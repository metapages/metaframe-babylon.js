var xl,Dt,QE,Al,qE,ZE,$E,Zh={},JE=[],UN=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function fo(a,u){for(var p in u)a[p]=u[p];return a}function eS(a){var u=a.parentNode;u&&u.removeChild(a)}function $e(a,u,p){var s,c,E,m={};for(E in u)E=="key"?s=u[E]:E=="ref"?c=u[E]:m[E]=u[E];if(arguments.length>2&&(m.children=arguments.length>3?xl.call(arguments,2):p),typeof a=="function"&&a.defaultProps!=null)for(E in a.defaultProps)m[E]===void 0&&(m[E]=a.defaultProps[E]);return Pl(a,m,s,c,null)}function Pl(a,u,p,s,c){var E={type:a,props:u,key:p,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:c??++QE};return Dt.vnode!=null&&Dt.vnode(E),E}function tS(){return{current:null}}function lr(a){return a.children}function fi(a,u){this.props=a,this.context=u}function zs(a,u){if(u==null)return a.__?zs(a.__,a.__.__k.indexOf(a)+1):null;for(var p;u<a.__k.length;u++)if((p=a.__k[u])!=null&&p.__e!=null)return p.__e;return typeof a.type=="function"?zs(a):null}function nS(a){var u,p;if((a=a.__)!=null&&a.__c!=null){for(a.__e=a.__c.base=null,u=0;u<a.__k.length;u++)if((p=a.__k[u])!=null&&p.__e!=null){a.__e=a.__c.base=p.__e;break}return nS(a)}}function p_(a){(!a.__d&&(a.__d=!0)&&Al.push(a)&&!$h.__r++||ZE!==Dt.debounceRendering)&&((ZE=Dt.debounceRendering)||qE)($h)}function $h(){for(var a;$h.__r=Al.length;)a=Al.sort(function(u,p){return u.__v.__b-p.__v.__b}),Al=[],a.some(function(u){var p,s,c,E,m,S;u.__d&&(m=(E=(p=u).__v).__e,(S=p.__P)&&(s=[],(c=fo({},E)).__v=E.__v+1,m_(S,E,c,p.__n,S.ownerSVGElement!==void 0,E.__h!=null?[m]:null,s,m??zs(E),E.__h),lS(s,E),E.__e!=m&&nS(E)))})}function rS(a,u,p,s,c,E,m,S,h,C){var R,I,b,f,x,P,A,T=s&&s.__k||JE,_=T.length;for(p.__k=[],R=0;R<u.length;R++)if((f=p.__k[R]=(f=u[R])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?Pl(null,f,null,null,f):Array.isArray(f)?Pl(lr,{children:f},null,null,null):f.__b>0?Pl(f.type,f.props,f.key,null,f.__v):f)!=null){if(f.__=p,f.__b=p.__b+1,(b=T[R])===null||b&&f.key==b.key&&f.type===b.type)T[R]=void 0;else for(I=0;I<_;I++){if((b=T[I])&&f.key==b.key&&f.type===b.type){T[I]=void 0;break}b=null}m_(a,f,b=b||Zh,c,E,m,S,h,C),x=f.__e,(I=f.ref)&&b.ref!=I&&(A||(A=[]),b.ref&&A.push(b.ref,null,f),A.push(I,f.__c||x,f)),x!=null?(P==null&&(P=x),typeof f.type=="function"&&f.__k!=null&&f.__k===b.__k?f.__d=h=iS(f,h,a):h=oS(a,f,b,T,x,h),C||p.type!=="option"?typeof p.type=="function"&&(p.__d=h):a.value=""):h&&b.__e==h&&h.parentNode!=a&&(h=zs(b))}for(p.__e=P,R=_;R--;)T[R]!=null&&(typeof p.type=="function"&&T[R].__e!=null&&T[R].__e==p.__d&&(p.__d=zs(s,R+1)),hS(T[R],T[R]));if(A)for(R=0;R<A.length;R++)uS(A[R],A[++R],A[++R])}function iS(a,u,p){var s,c;for(s=0;s<a.__k.length;s++)(c=a.__k[s])&&(c.__=a,u=typeof c.type=="function"?iS(c,u,p):oS(p,c,c,a.__k,c.__e,u));return u}function po(a,u){return u=u||[],a==null||typeof a=="boolean"||(Array.isArray(a)?a.some(function(p){po(p,u)}):u.push(a)),u}function oS(a,u,p,s,c,E){var m,S,h;if(u.__d!==void 0)m=u.__d,u.__d=void 0;else if(p==null||c!=E||c.parentNode==null)e:if(E==null||E.parentNode!==a)a.appendChild(c),m=null;else{for(S=E,h=0;(S=S.nextSibling)&&h<s.length;h+=2)if(S==c)break e;a.insertBefore(c,E),m=E}return m!==void 0?m:c.nextSibling}function VN(a,u,p,s,c){var E;for(E in p)E==="children"||E==="key"||E in u||Jh(a,E,null,p[E],s);for(E in u)c&&typeof u[E]!="function"||E==="children"||E==="key"||E==="value"||E==="checked"||p[E]===u[E]||Jh(a,E,u[E],p[E],s)}function aS(a,u,p){u[0]==="-"?a.setProperty(u,p):a[u]=p==null?"":typeof p!="number"||UN.test(u)?p:p+"px"}function Jh(a,u,p,s,c){var E;e:if(u==="style")if(typeof p=="string")a.style.cssText=p;else{if(typeof s=="string"&&(a.style.cssText=s=""),s)for(u in s)p&&u in p||aS(a.style,u,"");if(p)for(u in p)s&&p[u]===s[u]||aS(a.style,u,p[u])}else if(u[0]==="o"&&u[1]==="n")E=u!==(u=u.replace(/Capture$/,"")),u=u.toLowerCase()in a?u.toLowerCase().slice(2):u.slice(2),a.l||(a.l={}),a.l[u+E]=p,p?s||a.addEventListener(u,E?cS:sS,E):a.removeEventListener(u,E?cS:sS,E);else if(u!=="dangerouslySetInnerHTML"){if(c)u=u.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(u!=="href"&&u!=="list"&&u!=="form"&&u!=="tabIndex"&&u!=="download"&&u in a)try{a[u]=p??"";break e}catch(m){}typeof p=="function"||(p!=null&&(p!==!1||u[0]==="a"&&u[1]==="r")?a.setAttribute(u,p):a.removeAttribute(u))}}function sS(a){this.l[a.type+!1](Dt.event?Dt.event(a):a)}function cS(a){this.l[a.type+!0](Dt.event?Dt.event(a):a)}function m_(a,u,p,s,c,E,m,S,h){var C,R,I,b,f,x,P,A,T,_,g,M=u.type;if(u.constructor!==void 0)return null;p.__h!=null&&(h=p.__h,S=u.__e=p.__e,u.__h=null,E=[S]),(C=Dt.__b)&&C(u);try{e:if(typeof M=="function"){if(A=u.props,T=(C=M.contextType)&&s[C.__c],_=C?T?T.props.value:C.__:s,p.__c?P=(R=u.__c=p.__c).__=R.__E:("prototype"in M&&M.prototype.render?u.__c=R=new M(A,_):(u.__c=R=new fi(A,_),R.constructor=M,R.render=jN),T&&T.sub(R),R.props=A,R.state||(R.state={}),R.context=_,R.__n=s,I=R.__d=!0,R.__h=[]),R.__s==null&&(R.__s=R.state),M.getDerivedStateFromProps!=null&&(R.__s==R.state&&(R.__s=fo({},R.__s)),fo(R.__s,M.getDerivedStateFromProps(A,R.__s))),b=R.props,f=R.state,I)M.getDerivedStateFromProps==null&&R.componentWillMount!=null&&R.componentWillMount(),R.componentDidMount!=null&&R.__h.push(R.componentDidMount);else{if(M.getDerivedStateFromProps==null&&A!==b&&R.componentWillReceiveProps!=null&&R.componentWillReceiveProps(A,_),!R.__e&&R.shouldComponentUpdate!=null&&R.shouldComponentUpdate(A,R.__s,_)===!1||u.__v===p.__v){R.props=A,R.state=R.__s,u.__v!==p.__v&&(R.__d=!1),R.__v=u,u.__e=p.__e,u.__k=p.__k,u.__k.forEach(function(O){O&&(O.__=u)}),R.__h.length&&m.push(R);break e}R.componentWillUpdate!=null&&R.componentWillUpdate(A,R.__s,_),R.componentDidUpdate!=null&&R.__h.push(function(){R.componentDidUpdate(b,f,x)})}R.context=_,R.props=A,R.state=R.__s,(C=Dt.__r)&&C(u),R.__d=!1,R.__v=u,R.__P=a,C=R.render(R.props,R.state,R.context),R.state=R.__s,R.getChildContext!=null&&(s=fo(fo({},s),R.getChildContext())),I||R.getSnapshotBeforeUpdate==null||(x=R.getSnapshotBeforeUpdate(b,f)),g=C!=null&&C.type===lr&&C.key==null?C.props.children:C,rS(a,Array.isArray(g)?g:[g],u,p,s,c,E,m,S,h),R.base=u.__e,u.__h=null,R.__h.length&&m.push(R),P&&(R.__E=R.__=null),R.__e=!1}else E==null&&u.__v===p.__v?(u.__k=p.__k,u.__e=p.__e):u.__e=kN(p.__e,u,p,s,c,E,m,h);(C=Dt.diffed)&&C(u)}catch(O){u.__v=null,(h||E!=null)&&(u.__e=S,u.__h=!!h,E[E.indexOf(S)]=null),Dt.__e(O,u,p)}}function lS(a,u){Dt.__c&&Dt.__c(u,a),a.some(function(p){try{a=p.__h,p.__h=[],a.some(function(s){s.call(p)})}catch(s){Dt.__e(s,p.__v)}})}function kN(a,u,p,s,c,E,m,S){var h,C,R,I=p.props,b=u.props,f=u.type,x=0;if(f==="svg"&&(c=!0),E!=null){for(;x<E.length;x++)if((h=E[x])&&(h===a||(f?h.localName==f:h.nodeType==3))){a=h,E[x]=null;break}}if(a==null){if(f===null)return document.createTextNode(b);a=c?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,b.is&&b),E=null,S=!1}if(f===null)I===b||S&&a.data===b||(a.data=b);else{if(E=E&&xl.call(a.childNodes),C=(I=p.props||Zh).dangerouslySetInnerHTML,R=b.dangerouslySetInnerHTML,!S){if(E!=null)for(I={},x=0;x<a.attributes.length;x++)I[a.attributes[x].name]=a.attributes[x].value;(R||C)&&(R&&(C&&R.__html==C.__html||R.__html===a.innerHTML)||(a.innerHTML=R&&R.__html||""))}if(VN(a,b,I,c,S),R)u.__k=[];else if(x=u.props.children,rS(a,Array.isArray(x)?x:[x],u,p,s,c&&f!=="foreignObject",E,m,E?E[0]:p.__k&&zs(p,0),S),E!=null)for(x=E.length;x--;)E[x]!=null&&eS(E[x]);S||("value"in b&&(x=b.value)!==void 0&&(x!==a.value||f==="progress"&&!x)&&Jh(a,"value",x,I.value,!1),"checked"in b&&(x=b.checked)!==void 0&&x!==a.checked&&Jh(a,"checked",x,I.checked,!1))}return a}function uS(a,u,p){try{typeof a=="function"?a(u):a.current=u}catch(s){Dt.__e(s,p)}}function hS(a,u,p){var s,c;if(Dt.unmount&&Dt.unmount(a),(s=a.ref)&&(s.current&&s.current!==a.__e||uS(s,null,u)),(s=a.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(E){Dt.__e(E,u)}s.base=s.__P=null}if(s=a.__k)for(c=0;c<s.length;c++)s[c]&&hS(s[c],u,typeof a.type!="function");p||a.__e==null||eS(a.__e),a.__e=a.__d=void 0}function jN(a,u,p){return this.constructor(a,p)}function Gs(a,u,p){var s,c,E;Dt.__&&Dt.__(a,u),c=(s=typeof p=="function")?null:p&&p.__k||u.__k,E=[],m_(u,a=(!s&&p||u).__k=$e(lr,null,[a]),c||Zh,Zh,u.ownerSVGElement!==void 0,!s&&p?[p]:c?null:u.firstChild?xl.call(u.childNodes):null,E,!s&&p?p:c?c.__e:u.firstChild,s),lS(E,a)}function dS(a,u){Gs(a,u,dS)}function zN(a,u,p){var s,c,E,m=fo({},a.props);for(E in u)E=="key"?s=u[E]:E=="ref"?c=u[E]:m[E]=u[E];return arguments.length>2&&(m.children=arguments.length>3?xl.call(arguments,2):p),Pl(a.type,m,s||a.key,c||a.ref,null)}function Er(a,u){var p={__c:u="__cC"+$E++,__:a,Consumer:function(s,c){return s.children(c)},Provider:function(s){var c,E;return this.getChildContext||(c=[],(E={})[u]=this,this.getChildContext=function(){return E},this.shouldComponentUpdate=function(m){this.props.value!==m.value&&c.some(p_)},this.sub=function(m){c.push(m);var S=m.componentWillUnmount;m.componentWillUnmount=function(){c.splice(c.indexOf(m),1),S&&S.call(m)}}),s.children}};return p.Provider.__=p.Consumer.contextType=p}xl=JE.slice,Dt={__e:function(a,u){for(var p,s,c;u=u.__;)if((p=u.__c)&&!p.__)try{if((s=p.constructor)&&s.getDerivedStateFromError!=null&&(p.setState(s.getDerivedStateFromError(a)),c=p.__d),p.componentDidCatch!=null&&(p.componentDidCatch(a),c=p.__d),c)return p.__E=p}catch(E){a=E}throw a}},QE=0,fi.prototype.setState=function(a,u){var p;p=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=fo({},this.state),typeof a=="function"&&(a=a(fo({},p),this.props)),a&&fo(p,a),a!=null&&this.__v&&(u&&this.__h.push(u),p_(this))},fi.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),p_(this))},fi.prototype.render=lr,Al=[],qE=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,$h.__r=0,$E=0;var Fa,Sr,fS,Hs=0,__=[],pS=Dt.__b,mS=Dt.__r,_S=Dt.diffed,gS=Dt.__c,vS=Dt.unmount;function Ws(a,u){Dt.__h&&Dt.__h(Sr,a,Hs||u),Hs=0;var p=Sr.__H||(Sr.__H={__:[],__h:[]});return a>=p.__.length&&p.__.push({}),p.__[a]}function ln(a){return Hs=1,ed(ES,a)}function ed(a,u,p){var s=Ws(Fa++,2);return s.t=a,s.__c||(s.__=[p?p(u):ES(void 0,u),function(c){var E=s.t(s.__[0],c);s.__[0]!==E&&(s.__=[E,s.__[1]],s.__c.setState({}))}],s.__c=Sr),s.__}function Vt(a,u){var p=Ws(Fa++,3);!Dt.__s&&v_(p.__H,u)&&(p.__=a,p.__H=u,Sr.__H.__h.push(p))}function $o(a,u){var p=Ws(Fa++,4);!Dt.__s&&v_(p.__H,u)&&(p.__=a,p.__H=u,Sr.__h.push(p))}function zt(a){return Hs=5,Hn(function(){return{current:a}},[])}function bS(a,u,p){Hs=6,$o(function(){typeof a=="function"?a(u()):a&&(a.current=u())},p==null?p:p.concat(a))}function Hn(a,u){var p=Ws(Fa++,7);return v_(p.__H,u)&&(p.__=a(),p.__H=u,p.__h=a),p.__}function Gt(a,u){return Hs=8,Hn(function(){return a},u)}function cn(a){var u=Sr.context[a.__c],p=Ws(Fa++,9);return p.c=a,u?(p.__==null&&(p.__=!0,u.sub(Sr)),u.props.value):a.__}function yS(a,u){Dt.useDebugValue&&Dt.useDebugValue(u?u(a):a)}function GN(a){var u=Ws(Fa++,10),p=ln();return u.__=a,Sr.componentDidCatch||(Sr.componentDidCatch=function(s){u.__&&u.__(s),p[1](s)}),[p[0],function(){p[1](void 0)}]}function HN(){__.forEach(function(a){if(a.__P)try{a.__H.__h.forEach(td),a.__H.__h.forEach(g_),a.__H.__h=[]}catch(u){a.__H.__h=[],Dt.__e(u,a.__v)}}),__=[]}Dt.__b=function(a){Sr=null,pS&&pS(a)},Dt.__r=function(a){mS&&mS(a),Fa=0;var u=(Sr=a.__c).__H;u&&(u.__h.forEach(td),u.__h.forEach(g_),u.__h=[])},Dt.diffed=function(a){_S&&_S(a);var u=a.__c;u&&u.__H&&u.__H.__h.length&&(__.push(u)!==1&&fS===Dt.requestAnimationFrame||((fS=Dt.requestAnimationFrame)||function(p){var s,c=function(){clearTimeout(E),TS&&cancelAnimationFrame(s),setTimeout(p)},E=setTimeout(c,100);TS&&(s=requestAnimationFrame(c))})(HN)),Sr=void 0},Dt.__c=function(a,u){u.some(function(p){try{p.__h.forEach(td),p.__h=p.__h.filter(function(s){return!s.__||g_(s)})}catch(s){u.some(function(c){c.__h&&(c.__h=[])}),u=[],Dt.__e(s,p.__v)}}),gS&&gS(a,u)},Dt.unmount=function(a){vS&&vS(a);var u=a.__c;if(u&&u.__H)try{u.__H.__.forEach(td)}catch(p){Dt.__e(p,u.__v)}};var TS=typeof requestAnimationFrame=="function";function td(a){var u=Sr;typeof a.__c=="function"&&a.__c(),Sr=u}function g_(a){var u=Sr;a.__c=a.__(),Sr=u}function v_(a,u){return!a||a.length!==u.length||u.some(function(p,s){return p!==a[s]})}function ES(a,u){return typeof u=="function"?u(a):u}function SS(a,u){for(var p in u)a[p]=u[p];return a}function b_(a,u){for(var p in a)if(p!=="__source"&&!(p in u))return!0;for(var s in u)if(s!=="__source"&&a[s]!==u[s])return!0;return!1}function Cl(a){this.props=a}function Rl(a,u){function p(c){var E=this.props.ref,m=E==c.ref;return!m&&E&&(E.call?E(null):E.current=null),u?!u(this.props,c)||!m:b_(this.props,c)}function s(c){return this.shouldComponentUpdate=p,$e(a,c)}return s.displayName="Memo("+(a.displayName||a.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s}(Cl.prototype=new fi).isPureReactComponent=!0,Cl.prototype.shouldComponentUpdate=function(a,u){return b_(this.props,a)||b_(this.state,u)};var xS=Dt.__b;Dt.__b=function(a){a.type&&a.type.__f&&a.ref&&(a.props.ref=a.ref,a.ref=null),xS&&xS(a)};var WN=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Ci(a){function u(p,s){var c=SS({},p);return delete c.ref,a(c,(s=p.ref||s)&&(typeof s!="object"||"current"in s)?s:null)}return u.$$typeof=WN,u.render=u,u.prototype.isReactComponent=u.__f=!0,u.displayName="ForwardRef("+(a.displayName||a.name)+")",u}var AS=function(a,u){return a==null?null:po(po(a).map(u))},Ol={map:AS,forEach:AS,count:function(a){return a?po(a).length:0},only:function(a){var u=po(a);if(u.length!==1)throw"Children.only";return u[0]},toArray:po},XN=Dt.__e;Dt.__e=function(a,u,p){if(a.then){for(var s,c=u;c=c.__;)if((s=c.__c)&&s.__c)return u.__e==null&&(u.__e=p.__e,u.__k=p.__k),s.__c(a,u)}XN(a,u,p)};var PS=Dt.unmount;function Ml(){this.__u=0,this.t=null,this.__b=null}function CS(a){var u=a.__.__c;return u&&u.__e&&u.__e(a)}function RS(a){var u,p,s;function c(E){if(u||(u=a()).then(function(m){p=m.default||m},function(m){s=m}),s)throw s;if(!p)throw u;return $e(p,E)}return c.displayName="Lazy",c.__f=!0,c}function Xs(){this.u=null,this.o=null}Dt.unmount=function(a){var u=a.__c;u&&u.__R&&u.__R(),u&&a.__h===!0&&(a.type=null),PS&&PS(a)},(Ml.prototype=new fi).__c=function(a,u){var p=u.__c,s=this;s.t==null&&(s.t=[]),s.t.push(p);var c=CS(s.__v),E=!1,m=function(){E||(E=!0,p.__R=null,c?c(S):S())};p.__R=m;var S=function(){if(!--s.__u){if(s.state.__e){var C=s.state.__e;s.__v.__k[0]=function I(b,f,x){return b&&(b.__v=null,b.__k=b.__k&&b.__k.map(function(P){return I(P,f,x)}),b.__c&&b.__c.__P===f&&(b.__e&&x.insertBefore(b.__e,b.__d),b.__c.__e=!0,b.__c.__P=x)),b}(C,C.__c.__P,C.__c.__O)}var R;for(s.setState({__e:s.__b=null});R=s.t.pop();)R.forceUpdate()}},h=u.__h===!0;s.__u++||h||s.setState({__e:s.__b=s.__v.__k[0]}),a.then(m,m)},Ml.prototype.componentWillUnmount=function(){this.t=[]},Ml.prototype.render=function(a,u){if(this.__b){if(this.__v.__k){var p=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=function E(m,S,h){return m&&(m.__c&&m.__c.__H&&(m.__c.__H.__.forEach(function(C){typeof C.__c=="function"&&C.__c()}),m.__c.__H=null),(m=SS({},m)).__c!=null&&(m.__c.__P===h&&(m.__c.__P=S),m.__c=null),m.__k=m.__k&&m.__k.map(function(C){return E(C,S,h)})),m}(this.__b,p,s.__O=s.__P)}this.__b=null}var c=u.__e&&$e(lr,null,a.fallback);return c&&(c.__h=null),[$e(lr,null,u.__e?null:a.children),c]};var OS=function(a,u,p){if(++p[1]===p[0]&&a.o.delete(u),a.props.revealOrder&&(a.props.revealOrder[0]!=="t"||!a.o.size))for(p=a.u;p;){for(;p.length>3;)p.pop()();if(p[1]<p[0])break;a.u=p=p[2]}};function YN(a){return this.getChildContext=function(){return a.context},a.children}function KN(a){var u=this,p=a.i;u.componentWillUnmount=function(){Gs(null,u.l),u.l=null,u.i=null},u.i&&u.i!==p&&u.componentWillUnmount(),a.__v?(u.l||(u.i=p,u.l={nodeType:1,parentNode:p,childNodes:[],appendChild:function(s){this.childNodes.push(s),u.i.appendChild(s)},insertBefore:function(s,c){this.childNodes.push(s),u.i.appendChild(s)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),u.i.removeChild(s)}}),Gs($e(YN,{context:u.context},a.__v),u.l)):u.l&&u.componentWillUnmount()}function nd(a,u){return $e(KN,{__v:a,i:u})}(Xs.prototype=new fi).__e=function(a){var u=this,p=CS(u.__v),s=u.o.get(a);return s[0]++,function(c){var E=function(){u.props.revealOrder?(s.push(c),OS(u,a,s)):c()};p?p(E):E()}},Xs.prototype.render=function(a){this.u=null,this.o=new Map;var u=po(a.children);a.revealOrder&&a.revealOrder[0]==="b"&&u.reverse();for(var p=u.length;p--;)this.o.set(u[p],this.u=[1,0,this.u]);return a.children},Xs.prototype.componentDidUpdate=Xs.prototype.componentDidMount=function(){var a=this;this.o.forEach(function(u,p){OS(a,p,u)})};var MS=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,QN=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,qN=function(a){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(a)};function IS(a,u,p){return u.__k==null&&(u.textContent=""),Gs(a,u),typeof p=="function"&&p(),a?a.__c:null}function DS(a,u,p){return dS(a,u),typeof p=="function"&&p(),a?a.__c:null}fi.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(a){Object.defineProperty(fi.prototype,a,{configurable:!0,get:function(){return this["UNSAFE_"+a]},set:function(u){Object.defineProperty(this,a,{configurable:!0,writable:!0,value:u})}})});var wS=Dt.event;function ZN(){}function $N(){return this.cancelBubble}function JN(){return this.defaultPrevented}Dt.event=function(a){return wS&&(a=wS(a)),a.persist=ZN,a.isPropagationStopped=$N,a.isDefaultPrevented=JN,a.nativeEvent=a};var LS,NS={configurable:!0,get:function(){return this.class}},FS=Dt.vnode;Dt.vnode=function(a){var u=a.type,p=a.props,s=p;if(typeof u=="string"){for(var c in s={},p){var E=p[c];c==="value"&&"defaultValue"in p&&E==null||(c==="defaultValue"&&"value"in p&&p.value==null?c="value":c==="download"&&E===!0?E="":/ondoubleclick/i.test(c)?c="ondblclick":/^onchange(textarea|input)/i.test(c+u)&&!qN(p.type)?c="oninput":/^on(Ani|Tra|Tou|BeforeInp)/.test(c)?c=c.toLowerCase():QN.test(c)?c=c.replace(/[A-Z0-9]/,"-$&").toLowerCase():E===null&&(E=void 0),s[c]=E)}u=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=po(p.children).forEach(function(m){m.props.selected=s.value.indexOf(m.props.value)!=-1})),u=="select"&&s.defaultValue!=null&&(s.value=po(p.children).forEach(function(m){m.props.selected=s.multiple?s.defaultValue.indexOf(m.props.value)!=-1:s.defaultValue==m.props.value})),a.props=s}u&&p.class!=p.className&&(NS.enumerable="className"in p,p.className!=null&&(s.class=p.className),Object.defineProperty(s,"className",NS)),a.$$typeof=MS,FS&&FS(a)};var BS=Dt.__r;Dt.__r=function(a){BS&&BS(a),LS=a.__c};var US={ReactCurrentDispatcher:{current:{readContext:function(a){return LS.__n[a.__c].props.value}}}},eF="17.0.2";function VS(a){return $e.bind(null,a)}function Jo(a){return!!a&&a.$$typeof===MS}function ea(a){return Jo(a)?zN.apply(null,arguments):a}function kS(a){return!!a.__k&&(Gs(null,a),!0)}function jS(a){return a&&(a.base||a.nodeType===1&&a)||null}var zS=function(a,u){return a(u)},GS=function(a,u){return a(u)},tF=lr,Jr={useState:ln,useReducer:ed,useEffect:Vt,useLayoutEffect:$o,useRef:zt,useImperativeHandle:bS,useMemo:Hn,useCallback:Gt,useContext:cn,useDebugValue:yS,version:"17.0.2",Children:Ol,render:IS,hydrate:DS,unmountComponentAtNode:kS,createPortal:nd,createElement:$e,createContext:Er,createFactory:VS,cloneElement:ea,createRef:tS,Fragment:lr,isValidElement:Jo,findDOMNode:jS,Component:fi,PureComponent:Cl,memo:Rl,forwardRef:Ci,flushSync:GS,unstable_batchedUpdates:zS,StrictMode:lr,Suspense:Ml,SuspenseList:Xs,lazy:RS,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:US},nF=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Jr,version:eF,Children:Ol,render:IS,hydrate:DS,unmountComponentAtNode:kS,createPortal:nd,createFactory:VS,cloneElement:ea,isValidElement:Jo,findDOMNode:jS,PureComponent:Cl,memo:Rl,forwardRef:Ci,flushSync:GS,unstable_batchedUpdates:zS,StrictMode:tF,Suspense:Ml,SuspenseList:Xs,lazy:RS,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:US,createElement:$e,createContext:Er,createRef:tS,Fragment:lr,Component:fi,useState:ln,useReducer:ed,useEffect:Vt,useLayoutEffect:$o,useRef:zt,useImperativeHandle:bS,useMemo:Hn,useCallback:Gt,useContext:cn,useDebugValue:yS,useErrorBoundary:GN}),Be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function rF(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function y_(a){if(a.__esModule)return a;var u=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(a).forEach(function(p){var s=Object.getOwnPropertyDescriptor(a,p);Object.defineProperty(u,p,s.get?s:{enumerable:!0,get:function(){return a[p]}})}),u}var iF={},oF=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:iF}),aF=y_(oF),sF=function(a,u){for(var p=[],s=0;s<a.length;s++){var c=u(a[s],s);cF(c)?p.push.apply(p,c):p.push(c)}return p},cF=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},lF=HS;function HS(a,u,p){a instanceof RegExp&&(a=WS(a,p)),u instanceof RegExp&&(u=WS(u,p));var s=XS(a,u,p);return s&&{start:s[0],end:s[1],pre:p.slice(0,s[0]),body:p.slice(s[0]+a.length,s[1]),post:p.slice(s[1]+u.length)}}function WS(a,u){var p=u.match(a);return p?p[0]:null}HS.range=XS;function XS(a,u,p){var s,c,E,m,S,h=p.indexOf(a),C=p.indexOf(u,h+1),R=h;if(h>=0&&C>0){if(a===u)return[h,C];for(s=[],E=p.length;R>=0&&!S;)R==h?(s.push(R),h=p.indexOf(a,R+1)):s.length==1?S=[s.pop(),C]:(c=s.pop(),c<E&&(E=c,m=C),C=p.indexOf(u,R+1)),R=h<C&&h>=0?h:C;s.length&&(S=[E,m])}return S}var uF=sF,YS=lF,hF=pF,KS="\0SLASH"+Math.random()+"\0",QS="\0OPEN"+Math.random()+"\0",T_="\0CLOSE"+Math.random()+"\0",qS="\0COMMA"+Math.random()+"\0",ZS="\0PERIOD"+Math.random()+"\0";function E_(a){return parseInt(a,10)==a?parseInt(a,10):a.charCodeAt(0)}function dF(a){return a.split("\\\\").join(KS).split("\\{").join(QS).split("\\}").join(T_).split("\\,").join(qS).split("\\.").join(ZS)}function fF(a){return a.split(KS).join("\\").split(QS).join("{").split(T_).join("}").split(qS).join(",").split(ZS).join(".")}function $S(a){if(!a)return[""];var u=[],p=YS("{","}",a);if(!p)return a.split(",");var s=p.pre,c=p.body,E=p.post,m=s.split(",");m[m.length-1]+="{"+c+"}";var S=$S(E);return E.length&&(m[m.length-1]+=S.shift(),m.push.apply(m,S)),u.push.apply(u,m),u}function pF(a){return a?(a.substr(0,2)==="{}"&&(a="\\{\\}"+a.substr(2)),Ys(dF(a),!0).map(fF)):[]}function mF(a){return"{"+a+"}"}function _F(a){return/^-?0\d/.test(a)}function gF(a,u){return a<=u}function vF(a,u){return a>=u}function Ys(a,u){var p=[],s=YS("{","}",a);if(!s||/\$$/.test(s.pre))return[a];var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),E=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),m=c||E,S=s.body.indexOf(",")>=0;if(!m&&!S)return s.post.match(/,.*\}/)?(a=s.pre+"{"+s.body+T_+s.post,Ys(a)):[a];var h;if(m)h=s.body.split(/\.\./);else if(h=$S(s.body),h.length===1&&(h=Ys(h[0],!1).map(mF),h.length===1)){var R=s.post.length?Ys(s.post,!1):[""];return R.map(function(Y){return s.pre+h[0]+Y})}var C=s.pre,R=s.post.length?Ys(s.post,!1):[""],I;if(m){var b=E_(h[0]),f=E_(h[1]),x=Math.max(h[0].length,h[1].length),P=h.length==3?Math.abs(E_(h[2])):1,A=gF,T=f<b;T&&(P*=-1,A=vF);var _=h.some(_F);I=[];for(var g=b;A(g,f);g+=P){var M;if(E)M=String.fromCharCode(g),M==="\\"&&(M="");else if(M=String(g),_){var O=x-M.length;if(O>0){var N=new Array(O+1).join("0");g<0?M="-"+N+M.slice(1):M=N+M}}I.push(M)}}else I=uF(h,function(j){return Ys(j,!1)});for(var V=0;V<I.length;V++)for(var U=0;U<R.length;U++){var L=C+I[V]+R[U];(!u||m||L)&&p.push(L)}return p}var bF=pi;pi.Minimatch=pr;var Il={sep:"/"};try{Il=aF}catch(a){}var S_=pi.GLOBSTAR=pr.GLOBSTAR={},yF=hF,JS={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},x_="[^/]",A_=x_+"*?",TF="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",EF="(?:(?!(?:\\/|^)\\.).)*?",ex=SF("().*{}+?[]^$\\!");function SF(a){return a.split("").reduce(function(u,p){return u[p]=!0,u},{})}var tx=/\/+/;pi.filter=xF;function xF(a,u){return u=u||{},function(p,s,c){return pi(p,a,u)}}function nx(a,u){a=a||{},u=u||{};var p={};return Object.keys(u).forEach(function(s){p[s]=u[s]}),Object.keys(a).forEach(function(s){p[s]=a[s]}),p}pi.defaults=function(a){if(!a||!Object.keys(a).length)return pi;var u=pi,p=function(c,E,m){return u.minimatch(c,E,nx(a,m))};return p.Minimatch=function(c,E){return new u.Minimatch(c,nx(a,E))},p},pr.defaults=function(a){return!a||!Object.keys(a).length?pr:pi.defaults(a).Minimatch};function pi(a,u,p){if(typeof u!="string")throw new TypeError("glob pattern string required");return p||(p={}),!p.nocomment&&u.charAt(0)==="#"?!1:u.trim()===""?a==="":new pr(u,p).match(a)}function pr(a,u){if(!(this instanceof pr))return new pr(a,u);if(typeof a!="string")throw new TypeError("glob pattern string required");u||(u={}),a=a.trim(),Il.sep!=="/"&&(a=a.split(Il.sep).join("/")),this.options=u,this.set=[],this.pattern=a,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}pr.prototype.debug=function(){},pr.prototype.make=AF;function AF(){if(!this._made){var a=this.pattern,u=this.options;if(!u.nocomment&&a.charAt(0)==="#"){this.comment=!0;return}if(!a){this.empty=!0;return}this.parseNegate();var p=this.globSet=this.braceExpand();u.debug&&(this.debug=console.error),this.debug(this.pattern,p),p=this.globParts=p.map(function(s){return s.split(tx)}),this.debug(this.pattern,p),p=p.map(function(s,c,E){return s.map(this.parse,this)},this),this.debug(this.pattern,p),p=p.filter(function(s){return s.indexOf(!1)===-1}),this.debug(this.pattern,p),this.set=p}}pr.prototype.parseNegate=PF;function PF(){var a=this.pattern,u=!1,p=this.options,s=0;if(!p.nonegate){for(var c=0,E=a.length;c<E&&a.charAt(c)==="!";c++)u=!u,s++;s&&(this.pattern=a.substr(s)),this.negate=u}}pi.braceExpand=function(a,u){return rx(a,u)},pr.prototype.braceExpand=rx;function rx(a,u){if(u||(this instanceof pr?u=this.options:u={}),a=typeof a=="undefined"?this.pattern:a,typeof a=="undefined")throw new TypeError("undefined pattern");return u.nobrace||!a.match(/\{.*\}/)?[a]:yF(a)}pr.prototype.parse=CF;var rd={};function CF(a,u){if(a.length>1024*64)throw new TypeError("pattern is too long");var p=this.options;if(!p.noglobstar&&a==="**")return S_;if(a==="")return"";var s="",c=!!p.nocase,E=!1,m=[],S=[],h,C=!1,R=-1,I=-1,b=a.charAt(0)==="."?"":p.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",f=this;function x(){if(h){switch(h){case"*":s+=A_,c=!0;break;case"?":s+=x_,c=!0;break;default:s+="\\"+h;break}f.debug("clearStateChar %j %j",h,s),h=!1}}for(var P=0,A=a.length,T;P<A&&(T=a.charAt(P));P++){if(this.debug("%s	%s %s %j",a,P,s,T),E&&ex[T]){s+="\\"+T,E=!1;continue}switch(T){case"/":return!1;case"\\":x(),E=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",a,P,s,T),C){this.debug("  in class"),T==="!"&&P===I+1&&(T="^"),s+=T;continue}f.debug("call clearStateChar %j",h),x(),h=T,p.noext&&x();continue;case"(":if(C){s+="(";continue}if(!h){s+="\\(";continue}m.push({type:h,start:P-1,reStart:s.length,open:JS[h].open,close:JS[h].close}),s+=h==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,s),h=!1;continue;case")":if(C||!m.length){s+="\\)";continue}x(),c=!0;var _=m.pop();s+=_.close,_.type==="!"&&S.push(_),_.reEnd=s.length;continue;case"|":if(C||!m.length||E){s+="\\|",E=!1;continue}x(),s+="|";continue;case"[":if(x(),C){s+="\\"+T;continue}C=!0,I=P,R=s.length,s+=T;continue;case"]":if(P===I+1||!C){s+="\\"+T,E=!1;continue}if(C){var g=a.substring(I+1,P);try{RegExp("["+g+"]")}catch(J){var M=this.parse(g,rd);s=s.substr(0,R)+"\\["+M[0]+"\\]",c=c||M[1],C=!1;continue}}c=!0,C=!1,s+=T;continue;default:x(),E?E=!1:ex[T]&&!(T==="^"&&C)&&(s+="\\"),s+=T}}for(C&&(g=a.substr(I+1),M=this.parse(g,rd),s=s.substr(0,R)+"\\["+M[0],c=c||M[1]),_=m.pop();_;_=m.pop()){var O=s.slice(_.reStart+_.open.length);this.debug("setting tail",s,_),O=O.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(J,B,G){return G||(G="\\"),B+B+G+"|"}),this.debug(`tail=%j
   %s`,O,O,_,s);var N=_.type==="*"?A_:_.type==="?"?x_:"\\"+_.type;c=!0,s=s.slice(0,_.reStart)+N+"\\("+O}x(),E&&(s+="\\\\");var V=!1;switch(s.charAt(0)){case".":case"[":case"(":V=!0}for(var U=S.length-1;U>-1;U--){var L=S[U],j=s.slice(0,L.reStart),Y=s.slice(L.reStart,L.reEnd-8),W=s.slice(L.reEnd-8,L.reEnd),ie=s.slice(L.reEnd);W+=ie;var re=j.split("(").length-1,ye=ie;for(P=0;P<re;P++)ye=ye.replace(/\)[+*?]?/,"");ie=ye;var ve="";ie===""&&u!==rd&&(ve="$");var ue=j+Y+ie+ve+W;s=ue}if(s!==""&&c&&(s="(?=.)"+s),V&&(s=b+s),u===rd)return[s,c];if(!c)return MF(a);var oe=p.nocase?"i":"";try{var Z=new RegExp("^"+s+"$",oe)}catch(J){return new RegExp("$.")}return Z._glob=a,Z._src=s,Z}pi.makeRe=function(a,u){return new pr(a,u||{}).makeRe()},pr.prototype.makeRe=RF;function RF(){if(this.regexp||this.regexp===!1)return this.regexp;var a=this.set;if(!a.length)return this.regexp=!1,this.regexp;var u=this.options,p=u.noglobstar?A_:u.dot?TF:EF,s=u.nocase?"i":"",c=a.map(function(E){return E.map(function(m){return m===S_?p:typeof m=="string"?IF(m):m._src}).join("\\/")}).join("|");c="^(?:"+c+")$",this.negate&&(c="^(?!"+c+").*$");try{this.regexp=new RegExp(c,s)}catch(E){this.regexp=!1}return this.regexp}pi.match=function(a,u,p){p=p||{};var s=new pr(u,p);return a=a.filter(function(c){return s.match(c)}),s.options.nonull&&!a.length&&a.push(u),a},pr.prototype.match=OF;function OF(a,u){if(this.debug("match",a,this.pattern),this.comment)return!1;if(this.empty)return a==="";if(a==="/"&&u)return!0;var p=this.options;Il.sep!=="/"&&(a=a.split(Il.sep).join("/")),a=a.split(tx),this.debug(this.pattern,"split",a);var s=this.set;this.debug(this.pattern,"set",s);var c,E;for(E=a.length-1;E>=0&&(c=a[E],!c);E--);for(E=0;E<s.length;E++){var m=s[E],S=a;p.matchBase&&m.length===1&&(S=[c]);var h=this.matchOne(S,m,u);if(h)return p.flipNegate?!0:!this.negate}return p.flipNegate?!1:this.negate}pr.prototype.matchOne=function(a,u,p){var s=this.options;this.debug("matchOne",{this:this,file:a,pattern:u}),this.debug("matchOne",a.length,u.length);for(var c=0,E=0,m=a.length,S=u.length;c<m&&E<S;c++,E++){this.debug("matchOne loop");var h=u[E],C=a[c];if(this.debug(u,h,C),h===!1)return!1;if(h===S_){this.debug("GLOBSTAR",[u,h,C]);var R=c,I=E+1;if(I===S){for(this.debug("** at the end");c<m;c++)if(a[c]==="."||a[c]===".."||!s.dot&&a[c].charAt(0)===".")return!1;return!0}for(;R<m;){var b=a[R];if(this.debug(`
globstar while`,a,R,u,I,b),this.matchOne(a.slice(R),u.slice(I),p))return this.debug("globstar found match!",R,m,b),!0;if(b==="."||b===".."||!s.dot&&b.charAt(0)==="."){this.debug("dot detected!",a,R,u,I);break}this.debug("globstar swallow a segment, and continue"),R++}return!!(p&&(this.debug(`
>>> no match, partial?`,a,R,u,I),R===m))}var f;if(typeof h=="string"?(s.nocase?f=C.toLowerCase()===h.toLowerCase():f=C===h,this.debug("string match",h,C,f)):(f=C.match(h),this.debug("pattern match",h,C,f)),!f)return!1}if(c===m&&E===S)return!0;if(c===m)return p;if(E===S){var x=c===m-1&&a[c]==="";return x}throw new Error("wtf?")};function MF(a){return a.replace(/\\(.)/g,"$1")}function IF(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var id;(function(a){a.V0_3="0.3",a.V0_4="0.4"})(id||(id={}));var Ri;(function(a){a.V0_2="0.2",a.V0_3="0.3"})(Ri||(Ri={}));const ix=Object.keys(id);id.V0_4;const ox=Object.keys(Ri),od=Ri.V0_3;var qt;(function(a){a.Inputs="inputs",a.Outputs="outputs",a.State="state",a.Definition="definition",a.DefinitionUpdateRequest="definitionupdaterequest",a.Error="error",a.UrlHashUpdate="urlhashupdate",a.Message="Message"})(qt||(qt={}));var Fr;(function(a){a.InputsUpdate="InputsUpdate",a.OutputsUpdate="OutputsUpdate",a.SetupIframeClientRequest="SetupIframeClientRequest",a.SetupIframeServerResponseAck="SetupIframeServerResponseAck",a.PluginRequest="SetupIframeServerPluginRequestResponseAck",a.HashParamsUpdate="HashParamsUpdate"})(Fr||(Fr={}));var mo;(function(a){a.InputsUpdate="InputsUpdate",a.MessageAck="MessageAck",a.SetupIframeServerResponse="SetupIframeServerResponse"})(mo||(mo={}));var P_;(function(a){a.State="metapage/state"})(P_||(P_={}));const Hi="metapage/definition",ta="metapage/state",ax=ox[ox.length-1],DF=ix[ix.length-1];var Dl={exports:{}};(function(a,u){(function(p,s){a.exports=s()})(Be,function(){var p=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function s(I,b){return I.indexOf(b)===-1?I.length:I.indexOf(b)}function c(I){var b=I.replace(/^v/,"").replace(/\+.*$/,""),f=s(b,"-"),x=b.substring(0,f).split(".");return x.push(b.substring(f+1)),x}function E(I){return isNaN(Number(I))?I:Number(I)}function m(I){if(typeof I!="string")throw new TypeError("Invalid argument expected string");if(!p.test(I))throw new Error("Invalid argument not valid semver ('"+I+"' received)")}function S(I,b){[I,b].forEach(m);for(var f=c(I),x=c(b),P=0;P<Math.max(f.length-1,x.length-1);P++){var A=parseInt(f[P]||0,10),T=parseInt(x[P]||0,10);if(A>T)return 1;if(T>A)return-1}var _=f[f.length-1],g=x[x.length-1];if(_&&g){var M=_.split(".").map(E),O=g.split(".").map(E);for(P=0;P<Math.max(M.length,O.length);P++){if(M[P]===void 0||typeof O[P]=="string"&&typeof M[P]=="number")return-1;if(O[P]===void 0||typeof M[P]=="string"&&typeof O[P]=="number"||M[P]>O[P])return 1;if(O[P]>M[P])return-1}}else if(_||g)return _?-1:1;return 0}var h=[">",">=","=","<","<="],C={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function R(I){if(typeof I!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof I);if(h.indexOf(I)===-1)throw new TypeError("Invalid operator, expected one of "+h.join("|"))}return S.validate=function(I){return typeof I=="string"&&p.test(I)},S.compare=function(I,b,f){R(f);var x=S(I,b);return C[f].indexOf(x)>-1},S})})(Dl);var ad={exports:{}};(function(a){var u=Object.prototype.hasOwnProperty,p="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(p=!1));function c(h,C,R){this.fn=h,this.context=C,this.once=R||!1}function E(h,C,R,I,b){if(typeof R!="function")throw new TypeError("The listener must be a function");var f=new c(R,I||h,b),x=p?p+C:C;return h._events[x]?h._events[x].fn?h._events[x]=[h._events[x],f]:h._events[x].push(f):(h._events[x]=f,h._eventsCount++),h}function m(h,C){--h._eventsCount==0?h._events=new s:delete h._events[C]}function S(){this._events=new s,this._eventsCount=0}S.prototype.eventNames=function(){var C=[],R,I;if(this._eventsCount===0)return C;for(I in R=this._events)u.call(R,I)&&C.push(p?I.slice(1):I);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(R)):C},S.prototype.listeners=function(C){var R=p?p+C:C,I=this._events[R];if(!I)return[];if(I.fn)return[I.fn];for(var b=0,f=I.length,x=new Array(f);b<f;b++)x[b]=I[b].fn;return x},S.prototype.listenerCount=function(C){var R=p?p+C:C,I=this._events[R];return I?I.fn?1:I.length:0},S.prototype.emit=function(C,R,I,b,f,x){var P=p?p+C:C;if(!this._events[P])return!1;var A=this._events[P],T=arguments.length,_,g;if(A.fn){switch(A.once&&this.removeListener(C,A.fn,void 0,!0),T){case 1:return A.fn.call(A.context),!0;case 2:return A.fn.call(A.context,R),!0;case 3:return A.fn.call(A.context,R,I),!0;case 4:return A.fn.call(A.context,R,I,b),!0;case 5:return A.fn.call(A.context,R,I,b,f),!0;case 6:return A.fn.call(A.context,R,I,b,f,x),!0}for(g=1,_=new Array(T-1);g<T;g++)_[g-1]=arguments[g];A.fn.apply(A.context,_)}else{var M=A.length,O;for(g=0;g<M;g++)switch(A[g].once&&this.removeListener(C,A[g].fn,void 0,!0),T){case 1:A[g].fn.call(A[g].context);break;case 2:A[g].fn.call(A[g].context,R);break;case 3:A[g].fn.call(A[g].context,R,I);break;case 4:A[g].fn.call(A[g].context,R,I,b);break;default:if(!_)for(O=1,_=new Array(T-1);O<T;O++)_[O-1]=arguments[O];A[g].fn.apply(A[g].context,_)}}return!0},S.prototype.on=function(C,R,I){return E(this,C,R,I,!1)},S.prototype.once=function(C,R,I){return E(this,C,R,I,!0)},S.prototype.removeListener=function(C,R,I,b){var f=p?p+C:C;if(!this._events[f])return this;if(!R)return m(this,f),this;var x=this._events[f];if(x.fn)x.fn===R&&(!b||x.once)&&(!I||x.context===I)&&m(this,f);else{for(var P=0,A=[],T=x.length;P<T;P++)(x[P].fn!==R||b&&!x[P].once||I&&x[P].context!==I)&&A.push(x[P]);A.length?this._events[f]=A.length===1?A[0]:A:m(this,f)}return this},S.prototype.removeAllListeners=function(C){var R;return C?(R=p?p+C:C,this._events[R]&&m(this,R)):(this._events=new s,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=p,S.EventEmitter=S,a.exports=S})(ad);var sd;(function(a){a.mp_debug="mp_debug"})(sd||(sd={}));const wF=()=>{try{return window!==window.top}catch(a){return!1}};class LF extends ad.exports.EventEmitter{constructor(){super();this._definition={version:Ri.V0_3,metaframes:{}},this.getDefinition=this.getDefinition.bind(this)}error(u){throw"Subclass should implement"}getDefinition(){return this._definition}}var NF=function(a,u,p,s){function c(E){return E instanceof p?E:new p(function(m){m(E)})}return new(p||(p=Promise))(function(E,m){function S(R){try{C(s.next(R))}catch(I){m(I)}}function h(R){try{C(s.throw(R))}catch(I){m(I)}}function C(R){R.done?E(R.value):c(R.value).then(S,h)}C((s=s.apply(a,u||[])).next())})};const sx=a=>{if(a===null)throw"Metapage definition cannot be null";if(typeof a=="string")try{a=JSON.parse(a)}catch(p){throw`Cannot parse into JSON:
${a}`}let u;switch(BF(a.version)){case Ri.V0_2:{u=sx(FF(a));break}case Ri.V0_3:{u=a;break}default:console.warn(`Metapage definition version=${a.version} but we only know up to version ${od}. Assuming the definition is compatible, but it's the future!`),u=a;break}return u},FF=a=>(a.version=Ri.V0_3,a),cd=(a,u)=>{if(!u)return!1;let p=!1;return Object.keys(u).forEach(s=>{p=!0,u[s]===void 0?delete a[s]:a[s]=u[s]}),p},BF=a=>{if(a=="latest")return od;if(Dl.exports.compare(a,"0.2","<"))throw`Unknown version: ${a}`;return Dl.exports.compare(a,"0.2",">=")&&Dl.exports.compare(a,Ri.V0_3,"<")?Ri.V0_2:Dl.exports.compare(a,"0.3",">=")?Ri.V0_3:(console.log(`Could not match version=${a} to any known version, assuming ${od}`),od)},C_=()=>{const a=new URLSearchParams(window.location.search).get(sd.mp_debug);return a==="true"||a==="1"},UF=a=>a.filter(p=>new URLSearchParams(window.location.search).has(p)).length>0,VF=(a=8)=>kF(a),cx="abcdefghijklmnopqrstuvwxyz0123456789",kF=(a=8)=>{for(var u="",p=cx.length,s=0;s<a;s++)u+=cx.charAt(Math.floor(Math.random()*p));return u},R_=(a,u,p)=>{u=u||"000",u&&u.trim()==""&&(u=void 0);let s;if(typeof a=="string"?s=a:typeof a=="number"?s=a+"":s=JSON.stringify(a,null,"  "),u&&u.trim()!=""){var c=`color: #${u}`;p&&(c=`${c}; background: #${p}`),s=`%c${s}`,window.console.log(s,c)}else window.console.log(s)},lx=a=>zF(jF(a)),jF=a=>{var u=0;for(let p=0;p<a.length;p++)u=a.charCodeAt(p)+((u<<5)-u);return u},zF=a=>{var u=(a&16777215).toString(16).toUpperCase();return"00000".substring(0,6-u.length)+u},O_=()=>document.readyState=="complete"||document.readyState=="interactive",M_=()=>NF(void 0,void 0,void 0,function*(){return O_()?Promise.resolve():new Promise(a=>{if(O_()){a();return}let u=!1;window.addEventListener("load",()=>{u||(u=!0,a())}),setTimeout(()=>{!u&&O_()&&(u=!0,a())},200)})});var ux=function(a,u,p,s){function c(E){return E instanceof p?E:new p(function(m){m(E)})}return new(p||(p=Promise))(function(E,m){function S(R){try{C(s.next(R))}catch(I){m(I)}}function h(R){try{C(s.throw(R))}catch(I){m(I)}}function C(R){R.done?E(R.value):c(R.value).then(S,h)}C((s=s.apply(a,u||[])).next())})};class hx extends ad.exports.EventEmitter{constructor(u,p,s,c,E,m=!1){super();if(this.inputs={},this.outputs={},this._disposables=[],this._rpcListeners=[],this._loaded=!1,this._onLoaded=[],this._sendInputsAfterRegistration=!1,this._plugin=!1,this._cachedEventInputsUpdate={iframeId:void 0,inputs:void 0},this._cachedEventOutputsUpdate={iframeId:null,inputs:null},!p.startsWith("http")){for(;p.startsWith("/");)p=p.substr(1);p=window.location.protocol+"//"+window.location.hostname+(window.location.port&&window.location.port!=""?":"+window.location.port:"")+"/"+p}this.url=p,this._metapage=u;var S=new URL(this.url);m&&S.searchParams.set(sd.mp_debug,"true"),this.url=S.href,this.id=s,this._debug=m,this._parentId=c,this._color=lx(this.id),this._consoleBackgroundColor=E,this._iframe=document.createElement("iframe"),this._iframe.name=this.id;const h=this;this.iframe=new Promise(C=>{M_().then(()=>ux(this,void 0,void 0,function*(){if(h._iframe){const R=yield h.getDefinition();if(!h._iframe)return;(R==null?void 0:R.allow)&&(h._iframe.allow=R.allow),h._iframe.src=this.url,C(h._iframe)}}))}),this.ack=this.ack.bind(this),this.dispose=this.dispose.bind(this),this.getDefinition=this.getDefinition.bind(this),this.getDefinitionUrl=this.getDefinitionUrl.bind(this),this.setPlugin=this.setPlugin.bind(this),this.hasPermissionsDefinition=this.hasPermissionsDefinition.bind(this),this.hasPermissionsState=this.hasPermissionsState.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onOutput=this.onOutput.bind(this),this.onOutputs=this.onOutputs.bind(this),this.register=this.register.bind(this),this.registered=this.registered.bind(this),this.sendInputs=this.sendInputs.bind(this),this.sendOrBufferPostMessage=this.sendOrBufferPostMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.sendRpcInternal=this.sendRpcInternal.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setMetapage=this.setMetapage.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.setPlugin=this.setPlugin.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.isDisposed=this.isDisposed.bind(this)}addListenerReturnDisposer(u,p){return super.addListener(u,p),()=>{super.removeListener(u,p)}}setPlugin(){if(this._loaded)throw"Cannot setPlugin after MetapageIFrameRpcClient already loaded";return this._plugin=!0,this}setMetapage(u){return this._metapage=u,this}hasPermissionsState(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[ta]!==void 0}hasPermissionsDefinition(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[Hi]!==void 0}getDefinitionUrl(){var u=new URL(this.url);return u.pathname=u.pathname+(u.pathname.endsWith("/")?"metaframe.json":"/metaframe.json"),u.href}getDefinition(){return ux(this,void 0,void 0,function*(){if(this._definition)return this._definition;var u=this.getDefinitionUrl();try{const p=yield window.fetch(u);if(p.ok){const s=yield p.json();return this._definition=s,this._definition}else this.emit(qt.Error,`Failed to fetch: ${u}
Status: ${p.status}
Status text: ${p.statusText}`)}catch(p){this.emit(qt.Error,`Failed to fetch: ${u}
Error: ${p}`)}})}setInput(u,p){console.assert(!!u);var s={};s[u]=p,this.setInputs(s)}setInputs(u){if(this.log({m:"MetapageIFrameRpcClient",inputs:u}),!cd(this.inputs,u))return this;if(this._loaded||(this._sendInputsAfterRegistration=!0),this._iframe.parentNode&&this._loaded&&this.sendInputs(u),this.emit(qt.Inputs,this.inputs),this._metapage.listenerCount(qt.Inputs)>0){var p={};p[this.id]=u,this._metapage.emit(qt.Inputs,p)}return this}setOutput(u,p){console.assert(!!u);var s={};s[u]=p,this.setOutputs(s)}setOutputs(u){if(!!cd(this.outputs,u)&&(this.emit(qt.Outputs,u),this._metapage.listenerCount(qt.Outputs)>0)){var p={};p[this.id]=this.outputs,this._metapage.emit(qt.Outputs,p)}}onInputs(u){return this.addListenerReturnDisposer(qt.Inputs,u)}onInput(u,p){var s=function(c){c.hasOwnProperty(u)&&p(c[u])};return this.addListenerReturnDisposer(qt.Inputs,s)}onOutputs(u){return this.addListenerReturnDisposer(qt.Outputs,u)}onOutput(u,p){var s=function(c){c.hasOwnProperty(u)&&p(c[u])};return this.addListenerReturnDisposer(qt.Outputs,s)}isDisposed(){return this.inputs===void 0}dispose(){for(super.removeAllListeners();this._disposables&&this._disposables.length>0;){const u=this._disposables.pop();u&&u()}this._rpcListeners=void 0,this.inputs=void 0,this.outputs=void 0,this._iframe&&this._iframe.parentNode&&this._iframe.parentNode.removeChild(this._iframe),this._iframe=void 0,this._bufferMessages=void 0,this._bufferTimeout&&(window.clearInterval(this._bufferTimeout),this._bufferTimeout=void 0),this._metapage=void 0}register(){var u={iframeId:this.id,parentId:this._parentId,plugin:this._plugin,state:{inputs:this.inputs},version:ax};this.sendRpcInternal(mo.SetupIframeServerResponse,u)}registered(u){if(this.log({m:"MetapageIFrameRpcClient.registered",inputs:this.inputs}),!this._loaded){if(!u)throw"Cannot register without a version";for(this.version=u,this._loaded=!0;this._onLoaded&&this._onLoaded.length>0;)this._onLoaded.pop()();this._sendInputsAfterRegistration&&this.sendInputs(this.inputs)}}sendInputs(u){this.sendRpc(mo.InputsUpdate,{inputs:u,parentId:this._parentId})}sendRpc(u,p){if(this._iframe.parentNode&&this._loaded)this.sendRpcInternal(u,p);else{this._metapage.error("sending rpc later");const s=this;this._onLoaded.push(()=>{s.sendRpcInternal(u,p)})}}ack(u){if(this.log("\u2692 \u2692 \u2692 calling ack"),this._debug){this.log("\u2692 \u2692 \u2692 sending ack from client to frame");var p={message:u};this.sendRpc(mo.MessageAck,p)}else this.log("\u2692 \u2692 \u2692 NOT sending ack from client to frame since not debug mode")}log(u){!this._debug||this.logInternal(u)}logInternal(u){let p;typeof u=="string"?p=u:typeof u=="string"?p=u+"":p=JSON.stringify(u),R_(`Metapage[${this._parentId}] Metaframe[${this.id}] ${p}`,this._color,this._consoleBackgroundColor)}sendRpcInternal(u,p){const s={id:"_",iframeId:this.id,jsonrpc:"2.0",method:u,params:p,parentId:this._parentId};this._iframe?this.sendOrBufferPostMessage(s):this._metapage.error(`Cannot send to child iframe messageJSON=${JSON.stringify(s).substr(0,200)}`)}sendOrBufferPostMessage(u){if(this._iframe&&this._iframe.contentWindow)this._iframe.contentWindow.postMessage(u,this.url);else if(this._bufferMessages)this._bufferMessages.push(u);else{this._bufferMessages=[u];const p=this;this._bufferTimeout=window.setInterval(function(){p._iframe&&p._iframe.contentWindow&&(p._bufferMessages.forEach(s=>p._iframe.contentWindow.postMessage(s,p.url)),window.clearInterval(p._bufferTimeout),p._bufferTimeout=void 0,p._bufferMessages=void 0)},0)}}}var GF=function(a,u,p,s){function c(E){return E instanceof p?E:new p(function(m){m(E)})}return new(p||(p=Promise))(function(E,m){function S(R){try{C(s.next(R))}catch(I){m(I)}}function h(R){try{C(s.throw(R))}catch(I){m(I)}}function C(R){R.done?E(R.value):c(R.value).then(S,h)}C((s=s.apply(a,u||[])).next())})},dx;(function(a){a.all="all",a.delta="delta"})(dx||(dx={}));const fx=()=>({metaframes:{inputs:{},outputs:{}},plugins:{inputs:{},outputs:{}}}),HF="bcbcbc";class Oi extends LF{constructor(u){super();this._state=fx(),this._metaframes={},this._plugins={},this._pluginOrder=[],this.debug=C_(),this._internalReceivedMessageCounter=0,this._cachedInputLookupMap={},this._inputMap={},this._id=u&&u.id?u.id:VF(),this._consoleBackgroundColor=u&&u.color?u.color:HF,this.addPipe=this.addPipe.bind(this),this.dispose=this.dispose.bind(this),this.addMetaframe=this.addMetaframe.bind(this),this.addPlugin=this.addPlugin.bind(this),this.getInputsFromOutput=this.getInputsFromOutput.bind(this),this.getMetaframe=this.getMetaframe.bind(this),this.getMetaframeIds=this.getMetaframeIds.bind(this),this.getMetaframeOrPlugin=this.getMetaframeOrPlugin.bind(this),this.getMetaframes=this.getMetaframes.bind(this),this.getPlugin=this.getPlugin.bind(this),this.getPluginIds=this.getPluginIds.bind(this),this.getState=this.getState.bind(this),this.getStateMetaframes=this.getStateMetaframes.bind(this),this.isValidJSONRpcMessage=this.isValidJSONRpcMessage.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.metaframeIds=this.metaframeIds.bind(this),this.metaframes=this.metaframes.bind(this),this.onMessage=this.onMessage.bind(this),this.pluginIds=this.pluginIds.bind(this),this.plugins=this.plugins.bind(this),this.removeAll=this.removeAll.bind(this),this.removeMetaframe=this.removeMetaframe.bind(this),this.removePlugin=this.removePlugin.bind(this),this.setDebugFromUrlParams=this.setDebugFromUrlParams.bind(this),this.setDefinition=this.setDefinition.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInputStateOnly=this.setInputStateOnly.bind(this),this.setMetaframeClientInputAndSentClientEvent=this.setMetaframeClientInputAndSentClientEvent.bind(this),this.setOutputStateOnly=this.setOutputStateOnly.bind(this),this.setState=this.setState.bind(this),this.updatePluginsWithDefinition=this.updatePluginsWithDefinition.bind(this),this._emitDefinitionEvent=this._emitDefinitionEvent.bind(this),M_().then(()=>{window.addEventListener("message",this.onMessage),this.log("Initialized")})}static from(u,p){if(u==null)throw"Metapage definition cannot be null";if(typeof u=="string")try{u=JSON.parse(u)}catch(c){throw"Cannot parse into JSON:\n${metaPageDef}"}var s=new Oi;return s.setDefinition(u)}addListenerReturnDisposer(u,p){return super.addListener(u,p),()=>{super.removeListener(u,p)}}setDebugFromUrlParams(){return this.debug=UF(["MP_DEBUG","DEBUG","debug","mp_debug"]),this}getState(){return this._state}setState(u){this._state=u,this.getMetaframeIds().forEach(p=>{this.getMetaframe(p).setInputs(this._state.metaframes.inputs[p]),this.getMetaframe(p).setOutputs(this._state.metaframes.outputs[p])}),this.getPluginIds().forEach(p=>{this.getPlugin(p).setInputs(this._state.plugins.inputs[p]),this.getPlugin(p).setOutputs(this._state.plugins.outputs[p])}),this.emit(qt.State,this._state)}getStateMetaframes(){return this._state.metaframes}getDefinition(){return this._definition}setDefinition(u,p){const s=sx(u);return s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(s.plugins&&s.plugins.includes(c))throw this.emitErrorMessage(`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`),`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`;var E=s.metaframes[c];if(typeof E!="object")throw this.emitErrorMessage(`Metaframe "${c}" is not an object`),`Metaframe "${c}" is not an object`;if(!E.url)throw this.emitErrorMessage(`Metaframe "${c}" missing field: url`),`Metaframe "${c}" missing field: url`}),this._definition=s,Object.keys(this._metaframes).forEach(c=>{(!s.metaframes||!s.metaframes[c])&&this.removeMetaframe(c)}),Object.keys(this._plugins).forEach(c=>{s.plugins&&!s.plugins.includes(c)&&this.removePlugin(c)}),this._pluginOrder=s.plugins?s.plugins:[],p&&(this._state=p),s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(!this._metaframes.hasOwnProperty(c)){const E=s.metaframes[c];this.addMetaframe(c,E)}}),s.plugins&&s.plugins.forEach(c=>{this._plugins.hasOwnProperty(c)||this.addPlugin(c)}),window.setTimeout(()=>{this._emitDefinitionEvent(),p&&this.emit(qt.State,this._state)},0),this}_emitDefinitionEvent(){const u={definition:this._definition,metaframes:this._metaframes,plugins:this._plugins};this.emit(qt.Definition,u)}addPipe(u,p){this._inputMap[u]||(this._inputMap[u]=[]),this._inputMap[u].push(p)}removeMetaframe(u){!this._metaframes[u]||(this._metaframes[u].dispose(),delete this._metaframes[u],delete this._state.metaframes.inputs[u],delete this._state.metaframes.outputs[u],delete this._inputMap[u],Object.keys(this._inputMap).forEach(p=>{var s;const c=this._inputMap[p];let E=0;for(;E<=c.length;)((s=c[E])===null||s===void 0?void 0:s.metaframe)===u?c.splice(E,1):E++}),this._cachedInputLookupMap={})}removePlugin(u){!this._plugins[u]||(this._plugins[u].dispose(),delete this._plugins[u],delete this._state.plugins.inputs[u],delete this._state.plugins.outputs[u])}removeAll(){Object.keys(this._metaframes).forEach(u=>this._metaframes[u].dispose()),Object.keys(this._plugins).forEach(u=>this._plugins[u].dispose()),this._metaframes={},this._plugins={},this._state=fx(),this._inputMap={},this._cachedInputLookupMap={}}metaframes(){return this.getMetaframes()}metaframeIds(){return this.getMetaframeIds()}getMetaframeIds(){return Object.keys(this._metaframes)}getMetaframes(){return Object.assign({},this._metaframes)}plugins(){return Object.assign({},this._plugins)}pluginIds(){return this.getPluginIds()}getPluginIds(){return this._pluginOrder.slice(0)}getMetaframe(u){return this._metaframes[u]}getPlugin(u){return this._plugins[u]}addMetaframe(u,p){if(!u)throw"addMetaframe missing metaframeId";if(!p)throw"addMetaframe missing definition";if(this._metaframes[u])throw this.emitErrorMessage(`Existing metaframe for id=${u}`),`Existing metaframe for id=${u}`;if(!p.url)throw this.emitErrorMessage(`Metaframe definition missing url id=${u}`),`Metaframe definition missing url id=${u}`;var s=new hx(this,p.url,u,this._id,this._consoleBackgroundColor,this.debug).setMetapage(this);return this._metaframes[u]=s,s.addListener(qt.Error,c=>{this.emit(qt.Error,{metaframeId:s.id,metaframeUrl:s.url,error:c})}),p.inputs&&p.inputs.forEach(c=>this.addPipe(u,c)),s.setInputs(this._state.metaframes.inputs[u]),s}addPlugin(u){if(!u)throw"Plugin missing url";const p=new hx(this,u,u,this._id,this._consoleBackgroundColor,this.debug).setInputs(this._state.plugins.inputs[u]).setMetapage(this).setPlugin();return WF(this,p),this._plugins[u]=p,p}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this._metaframes&&Object.keys(this._metaframes).forEach(u=>this._metaframes[u].dispose()),this._plugins&&Object.keys(this._plugins).forEach(u=>this._plugins[u].dispose()),this._id=void 0,this._metaframes=void 0,this._plugins=void 0,this._state=void 0,this._cachedInputLookupMap=void 0,this._inputMap=void 0}log(u,p,s){!this.debug||this.logInternal(u,p,s)}error(u){this.logInternal(u,"f00",this._consoleBackgroundColor),this.emitErrorMessage(`${u}`)}emitErrorMessage(u){this.emit(qt.Error,u)}getInputsFromOutput(u,p){if(this._cachedInputLookupMap[u]||(this._cachedInputLookupMap[u]={}),!this._cachedInputLookupMap[u][p]){var s=[];this._cachedInputLookupMap[u][p]=s,Object.keys(this._inputMap).forEach(c=>{c!==u&&this._inputMap[c].forEach(E=>{if(E.metaframe==u&&bF(p,E.source)){var m=E.target;(!E.target||E.target.startsWith("*")||E.target==="")&&(m=p),s.push({metaframe:c,pipe:m})}})})}return this._cachedInputLookupMap[u][p]}isValidJSONRpcMessage(u){if(u.jsonrpc!=="2.0")return!1;switch(u.method){case Fr.SetupIframeClientRequest:return!0;default:var s=u.iframeId;return!(s&&!(u.parentId===this._id&&(this._metaframes[s]||this._plugins[s])))}}setInput(u,p,s){this.setInputStateOnly(u,p,s),this.setMetaframeClientInputAndSentClientEvent(u,p,s),this.emit(qt.State,this._state),this.emit(qt.Inputs,this._state)}setMetaframeClientInputAndSentClientEvent(u,p,s){if(typeof u=="object"){if(p||s)throw"bad arguments, see API docs";const c=u;Object.keys(c).forEach(E=>{var m=E,S=c[m];if(typeof S!="object")throw"bad arguments, see API docs";var h=this._metaframes[m];h?h.setInputs(S):this.error("No iframe id=$metaframeId")})}else if(typeof u=="string"){const c=this._metaframes[u];if(c==null&&this.error(`No iframe id=${u}`),typeof p=="string")c.setInput(p,s);else if(typeof p=="object")c.setInputs(p);else throw"bad arguments, see API docs"}else throw"bad arguments, see API docs"}setInputs(u,p,s){this.setInput(u,p,s)}setOutputStateOnly(u,p,s){this._setStateOnly(!1,u,p,s)}setInputStateOnly(u,p,s){this._setStateOnly(!0,u,p,s)}_setStateOnly(u,p,s,c){if(typeof p=="object"){if(s||c)throw"If first argument is an object, subsequent args should be undefined";const E=p;Object.keys(E).forEach(m=>{var S=E[m];if(typeof S!="object")throw"Object values must be objects";const h=this._metaframes.hasOwnProperty(m);if(!h&&!this._plugins.hasOwnProperty(m))throw"No metaframe or plugin: ${metaframeId}";const C=h?u?this._state.metaframes.inputs:this._state.metaframes.outputs:u?this._state.plugins.inputs:this._state.plugins.outputs;C[m]=C[m]?C[m]:{},Object.keys(S).forEach(R=>{S[R]===void 0?delete C[m][R]:C[m][R]=S[R]})})}else if(typeof p=="string"){const E=p,m=this._metaframes.hasOwnProperty(E);if(!m&&!this._plugins.hasOwnProperty(E))throw`No metaframe or plugin: ${E}`;const S=m?u?this._state.metaframes.inputs:this._state.metaframes.outputs:u?this._state.plugins.inputs:this._state.plugins.outputs;if(typeof s=="string"){S[E]=S[E]?S[E]:{};const h=s;c===void 0?delete S[E][h]:S[E][h]=c}else if(typeof s=="object"){S[E]=S[E]?S[E]:{};const h=s;Object.keys(h).forEach(C=>{h[C]===void 0?delete S[E][C]:S[E][C]=h[C]})}else throw"Second argument must be a string or an object"}else throw"First argument must be a string or an object"}getMetaframeOrPlugin(u){var p=this._metaframes[u];return p||(p=this._plugins[u]),p}onMessage(u){if(typeof u.data=="object"){const m=u.data;if(!this.isValidJSONRpcMessage(m))return;var p=m.method;const S=m.iframeId;if(!S)return;const h=this.getMetaframeOrPlugin(S),C=this._plugins[S];switch(m._messageCount=++this._internalReceivedMessageCounter,this.debug&&this.log(`processing ${JSON.stringify(m,null,"  ").substr(0,500)}`),p){case Fr.SetupIframeClientRequest:h&&h.register();break;case Fr.SetupIframeServerResponseAck:if(h){const I=m.params;h.registered(I.version)}break;case Fr.OutputsUpdate:const R=m.params;if(this._metaframes[S]){var s=this._metaframes[S];this.setOutputStateOnly(S,R),s.setOutputs(R),this.emit(qt.State,this._state);var c=!1;const I=Object.keys(R),b={};I.forEach((f,x)=>{const P=this.getInputsFromOutput(S,f);P.length>0&&P.forEach(A=>{b[A.metaframe]||(b[A.metaframe]={}),b[A.metaframe][A.pipe]=R[f],this.setInputStateOnly(A.metaframe,A.pipe,R[f]),c=!0})}),Object.keys(b).forEach(f=>{this._metaframes[f].setInputs(b[f])}),c&&this.emit(qt.State,this._state),this.debug&&s.ack({jsonrpc:m,state:this._state})}else if(this._plugins[S]){const I=!R[ta]&&!R[Hi];I&&this.setOutputStateOnly(S,R),this._plugins[S].setOutputs(R),I&&this.emit(qt.State,this._state),this.debug&&this._plugins[S].ack({jsonrpc:m,state:this._state})}else this.error("missing metaframe/plugin=$metaframeId");break;case Fr.InputsUpdate:var E=m.params;if(this.debug&&this.log(`inputs ${JSON.stringify(E)} from ${S}`),this._metaframes[S])this.setInputStateOnly(S,E),this._metaframes[S].setInputs(E),this.emit(qt.State,this._state),this.debug&&this._metaframes[S].ack({jsonrpc:m,state:this._state});else if(this._plugins[S]){const I=!E[ta]&&!E[Hi];I&&this.setInputStateOnly(S,E),this._plugins[S].setInputs(E),I&&this.emit(qt.State,this._state),this.debug&&this._plugins[S].ack({jsonrpc:m,state:this._state})}else console.error(`InputsUpdate failed no metaframe or plugin id: "${S}"`),this.error(`InputsUpdate failed no metaframe or plugin id: "${S}"`);break;case Fr.PluginRequest:C&&h&&h.hasPermissionsState()&&(h.setInput(ta,this._state),this.debug&&h.ack({jsonrpc:m,state:this._state}));break;case Fr.HashParamsUpdate:if(!C&&h){const I=m.params,b=new URL(h.url);b.hash=I.hash,h.url=b.href,this._definition.metaframes[I.metaframe].url=b.href,this.emit(qt.UrlHashUpdate,m.params),this._emitDefinitionEvent()}break;default:this.debug&&this.log(`Unknown RPC method: "${p}"`)}this.emit(qt.Message,m)}}updatePluginsWithDefinition(){this.getDefinition(),Object.values(this._plugins).forEach(u=>{u.hasPermissionsDefinition()&&XF(u)})}logInternal(u,p,s){s=s||this._consoleBackgroundColor;let c;typeof u=="string"?c=u:typeof u=="number"?c=u+"":c=JSON.stringify(u),c=this._id?`Metapage[${this._id}] ${c}`:c,R_(c,p,s)}}Oi.version=ax,Oi.DEFINITION=qt.Definition,Oi.DEFINITION_UPDATE_REQUEST=qt.DefinitionUpdateRequest,Oi.ERROR=qt.Error,Oi.INPUTS=qt.Inputs,Oi.MESSAGE=qt.Message,Oi.OUTPUTS=qt.Outputs,Oi.STATE=qt.State,Oi.URL_HASH_UPDATE=qt.UrlHashUpdate;const WF=(a,u)=>GF(void 0,void 0,void 0,function*(){try{const c=yield u.getDefinition();if(!c)throw`${u.url}`;if(u.isDisposed())return;if(u.hasPermissionsDefinition()){var p=a.addListenerReturnDisposer(qt.Definition,E=>{u.setInput(Hi,E.definition)});u._disposables.push(p);var s=a.getDefinition();if(s&&(u.setInput(Hi,s),c.outputs)){var p=u.onOutput(Hi,m=>{a.emit(qt.DefinitionUpdateRequest,m)});u._disposables.push(p)}}if(u.hasPermissionsState()&&c.outputs){var p=u.onOutput(ta,m=>{a.setState(m)});u._disposables.push(p)}}catch(c){console.error(c),a.emit(qt.Error,`Failed to get plugin definition from "${u.getDefinitionUrl()}", error=${c}`)}}),XF=a=>{const u=a._metapage.getDefinition();a.setInput(Hi,u)};var YF=function(a,u,p,s){function c(E){return E instanceof p?E:new p(function(m){m(E)})}return new(p||(p=Promise))(function(E,m){function S(R){try{C(s.next(R))}catch(I){m(I)}}function h(R){try{C(s.throw(R))}catch(I){m(I)}}function C(R){R.done?E(R.value):c(R.value).then(S,h)}C((s=s.apply(a,u||[])).next())})},na;(function(a){a.WaitingForPageLoad="WaitingForPageLoad",a.SentSetupIframeClientRequest="SentSetupIframeClientRequest",a.Ready="Ready"})(na||(na={}));var mr;(function(a){a.Connected="connected",a.Error="error",a.Input="input",a.Inputs="inputs",a.Message="message"})(mr||(mr={}));class mi extends ad.exports.EventEmitter{constructor(u){super();if(this._inputPipeValues={},this._outputPipeValues={},this._state=na.WaitingForPageLoad,this._messageSendCount=0,this.debug=C_(),this.id=window.name,this.debug=C_(),this._isIframe=wF(),this.addListener=this.addListener.bind(this),this.dispose=this.dispose.bind(this),this.error=this.error.bind(this),this.getInput=this.getInput.bind(this),this.getInputs=this.getInputs.bind(this),this.getOutput=this.getOutput.bind(this),this.getOutputs=this.getOutputs.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onMessage=this.onMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInternalInputsAndNotify=this.setInternalInputsAndNotify.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.warn=this.warn.bind(this),this._resolveSetupIframeServerResponse=this._resolveSetupIframeServerResponse.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.connected=this.connected.bind(this),this.disableNotifyOnHashUrlChange=this.disableNotifyOnHashUrlChange.bind(this),this._onHashUrlChange=this._onHashUrlChange.bind(this),!this._isIframe){this.log("Not an iframe, metaframe code disabled");return}const p=this;M_().then(()=>{this.log("pageLoaded"),window.addEventListener("message",this.onMessage),p.sendRpc(Fr.SetupIframeClientRequest,{version:mi.version}),p._state=na.SentSetupIframeClientRequest}),(u==null?void 0:u.disableHashChangeEvent)||window.addEventListener("hashchange",this._onHashUrlChange)}_resolveSetupIframeServerResponse(u){if(this._state===na.WaitingForPageLoad)throw"Got message but page has not finished loading, we should never get in this state";this._parentId?this.log("Got JsonRpcMethods.SetupIframeServerResponse but already resolved"):(this._parentVersion=u.version,this.color=lx(this.id),this._parentId=u.parentId,this.log(`metapage[${this._parentId}](v${this._parentVersion?this._parentVersion:"unknown"}) registered`),this._inputPipeValues=u.state&&u.state.inputs?u.state.inputs:this._inputPipeValues,this._state=na.Ready,this.sendRpc(Fr.SetupIframeServerResponseAck,{version:mi.version}),this._inputPipeValues&&Object.keys(this._inputPipeValues).length>0&&(this.emit(mr.Inputs,this._inputPipeValues),Object.keys(this._inputPipeValues).forEach(p=>this.emit(mr.Input,p,this._inputPipeValues[p]))),this.emit(mr.Inputs,this._inputPipeValues),u.plugin&&(this.plugin=new KF(this)),this.emit(mr.Connected))}connected(){return YF(this,void 0,void 0,function*(){if(this._state!==na.Ready)return new Promise((u,p)=>{let s;s=this.addListenerReturnDisposer(mr.Connected,()=>{u(),s()})})})}addListenerReturnDisposer(u,p){return super.addListener(u,p),()=>{super.removeListener(u,p)}}log(u,p,s){!this.debug||this.logInternal(u,p||this.color)}warn(u){!this.debug||this.logInternal(u,"000",this.color)}error(u){this.logInternal(u,this.color,"f00")}logInternal(u,p,s){let c;typeof u=="string"?c=u:typeof u=="number"?c=u+"":c=JSON.stringify(u),p=p&&p+"",c=(this.id?`Metaframe[${this.id}] `:"")+`${c}`,R_(c,p,s)}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this.disableNotifyOnHashUrlChange(),this._inputPipeValues=void 0,this._outputPipeValues=void 0}addListener(u,p){return super.addListener(u,p),u===mr.Inputs&&window.setTimeout(()=>{this._inputPipeValues&&p(this._inputPipeValues)},0),this}onInput(u,p){return this.addListenerReturnDisposer(mr.Input,(s,c)=>{u===s&&p(c)})}onInputs(u){return this.addListenerReturnDisposer(mr.Inputs,u)}setInput(u,p){var s={};s[u]=p,this.setInputs(s)}setInputs(u){this.sendRpc(Fr.InputsUpdate,u)}setInternalInputsAndNotify(u){!cd(this._inputPipeValues,u)||(Object.keys(u).forEach(p=>this.emit(mr.Input,p,u[p])),this.emit(mr.Inputs,u))}getInput(u){return console.assert(!!u),this._inputPipeValues[u]}getInputs(){return this._inputPipeValues}getOutput(u){return console.assert(!!u),this._outputPipeValues[u]}setOutput(u,p){console.assert(!!u);var s={};s[u]=p,this.setOutputs(s)}setOutputs(u){!cd(this._outputPipeValues,u)||this.sendRpc(Fr.OutputsUpdate,u)}getOutputs(){return this._outputPipeValues}disableNotifyOnHashUrlChange(){window.removeEventListener("hashchange",this._onHashUrlChange)}_onHashUrlChange(u){const p={hash:window.location.hash,metaframe:this.id};this.sendRpc(Fr.HashParamsUpdate,p)}sendRpc(u,p){if(this._isIframe){const s={jsonrpc:"2.0",id:++this._messageSendCount,method:u,params:p,iframeId:this.id,parentId:this._parentId};window.parent.postMessage(s,"*")}else this.log("Cannot send JSON-RPC window message: there is no window.parent which means we are not an iframe")}onMessage(u){if(typeof u.data=="object"){let s=u.data;if(s.jsonrpc==="2.0"){var p=s.method;if(!(p==mo.SetupIframeServerResponse||s.parentId==this._parentId&&s.iframeId==this.id)){this.error(`window.message: received message but jsonrpc.parentId=${s.parentId} _parentId=${this._parentId} jsonrpc.iframeId=${s.iframeId} id=${this.id}`);return}switch(p){case mo.SetupIframeServerResponse:this._resolveSetupIframeServerResponse(s.params);break;case mo.InputsUpdate:if(this._state!==na.Ready)throw"Got InputsUpdate but metaframe is not MetaframeLoadingState.Ready";this.setInternalInputsAndNotify(s.params.inputs);break;case mo.MessageAck:this.debug&&this.log(`ACK: ${JSON.stringify(s)}`);break;default:this.debug&&this.log(`window.message: unknown JSON-RPC method: ${JSON.stringify(s)}`);break}this.emit(mr.Message,s)}}}}mi.version=DF,mi.ERROR=mr.Error,mi.CONNECTED=mr.Connected,mi.INPUT=mr.Input,mi.INPUTS=mr.Inputs,mi.MESSAGE=mr.Message;class KF{constructor(u){this._metaframe=u,this.requestState=this.requestState.bind(this),this.onState=this.onState.bind(this),this.getState=this.getState.bind(this),this.setState=this.setState.bind(this),this.onDefinition=this.onDefinition.bind(this),this.getDefinition=this.getDefinition.bind(this),this.setDefinition=this.setDefinition.bind(this)}requestState(){var u={method:P_.State};this._metaframe.sendRpc(Fr.PluginRequest,u)}onState(u){const p=this._metaframe.onInput(ta,u);return this.getState()&&u(this.getState()),p}getState(){return this._metaframe.getInput(ta)}setState(u){this._metaframe.setOutput(ta,u)}onDefinition(u){var p=this._metaframe.onInput(Hi,u);return this.getDefinition()&&u(this.getDefinition()),p}setDefinition(u){this._metaframe.setOutput(Hi,u)}getDefinition(){return this._metaframe.getInput(Hi)}}var QF=function(a,u){u||(u={}),typeof u=="function"&&(u={cmp:u});var p=typeof u.cycles=="boolean"?u.cycles:!1,s=u.cmp&&function(E){return function(m){return function(S,h){var C={key:S,value:m[S]},R={key:h,value:m[h]};return E(C,R)}}}(u.cmp),c=[];return function E(m){if(m&&m.toJSON&&typeof m.toJSON=="function"&&(m=m.toJSON()),m!==void 0){if(typeof m=="number")return isFinite(m)?""+m:"null";if(typeof m!="object")return JSON.stringify(m);var S,h;if(Array.isArray(m)){for(h="[",S=0;S<m.length;S++)S&&(h+=","),h+=E(m[S])||"null";return h+"]"}if(m===null)return"null";if(c.indexOf(m)!==-1){if(p)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var C=c.push(m)-1,R=Object.keys(m).sort(s&&s(m));for(h="",S=0;S<R.length;S++){var I=R[S],b=E(m[I]);!b||(h&&(h+=","),h+=JSON.stringify(I)+":"+b)}return c.splice(C,1),"{"+h+"}"}}(a)};const qF=()=>{try{return window!==window.top}catch(a){return!1}},I_=a=>btoa(QF(a)),D_=a=>{if(a&&a.length>0)return JSON.parse(atob(a))},ld=()=>w_(window.location.href),w_=a=>{let u=new URL(a).hash.substr(1);const p=u.indexOf("?");if(p===-1)return[u,{}];const s=u.substr(0,p);u=u.substr(p+1);const c=Object.fromEntries(u.split("&").filter(E=>E.length>0).map(E=>E.split("=")));return Object.keys(c).forEach(E=>c[E]=decodeURI(c[E])),[s,c]},px=(a,u)=>{const[p,s]=w_(a);return s[u]},ZF=(a,u)=>{const p=px(a,u);if(p&&p!=="")return JSON.parse(atob(p))},mx=(a,u,p)=>{const s=ld()[1];let c=!1;if(s.hasOwnProperty(a)&&u===null||u===void 0?(delete s[a],c=!0):s[a]!==u&&(s[a]=u,c=!0),!c)return[];const E=Object.keys(s);E.sort();const m=E.map((I,b)=>`${I}=${encodeURI(s[I])}`).join("&");let S=window.location.hash.substr(1);const h=S.indexOf("?");let C="";h>-1&&(C=S.substr(0,h));const R=new URL(window.location.href);R.hash=`${C}?${m}`,(p==null?void 0:p.modifyHistory)?window.location.hash=`${C}?${m}`:(window.history.replaceState(null,document.title,`${R.pathname}${R.search}${R.hash}`),window.dispatchEvent(new HashChangeEvent("hashchange")))},Ba=(a,u)=>{const[p,s]=ln(ld()[1][a]||u);Vt(()=>{const E=m=>{const S=ld()[1];s(S[a])};return window.addEventListener("hashchange",E),()=>window.removeEventListener("hashchange",E)},[]);const c=Gt((E,m)=>{mx(a,E,m)},[]);return[p,c]},_x=(a,u)=>{const[p,s]=Ba(a,u?L_(u):void 0),[c,E]=ln(u);Vt(()=>{E(gx(p))},[a,p,E]);const m=Gt((S,h)=>{if(S==null)s(void 0,h);else{const C=L_(S);s(C,h)}},[s]);return[c,m]},L_=a=>btoa(a),gx=a=>{if(a&&a.length>0)return atob(a)},$F=(a,u)=>{const[p,s]=Ba(a,u?`${u}`:void 0),[c,E]=ln(p==="true");Vt(()=>{E(p==="true")},[a,p,E]);const m=Gt((S,h)=>{S==null||S===!1?s(void 0,h):s("true",h)},[s]);return[c,m]},JF=(a,u)=>{const[p,s]=Ba(a,u?u.toString():void 0),[c,E]=ln(p?parseFloat(p):void 0);Vt(()=>{E(p?parseFloat(p):void 0)},[a,p,E]);const m=Gt((S,h)=>{s(S?S.toString():void 0,h)},[s]);return[c,m]},eB=(a,u)=>{const[p,s]=Ba(a,u?u.toString():void 0),[c,E]=ln(p?parseInt(p):void 0);Vt(()=>{E(p?parseInt(p):void 0)},[a,p,E]);const m=Gt((S,h)=>{s(S?S.toString():void 0,h)},[s]);return[c,m]},vx=(a,u)=>{const[p,s]=Ba(a,u?I_(u):void 0),[c,E]=ln(D_(p));Vt(()=>{E(D_(p))},[a,p,E]);const m=Gt((S,h)=>{if(S==null)s(void 0,h);else{const C=I_(S);s(C,h)}},[s]);return[c,m]},tB={inputs:{}},nB={},N_=Er(nB),F_=Er(tB),bx=()=>cn(N_),rB=()=>cn(F_),iB=a=>{const[u,p]=ln({inputs:{}}),[s,c]=ln(void 0),[E,m]=ln(u.inputs);return Vt(()=>{const S=new mi,h=C=>{m(C)};return S.onInputs(h),c(S),()=>{S.removeListener(mi.INPUTS,h),S.dispose()}},[c,m]),Vt(()=>{E&&s&&p({metaframe:s,inputs:E,setOutputs:s.setOutputs})},[E,s]),Jr.createElement(F_.Provider,{value:u},a.children)},yx=a=>{const[u,p]=ln({}),[s,c]=ln(void 0);return Vt(()=>{const E=new mi;return c(E),()=>{E.dispose()}},[c]),Vt(()=>{s&&p({metaframe:s})},[s]),Jr.createElement(N_.Provider,{value:u},a.children)};var oB=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",MetaframeAndInputsContext:F_,MetaframeContext:N_,WithMetaframe:yx,WithMetaframeAndInputs:iB,blobFromBase64String:D_,blobToBase64String:I_,getHashParamObject:ZF,getHashParamValue:px,getHashParams:ld,getUrlHashParams:w_,isIframe:qF,setHashParam:mx,stringFromBase64String:gx,stringToBase64String:L_,useHashParam:Ba,useHashParamBase64:_x,useHashParamBoolean:$F,useHashParamFloat:JF,useHashParamInt:eB,useHashParamJson:vx,useMetaframe:bx,useMetaframeAndInput:rB});function aB(a){if(a.sheet)return a.sheet;for(var u=0;u<document.styleSheets.length;u++)if(document.styleSheets[u].ownerNode===a)return document.styleSheets[u]}function sB(a){var u=document.createElement("style");return u.setAttribute("data-emotion",a.key),a.nonce!==void 0&&u.setAttribute("nonce",a.nonce),u.appendChild(document.createTextNode("")),u.setAttribute("data-s",""),u}var Tx=function(){function a(p){var s=this;this._insertTag=function(c){var E;s.tags.length===0?E=s.prepend?s.container.firstChild:s.before:E=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,E),s.tags.push(c)},this.isSpeedy=p.speedy===void 0?!0:p.speedy,this.tags=[],this.ctr=0,this.nonce=p.nonce,this.key=p.key,this.container=p.container,this.prepend=p.prepend,this.before=null}var u=a.prototype;return u.hydrate=function(s){s.forEach(this._insertTag)},u.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(sB(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var E=aB(c);try{E.insertRule(s,E.cssRules.length)}catch(m){}}else c.appendChild(document.createTextNode(s));this.ctr++},u.flush=function(){this.tags.forEach(function(s){return s.parentNode.removeChild(s)}),this.tags=[],this.ctr=0},a}(),Pr="-ms-",ud="-moz-",mn="-webkit-",Ex="comm",B_="rule",U_="decl",cB="@import",lB="@keyframes",uB=Math.abs,hd=String.fromCharCode;function hB(a,u){return(((u<<2^Wr(a,0))<<2^Wr(a,1))<<2^Wr(a,2))<<2^Wr(a,3)}function Sx(a){return a.trim()}function dB(a,u){return(a=u.exec(a))?a[0]:a}function An(a,u,p){return a.replace(u,p)}function xx(a,u){return a.indexOf(u)}function Wr(a,u){return a.charCodeAt(u)|0}function wl(a,u,p){return a.slice(u,p)}function Wi(a){return a.length}function V_(a){return a.length}function dd(a,u){return u.push(a),a}function fB(a,u){return a.map(u).join("")}var fd=1,Ks=1,Ax=0,ei=0,rr=0,Qs="";function pd(a,u,p,s,c,E,m){return{value:a,root:u,parent:p,type:s,props:c,children:E,line:fd,column:Ks,length:m,return:""}}function Ll(a,u,p){return pd(a,u.root,u.parent,p,u.props,u.children,0)}function pB(){return rr}function mB(){return rr=ei>0?Wr(Qs,--ei):0,Ks--,rr===10&&(Ks=1,fd--),rr}function _i(){return rr=ei<Ax?Wr(Qs,ei++):0,Ks++,rr===10&&(Ks=1,fd++),rr}function _o(){return Wr(Qs,ei)}function md(){return ei}function _d(a,u){return wl(Qs,a,u)}function gd(a){switch(a){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Px(a){return fd=Ks=1,Ax=Wi(Qs=a),ei=0,[]}function Cx(a){return Qs="",a}function k_(a){return Sx(_d(ei-1,j_(a===91?a+2:a===40?a+1:a)))}function _B(a){for(;(rr=_o())&&rr<33;)_i();return gd(a)>2||gd(rr)>3?"":" "}function gB(a,u){for(;--u&&_i()&&!(rr<48||rr>102||rr>57&&rr<65||rr>70&&rr<97););return _d(a,md()+(u<6&&_o()==32&&_i()==32))}function j_(a){for(;_i();)switch(rr){case a:return ei;case 34:case 39:return j_(a===34||a===39?a:rr);case 40:a===41&&j_(a);break;case 92:_i();break}return ei}function vB(a,u){for(;_i()&&a+rr!==47+10;)if(a+rr===42+42&&_o()===47)break;return"/*"+_d(u,ei-1)+"*"+hd(a===47?a:_i())}function Rx(a){for(;!gd(_o());)_i();return _d(a,ei)}function bB(a){return Cx(vd("",null,null,null,[""],a=Px(a),0,[0],a))}function vd(a,u,p,s,c,E,m,S,h){for(var C=0,R=0,I=m,b=0,f=0,x=0,P=1,A=1,T=1,_=0,g="",M=c,O=E,N=s,V=g;A;)switch(x=_,_=_i()){case 34:case 39:case 91:case 40:V+=k_(_);break;case 9:case 10:case 13:case 32:V+=_B(x);break;case 92:V+=gB(md()-1,7);continue;case 47:switch(_o()){case 42:case 47:dd(yB(vB(_i(),md()),u,p),h);break;default:V+="/"}break;case 123*P:S[C++]=Wi(V)*T;case 125*P:case 59:case 0:switch(_){case 0:case 125:A=0;case 59+R:f>0&&Wi(V)-I&&dd(f>32?Mx(V+";",s,p,I-1):Mx(An(V," ","")+";",s,p,I-2),h);break;case 59:V+=";";default:if(dd(N=Ox(V,u,p,C,R,c,S,g,M=[],O=[],I),E),_===123)if(R===0)vd(V,u,N,N,M,E,I,S,O);else switch(b){case 100:case 109:case 115:vd(a,N,N,s&&dd(Ox(a,N,N,0,0,c,S,g,c,M=[],I),O),c,O,I,S,s?M:O);break;default:vd(V,N,N,N,[""],O,I,S,O)}}C=R=f=0,P=T=1,g=V="",I=m;break;case 58:I=1+Wi(V),f=x;default:if(P<1){if(_==123)--P;else if(_==125&&P++==0&&mB()==125)continue}switch(V+=hd(_),_*P){case 38:T=R>0?1:(V+="\f",-1);break;case 44:S[C++]=(Wi(V)-1)*T,T=1;break;case 64:_o()===45&&(V+=k_(_i())),b=_o(),R=Wi(g=V+=Rx(md())),_++;break;case 45:x===45&&Wi(V)==2&&(P=0)}}return E}function Ox(a,u,p,s,c,E,m,S,h,C,R){for(var I=c-1,b=c===0?E:[""],f=V_(b),x=0,P=0,A=0;x<s;++x)for(var T=0,_=wl(a,I+1,I=uB(P=m[x])),g=a;T<f;++T)(g=Sx(P>0?b[T]+" "+_:An(_,/&\f/g,b[T])))&&(h[A++]=g);return pd(a,u,p,c===0?B_:S,h,C,R)}function yB(a,u,p){return pd(a,u,p,Ex,hd(pB()),wl(a,2,-2),0)}function Mx(a,u,p,s){return pd(a,u,p,U_,wl(a,0,s),wl(a,s+1,-1),s)}function Ix(a,u){switch(hB(a,u)){case 5103:return mn+"print-"+a+a;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return mn+a+a;case 5349:case 4246:case 4810:case 6968:case 2756:return mn+a+ud+a+Pr+a+a;case 6828:case 4268:return mn+a+Pr+a+a;case 6165:return mn+a+Pr+"flex-"+a+a;case 5187:return mn+a+An(a,/(\w+).+(:[^]+)/,mn+"box-$1$2"+Pr+"flex-$1$2")+a;case 5443:return mn+a+Pr+"flex-item-"+An(a,/flex-|-self/,"")+a;case 4675:return mn+a+Pr+"flex-line-pack"+An(a,/align-content|flex-|-self/,"")+a;case 5548:return mn+a+Pr+An(a,"shrink","negative")+a;case 5292:return mn+a+Pr+An(a,"basis","preferred-size")+a;case 6060:return mn+"box-"+An(a,"-grow","")+mn+a+Pr+An(a,"grow","positive")+a;case 4554:return mn+An(a,/([^-])(transform)/g,"$1"+mn+"$2")+a;case 6187:return An(An(An(a,/(zoom-|grab)/,mn+"$1"),/(image-set)/,mn+"$1"),a,"")+a;case 5495:case 3959:return An(a,/(image-set\([^]*)/,mn+"$1$`$1");case 4968:return An(An(a,/(.+:)(flex-)?(.*)/,mn+"box-pack:$3"+Pr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+mn+a+a;case 4095:case 3583:case 4068:case 2532:return An(a,/(.+)-inline(.+)/,mn+"$1$2")+a;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Wi(a)-1-u>6)switch(Wr(a,u+1)){case 109:if(Wr(a,u+4)!==45)break;case 102:return An(a,/(.+:)(.+)-([^]+)/,"$1"+mn+"$2-$3$1"+ud+(Wr(a,u+3)==108?"$3":"$2-$3"))+a;case 115:return~xx(a,"stretch")?Ix(An(a,"stretch","fill-available"),u)+a:a}break;case 4949:if(Wr(a,u+1)!==115)break;case 6444:switch(Wr(a,Wi(a)-3-(~xx(a,"!important")&&10))){case 107:return An(a,":",":"+mn)+a;case 101:return An(a,/(.+:)([^;!]+)(;|!.+)?/,"$1"+mn+(Wr(a,14)===45?"inline-":"")+"box$3$1"+mn+"$2$3$1"+Pr+"$2box$3")+a}break;case 5936:switch(Wr(a,u+11)){case 114:return mn+a+Pr+An(a,/[svh]\w+-[tblr]{2}/,"tb")+a;case 108:return mn+a+Pr+An(a,/[svh]\w+-[tblr]{2}/,"tb-rl")+a;case 45:return mn+a+Pr+An(a,/[svh]\w+-[tblr]{2}/,"lr")+a}return mn+a+Pr+a+a}return a}function Nl(a,u){for(var p="",s=V_(a),c=0;c<s;c++)p+=u(a[c],c,a,u)||"";return p}function TB(a,u,p,s){switch(a.type){case cB:case U_:return a.return=a.return||a.value;case Ex:return"";case B_:a.value=a.props.join(",")}return Wi(p=Nl(a.children,s))?a.return=a.value+"{"+p+"}":""}function EB(a){var u=V_(a);return function(p,s,c,E){for(var m="",S=0;S<u;S++)m+=a[S](p,s,c,E)||"";return m}}function SB(a){return function(u){u.root||(u=u.return)&&a(u)}}function xB(a,u,p,s){if(!a.return)switch(a.type){case U_:a.return=Ix(a.value,a.length);break;case lB:return Nl([Ll(An(a.value,"@","@"+mn),a,"")],s);case B_:if(a.length)return fB(a.props,function(c){switch(dB(c,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Nl([Ll(An(c,/:(read-\w+)/,":"+ud+"$1"),a,"")],s);case"::placeholder":return Nl([Ll(An(c,/:(plac\w+)/,":"+mn+"input-$1"),a,""),Ll(An(c,/:(plac\w+)/,":"+ud+"$1"),a,""),Ll(An(c,/:(plac\w+)/,Pr+"input-$1"),a,"")],s)}return""})}}var Dx=function(u){var p=new WeakMap;return function(s){if(p.has(s))return p.get(s);var c=u(s);return p.set(s,c),c}};function wx(a){var u=Object.create(null);return function(p){return u[p]===void 0&&(u[p]=a(p)),u[p]}}var AB=function(u,p){var s=-1,c=44;do switch(gd(c)){case 0:c===38&&_o()===12&&(p[s]=1),u[s]+=Rx(ei-1);break;case 2:u[s]+=k_(c);break;case 4:if(c===44){u[++s]=_o()===58?"&\f":"",p[s]=u[s].length;break}default:u[s]+=hd(c)}while(c=_i());return u},PB=function(u,p){return Cx(AB(Px(u),p))},Lx=new WeakMap,CB=function(u){if(!(u.type!=="rule"||!u.parent||!u.length)){for(var p=u.value,s=u.parent,c=u.column===s.column&&u.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(u.props.length===1&&p.charCodeAt(0)!==58&&!Lx.get(s))&&!c){Lx.set(u,!0);for(var E=[],m=PB(p,E),S=s.props,h=0,C=0;h<m.length;h++)for(var R=0;R<S.length;R++,C++)u.props[C]=E[h]?m[h].replace(/&\f/g,S[R]):S[R]+" "+m[h]}}},RB=function(u){if(u.type==="decl"){var p=u.value;p.charCodeAt(0)===108&&p.charCodeAt(2)===98&&(u.return="",u.value="")}},OB=[xB],MB=function(u){var p=u.key;if(p==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(P){var A=P.getAttribute("data-emotion");A.indexOf(" ")!==-1&&(document.head.appendChild(P),P.setAttribute("data-s",""))})}var c=u.stylisPlugins||OB,E={},m,S=[];m=u.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+p+' "]'),function(P){for(var A=P.getAttribute("data-emotion").split(" "),T=1;T<A.length;T++)E[A[T]]=!0;S.push(P)});var h,C=[CB,RB];{var R,I=[TB,SB(function(P){R.insert(P)})],b=EB(C.concat(c,I)),f=function(A){return Nl(bB(A),b)};h=function(A,T,_,g){R=_,f(A?A+"{"+T.styles+"}":T.styles),g&&(x.inserted[T.name]=!0)}}var x={key:p,sheet:new Tx({key:p,container:m,nonce:u.nonce,speedy:u.speedy,prepend:u.prepend}),nonce:u.nonce,inserted:E,registered:{},insert:h};return x.sheet.hydrate(S),x};function ra(){return ra=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},ra.apply(this,arguments)}var Nx={exports:{}},Pn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _r=typeof Symbol=="function"&&Symbol.for,z_=_r?Symbol.for("react.element"):60103,G_=_r?Symbol.for("react.portal"):60106,bd=_r?Symbol.for("react.fragment"):60107,yd=_r?Symbol.for("react.strict_mode"):60108,Td=_r?Symbol.for("react.profiler"):60114,Ed=_r?Symbol.for("react.provider"):60109,Sd=_r?Symbol.for("react.context"):60110,H_=_r?Symbol.for("react.async_mode"):60111,xd=_r?Symbol.for("react.concurrent_mode"):60111,Ad=_r?Symbol.for("react.forward_ref"):60112,Pd=_r?Symbol.for("react.suspense"):60113,IB=_r?Symbol.for("react.suspense_list"):60120,Cd=_r?Symbol.for("react.memo"):60115,Rd=_r?Symbol.for("react.lazy"):60116,DB=_r?Symbol.for("react.block"):60121,wB=_r?Symbol.for("react.fundamental"):60117,LB=_r?Symbol.for("react.responder"):60118,NB=_r?Symbol.for("react.scope"):60119;function ti(a){if(typeof a=="object"&&a!==null){var u=a.$$typeof;switch(u){case z_:switch(a=a.type,a){case H_:case xd:case bd:case Td:case yd:case Pd:return a;default:switch(a=a&&a.$$typeof,a){case Sd:case Ad:case Rd:case Cd:case Ed:return a;default:return u}}case G_:return u}}}function Fx(a){return ti(a)===xd}Pn.AsyncMode=H_,Pn.ConcurrentMode=xd,Pn.ContextConsumer=Sd,Pn.ContextProvider=Ed,Pn.Element=z_,Pn.ForwardRef=Ad,Pn.Fragment=bd,Pn.Lazy=Rd,Pn.Memo=Cd,Pn.Portal=G_,Pn.Profiler=Td,Pn.StrictMode=yd,Pn.Suspense=Pd,Pn.isAsyncMode=function(a){return Fx(a)||ti(a)===H_},Pn.isConcurrentMode=Fx,Pn.isContextConsumer=function(a){return ti(a)===Sd},Pn.isContextProvider=function(a){return ti(a)===Ed},Pn.isElement=function(a){return typeof a=="object"&&a!==null&&a.$$typeof===z_},Pn.isForwardRef=function(a){return ti(a)===Ad},Pn.isFragment=function(a){return ti(a)===bd},Pn.isLazy=function(a){return ti(a)===Rd},Pn.isMemo=function(a){return ti(a)===Cd},Pn.isPortal=function(a){return ti(a)===G_},Pn.isProfiler=function(a){return ti(a)===Td},Pn.isStrictMode=function(a){return ti(a)===yd},Pn.isSuspense=function(a){return ti(a)===Pd},Pn.isValidElementType=function(a){return typeof a=="string"||typeof a=="function"||a===bd||a===xd||a===Td||a===yd||a===Pd||a===IB||typeof a=="object"&&a!==null&&(a.$$typeof===Rd||a.$$typeof===Cd||a.$$typeof===Ed||a.$$typeof===Sd||a.$$typeof===Ad||a.$$typeof===wB||a.$$typeof===LB||a.$$typeof===NB||a.$$typeof===DB)},Pn.typeOf=ti,Nx.exports=Pn;var W_=Nx.exports,FB={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},BB={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},UB={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Bx={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},X_={};X_[W_.ForwardRef]=UB,X_[W_.Memo]=Bx;function Ux(a){return W_.isMemo(a)?Bx:X_[a.$$typeof]||FB}var VB=Object.defineProperty,kB=Object.getOwnPropertyNames,Vx=Object.getOwnPropertySymbols,jB=Object.getOwnPropertyDescriptor,zB=Object.getPrototypeOf,kx=Object.prototype;function jx(a,u,p){if(typeof u!="string"){if(kx){var s=zB(u);s&&s!==kx&&jx(a,s,p)}var c=kB(u);Vx&&(c=c.concat(Vx(u)));for(var E=Ux(a),m=Ux(u),S=0;S<c.length;++S){var h=c[S];if(!BB[h]&&!(p&&p[h])&&!(m&&m[h])&&!(E&&E[h])){var C=jB(u,h);try{VB(a,h,C)}catch(R){}}}}return a}var GB=jx,HB=function(a,u){return GB(a,u)},WB=HB,XB=!0;function Y_(a,u,p){var s="";return p.split(" ").forEach(function(c){a[c]!==void 0?u.push(a[c]+";"):s+=c+" "}),s}var Od=function(u,p,s){var c=u.key+"-"+p.name;if((s===!1||XB===!1)&&u.registered[c]===void 0&&(u.registered[c]=p.styles),u.inserted[p.name]===void 0){var E=p;do u.insert(p===E?"."+c:"",E,u.sheet,!0),E=E.next;while(E!==void 0)}};function YB(a){for(var u=0,p,s=0,c=a.length;c>=4;++s,c-=4)p=a.charCodeAt(s)&255|(a.charCodeAt(++s)&255)<<8|(a.charCodeAt(++s)&255)<<16|(a.charCodeAt(++s)&255)<<24,p=(p&65535)*1540483477+((p>>>16)*59797<<16),p^=p>>>24,u=(p&65535)*1540483477+((p>>>16)*59797<<16)^(u&65535)*1540483477+((u>>>16)*59797<<16);switch(c){case 3:u^=(a.charCodeAt(s+2)&255)<<16;case 2:u^=(a.charCodeAt(s+1)&255)<<8;case 1:u^=a.charCodeAt(s)&255,u=(u&65535)*1540483477+((u>>>16)*59797<<16)}return u^=u>>>13,u=(u&65535)*1540483477+((u>>>16)*59797<<16),((u^u>>>15)>>>0).toString(36)}var KB={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},QB=/[A-Z]|^ms/g,qB=/_EMO_([^_]+?)_([^]*?)_EMO_/g,zx=function(u){return u.charCodeAt(1)===45},Gx=function(u){return u!=null&&typeof u!="boolean"},K_=wx(function(a){return zx(a)?a:a.replace(QB,"-$&").toLowerCase()}),Hx=function(u,p){switch(u){case"animation":case"animationName":if(typeof p=="string")return p.replace(qB,function(s,c,E){return Xi={name:c,styles:E,next:Xi},c})}return KB[u]!==1&&!zx(u)&&typeof p=="number"&&p!==0?p+"px":p};function Fl(a,u,p){if(p==null)return"";if(p.__emotion_styles!==void 0)return p;switch(typeof p){case"boolean":return"";case"object":{if(p.anim===1)return Xi={name:p.name,styles:p.styles,next:Xi},p.name;if(p.styles!==void 0){var s=p.next;if(s!==void 0)for(;s!==void 0;)Xi={name:s.name,styles:s.styles,next:Xi},s=s.next;var c=p.styles+";";return c}return ZB(a,u,p)}case"function":{if(a!==void 0){var E=Xi,m=p(a);return Xi=E,Fl(a,u,m)}break}}if(u==null)return p;var S=u[p];return S!==void 0?S:p}function ZB(a,u,p){var s="";if(Array.isArray(p))for(var c=0;c<p.length;c++)s+=Fl(a,u,p[c])+";";else for(var E in p){var m=p[E];if(typeof m!="object")u!=null&&u[m]!==void 0?s+=E+"{"+u[m]+"}":Gx(m)&&(s+=K_(E)+":"+Hx(E,m)+";");else if(Array.isArray(m)&&typeof m[0]=="string"&&(u==null||u[m[0]]===void 0))for(var S=0;S<m.length;S++)Gx(m[S])&&(s+=K_(E)+":"+Hx(E,m[S])+";");else{var h=Fl(a,u,m);switch(E){case"animation":case"animationName":{s+=K_(E)+":"+h+";";break}default:s+=E+"{"+h+"}"}}}return s}var Wx=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Xi,Bl=function(u,p,s){if(u.length===1&&typeof u[0]=="object"&&u[0]!==null&&u[0].styles!==void 0)return u[0];var c=!0,E="";Xi=void 0;var m=u[0];m==null||m.raw===void 0?(c=!1,E+=Fl(s,p,m)):E+=m[0];for(var S=1;S<u.length;S++)E+=Fl(s,p,u[S]),c&&(E+=m[S]);Wx.lastIndex=0;for(var h="",C;(C=Wx.exec(E))!==null;)h+="-"+C[1];var R=YB(E)+h;return{name:R,styles:E,next:Xi}},Q_=Object.prototype.hasOwnProperty,q_=Er(typeof HTMLElement!="undefined"?MB({key:"css"}):null),$B=q_.Provider,JB=function(){return cn(q_)},Ul=function(u){return Ci(function(p,s){var c=cn(q_);return u(p,c,s)})},Yi=Er({}),e2=function(){return cn(Yi)},t2=function(u,p){if(typeof p=="function"){var s=p(u);return s}return ra({},u,p)},n2=Dx(function(a){return Dx(function(u){return t2(a,u)})}),Xx=function(u){var p=cn(Yi);return u.theme!==p&&(p=n2(p)(u.theme)),$e(Yi.Provider,{value:p},u.children)};function r2(a){var u=a.displayName||a.name||"Component",p=function(E,m){var S=cn(Yi);return $e(a,ra({theme:S,ref:m},E))},s=Ci(p);return s.displayName="WithTheme("+u+")",WB(s,a)}var Z_="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",i2=function(u,p){var s={};for(var c in p)Q_.call(p,c)&&(s[c]=p[c]);return s[Z_]=u,s},o2=Ul(function(a,u,p){var s=a.css;typeof s=="string"&&u.registered[s]!==void 0&&(s=u.registered[s]);var c=a[Z_],E=[s],m="";typeof a.className=="string"?m=Y_(u.registered,E,a.className):a.className!=null&&(m=a.className+" ");var S=Bl(E,void 0,cn(Yi));Od(u,S,typeof c=="string"),m+=u.key+"-"+S.name;var h={};for(var C in a)Q_.call(a,C)&&C!=="css"&&C!==Z_&&(h[C]=a[C]);h.ref=p,h.className=m;var R=$e(c,h);return R}),Yx=function(u,p){var s=arguments;if(p==null||!Q_.call(p,"css"))return $e.apply(void 0,s);var c=s.length,E=new Array(c);E[0]=o2,E[1]=i2(u,p);for(var m=2;m<c;m++)E[m]=s[m];return $e.apply(null,E)},Md=Ul(function(a,u){var p=a.styles,s=Bl([p],void 0,cn(Yi)),c=zt();return $o(function(){var E=u.key+"-global",m=new Tx({key:E,nonce:u.sheet.nonce,container:u.sheet.container,speedy:u.sheet.isSpeedy}),S=!1,h=document.querySelector('style[data-emotion="'+E+" "+s.name+'"]');return u.sheet.tags.length&&(m.before=u.sheet.tags[0]),h!==null&&(S=!0,h.setAttribute("data-emotion",E),m.hydrate([h])),c.current=[m,S],function(){m.flush()}},[u]),$o(function(){var E=c.current,m=E[0],S=E[1];if(S){E[1]=!1;return}if(s.next!==void 0&&Od(u,s.next,!0),m.tags.length){var h=m.tags[m.tags.length-1].nextElementSibling;m.before=h,m.flush()}u.insert("",s,m,!1)},[u,s.name]),null});function Kx(){for(var a=arguments.length,u=new Array(a),p=0;p<a;p++)u[p]=arguments[p];return Bl(u)}var $_=function(){var u=Kx.apply(void 0,arguments),p="animation-"+u.name;return{name:p,styles:"@keyframes "+p+"{"+u.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},a2=function a(u){for(var p=u.length,s=0,c="";s<p;s++){var E=u[s];if(E!=null){var m=void 0;switch(typeof E){case"boolean":break;case"object":{if(Array.isArray(E))m=a(E);else{m="";for(var S in E)E[S]&&S&&(m&&(m+=" "),m+=S)}break}default:m=E}m&&(c&&(c+=" "),c+=m)}}return c};function s2(a,u,p){var s=[],c=Y_(a,s,p);return s.length<2?p:c+u(s)}var c2=Ul(function(a,u){var p=!1,s=function(){for(var h=arguments.length,C=new Array(h),R=0;R<h;R++)C[R]=arguments[R];var I=Bl(C,u.registered);return Od(u,I,!1),u.key+"-"+I.name},c=function(){for(var h=arguments.length,C=new Array(h),R=0;R<h;R++)C[R]=arguments[R];return s2(u.registered,s,a2(C))},E={css:s,cx:c,theme:cn(Yi)},m=a.children(E);return p=!0,m}),l2=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ClassNames:c2,Global:Md,createElement:Yx,css:Kx,jsx:Yx,keyframes:$_,CacheProvider:$B,ThemeContext:Yi,ThemeProvider:Xx,__unsafe_useEmotionCache:JB,useTheme:e2,withEmotionCache:Ul,withTheme:r2}),u2=()=>$e(Md,{styles:`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;      
        -moz-osx-font-smoothing: grayscale; 
        touch-action: manipulation; 
      }

      body {
        position: relative;
        min-height: 100%;
        font-feature-settings: 'kern';
      }

      *,
      *::before,
      *::after {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
      }

      main {
        display: block;
      }

      hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      pre,
      code,
      kbd,
      samp {
        font-family: SFMono-Regular,  Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      b,
      strong {
        font-weight: bold;
      }

      small {
        font-size: 80%;
      }

      sub,
      sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      sub {
        bottom: -0.25em;
      }

      sup {
        top: -0.5em;
      }

      img {
        border-style: none;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      button,
      input {
        overflow: visible;
      }

      button,
      select {
        text-transform: none;
      }

      button::-moz-focus-inner,
      [type="button"]::-moz-focus-inner,
      [type="reset"]::-moz-focus-inner,
      [type="submit"]::-moz-focus-inner {
        border-style: none;
        padding: 0;
      }

      fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      progress {
        vertical-align: baseline;
      }

      textarea {
        overflow: auto;
      }

      [type="checkbox"],
      [type="radio"] {
        box-sizing: border-box;
        padding: 0;
      }

      [type="number"]::-webkit-inner-spin-button,
      [type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      [type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      [type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      details {
        display: block;
      }

      summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      body,
      blockquote,
      dl,
      dd,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      hr,
      figure,
      p,
      pre {
        margin: 0;
      }

      button {
        background: transparent;
        padding: 0;
      }

      fieldset {
        margin: 0;
        padding: 0;
      }

      ol,
      ul {
        margin: 0;
        padding: 0;
      }

      textarea {
        resize: vertical;
      }

      button,
      [role="button"] {
        cursor: pointer;
      }

      button::-moz-focus-inner {
        border: 0 !important;
      }

      table {
        border-collapse: collapse;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-size: inherit;
        font-weight: inherit;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      img,
      svg,
      video,
      canvas,
      audio,
      iframe,
      embed,
      object {
        display: block;
        vertical-align: middle;
      }

      img,
      video {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible] :focus:not([data-focus-visible-added]) {
        outline: none;
        box-shadow: none;
      }

      select::-ms-expand {
        display: none;
      }
    `}),h2=u2;function d2(a){var u=a==null?0:a.length;return u?a[u-1]:void 0}function Ua(a){return typeof a=="number"}function J_(a){return Array.isArray(a)}function Qx(a){return typeof a=="function"}function Mi(a){var u=typeof a;return a!=null&&(u==="object"||u==="function")&&!J_(a)}function f2(a){return Mi(a)&&Object.keys(a).length===0}function eg(a){return Object.prototype.toString.call(a)==="[object String]"}function qx(a){return/^var\(--.+\)$/.test(a)}var Ki=!1,tg={exports:{}};(function(a,u){var p=200,s="__lodash_hash_undefined__",c=800,E=16,m=9007199254740991,S="[object Arguments]",h="[object Array]",C="[object AsyncFunction]",R="[object Boolean]",I="[object Date]",b="[object Error]",f="[object Function]",x="[object GeneratorFunction]",P="[object Map]",A="[object Number]",T="[object Null]",_="[object Object]",g="[object Proxy]",M="[object RegExp]",O="[object Set]",N="[object String]",V="[object Undefined]",U="[object WeakMap]",L="[object ArrayBuffer]",j="[object DataView]",Y="[object Float32Array]",W="[object Float64Array]",ie="[object Int8Array]",re="[object Int16Array]",ye="[object Int32Array]",ve="[object Uint8Array]",ue="[object Uint8ClampedArray]",oe="[object Uint16Array]",Z="[object Uint32Array]",J=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,G=/^(?:0|[1-9]\d*)$/,$={};$[Y]=$[W]=$[ie]=$[re]=$[ye]=$[ve]=$[ue]=$[oe]=$[Z]=!0,$[S]=$[h]=$[L]=$[R]=$[j]=$[I]=$[b]=$[f]=$[P]=$[A]=$[_]=$[M]=$[O]=$[N]=$[U]=!1;var he=typeof Be=="object"&&Be&&Be.Object===Object&&Be,se=typeof self=="object"&&self&&self.Object===Object&&self,q=he||se||Function("return this")(),H=u&&!u.nodeType&&u,X=H&&!0&&a&&!a.nodeType&&a,ee=X&&X.exports===H,Q=ee&&he.process,te=function(){try{var we=X&&X.require&&X.require("util").types;return we||Q&&Q.binding&&Q.binding("util")}catch(Ge){}}(),ge=te&&te.isTypedArray;function ce(we,Ge,Je){switch(Je.length){case 0:return we.call(Ge);case 1:return we.call(Ge,Je[0]);case 2:return we.call(Ge,Je[0],Je[1]);case 3:return we.call(Ge,Je[0],Je[1],Je[2])}return we.apply(Ge,Je)}function de(we,Ge){for(var Je=-1,xt=Array(we);++Je<we;)xt[Je]=Ge(Je);return xt}function ne(we){return function(Ge){return we(Ge)}}function pe(we,Ge){return we==null?void 0:we[Ge]}function Se(we,Ge){return function(Je){return we(Ge(Je))}}var Te=Array.prototype,Ne=Function.prototype,je=Object.prototype,Xe=q["__core-js_shared__"],Ye=Ne.toString,Ke=je.hasOwnProperty,nt=function(){var we=/[^.]+$/.exec(Xe&&Xe.keys&&Xe.keys.IE_PROTO||"");return we?"Symbol(src)_1."+we:""}(),qe=je.toString,ct=Ye.call(Object),ot=RegExp("^"+Ye.call(Ke).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=ee?q.Buffer:void 0,gt=q.Symbol,At=q.Uint8Array,wt=_t?_t.allocUnsafe:void 0,Qt=Se(Object.getPrototypeOf,Object),Wt=Object.create,Ft=je.propertyIsEnumerable,Ht=Te.splice,fn=gt?gt.toStringTag:void 0,un=function(){try{var we=Ta(Object,"defineProperty");return we({},"",{}),we}catch(Ge){}}(),wn=_t?_t.isBuffer:void 0,Fe=Math.max,gr=Date.now,On=Ta(q,"Map"),$n=Ta(Object,"create"),He=function(){function we(){}return function(Ge){if(!eo(Ge))return{};if(Wt)return Wt(Ge);we.prototype=Ge;var Je=new we;return we.prototype=void 0,Je}}();function jn(we){var Ge=-1,Je=we==null?0:we.length;for(this.clear();++Ge<Je;){var xt=we[Ge];this.set(xt[0],xt[1])}}function Io(){this.__data__=$n?$n(null):{},this.size=0}function et(we){var Ge=this.has(we)&&delete this.__data__[we];return this.size-=Ge?1:0,Ge}function dr(we){var Ge=this.__data__;if($n){var Je=Ge[we];return Je===s?void 0:Je}return Ke.call(Ge,we)?Ge[we]:void 0}function Kr(we){var Ge=this.__data__;return $n?Ge[we]!==void 0:Ke.call(Ge,we)}function ns(we,Ge){var Je=this.__data__;return this.size+=this.has(we)?0:1,Je[we]=$n&&Ge===void 0?s:Ge,this}jn.prototype.clear=Io,jn.prototype.delete=et,jn.prototype.get=dr,jn.prototype.has=Kr,jn.prototype.set=ns;function dt(we){var Ge=-1,Je=we==null?0:we.length;for(this.clear();++Ge<Je;){var xt=we[Ge];this.set(xt[0],xt[1])}}function Qr(){this.__data__=[],this.size=0}function hp(we){var Ge=this.__data__,Je=va(Ge,we);if(Je<0)return!1;var xt=Ge.length-1;return Je==xt?Ge.pop():Ht.call(Ge,Je,1),--this.size,!0}function Ot(we){var Ge=this.__data__,Je=va(Ge,we);return Je<0?void 0:Ge[Je][1]}function Uu(we){return va(this.__data__,we)>-1}function Vu(we,Ge){var Je=this.__data__,xt=va(Je,we);return xt<0?(++this.size,Je.push([we,Ge])):Je[xt][1]=Ge,this}dt.prototype.clear=Qr,dt.prototype.delete=hp,dt.prototype.get=Ot,dt.prototype.has=Uu,dt.prototype.set=Vu;function $i(we){var Ge=-1,Je=we==null?0:we.length;for(this.clear();++Ge<Je;){var xt=we[Ge];this.set(xt[0],xt[1])}}function Do(){this.size=0,this.__data__={hash:new jn,map:new(On||dt),string:new jn}}function dp(we){var Ge=wo(this,we).delete(we);return this.size-=Ge?1:0,Ge}function fp(we){return wo(this,we).get(we)}function vi(we){return wo(this,we).has(we)}function pp(we,Ge){var Je=wo(this,we),xt=Je.size;return Je.set(we,Ge),this.size+=Je.size==xt?0:1,this}$i.prototype.clear=Do,$i.prototype.delete=dp,$i.prototype.get=fp,$i.prototype.has=vi,$i.prototype.set=pp;function jt(we){var Ge=this.__data__=new dt(we);this.size=Ge.size}function Pt(){this.__data__=new dt,this.size=0}function Or(we){var Ge=this.__data__,Je=Ge.delete(we);return this.size=Ge.size,Je}function ku(we){return this.__data__.get(we)}function mp(we){return this.__data__.has(we)}function _p(we,Ge){var Je=this.__data__;if(Je instanceof dt){var xt=Je.__data__;if(!On||xt.length<p-1)return xt.push([we,Ge]),this.size=++Je.size,this;Je=this.__data__=new $i(xt)}return Je.set(we,Ge),this.size=Je.size,this}jt.prototype.clear=Pt,jt.prototype.delete=Or,jt.prototype.get=ku,jt.prototype.has=mp,jt.prototype.set=_p;function ke(we,Ge){var Je=ai(we),xt=!Je&&Zt(we),tn=!Je&&!xt&&Fi(we),gn=!Je&&!xt&&!tn&&Xc(we),Mn=Je||xt||tn||gn,Xt=Mn?de(we.length,String):[],Tn=Xt.length;for(var Gn in we)(Ge||Ke.call(we,Gn))&&!(Mn&&(Gn=="length"||tn&&(Gn=="offset"||Gn=="parent")||gn&&(Gn=="buffer"||Gn=="byteLength"||Gn=="byteOffset")||os(Gn,Tn)))&&Xt.push(Gn);return Xt}function Nt(we,Ge,Je){(Je!==void 0&&!Lo(we[Ge],Je)||Je===void 0&&!(Ge in we))&&rs(we,Ge,Je)}function en(we,Ge,Je){var xt=we[Ge];(!(Ke.call(we,Ge)&&Lo(xt,Je))||Je===void 0&&!(Ge in we))&&rs(we,Ge,Je)}function va(we,Ge){for(var Je=we.length;Je--;)if(Lo(we[Je][0],Ge))return Je;return-1}function rs(we,Ge,Je){Ge=="__proto__"&&un?un(we,Ge,{configurable:!0,enumerable:!0,value:Je,writable:!0}):we[Ge]=Je}var ju=Bc();function xr(we){return we==null?we===void 0?V:T:fn&&fn in Object(we)?Uc(we):Ea(we)}function ba(we){return Fo(we)&&xr(we)==S}function Kn(we){if(!eo(we)||vp(we))return!1;var Ge=No(we)?ot:B;return Ge.test(Gc(we))}function ya(we){return Fo(we)&&Wc(we.length)&&!!$[xr(we)]}function gp(we){if(!eo(we))return jc(we);var Ge=as(we),Je=[];for(var xt in we)xt=="constructor"&&(Ge||!Ke.call(we,xt))||Je.push(xt);return Je}function zn(we,Ge,Je,xt,tn){we!==Ge&&ju(Ge,function(gn,Mn){if(tn||(tn=new jt),eo(gn))zu(we,Ge,Mn,Je,zn,xt,tn);else{var Xt=xt?xt(Sa(we,Mn),gn,Mn+"",we,Ge,tn):void 0;Xt===void 0&&(Xt=gn),Nt(we,Mn,Xt)}},ss)}function zu(we,Ge,Je,xt,tn,gn,Mn){var Xt=Sa(we,Je),Tn=Sa(Ge,Je),Gn=Mn.get(Tn);if(Gn){Nt(we,Je,Gn);return}var Qe=gn?gn(Xt,Tn,Je+"",we,Ge,Mn):void 0,xa=Qe===void 0;if(xa){var cs=ai(Tn),St=!cs&&Fi(Tn),Xu=!cs&&!St&&Xc(Tn);Qe=Tn,cs||St||Xu?ai(Xt)?Qe=Xt:Hc(Xt)?Qe=Nc(Xt):St?(xa=!1,Qe=wc(Tn,!0)):Xu?(xa=!1,Qe=Gu(Tn,!0)):Qe=[]:qr(Tn)||Zt(Tn)?(Qe=Xt,Zt(Xt)?Qe=Wu(Xt):(!eo(Xt)||No(Xt))&&(Qe=Vc(Tn))):xa=!1}xa&&(Mn.set(Tn,Qe),tn(Qe,Tn,xt,gn,Mn),Mn.delete(Tn)),Nt(we,Je,Qe)}function Dc(we,Ge){return Nn(zc(we,Ge,Bi),we+"")}var Ji=un?function(we,Ge){return un(we,"toString",{configurable:!0,enumerable:!1,value:vr(Ge),writable:!0})}:Bi;function wc(we,Ge){if(Ge)return we.slice();var Je=we.length,xt=wt?wt(Je):new we.constructor(Je);return we.copy(xt),xt}function Lc(we){var Ge=new we.constructor(we.byteLength);return new At(Ge).set(new At(we)),Ge}function Gu(we,Ge){var Je=Ge?Lc(we.buffer):we.buffer;return new we.constructor(Je,we.byteOffset,we.length)}function Nc(we,Ge){var Je=-1,xt=we.length;for(Ge||(Ge=Array(xt));++Je<xt;)Ge[Je]=we[Je];return Ge}function is(we,Ge,Je,xt){var tn=!Je;Je||(Je={});for(var gn=-1,Mn=Ge.length;++gn<Mn;){var Xt=Ge[gn],Tn=xt?xt(Je[Xt],we[Xt],Xt,Je,we):void 0;Tn===void 0&&(Tn=we[Xt]),tn?rs(Je,Xt,Tn):en(Je,Xt,Tn)}return Je}function Fc(we){return Dc(function(Ge,Je){var xt=-1,tn=Je.length,gn=tn>1?Je[tn-1]:void 0,Mn=tn>2?Je[2]:void 0;for(gn=we.length>3&&typeof gn=="function"?(tn--,gn):void 0,Mn&&kc(Je[0],Je[1],Mn)&&(gn=tn<3?void 0:gn,tn=1),Ge=Object(Ge);++xt<tn;){var Xt=Je[xt];Xt&&we(Ge,Xt,xt,gn)}return Ge})}function Bc(we){return function(Ge,Je,xt){for(var tn=-1,gn=Object(Ge),Mn=xt(Ge),Xt=Mn.length;Xt--;){var Tn=Mn[we?Xt:++tn];if(Je(gn[Tn],Tn,gn)===!1)break}return Ge}}function wo(we,Ge){var Je=we.__data__;return nn(Ge)?Je[typeof Ge=="string"?"string":"hash"]:Je.map}function Ta(we,Ge){var Je=pe(we,Ge);return Kn(Je)?Je:void 0}function Uc(we){var Ge=Ke.call(we,fn),Je=we[fn];try{we[fn]=void 0;var xt=!0}catch(gn){}var tn=qe.call(we);return xt&&(Ge?we[fn]=Je:delete we[fn]),tn}function Vc(we){return typeof we.constructor=="function"&&!as(we)?He(Qt(we)):{}}function os(we,Ge){var Je=typeof we;return Ge=Ge??m,!!Ge&&(Je=="number"||Je!="symbol"&&G.test(we))&&we>-1&&we%1==0&&we<Ge}function kc(we,Ge,Je){if(!eo(Je))return!1;var xt=typeof Ge;return(xt=="number"?Ar(Je)&&os(Ge,Je.length):xt=="string"&&Ge in Je)?Lo(Je[Ge],we):!1}function nn(we){var Ge=typeof we;return Ge=="string"||Ge=="number"||Ge=="symbol"||Ge=="boolean"?we!=="__proto__":we===null}function vp(we){return!!nt&&nt in we}function as(we){var Ge=we&&we.constructor,Je=typeof Ge=="function"&&Ge.prototype||je;return we===Je}function jc(we){var Ge=[];if(we!=null)for(var Je in Object(we))Ge.push(Je);return Ge}function Ea(we){return qe.call(we)}function zc(we,Ge,Je){return Ge=Fe(Ge===void 0?we.length-1:Ge,0),function(){for(var xt=arguments,tn=-1,gn=Fe(xt.length-Ge,0),Mn=Array(gn);++tn<gn;)Mn[tn]=xt[Ge+tn];tn=-1;for(var Xt=Array(Ge+1);++tn<Ge;)Xt[tn]=xt[tn];return Xt[Ge]=Je(Mn),ce(we,this,Xt)}}function Sa(we,Ge){if(!(Ge==="constructor"&&typeof we[Ge]=="function")&&Ge!="__proto__")return we[Ge]}var Nn=Hu(Ji);function Hu(we){var Ge=0,Je=0;return function(){var xt=gr(),tn=E-(xt-Je);if(Je=xt,tn>0){if(++Ge>=c)return arguments[0]}else Ge=0;return we.apply(void 0,arguments)}}function Gc(we){if(we!=null){try{return Ye.call(we)}catch(Ge){}try{return we+""}catch(Ge){}}return""}function Lo(we,Ge){return we===Ge||we!==we&&Ge!==Ge}var Zt=ba(function(){return arguments}())?ba:function(we){return Fo(we)&&Ke.call(we,"callee")&&!Ft.call(we,"callee")},ai=Array.isArray;function Ar(we){return we!=null&&Wc(we.length)&&!No(we)}function Hc(we){return Fo(we)&&Ar(we)}var Fi=wn||Ui;function No(we){if(!eo(we))return!1;var Ge=xr(we);return Ge==f||Ge==x||Ge==C||Ge==g}function Wc(we){return typeof we=="number"&&we>-1&&we%1==0&&we<=m}function eo(we){var Ge=typeof we;return we!=null&&(Ge=="object"||Ge=="function")}function Fo(we){return we!=null&&typeof we=="object"}function qr(we){if(!Fo(we)||xr(we)!=_)return!1;var Ge=Qt(we);if(Ge===null)return!0;var Je=Ke.call(Ge,"constructor")&&Ge.constructor;return typeof Je=="function"&&Je instanceof Je&&Ye.call(Je)==ct}var Xc=ge?ne(ge):ya;function Wu(we){return is(we,ss(we))}function ss(we){return Ar(we)?ke(we,!0):gp(we)}var Qn=Fc(function(we,Ge,Je,xt){zn(we,Ge,Je,xt)});function vr(we){return function(){return we}}function Bi(we){return we}function Ui(){return!1}a.exports=Qn})(tg,tg.exports);var go=tg.exports;function Zx(a,u){var p={};return Object.keys(a).forEach(s=>{u.includes(s)||(p[s]=a[s])}),p}function p2(a,u){var p={};return u.forEach(s=>{s in a&&(p[s]=a[s])}),p}function m2(a,u){var p={},s={};return Object.keys(a).forEach(c=>{u.includes(c)?p[c]=a[c]:s[c]=a[c]}),[p,s]}function _2(a,u,p,s){var c=typeof u=="string"?u.split("."):[u];for(s=0;s<c.length&&a;s+=1)a=a[c[s]];return a===void 0?p:a}var g2=a=>{var u=new WeakMap,p=(s,c,E,m)=>{if(typeof s=="undefined")return a(s,c,E);u.has(s)||u.set(s,new Map);var S=u.get(s);if(S.has(c))return S.get(c);var h=a(s,c,E,m);return S.set(c,h),h};return p},Id=g2(_2);function $x(a,u){var p={};return Object.keys(a).forEach(s=>{var c=a[s],E=u(c,s,a);E&&(p[s]=c)}),p}var Dd=a=>$x(a,u=>u!=null),wd=a=>Object.keys(a),v2=a=>a.reduce((u,p)=>{var[s,c]=p;return u[s]=c,u},{});function b2(a){var u=parseFloat(a.toString()),p=a.toString().replace(String(u),"");return{unitless:!p,value:u,unit:p}}function ng(a){if(a==null)return a;var{unitless:u}=b2(a);return u||Ua(a)?a+"px":a}var Jx=(a,u)=>parseInt(a[1],10)>parseInt(u[1],10)?1:-1,rg=a=>v2(Object.entries(a).sort(Jx));function eA(a){var u=rg(a);return Object.assign(Object.values(u),u)}function y2(a){var u=Object.keys(rg(a));return new Set(u)}function T2(a){var u;if(!a)return a;a=(u=ng(a))!=null?u:a;var p=a.endsWith("px")?-1:-.0635;return Ua(a)?""+(a+p):a.replace(/([0-9]+\.?[0-9]*)/,s=>""+(parseFloat(s)+p))}function Ld(a,u){var p=[];return a&&p.push("@media screen and (min-width: "+ng(a)+")"),p.length>0&&u&&p.push("and"),u&&p.push("@media screen and (max-width: "+ng(u)+")"),p.join(" ")}function E2(a){var u;if(!a)return null;a.base=(u=a.base)!=null?u:"0px";var p=eA(a),s=Object.entries(a).sort(Jx).map((m,S,h)=>{var C,[R,I]=m,[,b]=(C=h[S+1])!=null?C:[];return b=parseFloat(b)>0?T2(b):void 0,{breakpoint:R,minW:I,maxW:b,maxWQuery:Ld(null,b),minWQuery:Ld(I),minMaxQuery:Ld(I,b)}}),c=y2(a),E=Array.from(c.values());return{keys:c,normalized:p,isResponsive(m){var S=Object.keys(m);return S.length>0&&S.every(h=>c.has(h))},asObject:rg(a),asArray:eA(a),details:s,media:[null,...p.map(m=>Ld(m)).slice(1)],toArrayValue(m){if(!Mi(m))throw new Error("toArrayValue: value must be an object");for(var S=E.map(h=>{var C;return(C=m[h])!=null?C:null});d2(S)===null;)S.pop();return S},toObjectValue(m){if(!Array.isArray(m))throw new Error("toObjectValue: value must be an array");return m.reduce((S,h,C)=>{var R=E[C];return R!=null&&h!=null&&(S[R]=h),S},{})}}}function tA(a){return a!=null&&typeof a=="object"&&"nodeType"in a&&a.nodeType===Node.ELEMENT_NODE}function ig(a){var u;if(!tA(a))return!1;var p=(u=a.ownerDocument.defaultView)!=null?u:window;return a instanceof p.HTMLElement}function nA(a){var u;return tA(a)&&(u=a.ownerDocument)!=null?u:document}function S2(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var qs=S2(),Cr=a=>a?"":void 0,og=a=>a?!0:void 0,ir=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return p.filter(Boolean).join(" ")},x2=a=>a.hasAttribute("tabindex");function A2(a){return Boolean(a.getAttribute("disabled"))===!0||Boolean(a.getAttribute("aria-disabled"))===!0}function P2(a){return ig(a)&&a.tagName.toLowerCase()==="input"&&"select"in a}function C2(a){var u=ig(a)?nA(a):document;return u.activeElement===a}function rA(a){return a.parentElement&&rA(a.parentElement)?!0:a.hidden}function R2(a){var u=a.getAttribute("contenteditable");return u!=="false"&&u!=null}function O2(a){if(!ig(a)||rA(a)||A2(a))return!1;var{localName:u}=a,p=["input","select","textarea","button"];if(p.indexOf(u)>=0)return!0;var s={a:()=>a.hasAttribute("href"),audio:()=>a.hasAttribute("controls"),video:()=>a.hasAttribute("controls")};return u in s?s[u]():R2(a)?!0:x2(a)}var M2=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","embed","iframe","object","a[href]","area[href]","button:not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],I2=M2.join();function D2(a){var u=Array.from(a.querySelectorAll(I2));return u.unshift(a),u.filter(O2).filter(p=>window.getComputedStyle(p).display!=="none")}function Qi(a){for(var u=arguments.length,p=new Array(u>1?u-1:0),s=1;s<u;s++)p[s-1]=arguments[s];return Qx(a)?a(...p):a}function ur(){for(var a=arguments.length,u=new Array(a),p=0;p<a;p++)u[p]=arguments[p];return function(c){u.some(E=>(E==null||E(c),c==null?void 0:c.defaultPrevented))}}function w2(a){var u;return function(){if(a){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];u=a.apply(this,c),a=null}return u}}var Vl=()=>{},ag=w2(a=>()=>{var{condition:u,message:p}=a;u&&Ki&&console.warn(p)});function iA(a,u){u===void 0&&(u={});var{isActive:p=C2,nextTick:s,preventScroll:c=!0,selectTextIfInput:E=!0}=u;if(!a||p(a))return-1;function m(){if(!a){ag({condition:!0,message:"[chakra-ui]: can't call focus() on `null` or `undefined` element"});return}if(L2())a.focus({preventScroll:c});else if(a.focus(),c){var S=N2(a);F2(S)}P2(a)&&E&&a.select()}return s?requestAnimationFrame(m):(m(),-1)}var Nd=null;function L2(){if(Nd==null){Nd=!1;try{var a=document.createElement("div");a.focus({get preventScroll(){return Nd=!0,!0}})}catch(u){}}return Nd}function N2(a){for(var u,p=nA(a),s=(u=p.defaultView)!=null?u:window,c=a.parentNode,E=[],m=p.scrollingElement||p.documentElement;c instanceof s.HTMLElement&&c!==m;)(c.offsetHeight<c.scrollHeight||c.offsetWidth<c.scrollWidth)&&E.push({element:c,scrollTop:c.scrollTop,scrollLeft:c.scrollLeft}),c=c.parentNode;return m instanceof s.HTMLElement&&E.push({element:m,scrollTop:m.scrollTop,scrollLeft:m.scrollLeft}),E}function F2(a){for(var{element:u,scrollTop:p,scrollLeft:s}of a)u.scrollTop=p,u.scrollLeft=s}var oA=1/60*1e3,B2=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},aA=typeof window!="undefined"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a(B2())},oA)};function U2(a){var u=[],p=[],s=0,c=!1,E=new WeakSet,m={schedule:function(S,h,C){h===void 0&&(h=!1),C===void 0&&(C=!1);var R=C&&c,I=R?u:p;return h&&E.add(S),I.indexOf(S)===-1&&(I.push(S),R&&c&&(s=u.length)),S},cancel:function(S){var h=p.indexOf(S);h!==-1&&p.splice(h,1),E.delete(S)},process:function(S){var h;if(c=!0,h=[p,u],u=h[0],p=h[1],p.length=0,s=u.length,s)for(var C=0;C<s;C++){var R=u[C];R(S),E.has(R)&&(m.schedule(R),a())}c=!1}};return m}var V2=40,sg=!0,kl=!1,cg=!1,Zs={delta:0,timestamp:0},jl=["read","update","preRender","render","postRender"],Fd=jl.reduce(function(a,u){return a[u]=U2(function(){return kl=!0}),a},{}),qi=jl.reduce(function(a,u){var p=Fd[u];return a[u]=function(s,c,E){return c===void 0&&(c=!1),E===void 0&&(E=!1),kl||j2(),p.schedule(s,c,E)},a},{}),zl=jl.reduce(function(a,u){return a[u]=Fd[u].cancel,a},{}),$s=jl.reduce(function(a,u){return a[u]=function(){return Fd[u].process(Zs)},a},{}),k2=function(a){return Fd[a].process(Zs)},sA=function(a){kl=!1,Zs.delta=sg?oA:Math.max(Math.min(a-Zs.timestamp,V2),1),Zs.timestamp=a,cg=!0,jl.forEach(k2),cg=!1,kl&&(sg=!1,aA(sA))},j2=function(){kl=!0,sg=!0,cg||aA(sA)},Bd=function(){return Zs};Object.freeze(["base","sm","md","lg","xl","2xl"]);function lg(a,u){return J_(a)?a.map(p=>p===null?null:u(p)):Mi(a)?wd(a).reduce((p,s)=>(p[s]=u(a[s]),p),{}):a!=null?u(a):null}function z2(a,u){function p(s,c){return c===void 0&&(c=[]),J_(s)?s.map((E,m)=>p(E,[...c,String(m)])):Mi(s)?Object.fromEntries(Object.entries(s).map(E=>{var[m,S]=E;return[m,p(S,[...c,m])]})):u(s,c)}return p(a)}function G2(a,u){if(a!=null){if(Qx(a)){a(u);return}try{a.current=u}catch(p){throw new Error("Cannot assign value '"+u+"' to ref '"+a+"'")}}}function Gl(){for(var a=arguments.length,u=new Array(a),p=0;p<a;p++)u[p]=arguments[p];return s=>{u.forEach(c=>G2(c,s))}}function ia(a){a===void 0&&(a={});var{strict:u=!0,errorMessage:p="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:s}=a,c=Er(void 0);c.displayName=s;function E(){var m=cn(c);if(!m&&u){var S=new Error(p);throw S.name="ContextError",Error.captureStackTrace==null||Error.captureStackTrace(S,E),S}return m}return[c.Provider,E,c]}function H2(a){return Ol.toArray(a).filter(u=>Jo(u))}var[W2,X2]=ia({strict:!1,name:"PortalManagerContext"});function cA(a){var{children:u,zIndex:p}=a;return $e(W2,{value:{zIndex:p}},u)}Ki&&(cA.displayName="PortalManager");function ug(a){a===void 0&&(a=!1);var[u,p]=ln(a),s=Gt(()=>{p(!0)},[]),c=Gt(()=>{p(!1)},[]),E=Gt(()=>{p(m=>!m)},[]);return[u,{on:s,off:c,toggle:E}]}var Js=qs?$o:Vt;function hg(a,u){u===void 0&&(u=[]);var p=zt(a);return Js(()=>{p.current=a}),Gt(function(){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return p.current==null?void 0:p.current(...c)},u)}function Y2(a,u){var p=a!==void 0,s=p&&typeof a!="undefined"?a:u;return[p,s]}var lA={prefix:Math.round(Math.random()*1e10),current:0},dg=Er(lA),K2=Rl(a=>{var{children:u}=a,p=cn(dg),s=p===lA,c=Hn(()=>({prefix:s?0:++p.prefix,current:0}),[s,p]);return $e(dg.Provider,{value:c},u)});function Q2(a,u){var p=cn(dg);return Hn(()=>a||[u,p.prefix,++p.current].filter(Boolean).join("-"),[a,u])}function q2(a){for(var u=arguments.length,p=new Array(u>1?u-1:0),s=1;s<u;s++)p[s-1]=arguments[s];var c=Q2(a);return Hn(()=>p.map(E=>E+"-"+c),[c,p])}function Z2(a,u){return u===void 0&&(u=[]),Vt(()=>()=>a(),u)}function uA(){var a=zt(!1),[u,p]=ln(0);return Z2(()=>{a.current=!0}),Gt(()=>{a.current||p(u+1)},[u])}function fg(){return fg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},fg.apply(this,arguments)}function $2(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var[hA,J2]=ia({strict:!1,name:"PortalContext"}),pg="chakra-portal",eU=".chakra-portal",tU=a=>$e("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:a.zIndex,top:0,left:0,right:0}},a.children),nU=a=>{var{appendToParentPortal:u,children:p}=a,s=zt(null),c=zt(null),E=uA(),m=J2(),S=X2();Js(()=>{if(!!s.current){var C=s.current.ownerDocument,R=u?m??C.body:C.body;if(!!R){c.current=C.createElement("div"),c.current.className=pg,R.appendChild(c.current),E();var I=c.current;return()=>{R.contains(I)&&R.removeChild(I)}}}},[]);var h=S!=null&&S.zIndex?$e(tU,{zIndex:S==null?void 0:S.zIndex},p):p;return c.current?nd($e(hA,{value:c.current},h),c.current):$e("span",{ref:s})},rU=a=>{var{children:u,containerRef:p,appendToParentPortal:s}=a,c=p.current,E=c??(qs?document.body:void 0),m=Hn(()=>{var h=c==null?void 0:c.ownerDocument.createElement("div");return h&&(h.className=pg),h},[c]),S=uA();return Js(()=>{S()},[]),Js(()=>{if(!(!m||!E))return E.appendChild(m),()=>{E.removeChild(m)}},[m,E]),E&&m?nd($e(hA,{value:s?m:null},u),m):null};function Ud(a){var{containerRef:u}=a,p=$2(a,["containerRef"]);return u?$e(rU,fg({containerRef:u},p)):$e(nU,p)}Ud.defaultProps={appendToParentPortal:!0},Ud.className=pg,Ud.selector=eU;var Vd={light:"chakra-ui-light",dark:"chakra-ui-dark"},iU={classList:{add:Vl,remove:Vl}},oU=()=>qs?document.body:iU;function aU(a){var u=oU();u.classList.add(a?Vd.dark:Vd.light),u.classList.remove(a?Vd.light:Vd.dark)}function sU(a){var u=window.matchMedia==null?void 0:window.matchMedia(a);if(!!u)return!!u.media===u.matches}var dA={light:"(prefers-color-scheme: light)",dark:"(prefers-color-scheme: dark)"};function cU(a){var u,p=(u=sU(dA.dark))!=null?u:a==="dark";return p?"dark":"light"}function lU(a){if(!("matchMedia"in window))return Vl;var u=window.matchMedia(dA.dark),p=()=>{a(u.matches?"dark":"light")};return p(),u.addListener(p),()=>{u.removeListener(p)}}var fA={get:()=>document.documentElement.style.getPropertyValue("--chakra-ui-color-mode"),set:a=>{qs&&document.documentElement.style.setProperty("--chakra-ui-color-mode",a)}},pA=()=>typeof Storage!="undefined",mA="chakra-ui-color-mode",uU={get(a){if(!pA())return a;try{var u=localStorage.getItem(mA);return u??a}catch(p){return a}},set(a){if(!!pA())try{localStorage.setItem(mA,a)}catch(u){}},type:"localStorage"},mg=Er({});Ki&&(mg.displayName="ColorModeContext");var _A=()=>{var a=cn(mg);if(a===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return a};function gA(a){var{value:u,children:p,options:{useSystemColorMode:s,initialColorMode:c},colorModeManager:E=uU}=a,[m,S]=ln(E.type==="cookie"?E.get(c):c);Vt(()=>{if(qs&&E.type==="localStorage"){var I=s?cU(c):fA.get()||E.get();I&&S(I)}},[E,s,c]),Vt(()=>{var I=m==="dark";aU(I),fA.set(I?"dark":"light")},[m]);var h=Gt(I=>{E.set(I),S(I)},[E]),C=Gt(()=>{h(m==="light"?"dark":"light")},[m,h]);Vt(()=>{var I;return s&&(I=lU(h)),()=>{I&&s&&I()}},[h,s]);var R=Hn(()=>({colorMode:u??m,toggleColorMode:u?Vl:C,setColorMode:u?Vl:h}),[m,h,C,u]);return $e(mg.Provider,{value:R},p)}Ki&&(gA.displayName="ColorModeProvider");var hU=(a,u)=>p=>{var s=String(u),c=a?a+"."+s:s;return Mi(p.__cssMap)&&c in p.__cssMap?p.__cssMap[c].varRef:u};function Hl(a){var{scale:u,transform:p,compose:s}=a,c=(E,m)=>{var S,h=hU(u,E)(m),C=(S=p==null?void 0:p(h,m))!=null?S:h;return s&&(C=s(C,m)),C};return c}function Ii(a,u){return p=>{var s={property:p,scale:a};return s.transform=Hl({scale:a,transform:u}),s}}var dU=a=>{var{rtl:u,ltr:p}=a;return s=>s.direction==="rtl"?u:p};function fU(a){var{property:u,scale:p,transform:s}=a;return{scale:p,property:dU(u),transform:p?Hl({scale:p,compose:s}):s}}var vA=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function pU(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...vA].join(" ")}function mU(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...vA].join(" ")}var _U={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},gU={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function vU(a){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":a,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var bU={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},bA="& > :not(style) ~ :not(style)",yU={[bA]:{marginInlineStart:"calc(var(--chakra-space-x) * calc(1 - var(--chakra-space-x-reverse)))",marginInlineEnd:"calc(var(--chakra-space-x) * var(--chakra-space-x-reverse))"}},TU={[bA]:{marginTop:"calc(var(--chakra-space-y) * calc(1 - var(--chakra-space-y-reverse)))",marginBottom:"calc(var(--chakra-space-y) * var(--chakra-space-y-reverse))"}};function _g(a,u){_g=function(h,C){return new E(h,void 0,C)};var p=gg(RegExp),s=RegExp.prototype,c=new WeakMap;function E(S,h,C){var R=p.call(this,S,h);return c.set(R,C||c.get(S)),R}EU(E,p),E.prototype.exec=function(S){var h=s.exec.call(this,S);return h&&(h.groups=m(h,this)),h},E.prototype[Symbol.replace]=function(S,h){if(typeof h=="string"){var C=c.get(this);return s[Symbol.replace].call(this,S,h.replace(/\$<([^>]+)>/g,function(I,b){return"$"+C[b]}))}else if(typeof h=="function"){var R=this;return s[Symbol.replace].call(this,S,function(){var I=[];return I.push.apply(I,arguments),typeof I[I.length-1]!="object"&&I.push(m(I,R)),h.apply(this,I)})}else return s[Symbol.replace].call(this,S,h)};function m(S,h){var C=c.get(h);return Object.keys(C).reduce(function(R,I){return R[I]=S[C[I]],R},Object.create(null))}return _g.apply(this,arguments)}function EU(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(u&&u.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),u&&Wl(a,u)}function gg(a){var u=typeof Map=="function"?new Map:void 0;return gg=function(s){if(s===null||!xU(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u!="undefined"){if(u.has(s))return u.get(s);u.set(s,c)}function c(){return kd(s,arguments,vg(this).constructor)}return c.prototype=Object.create(s.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),Wl(c,s)},gg(a)}function kd(a,u,p){return SU()?kd=Reflect.construct:kd=function(c,E,m){var S=[null];S.push.apply(S,E);var h=Function.bind.apply(c,S),C=new h;return m&&Wl(C,m.prototype),C},kd.apply(null,arguments)}function SU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function xU(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function Wl(a,u){return Wl=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},Wl(a,u)}function vg(a){return vg=Object.setPrototypeOf?Object.getPrototypeOf:function(p){return p.__proto__||Object.getPrototypeOf(p)},vg(a)}var bg={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},AU=new Set(Object.values(bg)),yA=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),PU=a=>a.trim();function CU(a,u){var p,s;if(a==null||yA.has(a))return a;var c=_g(/(^[\x2DA-Za-z]+)\(((.*))\)/g,{type:1,values:2}),{type:E,values:m}=(p=(s=c.exec(a))==null?void 0:s.groups)!=null?p:{};if(!E||!m)return a;var S=E.includes("-gradient")?E:E+"-gradient",[h,...C]=m.split(",").map(PU).filter(Boolean);if((C==null?void 0:C.length)===0)return a;var R=h in bg?bg[h]:h;C.unshift(R);var I=C.map(b=>{if(AU.has(b))return b;var f=b.indexOf(" "),[x,P]=f!==-1?[b.substr(0,f),b.substr(f+1)]:[b],A=TA(P)?P:P&&P.split(" "),T="colors."+x,_=T in u.__cssMap?u.__cssMap[T].varRef:x;return A?[_,A].join(" "):_});return S+"("+I.join(", ")+")"}var TA=a=>eg(a)&&a.includes("(")&&a.includes(")"),RU=(a,u)=>CU(a,u??{}),OU=a=>{var u=parseFloat(a.toString()),p=a.toString().replace(String(u),"");return{unitless:!p,value:u,unit:p}},Zi=a=>u=>a+"("+u+")",Cn={filter(a){return a!=="auto"?a:_U},backdropFilter(a){return a!=="auto"?a:gU},ring(a){return vU(Cn.px(a))},bgClip(a){return a==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:a}},transform(a){return a==="auto"?pU():a==="auto-gpu"?mU():a},px(a){if(a==null)return a;var{unitless:u}=OU(a);return u||Ua(a)?a+"px":a},fraction(a){return!Ua(a)||a>1?a:a*100+"%"},float(a,u){var p={left:"right",right:"left"};return u.direction==="rtl"?p[a]:a},degree(a){if(qx(a)||a==null)return a;var u=eg(a)&&!a.endsWith("deg");return Ua(a)||u?a+"deg":a},gradient:RU,blur:Zi("blur"),opacity:Zi("opacity"),brightness:Zi("brightness"),contrast:Zi("contrast"),dropShadow:Zi("drop-shadow"),grayscale:Zi("grayscale"),hueRotate:Zi("hue-rotate"),invert:Zi("invert"),saturate:Zi("saturate"),sepia:Zi("sepia"),bgImage(a){if(a==null)return a;var u=TA(a)||yA.has(a);return u?a:"url("+a+")"},outline(a){var u=String(a)==="0"||String(a)==="none";return a!==null&&u?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:a}},flexDirection(a){var u,{space:p,divide:s}=(u=bU[a])!=null?u:{},c={flexDirection:a};return p&&(c[p]=1),s&&(c[s]=1),c}};function yg(){return yg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},yg.apply(this,arguments)}var Ze={borderWidths:Ii("borderWidths"),borderStyles:Ii("borderStyles"),colors:Ii("colors"),borders:Ii("borders"),radii:Ii("radii",Cn.px),space:Ii("space",Cn.px),spaceT:Ii("space",Cn.px),degreeT(a){return{property:a,transform:Cn.degree}},prop(a,u,p){return yg({property:a,scale:u},u&&{transform:Hl({scale:u,transform:p})})},propT(a,u){return{property:a,transform:u}},sizes:Ii("sizes",Cn.px),sizesT:Ii("sizes",Cn.fraction),shadows:Ii("shadows"),logical:fU,blur:Ii("blur",Cn.blur)},jd={background:Ze.colors("background"),backgroundColor:Ze.colors("backgroundColor"),backgroundImage:Ze.propT("backgroundImage",Cn.bgImage),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Cn.bgClip},bgSize:Ze.prop("backgroundSize"),bgPosition:Ze.prop("backgroundPosition"),bg:Ze.colors("background"),bgColor:Ze.colors("backgroundColor"),bgPos:Ze.prop("backgroundPosition"),bgRepeat:Ze.prop("backgroundRepeat"),bgAttachment:Ze.prop("backgroundAttachment"),bgGradient:Ze.propT("backgroundImage",Cn.gradient),bgClip:{transform:Cn.bgClip}};Object.assign(jd,{bgImage:jd.backgroundImage,bgImg:jd.backgroundImage});var _n={border:Ze.borders("border"),borderWidth:Ze.borderWidths("borderWidth"),borderStyle:Ze.borderStyles("borderStyle"),borderColor:Ze.colors("borderColor"),borderRadius:Ze.radii("borderRadius"),borderTop:Ze.borders("borderTop"),borderBlockStart:Ze.borders("borderBlockStart"),borderTopLeftRadius:Ze.radii("borderTopLeftRadius"),borderStartStartRadius:Ze.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ze.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ze.radii("borderTopRightRadius"),borderStartEndRadius:Ze.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ze.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ze.borders("borderRight"),borderInlineEnd:Ze.borders("borderInlineEnd"),borderBottom:Ze.borders("borderBottom"),borderBlockEnd:Ze.borders("borderBlockEnd"),borderBottomLeftRadius:Ze.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ze.radii("borderBottomRightRadius"),borderLeft:Ze.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ze.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ze.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ze.borders(["borderLeft","borderRight"]),borderInline:Ze.borders("borderInline"),borderY:Ze.borders(["borderTop","borderBottom"]),borderBlock:Ze.borders("borderBlock"),borderTopWidth:Ze.borderWidths("borderTopWidth"),borderBlockStartWidth:Ze.borderWidths("borderBlockStartWidth"),borderTopColor:Ze.colors("borderTopColor"),borderBlockStartColor:Ze.colors("borderBlockStartColor"),borderTopStyle:Ze.borderStyles("borderTopStyle"),borderBlockStartStyle:Ze.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ze.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ze.borderWidths("borderBlockEndWidth"),borderBottomColor:Ze.colors("borderBottomColor"),borderBlockEndColor:Ze.colors("borderBlockEndColor"),borderBottomStyle:Ze.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ze.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ze.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ze.borderWidths("borderInlineStartWidth"),borderLeftColor:Ze.colors("borderLeftColor"),borderInlineStartColor:Ze.colors("borderInlineStartColor"),borderLeftStyle:Ze.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ze.borderStyles("borderInlineStartStyle"),borderRightWidth:Ze.borderWidths("borderRightWidth"),borderInlineEndWidth:Ze.borderWidths("borderInlineEndWidth"),borderRightColor:Ze.colors("borderRightColor"),borderInlineEndColor:Ze.colors("borderInlineEndColor"),borderRightStyle:Ze.borderStyles("borderRightStyle"),borderInlineEndStyle:Ze.borderStyles("borderInlineEndStyle"),borderTopRadius:Ze.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ze.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ze.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ze.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(_n,{rounded:_n.borderRadius,roundedTop:_n.borderTopRadius,roundedTopLeft:_n.borderTopLeftRadius,roundedTopRight:_n.borderTopRightRadius,roundedTopStart:_n.borderStartStartRadius,roundedTopEnd:_n.borderStartEndRadius,roundedBottom:_n.borderBottomRadius,roundedBottomLeft:_n.borderBottomLeftRadius,roundedBottomRight:_n.borderBottomRightRadius,roundedBottomStart:_n.borderEndStartRadius,roundedBottomEnd:_n.borderEndEndRadius,roundedLeft:_n.borderLeftRadius,roundedRight:_n.borderRightRadius,roundedStart:_n.borderInlineStartRadius,roundedEnd:_n.borderInlineEndRadius,borderStart:_n.borderInlineStart,borderEnd:_n.borderInlineEnd,borderTopStartRadius:_n.borderStartStartRadius,borderTopEndRadius:_n.borderStartEndRadius,borderBottomStartRadius:_n.borderEndStartRadius,borderBottomEndRadius:_n.borderEndEndRadius,borderStartRadius:_n.borderInlineStartRadius,borderEndRadius:_n.borderInlineEndRadius,borderStartWidth:_n.borderInlineStartWidth,borderEndWidth:_n.borderInlineEndWidth,borderStartColor:_n.borderInlineStartColor,borderEndColor:_n.borderInlineEndColor,borderStartStyle:_n.borderInlineStartStyle,borderEndStyle:_n.borderInlineEndStyle});var MU={color:Ze.colors("color"),textColor:Ze.colors("color"),fill:Ze.colors("fill"),stroke:Ze.colors("stroke")},Tg={boxShadow:Ze.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ze.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ze.prop("backgroundBlendMode"),opacity:!0};Object.assign(Tg,{shadow:Tg.boxShadow});var IU={filter:{transform:Cn.filter},blur:Ze.blur("--chakra-blur"),brightness:Ze.propT("--chakra-brightness",Cn.brightness),contrast:Ze.propT("--chakra-contrast",Cn.contrast),hueRotate:Ze.degreeT("--chakra-hue-rotate"),invert:Ze.propT("--chakra-invert",Cn.invert),saturate:Ze.propT("--chakra-saturate",Cn.saturate),dropShadow:Ze.propT("--chakra-drop-shadow",Cn.dropShadow),backdropFilter:{transform:Cn.backdropFilter},backdropBlur:Ze.blur("--chakra-backdrop-blur"),backdropBrightness:Ze.propT("--chakra-backdrop-brightness",Cn.brightness),backdropContrast:Ze.propT("--chakra-backdrop-contrast",Cn.contrast),backdropHueRotate:Ze.degreeT("--chakra-backdrop-hue-rotate"),backdropInvert:Ze.propT("--chakra-backdrop-invert",Cn.invert),backdropSaturate:Ze.propT("--chakra-backdrop-saturate",Cn.saturate)},zd={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Cn.flexDirection},experimental_spaceX:{static:yU,transform:Hl({scale:"space",transform:a=>a!==null?{"--chakra-space-x":a}:null})},experimental_spaceY:{static:TU,transform:Hl({scale:"space",transform:a=>a!=null?{"--chakra-space-y":a}:null})},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ze.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0};Object.assign(zd,{flexDir:zd.flexDirection});var EA={gridGap:Ze.space("gridGap"),gridColumnGap:Ze.space("gridColumnGap"),gridRowGap:Ze.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},DU={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Cn.outline},outlineOffset:!0,outlineColor:Ze.colors("outlineColor")},gi={width:Ze.sizesT("width"),inlineSize:Ze.sizesT("inlineSize"),height:Ze.sizes("height"),blockSize:Ze.sizes("blockSize"),boxSize:Ze.sizes(["width","height"]),minWidth:Ze.sizes("minWidth"),minInlineSize:Ze.sizes("minInlineSize"),minHeight:Ze.sizes("minHeight"),minBlockSize:Ze.sizes("minBlockSize"),maxWidth:Ze.sizes("maxWidth"),maxInlineSize:Ze.sizes("maxInlineSize"),maxHeight:Ze.sizes("maxHeight"),maxBlockSize:Ze.sizes("maxBlockSize"),d:Ze.prop("display"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ze.propT("float",Cn.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(gi,{w:gi.width,h:gi.height,minW:gi.minWidth,maxW:gi.maxWidth,minH:gi.minHeight,maxH:gi.maxHeight,overscroll:gi.overscrollBehavior,overscrollX:gi.overscrollBehaviorX,overscrollY:gi.overscrollBehaviorY});var wU={listStyleType:!0,listStylePosition:!0,listStylePos:Ze.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ze.prop("listStyleImage")},LU={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},NU={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},Eg=(a,u,p)=>{var s={},c=Id(a,u,{});for(var E in c){var m=E in p&&p[E]!=null;m||(s[E]=c[E])}return s},FU={srOnly:{transform(a){return a===!0?LU:a==="focusable"?NU:{}}},layerStyle:{processResult:!0,transform:(a,u,p)=>Eg(u,"layerStyles."+a,p)},textStyle:{processResult:!0,transform:(a,u,p)=>Eg(u,"textStyles."+a,p)},apply:{processResult:!0,transform:(a,u,p)=>Eg(u,a,p)}},Xl={position:!0,pos:Ze.prop("position"),zIndex:Ze.prop("zIndex","zIndices"),inset:Ze.spaceT(["top","right","bottom","left"]),insetX:Ze.spaceT(["left","right"]),insetInline:Ze.spaceT("insetInline"),insetY:Ze.spaceT(["top","bottom"]),insetBlock:Ze.spaceT("insetBlock"),top:Ze.spaceT("top"),insetBlockStart:Ze.spaceT("insetBlockStart"),bottom:Ze.spaceT("bottom"),insetBlockEnd:Ze.spaceT("insetBlockEnd"),left:Ze.spaceT("left"),insetInlineStart:Ze.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ze.spaceT("right"),insetInlineEnd:Ze.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Xl,{insetStart:Xl.insetInlineStart,insetEnd:Xl.insetInlineEnd});var BU={ring:{transform:Cn.ring},ringColor:Ze.colors("--chakra-ring-color"),ringOffset:Ze.prop("--chakra-ring-offset-width"),ringOffsetColor:Ze.colors("--chakra-ring-offset-color"),ringInset:Ze.prop("--chakra-ring-inset")},Bn={margin:Ze.spaceT("margin"),marginTop:Ze.spaceT("marginTop"),marginBlockStart:Ze.spaceT("marginBlockStart"),marginRight:Ze.spaceT("marginRight"),marginInlineEnd:Ze.spaceT("marginInlineEnd"),marginBottom:Ze.spaceT("marginBottom"),marginBlockEnd:Ze.spaceT("marginBlockEnd"),marginLeft:Ze.spaceT("marginLeft"),marginInlineStart:Ze.spaceT("marginInlineStart"),marginX:Ze.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ze.spaceT("marginInline"),marginY:Ze.spaceT(["marginTop","marginBottom"]),marginBlock:Ze.spaceT("marginBlock"),padding:Ze.space("padding"),paddingTop:Ze.space("paddingTop"),paddingBlockStart:Ze.space("paddingBlockStart"),paddingRight:Ze.space("paddingRight"),paddingBottom:Ze.space("paddingBottom"),paddingBlockEnd:Ze.space("paddingBlockEnd"),paddingLeft:Ze.space("paddingLeft"),paddingInlineStart:Ze.space("paddingInlineStart"),paddingInlineEnd:Ze.space("paddingInlineEnd"),paddingX:Ze.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ze.space("paddingInline"),paddingY:Ze.space(["paddingTop","paddingBottom"]),paddingBlock:Ze.space("paddingBlock")};Object.assign(Bn,{m:Bn.margin,mt:Bn.marginTop,mr:Bn.marginRight,me:Bn.marginInlineEnd,marginEnd:Bn.marginInlineEnd,mb:Bn.marginBottom,ml:Bn.marginLeft,ms:Bn.marginInlineStart,marginStart:Bn.marginInlineStart,mx:Bn.marginX,my:Bn.marginY,p:Bn.padding,pt:Bn.paddingTop,py:Bn.paddingY,px:Bn.paddingX,pb:Bn.paddingBottom,pl:Bn.paddingLeft,ps:Bn.paddingInlineStart,paddingStart:Bn.paddingInlineStart,pr:Bn.paddingRight,pe:Bn.paddingInlineEnd,paddingEnd:Bn.paddingInlineEnd});var UU={textDecorationColor:Ze.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ze.shadows("textShadow")},VU={clipPath:!0,transform:Ze.propT("transform",Cn.transform),transformOrigin:!0,translateX:Ze.spaceT("--chakra-translate-x"),translateY:Ze.spaceT("--chakra-translate-y"),skewX:Ze.degreeT("--chakra-skew-x"),skewY:Ze.degreeT("--chakra-skew-y"),scaleX:Ze.prop("--chakra-scale-x"),scaleY:Ze.prop("--chakra-scale-y"),scale:Ze.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ze.degreeT("--chakra-rotate")},kU={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ze.prop("transitionDuration","transition.duration"),transitionProperty:Ze.prop("transitionProperty","transition.property"),transitionTimingFunction:Ze.prop("transitionTimingFunction","transition.easing")},jU={fontFamily:Ze.prop("fontFamily","fonts"),fontSize:Ze.prop("fontSize","fontSizes",Cn.px),fontWeight:Ze.prop("fontWeight","fontWeights"),lineHeight:Ze.prop("lineHeight","lineHeights"),letterSpacing:Ze.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"},isTruncated:{transform(a){if(a===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}},ec={hover:a=>a+":hover &, "+a+"[data-hover] &",focus:a=>a+":focus &, "+a+"[data-focus] &",active:a=>a+":active &, "+a+"[data-active] &",disabled:a=>a+":disabled &, "+a+"[data-disabled] &",invalid:a=>a+":invalid &, "+a+"[data-invalid] &",checked:a=>a+":checked &, "+a+"[data-checked] &",indeterminate:a=>a+":indeterminate &, "+a+"[aria-checked=mixed] &, "+a+"[data-indeterminate] &",readOnly:a=>a+":read-only &, "+a+"[readonly] &, "+a+"[data-read-only] &",expanded:a=>a+":read-only &, "+a+"[aria-expanded=true] &, "+a+"[data-expanded] &"},tc=a=>zU(a,"[role=group]","[data-group]",".group"),zU=function(u){for(var p=arguments.length,s=new Array(p>1?p-1:0),c=1;c<p;c++)s[c-1]=arguments[c];return s.map(u).join(", ")},Sg={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible",_disabled:"&[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:tc(ec.hover),_groupFocus:tc(ec.focus),_groupActive:tc(ec.active),_groupDisabled:tc(ec.disabled),_groupInvalid:tc(ec.invalid),_groupChecked:tc(ec.checked),_placeholder:"&::placeholder",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &",_mediaDark:"@media (prefers-color-scheme: dark)",_dark:".chakra-ui-dark &, [data-theme=dark] &, &[data-theme=dark]",_light:".chakra-ui-light &, [data-theme=light] &, &[data-theme=light]"},GU=wd(Sg);function xg(){return xg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},xg.apply(this,arguments)}var Ag=go({},jd,_n,MU,zd,gi,IU,BU,DU,EA,FU,Xl,Tg,Bn,jU,UU,VU,wU,kU),HU=Object.assign({},Bn,gi,zd,EA,Xl),WU=wd(HU),XU=[...wd(Ag),...GU],YU=xg({},Ag,Sg),KU=a=>a in YU,QU=a=>u=>{if(!u.__breakpoints)return a;var{isResponsive:p,toArrayValue:s,media:c}=u.__breakpoints,E={};for(var m in a){var S=Qi(a[m],u);if(S!=null){if(S=Mi(S)&&p(S)?s(S):S,!Array.isArray(S)){E[m]=S;continue}for(var h=S.slice(0,c.length).length,C=0;C<h;C+=1){var R=c==null?void 0:c[C];if(!R){E[m]=S[C];continue}E[R]=E[R]||{},S[C]!=null&&(E[R][m]=S[C])}}}return E},qU=(a,u)=>a.startsWith("--")&&eg(u)&&!qx(u),ZU=(a,u)=>{var p,s;if(u==null)return u;var c=C=>{var R,I;return(R=a.__cssMap)==null||(I=R[C])==null?void 0:I.varRef},E=C=>{var R;return(R=c(C))!=null?R:C},m=u.split(",").map(C=>C.trim()),[S,h]=m;return u=(p=(s=c(S))!=null?s:E(h))!=null?p:E(u),u};function $U(a){var{configs:u={},pseudos:p={},theme:s}=a,c=function E(m,S){S===void 0&&(S=!1);var h=Qi(m,s),C=QU(h)(s),R={};for(var I in C){var b,f,x,P,A,T=C[I],_=Qi(T,s);I in p&&(I=p[I]),qU(I,_)&&(_=ZU(s,_));var g=u[I];if(g===!0&&(g={property:I}),Mi(_)){var M;R[I]=(M=R[I])!=null?M:{},R[I]=go({},R[I],E(_,!0));continue}var O=(b=(f=g)==null||f.transform==null?void 0:f.transform(_,s,h))!=null?b:_;O=(x=g)!=null&&x.processResult?E(O,!0):O;var N=Qi((P=g)==null?void 0:P.property,s);if(!S&&(A=g)!=null&&A.static){var V=Qi(g.static,s);R=go({},R,V)}if(N&&Array.isArray(N)){for(var U of N)R[U]=O;continue}if(N){N==="&"&&Mi(O)?R=go({},R,O):R[N]=O;continue}if(Mi(O)){R=go({},R,O);continue}R[I]=O}return R};return c}var SA=a=>u=>{var p=$U({theme:u,pseudos:Sg,configs:Ag});return p(a)};function xA(a){return Mi(a)&&a.reference?a.reference:String(a)}var Gd=function(u){for(var p=arguments.length,s=new Array(p>1?p-1:0),c=1;c<p;c++)s[c-1]=arguments[c];return s.map(xA).join(" "+u+" ").replace(/calc/g,"")},AA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Gd("+",...p)+")"},PA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Gd("-",...p)+")"},Pg=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Gd("*",...p)+")"},CA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Gd("/",...p)+")"},RA=a=>{var u=xA(a);return u!=null&&!Number.isNaN(parseFloat(u))?String(u).startsWith("-")?String(u).slice(1):"-"+u:Pg(u,-1)},Va=Object.assign(a=>({add:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return Va(AA(a,...s))},subtract:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return Va(PA(a,...s))},multiply:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return Va(Pg(a,...s))},divide:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return Va(CA(a,...s))},negate:()=>Va(RA(a)),toString:()=>a.toString()}),{add:AA,subtract:PA,multiply:Pg,divide:CA,negate:RA});function JU(a,u){return u===void 0&&(u="-"),a.replace(/\s+/g,u)}function OA(a){var u=JU(a.toString());if(u.includes("\\."))return a;var p=!Number.isInteger(parseFloat(a.toString()));return p?u.replace(".","\\."):a}function eV(a,u){return u===void 0&&(u=""),[u,OA(a)].filter(Boolean).join("-")}function tV(a,u){return"var("+OA(a)+(u?", "+u:"")+")"}function nV(a,u){return u===void 0&&(u=""),"--"+eV(a,u)}function MA(a,u,p){var s=nV(a,p);return{variable:s,reference:tV(s,u)}}function Cg(){return Cg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Cg.apply(this,arguments)}function rV(a,u){var p={cssMap:{},cssVars:{}};return z2(a,(s,c)=>{var E,[m]=c,S=(E=Rg[m])!=null?E:Rg.defaultHandler,{cssVars:h,cssMap:C}=S(c,s,u);Object.assign(p.cssVars,h),Object.assign(p.cssMap,C)}),p}var Rg={space:(a,u,p)=>{var s=Rg.defaultHandler(a,u,p),[c,...E]=a,m=c+".-"+E.join("."),S=a.join("-"),{variable:h,reference:C}=MA(S,void 0,p.cssVarPrefix),R=Va.negate(u),I=Va.negate(C);return{cssVars:s.cssVars,cssMap:Cg({},s.cssMap,{[m]:{value:""+R,var:""+h,varRef:I}})}},defaultHandler:(a,u,p)=>{var s=a.join("."),c=a.join("-"),{variable:E,reference:m}=MA(c,void 0,p.cssVarPrefix);return{cssVars:{[E]:u},cssMap:{[s]:{value:u,var:E,varRef:m}}}}};function iV(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var oV=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur"];function aV(a){var u=oV;return p2(a,u)}function sV(a){var u=iV(a,["__cssMap","__cssVars","__breakpoints"]);return u}function Og(){return Og=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Og.apply(this,arguments)}function cV(a){var u,p=sV(a),s=aV(p),c=(u=p.config)==null?void 0:u.cssVarPrefix,{cssMap:E,cssVars:m}=rV(s,{cssVarPrefix:c}),S={"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"};return Object.assign(p,{__cssVars:Og({},S,m),__cssMap:E,__breakpoints:E2(p.breakpoints)}),p}var lV=typeof Element!="undefined",uV=typeof Map=="function",hV=typeof Set=="function",dV=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Hd(a,u){if(a===u)return!0;if(a&&u&&typeof a=="object"&&typeof u=="object"){if(a.constructor!==u.constructor)return!1;var p,s,c;if(Array.isArray(a)){if(p=a.length,p!=u.length)return!1;for(s=p;s--!=0;)if(!Hd(a[s],u[s]))return!1;return!0}var E;if(uV&&a instanceof Map&&u instanceof Map){if(a.size!==u.size)return!1;for(E=a.entries();!(s=E.next()).done;)if(!u.has(s.value[0]))return!1;for(E=a.entries();!(s=E.next()).done;)if(!Hd(s.value[1],u.get(s.value[0])))return!1;return!0}if(hV&&a instanceof Set&&u instanceof Set){if(a.size!==u.size)return!1;for(E=a.entries();!(s=E.next()).done;)if(!u.has(s.value[0]))return!1;return!0}if(dV&&ArrayBuffer.isView(a)&&ArrayBuffer.isView(u)){if(p=a.length,p!=u.length)return!1;for(s=p;s--!=0;)if(a[s]!==u[s])return!1;return!0}if(a.constructor===RegExp)return a.source===u.source&&a.flags===u.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===u.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===u.toString();if(c=Object.keys(a),p=c.length,p!==Object.keys(u).length)return!1;for(s=p;s--!=0;)if(!Object.prototype.hasOwnProperty.call(u,c[s]))return!1;if(lV&&a instanceof Element)return!1;for(s=p;s--!=0;)if(!((c[s]==="_owner"||c[s]==="__v"||c[s]==="__o")&&a.$$typeof)&&!Hd(a[c[s]],u[c[s]]))return!1;return!0}return a!==a&&u!==u}var fV=function(u,p){try{return Hd(u,p)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}},pV=a=>{var{cssVarsRoot:u=":host, :root",theme:p,children:s}=a,c=Hn(()=>cV(p),[p]);return $e(Xx,{theme:c},$e(Md,{styles:E=>({[u]:E.__cssVars})}),s)};function IA(){var a=cn(Yi);if(!a)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return a}var[DA,oa]=ia({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "}),mV=()=>{var{colorMode:a}=_A();return $e(Md,{styles:u=>{var p=Id(u,"styles.global"),s=Qi(p,{theme:u,colorMode:a});if(!!s){var c=SA(s)(u);return c}}})},_V=["a","b","article","aside","blockquote","button","caption","cite","circle","code","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","img","input","kbd","label","li","main","mark","nav","ol","p","path","pre","q","rect","s","svg","section","select","strong","small","span","sub","sup","table","tbody","td","textarea","tfoot","th","thead","tr","ul"];function aa(a){return Zx(a,["styleConfig","size","variant","colorScheme"])}function Mg(){return Mg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Mg.apply(this,arguments)}function gV(){var a=_A(),u=IA();return Mg({},a,{theme:u})}var vV=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,bV=wx(function(a){return vV.test(a)||a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)<91}),yV=bV,TV=function(u){return u!=="theme"},wA=function(u){return typeof u=="string"&&u.charCodeAt(0)>96?yV:TV},LA=function(u,p,s){var c;if(p){var E=p.shouldForwardProp;c=u.__emotion_forwardProp&&E?function(m){return u.__emotion_forwardProp(m)&&E(m)}:E}return typeof c!="function"&&s&&(c=u.__emotion_forwardProp),c},EV=function a(u,p){var s=u.__emotion_real===u,c=s&&u.__emotion_base||u,E,m;p!==void 0&&(E=p.label,m=p.target);var S=LA(u,p,s),h=S||wA(c),C=!h("as");return function(){var R=arguments,I=s&&u.__emotion_styles!==void 0?u.__emotion_styles.slice(0):[];if(E!==void 0&&I.push("label:"+E+";"),R[0]==null||R[0].raw===void 0)I.push.apply(I,R);else{I.push(R[0][0]);for(var b=R.length,f=1;f<b;f++)I.push(R[f],R[0][f])}var x=Ul(function(P,A,T){var _=C&&P.as||c,g="",M=[],O=P;if(P.theme==null){O={};for(var N in P)O[N]=P[N];O.theme=cn(Yi)}typeof P.className=="string"?g=Y_(A.registered,M,P.className):P.className!=null&&(g=P.className+" ");var V=Bl(I.concat(M),A.registered,O);Od(A,V,typeof _=="string"),g+=A.key+"-"+V.name,m!==void 0&&(g+=" "+m);var U=C&&S===void 0?wA(_):h,L={};for(var j in P)C&&j==="as"||U(j)&&(L[j]=P[j]);L.className=g,L.ref=T;var Y=$e(_,L);return Y});return x.displayName=E!==void 0?E:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",x.defaultProps=u.defaultProps,x.__emotion_real=x,x.__emotion_base=c,x.__emotion_styles=I,x.__emotion_forwardProp=S,Object.defineProperty(x,"toString",{value:function(){return"."+m}}),x.withComponent=function(P,A){return a(P,ra({},p,A,{shouldForwardProp:LA(x,A,!0)})).apply(void 0,I)},x}},SV=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Ig=EV.bind();SV.forEach(function(a){Ig[a]=Ig(a)});var xV=new Set([...XU,"textStyle","layerStyle","apply","isTruncated","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),AV=new Set(["htmlWidth","htmlHeight","htmlSize"]),PV=a=>AV.has(a)||!xV.has(a);function NA(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var CV=a=>{var{baseStyle:u}=a;return p=>{var{css:s,__css:c,sx:E}=p,m=NA(p,["theme","css","__css","sx"]),S=$x(m,(I,b)=>KU(b)),h=Qi(u,p),C=Object.assign({},c,h,Dd(S),E),R=SA(C)(p.theme);return s?[R,s]:R}};function RV(a,u){var p=u??{},{baseStyle:s}=p,c=NA(p,["baseStyle"]);c.shouldForwardProp||(c.shouldForwardProp=PV);var E=CV({baseStyle:s});return Ig(a,c)(E)}var on=RV;_V.forEach(a=>{on[a]=on(a)});function Ln(a){return Ci(a)}function OV(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Yl(a,u,p){var s;u===void 0&&(u={}),p===void 0&&(p={});var{styleConfig:c}=u,E=OV(u,["styleConfig"]),{theme:m,colorMode:S}=gV(),h=Id(m,"components."+a),C=c||h,R=go({theme:m,colorMode:S},(s=C==null?void 0:C.defaultProps)!=null?s:{},Dd(Zx(E,["children"]))),I=zt({});if(C){var b,f,x,P,A,T,_=Qi((b=C.baseStyle)!=null?b:{},R),g=Qi((f=(x=C.variants)==null?void 0:x[R.variant])!=null?f:{},R),M=Qi((P=(A=C.sizes)==null?void 0:A[R.size])!=null?P:{},R),O=go({},_,M,g);(T=p)!=null&&T.isMultiPart&&C.parts&&C.parts.forEach(V=>{var U;O[V]=(U=O[V])!=null?U:{}});var N=fV(I.current,O);N||(I.current=O)}return I.current}function Kl(a,u){return Yl(a,u,{isMultiPart:!0})}var MV={body:{classList:{add(){},remove(){}}},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}}},FA=MV,nc=()=>{},IV={document:FA,navigator:{userAgent:""},CustomEvent:function(){return this},addEventListener:nc,removeEventListener:nc,getComputedStyle(){return{getPropertyValue(){return""}}},matchMedia(){return{matches:!1,addListener:nc,removeListener:nc}},requestAnimationFrame(a){return typeof setTimeout=="undefined"?(a(),null):setTimeout(a,0)},cancelAnimationFrame(a){typeof setTimeout!="undefined"&&clearTimeout(a)},setTimeout:()=>0,clearTimeout:nc,setInterval:()=>0,clearInterval:nc},DV=IV,wV={window:DV,document:FA},BA=qs?{window,document}:wV,LV=Er(BA);function NV(a){var{children:u,environment:p}=a,[s,c]=ln(null),E=Hn(()=>{var S,h=s==null?void 0:s.ownerDocument,C=s==null?void 0:s.ownerDocument.defaultView,R=h?{document:h,window:C}:void 0,I=(S=p??R)!=null?S:BA;return I},[s,p]),m=!s&&!p;return Jr.createElement(LV.Provider,{value:E},u,m&&Jr.createElement("span",{ref:S=>{S&&c(S)}}))}var FV=a=>{var{children:u,colorModeManager:p,portalZIndex:s,resetCSS:c=!0,theme:E={},environment:m,cssVarsRoot:S}=a,h=$e(NV,{environment:m},u);return $e(K2,null,$e(pV,{theme:E,cssVarsRoot:S},$e(gA,{colorModeManager:p,options:E.config},c&&$e(h2,null),$e(mV,null),s?$e(cA,{zIndex:s},h):h)))},UA={exports:{}};(function(a){(function(u){var p=/^\s+/,s=/\s+$/,c=0,E=u.round,m=u.min,S=u.max,h=u.random;function C(ce,de){if(ce=ce||"",de=de||{},ce instanceof C)return ce;if(!(this instanceof C))return new C(ce,de);var ne=R(ce);this._originalInput=ce,this._r=ne.r,this._g=ne.g,this._b=ne.b,this._a=ne.a,this._roundA=E(100*this._a)/100,this._format=de.format||ne.format,this._gradientType=de.gradientType,this._r<1&&(this._r=E(this._r)),this._g<1&&(this._g=E(this._g)),this._b<1&&(this._b=E(this._b)),this._ok=ne.ok,this._tc_id=c++}C.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var ce=this.toRgb();return(ce.r*299+ce.g*587+ce.b*114)/1e3},getLuminance:function(){var ce=this.toRgb(),de,ne,pe,Se,Te,Ne;return de=ce.r/255,ne=ce.g/255,pe=ce.b/255,de<=.03928?Se=de/12.92:Se=u.pow((de+.055)/1.055,2.4),ne<=.03928?Te=ne/12.92:Te=u.pow((ne+.055)/1.055,2.4),pe<=.03928?Ne=pe/12.92:Ne=u.pow((pe+.055)/1.055,2.4),.2126*Se+.7152*Te+.0722*Ne},setAlpha:function(ce){return this._a=Z(ce),this._roundA=E(100*this._a)/100,this},toHsv:function(){var ce=x(this._r,this._g,this._b);return{h:ce.h*360,s:ce.s,v:ce.v,a:this._a}},toHsvString:function(){var ce=x(this._r,this._g,this._b),de=E(ce.h*360),ne=E(ce.s*100),pe=E(ce.v*100);return this._a==1?"hsv("+de+", "+ne+"%, "+pe+"%)":"hsva("+de+", "+ne+"%, "+pe+"%, "+this._roundA+")"},toHsl:function(){var ce=b(this._r,this._g,this._b);return{h:ce.h*360,s:ce.s,l:ce.l,a:this._a}},toHslString:function(){var ce=b(this._r,this._g,this._b),de=E(ce.h*360),ne=E(ce.s*100),pe=E(ce.l*100);return this._a==1?"hsl("+de+", "+ne+"%, "+pe+"%)":"hsla("+de+", "+ne+"%, "+pe+"%, "+this._roundA+")"},toHex:function(ce){return A(this._r,this._g,this._b,ce)},toHexString:function(ce){return"#"+this.toHex(ce)},toHex8:function(ce){return T(this._r,this._g,this._b,this._a,ce)},toHex8String:function(ce){return"#"+this.toHex8(ce)},toRgb:function(){return{r:E(this._r),g:E(this._g),b:E(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+E(this._r)+", "+E(this._g)+", "+E(this._b)+")":"rgba("+E(this._r)+", "+E(this._g)+", "+E(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:E(J(this._r,255)*100)+"%",g:E(J(this._g,255)*100)+"%",b:E(J(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+E(J(this._r,255)*100)+"%, "+E(J(this._g,255)*100)+"%, "+E(J(this._b,255)*100)+"%)":"rgba("+E(J(this._r,255)*100)+"%, "+E(J(this._g,255)*100)+"%, "+E(J(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:ue[A(this._r,this._g,this._b,!0)]||!1},toFilter:function(ce){var de="#"+_(this._r,this._g,this._b,this._a),ne=de,pe=this._gradientType?"GradientType = 1, ":"";if(ce){var Se=C(ce);ne="#"+_(Se._r,Se._g,Se._b,Se._a)}return"progid:DXImageTransform.Microsoft.gradient("+pe+"startColorstr="+de+",endColorstr="+ne+")"},toString:function(ce){var de=!!ce;ce=ce||this._format;var ne=!1,pe=this._a<1&&this._a>=0,Se=!de&&pe&&(ce==="hex"||ce==="hex6"||ce==="hex3"||ce==="hex4"||ce==="hex8"||ce==="name");return Se?ce==="name"&&this._a===0?this.toName():this.toRgbString():(ce==="rgb"&&(ne=this.toRgbString()),ce==="prgb"&&(ne=this.toPercentageRgbString()),(ce==="hex"||ce==="hex6")&&(ne=this.toHexString()),ce==="hex3"&&(ne=this.toHexString(!0)),ce==="hex4"&&(ne=this.toHex8String(!0)),ce==="hex8"&&(ne=this.toHex8String()),ce==="name"&&(ne=this.toName()),ce==="hsl"&&(ne=this.toHslString()),ce==="hsv"&&(ne=this.toHsvString()),ne||this.toHexString())},clone:function(){return C(this.toString())},_applyModification:function(ce,de){var ne=ce.apply(null,[this].concat([].slice.call(de)));return this._r=ne._r,this._g=ne._g,this._b=ne._b,this.setAlpha(ne._a),this},lighten:function(){return this._applyModification(N,arguments)},brighten:function(){return this._applyModification(V,arguments)},darken:function(){return this._applyModification(U,arguments)},desaturate:function(){return this._applyModification(g,arguments)},saturate:function(){return this._applyModification(M,arguments)},greyscale:function(){return this._applyModification(O,arguments)},spin:function(){return this._applyModification(L,arguments)},_applyCombination:function(ce,de){return ce.apply(null,[this].concat([].slice.call(de)))},analogous:function(){return this._applyCombination(re,arguments)},complement:function(){return this._applyCombination(j,arguments)},monochromatic:function(){return this._applyCombination(ye,arguments)},splitcomplement:function(){return this._applyCombination(ie,arguments)},triad:function(){return this._applyCombination(Y,arguments)},tetrad:function(){return this._applyCombination(W,arguments)}},C.fromRatio=function(ce,de){if(typeof ce=="object"){var ne={};for(var pe in ce)ce.hasOwnProperty(pe)&&(pe==="a"?ne[pe]=ce[pe]:ne[pe]=q(ce[pe]));ce=ne}return C(ce,de)};function R(ce){var de={r:0,g:0,b:0},ne=1,pe=null,Se=null,Te=null,Ne=!1,je=!1;return typeof ce=="string"&&(ce=te(ce)),typeof ce=="object"&&(Q(ce.r)&&Q(ce.g)&&Q(ce.b)?(de=I(ce.r,ce.g,ce.b),Ne=!0,je=String(ce.r).substr(-1)==="%"?"prgb":"rgb"):Q(ce.h)&&Q(ce.s)&&Q(ce.v)?(pe=q(ce.s),Se=q(ce.v),de=P(ce.h,pe,Se),Ne=!0,je="hsv"):Q(ce.h)&&Q(ce.s)&&Q(ce.l)&&(pe=q(ce.s),Te=q(ce.l),de=f(ce.h,pe,Te),Ne=!0,je="hsl"),ce.hasOwnProperty("a")&&(ne=ce.a)),ne=Z(ne),{ok:Ne,format:ce.format||je,r:m(255,S(de.r,0)),g:m(255,S(de.g,0)),b:m(255,S(de.b,0)),a:ne}}function I(ce,de,ne){return{r:J(ce,255)*255,g:J(de,255)*255,b:J(ne,255)*255}}function b(ce,de,ne){ce=J(ce,255),de=J(de,255),ne=J(ne,255);var pe=S(ce,de,ne),Se=m(ce,de,ne),Te,Ne,je=(pe+Se)/2;if(pe==Se)Te=Ne=0;else{var Xe=pe-Se;switch(Ne=je>.5?Xe/(2-pe-Se):Xe/(pe+Se),pe){case ce:Te=(de-ne)/Xe+(de<ne?6:0);break;case de:Te=(ne-ce)/Xe+2;break;case ne:Te=(ce-de)/Xe+4;break}Te/=6}return{h:Te,s:Ne,l:je}}function f(ce,de,ne){var pe,Se,Te;ce=J(ce,360),de=J(de,100),ne=J(ne,100);function Ne(Ye,Ke,nt){return nt<0&&(nt+=1),nt>1&&(nt-=1),nt<1/6?Ye+(Ke-Ye)*6*nt:nt<1/2?Ke:nt<2/3?Ye+(Ke-Ye)*(2/3-nt)*6:Ye}if(de===0)pe=Se=Te=ne;else{var je=ne<.5?ne*(1+de):ne+de-ne*de,Xe=2*ne-je;pe=Ne(Xe,je,ce+1/3),Se=Ne(Xe,je,ce),Te=Ne(Xe,je,ce-1/3)}return{r:pe*255,g:Se*255,b:Te*255}}function x(ce,de,ne){ce=J(ce,255),de=J(de,255),ne=J(ne,255);var pe=S(ce,de,ne),Se=m(ce,de,ne),Te,Ne,je=pe,Xe=pe-Se;if(Ne=pe===0?0:Xe/pe,pe==Se)Te=0;else{switch(pe){case ce:Te=(de-ne)/Xe+(de<ne?6:0);break;case de:Te=(ne-ce)/Xe+2;break;case ne:Te=(ce-de)/Xe+4;break}Te/=6}return{h:Te,s:Ne,v:je}}function P(ce,de,ne){ce=J(ce,360)*6,de=J(de,100),ne=J(ne,100);var pe=u.floor(ce),Se=ce-pe,Te=ne*(1-de),Ne=ne*(1-Se*de),je=ne*(1-(1-Se)*de),Xe=pe%6,Ye=[ne,Ne,Te,Te,je,ne][Xe],Ke=[je,ne,ne,Ne,Te,Te][Xe],nt=[Te,Te,je,ne,ne,Ne][Xe];return{r:Ye*255,g:Ke*255,b:nt*255}}function A(ce,de,ne,pe){var Se=[se(E(ce).toString(16)),se(E(de).toString(16)),se(E(ne).toString(16))];return pe&&Se[0].charAt(0)==Se[0].charAt(1)&&Se[1].charAt(0)==Se[1].charAt(1)&&Se[2].charAt(0)==Se[2].charAt(1)?Se[0].charAt(0)+Se[1].charAt(0)+Se[2].charAt(0):Se.join("")}function T(ce,de,ne,pe,Se){var Te=[se(E(ce).toString(16)),se(E(de).toString(16)),se(E(ne).toString(16)),se(H(pe))];return Se&&Te[0].charAt(0)==Te[0].charAt(1)&&Te[1].charAt(0)==Te[1].charAt(1)&&Te[2].charAt(0)==Te[2].charAt(1)&&Te[3].charAt(0)==Te[3].charAt(1)?Te[0].charAt(0)+Te[1].charAt(0)+Te[2].charAt(0)+Te[3].charAt(0):Te.join("")}function _(ce,de,ne,pe){var Se=[se(H(pe)),se(E(ce).toString(16)),se(E(de).toString(16)),se(E(ne).toString(16))];return Se.join("")}C.equals=function(ce,de){return!ce||!de?!1:C(ce).toRgbString()==C(de).toRgbString()},C.random=function(){return C.fromRatio({r:h(),g:h(),b:h()})};function g(ce,de){de=de===0?0:de||10;var ne=C(ce).toHsl();return ne.s-=de/100,ne.s=B(ne.s),C(ne)}function M(ce,de){de=de===0?0:de||10;var ne=C(ce).toHsl();return ne.s+=de/100,ne.s=B(ne.s),C(ne)}function O(ce){return C(ce).desaturate(100)}function N(ce,de){de=de===0?0:de||10;var ne=C(ce).toHsl();return ne.l+=de/100,ne.l=B(ne.l),C(ne)}function V(ce,de){de=de===0?0:de||10;var ne=C(ce).toRgb();return ne.r=S(0,m(255,ne.r-E(255*-(de/100)))),ne.g=S(0,m(255,ne.g-E(255*-(de/100)))),ne.b=S(0,m(255,ne.b-E(255*-(de/100)))),C(ne)}function U(ce,de){de=de===0?0:de||10;var ne=C(ce).toHsl();return ne.l-=de/100,ne.l=B(ne.l),C(ne)}function L(ce,de){var ne=C(ce).toHsl(),pe=(ne.h+de)%360;return ne.h=pe<0?360+pe:pe,C(ne)}function j(ce){var de=C(ce).toHsl();return de.h=(de.h+180)%360,C(de)}function Y(ce){var de=C(ce).toHsl(),ne=de.h;return[C(ce),C({h:(ne+120)%360,s:de.s,l:de.l}),C({h:(ne+240)%360,s:de.s,l:de.l})]}function W(ce){var de=C(ce).toHsl(),ne=de.h;return[C(ce),C({h:(ne+90)%360,s:de.s,l:de.l}),C({h:(ne+180)%360,s:de.s,l:de.l}),C({h:(ne+270)%360,s:de.s,l:de.l})]}function ie(ce){var de=C(ce).toHsl(),ne=de.h;return[C(ce),C({h:(ne+72)%360,s:de.s,l:de.l}),C({h:(ne+216)%360,s:de.s,l:de.l})]}function re(ce,de,ne){de=de||6,ne=ne||30;var pe=C(ce).toHsl(),Se=360/ne,Te=[C(ce)];for(pe.h=(pe.h-(Se*de>>1)+720)%360;--de;)pe.h=(pe.h+Se)%360,Te.push(C(pe));return Te}function ye(ce,de){de=de||6;for(var ne=C(ce).toHsv(),pe=ne.h,Se=ne.s,Te=ne.v,Ne=[],je=1/de;de--;)Ne.push(C({h:pe,s:Se,v:Te})),Te=(Te+je)%1;return Ne}C.mix=function(ce,de,ne){ne=ne===0?0:ne||50;var pe=C(ce).toRgb(),Se=C(de).toRgb(),Te=ne/100,Ne={r:(Se.r-pe.r)*Te+pe.r,g:(Se.g-pe.g)*Te+pe.g,b:(Se.b-pe.b)*Te+pe.b,a:(Se.a-pe.a)*Te+pe.a};return C(Ne)},C.readability=function(ce,de){var ne=C(ce),pe=C(de);return(u.max(ne.getLuminance(),pe.getLuminance())+.05)/(u.min(ne.getLuminance(),pe.getLuminance())+.05)},C.isReadable=function(ce,de,ne){var pe=C.readability(ce,de),Se,Te;switch(Te=!1,Se=ge(ne),Se.level+Se.size){case"AAsmall":case"AAAlarge":Te=pe>=4.5;break;case"AAlarge":Te=pe>=3;break;case"AAAsmall":Te=pe>=7;break}return Te},C.mostReadable=function(ce,de,ne){var pe=null,Se=0,Te,Ne,je,Xe;ne=ne||{},Ne=ne.includeFallbackColors,je=ne.level,Xe=ne.size;for(var Ye=0;Ye<de.length;Ye++)Te=C.readability(ce,de[Ye]),Te>Se&&(Se=Te,pe=C(de[Ye]));return C.isReadable(ce,pe,{level:je,size:Xe})||!Ne?pe:(ne.includeFallbackColors=!1,C.mostReadable(ce,["#fff","#000"],ne))};var ve=C.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ue=C.hexNames=oe(ve);function oe(ce){var de={};for(var ne in ce)ce.hasOwnProperty(ne)&&(de[ce[ne]]=ne);return de}function Z(ce){return ce=parseFloat(ce),(isNaN(ce)||ce<0||ce>1)&&(ce=1),ce}function J(ce,de){$(ce)&&(ce="100%");var ne=he(ce);return ce=m(de,S(0,parseFloat(ce))),ne&&(ce=parseInt(ce*de,10)/100),u.abs(ce-de)<1e-6?1:ce%de/parseFloat(de)}function B(ce){return m(1,S(0,ce))}function G(ce){return parseInt(ce,16)}function $(ce){return typeof ce=="string"&&ce.indexOf(".")!=-1&&parseFloat(ce)===1}function he(ce){return typeof ce=="string"&&ce.indexOf("%")!=-1}function se(ce){return ce.length==1?"0"+ce:""+ce}function q(ce){return ce<=1&&(ce=ce*100+"%"),ce}function H(ce){return u.round(parseFloat(ce)*255).toString(16)}function X(ce){return G(ce)/255}var ee=function(){var ce="[-\\+]?\\d+%?",de="[-\\+]?\\d*\\.\\d+%?",ne="(?:"+de+")|(?:"+ce+")",pe="[\\s|\\(]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")\\s*\\)?",Se="[\\s|\\(]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")\\s*\\)?";return{CSS_UNIT:new RegExp(ne),rgb:new RegExp("rgb"+pe),rgba:new RegExp("rgba"+Se),hsl:new RegExp("hsl"+pe),hsla:new RegExp("hsla"+Se),hsv:new RegExp("hsv"+pe),hsva:new RegExp("hsva"+Se),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Q(ce){return!!ee.CSS_UNIT.exec(ce)}function te(ce){ce=ce.replace(p,"").replace(s,"").toLowerCase();var de=!1;if(ve[ce])ce=ve[ce],de=!0;else if(ce=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var ne;return(ne=ee.rgb.exec(ce))?{r:ne[1],g:ne[2],b:ne[3]}:(ne=ee.rgba.exec(ce))?{r:ne[1],g:ne[2],b:ne[3],a:ne[4]}:(ne=ee.hsl.exec(ce))?{h:ne[1],s:ne[2],l:ne[3]}:(ne=ee.hsla.exec(ce))?{h:ne[1],s:ne[2],l:ne[3],a:ne[4]}:(ne=ee.hsv.exec(ce))?{h:ne[1],s:ne[2],v:ne[3]}:(ne=ee.hsva.exec(ce))?{h:ne[1],s:ne[2],v:ne[3],a:ne[4]}:(ne=ee.hex8.exec(ce))?{r:G(ne[1]),g:G(ne[2]),b:G(ne[3]),a:X(ne[4]),format:de?"name":"hex8"}:(ne=ee.hex6.exec(ce))?{r:G(ne[1]),g:G(ne[2]),b:G(ne[3]),format:de?"name":"hex"}:(ne=ee.hex4.exec(ce))?{r:G(ne[1]+""+ne[1]),g:G(ne[2]+""+ne[2]),b:G(ne[3]+""+ne[3]),a:X(ne[4]+""+ne[4]),format:de?"name":"hex8"}:(ne=ee.hex3.exec(ce))?{r:G(ne[1]+""+ne[1]),g:G(ne[2]+""+ne[2]),b:G(ne[3]+""+ne[3]),format:de?"name":"hex"}:!1}function ge(ce){var de,ne;return ce=ce||{level:"AA",size:"small"},de=(ce.level||"AA").toUpperCase(),ne=(ce.size||"small").toLowerCase(),de!=="AA"&&de!=="AAA"&&(de="AA"),ne!=="small"&&ne!=="large"&&(ne="small"),{level:de,size:ne}}a.exports?a.exports=C:window.tinycolor=C})(Math)})(UA);var Wd=UA.exports,hr=(a,u,p)=>{var s=Id(a,"colors."+u,u),c=Wd(s).isValid();return c?s:p},BV=a=>u=>{var p=hr(u,a),s=Wd(p).isDark();return s?"dark":"light"},UV=a=>u=>BV(a)(u)==="dark",rc=(a,u)=>p=>{var s=hr(p,a);return Wd(s).setAlpha(u).toRgbString()};function VA(a,u){return a===void 0&&(a="1rem"),u===void 0&&(u="rgba(255, 255, 255, 0.15)"),{backgroundImage:`linear-gradient(
    45deg,
    `+u+` 25%,
    transparent 25%,
    transparent 50%,
    `+u+` 50%,
    `+u+` 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:a+" "+a}}function VV(a){var u=Wd.random().toHexString();return!a||f2(a)?u:a.string&&a.colors?jV(a.string,a.colors):a.string&&!a.colors?kV(a.string):a.colors&&!a.string?zV(a.colors):u}function kV(a){var u=0;if(a.length===0)return u.toString();for(var p=0;p<a.length;p+=1)u=a.charCodeAt(p)+((u<<5)-u),u=u&u;for(var s="#",c=0;c<3;c+=1){var E=u>>c*8&255;s+=("00"+E.toString(16)).substr(-2)}return s}function jV(a,u){var p=0;if(a.length===0)return u[0];for(var s=0;s<a.length;s+=1)p=a.charCodeAt(s)+((p<<5)-p),p=p&p;return p=(p%u.length+u.length)%u.length,u[p]}function zV(a){return a[Math.floor(Math.random()*a.length)]}function st(a,u){return p=>p.colorMode==="dark"?u:a}function Ql(a){var{orientation:u,vertical:p,horizontal:s}=a;return u?u==="vertical"?p:s:{}}function Dg(){return Dg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Dg.apply(this,arguments)}var GV=a=>(ag({condition:!0,message:["[chakra-ui]: createBreakpoints(...) will be deprecated pretty soon","simply pass the breakpoints as an object. Remove the createBreakpoint(..) call"].join("")}),Dg({base:"0em"},a));function ka(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}class HV{constructor(u){var p=this;this.name=u,ka(this,"map",{}),ka(this,"called",!1),ka(this,"assert",()=>{if(!this.called){this.called=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}),ka(this,"parts",function(){p.assert();for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];for(var m of c)p.map[m]=p.toPart(m);return p}),ka(this,"extend",function(){for(var s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];for(var m of c)m in p.map||(p.map[m]=p.toPart(m));return p}),ka(this,"toPart",s=>{var c=["container","root"].includes(s??"")?[this.name]:[this.name,s],E=c.filter(Boolean).join("__"),m="chakra-"+E,S={className:m,selector:"."+m,toString:()=>s};return S}),ka(this,"__type",{})}get selectors(){var u=Object.fromEntries(Object.entries(this.map).map(p=>{var[s,c]=p;return[s,c.selector]}));return u}get classNames(){var u=Object.fromEntries(Object.entries(this.map).map(p=>{var[s,c]=p;return[s,c.className]}));return u}get keys(){return Object.keys(this.map)}}function Dn(a){return new HV(a)}function kA(a){return Mi(a)&&a.reference?a.reference:String(a)}var Xd=function(u){for(var p=arguments.length,s=new Array(p>1?p-1:0),c=1;c<p;c++)s[c-1]=arguments[c];return s.map(kA).join(" "+u+" ").replace(/calc/g,"")},jA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Xd("+",...p)+")"},zA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Xd("-",...p)+")"},wg=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Xd("*",...p)+")"},GA=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return"calc("+Xd("/",...p)+")"},HA=a=>{var u=kA(a);return u!=null&&!Number.isNaN(parseFloat(u))?String(u).startsWith("-")?String(u).slice(1):"-"+u:wg(u,-1)},vo=Object.assign(a=>({add:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return vo(jA(a,...s))},subtract:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return vo(zA(a,...s))},multiply:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return vo(wg(a,...s))},divide:function(){for(var p=arguments.length,s=new Array(p),c=0;c<p;c++)s[c]=arguments[c];return vo(GA(a,...s))},negate:()=>vo(HA(a)),toString:()=>a.toString()}),{add:jA,subtract:zA,multiply:wg,divide:GA,negate:HA});function WV(a){return!Number.isInteger(parseFloat(a.toString()))}function XV(a,u){return u===void 0&&(u="-"),a.replace(/\s+/g,u)}function WA(a){var u=XV(a.toString());return u.includes("\\.")?a:WV(a)?u.replace(".","\\."):a}function YV(a,u){return u===void 0&&(u=""),[u,WA(a)].filter(Boolean).join("-")}function KV(a,u){return"var("+WA(a)+(u?", "+u:"")+")"}function QV(a,u){return u===void 0&&(u=""),"--"+YV(a,u)}function ni(a,u){var p=QV(a,u==null?void 0:u.prefix);return{variable:p,reference:KV(p,qV(u==null?void 0:u.fallback))}}function qV(a){return typeof a=="string"?a:a==null?void 0:a.reference}var ZV=Dn("accordion").parts("container","item","button","panel").extend("icon"),$V=Dn("alert").parts("title","description","container").extend("icon"),JV=Dn("avatar").parts("label","badge","container").extend("excessLabel","group"),ek=Dn("breadcrumb").parts("link","item").extend("separator");Dn("button").parts();var tk=Dn("checkbox").parts("control","icon").extend("label");Dn("progress").parts("track","filledTrack").extend("label");var nk=Dn("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),rk=Dn("editable").parts("preview","input"),ik=Dn("form").parts("container","requiredIndicator","helperText"),ok=Dn("formError").parts("text","icon"),ak=Dn("input").parts("addon","field","element"),sk=Dn("list").parts("container","item","icon"),ck=Dn("menu").parts("button","list","item").extend("groupTitle","command","divider"),lk=Dn("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),uk=Dn("numberinput").parts("root","field","stepperGroup","stepper");Dn("pininput").parts("field");var hk=Dn("popover").parts("content","header","body","footer").extend("popper","arrow"),dk=Dn("progress").parts("label","filledTrack","track"),fk=Dn("radio").parts("container","control","label"),pk=Dn("select").parts("field","icon"),mk=Dn("slider").parts("container","track","thumb","filledTrack"),_k=Dn("stat").parts("container","label","helpText","number","icon"),gk=Dn("switch").parts("container","track","thumb"),vk=Dn("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),bk=Dn("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),yk=Dn("tag").parts("container","label","closeButton"),Tk={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Ek={transitionProperty:"common",transitionDuration:"normal",fontSize:"1rem",_focus:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:4,py:2},Sk={pt:2,px:4,pb:5},xk={fontSize:"1.25em"},Ak={container:Tk,button:Ek,panel:Sk,icon:xk},Pk={parts:ZV.keys,baseStyle:Ak},Ck={container:{px:4,py:3},title:{fontWeight:"bold",lineHeight:6,marginEnd:2},description:{lineHeight:6},icon:{flexShrink:0,marginEnd:3,w:5,h:6}};function Lg(a){var{theme:u,colorScheme:p}=a,s=hr(u,p+".100",p),c=rc(p+".200",.16)(u);return st(s,c)(a)}var Rk=a=>{var{colorScheme:u}=a;return{container:{bg:Lg(a)},icon:{color:st(u+".500",u+".200")(a)}}},Ok=a=>{var{colorScheme:u}=a;return{container:{paddingStart:3,borderStartWidth:"4px",borderStartColor:st(u+".500",u+".200")(a),bg:Lg(a)},icon:{color:st(u+".500",u+".200")(a)}}},Mk=a=>{var{colorScheme:u}=a;return{container:{pt:2,borderTopWidth:"4px",borderTopColor:st(u+".500",u+".200")(a),bg:Lg(a)},icon:{color:st(u+".500",u+".200")(a)}}},Ik=a=>{var{colorScheme:u}=a;return{container:{bg:st(u+".500",u+".200")(a),color:st("white","gray.900")(a)}}},Dk={subtle:Rk,"left-accent":Ok,"top-accent":Mk,solid:Ik},wk={variant:"subtle",colorScheme:"blue"},Lk={parts:$V.keys,baseStyle:Ck,variants:Dk,defaultProps:wk},XA={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"};function Ng(){return Ng=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Ng.apply(this,arguments)}var Nk={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem"},Fk={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Bk=Ng({},XA,Nk,{container:Fk}),YA=Bk,Uk=a=>({transform:"translate(25%, 25%)",borderRadius:"full",border:"0.2em solid",borderColor:st("white","gray.800")(a)}),Vk=a=>({bg:st("gray.200","whiteAlpha.400")(a)}),kk=a=>{var{name:u,theme:p}=a,s=u?VV({string:u}):"gray.400",c=UV(s)(p),E="white";c||(E="gray.800");var m=st("white","gray.800")(a);return{bg:s,color:E,borderColor:m,verticalAlign:"top"}},jk=a=>({badge:Uk(a),excessLabel:Vk(a),container:kk(a)});function sa(a){var u=YA[a];return{container:{width:a,height:a,fontSize:"calc("+(u??a)+" / 2.5)"},excessLabel:{width:a,height:a},label:{fontSize:"calc("+(u??a)+" / 2.5)",lineHeight:a!=="100%"?u??a:void 0}}}var zk={"2xs":sa("4"),xs:sa("6"),sm:sa("8"),md:sa("12"),lg:sa("16"),xl:sa("24"),"2xl":sa("32"),full:sa("100%")},Gk={size:"md"},Hk={parts:JV.keys,baseStyle:jk,sizes:zk,defaultProps:Gk},Wk={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold"},Xk=a=>{var{colorScheme:u,theme:p}=a,s=rc(u+".500",.6)(p);return{bg:st(u+".500",s)(a),color:st("white","whiteAlpha.800")(a)}},Yk=a=>{var{colorScheme:u,theme:p}=a,s=rc(u+".200",.16)(p);return{bg:st(u+".100",s)(a),color:st(u+".800",u+".200")(a)}},Kk=a=>{var{colorScheme:u,theme:p}=a,s=rc(u+".200",.8)(p),c=hr(p,u+".500"),E=st(c,s)(a);return{color:E,boxShadow:"inset 0 0 0px 1px "+E}},Qk={solid:Xk,subtle:Yk,outline:Kk},qk={variant:"subtle",colorScheme:"gray"},ql={baseStyle:Wk,variants:Qk,defaultProps:qk},Zk={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},$k={link:Zk},Jk={parts:ek.keys,baseStyle:$k};function Fg(){return Fg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Fg.apply(this,arguments)}var e3={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},KA=a=>{var{colorScheme:u,theme:p}=a;if(u==="gray")return{color:st("inherit","whiteAlpha.900")(a),_hover:{bg:st("gray.100","whiteAlpha.200")(a)},_active:{bg:st("gray.200","whiteAlpha.300")(a)}};var s=rc(u+".200",.12)(p),c=rc(u+".200",.24)(p);return{color:st(u+".600",u+".200")(a),bg:"transparent",_hover:{bg:st(u+".50",s)(a)},_active:{bg:st(u+".100",c)(a)}}},t3=a=>{var{colorScheme:u}=a,p=st("gray.200","whiteAlpha.300")(a);return Fg({border:"1px solid",borderColor:u==="gray"?p:"currentColor"},KA(a))},n3={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},r3=a=>{var u,{colorScheme:p}=a;if(p==="gray"){var s=st("gray.100","whiteAlpha.200")(a);return{bg:s,_hover:{bg:st("gray.200","whiteAlpha.300")(a),_disabled:{bg:s}},_active:{bg:st("gray.300","whiteAlpha.400")(a)}}}var{bg:c=p+".500",color:E="white",hoverBg:m=p+".600",activeBg:S=p+".700"}=(u=n3[p])!=null?u:{},h=st(c,p+".200")(a);return{bg:h,color:st(E,"gray.800")(a),_hover:{bg:st(m,p+".300")(a),_disabled:{bg:h}},_active:{bg:st(S,p+".400")(a)}}},i3=a=>{var{colorScheme:u}=a;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:st(u+".500",u+".200")(a),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:st(u+".700",u+".500")(a)}}},o3={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:0,p:0},a3={ghost:KA,outline:t3,solid:r3,link:i3,unstyled:o3},s3={lg:{h:12,minW:12,fontSize:"lg",px:6},md:{h:10,minW:10,fontSize:"md",px:4},sm:{h:8,minW:8,fontSize:"sm",px:3},xs:{h:6,minW:6,fontSize:"xs",px:2}},c3={variant:"solid",size:"md",colorScheme:"gray"},l3={baseStyle:e3,variants:a3,sizes:s3,defaultProps:c3},u3=a=>{var{colorScheme:u}=a;return{w:"100%",transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:st(u+".500",u+".200")(a),borderColor:st(u+".500",u+".200")(a),color:st("white","gray.900")(a),_hover:{bg:st(u+".600",u+".300")(a),borderColor:st(u+".600",u+".300")(a)},_disabled:{borderColor:st("gray.200","transparent")(a),bg:st("gray.200","whiteAlpha.300")(a),color:st("gray.500","whiteAlpha.500")(a)}},_indeterminate:{bg:st(u+".500",u+".200")(a),borderColor:st(u+".500",u+".200")(a),color:st("white","gray.900")(a)},_disabled:{bg:st("gray.100","whiteAlpha.100")(a),borderColor:st("gray.100","transparent")(a)},_focus:{boxShadow:"outline"},_invalid:{borderColor:st("red.500","red.300")(a)}}},h3={userSelect:"none",_disabled:{opacity:.4}},d3={transitionProperty:"transform",transitionDuration:"normal"},f3=a=>({icon:d3,control:u3(a),label:h3}),p3={sm:{control:{h:3,w:3},label:{fontSize:"sm"},icon:{fontSize:"0.45rem"}},md:{control:{w:4,h:4},label:{fontSize:"md"},icon:{fontSize:"0.625rem"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"},icon:{fontSize:"0.625rem"}}},m3={size:"md",colorScheme:"blue"},Bg={parts:tk.keys,baseStyle:f3,sizes:p3,defaultProps:m3},Zl=ni("close-button-size"),_3=a=>{var u=st("blackAlpha.100","whiteAlpha.100")(a),p=st("blackAlpha.200","whiteAlpha.200")(a);return{w:[Zl.reference],h:[Zl.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{bg:u},_active:{bg:p},_focus:{boxShadow:"outline"}}},g3={lg:{[Zl.variable]:"40px",fontSize:"16px"},md:{[Zl.variable]:"32px",fontSize:"12px"},sm:{[Zl.variable]:"24px",fontSize:"10px"}},v3={size:"md"},b3={baseStyle:_3,sizes:g3,defaultProps:v3},{variants:y3,defaultProps:T3}=ql,E3={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm"},S3={baseStyle:E3,variants:y3,defaultProps:T3},x3={w:"100%",mx:"auto",maxW:"60ch",px:"1rem"},A3={baseStyle:x3},P3={opacity:.6,borderColor:"inherit"},C3={borderStyle:"solid"},R3={borderStyle:"dashed"},O3={solid:C3,dashed:R3},M3={variant:"solid"},I3={baseStyle:P3,variants:O3,defaultProps:M3};function Ug(){return Ug=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Ug.apply(this,arguments)}function ic(a){return a==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:a}}}var D3={bg:"blackAlpha.600",zIndex:"overlay"},w3={display:"flex",zIndex:"modal",justifyContent:"center"},L3=a=>{var{isFullHeight:u}=a;return Ug({},u&&{height:"100vh"},{zIndex:"modal",maxH:"100vh",bg:st("white","gray.700")(a),color:"inherit",boxShadow:st("lg","dark-lg")(a)})},N3={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},F3={position:"absolute",top:2,insetEnd:3},B3={px:6,py:2,flex:1,overflow:"auto"},U3={px:6,py:4},V3=a=>({overlay:D3,dialogContainer:w3,dialog:L3(a),header:N3,closeButton:F3,body:B3,footer:U3}),k3={xs:ic("xs"),sm:ic("md"),md:ic("lg"),lg:ic("2xl"),xl:ic("4xl"),full:ic("full")},j3={size:"xs"},z3={parts:nk.keys,baseStyle:V3,sizes:k3,defaultProps:j3},G3={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal"},H3={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal",width:"full",_focus:{boxShadow:"outline"},_placeholder:{opacity:.6}},W3={preview:G3,input:H3},X3={parts:rk.keys,baseStyle:W3},Y3=a=>({marginStart:1,color:st("red.500","red.300")(a)}),K3=a=>({mt:2,color:st("gray.500","whiteAlpha.600")(a),lineHeight:"normal",fontSize:"sm"}),Q3=a=>({container:{width:"100%",position:"relative"},requiredIndicator:Y3(a),helperText:K3(a)}),q3={parts:ik.keys,baseStyle:Q3},Z3={fontSize:"md",marginEnd:3,mb:2,fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},$3={baseStyle:Z3},J3={fontFamily:"heading",fontWeight:"bold"},ej={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},tj={size:"xl"},nj={baseStyle:J3,sizes:ej,defaultProps:tj},rj={field:{width:"100%",minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal"}},ca={lg:{fontSize:"lg",px:4,h:12,borderRadius:"md"},md:{fontSize:"md",px:4,h:10,borderRadius:"md"},sm:{fontSize:"sm",px:3,h:8,borderRadius:"sm"},xs:{fontSize:"xs",px:2,h:6,borderRadius:"sm"}},ij={lg:{field:ca.lg,addon:ca.lg},md:{field:ca.md,addon:ca.md},sm:{field:ca.sm,addon:ca.sm},xs:{field:ca.xs,addon:ca.xs}};function Vg(a){var{focusBorderColor:u,errorBorderColor:p}=a;return{focusBorderColor:u||st("blue.500","blue.300")(a),errorBorderColor:p||st("red.500","red.300")(a)}}var oj=a=>{var{theme:u}=a,{focusBorderColor:p,errorBorderColor:s}=Vg(a);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:st("gray.300","whiteAlpha.400")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:hr(u,s),boxShadow:"0 0 0 1px "+hr(u,s)},_focus:{zIndex:1,borderColor:hr(u,p),boxShadow:"0 0 0 1px "+hr(u,p)}},addon:{border:"1px solid",borderColor:st("inherit","whiteAlpha.50")(a),bg:st("gray.100","whiteAlpha.300")(a)}}},aj=a=>{var{theme:u}=a,{focusBorderColor:p,errorBorderColor:s}=Vg(a);return{field:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(a),_hover:{bg:st("gray.200","whiteAlpha.100")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:hr(u,s)},_focus:{bg:"transparent",borderColor:hr(u,p)}},addon:{border:"2px solid",borderColor:"transparent",bg:st("gray.100","whiteAlpha.50")(a)}}},sj=a=>{var{theme:u}=a,{focusBorderColor:p,errorBorderColor:s}=Vg(a);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:hr(u,s),boxShadow:"0px 1px 0px 0px "+hr(u,s)},_focus:{borderColor:hr(u,p),boxShadow:"0px 1px 0px 0px "+hr(u,p)}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent"}}},cj={field:{bg:"transparent",px:0,height:"auto"},addon:{bg:"transparent",px:0,height:"auto"}},lj={outline:oj,filled:aj,flushed:sj,unstyled:cj},uj={size:"md",variant:"outline"},Vn={parts:ak.keys,baseStyle:rj,sizes:ij,variants:lj,defaultProps:uj},hj=a=>({bg:st("gray.100","whiteAlpha")(a),borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"}),dj={baseStyle:hj},fj={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},pj={baseStyle:fj},mj={marginEnd:"0.5rem",display:"inline",verticalAlign:"text-bottom"},_j={container:{},item:{},icon:mj},gj={parts:sk.keys,baseStyle:_j},vj=a=>({bg:st("#fff","gray.700")(a),boxShadow:st("sm","dark-lg")(a),color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px"}),bj=a=>({py:"0.4rem",px:"0.8rem",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{bg:st("gray.100","whiteAlpha.100")(a)},_active:{bg:st("gray.200","whiteAlpha.200")(a)},_expanded:{bg:st("gray.100","whiteAlpha.100")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),yj={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Tj={opacity:.6},Ej={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"0.5rem",opacity:.6},Sj={transitionProperty:"common",transitionDuration:"normal"},xj=a=>({button:Sj,list:vj(a),item:bj(a),groupTitle:yj,command:Tj,divider:Ej}),Aj={parts:ck.keys,baseStyle:xj},Pj={bg:"blackAlpha.600",zIndex:"modal"},Cj=a=>{var{isCentered:u,scrollBehavior:p}=a;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:u?"center":"flex-start",overflow:p==="inside"?"hidden":"auto"}},Rj=a=>{var{scrollBehavior:u}=a;return{borderRadius:"md",bg:st("white","gray.700")(a),color:"inherit",my:"3.75rem",zIndex:"modal",maxH:u==="inside"?"calc(100% - 7.5rem)":void 0,boxShadow:st("lg","dark-lg")(a)}},Oj={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},Mj={position:"absolute",top:2,insetEnd:3},Ij=a=>{var{scrollBehavior:u}=a;return{px:6,py:2,flex:1,overflow:u==="inside"?"auto":void 0}},Dj={px:6,py:4},wj=a=>({overlay:Pj,dialogContainer:Cj(a),dialog:Rj(a),header:Oj,closeButton:Mj,body:Ij(a),footer:Dj});function Di(a){return a==="full"?{dialog:{maxW:"100vw",minH:"100vh",my:0}}:{dialog:{maxW:a}}}var Lj={xs:Di("xs"),sm:Di("sm"),md:Di("md"),lg:Di("lg"),xl:Di("xl"),"2xl":Di("2xl"),"3xl":Di("3xl"),"4xl":Di("4xl"),"5xl":Di("5xl"),"6xl":Di("6xl"),full:Di("full")},Nj={size:"md"},Fj={parts:lk.keys,baseStyle:wj,sizes:Lj,defaultProps:Nj},Bj={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2","3":".75rem","4":"1rem","5":"1.25rem","6":"1.5rem","7":"1.75rem","8":"2rem","9":"2.25rem","10":"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},QA=Bj,qA,ZA;function kg(){return kg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},kg.apply(this,arguments)}var{variants:Uj,defaultProps:Vj}=Vn,jg=ni("number-input-stepper-width"),$A=ni("number-input-input-padding"),kj=vo(jg).add("0.5rem").toString(),jj={[jg.variable]:"24px",[$A.variable]:kj},zj=(qA=(ZA=Vn.baseStyle)==null?void 0:ZA.field)!=null?qA:{},Gj={width:[jg.reference]},Hj=a=>({borderStart:"1px solid",borderStartColor:st("inherit","whiteAlpha.300")(a),color:st("inherit","whiteAlpha.800")(a),_active:{bg:st("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),Wj=a=>({root:jj,field:zj,stepperGroup:Gj,stepper:Hj(a)});function Yd(a){var u,p,s=Vn.sizes[a],c={lg:"md",md:"md",sm:"sm",xs:"sm"},E=(u=(p=s.field)==null?void 0:p.fontSize)!=null?u:"md",m=QA.fontSizes[E.toString()];return{field:kg({},s.field,{paddingInlineEnd:$A.reference,verticalAlign:"top"}),stepper:{fontSize:vo(m).multiply(.75).toString(),_first:{borderTopEndRadius:c[a]},_last:{borderBottomEndRadius:c[a],mt:"-1px",borderTopWidth:1}}}}var Xj={xs:Yd("xs"),sm:Yd("sm"),md:Yd("md"),lg:Yd("lg")},Yj={parts:uk.keys,baseStyle:Wj,sizes:Xj,variants:Uj,defaultProps:Vj},JA;function zg(){return zg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},zg.apply(this,arguments)}var Kj=zg({},Vn.baseStyle.field,{textAlign:"center"}),Qj={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},qj={outline:a=>{var u;return(u=Vn.variants.outline(a).field)!=null?u:{}},flushed:a=>{var u;return(u=Vn.variants.flushed(a).field)!=null?u:{}},filled:a=>{var u;return(u=Vn.variants.filled(a).field)!=null?u:{}},unstyled:(JA=Vn.variants.unstyled.field)!=null?JA:{}},Zj=Vn.defaultProps,$j={baseStyle:Kj,sizes:Qj,variants:qj,defaultProps:Zj},Gg=ni("popper-bg"),Jj=ni("popper-arrow-bg"),ez=ni("popper-arrow-shadow-color"),tz={zIndex:10},nz=a=>{var u=st("white","gray.700")(a),p=st("gray.200","whiteAlpha.300")(a);return{[Gg.variable]:"colors."+u,bg:Gg.reference,[Jj.variable]:Gg.reference,[ez.variable]:"colors."+p,width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focus:{outline:0,boxShadow:"outline"}}},rz={px:3,py:2,borderBottomWidth:"1px"},iz={px:3,py:2},oz={px:3,py:2,borderTopWidth:"1px"},az=a=>({popper:tz,content:nz(a),header:rz,body:iz,footer:oz,arrow:{}}),sz={parts:hk.keys,baseStyle:az};function Kd(){return Kd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Kd.apply(this,arguments)}function cz(a){var{colorScheme:u,theme:p,isIndeterminate:s,hasStripe:c}=a,E=st(VA(),VA("1rem","rgba(0,0,0,0.1)"))(a),m=st(u+".500",u+".200")(a),S=`linear-gradient(
    to right,
    transparent 0%,
    `+hr(p,m)+` 50%,
    transparent 100%
  )`,h=!s&&c;return Kd({},h&&E,s?{bgImage:S}:{bgColor:m})}var lz={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},uz=a=>({bg:st("gray.100","whiteAlpha.300")(a)}),hz=a=>Kd({transitionProperty:"common",transitionDuration:"slow"},cz(a)),dz=a=>({label:lz,filledTrack:hz(a),track:uz(a)}),fz={xs:{track:{h:"0.25rem"}},sm:{track:{h:"0.5rem"}},md:{track:{h:"0.75rem"}},lg:{track:{h:"1rem"}}},pz={size:"md",colorScheme:"blue"},mz={parts:dk.keys,sizes:fz,baseStyle:dz,defaultProps:pz};function Qd(){return Qd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Qd.apply(this,arguments)}var _z=a=>{var{control:u={}}=Bg.baseStyle(a);return Qd({},u,{borderRadius:"full",_checked:Qd({},u._checked,{_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}})})},gz=a=>({label:Bg.baseStyle(a).label,control:_z(a)}),vz={md:{control:{w:4,h:4},label:{fontSize:"md"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"}},sm:{control:{width:3,height:3},label:{fontSize:"sm"}}},bz={size:"md",colorScheme:"blue"},yz={parts:fk.keys,baseStyle:gz,sizes:vz,defaultProps:bz};function $l(){return $l=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},$l.apply(this,arguments)}var Tz=a=>$l({},Vn.baseStyle.field,{bg:st("white","gray.700")(a),appearance:"none",paddingBottom:"1px",lineHeight:"normal","> option, > optgroup":{bg:st("white","gray.700")(a)}}),Ez={width:"1.5rem",height:"100%",insetEnd:"0.5rem",position:"relative",color:"currentColor",fontSize:"1.25rem",_disabled:{opacity:.5}},Sz=a=>({field:Tz(a),icon:Ez}),xz=$l({},Vn.sizes,{xs:$l({},Vn.sizes.xs,{icon:{insetEnd:"0.25rem"}})}),Az={parts:pk.keys,baseStyle:Sz,sizes:xz,variants:Vn.variants,defaultProps:Vn.defaultProps},Pz=(a,u)=>$_({from:{borderColor:a,background:a},to:{borderColor:u,background:u}}),Cz=a=>{var u=st("gray.100","gray.800")(a),p=st("gray.400","gray.600")(a),{startColor:s=u,endColor:c=p,speed:E,theme:m}=a,S=hr(m,s),h=hr(m,c);return{opacity:.7,borderRadius:"2px",borderColor:S,background:h,animation:E+"s linear infinite alternate "+Pz(S,h)}},Rz={baseStyle:Cz},Oz=a=>({borderRadius:"md",fontWeight:"semibold",_focus:{boxShadow:"outline",padding:"1rem",position:"fixed",top:"1.5rem",insetStart:"1.5rem",bg:st("white","gray.700")(a)}}),Mz={baseStyle:Oz};function qd(){return qd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},qd.apply(this,arguments)}function Iz(a){return Ql({orientation:a.orientation,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}})}var Dz=a=>{var{orientation:u}=a;return qd({_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"}},Ql({orientation:u,vertical:{h:"100%"},horizontal:{w:"100%"}}))},wz=a=>({borderRadius:"sm",bg:st("gray.200","whiteAlpha.200")(a),_disabled:{bg:st("gray.300","whiteAlpha.300")(a)}}),Lz=a=>qd({zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{bg:"gray.300"}},Iz(a)),Nz=a=>{var{colorScheme:u}=a;return{bg:st(u+".500",u+".200")(a)}},Fz=a=>({container:Dz(a),track:wz(a),thumb:Lz(a),filledTrack:Nz(a)}),Bz=a=>({thumb:{w:"16px",h:"16px"},track:Ql({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),Uz=a=>({thumb:{w:"14px",h:"14px"},track:Ql({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),Vz=a=>({thumb:{w:"10px",h:"10px"},track:Ql({orientation:a.orientation,horizontal:{h:"2px"},vertical:{w:"2px"}})}),kz={lg:Bz,md:Uz,sm:Vz},jz={size:"md",colorScheme:"blue"},zz={parts:mk.keys,sizes:kz,baseStyle:Fz,defaultProps:jz},ja=ni("spinner-size"),Gz={width:[ja.reference],height:[ja.reference]},Hz={xs:{[ja.variable]:"0.75rem"},sm:{[ja.variable]:"1rem"},md:{[ja.variable]:"1.5rem"},lg:{[ja.variable]:"2rem"},xl:{[ja.variable]:"3rem"}},Wz={size:"md"},Xz={baseStyle:Gz,sizes:Hz,defaultProps:Wz},Yz={fontWeight:"medium"},Kz={opacity:.8,marginBottom:2},Qz={verticalAlign:"baseline",fontWeight:"semibold"},qz={marginEnd:1,w:"14px",h:"14px",verticalAlign:"middle"},Zz={container:{},label:Yz,helpText:Kz,number:Qz,icon:qz},$z={md:{label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}}},Jz={size:"md"},eG={parts:_k.keys,baseStyle:Zz,sizes:$z,defaultProps:Jz},Jl=ni("switch-track-width"),za=ni("switch-track-height"),Hg=ni("switch-track-diff"),tG=vo.subtract(Jl,za),Wg=ni("switch-thumb-x"),nG=a=>{var{colorScheme:u}=a;return{borderRadius:"full",p:"2px",width:[Jl.reference],height:[za.reference],transitionProperty:"common",transitionDuration:"fast",bg:st("gray.300","whiteAlpha.400")(a),_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{bg:st(u+".500",u+".200")(a)}}},rG={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[za.reference],height:[za.reference],_checked:{transform:"translateX("+Wg.reference+")"}},iG=a=>({container:{[Hg.variable]:tG,[Wg.variable]:Hg.reference,_rtl:{[Wg.variable]:vo(Hg).negate().toString()}},track:nG(a),thumb:rG}),oG={sm:{container:{[Jl.variable]:"1.375rem",[za.variable]:"0.75rem"}},md:{container:{[Jl.variable]:"1.875rem",[za.variable]:"1rem"}},lg:{container:{[Jl.variable]:"2.875rem",[za.variable]:"1.5rem"}}},aG={size:"md",colorScheme:"blue"},sG={parts:gk.keys,baseStyle:iG,sizes:oG,defaultProps:aG};function oc(){return oc=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},oc.apply(this,arguments)}var cG={table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}},Zd={"&[data-is-numeric=true]":{textAlign:"end"}},lG=a=>{var{colorScheme:u}=a;return{th:oc({color:st("gray.600","gray.400")(a),borderBottom:"1px",borderColor:st(u+".100",u+".700")(a)},Zd),td:oc({borderBottom:"1px",borderColor:st(u+".100",u+".700")(a)},Zd),caption:{color:st("gray.600","gray.100")(a)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},uG=a=>{var{colorScheme:u}=a;return{th:oc({color:st("gray.600","gray.400")(a),borderBottom:"1px",borderColor:st(u+".100",u+".700")(a)},Zd),td:oc({borderBottom:"1px",borderColor:st(u+".100",u+".700")(a)},Zd),caption:{color:st("gray.600","gray.100")(a)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:st(u+".100",u+".700")(a)},td:{background:st(u+".100",u+".700")(a)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},hG={simple:lG,striped:uG,unstyled:{}},dG={sm:{th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}},md:{th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}},lg:{th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}}},fG={variant:"simple",size:"md",colorScheme:"gray"},pG={parts:vk.keys,baseStyle:cG,variants:hG,sizes:dG,defaultProps:fG},mG=a=>{var{orientation:u}=a;return{display:u==="vertical"?"flex":"block"}},_G=a=>{var{isFitted:u}=a;return{flex:u?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focus:{zIndex:1,boxShadow:"outline"}}},gG=a=>{var{align:u="start",orientation:p}=a,s={end:"flex-end",center:"center",start:"flex-start"};return{justifyContent:s[u],flexDirection:p==="vertical"?"column":"row"}},vG={p:4},bG=a=>({root:mG(a),tab:_G(a),tablist:gG(a),tabpanel:vG}),yG={sm:{tab:{py:1,px:4,fontSize:"sm"}},md:{tab:{fontSize:"md",py:2,px:4}},lg:{tab:{fontSize:"lg",py:3,px:4}}},TG=a=>{var{colorScheme:u,orientation:p}=a,s=p==="vertical",c=p==="vertical"?"borderStart":"borderBottom",E=s?"marginStart":"marginBottom";return{tablist:{[c]:"2px solid",borderColor:"inherit"},tab:{[c]:"2px solid",borderColor:"transparent",[E]:"-2px",_selected:{color:st(u+".600",u+".300")(a),borderColor:"currentColor"},_active:{bg:st("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}}},EG=a=>{var{colorScheme:u}=a;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",_selected:{color:st(u+".600",u+".300")(a),borderColor:"inherit",borderBottomColor:st("white","gray.800")(a)}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},SG=a=>{var{colorScheme:u}=a;return{tab:{border:"1px solid",borderColor:"inherit",bg:st("gray.50","whiteAlpha.50")(a),mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{bg:st("#fff","gray.800")(a),color:st(u+".600",u+".300")(a),borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},xG=a=>{var{colorScheme:u,theme:p}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:hr(p,u+".700"),bg:hr(p,u+".100")}}}},AG=a=>{var{colorScheme:u}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:st("gray.600","inherit")(a),_selected:{color:st("#fff","gray.800")(a),bg:st(u+".600",u+".300")(a)}}}},PG={},CG={line:TG,enclosed:EG,"enclosed-colored":SG,"soft-rounded":xG,"solid-rounded":AG,unstyled:PG},RG={size:"md",variant:"line",colorScheme:"blue"},OG={parts:bk.keys,baseStyle:bG,sizes:yG,variants:CG,defaultProps:RG},MG={fontWeight:"medium",lineHeight:1.2,outline:0,_focus:{boxShadow:"outline"}},IG={lineHeight:1.2,overflow:"visible"},DG={fontSize:"18px",w:"1.25rem",h:"1.25rem",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"0.375rem",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focus:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},wG={container:MG,label:IG,closeButton:DG},LG={sm:{container:{minH:"1.25rem",minW:"1.25rem",fontSize:"xs",px:2,borderRadius:"md"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}},md:{container:{minH:"1.5rem",minW:"1.5rem",fontSize:"sm",borderRadius:"md",px:2}},lg:{container:{minH:8,minW:8,fontSize:"md",borderRadius:"md",px:3}}},NG={subtle:a=>({container:ql.variants.subtle(a)}),solid:a=>({container:ql.variants.solid(a)}),outline:a=>({container:ql.variants.outline(a)})},FG={size:"md",variant:"subtle",colorScheme:"gray"},BG={parts:yk.keys,variants:NG,baseStyle:wG,sizes:LG,defaultProps:FG},eP,tP,nP,rP,iP;function Xg(){return Xg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Xg.apply(this,arguments)}var UG=Xg({},Vn.baseStyle.field,{paddingY:"8px",minHeight:"80px",lineHeight:"short",verticalAlign:"top"}),VG={outline:a=>{var u;return(u=Vn.variants.outline(a).field)!=null?u:{}},flushed:a=>{var u;return(u=Vn.variants.flushed(a).field)!=null?u:{}},filled:a=>{var u;return(u=Vn.variants.filled(a).field)!=null?u:{}},unstyled:(eP=Vn.variants.unstyled.field)!=null?eP:{}},kG={xs:(tP=Vn.sizes.xs.field)!=null?tP:{},sm:(nP=Vn.sizes.sm.field)!=null?nP:{},md:(rP=Vn.sizes.md.field)!=null?rP:{},lg:(iP=Vn.sizes.lg.field)!=null?iP:{}},jG={size:"md",variant:"outline"},zG={baseStyle:UG,sizes:kG,variants:VG,defaultProps:jG},Yg=ni("tooltip-bg"),GG=ni("popper-arrow-bg"),HG=a=>{var u=st("gray.700","gray.300")(a);return{[Yg.variable]:"colors."+u,px:"8px",py:"2px",bg:[Yg.reference],[GG.variable]:[Yg.reference],color:st("whiteAlpha.900","gray.900")(a),borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"320px",zIndex:"tooltip"}},WG={baseStyle:HG},XG=a=>({color:st("red.500","red.300")(a),mt:2,fontSize:"sm"}),YG=a=>({marginEnd:"0.5em",color:st("red.500","red.300")(a)}),KG=a=>({text:XG(a),icon:YG(a)}),QG={parts:ok.keys,baseStyle:KG},qG={Accordion:Pk,Alert:Lk,Avatar:Hk,Badge:ql,Breadcrumb:Jk,Button:l3,Checkbox:Bg,CloseButton:b3,Code:S3,Container:A3,Divider:I3,Drawer:z3,Editable:X3,Form:q3,FormLabel:$3,Heading:nj,Input:Vn,Kbd:dj,Link:pj,List:gj,Menu:Aj,Modal:Fj,NumberInput:Yj,PinInput:$j,Popover:sz,Progress:mz,Radio:yz,Select:Az,Skeleton:Rz,SkipLink:Mz,Slider:zz,Spinner:Xz,Stat:eG,Switch:sG,Table:pG,Tabs:OG,Tag:BG,Textarea:zG,Tooltip:WG,FormError:QG},ZG={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},$G=ZG,JG=GV({sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"}),e4=JG,t4={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},n4=t4,r4={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},i4=r4,o4={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},a4=o4,s4={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},c4={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},l4={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},u4={property:s4,easing:c4,duration:l4},h4=u4,d4={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},f4=d4,p4={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},m4=p4;function Kg(){return Kg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Kg.apply(this,arguments)}var _4=Kg({breakpoints:e4,zIndices:f4,radii:i4,blur:m4,colors:n4},QA,{sizes:YA,shadows:a4,space:XA,borders:$G,transition:h4}),g4=_4,v4={global:a=>({body:{fontFamily:"body",color:st("gray.800","whiteAlpha.900")(a),bg:st("white","gray.800")(a),transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:st("gray.400","whiteAlpha.400")(a)},"*, *::before, &::after":{borderColor:st("gray.200","whiteAlpha.300")(a),wordWrap:"break-word"}})},b4=v4;function Qg(){return Qg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Qg.apply(this,arguments)}var y4="ltr",T4={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},E4=Qg({direction:y4},g4,{components:qG,styles:b4,config:T4}),S4=E4,oP=FV;oP.defaultProps={theme:S4};function eu(){return eu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},eu.apply(this,arguments)}function x4(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var aP={path:$e("g",{stroke:"currentColor",strokeWidth:"1.5"},$e("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),$e("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),$e("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})),viewBox:"0 0 24 24"},tu=Ln((a,u)=>{var{as:p,viewBox:s,color:c="currentColor",focusable:E=!1,children:m,className:S,__css:h}=a,C=x4(a,["as","viewBox","color","focusable","children","className","__css"]),R=ir("chakra-icon",S),I=eu({w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:c},h),b={ref:u,focusable:E,className:R,__css:I},f=s??aP.viewBox;if(p&&typeof p!="string")return $e(on.svg,eu({as:p},b,C));var x=m??aP.path;return $e(on.svg,eu({verticalAlign:"middle",viewBox:f},b,C),x)});function qg(){return qg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},qg.apply(this,arguments)}function nu(a){var{viewBox:u="0 0 24 24",d:p,path:s,displayName:c,defaultProps:E={}}=a,m=Ln((S,h)=>$e(tu,qg({ref:h,viewBox:u},E,S),s??$e("path",{fill:"currentColor",d:p})));return m}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Zg=function(a,u){return Zg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,s){p.__proto__=s}||function(p,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(p[c]=s[c])},Zg(a,u)};function sP(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");Zg(a,u);function p(){this.constructor=a}a.prototype=u===null?Object.create(u):(p.prototype=u.prototype,new p)}var ht=function(){return ht=Object.assign||function(u){for(var p,s=1,c=arguments.length;s<c;s++){p=arguments[s];for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&(u[E]=p[E])}return u},ht.apply(this,arguments)};function ri(a,u){var p={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(p[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(p[s[c]]=a[s[c]]);return p}function Wn(a,u){var p=typeof Symbol=="function"&&a[Symbol.iterator];if(!p)return a;var s=p.call(a),c,E=[],m;try{for(;(u===void 0||u-- >0)&&!(c=s.next()).done;)E.push(c.value)}catch(S){m={error:S}}finally{try{c&&!c.done&&(p=s.return)&&p.call(s)}finally{if(m)throw m.error}}return E}function Br(a,u,p){if(p||arguments.length===2)for(var s=0,c=u.length,E;s<c;s++)(E||!(s in u))&&(E||(E=Array.prototype.slice.call(u,0,s)),E[s]=u[s]);return a.concat(E||Array.prototype.slice.call(u))}var bo=function(a){return{isEnabled:function(u){return a.some(function(p){return!!u[p]})}}},$g={measureLayout:bo(["layout","layoutId","drag","_layoutResetTransform"]),animation:bo(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag"]),exit:bo(["exit"]),drag:bo(["drag","dragControls"]),focus:bo(["whileFocus"]),hover:bo(["whileHover","onHoverStart","onHoverEnd"]),tap:bo(["whileTap","onTap","onTapStart","onTapCancel"]),pan:bo(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),layoutAnimation:bo(["layout","layoutId"])};function A4(a){for(var u in a){var p=a[u];p!==null&&($g[u].Component=p)}}var ru=function(){},cP=Er({strict:!1}),lP=Object.keys($g),P4=lP.length;function C4(a,u,p){var s=[];if(cn(cP),!u)return null;for(var c=0;c<P4;c++){var E=lP[c],m=$g[E],S=m.isEnabled,h=m.Component;S(a)&&h&&s.push($e(h,ht({key:E},a,{visualElement:u})))}return s}var $d=Er({transformPagePoint:function(a){return a},isStatic:!1}),Jd=Er({});function R4(){return cn(Jd).visualElement}var iu=Er(null);function ou(a){var u=zt(null);return u.current===null&&(u.current=a()),u.current}function Jg(){var a=cn(iu);if(a===null)return[!0,null];var u=a.isPresent,p=a.onExitComplete,s=a.register,c=D4();Vt(function(){return s(c)},[]);var E=function(){return p==null?void 0:p(c)};return!u&&p?[!1,E]:[!0]}function O4(a){return a===null?!0:a.isPresent}var M4=0,I4=function(){return M4++},D4=function(){return ou(I4)},w4=Er(null),au=typeof window!="undefined",uP=au?$o:Vt;function L4(a){var u=a.layoutId,p=cn(w4);return p&&u!==void 0?p+"-"+u:u}function N4(a,u,p,s){var c=cn($d),E=cn(cP),m=R4(),S=cn(iu),h=L4(p),C=zt(void 0);s||(s=E.renderer),!C.current&&s&&(C.current=s(a,{visualState:u,parent:m,props:ht(ht({},p),{layoutId:h}),presenceId:S==null?void 0:S.id,blockInitialAnimation:(S==null?void 0:S.initial)===!1}));var R=C.current;return uP(function(){!R||(R.setProps(ht(ht(ht({},c),p),{layoutId:h})),R.isPresent=O4(S),R.isPresenceRoot=!m||m.presenceId!==(S==null?void 0:S.id),R.syncRender())}),Vt(function(){var I;!R||(I=R.animationState)===null||I===void 0||I.animateChanges()}),uP(function(){return function(){return R==null?void 0:R.notifyUnmount()}},[]),R}function ev(a){return typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"current")}function F4(a,u,p){return Gt(function(s){var c;s&&((c=a.mount)===null||c===void 0||c.call(a,s)),u&&(s?u.mount(s):u.unmount()),p&&(typeof p=="function"?p(s):ev(p)&&(p.current=s))},[u])}function hP(a){return Array.isArray(a)}function wi(a){return typeof a=="string"||hP(a)}function B4(a){var u={};return a.forEachValue(function(p,s){return u[s]=p.get()}),u}function U4(a){var u={};return a.forEachValue(function(p,s){return u[s]=p.getVelocity()}),u}function dP(a,u,p,s,c){var E;return s===void 0&&(s={}),c===void 0&&(c={}),typeof u=="string"&&(u=(E=a.variants)===null||E===void 0?void 0:E[u]),typeof u=="function"?u(p??a.custom,s,c):u}function ef(a,u,p){var s=a.getProps();return dP(s,u,p??s.custom,B4(a),U4(a))}function tf(a){var u;return typeof((u=a.animate)===null||u===void 0?void 0:u.start)=="function"||wi(a.initial)||wi(a.animate)||wi(a.whileHover)||wi(a.whileDrag)||wi(a.whileTap)||wi(a.whileFocus)||wi(a.exit)}function fP(a){return Boolean(tf(a)||a.variants)}function V4(a,u){if(tf(a)){var p=a.initial,s=a.animate;return{initial:p===!1||wi(p)?p:void 0,animate:wi(s)?s:void 0}}return a.inherit!==!1?u:{}}function k4(a,u){var p=V4(a,cn(Jd)),s=p.initial,c=p.animate;return Hn(function(){return{initial:s,animate:c}},u?[pP(s),pP(c)]:[])}function pP(a){return Array.isArray(a)?a.join(" "):a}function j4(a){var u=a.preloadedFeatures,p=a.createVisualElement,s=a.useRender,c=a.useVisualState,E=a.Component;u&&A4(u);function m(S,h){var C=cn($d).isStatic,R=null,I=k4(S,C),b=c(S,C);return!C&&au&&(I.visualElement=N4(E,b,S,p),R=C4(S,I.visualElement)),$e(lr,null,$e(Jd.Provider,{value:I},s(E,S,F4(b,I.visualElement,h),b,C)),R)}return Ci(m)}function z4(a){function u(s,c){return c===void 0&&(c={}),j4(a(s,c))}var p=new Map;return new Proxy(u,{get:function(s,c){return p.has(c)||p.set(c,u(c)),p.get(c)}})}var G4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view"];function tv(a){return typeof a!="string"||a.includes("-")?!1:!!(G4.indexOf(a)>-1||/[A-Z]/.test(a))}var su={};function H4(a){for(var u in a)su[u]=a[u]}var W4=["","X","Y","Z"],X4=["translate","scale","rotate","skew"],cu=["transformPerspective","x","y","z"];X4.forEach(function(a){return W4.forEach(function(u){return cu.push(a+u)})});function Y4(a,u){return cu.indexOf(a)-cu.indexOf(u)}var K4=new Set(cu);function nf(a){return K4.has(a)}var Q4=new Set(["originX","originY","originZ"]);function mP(a){return Q4.has(a)}function _P(a,u){var p=u.layout,s=u.layoutId;return nf(a)||mP(a)||(p||s!==void 0)&&(!!su[a]||a==="opacity")}var la=function(a){return a!==null&&typeof a=="object"&&a.getVelocity},q4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"};function Z4(a,u,p,s){var c=a.transform,E=a.transformKeys,m=u.enableHardwareAcceleration,S=m===void 0?!0:m,h=u.allowTransformNone,C=h===void 0?!0:h,R="";E.sort(Y4);for(var I=!1,b=E.length,f=0;f<b;f++){var x=E[f];R+=(q4[x]||x)+"("+c[x]+") ",x==="z"&&(I=!0)}return!I&&S?R+="translateZ(0)":R=R.trim(),s?R=s(c,p?"":R):C&&p&&(R="none"),R}function $4(a){var u=a.originX,p=u===void 0?"50%":u,s=a.originY,c=s===void 0?"50%":s,E=a.originZ,m=E===void 0?0:E;return p+" "+c+" "+m}function gP(a){return a.startsWith("--")}var J4=function(a,u){return u&&typeof a=="number"?u.transform(a):a},vP=function(a,u){return function(p){return Math.max(Math.min(p,u),a)}},lu=function(a){return a%1?Number(a.toFixed(5)):a},uu=/(-)?([\d]*\.?[\d])+/g,nv=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,eH=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function hu(a){return typeof a=="string"}var Ga={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},du=ht(ht({},Ga),{transform:vP(0,1)}),rf=ht(ht({},Ga),{default:1}),fu=function(a){return{test:function(u){return hu(u)&&u.endsWith(a)&&u.split(" ").length===1},parse:parseFloat,transform:function(u){return""+u+a}}},ua=fu("deg"),ac=fu("%"),kt=fu("px"),tH=fu("vh"),nH=fu("vw"),bP=ht(ht({},ac),{parse:function(a){return ac.parse(a)/100},transform:function(a){return ac.transform(a*100)}}),rv=function(a,u){return function(p){return Boolean(hu(p)&&eH.test(p)&&p.startsWith(a)||u&&Object.prototype.hasOwnProperty.call(p,u))}},yP=function(a,u,p){return function(s){var c;if(!hu(s))return s;var E=s.match(uu),m=E[0],S=E[1],h=E[2],C=E[3];return c={},c[a]=parseFloat(m),c[u]=parseFloat(S),c[p]=parseFloat(h),c.alpha=C!==void 0?parseFloat(C):1,c}},sc={test:rv("hsl","hue"),parse:yP("hue","saturation","lightness"),transform:function(a){var u=a.hue,p=a.saturation,s=a.lightness,c=a.alpha,E=c===void 0?1:c;return"hsla("+Math.round(u)+", "+ac.transform(lu(p))+", "+ac.transform(lu(s))+", "+lu(du.transform(E))+")"}},rH=vP(0,255),iv=ht(ht({},Ga),{transform:function(a){return Math.round(rH(a))}}),cc={test:rv("rgb","red"),parse:yP("red","green","blue"),transform:function(a){var u=a.red,p=a.green,s=a.blue,c=a.alpha,E=c===void 0?1:c;return"rgba("+iv.transform(u)+", "+iv.transform(p)+", "+iv.transform(s)+", "+lu(du.transform(E))+")"}};function iH(a){var u="",p="",s="",c="";return a.length>5?(u=a.substr(1,2),p=a.substr(3,2),s=a.substr(5,2),c=a.substr(7,2)):(u=a.substr(1,1),p=a.substr(2,1),s=a.substr(3,1),c=a.substr(4,1),u+=u,p+=p,s+=s,c+=c),{red:parseInt(u,16),green:parseInt(p,16),blue:parseInt(s,16),alpha:c?parseInt(c,16)/255:1}}var ov={test:rv("#"),parse:iH,transform:cc.transform},Ur={test:function(a){return cc.test(a)||ov.test(a)||sc.test(a)},parse:function(a){return cc.test(a)?cc.parse(a):sc.test(a)?sc.parse(a):ov.parse(a)},transform:function(a){return hu(a)?a:a.hasOwnProperty("red")?cc.transform(a):sc.transform(a)}},TP="${c}",EP="${n}";function oH(a){var u,p,s,c;return isNaN(a)&&hu(a)&&((p=(u=a.match(uu))===null||u===void 0?void 0:u.length)!==null&&p!==void 0?p:0)+((c=(s=a.match(nv))===null||s===void 0?void 0:s.length)!==null&&c!==void 0?c:0)>0}function SP(a){var u=[],p=0,s=a.match(nv);s&&(p=s.length,a=a.replace(nv,TP),u.push.apply(u,s.map(Ur.parse)));var c=a.match(uu);return c&&(a=a.replace(uu,EP),u.push.apply(u,c.map(Ga.parse))),{values:u,numColors:p,tokenised:a}}function xP(a){return SP(a).values}function AP(a){var u=SP(a),p=u.values,s=u.numColors,c=u.tokenised,E=p.length;return function(m){for(var S=c,h=0;h<E;h++)S=S.replace(h<s?TP:EP,h<s?Ur.transform(m[h]):lu(m[h]));return S}}var aH=function(a){return typeof a=="number"?0:a};function sH(a){var u=xP(a),p=AP(a);return p(u.map(aH))}var yo={test:oH,parse:xP,createTransformer:AP,getAnimatableNone:sH},cH=new Set(["brightness","contrast","saturate","opacity"]);function lH(a){var u=a.slice(0,-1).split("("),p=u[0],s=u[1];if(p==="drop-shadow")return a;var c=(s.match(uu)||[])[0];if(!c)return a;var E=s.replace(c,""),m=cH.has(p)?1:0;return c!==s&&(m*=100),p+"("+m+E+")"}var uH=/([a-z-]*)\(.*?\)/g,av=ht(ht({},yo),{getAnimatableNone:function(a){var u=a.match(uH);return u?u.map(lH).join(" "):a}}),PP=ht(ht({},Ga),{transform:Math.round}),CP={borderWidth:kt,borderTopWidth:kt,borderRightWidth:kt,borderBottomWidth:kt,borderLeftWidth:kt,borderRadius:kt,radius:kt,borderTopLeftRadius:kt,borderTopRightRadius:kt,borderBottomRightRadius:kt,borderBottomLeftRadius:kt,width:kt,maxWidth:kt,height:kt,maxHeight:kt,size:kt,top:kt,right:kt,bottom:kt,left:kt,padding:kt,paddingTop:kt,paddingRight:kt,paddingBottom:kt,paddingLeft:kt,margin:kt,marginTop:kt,marginRight:kt,marginBottom:kt,marginLeft:kt,rotate:ua,rotateX:ua,rotateY:ua,rotateZ:ua,scale:rf,scaleX:rf,scaleY:rf,scaleZ:rf,skew:ua,skewX:ua,skewY:ua,distance:kt,translateX:kt,translateY:kt,translateZ:kt,x:kt,y:kt,z:kt,perspective:kt,transformPerspective:kt,opacity:du,originX:bP,originY:bP,originZ:kt,zIndex:PP,fillOpacity:du,strokeOpacity:du,numOctaves:PP};function sv(a,u,p,s,c,E,m,S){var h,C=a.style,R=a.vars,I=a.transform,b=a.transformKeys,f=a.transformOrigin;b.length=0;var x=!1,P=!1,A=!0;for(var T in u){var _=u[T];if(gP(T)){R[T]=_;continue}var g=CP[T],M=J4(_,g);if(nf(T)){if(x=!0,I[T]=M,b.push(T),!A)continue;_!==((h=g.default)!==null&&h!==void 0?h:0)&&(A=!1)}else if(mP(T))f[T]=M,P=!0;else if((p==null?void 0:p.isHydrated)&&(s==null?void 0:s.isHydrated)&&su[T]){var O=su[T].process(_,s,p),N=su[T].applyTo;if(N)for(var V=N.length,U=0;U<V;U++)C[N[U]]=O;else C[T]=O}else C[T]=M}s&&p&&m&&S?(C.transform=m(s.deltaFinal,s.treeScale,x?I:void 0),E&&(C.transform=E(I,C.transform)),C.transformOrigin=S(s)):(x&&(C.transform=Z4(a,c,A,E)),P&&(C.transformOrigin=$4(f)))}var cv=function(){return{style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}}};function RP(a,u,p){for(var s in u)!la(u[s])&&!_P(s,p)&&(a[s]=u[s])}function hH(a,u,p){var s=a.transformTemplate;return Hn(function(){var c=cv();sv(c,u,void 0,void 0,{enableHardwareAcceleration:!p},s);var E=c.vars,m=c.style;return ht(ht({},E),m)},[u])}function dH(a,u,p){var s=a.style||{},c={};return RP(c,s,a),Object.assign(c,hH(a,u,p)),a.transformValues&&(c=a.transformValues(c)),c}function fH(a,u,p){var s={},c=dH(a,u,p);return Boolean(a.drag)&&(s.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=a.drag===!0?"none":"pan-"+(a.drag==="x"?"y":"x")),s.style=c,s}var pH=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","layout","layoutId","_layoutResetTransform","onLayoutAnimationComplete","onViewportBoxUpdate","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","whileDrag","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","onHoverStart","onHoverEnd","whileFocus","whileTap","whileHover"]);function of(a){return pH.has(a)}var OP=function(a){return!of(a)};try{var mH=require("@emotion/is-prop-valid").default;OP=function(a){return a.startsWith("on")?!of(a):mH(a)}}catch(a){}function _H(a,u,p){var s={};for(var c in a)(OP(c)||p===!0&&of(c)||!u&&!of(c))&&(s[c]=a[c]);return s}function MP(a,u,p){return typeof a=="string"?a:kt.transform(u+p*a)}function gH(a,u,p){var s=MP(u,a.x,a.width),c=MP(p,a.y,a.height);return s+" "+c}var lv=function(a,u){return kt.transform(a*u)},vH={offset:"stroke-dashoffset",array:"stroke-dasharray"},bH={offset:"strokeDashoffset",array:"strokeDasharray"};function yH(a,u,p,s,c,E){s===void 0&&(s=1),c===void 0&&(c=0),E===void 0&&(E=!0);var m=E?vH:bH;a[m.offset]=lv(-c,u);var S=lv(p,u),h=lv(s,u);a[m.array]=S+" "+h}function uv(a,u,p,s,c,E,m,S){var h=u.attrX,C=u.attrY,R=u.originX,I=u.originY,b=u.pathLength,f=u.pathSpacing,x=f===void 0?1:f,P=u.pathOffset,A=P===void 0?0:P,T=ri(u,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]);sv(a,T,p,s,c,E,m,S),a.attrs=a.style,a.style={};var _=a.attrs,g=a.style,M=a.dimensions,O=a.totalPathLength;_.transform&&(M&&(g.transform=_.transform),delete _.transform),M&&(R!==void 0||I!==void 0||g.transform)&&(g.transformOrigin=gH(M,R!==void 0?R:.5,I!==void 0?I:.5)),h!==void 0&&(_.x=h),C!==void 0&&(_.y=C),O!==void 0&&b!==void 0&&yH(_,O,b,x,A,!1)}var IP=function(){return ht(ht({},cv()),{attrs:{}})};function TH(a,u){var p=Hn(function(){var c=IP();return uv(c,u,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),ht(ht({},c.attrs),{style:ht({},c.style)})},[u]);if(a.style){var s={};RP(s,a.style,a),p.style=ht(ht({},s),p.style)}return p}function EH(a){a===void 0&&(a=!1);var u=function(p,s,c,E,m){var S=E.latestValues,h=tv(p)?TH:fH,C=h(s,S,m),R=_H(s,typeof p=="string",a),I=ht(ht(ht({},R),C),{ref:c});return $e(p,I)};return u}var SH=/([a-z])([A-Z])/g,xH="$1-$2",DP=function(a){return a.replace(SH,xH).toLowerCase()};function wP(a,u){var p=u.style,s=u.vars;Object.assign(a.style,p);for(var c in s)a.style.setProperty(c,s[c])}var LP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform"]);function NP(a,u){wP(a,u);for(var p in u.attrs)a.setAttribute(LP.has(p)?p:DP(p),u.attrs[p])}function hv(a){var u=a.style,p={};for(var s in u)(la(u[s])||_P(s,a))&&(p[s]=u[s]);return p}function FP(a){var u=hv(a);for(var p in a)if(la(a[p])){var s=p==="x"||p==="y"?"attr"+p.toUpperCase():p;u[s]=a[p]}return u}function dv(a){return typeof a=="object"&&typeof a.start=="function"}var pu=function(a){return Array.isArray(a)},AH=function(a){return Boolean(a&&typeof a=="object"&&a.mix&&a.toValue)},PH=function(a){return pu(a)?a[a.length-1]||0:a};function CH(a){var u=la(a)?a.get():a;return AH(u)?u.toValue():u}function BP(a,u,p,s){var c=a.scrapeMotionValuesFromProps,E=a.createRenderState,m=a.onMount,S={latestValues:RH(u,p,s,c),renderState:E()};return m&&(S.mount=function(h){return m(u,h,S)}),S}var UP=function(a){return function(u,p){var s=cn(Jd),c=cn(iu);return p?BP(a,u,s,c):ou(function(){return BP(a,u,s,c)})}};function RH(a,u,p,s){var c={},E=(p==null?void 0:p.initial)===!1,m=s(a);for(var S in m)c[S]=CH(m[S]);var h=a.initial,C=a.animate,R=tf(a),I=fP(a);u&&I&&!R&&a.inherit!==!1&&(h??(h=u.initial),C??(C=u.animate));var b=E||h===!1?C:h;if(b&&typeof b!="boolean"&&!dv(b)){var f=Array.isArray(b)?b:[b];f.forEach(function(x){var P=dP(a,x);if(!!P){var A=P.transitionEnd;P.transition;var T=ri(P,["transitionEnd","transition"]);for(var _ in T)c[_]=T[_];for(var _ in A)c[_]=A[_]}})}return c}var OH={useVisualState:UP({scrapeMotionValuesFromProps:FP,createRenderState:IP,onMount:function(a,u,p){var s=p.renderState,c=p.latestValues;try{s.dimensions=typeof u.getBBox=="function"?u.getBBox():u.getBoundingClientRect()}catch(E){s.dimensions={x:0,y:0,width:0,height:0}}MH(u)&&(s.totalPathLength=u.getTotalLength()),uv(s,c,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),NP(u,s)}})};function MH(a){return a.tagName==="path"}var IH={useVisualState:UP({scrapeMotionValuesFromProps:hv,createRenderState:cv})};function DH(a,u,p,s){var c=u.forwardMotionProps,E=c===void 0?!1:c,m=tv(a)?OH:IH;return ht(ht({},m),{preloadedFeatures:p,useRender:EH(E),createVisualElement:s,Component:a})}var Zn;(function(a){a.Animate="animate",a.Hover="whileHover",a.Tap="whileTap",a.Drag="whileDrag",a.Focus="whileFocus",a.Exit="exit"})(Zn||(Zn={}));function fv(a,u,p,s){return a.addEventListener(u,p,s),function(){return a.removeEventListener(u,p,s)}}function pv(a,u,p,s){Vt(function(){var c=a.current;if(p&&c)return fv(c,u,p,s)},[a,u,p,s])}function wH(a){var u=a.whileFocus,p=a.visualElement,s=function(){var E;(E=p.animationState)===null||E===void 0||E.setActive(Zn.Focus,!0)},c=function(){var E;(E=p.animationState)===null||E===void 0||E.setActive(Zn.Focus,!1)};pv(p,"focus",u?s:void 0),pv(p,"blur",u?c:void 0)}function VP(a){return typeof PointerEvent!="undefined"&&a instanceof PointerEvent?a.pointerType==="mouse":a instanceof MouseEvent}function kP(a){var u=!!a.touches;return u}function LH(a){return function(u){var p=u instanceof MouseEvent,s=!p||p&&u.button===0;s&&a(u)}}var NH={pageX:0,pageY:0};function FH(a,u){u===void 0&&(u="page");var p=a.touches[0]||a.changedTouches[0],s=p||NH;return{x:s[u+"X"],y:s[u+"Y"]}}function BH(a,u){return u===void 0&&(u="page"),{x:a[u+"X"],y:a[u+"Y"]}}function mv(a,u){return u===void 0&&(u="page"),{point:kP(a)?FH(a,u):BH(a,u)}}function UH(a){return mv(a,"client")}var jP=function(a,u){u===void 0&&(u=!1);var p=function(s){return a(s,mv(s))};return u?LH(p):p},VH=function(){return au&&window.onpointerdown===null},kH=function(){return au&&window.ontouchstart===null},jH=function(){return au&&window.onmousedown===null},zH={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},GH={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function zP(a){return VH()?a:kH()?GH[a]:jH()?zH[a]:a}function lc(a,u,p,s){return fv(a,zP(u),jP(p,u==="pointerdown"),s)}function af(a,u,p,s){return pv(a,zP(u),p&&jP(p,u==="pointerdown"),s)}function GP(a){var u=null;return function(){var p=function(){u=null};return u===null?(u=a,p):!1}}var HP=GP("dragHorizontal"),WP=GP("dragVertical");function XP(a){var u=!1;if(a==="y")u=WP();else if(a==="x")u=HP();else{var p=HP(),s=WP();p&&s?u=function(){p(),s()}:(p&&p(),s&&s())}return u}function YP(){var a=XP(!0);return a?(a(),!1):!0}function KP(a,u,p){return function(s,c){var E;!VP(s)||YP()||(p==null||p(s,c),(E=a.animationState)===null||E===void 0||E.setActive(Zn.Hover,u))}}function HH(a){var u=a.onHoverStart,p=a.onHoverEnd,s=a.whileHover,c=a.visualElement;af(c,"pointerenter",u||s?KP(c,!0,u):void 0),af(c,"pointerleave",p||s?KP(c,!1,p):void 0)}var QP=function(a,u){return u?a===u?!0:QP(a,u.parentElement):!1};function _v(a){return Vt(function(){return function(){return a()}},[])}var sf=function(a,u,p){return Math.min(Math.max(p,a),u)},gv=.001,WH=.01,XH=10,YH=.05,KH=1;function QH(a){var u=a.duration,p=u===void 0?800:u,s=a.bounce,c=s===void 0?.25:s,E=a.velocity,m=E===void 0?0:E,S=a.mass,h=S===void 0?1:S,C,R,I=1-c;I=sf(YH,KH,I),p=sf(WH,XH,p/1e3),I<1?(C=function(P){var A=P*I,T=A*p,_=A-m,g=vv(P,I),M=Math.exp(-T);return gv-_/g*M},R=function(P){var A=P*I,T=A*p,_=T*m+m,g=Math.pow(I,2)*Math.pow(P,2)*p,M=Math.exp(-T),O=vv(Math.pow(P,2),I),N=-C(P)+gv>0?-1:1;return N*((_-g)*M)/O}):(C=function(P){var A=Math.exp(-P*p),T=(P-m)*p+1;return-gv+A*T},R=function(P){var A=Math.exp(-P*p),T=(m-P)*(p*p);return A*T});var b=5/p,f=ZH(C,R,b);if(p=p*1e3,isNaN(f))return{stiffness:100,damping:10,duration:p};var x=Math.pow(f,2)*h;return{stiffness:x,damping:I*2*Math.sqrt(h*x),duration:p}}var qH=12;function ZH(a,u,p){for(var s=p,c=1;c<qH;c++)s=s-a(s)/u(s);return s}function vv(a,u){return a*Math.sqrt(1-u*u)}var $H=["duration","bounce"],JH=["stiffness","damping","mass"];function qP(a,u){return u.some(function(p){return a[p]!==void 0})}function eW(a){var u=ht({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},a);if(!qP(a,JH)&&qP(a,$H)){var p=QH(a);u=ht(ht(ht({},u),p),{velocity:0,mass:1}),u.isResolvedFromDuration=!0}return u}function bv(a){var u=a.from,p=u===void 0?0:u,s=a.to,c=s===void 0?1:s,E=a.restSpeed,m=E===void 0?2:E,S=a.restDelta,h=ri(a,["from","to","restSpeed","restDelta"]),C={done:!1,value:p},R=eW(h),I=R.stiffness,b=R.damping,f=R.mass,x=R.velocity,P=R.duration,A=R.isResolvedFromDuration,T=ZP,_=ZP;function g(){var M=x?-(x/1e3):0,O=c-p,N=b/(2*Math.sqrt(I*f)),V=Math.sqrt(I/f)/1e3;if(S??(S=Math.abs(c-p)<=1?.01:.4),N<1){var U=vv(V,N);T=function(j){var Y=Math.exp(-N*V*j);return c-Y*((M+N*V*O)/U*Math.sin(U*j)+O*Math.cos(U*j))},_=function(j){var Y=Math.exp(-N*V*j);return N*V*Y*(Math.sin(U*j)*(M+N*V*O)/U+O*Math.cos(U*j))-Y*(Math.cos(U*j)*(M+N*V*O)-U*O*Math.sin(U*j))}}else if(N===1)T=function(j){return c-Math.exp(-V*j)*(O+(M+V*O)*j)};else{var L=V*Math.sqrt(N*N-1);T=function(j){var Y=Math.exp(-N*V*j),W=Math.min(L*j,300);return c-Y*((M+N*V*O)*Math.sinh(W)+L*O*Math.cosh(W))/L}}}return g(),{next:function(M){var O=T(M);if(A)C.done=M>=P;else{var N=_(M)*1e3,V=Math.abs(N)<=m,U=Math.abs(c-O)<=S;C.done=V&&U}return C.value=C.done?c:O,C},flipTarget:function(){var M;x=-x,M=[c,p],p=M[0],c=M[1],g()}}}bv.needsInterpolation=function(a,u){return typeof a=="string"||typeof u=="string"};var ZP=function(a){return 0},mu=function(a,u,p){var s=u-a;return s===0?1:(p-a)/s},Xr=function(a,u,p){return-p*a+p*u+a},tW=function(a,u,p){var s=a*a,c=u*u;return Math.sqrt(Math.max(0,p*(c-s)+s))},nW=[ov,cc,sc],$P=function(a){return nW.find(function(u){return u.test(a)})},JP=function(a,u){var p=$P(a),s=$P(u);ru(p.transform===s.transform);var c=p.parse(a),E=s.parse(u),m=ht({},c),S=p===sc?Xr:tW;return function(h){for(var C in m)C!=="alpha"&&(m[C]=S(c[C],E[C],h));return m.alpha=Xr(c.alpha,E.alpha,h),p.transform(m)}},yv=function(a){return typeof a=="number"},rW=function(a,u){return function(p){return u(a(p))}},_u=function(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return a.reduce(rW)};function eC(a,u){return yv(a)?function(p){return Xr(a,u,p)}:Ur.test(a)?JP(a,u):rC(a,u)}var tC=function(a,u){var p=Br([],a),s=p.length,c=a.map(function(E,m){return eC(E,u[m])});return function(E){for(var m=0;m<s;m++)p[m]=c[m](E);return p}},iW=function(a,u){var p=ht(ht({},a),u),s={};for(var c in p)a[c]!==void 0&&u[c]!==void 0&&(s[c]=eC(a[c],u[c]));return function(E){for(var m in s)p[m]=s[m](E);return p}};function nC(a){for(var u=yo.parse(a),p=u.length,s=0,c=0,E=0,m=0;m<p;m++)s||typeof u[m]=="number"?s++:u[m].hue!==void 0?E++:c++;return{parsed:u,numNumbers:s,numRGB:c,numHSL:E}}var rC=function(a,u){var p=yo.createTransformer(u),s=nC(a),c=nC(u);return _u(tC(s.parsed,c.parsed),p)},oW=function(a,u){return function(p){return Xr(a,u,p)}};function aW(a){if(typeof a=="number")return oW;if(typeof a=="string")return Ur.test(a)?JP:rC;if(Array.isArray(a))return tC;if(typeof a=="object")return iW}function sW(a,u,p){for(var s=[],c=p||aW(a[0]),E=a.length-1,m=0;m<E;m++){var S=c(a[m],a[m+1]);if(u){var h=Array.isArray(u)?u[m]:u;S=_u(h,S)}s.push(S)}return s}function cW(a,u){var p=a[0],s=a[1],c=u[0];return function(E){return c(mu(p,s,E))}}function lW(a,u){var p=a.length,s=p-1;return function(c){var E=0,m=!1;if(c<=a[0]?m=!0:c>=a[s]&&(E=s-1,m=!0),!m){for(var S=1;S<p&&!(a[S]>c||S===s);S++);E=S-1}var h=mu(a[E],a[E+1],c);return u[E](h)}}function iC(a,u,p){var s=p===void 0?{}:p,c=s.clamp,E=c===void 0?!0:c,m=s.ease,S=s.mixer,h=a.length;ru(h===u.length),ru(!m||!Array.isArray(m)||m.length===h-1),a[0]>a[h-1]&&(a=[].concat(a),u=[].concat(u),a.reverse(),u.reverse());var C=sW(u,m,S),R=h===2?cW(a,C):lW(a,C);return E?function(I){return R(sf(a[0],a[h-1],I))}:R}var cf=function(a){return function(u){return 1-a(1-u)}},Tv=function(a){return function(u){return u<=.5?a(2*u)/2:(2-a(2*(1-u)))/2}},uW=function(a){return function(u){return Math.pow(u,a)}},oC=function(a){return function(u){return u*u*((a+1)*u-a)}},hW=function(a){var u=oC(a);return function(p){return(p*=2)<1?.5*u(p):.5*(2-Math.pow(2,-10*(p-1)))}},aC=1.525,dW=4/11,fW=8/11,pW=9/10,sC=function(a){return a},Ev=uW(2),mW=cf(Ev),cC=Tv(Ev),lC=function(a){return 1-Math.sin(Math.acos(a))},uC=cf(lC),_W=Tv(uC),Sv=oC(aC),gW=cf(Sv),vW=Tv(Sv),bW=hW(aC),yW=4356/361,TW=35442/1805,EW=16061/1805,lf=function(a){if(a===1||a===0)return a;var u=a*a;return a<dW?7.5625*u:a<fW?9.075*u-9.9*a+3.4:a<pW?yW*u-TW*a+EW:10.8*a*a-20.52*a+10.72},SW=cf(lf),xW=function(a){return a<.5?.5*(1-lf(1-a*2)):.5*lf(a*2-1)+.5};function AW(a,u){return a.map(function(){return u||cC}).splice(0,a.length-1)}function PW(a){var u=a.length;return a.map(function(p,s){return s!==0?s/(u-1):0})}function CW(a,u){return a.map(function(p){return p*u})}function uf(a){var u=a.from,p=u===void 0?0:u,s=a.to,c=s===void 0?1:s,E=a.ease,m=a.offset,S=a.duration,h=S===void 0?300:S,C={done:!1,value:p},R=Array.isArray(c)?c:[p,c],I=CW(m&&m.length===R.length?m:PW(R),h);function b(){return iC(I,R,{ease:Array.isArray(E)?E:AW(R,E)})}var f=b();return{next:function(x){return C.value=f(x),C.done=x>=h,C},flipTarget:function(){R.reverse(),f=b()}}}function RW(a){var u=a.velocity,p=u===void 0?0:u,s=a.from,c=s===void 0?0:s,E=a.power,m=E===void 0?.8:E,S=a.timeConstant,h=S===void 0?350:S,C=a.restDelta,R=C===void 0?.5:C,I=a.modifyTarget,b={done:!1,value:c},f=m*p,x=c+f,P=I===void 0?x:I(x);return P!==x&&(f=P-c),{next:function(A){var T=-f*Math.exp(-A/h);return b.done=!(T>R||T<-R),b.value=b.done?P:P+T,b},flipTarget:function(){}}}var hC={keyframes:uf,spring:bv,decay:RW};function OW(a){if(Array.isArray(a.to))return uf;if(hC[a.type])return hC[a.type];var u=new Set(Object.keys(a));return u.has("ease")||u.has("duration")&&!u.has("dampingRatio")?uf:u.has("dampingRatio")||u.has("stiffness")||u.has("mass")||u.has("damping")||u.has("restSpeed")||u.has("restDelta")?bv:uf}function dC(a,u,p){return p===void 0&&(p=0),a-u-p}function MW(a,u,p,s){return p===void 0&&(p=0),s===void 0&&(s=!0),s?dC(u+-a,u,p):u-(a-u)+p}function IW(a,u,p,s){return s?a>=u+p:a<=-p}var DW=function(a){var u=function(p){var s=p.delta;return a(s)};return{start:function(){return qi.update(u,!0)},stop:function(){return zl.update(u)}}};function fC(a){var u,p,s=a.from,c=a.autoplay,E=c===void 0?!0:c,m=a.driver,S=m===void 0?DW:m,h=a.elapsed,C=h===void 0?0:h,R=a.repeat,I=R===void 0?0:R,b=a.repeatType,f=b===void 0?"loop":b,x=a.repeatDelay,P=x===void 0?0:x,A=a.onPlay,T=a.onStop,_=a.onComplete,g=a.onRepeat,M=a.onUpdate,O=ri(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),N=O.to,V,U=0,L=O.duration,j,Y=!1,W=!0,ie,re=OW(O);((p=(u=re).needsInterpolation)===null||p===void 0?void 0:p.call(u,s,N))&&(ie=iC([0,100],[s,N],{clamp:!1}),s=0,N=100);var ye=re(ht(ht({},O),{from:s,to:N}));function ve(){U++,f==="reverse"?(W=U%2==0,C=MW(C,L,P,W)):(C=dC(C,L,P),f==="mirror"&&ye.flipTarget()),Y=!1,g&&g()}function ue(){V.stop(),_&&_()}function oe(J){if(W||(J=-J),C+=J,!Y){var B=ye.next(Math.max(0,C));j=B.value,ie&&(j=ie(j)),Y=W?B.done:C<=0}M==null||M(j),Y&&(U===0&&(L??(L=C)),U<I?IW(C,L,P,W)&&ve():ue())}function Z(){A==null||A(),V=S(oe),V.start()}return E&&Z(),{stop:function(){T==null||T(),V.stop()}}}function pC(a,u){return u?a*(1e3/u):0}function wW(a){var u=a.from,p=u===void 0?0:u,s=a.velocity,c=s===void 0?0:s,E=a.min,m=a.max,S=a.power,h=S===void 0?.8:S,C=a.timeConstant,R=C===void 0?750:C,I=a.bounceStiffness,b=I===void 0?500:I,f=a.bounceDamping,x=f===void 0?10:f,P=a.restDelta,A=P===void 0?1:P,T=a.modifyTarget,_=a.driver,g=a.onUpdate,M=a.onComplete,O;function N(ve){return E!==void 0&&ve<E||m!==void 0&&ve>m}function V(ve){return E===void 0?m:m===void 0||Math.abs(E-ve)<Math.abs(m-ve)?E:m}function U(ve){O==null||O.stop(),O=fC(ht(ht({},ve),{driver:_,onUpdate:function(ue){var oe;g==null||g(ue),(oe=ve.onUpdate)===null||oe===void 0||oe.call(ve,ue)},onComplete:M}))}function L(ve){U(ht({type:"spring",stiffness:b,damping:x,restDelta:A},ve))}if(N(p))L({from:p,velocity:c,to:V(p)});else{var j=h*c+p;typeof T!="undefined"&&(j=T(j));var Y=V(j),W=Y===E?-1:1,ie,re,ye=function(ve){ie=re,re=ve,c=pC(ve-ie,Bd().delta),(W===1&&ve>Y||W===-1&&ve<Y)&&L({from:ve,to:Y,velocity:c})};U({type:"decay",from:p,velocity:c,timeConstant:R,power:h,restDelta:A,modifyTarget:T,onUpdate:N(j)?ye:void 0})}return{stop:function(){return O==null?void 0:O.stop()}}}var xv=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},mC=function(a){return xv(a)&&a.hasOwnProperty("z")},hf=function(a,u){return Math.abs(a-u)};function _C(a,u){if(yv(a)&&yv(u))return hf(a,u);if(xv(a)&&xv(u)){var p=hf(a.x,u.x),s=hf(a.y,u.y),c=mC(a)&&mC(u)?hf(a.z,u.z):0;return Math.sqrt(Math.pow(p,2)+Math.pow(s,2)+Math.pow(c,2))}}var gC=function(a,u){return 1-3*u+3*a},vC=function(a,u){return 3*u-6*a},bC=function(a){return 3*a},df=function(a,u,p){return((gC(u,p)*a+vC(u,p))*a+bC(u))*a},yC=function(a,u,p){return 3*gC(u,p)*a*a+2*vC(u,p)*a+bC(u)},LW=1e-7,NW=10;function FW(a,u,p,s,c){var E,m,S=0;do m=u+(p-u)/2,E=df(m,s,c)-a,E>0?p=m:u=m;while(Math.abs(E)>LW&&++S<NW);return m}var BW=8,UW=.001;function VW(a,u,p,s){for(var c=0;c<BW;++c){var E=yC(u,p,s);if(E===0)return u;var m=df(u,p,s)-a;u-=m/E}return u}var ff=11,pf=1/(ff-1);function kW(a,u,p,s){if(a===u&&p===s)return sC;for(var c=new Float32Array(ff),E=0;E<ff;++E)c[E]=df(E*pf,a,p);function m(S){for(var h=0,C=1,R=ff-1;C!==R&&c[C]<=S;++C)h+=pf;--C;var I=(S-c[C])/(c[C+1]-c[C]),b=h+I*pf,f=yC(b,a,p);return f>=UW?VW(S,b,a,p):f===0?b:FW(S,h,h+pf,a,p)}return function(S){return S===0||S===1?S:df(m(S),u,s)}}function jW(a){var u=a.onTap,p=a.onTapStart,s=a.onTapCancel,c=a.whileTap,E=a.visualElement,m=u||p||s||c,S=zt(!1),h=zt(null);function C(){var x;(x=h.current)===null||x===void 0||x.call(h),h.current=null}function R(){var x;return C(),S.current=!1,(x=E.animationState)===null||x===void 0||x.setActive(Zn.Tap,!1),!YP()}function I(x,P){!R()||(QP(E.getInstance(),x.target)?u==null||u(x,P):s==null||s(x,P))}function b(x,P){!R()||s==null||s(x,P)}function f(x,P){var A;C(),!S.current&&(S.current=!0,h.current=_u(lc(window,"pointerup",I),lc(window,"pointercancel",b)),p==null||p(x,P),(A=E.animationState)===null||A===void 0||A.setActive(Zn.Tap,!0))}af(E,"pointerdown",m?f:void 0),_v(C)}var Ha=function(a){return function(u){return a(u),null}},zW={tap:Ha(jW),focus:Ha(wH),hover:Ha(HH)};function TC(a,u){if(!Array.isArray(u))return!1;var p=u.length;if(p!==a.length)return!1;for(var s=0;s<p;s++)if(u[s]!==a[s])return!1;return!0}var mf=function(a){return a*1e3},GW={linear:sC,easeIn:Ev,easeInOut:cC,easeOut:mW,circIn:lC,circInOut:_W,circOut:uC,backIn:Sv,backInOut:vW,backOut:gW,anticipate:bW,bounceIn:SW,bounceInOut:xW,bounceOut:lf},EC=function(a){if(Array.isArray(a)){ru(a.length===4);var u=Wn(a,4),p=u[0],s=u[1],c=u[2],E=u[3];return kW(p,s,c,E)}else if(typeof a=="string")return GW[a];return a},HW=function(a){return Array.isArray(a)&&typeof a[0]!="number"},SC=function(a,u){return a==="zIndex"?!1:!!(typeof u=="number"||Array.isArray(u)||typeof u=="string"&&yo.test(u)&&!u.startsWith("url("))},Wa=function(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}},_f=function(a){return{type:"spring",stiffness:550,damping:a===0?2*Math.sqrt(550):30,restDelta:.01,restSpeed:10}},Av=function(){return{type:"keyframes",ease:"linear",duration:.3}},WW=function(a){return{type:"keyframes",duration:.8,values:a}},xC={x:Wa,y:Wa,z:Wa,rotate:Wa,rotateX:Wa,rotateY:Wa,rotateZ:Wa,scaleX:_f,scaleY:_f,scale:_f,opacity:Av,backgroundColor:Av,color:Av,default:_f},XW=function(a,u){var p;return pu(u)?p=WW:p=xC[a]||xC.default,ht({to:u},p(u))},YW=ht(ht({},CP),{color:Ur,backgroundColor:Ur,outlineColor:Ur,fill:Ur,stroke:Ur,borderColor:Ur,borderTopColor:Ur,borderRightColor:Ur,borderBottomColor:Ur,borderLeftColor:Ur,filter:av,WebkitFilter:av}),Pv=function(a){return YW[a]};function Cv(a,u){var p,s=Pv(a);return s!==av&&(s=yo),(p=s.getAnimatableNone)===null||p===void 0?void 0:p.call(s,u)}function KW(a){a.when,a.delay,a.delayChildren,a.staggerChildren,a.staggerDirection,a.repeat,a.repeatType,a.repeatDelay,a.from;var u=ri(a,["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from"]);return!!Object.keys(u).length}function QW(a){var u=a.ease,p=a.times,s=a.yoyo,c=a.flip,E=a.loop,m=ri(a,["ease","times","yoyo","flip","loop"]),S=ht({},m);return p&&(S.offset=p),m.duration&&(S.duration=mf(m.duration)),m.repeatDelay&&(S.repeatDelay=mf(m.repeatDelay)),u&&(S.ease=HW(u)?u.map(EC):EC(u)),m.type==="tween"&&(S.type="keyframes"),(s||E||c)&&(s?S.repeatType="reverse":E?S.repeatType="loop":c&&(S.repeatType="mirror"),S.repeat=E||s||c||m.repeat),m.type!=="spring"&&(S.type="keyframes"),S}function qW(a,u){var p,s=Rv(a,u)||{};return(p=s.delay)!==null&&p!==void 0?p:0}function ZW(a){return Array.isArray(a.to)&&a.to[0]===null&&(a.to=Br([],Wn(a.to)),a.to[0]=a.from),a}function $W(a,u,p){var s;return Array.isArray(u.to)&&((s=a.duration)!==null&&s!==void 0||(a.duration=.8)),ZW(u),KW(a)||(a=ht(ht({},a),XW(p,u.to))),ht(ht({},u),QW(a))}function JW(a,u,p,s,c){var E,m=Rv(s,a),S=(E=m.from)!==null&&E!==void 0?E:u.get(),h=SC(a,p);S==="none"&&h&&typeof p=="string"?S=Cv(a,p):AC(S)&&typeof p=="string"?S=PC(p):!Array.isArray(p)&&AC(p)&&typeof S=="string"&&(p=PC(S));var C=SC(a,S);function R(){var b={from:S,to:p,velocity:u.getVelocity(),onComplete:c,onUpdate:function(f){return u.set(f)}};return m.type==="inertia"||m.type==="decay"?wW(ht(ht({},b),m)):fC(ht(ht({},$W(m,b,a)),{onUpdate:function(f){var x;b.onUpdate(f),(x=m.onUpdate)===null||x===void 0||x.call(m,f)},onComplete:function(){var f;b.onComplete(),(f=m.onComplete)===null||f===void 0||f.call(m)}}))}function I(){var b;return u.set(p),c(),(b=m==null?void 0:m.onComplete)===null||b===void 0||b.call(m),{stop:function(){}}}return!C||!h||m.type===!1?I:R}function AC(a){return a===0||typeof a=="string"&&parseFloat(a)===0&&a.indexOf(" ")===-1}function PC(a){return typeof a=="number"?0:Cv("",a)}function Rv(a,u){return a[u]||a.default||a}function gf(a,u,p,s){return s===void 0&&(s={}),u.start(function(c){var E,m,S=JW(a,u,p,s,c),h=qW(s,a),C=function(){return m=S()};return h?E=setTimeout(C,mf(h)):C(),function(){clearTimeout(E),m==null||m.stop()}})}var e5=function(a){return/^\-?\d*\.?\d+$/.test(a)};function CC(a,u){a.indexOf(u)===-1&&a.push(u)}function RC(a,u){var p=a.indexOf(u);p>-1&&a.splice(p,1)}var vf=function(){function a(){this.subscriptions=[]}return a.prototype.add=function(u){var p=this;return CC(this.subscriptions,u),function(){return RC(p.subscriptions,u)}},a.prototype.notify=function(u,p,s){var c=this.subscriptions.length;if(!!c)if(c===1)this.subscriptions[0](u,p,s);else for(var E=0;E<c;E++){var m=this.subscriptions[E];m&&m(u,p,s)}},a.prototype.getSize=function(){return this.subscriptions.length},a.prototype.clear=function(){this.subscriptions.length=0},a}(),t5=function(a){return!isNaN(parseFloat(a))},n5=function(){function a(u){var p=this;this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new vf,this.velocityUpdateSubscribers=new vf,this.renderSubscribers=new vf,this.canTrackVelocity=!1,this.updateAndNotify=function(s,c){c===void 0&&(c=!0),p.prev=p.current,p.current=s;var E=Bd(),m=E.delta,S=E.timestamp;p.lastUpdated!==S&&(p.timeDelta=m,p.lastUpdated=S,qi.postRender(p.scheduleVelocityCheck)),p.prev!==p.current&&p.updateSubscribers.notify(p.current),p.velocityUpdateSubscribers.getSize()&&p.velocityUpdateSubscribers.notify(p.getVelocity()),c&&p.renderSubscribers.notify(p.current)},this.scheduleVelocityCheck=function(){return qi.postRender(p.velocityCheck)},this.velocityCheck=function(s){var c=s.timestamp;c!==p.lastUpdated&&(p.prev=p.current,p.velocityUpdateSubscribers.notify(p.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=u,this.canTrackVelocity=t5(this.current)}return a.prototype.onChange=function(u){return this.updateSubscribers.add(u)},a.prototype.clearListeners=function(){this.updateSubscribers.clear()},a.prototype.onRenderRequest=function(u){return u(this.get()),this.renderSubscribers.add(u)},a.prototype.attach=function(u){this.passiveEffect=u},a.prototype.set=function(u,p){p===void 0&&(p=!0),!p||!this.passiveEffect?this.updateAndNotify(u,p):this.passiveEffect(u,this.updateAndNotify)},a.prototype.get=function(){return this.current},a.prototype.getPrevious=function(){return this.prev},a.prototype.getVelocity=function(){return this.canTrackVelocity?pC(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},a.prototype.start=function(u){var p=this;return this.stop(),new Promise(function(s){p.hasAnimated=!0,p.stopAnimation=u(s)}).then(function(){return p.clearAnimation()})},a.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},a.prototype.isAnimating=function(){return!!this.stopAnimation},a.prototype.clearAnimation=function(){this.stopAnimation=null},a.prototype.destroy=function(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()},a}();function Xa(a){return new n5(a)}var OC=function(a){return function(u){return u.test(a)}},r5={test:function(a){return a==="auto"},parse:function(a){return a}},MC=[Ga,kt,ac,ua,nH,tH,r5],bf=function(a){return MC.find(OC(a))},i5=Br(Br([],Wn(MC)),[Ur,yo]),o5=function(a){return i5.find(OC(a))};function a5(a,u,p){a.hasValue(u)?a.getValue(u).set(p):a.addValue(u,Xa(p))}function s5(a,u){var p=ef(a,u),s=p?a.makeTargetAnimatable(p,!1):{},c=s.transitionEnd,E=c===void 0?{}:c;s.transition;var m=ri(s,["transitionEnd","transition"]);m=ht(ht({},m),E);for(var S in m){var h=PH(m[S]);a5(a,S,h)}}function c5(a,u,p){var s,c,E,m,S=Object.keys(u).filter(function(f){return!a.hasValue(f)}),h=S.length;if(!!h)for(var C=0;C<h;C++){var R=S[C],I=u[R],b=null;Array.isArray(I)&&(b=I[0]),b===null&&(b=(c=(s=p[R])!==null&&s!==void 0?s:a.readValue(R))!==null&&c!==void 0?c:u[R]),b!=null&&(typeof b=="string"&&e5(b)?b=parseFloat(b):!o5(b)&&yo.test(I)&&(b=Cv(R,I)),a.addValue(R,Xa(b)),(E=(m=p)[R])!==null&&E!==void 0||(m[R]=b),a.setBaseTarget(R,b))}}function l5(a,u){if(!!u){var p=u[a]||u.default||u;return p.from}}function u5(a,u,p){var s,c,E={};for(var m in a)E[m]=(s=l5(m,u))!==null&&s!==void 0?s:(c=p.getValue(m))===null||c===void 0?void 0:c.get();return E}function h5(a,u,p){p===void 0&&(p={}),a.notifyAnimationStart();var s;if(Array.isArray(u)){var c=u.map(function(m){return Ov(a,m,p)});s=Promise.all(c)}else if(typeof u=="string")s=Ov(a,u,p);else{var E=typeof u=="function"?ef(a,u,p.custom):u;s=IC(a,E,p)}return s.then(function(){return a.notifyAnimationComplete(u)})}function Ov(a,u,p){var s;p===void 0&&(p={});var c=ef(a,u,p.custom),E=(c||{}).transition,m=E===void 0?a.getDefaultTransition()||{}:E;p.transitionOverride&&(m=p.transitionOverride);var S=c?function(){return IC(a,c,p)}:function(){return Promise.resolve()},h=((s=a.variantChildren)===null||s===void 0?void 0:s.size)?function(f){f===void 0&&(f=0);var x=m.delayChildren,P=x===void 0?0:x,A=m.staggerChildren,T=m.staggerDirection;return d5(a,u,P+f,A,T,p)}:function(){return Promise.resolve()},C=m.when;if(C){var R=Wn(C==="beforeChildren"?[S,h]:[h,S],2),I=R[0],b=R[1];return I().then(b)}else return Promise.all([S(),h(p.delay)])}function IC(a,u,p){var s,c=p===void 0?{}:p,E=c.delay,m=E===void 0?0:E,S=c.transitionOverride,h=c.type,C=a.makeTargetAnimatable(u),R=C.transition,I=R===void 0?a.getDefaultTransition():R,b=C.transitionEnd,f=ri(C,["transition","transitionEnd"]);S&&(I=S);var x=[],P=h&&((s=a.animationState)===null||s===void 0?void 0:s.getState()[h]);for(var A in f){var T=a.getValue(A),_=f[A];if(!(!T||_===void 0||P&&p5(P,A))){var g=gf(A,T,_,ht({delay:m},I));x.push(g)}}return Promise.all(x).then(function(){b&&s5(a,b)})}function d5(a,u,p,s,c,E){p===void 0&&(p=0),s===void 0&&(s=0),c===void 0&&(c=1);var m=[],S=(a.variantChildren.size-1)*s,h=c===1?function(C){return C===void 0&&(C=0),C*s}:function(C){return C===void 0&&(C=0),S-C*s};return Array.from(a.variantChildren).sort(f5).forEach(function(C,R){m.push(Ov(C,u,ht(ht({},E),{delay:p+h(R)})).then(function(){return C.notifyAnimationComplete(u)}))}),Promise.all(m)}function f5(a,u){return a.sortNodePosition(u)}function p5(a,u){var p=a.protectedKeys,s=a.needsAnimating,c=p.hasOwnProperty(u)&&s[u]!==!0;return s[u]=!1,c}var Mv=[Zn.Animate,Zn.Hover,Zn.Tap,Zn.Drag,Zn.Focus,Zn.Exit],m5=Br([],Wn(Mv)).reverse(),_5=Mv.length;function g5(a){return function(u){return Promise.all(u.map(function(p){var s=p.animation,c=p.options;return h5(a,s,c)}))}}function v5(a){var u=g5(a),p=y5(),s={},c=!0,E=function(R,I){var b=ef(a,I);if(b){b.transition;var f=b.transitionEnd,x=ri(b,["transition","transitionEnd"]);R=ht(ht(ht({},R),x),f)}return R};function m(R){return s[R]!==void 0}function S(R){u=R(a)}function h(R,I){for(var b,f=a.getProps(),x=a.getVariantContext(!0)||{},P=[],A=new Set,T={},_=1/0,g=function(V){var U=m5[V],L=p[U],j=(b=f[U])!==null&&b!==void 0?b:x[U],Y=wi(j),W=U===I?L.isActive:null;W===!1&&(_=V);var ie=j===x[U]&&j!==f[U]&&Y;if(ie&&c&&a.manuallyAnimateOnMount&&(ie=!1),L.protectedKeys=ht({},T),!L.isActive&&W===null||!j&&!L.prevProp||dv(j)||typeof j=="boolean")return"continue";var re=b5(L.prevProp,j)||U===I&&L.isActive&&!ie&&Y||V>_&&Y,ye=Array.isArray(j)?j:[j],ve=ye.reduce(E,{});W===!1&&(ve={});var ue=L.prevResolvedValues,oe=ue===void 0?{}:ue,Z=ht(ht({},oe),ve),J=function(he){re=!0,A.delete(he),L.needsAnimating[he]=!0};for(var B in Z){var G=ve[B],$=oe[B];T.hasOwnProperty(B)||(G!==$?pu(G)&&pu($)?TC(G,$)?L.protectedKeys[B]=!0:J(B):G!==void 0?J(B):A.add(B):G!==void 0&&A.has(B)?J(B):L.protectedKeys[B]=!0)}L.prevProp=j,L.prevResolvedValues=ve,L.isActive&&(T=ht(ht({},T),ve)),c&&a.blockInitialAnimation&&(re=!1),re&&!ie&&P.push.apply(P,Br([],Wn(ye.map(function(he){return{animation:he,options:ht({type:U},R)}}))))},M=0;M<_5;M++)g(M);if(s=ht({},T),A.size){var O={};A.forEach(function(V){var U=a.getBaseTarget(V);U!==void 0&&(O[V]=U)}),P.push({animation:O})}var N=Boolean(P.length);return c&&f.initial===!1&&!a.manuallyAnimateOnMount&&(N=!1),c=!1,N?u(P):Promise.resolve()}function C(R,I,b){var f;return p[R].isActive===I?Promise.resolve():((f=a.variantChildren)===null||f===void 0||f.forEach(function(x){var P;return(P=x.animationState)===null||P===void 0?void 0:P.setActive(R,I)}),p[R].isActive=I,h(b,R))}return{isAnimated:m,animateChanges:h,setActive:C,setAnimateFunction:S,getState:function(){return p}}}function b5(a,u){return typeof u=="string"?u!==a:hP(u)?!TC(u,a):!1}function uc(a){return a===void 0&&(a=!1),{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function y5(){var a;return a={},a[Zn.Animate]=uc(!0),a[Zn.Hover]=uc(),a[Zn.Tap]=uc(),a[Zn.Drag]=uc(),a[Zn.Focus]=uc(),a[Zn.Exit]=uc(),a}var T5={animation:Ha(function(a){var u=a.visualElement,p=a.animate;u.animationState||(u.animationState=v5(u)),dv(p)&&Vt(function(){return p.subscribe(u)},[p])}),exit:Ha(function(a){var u=a.custom,p=a.visualElement,s=Wn(Jg(),2),c=s[0],E=s[1],m=cn(iu);Vt(function(){var S,h,C=(S=p.animationState)===null||S===void 0?void 0:S.setActive(Zn.Exit,!c,{custom:(h=m==null?void 0:m.custom)!==null&&h!==void 0?h:u});!c&&(C==null||C.then(E))},[c])})},DC=function(){function a(u,p,s){var c=this,E=s===void 0?{}:s,m=E.transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(!!(c.lastMoveEvent&&c.lastMoveEventInfo)){var b=Dv(c.lastMoveEventInfo,c.history),f=c.startEvent!==null,x=_C(b.offset,{x:0,y:0})>=3;if(!(!f&&!x)){var P=b.point,A=Bd().timestamp;c.history.push(ht(ht({},P),{timestamp:A}));var T=c.handlers,_=T.onStart,g=T.onMove;f||(_&&_(c.lastMoveEvent,b),c.startEvent=c.lastMoveEvent),g&&g(c.lastMoveEvent,b)}}},this.handlePointerMove=function(b,f){if(c.lastMoveEvent=b,c.lastMoveEventInfo=Iv(f,c.transformPagePoint),VP(b)&&b.buttons===0){c.handlePointerUp(b,f);return}qi.update(c.updatePoint,!0)},this.handlePointerUp=function(b,f){c.end();var x=c.handlers,P=x.onEnd,A=x.onSessionEnd,T=Dv(Iv(f,c.transformPagePoint),c.history);c.startEvent&&P&&P(b,T),A&&A(b,T)},!(kP(u)&&u.touches.length>1)){this.handlers=p,this.transformPagePoint=m;var S=mv(u),h=Iv(S,this.transformPagePoint),C=h.point,R=Bd().timestamp;this.history=[ht(ht({},C),{timestamp:R})];var I=p.onSessionStart;I&&I(u,Dv(h,this.history)),this.removeListeners=_u(lc(window,"pointermove",this.handlePointerMove),lc(window,"pointerup",this.handlePointerUp),lc(window,"pointercancel",this.handlePointerUp))}}return a.prototype.updateHandlers=function(u){this.handlers=u},a.prototype.end=function(){this.removeListeners&&this.removeListeners(),zl.update(this.updatePoint)},a}();function Iv(a,u){return u?{point:u(a.point)}:a}function wC(a,u){return{x:a.x-u.x,y:a.y-u.y}}function Dv(a,u){var p=a.point;return{point:p,delta:wC(p,LC(u)),offset:wC(p,E5(u)),velocity:S5(u,.1)}}function E5(a){return a[0]}function LC(a){return a[a.length-1]}function S5(a,u){if(a.length<2)return{x:0,y:0};for(var p=a.length-1,s=null,c=LC(a);p>=0&&(s=a[p],!(c.timestamp-s.timestamp>mf(u)));)p--;if(!s)return{x:0,y:0};var E=(c.timestamp-s.timestamp)/1e3;if(E===0)return{x:0,y:0};var m={x:(c.x-s.x)/E,y:(c.y-s.y)/E};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function x5(a){return a}function NC(a){var u=a.top,p=a.left,s=a.right,c=a.bottom;return{x:{min:p,max:s},y:{min:u,max:c}}}function A5(a){var u=a.x,p=a.y;return{top:p.min,bottom:p.max,left:u.min,right:u.max}}function P5(a,u){var p=a.top,s=a.left,c=a.bottom,E=a.right;u===void 0&&(u=x5);var m=u({x:s,y:p}),S=u({x:E,y:c});return{top:m.y,left:m.x,bottom:S.y,right:S.x}}function ha(){return{x:{min:0,max:1},y:{min:0,max:1}}}function C5(a){return{x:ht({},a.x),y:ht({},a.y)}}var FC={translate:0,scale:1,origin:0,originPoint:0};function BC(){return{x:ht({},FC),y:ht({},FC)}}function Yr(a){return[a("x"),a("y")]}function UC(a,u,p){var s=u.min,c=u.max;return s!==void 0&&a<s?a=p?Xr(s,a,p.min):Math.max(a,s):c!==void 0&&a>c&&(a=p?Xr(c,a,p.max):Math.min(a,c)),a}function R5(a,u,p,s,c){var E=a-u*p;return s?UC(E,s,c):E}function VC(a,u,p){return{min:u!==void 0?a.min+u:void 0,max:p!==void 0?a.max+p-(a.max-a.min):void 0}}function O5(a,u){var p=u.top,s=u.left,c=u.bottom,E=u.right;return{x:VC(a.x,s,E),y:VC(a.y,p,c)}}function kC(a,u){var p,s=u.min-a.min,c=u.max-a.max;return u.max-u.min<a.max-a.min&&(p=Wn([c,s],2),s=p[0],c=p[1]),{min:a.min+s,max:a.min+c}}function M5(a,u){return{x:kC(a.x,u.x),y:kC(a.y,u.y)}}function I5(a,u,p){var s=a.max-a.min,c=Xr(u.min,u.max-s,p);return{min:c,max:c+s}}function D5(a,u){var p={};return u.min!==void 0&&(p.min=u.min-a.min),u.max!==void 0&&(p.max=u.max-a.min),p}var jC=.35;function w5(a){return a===!1?a=0:a===!0&&(a=jC),{x:zC(a,"left","right"),y:zC(a,"top","bottom")}}function zC(a,u,p){return{min:GC(a,u),max:GC(a,p)}}function GC(a,u){var p;return typeof a=="number"?a:(p=a[u])!==null&&p!==void 0?p:0}function HC(a,u){var p=a.getBoundingClientRect();return NC(P5(p,u))}var L5=function(a){return sf(0,1,a)};function WC(a,u,p){return u===void 0&&(u=0),p===void 0&&(p=.01),_C(a,u)<p}function gu(a){return a.max-a.min}function N5(a,u){var p=.5,s=gu(a),c=gu(u);return c>s?p=mu(u.min,u.max-s,a.min):s>c&&(p=mu(a.min,a.max-c,u.min)),L5(p)}function XC(a,u,p,s){s===void 0&&(s=.5),a.origin=s,a.originPoint=Xr(u.min,u.max,a.origin),a.scale=gu(p)/gu(u),WC(a.scale,1,1e-4)&&(a.scale=1),a.translate=Xr(p.min,p.max,a.origin)-a.originPoint,WC(a.translate)&&(a.translate=0)}function YC(a,u,p,s){XC(a.x,u.x,p.x,KC(s.originX)),XC(a.y,u.y,p.y,KC(s.originY))}function KC(a){return typeof a=="number"?a:.5}function QC(a,u,p){a.min=p.min+u.min,a.max=a.min+gu(u)}function F5(a,u){QC(a.target.x,a.relativeTarget.x,u.target.x),QC(a.target.y,a.relativeTarget.y,u.target.y)}var wv=function(a,u){return a.depth-u.depth};function qC(a){var u=a.projection.isEnabled;return u||a.shouldResetTransform()}function yf(a,u){u===void 0&&(u=[]);var p=a.parent;return p&&yf(p,u),qC(a)&&u.push(a),u}function B5(a){var u=[],p=function(s){qC(s)&&u.push(s),s.children.forEach(p)};return a.children.forEach(p),u.sort(wv)}function Tf(a){if(!a.shouldResetTransform()){var u=a.getLayoutState();a.notifyBeforeLayoutMeasure(u.layout),u.isHydrated=!0,u.layout=a.measureViewportBox(),u.layoutCorrected=C5(u.layout),a.notifyLayoutMeasure(u.layout,a.prevViewportBox||u.layout),qi.update(function(){return a.rebaseProjectionTarget()})}}function U5(a){a.shouldResetTransform()||(a.prevViewportBox=a.measureViewportBox(!1),a.rebaseProjectionTarget(!1,a.prevViewportBox))}function V5(a,u,p,s){a.min=Xr(u.min,p.min,s),a.max=Xr(u.max,p.max,s)}function ZC(a,u){return{min:u.min-a.min,max:u.max-a.min}}function hc(a,u){return{x:ZC(a.x,u.x),y:ZC(a.y,u.y)}}function k5(a,u){var p=a.getLayoutId(),s=u.getLayoutId();return p!==s||s===void 0&&a!==u}function $C(a){var u=a.getProps(),p=u.drag,s=u._dragX;return p&&!s}function JC(a,u){a.min=u.min,a.max=u.max}function j5(a,u){JC(a.x,u.x),JC(a.y,u.y)}function Ef(a,u,p){var s=a-p,c=u*s;return p+c}function eR(a,u,p,s,c){return c!==void 0&&(a=Ef(a,c,s)),Ef(a,p,s)+u}function Lv(a,u,p,s,c){u===void 0&&(u=0),p===void 0&&(p=1),a.min=eR(a.min,u,p,s,c),a.max=eR(a.max,u,p,s,c)}function z5(a,u){var p=u.x,s=u.y;Lv(a.x,p.translate,p.scale,p.originPoint),Lv(a.y,s.translate,s.scale,s.originPoint)}function tR(a,u,p,s){var c=Wn(s,3),E=c[0],m=c[1],S=c[2];a.min=u.min,a.max=u.max;var h=p[S]!==void 0?p[S]:.5,C=Xr(u.min,u.max,h);Lv(a,p[E],p[m],C,p.scale)}var nR=["x","scaleX","originX"],rR=["y","scaleY","originY"];function Nv(a,u,p){tR(a.x,u.x,p,nR),tR(a.y,u.y,p,rR)}function iR(a,u,p,s,c){return a-=u,a=Ef(a,1/p,s),c!==void 0&&(a=Ef(a,1/c,s)),a}function G5(a,u,p,s,c){u===void 0&&(u=0),p===void 0&&(p=1),s===void 0&&(s=.5);var E=Xr(a.min,a.max,s)-u;a.min=iR(a.min,u,p,E,c),a.max=iR(a.max,u,p,E,c)}function oR(a,u,p){var s=Wn(p,3),c=s[0],E=s[1],m=s[2];G5(a,u[c],u[E],u[m],u.scale)}function aR(a,u){oR(a.x,u,nR),oR(a.y,u,rR)}function H5(a,u,p){var s=p.length;if(!!s){u.x=u.y=1;for(var c,E,m=0;m<s;m++)c=p[m],E=c.getLayoutState().delta,u.x*=E.x.scale,u.y*=E.y.scale,z5(a,E),$C(c)&&Nv(a,a,c.getLatestValues())}}function W5(a,u){u===void 0&&(u=!0);var p=a.getProjectionParent();if(!p)return!1;var s;return u?(s=hc(p.projection.target,a.projection.target),aR(s,p.getLatestValues())):s=hc(p.getLayoutState().layout,a.getLayoutState().layout),Yr(function(c){return a.setProjectionTargetAxis(c,s[c].min,s[c].max,!0)}),!0}var vu=new Set;function sR(a,u,p){a[p]||(a[p]=[]),a[p].push(u)}function Fv(a){return vu.add(a),function(){return vu.delete(a)}}function Bv(){if(!!vu.size){var a=0,u=[[]],p=[],s=function(S){return sR(u,S,a)},c=function(S){sR(p,S,a),a++};vu.forEach(function(S){S(s,c),a=0}),vu.clear();for(var E=p.length,m=0;m<=E;m++)u[m]&&u[m].forEach(cR),p[m]&&p[m].forEach(cR)}}var cR=function(a){return a()},X5=new WeakMap,lR,Y5=function(){function a(u){var p=u.visualElement;this.isDragging=!1,this.currentDirection=null,this.constraints=!1,this.elastic=ha(),this.props={},this.hasMutatedConstraints=!1,this.cursorProgress={x:.5,y:.5},this.originPoint={},this.openGlobalLock=null,this.panSession=null,this.visualElement=p,this.visualElement.enableLayoutProjection(),X5.set(p,this)}return a.prototype.start=function(u,p){var s=this,c=p===void 0?{}:p,E=c.snapToCursor,m=E===void 0?!1:E,S=c.cursorProgress,h=function(f){var x;s.stopMotion();var P=UH(f).point;(x=s.cancelLayout)===null||x===void 0||x.call(s),s.cancelLayout=Fv(function(A,T){var _=yf(s.visualElement),g=B5(s.visualElement),M=Br(Br([],Wn(_)),Wn(g)),O=!1;s.isLayoutDrag()&&s.visualElement.lockProjectionTarget(),T(function(){M.forEach(function(N){return N.resetTransform()})}),A(function(){Tf(s.visualElement),g.forEach(Tf)}),T(function(){M.forEach(function(N){return N.restoreTransform()}),m&&(O=s.snapToCursor(P))}),A(function(){var N=Boolean(s.getAxisMotionValue("x")&&!s.isExternalDrag());N||s.visualElement.rebaseProjectionTarget(!0,s.visualElement.measureViewportBox(!1)),s.visualElement.scheduleUpdateLayoutProjection();var V=s.visualElement.projection;Yr(function(U){if(!O){var L=V.target[U],j=L.min,Y=L.max;s.cursorProgress[U]=S?S[U]:mu(j,Y,P[U])}var W=s.getAxisMotionValue(U);W&&(s.originPoint[U]=W.get())})}),T(function(){$s.update(),$s.preRender(),$s.render(),$s.postRender()}),A(function(){return s.resolveDragConstraints()})})},C=function(f,x){var P,A,T,_=s.props,g=_.drag,M=_.dragPropagation;g&&!M&&(s.openGlobalLock&&s.openGlobalLock(),s.openGlobalLock=XP(g),!s.openGlobalLock)||(Bv(),s.isDragging=!0,s.currentDirection=null,(A=(P=s.props).onDragStart)===null||A===void 0||A.call(P,f,x),(T=s.visualElement.animationState)===null||T===void 0||T.setActive(Zn.Drag,!0))},R=function(f,x){var P,A,T,_,g=s.props,M=g.dragPropagation,O=g.dragDirectionLock;if(!(!M&&!s.openGlobalLock)){var N=x.offset;if(O&&s.currentDirection===null){s.currentDirection=K5(N),s.currentDirection!==null&&((A=(P=s.props).onDirectionLock)===null||A===void 0||A.call(P,s.currentDirection));return}s.updateAxis("x",x.point,N),s.updateAxis("y",x.point,N),(_=(T=s.props).onDrag)===null||_===void 0||_.call(T,f,x),lR=f}},I=function(f,x){return s.stop(f,x)},b=this.props.transformPagePoint;this.panSession=new DC(u,{onSessionStart:h,onStart:C,onMove:R,onSessionEnd:I},{transformPagePoint:b})},a.prototype.resolveDragConstraints=function(){var u=this,p=this.props,s=p.dragConstraints,c=p.dragElastic,E=this.visualElement.getLayoutState().layoutCorrected;s?this.constraints=ev(s)?this.resolveRefConstraints(E,s):O5(E,s):this.constraints=!1,this.elastic=w5(c),this.constraints&&!this.hasMutatedConstraints&&Yr(function(m){u.getAxisMotionValue(m)&&(u.constraints[m]=D5(E[m],u.constraints[m]))})},a.prototype.resolveRefConstraints=function(u,p){var s=this.props,c=s.onMeasureDragConstraints,E=s.transformPagePoint,m=p.current;this.constraintsBox=HC(m,E);var S=M5(u,this.constraintsBox);if(c){var h=c(A5(S));this.hasMutatedConstraints=!!h,h&&(S=NC(h))}return S},a.prototype.cancelDrag=function(){var u,p;this.visualElement.unlockProjectionTarget(),(u=this.cancelLayout)===null||u===void 0||u.call(this),this.isDragging=!1,this.panSession&&this.panSession.end(),this.panSession=null,!this.props.dragPropagation&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(p=this.visualElement.animationState)===null||p===void 0||p.setActive(Zn.Drag,!1)},a.prototype.stop=function(u,p){var s,c,E;(s=this.panSession)===null||s===void 0||s.end(),this.panSession=null;var m=this.isDragging;if(this.cancelDrag(),!!m){var S=p.velocity;this.animateDragEnd(S),(E=(c=this.props).onDragEnd)===null||E===void 0||E.call(c,u,p)}},a.prototype.snapToCursor=function(u){var p=this;return Yr(function(s){var c=p.props.drag;if(!!Sf(s,c,p.currentDirection)){var E=p.getAxisMotionValue(s);if(E){var m=p.visualElement.getLayoutState().layout,S=m[s].max-m[s].min,h=m[s].min+S/2,C=u[s]-h;p.originPoint[s]=u[s],E.set(C)}else return p.cursorProgress[s]=.5,!0}}).includes(!0)},a.prototype.updateAxis=function(u,p,s){var c=this.props.drag;if(!!Sf(u,c,this.currentDirection))return this.getAxisMotionValue(u)?this.updateAxisMotionValue(u,s):this.updateVisualElementAxis(u,p)},a.prototype.updateAxisMotionValue=function(u,p){var s=this.getAxisMotionValue(u);if(!(!p||!s)){var c=this.originPoint[u]+p[u],E=this.constraints?UC(c,this.constraints[u],this.elastic[u]):c;s.set(E)}},a.prototype.updateVisualElementAxis=function(u,p){var s,c=this.visualElement.getLayoutState().layout[u],E=c.max-c.min,m=this.cursorProgress[u],S=R5(p[u],E,m,(s=this.constraints)===null||s===void 0?void 0:s[u],this.elastic[u]);this.visualElement.setProjectionTargetAxis(u,S,S+E)},a.prototype.setProps=function(u){var p=u.drag,s=p===void 0?!1:p,c=u.dragDirectionLock,E=c===void 0?!1:c,m=u.dragPropagation,S=m===void 0?!1:m,h=u.dragConstraints,C=h===void 0?!1:h,R=u.dragElastic,I=R===void 0?jC:R,b=u.dragMomentum,f=b===void 0?!0:b,x=ri(u,["drag","dragDirectionLock","dragPropagation","dragConstraints","dragElastic","dragMomentum"]);this.props=ht({drag:s,dragDirectionLock:E,dragPropagation:S,dragConstraints:C,dragElastic:I,dragMomentum:f},x)},a.prototype.getAxisMotionValue=function(u){var p=this.props,s=p.layout,c=p.layoutId,E="_drag"+u.toUpperCase();if(this.props[E])return this.props[E];if(!s&&c===void 0)return this.visualElement.getValue(u,0)},a.prototype.isLayoutDrag=function(){return!this.getAxisMotionValue("x")},a.prototype.isExternalDrag=function(){var u=this.props,p=u._dragX,s=u._dragY;return p||s},a.prototype.animateDragEnd=function(u){var p=this,s=this.props,c=s.drag,E=s.dragMomentum,m=s.dragElastic,S=s.dragTransition,h=W5(this.visualElement,this.isLayoutDrag()&&!this.isExternalDrag()),C=this.constraints||{};if(h&&Object.keys(C).length&&this.isLayoutDrag()){var R=this.visualElement.getProjectionParent();if(R){var I=hc(R.projection.targetFinal,C);Yr(function(f){var x=I[f],P=x.min,A=x.max;C[f]={min:isNaN(P)?void 0:P,max:isNaN(A)?void 0:A}})}}var b=Yr(function(f){var x;if(!!Sf(f,c,p.currentDirection)){var P=(x=C==null?void 0:C[f])!==null&&x!==void 0?x:{},A=m?200:1e6,T=m?40:1e7,_=ht(ht({type:"inertia",velocity:E?u[f]:0,bounceStiffness:A,bounceDamping:T,timeConstant:750,restDelta:1,restSpeed:10},S),P);return p.getAxisMotionValue(f)?p.startAxisValueAnimation(f,_):p.visualElement.startLayoutAnimation(f,_,h)}});return Promise.all(b).then(function(){var f,x;(x=(f=p.props).onDragTransitionEnd)===null||x===void 0||x.call(f)})},a.prototype.stopMotion=function(){var u=this;Yr(function(p){var s=u.getAxisMotionValue(p);s?s.stop():u.visualElement.stopLayoutAnimation()})},a.prototype.startAxisValueAnimation=function(u,p){var s=this.getAxisMotionValue(u);if(!!s){var c=s.get();return s.set(c),s.set(c),gf(u,s,0,p)}},a.prototype.scalePoint=function(){var u=this,p=this.props,s=p.drag,c=p.dragConstraints;if(!(!ev(c)||!this.constraintsBox)){this.stopMotion();var E={x:0,y:0};Yr(function(m){E[m]=N5(u.visualElement.projection.target[m],u.constraintsBox[m])}),this.updateConstraints(function(){Yr(function(m){if(!!Sf(m,s,null)){var S=I5(u.visualElement.projection.target[m],u.constraintsBox[m],E[m]),h=S.min,C=S.max;u.visualElement.setProjectionTargetAxis(m,h,C)}})}),setTimeout(Bv,1)}},a.prototype.updateConstraints=function(u){var p=this;this.cancelLayout=Fv(function(s,c){var E=yf(p.visualElement);c(function(){return E.forEach(function(m){return m.resetTransform()})}),s(function(){return Tf(p.visualElement)}),c(function(){return E.forEach(function(m){return m.restoreTransform()})}),s(function(){p.resolveDragConstraints()}),u&&c(u)})},a.prototype.mount=function(u){var p=this,s=u.getInstance(),c=lc(s,"pointerdown",function(h){var C=p.props,R=C.drag,I=C.dragListener,b=I===void 0?!0:I;R&&b&&p.start(h)}),E=fv(window,"resize",function(){p.scalePoint()}),m=u.onLayoutUpdate(function(){p.isDragging&&p.resolveDragConstraints()}),S=u.prevDragCursor;return S&&this.start(lR,{cursorProgress:S}),function(){c==null||c(),E==null||E(),m==null||m(),p.cancelDrag()}},a}();function Sf(a,u,p){return(u===!0||u===a)&&(p===null||p===a)}function K5(a,u){u===void 0&&(u=10);var p=null;return Math.abs(a.y)>u?p="y":Math.abs(a.x)>u&&(p="x"),p}function Q5(a){var u=a.dragControls,p=a.visualElement,s=cn($d).transformPagePoint,c=ou(function(){return new Y5({visualElement:p})});c.setProps(ht(ht({},a),{transformPagePoint:s})),Vt(function(){return u&&u.subscribe(c)},[c]),Vt(function(){return c.mount(p)},[])}function q5(a){var u=a.onPan,p=a.onPanStart,s=a.onPanEnd,c=a.onPanSessionStart,E=a.visualElement,m=u||p||s||c,S=zt(null),h=cn($d).transformPagePoint,C={onSessionStart:c,onStart:p,onMove:u,onEnd:function(I,b){S.current=null,s&&s(I,b)}};Vt(function(){S.current!==null&&S.current.updateHandlers(C)});function R(I){S.current=new DC(I,C,{transformPagePoint:h})}af(E,"pointerdown",m&&R),_v(function(){return S.current&&S.current.end()})}var Z5={pan:Ha(q5),drag:Ha(Q5)},bu;(function(a){a[a.Entering=0]="Entering",a[a.Present=1]="Present",a[a.Exiting=2]="Exiting"})(bu||(bu={}));var Uv;(function(a){a[a.Hide=0]="Hide",a[a.Show=1]="Show"})(Uv||(Uv={}));function Vv(a){return typeof a=="string"&&a.startsWith("var(--")}var uR=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function $5(a){var u=uR.exec(a);if(!u)return[,];var p=Wn(u,3),s=p[1],c=p[2];return[s,c]}function kv(a,u,p){var s=Wn($5(a),2),c=s[0],E=s[1];if(!!c){var m=window.getComputedStyle(u).getPropertyValue(c);return m?m.trim():Vv(E)?kv(E,u):E}}function J5(a,u,p){var s,c=ri(u,[]),E=a.getInstance();if(!(E instanceof HTMLElement))return{target:c,transitionEnd:p};p&&(p=ht({},p)),a.forEachValue(function(C){var R=C.get();if(!!Vv(R)){var I=kv(R,E);I&&C.set(I)}});for(var m in c){var S=c[m];if(!!Vv(S)){var h=kv(S,E);!h||(c[m]=h,p&&((s=p[m])!==null&&s!==void 0||(p[m]=S)))}}return{target:c,transitionEnd:p}}function hR(a,u){return a/(u.max-u.min)*100}function eX(a,u,p){var s=p.target;if(typeof a=="string")if(kt.test(a))a=parseFloat(a);else return a;var c=hR(a,s.x),E=hR(a,s.y);return c+"% "+E+"%"}var dR="_$css";function tX(a,u){var p=u.delta,s=u.treeScale,c=a,E=a.includes("var("),m=[];E&&(a=a.replace(uR,function(P){return m.push(P),dR}));var S=yo.parse(a);if(S.length>5)return c;var h=yo.createTransformer(a),C=typeof S[0]!="number"?1:0,R=p.x.scale*s.x,I=p.y.scale*s.y;S[0+C]/=R,S[1+C]/=I;var b=Xr(R,I,.5);typeof S[2+C]=="number"&&(S[2+C]/=b),typeof S[3+C]=="number"&&(S[3+C]/=b);var f=h(S);if(E){var x=0;f=f.replace(dR,function(){var P=m[x];return x++,P})}return f}var yu={process:eX},nX={borderRadius:ht(ht({},yu),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:yu,borderTopRightRadius:yu,borderBottomLeftRadius:yu,borderBottomRightRadius:yu,boxShadow:{process:tX}},fR=1e3,rX=function(a){sP(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.frameTarget=ha(),p.currentAnimationTarget=ha(),p.isAnimating={x:!1,y:!1},p.stopAxisAnimation={x:void 0,y:void 0},p.isAnimatingTree=!1,p.animate=function(s,c,E){E===void 0&&(E={});var m=E.originBox,S=E.targetBox,h=E.visibilityAction,C=E.shouldStackAnimate,R=E.onComplete,I=E.prevParent,b=ri(E,["originBox","targetBox","visibilityAction","shouldStackAnimate","onComplete","prevParent"]),f=p.props,x=f.visualElement,P=f.layout;if(C===!1)return p.isAnimatingTree=!1,p.safeToRemove();if(!(p.isAnimatingTree&&C!==!0)){C&&(p.isAnimatingTree=!0),c=m||c,s=S||s;var A=!1,T=x.getProjectionParent();if(T){var _=T.prevViewportBox,g=T.getLayoutState().layout;I&&(S&&(g=I.getLayoutState().layout),m&&!k5(I,T)&&I.prevViewportBox&&(_=I.prevViewportBox)),_&&sX(I,m,S)&&(A=!0,c=hc(_,c),s=hc(g,s))}var M=oX(c,s),O=Yr(function(N){var V,U;if(P==="position"){var L=s[N].max-s[N].min;c[N].max=c[N].min+L}if(!x.projection.isTargetLocked)if(h!==void 0)x.setVisibility(h===Uv.Show);else return M?p.animateAxis(N,s[N],c[N],ht(ht({},b),{isRelative:A})):((U=(V=p.stopAxisAnimation)[N])===null||U===void 0||U.call(V),x.setProjectionTargetAxis(N,s[N].min,s[N].max,A))});return x.syncRender(),Promise.all(O).then(function(){p.isAnimatingTree=!1,R&&R(),x.notifyLayoutAnimationComplete()})}},p}return u.prototype.componentDidMount=function(){var p=this,s=this.props.visualElement;s.animateMotionValue=gf,s.enableLayoutProjection(),this.unsubLayoutReady=s.onLayoutUpdate(this.animate),s.layoutSafeToRemove=function(){return p.safeToRemove()},H4(nX)},u.prototype.componentWillUnmount=function(){var p=this;this.unsubLayoutReady(),Yr(function(s){var c,E;return(E=(c=p.stopAxisAnimation)[s])===null||E===void 0?void 0:E.call(c)})},u.prototype.animateAxis=function(p,s,c,E){var m=this,S,h,C=E===void 0?{}:E,R=C.transition,I=C.isRelative;if(!(this.isAnimating[p]&&Tu(s,this.currentAnimationTarget[p]))){(h=(S=this.stopAxisAnimation)[p])===null||h===void 0||h.call(S),this.isAnimating[p]=!0;var b=this.props.visualElement,f=this.frameTarget[p],x=b.getProjectionAnimationProgress()[p];x.clearListeners(),x.set(0),x.set(0);var P=function(){var g=x.get()/fR;V5(f,c,s,g),b.setProjectionTargetAxis(p,f.min,f.max,I)};P();var A=x.onChange(P);this.stopAxisAnimation[p]=function(){m.isAnimating[p]=!1,x.stop(),A()},this.currentAnimationTarget[p]=s;var T=R||b.getDefaultTransition()||aX,_=gf(p==="x"?"layoutX":"layoutY",x,fR,T&&Rv(T,"layout")).then(this.stopAxisAnimation[p]);return _}},u.prototype.safeToRemove=function(){var p,s;(s=(p=this.props).safeToRemove)===null||s===void 0||s.call(p)},u.prototype.render=function(){return null},u}(fi);function iX(a){var u=Wn(Jg(),2),p=u[1];return $e(rX,ht({},a,{safeToRemove:p}))}function oX(a,u){return!mR(a)&&!mR(u)&&(!Tu(a.x,u.x)||!Tu(a.y,u.y))}var pR={min:0,max:0};function mR(a){return Tu(a.x,pR)&&Tu(a.y,pR)}function Tu(a,u){return a.min===u.min&&a.max===u.max}var aX={duration:.45,ease:[.4,0,.1,1]};function sX(a,u,p){return a||!a&&!(u||p)}var cX={layoutReady:function(a){return a.notifyLayoutReady()}};function _R(){var a=new Set;return{add:function(u){return a.add(u)},flush:function(u){var p=u===void 0?cX:u,s=p.layoutReady,c=p.parent;Fv(function(E,m){var S=Array.from(a).sort(wv),h=c?yf(c):[];m(function(){var C=Br(Br([],Wn(h)),Wn(S));C.forEach(function(R){return R.resetTransform()})}),E(function(){S.forEach(Tf)}),m(function(){h.forEach(function(C){return C.restoreTransform()}),S.forEach(s)}),E(function(){S.forEach(function(C){C.isPresent&&(C.presence=bu.Present)})}),m(function(){$s.preRender(),$s.render()}),E(function(){qi.postRender(function(){return S.forEach(lX)}),a.clear()})}),Bv()}}}function lX(a){a.prevViewportBox=a.projection.target}var gR=Er(_R()),uX=Er(_R());function Ya(a){return!!a.forceUpdate}var hX=function(a){sP(u,a);function u(){return a!==null&&a.apply(this,arguments)||this}return u.prototype.componentDidMount=function(){var p=this.props,s=p.syncLayout,c=p.framerSyncLayout,E=p.visualElement;Ya(s)&&s.register(E),Ya(c)&&c.register(E),E.onUnmount(function(){Ya(s)&&s.remove(E),Ya(c)&&c.remove(E)})},u.prototype.getSnapshotBeforeUpdate=function(){var p=this.props,s=p.syncLayout,c=p.visualElement;return Ya(s)?s.syncUpdate():(U5(c),s.add(c)),null},u.prototype.componentDidUpdate=function(){var p=this.props.syncLayout;Ya(p)||p.flush()},u.prototype.render=function(){return null},u}(Jr.Component);function dX(a){var u=cn(gR),p=cn(uX);return Jr.createElement(hX,ht({},a,{syncLayout:u,framerSyncLayout:p}))}var fX={measureLayout:dX,layoutAnimation:iX},pX=function(){return{isEnabled:!1,isHydrated:!1,isTargetLocked:!1,target:ha(),targetFinal:ha()}};function vR(){return{isHydrated:!1,layout:ha(),layoutCorrected:ha(),treeScale:{x:1,y:1},delta:BC(),deltaFinal:BC(),deltaTransform:""}}var bR=vR();function xf(a,u,p){var s=a.x,c=a.y,E=s.translate/u.x,m=c.translate/u.y,S="translate3d("+E+"px, "+m+"px, 0) ";if(p){var h=p.rotate,C=p.rotateX,R=p.rotateY;h&&(S+="rotate("+h+") "),C&&(S+="rotateX("+C+") "),R&&(S+="rotateY("+R+") ")}return S+="scale("+s.scale+", "+c.scale+")",!p&&S===mX?"":S}function yR(a){var u=a.deltaFinal;return u.x.origin*100+"% "+u.y.origin*100+"% 0"}var mX=xf(bR.delta,bR.treeScale,{x:1,y:1}),Af=["LayoutMeasure","BeforeLayoutMeasure","LayoutUpdate","ViewportBoxUpdate","Update","Render","AnimationComplete","LayoutAnimationComplete","AnimationStart","SetAxisTarget","Unmount"];function _X(){var a=Af.map(function(){return new vf}),u={},p={clearAllListeners:function(){return a.forEach(function(s){return s.clear()})},updatePropListeners:function(s){return Af.forEach(function(c){var E;(E=u[c])===null||E===void 0||E.call(u);var m="on"+c,S=s[m];S&&(u[c]=p[m](S))})}};return a.forEach(function(s,c){p["on"+Af[c]]=function(E){return s.add(E)},p["notify"+Af[c]]=function(){for(var E=[],m=0;m<arguments.length;m++)E[m]=arguments[m];return s.notify.apply(s,Br([],Wn(E)))}}),p}function gX(a,u,p){var s;for(var c in u){var E=u[c],m=p[c];if(la(E))a.addValue(c,E);else if(la(m))a.addValue(c,Xa(E));else if(m!==E)if(a.hasValue(c)){var S=a.getValue(c);!S.hasAnimated&&S.set(E)}else a.addValue(c,Xa((s=a.getStaticValue(c))!==null&&s!==void 0?s:E))}for(var c in p)u[c]===void 0&&a.removeValue(c);return u}function vX(a,u,p,s){var c=a.delta,E=a.layout,m=a.layoutCorrected,S=a.treeScale,h=u.target;j5(m,E),H5(m,S,p),YC(c,m,h,s)}var bX=function(){function a(){this.children=[],this.isDirty=!1}return a.prototype.add=function(u){CC(this.children,u),this.isDirty=!0},a.prototype.remove=function(u){RC(this.children,u),this.isDirty=!0},a.prototype.forEach=function(u){this.isDirty&&this.children.sort(wv),this.isDirty=!1,this.children.forEach(u)},a}();function yX(a){var u=a.getProjectionParent();if(!u){a.rebaseProjectionTarget();return}var p=hc(u.getLayoutState().layout,a.getLayoutState().layout);Yr(function(s){a.setProjectionTargetAxis(s,p[s].min,p[s].max,!0)})}var TR=function(a){var u=a.treeType,p=u===void 0?"":u,s=a.build,c=a.getBaseTarget,E=a.makeTargetAnimatable,m=a.measureViewportBox,S=a.render,h=a.readValueFromInstance,C=a.resetTransform,R=a.restoreTransform,I=a.removeValueFromRenderState,b=a.sortNodePosition,f=a.scrapeMotionValuesFromProps;return function(x,P){var A=x.parent,T=x.props,_=x.presenceId,g=x.blockInitialAnimation,M=x.visualState;P===void 0&&(P={});var O=M.latestValues,N=M.renderState,V,U=_X(),L=pX(),j,Y=L,W=O,ie,re=vR(),ye,ve=!1,ue=new Map,oe=new Map,Z={},J,B=ht({},O),G;function $(){!V||(de.isProjectionReady()&&(Nv(Y.targetFinal,Y.target,W),YC(re.deltaFinal,re.layoutCorrected,Y.targetFinal,O)),he(),S(V,N))}function he(){var ne=O;if(ye&&ye.isActive()){var pe=ye.getCrossfadeState(de);pe&&(ne=pe)}s(de,N,ne,Y,re,P,T)}function se(){U.notifyUpdate(O)}function q(){if(!!de.isProjectionReady()){var ne=re.delta,pe=re.treeScale,Se=pe.x,Te=pe.y,Ne=re.deltaTransform;vX(re,Y,de.path,O),ve&&de.notifyViewportBoxUpdate(Y.target,ne),ve=!1;var je=xf(ne,pe);(je!==Ne||Se!==pe.x||Te!==pe.y)&&de.scheduleRender(),re.deltaTransform=je}}function H(){de.layoutTree.forEach(EX)}function X(ne,pe){var Se=pe.onChange(function(Ne){O[ne]=Ne,T.onUpdate&&qi.update(se,!1,!0)}),Te=pe.onRenderRequest(de.scheduleRender);oe.set(ne,function(){Se(),Te()})}var ee=f(T);for(var Q in ee){var te=ee[Q];O[Q]!==void 0&&la(te)&&te.set(O[Q],!1)}var ge=tf(T),ce=fP(T),de=ht(ht({treeType:p,current:null,depth:A?A.depth+1:0,parent:A,children:new Set,path:A?Br(Br([],Wn(A.path)),[A]):[],layoutTree:A?A.layoutTree:new bX,presenceId:_,projection:L,variantChildren:ce?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(A==null?void 0:A.isMounted()),blockInitialAnimation:g,isMounted:function(){return Boolean(V)},mount:function(ne){V=de.current=ne,de.pointTo(de),ce&&A&&!ge&&(G=A==null?void 0:A.addVariantChild(de)),A==null||A.children.add(de)},unmount:function(){zl.update(se),zl.render($),zl.preRender(de.updateLayoutProjection),oe.forEach(function(ne){return ne()}),de.stopLayoutAnimation(),de.layoutTree.remove(de),G==null||G(),A==null||A.children.delete(de),ie==null||ie(),U.clearAllListeners()},addVariantChild:function(ne){var pe,Se=de.getClosestVariantNode();if(Se)return(pe=Se.variantChildren)===null||pe===void 0||pe.add(ne),function(){return Se.variantChildren.delete(ne)}},sortNodePosition:function(ne){return!b||p!==ne.treeType?0:b(de.getInstance(),ne.getInstance())},getClosestVariantNode:function(){return ce?de:A==null?void 0:A.getClosestVariantNode()},scheduleUpdateLayoutProjection:A?A.scheduleUpdateLayoutProjection:function(){return qi.preRender(de.updateTreeLayoutProjection,!1,!0)},getLayoutId:function(){return T.layoutId},getInstance:function(){return V},getStaticValue:function(ne){return O[ne]},setStaticValue:function(ne,pe){return O[ne]=pe},getLatestValues:function(){return O},setVisibility:function(ne){de.isVisible!==ne&&(de.isVisible=ne,de.scheduleRender())},makeTargetAnimatable:function(ne,pe){return pe===void 0&&(pe=!0),E(de,ne,T,pe)},addValue:function(ne,pe){de.hasValue(ne)&&de.removeValue(ne),ue.set(ne,pe),O[ne]=pe.get(),X(ne,pe)},removeValue:function(ne){var pe;ue.delete(ne),(pe=oe.get(ne))===null||pe===void 0||pe(),oe.delete(ne),delete O[ne],I(ne,N)},hasValue:function(ne){return ue.has(ne)},getValue:function(ne,pe){var Se=ue.get(ne);return Se===void 0&&pe!==void 0&&(Se=Xa(pe),de.addValue(ne,Se)),Se},forEachValue:function(ne){return ue.forEach(ne)},readValue:function(ne){var pe;return(pe=O[ne])!==null&&pe!==void 0?pe:h(V,ne,P)},setBaseTarget:function(ne,pe){B[ne]=pe},getBaseTarget:function(ne){if(c){var pe=c(T,ne);if(pe!==void 0&&!la(pe))return pe}return B[ne]}},U),{build:function(){return he(),N},scheduleRender:function(){qi.render($,!1,!0)},syncRender:$,setProps:function(ne){T=ne,U.updatePropListeners(ne),Z=gX(de,f(T),Z)},getProps:function(){return T},getVariant:function(ne){var pe;return(pe=T.variants)===null||pe===void 0?void 0:pe[ne]},getDefaultTransition:function(){return T.transition},getVariantContext:function(ne){if(ne===void 0&&(ne=!1),ne)return A==null?void 0:A.getVariantContext();if(!ge){var pe=(A==null?void 0:A.getVariantContext())||{};return T.initial!==void 0&&(pe.initial=T.initial),pe}for(var Se={},Te=0;Te<SX;Te++){var Ne=ER[Te],je=T[Ne];(wi(je)||je===!1)&&(Se[Ne]=je)}return Se},enableLayoutProjection:function(){L.isEnabled=!0,de.layoutTree.add(de)},lockProjectionTarget:function(){L.isTargetLocked=!0},unlockProjectionTarget:function(){de.stopLayoutAnimation(),L.isTargetLocked=!1},getLayoutState:function(){return re},setCrossfader:function(ne){ye=ne},isProjectionReady:function(){return L.isEnabled&&L.isHydrated&&re.isHydrated},startLayoutAnimation:function(ne,pe,Se){Se===void 0&&(Se=!1);var Te=de.getProjectionAnimationProgress()[ne],Ne=Se?L.relativeTarget[ne]:L.target[ne],je=Ne.min,Xe=Ne.max,Ye=Xe-je;return Te.clearListeners(),Te.set(je),Te.set(je),Te.onChange(function(Ke){de.setProjectionTargetAxis(ne,Ke,Ke+Ye,Se)}),de.animateMotionValue(ne,Te,0,pe)},stopLayoutAnimation:function(){Yr(function(ne){return de.getProjectionAnimationProgress()[ne].stop()})},measureViewportBox:function(ne){ne===void 0&&(ne=!0);var pe=m(V,P);return ne||aR(pe,O),pe},getProjectionAnimationProgress:function(){return J||(J={x:Xa(0),y:Xa(0)}),J},setProjectionTargetAxis:function(ne,pe,Se,Te){Te===void 0&&(Te=!1);var Ne;Te?(L.relativeTarget||(L.relativeTarget=ha()),Ne=L.relativeTarget[ne]):(L.relativeTarget=void 0,Ne=L.target[ne]),L.isHydrated=!0,Ne.min=pe,Ne.max=Se,ve=!0,U.notifySetAxisTarget()},rebaseProjectionTarget:function(ne,pe){pe===void 0&&(pe=re.layout);var Se=de.getProjectionAnimationProgress(),Te=Se.x,Ne=Se.y,je=!L.relativeTarget&&!L.isTargetLocked&&!Te.isAnimating()&&!Ne.isAnimating();(ne||je)&&Yr(function(Xe){var Ye=pe[Xe],Ke=Ye.min,nt=Ye.max;de.setProjectionTargetAxis(Xe,Ke,nt)})},notifyLayoutReady:function(ne){yX(de),de.notifyLayoutUpdate(re.layout,de.prevViewportBox||re.layout,ne)},resetTransform:function(){return C(de,V,T)},restoreTransform:function(){return R(V,N)},updateLayoutProjection:q,updateTreeLayoutProjection:function(){de.layoutTree.forEach(TX),qi.preRender(H,!1,!0)},getProjectionParent:function(){if(j===void 0){for(var ne=!1,pe=de.path.length-1;pe>=0;pe--){var Se=de.path[pe];if(Se.projection.isEnabled){ne=Se;break}}j=ne}return j},resolveRelativeTargetBox:function(){var ne=de.getProjectionParent();if(!(!L.relativeTarget||!ne)&&(F5(L,ne.projection),$C(ne))){var pe=L.target;Nv(pe,pe,ne.getLatestValues())}},shouldResetTransform:function(){return Boolean(T._layoutResetTransform)},pointTo:function(ne){Y=ne.projection,W=ne.getLatestValues(),ie==null||ie(),ie=_u(ne.onSetAxisTarget(de.scheduleUpdateLayoutProjection),ne.onLayoutAnimationComplete(function(){var pe;de.isPresent?de.presence=bu.Present:(pe=de.layoutSafeToRemove)===null||pe===void 0||pe.call(de)}))},isPresent:!0,presence:bu.Entering});return de}};function TX(a){a.resolveRelativeTargetBox()}function EX(a){a.updateLayoutProjection()}var ER=Br(["initial"],Wn(Mv)),SX=ER.length,xX=new Set(["width","height","top","left","right","bottom","x","y"]),SR=function(a){return xX.has(a)},AX=function(a){return Object.keys(a).some(SR)},xR=function(a,u){a.set(u,!1),a.set(u)},AR=function(a){return a===Ga||a===kt},PR;(function(a){a.width="width",a.height="height",a.left="left",a.right="right",a.top="top",a.bottom="bottom"})(PR||(PR={}));var CR=function(a,u){return parseFloat(a.split(", ")[u])},RR=function(a,u){return function(p,s){var c=s.transform;if(c==="none"||!c)return 0;var E=c.match(/^matrix3d\((.+)\)$/);if(E)return CR(E[1],u);var m=c.match(/^matrix\((.+)\)$/);return m?CR(m[1],a):0}},PX=new Set(["x","y","z"]),CX=cu.filter(function(a){return!PX.has(a)});function RX(a){var u=[];return CX.forEach(function(p){var s=a.getValue(p);s!==void 0&&(u.push([p,s.get()]),s.set(p.startsWith("scale")?1:0))}),u.length&&a.syncRender(),u}var OR={width:function(a){var u=a.x;return u.max-u.min},height:function(a){var u=a.y;return u.max-u.min},top:function(a,u){var p=u.top;return parseFloat(p)},left:function(a,u){var p=u.left;return parseFloat(p)},bottom:function(a,u){var p=a.y,s=u.top;return parseFloat(s)+(p.max-p.min)},right:function(a,u){var p=a.x,s=u.left;return parseFloat(s)+(p.max-p.min)},x:RR(4,13),y:RR(5,14)},OX=function(a,u,p){var s=u.measureViewportBox(),c=u.getInstance(),E=getComputedStyle(c),m=E.display,S=E.top,h=E.left,C=E.bottom,R=E.right,I=E.transform,b={top:S,left:h,bottom:C,right:R,transform:I};m==="none"&&u.setStaticValue("display",a.display||"block"),u.syncRender();var f=u.measureViewportBox();return p.forEach(function(x){var P=u.getValue(x);xR(P,OR[x](s,b)),a[x]=OR[x](f,E)}),a},MX=function(a,u,p,s){p===void 0&&(p={}),s===void 0&&(s={}),u=ht({},u),s=ht({},s);var c=Object.keys(u).filter(SR),E=[],m=!1,S=[];if(c.forEach(function(C){var R=a.getValue(C);if(!!a.hasValue(C)){var I=p[C],b=u[C],f=bf(I),x;if(pu(b))for(var P=b.length,A=b[0]===null?1:0;A<P;A++)x?ru(bf(b[A])===x):x=bf(b[A]);else x=bf(b);if(f!==x)if(AR(f)&&AR(x)){var T=R.get();typeof T=="string"&&R.set(parseFloat(T)),typeof b=="string"?u[C]=parseFloat(b):Array.isArray(b)&&x===kt&&(u[C]=b.map(parseFloat))}else(f==null?void 0:f.transform)&&(x==null?void 0:x.transform)&&(I===0||b===0)?I===0?R.set(x.transform(I)):u[C]=f.transform(b):(m||(E=RX(a),m=!0),S.push(C),s[C]=s[C]!==void 0?s[C]:u[C],xR(R,b))}}),S.length){var h=OX(u,a,S);return E.length&&E.forEach(function(C){var R=Wn(C,2),I=R[0],b=R[1];a.getValue(I).set(b)}),a.syncRender(),{target:h,transitionEnd:s}}else return{target:u,transitionEnd:s}};function IX(a,u,p,s){return AX(u)?MX(a,u,p,s):{target:u,transitionEnd:s}}var DX=function(a,u,p,s){var c=J5(a,u,s);return u=c.target,s=c.transitionEnd,IX(a,u,p,s)};function wX(a){return window.getComputedStyle(a)}var MR={treeType:"dom",readValueFromInstance:function(a,u){if(nf(u)){var p=Pv(u);return p&&p.default||0}else{var s=wX(a);return(gP(u)?s.getPropertyValue(u):s[u])||0}},sortNodePosition:function(a,u){return a.compareDocumentPosition(u)&2?1:-1},getBaseTarget:function(a,u){var p;return(p=a.style)===null||p===void 0?void 0:p[u]},measureViewportBox:function(a,u){var p=u.transformPagePoint;return HC(a,p)},resetTransform:function(a,u,p){var s=p.transformTemplate;u.style.transform=s?s({},""):"none",a.scheduleRender()},restoreTransform:function(a,u){a.style.transform=u.style.transform},removeValueFromRenderState:function(a,u){var p=u.vars,s=u.style;delete p[a],delete s[a]},makeTargetAnimatable:function(a,u,p,s){var c=p.transformValues;s===void 0&&(s=!0);var E=u.transition,m=u.transitionEnd,S=ri(u,["transition","transitionEnd"]),h=u5(S,E||{},a);if(c&&(m&&(m=c(m)),S&&(S=c(S)),h&&(h=c(h))),s){c5(a,S,h);var C=DX(a,S,h,m);m=C.transitionEnd,S=C.target}return ht({transition:E,transitionEnd:m},S)},scrapeMotionValuesFromProps:hv,build:function(a,u,p,s,c,E,m){a.isVisible!==void 0&&(u.style.visibility=a.isVisible?"visible":"hidden");var S=s.isEnabled&&c.isHydrated;sv(u,p,s,c,E,m.transformTemplate,S?xf:void 0,S?yR:void 0)},render:wP},LX=TR(MR),NX=TR(ht(ht({},MR),{getBaseTarget:function(a,u){return a[u]},readValueFromInstance:function(a,u){var p;return nf(u)?((p=Pv(u))===null||p===void 0?void 0:p.default)||0:(u=LP.has(u)?u:DP(u),a.getAttribute(u))},scrapeMotionValuesFromProps:FP,build:function(a,u,p,s,c,E,m){var S=s.isEnabled&&c.isHydrated;uv(u,p,s,c,E,m.transformTemplate,S?xf:void 0,S?yR:void 0)},render:NP})),FX=function(a,u){return tv(a)?NX(u,{enableHardwareAcceleration:!1}):LX(u,{enableHardwareAcceleration:!0})},BX=ht(ht(ht(ht({},T5),zW),Z5),fX),IR=z4(function(a,u){return DH(a,u,BX,FX)});function UX(){var a=zt(!1),u=Wn(ln(0),2),p=u[0],s=u[1];return _v(function(){return a.current=!0}),Gt(function(){!a.current&&s(p+1)},[p])}var DR=0;function VX(){var a=DR;return DR++,a}var jv=function(a){var u=a.children,p=a.initial,s=a.isPresent,c=a.onExitComplete,E=a.custom,m=a.presenceAffectsLayout,S=ou(kX),h=ou(VX),C=Hn(function(){return{id:h,initial:p,isPresent:s,custom:E,onExitComplete:function(R){S.set(R,!0);var I=!0;S.forEach(function(b){b||(I=!1)}),I&&(c==null||c())},register:function(R){return S.set(R,!1),function(){return S.delete(R)}}}},m?void 0:[s]);return Hn(function(){S.forEach(function(R,I){return S.set(I,!1)})},[s]),Vt(function(){!s&&!S.size&&(c==null||c())},[s]),$e(iu.Provider,{value:C},u)};function kX(){return new Map}function dc(a){return a.key||""}function jX(a,u){a.forEach(function(p){var s=dc(p);u.set(s,p)})}function zX(a){var u=[];return Ol.forEach(a,function(p){Jo(p)&&u.push(p)}),u}var wR=function(a){var u=a.children,p=a.custom,s=a.initial,c=s===void 0?!0:s,E=a.onExitComplete,m=a.exitBeforeEnter,S=a.presenceAffectsLayout,h=S===void 0?!0:S,C=UX(),R=cn(gR);Ya(R)&&(C=R.forceUpdate);var I=zt(!0),b=zX(u),f=zt(b),x=zt(new Map).current,P=zt(new Set).current;if(jX(b,x),I.current)return I.current=!1,$e(lr,null,b.map(function(N){return $e(jv,{key:dc(N),isPresent:!0,initial:c?void 0:!1,presenceAffectsLayout:h},N)}));for(var A=Br([],Wn(b)),T=f.current.map(dc),_=b.map(dc),g=T.length,M=0;M<g;M++){var O=T[M];_.indexOf(O)===-1?P.add(O):P.delete(O)}return m&&P.size&&(A=[]),P.forEach(function(N){if(_.indexOf(N)===-1){var V=x.get(N);if(!!V){var U=T.indexOf(N),L=function(){x.delete(N),P.delete(N);var j=f.current.findIndex(function(Y){return Y.key===N});f.current.splice(j,1),P.size||(f.current=b,C(),E&&E())};A.splice(U,0,$e(jv,{key:dc(V),isPresent:!1,onExitComplete:L,custom:p,presenceAffectsLayout:h},V))}}}),A=A.map(function(N){var V=N.key;return P.has(V)?N:$e(jv,{key:dc(N),isPresent:!0,presenceAffectsLayout:h},N)}),f.current=A,$e(lr,null,P.size?A:A.map(function(N){return ea(N)}))};function Pf(){return Pf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Pf.apply(this,arguments)}var zv={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1]},Eu={scale:{enter:{scale:1},exit:{scale:.95}},fade:{enter:{opacity:1},exit:{opacity:0}},pushLeft:{enter:{x:"100%"},exit:{x:"-30%"}},pushRight:{enter:{x:"-100%"},exit:{x:"30%"}},pushUp:{enter:{y:"100%"},exit:{y:"-30%"}},pushDown:{enter:{y:"-100%"},exit:{y:"30%"}},slideLeft:{position:{left:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"-100%"}},slideRight:{position:{right:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"100%"}},slideUp:{position:{top:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"-100%"}},slideDown:{position:{bottom:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"100%"}}};function Gv(a){var u,p=(u=a==null?void 0:a.direction)!=null?u:"right";switch(p){case"right":return Eu.slideRight;case"left":return Eu.slideLeft;case"bottom":return Eu.slideDown;case"top":return Eu.slideUp;default:return Eu.slideRight}}var LR={enter:{duration:.2,ease:zv.easeOut},exit:{duration:.1,ease:zv.easeIn}},Cf={enter:(a,u)=>Pf({},a,{delay:Ua(u)?u:u==null?void 0:u.enter}),exit:(a,u)=>Pf({},a,{delay:Ua(u)?u:u==null?void 0:u.exit})},GX={enter:function(u){var p,{transition:s,transitionEnd:c,delay:E}=u===void 0?{}:u;return{opacity:1,transition:(p=s==null?void 0:s.enter)!=null?p:Cf.enter(LR.enter,E),transitionEnd:c==null?void 0:c.enter}},exit:function(u){var p,{transition:s,transitionEnd:c,delay:E}=u===void 0?{}:u;return{opacity:0,transition:(p=s==null?void 0:s.exit)!=null?p:Cf.exit(LR.exit,E),transitionEnd:c==null?void 0:c.exit}}},HX={initial:"exit",animate:"enter",exit:"exit",variants:GX};function WX(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Su(){return Su=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Su.apply(this,arguments)}var NR={exit:{duration:.15,ease:zv.easeInOut},enter:{type:"spring",damping:25,stiffness:180}},XX={exit:a=>{var u,{direction:p,transition:s,transitionEnd:c,delay:E}=a,{exit:m}=Gv({direction:p});return Su({},m,{transition:(u=s==null?void 0:s.exit)!=null?u:Cf.exit(NR.exit,E),transitionEnd:c==null?void 0:c.exit})},enter:a=>{var u,{direction:p,transitionEnd:s,transition:c,delay:E}=a,{enter:m}=Gv({direction:p});return Su({},m,{transition:(u=c==null?void 0:c.enter)!=null?u:Cf.enter(NR.enter,E),transitionEnd:s==null?void 0:s.enter})}},YX=Ci((a,u)=>{var{direction:p="right",style:s,unmountOnExit:c,in:E,className:m,transition:S,transitionEnd:h,delay:C}=a,R=WX(a,["direction","style","unmountOnExit","in","className","transition","transitionEnd","delay"]),I=Gv({direction:p}),b=Object.assign({position:"fixed"},I.position,s),f=c?E&&c:!0,x=E||c?"enter":"exit",P={transitionEnd:h,transition:S,direction:p,delay:C};return $e(wR,{custom:P},f&&$e(IR.div,Su({ref:u,initial:"exit",className:ir("chakra-slide",m),animate:x,exit:"exit",custom:P,variants:XX,style:b},R)))});function xu(){return xu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},xu.apply(this,arguments)}var KX=a=>$e(tu,xu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})),QX=a=>$e(tu,xu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})),FR=a=>$e(tu,xu({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"}));function To(){return To=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},To.apply(this,arguments)}function qX(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var BR={info:{icon:QX,colorScheme:"blue"},warning:{icon:FR,colorScheme:"orange"},success:{icon:KX,colorScheme:"green"},error:{icon:FR,colorScheme:"red"}},[ZX,$X]=ia({name:"AlertContext",errorMessage:"useAlertContext: `context` is undefined. Seems you forgot to wrap alert components in `<Alert />`"}),JX=Ln((a,u)=>{var p,s=aa(a),{status:c="info"}=s,E=qX(s,["status"]),m=(p=a.colorScheme)!=null?p:BR[c].colorScheme,S=Kl("Alert",To({},a,{colorScheme:m})),h=To({width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden"},S.container);return $e(ZX,{value:{status:c}},$e(DA,{value:S},$e(on.div,To({role:"alert",ref:u},E,{className:ir("chakra-alert",a.className),__css:h}))))}),e6=Ln((a,u)=>{var p=oa();return $e(on.div,To({ref:u},a,{className:ir("chakra-alert__title",a.className),__css:p.title}))}),t6=Ln((a,u)=>{var p=oa(),s=To({display:"inline"},p.description);return $e(on.div,To({ref:u},a,{className:ir("chakra-alert__desc",a.className),__css:s}))}),n6=a=>{var{status:u}=$X(),{icon:p}=BR[u],s=oa();return $e(on.span,To({display:"inherit"},a,{className:ir("chakra-alert__icon",a.className),__css:s.icon}),$e(p,{w:"100%",h:"100%"}))},[zQ,r6]=ia({strict:!1,name:"ButtonGroupContext"}),Hv={border:"0px",clip:"rect(0px, 0px, 0px, 0px)",height:"1px",width:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},i6=on("span",{baseStyle:Hv});on("input",{baseStyle:Hv});function Rf(){return Rf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Rf.apply(this,arguments)}function o6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var a6=$_({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),s6=Ln((a,u)=>{var p=Yl("Spinner",a),s=aa(a),{label:c="Loading...",thickness:E="2px",speed:m="0.45s",emptyColor:S="transparent",className:h}=s,C=o6(s,["label","thickness","speed","emptyColor","className"]),R=ir("chakra-spinner",h),I=Rf({display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:E,borderBottomColor:S,borderLeftColor:S,animation:a6+" "+m+" linear infinite"},p);return $e(on.div,Rf({ref:u,__css:I,className:R},C),c&&$e(i6,null,c))});function Of(){return Of=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Of.apply(this,arguments)}function c6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var UR=a=>{var{label:u,placement:p,children:s=$e(s6,{color:"currentColor",width:"1em",height:"1em"}),className:c,__css:E}=a,m=c6(a,["label","placement","spacing","children","className","__css"]),S=ir("chakra-button__spinner",c),h=p==="start"?"marginEnd":"marginStart",C=Hn(()=>Of({display:"flex",alignItems:"center",position:u?"relative":"absolute",[h]:u?"0.5rem":0,fontSize:"1em",lineHeight:"normal"},E),[E,u,h]);return $e(on.div,Of({className:S},m,{__css:C}),s)};function Wv(){return Wv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Wv.apply(this,arguments)}function l6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var VR=a=>{var{children:u,className:p}=a,s=l6(a,["children","className"]),c=Jo(u)?ea(u,{"aria-hidden":!0,focusable:!1}):u,E=ir("chakra-button__icon",p);return $e(on.span,Wv({display:"inline-flex",alignSelf:"center",flexShrink:0},s,{className:E}),c)};function u6(a){var[u,p]=ln(!a),s=Gt(E=>{!E||p(E.tagName==="BUTTON")},[]),c=u?"button":void 0;return{ref:s,type:c}}function h6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Au(){return Au=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Au.apply(this,arguments)}var d6=Ln((a,u)=>{var p=r6(),s=Yl("Button",Au({},p,a)),c=aa(a),{isDisabled:E=p==null?void 0:p.isDisabled,isLoading:m,isActive:S,isFullWidth:h,children:C,leftIcon:R,rightIcon:I,loadingText:b,iconSpacing:f="0.5rem",type:x,spinner:P,spinnerPlacement:A="start",className:T,as:_}=c,g=h6(c,["isDisabled","isLoading","isActive","isFullWidth","children","leftIcon","rightIcon","loadingText","iconSpacing","type","spinner","spinnerPlacement","className","as"]),M=Hn(()=>{var U,L=go({},(U=s==null?void 0:s._focus)!=null?U:{},{zIndex:1});return Au({display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",width:h?"100%":"auto"},s,!!p&&{_focus:L})},[s,p,h]),{ref:O,type:N}=u6(_),V={rightIcon:I,leftIcon:R,iconSpacing:f,children:C};return $e(on.button,Au({disabled:E||m,ref:Gl(u,O),as:_,type:x??N,"data-active":Cr(S),"data-loading":Cr(m),__css:M,className:ir("chakra-button",T)},g),m&&A==="start"&&$e(UR,{className:"chakra-button__spinner--start",label:b,placement:"start"},P),m?b||$e(on.span,{opacity:0},$e(kR,V)):$e(kR,V),m&&A==="end"&&$e(UR,{className:"chakra-button__spinner--end",label:b,placement:"end"},P))});function kR(a){var{leftIcon:u,rightIcon:p,children:s,iconSpacing:c}=a;return $e(lr,null,u&&$e(VR,{marginEnd:c},u),s,p&&$e(VR,{marginStart:c},p))}function Xv(){return Xv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Xv.apply(this,arguments)}function f6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var p6=Ln((a,u)=>{var{icon:p,children:s,isRound:c,"aria-label":E}=a,m=f6(a,["icon","children","isRound","aria-label"]),S=p||s,h=Jo(S)?ea(S,{"aria-hidden":!0,focusable:!1}):null;return $e(d6,Xv({padding:"0",borderRadius:c?"full":void 0,ref:u,"aria-label":E},m),h)});function fc(){return fc=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},fc.apply(this,arguments)}function m6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function _6(a){a===void 0&&(a={});var{defaultIsChecked:u,defaultChecked:p=u,isChecked:s,isFocusable:c,isDisabled:E,isReadOnly:m,isRequired:S,onChange:h,isIndeterminate:C,isInvalid:R,name:I,value:b,id:f,onBlur:x,onFocus:P,"aria-label":A,"aria-labelledby":T,"aria-invalid":_,"aria-describedby":g}=a,M=m6(a,["defaultIsChecked","defaultChecked","isChecked","isFocusable","isDisabled","isReadOnly","isRequired","onChange","isIndeterminate","isInvalid","name","value","id","onBlur","onFocus","aria-label","aria-labelledby","aria-invalid","aria-describedby"]),O=hg(h),N=hg(x),V=hg(P),[U,L]=ug(),[j,Y]=ug(),[W,ie]=ug(),re=zt(null),[ye,ve]=ln(!0),[ue,oe]=ln(!!p),[Z,J]=Y2(s,ue);ag({condition:!!u,message:'The "defaultIsChecked" prop has been deprecated and will be removed in a future version. Please use the "defaultChecked" prop instead, which mirrors default React checkbox behavior.'});var B=Gt(ee=>{if(m||E){ee.preventDefault();return}Z||oe(J?ee.target.checked:C?!0:ee.target.checked),O==null||O(ee)},[m,E,J,Z,C,O]);Js(()=>{re.current&&(re.current.indeterminate=Boolean(C))},[C]);var G=E&&!c,$=Gt(ee=>{ee.key===" "&&ie.on()},[ie]),he=Gt(ee=>{ee.key===" "&&ie.off()},[ie]);Js(()=>{if(!!re.current){var ee=re.current.checked!==J;ee&&oe(re.current.checked)}},[re.current]);var se=Gt(function(ee,Q){ee===void 0&&(ee={}),Q===void 0&&(Q=null);var te=ge=>{ge.preventDefault(),ie.on()};return fc({},ee,{ref:Q,"data-active":Cr(W),"data-hover":Cr(j),"data-checked":Cr(J),"data-focus":Cr(U),"data-indeterminate":Cr(C),"data-disabled":Cr(E),"data-invalid":Cr(R),"data-readonly":Cr(m),"aria-hidden":!0,onMouseDown:ur(ee.onMouseDown,te),onMouseUp:ur(ee.onMouseUp,ie.off),onMouseEnter:ur(ee.onMouseEnter,Y.on),onMouseLeave:ur(ee.onMouseLeave,Y.off)})},[W,J,E,U,j,C,R,m,ie,Y.off,Y.on]),q=Gt(function(ee,Q){return ee===void 0&&(ee={}),Q===void 0&&(Q=null),fc({},M,ee,{ref:Gl(Q,te=>{!te||ve(te.tagName==="LABEL")}),onClick:ur(ee.onClick,()=>{if(!ye){var te;(te=re.current)==null||te.click(),iA(re.current,{nextTick:!0})}}),"data-disabled":Cr(E)})},[M,E,ye]),H=Gt(function(ee,Q){return ee===void 0&&(ee={}),Q===void 0&&(Q=null),fc({},ee,{ref:Gl(re,Q),type:"checkbox",name:I,value:b,id:f,onChange:ur(ee.onChange,B),onBlur:ur(ee.onBlur,N,L.off),onFocus:ur(ee.onFocus,V,L.on),onKeyDown:ur(ee.onKeyDown,$),onKeyUp:ur(ee.onKeyUp,he),required:S,checked:J,disabled:G,readOnly:m,"aria-label":A,"aria-labelledby":T,"aria-invalid":_?Boolean(_):R,"aria-describedby":g,"aria-disabled":E,style:Hv})},[I,b,f,B,L.off,L.on,N,V,$,he,S,J,G,m,A,T,_,R,g,E]),X=Gt(function(ee,Q){return ee===void 0&&(ee={}),Q===void 0&&(Q=null),fc({},ee,{ref:Q,onMouseDown:ur(ee.onMouseDown,jR),onTouchStart:ur(ee.onTouchStart,jR),"data-disabled":Cr(E),"data-checked":Cr(J),"data-invalid":Cr(R)})},[J,E,R]);return{state:{isInvalid:R,isFocused:U,isChecked:J,isActive:W,isHovered:j,isIndeterminate:C,isDisabled:E,isReadOnly:m,isRequired:S},getRootProps:q,getCheckboxProps:se,getInputProps:H,getLabelProps:X,htmlProps:M}}function jR(a){a.preventDefault(),a.stopPropagation()}function g6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Pu(){return Pu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Pu.apply(this,arguments)}var v6=a=>$e(tu,Pu({focusable:"false","aria-hidden":!0},a),$e("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})),b6=Ln((a,u)=>{var p=Yl("CloseButton",a),s=aa(a),{children:c,isDisabled:E,__css:m}=s,S=g6(s,["children","isDisabled","__css"]),h={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return $e(on.button,Pu({type:"button","aria-label":"Close",ref:u,disabled:E,__css:Pu({},h,p,m)},S),c||$e(v6,{width:"1em",height:"1em"}))}),[GQ,y6]=ia({strict:!1,name:"FormControlContext"});function Mf(){return Mf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Mf.apply(this,arguments)}function zR(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function GR(a){var u=T6(a),{isDisabled:p,isInvalid:s,isReadOnly:c,isRequired:E}=u,m=zR(u,["isDisabled","isInvalid","isReadOnly","isRequired"]);return Mf({},m,{disabled:p,readOnly:c,required:E,"aria-invalid":og(s),"aria-required":og(E),"aria-readonly":og(c)})}function T6(a){var u,p,s,c=y6(),{id:E,disabled:m,readOnly:S,required:h,isRequired:C,isInvalid:R,isReadOnly:I,isDisabled:b,onFocus:f,onBlur:x}=a,P=zR(a,["id","disabled","readOnly","required","isRequired","isInvalid","isReadOnly","isDisabled","onFocus","onBlur"]),A=a["aria-describedby"]?[a["aria-describedby"]]:[];return c!=null&&c.hasFeedbackText&&c!=null&&c.isInvalid&&A.push(c.feedbackId),c!=null&&c.hasHelpText&&A.push(c.helpTextId),Mf({},P,{"aria-describedby":A.join(" ")||void 0,id:E??(c==null?void 0:c.id),isDisabled:(u=m??b)!=null?u:c==null?void 0:c.isDisabled,isReadOnly:(p=S??I)!=null?p:c==null?void 0:c.isReadOnly,isRequired:(s=h??C)!=null?s:c==null?void 0:c.isRequired,isInvalid:R??(c==null?void 0:c.isInvalid),onFocus:ur(c==null?void 0:c.onFocus,f),onBlur:ur(c==null?void 0:c.onBlur,x)})}function Yv(){return Yv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Yv.apply(this,arguments)}var HR=Ln((a,u)=>{var p=Kl("Input",a),s=aa(a),c=GR(s),E=ir("chakra-input",a.className);return $e(on.input,Yv({},c,{__css:p.field,ref:u,className:E}))});HR.id="Input";function Cu(){return Cu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Cu.apply(this,arguments)}function WR(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var Kv=on("div");Ki&&(Kv.displayName="Box");var XR=Ln((a,u)=>{var{size:p,centerContent:s=!0}=a,c=WR(a,["size","centerContent"]),E=s?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return $e(Kv,Cu({ref:u,boxSize:p,__css:Cu({},E,{flexShrink:0,flexGrow:0})},c))});Ki&&(XR.displayName="Square");var E6=Ln((a,u)=>{var{size:p}=a,s=WR(a,["size"]);return $e(XR,Cu({size:p,ref:u,borderRadius:"9999px"},s))});Ki&&(E6.displayName="Circle");function If(){return If=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},If.apply(this,arguments)}function YR(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var S6=Ln((a,u)=>{var{area:p,templateAreas:s,gap:c,rowGap:E,columnGap:m,column:S,row:h,autoFlow:C,autoRows:R,templateRows:I,autoColumns:b,templateColumns:f}=a,x=YR(a,["area","templateAreas","gap","rowGap","columnGap","column","row","autoFlow","autoRows","templateRows","autoColumns","templateColumns"]),P={display:"grid",gridArea:p,gridTemplateAreas:s,gridGap:c,gridRowGap:E,gridColumnGap:m,gridAutoColumns:b,gridColumn:S,gridRow:h,gridAutoFlow:C,gridAutoRows:R,gridTemplateRows:I,gridTemplateColumns:f};return $e(on.div,If({ref:u,__css:P},x))});function KR(a){return lg(a,u=>u==="auto"?"auto":"span "+u+"/span "+u)}var x6=Ln((a,u)=>{var{colSpan:p,colStart:s,colEnd:c,rowEnd:E,rowSpan:m,rowStart:S}=a,h=YR(a,["colSpan","colStart","colEnd","rowEnd","rowSpan","rowStart"]),C=Dd({gridColumn:KR(p),gridRow:KR(m),gridColumnStart:s,gridColumnEnd:c,gridRowStart:S,gridRowEnd:E});return $e(on.div,If({ref:u,__css:C},h))}),A6=on("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}}),Qv="& > *:not(style) ~ *:not(style)";function P6(a){var{spacing:u,direction:p}=a,s={column:{marginTop:u,marginEnd:0,marginBottom:0,marginStart:0},row:{marginTop:0,marginEnd:0,marginBottom:0,marginStart:u},"column-reverse":{marginTop:0,marginEnd:0,marginBottom:u,marginStart:0},"row-reverse":{marginTop:0,marginEnd:u,marginBottom:0,marginStart:0}};return{flexDirection:p,[Qv]:lg(p,c=>s[c])}}function C6(a){var{spacing:u,direction:p}=a,s={column:{my:u,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:u,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:u,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:u,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":lg(p,c=>s[c])}}function R6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Ka(){return Ka=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Ka.apply(this,arguments)}var O6=a=>$e(on.div,Ka({className:"chakra-stack__item"},a,{__css:Ka({display:"inline-block",flex:"0 0 auto",minWidth:0},a.__css)})),qv=Ln((a,u)=>{var{isInline:p,direction:s,align:c,justify:E,spacing:m="0.5rem",wrap:S,children:h,divider:C,className:R,shouldWrapChildren:I}=a,b=R6(a,["isInline","direction","align","justify","spacing","wrap","children","divider","className","shouldWrapChildren"]),f=p?"row":s??"column",x=Hn(()=>P6({direction:f,spacing:m}),[f,m]),P=Hn(()=>C6({spacing:m,direction:f}),[m,f]),A=!!C,T=!I&&!A,_=H2(h),g=T?_:_.map((O,N)=>{var V=typeof O.key!="undefined"?O.key:N,U=N+1===_.length,L=$e(O6,{key:V},O),j=I?L:O;if(!A)return j;var Y=ea(C,{__css:P}),W=U?null:Y;return $e(lr,{key:V},j,W)}),M=ir("chakra-stack",R);return $e(on.div,Ka({ref:u,display:"flex",alignItems:c,justifyContent:E,flexDirection:x.flexDirection,flexWrap:S,className:M,__css:A?{}:{[Qv]:x[Qv]}},b),g)});Ki&&(qv.displayName="Stack");var QR=Ln((a,u)=>$e(qv,Ka({align:"center"},a,{direction:"row",ref:u})));Ki&&(QR.displayName="HStack");var qR=Ln((a,u)=>$e(qv,Ka({align:"center"},a,{direction:"column",ref:u})));Ki&&(qR.displayName="VStack");function Zv(){return Zv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Zv.apply(this,arguments)}function M6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var I6=Ln((a,u)=>{var p=Yl("Text",a),s=aa(a),c=M6(s,["className","align","decoration","casing"]),E=Dd({textAlign:a.align,textDecoration:a.decoration,textTransform:a.casing});return $e(on.p,Zv({ref:u,className:ir("chakra-text",a.className)},E,c,{__css:p}))});function D6(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var ZR={exports:{}},w6="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",L6=w6,N6=L6;function $R(){}function JR(){}JR.resetWarningCache=$R;var F6=function(){function a(s,c,E,m,S,h){if(h!==N6){var C=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw C.name="Invariant Violation",C}}a.isRequired=a;function u(){return a}var p={array:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:u,element:a,elementType:a,instanceOf:u,node:a,objectOf:u,oneOf:u,oneOfType:u,shape:u,exact:u,checkPropTypes:JR,resetWarningCache:$R};return p.PropTypes=p,p};ZR.exports=F6();var Ct=ZR.exports,$v="data-focus-lock",eO="data-focus-lock-disabled",B6="data-no-focus-lock",U6="data-autofocus-inside";function V6(a,u){return typeof a=="function"?a(u):a&&(a.current=u),a}function k6(a,u){var p=ln(function(){return{value:a,callback:u,facade:{get current(){return p.value},set current(s){var c=p.value;c!==s&&(p.value=s,p.callback(s,c))}}}})[0];return p.callback=u,p.facade}function tO(a,u){return k6(u,function(p){return a.forEach(function(s){return V6(s,p)})})}var Jv={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Df=function(){return Df=Object.assign||function(u){for(var p,s=1,c=arguments.length;s<c;s++){p=arguments[s];for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&(u[E]=p[E])}return u},Df.apply(this,arguments)};function j6(a,u){var p={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(p[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(p[s[c]]=a[s[c]]);return p}function nO(a){return a}function rO(a,u){u===void 0&&(u=nO);var p=[],s=!1,c={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return p.length?p[p.length-1]:a},useMedium:function(E){var m=u(E,s);return p.push(m),function(){p=p.filter(function(S){return S!==m})}},assignSyncMedium:function(E){for(s=!0;p.length;){var m=p;p=[],m.forEach(E)}p={push:function(S){return E(S)},filter:function(){return p}}},assignMedium:function(E){s=!0;var m=[];if(p.length){var S=p;p=[],S.forEach(E),m=p}var h=function(){var R=m;m=[],R.forEach(E)},C=function(){return Promise.resolve().then(h)};C(),p={push:function(R){m.push(R),C()},filter:function(R){return m=m.filter(R),p}}}};return c}function eb(a,u){return u===void 0&&(u=nO),rO(a,u)}function iO(a){a===void 0&&(a={});var u=rO(null);return u.options=Df({async:!0,ssr:!1},a),u}var oO=function(a){var u=a.sideCar,p=j6(a,["sideCar"]);if(!u)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=u.read();if(!s)throw new Error("Sidecar medium not found");return $e(s,Df({},p))};oO.isSideCarExport=!0;function z6(a,u){return a.useMedium(u),oO}var aO=eb({},function(a){var u=a.target,p=a.currentTarget;return{target:u,currentTarget:p}}),sO=eb(),G6=eb(),H6=iO({async:!0}),W6=[],tb=Ci(function(u,p){var s,c=ln(),E=c[0],m=c[1],S=zt(),h=zt(!1),C=zt(null),R=u.children,I=u.disabled,b=u.noFocusGuards,f=u.persistentFocus,x=u.crossFrame,P=u.autoFocus;u.allowTextSelection;var A=u.group,T=u.className,_=u.whiteList,g=u.shards,M=g===void 0?W6:g,O=u.as,N=O===void 0?"div":O,V=u.lockProps,U=V===void 0?{}:V,L=u.sideCar,j=u.returnFocus,Y=u.onActivation,W=u.onDeactivation,ie=ln({}),re=ie[0],ye=Gt(function(){C.current=C.current||document&&document.activeElement,S.current&&Y&&Y(S.current),h.current=!0},[Y]),ve=Gt(function(){h.current=!1,W&&W(S.current)},[W]),ue=Gt(function(se){var q=C.current;if(Boolean(j)&&q&&q.focus){var H=typeof j=="object"?j:void 0;C.current=null,se?Promise.resolve().then(function(){return q.focus(H)}):q.focus(H)}},[j]),oe=Gt(function(se){h.current&&aO.useMedium(se)},[]),Z=sO.useMedium,J=Gt(function(se){S.current!==se&&(S.current=se,m(se))},[]),B=ra((s={},s[eO]=I&&"disabled",s[$v]=A,s),U),G=b!==!0,$=G&&b!=="tail",he=tO([p,J]);return $e(lr,null,G&&[$e("div",{key:"guard-first","data-focus-guard":!0,tabIndex:I?-1:0,style:Jv}),$e("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:I?-1:1,style:Jv})],!I&&$e(L,{id:re,sideCar:H6,observed:E,disabled:I,persistentFocus:f,crossFrame:x,autoFocus:P,whiteList:_,shards:M,onActivation:ye,onDeactivation:ve,returnFocus:ue}),$e(N,ra({ref:he},B,{className:T,onBlur:Z,onFocus:oe}),R),$&&$e("div",{"data-focus-guard":!0,tabIndex:I?-1:0,style:Jv}))});tb.propTypes={},tb.defaultProps={children:void 0,disabled:!1,returnFocus:!1,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};var cO=tb;function nb(a,u){return nb=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},nb(a,u)}function X6(a,u){a.prototype=Object.create(u.prototype),a.prototype.constructor=a,nb(a,u)}function Y6(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}function K6(a,u){function p(s){return s.displayName||s.name||"Component"}return function(c){var E=[],m;function S(){m=a(E.map(function(C){return C.props})),u(m)}var h=function(C){X6(R,C);function R(){return C.apply(this,arguments)||this}R.peek=function(){return m};var I=R.prototype;return I.componentDidMount=function(){E.push(this),S()},I.componentDidUpdate=function(){S()},I.componentWillUnmount=function(){var f=E.indexOf(this);E.splice(f,1),S()},I.render=function(){return Jr.createElement(c,this.props)},R}(Cl);return Y6(h,"displayName","SideEffect("+p(c)+")"),h}}var da=function(a){for(var u=Array(a.length),p=0;p<a.length;++p)u[p]=a[p];return u},rb=function(a){return Array.isArray(a)?a:[a]},Q6=function(a){for(var u=new Set,p=a.length,s=0;s<p;s+=1)for(var c=s+1;c<p;c+=1){var E=a[s].compareDocumentPosition(a[c]);(E&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&u.add(c),(E&Node.DOCUMENT_POSITION_CONTAINS)>0&&u.add(s)}return a.filter(function(m,S){return!u.has(S)})},lO=function(a){return a.parentNode?lO(a.parentNode):a},ib=function(a){var u=rb(a);return u.filter(Boolean).reduce(function(p,s){var c=s.getAttribute($v);return p.push.apply(p,c?Q6(da(lO(s).querySelectorAll("["+$v+'="'+c+'"]:not(['+eO+'="disabled"])'))):[s]),p},[])},q6=function(a){return!a||!a.getPropertyValue?!1:a.getPropertyValue("display")==="none"||a.getPropertyValue("visibility")==="hidden"},uO=function(a){return!a||a===document||a&&a.nodeType===Node.DOCUMENT_NODE||!q6(window.getComputedStyle(a,null))&&uO(a.parentNode&&a.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?a.parentNode.host:a.parentNode)},Z6=function(a){return!((a.tagName==="INPUT"||a.tagName==="BUTTON")&&(a.type==="hidden"||a.disabled))},ob=function(a){return Boolean(a&&a.dataset&&a.dataset.focusGuard)},wf=function(a){return!ob(a)},$6=function(a){return Boolean(a)},J6=function(a,u){var p=a.tabIndex-u.tabIndex,s=a.index-u.index;if(p){if(!a.tabIndex)return 1;if(!u.tabIndex)return-1}return p||s},hO=function(a,u,p){return da(a).map(function(s,c){return{node:s,index:c,tabIndex:p&&s.tabIndex===-1?(s.dataset||{}).focusGuard?0:-1:s.tabIndex}}).filter(function(s){return!u||s.tabIndex>=0}).sort(J6)},eY=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],ab=eY.join(","),tY=ab+", [data-focus-guard]",sb=function(a,u){return a.reduce(function(p,s){return p.concat(da(s.querySelectorAll(u?tY:ab)),s.parentNode?da(s.parentNode.querySelectorAll(ab)).filter(function(c){return c===s}):[])},[])},nY=function(a){var u=a.querySelectorAll("["+U6+"]");return da(u).map(function(p){return sb([p])}).reduce(function(p,s){return p.concat(s)},[])},cb=function(a){return da(a).filter(function(u){return uO(u)}).filter(function(u){return Z6(u)})},lb=function(a,u){return hO(cb(sb(a,u)),!0,u)},dO=function(a){return hO(cb(sb(a)),!1)},rY=function(a){return cb(nY(a))},ub=function(a,u){return u===void 0&&(u=[]),u.push(a),a.parentNode&&ub(a.parentNode,u),u},hb=function(a,u){for(var p=ub(a),s=ub(u),c=0;c<p.length;c+=1){var E=p[c];if(s.indexOf(E)>=0)return E}return!1},fO=function(a,u,p){var s=rb(a),c=rb(u),E=s[0],m=!1;return c.filter(Boolean).forEach(function(S){m=hb(m||S,S)||m,p.filter(Boolean).forEach(function(h){var C=hb(E,h);C&&(!m||C.contains(m)?m=C:m=hb(C,m))})}),m},iY=function(a){return a.reduce(function(u,p){return u.concat(rY(p))},[])},oY=function(a){var u=ib(a).filter(wf),p=fO(a,a,u),s=lb([p],!0),c=lb(u).filter(function(E){var m=E.node;return wf(m)}).map(function(E){var m=E.node;return m});return s.map(function(E){var m=E.node,S=E.index;return{node:m,index:S,lockItem:c.indexOf(m)>=0,guard:ob(m)}})},aY=function(a){return a===document.activeElement},sY=function(a){return Boolean(da(a.querySelectorAll("iframe")).some(function(u){return aY(u)}))},pO=function(a){var u=document&&document.activeElement;return!u||u.dataset&&u.dataset.focusGuard?!1:ib(a).reduce(function(p,s){return p||s.contains(u)||sY(s)},!1)},cY=function(){return document&&da(document.querySelectorAll("["+B6+"]")).some(function(a){return a.contains(document.activeElement)})},mO=function(a){return a.tagName==="INPUT"&&a.type==="radio"},lY=function(a,u){return u.filter(mO).filter(function(p){return p.name===a.name}).filter(function(p){return p.checked})[0]||a},db=function(a,u){return mO(a)&&a.name?lY(a,u):a},uY=function(a){var u=new Set;return a.forEach(function(p){return u.add(db(p,a))}),a.filter(function(p){return u.has(p)})},_O=function(a){return a[0]&&a.length>1?db(a[0],a):a[0]},gO=function(a,u){return a.length>1?a.indexOf(db(a[u],a)):u},vO="NEW_FOCUS",hY=function(a,u,p,s){var c=a.length,E=a[0],m=a[c-1],S=ob(p);if(!(a.indexOf(p)>=0)){var h=u.indexOf(p),C=s?u.indexOf(s):h,R=s?a.indexOf(s):-1,I=h-C,b=u.indexOf(E),f=u.indexOf(m),x=uY(u),P=x.indexOf(p)-(s?x.indexOf(s):h),A=gO(a,0),T=gO(a,c-1);if(h===-1||R===-1)return vO;if(!I&&R>=0)return R;if(h<=b&&S&&Math.abs(I)>1)return T;if(h>=f&&S&&Math.abs(I)>1)return A;if(I&&Math.abs(P)>1)return R;if(h<=b)return T;if(h>f)return A;if(I)return Math.abs(I)>1?R:(c+R+I)%c}},dY=function(a){return function(u){return u.autofocus||u.dataset&&!!u.dataset.autofocus||a.indexOf(u)>=0}},fY=function(a,u){var p=new Map;return u.forEach(function(s){return p.set(s.node,s)}),a.map(function(s){return p.get(s)}).filter($6)},pY=function(a,u){var p=document&&document.activeElement,s=ib(a).filter(wf),c=fO(p||a,a,s),E=dO(s),m=lb(s).filter(function(b){var f=b.node;return wf(f)});if(!(!m[0]&&(m=E,!m[0]))){var S=dO([c]).map(function(b){var f=b.node;return f}),h=fY(S,m),C=h.map(function(b){var f=b.node;return f}),R=hY(C,S,p,u);if(R===vO){var I=E.map(function(b){var f=b.node;return f}).filter(dY(iY(s)));return{node:I&&I.length?_O(I):_O(C)}}return R===void 0?R:h[R]}},mY=function(a){a.focus(),"contentWindow"in a&&a.contentWindow&&a.contentWindow.focus()},fb=0,pb=!1,_Y=function(a,u){var p=pY(a,u);if(!pb&&p){if(fb>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),pb=!0,setTimeout(function(){pb=!1},1);return}fb++,mY(p.node),fb--}},bO=_Y;function yO(a){var u=window,p=u.setImmediate;typeof p!="undefined"?p(a):setTimeout(a,1)}var gY=function(){return document&&document.activeElement===document.body},vY=function(){return gY()||cY()},pc=null,mc=null,_c=null,Ru=!1,bY=function(){return!0},yY=function(u){return(pc.whiteList||bY)(u)},TY=function(u,p){_c={observerNode:u,portaledElement:p}},EY=function(u){return _c&&_c.portaledElement===u};function TO(a,u,p,s){var c=null,E=a;do{var m=s[E];if(m.guard)m.node.dataset.focusAutoGuard&&(c=m);else if(m.lockItem){if(E!==a)return;c=null}else break}while((E+=p)!==u);c&&(c.node.tabIndex=0)}var SY=function(u){return u&&"current"in u?u.current:u},xY=function(u){return u?Boolean(Ru):Ru==="meanwhile"},Lf=function(){var u=!1;if(pc){var p=pc,s=p.observed,c=p.persistentFocus,E=p.autoFocus,m=p.shards,S=p.crossFrame,h=s||_c&&_c.portaledElement,C=document&&document.activeElement;if(h){var R=[h].concat(m.map(SY).filter(Boolean));if((!C||yY(C))&&(c||xY(S)||!vY()||!mc&&E)&&(h&&!(pO(R)||EY(C))&&(document&&!mc&&C&&!E?(C.blur&&C.blur(),document.body.focus()):(u=bO(R,mc),_c={})),Ru=!1,mc=document&&document.activeElement),document){var I=document&&document.activeElement,b=oY(R),f=b.map(function(x){var P=x.node;return P}).indexOf(I);f>-1&&(b.filter(function(x){var P=x.guard,A=x.node;return P&&A.dataset.focusAutoGuard}).forEach(function(x){var P=x.node;return P.removeAttribute("tabIndex")}),TO(f,b.length,1,b),TO(f,-1,-1,b))}}}return u},EO=function(u){Lf()&&u&&(u.stopPropagation(),u.preventDefault())},mb=function(){return yO(Lf)},AY=function(u){var p=u.target,s=u.currentTarget;s.contains(p)||TY(s,p)},PY=function(){return null},SO=function(){Ru="just",setTimeout(function(){Ru="meanwhile"},0)},CY=function(){document.addEventListener("focusin",EO,!0),document.addEventListener("focusout",mb),window.addEventListener("blur",SO)},RY=function(){document.removeEventListener("focusin",EO,!0),document.removeEventListener("focusout",mb),window.removeEventListener("blur",SO)};function OY(a){return a.filter(function(u){var p=u.disabled;return!p})}function MY(a){var u=a.slice(-1)[0];u&&!pc&&CY();var p=pc,s=p&&u&&u.id===p.id;pc=u,p&&!s&&(p.onDeactivation(),a.filter(function(c){var E=c.id;return E===p.id}).length||p.returnFocus(!u)),u?(mc=null,(!s||p.observed!==u.observed)&&u.onActivation(),Lf(),yO(Lf)):(RY(),mc=null)}aO.assignSyncMedium(AY),sO.assignMedium(mb),G6.assignMedium(function(a){return a({moveFocusInside:bO,focusInside:pO})});var IY=K6(OY,MY)(PY),xO=Ci(function(u,p){return $e(cO,ra({sideCar:IY,ref:p},u))}),AO=cO.propTypes||{};AO.sideCar,D6(AO,["sideCar"]),xO.propTypes={};var DY=xO,wY=a=>{var{initialFocusRef:u,finalFocusRef:p,contentRef:s,restoreFocus:c,children:E,isDisabled:m,autoFocus:S,persistentFocus:h,lockFocusAcrossFrames:C}=a,R=Gt(()=>{if(u!=null&&u.current)u.current.focus();else if(s!=null&&s.current){var f=D2(s.current);f.length===0&&iA(s.current,{nextTick:!0})}},[u,s]),I=Gt(()=>{var f;p==null||(f=p.current)==null||f.focus()},[p]),b=c&&!p;return $e(DY,{crossFrame:C,persistentFocus:h,autoFocus:S,disabled:m,onActivation:R,onDeactivation:I,returnFocus:b},E)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var gc=function(){return gc=Object.assign||function(u){for(var p,s=1,c=arguments.length;s<c;s++){p=arguments[s];for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&(u[E]=p[E])}return u},gc.apply(this,arguments)};function LY(a,u){var p={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(p[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(p[s[c]]=a[s[c]]);return p}var Nf="right-scroll-bar-position",Ff="width-before-scroll-bar",NY="with-scroll-bars-hidden",FY="--removed-body-scroll-bar-size",PO=iO(),_b=function(){},Bf=Ci(function(a,u){var p=zt(null),s=ln({onScrollCapture:_b,onWheelCapture:_b,onTouchMoveCapture:_b}),c=s[0],E=s[1],m=a.forwardProps,S=a.children,h=a.className,C=a.removeScrollBar,R=a.enabled,I=a.shards,b=a.sideCar,f=a.noIsolation,x=a.inert,P=a.allowPinchZoom,A=a.as,T=A===void 0?"div":A,_=LY(a,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),g=b,M=tO([p,u]),O=gc({},_,c);return $e(lr,null,R&&$e(g,{sideCar:PO,removeScrollBar:C,shards:I,noIsolation:f,inert:x,setCallbacks:E,allowPinchZoom:!!P,lockRef:p}),m?ea(Ol.only(S),gc({},O,{ref:M})):$e(T,gc({},O,{className:h,ref:M}),S))});Bf.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Bf.classNames={fullWidth:Ff,zeroRight:Nf};var BY=function(){if(typeof __webpack_nonce__!="undefined")return __webpack_nonce__};function UY(){if(!document)return null;var a=document.createElement("style");a.type="text/css";var u=BY();return u&&a.setAttribute("nonce",u),a}function VY(a,u){a.styleSheet?a.styleSheet.cssText=u:a.appendChild(document.createTextNode(u))}function kY(a){var u=document.head||document.getElementsByTagName("head")[0];u.appendChild(a)}var jY=function(){var a=0,u=null;return{add:function(p){a==0&&(u=UY())&&(VY(u,p),kY(u)),a++},remove:function(){a--,!a&&u&&(u.parentNode&&u.parentNode.removeChild(u),u=null)}}},zY=function(){var a=jY();return function(u){Vt(function(){return a.add(u),function(){a.remove()}},[])}},CO=function(){var a=zY(),u=function(p){var s=p.styles;return a(s),null};return u},GY={left:0,top:0,right:0,gap:0},gb=function(a){return parseInt(a||"",10)||0},HY=function(a){var u=window.getComputedStyle(document.body),p=u[a==="padding"?"paddingLeft":"marginLeft"],s=u[a==="padding"?"paddingTop":"marginTop"],c=u[a==="padding"?"paddingRight":"marginRight"];return[gb(p),gb(s),gb(c)]},RO=function(a){if(a===void 0&&(a="margin"),typeof window=="undefined")return GY;var u=HY(a),p=document.documentElement.clientWidth,s=window.innerWidth;return{left:u[0],top:u[1],right:u[2],gap:Math.max(0,s-p+u[2]-u[0])}},WY=CO(),XY=function(a,u,p,s){var c=a.left,E=a.top,m=a.right,S=a.gap;return p===void 0&&(p="margin"),`
  .`+NY+` {
   overflow: hidden `+s+`;
   padding-right: `+S+"px "+s+`;
  }
  body {
    overflow: hidden `+s+`;
    `+[u&&"position: relative "+s+";",p==="margin"&&`
    padding-left: `+c+`px;
    padding-top: `+E+`px;
    padding-right: `+m+`px;
    margin-left:0;
    margin-top:0;
    margin-right: `+S+"px "+s+`;
    `,p==="padding"&&"padding-right: "+S+"px "+s+";"].filter(Boolean).join("")+`
  }
  
  .`+Nf+` {
    right: `+S+"px "+s+`;
  }
  
  .`+Ff+` {
    margin-right: `+S+"px "+s+`;
  }
  
  .`+Nf+" ."+Nf+` {
    right: 0 `+s+`;
  }
  
  .`+Ff+" ."+Ff+` {
    margin-right: 0 `+s+`;
  }
  
  body {
    `+FY+": "+S+`px;
  }
`},YY=function(a){var u=ln(RO(a.gapMode)),p=u[0],s=u[1];Vt(function(){s(RO(a.gapMode))},[a.gapMode]);var c=a.noRelative,E=a.noImportant,m=a.gapMode,S=m===void 0?"margin":m;return $e(WY,{styles:XY(p,!c,S,E?"":"!important")})},KY=function(a){var u=window.getComputedStyle(a);return u.overflowY!=="hidden"&&!(u.overflowY===u.overflowX&&u.overflowY==="visible")},QY=function(a){var u=window.getComputedStyle(a);return u.overflowX!=="hidden"&&!(u.overflowY===u.overflowX&&u.overflowX==="visible")},OO=function(a,u){var p=u;do{var s=MO(a,p);if(s){var c=IO(a,p),E=c[1],m=c[2];if(E>m)return!0}p=p.parentNode}while(p&&p!==document.body);return!1},qY=function(a){var u=a.scrollTop,p=a.scrollHeight,s=a.clientHeight;return[u,p,s]},ZY=function(a){var u=a.scrollLeft,p=a.scrollWidth,s=a.clientWidth;return[u,p,s]},MO=function(a,u){return a==="v"?KY(u):QY(u)},IO=function(a,u){return a==="v"?qY(u):ZY(u)},$Y=function(a,u,p,s,c){var E=s,m=p.target,S=u.contains(m),h=!1,C=E>0,R=0,I=0;do{var b=IO(a,m),f=b[0],x=b[1],P=b[2],A=x-P-f;(f||A)&&MO(a,m)&&(R+=A,I+=f),m=m.parentNode}while(!S&&m!==document.body||S&&(u.contains(m)||u===m));return(C&&(c&&R===0||!c&&E>R)||!C&&(c&&I===0||!c&&-E>I))&&(h=!0),h},vb=!1;if(typeof window!="undefined")try{var Uf=Object.defineProperty({},"passive",{get:function(){return vb=!0,!0}});window.addEventListener("test",Uf,Uf),window.removeEventListener("test",Uf,Uf)}catch(a){vb=!1}var vc=vb?{passive:!1}:!1,Vf=function(a){return"changedTouches"in a?[a.changedTouches[0].clientX,a.changedTouches[0].clientY]:[0,0]},DO=function(a){return[a.deltaX,a.deltaY]},wO=function(a){return a&&"current"in a?a.current:a},JY=function(a,u){return a[0]===u[0]&&a[1]===u[1]},e8=function(a){return`
  .block-interactivity-`+a+` {pointer-events: none;}
  .allow-interactivity-`+a+` {pointer-events: all;}
`},t8=0,bc=[];function n8(a){var u=zt([]),p=zt([0,0]),s=zt(),c=ln(t8++)[0],E=ln(function(){return CO()})[0],m=zt(a);Vt(function(){m.current=a},[a]),Vt(function(){if(a.inert){document.body.classList.add("block-interactivity-"+c);var P=[a.lockRef.current].concat((a.shards||[]).map(wO)).filter(Boolean);return P.forEach(function(A){return A.classList.add("allow-interactivity-"+c)}),function(){document.body.classList.remove("block-interactivity-"+c),P.forEach(function(A){return A.classList.remove("allow-interactivity-"+c)})}}},[a.inert,a.lockRef.current,a.shards]);var S=Gt(function(P,A){if("touches"in P&&P.touches.length===2)return!m.current.allowPinchZoom;var T=Vf(P),_=p.current,g="deltaX"in P?P.deltaX:_[0]-T[0],M="deltaY"in P?P.deltaY:_[1]-T[1],O,N=P.target,V=Math.abs(g)>Math.abs(M)?"h":"v",U=OO(V,N);if(!U)return!0;if(U?O=V:(O=V==="v"?"h":"v",U=OO(V,N)),!U)return!1;if(!s.current&&"changedTouches"in P&&(g||M)&&(s.current=O),!O)return!0;var L=s.current||O;return $Y(L,A,P,L==="h"?g:M,!0)},[]),h=Gt(function(P){var A=P;if(!(!bc.length||bc[bc.length-1]!==E)){var T="deltaY"in A?DO(A):Vf(A),_=u.current.filter(function(O){return O.name===A.type&&O.target===A.target&&JY(O.delta,T)})[0];if(_&&_.should){A.preventDefault();return}if(!_){var g=(m.current.shards||[]).map(wO).filter(Boolean).filter(function(O){return O.contains(A.target)}),M=g.length>0?S(A,g[0]):!m.current.noIsolation;M&&A.preventDefault()}}},[]),C=Gt(function(P,A,T,_){var g={name:P,delta:A,target:T,should:_};u.current.push(g),setTimeout(function(){u.current=u.current.filter(function(M){return M!==g})},1)},[]),R=Gt(function(P){p.current=Vf(P),s.current=void 0},[]),I=Gt(function(P){C(P.type,DO(P),P.target,S(P,a.lockRef.current))},[]),b=Gt(function(P){C(P.type,Vf(P),P.target,S(P,a.lockRef.current))},[]);Vt(function(){return bc.push(E),a.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:b}),document.addEventListener("wheel",h,vc),document.addEventListener("touchmove",h,vc),document.addEventListener("touchstart",R,vc),function(){bc=bc.filter(function(P){return P!==E}),document.removeEventListener("wheel",h,vc),document.removeEventListener("touchmove",h,vc),document.removeEventListener("touchstart",R,vc)}},[]);var f=a.removeScrollBar,x=a.inert;return $e(lr,null,x?$e(E,{styles:e8(c)}):null,f?$e(YY,{gapMode:"margin"}):null)}var r8=z6(PO,n8),LO=Ci(function(a,u){return $e(Bf,gc({},a,{ref:u,sideCar:r8}))});LO.classNames=Bf.classNames;var i8=LO,o8=function(a){if(typeof document=="undefined")return null;var u=Array.isArray(a)?a[0]:a;return u.ownerDocument.body},yc=new WeakMap,kf=new WeakMap,jf={},bb=0,a8=function(a,u,p){u===void 0&&(u=o8(a)),p===void 0&&(p="data-aria-hidden");var s=Array.isArray(a)?a:[a];jf[p]||(jf[p]=new WeakMap);var c=jf[p],E=[],m=new Set,S=function(C){!C||m.has(C)||(m.add(C),S(C.parentNode))};s.forEach(S);var h=function(C){!C||s.indexOf(C)>=0||Array.prototype.forEach.call(C.children,function(R){if(m.has(R))h(R);else{var I=R.getAttribute("aria-hidden"),b=I!==null&&I!=="false",f=(yc.get(R)||0)+1,x=(c.get(R)||0)+1;yc.set(R,f),c.set(R,x),E.push(R),f===1&&b&&kf.set(R,!0),x===1&&R.setAttribute(p,"true"),b||R.setAttribute("aria-hidden","true")}})};return h(u),m.clear(),bb++,function(){E.forEach(function(C){var R=yc.get(C)-1,I=c.get(C)-1;yc.set(C,R),c.set(C,I),R||(kf.has(C)||C.removeAttribute("aria-hidden"),kf.delete(C)),I||C.removeAttribute(p)}),bb--,bb||(yc=new WeakMap,yc=new WeakMap,kf=new WeakMap,jf={})}};function s8(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}class c8{constructor(){s8(this,"modals",void 0),this.modals=[]}add(u){this.modals.push(u)}remove(u){this.modals=this.modals.filter(p=>p!==u)}isTopModal(u){var p=this.modals[this.modals.length-1];return p===u}}var yb=new c8;function l8(a,u){Vt(()=>(u&&yb.add(a),()=>{yb.remove(a)}),[u,a])}function zf(){return zf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},zf.apply(this,arguments)}function u8(a){var{isOpen:u,onClose:p,id:s,closeOnOverlayClick:c=!0,closeOnEsc:E=!0,useInert:m=!0,onOverlayClick:S,onEsc:h}=a,C=zt(null),R=zt(null),[I,b,f]=q2(s,"chakra-modal","chakra-modal--header","chakra-modal--body");h8(C,u&&m),l8(C,u);var x=zt(null),P=Gt(U=>{x.current=U.target},[]),A=Gt(U=>{U.key==="Escape"&&(U.stopPropagation(),E&&(p==null||p()),h==null||h())},[E,p,h]),[T,_]=ln(!1),[g,M]=ln(!1),O=Gt(function(U,L){return U===void 0&&(U={}),L===void 0&&(L=null),zf({role:"dialog"},U,{ref:Gl(L,C),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":T?b:void 0,"aria-describedby":g?f:void 0,onClick:ur(U.onClick,j=>j.stopPropagation())})},[f,g,I,b,T]),N=Gt(U=>{U.stopPropagation(),x.current===U.target&&(!yb.isTopModal(C)||(c&&(p==null||p()),S==null||S()))},[p,c,S]),V=Gt(function(U,L){return U===void 0&&(U={}),L===void 0&&(L=null),zf({},U,{ref:Gl(L,R),onClick:ur(U.onClick,N),onKeyDown:ur(U.onKeyDown,A),onMouseDown:ur(U.onMouseDown,P)})},[A,P,N]);return{isOpen:u,onClose:p,headerId:b,bodyId:f,setBodyMounted:M,setHeaderMounted:_,dialogRef:C,overlayRef:R,getDialogProps:O,getDialogContainerProps:V}}function h8(a,u){Vt(()=>{if(!!a.current){var p=null;return u&&a.current&&(p=a8(a.current)),()=>{u&&(p==null||p())}}},[u,a])}function Gf(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}function Eo(){return Eo=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Eo.apply(this,arguments)}var[d8,Tc]=ia({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),NO=a=>{var{portalProps:u,children:p,autoFocus:s,trapFocus:c,initialFocusRef:E,finalFocusRef:m,returnFocusOnClose:S,blockScrollOnMount:h,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:I,lockFocusAcrossFrames:b}=a,f=Kl("Modal",a),x=u8(a),P=Eo({},x,{autoFocus:s,trapFocus:c,initialFocusRef:E,finalFocusRef:m,returnFocusOnClose:S,blockScrollOnMount:h,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:I,lockFocusAcrossFrames:b});return $e(d8,{value:P},$e(DA,{value:f},$e(wR,null,P.isOpen&&$e(Ud,u,p))))};NO.defaultProps={lockFocusAcrossFrames:!0,returnFocusOnClose:!0,scrollBehavior:"outside",trapFocus:!0,autoFocus:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale"};var f8=on(IR.div);function p8(a){var{autoFocus:u,trapFocus:p,dialogRef:s,initialFocusRef:c,blockScrollOnMount:E,allowPinchZoom:m,finalFocusRef:S,returnFocusOnClose:h,preserveScrollBarGap:C,lockFocusAcrossFrames:R}=Tc(),[I,b]=Jg();return Vt(()=>{!I&&b&&setTimeout(b)},[I,b]),$e(wY,{autoFocus:u,isDisabled:!p,initialFocusRef:c,finalFocusRef:S,restoreFocus:h,contentRef:s,lockFocusAcrossFrames:R},$e(i8,{removeScrollBar:!C,allowPinchZoom:m,enabled:E,forwardProps:!0},a.children))}var m8=Ln((a,u)=>{var{className:p}=a,s=Gf(a,["className","transition"]),c=ir("chakra-modal__overlay",p),E=oa(),m=Eo({pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh"},E.overlay),{motionPreset:S}=Tc(),h=S==="none"?{}:HX;return $e(f8,Eo({},h,{__css:m,ref:u,className:c},s))}),_8=Ln((a,u)=>{var{className:p}=a,s=Gf(a,["className"]),{headerId:c,setHeaderMounted:E}=Tc();Vt(()=>(E(!0),()=>E(!1)),[E]);var m=ir("chakra-modal__header",p),S=oa(),h=Eo({flex:0},S.header);return $e(on.header,Eo({ref:u,className:m,id:c},s,{__css:h}))}),g8=Ln((a,u)=>{var{className:p}=a,s=Gf(a,["className"]),{bodyId:c,setBodyMounted:E}=Tc();Vt(()=>(E(!0),()=>E(!1)),[E]);var m=ir("chakra-modal__body",p),S=oa();return $e(on.div,Eo({ref:u,className:m,id:c},s,{__css:S.body}))}),v8=Ln((a,u)=>{var{onClick:p,className:s}=a,c=Gf(a,["onClick","className"]),{onClose:E}=Tc(),m=ir("chakra-modal__close-btn",s),S=oa();return $e(b6,Eo({ref:u,__css:S.closeButton,className:m,onClick:ur(p,h=>{h.stopPropagation(),E()})},c))});function Qa(){return Qa=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},Qa.apply(this,arguments)}function FO(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var[b8,y8]=ia();function T8(a){var u,{isOpen:p,onClose:s,placement:c="right",children:E}=a,m=FO(a,["isOpen","onClose","placement","children"]),S=IA(),h=(u=S.components)==null?void 0:u.Drawer;return $e(b8,{value:{placement:c}},$e(NO,Qa({isOpen:p,onClose:s,styleConfig:h},m),E))}var E8=on(YX),S8=Ln((a,u)=>{var{className:p,children:s}=a,c=FO(a,["className","children"]),{getDialogProps:E,getDialogContainerProps:m,isOpen:S}=Tc(),h=E(c,u),C=m(),R=ir("chakra-modal__content",p),I=oa(),b=Qa({display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0},I.dialog),f=Qa({display:"flex",width:"100vw",height:"100vh",position:"fixed",left:0,top:0},I.dialogContainer),{placement:x}=y8();return $e(on.div,Qa({},C,{className:"chakra-modal__content-container",__css:f}),$e(p8,null,$e(E8,Qa({direction:x,in:S,className:R},h,{__css:b}),s)))});function fa(){return fa=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},fa.apply(this,arguments)}function Tb(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var x8=Ln((a,u)=>{var{children:p,placeholder:s,className:c}=a,E=Tb(a,["children","placeholder","className"]),m=GR(E);return $e(on.select,fa({},m,{ref:u,className:ir("chakra-select",c)}),s&&$e("option",{value:""},s),p)}),A8=Ln((a,u)=>{var p=Kl("Select",a),s=aa(a),{rootProps:c,placeholder:E,icon:m,color:S,height:h,h:C,minH:R,minHeight:I,iconColor:b,iconSize:f}=s,x=Tb(s,["rootProps","placeholder","icon","color","height","h","minH","minHeight","iconColor","iconSize","isFullWidth"]),[P,A]=m2(x,WU),T={width:"100%",height:"fit-content",position:"relative",color:S},_=go({},p.field,{paddingEnd:"2rem",_focus:{zIndex:"unset"}});return $e(on.div,fa({className:"chakra-select__wrapper",__css:T},P,c),$e(x8,fa({ref:u,height:C??h,minH:R??I,placeholder:E},A,{__css:_}),a.children),$e(R8,fa({"data-disabled":a.isDisabled},(b||S)&&{color:b||S},{__css:p.icon},f&&{fontSize:f}),m))}),P8=a=>$e("svg",fa({viewBox:"0 0 24 24"},a),$e("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})),C8=on("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),R8=a=>{var{children:u=$e(P8,null)}=a,p=Tb(a,["children"]),s=ea(u,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return $e(C8,fa({},p,{className:"chakra-select__icon-wrapper"}),Jo(u)?s:null)};function So(){return So=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(a[s]=p[s])}return a},So.apply(this,arguments)}function O8(a,u){if(a==null)return{};var p={},s=Object.keys(a),c,E;for(E=0;E<s.length;E++)c=s[E],!(u.indexOf(c)>=0)&&(p[c]=a[c]);return p}var M8=Ln((a,u)=>{var p=Kl("Switch",a),s=aa(a),{spacing:c="0.5rem",children:E}=s,m=O8(s,["spacing","children"]),{state:S,getInputProps:h,getCheckboxProps:C,getRootProps:R,getLabelProps:I}=_6(m),b=Hn(()=>So({display:"inline-block",verticalAlign:"middle",lineHeight:"normal"},p.container),[p.container]),f=Hn(()=>So({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer"},p.track),[p.track]),x=Hn(()=>So({userSelect:"none",marginStart:c},p.label),[c,p.label]);return $e(on.label,So({},R(),{className:ir("chakra-switch",a.className),__css:b}),$e("input",So({className:"chakra-switch__input"},h({},u))),$e(on.span,So({},C(),{className:"chakra-switch__track",__css:f}),$e(on.span,{__css:p.thumb,className:"chakra-switch__thumb","data-checked":Cr(S.isChecked),"data-hover":Cr(S.isHovered)})),E&&$e(on.span,So({className:"chakra-switch__label"},I(),{__css:x}),E))});function I8(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}function BO(a,u){var p=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);u&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),p.push.apply(p,s)}return p}function UO(a){for(var u=1;u<arguments.length;u++){var p=arguments[u]!=null?arguments[u]:{};u%2?BO(Object(p),!0).forEach(function(s){I8(a,s,p[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(p)):BO(Object(p)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(p,s))})}return a}function D8(a,u){return w8(a)||L8(a,u)||N8(a,u)||F8()}function w8(a){if(Array.isArray(a))return a}function L8(a,u){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(a)))){var p=[],s=!0,c=!1,E=void 0;try{for(var m=a[Symbol.iterator](),S;!(s=(S=m.next()).done)&&(p.push(S.value),!(u&&p.length===u));s=!0);}catch(h){c=!0,E=h}finally{try{!s&&m.return!=null&&m.return()}finally{if(c)throw E}}return p}}function N8(a,u){if(!!a){if(typeof a=="string")return VO(a,u);var p=Object.prototype.toString.call(a).slice(8,-1);if(p==="Object"&&a.constructor&&(p=a.constructor.name),p==="Map"||p==="Set")return Array.from(a);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return VO(a,u)}}function VO(a,u){(u==null||u>a.length)&&(u=a.length);for(var p=0,s=new Array(u);p<u;p++)s[p]=a[p];return s}function F8(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B8(a,u,p){return u in a?Object.defineProperty(a,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):a[u]=p,a}function kO(a,u){var p=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);u&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),p.push.apply(p,s)}return p}function jO(a){for(var u=1;u<arguments.length;u++){var p=arguments[u]!=null?arguments[u]:{};u%2?kO(Object(p),!0).forEach(function(s){B8(a,s,p[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(p)):kO(Object(p)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(p,s))})}return a}function U8(){for(var a=arguments.length,u=new Array(a),p=0;p<a;p++)u[p]=arguments[p];return function(s){return u.reduceRight(function(c,E){return E(c)},s)}}function Ou(a){return function u(){for(var p=this,s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,S=new Array(m),h=0;h<m;h++)S[h]=arguments[h];return u.apply(p,[].concat(c,S))}}}function Hf(a){return{}.toString.call(a).includes("Object")}function V8(a){return!Object.keys(a).length}function Mu(a){return typeof a=="function"}function k8(a,u){return Object.prototype.hasOwnProperty.call(a,u)}function j8(a,u){return Hf(u)||pa("changeType"),Object.keys(u).some(function(p){return!k8(a,p)})&&pa("changeField"),u}function z8(a){Mu(a)||pa("selectorType")}function G8(a){Mu(a)||Hf(a)||pa("handlerType"),Hf(a)&&Object.values(a).some(function(u){return!Mu(u)})&&pa("handlersType")}function H8(a){a||pa("initialIsRequired"),Hf(a)||pa("initialType"),V8(a)&&pa("initialContent")}function W8(a,u){throw new Error(a[u]||a.default)}var X8={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},pa=Ou(W8)(X8),Wf={changes:j8,selector:z8,handler:G8,initial:H8};function Y8(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wf.initial(a),Wf.handler(u);var p={current:a},s=Ou(q8)(p,u),c=Ou(Q8)(p),E=Ou(Wf.changes)(a),m=Ou(K8)(p);function S(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(R){return R};return Wf.selector(C),C(p.current)}function h(C){U8(s,c,E,m)(C)}return[S,h]}function K8(a,u){return Mu(u)?u(a.current):u}function Q8(a,u){return a.current=jO(jO({},a.current),u),u}function q8(a,u,p){return Mu(u)?u(a.current):Object.keys(p).forEach(function(s){var c;return(c=u[s])===null||c===void 0?void 0:c.call(u,a.current[s])}),p}var Z8={create:Y8},$8={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.25.2/min/vs"}};function J8(a){return function u(){for(var p=this,s=arguments.length,c=new Array(s),E=0;E<s;E++)c[E]=arguments[E];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,S=new Array(m),h=0;h<m;h++)S[h]=arguments[h];return u.apply(p,[].concat(c,S))}}}function eK(a){return{}.toString.call(a).includes("Object")}function tK(a){return a||GO("configIsRequired"),eK(a)||GO("configType"),a.urls?(nK(),{paths:{vs:a.urls.monacoBase}}):a}function nK(){console.warn(zO.deprecation)}function rK(a,u){throw new Error(a[u]||a.default)}var zO={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},GO=J8(rK)(zO),iK={config:tK},oK=function(){for(var u=arguments.length,p=new Array(u),s=0;s<u;s++)p[s]=arguments[s];return function(c){return p.reduceRight(function(E,m){return m(E)},c)}};function HO(a,u){return Object.keys(u).forEach(function(p){u[p]instanceof Object&&a[p]&&Object.assign(u[p],HO(a[p],u[p]))}),UO(UO({},a),u)}var aK={type:"cancelation",msg:"operation is manually canceled"};function WO(a){var u=!1,p=new Promise(function(s,c){a.then(function(E){return u?c(aK):s(E)}),a.catch(c)});return p.cancel=function(){return u=!0},p}var sK=Z8.create({config:$8,isInitialized:!1,resolve:null,reject:null,monaco:null}),XO=D8(sK,2),Iu=XO[0],Xf=XO[1];function cK(a){Xf(function(u){return{config:HO(u.config,iK.config(a))}})}function lK(){var a=Iu(function(u){var p=u.isInitialized;return{isInitialized:p}});if(!a.isInitialized){if(window.monaco&&window.monaco.editor)return YO(window.monaco),WO(Promise.resolve(window.monaco));oK(uK,dK)(fK),Xf({isInitialized:!0})}return WO(mK)}function uK(a){return document.body.appendChild(a)}function hK(a){var u=document.createElement("script");return a&&(u.src=a),u}function dK(a){var u=Iu(function(s){var c=s.config,E=s.reject;return{config:c,reject:E}}),p=hK("".concat(u.config.paths.vs,"/loader.js"));return p.onload=function(){return a()},p.onerror=u.reject,p}function fK(){var a=Iu(function(p){var s=p.config,c=p.resolve,E=p.reject;return{config:s,resolve:c,reject:E}}),u=window.require;u.config(a.config),u(["vs/editor/editor.main"],function(p){YO(p),a.resolve(p)},function(p){a.reject(p)})}function YO(a){Iu().monaco||Xf({monaco:a})}function pK(){return Iu(function(a){var u=a.monaco;return u})}var mK=new Promise(function(a,u){return Xf({resolve:a,reject:u})}),_K={config:cK,init:lK,__getMonacoInstance:pK};const gK={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function vK({content:a}){return Jr.createElement("div",{style:gK},a)}const Eb={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function KO({width:a,height:u,isEditorReady:p,loading:s,_ref:c,className:E,wrapperClassName:m}){return Jr.createElement("section",{style:{...Eb.wrapper,width:a,height:u},className:m},!p&&Jr.createElement(vK,{content:s}),Jr.createElement("div",{ref:c,style:{...Eb.fullWidth,...!p&&Eb.hide},className:E}))}KO.propTypes={width:Ct.oneOfType([Ct.number,Ct.string]).isRequired,height:Ct.oneOfType([Ct.number,Ct.string]).isRequired,loading:Ct.oneOfType([Ct.element,Ct.string]).isRequired,isEditorReady:Ct.bool.isRequired,className:Ct.string,wrapperClassName:Ct.string};var bK=Rl(KO);function yK(a){Vt(a,[])}function Ec(a,u,p=!0){const s=zt(!0);Vt(s.current||!p?()=>{s.current=!1}:a,u)}function Sb(){}function QO(a,u,p,s){return TK(a,s)||EK(a,u,p,s)}function TK(a,u){return a.editor.getModel(qO(a,u))}function EK(a,u,p,s){return a.editor.createModel(u,p,s&&qO(a,s))}function qO(a,u){return a.Uri.parse(u)}function SK(a){return a===void 0}Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.string,Ct.bool,Ct.bool,Ct.string,Ct.oneOfType([Ct.element,Ct.string]),Ct.object,Ct.oneOfType([Ct.number,Ct.string]),Ct.oneOfType([Ct.number,Ct.string]),Ct.string,Ct.string,Ct.func,Ct.func;function xK(a){const u=zt();return Vt(()=>{u.current=a},[a]),u.current}const Yf=new Map;function xb({defaultValue:a,defaultLanguage:u,defaultPath:p,value:s,language:c,path:E,theme:m,line:S,loading:h,options:C,overrideServices:R,saveViewState:I,keepCurrentModel:b,width:f,height:x,className:P,wrapperClassName:A,beforeMount:T,onMount:_,onChange:g,onValidate:M}){const[O,N]=ln(!1),[V,U]=ln(!0),L=zt(null),j=zt(null),Y=zt(null),W=zt(_),ie=zt(T),re=zt(null),ye=zt(s),ve=xK(E);yK(()=>{const Z=_K.init();return Z.then(J=>(L.current=J)&&U(!1)).catch(J=>(J==null?void 0:J.type)!=="cancelation"&&console.error("Monaco initialization: error:",J)),()=>j.current?oe():Z.cancel()}),Ec(()=>{const Z=QO(L.current,a||s,u||c,E);Z!==j.current.getModel()&&(I&&Yf.set(ve,j.current.saveViewState()),j.current.setModel(Z),I&&j.current.restoreViewState(Yf.get(E)))},[E],O),Ec(()=>{j.current.updateOptions(C)},[C],O),Ec(()=>{j.current.getOption(L.current.editor.EditorOption.readOnly)?j.current.setValue(s):s!==j.current.getValue()&&(j.current.executeEdits("",[{range:j.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),j.current.pushUndoStop())},[s],O),Ec(()=>{L.current.editor.setModelLanguage(j.current.getModel(),c)},[c],O),Ec(()=>{SK(S)||j.current.revealLine(S)},[S],O),Ec(()=>{L.current.editor.setTheme(m)},[m],O);const ue=Gt(()=>{ie.current(L.current);const Z=E||p,J=QO(L.current,s||a,u||c,Z);j.current=L.current.editor.create(Y.current,{model:J,automaticLayout:!0,...C},R),I&&j.current.restoreViewState(Yf.get(Z)),L.current.editor.setTheme(m),N(!0)},[a,u,p,s,c,E,C,R,I,m]);Vt(()=>{O&&W.current(j.current,L.current)},[O]),Vt(()=>{!V&&!O&&ue()},[V,O,ue]),ye.current=s,Vt(()=>{if(O&&g){var Z,J;(Z=re.current)===null||Z===void 0||Z.dispose(),re.current=(J=j.current)===null||J===void 0?void 0:J.onDidChangeModelContent(B=>{const G=j.current.getValue();ye.current!==G&&g(G,B)})}},[O,g]),Vt(()=>{if(O){const Z=L.current.editor.onDidChangeMarkers(J=>{var B;const G=(B=j.current.getModel())===null||B===void 0?void 0:B.uri;if(G&&J.find(he=>he.path===G.path)){const he=L.current.editor.getModelMarkers({resource:G});M==null||M(he)}});return()=>{Z==null||Z.dispose()}}},[O,M]);function oe(){var Z;if((Z=re.current)===null||Z===void 0||Z.dispose(),b)I&&Yf.set(E,j.current.saveViewState());else{var J;(J=j.current.getModel())===null||J===void 0||J.dispose()}j.current.dispose()}return Jr.createElement(bK,{width:f,height:x,isEditorReady:O,loading:h,_ref:Y,className:P,wrapperClassName:A})}xb.propTypes={defaultValue:Ct.string,defaultPath:Ct.string,defaultLanguage:Ct.string,value:Ct.string,language:Ct.string,path:Ct.string,theme:Ct.string,line:Ct.number,loading:Ct.oneOfType([Ct.element,Ct.string]),options:Ct.object,overrideServices:Ct.object,saveViewState:Ct.bool,keepCurrentModel:Ct.bool,width:Ct.oneOfType([Ct.number,Ct.string]),height:Ct.oneOfType([Ct.number,Ct.string]),className:Ct.string,wrapperClassName:Ct.string,beforeMount:Ct.func,onMount:Ct.func,onChange:Ct.func,onValidate:Ct.func},xb.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",beforeMount:Sb,onMount:Sb,onValidate:Sb};var AK=Rl(xb),PK=nu({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),CK=nu({displayName:"EditIcon",path:$e("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2"},$e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),$e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))}),RK=nu({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),OK=nu({d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,19a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,12,19Zm1.6-6.08a1,1,0,0,0-.6.917,1,1,0,1,1-2,0,3,3,0,0,1,1.8-2.75A2,2,0,1,0,10,9.255a1,1,0,1,1-2,0,4,4,0,1,1,5.6,3.666Z",displayName:"QuestionIcon"}),MK=nu({viewBox:"0 0 14 14",path:$e("g",{fill:"currentColor"},$e("polygon",{points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"}))});function IK(a){let u;const p=new Set,s=(C,R)=>{const I=typeof C=="function"?C(u):C;if(I!==u){const b=u;u=R?I:Object.assign({},u,I),p.forEach(f=>f(u,b))}},c=()=>u,E=(C,R=c,I=Object.is)=>{let b=R(u);function f(){const x=R(u);if(!I(b,x)){const P=b;C(b=x,P)}}return p.add(f),()=>p.delete(f)},h={setState:s,getState:c,subscribe:(C,R,I)=>R||I?E(C,R,I):(p.add(C),()=>p.delete(C)),destroy:()=>p.clear()};return u=a(s,c,h),h}const DK=typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),ZO=DK?Vt:$o;function wK(a){const u=typeof a=="function"?IK(a):a,p=(s=u.getState,c=Object.is)=>{const[,E]=ed(P=>P+1,0),m=u.getState(),S=zt(m),h=zt(s),C=zt(c),R=zt(!1),I=zt();I.current===void 0&&(I.current=s(m));let b,f=!1;(S.current!==m||h.current!==s||C.current!==c||R.current)&&(b=s(m),f=!c(I.current,b)),ZO(()=>{f&&(I.current=b),S.current=m,h.current=s,C.current=c,R.current=!1});const x=zt(m);return ZO(()=>{const P=()=>{try{const T=u.getState(),_=h.current(T);C.current(I.current,_)||(S.current=T,I.current=_,E())}catch(T){R.current=!0,E()}},A=u.subscribe(P);return u.getState()!==x.current&&P(),A},[]),f?b:I.current};return Object.assign(p,u),p[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[p,u];return{next(){const c=s.length<=0;return{value:s.shift(),done:c}}}},p}var $O={},Ab={},Xn=y_(nF),Yn=y_(l2),kn={},Li={};Object.defineProperty(Li,"__esModule",{value:!0}),Li.heightWidthRadiusDefaults=Li.heightWidthDefaults=Li.sizeMarginDefaults=Li.sizeDefaults=void 0;var JO={loading:!0,color:"#000000",css:"",speedMultiplier:1};function eM(a){return Object.assign({},JO,{size:a})}Li.sizeDefaults=eM;function LK(a){return Object.assign({},eM(a),{margin:2})}Li.sizeMarginDefaults=LK;function tM(a,u){return Object.assign({},JO,{height:a,width:u})}Li.heightWidthDefaults=tM;function NK(a,u,p){return p===void 0&&(p=2),Object.assign({},tM(a,u),{radius:p,margin:2})}Li.heightWidthRadiusDefaults=NK;var Kf={};Object.defineProperty(Kf,"__esModule",{value:!0}),Kf.calculateRgba=void 0;var Qf;(function(a){a.maroon="#800000",a.red="#FF0000",a.orange="#FFA500",a.yellow="#FFFF00",a.olive="#808000",a.green="#008000",a.purple="#800080",a.fuchsia="#FF00FF",a.lime="#00FF00",a.teal="#008080",a.aqua="#00FFFF",a.blue="#0000FF",a.navy="#000080",a.black="#000000",a.gray="#808080",a.silver="#C0C0C0",a.white="#FFFFFF"})(Qf||(Qf={}));var FK=function(a,u){if(Object.keys(Qf).includes(a)&&(a=Qf[a]),a[0]==="#"&&(a=a.slice(1)),a.length===3){var p="";a.split("").forEach(function(c){p+=c,p+=c}),a=p}var s=(a.match(/.{2}/g)||[]).map(function(c){return parseInt(c,16)}).join(", ");return"rgba("+s+", "+u+")"};Kf.calculateRgba=FK;var Sc={};Object.defineProperty(Sc,"__esModule",{value:!0}),Sc.cssValue=Sc.parseLengthAndUnit=void 0;var BK={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function nM(a){if(typeof a=="number")return{value:a,unit:"px"};var u,p=(a.match(/^[0-9.]*/)||"").toString();p.includes(".")?u=parseFloat(p):u=parseInt(p,10);var s=(a.match(/[^0-9]*$/)||"").toString();return BK[s]?{value:u,unit:s}:(console.warn("React Spinners: "+a+" is not a valid css value. Defaulting to "+u+"px."),{value:u,unit:"px"})}Sc.parseLengthAndUnit=nM;function UK(a){var u=nM(a);return""+u.value+u.unit}Sc.cssValue=UK,function(a){var u=Be&&Be.__createBinding||(Object.create?function(s,c,E,m){m===void 0&&(m=E),Object.defineProperty(s,m,{enumerable:!0,get:function(){return c[E]}})}:function(s,c,E,m){m===void 0&&(m=E),s[m]=c[E]}),p=Be&&Be.__exportStar||function(s,c){for(var E in s)E!=="default"&&!Object.prototype.hasOwnProperty.call(c,E)&&u(c,s,E)};Object.defineProperty(a,"__esModule",{value:!0}),p(Li,a),p(Kf,a),p(Sc,a)}(kn);var qf=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},VK=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),kK=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),jK=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),zK=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&kK(u,a,p);return jK(u,a),u};Object.defineProperty(Ab,"__esModule",{value:!0});var GK=zK(Xn),qa=Yn,Du=kn,HK=qa.keyframes(rM||(rM=qf([`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`],[`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`]))),WK=qa.keyframes(iM||(iM=qf([`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`],[`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`]))),XK=function(a){VK(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.height,m=c.color,S=c.speedMultiplier;return qa.css(oM||(oM=qf([`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `],[`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `])),Du.cssValue(E),m,s===1?HK:WK,2.1/S,s===2?1.15/S+"s":"",s===1?"cubic-bezier(0.65, 0.815, 0.735, 0.395)":"cubic-bezier(0.165, 0.84, 0.44, 1)")},p.wrapper=function(){var s=p.props,c=s.width,E=s.height,m=s.color;return qa.css(aM||(aM=qf([`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `])),Du.cssValue(c),Du.cssValue(E),Du.calculateRgba(m,.2))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?qa.jsx("span",{css:[this.wrapper(),c]},qa.jsx("span",{css:this.style(1)}),qa.jsx("span",{css:this.style(2)})):null},u.defaultProps=Du.heightWidthDefaults(4,100),u}(GK.PureComponent);Ab.default=XK;var rM,iM,oM,aM,Pb={},sM=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},YK=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),KK=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),QK=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),qK=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&KK(u,a,p);return QK(u,a),u};Object.defineProperty(Pb,"__esModule",{value:!0});var ZK=qK(Xn),xc=Yn,Zf=kn,$K=xc.keyframes(cM||(cM=sM([`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`],[`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`]))),JK=function(a){YK(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.margin,h=c.speedMultiplier;return xc.css(lM||(lM=sM([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `])),E,Zf.cssValue(m),Zf.cssValue(m),Zf.cssValue(S),$K,.7/h,s%2?"0s":.35/h+"s")},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?xc.jsx("span",{css:[c]},xc.jsx("span",{css:this.style(1)}),xc.jsx("span",{css:this.style(2)}),xc.jsx("span",{css:this.style(3)})):null},u.defaultProps=Zf.sizeMarginDefaults(15),u}(ZK.PureComponent);Pb.default=JK;var cM,lM,Cb={},Rb=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},e7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),t7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),n7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),r7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&t7(u,a,p);return n7(u,a),u};Object.defineProperty(Cb,"__esModule",{value:!0});var i7=r7(Xn),Ac=Yn,wu=kn,o7=Ac.keyframes(uM||(uM=Rb([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),a7=function(a){e7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.speedMultiplier;return Ac.css(hM||(hM=Rb([`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `])),wu.cssValue(m),wu.cssValue(m),E,o7,2.1/S,s===1?1/S+"s":"0s")},p.wrapper=function(){var s=p.props.size;return Ac.css(dM||(dM=Rb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),wu.cssValue(s),wu.cssValue(s))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Ac.jsx("span",{css:[this.wrapper(),c]},Ac.jsx("span",{css:this.style(1)}),Ac.jsx("span",{css:this.style(2)})):null},u.defaultProps=wu.sizeDefaults(60),u}(i7.PureComponent);Cb.default=a7;var uM,hM,dM,Ob={},Mb=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},s7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),c7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),l7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),u7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&c7(u,a,p);return l7(u,a),u};Object.defineProperty(Ob,"__esModule",{value:!0});var h7=u7(Xn),xo=Yn,$f=kn,d7=xo.keyframes(fM||(fM=Mb([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),f7=function(a){s7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.size,m=c.color,S=c.speedMultiplier,h=$f.parseLengthAndUnit(E),C=h.value,R=h.unit;return xo.css(pM||(pM=Mb([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `])),""+C*(1-s/10)+R,""+C*(1-s/10)+R,m,s*.7*2.5,s*.35*2.5,d7,1/S,s*.2/S)},p.wrapper=function(){var s=p.props.size;return xo.css(mM||(mM=Mb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),$f.cssValue(s),$f.cssValue(s))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?xo.jsx("span",{css:[this.wrapper(),c]},xo.jsx("span",{css:this.style(0)}),xo.jsx("span",{css:this.style(1)}),xo.jsx("span",{css:this.style(2)}),xo.jsx("span",{css:this.style(3)}),xo.jsx("span",{css:this.style(4)})):null},u.defaultProps=$f.sizeDefaults(50),u}(h7.PureComponent);Ob.default=f7;var fM,pM,mM,Ib={},Lu=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},p7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),m7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),_7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),g7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&m7(u,a,p);return _7(u,a),u};Object.defineProperty(Ib,"__esModule",{value:!0});var v7=g7(Xn),Ao=Yn,_M=kn,b7=Ao.keyframes(gM||(gM=Lu([`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`],[`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`]))),y7=function(a){p7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(){var s=p.props,c=s.color,E=s.speedMultiplier;return Ao.css(vM||(vM=Lu([`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `],[`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `])),c,b7,2.5/E)},p.wrapper=function(){var s=p.props.size;return Ao.css(bM||(bM=Lu([`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `],[`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `])),_M.cssValue(s))},p.hill=function(){var s=p.props.color;return Ao.css(yM||(yM=Lu([`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `],[`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `])),s)},p.container=function(){return Ao.css(TM||(TM=Lu([`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `],[`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `])))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Ao.jsx("span",{css:[this.container(),c]},Ao.jsx("span",{css:this.wrapper()},Ao.jsx("span",{css:this.style()}),Ao.jsx("span",{css:this.hill()}))):null},u.defaultProps=_M.sizeDefaults(15),u}(v7.PureComponent);Ib.default=y7;var gM,vM,bM,yM,TM,Db={},EM=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},T7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),E7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),S7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),x7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&E7(u,a,p);return S7(u,a),u};Object.defineProperty(Db,"__esModule",{value:!0});var A7=x7(Xn),wb=Yn,Lb=kn,P7=wb.keyframes(SM||(SM=EM([`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`],[`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`]))),C7=function(a){T7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(){var s=p.props,c=s.size,E=s.color,m=s.speedMultiplier;return wb.css(xM||(xM=EM([`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `],[`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `])),Lb.cssValue(c),Lb.cssValue(c),E,P7,.75/m)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?wb.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=Lb.sizeDefaults(35),u}(A7.PureComponent);Db.default=C7;var SM,xM,Nb={},AM=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},R7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),O7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),M7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),I7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&O7(u,a,p);return M7(u,a),u};Object.defineProperty(Nb,"__esModule",{value:!0});var D7=I7(Xn),Fb=Yn,PM=kn,CM=Fb.keyframes(RM||(RM=AM([`
  100% { transform: rotate(360deg) }
`],[`
  100% { transform: rotate(360deg) }
`]))),w7=function(a){R7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.wrapper=function(){var s=p.props,c=s.size,E=s.color,m=s.speedMultiplier,S=PM.parseLengthAndUnit(c),h=S.value,C=S.unit;return Fb.css(OM||(OM=AM([`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `])),""+h+C,""+h+C,E,E,h/2.4,h/2-1,h/2-1,CM,2/m,h/3,h/2-1,h/2-1,CM,8/m)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Fb.jsx("span",{css:[this.wrapper(),c]}):null},u.defaultProps=PM.sizeDefaults(50),u}(D7.PureComponent);Nb.default=w7;var RM,OM,Bb={},Jf=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},L7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),N7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),F7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),B7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&N7(u,a,p);return F7(u,a),u};Object.defineProperty(Bb,"__esModule",{value:!0});var U7=B7(Xn),Za=Yn,ep=kn,V7=Za.keyframes(MM||(MM=Jf([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),k7=Za.keyframes(IM||(IM=Jf([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),j7=function(a){L7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.size,m=c.color,S=c.speedMultiplier,h=ep.parseLengthAndUnit(E),C=h.value,R=h.unit;return Za.css(DM||(DM=Jf([`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `],[`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `])),s%2?"0":"auto",s%2?"auto":"0",""+C/2+R,""+C/2+R,m,k7,2/S,s===2?"-1s":"0s")},p.wrapper=function(){var s=p.props,c=s.size,E=s.speedMultiplier;return Za.css(wM||(wM=Jf([`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `])),ep.cssValue(c),ep.cssValue(c),V7,2/E)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Za.jsx("span",{css:[this.wrapper(),c]},Za.jsx("span",{css:this.style(1)}),Za.jsx("span",{css:this.style(2)})):null},u.defaultProps=ep.sizeDefaults(60),u}(U7.PureComponent);Bb.default=j7;var MM,IM,DM,wM,Ub={},Ni=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},z7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),G7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),H7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),W7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&G7(u,a,p);return H7(u,a),u};Object.defineProperty(Ub,"__esModule",{value:!0});var X7=W7(Xn),or=Yn,Pc=kn,Y7=or.keyframes(LM||(LM=Ni([`
  50% {opacity: 0.3}
  100% {opacity: 1}
`],[`
  50% {opacity: 0.3}
  100% {opacity: 1}
`]))),K7=function(a){z7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.radius=function(){var s=p.props.margin,c=Pc.parseLengthAndUnit(s).value;return c+18},p.quarter=function(){return p.radius()/2+p.radius()/5.5},p.style=function(s){var c=p.props,E=c.height,m=c.width,S=c.margin,h=c.color,C=c.radius,R=c.speedMultiplier;return or.css(NM||(NM=Ni([`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `],[`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `])),Pc.cssValue(m),Pc.cssValue(E),Pc.cssValue(S),h,Pc.cssValue(C),Y7,1.2/R,s*.12)},p.wrapper=function(){return or.css(FM||(FM=Ni([`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `],[`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `])),p.radius(),p.radius(),p.radius()*3,p.radius()*3)},p.a=function(){return or.css(BM||(BM=Ni([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),p.style(1),p.radius())},p.b=function(){return or.css(UM||(UM=Ni([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),p.style(2),p.quarter(),p.quarter())},p.c=function(){return or.css(VM||(VM=Ni([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),p.style(3),p.radius())},p.d=function(){return or.css(kM||(kM=Ni([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),p.style(4),-p.quarter(),p.quarter())},p.e=function(){return or.css(jM||(jM=Ni([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),p.style(5),-p.radius())},p.f=function(){return or.css(zM||(zM=Ni([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),p.style(6),-p.quarter(),-p.quarter())},p.g=function(){return or.css(GM||(GM=Ni([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),p.style(7),-p.radius())},p.h=function(){return or.css(HM||(HM=Ni([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),p.style(8),p.quarter(),-p.quarter())},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?or.jsx("span",{css:[this.wrapper(),c]},or.jsx("span",{css:this.a()}),or.jsx("span",{css:this.b()}),or.jsx("span",{css:this.c()}),or.jsx("span",{css:this.d()}),or.jsx("span",{css:this.e()}),or.jsx("span",{css:this.f()}),or.jsx("span",{css:this.g()}),or.jsx("span",{css:this.h()})):null},u.defaultProps=Pc.heightWidthRadiusDefaults(15,5,2),u}(X7.PureComponent);Ub.default=K7;var LM,NM,FM,BM,UM,VM,kM,jM,zM,GM,HM,Vb={},kb=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},Q7=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),q7=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),Z7=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),$7=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&q7(u,a,p);return Z7(u,a),u};Object.defineProperty(Vb,"__esModule",{value:!0});var J7=$7(Xn),ii=Yn,Cc=kn,e9=ii.keyframes(WM||(WM=kb([`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`]))),Po=function(a){return Math.random()*a},t9=function(a){Q7(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.margin,h=c.speedMultiplier;return ii.css(XM||(XM=kb([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `])),E,Cc.cssValue(m),Cc.cssValue(m),Cc.cssValue(S),e9,(s/100+.6)/h,s/100-.2)},p.wrapper=function(){var s=p.props,c=s.size,E=s.margin,m=Cc.parseLengthAndUnit(c),S=Cc.parseLengthAndUnit(E),h=""+(parseFloat(m.value.toString())*3+parseFloat(S.value.toString())*6)+m.unit;return ii.css(YM||(YM=kb([`
      width: `,`;
      font-size: 0;
    `],[`
      width: `,`;
      font-size: 0;
    `])),h)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?ii.jsx("span",{css:[this.wrapper(),c]},ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))}),ii.jsx("span",{css:this.style(Po(100))})):null},u.defaultProps=Cc.sizeMarginDefaults(15),u}(J7.PureComponent);Vb.default=t9;var WM,XM,YM,jb={},n9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),tp=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},r9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),i9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),o9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&r9(u,a,p);return i9(u,a),u};Object.defineProperty(jb,"__esModule",{value:!0});var a9=o9(Xn),$a=Yn,Co=kn,s9=function(a){n9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.thickness=function(){var s=p.props.size,c=Co.parseLengthAndUnit(s).value;return c/5},p.lat=function(){var s=p.props.size,c=Co.parseLengthAndUnit(s).value;return(c-p.thickness())/2},p.offset=function(){return p.lat()-p.thickness()},p.color=function(){var s=p.props.color;return Co.calculateRgba(s,.75)},p.before=function(){var s=p.props.size,c=p.color(),E=p.lat(),m=p.thickness(),S=p.offset();return $a.keyframes(KM||(KM=tp([`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,E,-S,c,-E,S,c,Co.cssValue(s),-S,c,S,c,m,-E,-S,c,E,S,c,E,-S,c,-E,S,c)},p.after=function(){var s=p.props.size,c=p.color(),E=p.lat(),m=p.thickness(),S=p.offset();return $a.keyframes(QM||(QM=tp([`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,S,E,c,-S,-E,c,Co.cssValue(s),S,c,-S,c,m,S,-E,c,-S,E,c,S,E,c,-S,-E,c)},p.style=function(s){var c=p.props,E=c.size,m=c.speedMultiplier,S=Co.parseLengthAndUnit(E),h=S.value,C=S.unit;return $a.css(qM||(qM=tp([`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `],[`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `])),""+h/5+C,""+h/5+C,""+h/10+C,s===1?p.before():p.after(),2/m)},p.wrapper=function(){var s=p.props.size;return $a.css(ZM||(ZM=tp([`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `])),Co.cssValue(s),Co.cssValue(s))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?$a.jsx("span",{css:[this.wrapper(),c]},$a.jsx("span",{css:this.style(1)}),$a.jsx("span",{css:this.style(2)})):null},u.defaultProps=Co.sizeDefaults(50),u}(a9.PureComponent);jb.default=s9;var KM,QM,qM,ZM,zb={},Nu=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},c9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),l9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),u9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),h9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&l9(u,a,p);return u9(u,a),u};Object.defineProperty(zb,"__esModule",{value:!0});var d9=h9(Xn),ma=Yn,Ja=kn,$M=ma.keyframes(JM||(JM=Nu([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),f9=function(a){c9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.moonSize=function(){var s=p.props.size,c=Ja.parseLengthAndUnit(s).value;return c/7},p.ballStyle=function(s){return ma.css(e1||(e1=Nu([`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),Ja.cssValue(s),Ja.cssValue(s))},p.wrapper=function(){var s=p.props,c=s.size,E=s.speedMultiplier,m=Ja.parseLengthAndUnit(c),S=m.value,h=m.unit;return ma.css(t1||(t1=Nu([`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),""+(S+p.moonSize()*2)+h,""+(S+p.moonSize()*2)+h,$M,.6/E)},p.ball=function(){var s=p.props,c=s.color,E=s.size,m=s.speedMultiplier,S=Ja.parseLengthAndUnit(E),h=S.value,C=S.unit;return ma.css(n1||(n1=Nu([`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),p.ballStyle(p.moonSize()),c,""+(h/2-p.moonSize()/2)+C,$M,.6/m)},p.circle=function(){var s=p.props,c=s.size,E=s.color,m=Ja.parseLengthAndUnit(c).value;return ma.css(r1||(r1=Nu([`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `],[`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `])),p.ballStyle(m),p.moonSize(),E)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?ma.jsx("span",{css:[this.wrapper(),c]},ma.jsx("span",{css:this.ball()}),ma.jsx("span",{css:this.circle()})):null},u.defaultProps=Ja.sizeDefaults(60),u}(d9.PureComponent);zb.default=f9;var JM,e1,t1,n1,r1,Gb={},Rc=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},p9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),m9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),_9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),g9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&m9(u,a,p);return _9(u,a),u};Object.defineProperty(Gb,"__esModule",{value:!0});var v9=g9(Xn),oi=Yn,Ro=kn,b9=[oi.keyframes(i1||(i1=Rc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `]))),oi.keyframes(o1||(o1=Rc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `])))],y9=function(a){p9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.ball=function(){var s=p.props.size,c=Ro.parseLengthAndUnit(s),E=c.value,m=c.unit;return oi.keyframes(a1||(a1=Rc([`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `],[`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `])),""+-4*E+m,""+-E/4+m)},p.ballStyle=function(s){var c=p.props,E=c.color,m=c.margin,S=c.size,h=c.speedMultiplier,C=Ro.parseLengthAndUnit(S),R=C.value,I=C.unit;return oi.css(s1||(s1=Rc([`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `],[`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `])),""+R/3+I,""+R/3+I,E,Ro.cssValue(m),""+-R/4+I,""+R+I,""+R*4+I,p.ball(),1/h,s*.25)},p.s1=function(){return Ro.cssValue(p.props.size)+" solid transparent"},p.s2=function(){var s=p.props.color;return Ro.cssValue(p.props.size)+" solid "+s},p.pacmanStyle=function(s){var c=p.props,E=c.size,m=c.speedMultiplier,S=p.s1(),h=p.s2();return oi.css(c1||(c1=Rc([`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),S,s===0?S:h,h,s===0?h:S,Ro.cssValue(E),b9[s],.8/m)},p.wrapper=function(){return oi.css(l1||(l1=Rc([`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `],[`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `])),Ro.cssValue(p.props.size),Ro.cssValue(p.props.size))},p.pac=function(){return p.pacmanStyle(0)},p.man=function(){return p.pacmanStyle(1)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?oi.jsx("span",{css:[this.wrapper(),c]},oi.jsx("span",{css:this.pac()}),oi.jsx("span",{css:this.man()}),oi.jsx("span",{css:this.ballStyle(2)}),oi.jsx("span",{css:this.ballStyle(3)}),oi.jsx("span",{css:this.ballStyle(4)}),oi.jsx("span",{css:this.ballStyle(5)})):null},u.defaultProps=Ro.sizeMarginDefaults(25),u}(v9.PureComponent);Gb.default=y9;var i1,o1,a1,s1,c1,l1,Hb={},_a=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},T9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),E9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),S9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),x9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&E9(u,a,p);return S9(u,a),u};Object.defineProperty(Hb,"__esModule",{value:!0});var A9=x9(Xn),Vr=Yn,u1=kn,Rr=[1,3,5],P9=[Vr.keyframes(h1||(h1=_a([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[1],Rr[2]),Vr.keyframes(d1||(d1=_a([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[1],Rr[1]),Vr.keyframes(f1||(f1=_a([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[0]),Vr.keyframes(p1||(p1=_a([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[0]),Vr.keyframes(m1||(m1=_a([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[1],Rr[1]),Vr.keyframes(_1||(_1=_a([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),Rr[0],Rr[1],Rr[2])],C9=function(a){T9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.size,m=c.color,S=c.speedMultiplier,h=u1.parseLengthAndUnit(E),C=h.value,R=h.unit;return Vr.css(g1||(g1=_a([`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `],[`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `])),""+C/3+R,""+C+R,""+C+R,m,P9[s],1.5/S)},p.wrapper=function(){return Vr.css(v1||(v1=_a([`
      position: relative;
    `],[`
      position: relative;
    `])))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Vr.jsx("span",{css:[this.wrapper(),c]},Vr.jsx("span",{css:this.style(0)}),Vr.jsx("span",{css:this.style(1)}),Vr.jsx("span",{css:this.style(2)}),Vr.jsx("span",{css:this.style(3)}),Vr.jsx("span",{css:this.style(4)}),Vr.jsx("span",{css:this.style(5)})):null},u.defaultProps=u1.sizeDefaults(15),u}(A9.PureComponent);Hb.default=C9;var h1,d1,f1,p1,m1,_1,g1,v1,Wb={},b1=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},R9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),O9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),M9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),I9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&O9(u,a,p);return M9(u,a),u};Object.defineProperty(Wb,"__esModule",{value:!0});var D9=I9(Xn),Oc=Yn,np=kn,w9=Oc.keyframes(y1||(y1=b1([`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`]))),L9=function(a){R9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.margin,h=c.speedMultiplier;return Oc.css(T1||(T1=b1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),E,np.cssValue(m),np.cssValue(m),np.cssValue(S),w9,.75/h,s*.12/h)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Oc.jsx("span",{css:[c]},Oc.jsx("span",{css:this.style(1)}),Oc.jsx("span",{css:this.style(2)}),Oc.jsx("span",{css:this.style(3)})):null},u.defaultProps=np.sizeMarginDefaults(15),u}(D9.PureComponent);Wb.default=L9;var y1,T1,Xb={},rp=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},N9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),F9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),B9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),U9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&F9(u,a,p);return B9(u,a),u};Object.defineProperty(Xb,"__esModule",{value:!0});var V9=U9(Xn),es=Yn,Fu=kn,E1=[es.keyframes(S1||(S1=rp([`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`],[`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`]))),es.keyframes(x1||(x1=rp([`
  0%  {opacity: 1}
  100% {opacity: 0}
`],[`
  0%  {opacity: 1}
  100% {opacity: 0}
`])))],k9=function(a){N9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.getSize=function(){return p.props.size},p.style=function(s){var c=p.props,E=c.color,m=c.speedMultiplier;return es.css(A1||(A1=rp([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `])),Fu.cssValue(p.getSize()),Fu.cssValue(p.getSize()),E,E1[0],E1[1],2/m,s===1?"-1s":"0s")},p.wrapper=function(){return es.css(P1||(P1=rp([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),Fu.cssValue(p.getSize()),Fu.cssValue(p.getSize()))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?es.jsx("span",{css:[this.wrapper(),c]},es.jsx("span",{css:this.style(1)}),es.jsx("span",{css:this.style(2)})):null},u.defaultProps=Fu.sizeDefaults(60),u}(V9.PureComponent);Xb.default=k9;var S1,x1,A1,P1,Yb={},ip=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},j9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),z9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),G9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),H9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&z9(u,a,p);return G9(u,a),u};Object.defineProperty(Yb,"__esModule",{value:!0});var W9=H9(Xn),ts=Yn,op=kn,X9=ts.keyframes(C1||(C1=ip([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`]))),Y9=ts.keyframes(R1||(R1=ip([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`]))),K9=function(a){j9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.getSize=function(){return p.props.size},p.style=function(s){var c=p.props,E=c.color,m=c.speedMultiplier,S=op.parseLengthAndUnit(p.getSize()),h=S.value,C=S.unit;return ts.css(O1||(O1=ip([`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `])),""+h+C,""+h+C,""+h/10+C,E,s===1?X9:Y9,2/m)},p.wrapper=function(){return ts.css(M1||(M1=ip([`
      width: `,`;
      height: `,`;
      position: relative;
    `],[`
      width: `,`;
      height: `,`;
      position: relative;
    `])),op.cssValue(p.getSize()),op.cssValue(p.getSize()))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?ts.jsx("span",{css:[this.wrapper(),c]},ts.jsx("span",{css:this.style(1)}),ts.jsx("span",{css:this.style(2)})):null},u.defaultProps=op.sizeDefaults(60),u}(W9.PureComponent);Yb.default=K9;var C1,R1,O1,M1,Kb={},Qb=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},Q9=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),q9=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),Z9=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),$9=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&q9(u,a,p);return Z9(u,a),u};Object.defineProperty(Kb,"__esModule",{value:!0});var J9=$9(Xn),Oo=Yn,ap=kn,sp=30,eQ=Oo.keyframes(I1||(I1=Qb([`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`],[`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`])),sp,sp),tQ=Oo.keyframes(D1||(D1=Qb([`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`],[`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`])),sp,-sp),nQ=function(a){Q9(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.margin,h=c.speedMultiplier;return Oo.css(w1||(w1=Qb([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `])),E,ap.cssValue(m),ap.cssValue(m),ap.cssValue(S),s%2==0?eQ:tQ,1/h)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Oo.jsx("span",{css:[c]},Oo.jsx("span",{css:this.style(1)}),Oo.jsx("span",{css:this.style(2)}),Oo.jsx("span",{css:this.style(3)}),Oo.jsx("span",{css:this.style(4)}),Oo.jsx("span",{css:this.style(5)})):null},u.defaultProps=ap.sizeMarginDefaults(15),u}(J9.PureComponent);Kb.default=nQ;var I1,D1,w1,qb={},Mc=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},rQ=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),iQ=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),oQ=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),aQ=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&iQ(u,a,p);return oQ(u,a),u};Object.defineProperty(qb,"__esModule",{value:!0});var sQ=aQ(Xn),Mo=Yn,cp=kn,cQ=Mo.keyframes(L1||(L1=Mc([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),lQ=function(a){rQ(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props.margin,E=cp.parseLengthAndUnit(c),m=E.value,S=E.unit,h=(s%2?-1:1)*(26+m);return Mo.css(N1||(N1=Mc([`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `],[`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `])),h,S)},p.ball=function(){var s=p.props,c=s.color,E=s.size;return Mo.css(F1||(F1=Mc([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),c,cp.cssValue(E),cp.cssValue(E))},p.wrapper=function(){var s=p.props.speedMultiplier;return Mo.css(B1||(B1=Mc([`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `],[`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `])),p.ball(),cQ,1/s)},p.long=function(){return Mo.css(U1||(U1=Mc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),p.ball(),p.style(1))},p.short=function(){return Mo.css(V1||(V1=Mc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),p.ball(),p.style(2))},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Mo.jsx("span",{css:[this.wrapper(),c]},Mo.jsx("span",{css:this.long()}),Mo.jsx("span",{css:this.short()})):null},u.defaultProps=cp.sizeMarginDefaults(15),u}(sQ.PureComponent);qb.default=lQ;var L1,N1,F1,B1,U1,V1,Zb={},k1=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},uQ=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),hQ=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),dQ=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),fQ=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&hQ(u,a,p);return dQ(u,a),u};Object.defineProperty(Zb,"__esModule",{value:!0});var pQ=fQ(Xn),ga=Yn,Bu=kn,mQ=ga.keyframes(j1||(j1=k1([`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`],[`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`]))),_Q=function(a){uQ(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.width,S=c.height,h=c.margin,C=c.radius,R=c.speedMultiplier;return ga.css(z1||(z1=k1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),E,Bu.cssValue(m),Bu.cssValue(S),Bu.cssValue(h),Bu.cssValue(C),mQ,1/R,s*.1)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?ga.jsx("span",{css:[c]},ga.jsx("span",{css:this.style(1)}),ga.jsx("span",{css:this.style(2)}),ga.jsx("span",{css:this.style(3)}),ga.jsx("span",{css:this.style(4)}),ga.jsx("span",{css:this.style(5)})):null},u.defaultProps=Bu.heightWidthRadiusDefaults(35,4,2),u}(pQ.PureComponent);Zb.default=_Q;var j1,z1,$b={},G1=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},gQ=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),vQ=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),bQ=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),yQ=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&vQ(u,a,p);return bQ(u,a),u};Object.defineProperty($b,"__esModule",{value:!0});var TQ=yQ(Xn),Jb=Yn,lp=kn,EQ=Jb.keyframes(H1||(H1=G1([`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`],[`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`]))),SQ=function(a){gQ(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(){var s=p.props,c=s.color,E=s.speedMultiplier,m=s.size;return Jb.css(W1||(W1=G1([`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),lp.cssValue(m),lp.cssValue(m),lp.cssValue(m),c,EQ,3/E)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Jb.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=lp.sizeDefaults(20),u}(TQ.PureComponent);$b.default=SQ;var H1,W1,ey={},X1=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},xQ=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),AQ=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),PQ=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),CQ=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&AQ(u,a,p);return PQ(u,a),u};Object.defineProperty(ey,"__esModule",{value:!0});var RQ=CQ(Xn),ty=Yn,ny=kn,OQ=ty.keyframes(Y1||(Y1=X1([`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`],[`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`]))),MQ=function(a){xQ(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(){var s=p.props,c=s.color,E=s.size,m=s.speedMultiplier;return ty.css(K1||(K1=X1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),c,ny.cssValue(E),ny.cssValue(E),OQ,3/m)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?ty.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=ny.sizeDefaults(50),u}(RQ.PureComponent);ey.default=MQ;var Y1,K1,ry={},Q1=Be&&Be.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},IQ=Be&&Be.__extends||function(){var a=function(u,p){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var E in c)Object.prototype.hasOwnProperty.call(c,E)&&(s[E]=c[E])},a(u,p)};return function(u,p){a(u,p);function s(){this.constructor=u}u.prototype=p===null?Object.create(p):(s.prototype=p.prototype,new s)}}(),DQ=Be&&Be.__createBinding||(Object.create?function(a,u,p,s){s===void 0&&(s=p),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[p]}})}:function(a,u,p,s){s===void 0&&(s=p),a[s]=u[p]}),wQ=Be&&Be.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),LQ=Be&&Be.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var p in a)p!=="default"&&Object.prototype.hasOwnProperty.call(a,p)&&DQ(u,a,p);return wQ(u,a),u};Object.defineProperty(ry,"__esModule",{value:!0});var NQ=LQ(Xn),Ic=Yn,FQ=Li,iy=kn,BQ=Ic.keyframes(q1||(q1=Q1([`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`],[`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`]))),UQ=function(a){IQ(u,a);function u(){var p=a!==null&&a.apply(this,arguments)||this;return p.style=function(s){var c=p.props,E=c.color,m=c.size,S=c.margin,h=c.speedMultiplier;return Ic.css(Z1||(Z1=Q1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),E,iy.cssValue(m),iy.cssValue(m),iy.cssValue(S),BQ,.6/h,s*.07)},p}return u.prototype.render=function(){var p=this.props,s=p.loading,c=p.css;return s?Ic.jsx("span",{css:[c]},Ic.jsx("span",{css:this.style(1)}),Ic.jsx("span",{css:this.style(2)}),Ic.jsx("span",{css:this.style(3)})):null},u.defaultProps=FQ.sizeMarginDefaults(15),u}(NQ.PureComponent);ry.default=UQ;var q1,Z1;(function(a){var u=Be&&Be.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(a,"__esModule",{value:!0}),a.SyncLoader=a.SquareLoader=a.SkewLoader=a.ScaleLoader=a.RotateLoader=a.RiseLoader=a.RingLoader=a.PuffLoader=a.PulseLoader=a.PropagateLoader=a.PacmanLoader=a.MoonLoader=a.HashLoader=a.GridLoader=a.FadeLoader=a.DotLoader=a.ClockLoader=a.ClipLoader=a.ClimbingBoxLoader=a.CircleLoader=a.BounceLoader=a.BeatLoader=a.BarLoader=void 0;var p=Ab;Object.defineProperty(a,"BarLoader",{enumerable:!0,get:function(){return u(p).default}});var s=Pb;Object.defineProperty(a,"BeatLoader",{enumerable:!0,get:function(){return u(s).default}});var c=Cb;Object.defineProperty(a,"BounceLoader",{enumerable:!0,get:function(){return u(c).default}});var E=Ob;Object.defineProperty(a,"CircleLoader",{enumerable:!0,get:function(){return u(E).default}});var m=Ib;Object.defineProperty(a,"ClimbingBoxLoader",{enumerable:!0,get:function(){return u(m).default}});var S=Db;Object.defineProperty(a,"ClipLoader",{enumerable:!0,get:function(){return u(S).default}});var h=Nb;Object.defineProperty(a,"ClockLoader",{enumerable:!0,get:function(){return u(h).default}});var C=Bb;Object.defineProperty(a,"DotLoader",{enumerable:!0,get:function(){return u(C).default}});var R=Ub;Object.defineProperty(a,"FadeLoader",{enumerable:!0,get:function(){return u(R).default}});var I=Vb;Object.defineProperty(a,"GridLoader",{enumerable:!0,get:function(){return u(I).default}});var b=jb;Object.defineProperty(a,"HashLoader",{enumerable:!0,get:function(){return u(b).default}});var f=zb;Object.defineProperty(a,"MoonLoader",{enumerable:!0,get:function(){return u(f).default}});var x=Gb;Object.defineProperty(a,"PacmanLoader",{enumerable:!0,get:function(){return u(x).default}});var P=Hb;Object.defineProperty(a,"PropagateLoader",{enumerable:!0,get:function(){return u(P).default}});var A=Wb;Object.defineProperty(a,"PulseLoader",{enumerable:!0,get:function(){return u(A).default}});var T=Xb;Object.defineProperty(a,"PuffLoader",{enumerable:!0,get:function(){return u(T).default}});var _=Yb;Object.defineProperty(a,"RingLoader",{enumerable:!0,get:function(){return u(_).default}});var g=Kb;Object.defineProperty(a,"RiseLoader",{enumerable:!0,get:function(){return u(g).default}});var M=qb;Object.defineProperty(a,"RotateLoader",{enumerable:!0,get:function(){return u(M).default}});var O=Zb;Object.defineProperty(a,"ScaleLoader",{enumerable:!0,get:function(){return u(O).default}});var N=$b;Object.defineProperty(a,"SkewLoader",{enumerable:!0,get:function(){return u(N).default}});var V=ey;Object.defineProperty(a,"SquareLoader",{enumerable:!0,get:function(){return u(V).default}});var U=ry;Object.defineProperty(a,"SyncLoader",{enumerable:!0,get:function(){return u(U).default}})})($O);var up={exports:{}};(function(a,u){(function(p,s){a.exports=s()})(typeof self!="undefined"?self:(typeof Be!="undefined",Be),function(){return function(p){var s={};function c(E){if(s[E])return s[E].exports;var m=s[E]={i:E,l:!1,exports:{}};return p[E].call(m.exports,m,m.exports,c),m.l=!0,m.exports}return c.m=p,c.c=s,c.d=function(E,m,S){c.o(E,m)||Object.defineProperty(E,m,{enumerable:!0,get:S})},c.r=function(E){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(E,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(E,"__esModule",{value:!0})},c.t=function(E,m){if(1&m&&(E=c(E)),8&m||4&m&&typeof E=="object"&&E&&E.__esModule)return E;var S=Object.create(null);if(c.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:E}),2&m&&typeof E!="string")for(var h in E)c.d(S,h,function(C){return E[C]}.bind(null,h));return S},c.n=function(E){var m=E&&E.__esModule?function(){return E.default}:function(){return E};return c.d(m,"a",m),m},c.o=function(E,m){return Object.prototype.hasOwnProperty.call(E,m)},c.p="",c(c.s=169)}([function(p,s,c){c.d(s,"d",function(){return R}),c.d(s,"e",function(){return I}),c.d(s,"f",function(){return b}),c.d(s,"b",function(){return f}),c.d(s,"a",function(){return x}),c.d(s,"c",function(){return A});var E=c(14),m=c(28),S=c(44),h=c(11),C=c(74),R=function(){function T(_,g){_===void 0&&(_=0),g===void 0&&(g=0),this.x=_,this.y=g}return T.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},T.prototype.getClassName=function(){return"Vector2"},T.prototype.getHashCode=function(){var _=0|this.x;return _=397*_^(0|this.y)},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this.x,_[g+1]=this.y,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},T.prototype.copyFrom=function(_){return this.x=_.x,this.y=_.y,this},T.prototype.copyFromFloats=function(_,g){return this.x=_,this.y=g,this},T.prototype.set=function(_,g){return this.copyFromFloats(_,g)},T.prototype.add=function(_){return new T(this.x+_.x,this.y+_.y)},T.prototype.addToRef=function(_,g){return g.x=this.x+_.x,g.y=this.y+_.y,this},T.prototype.addInPlace=function(_){return this.x+=_.x,this.y+=_.y,this},T.prototype.addVector3=function(_){return new T(this.x+_.x,this.y+_.y)},T.prototype.subtract=function(_){return new T(this.x-_.x,this.y-_.y)},T.prototype.subtractToRef=function(_,g){return g.x=this.x-_.x,g.y=this.y-_.y,this},T.prototype.subtractInPlace=function(_){return this.x-=_.x,this.y-=_.y,this},T.prototype.multiplyInPlace=function(_){return this.x*=_.x,this.y*=_.y,this},T.prototype.multiply=function(_){return new T(this.x*_.x,this.y*_.y)},T.prototype.multiplyToRef=function(_,g){return g.x=this.x*_.x,g.y=this.y*_.y,this},T.prototype.multiplyByFloats=function(_,g){return new T(this.x*_,this.y*g)},T.prototype.divide=function(_){return new T(this.x/_.x,this.y/_.y)},T.prototype.divideToRef=function(_,g){return g.x=this.x/_.x,g.y=this.y/_.y,this},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.negate=function(){return new T(-this.x,-this.y)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this.x,-1*this.y)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this},T.prototype.scale=function(_){var g=new T(0,0);return this.scaleToRef(_,g),g},T.prototype.scaleToRef=function(_,g){return g.x=this.x*_,g.y=this.y*_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this.x*_,g.y+=this.y*_,this},T.prototype.equals=function(_){return _&&this.x===_.x&&this.y===_.y},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this.x,_.x,g)&&E.a.WithinEpsilon(this.y,_.y,g)},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y))},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},T.prototype.normalize=function(){var _=this.length();return _===0||(this.x/=_,this.y/=_),this},T.prototype.clone=function(){return new T(this.x,this.y)},T.Zero=function(){return new T(0,0)},T.One=function(){return new T(1,1)},T.FromArray=function(_,g){return g===void 0&&(g=0),new T(_[g],_[g+1])},T.FromArrayToRef=function(_,g,M){M.x=_[g],M.y=_[g+1]},T.CatmullRom=function(_,g,M,O,N){var V=N*N,U=N*V;return new T(.5*(2*g.x+(-_.x+M.x)*N+(2*_.x-5*g.x+4*M.x-O.x)*V+(-_.x+3*g.x-3*M.x+O.x)*U),.5*(2*g.y+(-_.y+M.y)*N+(2*_.y-5*g.y+4*M.y-O.y)*V+(-_.y+3*g.y-3*M.y+O.y)*U))},T.Clamp=function(_,g,M){var O=_.x;O=(O=O>M.x?M.x:O)<g.x?g.x:O;var N=_.y;return new T(O,N=(N=N>M.y?M.y:N)<g.y?g.y:N)},T.Hermite=function(_,g,M,O,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_.x*L+M.x*j+g.x*Y+O.x*W,_.y*L+M.y*j+g.y*Y+O.y*W)},T.Lerp=function(_,g,M){return new T(_.x+(g.x-_.x)*M,_.y+(g.y-_.y)*M)},T.Dot=function(_,g){return _.x*g.x+_.y*g.y},T.Normalize=function(_){var g=_.clone();return g.normalize(),g},T.Minimize=function(_,g){return new T(_.x<g.x?_.x:g.x,_.y<g.y?_.y:g.y)},T.Maximize=function(_,g){return new T(_.x>g.x?_.x:g.x,_.y>g.y?_.y:g.y)},T.Transform=function(_,g){var M=T.Zero();return T.TransformToRef(_,g,M),M},T.TransformToRef=function(_,g,M){var O=g.m,N=_.x*O[0]+_.y*O[4]+O[12],V=_.x*O[1]+_.y*O[5]+O[13];M.x=N,M.y=V},T.PointInTriangle=function(_,g,M,O){var N=.5*(-M.y*O.x+g.y*(-M.x+O.x)+g.x*(M.y-O.y)+M.x*O.y),V=N<0?-1:1,U=(g.y*O.x-g.x*O.y+(O.y-g.y)*_.x+(g.x-O.x)*_.y)*V,L=(g.x*M.y-g.y*M.x+(g.y-M.y)*_.x+(M.x-g.x)*_.y)*V;return U>0&&L>0&&U+L<2*N*V},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var M=_.x-g.x,O=_.y-g.y;return M*M+O*O},T.Center=function(_,g){var M=_.add(g);return M.scaleInPlace(.5),M},T.DistanceOfPointFromSegment=function(_,g,M){var O=T.DistanceSquared(g,M);if(O===0)return T.Distance(_,g);var N=M.subtract(g),V=Math.max(0,Math.min(1,T.Dot(_.subtract(g),N)/O)),U=g.add(N.multiplyByFloats(V,V));return T.Distance(_,U)},T}(),I=function(){function T(_,g,M){_===void 0&&(_=0),g===void 0&&(g=0),M===void 0&&(M=0),this._isDirty=!0,this._x=_,this._y=g,this._z=M}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(_){this._x=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(_){this._y=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(_){this._z=_,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},T.prototype.getClassName=function(){return"Vector3"},T.prototype.getHashCode=function(){var _=0|this._x;return _=397*(_=397*_^(0|this._y))^(0|this._z)},T.prototype.asArray=function(){var _=[];return this.toArray(_,0),_},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this._x,_[g+1]=this._y,_[g+2]=this._z,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.toQuaternion=function(){return f.RotationYawPitchRoll(this._y,this._x,this._z)},T.prototype.addInPlace=function(_){return this.addInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.addInPlaceFromFloats=function(_,g,M){return this.x+=_,this.y+=g,this.z+=M,this},T.prototype.add=function(_){return new T(this._x+_._x,this._y+_._y,this._z+_._z)},T.prototype.addToRef=function(_,g){return g.copyFromFloats(this._x+_._x,this._y+_._y,this._z+_._z)},T.prototype.subtractInPlace=function(_){return this.x-=_._x,this.y-=_._y,this.z-=_._z,this},T.prototype.subtract=function(_){return new T(this._x-_._x,this._y-_._y,this._z-_._z)},T.prototype.subtractToRef=function(_,g){return this.subtractFromFloatsToRef(_._x,_._y,_._z,g)},T.prototype.subtractFromFloats=function(_,g,M){return new T(this._x-_,this._y-g,this._z-M)},T.prototype.subtractFromFloatsToRef=function(_,g,M,O){return O.copyFromFloats(this._x-_,this._y-g,this._z-M)},T.prototype.negate=function(){return new T(-this._x,-this._y,-this._z)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this},T.prototype.scale=function(_){return new T(this._x*_,this._y*_,this._z*_)},T.prototype.scaleToRef=function(_,g){return g.copyFromFloats(this._x*_,this._y*_,this._z*_)},T.prototype.scaleAndAddToRef=function(_,g){return g.addInPlaceFromFloats(this._x*_,this._y*_,this._z*_)},T.prototype.projectOnPlane=function(_,g){var M=T.Zero();return this.projectOnPlaneToRef(_,g,M),M},T.prototype.projectOnPlaneToRef=function(_,g,M){var O=_.normal,N=_.d,V=P.Vector3[0];this.subtractToRef(g,V),V.normalize();var U=T.Dot(V,O),L=-(T.Dot(g,O)+N)/U,j=V.scaleInPlace(L);g.addToRef(j,M)},T.prototype.equals=function(_){return _&&this._x===_._x&&this._y===_._y&&this._z===_._z},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this._x,_._x,g)&&E.a.WithinEpsilon(this._y,_._y,g)&&E.a.WithinEpsilon(this._z,_._z,g)},T.prototype.equalsToFloats=function(_,g,M){return this._x===_&&this._y===g&&this._z===M},T.prototype.multiplyInPlace=function(_){return this.x*=_._x,this.y*=_._y,this.z*=_._z,this},T.prototype.multiply=function(_){return this.multiplyByFloats(_._x,_._y,_._z)},T.prototype.multiplyToRef=function(_,g){return g.copyFromFloats(this._x*_._x,this._y*_._y,this._z*_._z)},T.prototype.multiplyByFloats=function(_,g,M){return new T(this._x*_,this._y*g,this._z*M)},T.prototype.divide=function(_){return new T(this._x/_._x,this._y/_._y,this._z/_._z)},T.prototype.divideToRef=function(_,g){return g.copyFromFloats(this._x/_._x,this._y/_._y,this._z/_._z)},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.minimizeInPlace=function(_){return this.minimizeInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.maximizeInPlace=function(_){return this.maximizeInPlaceFromFloats(_._x,_._y,_._z)},T.prototype.minimizeInPlaceFromFloats=function(_,g,M){return _<this._x&&(this.x=_),g<this._y&&(this.y=g),M<this._z&&(this.z=M),this},T.prototype.maximizeInPlaceFromFloats=function(_,g,M){return _>this._x&&(this.x=_),g>this._y&&(this.y=g),M>this._z&&(this.z=M),this},T.prototype.isNonUniformWithinEpsilon=function(_){var g=Math.abs(this._x),M=Math.abs(this._y);if(!E.a.WithinEpsilon(g,M,_))return!0;var O=Math.abs(this._z);return!E.a.WithinEpsilon(g,O,_)||!E.a.WithinEpsilon(M,O,_)},Object.defineProperty(T.prototype,"isNonUniform",{get:function(){var _=Math.abs(this._x);return _!==Math.abs(this._y)||_!==Math.abs(this._z)},enumerable:!1,configurable:!0}),T.prototype.floor=function(){return new T(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},T.prototype.fract=function(){return new T(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},T.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},T.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.reorderInPlace=function(_){var g=this;return(_=_.toLowerCase())==="xyz"||(P.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(M,O){g[M]=P.Vector3[0][_[O]]})),this},T.prototype.rotateByQuaternionToRef=function(_,g){return _.toRotationMatrix(P.Matrix[0]),T.TransformCoordinatesToRef(this,P.Matrix[0],g),g},T.prototype.rotateByQuaternionAroundPointToRef=function(_,g,M){return this.subtractToRef(g,P.Vector3[0]),P.Vector3[0].rotateByQuaternionToRef(_,P.Vector3[0]),g.addToRef(P.Vector3[0],M),M},T.prototype.cross=function(_){return T.Cross(this,_)},T.prototype.normalizeFromLength=function(_){return _===0||_===1?this:this.scaleInPlace(1/_)},T.prototype.normalizeToNew=function(){var _=new T(0,0,0);return this.normalizeToRef(_),_},T.prototype.normalizeToRef=function(_){var g=this.length();return g===0||g===1?_.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/g,_)},T.prototype.clone=function(){return new T(this._x,this._y,this._z)},T.prototype.copyFrom=function(_){return this.copyFromFloats(_._x,_._y,_._z)},T.prototype.copyFromFloats=function(_,g,M){return this.x=_,this.y=g,this.z=M,this},T.prototype.set=function(_,g,M){return this.copyFromFloats(_,g,M)},T.prototype.setAll=function(_){return this.x=this.y=this.z=_,this},T.GetClipFactor=function(_,g,M,O){var N=T.Dot(_,M)-O;return N/(N-(T.Dot(g,M)-O))},T.GetAngleBetweenVectors=function(_,g,M){var O=_.normalizeToRef(P.Vector3[1]),N=g.normalizeToRef(P.Vector3[2]),V=T.Dot(O,N),U=P.Vector3[3];return T.CrossToRef(O,N,U),T.Dot(U,M)>0?Math.acos(V):-Math.acos(V)},T.FromArray=function(_,g){return g===void 0&&(g=0),new T(_[g],_[g+1],_[g+2])},T.FromFloatArray=function(_,g){return T.FromArray(_,g)},T.FromArrayToRef=function(_,g,M){M.x=_[g],M.y=_[g+1],M.z=_[g+2]},T.FromFloatArrayToRef=function(_,g,M){return T.FromArrayToRef(_,g,M)},T.FromFloatsToRef=function(_,g,M,O){O.copyFromFloats(_,g,M)},T.Zero=function(){return new T(0,0,0)},T.One=function(){return new T(1,1,1)},T.Up=function(){return new T(0,1,0)},Object.defineProperty(T,"UpReadOnly",{get:function(){return T._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"ZeroReadOnly",{get:function(){return T._ZeroReadOnly},enumerable:!1,configurable:!0}),T.Down=function(){return new T(0,-1,0)},T.Forward=function(_){return _===void 0&&(_=!1),new T(0,0,_?-1:1)},T.Backward=function(_){return _===void 0&&(_=!1),new T(0,0,_?1:-1)},T.Right=function(){return new T(1,0,0)},T.Left=function(){return new T(-1,0,0)},T.TransformCoordinates=function(_,g){var M=T.Zero();return T.TransformCoordinatesToRef(_,g,M),M},T.TransformCoordinatesToRef=function(_,g,M){T.TransformCoordinatesFromFloatsToRef(_._x,_._y,_._z,g,M)},T.TransformCoordinatesFromFloatsToRef=function(_,g,M,O,N){var V=O.m,U=_*V[0]+g*V[4]+M*V[8]+V[12],L=_*V[1]+g*V[5]+M*V[9]+V[13],j=_*V[2]+g*V[6]+M*V[10]+V[14],Y=1/(_*V[3]+g*V[7]+M*V[11]+V[15]);N.x=U*Y,N.y=L*Y,N.z=j*Y},T.TransformNormal=function(_,g){var M=T.Zero();return T.TransformNormalToRef(_,g,M),M},T.TransformNormalToRef=function(_,g,M){this.TransformNormalFromFloatsToRef(_._x,_._y,_._z,g,M)},T.TransformNormalFromFloatsToRef=function(_,g,M,O,N){var V=O.m;N.x=_*V[0]+g*V[4]+M*V[8],N.y=_*V[1]+g*V[5]+M*V[9],N.z=_*V[2]+g*V[6]+M*V[10]},T.CatmullRom=function(_,g,M,O,N){var V=N*N,U=N*V;return new T(.5*(2*g._x+(-_._x+M._x)*N+(2*_._x-5*g._x+4*M._x-O._x)*V+(-_._x+3*g._x-3*M._x+O._x)*U),.5*(2*g._y+(-_._y+M._y)*N+(2*_._y-5*g._y+4*M._y-O._y)*V+(-_._y+3*g._y-3*M._y+O._y)*U),.5*(2*g._z+(-_._z+M._z)*N+(2*_._z-5*g._z+4*M._z-O._z)*V+(-_._z+3*g._z-3*M._z+O._z)*U))},T.Clamp=function(_,g,M){var O=new T;return T.ClampToRef(_,g,M,O),O},T.ClampToRef=function(_,g,M,O){var N=_._x;N=(N=N>M._x?M._x:N)<g._x?g._x:N;var V=_._y;V=(V=V>M._y?M._y:V)<g._y?g._y:V;var U=_._z;U=(U=U>M._z?M._z:U)<g._z?g._z:U,O.copyFromFloats(N,V,U)},T.CheckExtends=function(_,g,M){g.minimizeInPlace(_),M.maximizeInPlace(_)},T.Hermite=function(_,g,M,O,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_._x*L+M._x*j+g._x*Y+O._x*W,_._y*L+M._y*j+g._y*Y+O._y*W,_._z*L+M._z*j+g._z*Y+O._z*W)},T.Lerp=function(_,g,M){var O=new T(0,0,0);return T.LerpToRef(_,g,M,O),O},T.LerpToRef=function(_,g,M,O){O.x=_._x+(g._x-_._x)*M,O.y=_._y+(g._y-_._y)*M,O.z=_._z+(g._z-_._z)*M},T.Dot=function(_,g){return _._x*g._x+_._y*g._y+_._z*g._z},T.Cross=function(_,g){var M=T.Zero();return T.CrossToRef(_,g,M),M},T.CrossToRef=function(_,g,M){var O=_._y*g._z-_._z*g._y,N=_._z*g._x-_._x*g._z,V=_._x*g._y-_._y*g._x;M.copyFromFloats(O,N,V)},T.Normalize=function(_){var g=T.Zero();return T.NormalizeToRef(_,g),g},T.NormalizeToRef=function(_,g){_.normalizeToRef(g)},T.Project=function(_,g,M,O){var N=new T;return T.ProjectToRef(_,g,M,O,N),N},T.ProjectToRef=function(_,g,M,O,N){var V=O.width,U=O.height,L=O.x,j=O.y,Y=P.Matrix[1];x.FromValuesToRef(V/2,0,0,0,0,-U/2,0,0,0,0,.5,0,L+V/2,U/2+j,.5,1,Y);var W=P.Matrix[0];return g.multiplyToRef(M,W),W.multiplyToRef(Y,W),T.TransformCoordinatesToRef(_,W,N),N},T._UnprojectFromInvertedMatrixToRef=function(_,g,M){T.TransformCoordinatesToRef(_,g,M);var O=g.m,N=_._x*O[3]+_._y*O[7]+_._z*O[11]+O[15];E.a.WithinEpsilon(N,1)&&M.scaleInPlace(1/N)},T.UnprojectFromTransform=function(_,g,M,O,N){var V=P.Matrix[0];O.multiplyToRef(N,V),V.invert(),_.x=_._x/g*2-1,_.y=-(_._y/M*2-1);var U=new T;return T._UnprojectFromInvertedMatrixToRef(_,V,U),U},T.Unproject=function(_,g,M,O,N,V){var U=T.Zero();return T.UnprojectToRef(_,g,M,O,N,V,U),U},T.UnprojectToRef=function(_,g,M,O,N,V,U){T.UnprojectFloatsToRef(_._x,_._y,_._z,g,M,O,N,V,U)},T.UnprojectFloatsToRef=function(_,g,M,O,N,V,U,L,j){var Y=P.Matrix[0];V.multiplyToRef(U,Y),Y.multiplyToRef(L,Y),Y.invert();var W=P.Vector3[0];W.x=_/O*2-1,W.y=-(g/N*2-1),W.z=2*M-1,T._UnprojectFromInvertedMatrixToRef(W,Y,j)},T.Minimize=function(_,g){var M=_.clone();return M.minimizeInPlace(g),M},T.Maximize=function(_,g){var M=_.clone();return M.maximizeInPlace(g),M},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var M=_._x-g._x,O=_._y-g._y,N=_._z-g._z;return M*M+O*O+N*N},T.Center=function(_,g){var M=_.add(g);return M.scaleInPlace(.5),M},T.RotationFromAxis=function(_,g,M){var O=T.Zero();return T.RotationFromAxisToRef(_,g,M,O),O},T.RotationFromAxisToRef=function(_,g,M,O){var N=P.Quaternion[0];f.RotationQuaternionFromAxisToRef(_,g,M,N),N.toEulerAnglesToRef(O)},T._UpReadOnly=T.Up(),T._ZeroReadOnly=T.Zero(),T}(),b=function(){function T(_,g,M,O){this.x=_,this.y=g,this.z=M,this.w=O}return T.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},T.prototype.getClassName=function(){return"Vector4"},T.prototype.getHashCode=function(){var _=0|this.x;return _=397*(_=397*(_=397*_^(0|this.y))^(0|this.z))^(0|this.w)},T.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},T.prototype.toArray=function(_,g){return g===void 0&&(g=0),_[g]=this.x,_[g+1]=this.y,_[g+2]=this.z,_[g+3]=this.w,this},T.prototype.fromArray=function(_,g){return g===void 0&&(g=0),T.FromArrayToRef(_,g,this),this},T.prototype.addInPlace=function(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this.w+=_.w,this},T.prototype.add=function(_){return new T(this.x+_.x,this.y+_.y,this.z+_.z,this.w+_.w)},T.prototype.addToRef=function(_,g){return g.x=this.x+_.x,g.y=this.y+_.y,g.z=this.z+_.z,g.w=this.w+_.w,this},T.prototype.subtractInPlace=function(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this.w-=_.w,this},T.prototype.subtract=function(_){return new T(this.x-_.x,this.y-_.y,this.z-_.z,this.w-_.w)},T.prototype.subtractToRef=function(_,g){return g.x=this.x-_.x,g.y=this.y-_.y,g.z=this.z-_.z,g.w=this.w-_.w,this},T.prototype.subtractFromFloats=function(_,g,M,O){return new T(this.x-_,this.y-g,this.z-M,this.w-O)},T.prototype.subtractFromFloatsToRef=function(_,g,M,O,N){return N.x=this.x-_,N.y=this.y-g,N.z=this.z-M,N.w=this.w-O,this},T.prototype.negate=function(){return new T(-this.x,-this.y,-this.z,-this.w)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},T.prototype.negateToRef=function(_){return _.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this},T.prototype.scale=function(_){return new T(this.x*_,this.y*_,this.z*_,this.w*_)},T.prototype.scaleToRef=function(_,g){return g.x=this.x*_,g.y=this.y*_,g.z=this.z*_,g.w=this.w*_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this.x*_,g.y+=this.y*_,g.z+=this.z*_,g.w+=this.w*_,this},T.prototype.equals=function(_){return _&&this.x===_.x&&this.y===_.y&&this.z===_.z&&this.w===_.w},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this.x,_.x,g)&&E.a.WithinEpsilon(this.y,_.y,g)&&E.a.WithinEpsilon(this.z,_.z,g)&&E.a.WithinEpsilon(this.w,_.w,g)},T.prototype.equalsToFloats=function(_,g,M,O){return this.x===_&&this.y===g&&this.z===M&&this.w===O},T.prototype.multiplyInPlace=function(_){return this.x*=_.x,this.y*=_.y,this.z*=_.z,this.w*=_.w,this},T.prototype.multiply=function(_){return new T(this.x*_.x,this.y*_.y,this.z*_.z,this.w*_.w)},T.prototype.multiplyToRef=function(_,g){return g.x=this.x*_.x,g.y=this.y*_.y,g.z=this.z*_.z,g.w=this.w*_.w,this},T.prototype.multiplyByFloats=function(_,g,M,O){return new T(this.x*_,this.y*g,this.z*M,this.w*O)},T.prototype.divide=function(_){return new T(this.x/_.x,this.y/_.y,this.z/_.z,this.w/_.w)},T.prototype.divideToRef=function(_,g){return g.x=this.x/_.x,g.y=this.y/_.y,g.z=this.z/_.z,g.w=this.w/_.w,this},T.prototype.divideInPlace=function(_){return this.divideToRef(_,this)},T.prototype.minimizeInPlace=function(_){return _.x<this.x&&(this.x=_.x),_.y<this.y&&(this.y=_.y),_.z<this.z&&(this.z=_.z),_.w<this.w&&(this.w=_.w),this},T.prototype.maximizeInPlace=function(_){return _.x>this.x&&(this.x=_.x),_.y>this.y&&(this.y=_.y),_.z>this.z&&(this.z=_.z),_.w>this.w&&(this.w=_.w),this},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},T.prototype.normalize=function(){var _=this.length();return _===0?this:this.scaleInPlace(1/_)},T.prototype.toVector3=function(){return new I(this.x,this.y,this.z)},T.prototype.clone=function(){return new T(this.x,this.y,this.z,this.w)},T.prototype.copyFrom=function(_){return this.x=_.x,this.y=_.y,this.z=_.z,this.w=_.w,this},T.prototype.copyFromFloats=function(_,g,M,O){return this.x=_,this.y=g,this.z=M,this.w=O,this},T.prototype.set=function(_,g,M,O){return this.copyFromFloats(_,g,M,O)},T.prototype.setAll=function(_){return this.x=this.y=this.z=this.w=_,this},T.FromArray=function(_,g){return g||(g=0),new T(_[g],_[g+1],_[g+2],_[g+3])},T.FromArrayToRef=function(_,g,M){M.x=_[g],M.y=_[g+1],M.z=_[g+2],M.w=_[g+3]},T.FromFloatArrayToRef=function(_,g,M){T.FromArrayToRef(_,g,M)},T.FromFloatsToRef=function(_,g,M,O,N){N.x=_,N.y=g,N.z=M,N.w=O},T.Zero=function(){return new T(0,0,0,0)},T.One=function(){return new T(1,1,1,1)},T.Normalize=function(_){var g=T.Zero();return T.NormalizeToRef(_,g),g},T.NormalizeToRef=function(_,g){g.copyFrom(_),g.normalize()},T.Minimize=function(_,g){var M=_.clone();return M.minimizeInPlace(g),M},T.Maximize=function(_,g){var M=_.clone();return M.maximizeInPlace(g),M},T.Distance=function(_,g){return Math.sqrt(T.DistanceSquared(_,g))},T.DistanceSquared=function(_,g){var M=_.x-g.x,O=_.y-g.y,N=_.z-g.z,V=_.w-g.w;return M*M+O*O+N*N+V*V},T.Center=function(_,g){var M=_.add(g);return M.scaleInPlace(.5),M},T.TransformNormal=function(_,g){var M=T.Zero();return T.TransformNormalToRef(_,g,M),M},T.TransformNormalToRef=function(_,g,M){var O=g.m,N=_.x*O[0]+_.y*O[4]+_.z*O[8],V=_.x*O[1]+_.y*O[5]+_.z*O[9],U=_.x*O[2]+_.y*O[6]+_.z*O[10];M.x=N,M.y=V,M.z=U,M.w=_.w},T.TransformNormalFromFloatsToRef=function(_,g,M,O,N,V){var U=N.m;V.x=_*U[0]+g*U[4]+M*U[8],V.y=_*U[1]+g*U[5]+M*U[9],V.z=_*U[2]+g*U[6]+M*U[10],V.w=O},T.FromVector3=function(_,g){return g===void 0&&(g=0),new T(_._x,_._y,_._z,g)},T}(),f=function(){function T(_,g,M,O){_===void 0&&(_=0),g===void 0&&(g=0),M===void 0&&(M=0),O===void 0&&(O=1),this._isDirty=!0,this._x=_,this._y=g,this._z=M,this._w=O}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(_){this._x=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(_){this._y=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(_){this._z=_,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"w",{get:function(){return this._w},set:function(_){this._w=_,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},T.prototype.getClassName=function(){return"Quaternion"},T.prototype.getHashCode=function(){var _=0|this._x;return _=397*(_=397*(_=397*_^(0|this._y))^(0|this._z))^(0|this._w)},T.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},T.prototype.equals=function(_){return _&&this._x===_._x&&this._y===_._y&&this._z===_._z&&this._w===_._w},T.prototype.equalsWithEpsilon=function(_,g){return g===void 0&&(g=m.a),_&&E.a.WithinEpsilon(this._x,_._x,g)&&E.a.WithinEpsilon(this._y,_._y,g)&&E.a.WithinEpsilon(this._z,_._z,g)&&E.a.WithinEpsilon(this._w,_._w,g)},T.prototype.clone=function(){return new T(this._x,this._y,this._z,this._w)},T.prototype.copyFrom=function(_){return this.x=_._x,this.y=_._y,this.z=_._z,this.w=_._w,this},T.prototype.copyFromFloats=function(_,g,M,O){return this.x=_,this.y=g,this.z=M,this.w=O,this},T.prototype.set=function(_,g,M,O){return this.copyFromFloats(_,g,M,O)},T.prototype.add=function(_){return new T(this._x+_._x,this._y+_._y,this._z+_._z,this._w+_._w)},T.prototype.addInPlace=function(_){return this._x+=_._x,this._y+=_._y,this._z+=_._z,this._w+=_._w,this},T.prototype.subtract=function(_){return new T(this._x-_._x,this._y-_._y,this._z-_._z,this._w-_._w)},T.prototype.scale=function(_){return new T(this._x*_,this._y*_,this._z*_,this._w*_)},T.prototype.scaleToRef=function(_,g){return g.x=this._x*_,g.y=this._y*_,g.z=this._z*_,g.w=this._w*_,this},T.prototype.scaleInPlace=function(_){return this.x*=_,this.y*=_,this.z*=_,this.w*=_,this},T.prototype.scaleAndAddToRef=function(_,g){return g.x+=this._x*_,g.y+=this._y*_,g.z+=this._z*_,g.w+=this._w*_,this},T.prototype.multiply=function(_){var g=new T(0,0,0,1);return this.multiplyToRef(_,g),g},T.prototype.multiplyToRef=function(_,g){var M=this._x*_._w+this._y*_._z-this._z*_._y+this._w*_._x,O=-this._x*_._z+this._y*_._w+this._z*_._x+this._w*_._y,N=this._x*_._y-this._y*_._x+this._z*_._w+this._w*_._z,V=-this._x*_._x-this._y*_._y-this._z*_._z+this._w*_._w;return g.copyFromFloats(M,O,N,V),this},T.prototype.multiplyInPlace=function(_){return this.multiplyToRef(_,this),this},T.prototype.conjugateToRef=function(_){return _.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},T.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},T.prototype.conjugate=function(){return new T(-this._x,-this._y,-this._z,this._w)},T.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},T.prototype.normalize=function(){var _=this.length();if(_===0)return this;var g=1/_;return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},T.prototype.toEulerAngles=function(_){var g=I.Zero();return this.toEulerAnglesToRef(g),g},T.prototype.toEulerAnglesToRef=function(_){var g=this._z,M=this._x,O=this._y,N=this._w,V=N*N,U=g*g,L=M*M,j=O*O,Y=O*g-M*N;return Y<-.4999999?(_.y=2*Math.atan2(O,N),_.x=Math.PI/2,_.z=0):Y>.4999999?(_.y=2*Math.atan2(O,N),_.x=-Math.PI/2,_.z=0):(_.z=Math.atan2(2*(M*O+g*N),-U-L+j+V),_.x=Math.asin(-2*(g*O-M*N)),_.y=Math.atan2(2*(g*M+O*N),U-L-j+V)),this},T.prototype.toRotationMatrix=function(_){return x.FromQuaternionToRef(this,_),this},T.prototype.fromRotationMatrix=function(_){return T.FromRotationMatrixToRef(_,this),this},T.FromRotationMatrix=function(_){var g=new T;return T.FromRotationMatrixToRef(_,g),g},T.FromRotationMatrixToRef=function(_,g){var M,O=_.m,N=O[0],V=O[4],U=O[8],L=O[1],j=O[5],Y=O[9],W=O[2],ie=O[6],re=O[10],ye=N+j+re;ye>0?(M=.5/Math.sqrt(ye+1),g.w=.25/M,g.x=(ie-Y)*M,g.y=(U-W)*M,g.z=(L-V)*M):N>j&&N>re?(M=2*Math.sqrt(1+N-j-re),g.w=(ie-Y)/M,g.x=.25*M,g.y=(V+L)/M,g.z=(U+W)/M):j>re?(M=2*Math.sqrt(1+j-N-re),g.w=(U-W)/M,g.x=(V+L)/M,g.y=.25*M,g.z=(Y+ie)/M):(M=2*Math.sqrt(1+re-N-j),g.w=(L-V)/M,g.x=(U+W)/M,g.y=(Y+ie)/M,g.z=.25*M)},T.Dot=function(_,g){return _._x*g._x+_._y*g._y+_._z*g._z+_._w*g._w},T.AreClose=function(_,g){return T.Dot(_,g)>=0},T.Zero=function(){return new T(0,0,0,0)},T.Inverse=function(_){return new T(-_._x,-_._y,-_._z,_._w)},T.InverseToRef=function(_,g){return g.set(-_._x,-_._y,-_._z,_._w),g},T.Identity=function(){return new T(0,0,0,1)},T.IsIdentity=function(_){return _&&_._x===0&&_._y===0&&_._z===0&&_._w===1},T.RotationAxis=function(_,g){return T.RotationAxisToRef(_,g,new T)},T.RotationAxisToRef=function(_,g,M){var O=Math.sin(g/2);return _.normalize(),M.w=Math.cos(g/2),M.x=_._x*O,M.y=_._y*O,M.z=_._z*O,M},T.FromArray=function(_,g){return g||(g=0),new T(_[g],_[g+1],_[g+2],_[g+3])},T.FromArrayToRef=function(_,g,M){M.x=_[g],M.y=_[g+1],M.z=_[g+2],M.w=_[g+3]},T.FromEulerAngles=function(_,g,M){var O=new T;return T.RotationYawPitchRollToRef(g,_,M,O),O},T.FromEulerAnglesToRef=function(_,g,M,O){return T.RotationYawPitchRollToRef(g,_,M,O),O},T.FromEulerVector=function(_){var g=new T;return T.RotationYawPitchRollToRef(_._y,_._x,_._z,g),g},T.FromEulerVectorToRef=function(_,g){return T.RotationYawPitchRollToRef(_._y,_._x,_._z,g),g},T.RotationYawPitchRoll=function(_,g,M){var O=new T;return T.RotationYawPitchRollToRef(_,g,M,O),O},T.RotationYawPitchRollToRef=function(_,g,M,O){var N=.5*M,V=.5*g,U=.5*_,L=Math.sin(N),j=Math.cos(N),Y=Math.sin(V),W=Math.cos(V),ie=Math.sin(U),re=Math.cos(U);O.x=re*Y*j+ie*W*L,O.y=ie*W*j-re*Y*L,O.z=re*W*L-ie*Y*j,O.w=re*W*j+ie*Y*L},T.RotationAlphaBetaGamma=function(_,g,M){var O=new T;return T.RotationAlphaBetaGammaToRef(_,g,M,O),O},T.RotationAlphaBetaGammaToRef=function(_,g,M,O){var N=.5*(M+_),V=.5*(M-_),U=.5*g;O.x=Math.cos(V)*Math.sin(U),O.y=Math.sin(V)*Math.sin(U),O.z=Math.sin(N)*Math.cos(U),O.w=Math.cos(N)*Math.cos(U)},T.RotationQuaternionFromAxis=function(_,g,M){var O=new T(0,0,0,0);return T.RotationQuaternionFromAxisToRef(_,g,M,O),O},T.RotationQuaternionFromAxisToRef=function(_,g,M,O){var N=P.Matrix[0];x.FromXYZAxesToRef(_.normalize(),g.normalize(),M.normalize(),N),T.FromRotationMatrixToRef(N,O)},T.Slerp=function(_,g,M){var O=T.Identity();return T.SlerpToRef(_,g,M,O),O},T.SlerpToRef=function(_,g,M,O){var N,V,U=_._x*g._x+_._y*g._y+_._z*g._z+_._w*g._w,L=!1;if(U<0&&(L=!0,U=-U),U>.999999)V=1-M,N=L?-M:M;else{var j=Math.acos(U),Y=1/Math.sin(j);V=Math.sin((1-M)*j)*Y,N=L?-Math.sin(M*j)*Y:Math.sin(M*j)*Y}O.x=V*_._x+N*g._x,O.y=V*_._y+N*g._y,O.z=V*_._z+N*g._z,O.w=V*_._w+N*g._w},T.Hermite=function(_,g,M,O,N){var V=N*N,U=N*V,L=2*U-3*V+1,j=-2*U+3*V,Y=U-2*V+N,W=U-V;return new T(_._x*L+M._x*j+g._x*Y+O._x*W,_._y*L+M._y*j+g._y*Y+O._y*W,_._z*L+M._z*j+g._z*Y+O._z*W,_._w*L+M._w*j+g._w*Y+O._w*W)},T}(),x=function(){function T(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,C.a.MatrixTrackPrecisionChange&&C.a.MatrixTrackedMatrices.push(this),this._m=new C.a.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(T,"Use64Bits",{get:function(){return C.a.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),T.prototype._markAsUpdated=function(){this.updateFlag=T._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},T.prototype._updateIdentityStatus=function(_,g,M,O){g===void 0&&(g=!1),M===void 0&&(M=!1),O===void 0&&(O=!0),this.updateFlag=T._updateFlagSeed++,this._isIdentity=_,this._isIdentity3x2=_||M,this._isIdentityDirty=!this._isIdentity&&g,this._isIdentity3x2Dirty=!this._isIdentity3x2&&O},T.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var _=this._m;this._isIdentity=_[0]===1&&_[1]===0&&_[2]===0&&_[3]===0&&_[4]===0&&_[5]===1&&_[6]===0&&_[7]===0&&_[8]===0&&_[9]===0&&_[10]===1&&_[11]===0&&_[12]===0&&_[13]===0&&_[14]===0&&_[15]===1}return this._isIdentity},T.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1||this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},T.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var _=this._m,g=_[0],M=_[1],O=_[2],N=_[3],V=_[4],U=_[5],L=_[6],j=_[7],Y=_[8],W=_[9],ie=_[10],re=_[11],ye=_[12],ve=_[13],ue=_[14],oe=_[15],Z=ie*oe-ue*re,J=W*oe-ve*re,B=W*ue-ve*ie,G=Y*oe-ye*re,$=Y*ue-ie*ye,he=Y*ve-ye*W;return g*+(U*Z-L*J+j*B)+M*-(V*Z-L*G+j*$)+O*+(V*J-U*G+j*he)+N*-(V*B-U*$+L*he)},T.prototype.toArray=function(){return this._m},T.prototype.asArray=function(){return this._m},T.prototype.invert=function(){return this.invertToRef(this),this},T.prototype.reset=function(){return T.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},T.prototype.add=function(_){var g=new T;return this.addToRef(_,g),g},T.prototype.addToRef=function(_,g){for(var M=this._m,O=g._m,N=_.m,V=0;V<16;V++)O[V]=M[V]+N[V];return g._markAsUpdated(),this},T.prototype.addToSelf=function(_){for(var g=this._m,M=_.m,O=0;O<16;O++)g[O]+=M[O];return this._markAsUpdated(),this},T.prototype.invertToRef=function(_){if(this._isIdentity===!0)return T.IdentityToRef(_),this;var g=this._m,M=g[0],O=g[1],N=g[2],V=g[3],U=g[4],L=g[5],j=g[6],Y=g[7],W=g[8],ie=g[9],re=g[10],ye=g[11],ve=g[12],ue=g[13],oe=g[14],Z=g[15],J=re*Z-oe*ye,B=ie*Z-ue*ye,G=ie*oe-ue*re,$=W*Z-ve*ye,he=W*oe-re*ve,se=W*ue-ve*ie,q=+(L*J-j*B+Y*G),H=-(U*J-j*$+Y*he),X=+(U*B-L*$+Y*se),ee=-(U*G-L*he+j*se),Q=M*q+O*H+N*X+V*ee;if(Q===0)return _.copyFrom(this),this;var te=1/Q,ge=j*Z-oe*Y,ce=L*Z-ue*Y,de=L*oe-ue*j,ne=U*Z-ve*Y,pe=U*oe-ve*j,Se=U*ue-ve*L,Te=j*ye-re*Y,Ne=L*ye-ie*Y,je=L*re-ie*j,Xe=U*ye-W*Y,Ye=U*re-W*j,Ke=U*ie-W*L,nt=-(O*J-N*B+V*G),qe=+(M*J-N*$+V*he),ct=-(M*B-O*$+V*se),ot=+(M*G-O*he+N*se),_t=+(O*ge-N*ce+V*de),gt=-(M*ge-N*ne+V*pe),At=+(M*ce-O*ne+V*Se),wt=-(M*de-O*pe+N*Se),Qt=-(O*Te-N*Ne+V*je),Wt=+(M*Te-N*Xe+V*Ye),Ft=-(M*Ne-O*Xe+V*Ke),Ht=+(M*je-O*Ye+N*Ke);return T.FromValuesToRef(q*te,nt*te,_t*te,Qt*te,H*te,qe*te,gt*te,Wt*te,X*te,ct*te,At*te,Ft*te,ee*te,ot*te,wt*te,Ht*te,_),this},T.prototype.addAtIndex=function(_,g){return this._m[_]+=g,this._markAsUpdated(),this},T.prototype.multiplyAtIndex=function(_,g){return this._m[_]*=g,this._markAsUpdated(),this},T.prototype.setTranslationFromFloats=function(_,g,M){return this._m[12]=_,this._m[13]=g,this._m[14]=M,this._markAsUpdated(),this},T.prototype.addTranslationFromFloats=function(_,g,M){return this._m[12]+=_,this._m[13]+=g,this._m[14]+=M,this._markAsUpdated(),this},T.prototype.setTranslation=function(_){return this.setTranslationFromFloats(_._x,_._y,_._z)},T.prototype.getTranslation=function(){return new I(this._m[12],this._m[13],this._m[14])},T.prototype.getTranslationToRef=function(_){return _.x=this._m[12],_.y=this._m[13],_.z=this._m[14],this},T.prototype.removeRotationAndScaling=function(){var _=this.m;return T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,_[12],_[13],_[14],_[15],this),this._updateIdentityStatus(_[12]===0&&_[13]===0&&_[14]===0&&_[15]===1),this},T.prototype.multiply=function(_){var g=new T;return this.multiplyToRef(_,g),g},T.prototype.copyFrom=function(_){_.copyToArray(this._m);var g=_;return this._updateIdentityStatus(g._isIdentity,g._isIdentityDirty,g._isIdentity3x2,g._isIdentity3x2Dirty),this},T.prototype.copyToArray=function(_,g){g===void 0&&(g=0);var M=this._m;return _[g]=M[0],_[g+1]=M[1],_[g+2]=M[2],_[g+3]=M[3],_[g+4]=M[4],_[g+5]=M[5],_[g+6]=M[6],_[g+7]=M[7],_[g+8]=M[8],_[g+9]=M[9],_[g+10]=M[10],_[g+11]=M[11],_[g+12]=M[12],_[g+13]=M[13],_[g+14]=M[14],_[g+15]=M[15],this},T.prototype.multiplyToRef=function(_,g){return this._isIdentity?(g.copyFrom(_),this):_._isIdentity?(g.copyFrom(this),this):(this.multiplyToArray(_,g._m,0),g._markAsUpdated(),this)},T.prototype.multiplyToArray=function(_,g,M){var O=this._m,N=_.m,V=O[0],U=O[1],L=O[2],j=O[3],Y=O[4],W=O[5],ie=O[6],re=O[7],ye=O[8],ve=O[9],ue=O[10],oe=O[11],Z=O[12],J=O[13],B=O[14],G=O[15],$=N[0],he=N[1],se=N[2],q=N[3],H=N[4],X=N[5],ee=N[6],Q=N[7],te=N[8],ge=N[9],ce=N[10],de=N[11],ne=N[12],pe=N[13],Se=N[14],Te=N[15];return g[M]=V*$+U*H+L*te+j*ne,g[M+1]=V*he+U*X+L*ge+j*pe,g[M+2]=V*se+U*ee+L*ce+j*Se,g[M+3]=V*q+U*Q+L*de+j*Te,g[M+4]=Y*$+W*H+ie*te+re*ne,g[M+5]=Y*he+W*X+ie*ge+re*pe,g[M+6]=Y*se+W*ee+ie*ce+re*Se,g[M+7]=Y*q+W*Q+ie*de+re*Te,g[M+8]=ye*$+ve*H+ue*te+oe*ne,g[M+9]=ye*he+ve*X+ue*ge+oe*pe,g[M+10]=ye*se+ve*ee+ue*ce+oe*Se,g[M+11]=ye*q+ve*Q+ue*de+oe*Te,g[M+12]=Z*$+J*H+B*te+G*ne,g[M+13]=Z*he+J*X+B*ge+G*pe,g[M+14]=Z*se+J*ee+B*ce+G*Se,g[M+15]=Z*q+J*Q+B*de+G*Te,this},T.prototype.equals=function(_){var g=_;if(!g)return!1;if((this._isIdentity||g._isIdentity)&&!this._isIdentityDirty&&!g._isIdentityDirty)return this._isIdentity&&g._isIdentity;var M=this.m,O=g.m;return M[0]===O[0]&&M[1]===O[1]&&M[2]===O[2]&&M[3]===O[3]&&M[4]===O[4]&&M[5]===O[5]&&M[6]===O[6]&&M[7]===O[7]&&M[8]===O[8]&&M[9]===O[9]&&M[10]===O[10]&&M[11]===O[11]&&M[12]===O[12]&&M[13]===O[13]&&M[14]===O[14]&&M[15]===O[15]},T.prototype.clone=function(){var _=new T;return _.copyFrom(this),_},T.prototype.getClassName=function(){return"Matrix"},T.prototype.getHashCode=function(){for(var _=0|this._m[0],g=1;g<16;g++)_=397*_^(0|this._m[g]);return _},T.prototype.decompose=function(_,g,M){if(this._isIdentity)return M&&M.setAll(0),_&&_.setAll(1),g&&g.copyFromFloats(0,0,0,1),!0;var O=this._m;if(M&&M.copyFromFloats(O[12],O[13],O[14]),(_=_||P.Vector3[0]).x=Math.sqrt(O[0]*O[0]+O[1]*O[1]+O[2]*O[2]),_.y=Math.sqrt(O[4]*O[4]+O[5]*O[5]+O[6]*O[6]),_.z=Math.sqrt(O[8]*O[8]+O[9]*O[9]+O[10]*O[10]),this.determinant()<=0&&(_.y*=-1),_._x===0||_._y===0||_._z===0)return g&&g.copyFromFloats(0,0,0,1),!1;if(g){var N=1/_._x,V=1/_._y,U=1/_._z;T.FromValuesToRef(O[0]*N,O[1]*N,O[2]*N,0,O[4]*V,O[5]*V,O[6]*V,0,O[8]*U,O[9]*U,O[10]*U,0,0,0,0,1,P.Matrix[0]),f.FromRotationMatrixToRef(P.Matrix[0],g)}return!0},T.prototype.getRow=function(_){if(_<0||_>3)return null;var g=4*_;return new b(this._m[g+0],this._m[g+1],this._m[g+2],this._m[g+3])},T.prototype.setRow=function(_,g){return this.setRowFromFloats(_,g.x,g.y,g.z,g.w)},T.prototype.transpose=function(){return T.Transpose(this)},T.prototype.transposeToRef=function(_){return T.TransposeToRef(this,_),this},T.prototype.setRowFromFloats=function(_,g,M,O,N){if(_<0||_>3)return this;var V=4*_;return this._m[V+0]=g,this._m[V+1]=M,this._m[V+2]=O,this._m[V+3]=N,this._markAsUpdated(),this},T.prototype.scale=function(_){var g=new T;return this.scaleToRef(_,g),g},T.prototype.scaleToRef=function(_,g){for(var M=0;M<16;M++)g._m[M]=this._m[M]*_;return g._markAsUpdated(),this},T.prototype.scaleAndAddToRef=function(_,g){for(var M=0;M<16;M++)g._m[M]+=this._m[M]*_;return g._markAsUpdated(),this},T.prototype.toNormalMatrix=function(_){var g=P.Matrix[0];this.invertToRef(g),g.transposeToRef(_);var M=_._m;T.FromValuesToRef(M[0],M[1],M[2],0,M[4],M[5],M[6],0,M[8],M[9],M[10],0,0,0,0,1,_)},T.prototype.getRotationMatrix=function(){var _=new T;return this.getRotationMatrixToRef(_),_},T.prototype.getRotationMatrixToRef=function(_){var g=P.Vector3[0];if(!this.decompose(g))return T.IdentityToRef(_),this;var M=this._m,O=1/g._x,N=1/g._y,V=1/g._z;return T.FromValuesToRef(M[0]*O,M[1]*O,M[2]*O,0,M[4]*N,M[5]*N,M[6]*N,0,M[8]*V,M[9]*V,M[10]*V,0,0,0,0,1,_),this},T.prototype.toggleModelMatrixHandInPlace=function(){var _=this._m;_[2]*=-1,_[6]*=-1,_[8]*=-1,_[9]*=-1,_[14]*=-1,this._markAsUpdated()},T.prototype.toggleProjectionMatrixHandInPlace=function(){var _=this._m;_[8]*=-1,_[9]*=-1,_[10]*=-1,_[11]*=-1,this._markAsUpdated()},T.FromArray=function(_,g){g===void 0&&(g=0);var M=new T;return T.FromArrayToRef(_,g,M),M},T.FromArrayToRef=function(_,g,M){for(var O=0;O<16;O++)M._m[O]=_[O+g];M._markAsUpdated()},T.FromFloat32ArrayToRefScaled=function(_,g,M,O){for(var N=0;N<16;N++)O._m[N]=_[N+g]*M;O._markAsUpdated()},Object.defineProperty(T,"IdentityReadOnly",{get:function(){return T._identityReadOnly},enumerable:!1,configurable:!0}),T.FromValuesToRef=function(_,g,M,O,N,V,U,L,j,Y,W,ie,re,ye,ve,ue,oe){var Z=oe._m;Z[0]=_,Z[1]=g,Z[2]=M,Z[3]=O,Z[4]=N,Z[5]=V,Z[6]=U,Z[7]=L,Z[8]=j,Z[9]=Y,Z[10]=W,Z[11]=ie,Z[12]=re,Z[13]=ye,Z[14]=ve,Z[15]=ue,oe._markAsUpdated()},T.FromValues=function(_,g,M,O,N,V,U,L,j,Y,W,ie,re,ye,ve,ue){var oe=new T,Z=oe._m;return Z[0]=_,Z[1]=g,Z[2]=M,Z[3]=O,Z[4]=N,Z[5]=V,Z[6]=U,Z[7]=L,Z[8]=j,Z[9]=Y,Z[10]=W,Z[11]=ie,Z[12]=re,Z[13]=ye,Z[14]=ve,Z[15]=ue,oe._markAsUpdated(),oe},T.Compose=function(_,g,M){var O=new T;return T.ComposeToRef(_,g,M,O),O},T.ComposeToRef=function(_,g,M,O){var N=O._m,V=g._x,U=g._y,L=g._z,j=g._w,Y=V+V,W=U+U,ie=L+L,re=V*Y,ye=V*W,ve=V*ie,ue=U*W,oe=U*ie,Z=L*ie,J=j*Y,B=j*W,G=j*ie,$=_._x,he=_._y,se=_._z;N[0]=(1-(ue+Z))*$,N[1]=(ye+G)*$,N[2]=(ve-B)*$,N[3]=0,N[4]=(ye-G)*he,N[5]=(1-(re+Z))*he,N[6]=(oe+J)*he,N[7]=0,N[8]=(ve+B)*se,N[9]=(oe-J)*se,N[10]=(1-(re+ue))*se,N[11]=0,N[12]=M._x,N[13]=M._y,N[14]=M._z,N[15]=1,O._markAsUpdated()},T.Identity=function(){var _=T.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return _._updateIdentityStatus(!0),_},T.IdentityToRef=function(_){T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,_),_._updateIdentityStatus(!0)},T.Zero=function(){var _=T.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return _._updateIdentityStatus(!1),_},T.RotationX=function(_){var g=new T;return T.RotationXToRef(_,g),g},T.Invert=function(_){var g=new T;return _.invertToRef(g),g},T.RotationXToRef=function(_,g){var M=Math.sin(_),O=Math.cos(_);T.FromValuesToRef(1,0,0,0,0,O,M,0,0,-M,O,0,0,0,0,1,g),g._updateIdentityStatus(O===1&&M===0)},T.RotationY=function(_){var g=new T;return T.RotationYToRef(_,g),g},T.RotationYToRef=function(_,g){var M=Math.sin(_),O=Math.cos(_);T.FromValuesToRef(O,0,-M,0,0,1,0,0,M,0,O,0,0,0,0,1,g),g._updateIdentityStatus(O===1&&M===0)},T.RotationZ=function(_){var g=new T;return T.RotationZToRef(_,g),g},T.RotationZToRef=function(_,g){var M=Math.sin(_),O=Math.cos(_);T.FromValuesToRef(O,M,0,0,-M,O,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(O===1&&M===0)},T.RotationAxis=function(_,g){var M=new T;return T.RotationAxisToRef(_,g,M),M},T.RotationAxisToRef=function(_,g,M){var O=Math.sin(-g),N=Math.cos(-g),V=1-N;_.normalize();var U=M._m;U[0]=_._x*_._x*V+N,U[1]=_._x*_._y*V-_._z*O,U[2]=_._x*_._z*V+_._y*O,U[3]=0,U[4]=_._y*_._x*V+_._z*O,U[5]=_._y*_._y*V+N,U[6]=_._y*_._z*V-_._x*O,U[7]=0,U[8]=_._z*_._x*V-_._y*O,U[9]=_._z*_._y*V+_._x*O,U[10]=_._z*_._z*V+N,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,M._markAsUpdated()},T.RotationAlignToRef=function(_,g,M){var O=I.Cross(g,_),N=I.Dot(g,_),V=1/(1+N),U=M._m;U[0]=O._x*O._x*V+N,U[1]=O._y*O._x*V-O._z,U[2]=O._z*O._x*V+O._y,U[3]=0,U[4]=O._x*O._y*V+O._z,U[5]=O._y*O._y*V+N,U[6]=O._z*O._y*V-O._x,U[7]=0,U[8]=O._x*O._z*V-O._y,U[9]=O._y*O._z*V+O._x,U[10]=O._z*O._z*V+N,U[11]=0,U[12]=0,U[13]=0,U[14]=0,U[15]=1,M._markAsUpdated()},T.RotationYawPitchRoll=function(_,g,M){var O=new T;return T.RotationYawPitchRollToRef(_,g,M,O),O},T.RotationYawPitchRollToRef=function(_,g,M,O){f.RotationYawPitchRollToRef(_,g,M,P.Quaternion[0]),P.Quaternion[0].toRotationMatrix(O)},T.Scaling=function(_,g,M){var O=new T;return T.ScalingToRef(_,g,M,O),O},T.ScalingToRef=function(_,g,M,O){T.FromValuesToRef(_,0,0,0,0,g,0,0,0,0,M,0,0,0,0,1,O),O._updateIdentityStatus(_===1&&g===1&&M===1)},T.Translation=function(_,g,M){var O=new T;return T.TranslationToRef(_,g,M,O),O},T.TranslationToRef=function(_,g,M,O){T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,_,g,M,1,O),O._updateIdentityStatus(_===0&&g===0&&M===0)},T.Lerp=function(_,g,M){var O=new T;return T.LerpToRef(_,g,M,O),O},T.LerpToRef=function(_,g,M,O){for(var N=O._m,V=_.m,U=g.m,L=0;L<16;L++)N[L]=V[L]*(1-M)+U[L]*M;O._markAsUpdated()},T.DecomposeLerp=function(_,g,M){var O=new T;return T.DecomposeLerpToRef(_,g,M,O),O},T.DecomposeLerpToRef=function(_,g,M,O){var N=P.Vector3[0],V=P.Quaternion[0],U=P.Vector3[1];_.decompose(N,V,U);var L=P.Vector3[2],j=P.Quaternion[1],Y=P.Vector3[3];g.decompose(L,j,Y);var W=P.Vector3[4];I.LerpToRef(N,L,M,W);var ie=P.Quaternion[2];f.SlerpToRef(V,j,M,ie);var re=P.Vector3[5];I.LerpToRef(U,Y,M,re),T.ComposeToRef(W,ie,re,O)},T.LookAtLH=function(_,g,M){var O=new T;return T.LookAtLHToRef(_,g,M,O),O},T.LookAtLHToRef=function(_,g,M,O){var N=P.Vector3[0],V=P.Vector3[1],U=P.Vector3[2];g.subtractToRef(_,U),U.normalize(),I.CrossToRef(M,U,N);var L=N.lengthSquared();L===0?N.x=1:N.normalizeFromLength(Math.sqrt(L)),I.CrossToRef(U,N,V),V.normalize();var j=-I.Dot(N,_),Y=-I.Dot(V,_),W=-I.Dot(U,_);T.FromValuesToRef(N._x,V._x,U._x,0,N._y,V._y,U._y,0,N._z,V._z,U._z,0,j,Y,W,1,O)},T.LookAtRH=function(_,g,M){var O=new T;return T.LookAtRHToRef(_,g,M,O),O},T.LookAtRHToRef=function(_,g,M,O){var N=P.Vector3[0],V=P.Vector3[1],U=P.Vector3[2];_.subtractToRef(g,U),U.normalize(),I.CrossToRef(M,U,N);var L=N.lengthSquared();L===0?N.x=1:N.normalizeFromLength(Math.sqrt(L)),I.CrossToRef(U,N,V),V.normalize();var j=-I.Dot(N,_),Y=-I.Dot(V,_),W=-I.Dot(U,_);T.FromValuesToRef(N._x,V._x,U._x,0,N._y,V._y,U._y,0,N._z,V._z,U._z,0,j,Y,W,1,O)},T.OrthoLH=function(_,g,M,O){var N=new T;return T.OrthoLHToRef(_,g,M,O,N),N},T.OrthoLHToRef=function(_,g,M,O,N){var V=2/_,U=2/g,L=2/(O-M),j=-(O+M)/(O-M);T.FromValuesToRef(V,0,0,0,0,U,0,0,0,0,L,0,0,0,j,1,N),N._updateIdentityStatus(V===1&&U===1&&L===1&&j===0)},T.OrthoOffCenterLH=function(_,g,M,O,N,V){var U=new T;return T.OrthoOffCenterLHToRef(_,g,M,O,N,V,U),U},T.OrthoOffCenterLHToRef=function(_,g,M,O,N,V,U){var L=2/(g-_),j=2/(O-M),Y=2/(V-N),W=-(V+N)/(V-N),ie=(_+g)/(_-g),re=(O+M)/(M-O);T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,Y,0,ie,re,W,1,U),U._markAsUpdated()},T.OrthoOffCenterRH=function(_,g,M,O,N,V){var U=new T;return T.OrthoOffCenterRHToRef(_,g,M,O,N,V,U),U},T.OrthoOffCenterRHToRef=function(_,g,M,O,N,V,U){T.OrthoOffCenterLHToRef(_,g,M,O,N,V,U),U._m[10]*=-1},T.PerspectiveLH=function(_,g,M,O){var N=new T,V=2*M/_,U=2*M/g,L=(O+M)/(O-M),j=-2*O*M/(O-M);return T.FromValuesToRef(V,0,0,0,0,U,0,0,0,0,L,1,0,0,j,0,N),N._updateIdentityStatus(!1),N},T.PerspectiveFovLH=function(_,g,M,O){var N=new T;return T.PerspectiveFovLHToRef(_,g,M,O,N),N},T.PerspectiveFovLHToRef=function(_,g,M,O,N,V){V===void 0&&(V=!0);var U=M,L=O,j=1/Math.tan(.5*_),Y=V?j/g:j,W=V?j:j*g,ie=(L+U)/(L-U),re=-2*L*U/(L-U);T.FromValuesToRef(Y,0,0,0,0,W,0,0,0,0,ie,1,0,0,re,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovReverseLHToRef=function(_,g,M,O,N,V){V===void 0&&(V=!0);var U=1/Math.tan(.5*_),L=V?U/g:U,j=V?U:U*g;T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,-M,1,0,0,1,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovRH=function(_,g,M,O){var N=new T;return T.PerspectiveFovRHToRef(_,g,M,O,N),N},T.PerspectiveFovRHToRef=function(_,g,M,O,N,V){V===void 0&&(V=!0);var U=M,L=O,j=1/Math.tan(.5*_),Y=V?j/g:j,W=V?j:j*g,ie=-(L+U)/(L-U),re=-2*L*U/(L-U);T.FromValuesToRef(Y,0,0,0,0,W,0,0,0,0,ie,-1,0,0,re,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovReverseRHToRef=function(_,g,M,O,N,V){V===void 0&&(V=!0);var U=1/Math.tan(.5*_),L=V?U/g:U,j=V?U:U*g;T.FromValuesToRef(L,0,0,0,0,j,0,0,0,0,-M,-1,0,0,-1,0,N),N._updateIdentityStatus(!1)},T.PerspectiveFovWebVRToRef=function(_,g,M,O,N){N===void 0&&(N=!1);var V=N?-1:1,U=Math.tan(_.upDegrees*Math.PI/180),L=Math.tan(_.downDegrees*Math.PI/180),j=Math.tan(_.leftDegrees*Math.PI/180),Y=Math.tan(_.rightDegrees*Math.PI/180),W=2/(j+Y),ie=2/(U+L),re=O._m;re[0]=W,re[1]=re[2]=re[3]=re[4]=0,re[5]=ie,re[6]=re[7]=0,re[8]=(j-Y)*W*.5,re[9]=-(U-L)*ie*.5,re[10]=-M/(g-M),re[11]=1*V,re[12]=re[13]=re[15]=0,re[14]=-2*M*g/(M-g),O._markAsUpdated()},T.GetFinalMatrix=function(_,g,M,O,N,V){var U=_.width,L=_.height,j=_.x,Y=_.y,W=T.FromValues(U/2,0,0,0,0,-L/2,0,0,0,0,V-N,0,j+U/2,L/2+Y,N,1),ie=P.Matrix[0];return g.multiplyToRef(M,ie),ie.multiplyToRef(O,ie),ie.multiply(W)},T.GetAsMatrix2x2=function(_){var g=_.m,M=[g[0],g[1],g[4],g[5]];return C.a.MatrixUse64Bits?M:new Float32Array(M)},T.GetAsMatrix3x3=function(_){var g=_.m,M=[g[0],g[1],g[2],g[4],g[5],g[6],g[8],g[9],g[10]];return C.a.MatrixUse64Bits?M:new Float32Array(M)},T.Transpose=function(_){var g=new T;return T.TransposeToRef(_,g),g},T.TransposeToRef=function(_,g){var M=g._m,O=_.m;M[0]=O[0],M[1]=O[4],M[2]=O[8],M[3]=O[12],M[4]=O[1],M[5]=O[5],M[6]=O[9],M[7]=O[13],M[8]=O[2],M[9]=O[6],M[10]=O[10],M[11]=O[14],M[12]=O[3],M[13]=O[7],M[14]=O[11],M[15]=O[15],g._updateIdentityStatus(_._isIdentity,_._isIdentityDirty)},T.Reflection=function(_){var g=new T;return T.ReflectionToRef(_,g),g},T.ReflectionToRef=function(_,g){_.normalize();var M=_.normal.x,O=_.normal.y,N=_.normal.z,V=-2*M,U=-2*O,L=-2*N;T.FromValuesToRef(V*M+1,U*M,L*M,0,V*O,U*O+1,L*O,0,V*N,U*N,L*N+1,0,V*_.d,U*_.d,L*_.d,1,g)},T.FromXYZAxesToRef=function(_,g,M,O){T.FromValuesToRef(_._x,_._y,_._z,0,g._x,g._y,g._z,0,M._x,M._y,M._z,0,0,0,0,1,O)},T.FromQuaternionToRef=function(_,g){var M=_._x*_._x,O=_._y*_._y,N=_._z*_._z,V=_._x*_._y,U=_._z*_._w,L=_._z*_._x,j=_._y*_._w,Y=_._y*_._z,W=_._x*_._w;g._m[0]=1-2*(O+N),g._m[1]=2*(V+U),g._m[2]=2*(L-j),g._m[3]=0,g._m[4]=2*(V-U),g._m[5]=1-2*(N+M),g._m[6]=2*(Y+W),g._m[7]=0,g._m[8]=2*(L+j),g._m[9]=2*(Y-W),g._m[10]=1-2*(O+M),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,g._markAsUpdated()},T._updateFlagSeed=0,T._identityReadOnly=T.Identity(),T}(),P=function(){function T(){}return T.Vector3=S.a.BuildArray(6,I.Zero),T.Matrix=S.a.BuildArray(2,x.Identity),T.Quaternion=S.a.BuildArray(3,f.Zero),T}(),A=function(){function T(){}return T.Vector2=S.a.BuildArray(3,R.Zero),T.Vector3=S.a.BuildArray(13,I.Zero),T.Vector4=S.a.BuildArray(3,b.Zero),T.Quaternion=S.a.BuildArray(2,f.Zero),T.Matrix=S.a.BuildArray(8,x.Identity),T}();h.a.RegisteredTypes["BABYLON.Vector2"]=R,h.a.RegisteredTypes["BABYLON.Vector3"]=I,h.a.RegisteredTypes["BABYLON.Vector4"]=b,h.a.RegisteredTypes["BABYLON.Matrix"]=x},function(p,s,c){c.d(s,"d",function(){return m}),c.d(s,"a",function(){return S}),c.d(s,"c",function(){return h}),c.d(s,"b",function(){return C}),c.d(s,"e",function(){return R}),c.d(s,"f",function(){return I});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var E=function(b,f){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,P){x.__proto__=P}||function(x,P){for(var A in P)Object.prototype.hasOwnProperty.call(P,A)&&(x[A]=P[A])})(b,f)};function m(b,f){function x(){this.constructor=b}E(b,f),b.prototype=f===null?Object.create(f):(x.prototype=f.prototype,new x)}var S=function(){return(S=Object.assign||function(b){for(var f,x=1,P=arguments.length;x<P;x++)for(var A in f=arguments[x])Object.prototype.hasOwnProperty.call(f,A)&&(b[A]=f[A]);return b}).apply(this,arguments)};function h(b,f,x,P){var A,T=arguments.length,_=T<3?f:P===null?P=Object.getOwnPropertyDescriptor(f,x):P;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(b,f,x,P);else for(var g=b.length-1;g>=0;g--)(A=b[g])&&(_=(T<3?A(_):T>3?A(f,x,_):A(f,x))||_);return T>3&&_&&Object.defineProperty(f,x,_),_}function C(b,f,x,P){return new(x||(x=Promise))(function(A,T){function _(O){try{M(P.next(O))}catch(N){T(N)}}function g(O){try{M(P.throw(O))}catch(N){T(N)}}function M(O){var N;O.done?A(O.value):(N=O.value,N instanceof x?N:new x(function(V){V(N)})).then(_,g)}M((P=P.apply(b,f||[])).next())})}function R(b,f){var x,P,A,T,_={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return T={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function g(M){return function(O){return function(N){if(x)throw new TypeError("Generator is already executing.");for(;_;)try{if(x=1,P&&(A=2&N[0]?P.return:N[0]?P.throw||((A=P.return)&&A.call(P),0):P.next)&&!(A=A.call(P,N[1])).done)return A;switch(P=0,A&&(N=[2&N[0],A.value]),N[0]){case 0:case 1:A=N;break;case 4:return _.label++,{value:N[1],done:!1};case 5:_.label++,P=N[1],N=[0];continue;case 7:N=_.ops.pop(),_.trys.pop();continue;default:if(A=_.trys,!((A=A.length>0&&A[A.length-1])||N[0]!==6&&N[0]!==2)){_=0;continue}if(N[0]===3&&(!A||N[1]>A[0]&&N[1]<A[3])){_.label=N[1];break}if(N[0]===6&&_.label<A[1]){_.label=A[1],A=N;break}if(A&&_.label<A[2]){_.label=A[2],_.ops.push(N);break}A[2]&&_.ops.pop(),_.trys.pop();continue}N=f.call(b,_)}catch(V){N=[6,V],P=0}finally{x=A=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([M,O])}}}function I(){for(var b=0,f=0,x=arguments.length;f<x;f++)b+=arguments[f].length;var P=Array(b),A=0;for(f=0;f<x;f++)for(var T=arguments[f],_=0,g=T.length;_<g;_++,A++)P[A]=T[_];return P}},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.ALPHA_DISABLE=0,m.ALPHA_ADD=1,m.ALPHA_COMBINE=2,m.ALPHA_SUBTRACT=3,m.ALPHA_MULTIPLY=4,m.ALPHA_MAXIMIZED=5,m.ALPHA_ONEONE=6,m.ALPHA_PREMULTIPLIED=7,m.ALPHA_PREMULTIPLIED_PORTERDUFF=8,m.ALPHA_INTERPOLATE=9,m.ALPHA_SCREENMODE=10,m.ALPHA_ONEONE_ONEONE=11,m.ALPHA_ALPHATOCOLOR=12,m.ALPHA_REVERSEONEMINUS=13,m.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,m.ALPHA_ONEONE_ONEZERO=15,m.ALPHA_EXCLUSION=16,m.ALPHA_EQUATION_ADD=0,m.ALPHA_EQUATION_SUBSTRACT=1,m.ALPHA_EQUATION_REVERSE_SUBTRACT=2,m.ALPHA_EQUATION_MAX=3,m.ALPHA_EQUATION_MIN=4,m.ALPHA_EQUATION_DARKEN=5,m.DELAYLOADSTATE_NONE=0,m.DELAYLOADSTATE_LOADED=1,m.DELAYLOADSTATE_LOADING=2,m.DELAYLOADSTATE_NOTLOADED=4,m.NEVER=512,m.ALWAYS=519,m.LESS=513,m.EQUAL=514,m.LEQUAL=515,m.GREATER=516,m.GEQUAL=518,m.NOTEQUAL=517,m.KEEP=7680,m.REPLACE=7681,m.INCR=7682,m.DECR=7683,m.INVERT=5386,m.INCR_WRAP=34055,m.DECR_WRAP=34056,m.TEXTURE_CLAMP_ADDRESSMODE=0,m.TEXTURE_WRAP_ADDRESSMODE=1,m.TEXTURE_MIRROR_ADDRESSMODE=2,m.TEXTUREFORMAT_ALPHA=0,m.TEXTUREFORMAT_LUMINANCE=1,m.TEXTUREFORMAT_LUMINANCE_ALPHA=2,m.TEXTUREFORMAT_RGB=4,m.TEXTUREFORMAT_RGBA=5,m.TEXTUREFORMAT_RED=6,m.TEXTUREFORMAT_R=6,m.TEXTUREFORMAT_RG=7,m.TEXTUREFORMAT_RED_INTEGER=8,m.TEXTUREFORMAT_R_INTEGER=8,m.TEXTUREFORMAT_RG_INTEGER=9,m.TEXTUREFORMAT_RGB_INTEGER=10,m.TEXTUREFORMAT_RGBA_INTEGER=11,m.TEXTURETYPE_UNSIGNED_BYTE=0,m.TEXTURETYPE_UNSIGNED_INT=0,m.TEXTURETYPE_FLOAT=1,m.TEXTURETYPE_HALF_FLOAT=2,m.TEXTURETYPE_BYTE=3,m.TEXTURETYPE_SHORT=4,m.TEXTURETYPE_UNSIGNED_SHORT=5,m.TEXTURETYPE_INT=6,m.TEXTURETYPE_UNSIGNED_INTEGER=7,m.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,m.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,m.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,m.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,m.TEXTURETYPE_UNSIGNED_INT_24_8=12,m.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,m.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,m.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,m.TEXTURE_NEAREST_SAMPLINGMODE=1,m.TEXTURE_NEAREST_NEAREST=1,m.TEXTURE_BILINEAR_SAMPLINGMODE=2,m.TEXTURE_LINEAR_LINEAR=2,m.TEXTURE_TRILINEAR_SAMPLINGMODE=3,m.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,m.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,m.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,m.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,m.TEXTURE_NEAREST_LINEAR=7,m.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,m.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,m.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,m.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,m.TEXTURE_LINEAR_NEAREST=12,m.TEXTURE_EXPLICIT_MODE=0,m.TEXTURE_SPHERICAL_MODE=1,m.TEXTURE_PLANAR_MODE=2,m.TEXTURE_CUBIC_MODE=3,m.TEXTURE_PROJECTION_MODE=4,m.TEXTURE_SKYBOX_MODE=5,m.TEXTURE_INVCUBIC_MODE=6,m.TEXTURE_EQUIRECTANGULAR_MODE=7,m.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,m.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,m.TEXTURE_FILTERING_QUALITY_HIGH=64,m.TEXTURE_FILTERING_QUALITY_MEDIUM=16,m.TEXTURE_FILTERING_QUALITY_LOW=8,m.SCALEMODE_FLOOR=1,m.SCALEMODE_NEAREST=2,m.SCALEMODE_CEILING=3,m.MATERIAL_TextureDirtyFlag=1,m.MATERIAL_LightDirtyFlag=2,m.MATERIAL_FresnelDirtyFlag=4,m.MATERIAL_AttributesDirtyFlag=8,m.MATERIAL_MiscDirtyFlag=16,m.MATERIAL_PrePassDirtyFlag=32,m.MATERIAL_AllDirtyFlag=63,m.MATERIAL_TriangleFillMode=0,m.MATERIAL_WireFrameFillMode=1,m.MATERIAL_PointFillMode=2,m.MATERIAL_PointListDrawMode=3,m.MATERIAL_LineListDrawMode=4,m.MATERIAL_LineLoopDrawMode=5,m.MATERIAL_LineStripDrawMode=6,m.MATERIAL_TriangleStripDrawMode=7,m.MATERIAL_TriangleFanDrawMode=8,m.MATERIAL_ClockWiseSideOrientation=0,m.MATERIAL_CounterClockWiseSideOrientation=1,m.ACTION_NothingTrigger=0,m.ACTION_OnPickTrigger=1,m.ACTION_OnLeftPickTrigger=2,m.ACTION_OnRightPickTrigger=3,m.ACTION_OnCenterPickTrigger=4,m.ACTION_OnPickDownTrigger=5,m.ACTION_OnDoublePickTrigger=6,m.ACTION_OnPickUpTrigger=7,m.ACTION_OnPickOutTrigger=16,m.ACTION_OnLongPressTrigger=8,m.ACTION_OnPointerOverTrigger=9,m.ACTION_OnPointerOutTrigger=10,m.ACTION_OnEveryFrameTrigger=11,m.ACTION_OnIntersectionEnterTrigger=12,m.ACTION_OnIntersectionExitTrigger=13,m.ACTION_OnKeyDownTrigger=14,m.ACTION_OnKeyUpTrigger=15,m.PARTICLES_BILLBOARDMODE_Y=2,m.PARTICLES_BILLBOARDMODE_ALL=7,m.PARTICLES_BILLBOARDMODE_STRETCHED=8,m.MESHES_CULLINGSTRATEGY_STANDARD=0,m.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,m.SCENELOADER_NO_LOGGING=0,m.SCENELOADER_MINIMAL_LOGGING=1,m.SCENELOADER_SUMMARY_LOGGING=2,m.SCENELOADER_DETAILED_LOGGING=3,m.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,m.PREPASS_POSITION_TEXTURE_TYPE=1,m.PREPASS_VELOCITY_TEXTURE_TYPE=2,m.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,m.PREPASS_COLOR_TEXTURE_TYPE=4,m.PREPASS_DEPTHNORMAL_TEXTURE_TYPE=5,m.PREPASS_ALBEDO_TEXTURE_TYPE=6,m}()},function(p,s,c){c.d(s,"b",function(){return x}),c.d(s,"c",function(){return P}),c.d(s,"m",function(){return A}),c.d(s,"e",function(){return T}),c.d(s,"h",function(){return _}),c.d(s,"n",function(){return g}),c.d(s,"o",function(){return M}),c.d(s,"k",function(){return O}),c.d(s,"g",function(){return N}),c.d(s,"f",function(){return V}),c.d(s,"i",function(){return U}),c.d(s,"l",function(){return L}),c.d(s,"j",function(){return j}),c.d(s,"d",function(){return Y}),c.d(s,"a",function(){return W});var E=c(37),m=c(0),S=c(21),h=c(9),C={},R={},I=function(ie,re,ye){var ve=ie();E.a&&E.a.AddTagsTo(ve,re.tags);var ue=b(ve);for(var oe in ue){var Z=ue[oe],J=re[oe],B=Z.type;if(J!=null&&oe!=="uniqueId")switch(B){case 0:case 6:case 11:ve[oe]=J;break;case 1:ve[oe]=ye||J.isRenderTarget?J:J.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:ve[oe]=ye?J:J.clone()}}return ve};function b(ie){var re=ie.getClassName();if(R[re])return R[re];R[re]={};for(var ye=R[re],ve=ie,ue=re;ue;){var oe=C[ue];for(var Z in oe)ye[Z]=oe[Z];var J=void 0,B=!1;do{if(!(J=Object.getPrototypeOf(ve)).getClassName){B=!0;break}if(J.getClassName()!==ue)break;ve=J}while(J);if(B)break;ue=J.getClassName(),ve=J}return ye}function f(ie,re){return function(ye,ve){var ue=function(oe){var Z=oe.getClassName();return C[Z]||(C[Z]={}),C[Z]}(ye);ue[ve]||(ue[ve]={type:ie,sourceName:re})}}function x(ie,re){return re===void 0&&(re=null),function(ye,ve){return ve===void 0&&(ve=null),function(ue,oe){var Z=ve||"_"+oe;Object.defineProperty(ue,oe,{get:function(){return this[Z]},set:function(J){this[Z]!==J&&(this[Z]=J,ue[ye].apply(this))},enumerable:!0,configurable:!0})}}(ie,re)}function P(ie){return f(0,ie)}function A(ie){return f(1,ie)}function T(ie){return f(2,ie)}function _(ie){return f(3,ie)}function g(ie){return f(4,ie)}function M(ie){return f(5,ie)}function O(ie){return f(6,ie)}function N(ie){return f(7,ie)}function V(ie){return f(8,ie)}function U(ie){return f(9,ie)}function L(ie){return f(10,ie)}function j(ie){return f(12,ie)}function Y(ie){return f(11,ie)}var W=function(){function ie(){}return ie.AppendSerializedAnimations=function(re,ye){if(re.animations){ye.animations=[];for(var ve=0;ve<re.animations.length;ve++){var ue=re.animations[ve];ye.animations.push(ue.serialize())}}},ie.Serialize=function(re,ye){ye||(ye={}),E.a&&(ye.tags=E.a.GetTags(re));var ve=b(re);for(var ue in ve){var oe=ve[ue],Z=oe.sourceName||ue,J=oe.type,B=re[ue];if(B!=null&&ue!=="uniqueId")switch(J){case 0:ye[Z]=B;break;case 1:ye[Z]=B.serialize();break;case 2:ye[Z]=B.asArray();break;case 3:ye[Z]=B.serialize();break;case 4:case 5:ye[Z]=B.asArray();break;case 6:ye[Z]=B.id;break;case 7:ye[Z]=B.serialize();break;case 8:ye[Z]=B.asArray();break;case 9:ye[Z]=B.serialize();break;case 10:ye[Z]=B.asArray();break;case 11:ye[Z]=B.id;case 12:ye[Z]=B.asArray()}}return ye},ie.Parse=function(re,ye,ve,ue){ue===void 0&&(ue=null);var oe=re();ue||(ue=""),E.a&&E.a.AddTagsTo(oe,ye.tags);var Z=b(oe);for(var J in Z){var B=Z[J],G=ye[B.sourceName||J],$=B.type;if(G!=null&&J!=="uniqueId"){var he=oe;switch($){case 0:he[J]=G;break;case 1:ve&&(he[J]=ie._TextureParser(G,ve,ue));break;case 2:he[J]=h.a.FromArray(G);break;case 3:he[J]=ie._FresnelParametersParser(G);break;case 4:he[J]=m.d.FromArray(G);break;case 5:he[J]=m.e.FromArray(G);break;case 6:ve&&(he[J]=ve.getLastMeshByID(G));break;case 7:he[J]=ie._ColorCurvesParser(G);break;case 8:he[J]=h.b.FromArray(G);break;case 9:he[J]=ie._ImageProcessingConfigurationParser(G);break;case 10:he[J]=m.b.FromArray(G);break;case 11:ve&&(he[J]=ve.getCameraByID(G));case 12:he[J]=m.a.FromArray(G)}}}return oe},ie.Clone=function(re,ye){return I(re,ye,!1)},ie.Instanciate=function(re,ye){return I(re,ye,!0)},ie._ImageProcessingConfigurationParser=function(re){throw S.a.WarnImport("ImageProcessingConfiguration")},ie._FresnelParametersParser=function(re){throw S.a.WarnImport("FresnelParameters")},ie._ColorCurvesParser=function(re){throw S.a.WarnImport("ColorCurves")},ie._TextureParser=function(re,ye,ve){throw S.a.WarnImport("Texture")},ie}()},function(p,s,c){c.d(s,"a",function(){return E}),c.d(s,"b",function(){return m});var E=function(){function S(h,C,R,I,b,f,x,P){I===void 0&&(I=0),b===void 0&&(b=!1),f===void 0&&(f=!1),x===void 0&&(x=!1),this._isAlreadyOwned=!1,h.getScene?this._engine=h.getScene().getEngine():this._engine=h,this._updatable=R,this._instanced=f,this._divisor=P||1,this._data=C,this.byteStride=x?I:I*Float32Array.BYTES_PER_ELEMENT,b||this.create()}return S.prototype.createVertexBuffer=function(h,C,R,I,b,f,x){f===void 0&&(f=!1);var P=f?C:C*Float32Array.BYTES_PER_ELEMENT,A=I?f?I:I*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,h,this._updatable,!0,A,b===void 0?this._instanced:b,P,R,void 0,void 0,!0,this._divisor||x)},S.prototype.isUpdatable=function(){return this._updatable},S.prototype.getData=function(){return this._data},S.prototype.getBuffer=function(){return this._buffer},S.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},S.prototype.create=function(h){h===void 0&&(h=null),!h&&this._buffer||(h=h||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h),this._data=h):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(h),this._data=h):this._buffer=this._engine.createVertexBuffer(h))},S.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},S.prototype.update=function(h){this.create(h)},S.prototype.updateDirectly=function(h,C,R,I){I===void 0&&(I=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h,I?C:C*Float32Array.BYTES_PER_ELEMENT,R?R*this.byteStride:void 0),this._data=null)},S.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},S.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},S}(),m=function(){function S(h,C,R,I,b,f,x,P,A,T,_,g,M,O){if(_===void 0&&(_=!1),g===void 0&&(g=!1),M===void 0&&(M=1),O===void 0&&(O=!1),C instanceof E?(this._buffer=C,this._ownsBuffer=O,O&&this._buffer._increaseReferences()):(this._buffer=new E(h,C,I,f,b,x,g),this._ownsBuffer=!0),this._kind=R,T==null){var N=this.getData();this.type=S.FLOAT,N instanceof Int8Array?this.type=S.BYTE:N instanceof Uint8Array?this.type=S.UNSIGNED_BYTE:N instanceof Int16Array?this.type=S.SHORT:N instanceof Uint16Array?this.type=S.UNSIGNED_SHORT:N instanceof Int32Array?this.type=S.INT:N instanceof Uint32Array&&(this.type=S.UNSIGNED_INT)}else this.type=T;var V=S.GetTypeByteLength(this.type);g?(this._size=A||(f?f/V:S.DeduceStride(R)),this.byteStride=f||this._buffer.byteStride||this._size*V,this.byteOffset=P||0):(this._size=A||f||S.DeduceStride(R),this.byteStride=f?f*V:this._buffer.byteStride||this._size*V,this.byteOffset=(P||0)*V),this.normalized=_,this._instanced=x!==void 0&&x,this._instanceDivisor=x?M:0}return Object.defineProperty(S.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(h){this._instanceDivisor=h,this._instanced=h!=0},enumerable:!1,configurable:!0}),S.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},S.prototype.getKind=function(){return this._kind},S.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},S.prototype.getData=function(){return this._buffer.getData()},S.prototype.getBuffer=function(){return this._buffer.getBuffer()},S.prototype.getStrideSize=function(){return this.byteStride/S.GetTypeByteLength(this.type)},S.prototype.getOffset=function(){return this.byteOffset/S.GetTypeByteLength(this.type)},S.prototype.getSize=function(){return this._size},S.prototype.getIsInstanced=function(){return this._instanced},S.prototype.getInstanceDivisor=function(){return this._instanceDivisor},S.prototype.create=function(h){this._buffer.create(h)},S.prototype.update=function(h){this._buffer.update(h)},S.prototype.updateDirectly=function(h,C,R){R===void 0&&(R=!1),this._buffer.updateDirectly(h,C,void 0,R)},S.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},S.prototype.forEach=function(h,C){S.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,h,this.normalized,C)},S.DeduceStride=function(h){switch(h){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+h+"'")}},S.GetTypeByteLength=function(h){switch(h){case S.BYTE:case S.UNSIGNED_BYTE:return 1;case S.SHORT:case S.UNSIGNED_SHORT:return 2;case S.INT:case S.UNSIGNED_INT:case S.FLOAT:return 4;default:throw new Error("Invalid type '"+h+"'")}},S.ForEach=function(h,C,R,I,b,f,x,P){if(h instanceof Array)for(var A=C/4,T=R/4,_=0;_<f;_+=I){for(var g=0;g<I;g++)P(h[A+g],_+g);A+=T}else{var M=h instanceof ArrayBuffer?new DataView(h):new DataView(h.buffer,h.byteOffset,h.byteLength),O=S.GetTypeByteLength(b);for(_=0;_<f;_+=I){var N=C;for(g=0;g<I;g++)P(S._GetFloatValue(M,b,N,x),_+g),N+=O;C+=R}}},S._GetFloatValue=function(h,C,R,I){switch(C){case S.BYTE:var b=h.getInt8(R);return I&&(b=Math.max(b/127,-1)),b;case S.UNSIGNED_BYTE:return b=h.getUint8(R),I&&(b/=255),b;case S.SHORT:return b=h.getInt16(R,!0),I&&(b=Math.max(b/32767,-1)),b;case S.UNSIGNED_SHORT:return b=h.getUint16(R,!0),I&&(b/=65535),b;case S.INT:return h.getInt32(R,!0);case S.UNSIGNED_INT:return h.getUint32(R,!0);case S.FLOAT:return h.getFloat32(R,!0);default:throw new Error("Invalid component type "+C)}},S.BYTE=5120,S.UNSIGNED_BYTE=5121,S.SHORT=5122,S.UNSIGNED_SHORT=5123,S.INT=5124,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.PositionKind="position",S.NormalKind="normal",S.TangentKind="tangent",S.UVKind="uv",S.UV2Kind="uv2",S.UV3Kind="uv3",S.UV4Kind="uv4",S.UV5Kind="uv5",S.UV6Kind="uv6",S.ColorKind="color",S.MatricesIndicesKind="matricesIndices",S.MatricesWeightsKind="matricesWeights",S.MatricesIndicesExtraKind="matricesIndicesExtra",S.MatricesWeightsExtraKind="matricesWeightsExtra",S}()},function(p,s,c){c.d(s,"a",function(){return R});var E=c(6),m=c(2),S=c(38),h=c(8),C=c(128),R=function(){function I(b,f,x,P,A,T,_,g,M,O){var N,V=this;P===void 0&&(P=null),T===void 0&&(T=null),_===void 0&&(_=null),g===void 0&&(g=null),M===void 0&&(M=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new E.c,this.onErrorObservable=new E.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=b;var U,L,j=null;if(f.attributes){var Y=f;if(this._engine=x,this._attributesNames=Y.attributes,this._uniformsNames=Y.uniformsNames.concat(Y.samplers),this._samplerList=Y.samplers.slice(),this.defines=Y.defines,this.onError=Y.onError,this.onCompiled=Y.onCompiled,this._fallbacks=Y.fallbacks,this._indexParameters=Y.indexParameters,this._transformFeedbackVaryings=Y.transformFeedbackVaryings||null,this._multiTarget=!!Y.multiTarget,Y.uniformBuffersNames){this._uniformBuffersNamesList=Y.uniformBuffersNames.slice();for(var W=0;W<Y.uniformBuffersNames.length;W++)this._uniformBuffersNames[Y.uniformBuffersNames[W]]=W}j=(N=Y.processFinalCode)!==null&&N!==void 0?N:null}else this._engine=A,this.defines=T??"",this._uniformsNames=x.concat(P),this._samplerList=P?P.slice():[],this._attributesNames=f,this._uniformBuffersNamesList=[],this.onError=M,this.onCompiled=g,this._indexParameters=O,this._fallbacks=_;this._attributeLocationByName={},this.uniqueId=I._uniqueIdSeed++;var ie=S.a.IsWindowObjectExist()?this._engine.getHostDocument():null;b.vertexSource?U="source:"+b.vertexSource:b.vertexElement?(U=ie?ie.getElementById(b.vertexElement):null)||(U=b.vertexElement):U=b.vertex||b,b.fragmentSource?L="source:"+b.fragmentSource:b.fragmentElement?(L=ie?ie.getElementById(b.fragmentElement):null)||(L=b.fragmentElement):L=b.fragment||b;var re={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:I.ShadersRepository,includesShadersStore:I.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(U,"Vertex","",function(ye){V._rawVertexSourceCode=ye,V._loadShader(L,"Fragment","Pixel",function(ve){V._rawFragmentSourceCode=ve,C.a.Process(ye,re,function(ue){j&&(ue=j("vertex",ue)),re.isFragment=!0,C.a.Process(ve,re,function(oe){j&&(oe=j("fragment",oe)),V._useFinalCode(ue,oe,b)},V._engine)},V._engine)})})}return Object.defineProperty(I.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new E.c),this._onBindObservable},enumerable:!1,configurable:!0}),I.prototype._useFinalCode=function(b,f,x){if(x){var P=x.vertexElement||x.vertex||x.spectorName||x,A=x.fragmentElement||x.fragment||x.spectorName||x;this._vertexSourceCode="#define SHADER_NAME vertex:"+P+`
`+b,this._fragmentSourceCode="#define SHADER_NAME fragment:"+A+`
`+f}else this._vertexSourceCode=b,this._fragmentSourceCode=f;this._prepareEffect()},Object.defineProperty(I.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),I.prototype.isReady=function(){try{return this._isReadyInternal()}catch(b){return!1}},I.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},I.prototype.getEngine=function(){return this._engine},I.prototype.getPipelineContext=function(){return this._pipelineContext},I.prototype.getAttributesNames=function(){return this._attributesNames},I.prototype.getAttributeLocation=function(b){return this._attributes[b]},I.prototype.getAttributeLocationByName=function(b){return this._attributeLocationByName[b]},I.prototype.getAttributesCount=function(){return this._attributes.length},I.prototype.getUniformIndex=function(b){return this._uniformsNames.indexOf(b)},I.prototype.getUniform=function(b){return this._uniforms[b]},I.prototype.getSamplers=function(){return this._samplerList},I.prototype.getUniformNames=function(){return this._uniformsNames},I.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},I.prototype.getIndexParameters=function(){return this._indexParameters},I.prototype.getCompilationError=function(){return this._compilationError},I.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},I.prototype.executeWhenCompiled=function(b){var f=this;this.isReady()?b(this):(this.onCompileObservable.add(function(x){b(x)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){f._checkIsReady(null)},16))},I.prototype._checkIsReady=function(b){var f=this;try{if(this._isReadyInternal())return}catch(x){return void this._processCompilationErrors(x,b)}setTimeout(function(){f._checkIsReady(b)},16)},I.prototype._loadShader=function(b,f,x,P){var A;if(typeof HTMLElement!="undefined"&&b instanceof HTMLElement)return void P(S.a.GetDOMTextContent(b));b.substr(0,7)!=="source:"?b.substr(0,7)!=="base64:"?I.ShadersStore[b+f+"Shader"]?P(I.ShadersStore[b+f+"Shader"]):x&&I.ShadersStore[b+x+"Shader"]?P(I.ShadersStore[b+x+"Shader"]):(A=b[0]==="."||b[0]==="/"||b.indexOf("http")>-1?b:I.ShadersRepository+b,this._engine._loadFile(A+"."+f.toLowerCase()+".fx",P)):P(window.atob(b.substr(7))):P(b.substr(7))},Object.defineProperty(I.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),I.prototype._rebuildProgram=function(b,f,x,P){var A=this;this._isReady=!1,this._vertexSourceCodeOverride=b,this._fragmentSourceCodeOverride=f,this.onError=function(T,_){P&&P(_)},this.onCompiled=function(){var T=A.getEngine().scenes;if(T)for(var _=0;_<T.length;_++)T[_].markAllMaterialsAsDirty(m.a.MATERIAL_AllDirtyFlag);A._pipelineContext._handlesSpectorRebuildCallback(x)},this._fallbacks=null,this._prepareEffect()},I.prototype._prepareEffect=function(){var b=this,f=this._attributesNames,x=this.defines;this._valueCache={};var P=this._pipelineContext;try{var A=this._engine;this._pipelineContext=A.createPipelineContext();var T=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?A._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,T,null,this._transformFeedbackVaryings):A._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,T,x,this._transformFeedbackVaryings),A._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(A.supportsUniformBuffers)for(var _ in b._uniformBuffersNames)b.bindUniformBlock(_,b._uniformBuffersNames[_]);var g;if(A.getUniforms(b._pipelineContext,b._uniformsNames).forEach(function(N,V){b._uniforms[b._uniformsNames[V]]=N}),b._attributes=A.getAttributes(b._pipelineContext,f),f)for(var M=0;M<f.length;M++){var O=f[M];b._attributeLocationByName[O]=b._attributes[M]}for(g=0;g<b._samplerList.length;g++)b.getUniform(b._samplerList[g])==null&&(b._samplerList.splice(g,1),g--);b._samplerList.forEach(function(N,V){b._samplers[N]=V}),A.bindSamplers(b),b._compilationError="",b._isReady=!0,b.onCompiled&&b.onCompiled(b),b.onCompileObservable.notifyObservers(b),b.onCompileObservable.clear(),b._fallbacks&&b._fallbacks.unBindMesh(),P&&b.getEngine()._deletePipelineContext(P)}),this._pipelineContext.isAsync&&this._checkIsReady(P)}catch(_){this._processCompilationErrors(_,P)}},I.prototype._getShaderCodeAndErrorLine=function(b,f,x){var P=x?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,A=null;if(f&&b){var T=f.match(P);if(T&&T.length===2){var _=parseInt(T[1]),g=b.split(`
`,-1);g.length>=_&&(A="Offending line ["+_+"] in "+(x?"fragment":"vertex")+" code: "+g[_-1])}}return[b,A]},I.prototype._processCompilationErrors=function(b,f){var x,P,A,T,_;f===void 0&&(f=null),this._compilationError=b.message;var g=this._attributesNames,M=this._fallbacks;if(h.a.Error("Unable to compile effect:"),h.a.Error("Uniforms: "+this._uniformsNames.map(function(U){return" "+U})),h.a.Error("Attributes: "+g.map(function(U){return" "+U})),h.a.Error(`Defines:\r
`+this.defines),I.LogShaderCodeOnCompilationError){var O=null,N=null,V=null;((A=this._pipelineContext)===null||A===void 0?void 0:A._getVertexShaderCode())&&(V=(x=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],O=x[1],V&&(h.a.Error("Vertex code:"),h.a.Error(V))),((T=this._pipelineContext)===null||T===void 0?void 0:T._getFragmentShaderCode())&&(V=(P=this._getShaderCodeAndErrorLine((_=this._pipelineContext)===null||_===void 0?void 0:_._getFragmentShaderCode(),this._compilationError,!0))[0],N=P[1],V&&(h.a.Error("Fragment code:"),h.a.Error(V))),O&&h.a.Error(O),N&&h.a.Error(N)}h.a.Error("Error: "+this._compilationError),f&&(this._pipelineContext=f,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),M?(this._pipelineContext=null,M.hasMoreFallbacks?(this._allFallbacksProcessed=!1,h.a.Error("Trying next fallback."),this.defines=M.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(I.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),I.prototype._bindTexture=function(b,f){this._engine._bindTexture(this._samplers[b],f)},I.prototype.setTexture=function(b,f){this._engine.setTexture(this._samplers[b],this._uniforms[b],f)},I.prototype.setDepthStencilTexture=function(b,f){this._engine.setDepthStencilTexture(this._samplers[b],this._uniforms[b],f)},I.prototype.setTextureArray=function(b,f){var x=b+"Ex";if(this._samplerList.indexOf(x+"0")===-1){for(var P=this._samplerList.indexOf(b),A=1;A<f.length;A++){var T=x+(A-1).toString();this._samplerList.splice(P+A,0,T)}for(var _=0,g=0,M=this._samplerList;g<M.length;g++){var O=M[g];this._samplers[O]=_,_+=1}}this._engine.setTextureArray(this._samplers[b],this._uniforms[b],f)},I.prototype.setTextureFromPostProcess=function(b,f){this._engine.setTextureFromPostProcess(this._samplers[b],f)},I.prototype.setTextureFromPostProcessOutput=function(b,f){this._engine.setTextureFromPostProcessOutput(this._samplers[b],f)},I.prototype._cacheMatrix=function(b,f){var x=this._valueCache[b],P=f.updateFlag;return(x===void 0||x!==P)&&(this._valueCache[b]=P,!0)},I.prototype._cacheFloat2=function(b,f,x){var P=this._valueCache[b];if(!P||P.length!==2)return P=[f,x],this._valueCache[b]=P,!0;var A=!1;return P[0]!==f&&(P[0]=f,A=!0),P[1]!==x&&(P[1]=x,A=!0),A},I.prototype._cacheFloat3=function(b,f,x,P){var A=this._valueCache[b];if(!A||A.length!==3)return A=[f,x,P],this._valueCache[b]=A,!0;var T=!1;return A[0]!==f&&(A[0]=f,T=!0),A[1]!==x&&(A[1]=x,T=!0),A[2]!==P&&(A[2]=P,T=!0),T},I.prototype._cacheFloat4=function(b,f,x,P,A){var T=this._valueCache[b];if(!T||T.length!==4)return T=[f,x,P,A],this._valueCache[b]=T,!0;var _=!1;return T[0]!==f&&(T[0]=f,_=!0),T[1]!==x&&(T[1]=x,_=!0),T[2]!==P&&(T[2]=P,_=!0),T[3]!==A&&(T[3]=A,_=!0),_},I.prototype.bindUniformBuffer=function(b,f){var x=this._uniformBuffersNames[f];x!==void 0&&I._baseCache[x]!==b&&(I._baseCache[x]=b,this._engine.bindUniformBufferBase(b,x))},I.prototype.bindUniformBlock=function(b,f){this._engine.bindUniformBlock(this._pipelineContext,b,f)},I.prototype.setInt=function(b,f){var x=this._valueCache[b];return x!==void 0&&x===f||this._engine.setInt(this._uniforms[b],f)&&(this._valueCache[b]=f),this},I.prototype.setIntArray=function(b,f){return this._valueCache[b]=null,this._engine.setIntArray(this._uniforms[b],f),this},I.prototype.setIntArray2=function(b,f){return this._valueCache[b]=null,this._engine.setIntArray2(this._uniforms[b],f),this},I.prototype.setIntArray3=function(b,f){return this._valueCache[b]=null,this._engine.setIntArray3(this._uniforms[b],f),this},I.prototype.setIntArray4=function(b,f){return this._valueCache[b]=null,this._engine.setIntArray4(this._uniforms[b],f),this},I.prototype.setFloatArray=function(b,f){return this._valueCache[b]=null,this._engine.setArray(this._uniforms[b],f),this},I.prototype.setFloatArray2=function(b,f){return this._valueCache[b]=null,this._engine.setArray2(this._uniforms[b],f),this},I.prototype.setFloatArray3=function(b,f){return this._valueCache[b]=null,this._engine.setArray3(this._uniforms[b],f),this},I.prototype.setFloatArray4=function(b,f){return this._valueCache[b]=null,this._engine.setArray4(this._uniforms[b],f),this},I.prototype.setArray=function(b,f){return this._valueCache[b]=null,this._engine.setArray(this._uniforms[b],f),this},I.prototype.setArray2=function(b,f){return this._valueCache[b]=null,this._engine.setArray2(this._uniforms[b],f),this},I.prototype.setArray3=function(b,f){return this._valueCache[b]=null,this._engine.setArray3(this._uniforms[b],f),this},I.prototype.setArray4=function(b,f){return this._valueCache[b]=null,this._engine.setArray4(this._uniforms[b],f),this},I.prototype.setMatrices=function(b,f){return f?(this._valueCache[b]=null,this._engine.setMatrices(this._uniforms[b],f),this):this},I.prototype.setMatrix=function(b,f){return this._cacheMatrix(b,f)&&(this._engine.setMatrices(this._uniforms[b],f.toArray())||(this._valueCache[b]=null)),this},I.prototype.setMatrix3x3=function(b,f){return this._valueCache[b]=null,this._engine.setMatrix3x3(this._uniforms[b],f),this},I.prototype.setMatrix2x2=function(b,f){return this._valueCache[b]=null,this._engine.setMatrix2x2(this._uniforms[b],f),this},I.prototype.setFloat=function(b,f){var x=this._valueCache[b];return x!==void 0&&x===f||this._engine.setFloat(this._uniforms[b],f)&&(this._valueCache[b]=f),this},I.prototype.setBool=function(b,f){var x=this._valueCache[b];return x!==void 0&&x===f||this._engine.setInt(this._uniforms[b],f?1:0)&&(this._valueCache[b]=f),this},I.prototype.setVector2=function(b,f){return this._cacheFloat2(b,f.x,f.y)&&(this._engine.setFloat2(this._uniforms[b],f.x,f.y)||(this._valueCache[b]=null)),this},I.prototype.setFloat2=function(b,f,x){return this._cacheFloat2(b,f,x)&&(this._engine.setFloat2(this._uniforms[b],f,x)||(this._valueCache[b]=null)),this},I.prototype.setVector3=function(b,f){return this._cacheFloat3(b,f.x,f.y,f.z)&&(this._engine.setFloat3(this._uniforms[b],f.x,f.y,f.z)||(this._valueCache[b]=null)),this},I.prototype.setFloat3=function(b,f,x,P){return this._cacheFloat3(b,f,x,P)&&(this._engine.setFloat3(this._uniforms[b],f,x,P)||(this._valueCache[b]=null)),this},I.prototype.setVector4=function(b,f){return this._cacheFloat4(b,f.x,f.y,f.z,f.w)&&(this._engine.setFloat4(this._uniforms[b],f.x,f.y,f.z,f.w)||(this._valueCache[b]=null)),this},I.prototype.setFloat4=function(b,f,x,P,A){return this._cacheFloat4(b,f,x,P,A)&&(this._engine.setFloat4(this._uniforms[b],f,x,P,A)||(this._valueCache[b]=null)),this},I.prototype.setColor3=function(b,f){return this._cacheFloat3(b,f.r,f.g,f.b)&&(this._engine.setFloat3(this._uniforms[b],f.r,f.g,f.b)||(this._valueCache[b]=null)),this},I.prototype.setColor4=function(b,f,x){return this._cacheFloat4(b,f.r,f.g,f.b,x)&&(this._engine.setFloat4(this._uniforms[b],f.r,f.g,f.b,x)||(this._valueCache[b]=null)),this},I.prototype.setDirectColor4=function(b,f){return this._cacheFloat4(b,f.r,f.g,f.b,f.a)&&(this._engine.setFloat4(this._uniforms[b],f.r,f.g,f.b,f.a)||(this._valueCache[b]=null)),this},I.prototype.dispose=function(){this._engine._releaseEffect(this)},I.RegisterShader=function(b,f,x){f&&(I.ShadersStore[b+"PixelShader"]=f),x&&(I.ShadersStore[b+"VertexShader"]=x)},I.ResetCache=function(){I._baseCache={}},I.ShadersRepository="src/Shaders/",I.LogShaderCodeOnCompilationError=!0,I._uniqueIdSeed=0,I._baseCache={},I.ShadersStore={},I.IncludesShadersStore={},I}()},function(p,s,c){c.d(s,"a",function(){return E}),c.d(s,"d",function(){return m}),c.d(s,"b",function(){return S}),c.d(s,"c",function(){return h});var E=function(){function C(R,I,b,f){I===void 0&&(I=!1),this.initalize(R,I,b,f)}return C.prototype.initalize=function(R,I,b,f){return I===void 0&&(I=!1),this.mask=R,this.skipNextObservers=I,this.target=b,this.currentTarget=f,this},C}(),m=function(C,R,I){I===void 0&&(I=null),this.callback=C,this.mask=R,this.scope=I,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},S=function(){function C(){}return C.prototype.dispose=function(){if(this._observers&&this._observables)for(var R=0;R<this._observers.length;R++)this._observables[R].remove(this._observers[R]);this._observers=null,this._observables=null},C.Watch=function(R,I,b,f){b===void 0&&(b=-1),f===void 0&&(f=null);var x=new C;x._observers=new Array,x._observables=R;for(var P=0,A=R;P<A.length;P++){var T=A[P].add(I,b,!1,f);T&&x._observers.push(T)}return x},C}(),h=function(){function C(R){this._observers=new Array,this._eventState=new E(0),R&&(this._onObserverAdded=R)}return Object.defineProperty(C.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),C.prototype.add=function(R,I,b,f,x){if(I===void 0&&(I=-1),b===void 0&&(b=!1),f===void 0&&(f=null),x===void 0&&(x=!1),!R)return null;var P=new m(R,I,f);return P.unregisterOnNextCall=x,b?this._observers.unshift(P):this._observers.push(P),this._onObserverAdded&&this._onObserverAdded(P),P},C.prototype.addOnce=function(R){return this.add(R,void 0,void 0,void 0,!0)},C.prototype.remove=function(R){return!!R&&this._observers.indexOf(R)!==-1&&(this._deferUnregister(R),!0)},C.prototype.removeCallback=function(R,I){for(var b=0;b<this._observers.length;b++){var f=this._observers[b];if(!f._willBeUnregistered&&f.callback===R&&(!I||I===f.scope))return this._deferUnregister(f),!0}return!1},C.prototype._deferUnregister=function(R){var I=this;R.unregisterOnNextCall=!1,R._willBeUnregistered=!0,setTimeout(function(){I._remove(R)},0)},C.prototype._remove=function(R){if(!R)return!1;var I=this._observers.indexOf(R);return I!==-1&&(this._observers.splice(I,1),!0)},C.prototype.makeObserverTopPriority=function(R){this._remove(R),this._observers.unshift(R)},C.prototype.makeObserverBottomPriority=function(R){this._remove(R),this._observers.push(R)},C.prototype.notifyObservers=function(R,I,b,f,x){if(I===void 0&&(I=-1),!this._observers.length)return!0;var P=this._eventState;P.mask=I,P.target=b,P.currentTarget=f,P.skipNextObservers=!1,P.lastReturnValue=R,P.userInfo=x;for(var A=0,T=this._observers;A<T.length;A++){var _=T[A];if(!_._willBeUnregistered&&(_.mask&I&&(_.scope?P.lastReturnValue=_.callback.apply(_.scope,[R,P]):P.lastReturnValue=_.callback(R,P),_.unregisterOnNextCall&&this._deferUnregister(_)),P.skipNextObservers))return!1}return!0},C.prototype.notifyObserversWithPromise=function(R,I,b,f,x){var P=this;I===void 0&&(I=-1);var A=Promise.resolve(R);if(!this._observers.length)return A;var T=this._eventState;return T.mask=I,T.target=b,T.currentTarget=f,T.skipNextObservers=!1,T.userInfo=x,this._observers.forEach(function(_){T.skipNextObservers||_._willBeUnregistered||_.mask&I&&(A=_.scope?A.then(function(g){return T.lastReturnValue=g,_.callback.apply(_.scope,[R,T])}):A.then(function(g){return T.lastReturnValue=g,_.callback(R,T)}),_.unregisterOnNextCall&&P._deferUnregister(_))}),A.then(function(){return R})},C.prototype.notifyObserver=function(R,I,b){b===void 0&&(b=-1);var f=this._eventState;f.mask=b,f.skipNextObservers=!1,R.callback(I,f)},C.prototype.hasObservers=function(){return this._observers.length>0},C.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},C.prototype.clone=function(){var R=new C;return R._observers=this._observers.slice(0),R},C.prototype.hasSpecificMask=function(R){R===void 0&&(R=-1);for(var I=0,b=this._observers;I<b.length;I++){var f=b[I];if(f.mask&R||f.mask===R)return!0}return!1},C}()},function(p,s,c){c.d(s,"b",function(){return re}),c.d(s,"c",function(){return ve}),c.d(s,"a",function(){return Z});var E=c(1),m=c(6),S=c(12),h=c(41),C=c(37),R=c(0),I=c(9),b=c(29),f=c(4),x=c(16),P=c(71),A=c(31),T=c(61),_=c(43),g=c(25),M=c(68),O=c(69),N=c(2),V=c(3),U=c(8),L=c(11),j=c(21),Y=c(17),W=c(149),ie=c(70),re=function(){},ye=function(){this.visibleInstances={},this.batchCache=new ve,this.instancesBufferSize=2048},ve=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},ue=function(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=512,this.boundingVectors=[],this.worldMatrices=null},oe=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},Z=function(J){function B(G,$,he,se,q,H){$===void 0&&($=null),he===void 0&&(he=null),se===void 0&&(se=null),H===void 0&&(H=!0);var X=J.call(this,G,$)||this;if(X._internalMeshDataInfo=new oe,X.delayLoadState=N.a.DELAYLOADSTATE_NONE,X.instances=new Array,X._creationDataStorage=null,X._geometry=null,X._instanceDataStorage=new ye,X._thinInstanceDataStorage=new ue,X._effectiveMaterial=null,X._shouldGenerateFlatShading=!1,X._originalBuilderSideOrientation=B.DEFAULTSIDE,X.overrideMaterialSideOrientation=null,$=X.getScene(),se){if(se._geometry&&se._geometry.applyToMesh(X),h.a.DeepCopy(se,X,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),X._internalMeshDataInfo._source=se,$.useClonedMeshMap&&(se._internalMeshDataInfo.meshMap||(se._internalMeshDataInfo.meshMap={}),se._internalMeshDataInfo.meshMap[X.uniqueId]=X),X._originalBuilderSideOrientation=se._originalBuilderSideOrientation,X._creationDataStorage=se._creationDataStorage,se._ranges){var ee=se._ranges;for(var G in ee)ee.hasOwnProperty(G)&&ee[G]&&X.createAnimationRange(G,ee[G].from,ee[G].to)}var Q;if(se.metadata&&se.metadata.clone?X.metadata=se.metadata.clone():X.metadata=se.metadata,C.a&&C.a.HasTags(se)&&C.a.AddTagsTo(X,C.a.GetTags(se,!0)),X.setEnabled(se.isEnabled()),X.parent=se.parent,X.setPivotMatrix(se.getPivotMatrix()),X.id=G+"."+se.id,X.material=se.material,!q)for(var te=se.getDescendants(!0),ge=0;ge<te.length;ge++){var ce=te[ge];ce.clone&&ce.clone(G+"."+ce.name,X)}if(se.morphTargetManager&&(X.morphTargetManager=se.morphTargetManager),$.getPhysicsEngine){var de=$.getPhysicsEngine();if(H&&de){var ne=de.getImpostorForPhysicsObject(se);ne&&(X.physicsImpostor=ne.clone(X))}}for(Q=0;Q<$.particleSystems.length;Q++){var pe=$.particleSystems[Q];pe.emitter===se&&pe.clone(pe.name,X)}X.refreshBoundingInfo(),X.computeWorldMatrix(!0)}return he!==null&&(X.parent=he),X._instanceDataStorage.hardwareInstancedRendering=X.getEngine().getCaps().instancedArrays,X}return Object(E.d)(B,J),B._GetDefaultSideOrientation=function(G){return G||B.FRONTSIDE},Object.defineProperty(B.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(G&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(f.b.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(f.b.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new m.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new m.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new m.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new m.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"onBeforeDraw",{set:function(G){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(G)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"hasThinInstances",{get:function(){var G;return((G=this._thinInstanceDataStorage.instancesCount)!==null&&G!==void 0?G:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(G){this._internalMeshDataInfo._morphTargetManager!==G&&(this._internalMeshDataInfo._morphTargetManager=G,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(G){this._unIndexed!==G&&(this._unIndexed=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(G){this._instanceDataStorage.manualUpdate=G},enumerable:!1,configurable:!0}),B.prototype.instantiateHierarchy=function(G,$,he){G===void 0&&(G=null);var se=!(this.getTotalVertices()>0)||$&&$.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),G||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));se&&(se.parent=G||this.parent,se.position=this.position.clone(),se.scaling=this.scaling.clone(),this.rotationQuaternion?se.rotationQuaternion=this.rotationQuaternion.clone():se.rotation=this.rotation.clone(),he&&he(this,se));for(var q=0,H=this.getChildTransformNodes(!0);q<H.length;q++)H[q].instantiateHierarchy(se,$,he);return se},B.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(B.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),B.prototype.toString=function(G){var $=J.prototype.toString.call(this,G);if($+=", n vertices: "+this.getTotalVertices(),$+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var he=0;he<this.animations.length;he++)$+=", animation[0]: "+this.animations[he].toString(G);if(G)if(this._geometry){var se=this.getIndices(),q=this.getVerticesData(f.b.PositionKind);q&&se&&($+=", flat shading: "+(q.length/3===se.length?"YES":"NO"))}else $+=", flat shading: UNKNOWN";return $},B.prototype._unBindEffect=function(){J.prototype._unBindEffect.call(this);for(var G=0,$=this.instances;G<$.length;G++)$[G]._unBindEffect()},Object.defineProperty(B.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),B.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},B.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(G,$){return G.distance<$.distance?1:G.distance>$.distance?-1:0})},B.prototype.addLODLevel=function(G,$){if($&&$._masterMesh)return U.a.Warn("You cannot use a mesh as LOD level twice"),this;var he=new W.a(G,$);return this._internalMeshDataInfo._LODLevels.push(he),$&&($._masterMesh=this),this._sortLODLevels(),this},B.prototype.getLODLevelAtDistance=function(G){for(var $=this._internalMeshDataInfo,he=0;he<$._LODLevels.length;he++){var se=$._LODLevels[he];if(se.distance===G)return se.mesh}return null},B.prototype.removeLODLevel=function(G){for(var $=this._internalMeshDataInfo,he=0;he<$._LODLevels.length;he++)$._LODLevels[he].mesh===G&&($._LODLevels.splice(he,1),G&&(G._masterMesh=null));return this._sortLODLevels(),this},B.prototype.getLOD=function(G,$){var he,se=this._internalMeshDataInfo;if(!se._LODLevels||se._LODLevels.length===0)return this;$?he=$:he=this.getBoundingInfo().boundingSphere;var q=he.centerWorld.subtract(G.globalPosition).length();if(se._LODLevels[se._LODLevels.length-1].distance>q)return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,this),this;for(var H=0;H<se._LODLevels.length;H++){var X=se._LODLevels[H];if(X.distance<q){if(X.mesh){if(X.mesh.delayLoadState===N.a.DELAYLOADSTATE_NOTLOADED)return X.mesh._checkDelayState(),this;if(X.mesh.delayLoadState===N.a.DELAYLOADSTATE_LOADING)return this;X.mesh._preActivate(),X.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,X.mesh),X.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(q,this,this),this},Object.defineProperty(B.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),B.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},B.prototype.getVerticesData=function(G,$,he){return this._geometry?this._geometry.getVerticesData(G,$,he):null},B.prototype.getVertexBuffer=function(G){return this._geometry?this._geometry.getVertexBuffer(G):null},B.prototype.isVerticesDataPresent=function(G){return this._geometry?this._geometry.isVerticesDataPresent(G):!!this._delayInfo&&this._delayInfo.indexOf(G)!==-1},B.prototype.isVertexBufferUpdatable=function(G){return this._geometry?this._geometry.isVertexBufferUpdatable(G):!!this._delayInfo&&this._delayInfo.indexOf(G)!==-1},B.prototype.getVerticesDataKinds=function(){if(!this._geometry){var G=new Array;return this._delayInfo&&this._delayInfo.forEach(function($){G.push($)}),G}return this._geometry.getVerticesDataKinds()},B.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},B.prototype.getIndices=function(G,$){return this._geometry?this._geometry.getIndices(G,$):[]},Object.defineProperty(B.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),B.prototype.isReady=function(G,$){var he,se,q,H,X,ee;if(G===void 0&&(G=!1),$===void 0&&($=!1),this.delayLoadState===N.a.DELAYLOADSTATE_LOADING||!J.prototype.isReady.call(this,G))return!1;if(!this.subMeshes||this.subMeshes.length===0||!G)return!0;var Q=this.getEngine(),te=this.getScene(),ge=$||Q.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var ce=this.material||te.defaultMaterial;if(ce){if(ce._storeEffectOnSubMeshes)for(var de=0,ne=this.subMeshes;de<ne.length;de++){var pe=(Ye=ne[de]).getMaterial();if(pe){if(pe._storeEffectOnSubMeshes){if(!pe.isReadyForSubMesh(this,Ye,ge))return!1}else if(!pe.isReady(this,ge))return!1}}else if(!ce.isReady(this,ge))return!1}for(var Se=0,Te=this.lightSources;Se<Te.length;Se++){var Ne=Te[Se].getShadowGenerator();if(Ne&&(!((he=Ne.getShadowMap())===null||he===void 0?void 0:he.renderList)||((se=Ne.getShadowMap())===null||se===void 0?void 0:se.renderList)&&((H=(q=Ne.getShadowMap())===null||q===void 0?void 0:q.renderList)===null||H===void 0?void 0:H.indexOf(this))!==-1))for(var je=0,Xe=this.subMeshes;je<Xe.length;je++){var Ye=Xe[je];if(!Ne.isReady(Ye,ge,(ee=(X=Ye.getMaterial())===null||X===void 0?void 0:X.needAlphaBlendingForMesh(this))!==null&&ee!==void 0&&ee))return!1}}for(var Ke=0,nt=this._internalMeshDataInfo._LODLevels;Ke<nt.length;Ke++){var qe=nt[Ke];if(qe.mesh&&!qe.mesh.isReady(ge))return!1}return!0},Object.defineProperty(B.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),B.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},B.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(B.prototype,"overridenInstanceCount",{set:function(G){this._instanceDataStorage.overridenInstanceCount=G},enumerable:!1,configurable:!0}),B.prototype._preActivate=function(){var G=this._internalMeshDataInfo,$=this.getScene().getRenderId();return G._preActivateId===$||(G._preActivateId=$,this._instanceDataStorage.visibleInstances=null),this},B.prototype._preActivateForIntermediateRendering=function(G){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=G),this},B.prototype._registerInstanceForRenderId=function(G,$){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:$,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[$]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=$,this._instanceDataStorage.visibleInstances[$]=new Array),this._instanceDataStorage.visibleInstances[$].push(G),this},B.prototype._afterComputeWorldMatrix=function(){J.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},B.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},B.prototype.refreshBoundingInfo=function(G){if(G===void 0&&(G=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var $=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(G),$),this},B.prototype._createGlobalSubMesh=function(G){var $=this.getTotalVertices();if(!$||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var he=this.getIndices();if(!he)return null;var se=he.length,q=!1;if(G)q=!0;else for(var H=0,X=this.subMeshes;H<X.length;H++){var ee=X[H];if(ee.indexStart+ee.indexCount>se){q=!0;break}if(ee.verticesStart+ee.verticesCount>$){q=!0;break}}if(!q)return this.subMeshes[0]}return this.releaseSubMeshes(),new T.a(0,0,$,0,this.getTotalIndices(),this)},B.prototype.subdivide=function(G){if(!(G<1)){for(var $=this.getTotalIndices(),he=$/G|0,se=0;he%3!=0;)he++;this.releaseSubMeshes();for(var q=0;q<G&&!(se>=$);q++)T.a.CreateFromIndices(0,se,q===G-1?$-se:he,this),se+=he;this.synchronizeInstances()}},B.prototype.setVerticesData=function(G,$,he,se){if(he===void 0&&(he=!1),this._geometry)this._geometry.setVerticesData(G,$,he,se);else{var q=new x.a;q.set($,G);var H=this.getScene();new P.a(P.a.RandomId(),H,q,he,this)}return this},B.prototype.removeVerticesData=function(G){this._geometry&&this._geometry.removeVerticesData(G)},B.prototype.markVerticesDataAsUpdatable=function(G,$){$===void 0&&($=!0);var he=this.getVertexBuffer(G);he&&he.isUpdatable()!==$&&this.setVerticesData(G,this.getVerticesData(G),$)},B.prototype.setVerticesBuffer=function(G){return this._geometry||(this._geometry=P.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(G),this},B.prototype.updateVerticesData=function(G,$,he,se){return this._geometry?(se?(this.makeGeometryUnique(),this.updateVerticesData(G,$,he,!1)):this._geometry.updateVerticesData(G,$,he),this):this},B.prototype.updateMeshPositions=function(G,$){$===void 0&&($=!0);var he=this.getVerticesData(f.b.PositionKind);if(!he)return this;if(G(he),this.updateVerticesData(f.b.PositionKind,he,!1,!1),$){var se=this.getIndices(),q=this.getVerticesData(f.b.NormalKind);if(!q)return this;x.a.ComputeNormals(he,se,q),this.updateVerticesData(f.b.NormalKind,q,!1,!1)}return this},B.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var G=this._geometry,$=this._geometry.copy(P.a.RandomId());return G.releaseForMesh(this,!0),$.applyToMesh(this),this},B.prototype.setIndices=function(G,$,he){if($===void 0&&($=null),he===void 0&&(he=!1),this._geometry)this._geometry.setIndices(G,$,he);else{var se=new x.a;se.indices=G;var q=this.getScene();new P.a(P.a.RandomId(),q,se,he,this)}return this},B.prototype.updateIndices=function(G,$,he){return he===void 0&&(he=!1),this._geometry?(this._geometry.updateIndices(G,$,he),this):this},B.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},B.prototype._bind=function(G,$,he){if(!this._geometry)return this;var se,q=this.getScene().getEngine();if(this._unIndexed)se=null;else switch(he){case g.a.PointFillMode:se=null;break;case g.a.WireFrameFillMode:se=G._getLinesIndexBuffer(this.getIndices(),q);break;default:case g.a.TriangleFillMode:se=this._geometry.getIndexBuffer()}return this._geometry._bind($,se),this},B.prototype._draw=function(G,$,he){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var se=this.getScene().getEngine();return this._unIndexed||$==g.a.PointFillMode?se.drawArraysType($,G.verticesStart,G.verticesCount,he):$==g.a.WireFrameFillMode?se.drawElementsType($,0,G._linesIndexCount,he):se.drawElementsType($,G.indexStart,G.indexCount,he),this},B.prototype.registerBeforeRender=function(G){return this.onBeforeRenderObservable.add(G),this},B.prototype.unregisterBeforeRender=function(G){return this.onBeforeRenderObservable.removeCallback(G),this},B.prototype.registerAfterRender=function(G){return this.onAfterRenderObservable.add(G),this},B.prototype.unregisterAfterRender=function(G){return this.onAfterRenderObservable.removeCallback(G),this},B.prototype._getInstancesRenderList=function(G,$){if($===void 0&&($=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var he=this.getScene(),se=he._isInIntermediateRendering(),q=se?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,H=this._instanceDataStorage.batchCache;if(H.mustReturn=!1,H.renderSelf[G]=$||!q&&this.isEnabled()&&this.isVisible,H.visibleInstances[G]=null,this._instanceDataStorage.visibleInstances&&!$){var X=this._instanceDataStorage.visibleInstances,ee=he.getRenderId(),Q=se?X.intermediateDefaultRenderId:X.defaultRenderId;H.visibleInstances[G]=X[ee],!H.visibleInstances[G]&&Q&&(H.visibleInstances[G]=X[Q])}return H.hardwareInstancedRendering[G]=!$&&this._instanceDataStorage.hardwareInstancedRendering&&H.visibleInstances[G]!==null&&H.visibleInstances[G]!==void 0,this._instanceDataStorage.previousBatch=H,H},B.prototype._renderWithInstances=function(G,$,he,se,q){var H=he.visibleInstances[G._id];if(!H)return this;for(var X=this._instanceDataStorage,ee=X.instancesBufferSize,Q=X.instancesBuffer,te=16*(H.length+1)*4;X.instancesBufferSize<te;)X.instancesBufferSize*=2;X.instancesData&&ee==X.instancesBufferSize||(X.instancesData=new Float32Array(X.instancesBufferSize/4));var ge=0,ce=0,de=he.renderSelf[G._id],ne=!Q||ee!==X.instancesBufferSize;if(this._instanceDataStorage.manualUpdate||X.isFrozen&&!ne)ce=(de?1:0)+H.length;else{var pe=this._effectiveMesh.getWorldMatrix();if(de&&(pe.copyToArray(X.instancesData,ge),ge+=16,ce++),H)for(var Se=0;Se<H.length;Se++)H[Se].getWorldMatrix().copyToArray(X.instancesData,ge),ge+=16,ce++}return ne?(Q&&Q.dispose(),Q=new f.a(q,X.instancesData,!0,16,!1,!0),X.instancesBuffer=Q,this.setVerticesBuffer(Q.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(Q.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(Q.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(Q.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||Q.updateDirectly(X.instancesData,0,ce),this._processInstancedBuffers(H,de),this.getScene()._activeIndices.addCount(G.indexCount*ce,!1),this._bind(G,se,$),this._draw(G,$,ce),q.unbindInstanceAttributes(),this},B.prototype._renderWithThinInstances=function(G,$,he,se){var q,H,X=(H=(q=this._thinInstanceDataStorage)===null||q===void 0?void 0:q.instancesCount)!==null&&H!==void 0?H:0;this.getScene()._activeIndices.addCount(G.indexCount*X,!1),this._bind(G,he,$),this._draw(G,$,X),se.unbindInstanceAttributes()},B.prototype._processInstancedBuffers=function(G,$){},B.prototype._processRendering=function(G,$,he,se,q,H,X,ee){var Q=this.getScene(),te=Q.getEngine();if(H&&$.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances($,se,he,te),this;if(H)this._renderWithInstances($,se,q,he,te);else{var ge=0;q.renderSelf[$._id]&&(X&&X(!1,G._effectiveMesh.getWorldMatrix(),ee),ge++,this._draw($,se,this._instanceDataStorage.overridenInstanceCount));var ce=q.visibleInstances[$._id];if(ce){var de=ce.length;ge+=de;for(var ne=0;ne<de;ne++){var pe=ce[ne].getWorldMatrix();X&&X(!0,pe,ee),this._draw($,se)}}Q._activeIndices.addCount($.indexCount*ge,!1)}return this},B.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),J.prototype._rebuild.call(this)},B.prototype._freeze=function(){if(this.subMeshes){for(var G=0;G<this.subMeshes.length;G++)this._getInstancesRenderList(G);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},B.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},B.prototype.render=function(G,$,he){var se=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var q=this._getInstancesRenderList(G._id,!!he);if(q.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var H,X=se.getEngine(),ee=q.hardwareInstancedRendering[G._id]||G.getRenderingMesh().hasThinInstances,Q=this._instanceDataStorage,te=G.getMaterial();if(!te)return this;if(!Q.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==te){if(te._storeEffectOnSubMeshes){if(!te.isReadyForSubMesh(this,G,ee))return this}else if(!te.isReady(this,ee))return this;this._effectiveMaterial=te}$&&X.setAlphaMode(this._effectiveMaterial.alphaMode),H=this._effectiveMaterial._storeEffectOnSubMeshes?G.effect:this._effectiveMaterial.getEffect();for(var ge=0,ce=se._beforeRenderingMeshStage;ge<ce.length;ge++)ce[ge].action(this,G,q,H);if(!H)return this;var de,ne=he||this._effectiveMesh;if(Q.isFrozen||!this._effectiveMaterial.backFaceCulling&&this.overrideMaterialSideOrientation===null)de=Q.sideOrientation;else{var pe=ne._getWorldMatrixDeterminant();(de=this.overrideMaterialSideOrientation)==null&&(de=this._effectiveMaterial.sideOrientation),pe<0&&(de=de===g.a.ClockWiseSideOrientation?g.a.CounterClockWiseSideOrientation:g.a.ClockWiseSideOrientation),Q.sideOrientation=de}var Se=this._effectiveMaterial._preBind(H,de);this._effectiveMaterial.forceDepthWrite&&X.setDepthWrite(!0);var Te=se.forcePointsCloud?g.a.PointFillMode:se.forceWireframe?g.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),ee||this._bind(G,H,Te);var Ne=ne.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(Ne,this,G):this._effectiveMaterial.bind(Ne,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(X.setState(!0,this._effectiveMaterial.zOffset,!1,!Se),this._processRendering(this,G,H,Te,q,ee,this._onBeforeDraw,this._effectiveMaterial),X.setState(!0,this._effectiveMaterial.zOffset,!1,Se)),this._processRendering(this,G,H,Te,q,ee,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var je=0,Xe=se._afterRenderingMeshStage;je<Xe.length;je++)Xe[je].action(this,G,q,H);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},B.prototype._onBeforeDraw=function(G,$,he){G&&he&&he.bindOnlyWorldMatrix($)},B.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(f.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(f.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},B.prototype.normalizeSkinFourWeights=function(){for(var G=this.getVerticesData(f.b.MatricesWeightsKind),$=G.length,he=0;he<$;he+=4){var se=G[he]+G[he+1]+G[he+2]+G[he+3];if(se===0)G[he]=1;else{var q=1/se;G[he]*=q,G[he+1]*=q,G[he+2]*=q,G[he+3]*=q}}this.setVerticesData(f.b.MatricesWeightsKind,G)},B.prototype.normalizeSkinWeightsAndExtra=function(){for(var G=this.getVerticesData(f.b.MatricesWeightsExtraKind),$=this.getVerticesData(f.b.MatricesWeightsKind),he=$.length,se=0;se<he;se+=4){var q=$[se]+$[se+1]+$[se+2]+$[se+3];if((q+=G[se]+G[se+1]+G[se+2]+G[se+3])===0)$[se]=1;else{var H=1/q;$[se]*=H,$[se+1]*=H,$[se+2]*=H,$[se+3]*=H,G[se]*=H,G[se+1]*=H,G[se+2]*=H,G[se+3]*=H}}this.setVerticesData(f.b.MatricesWeightsKind,$),this.setVerticesData(f.b.MatricesWeightsKind,G)},B.prototype.validateSkinning=function(){var G=this.getVerticesData(f.b.MatricesWeightsExtraKind),$=this.getVerticesData(f.b.MatricesWeightsKind);if($===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var he=$.length,se=0,q=0,H=0,X=0,ee=G===null?4:8,Q=new Array,te=0;te<=ee;te++)Q[te]=0;for(te=0;te<he;te+=4){for(var ge=$[te],ce=ge,de=ce===0?0:1,ne=1;ne<ee;ne++){var pe=ne<4?$[te+ne]:G[te+ne-4];pe>ge&&se++,pe!==0&&de++,ce+=pe,ge=pe}if(Q[de]++,de>H&&(H=de),ce===0)q++;else{var Se=1/ce,Te=0;for(ne=0;ne<ee;ne++)Te+=ne<4?Math.abs($[te+ne]-$[te+ne]*Se):Math.abs(G[te+ne-4]-G[te+ne-4]*Se);Te>.001&&X++}}var Ne=this.skeleton.bones.length,je=this.getVerticesData(f.b.MatricesIndicesKind),Xe=this.getVerticesData(f.b.MatricesIndicesExtraKind),Ye=0;for(te=0;te<he;te+=4)for(ne=0;ne<ee;ne++){var Ke=ne<4?je[te+ne]:Xe[te+ne-4];(Ke>=Ne||Ke<0)&&Ye++}return{skinned:!0,valid:q===0&&X===0&&Ye===0,report:"Number of Weights = "+he/4+`
Maximum influences = `+H+`
Missing Weights = `+q+`
Not Sorted = `+se+`
Not Normalized = `+X+`
WeightCounts = [`+Q+`]
Number of bones = `+Ne+`
Bad Bone Indices = `+Ye}},B.prototype._checkDelayState=function(){var G=this.getScene();return this._geometry?this._geometry.load(G):this.delayLoadState===N.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=N.a.DELAYLOADSTATE_LOADING,this._queueLoad(G)),this},B.prototype._queueLoad=function(G){var $=this;G._addPendingData(this);var he=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return S.b.LoadFile(this.delayLoadingFile,function(se){se instanceof ArrayBuffer?$._delayLoadingFunction(se,$):$._delayLoadingFunction(JSON.parse(se),$),$.instances.forEach(function(q){q.refreshBoundingInfo(),q._syncSubMeshes()}),$.delayLoadState=N.a.DELAYLOADSTATE_LOADED,G._removePendingData($)},function(){},G.offlineProvider,he),this},B.prototype.isInFrustum=function(G){return this.delayLoadState!==N.a.DELAYLOADSTATE_LOADING&&!!J.prototype.isInFrustum.call(this,G)&&(this._checkDelayState(),!0)},B.prototype.setMaterialByID=function(G){var $,he=this.getScene().materials;for($=he.length-1;$>-1;$--)if(he[$].id===G)return this.material=he[$],this;var se=this.getScene().multiMaterials;for($=se.length-1;$>-1;$--)if(se[$].id===G)return this.material=se[$],this;return this},B.prototype.getAnimatables=function(){var G=new Array;return this.material&&G.push(this.material),this.skeleton&&G.push(this.skeleton),G},B.prototype.bakeTransformIntoVertices=function(G){if(!this.isVerticesDataPresent(f.b.PositionKind))return this;var $=this.subMeshes.splice(0);this._resetPointsArrayCache();var he,se=this.getVerticesData(f.b.PositionKind),q=new Array;for(he=0;he<se.length;he+=3)R.e.TransformCoordinates(R.e.FromArray(se,he),G).toArray(q,he);if(this.setVerticesData(f.b.PositionKind,q,this.getVertexBuffer(f.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(f.b.NormalKind)){for(se=this.getVerticesData(f.b.NormalKind),q=[],he=0;he<se.length;he+=3)R.e.TransformNormal(R.e.FromArray(se,he),G).normalize().toArray(q,he);this.setVerticesData(f.b.NormalKind,q,this.getVertexBuffer(f.b.NormalKind).isUpdatable())}return G.m[0]*G.m[5]*G.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=$,this},B.prototype.bakeCurrentTransformIntoVertices=function(G){return G===void 0&&(G=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(G),this},Object.defineProperty(B.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),B.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},B.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},B.prototype.clone=function(G,$,he,se){return G===void 0&&(G=""),$===void 0&&($=null),se===void 0&&(se=!0),new B(G,this.getScene(),$,this,he,se)},B.prototype.dispose=function(G,$){$===void 0&&($=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var he=this._internalMeshDataInfo;if(he._onBeforeDrawObservable&&he._onBeforeDrawObservable.clear(),he._onBeforeBindObservable&&he._onBeforeBindObservable.clear(),he._onBeforeRenderObservable&&he._onBeforeRenderObservable.clear(),he._onAfterRenderObservable&&he._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(he.meshMap)for(var se in he.meshMap)(X=he.meshMap[se])&&(X._internalMeshDataInfo._source=null,he.meshMap[se]=void 0);he._source&&he._source._internalMeshDataInfo.meshMap&&(he._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var q=0,H=this.getScene().meshes;q<H.length;q++){var X;(X=H[q])._internalMeshDataInfo&&X._internalMeshDataInfo._source&&X._internalMeshDataInfo._source===this&&(X._internalMeshDataInfo._source=null)}he._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),J.prototype.dispose.call(this,G,$)},B.prototype._disposeInstanceSpecificData=function(){},B.prototype._disposeThinInstanceSpecificData=function(){},B.prototype.applyDisplacementMap=function(G,$,he,se,q,H,X){var ee=this;X===void 0&&(X=!1);var Q=this.getScene();return S.b.LoadImage(G,function(te){var ge=te.width,ce=te.height,de=ie.a.CreateCanvas(ge,ce).getContext("2d");de.drawImage(te,0,0);var ne=de.getImageData(0,0,ge,ce).data;ee.applyDisplacementMapFromBuffer(ne,ge,ce,$,he,q,H,X),se&&se(ee)},function(){},Q.offlineProvider),this},B.prototype.applyDisplacementMapFromBuffer=function(G,$,he,se,q,H,X,ee){if(ee===void 0&&(ee=!1),!this.isVerticesDataPresent(f.b.PositionKind)||!this.isVerticesDataPresent(f.b.NormalKind)||!this.isVerticesDataPresent(f.b.UVKind))return U.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var Q=this.getVerticesData(f.b.PositionKind,!0,!0),te=this.getVerticesData(f.b.NormalKind),ge=this.getVerticesData(f.b.UVKind),ce=R.e.Zero(),de=R.e.Zero(),ne=R.d.Zero();H=H||R.d.Zero(),X=X||new R.d(1,1);for(var pe=0;pe<Q.length;pe+=3){R.e.FromArrayToRef(Q,pe,ce),R.e.FromArrayToRef(te,pe,de),R.d.FromArrayToRef(ge,pe/3*2,ne);var Se=4*((Math.abs(ne.x*X.x+H.x%1)*($-1)%$|0)+(Math.abs(ne.y*X.y+H.y%1)*(he-1)%he|0)*$),Te=.3*(G[Se]/255)+.59*(G[Se+1]/255)+.11*(G[Se+2]/255);de.normalize(),de.scaleInPlace(se+(q-se)*Te),(ce=ce.add(de)).toArray(Q,pe)}return x.a.ComputeNormals(Q,this.getIndices(),te),ee?(this.setVerticesData(f.b.PositionKind,Q),this.setVerticesData(f.b.NormalKind,te)):(this.updateVerticesData(f.b.PositionKind,Q),this.updateVerticesData(f.b.NormalKind,te)),this},B.prototype.convertToFlatShadedMesh=function(){var G,$,he=this.getVerticesDataKinds(),se={},q={},H={},X=!1;for(G=0;G<he.length;G++){$=he[G];var ee=this.getVertexBuffer($);$!==f.b.NormalKind?(se[$]=ee,q[$]=se[$].getData(),H[$]=[]):(X=ee.isUpdatable(),he.splice(G,1),G--)}var Q,te=this.subMeshes.slice(0),ge=this.getIndices(),ce=this.getTotalIndices();for(Q=0;Q<ce;Q++){var de=ge[Q];for(G=0;G<he.length;G++)for(var ne=se[$=he[G]].getStrideSize(),pe=0;pe<ne;pe++)H[$].push(q[$][de*ne+pe])}var Se=[],Te=H[f.b.PositionKind];for(Q=0;Q<ce;Q+=3){ge[Q]=Q,ge[Q+1]=Q+1,ge[Q+2]=Q+2;for(var Ne=R.e.FromArray(Te,3*Q),je=R.e.FromArray(Te,3*(Q+1)),Xe=R.e.FromArray(Te,3*(Q+2)),Ye=Ne.subtract(je),Ke=Xe.subtract(je),nt=R.e.Normalize(R.e.Cross(Ye,Ke)),qe=0;qe<3;qe++)Se.push(nt.x),Se.push(nt.y),Se.push(nt.z)}for(this.setIndices(ge),this.setVerticesData(f.b.NormalKind,Se,X),G=0;G<he.length;G++)$=he[G],this.setVerticesData($,H[$],se[$].isUpdatable());this.releaseSubMeshes();for(var ct=0;ct<te.length;ct++){var ot=te[ct];T.a.AddToMesh(ot.materialIndex,ot.indexStart,ot.indexCount,ot.indexStart,ot.indexCount,this)}return this.synchronizeInstances(),this},B.prototype.convertToUnIndexedMesh=function(){var G,$,he=this.getVerticesDataKinds(),se={},q={},H={};for(G=0;G<he.length;G++){$=he[G];var X=this.getVertexBuffer($);se[$]=X,q[$]=se[$].getData(),H[$]=[]}var ee,Q=this.subMeshes.slice(0),te=this.getIndices(),ge=this.getTotalIndices();for(ee=0;ee<ge;ee++){var ce=te[ee];for(G=0;G<he.length;G++)for(var de=se[$=he[G]].getStrideSize(),ne=0;ne<de;ne++)H[$].push(q[$][ce*de+ne])}for(ee=0;ee<ge;ee+=3)te[ee]=ee,te[ee+1]=ee+1,te[ee+2]=ee+2;for(this.setIndices(te),G=0;G<he.length;G++)$=he[G],this.setVerticesData($,H[$],se[$].isUpdatable());this.releaseSubMeshes();for(var pe=0;pe<Q.length;pe++){var Se=Q[pe];T.a.AddToMesh(Se.materialIndex,Se.indexStart,Se.indexCount,Se.indexStart,Se.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},B.prototype.flipFaces=function(G){G===void 0&&(G=!1);var $,he,se=x.a.ExtractFromMesh(this);if(G&&this.isVerticesDataPresent(f.b.NormalKind)&&se.normals)for($=0;$<se.normals.length;$++)se.normals[$]*=-1;if(se.indices)for($=0;$<se.indices.length;$+=3)he=se.indices[$+1],se.indices[$+1]=se.indices[$+2],se.indices[$+2]=he;return se.applyToMesh(this,this.isVertexBufferUpdatable(f.b.PositionKind)),this},B.prototype.increaseVertices=function(G){var $=x.a.ExtractFromMesh(this),he=$.uvs,se=$.indices,q=$.positions,H=$.normals;if(se&&q&&H&&he){for(var X,ee,Q=G+1,te=new Array,ge=0;ge<Q+1;ge++)te[ge]=new Array;var ce,de=new R.e(0,0,0),ne=new R.e(0,0,0),pe=new R.d(0,0),Se=new Array,Te=new Array,Ne=new Array,je=q.length,Xe=he.length;for(ge=0;ge<se.length;ge+=3){Te[0]=se[ge],Te[1]=se[ge+1],Te[2]=se[ge+2];for(var Ye=0;Ye<3;Ye++)if(X=Te[Ye],ee=Te[(Ye+1)%3],Ne[X]===void 0&&Ne[ee]===void 0?(Ne[X]=new Array,Ne[ee]=new Array):(Ne[X]===void 0&&(Ne[X]=new Array),Ne[ee]===void 0&&(Ne[ee]=new Array)),Ne[X][ee]===void 0&&Ne[ee][X]===void 0){Ne[X][ee]=[],de.x=(q[3*ee]-q[3*X])/Q,de.y=(q[3*ee+1]-q[3*X+1])/Q,de.z=(q[3*ee+2]-q[3*X+2])/Q,ne.x=(H[3*ee]-H[3*X])/Q,ne.y=(H[3*ee+1]-H[3*X+1])/Q,ne.z=(H[3*ee+2]-H[3*X+2])/Q,pe.x=(he[2*ee]-he[2*X])/Q,pe.y=(he[2*ee+1]-he[2*X+1])/Q,Ne[X][ee].push(X);for(var Ke=1;Ke<Q;Ke++)Ne[X][ee].push(q.length/3),q[je]=q[3*X]+Ke*de.x,H[je++]=H[3*X]+Ke*ne.x,q[je]=q[3*X+1]+Ke*de.y,H[je++]=H[3*X+1]+Ke*ne.y,q[je]=q[3*X+2]+Ke*de.z,H[je++]=H[3*X+2]+Ke*ne.z,he[Xe++]=he[2*X]+Ke*pe.x,he[Xe++]=he[2*X+1]+Ke*pe.y;Ne[X][ee].push(ee),Ne[ee][X]=new Array,ce=Ne[X][ee].length;for(var nt=0;nt<ce;nt++)Ne[ee][X][nt]=Ne[X][ee][ce-1-nt]}for(te[0][0]=se[ge],te[1][0]=Ne[se[ge]][se[ge+1]][1],te[1][1]=Ne[se[ge]][se[ge+2]][1],Ke=2;Ke<Q;Ke++)for(te[Ke][0]=Ne[se[ge]][se[ge+1]][Ke],te[Ke][Ke]=Ne[se[ge]][se[ge+2]][Ke],de.x=(q[3*te[Ke][Ke]]-q[3*te[Ke][0]])/Ke,de.y=(q[3*te[Ke][Ke]+1]-q[3*te[Ke][0]+1])/Ke,de.z=(q[3*te[Ke][Ke]+2]-q[3*te[Ke][0]+2])/Ke,ne.x=(H[3*te[Ke][Ke]]-H[3*te[Ke][0]])/Ke,ne.y=(H[3*te[Ke][Ke]+1]-H[3*te[Ke][0]+1])/Ke,ne.z=(H[3*te[Ke][Ke]+2]-H[3*te[Ke][0]+2])/Ke,pe.x=(he[2*te[Ke][Ke]]-he[2*te[Ke][0]])/Ke,pe.y=(he[2*te[Ke][Ke]+1]-he[2*te[Ke][0]+1])/Ke,Ye=1;Ye<Ke;Ye++)te[Ke][Ye]=q.length/3,q[je]=q[3*te[Ke][0]]+Ye*de.x,H[je++]=H[3*te[Ke][0]]+Ye*ne.x,q[je]=q[3*te[Ke][0]+1]+Ye*de.y,H[je++]=H[3*te[Ke][0]+1]+Ye*ne.y,q[je]=q[3*te[Ke][0]+2]+Ye*de.z,H[je++]=H[3*te[Ke][0]+2]+Ye*ne.z,he[Xe++]=he[2*te[Ke][0]]+Ye*pe.x,he[Xe++]=he[2*te[Ke][0]+1]+Ye*pe.y;for(te[Q]=Ne[se[ge+1]][se[ge+2]],Se.push(te[0][0],te[1][0],te[1][1]),Ke=1;Ke<Q;Ke++){for(Ye=0;Ye<Ke;Ye++)Se.push(te[Ke][Ye],te[Ke+1][Ye],te[Ke+1][Ye+1]),Se.push(te[Ke][Ye],te[Ke+1][Ye+1],te[Ke][Ye+1]);Se.push(te[Ke][Ye],te[Ke+1][Ye],te[Ke+1][Ye+1])}}$.indices=Se,$.applyToMesh(this,this.isVertexBufferUpdatable(f.b.PositionKind))}else U.a.Warn("VertexData contains null entries")},B.prototype.forceSharedVertices=function(){var G=x.a.ExtractFromMesh(this),$=G.uvs,he=G.indices,se=G.positions,q=G.colors;if(he===void 0||se===void 0||he===null||se===null)U.a.Warn("VertexData contains empty entries");else{for(var H,X,ee=new Array,Q=new Array,te=new Array,ge=new Array,ce=new Array,de=0,ne={},pe=0;pe<he.length;pe+=3){X=[he[pe],he[pe+1],he[pe+2]],ce=new Array;for(var Se=0;Se<3;Se++){ce[Se]="";for(var Te=0;Te<3;Te++)Math.abs(se[3*X[Se]+Te])<1e-8&&(se[3*X[Se]+Te]=0),ce[Se]+=se[3*X[Se]+Te]+"|"}if(ce[0]!=ce[1]&&ce[0]!=ce[2]&&ce[1]!=ce[2])for(Se=0;Se<3;Se++){if((H=ne[ce[Se]])===void 0){for(ne[ce[Se]]=de,H=de++,Te=0;Te<3;Te++)ee.push(se[3*X[Se]+Te]);if(q!=null)for(Te=0;Te<4;Te++)ge.push(q[4*X[Se]+Te]);if($!=null)for(Te=0;Te<2;Te++)te.push($[2*X[Se]+Te])}Q.push(H)}}var Ne=new Array;x.a.ComputeNormals(ee,Q,Ne),G.positions=ee,G.indices=Q,G.normals=Ne,$!=null&&(G.uvs=te),q!=null&&(G.colors=ge),G.applyToMesh(this,this.isVertexBufferUpdatable(f.b.PositionKind))}},B._instancedMeshFactory=function(G,$){throw j.a.WarnImport("InstancedMesh")},B._PhysicsImpostorParser=function(G,$,he){throw j.a.WarnImport("PhysicsImpostor")},B.prototype.createInstance=function(G){var $=this.geometry;if($&&$.meshes.length>1)for(var he=0,se=$.meshes.slice(0);he<se.length;he++){var q=se[he];q!==this&&q.makeGeometryUnique()}return B._instancedMeshFactory(G,this)},B.prototype.synchronizeInstances=function(){this._geometry&&this._geometry.meshes.length!==1&&this.instances.length&&this.makeGeometryUnique();for(var G=0;G<this.instances.length;G++)this.instances[G]._syncSubMeshes();return this},B.prototype.optimizeIndices=function(G){var $=this,he=this.getIndices(),se=this.getVerticesData(f.b.PositionKind);if(!se||!he)return this;for(var q=new Array,H=0;H<se.length;H+=3)q.push(R.e.FromArray(se,H));var X=new Array;return S.a.SyncAsyncForLoop(q.length,40,function(ee){for(var Q=q.length-1-ee,te=q[Q],ge=0;ge<Q;++ge){var ce=q[ge];if(te.equals(ce)){X[Q]=ge;break}}},function(){for(var ee=0;ee<he.length;++ee)he[ee]=X[he[ee]]||he[ee];var Q=$.subMeshes.slice(0);$.setIndices(he),$.subMeshes=Q,G&&G($)}),this},B.prototype.serialize=function(G){G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,G.type=this.getClassName(),C.a&&C.a.HasTags(this)&&(G.tags=C.a.GetTags(this)),G.position=this.position.asArray(),this.rotationQuaternion?G.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(G.rotation=this.rotation.asArray()),G.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?G.pivotMatrix=this.getPivotMatrix().asArray():G.localMatrix=this.getPivotMatrix().asArray(),G.isEnabled=this.isEnabled(!1),G.isVisible=this.isVisible,G.infiniteDistance=this.infiniteDistance,G.pickable=this.isPickable,G.receiveShadows=this.receiveShadows,G.billboardMode=this.billboardMode,G.visibility=this.visibility,G.checkCollisions=this.checkCollisions,G.isBlocker=this.isBlocker,G.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(G.parentId=this.parent.id),G.isUnIndexed=this.isUnIndexed;var $=this._geometry;if($){var he=$.id;G.geometryId=he,G.subMeshes=[];for(var se=0;se<this.subMeshes.length;se++){var q=this.subMeshes[se];G.subMeshes.push({materialIndex:q.materialIndex,verticesStart:q.verticesStart,verticesCount:q.verticesCount,indexStart:q.indexStart,indexCount:q.indexCount})}}this.material?this.material.doNotSerialize||(G.materialId=this.material.id):this.material=null,this.morphTargetManager&&(G.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(G.skeletonId=this.skeleton.id,G.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Y.a.NAME_PHYSICSENGINE)&&(ee=this.getPhysicsImpostor())&&(G.physicsMass=ee.getParam("mass"),G.physicsFriction=ee.getParam("friction"),G.physicsRestitution=ee.getParam("mass"),G.physicsImpostor=ee.type),this.metadata&&(G.metadata=this.metadata),G.instances=[];for(var H=0;H<this.instances.length;H++){var X=this.instances[H];if(!X.doNotSerialize){var ee,Q={name:X.name,id:X.id,isEnabled:X.isEnabled(!1),isVisible:X.isVisible,isPickable:X.isPickable,checkCollisions:X.checkCollisions,position:X.position.asArray(),scaling:X.scaling.asArray()};X.parent&&(Q.parentId=X.parent.id),X.rotationQuaternion?Q.rotationQuaternion=X.rotationQuaternion.asArray():X.rotation&&(Q.rotation=X.rotation.asArray()),this.getScene()._getComponent(Y.a.NAME_PHYSICSENGINE)&&(ee=X.getPhysicsImpostor())&&(Q.physicsMass=ee.getParam("mass"),Q.physicsFriction=ee.getParam("friction"),Q.physicsRestitution=ee.getParam("mass"),Q.physicsImpostor=ee.type),X.metadata&&(Q.metadata=X.metadata),G.instances.push(Q),V.a.AppendSerializedAnimations(X,Q),Q.ranges=X.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(G.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:S.b.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var te={data:{},sizes:{},strides:{}};for(var ge in this._userThinInstanceBuffersStorage.data)te.data[ge]=S.b.SliceToArray(this._userThinInstanceBuffersStorage.data[ge]),te.sizes[ge]=this._userThinInstanceBuffersStorage.sizes[ge],te.strides[ge]=this._userThinInstanceBuffersStorage.strides[ge];G.thinInstances.userThinInstance=te}V.a.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.layerMask=this.layerMask,G.alphaIndex=this.alphaIndex,G.hasVertexAlpha=this.hasVertexAlpha,G.overlayAlpha=this.overlayAlpha,G.overlayColor=this.overlayColor.asArray(),G.renderOverlay=this.renderOverlay,G.applyFog=this.applyFog,this.actionManager&&(G.actions=this.actionManager.serialize(this.name))},B.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var G=this._internalMeshDataInfo._morphTargetManager;if(G&&G.vertexCount){if(G.vertexCount!==this.getTotalVertices())return U.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var $=0;$<G.numInfluencers;$++){var he=G.getActiveTarget($),se=he.getPositions();if(!se)return void U.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(f.b.PositionKind+$,se,!1,3);var q=he.getNormals();q&&this.geometry.setVerticesData(f.b.NormalKind+$,q,!1,3);var H=he.getTangents();H&&this.geometry.setVerticesData(f.b.TangentKind+$,H,!1,3);var X=he.getUVs();X&&this.geometry.setVerticesData(f.b.UVKind+"_"+$,X,!1,2)}}else for($=0;this.geometry.isVerticesDataPresent(f.b.PositionKind+$);)this.geometry.removeVerticesData(f.b.PositionKind+$),this.geometry.isVerticesDataPresent(f.b.NormalKind+$)&&this.geometry.removeVerticesData(f.b.NormalKind+$),this.geometry.isVerticesDataPresent(f.b.TangentKind+$)&&this.geometry.removeVerticesData(f.b.TangentKind+$),this.geometry.isVerticesDataPresent(f.b.UVKind+$)&&this.geometry.removeVerticesData(f.b.UVKind+"_"+$),$++}},B.Parse=function(G,$,he){var se;if((se=G.type&&G.type==="GroundMesh"?B._GroundMeshParser(G,$):new B(G.name,$)).id=G.id,C.a&&C.a.AddTagsTo(se,G.tags),se.position=R.e.FromArray(G.position),G.metadata!==void 0&&(se.metadata=G.metadata),G.rotationQuaternion?se.rotationQuaternion=R.b.FromArray(G.rotationQuaternion):G.rotation&&(se.rotation=R.e.FromArray(G.rotation)),se.scaling=R.e.FromArray(G.scaling),G.localMatrix?se.setPreTransformMatrix(R.a.FromArray(G.localMatrix)):G.pivotMatrix&&se.setPivotMatrix(R.a.FromArray(G.pivotMatrix)),se.setEnabled(G.isEnabled),se.isVisible=G.isVisible,se.infiniteDistance=G.infiniteDistance,se.showBoundingBox=G.showBoundingBox,se.showSubMeshesBoundingBox=G.showSubMeshesBoundingBox,G.applyFog!==void 0&&(se.applyFog=G.applyFog),G.pickable!==void 0&&(se.isPickable=G.pickable),G.alphaIndex!==void 0&&(se.alphaIndex=G.alphaIndex),se.receiveShadows=G.receiveShadows,se.billboardMode=G.billboardMode,G.visibility!==void 0&&(se.visibility=G.visibility),se.checkCollisions=G.checkCollisions,se.overrideMaterialSideOrientation=G.overrideMaterialSideOrientation,G.isBlocker!==void 0&&(se.isBlocker=G.isBlocker),se._shouldGenerateFlatShading=G.useFlatShading,G.freezeWorldMatrix&&(se._waitingData.freezeWorldMatrix=G.freezeWorldMatrix),G.parentId&&(se._waitingParentId=G.parentId),G.actions!==void 0&&(se._waitingData.actions=G.actions),G.overlayAlpha!==void 0&&(se.overlayAlpha=G.overlayAlpha),G.overlayColor!==void 0&&(se.overlayColor=I.a.FromArray(G.overlayColor)),G.renderOverlay!==void 0&&(se.renderOverlay=G.renderOverlay),se.isUnIndexed=!!G.isUnIndexed,se.hasVertexAlpha=G.hasVertexAlpha,G.delayLoadingFile?(se.delayLoadState=N.a.DELAYLOADSTATE_NOTLOADED,se.delayLoadingFile=he+G.delayLoadingFile,se._boundingInfo=new _.a(R.e.FromArray(G.boundingBoxMinimum),R.e.FromArray(G.boundingBoxMaximum)),G._binaryInfo&&(se._binaryInfo=G._binaryInfo),se._delayInfo=[],G.hasUVs&&se._delayInfo.push(f.b.UVKind),G.hasUVs2&&se._delayInfo.push(f.b.UV2Kind),G.hasUVs3&&se._delayInfo.push(f.b.UV3Kind),G.hasUVs4&&se._delayInfo.push(f.b.UV4Kind),G.hasUVs5&&se._delayInfo.push(f.b.UV5Kind),G.hasUVs6&&se._delayInfo.push(f.b.UV6Kind),G.hasColors&&se._delayInfo.push(f.b.ColorKind),G.hasMatricesIndices&&se._delayInfo.push(f.b.MatricesIndicesKind),G.hasMatricesWeights&&se._delayInfo.push(f.b.MatricesWeightsKind),se._delayLoadingFunction=P.a._ImportGeometry,O.a.ForceFullSceneLoadingForIncremental&&se._checkDelayState()):P.a._ImportGeometry(G,se),G.materialId?se.setMaterialByID(G.materialId):se.material=null,G.morphTargetManagerId>-1&&(se.morphTargetManager=$.getMorphTargetManagerById(G.morphTargetManagerId)),G.skeletonId!==void 0&&G.skeletonId!==null&&(se.skeleton=$.getLastSkeletonByID(G.skeletonId),G.numBoneInfluencers&&(se.numBoneInfluencers=G.numBoneInfluencers)),G.animations){for(var q=0;q<G.animations.length;q++){var H=G.animations[q];(te=L.a.GetClass("BABYLON.Animation"))&&se.animations.push(te.Parse(H))}b.a.ParseAnimationRanges(se,G,$)}if(G.autoAnimate&&$.beginAnimation(se,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),G.layerMask&&!isNaN(G.layerMask)?se.layerMask=Math.abs(parseInt(G.layerMask)):se.layerMask=268435455,G.physicsImpostor&&B._PhysicsImpostorParser($,se,G),G.lodMeshIds&&(se._waitingData.lods={ids:G.lodMeshIds,distances:G.lodDistances?G.lodDistances:null,coverages:G.lodCoverages?G.lodCoverages:null}),G.instances)for(var X=0;X<G.instances.length;X++){var ee=G.instances[X],Q=se.createInstance(ee.name);if(ee.id&&(Q.id=ee.id),C.a&&(ee.tags?C.a.AddTagsTo(Q,ee.tags):C.a.AddTagsTo(Q,G.tags)),Q.position=R.e.FromArray(ee.position),ee.metadata!==void 0&&(Q.metadata=ee.metadata),ee.parentId&&(Q._waitingParentId=ee.parentId),ee.isEnabled!==void 0&&ee.isEnabled!==null&&Q.setEnabled(ee.isEnabled),ee.isVisible!==void 0&&ee.isVisible!==null&&(Q.isVisible=ee.isVisible),ee.isPickable!==void 0&&ee.isPickable!==null&&(Q.isPickable=ee.isPickable),ee.rotationQuaternion?Q.rotationQuaternion=R.b.FromArray(ee.rotationQuaternion):ee.rotation&&(Q.rotation=R.e.FromArray(ee.rotation)),Q.scaling=R.e.FromArray(ee.scaling),ee.checkCollisions!=null&&ee.checkCollisions!=null&&(Q.checkCollisions=ee.checkCollisions),ee.pickable!=null&&ee.pickable!=null&&(Q.isPickable=ee.pickable),ee.showBoundingBox!=null&&ee.showBoundingBox!=null&&(Q.showBoundingBox=ee.showBoundingBox),ee.showSubMeshesBoundingBox!=null&&ee.showSubMeshesBoundingBox!=null&&(Q.showSubMeshesBoundingBox=ee.showSubMeshesBoundingBox),ee.alphaIndex!=null&&ee.showSubMeshesBoundingBox!=null&&(Q.alphaIndex=ee.alphaIndex),ee.physicsImpostor&&B._PhysicsImpostorParser($,Q,ee),ee.animations){for(q=0;q<ee.animations.length;q++){var te;H=ee.animations[q],(te=L.a.GetClass("BABYLON.Animation"))&&Q.animations.push(te.Parse(H))}b.a.ParseAnimationRanges(Q,ee,$),ee.autoAnimate&&$.beginAnimation(Q,ee.autoAnimateFrom,ee.autoAnimateTo,ee.autoAnimateLoop,ee.autoAnimateSpeed||1)}}if(G.thinInstances){var ge=G.thinInstances;if(ge.matrixData?(se.thinInstanceSetBuffer("matrix",new Float32Array(ge.matrixData),16,!1),se._thinInstanceDataStorage.matrixBufferSize=ge.matrixBufferSize,se._thinInstanceDataStorage.instancesCount=ge.instancesCount):se._thinInstanceDataStorage.matrixBufferSize=ge.matrixBufferSize,G.thinInstances.userThinInstance){var ce=G.thinInstances.userThinInstance;for(var de in ce.data)se.thinInstanceSetBuffer(de,new Float32Array(ce.data[de]),ce.strides[de],!1),se._userThinInstanceBuffersStorage.sizes[de]=ce.sizes[de]}}return se},B.CreateRibbon=function(G,$,he,se,q,H,X,ee,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateDisc=function(G,$,he,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateBox=function(G,$,he,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateSphere=function(G,$,he,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateHemisphere=function(G,$,he,se){throw j.a.WarnImport("MeshBuilder")},B.CreateCylinder=function(G,$,he,se,q,H,X,ee,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateTorus=function(G,$,he,se,q,H,X){throw j.a.WarnImport("MeshBuilder")},B.CreateTorusKnot=function(G,$,he,se,q,H,X,ee,Q,te){throw j.a.WarnImport("MeshBuilder")},B.CreateLines=function(G,$,he,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateDashedLines=function(G,$,he,se,q,H,X,ee){throw j.a.WarnImport("MeshBuilder")},B.CreatePolygon=function(G,$,he,se,q,H,X){throw X===void 0&&(X=earcut),j.a.WarnImport("MeshBuilder")},B.ExtrudePolygon=function(G,$,he,se,q,H,X,ee){throw ee===void 0&&(ee=earcut),j.a.WarnImport("MeshBuilder")},B.ExtrudeShape=function(G,$,he,se,q,H,X,ee,Q,te){throw j.a.WarnImport("MeshBuilder")},B.ExtrudeShapeCustom=function(G,$,he,se,q,H,X,ee,Q,te,ge,ce){throw j.a.WarnImport("MeshBuilder")},B.CreateLathe=function(G,$,he,se,q,H,X){throw j.a.WarnImport("MeshBuilder")},B.CreatePlane=function(G,$,he,se,q){throw j.a.WarnImport("MeshBuilder")},B.CreateGround=function(G,$,he,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateTiledGround=function(G,$,he,se,q,H,X,ee,Q){throw j.a.WarnImport("MeshBuilder")},B.CreateGroundFromHeightMap=function(G,$,he,se,q,H,X,ee,Q,te,ge){throw j.a.WarnImport("MeshBuilder")},B.CreateTube=function(G,$,he,se,q,H,X,ee,Q,te){throw j.a.WarnImport("MeshBuilder")},B.CreatePolyhedron=function(G,$,he){throw j.a.WarnImport("MeshBuilder")},B.CreateIcoSphere=function(G,$,he){throw j.a.WarnImport("MeshBuilder")},B.CreateDecal=function(G,$,he,se,q,H){throw j.a.WarnImport("MeshBuilder")},B.CreateCapsule=function(G,$,he){throw j.a.WarnImport("MeshBuilder")},B.prototype.setPositionsForCPUSkinning=function(){var G=this._internalMeshDataInfo;if(!G._sourcePositions){var $=this.getVerticesData(f.b.PositionKind);if(!$)return G._sourcePositions;G._sourcePositions=new Float32Array($),this.isVertexBufferUpdatable(f.b.PositionKind)||this.setVerticesData(f.b.PositionKind,$,!0)}return G._sourcePositions},B.prototype.setNormalsForCPUSkinning=function(){var G=this._internalMeshDataInfo;if(!G._sourceNormals){var $=this.getVerticesData(f.b.NormalKind);if(!$)return G._sourceNormals;G._sourceNormals=new Float32Array($),this.isVertexBufferUpdatable(f.b.NormalKind)||this.setVerticesData(f.b.NormalKind,$,!0)}return G._sourceNormals},B.prototype.applySkeleton=function(G){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(f.b.PositionKind))return this;if(!this.isVerticesDataPresent(f.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(f.b.MatricesWeightsKind))return this;var $=this.isVerticesDataPresent(f.b.NormalKind),he=this._internalMeshDataInfo;if(!he._sourcePositions){var se=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=se}$&&!he._sourceNormals&&this.setNormalsForCPUSkinning();var q=this.getVerticesData(f.b.PositionKind);if(!q)return this;q instanceof Float32Array||(q=new Float32Array(q));var H=this.getVerticesData(f.b.NormalKind);if($){if(!H)return this;H instanceof Float32Array||(H=new Float32Array(H))}var X=this.getVerticesData(f.b.MatricesIndicesKind),ee=this.getVerticesData(f.b.MatricesWeightsKind);if(!ee||!X)return this;for(var Q,te=this.numBoneInfluencers>4,ge=te?this.getVerticesData(f.b.MatricesIndicesExtraKind):null,ce=te?this.getVerticesData(f.b.MatricesWeightsExtraKind):null,de=G.getTransformMatrices(this),ne=R.e.Zero(),pe=new R.a,Se=new R.a,Te=0,Ne=0;Ne<q.length;Ne+=3,Te+=4){var je;for(Q=0;Q<4;Q++)(je=ee[Te+Q])>0&&(R.a.FromFloat32ArrayToRefScaled(de,Math.floor(16*X[Te+Q]),je,Se),pe.addToSelf(Se));if(te)for(Q=0;Q<4;Q++)(je=ce[Te+Q])>0&&(R.a.FromFloat32ArrayToRefScaled(de,Math.floor(16*ge[Te+Q]),je,Se),pe.addToSelf(Se));R.e.TransformCoordinatesFromFloatsToRef(he._sourcePositions[Ne],he._sourcePositions[Ne+1],he._sourcePositions[Ne+2],pe,ne),ne.toArray(q,Ne),$&&(R.e.TransformNormalFromFloatsToRef(he._sourceNormals[Ne],he._sourceNormals[Ne+1],he._sourceNormals[Ne+2],pe,ne),ne.toArray(H,Ne)),pe.reset()}return this.updateVerticesData(f.b.PositionKind,q),$&&this.updateVerticesData(f.b.NormalKind,H),this},B.MinMax=function(G){var $=null,he=null;return G.forEach(function(se){var q=se.getBoundingInfo().boundingBox;$&&he?($.minimizeInPlace(q.minimumWorld),he.maximizeInPlace(q.maximumWorld)):($=q.minimumWorld,he=q.maximumWorld)}),$&&he?{min:$,max:he}:{min:R.e.Zero(),max:R.e.Zero()}},B.Center=function(G){var $=G instanceof Array?B.MinMax(G):G;return R.e.Center($.min,$.max)},B.MergeMeshes=function(G,$,he,se,q,H){var X;if($===void 0&&($=!0),!he){var ee=0;for(X=0;X<G.length;X++)if(G[X]&&(ee+=G[X].getTotalVertices())>=65536)return U.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(H){var Q,te,ge=null;q=!1}var ce,de=new Array,ne=new Array,pe=null,Se=new Array,Te=null;for(X=0;X<G.length;X++)if(G[X]){var Ne=G[X];if(Ne.isAnInstance)return U.a.Warn("Cannot merge instance meshes."),null;var je=Ne.computeWorldMatrix(!0);if((ce=x.a.ExtractFromMesh(Ne,!0,!0)).transform(je),pe?pe.merge(ce,he):(pe=ce,Te=Ne),q&&Se.push(Ne.getTotalIndices()),H)if(Ne.material){var Xe=Ne.material;if(Xe instanceof M.a){for(te=0;te<Xe.subMaterials.length;te++)de.indexOf(Xe.subMaterials[te])<0&&de.push(Xe.subMaterials[te]);for(Q=0;Q<Ne.subMeshes.length;Q++)ne.push(de.indexOf(Xe.subMaterials[Ne.subMeshes[Q].materialIndex])),Se.push(Ne.subMeshes[Q].indexCount)}else for(de.indexOf(Xe)<0&&de.push(Xe),Q=0;Q<Ne.subMeshes.length;Q++)ne.push(de.indexOf(Xe)),Se.push(Ne.subMeshes[Q].indexCount)}else for(Q=0;Q<Ne.subMeshes.length;Q++)ne.push(0),Se.push(Ne.subMeshes[Q].indexCount)}if(Te=Te,se||(se=new B(Te.name+"_merged",Te.getScene())),pe.applyToMesh(se),se.checkCollisions=Te.checkCollisions,se.overrideMaterialSideOrientation=Te.overrideMaterialSideOrientation,$)for(X=0;X<G.length;X++)G[X]&&G[X].dispose();if(q||H){se.releaseSubMeshes(),X=0;for(var Ye=0;X<Se.length;)T.a.CreateFromIndices(0,Ye,Se[X],se),Ye+=Se[X],X++}if(H){for((ge=new M.a(Te.name+"_merged",Te.getScene())).subMaterials=de,Q=0;Q<se.subMeshes.length;Q++)se.subMeshes[Q].materialIndex=ne[Q];se.material=ge}else se.material=Te.material;return se},B.prototype.addInstance=function(G){G._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(G)},B.prototype.removeInstance=function(G){var $=G._indexInSourceMeshInstanceArray;if($!=-1){if($!==this.instances.length-1){var he=this.instances[this.instances.length-1];this.instances[$]=he,he._indexInSourceMeshInstanceArray=$}G._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},B.FRONTSIDE=x.a.FRONTSIDE,B.BACKSIDE=x.a.BACKSIDE,B.DOUBLESIDE=x.a.DOUBLESIDE,B.DEFAULTSIDE=x.a.DEFAULTSIDE,B.NO_CAP=0,B.CAP_START=1,B.CAP_END=2,B.CAP_ALL=3,B.NO_FLIP=0,B.FLIP_TILE=1,B.ROTATE_TILE=2,B.FLIP_ROW=3,B.ROTATE_ROW=4,B.FLIP_N_ROTATE_TILE=5,B.FLIP_N_ROTATE_ROW=6,B.CENTER=0,B.LEFT=1,B.RIGHT=2,B.TOP=3,B.BOTTOM=4,B._GroundMeshParser=function(G,$){throw j.a.WarnImport("GroundMesh")},B}(A.a);L.a.RegisteredTypes["BABYLON.Mesh"]=Z},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m._AddLogEntry=function(S){m._LogCache=S+m._LogCache,m.OnNewCacheEntry&&m.OnNewCacheEntry(S)},m._FormatMessage=function(S){var h=function(R){return R<10?"0"+R:""+R},C=new Date;return"["+h(C.getHours())+":"+h(C.getMinutes())+":"+h(C.getSeconds())+"]: "+S},m._LogDisabled=function(S){},m._LogEnabled=function(S){var h=m._FormatMessage(S);console.log("BJS - "+h);var C="<div style='color:white'>"+h+"</div><br>";m._AddLogEntry(C)},m._WarnDisabled=function(S){},m._WarnEnabled=function(S){var h=m._FormatMessage(S);console.warn("BJS - "+h);var C="<div style='color:orange'>"+h+"</div><br>";m._AddLogEntry(C)},m._ErrorDisabled=function(S){},m._ErrorEnabled=function(S){m.errorsCount++;var h=m._FormatMessage(S);console.error("BJS - "+h);var C="<div style='color:red'>"+h+"</div><br>";m._AddLogEntry(C)},Object.defineProperty(m,"LogCache",{get:function(){return m._LogCache},enumerable:!1,configurable:!0}),m.ClearLogCache=function(){m._LogCache="",m.errorsCount=0},Object.defineProperty(m,"LogLevels",{set:function(S){(S&m.MessageLogLevel)===m.MessageLogLevel?m.Log=m._LogEnabled:m.Log=m._LogDisabled,(S&m.WarningLogLevel)===m.WarningLogLevel?m.Warn=m._WarnEnabled:m.Warn=m._WarnDisabled,(S&m.ErrorLogLevel)===m.ErrorLogLevel?m.Error=m._ErrorEnabled:m.Error=m._ErrorDisabled},enumerable:!1,configurable:!0}),m.NoneLogLevel=0,m.MessageLogLevel=1,m.WarningLogLevel=2,m.ErrorLogLevel=4,m.AllLogLevel=7,m._LogCache="",m.errorsCount=0,m.Log=m._LogEnabled,m.Warn=m._WarnEnabled,m.Error=m._ErrorEnabled,m}()},function(p,s,c){c.d(s,"a",function(){return C}),c.d(s,"b",function(){return R}),c.d(s,"c",function(){return I});var E=c(14),m=c(28),S=c(44),h=c(11),C=function(){function b(f,x,P){f===void 0&&(f=0),x===void 0&&(x=0),P===void 0&&(P=0),this.r=f,this.g=x,this.b=P}return b.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},b.prototype.getClassName=function(){return"Color3"},b.prototype.getHashCode=function(){var f=255*this.r|0;return f=397*(f=397*f^(255*this.g|0))^(255*this.b|0)},b.prototype.toArray=function(f,x){return x===void 0&&(x=0),f[x]=this.r,f[x+1]=this.g,f[x+2]=this.b,this},b.prototype.fromArray=function(f,x){return x===void 0&&(x=0),b.FromArrayToRef(f,x,this),this},b.prototype.toColor4=function(f){return f===void 0&&(f=1),new R(this.r,this.g,this.b,f)},b.prototype.asArray=function(){var f=new Array;return this.toArray(f,0),f},b.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},b.prototype.multiply=function(f){return new b(this.r*f.r,this.g*f.g,this.b*f.b)},b.prototype.multiplyToRef=function(f,x){return x.r=this.r*f.r,x.g=this.g*f.g,x.b=this.b*f.b,this},b.prototype.equals=function(f){return f&&this.r===f.r&&this.g===f.g&&this.b===f.b},b.prototype.equalsFloats=function(f,x,P){return this.r===f&&this.g===x&&this.b===P},b.prototype.scale=function(f){return new b(this.r*f,this.g*f,this.b*f)},b.prototype.scaleToRef=function(f,x){return x.r=this.r*f,x.g=this.g*f,x.b=this.b*f,this},b.prototype.scaleAndAddToRef=function(f,x){return x.r+=this.r*f,x.g+=this.g*f,x.b+=this.b*f,this},b.prototype.clampToRef=function(f,x,P){return f===void 0&&(f=0),x===void 0&&(x=1),P.r=E.a.Clamp(this.r,f,x),P.g=E.a.Clamp(this.g,f,x),P.b=E.a.Clamp(this.b,f,x),this},b.prototype.add=function(f){return new b(this.r+f.r,this.g+f.g,this.b+f.b)},b.prototype.addToRef=function(f,x){return x.r=this.r+f.r,x.g=this.g+f.g,x.b=this.b+f.b,this},b.prototype.subtract=function(f){return new b(this.r-f.r,this.g-f.g,this.b-f.b)},b.prototype.subtractToRef=function(f,x){return x.r=this.r-f.r,x.g=this.g-f.g,x.b=this.b-f.b,this},b.prototype.clone=function(){return new b(this.r,this.g,this.b)},b.prototype.copyFrom=function(f){return this.r=f.r,this.g=f.g,this.b=f.b,this},b.prototype.copyFromFloats=function(f,x,P){return this.r=f,this.g=x,this.b=P,this},b.prototype.set=function(f,x,P){return this.copyFromFloats(f,x,P)},b.prototype.toHexString=function(){var f=255*this.r|0,x=255*this.g|0,P=255*this.b|0;return"#"+E.a.ToHex(f)+E.a.ToHex(x)+E.a.ToHex(P)},b.prototype.toLinearSpace=function(){var f=new b;return this.toLinearSpaceToRef(f),f},b.prototype.toHSV=function(){var f=new b;return this.toHSVToRef(f),f},b.prototype.toHSVToRef=function(f){var x=this.r,P=this.g,A=this.b,T=Math.max(x,P,A),_=Math.min(x,P,A),g=0,M=0,O=T,N=T-_;T!==0&&(M=N/T),T!=_&&(T==x?(g=(P-A)/N,P<A&&(g+=6)):T==P?g=(A-x)/N+2:T==A&&(g=(x-P)/N+4),g*=60),f.r=g,f.g=M,f.b=O},b.prototype.toLinearSpaceToRef=function(f){return f.r=Math.pow(this.r,m.c),f.g=Math.pow(this.g,m.c),f.b=Math.pow(this.b,m.c),this},b.prototype.toGammaSpace=function(){var f=new b;return this.toGammaSpaceToRef(f),f},b.prototype.toGammaSpaceToRef=function(f){return f.r=Math.pow(this.r,m.b),f.g=Math.pow(this.g,m.b),f.b=Math.pow(this.b,m.b),this},b.HSVtoRGBToRef=function(f,x,P,A){var T=P*x,_=f/60,g=T*(1-Math.abs(_%2-1)),M=0,O=0,N=0;_>=0&&_<=1?(M=T,O=g):_>=1&&_<=2?(M=g,O=T):_>=2&&_<=3?(O=T,N=g):_>=3&&_<=4?(O=g,N=T):_>=4&&_<=5?(M=g,N=T):_>=5&&_<=6&&(M=T,N=g);var V=P-T;A.set(M+V,O+V,N+V)},b.FromHexString=function(f){if(f.substring(0,1)!=="#"||f.length!==7)return new b(0,0,0);var x=parseInt(f.substring(1,3),16),P=parseInt(f.substring(3,5),16),A=parseInt(f.substring(5,7),16);return b.FromInts(x,P,A)},b.FromArray=function(f,x){return x===void 0&&(x=0),new b(f[x],f[x+1],f[x+2])},b.FromArrayToRef=function(f,x,P){x===void 0&&(x=0),P.r=f[x],P.g=f[x+1],P.b=f[x+2]},b.FromInts=function(f,x,P){return new b(f/255,x/255,P/255)},b.Lerp=function(f,x,P){var A=new b(0,0,0);return b.LerpToRef(f,x,P,A),A},b.LerpToRef=function(f,x,P,A){A.r=f.r+(x.r-f.r)*P,A.g=f.g+(x.g-f.g)*P,A.b=f.b+(x.b-f.b)*P},b.Red=function(){return new b(1,0,0)},b.Green=function(){return new b(0,1,0)},b.Blue=function(){return new b(0,0,1)},b.Black=function(){return new b(0,0,0)},Object.defineProperty(b,"BlackReadOnly",{get:function(){return b._BlackReadOnly},enumerable:!1,configurable:!0}),b.White=function(){return new b(1,1,1)},b.Purple=function(){return new b(.5,0,.5)},b.Magenta=function(){return new b(1,0,1)},b.Yellow=function(){return new b(1,1,0)},b.Gray=function(){return new b(.5,.5,.5)},b.Teal=function(){return new b(0,1,1)},b.Random=function(){return new b(Math.random(),Math.random(),Math.random())},b._BlackReadOnly=b.Black(),b}(),R=function(){function b(f,x,P,A){f===void 0&&(f=0),x===void 0&&(x=0),P===void 0&&(P=0),A===void 0&&(A=1),this.r=f,this.g=x,this.b=P,this.a=A}return b.prototype.addInPlace=function(f){return this.r+=f.r,this.g+=f.g,this.b+=f.b,this.a+=f.a,this},b.prototype.asArray=function(){var f=new Array;return this.toArray(f,0),f},b.prototype.toArray=function(f,x){return x===void 0&&(x=0),f[x]=this.r,f[x+1]=this.g,f[x+2]=this.b,f[x+3]=this.a,this},b.prototype.fromArray=function(f,x){return x===void 0&&(x=0),b.FromArrayToRef(f,x,this),this},b.prototype.equals=function(f){return f&&this.r===f.r&&this.g===f.g&&this.b===f.b&&this.a===f.a},b.prototype.add=function(f){return new b(this.r+f.r,this.g+f.g,this.b+f.b,this.a+f.a)},b.prototype.subtract=function(f){return new b(this.r-f.r,this.g-f.g,this.b-f.b,this.a-f.a)},b.prototype.subtractToRef=function(f,x){return x.r=this.r-f.r,x.g=this.g-f.g,x.b=this.b-f.b,x.a=this.a-f.a,this},b.prototype.scale=function(f){return new b(this.r*f,this.g*f,this.b*f,this.a*f)},b.prototype.scaleToRef=function(f,x){return x.r=this.r*f,x.g=this.g*f,x.b=this.b*f,x.a=this.a*f,this},b.prototype.scaleAndAddToRef=function(f,x){return x.r+=this.r*f,x.g+=this.g*f,x.b+=this.b*f,x.a+=this.a*f,this},b.prototype.clampToRef=function(f,x,P){return f===void 0&&(f=0),x===void 0&&(x=1),P.r=E.a.Clamp(this.r,f,x),P.g=E.a.Clamp(this.g,f,x),P.b=E.a.Clamp(this.b,f,x),P.a=E.a.Clamp(this.a,f,x),this},b.prototype.multiply=function(f){return new b(this.r*f.r,this.g*f.g,this.b*f.b,this.a*f.a)},b.prototype.multiplyToRef=function(f,x){return x.r=this.r*f.r,x.g=this.g*f.g,x.b=this.b*f.b,x.a=this.a*f.a,x},b.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},b.prototype.getClassName=function(){return"Color4"},b.prototype.getHashCode=function(){var f=255*this.r|0;return f=397*(f=397*(f=397*f^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},b.prototype.clone=function(){return new b(this.r,this.g,this.b,this.a)},b.prototype.copyFrom=function(f){return this.r=f.r,this.g=f.g,this.b=f.b,this.a=f.a,this},b.prototype.copyFromFloats=function(f,x,P,A){return this.r=f,this.g=x,this.b=P,this.a=A,this},b.prototype.set=function(f,x,P,A){return this.copyFromFloats(f,x,P,A)},b.prototype.toHexString=function(f){f===void 0&&(f=!1);var x=255*this.r|0,P=255*this.g|0,A=255*this.b|0;if(f)return"#"+E.a.ToHex(x)+E.a.ToHex(P)+E.a.ToHex(A);var T=255*this.a|0;return"#"+E.a.ToHex(x)+E.a.ToHex(P)+E.a.ToHex(A)+E.a.ToHex(T)},b.prototype.toLinearSpace=function(){var f=new b;return this.toLinearSpaceToRef(f),f},b.prototype.toLinearSpaceToRef=function(f){return f.r=Math.pow(this.r,m.c),f.g=Math.pow(this.g,m.c),f.b=Math.pow(this.b,m.c),f.a=this.a,this},b.prototype.toGammaSpace=function(){var f=new b;return this.toGammaSpaceToRef(f),f},b.prototype.toGammaSpaceToRef=function(f){return f.r=Math.pow(this.r,m.b),f.g=Math.pow(this.g,m.b),f.b=Math.pow(this.b,m.b),f.a=this.a,this},b.FromHexString=function(f){if(f.substring(0,1)!=="#"||f.length!==9)return new b(0,0,0,0);var x=parseInt(f.substring(1,3),16),P=parseInt(f.substring(3,5),16),A=parseInt(f.substring(5,7),16),T=parseInt(f.substring(7,9),16);return b.FromInts(x,P,A,T)},b.Lerp=function(f,x,P){var A=new b(0,0,0,0);return b.LerpToRef(f,x,P,A),A},b.LerpToRef=function(f,x,P,A){A.r=f.r+(x.r-f.r)*P,A.g=f.g+(x.g-f.g)*P,A.b=f.b+(x.b-f.b)*P,A.a=f.a+(x.a-f.a)*P},b.FromColor3=function(f,x){return x===void 0&&(x=1),new b(f.r,f.g,f.b,x)},b.FromArray=function(f,x){return x===void 0&&(x=0),new b(f[x],f[x+1],f[x+2],f[x+3])},b.FromArrayToRef=function(f,x,P){x===void 0&&(x=0),P.r=f[x],P.g=f[x+1],P.b=f[x+2],P.a=f[x+3]},b.FromInts=function(f,x,P,A){return new b(f/255,x/255,P/255,A/255)},b.CheckColors4=function(f,x){if(f.length===3*x){for(var P=[],A=0;A<f.length;A+=3){var T=A/3*4;P[T]=f[A],P[T+1]=f[A+1],P[T+2]=f[A+2],P[T+3]=1}return P}return f},b}(),I=function(){function b(){}return b.Color3=S.a.BuildArray(3,C.Black),b.Color4=S.a.BuildArray(3,function(){return new R(0,0,0,0)}),b}();h.a.RegisteredTypes["BABYLON.Color3"]=C,h.a.RegisteredTypes["BABYLON.Color4"]=R},function(p,s,c){c.d(s,"a",function(){return _});var E=c(1),m=c(3),S=c(6),h=c(0),C=c(52),R=c(2),I=c(11),b=c(21),f=c(104),x=c(122),P=c(64),A=c(34),T=c(150),_=function(g){function M(O,N,V,U,L,j,Y,W,ie,re,ye,ve){V===void 0&&(V=!1),U===void 0&&(U=!0),L===void 0&&(L=M.TRILINEAR_SAMPLINGMODE),j===void 0&&(j=null),Y===void 0&&(Y=null),W===void 0&&(W=null),ie===void 0&&(ie=!1);var ue=g.call(this,N)||this;ue.url=null,ue.uOffset=0,ue.vOffset=0,ue.uScale=1,ue.vScale=1,ue.uAng=0,ue.vAng=0,ue.wAng=0,ue.uRotationCenter=.5,ue.vRotationCenter=.5,ue.wRotationCenter=.5,ue.homogeneousRotationInUVTransform=!1,ue.inspectableCustomProperties=null,ue._noMipmap=!1,ue._invertY=!1,ue._rowGenerationMatrix=null,ue._cachedTextureMatrix=null,ue._projectionModeMatrix=null,ue._t0=null,ue._t1=null,ue._t2=null,ue._cachedUOffset=-1,ue._cachedVOffset=-1,ue._cachedUScale=0,ue._cachedVScale=0,ue._cachedUAng=-1,ue._cachedVAng=-1,ue._cachedWAng=-1,ue._cachedProjectionMatrixId=-1,ue._cachedURotationCenter=-1,ue._cachedVRotationCenter=-1,ue._cachedWRotationCenter=-1,ue._cachedHomogeneousRotationInUVTransform=!1,ue._cachedCoordinatesMode=-1,ue._initialSamplingMode=M.BILINEAR_SAMPLINGMODE,ue._buffer=null,ue._deleteBuffer=!1,ue._format=null,ue._delayedOnLoad=null,ue._delayedOnError=null,ue.onLoadObservable=new S.c,ue._isBlocking=!0,ue.name=O||"",ue.url=O,ue._noMipmap=V,ue._invertY=U,ue._initialSamplingMode=L,ue._buffer=W,ue._deleteBuffer=ie,ue._mimeType=ye,ue._loaderOptions=ve,re&&(ue._format=re);var oe=ue.getScene(),Z=ue._getEngine();if(!Z)return ue;Z.onBeforeTextureInitObservable.notifyObservers(ue);var J=function(){ue._texture&&(ue._texture._invertVScale&&(ue.vScale*=-1,ue.vOffset+=1),ue._texture._cachedWrapU!==null&&(ue.wrapU=ue._texture._cachedWrapU,ue._texture._cachedWrapU=null),ue._texture._cachedWrapV!==null&&(ue.wrapV=ue._texture._cachedWrapV,ue._texture._cachedWrapV=null),ue._texture._cachedWrapR!==null&&(ue.wrapR=ue._texture._cachedWrapR,ue._texture._cachedWrapR=null)),ue.onLoadObservable.hasObservers()&&ue.onLoadObservable.notifyObservers(ue),j&&j(),!ue.isBlocking&&oe&&oe.resetCachedMaterial()};return ue.url?(ue._texture=ue._getFromCache(ue.url,V,L,U),ue._texture?ue._texture.isReady?f.a.SetImmediate(function(){return J()}):ue._texture.onLoadedObservable.add(J):oe&&oe.useDelayedTextureLoading?(ue.delayLoadState=R.a.DELAYLOADSTATE_NOTLOADED,ue._delayedOnLoad=J,ue._delayedOnError=Y):(ue._texture=Z.createTexture(ue.url,V,U,oe,L,J,Y,ue._buffer,void 0,ue._format,null,ye,ve),ie&&(ue._buffer=null)),ue):(ue._delayedOnLoad=J,ue._delayedOnError=Y,ue)}return Object(E.d)(M,g),Object.defineProperty(M.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(O){this._isBlocking=O},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),M.prototype.updateURL=function(O,N,V){N===void 0&&(N=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag)),this.name&&!A.a.StartsWith(this.name,"data:")||(this.name=O),this.url=O,this._buffer=N,this.delayLoadState=R.a.DELAYLOADSTATE_NOTLOADED,V&&(this._delayedOnLoad=V),this.delayLoad()},M.prototype.delayLoad=function(){if(this.delayLoadState===R.a.DELAYLOADSTATE_NOTLOADED){var O=this.getScene();O&&(this.delayLoadState=R.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?f.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=O.getEngine().createTexture(this.url,this._noMipmap,this._invertY,O,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},M.prototype._prepareRowForTextureGeneration=function(O,N,V,U){O*=this._cachedUScale,N*=this._cachedVScale,O-=this.uRotationCenter*this._cachedUScale,N-=this.vRotationCenter*this._cachedVScale,V-=this.wRotationCenter,h.e.TransformCoordinatesFromFloatsToRef(O,N,V,this._rowGenerationMatrix,U),U.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,U.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,U.z+=this.wRotationCenter},M.prototype.checkTransformsAreIdentical=function(O){return O!==null&&this.uOffset===O.uOffset&&this.vOffset===O.vOffset&&this.uScale===O.uScale&&this.vScale===O.vScale&&this.uAng===O.uAng&&this.vAng===O.vAng&&this.wAng===O.wAng},M.prototype.getTextureMatrix=function(O){var N=this;if(O===void 0&&(O=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*O===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*O,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=h.a.Zero(),this._rowGenerationMatrix=new h.a,this._t0=h.e.Zero(),this._t1=h.e.Zero(),this._t2=h.e.Zero()),h.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(h.a.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,h.c.Matrix[0]),h.a.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,h.c.Matrix[1]),h.a.ScalingToRef(this._cachedUScale,this._cachedVScale,0,h.c.Matrix[2]),h.a.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,h.c.Matrix[3]),h.c.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.c.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.c.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(h.c.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),h.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var V=this.getScene();return V?(V.markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag,function(U){return U.hasTexture(N)}),this._cachedTextureMatrix):this._cachedTextureMatrix},M.prototype.getReflectionTextureMatrix=function(){var O=this,N=this.getScene();if(!N)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==M.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===N.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=h.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=h.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case M.PLANAR_MODE:h.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case M.PROJECTION_MODE:h.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var V=N.getProjectionMatrix();this._cachedProjectionMatrixId=V.updateFlag,V.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:h.a.IdentityToRef(this._cachedTextureMatrix)}return N.markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag,function(U){return U.getActiveTextures().indexOf(O)!==-1}),this._cachedTextureMatrix},M.prototype.clone=function(){var O=this;return m.a.Clone(function(){return new M(O._texture?O._texture.url:null,O.getScene(),O._noMipmap,O._invertY,O.samplingMode,void 0,void 0,O._texture?O._texture._buffer:void 0)},this)},M.prototype.serialize=function(){var O=this.name;M.SerializeBuffers||A.a.StartsWith(this.name,"data:")&&(this.name=""),A.a.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var N=g.prototype.serialize.call(this);return N?((M.SerializeBuffers||M.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(N.base64String=this._buffer,N.name=N.name.replace("data:","")):this.url&&A.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?N.base64String="data:image/png;base64,"+A.a.EncodeArrayBufferToBase64(this._buffer):M.ForceSerializeBuffers&&(N.base64String=T.a.GenerateBase64StringFromTexture(this))),N.invertY=this._invertY,N.samplingMode=this.samplingMode,this.name=O,N):null},M.prototype.getClassName=function(){return"Texture"},M.prototype.dispose=function(){g.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},M.Parse=function(O,N,V){if(O.customType){var U=x.a.Instantiate(O.customType).Parse(O,N,V);return O.samplingMode&&U.updateSamplingMode&&U._samplingMode&&U._samplingMode!==O.samplingMode&&U.updateSamplingMode(O.samplingMode),U}if(O.isCube&&!O.isRenderTarget)return M._CubeTextureParser(O,N,V);if(!O.name&&!O.isRenderTarget)return null;var L=function(){if(j&&j._texture&&(j._texture._cachedWrapU=null,j._texture._cachedWrapV=null,j._texture._cachedWrapR=null),O.samplingMode){var Y=O.samplingMode;j&&j.samplingMode!==Y&&j.updateSamplingMode(Y)}if(j&&O.animations)for(var W=0;W<O.animations.length;W++){var ie=O.animations[W],re=I.a.GetClass("BABYLON.Animation");re&&j.animations.push(re.Parse(ie))}},j=m.a.Parse(function(){var Y,W=!0;if(O.noMipmap&&(W=!1),O.mirrorPlane){var ie=M._CreateMirror(O.name,O.renderTargetSize,N,W);return ie._waitingRenderList=O.renderList,ie.mirrorPlane=P.a.FromArray(O.mirrorPlane),L(),ie}if(O.isRenderTarget){var re=null;if(O.isCube){if(N.reflectionProbes)for(var ye=0;ye<N.reflectionProbes.length;ye++){var ve=N.reflectionProbes[ye];if(ve.name===O.name)return ve.cubeTexture}}else(re=M._CreateRenderTargetTexture(O.name,O.renderTargetSize,N,W))._waitingRenderList=O.renderList;return L(),re}if(O.base64String)Y=M.CreateFromBase64String(O.base64String,O.name,N,!W,O.invertY,void 0,L);else{var ue=void 0;ue=O.name&&O.name.indexOf("://")>0?O.name:V+O.name,(A.a.StartsWith(O.url,"data:")||M.UseSerializedUrlIfAny&&O.url)&&(ue=O.url),Y=new M(ue,N,!W,O.invertY,void 0,L)}return Y},O,N);return j},M.CreateFromBase64String=function(O,N,V,U,L,j,Y,W,ie){return j===void 0&&(j=M.TRILINEAR_SAMPLINGMODE),Y===void 0&&(Y=null),W===void 0&&(W=null),ie===void 0&&(ie=R.a.TEXTUREFORMAT_RGBA),new M("data:"+N,V,U,L,j,Y,W,O,!1,ie)},M.LoadFromDataString=function(O,N,V,U,L,j,Y,W,ie,re){return U===void 0&&(U=!1),L===void 0&&(L=!1),j===void 0&&(j=!0),Y===void 0&&(Y=M.TRILINEAR_SAMPLINGMODE),W===void 0&&(W=null),ie===void 0&&(ie=null),re===void 0&&(re=R.a.TEXTUREFORMAT_RGBA),O.substr(0,5)!=="data:"&&(O="data:"+O),new M(O,V,L,j,Y,W,ie,N,U,re)},M.SerializeBuffers=!0,M.ForceSerializeBuffers=!1,M._CubeTextureParser=function(O,N,V){throw b.a.WarnImport("CubeTexture")},M._CreateMirror=function(O,N,V,U){throw b.a.WarnImport("MirrorTexture")},M._CreateRenderTargetTexture=function(O,N,V,U){throw b.a.WarnImport("RenderTargetTexture")},M.NEAREST_SAMPLINGMODE=R.a.TEXTURE_NEAREST_SAMPLINGMODE,M.NEAREST_NEAREST_MIPLINEAR=R.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,M.BILINEAR_SAMPLINGMODE=R.a.TEXTURE_BILINEAR_SAMPLINGMODE,M.LINEAR_LINEAR_MIPNEAREST=R.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,M.TRILINEAR_SAMPLINGMODE=R.a.TEXTURE_TRILINEAR_SAMPLINGMODE,M.LINEAR_LINEAR_MIPLINEAR=R.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,M.NEAREST_NEAREST_MIPNEAREST=R.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,M.NEAREST_LINEAR_MIPNEAREST=R.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,M.NEAREST_LINEAR_MIPLINEAR=R.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,M.NEAREST_LINEAR=R.a.TEXTURE_NEAREST_LINEAR,M.NEAREST_NEAREST=R.a.TEXTURE_NEAREST_NEAREST,M.LINEAR_NEAREST_MIPNEAREST=R.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,M.LINEAR_NEAREST_MIPLINEAR=R.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,M.LINEAR_LINEAR=R.a.TEXTURE_LINEAR_LINEAR,M.LINEAR_NEAREST=R.a.TEXTURE_LINEAR_NEAREST,M.EXPLICIT_MODE=R.a.TEXTURE_EXPLICIT_MODE,M.SPHERICAL_MODE=R.a.TEXTURE_SPHERICAL_MODE,M.PLANAR_MODE=R.a.TEXTURE_PLANAR_MODE,M.CUBIC_MODE=R.a.TEXTURE_CUBIC_MODE,M.PROJECTION_MODE=R.a.TEXTURE_PROJECTION_MODE,M.SKYBOX_MODE=R.a.TEXTURE_SKYBOX_MODE,M.INVCUBIC_MODE=R.a.TEXTURE_INVCUBIC_MODE,M.EQUIRECTANGULAR_MODE=R.a.TEXTURE_EQUIRECTANGULAR_MODE,M.FIXED_EQUIRECTANGULAR_MODE=R.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,M.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=R.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,M.CLAMP_ADDRESSMODE=R.a.TEXTURE_CLAMP_ADDRESSMODE,M.WRAP_ADDRESSMODE=R.a.TEXTURE_WRAP_ADDRESSMODE,M.MIRROR_ADDRESSMODE=R.a.TEXTURE_MIRROR_ADDRESSMODE,M.UseSerializedUrlIfAny=!1,Object(E.c)([Object(m.c)()],M.prototype,"url",void 0),Object(E.c)([Object(m.c)()],M.prototype,"uOffset",void 0),Object(E.c)([Object(m.c)()],M.prototype,"vOffset",void 0),Object(E.c)([Object(m.c)()],M.prototype,"uScale",void 0),Object(E.c)([Object(m.c)()],M.prototype,"vScale",void 0),Object(E.c)([Object(m.c)()],M.prototype,"uAng",void 0),Object(E.c)([Object(m.c)()],M.prototype,"vAng",void 0),Object(E.c)([Object(m.c)()],M.prototype,"wAng",void 0),Object(E.c)([Object(m.c)()],M.prototype,"uRotationCenter",void 0),Object(E.c)([Object(m.c)()],M.prototype,"vRotationCenter",void 0),Object(E.c)([Object(m.c)()],M.prototype,"wRotationCenter",void 0),Object(E.c)([Object(m.c)()],M.prototype,"homogeneousRotationInUVTransform",void 0),Object(E.c)([Object(m.c)()],M.prototype,"isBlocking",null),M}(C.a);I.a.RegisteredTypes["BABYLON.Texture"]=_,m.a._TextureParser=_.Parse},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.GetClass=function(S){return this.RegisteredTypes&&this.RegisteredTypes[S]?this.RegisteredTypes[S]:null},m.RegisteredTypes={},m}()},function(p,s,c){c.d(s,"b",function(){return _}),c.d(s,"c",function(){return g}),c.d(s,"a",function(){return M});var E=c(6),m=c(38),S=c(8),h=c(41),C=c(57),R=c(21),I=c(49),b=c(22),f=c(56),x=c(145),P=c(104),A=c(122),T=c(120),_=function(){function O(){}return Object.defineProperty(O,"BaseUrl",{get:function(){return f.a.BaseUrl},set:function(N){f.a.BaseUrl=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"DefaultRetryStrategy",{get:function(){return f.a.DefaultRetryStrategy},set:function(N){f.a.DefaultRetryStrategy=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"CorsBehavior",{get:function(){return f.a.CorsBehavior},set:function(N){f.a.CorsBehavior=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"UseFallbackTexture",{get:function(){return b.a.UseFallbackTexture},set:function(N){b.a.UseFallbackTexture=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"RegisteredExternalClasses",{get:function(){return A.a.RegisteredExternalClasses},set:function(N){A.a.RegisteredExternalClasses=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"fallbackTexture",{get:function(){return b.a.FallbackTexture},set:function(N){b.a.FallbackTexture=N},enumerable:!1,configurable:!0}),O.FetchToRef=function(N,V,U,L,j,Y){var W=4*((Math.abs(N)*U%U|0)+(Math.abs(V)*L%L|0)*U);Y.r=j[W]/255,Y.g=j[W+1]/255,Y.b=j[W+2]/255,Y.a=j[W+3]/255},O.Mix=function(N,V,U){return N*(1-U)+V*U},O.Instantiate=function(N){return A.a.Instantiate(N)},O.Slice=function(N,V,U){return N.slice?N.slice(V,U):Array.prototype.slice.call(N,V,U)},O.SliceToArray=function(N,V,U){return Array.isArray(N)?N.slice(V,U):Array.prototype.slice.call(N,V,U)},O.SetImmediate=function(N){P.a.SetImmediate(N)},O.IsExponentOfTwo=function(N){var V=1;do V*=2;while(V<N);return V===N},O.FloatRound=function(N){return Math.fround?Math.fround(N):O._tmpFloatArray[0]=N},O.GetFilename=function(N){var V=N.lastIndexOf("/");return V<0?N:N.substring(V+1)},O.GetFolderPath=function(N,V){V===void 0&&(V=!1);var U=N.lastIndexOf("/");return U<0?V?N:"":N.substring(0,U+1)},O.ToDegrees=function(N){return 180*N/Math.PI},O.ToRadians=function(N){return N*Math.PI/180},O.MakeArray=function(N,V){return V===!0||N!==void 0&&N!=null?Array.isArray(N)?N:[N]:null},O.GetPointerPrefix=function(N){var V="pointer";return m.a.IsWindowObjectExist()&&!window.PointerEvent&&m.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(V="mouse"),!N._badDesktopOS||N._badOS||document&&"ontouchend"in document||(V="mouse"),V},O.SetCorsBehavior=function(N,V){f.a.SetCorsBehavior(N,V)},O.CleanUrl=function(N){return N=N.replace(/#/gm,"%23")},Object.defineProperty(O,"PreprocessUrl",{get:function(){return f.a.PreprocessUrl},set:function(N){f.a.PreprocessUrl=N},enumerable:!1,configurable:!0}),O.LoadImage=function(N,V,U,L,j){return f.a.LoadImage(N,V,U,L,j)},O.LoadFile=function(N,V,U,L,j,Y){return f.a.LoadFile(N,V,U,L,j,Y)},O.LoadFileAsync=function(N,V){return V===void 0&&(V=!0),new Promise(function(U,L){f.a.LoadFile(N,function(j){U(j)},void 0,void 0,V,function(j,Y){L(Y)})})},O.LoadScript=function(N,V,U,L){if(m.a.IsWindowObjectExist()){var j=document.getElementsByTagName("head")[0],Y=document.createElement("script");Y.setAttribute("type","text/javascript"),Y.setAttribute("src",N),L&&(Y.id=L),Y.onload=function(){V&&V()},Y.onerror=function(W){U&&U("Unable to load script '"+N+"'",W)},j.appendChild(Y)}},O.LoadScriptAsync=function(N,V){var U=this;return new Promise(function(L,j){U.LoadScript(N,function(){L()},function(Y,W){j(W)})})},O.ReadFileAsDataURL=function(N,V,U){var L=new FileReader,j={onCompleteObservable:new E.c,abort:function(){return L.abort()}};return L.onloadend=function(Y){j.onCompleteObservable.notifyObservers(j)},L.onload=function(Y){V(Y.target.result)},L.onprogress=U,L.readAsDataURL(N),j},O.ReadFile=function(N,V,U,L,j){return f.a.ReadFile(N,V,U,L,j)},O.FileAsURL=function(N){var V=new Blob([N]);return(window.URL||window.webkitURL).createObjectURL(V)},O.Format=function(N,V){return V===void 0&&(V=2),N.toFixed(V)},O.DeepCopy=function(N,V,U,L){h.a.DeepCopy(N,V,U,L)},O.IsEmpty=function(N){for(var V in N)if(N.hasOwnProperty(V))return!1;return!0},O.RegisterTopRootEvents=function(N,V){for(var U=0;U<V.length;U++){var L=V[U];N.addEventListener(L.name,L.handler,!1);try{window.parent&&window.parent.addEventListener(L.name,L.handler,!1)}catch(j){}}},O.UnregisterTopRootEvents=function(N,V){for(var U=0;U<V.length;U++){var L=V[U];N.removeEventListener(L.name,L.handler);try{N.parent&&N.parent.removeEventListener(L.name,L.handler)}catch(j){}}},O.DumpFramebuffer=function(N,V,U,L,j,Y){j===void 0&&(j="image/png");for(var W=4*N,ie=V/2,re=U.readPixels(0,0,N,V),ye=0;ye<ie;ye++)for(var ve=0;ve<W;ve++){var ue=ve+ye*W,oe=ve+(V-ye-1)*W,Z=re[ue];re[ue]=re[oe],re[oe]=Z}O._ScreenshotCanvas||(O._ScreenshotCanvas=document.createElement("canvas")),O._ScreenshotCanvas.width=N,O._ScreenshotCanvas.height=V;var J=O._ScreenshotCanvas.getContext("2d");if(J){var B=J.createImageData(N,V);B.data.set(re),J.putImageData(B,0,0),O.EncodeScreenshotCanvasData(L,j,Y)}},O.ToBlob=function(N,V,U){U===void 0&&(U="image/png"),N.toBlob||(N.toBlob=function(L,j,Y){var W=this;setTimeout(function(){for(var ie=atob(W.toDataURL(j,Y).split(",")[1]),re=ie.length,ye=new Uint8Array(re),ve=0;ve<re;ve++)ye[ve]=ie.charCodeAt(ve);L(new Blob([ye]))})}),N.toBlob(function(L){V(L)},U)},O.EncodeScreenshotCanvasData=function(N,V,U){V===void 0&&(V="image/png"),N?N(O._ScreenshotCanvas.toDataURL(V)):this.ToBlob(O._ScreenshotCanvas,function(L){if("download"in document.createElement("a")){if(!U){var j=new Date,Y=(j.getFullYear()+"-"+(j.getMonth()+1)).slice(2)+"-"+j.getDate()+"_"+j.getHours()+"-"+("0"+j.getMinutes()).slice(-2);U="screenshot_"+Y+".png"}O.Download(L,U)}else{var W=URL.createObjectURL(L),ie=window.open("");if(!ie)return;var re=ie.document.createElement("img");re.onload=function(){URL.revokeObjectURL(W)},re.src=W,ie.document.body.appendChild(re)}},V)},O.Download=function(N,V){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(N,V);else{var U=window.URL.createObjectURL(N),L=document.createElement("a");document.body.appendChild(L),L.style.display="none",L.href=U,L.download=V,L.addEventListener("click",function(){L.parentElement&&L.parentElement.removeChild(L)}),L.click(),window.URL.revokeObjectURL(U)}},O.BackCompatCameraNoPreventDefault=function(N){return typeof N[0]=="boolean"?N[0]:typeof N[1]=="boolean"&&N[1]},O.CreateScreenshot=function(N,V,U,L,j){throw R.a.WarnImport("ScreenshotTools")},O.CreateScreenshotAsync=function(N,V,U,L){throw R.a.WarnImport("ScreenshotTools")},O.CreateScreenshotUsingRenderTarget=function(N,V,U,L,j,Y,W,ie){throw R.a.WarnImport("ScreenshotTools")},O.CreateScreenshotUsingRenderTargetAsync=function(N,V,U,L,j,Y,W){throw R.a.WarnImport("ScreenshotTools")},O.RandomId=function(){return T.a.RandomId()},O.IsBase64=function(N){return!(N.length<5)&&N.substr(0,5)==="data:"},O.DecodeBase64=function(N){for(var V=atob(N.split(",")[1]),U=V.length,L=new Uint8Array(new ArrayBuffer(U)),j=0;j<U;j++)L[j]=V.charCodeAt(j);return L.buffer},O.GetAbsoluteUrl=function(N){var V=document.createElement("a");return V.href=N,V.href},Object.defineProperty(O,"errorsCount",{get:function(){return S.a.errorsCount},enumerable:!1,configurable:!0}),O.Log=function(N){S.a.Log(N)},O.Warn=function(N){S.a.Warn(N)},O.Error=function(N){S.a.Error(N)},Object.defineProperty(O,"LogCache",{get:function(){return S.a.LogCache},enumerable:!1,configurable:!0}),O.ClearLogCache=function(){S.a.ClearLogCache()},Object.defineProperty(O,"LogLevels",{set:function(N){S.a.LogLevels=N},enumerable:!1,configurable:!0}),Object.defineProperty(O,"PerformanceLogLevel",{set:function(N){return(N&O.PerformanceUserMarkLogLevel)===O.PerformanceUserMarkLogLevel?(O.StartPerformanceCounter=O._StartUserMark,void(O.EndPerformanceCounter=O._EndUserMark)):(N&O.PerformanceConsoleLogLevel)===O.PerformanceConsoleLogLevel?(O.StartPerformanceCounter=O._StartPerformanceConsole,void(O.EndPerformanceCounter=O._EndPerformanceConsole)):(O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,void(O.EndPerformanceCounter=O._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),O._StartPerformanceCounterDisabled=function(N,V){},O._EndPerformanceCounterDisabled=function(N,V){},O._StartUserMark=function(N,V){if(V===void 0&&(V=!0),!O._performance){if(!m.a.IsWindowObjectExist())return;O._performance=window.performance}V&&O._performance.mark&&O._performance.mark(N+"-Begin")},O._EndUserMark=function(N,V){V===void 0&&(V=!0),V&&O._performance.mark&&(O._performance.mark(N+"-End"),O._performance.measure(N,N+"-Begin",N+"-End"))},O._StartPerformanceConsole=function(N,V){V===void 0&&(V=!0),V&&(O._StartUserMark(N,V),console.time&&console.time(N))},O._EndPerformanceConsole=function(N,V){V===void 0&&(V=!0),V&&(O._EndUserMark(N,V),console.timeEnd(N))},Object.defineProperty(O,"Now",{get:function(){return C.a.Now},enumerable:!1,configurable:!0}),O.GetClassName=function(N,V){V===void 0&&(V=!1);var U=null;return!V&&N.getClassName?U=N.getClassName():(N instanceof Object&&(U=(V?N:Object.getPrototypeOf(N)).constructor.__bjsclassName__),U||(U=typeof N)),U},O.First=function(N,V){for(var U=0,L=N;U<L.length;U++){var j=L[U];if(V(j))return j}return null},O.getFullClassName=function(N,V){V===void 0&&(V=!1);var U=null,L=null;if(!V&&N.getClassName)U=N.getClassName();else{if(N instanceof Object){var j=V?N:Object.getPrototypeOf(N);U=j.constructor.__bjsclassName__,L=j.constructor.__bjsmoduleName__}U||(U=typeof N)}return U?(L!=null?L+".":"")+U:null},O.DelayAsync=function(N){return new Promise(function(V){setTimeout(function(){V()},N)})},O.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},O.UseCustomRequestHeaders=!1,O.CustomRequestHeaders=I.a.CustomRequestHeaders,O._tmpFloatArray=new Float32Array(1),O.GetDOMTextContent=m.a.GetDOMTextContent,O.NoneLogLevel=S.a.NoneLogLevel,O.MessageLogLevel=S.a.MessageLogLevel,O.WarningLogLevel=S.a.WarningLogLevel,O.ErrorLogLevel=S.a.ErrorLogLevel,O.AllLogLevel=S.a.AllLogLevel,O.IsWindowObjectExist=m.a.IsWindowObjectExist,O.PerformanceNoneLogLevel=0,O.PerformanceUserMarkLogLevel=1,O.PerformanceConsoleLogLevel=2,O.StartPerformanceCounter=O._StartPerformanceCounterDisabled,O.EndPerformanceCounter=O._EndPerformanceCounterDisabled,O}();function g(O,N){return function(V){V.__bjsclassName__=O,V.__bjsmoduleName__=N??null}}var M=function(){function O(N,V,U,L){L===void 0&&(L=0),this.iterations=N,this.index=L-1,this._done=!1,this._fn=V,this._successCallback=U}return O.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},O.prototype.breakLoop=function(){this._done=!0,this._successCallback()},O.Run=function(N,V,U,L){L===void 0&&(L=0);var j=new O(N,V,U,L);return j.executeNext(),j},O.SyncAsyncForLoop=function(N,V,U,L,j,Y){return Y===void 0&&(Y=0),O.Run(Math.ceil(N/V),function(W){j&&j()?W.breakLoop():setTimeout(function(){for(var ie=0;ie<V;++ie){var re=W.index*V+ie;if(re>=N)break;if(U(re),j&&j()){W.breakLoop();break}}W.executeNext()},Y)},L)},O}();b.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",x.a.Apply()},function(p,s,c){c.d(s,"a",function(){return A});var E=c(1),m=c(6),S=c(38),h=c(22),C=c(21),R=c(26),I=c(2),b=c(146),f=c(55),x=c(88),P=c(8),A=(c(123),c(129),c(124),function(T){function _(g,M,O,N){N===void 0&&(N=!1);var V=T.call(this,g,M,O,N)||this;if(V.enableOfflineSupport=!1,V.disableManifestCheck=!1,V.scenes=new Array,V.onNewSceneAddedObservable=new m.c,V.postProcesses=new Array,V.isPointerLock=!1,V.onResizeObservable=new m.c,V.onCanvasBlurObservable=new m.c,V.onCanvasFocusObservable=new m.c,V.onCanvasPointerOutObservable=new m.c,V.onBeginFrameObservable=new m.c,V.customAnimationFrameRequester=null,V.onEndFrameObservable=new m.c,V.onBeforeShaderCompilationObservable=new m.c,V.onAfterShaderCompilationObservable=new m.c,V._deterministicLockstep=!1,V._lockstepMaxSteps=4,V._timeStep=1/60,V._fps=60,V._deltaTime=0,V._drawCalls=new f.a,V.canvasTabIndex=1,V.disablePerformanceMonitorInBackground=!1,V._performanceMonitor=new b.a,_.Instances.push(V),!g)return V;if(O=V._creationOptions,g.getContext){var U=g;if(V._onCanvasFocus=function(){V.onCanvasFocusObservable.notifyObservers(V)},V._onCanvasBlur=function(){V.onCanvasBlurObservable.notifyObservers(V)},U.addEventListener("focus",V._onCanvasFocus),U.addEventListener("blur",V._onCanvasBlur),V._onBlur=function(){V.disablePerformanceMonitorInBackground&&V._performanceMonitor.disable(),V._windowIsBackground=!0},V._onFocus=function(){V.disablePerformanceMonitorInBackground&&V._performanceMonitor.enable(),V._windowIsBackground=!1},V._onCanvasPointerOut=function(Y){V.onCanvasPointerOutObservable.notifyObservers(Y)},U.addEventListener("pointerout",V._onCanvasPointerOut),S.a.IsWindowObjectExist()){var L=V.getHostWindow();L.addEventListener("blur",V._onBlur),L.addEventListener("focus",V._onFocus);var j=document;V._onFullscreenChange=function(){j.fullscreen!==void 0?V.isFullscreen=j.fullscreen:j.mozFullScreen!==void 0?V.isFullscreen=j.mozFullScreen:j.webkitIsFullScreen!==void 0?V.isFullscreen=j.webkitIsFullScreen:j.msIsFullScreen!==void 0&&(V.isFullscreen=j.msIsFullScreen),V.isFullscreen&&V._pointerLockRequested&&U&&_._RequestPointerlock(U)},document.addEventListener("fullscreenchange",V._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",V._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",V._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",V._onFullscreenChange,!1),V._onPointerLockChange=function(){V.isPointerLock=j.mozPointerLockElement===U||j.webkitPointerLockElement===U||j.msPointerLockElement===U||j.pointerLockElement===U},document.addEventListener("pointerlockchange",V._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",V._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",V._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",V._onPointerLockChange,!1),!_.audioEngine&&O.audioEngine&&_.AudioEngineFactory&&(_.audioEngine=_.AudioEngineFactory(V.getRenderingCanvas()))}V._connectVREvents(),V.enableOfflineSupport=_.OfflineProviderFactory!==void 0,O.doNotHandleTouchAction||V._disableTouchAction(),V._deterministicLockstep=!!O.deterministicLockstep,V._lockstepMaxSteps=O.lockstepMaxSteps||0,V._timeStep=O.timeStep||1/60}return V._prepareVRComponent(),O.autoEnableWebVR&&V.initWebVR(),V}return Object(E.d)(_,T),Object.defineProperty(_,"NpmPackage",{get:function(){return R.a.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(_,"Version",{get:function(){return R.a.Version},enumerable:!1,configurable:!0}),Object.defineProperty(_,"Instances",{get:function(){return h.a.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(_,"LastCreatedEngine",{get:function(){return h.a.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(_,"LastCreatedScene",{get:function(){return h.a.LastCreatedScene},enumerable:!1,configurable:!0}),_.MarkAllMaterialsAsDirty=function(g,M){for(var O=0;O<_.Instances.length;O++)for(var N=_.Instances[O],V=0;V<N.scenes.length;V++)N.scenes[V].markAllMaterialsAsDirty(g,M)},_.DefaultLoadingScreenFactory=function(g){throw C.a.WarnImport("LoadingScreen")},Object.defineProperty(_.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!_._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),_.prototype.getInputElement=function(){return this._renderingCanvas},_.prototype.getAspectRatio=function(g,M){M===void 0&&(M=!1);var O=g.viewport;return this.getRenderWidth(M)*O.width/(this.getRenderHeight(M)*O.height)},_.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},_.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},_.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},_.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},_.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},_.prototype.getTimeStep=function(){return 1e3*this._timeStep},_.prototype.generateMipMapsForCubemap=function(g,M){if(M===void 0&&(M=!0),g.generateMipMaps){var O=this._gl;this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,g,!0),O.generateMipmap(O.TEXTURE_CUBE_MAP),M&&this._bindTextureDirectly(O.TEXTURE_CUBE_MAP,null)}},_.prototype.setState=function(g,M,O,N){M===void 0&&(M=0),N===void 0&&(N=!1),(this._depthCullingState.cull!==g||O)&&(this._depthCullingState.cull=g);var V=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==V||O)&&(this._depthCullingState.cullFace=V),this.setZOffset(M);var U=N?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==U||O)&&(this._depthCullingState.frontFace=U)},_.prototype.setZOffset=function(g){this._depthCullingState.zOffset=g},_.prototype.getZOffset=function(){return this._depthCullingState.zOffset},_.prototype.setDepthBuffer=function(g){this._depthCullingState.depthTest=g},_.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},_.prototype.setDepthWrite=function(g){this._depthCullingState.depthMask=g},_.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},_.prototype.setStencilBuffer=function(g){this._stencilState.stencilTest=g},_.prototype.getStencilMask=function(){return this._stencilState.stencilMask},_.prototype.setStencilMask=function(g){this._stencilState.stencilMask=g},_.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},_.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},_.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},_.prototype.setStencilFunction=function(g){this._stencilState.stencilFunc=g},_.prototype.setStencilFunctionReference=function(g){this._stencilState.stencilFuncRef=g},_.prototype.setStencilFunctionMask=function(g){this._stencilState.stencilFuncMask=g},_.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},_.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},_.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},_.prototype.setStencilOperationFail=function(g){this._stencilState.stencilOpStencilFail=g},_.prototype.setStencilOperationDepthFail=function(g){this._stencilState.stencilOpDepthFail=g},_.prototype.setStencilOperationPass=function(g){this._stencilState.stencilOpStencilDepthPass=g},_.prototype.setDitheringState=function(g){g?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},_.prototype.setRasterizerState=function(g){g?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},_.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},_.prototype.setDepthFunction=function(g){this._depthCullingState.depthFunc=g},_.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},_.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},_.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},_.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},_.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},_.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},_.prototype.setDirectViewport=function(g,M,O,N){var V=this._cachedViewport;return this._cachedViewport=null,this._viewport(g,M,O,N),V},_.prototype.scissorClear=function(g,M,O,N,V){this.enableScissor(g,M,O,N),this.clear(V,!0,!0,!0),this.disableScissor()},_.prototype.enableScissor=function(g,M,O,N){var V=this._gl;V.enable(V.SCISSOR_TEST),V.scissor(g,M,O,N)},_.prototype.disableScissor=function(){var g=this._gl;g.disable(g.SCISSOR_TEST)},_.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},_.prototype.initWebVR=function(){throw C.a.WarnImport("WebVRCamera")},_.prototype._prepareVRComponent=function(){},_.prototype._connectVREvents=function(g,M){},_.prototype._submitVRFrame=function(){},_.prototype.disableVR=function(){},_.prototype.isVRPresenting=function(){return!1},_.prototype._requestVRFrame=function(){},_.prototype._loadFileAsync=function(g,M,O){var N=this;return new Promise(function(V,U){N._loadFile(g,function(L){V(L)},void 0,M,O,function(L,j){U(j)})})},_.prototype.getVertexShaderSource=function(g){var M=this._gl.getAttachedShaders(g);return M?this._gl.getShaderSource(M[0]):null},_.prototype.getFragmentShaderSource=function(g){var M=this._gl.getAttachedShaders(g);return M?this._gl.getShaderSource(M[1]):null},_.prototype.setDepthStencilTexture=function(g,M,O){g!==void 0&&(M&&(this._boundUniforms[g]=M),O&&O.depthStencilTexture?this._setTexture(g,O,!1,!0):this._setTexture(g,null))},_.prototype.setTextureFromPostProcess=function(g,M){this._bindTexture(g,M?M._textures.data[M._currentRenderTextureInd]:null)},_.prototype.setTextureFromPostProcessOutput=function(g,M){this._bindTexture(g,M?M._outputTexture:null)},_.prototype._rebuildBuffers=function(){for(var g=0,M=this.scenes;g<M.length;g++){var O=M[g];O.resetCachedMaterial(),O._rebuildGeometries(),O._rebuildTextures()}T.prototype._rebuildBuffers.call(this)},_.prototype._renderFrame=function(){for(var g=0;g<this._activeRenderLoops.length;g++)(0,this._activeRenderLoops[g])()},_.prototype._renderLoop=function(){if(!this._contextWasLost){var g=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(g=!1),g&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},_.prototype._renderViews=function(){return!1},_.prototype.switchFullscreen=function(g){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(g)},_.prototype.enterFullscreen=function(g){this.isFullscreen||(this._pointerLockRequested=g,this._renderingCanvas&&_._RequestFullscreen(this._renderingCanvas))},_.prototype.exitFullscreen=function(){this.isFullscreen&&_._ExitFullscreen()},_.prototype.enterPointerlock=function(){this._renderingCanvas&&_._RequestPointerlock(this._renderingCanvas)},_.prototype.exitPointerlock=function(){_._ExitPointerlock()},_.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),T.prototype.beginFrame.call(this)},_.prototype.endFrame=function(){T.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},_.prototype.resize=function(){this.isVRPresenting()||T.prototype.resize.call(this)},_.prototype.setSize=function(g,M){if(!this._renderingCanvas||!T.prototype.setSize.call(this,g,M))return!1;if(this.scenes){for(var O=0;O<this.scenes.length;O++)for(var N=this.scenes[O],V=0;V<N.cameras.length;V++)N.cameras[V]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},_.prototype._deletePipelineContext=function(g){var M=g;M&&M.program&&M.transformFeedback&&(this.deleteTransformFeedback(M.transformFeedback),M.transformFeedback=null),T.prototype._deletePipelineContext.call(this,g)},_.prototype.createShaderProgram=function(g,M,O,N,V,U){U===void 0&&(U=null),V=V||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var L=T.prototype.createShaderProgram.call(this,g,M,O,N,V,U);return this.onAfterShaderCompilationObservable.notifyObservers(this),L},_.prototype._createShaderProgram=function(g,M,O,N,V){V===void 0&&(V=null);var U=N.createProgram();if(g.program=U,!U)throw new Error("Unable to create program");if(N.attachShader(U,M),N.attachShader(U,O),this.webGLVersion>1&&V){var L=this.createTransformFeedback();this.bindTransformFeedback(L),this.setTranformFeedbackVaryings(U,V),g.transformFeedback=L}return N.linkProgram(U),this.webGLVersion>1&&V&&this.bindTransformFeedback(null),g.context=N,g.vertexShader=M,g.fragmentShader=O,g.isParallelCompiled||this._finalizePipelineContext(g),U},_.prototype._releaseTexture=function(g){T.prototype._releaseTexture.call(this,g),this.scenes.forEach(function(M){M.postProcesses.forEach(function(O){O._outputTexture==g&&(O._outputTexture=null)}),M.cameras.forEach(function(O){O._postProcesses.forEach(function(N){N&&N._outputTexture==g&&(N._outputTexture=null)})})})},_.prototype._rescaleTexture=function(g,M,O,N,V){var U=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var L=this.createRenderTargetTexture({width:M.width,height:M.height},{generateMipMaps:!1,type:I.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:I.a.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&_._RescalePostProcessFactory&&(this._rescalePostProcess=_._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){U._rescalePostProcess.onApply=function(Y){Y._bindTexture("textureSampler",g)};var j=O;j||(j=U.scenes[U.scenes.length-1]),j.postProcessManager.directRender([U._rescalePostProcess],L,!0),U._bindTextureDirectly(U._gl.TEXTURE_2D,M,!0),U._gl.copyTexImage2D(U._gl.TEXTURE_2D,0,N,0,0,M.width,M.height,0),U.unBindFramebuffer(L),U._releaseTexture(L),V&&V()})},_.prototype.getFps=function(){return this._fps},_.prototype.getDeltaTime=function(){return this._deltaTime},_.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},_.prototype._uploadImageToTexture=function(g,M,O,N){O===void 0&&(O=0),N===void 0&&(N=0);var V=this._gl,U=this._getWebGLTextureType(g.type),L=this._getInternalFormat(g.format),j=this._getRGBABufferInternalSizedFormat(g.type,L),Y=g.isCube?V.TEXTURE_CUBE_MAP:V.TEXTURE_2D;this._bindTextureDirectly(Y,g,!0),this._unpackFlipY(g.invertY);var W=V.TEXTURE_2D;g.isCube&&(W=V.TEXTURE_CUBE_MAP_POSITIVE_X+O),V.texImage2D(W,N,j,L,U,M),this._bindTextureDirectly(Y,null,!0)},_.prototype.updateRenderTargetTextureSampleCount=function(g,M){if(this.webGLVersion<2||!g)return 1;if(g.samples===M)return M;var O=this._gl;if(M=Math.min(M,this.getCaps().maxMSAASamples),g._depthStencilBuffer&&(O.deleteRenderbuffer(g._depthStencilBuffer),g._depthStencilBuffer=null),g._MSAAFramebuffer&&(O.deleteFramebuffer(g._MSAAFramebuffer),g._MSAAFramebuffer=null),g._MSAARenderBuffer&&(O.deleteRenderbuffer(g._MSAARenderBuffer),g._MSAARenderBuffer=null),M>1&&O.renderbufferStorageMultisample){var N=O.createFramebuffer();if(!N)throw new Error("Unable to create multi sampled framebuffer");g._MSAAFramebuffer=N,this._bindUnboundFramebuffer(g._MSAAFramebuffer);var V=O.createRenderbuffer();if(!V)throw new Error("Unable to create multi sampled framebuffer");O.bindRenderbuffer(O.RENDERBUFFER,V),O.renderbufferStorageMultisample(O.RENDERBUFFER,M,this._getRGBAMultiSampleBufferFormat(g.type),g.width,g.height),O.framebufferRenderbuffer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.RENDERBUFFER,V),g._MSAARenderBuffer=V}else this._bindUnboundFramebuffer(g._framebuffer);return g.samples=M,g._depthStencilBuffer=this._setupFramebufferDepthAttachments(g._generateStencilBuffer,g._generateDepthBuffer,g.width,g.height,M),this._bindUnboundFramebuffer(null),M},_.prototype.updateTextureComparisonFunction=function(g,M){if(this.webGLVersion!==1){var O=this._gl;g.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,!0),M===0?(O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_COMPARE_FUNC,I.a.LEQUAL),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_COMPARE_MODE,O.NONE)):(O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_COMPARE_FUNC,M),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_COMPARE_MODE,O.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0),M===0?(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_COMPARE_FUNC,I.a.LEQUAL),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_COMPARE_MODE,O.NONE)):(O.texParameteri(O.TEXTURE_2D,O.TEXTURE_COMPARE_FUNC,M),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_COMPARE_MODE,O.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),g._comparisonFunction=M}else P.a.Error("WebGL 1 does not support texture comparison.")},_.prototype.createInstancesBuffer=function(g){var M=this._gl.createBuffer();if(!M)throw new Error("Unable to create instance buffer");var O=new x.a(M);return O.capacity=g,this.bindArrayBuffer(O),this._gl.bufferData(this._gl.ARRAY_BUFFER,g,this._gl.DYNAMIC_DRAW),O},_.prototype.deleteInstancesBuffer=function(g){this._gl.deleteBuffer(g)},_.prototype._clientWaitAsync=function(g,M,O){M===void 0&&(M=0),O===void 0&&(O=10);var N=this._gl;return new Promise(function(V,U){var L=function(){var j=N.clientWaitSync(g,M,0);j!=N.WAIT_FAILED?j!=N.TIMEOUT_EXPIRED?V():setTimeout(L,O):U()};L()})},_.prototype._readPixelsAsync=function(g,M,O,N,V,U,L){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var j=this._gl,Y=j.createBuffer();j.bindBuffer(j.PIXEL_PACK_BUFFER,Y),j.bufferData(j.PIXEL_PACK_BUFFER,L.byteLength,j.STREAM_READ),j.readPixels(g,M,O,N,V,U,0),j.bindBuffer(j.PIXEL_PACK_BUFFER,null);var W=j.fenceSync(j.SYNC_GPU_COMMANDS_COMPLETE,0);return W?(j.flush(),this._clientWaitAsync(W,0,10).then(function(){return j.deleteSync(W),j.bindBuffer(j.PIXEL_PACK_BUFFER,Y),j.getBufferSubData(j.PIXEL_PACK_BUFFER,0,L),j.bindBuffer(j.PIXEL_PACK_BUFFER,null),j.deleteBuffer(Y),L})):null},_.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();_.Instances.length===1&&_.audioEngine&&_.audioEngine.dispose(),this.disableVR(),S.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),S.a.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),T.prototype.dispose.call(this);var g=_.Instances.indexOf(this);g>=0&&_.Instances.splice(g,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},_.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},_.prototype.displayLoadingUI=function(){if(S.a.IsWindowObjectExist()){var g=this.loadingScreen;g&&g.displayLoadingUI()}},_.prototype.hideLoadingUI=function(){if(S.a.IsWindowObjectExist()){var g=this._loadingScreen;g&&g.hideLoadingUI()}},Object.defineProperty(_.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=_.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(g){this._loadingScreen=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIText",{set:function(g){this.loadingScreen.loadingUIText=g},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"loadingUIBackgroundColor",{set:function(g){this.loadingScreen.loadingUIBackgroundColor=g},enumerable:!1,configurable:!0}),_._RequestPointerlock=function(g){g.requestPointerLock=g.requestPointerLock||g.msRequestPointerLock||g.mozRequestPointerLock||g.webkitRequestPointerLock,g.requestPointerLock&&g.requestPointerLock()},_._ExitPointerlock=function(){var g=document;document.exitPointerLock=document.exitPointerLock||g.msExitPointerLock||g.mozExitPointerLock||g.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},_._RequestFullscreen=function(g){var M=g.requestFullscreen||g.msRequestFullscreen||g.webkitRequestFullscreen||g.mozRequestFullScreen;M&&M.call(g)},_._ExitFullscreen=function(){var g=document;document.exitFullscreen?document.exitFullscreen():g.mozCancelFullScreen?g.mozCancelFullScreen():g.webkitCancelFullScreen?g.webkitCancelFullScreen():g.msCancelFullScreen&&g.msCancelFullScreen()},_.ALPHA_DISABLE=I.a.ALPHA_DISABLE,_.ALPHA_ADD=I.a.ALPHA_ADD,_.ALPHA_COMBINE=I.a.ALPHA_COMBINE,_.ALPHA_SUBTRACT=I.a.ALPHA_SUBTRACT,_.ALPHA_MULTIPLY=I.a.ALPHA_MULTIPLY,_.ALPHA_MAXIMIZED=I.a.ALPHA_MAXIMIZED,_.ALPHA_ONEONE=I.a.ALPHA_ONEONE,_.ALPHA_PREMULTIPLIED=I.a.ALPHA_PREMULTIPLIED,_.ALPHA_PREMULTIPLIED_PORTERDUFF=I.a.ALPHA_PREMULTIPLIED_PORTERDUFF,_.ALPHA_INTERPOLATE=I.a.ALPHA_INTERPOLATE,_.ALPHA_SCREENMODE=I.a.ALPHA_SCREENMODE,_.DELAYLOADSTATE_NONE=I.a.DELAYLOADSTATE_NONE,_.DELAYLOADSTATE_LOADED=I.a.DELAYLOADSTATE_LOADED,_.DELAYLOADSTATE_LOADING=I.a.DELAYLOADSTATE_LOADING,_.DELAYLOADSTATE_NOTLOADED=I.a.DELAYLOADSTATE_NOTLOADED,_.NEVER=I.a.NEVER,_.ALWAYS=I.a.ALWAYS,_.LESS=I.a.LESS,_.EQUAL=I.a.EQUAL,_.LEQUAL=I.a.LEQUAL,_.GREATER=I.a.GREATER,_.GEQUAL=I.a.GEQUAL,_.NOTEQUAL=I.a.NOTEQUAL,_.KEEP=I.a.KEEP,_.REPLACE=I.a.REPLACE,_.INCR=I.a.INCR,_.DECR=I.a.DECR,_.INVERT=I.a.INVERT,_.INCR_WRAP=I.a.INCR_WRAP,_.DECR_WRAP=I.a.DECR_WRAP,_.TEXTURE_CLAMP_ADDRESSMODE=I.a.TEXTURE_CLAMP_ADDRESSMODE,_.TEXTURE_WRAP_ADDRESSMODE=I.a.TEXTURE_WRAP_ADDRESSMODE,_.TEXTURE_MIRROR_ADDRESSMODE=I.a.TEXTURE_MIRROR_ADDRESSMODE,_.TEXTUREFORMAT_ALPHA=I.a.TEXTUREFORMAT_ALPHA,_.TEXTUREFORMAT_LUMINANCE=I.a.TEXTUREFORMAT_LUMINANCE,_.TEXTUREFORMAT_LUMINANCE_ALPHA=I.a.TEXTUREFORMAT_LUMINANCE_ALPHA,_.TEXTUREFORMAT_RGB=I.a.TEXTUREFORMAT_RGB,_.TEXTUREFORMAT_RGBA=I.a.TEXTUREFORMAT_RGBA,_.TEXTUREFORMAT_RED=I.a.TEXTUREFORMAT_RED,_.TEXTUREFORMAT_R=I.a.TEXTUREFORMAT_R,_.TEXTUREFORMAT_RG=I.a.TEXTUREFORMAT_RG,_.TEXTUREFORMAT_RED_INTEGER=I.a.TEXTUREFORMAT_RED_INTEGER,_.TEXTUREFORMAT_R_INTEGER=I.a.TEXTUREFORMAT_R_INTEGER,_.TEXTUREFORMAT_RG_INTEGER=I.a.TEXTUREFORMAT_RG_INTEGER,_.TEXTUREFORMAT_RGB_INTEGER=I.a.TEXTUREFORMAT_RGB_INTEGER,_.TEXTUREFORMAT_RGBA_INTEGER=I.a.TEXTUREFORMAT_RGBA_INTEGER,_.TEXTURETYPE_UNSIGNED_BYTE=I.a.TEXTURETYPE_UNSIGNED_BYTE,_.TEXTURETYPE_UNSIGNED_INT=I.a.TEXTURETYPE_UNSIGNED_INT,_.TEXTURETYPE_FLOAT=I.a.TEXTURETYPE_FLOAT,_.TEXTURETYPE_HALF_FLOAT=I.a.TEXTURETYPE_HALF_FLOAT,_.TEXTURETYPE_BYTE=I.a.TEXTURETYPE_BYTE,_.TEXTURETYPE_SHORT=I.a.TEXTURETYPE_SHORT,_.TEXTURETYPE_UNSIGNED_SHORT=I.a.TEXTURETYPE_UNSIGNED_SHORT,_.TEXTURETYPE_INT=I.a.TEXTURETYPE_INT,_.TEXTURETYPE_UNSIGNED_INTEGER=I.a.TEXTURETYPE_UNSIGNED_INTEGER,_.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=I.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,_.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=I.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,_.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=I.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,_.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=I.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,_.TEXTURETYPE_UNSIGNED_INT_24_8=I.a.TEXTURETYPE_UNSIGNED_INT_24_8,_.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=I.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,_.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=I.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,_.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=I.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,_.TEXTURE_NEAREST_SAMPLINGMODE=I.a.TEXTURE_NEAREST_SAMPLINGMODE,_.TEXTURE_BILINEAR_SAMPLINGMODE=I.a.TEXTURE_BILINEAR_SAMPLINGMODE,_.TEXTURE_TRILINEAR_SAMPLINGMODE=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE,_.TEXTURE_NEAREST_NEAREST_MIPLINEAR=I.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,_.TEXTURE_LINEAR_LINEAR_MIPNEAREST=I.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,_.TEXTURE_LINEAR_LINEAR_MIPLINEAR=I.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,_.TEXTURE_NEAREST_NEAREST_MIPNEAREST=I.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,_.TEXTURE_NEAREST_LINEAR_MIPNEAREST=I.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,_.TEXTURE_NEAREST_LINEAR_MIPLINEAR=I.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,_.TEXTURE_NEAREST_LINEAR=I.a.TEXTURE_NEAREST_LINEAR,_.TEXTURE_NEAREST_NEAREST=I.a.TEXTURE_NEAREST_NEAREST,_.TEXTURE_LINEAR_NEAREST_MIPNEAREST=I.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,_.TEXTURE_LINEAR_NEAREST_MIPLINEAR=I.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,_.TEXTURE_LINEAR_LINEAR=I.a.TEXTURE_LINEAR_LINEAR,_.TEXTURE_LINEAR_NEAREST=I.a.TEXTURE_LINEAR_NEAREST,_.TEXTURE_EXPLICIT_MODE=I.a.TEXTURE_EXPLICIT_MODE,_.TEXTURE_SPHERICAL_MODE=I.a.TEXTURE_SPHERICAL_MODE,_.TEXTURE_PLANAR_MODE=I.a.TEXTURE_PLANAR_MODE,_.TEXTURE_CUBIC_MODE=I.a.TEXTURE_CUBIC_MODE,_.TEXTURE_PROJECTION_MODE=I.a.TEXTURE_PROJECTION_MODE,_.TEXTURE_SKYBOX_MODE=I.a.TEXTURE_SKYBOX_MODE,_.TEXTURE_INVCUBIC_MODE=I.a.TEXTURE_INVCUBIC_MODE,_.TEXTURE_EQUIRECTANGULAR_MODE=I.a.TEXTURE_EQUIRECTANGULAR_MODE,_.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=I.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,_.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=I.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,_.SCALEMODE_FLOOR=I.a.SCALEMODE_FLOOR,_.SCALEMODE_NEAREST=I.a.SCALEMODE_NEAREST,_.SCALEMODE_CEILING=I.a.SCALEMODE_CEILING,_._RescalePostProcessFactory=null,_}(R.a))},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.WithinEpsilon=function(S,h,C){C===void 0&&(C=1401298e-51);var R=S-h;return-C<=R&&R<=C},m.ToHex=function(S){var h=S.toString(16);return S<=15?("0"+h).toUpperCase():h.toUpperCase()},m.Sign=function(S){return(S=+S)==0||isNaN(S)?S:S>0?1:-1},m.Clamp=function(S,h,C){return h===void 0&&(h=0),C===void 0&&(C=1),Math.min(C,Math.max(h,S))},m.Log2=function(S){return Math.log(S)*Math.LOG2E},m.Repeat=function(S,h){return S-Math.floor(S/h)*h},m.Normalize=function(S,h,C){return(S-h)/(C-h)},m.Denormalize=function(S,h,C){return S*(C-h)+h},m.DeltaAngle=function(S,h){var C=m.Repeat(h-S,360);return C>180&&(C-=360),C},m.PingPong=function(S,h){var C=m.Repeat(S,2*h);return h-Math.abs(C-h)},m.SmoothStep=function(S,h,C){var R=m.Clamp(C);return h*(R=-2*R*R*R+3*R*R)+S*(1-R)},m.MoveTowards=function(S,h,C){return Math.abs(h-S)<=C?h:S+m.Sign(h-S)*C},m.MoveTowardsAngle=function(S,h,C){var R=m.DeltaAngle(S,h),I=0;return-C<R&&R<C?I=h:(h=S+R,I=m.MoveTowards(S,h,C)),I},m.Lerp=function(S,h,C){return S+(h-S)*C},m.LerpAngle=function(S,h,C){var R=m.Repeat(h-S,360);return R>180&&(R-=360),S+R*m.Clamp(C)},m.InverseLerp=function(S,h,C){return S!=h?m.Clamp((C-S)/(h-S)):0},m.Hermite=function(S,h,C,R,I){var b=I*I,f=I*b;return S*(2*f-3*b+1)+C*(-2*f+3*b)+h*(f-2*b+I)+R*(f-b)},m.RandomRange=function(S,h){return S===h?S:Math.random()*(h-S)+S},m.RangeToPercent=function(S,h,C){return(S-h)/(C-h)},m.PercentToRange=function(S,h,C){return(C-h)*S+h},m.NormalizeRadians=function(S){return S-=m.TwoPi*Math.floor((S+Math.PI)/m.TwoPi)},m.TwoPi=2*Math.PI,m}()},function(p,s,c){c.d(s,"a",function(){return f});var E=c(8),m=c(20),S=c(22),h=c(4),C=c(48),R=c(2),I=c(9),b=c(119),f=function(){function x(){}return x.BindEyePosition=function(P,A,T){if(T===void 0&&(T="vEyePosition"),A._forcedViewPosition)P.setVector3(T,A._forcedViewPosition);else{var _=A.activeCamera.globalPosition;_||(_=A.activeCamera.devicePosition),P.setVector3(T,A._mirroredCameraPosition?A._mirroredCameraPosition:_)}},x.PrepareDefinesForMergedUV=function(P,A,T){A._needUVs=!0,A[T]=!0,P.getTextureMatrix().isIdentityAs3x2()?(A[T+"DIRECTUV"]=P.coordinatesIndex+1,P.coordinatesIndex===0?A.MAINUV1=!0:A.MAINUV2=!0):A[T+"DIRECTUV"]=0},x.BindTextureMatrix=function(P,A,T){var _=P.getTextureMatrix();A.updateMatrix(T+"Matrix",_)},x.GetFogState=function(P,A){return A.fogEnabled&&P.applyFog&&A.fogMode!==m.a.FOGMODE_NONE},x.PrepareDefinesForMisc=function(P,A,T,_,g,M,O){O._areMiscDirty&&(O.LOGARITHMICDEPTH=T,O.POINTSIZE=_,O.FOG=g&&this.GetFogState(P,A),O.NONUNIFORMSCALING=P.nonUniformScaling,O.ALPHATEST=M)},x.PrepareDefinesForFrameBoundValues=function(P,A,T,_,g,M){g===void 0&&(g=null),M===void 0&&(M=!1);var O,N,V,U,L,j,Y=!1;O=g??(P.clipPlane!==void 0&&P.clipPlane!==null),N=g??(P.clipPlane2!==void 0&&P.clipPlane2!==null),V=g??(P.clipPlane3!==void 0&&P.clipPlane3!==null),U=g??(P.clipPlane4!==void 0&&P.clipPlane4!==null),L=g??(P.clipPlane5!==void 0&&P.clipPlane5!==null),j=g??(P.clipPlane6!==void 0&&P.clipPlane6!==null),T.CLIPPLANE!==O&&(T.CLIPPLANE=O,Y=!0),T.CLIPPLANE2!==N&&(T.CLIPPLANE2=N,Y=!0),T.CLIPPLANE3!==V&&(T.CLIPPLANE3=V,Y=!0),T.CLIPPLANE4!==U&&(T.CLIPPLANE4=U,Y=!0),T.CLIPPLANE5!==L&&(T.CLIPPLANE5=L,Y=!0),T.CLIPPLANE6!==j&&(T.CLIPPLANE6=j,Y=!0),T.DEPTHPREPASS!==!A.getColorWrite()&&(T.DEPTHPREPASS=!T.DEPTHPREPASS,Y=!0),T.INSTANCES!==_&&(T.INSTANCES=_,Y=!0),T.THIN_INSTANCES!==M&&(T.THIN_INSTANCES=M,Y=!0),Y&&T.markAsUnprocessed()},x.PrepareDefinesForBones=function(P,A){if(P.useBones&&P.computeBonesUsingShaders&&P.skeleton){A.NUM_BONE_INFLUENCERS=P.numBoneInfluencers;var T=A.BONETEXTURE!==void 0;if(P.skeleton.isUsingTextureForMatrices&&T)A.BONETEXTURE=!0;else{A.BonesPerMesh=P.skeleton.bones.length+1,A.BONETEXTURE=!T&&void 0;var _=P.getScene().prePassRenderer;if(_&&_.enabled){var g=_.excludedSkinnedMesh.indexOf(P)===-1;A.BONES_VELOCITY_ENABLED=g}}}else A.NUM_BONE_INFLUENCERS=0,A.BonesPerMesh=0},x.PrepareDefinesForMorphTargets=function(P,A){var T=P.morphTargetManager;T?(A.MORPHTARGETS_UV=T.supportsUVs&&A.UV1,A.MORPHTARGETS_TANGENT=T.supportsTangents&&A.TANGENT,A.MORPHTARGETS_NORMAL=T.supportsNormals&&A.NORMAL,A.MORPHTARGETS=T.numInfluencers>0,A.NUM_MORPH_INFLUENCERS=T.numInfluencers):(A.MORPHTARGETS_UV=!1,A.MORPHTARGETS_TANGENT=!1,A.MORPHTARGETS_NORMAL=!1,A.MORPHTARGETS=!1,A.NUM_MORPH_INFLUENCERS=0)},x.PrepareDefinesForAttributes=function(P,A,T,_,g,M){if(g===void 0&&(g=!1),M===void 0&&(M=!0),!A._areAttributesDirty&&A._needNormals===A._normals&&A._needUVs===A._uvs)return!1;if(A._normals=A._needNormals,A._uvs=A._needUVs,A.NORMAL=A._needNormals&&P.isVerticesDataPresent(h.b.NormalKind),A._needNormals&&P.isVerticesDataPresent(h.b.TangentKind)&&(A.TANGENT=!0),A._needUVs?(A.UV1=P.isVerticesDataPresent(h.b.UVKind),A.UV2=P.isVerticesDataPresent(h.b.UV2Kind)):(A.UV1=!1,A.UV2=!1),T){var O=P.useVertexColors&&P.isVerticesDataPresent(h.b.ColorKind);A.VERTEXCOLOR=O,A.VERTEXALPHA=P.hasVertexAlpha&&O&&M}return _&&this.PrepareDefinesForBones(P,A),g&&this.PrepareDefinesForMorphTargets(P,A),!0},x.PrepareDefinesForMultiview=function(P,A){if(P.activeCamera){var T=A.MULTIVIEW;A.MULTIVIEW=P.activeCamera.outputRenderTarget!==null&&P.activeCamera.outputRenderTarget.getViewCount()>1,A.MULTIVIEW!=T&&A.markAsUnprocessed()}},x.PrepareDefinesForPrePass=function(P,A,T){var _=A.PREPASS;if(A._arePrePassDirty){var g=[{type:R.a.PREPASS_POSITION_TEXTURE_TYPE,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:R.a.PREPASS_VELOCITY_TEXTURE_TYPE,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:R.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:R.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:R.a.PREPASS_ALBEDO_TEXTURE_TYPE,define:"PREPASS_ALBEDO",index:"PREPASS_ALBEDO_INDEX"},{type:R.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,define:"PREPASS_DEPTHNORMAL",index:"PREPASS_DEPTHNORMAL_INDEX"}];if(P.prePassRenderer&&P.prePassRenderer.enabled&&T){A.PREPASS=!0,A.SCENE_MRT_COUNT=P.prePassRenderer.mrtCount;for(var M=0;M<g.length;M++){var O=P.prePassRenderer.getIndex(g[M].type);O!==-1?(A[g[M].define]=!0,A[g[M].index]=O):A[g[M].define]=!1}}else for(A.PREPASS=!1,M=0;M<g.length;M++)A[g[M].define]=!1;A.PREPASS!=_&&(A.markAsUnprocessed(),A.markAsImageProcessingDirty())}},x.PrepareDefinesForLight=function(P,A,T,_,g,M,O){switch(O.needNormals=!0,g["LIGHT"+_]===void 0&&(O.needRebuild=!0),g["LIGHT"+_]=!0,g["SPOTLIGHT"+_]=!1,g["HEMILIGHT"+_]=!1,g["POINTLIGHT"+_]=!1,g["DIRLIGHT"+_]=!1,T.prepareLightSpecificDefines(g,_),g["LIGHT_FALLOFF_PHYSICAL"+_]=!1,g["LIGHT_FALLOFF_GLTF"+_]=!1,g["LIGHT_FALLOFF_STANDARD"+_]=!1,T.falloffType){case C.a.FALLOFF_GLTF:g["LIGHT_FALLOFF_GLTF"+_]=!0;break;case C.a.FALLOFF_PHYSICAL:g["LIGHT_FALLOFF_PHYSICAL"+_]=!0;break;case C.a.FALLOFF_STANDARD:g["LIGHT_FALLOFF_STANDARD"+_]=!0}if(M&&!T.specular.equalsFloats(0,0,0)&&(O.specularEnabled=!0),g["SHADOW"+_]=!1,g["SHADOWCSM"+_]=!1,g["SHADOWCSMDEBUG"+_]=!1,g["SHADOWCSMNUM_CASCADES"+_]=!1,g["SHADOWCSMUSESHADOWMAXZ"+_]=!1,g["SHADOWCSMNOBLEND"+_]=!1,g["SHADOWCSM_RIGHTHANDED"+_]=!1,g["SHADOWPCF"+_]=!1,g["SHADOWPCSS"+_]=!1,g["SHADOWPOISSON"+_]=!1,g["SHADOWESM"+_]=!1,g["SHADOWCLOSEESM"+_]=!1,g["SHADOWCUBE"+_]=!1,g["SHADOWLOWQUALITY"+_]=!1,g["SHADOWMEDIUMQUALITY"+_]=!1,A&&A.receiveShadows&&P.shadowsEnabled&&T.shadowEnabled){var N=T.getShadowGenerator();if(N){var V=N.getShadowMap();V&&V.renderList&&V.renderList.length>0&&(O.shadowEnabled=!0,N.prepareDefines(g,_))}}T.lightmapMode!=C.a.LIGHTMAP_DEFAULT?(O.lightmapMode=!0,g["LIGHTMAPEXCLUDED"+_]=!0,g["LIGHTMAPNOSPECULAR"+_]=T.lightmapMode==C.a.LIGHTMAP_SHADOWSONLY):(g["LIGHTMAPEXCLUDED"+_]=!1,g["LIGHTMAPNOSPECULAR"+_]=!1)},x.PrepareDefinesForLights=function(P,A,T,_,g,M){if(g===void 0&&(g=4),M===void 0&&(M=!1),!T._areLightsDirty)return T._needNormals;var O=0,N={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(P.lightsEnabled&&!M)for(var V=0,U=A.lightSources;V<U.length;V++){var L=U[V];if(this.PrepareDefinesForLight(P,A,L,O,T,_,N),++O===g)break}T.SPECULARTERM=N.specularEnabled,T.SHADOWS=N.shadowEnabled;for(var j=O;j<g;j++)T["LIGHT"+j]!==void 0&&(T["LIGHT"+j]=!1,T["HEMILIGHT"+j]=!1,T["POINTLIGHT"+j]=!1,T["DIRLIGHT"+j]=!1,T["SPOTLIGHT"+j]=!1,T["SHADOW"+j]=!1,T["SHADOWCSM"+j]=!1,T["SHADOWCSMDEBUG"+j]=!1,T["SHADOWCSMNUM_CASCADES"+j]=!1,T["SHADOWCSMUSESHADOWMAXZ"+j]=!1,T["SHADOWCSMNOBLEND"+j]=!1,T["SHADOWCSM_RIGHTHANDED"+j]=!1,T["SHADOWPCF"+j]=!1,T["SHADOWPCSS"+j]=!1,T["SHADOWPOISSON"+j]=!1,T["SHADOWESM"+j]=!1,T["SHADOWCLOSEESM"+j]=!1,T["SHADOWCUBE"+j]=!1,T["SHADOWLOWQUALITY"+j]=!1,T["SHADOWMEDIUMQUALITY"+j]=!1);var Y=P.getEngine().getCaps();return T.SHADOWFLOAT===void 0&&(N.needRebuild=!0),T.SHADOWFLOAT=N.shadowEnabled&&(Y.textureFloatRender&&Y.textureFloatLinearFiltering||Y.textureHalfFloatRender&&Y.textureHalfFloatLinearFiltering),T.LIGHTMAPEXCLUDED=N.lightmapMode,N.needRebuild&&T.rebuild(),N.needNormals},x.PrepareUniformsAndSamplersForLight=function(P,A,T,_,g,M){g===void 0&&(g=null),M===void 0&&(M=!1),g&&g.push("Light"+P),M||(A.push("vLightData"+P,"vLightDiffuse"+P,"vLightSpecular"+P,"vLightDirection"+P,"vLightFalloff"+P,"vLightGround"+P,"lightMatrix"+P,"shadowsInfo"+P,"depthValues"+P),T.push("shadowSampler"+P),T.push("depthSampler"+P),A.push("viewFrustumZ"+P,"cascadeBlendFactor"+P,"lightSizeUVCorrection"+P,"depthCorrection"+P,"penumbraDarkness"+P,"frustumLengths"+P),_&&(T.push("projectionLightSampler"+P),A.push("textureProjectionMatrix"+P)))},x.PrepareUniformsAndSamplersList=function(P,A,T,_){var g;_===void 0&&(_=4);var M=null;if(P.uniformsNames){var O=P;g=O.uniformsNames,M=O.uniformBuffersNames,A=O.samplers,T=O.defines,_=O.maxSimultaneousLights||0}else g=P,A||(A=[]);for(var N=0;N<_&&T["LIGHT"+N];N++)this.PrepareUniformsAndSamplersForLight(N,g,A,T["PROJECTEDLIGHTTEXTURE"+N],M);T.NUM_MORPH_INFLUENCERS&&g.push("morphTargetInfluences")},x.HandleFallbacksForShadows=function(P,A,T,_){T===void 0&&(T=4),_===void 0&&(_=0);for(var g=0,M=0;M<T&&P["LIGHT"+M];M++)M>0&&(g=_+M,A.addFallback(g,"LIGHT"+M)),P.SHADOWS||(P["SHADOW"+M]&&A.addFallback(_,"SHADOW"+M),P["SHADOWPCF"+M]&&A.addFallback(_,"SHADOWPCF"+M),P["SHADOWPCSS"+M]&&A.addFallback(_,"SHADOWPCSS"+M),P["SHADOWPOISSON"+M]&&A.addFallback(_,"SHADOWPOISSON"+M),P["SHADOWESM"+M]&&A.addFallback(_,"SHADOWESM"+M),P["SHADOWCLOSEESM"+M]&&A.addFallback(_,"SHADOWCLOSEESM"+M));return g++},x.PrepareAttributesForMorphTargetsInfluencers=function(P,A,T){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=T,this.PrepareAttributesForMorphTargets(P,A,this._TmpMorphInfluencers)},x.PrepareAttributesForMorphTargets=function(P,A,T){var _=T.NUM_MORPH_INFLUENCERS;if(_>0&&S.a.LastCreatedEngine)for(var g=S.a.LastCreatedEngine.getCaps().maxVertexAttribs,M=A.morphTargetManager,O=M&&M.supportsNormals&&T.NORMAL,N=M&&M.supportsTangents&&T.TANGENT,V=M&&M.supportsUVs&&T.UV1,U=0;U<_;U++)P.push(h.b.PositionKind+U),O&&P.push(h.b.NormalKind+U),N&&P.push(h.b.TangentKind+U),V&&P.push(h.b.UVKind+"_"+U),P.length>g&&E.a.Error("Cannot add more vertex attributes for mesh "+A.name)},x.PrepareAttributesForBones=function(P,A,T,_){T.NUM_BONE_INFLUENCERS>0&&(_.addCPUSkinningFallback(0,A),P.push(h.b.MatricesIndicesKind),P.push(h.b.MatricesWeightsKind),T.NUM_BONE_INFLUENCERS>4&&(P.push(h.b.MatricesIndicesExtraKind),P.push(h.b.MatricesWeightsExtraKind)))},x.PrepareAttributesForInstances=function(P,A){(A.INSTANCES||A.THIN_INSTANCES)&&this.PushAttributesForInstances(P)},x.PushAttributesForInstances=function(P){P.push("world0"),P.push("world1"),P.push("world2"),P.push("world3")},x.BindLightProperties=function(P,A,T){P.transferToEffect(A,T+"")},x.BindLight=function(P,A,T,_,g,M){M===void 0&&(M=!1),P._bindLight(A,T,_,g,M)},x.BindLights=function(P,A,T,_,g,M){g===void 0&&(g=4),M===void 0&&(M=!1);for(var O=Math.min(A.lightSources.length,g),N=0;N<O;N++){var V=A.lightSources[N];this.BindLight(V,N,P,T,typeof _=="boolean"?_:_.SPECULARTERM,M)}},x.BindFogParameters=function(P,A,T,_){_===void 0&&(_=!1),P.fogEnabled&&A.applyFog&&P.fogMode!==m.a.FOGMODE_NONE&&(T.setFloat4("vFogInfos",P.fogMode,P.fogStart,P.fogEnd,P.fogDensity),_?(P.fogColor.toLinearSpaceToRef(this._tempFogColor),T.setColor3("vFogColor",this._tempFogColor)):T.setColor3("vFogColor",P.fogColor))},x.BindBonesParameters=function(P,A,T){if(A&&P&&(P.computeBonesUsingShaders&&A._bonesComputationForcedToCPU&&(P.computeBonesUsingShaders=!1),P.useBones&&P.computeBonesUsingShaders&&P.skeleton)){var _=P.skeleton;if(_.isUsingTextureForMatrices&&A.getUniformIndex("boneTextureWidth")>-1){var g=_.getTransformMatrixTexture(P);A.setTexture("boneSampler",g),A.setFloat("boneTextureWidth",4*(_.bones.length+1))}else{var M=_.getTransformMatrices(P);M&&(A.setMatrices("mBones",M),T&&P.getScene().prePassRenderer&&P.getScene().prePassRenderer.getIndex(R.a.PREPASS_VELOCITY_TEXTURE_TYPE)&&(T.previousBones[P.uniqueId]&&A.setMatrices("mPreviousBones",T.previousBones[P.uniqueId]),x._CopyBonesTransformationMatrices(M,T.previousBones[P.uniqueId])))}}},x._CopyBonesTransformationMatrices=function(P,A){return A.set(P),A},x.BindMorphTargetParameters=function(P,A){var T=P.morphTargetManager;P&&T&&A.setFloatArray("morphTargetInfluences",T.influences)},x.BindLogDepth=function(P,A,T){P.LOGARITHMICDEPTH&&A.setFloat("logarithmicDepthConstant",2/(Math.log(T.activeCamera.maxZ+1)/Math.LN2))},x.BindClipPlane=function(P,A){b.a.BindClipPlane(P,A)},x._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},x._tempFogColor=I.a.Black(),x}()},function(p,s,c){c.d(s,"a",function(){return R});var E=c(0),m=c(4),S=c(21),h=c(9),C=c(8),R=function(){function I(){}return I.prototype.set=function(b,f){switch(b.length||C.a.Warn("Setting vertex data kind '"+f+"' with an empty array"),f){case m.b.PositionKind:this.positions=b;break;case m.b.NormalKind:this.normals=b;break;case m.b.TangentKind:this.tangents=b;break;case m.b.UVKind:this.uvs=b;break;case m.b.UV2Kind:this.uvs2=b;break;case m.b.UV3Kind:this.uvs3=b;break;case m.b.UV4Kind:this.uvs4=b;break;case m.b.UV5Kind:this.uvs5=b;break;case m.b.UV6Kind:this.uvs6=b;break;case m.b.ColorKind:this.colors=b;break;case m.b.MatricesIndicesKind:this.matricesIndices=b;break;case m.b.MatricesWeightsKind:this.matricesWeights=b;break;case m.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=b;break;case m.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=b}},I.prototype.applyToMesh=function(b,f){return this._applyTo(b,f),this},I.prototype.applyToGeometry=function(b,f){return this._applyTo(b,f),this},I.prototype.updateMesh=function(b){return this._update(b),this},I.prototype.updateGeometry=function(b){return this._update(b),this},I.prototype._applyTo=function(b,f){return f===void 0&&(f=!1),this.positions&&b.setVerticesData(m.b.PositionKind,this.positions,f),this.normals&&b.setVerticesData(m.b.NormalKind,this.normals,f),this.tangents&&b.setVerticesData(m.b.TangentKind,this.tangents,f),this.uvs&&b.setVerticesData(m.b.UVKind,this.uvs,f),this.uvs2&&b.setVerticesData(m.b.UV2Kind,this.uvs2,f),this.uvs3&&b.setVerticesData(m.b.UV3Kind,this.uvs3,f),this.uvs4&&b.setVerticesData(m.b.UV4Kind,this.uvs4,f),this.uvs5&&b.setVerticesData(m.b.UV5Kind,this.uvs5,f),this.uvs6&&b.setVerticesData(m.b.UV6Kind,this.uvs6,f),this.colors&&b.setVerticesData(m.b.ColorKind,this.colors,f),this.matricesIndices&&b.setVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,f),this.matricesWeights&&b.setVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,f),this.matricesIndicesExtra&&b.setVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,f),this.matricesWeightsExtra&&b.setVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,f),this.indices?b.setIndices(this.indices,null,f):b.setIndices([],null),this},I.prototype._update=function(b,f,x){return this.positions&&b.updateVerticesData(m.b.PositionKind,this.positions,f,x),this.normals&&b.updateVerticesData(m.b.NormalKind,this.normals,f,x),this.tangents&&b.updateVerticesData(m.b.TangentKind,this.tangents,f,x),this.uvs&&b.updateVerticesData(m.b.UVKind,this.uvs,f,x),this.uvs2&&b.updateVerticesData(m.b.UV2Kind,this.uvs2,f,x),this.uvs3&&b.updateVerticesData(m.b.UV3Kind,this.uvs3,f,x),this.uvs4&&b.updateVerticesData(m.b.UV4Kind,this.uvs4,f,x),this.uvs5&&b.updateVerticesData(m.b.UV5Kind,this.uvs5,f,x),this.uvs6&&b.updateVerticesData(m.b.UV6Kind,this.uvs6,f,x),this.colors&&b.updateVerticesData(m.b.ColorKind,this.colors,f,x),this.matricesIndices&&b.updateVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,f,x),this.matricesWeights&&b.updateVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,f,x),this.matricesIndicesExtra&&b.updateVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,f,x),this.matricesWeightsExtra&&b.updateVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,f,x),this.indices&&b.setIndices(this.indices,null),this},I.prototype.transform=function(b){var f,x=b.determinant()<0,P=E.e.Zero();if(this.positions){var A=E.e.Zero();for(f=0;f<this.positions.length;f+=3)E.e.FromArrayToRef(this.positions,f,A),E.e.TransformCoordinatesToRef(A,b,P),this.positions[f]=P.x,this.positions[f+1]=P.y,this.positions[f+2]=P.z}if(this.normals){var T=E.e.Zero();for(f=0;f<this.normals.length;f+=3)E.e.FromArrayToRef(this.normals,f,T),E.e.TransformNormalToRef(T,b,P),this.normals[f]=P.x,this.normals[f+1]=P.y,this.normals[f+2]=P.z}if(this.tangents){var _=E.f.Zero(),g=E.f.Zero();for(f=0;f<this.tangents.length;f+=4)E.f.FromArrayToRef(this.tangents,f,_),E.f.TransformNormalToRef(_,b,g),this.tangents[f]=g.x,this.tangents[f+1]=g.y,this.tangents[f+2]=g.z,this.tangents[f+3]=g.w}if(x&&this.indices)for(f=0;f<this.indices.length;f+=3){var M=this.indices[f+1];this.indices[f+1]=this.indices[f+2],this.indices[f+2]=M}return this},I.prototype.merge=function(b,f){if(f===void 0&&(f=!1),this._validate(),b._validate(),!this.normals!=!b.normals||!this.tangents!=!b.tangents||!this.uvs!=!b.uvs||!this.uvs2!=!b.uvs2||!this.uvs3!=!b.uvs3||!this.uvs4!=!b.uvs4||!this.uvs5!=!b.uvs5||!this.uvs6!=!b.uvs6||!this.colors!=!b.colors||!this.matricesIndices!=!b.matricesIndices||!this.matricesWeights!=!b.matricesWeights||!this.matricesIndicesExtra!=!b.matricesIndicesExtra||!this.matricesWeightsExtra!=!b.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(b.indices){this.indices||(this.indices=[]);var x=this.positions?this.positions.length/3:0;if(this.indices.BYTES_PER_ELEMENT!==void 0){var P=this.indices.length+b.indices.length,A=f||this.indices instanceof Uint32Array?new Uint32Array(P):new Uint16Array(P);A.set(this.indices);for(var T=this.indices.length,_=0;_<b.indices.length;_++)A[T+_]=b.indices[_]+x;this.indices=A}else for(_=0;_<b.indices.length;_++)this.indices.push(b.indices[_]+x)}return this.positions=this._mergeElement(this.positions,b.positions),this.normals=this._mergeElement(this.normals,b.normals),this.tangents=this._mergeElement(this.tangents,b.tangents),this.uvs=this._mergeElement(this.uvs,b.uvs),this.uvs2=this._mergeElement(this.uvs2,b.uvs2),this.uvs3=this._mergeElement(this.uvs3,b.uvs3),this.uvs4=this._mergeElement(this.uvs4,b.uvs4),this.uvs5=this._mergeElement(this.uvs5,b.uvs5),this.uvs6=this._mergeElement(this.uvs6,b.uvs6),this.colors=this._mergeElement(this.colors,b.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,b.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,b.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,b.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,b.matricesWeightsExtra),this},I.prototype._mergeElement=function(b,f){if(!b)return f;if(!f)return b;var x=f.length+b.length,P=b instanceof Float32Array,A=f instanceof Float32Array;if(P){var T=new Float32Array(x);return T.set(b),T.set(f,b.length),T}if(A){var _=b.slice(0),g=0;for(x=f.length;g<x;g++)_.push(f[g]);return _}return b.concat(f)},I.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var b=function(P,A){var T=m.b.DeduceStride(P);if(A.length%T!=0)throw new Error("The "+P+"s array count must be a multiple of "+T);return A.length/T},f=b(m.b.PositionKind,this.positions),x=function(P,A){var T=b(P,A);if(T!==f)throw new Error("The "+P+"s element count ("+T+") does not match the positions count ("+f+")")};this.normals&&x(m.b.NormalKind,this.normals),this.tangents&&x(m.b.TangentKind,this.tangents),this.uvs&&x(m.b.UVKind,this.uvs),this.uvs2&&x(m.b.UV2Kind,this.uvs2),this.uvs3&&x(m.b.UV3Kind,this.uvs3),this.uvs4&&x(m.b.UV4Kind,this.uvs4),this.uvs5&&x(m.b.UV5Kind,this.uvs5),this.uvs6&&x(m.b.UV6Kind,this.uvs6),this.colors&&x(m.b.ColorKind,this.colors),this.matricesIndices&&x(m.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&x(m.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&x(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&x(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},I.prototype.serialize=function(){var b=this.serialize();return this.positions&&(b.positions=this.positions),this.normals&&(b.normals=this.normals),this.tangents&&(b.tangents=this.tangents),this.uvs&&(b.uvs=this.uvs),this.uvs2&&(b.uvs2=this.uvs2),this.uvs3&&(b.uvs3=this.uvs3),this.uvs4&&(b.uvs4=this.uvs4),this.uvs5&&(b.uvs5=this.uvs5),this.uvs6&&(b.uvs6=this.uvs6),this.colors&&(b.colors=this.colors),this.matricesIndices&&(b.matricesIndices=this.matricesIndices,b.matricesIndices._isExpanded=!0),this.matricesWeights&&(b.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(b.matricesIndicesExtra=this.matricesIndicesExtra,b.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(b.matricesWeightsExtra=this.matricesWeightsExtra),b.indices=this.indices,b},I.ExtractFromMesh=function(b,f,x){return I._ExtractFrom(b,f,x)},I.ExtractFromGeometry=function(b,f,x){return I._ExtractFrom(b,f,x)},I._ExtractFrom=function(b,f,x){var P=new I;return b.isVerticesDataPresent(m.b.PositionKind)&&(P.positions=b.getVerticesData(m.b.PositionKind,f,x)),b.isVerticesDataPresent(m.b.NormalKind)&&(P.normals=b.getVerticesData(m.b.NormalKind,f,x)),b.isVerticesDataPresent(m.b.TangentKind)&&(P.tangents=b.getVerticesData(m.b.TangentKind,f,x)),b.isVerticesDataPresent(m.b.UVKind)&&(P.uvs=b.getVerticesData(m.b.UVKind,f,x)),b.isVerticesDataPresent(m.b.UV2Kind)&&(P.uvs2=b.getVerticesData(m.b.UV2Kind,f,x)),b.isVerticesDataPresent(m.b.UV3Kind)&&(P.uvs3=b.getVerticesData(m.b.UV3Kind,f,x)),b.isVerticesDataPresent(m.b.UV4Kind)&&(P.uvs4=b.getVerticesData(m.b.UV4Kind,f,x)),b.isVerticesDataPresent(m.b.UV5Kind)&&(P.uvs5=b.getVerticesData(m.b.UV5Kind,f,x)),b.isVerticesDataPresent(m.b.UV6Kind)&&(P.uvs6=b.getVerticesData(m.b.UV6Kind,f,x)),b.isVerticesDataPresent(m.b.ColorKind)&&(P.colors=b.getVerticesData(m.b.ColorKind,f,x)),b.isVerticesDataPresent(m.b.MatricesIndicesKind)&&(P.matricesIndices=b.getVerticesData(m.b.MatricesIndicesKind,f,x)),b.isVerticesDataPresent(m.b.MatricesWeightsKind)&&(P.matricesWeights=b.getVerticesData(m.b.MatricesWeightsKind,f,x)),b.isVerticesDataPresent(m.b.MatricesIndicesExtraKind)&&(P.matricesIndicesExtra=b.getVerticesData(m.b.MatricesIndicesExtraKind,f,x)),b.isVerticesDataPresent(m.b.MatricesWeightsExtraKind)&&(P.matricesWeightsExtra=b.getVerticesData(m.b.MatricesWeightsExtraKind,f,x)),P.indices=b.getIndices(f,x),P},I.CreateRibbon=function(b){throw S.a.WarnImport("ribbonBuilder")},I.CreateBox=function(b){throw S.a.WarnImport("boxBuilder")},I.CreateTiledBox=function(b){throw S.a.WarnImport("tiledBoxBuilder")},I.CreateTiledPlane=function(b){throw S.a.WarnImport("tiledPlaneBuilder")},I.CreateSphere=function(b){throw S.a.WarnImport("sphereBuilder")},I.CreateCylinder=function(b){throw S.a.WarnImport("cylinderBuilder")},I.CreateTorus=function(b){throw S.a.WarnImport("torusBuilder")},I.CreateLineSystem=function(b){throw S.a.WarnImport("linesBuilder")},I.CreateDashedLines=function(b){throw S.a.WarnImport("linesBuilder")},I.CreateGround=function(b){throw S.a.WarnImport("groundBuilder")},I.CreateTiledGround=function(b){throw S.a.WarnImport("groundBuilder")},I.CreateGroundFromHeightMap=function(b){throw S.a.WarnImport("groundBuilder")},I.CreatePlane=function(b){throw S.a.WarnImport("planeBuilder")},I.CreateDisc=function(b){throw S.a.WarnImport("discBuilder")},I.CreatePolygon=function(b,f,x,P,A,T,_){throw S.a.WarnImport("polygonBuilder")},I.CreateIcoSphere=function(b){throw S.a.WarnImport("icoSphereBuilder")},I.CreatePolyhedron=function(b){throw S.a.WarnImport("polyhedronBuilder")},I.CreateCapsule=function(b){throw b===void 0&&(b={orientation:E.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),S.a.WarnImport("capsuleBuilder")},I.CreateTorusKnot=function(b){throw S.a.WarnImport("torusKnotBuilder")},I.ComputeNormals=function(b,f,x,P){var A=0,T=0,_=0,g=0,M=0,O=0,N=0,V=0,U=0,L=0,j=0,Y=0,W=0,ie=0,re=0,ye=0,ve=0,ue=0,oe=0,Z=0,J=!1,B=!1,G=!1,$=!1,he=1,se=0,q=null;if(P&&(J=!!P.facetNormals,B=!!P.facetPositions,G=!!P.facetPartitioning,he=P.useRightHandedSystem===!0?-1:1,se=P.ratio||0,$=!!P.depthSort,q=P.distanceTo,$)){q===void 0&&(q=E.e.Zero());var H=P.depthSortedFacets}var X=0,ee=0,Q=0,te=0;if(G&&P&&P.bbSize){var ge=0,ce=0,de=0,ne=0,pe=0,Se=0,Te=0,Ne=0,je=0,Xe=0,Ye=0,Ke=0,nt=0,qe=0,ct=0,ot=0,_t=P.bbSize.x>P.bbSize.y?P.bbSize.x:P.bbSize.y;_t=_t>P.bbSize.z?_t:P.bbSize.z,X=P.subDiv.X*se/P.bbSize.x,ee=P.subDiv.Y*se/P.bbSize.y,Q=P.subDiv.Z*se/P.bbSize.z,te=P.subDiv.max*P.subDiv.max,P.facetPartitioning.length=0}for(A=0;A<b.length;A++)x[A]=0;var gt=f.length/3|0;for(A=0;A<gt;A++){if(W=(Y=3*f[3*A])+1,ie=Y+2,ye=(re=3*f[3*A+1])+1,ve=re+2,oe=(ue=3*f[3*A+2])+1,Z=ue+2,T=b[Y]-b[re],_=b[W]-b[ye],g=b[ie]-b[ve],M=b[ue]-b[re],O=b[oe]-b[ye],V=he*(_*(N=b[Z]-b[ve])-g*O),U=he*(g*M-T*N),L=he*(T*O-_*M),V/=j=(j=Math.sqrt(V*V+U*U+L*L))===0?1:j,U/=j,L/=j,J&&P&&(P.facetNormals[A].x=V,P.facetNormals[A].y=U,P.facetNormals[A].z=L),B&&P&&(P.facetPositions[A].x=(b[Y]+b[re]+b[ue])/3,P.facetPositions[A].y=(b[W]+b[ye]+b[oe])/3,P.facetPositions[A].z=(b[ie]+b[ve]+b[Z])/3),G&&P&&(ge=Math.floor((P.facetPositions[A].x-P.bInfo.minimum.x*se)*X),ce=Math.floor((P.facetPositions[A].y-P.bInfo.minimum.y*se)*ee),de=Math.floor((P.facetPositions[A].z-P.bInfo.minimum.z*se)*Q),ne=Math.floor((b[Y]-P.bInfo.minimum.x*se)*X),pe=Math.floor((b[W]-P.bInfo.minimum.y*se)*ee),Se=Math.floor((b[ie]-P.bInfo.minimum.z*se)*Q),Te=Math.floor((b[re]-P.bInfo.minimum.x*se)*X),Ne=Math.floor((b[ye]-P.bInfo.minimum.y*se)*ee),je=Math.floor((b[ve]-P.bInfo.minimum.z*se)*Q),Xe=Math.floor((b[ue]-P.bInfo.minimum.x*se)*X),Ye=Math.floor((b[oe]-P.bInfo.minimum.y*se)*ee),Ke=Math.floor((b[Z]-P.bInfo.minimum.z*se)*Q),qe=ne+P.subDiv.max*pe+te*Se,ct=Te+P.subDiv.max*Ne+te*je,ot=Xe+P.subDiv.max*Ye+te*Ke,nt=ge+P.subDiv.max*ce+te*de,P.facetPartitioning[nt]=P.facetPartitioning[nt]?P.facetPartitioning[nt]:new Array,P.facetPartitioning[qe]=P.facetPartitioning[qe]?P.facetPartitioning[qe]:new Array,P.facetPartitioning[ct]=P.facetPartitioning[ct]?P.facetPartitioning[ct]:new Array,P.facetPartitioning[ot]=P.facetPartitioning[ot]?P.facetPartitioning[ot]:new Array,P.facetPartitioning[qe].push(A),ct!=qe&&P.facetPartitioning[ct].push(A),ot!=ct&&ot!=qe&&P.facetPartitioning[ot].push(A),nt!=qe&&nt!=ct&&nt!=ot&&P.facetPartitioning[nt].push(A)),$&&P&&P.facetPositions){var At=H[A];At.ind=3*A,At.sqDistance=E.e.DistanceSquared(P.facetPositions[A],q)}x[Y]+=V,x[W]+=U,x[ie]+=L,x[re]+=V,x[ye]+=U,x[ve]+=L,x[ue]+=V,x[oe]+=U,x[Z]+=L}for(A=0;A<x.length/3;A++)V=x[3*A],U=x[3*A+1],L=x[3*A+2],V/=j=(j=Math.sqrt(V*V+U*U+L*L))===0?1:j,U/=j,L/=j,x[3*A]=V,x[3*A+1]=U,x[3*A+2]=L},I._ComputeSides=function(b,f,x,P,A,T,_){var g,M,O=x.length,N=P.length;switch(b=b||I.DEFAULTSIDE){case I.FRONTSIDE:break;case I.BACKSIDE:var V;for(g=0;g<O;g+=3)V=x[g],x[g]=x[g+2],x[g+2]=V;for(M=0;M<N;M++)P[M]=-P[M];break;case I.DOUBLESIDE:for(var U=f.length,L=U/3,j=0;j<U;j++)f[U+j]=f[j];for(g=0;g<O;g+=3)x[g+O]=x[g+2]+L,x[g+1+O]=x[g+1]+L,x[g+2+O]=x[g]+L;for(M=0;M<N;M++)P[N+M]=-P[M];var Y=A.length,W=0;for(W=0;W<Y;W++)A[W+Y]=A[W];for(T=T||new E.f(0,0,1,1),_=_||new E.f(0,0,1,1),W=0,g=0;g<Y/2;g++)A[W]=T.x+(T.z-T.x)*A[W],A[W+1]=T.y+(T.w-T.y)*A[W+1],A[W+Y]=_.x+(_.z-_.x)*A[W+Y],A[W+Y+1]=_.y+(_.w-_.y)*A[W+Y+1],W+=2}},I.ImportVertexData=function(b,f){var x=new I,P=b.positions;P&&x.set(P,m.b.PositionKind);var A=b.normals;A&&x.set(A,m.b.NormalKind);var T=b.tangents;T&&x.set(T,m.b.TangentKind);var _=b.uvs;_&&x.set(_,m.b.UVKind);var g=b.uv2s;g&&x.set(g,m.b.UV2Kind);var M=b.uv3s;M&&x.set(M,m.b.UV3Kind);var O=b.uv4s;O&&x.set(O,m.b.UV4Kind);var N=b.uv5s;N&&x.set(N,m.b.UV5Kind);var V=b.uv6s;V&&x.set(V,m.b.UV6Kind);var U=b.colors;U&&x.set(h.b.CheckColors4(U,P.length/3),m.b.ColorKind);var L=b.matricesIndices;L&&x.set(L,m.b.MatricesIndicesKind);var j=b.matricesWeights;j&&x.set(j,m.b.MatricesWeightsKind);var Y=b.indices;Y&&(x.indices=Y),f.setAllVerticesData(x,b.updatable)},I.FRONTSIDE=0,I.BACKSIDE=1,I.DOUBLESIDE=2,I.DEFAULTSIDE=0,I}()},function(p,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(1),m=function(){function h(){}return h.NAME_EFFECTLAYER="EffectLayer",h.NAME_LAYER="Layer",h.NAME_LENSFLARESYSTEM="LensFlareSystem",h.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",h.NAME_PARTICLESYSTEM="ParticleSystem",h.NAME_GAMEPAD="Gamepad",h.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",h.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",h.NAME_PREPASSRENDERER="PrePassRenderer",h.NAME_DEPTHRENDERER="DepthRenderer",h.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",h.NAME_SPRITE="Sprite",h.NAME_SUBSURFACE="SubSurface",h.NAME_OUTLINERENDERER="Outline",h.NAME_PROCEDURALTEXTURE="ProceduralTexture",h.NAME_SHADOWGENERATOR="ShadowGenerator",h.NAME_OCTREE="Octree",h.NAME_PHYSICSENGINE="PhysicsEngine",h.NAME_AUDIO="Audio",h.STEP_ISREADYFORMESH_EFFECTLAYER=0,h.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,h.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,h.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,h.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,h.STEP_BEFORECAMERADRAW_LAYER=1,h.STEP_BEFORECAMERADRAW_PREPASS=2,h.STEP_BEFORERENDERTARGETDRAW_LAYER=0,h.STEP_BEFORERENDERINGMESH_PREPASS=0,h.STEP_BEFORERENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGMESH_PREPASS=0,h.STEP_AFTERRENDERINGMESH_OUTLINE=1,h.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,h.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,h.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,h.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,h.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,h.STEP_AFTERRENDERTARGETDRAW_LAYER=0,h.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,h.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,h.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,h.STEP_AFTERCAMERADRAW_LAYER=3,h.STEP_AFTERCAMERADRAW_PREPASS=4,h.STEP_AFTERRENDER_AUDIO=0,h.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,h.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,h.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,h.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,h.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,h.STEP_BEFORECLEARSTAGE_PREPASS=0,h.STEP_POINTERMOVE_SPRITE=0,h.STEP_POINTERDOWN_SPRITE=0,h.STEP_POINTERUP_SPRITE=0,h}(),S=function(h){function C(R){return h.apply(this,R)||this}return Object(E.d)(C,h),C.Create=function(){return Object.create(C.prototype)},C.prototype.registerStep=function(R,I,b){var f=0;for(Number.MAX_VALUE;f<this.length&&!(R<this[f].index);f++);this.splice(f,0,{index:R,component:I,action:b.bind(I)})},C.prototype.clear=function(){this.length=0},C}(Array)},function(p,s,c){c.d(s,"a",function(){return S}),c.d(s,"c",function(){return h}),c.d(s,"d",function(){return C}),c.d(s,"b",function(){return R});var E=c(1),m=c(0),S=function(){function I(){}return I.POINTERDOWN=1,I.POINTERUP=2,I.POINTERMOVE=4,I.POINTERWHEEL=8,I.POINTERPICK=16,I.POINTERTAP=32,I.POINTERDOUBLETAP=64,I}(),h=function(I,b){this.type=I,this.event=b},C=function(I){function b(f,x,P,A){var T=I.call(this,f,x)||this;return T.ray=null,T.skipOnPointerObservable=!1,T.localPosition=new m.d(P,A),T}return Object(E.d)(b,I),b}(h),R=function(I){function b(f,x,P){var A=I.call(this,f,x)||this;return A.pickInfo=P,A}return Object(E.d)(b,I),b}(h)},function(p,s,c){c.d(s,"a",function(){return S});var E=c(13),m=c(2),S=function(){function h(){}return Object.defineProperty(h,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(C){this._DiffuseTextureEnabled!==C&&(this._DiffuseTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(C){this._DetailTextureEnabled!==C&&(this._DetailTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(C){this._AmbientTextureEnabled!==C&&(this._AmbientTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(C){this._OpacityTextureEnabled!==C&&(this._OpacityTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(C){this._ReflectionTextureEnabled!==C&&(this._ReflectionTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(C){this._EmissiveTextureEnabled!==C&&(this._EmissiveTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(C){this._SpecularTextureEnabled!==C&&(this._SpecularTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(C){this._BumpTextureEnabled!==C&&(this._BumpTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(C){this._LightmapTextureEnabled!==C&&(this._LightmapTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(C){this._RefractionTextureEnabled!==C&&(this._RefractionTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(C){this._ColorGradingTextureEnabled!==C&&(this._ColorGradingTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(C){this._FresnelEnabled!==C&&(this._FresnelEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_FresnelDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(C){this._ClearCoatTextureEnabled!==C&&(this._ClearCoatTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(C){this._ClearCoatBumpTextureEnabled!==C&&(this._ClearCoatBumpTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(C){this._ClearCoatTintTextureEnabled!==C&&(this._ClearCoatTintTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(C){this._SheenTextureEnabled!==C&&(this._SheenTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(C){this._AnisotropicTextureEnabled!==C&&(this._AnisotropicTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(C){this._ThicknessTextureEnabled!==C&&(this._ThicknessTextureEnabled=C,E.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),h._DiffuseTextureEnabled=!0,h._DetailTextureEnabled=!0,h._AmbientTextureEnabled=!0,h._OpacityTextureEnabled=!0,h._ReflectionTextureEnabled=!0,h._EmissiveTextureEnabled=!0,h._SpecularTextureEnabled=!0,h._BumpTextureEnabled=!0,h._LightmapTextureEnabled=!0,h._RefractionTextureEnabled=!0,h._ColorGradingTextureEnabled=!0,h._FresnelEnabled=!0,h._ClearCoatTextureEnabled=!0,h._ClearCoatBumpTextureEnabled=!0,h._ClearCoatTintTextureEnabled=!0,h._SheenTextureEnabled=!0,h._AnisotropicTextureEnabled=!0,h._ThicknessTextureEnabled=!0,h}()},function(p,s,c){c.d(s,"a",function(){return he});var E=c(1),m=c(12),S=c(57),h=c(6),C=c(33),R=c(112),I=c(37),b=c(0),f=c(46),x=c(31),P=c(24),A=c(35),T=c(42),_=c(85),g=c(48),M=c(54),O=c(47),N=c(95),V=c(96),U=c(17),L=c(2),j=c(38),Y=c(8),W=c(22),ie=c(21),re=c(18),ye=c(91),ve=c(66),ue=function(){function se(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(se.prototype,"singleClick",{get:function(){return this._singleClick},set:function(q){this._singleClick=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(q){this._doubleClick=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(q){this._hasSwiped=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"ignore",{get:function(){return this._ignore},set:function(q){this._ignore=q},enumerable:!1,configurable:!0}),se}(),oe=function(){function se(q){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new b.d(0,0),this._previousStartingPointerPosition=new b.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=q}return Object.defineProperty(se.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),se.prototype.getMeshUnderPointerByPointerId=function(q){return this._meshUnderPointerId[q]},Object.defineProperty(se.prototype,"unTranslatedPointer",{get:function(){return new b.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"pointerX",{get:function(){return this._pointerX},set:function(q){this._pointerX=q},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"pointerY",{get:function(){return this._pointerY},set:function(q){this._pointerY=q},enumerable:!1,configurable:!0}),se.prototype._updatePointerPosition=function(q){var H=this._scene.getEngine().getInputElementClientRect();H&&(this._pointerX=q.clientX-H.left,this._pointerY=q.clientY-H.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},se.prototype._processPointerMove=function(q,H){var X=this._scene,ee=X.getEngine(),Q=ee.getInputElement();if(Q){Q.tabIndex=ee.canvasTabIndex,X.doNotHandleCursors||(Q.style.cursor=X.defaultCursor);var te=!!(q&&q.hit&&q.pickedMesh);te?(X.setPointerOverMesh(q.pickedMesh,H.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(X.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?Q.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:Q.style.cursor=X.hoverCursor))):X.setPointerOverMesh(null,H.pointerId);for(var ge=0,ce=X._pointerMoveStage;ge<ce.length;ge++)q=ce[ge].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,te,Q);if(q){var de=H.type===this._wheelEventName?re.a.POINTERWHEEL:re.a.POINTERMOVE;if(X.onPointerMove&&X.onPointerMove(H,q,de),X.onPointerObservable.hasObservers()){var ne=new re.b(de,H,q);this._setRayOnPointerInfo(ne),X.onPointerObservable.notifyObservers(ne,de)}}}},se.prototype._setRayOnPointerInfo=function(q){var H=this._scene;q.pickInfo&&!q.pickInfo._pickingUnavailable&&(q.pickInfo.ray||(q.pickInfo.ray=H.createPickingRay(q.event.offsetX,q.event.offsetY,b.a.Identity(),H.activeCamera)))},se.prototype._checkPrePointerObservable=function(q,H,X){var ee=this._scene,Q=new re.d(X,H,this._unTranslatedPointerX,this._unTranslatedPointerY);return q&&(Q.ray=q.ray),ee.onPrePointerObservable.notifyObservers(Q,X),!!Q.skipOnPointerObservable},se.prototype.simulatePointerMove=function(q,H){var X=new PointerEvent("pointermove",H);this._checkPrePointerObservable(q,X,re.a.POINTERMOVE)||this._processPointerMove(q,X)},se.prototype.simulatePointerDown=function(q,H){var X=new PointerEvent("pointerdown",H);this._checkPrePointerObservable(q,X,re.a.POINTERDOWN)||this._processPointerDown(q,X)},se.prototype._processPointerDown=function(q,H){var X=this,ee=this._scene;if(q&&q.hit&&q.pickedMesh){this._pickedDownMesh=q.pickedMesh;var Q=q.pickedMesh._getActionManagerForTrigger();if(Q){if(Q.hasPickTriggers)switch(Q.processTrigger(L.a.ACTION_OnPickDownTrigger,O.a.CreateNew(q.pickedMesh,H)),H.button){case 0:Q.processTrigger(L.a.ACTION_OnLeftPickTrigger,O.a.CreateNew(q.pickedMesh,H));break;case 1:Q.processTrigger(L.a.ACTION_OnCenterPickTrigger,O.a.CreateNew(q.pickedMesh,H));break;case 2:Q.processTrigger(L.a.ACTION_OnRightPickTrigger,O.a.CreateNew(q.pickedMesh,H))}Q.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var ne=ee.pick(X._unTranslatedPointerX,X._unTranslatedPointerY,function(pe){return pe.isPickable&&pe.isVisible&&pe.isReady()&&pe.actionManager&&pe.actionManager.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&pe==X._pickedDownMesh},!1,ee.cameraToUseForPointers);ne&&ne.hit&&ne.pickedMesh&&Q&&X._totalPointersPressed!==0&&Date.now()-X._startingPointerTime>se.LongPressDelay&&!X._isPointerSwiping()&&(X._startingPointerTime=0,Q.processTrigger(L.a.ACTION_OnLongPressTrigger,O.a.CreateNew(ne.pickedMesh,H)))},se.LongPressDelay)}}else for(var te=0,ge=ee._pointerDownStage;te<ge.length;te++)q=ge[te].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,H);if(q){var ce=re.a.POINTERDOWN;if(ee.onPointerDown&&ee.onPointerDown(H,q,ce),ee.onPointerObservable.hasObservers()){var de=new re.b(ce,H,q);this._setRayOnPointerInfo(de),ee.onPointerObservable.notifyObservers(de,ce)}}},se.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>se.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>se.DragMovementThreshold},se.prototype.simulatePointerUp=function(q,H,X){var ee=new PointerEvent("pointerup",H),Q=new ue;X?Q.doubleClick=!0:Q.singleClick=!0,this._checkPrePointerObservable(q,ee,re.a.POINTERUP)||this._processPointerUp(q,ee,Q)},se.prototype._processPointerUp=function(q,H,X){var ee=this._scene;if(q&&q&&q.pickedMesh){if(this._pickedUpMesh=q.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(ee.onPointerPick&&ee.onPointerPick(H,q),X.singleClick&&!X.ignore&&ee.onPointerObservable.hasObservers())){var Q=re.a.POINTERPICK,te=new re.b(Q,H,q);this._setRayOnPointerInfo(te),ee.onPointerObservable.notifyObservers(te,Q)}var ge=q.pickedMesh._getActionManagerForTrigger();if(ge&&!X.ignore){ge.processTrigger(L.a.ACTION_OnPickUpTrigger,O.a.CreateNew(q.pickedMesh,H)),!X.hasSwiped&&X.singleClick&&ge.processTrigger(L.a.ACTION_OnPickTrigger,O.a.CreateNew(q.pickedMesh,H));var ce=q.pickedMesh._getActionManagerForTrigger(L.a.ACTION_OnDoublePickTrigger);X.doubleClick&&ce&&ce.processTrigger(L.a.ACTION_OnDoublePickTrigger,O.a.CreateNew(q.pickedMesh,H))}}else if(!X.ignore)for(var de=0,ne=ee._pointerUpStage;de<ne.length;de++)q=ne[de].action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,H);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var pe=this._pickedDownMesh._getActionManagerForTrigger(L.a.ACTION_OnPickOutTrigger);pe&&pe.processTrigger(L.a.ACTION_OnPickOutTrigger,O.a.CreateNew(this._pickedDownMesh,H))}var Se=0;ee.onPointerObservable.hasObservers()&&(!X.ignore&&!X.hasSwiped&&(X.singleClick&&ee.onPointerObservable.hasSpecificMask(re.a.POINTERTAP)?Se=re.a.POINTERTAP:X.doubleClick&&ee.onPointerObservable.hasSpecificMask(re.a.POINTERDOUBLETAP)&&(Se=re.a.POINTERDOUBLETAP),Se)&&(te=new re.b(Se,H,q),this._setRayOnPointerInfo(te),ee.onPointerObservable.notifyObservers(te,Se)),X.ignore||(Se=re.a.POINTERUP,te=new re.b(Se,H,q),this._setRayOnPointerInfo(te),ee.onPointerObservable.notifyObservers(te,Se))),ee.onPointerUp&&!X.ignore&&ee.onPointerUp(H,q,Se)},se.prototype.isPointerCaptured=function(q){return q===void 0&&(q=0),this._pointerCaptures[q]},se.prototype.attachControl=function(q,H,X,ee){var Q=this;q===void 0&&(q=!0),H===void 0&&(H=!0),X===void 0&&(X=!0),ee===void 0&&(ee=null);var te=this._scene;if(ee||(ee=te.getEngine().getInputElement()),ee){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=ee;var ge=te.getEngine();this._initActionManager=function(pe,Se){if(!Q._meshPickProceed){var Te=te.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,te.pointerDownPredicate,!1,te.cameraToUseForPointers);Q._currentPickResult=Te,Te&&(pe=Te.hit&&Te.pickedMesh?Te.pickedMesh._getActionManagerForTrigger():null),Q._meshPickProceed=!0}return pe},this._delayedSimpleClick=function(pe,Se,Te){(Date.now()-Q._previousStartingPointerTime>se.DoubleClickDelay&&!Q._doubleClickOccured||pe!==Q._previousButtonPressed)&&(Q._doubleClickOccured=!1,Se.singleClick=!0,Se.ignore=!1,Te(Se,Q._currentPickResult))},this._initClickEvent=function(pe,Se,Te,Ne){var je=new ue;Q._currentPickResult=null;var Xe=null,Ye=pe.hasSpecificMask(re.a.POINTERPICK)||Se.hasSpecificMask(re.a.POINTERPICK)||pe.hasSpecificMask(re.a.POINTERTAP)||Se.hasSpecificMask(re.a.POINTERTAP)||pe.hasSpecificMask(re.a.POINTERDOUBLETAP)||Se.hasSpecificMask(re.a.POINTERDOUBLETAP);!Ye&&ye.a&&(Xe=Q._initActionManager(Xe,je))&&(Ye=Xe.hasPickTriggers);var Ke=!1;if(Ye){var nt=Te.button;if(je.hasSwiped=Q._isPointerSwiping(),!je.hasSwiped){var qe=!se.ExclusiveDoubleClickMode;qe||(qe=!pe.hasSpecificMask(re.a.POINTERDOUBLETAP)&&!Se.hasSpecificMask(re.a.POINTERDOUBLETAP))&&!ye.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Xe=Q._initActionManager(Xe,je))&&(qe=!Xe.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),qe?(Date.now()-Q._previousStartingPointerTime>se.DoubleClickDelay||nt!==Q._previousButtonPressed)&&(je.singleClick=!0,Ne(je,Q._currentPickResult),Ke=!0):(Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Q._delayedSimpleClickTimeout=window.setTimeout(Q._delayedSimpleClick.bind(Q,nt,je,Ne),se.DoubleClickDelay));var ct=pe.hasSpecificMask(re.a.POINTERDOUBLETAP)||Se.hasSpecificMask(re.a.POINTERDOUBLETAP);!ct&&ye.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(Xe=Q._initActionManager(Xe,je))&&(ct=Xe.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),ct&&(nt===Q._previousButtonPressed&&Date.now()-Q._previousStartingPointerTime<se.DoubleClickDelay&&!Q._doubleClickOccured?(je.hasSwiped||Q._isPointerSwiping()?(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=nt,se.ExclusiveDoubleClickMode?(Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Ne(je,Q._previousPickResult)):Ne(je,Q._currentPickResult)):(Q._previousStartingPointerTime=0,Q._doubleClickOccured=!0,je.doubleClick=!0,je.ignore=!1,se.ExclusiveDoubleClickMode&&Q._previousDelayedSimpleClickTimeout&&clearTimeout(Q._previousDelayedSimpleClickTimeout),Q._previousDelayedSimpleClickTimeout=Q._delayedSimpleClickTimeout,Ne(je,Q._currentPickResult)),Ke=!0):(Q._doubleClickOccured=!1,Q._previousStartingPointerTime=Q._startingPointerTime,Q._previousStartingPointerPosition.x=Q._startingPointerPosition.x,Q._previousStartingPointerPosition.y=Q._startingPointerPosition.y,Q._previousButtonPressed=nt))}}Ke||Ne(je,Q._currentPickResult)},this._onPointerMove=function(pe){if(pe.pointerId===void 0&&(pe.pointerId=0),Q._updatePointerPosition(pe),!Q._checkPrePointerObservable(null,pe,pe.type===Q._wheelEventName?re.a.POINTERWHEEL:re.a.POINTERMOVE)&&(te.cameraToUseForPointers||te.activeCamera)){te.pointerMovePredicate||(te.pointerMovePredicate=function(Te){return Te.isPickable&&Te.isVisible&&Te.isReady()&&Te.isEnabled()&&(Te.enablePointerMoveEvents||te.constantlyUpdateMeshUnderPointer||Te._getActionManagerForTrigger()!=null)&&(!te.cameraToUseForPointers||(te.cameraToUseForPointers.layerMask&Te.layerMask)!=0)});var Se=te.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,te.pointerMovePredicate,!1,te.cameraToUseForPointers);Q._processPointerMove(Se,pe)}},this._onPointerDown=function(pe){if(Q._totalPointersPressed++,Q._pickedDownMesh=null,Q._meshPickProceed=!1,pe.pointerId===void 0&&(pe.pointerId=0),Q._updatePointerPosition(pe),te.preventDefaultOnPointerDown&&ee&&(pe.preventDefault(),ee.focus()),Q._startingPointerPosition.x=Q._pointerX,Q._startingPointerPosition.y=Q._pointerY,Q._startingPointerTime=Date.now(),!Q._checkPrePointerObservable(null,pe,re.a.POINTERDOWN)&&(te.cameraToUseForPointers||te.activeCamera)){Q._pointerCaptures[pe.pointerId]=!0,te.pointerDownPredicate||(te.pointerDownPredicate=function(Te){return Te.isPickable&&Te.isVisible&&Te.isReady()&&Te.isEnabled()&&(!te.cameraToUseForPointers||(te.cameraToUseForPointers.layerMask&Te.layerMask)!=0)}),Q._pickedDownMesh=null;var Se=te.pick(Q._unTranslatedPointerX,Q._unTranslatedPointerY,te.pointerDownPredicate,!1,te.cameraToUseForPointers);Q._processPointerDown(Se,pe)}},this._onPointerUp=function(pe){Q._totalPointersPressed!==0&&(Q._totalPointersPressed--,Q._pickedUpMesh=null,Q._meshPickProceed=!1,pe.pointerId===void 0&&(pe.pointerId=0),Q._updatePointerPosition(pe),te.preventDefaultOnPointerUp&&ee&&(pe.preventDefault(),ee.focus()),Q._initClickEvent(te.onPrePointerObservable,te.onPointerObservable,pe,function(Se,Te){te.onPrePointerObservable.hasObservers()&&!Se.ignore&&(!Se.hasSwiped&&(Se.singleClick&&te.onPrePointerObservable.hasSpecificMask(re.a.POINTERTAP)&&Q._checkPrePointerObservable(null,pe,re.a.POINTERTAP)||Se.doubleClick&&te.onPrePointerObservable.hasSpecificMask(re.a.POINTERDOUBLETAP)&&Q._checkPrePointerObservable(null,pe,re.a.POINTERDOUBLETAP))||Q._checkPrePointerObservable(null,pe,re.a.POINTERUP))||Q._pointerCaptures[pe.pointerId]&&(Q._pointerCaptures[pe.pointerId]=!1,(te.cameraToUseForPointers||te.activeCamera)&&(te.pointerUpPredicate||(te.pointerUpPredicate=function(Ne){return Ne.isPickable&&Ne.isVisible&&Ne.isReady()&&Ne.isEnabled()&&(!te.cameraToUseForPointers||(te.cameraToUseForPointers.layerMask&Ne.layerMask)!=0)}),!Q._meshPickProceed&&(ye.a&&ye.a.HasTriggers||te.onPointerObservable.hasObservers())&&Q._initActionManager(null,Se),Te||(Te=Q._currentPickResult),Q._processPointerUp(Te,pe,Se),Q._previousPickResult=Q._currentPickResult))}))},this._onKeyDown=function(pe){var Se=ve.a.KEYDOWN;if(te.onPreKeyboardObservable.hasObservers()){var Te=new ve.c(Se,pe);if(te.onPreKeyboardObservable.notifyObservers(Te,Se),Te.skipOnPointerObservable)return}te.onKeyboardObservable.hasObservers()&&(Te=new ve.b(Se,pe),te.onKeyboardObservable.notifyObservers(Te,Se)),te.actionManager&&te.actionManager.processTrigger(L.a.ACTION_OnKeyDownTrigger,O.a.CreateNewFromScene(te,pe))},this._onKeyUp=function(pe){var Se=ve.a.KEYUP;if(te.onPreKeyboardObservable.hasObservers()){var Te=new ve.c(Se,pe);if(te.onPreKeyboardObservable.notifyObservers(Te,Se),Te.skipOnPointerObservable)return}te.onKeyboardObservable.hasObservers()&&(Te=new ve.b(Se,pe),te.onKeyboardObservable.notifyObservers(Te,Se)),te.actionManager&&te.actionManager.processTrigger(L.a.ACTION_OnKeyUpTrigger,O.a.CreateNewFromScene(te,pe))};var ce=function(){ee&&!Q._keyboardIsAttached&&(ee.addEventListener("keydown",Q._onKeyDown,!1),ee.addEventListener("keyup",Q._onKeyUp,!1),Q._keyboardIsAttached=!0)};this._onCanvasFocusObserver=ge.onCanvasFocusObservable.add((document.activeElement===ee&&ce(),ce)),this._onCanvasBlurObserver=ge.onCanvasBlurObservable.add(function(){ee&&(ee.removeEventListener("keydown",Q._onKeyDown),ee.removeEventListener("keyup",Q._onKeyUp),Q._keyboardIsAttached=!1)}),ce();var de=m.b.GetPointerPrefix(ge);if(X&&(ee.addEventListener(de+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",ee.addEventListener(this._wheelEventName,this._onPointerMove,!1)),H&&ee.addEventListener(de+"down",this._onPointerDown,!1),q){var ne=te.getEngine().getHostWindow();ne&&ne.addEventListener(de+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},se.prototype.detachControl=function(){var q=this._scene.getEngine(),H=m.b.GetPointerPrefix(q);this._alreadyAttachedTo&&this._alreadyAttached&&(this._alreadyAttachedTo.removeEventListener(H+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(H+"down",this._onPointerDown),window.removeEventListener(H+"up",this._onPointerUp),this._onCanvasBlurObserver&&q.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&q.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},se.prototype.setPointerOverMesh=function(q,H){if(H===void 0&&(H=0),H<0&&(H=0),this._meshUnderPointerId[H]!==q){var X,ee=this._meshUnderPointerId[H];ee&&(X=ee._getActionManagerForTrigger(L.a.ACTION_OnPointerOutTrigger))&&X.processTrigger(L.a.ACTION_OnPointerOutTrigger,O.a.CreateNew(ee,void 0,{pointerId:H})),this._meshUnderPointerId[H]=q,this._pointerOverMesh=q,(ee=this._meshUnderPointerId[H])&&(X=ee._getActionManagerForTrigger(L.a.ACTION_OnPointerOverTrigger))&&X.processTrigger(L.a.ACTION_OnPointerOverTrigger,O.a.CreateNew(ee,void 0,{pointerId:H}))}},se.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},se.DragMovementThreshold=10,se.LongPressDelay=500,se.DoubleClickDelay=300,se.ExclusiveDoubleClickMode=!1,se}(),Z=c(55),J=c(9),B=c(90),G=c(152),$=c(56),he=function(se){function q(H,X){var ee=se.call(this)||this;ee._inputManager=new oe(ee),ee.cameraToUseForPointers=null,ee._isScene=!0,ee._blockEntityCollection=!1,ee.autoClear=!0,ee.autoClearDepthAndStencil=!0,ee.clearColor=new J.b(.2,.2,.3,1),ee.ambientColor=new J.a(0,0,0),ee._environmentIntensity=1,ee._forceWireframe=!1,ee._skipFrustumClipping=!1,ee._forcePointsCloud=!1,ee.animationsEnabled=!0,ee._animationPropertiesOverride=null,ee.useConstantAnimationDeltaTime=!1,ee.constantlyUpdateMeshUnderPointer=!1,ee.hoverCursor="pointer",ee.defaultCursor="",ee.doNotHandleCursors=!1,ee.preventDefaultOnPointerDown=!0,ee.preventDefaultOnPointerUp=!0,ee.metadata=null,ee.reservedDataStore=null,ee.disableOfflineSupportExceptionRules=new Array,ee.onDisposeObservable=new h.c,ee._onDisposeObserver=null,ee.onBeforeRenderObservable=new h.c,ee._onBeforeRenderObserver=null,ee.onAfterRenderObservable=new h.c,ee.onAfterRenderCameraObservable=new h.c,ee._onAfterRenderObserver=null,ee.onBeforeAnimationsObservable=new h.c,ee.onAfterAnimationsObservable=new h.c,ee.onBeforeDrawPhaseObservable=new h.c,ee.onAfterDrawPhaseObservable=new h.c,ee.onReadyObservable=new h.c,ee.onBeforeCameraRenderObservable=new h.c,ee._onBeforeCameraRenderObserver=null,ee.onAfterCameraRenderObservable=new h.c,ee._onAfterCameraRenderObserver=null,ee.onBeforeActiveMeshesEvaluationObservable=new h.c,ee.onAfterActiveMeshesEvaluationObservable=new h.c,ee.onBeforeParticlesRenderingObservable=new h.c,ee.onAfterParticlesRenderingObservable=new h.c,ee.onDataLoadedObservable=new h.c,ee.onNewCameraAddedObservable=new h.c,ee.onCameraRemovedObservable=new h.c,ee.onNewLightAddedObservable=new h.c,ee.onLightRemovedObservable=new h.c,ee.onNewGeometryAddedObservable=new h.c,ee.onGeometryRemovedObservable=new h.c,ee.onNewTransformNodeAddedObservable=new h.c,ee.onTransformNodeRemovedObservable=new h.c,ee.onNewMeshAddedObservable=new h.c,ee.onMeshRemovedObservable=new h.c,ee.onNewSkeletonAddedObservable=new h.c,ee.onSkeletonRemovedObservable=new h.c,ee.onNewMaterialAddedObservable=new h.c,ee.onNewMultiMaterialAddedObservable=new h.c,ee.onMaterialRemovedObservable=new h.c,ee.onMultiMaterialRemovedObservable=new h.c,ee.onNewTextureAddedObservable=new h.c,ee.onTextureRemovedObservable=new h.c,ee.onBeforeRenderTargetsRenderObservable=new h.c,ee.onAfterRenderTargetsRenderObservable=new h.c,ee.onBeforeStepObservable=new h.c,ee.onAfterStepObservable=new h.c,ee.onActiveCameraChanged=new h.c,ee.onBeforeRenderingGroupObservable=new h.c,ee.onAfterRenderingGroupObservable=new h.c,ee.onMeshImportedObservable=new h.c,ee.onAnimationFileImportedObservable=new h.c,ee._registeredForLateAnimationBindings=new C.b(256),ee.onPrePointerObservable=new h.c,ee.onPointerObservable=new h.c,ee.onPreKeyboardObservable=new h.c,ee.onKeyboardObservable=new h.c,ee._useRightHandedSystem=!1,ee._timeAccumulator=0,ee._currentStepId=0,ee._currentInternalStep=0,ee._fogEnabled=!0,ee._fogMode=q.FOGMODE_NONE,ee.fogColor=new J.a(.2,.2,.3),ee.fogDensity=.1,ee.fogStart=0,ee.fogEnd=1e3,ee.prePass=!1,ee._shadowsEnabled=!0,ee._lightsEnabled=!0,ee.activeCameras=new Array,ee._texturesEnabled=!0,ee.physicsEnabled=!0,ee.particlesEnabled=!0,ee.spritesEnabled=!0,ee._skeletonsEnabled=!0,ee.lensFlaresEnabled=!0,ee.collisionsEnabled=!0,ee.gravity=new b.e(0,-9.807,0),ee.postProcessesEnabled=!0,ee.renderTargetsEnabled=!0,ee.dumpNextRenderTargets=!1,ee.customRenderTargets=new Array,ee.importedMeshesFiles=new Array,ee.probesEnabled=!0,ee._meshesForIntersections=new C.b(256),ee.proceduralTexturesEnabled=!0,ee._totalVertices=new Z.a,ee._activeIndices=new Z.a,ee._activeParticles=new Z.a,ee._activeBones=new Z.a,ee._animationTime=0,ee.animationTimeScale=1,ee._renderId=0,ee._frameId=0,ee._executeWhenReadyTimeoutId=-1,ee._intermediateRendering=!1,ee._viewUpdateFlag=-1,ee._projectionUpdateFlag=-1,ee._toBeDisposed=new Array(256),ee._activeRequests=new Array,ee._pendingData=new Array,ee._isDisposed=!1,ee.dispatchAllSubMeshesOfActiveMeshes=!1,ee._activeMeshes=new C.a(256),ee._processedMaterials=new C.a(256),ee._renderTargets=new C.b(256),ee._activeParticleSystems=new C.a(256),ee._activeSkeletons=new C.b(32),ee._softwareSkinnedMeshes=new C.b(32),ee._activeAnimatables=new Array,ee._transformMatrix=b.a.Zero(),ee.requireLightSorting=!1,ee._components=[],ee._serializableComponents=[],ee._transientComponents=[],ee._beforeCameraUpdateStage=U.b.Create(),ee._beforeClearStage=U.b.Create(),ee._gatherRenderTargetsStage=U.b.Create(),ee._gatherActiveCameraRenderTargetsStage=U.b.Create(),ee._isReadyForMeshStage=U.b.Create(),ee._beforeEvaluateActiveMeshStage=U.b.Create(),ee._evaluateSubMeshStage=U.b.Create(),ee._preActiveMeshStage=U.b.Create(),ee._cameraDrawRenderTargetStage=U.b.Create(),ee._beforeCameraDrawStage=U.b.Create(),ee._beforeRenderTargetDrawStage=U.b.Create(),ee._beforeRenderingGroupDrawStage=U.b.Create(),ee._beforeRenderingMeshStage=U.b.Create(),ee._afterRenderingMeshStage=U.b.Create(),ee._afterRenderingGroupDrawStage=U.b.Create(),ee._afterCameraDrawStage=U.b.Create(),ee._afterRenderTargetDrawStage=U.b.Create(),ee._afterRenderStage=U.b.Create(),ee._pointerMoveStage=U.b.Create(),ee._pointerDownStage=U.b.Create(),ee._pointerUpStage=U.b.Create(),ee.geometriesByUniqueId=null,ee._defaultMeshCandidates={data:[],length:0},ee._defaultSubMeshCandidates={data:[],length:0},ee._preventFreeActiveMeshesAndRenderingGroups=!1,ee._activeMeshesFrozen=!1,ee._skipEvaluateActiveMeshesCompletely=!1,ee._allowPostProcessClearColor=!0,ee.getDeterministicFrameTime=function(){return ee._engine.getTimeStep()},ee._blockMaterialDirtyMechanism=!1;var Q=Object(E.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},X);return ee._engine=H||W.a.LastCreatedEngine,Q.virtual||(W.a._LastCreatedScene=ee,ee._engine.scenes.push(ee)),ee._uid=null,ee._renderingManager=new V.b(ee),N.a&&(ee.postProcessManager=new N.a(ee)),j.a.IsWindowObjectExist()&&ee.attachControl(),ee._createUbo(),T.a&&(ee._imageProcessingConfiguration=new T.a),ee.setDefaultCandidateProviders(),Q.useGeometryUniqueIdsMap&&(ee.geometriesByUniqueId={}),ee.useMaterialMeshMap=Q.useMaterialMeshMap,ee.useClonedMeshMap=Q.useClonedMeshMap,X&&X.virtual||ee._engine.onNewSceneAddedObservable.notifyObservers(ee),ee}return Object(E.d)(q,se),q.DefaultMaterialFactory=function(H){throw ie.a.WarnImport("StandardMaterial")},q.CollisionCoordinatorFactory=function(){throw ie.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(q.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(H){this._environmentTexture!==H&&(this._environmentTexture=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(H){this._environmentIntensity!==H&&(this._environmentIntensity=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(H){this._forceWireframe!==H&&(this._forceWireframe=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(H){this._skipFrustumClipping!==H&&(this._skipFrustumClipping=H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(H){this._forcePointsCloud!==H&&(this._forcePointsCloud=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(H){this._animationPropertiesOverride=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"onDispose",{set:function(H){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"beforeRender",{set:function(H){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),H&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(H))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"afterRender",{set:function(H){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),H&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(H))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"beforeCameraRender",{set:function(H){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"afterCameraRender",{set:function(H){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(H)},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(q,"DragMovementThreshold",{get:function(){return oe.DragMovementThreshold},set:function(H){oe.DragMovementThreshold=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"LongPressDelay",{get:function(){return oe.LongPressDelay},set:function(H){oe.LongPressDelay=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"DoubleClickDelay",{get:function(){return oe.DoubleClickDelay},set:function(H){oe.DoubleClickDelay=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"ExclusiveDoubleClickMode",{get:function(){return oe.ExclusiveDoubleClickMode},set:function(H){oe.ExclusiveDoubleClickMode=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(H){this._useRightHandedSystem!==H&&(this._useRightHandedSystem=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),q.prototype.setStepId=function(H){this._currentStepId=H},q.prototype.getStepId=function(){return this._currentStepId},q.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(q.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(H){this._fogEnabled!==H&&(this._fogEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"fogMode",{get:function(){return this._fogMode},set:function(H){this._fogMode!==H&&(this._fogMode=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(H){this._shadowsEnabled!==H&&(this._shadowsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(H){this._lightsEnabled!==H&&(this._lightsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(H){H!==this._activeCamera&&(this._activeCamera=H,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=q.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(H){this._defaultMaterial=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(H){this._texturesEnabled!==H&&(this._texturesEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(H){this._skeletonsEnabled!==H&&(this._skeletonsEnabled=H,this.markAllMaterialsAsDirty(L.a.MATERIAL_AttributesDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=q.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),q.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var H=0,X=this._transientComponents;H<X.length;H++)X[H].register();this._transientComponents=[]}},q.prototype._addComponent=function(H){this._components.push(H),this._transientComponents.push(H);var X=H;X.addFromContainer&&X.serialize&&this._serializableComponents.push(X)},q.prototype._getComponent=function(H){for(var X=0,ee=this._components;X<ee.length;X++){var Q=ee[X];if(Q.name===H)return Q}return null},q.prototype.getClassName=function(){return"Scene"},q.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},q.prototype._getDefaultSubMeshCandidates=function(H){return this._defaultSubMeshCandidates.data=H.subMeshes,this._defaultSubMeshCandidates.length=H.subMeshes.length,this._defaultSubMeshCandidates},q.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(q.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(H){this._inputManager.pointerX=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(H){this._inputManager.pointerY=H},enumerable:!1,configurable:!0}),q.prototype.getCachedMaterial=function(){return this._cachedMaterial},q.prototype.getCachedEffect=function(){return this._cachedEffect},q.prototype.getCachedVisibility=function(){return this._cachedVisibility},q.prototype.isCachedMaterialInvalid=function(H,X,ee){return ee===void 0&&(ee=1),this._cachedEffect!==X||this._cachedMaterial!==H||this._cachedVisibility!==ee},q.prototype.getEngine=function(){return this._engine},q.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(q.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),q.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(q.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),q.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(q.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),q.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(q.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),q.prototype.getActiveMeshes=function(){return this._activeMeshes},q.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},q.prototype.getRenderId=function(){return this._renderId},q.prototype.getFrameId=function(){return this._frameId},q.prototype.incrementRenderId=function(){this._renderId++},q.prototype._createUbo=function(){this._sceneUbo=new _.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},q.prototype.simulatePointerMove=function(H,X){return this._inputManager.simulatePointerMove(H,X),this},q.prototype.simulatePointerDown=function(H,X){return this._inputManager.simulatePointerDown(H,X),this},q.prototype.simulatePointerUp=function(H,X,ee){return this._inputManager.simulatePointerUp(H,X,ee),this},q.prototype.isPointerCaptured=function(H){return H===void 0&&(H=0),this._inputManager.isPointerCaptured(H)},q.prototype.attachControl=function(H,X,ee){H===void 0&&(H=!0),X===void 0&&(X=!0),ee===void 0&&(ee=!0),this._inputManager.attachControl(H,X,ee)},q.prototype.detachControl=function(){this._inputManager.detachControl()},q.prototype.isReady=function(){if(this._isDisposed)return!1;var H,X=this.getEngine();if(!X.areAllEffectsReady()||this._pendingData.length>0)return!1;for(H=0;H<this.meshes.length;H++){var ee=this.meshes[H];if(ee.isEnabled()&&ee.subMeshes&&ee.subMeshes.length!==0){if(!ee.isReady(!0))return!1;for(var Q=ee.hasThinInstances||ee.getClassName()==="InstancedMesh"||ee.getClassName()==="InstancedLinesMesh"||X.getCaps().instancedArrays&&ee.instances.length>0,te=0,ge=this._isReadyForMeshStage;te<ge.length;te++)if(!ge[te].action(ee,Q))return!1}}for(H=0;H<this.geometries.length;H++)if(this.geometries[H].delayLoadState===L.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var ce=0,de=this.activeCameras;ce<de.length;ce++)if(!de[ce].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var ne=0,pe=this.particleSystems;ne<pe.length;ne++)if(!pe[ne].isReady())return!1;return!0},q.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},q.prototype.registerBeforeRender=function(H){this.onBeforeRenderObservable.add(H)},q.prototype.unregisterBeforeRender=function(H){this.onBeforeRenderObservable.removeCallback(H)},q.prototype.registerAfterRender=function(H){this.onAfterRenderObservable.add(H)},q.prototype.unregisterAfterRender=function(H){this.onAfterRenderObservable.removeCallback(H)},q.prototype._executeOnceBeforeRender=function(H){var X=this,ee=function(){H(),setTimeout(function(){X.unregisterBeforeRender(ee)})};this.registerBeforeRender(ee)},q.prototype.executeOnceBeforeRender=function(H,X){var ee=this;X!==void 0?setTimeout(function(){ee._executeOnceBeforeRender(H)},X):this._executeOnceBeforeRender(H)},q.prototype._addPendingData=function(H){this._pendingData.push(H)},q.prototype._removePendingData=function(H){var X=this.isLoading,ee=this._pendingData.indexOf(H);ee!==-1&&this._pendingData.splice(ee,1),X&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},q.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(q.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),q.prototype.executeWhenReady=function(H){var X=this;this.onReadyObservable.add(H),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){X._checkIsReady()},150))},q.prototype.whenReadyAsync=function(){var H=this;return new Promise(function(X){H.executeWhenReady(function(){X()})})},q.prototype._checkIsReady=function(){var H=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){H._checkIsReady()},150))},Object.defineProperty(q.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),q.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=S.a.Now},q.prototype.getViewMatrix=function(){return this._viewMatrix},q.prototype.getProjectionMatrix=function(){return this._projectionMatrix},q.prototype.getTransformMatrix=function(){return this._transformMatrix},q.prototype.setTransformMatrix=function(H,X,ee,Q){this._viewUpdateFlag===H.updateFlag&&this._projectionUpdateFlag===X.updateFlag||(this._viewUpdateFlag=H.updateFlag,this._projectionUpdateFlag=X.updateFlag,this._viewMatrix=H,this._projectionMatrix=X,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?B.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=B.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(ee,Q):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},q.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},q.prototype.getUniqueId=function(){return G.a.UniqueId},q.prototype.addMesh=function(H,X){var ee=this;X===void 0&&(X=!1),this._blockEntityCollection||(this.meshes.push(H),H._resyncLightSources(),H.parent||H._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(H),X&&H.getChildMeshes().forEach(function(Q){ee.addMesh(Q)}))},q.prototype.removeMesh=function(H,X){var ee=this;X===void 0&&(X=!1);var Q=this.meshes.indexOf(H);return Q!==-1&&(this.meshes[Q]=this.meshes[this.meshes.length-1],this.meshes.pop(),H.parent||H._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(H),X&&H.getChildMeshes().forEach(function(te){ee.removeMesh(te)}),Q},q.prototype.addTransformNode=function(H){this._blockEntityCollection||(H._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(H),H.parent||H._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(H))},q.prototype.removeTransformNode=function(H){var X=H._indexInSceneTransformNodesArray;if(X!==-1){if(X!==this.transformNodes.length-1){var ee=this.transformNodes[this.transformNodes.length-1];this.transformNodes[X]=ee,ee._indexInSceneTransformNodesArray=X}H._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),H.parent||H._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(H),X},q.prototype.removeSkeleton=function(H){var X=this.skeletons.indexOf(H);return X!==-1&&(this.skeletons.splice(X,1),this.onSkeletonRemovedObservable.notifyObservers(H)),X},q.prototype.removeMorphTargetManager=function(H){var X=this.morphTargetManagers.indexOf(H);return X!==-1&&this.morphTargetManagers.splice(X,1),X},q.prototype.removeLight=function(H){var X=this.lights.indexOf(H);if(X!==-1){for(var ee=0,Q=this.meshes;ee<Q.length;ee++)Q[ee]._removeLightSource(H,!1);this.lights.splice(X,1),this.sortLightsByPriority(),H.parent||H._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(H),X},q.prototype.removeCamera=function(H){var X=this.cameras.indexOf(H);if(X!==-1&&(this.cameras.splice(X,1),H.parent||H._removeFromSceneRootNodes()),this.activeCameras){var ee=this.activeCameras.indexOf(H);ee!==-1&&this.activeCameras.splice(ee,1)}return this.activeCamera===H&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(H),X},q.prototype.removeParticleSystem=function(H){var X=this.particleSystems.indexOf(H);return X!==-1&&this.particleSystems.splice(X,1),X},q.prototype.removeAnimation=function(H){var X=this.animations.indexOf(H);return X!==-1&&this.animations.splice(X,1),X},q.prototype.stopAnimation=function(H,X,ee){},q.prototype.removeAnimationGroup=function(H){var X=this.animationGroups.indexOf(H);return X!==-1&&this.animationGroups.splice(X,1),X},q.prototype.removeMultiMaterial=function(H){var X=this.multiMaterials.indexOf(H);return X!==-1&&this.multiMaterials.splice(X,1),this.onMultiMaterialRemovedObservable.notifyObservers(H),X},q.prototype.removeMaterial=function(H){var X=H._indexInSceneMaterialArray;if(X!==-1&&X<this.materials.length){if(X!==this.materials.length-1){var ee=this.materials[this.materials.length-1];this.materials[X]=ee,ee._indexInSceneMaterialArray=X}H._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(H),X},q.prototype.removeActionManager=function(H){var X=this.actionManagers.indexOf(H);return X!==-1&&this.actionManagers.splice(X,1),X},q.prototype.removeTexture=function(H){var X=this.textures.indexOf(H);return X!==-1&&this.textures.splice(X,1),this.onTextureRemovedObservable.notifyObservers(H),X},q.prototype.addLight=function(H){if(!this._blockEntityCollection){this.lights.push(H),this.sortLightsByPriority(),H.parent||H._addToSceneRootNodes();for(var X=0,ee=this.meshes;X<ee.length;X++){var Q=ee[X];Q.lightSources.indexOf(H)===-1&&(Q.lightSources.push(H),Q._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(H)}},q.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(g.a.CompareLightsPriority)},q.prototype.addCamera=function(H){this._blockEntityCollection||(this.cameras.push(H),this.onNewCameraAddedObservable.notifyObservers(H),H.parent||H._addToSceneRootNodes())},q.prototype.addSkeleton=function(H){this._blockEntityCollection||(this.skeletons.push(H),this.onNewSkeletonAddedObservable.notifyObservers(H))},q.prototype.addParticleSystem=function(H){this._blockEntityCollection||this.particleSystems.push(H)},q.prototype.addAnimation=function(H){this._blockEntityCollection||this.animations.push(H)},q.prototype.addAnimationGroup=function(H){this._blockEntityCollection||this.animationGroups.push(H)},q.prototype.addMultiMaterial=function(H){this._blockEntityCollection||(this.multiMaterials.push(H),this.onNewMultiMaterialAddedObservable.notifyObservers(H))},q.prototype.addMaterial=function(H){this._blockEntityCollection||(H._indexInSceneMaterialArray=this.materials.length,this.materials.push(H),this.onNewMaterialAddedObservable.notifyObservers(H))},q.prototype.addMorphTargetManager=function(H){this._blockEntityCollection||this.morphTargetManagers.push(H)},q.prototype.addGeometry=function(H){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[H.uniqueId]=this.geometries.length),this.geometries.push(H))},q.prototype.addActionManager=function(H){this.actionManagers.push(H)},q.prototype.addTexture=function(H){this._blockEntityCollection||(this.textures.push(H),this.onNewTextureAddedObservable.notifyObservers(H))},q.prototype.switchActiveCamera=function(H,X){X===void 0&&(X=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=H,X&&H.attachControl())},q.prototype.setActiveCameraByID=function(H){var X=this.getCameraByID(H);return X?(this.activeCamera=X,X):null},q.prototype.setActiveCameraByName=function(H){var X=this.getCameraByName(H);return X?(this.activeCamera=X,X):null},q.prototype.getAnimationGroupByName=function(H){for(var X=0;X<this.animationGroups.length;X++)if(this.animationGroups[X].name===H)return this.animationGroups[X];return null},q.prototype.getMaterialByUniqueID=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].uniqueId===H)return this.materials[X];return null},q.prototype.getMaterialByID=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].id===H)return this.materials[X];return null},q.prototype.getLastMaterialByID=function(H){for(var X=this.materials.length-1;X>=0;X--)if(this.materials[X].id===H)return this.materials[X];return null},q.prototype.getMaterialByName=function(H){for(var X=0;X<this.materials.length;X++)if(this.materials[X].name===H)return this.materials[X];return null},q.prototype.getTextureByUniqueID=function(H){for(var X=0;X<this.textures.length;X++)if(this.textures[X].uniqueId===H)return this.textures[X];return null},q.prototype.getCameraByID=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].id===H)return this.cameras[X];return null},q.prototype.getCameraByUniqueID=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].uniqueId===H)return this.cameras[X];return null},q.prototype.getCameraByName=function(H){for(var X=0;X<this.cameras.length;X++)if(this.cameras[X].name===H)return this.cameras[X];return null},q.prototype.getBoneByID=function(H){for(var X=0;X<this.skeletons.length;X++)for(var ee=this.skeletons[X],Q=0;Q<ee.bones.length;Q++)if(ee.bones[Q].id===H)return ee.bones[Q];return null},q.prototype.getBoneByName=function(H){for(var X=0;X<this.skeletons.length;X++)for(var ee=this.skeletons[X],Q=0;Q<ee.bones.length;Q++)if(ee.bones[Q].name===H)return ee.bones[Q];return null},q.prototype.getLightByName=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].name===H)return this.lights[X];return null},q.prototype.getLightByID=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].id===H)return this.lights[X];return null},q.prototype.getLightByUniqueID=function(H){for(var X=0;X<this.lights.length;X++)if(this.lights[X].uniqueId===H)return this.lights[X];return null},q.prototype.getParticleSystemByID=function(H){for(var X=0;X<this.particleSystems.length;X++)if(this.particleSystems[X].id===H)return this.particleSystems[X];return null},q.prototype.getGeometryByID=function(H){for(var X=0;X<this.geometries.length;X++)if(this.geometries[X].id===H)return this.geometries[X];return null},q.prototype._getGeometryByUniqueID=function(H){if(this.geometriesByUniqueId){var X=this.geometriesByUniqueId[H];if(X!==void 0)return this.geometries[X]}else for(var ee=0;ee<this.geometries.length;ee++)if(this.geometries[ee].uniqueId===H)return this.geometries[ee];return null},q.prototype.pushGeometry=function(H,X){return!(!X&&this._getGeometryByUniqueID(H.uniqueId))&&(this.addGeometry(H),this.onNewGeometryAddedObservable.notifyObservers(H),!0)},q.prototype.removeGeometry=function(H){var X;if(this.geometriesByUniqueId){if((X=this.geometriesByUniqueId[H.uniqueId])===void 0)return!1}else if((X=this.geometries.indexOf(H))<0)return!1;if(X!==this.geometries.length-1){var ee=this.geometries[this.geometries.length-1];ee&&(this.geometries[X]=ee,this.geometriesByUniqueId&&(this.geometriesByUniqueId[ee.uniqueId]=X,this.geometriesByUniqueId[H.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(H),!0},q.prototype.getGeometries=function(){return this.geometries},q.prototype.getMeshByID=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].id===H)return this.meshes[X];return null},q.prototype.getMeshesByID=function(H){return this.meshes.filter(function(X){return X.id===H})},q.prototype.getTransformNodeByID=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].id===H)return this.transformNodes[X];return null},q.prototype.getTransformNodeByUniqueID=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].uniqueId===H)return this.transformNodes[X];return null},q.prototype.getTransformNodesByID=function(H){return this.transformNodes.filter(function(X){return X.id===H})},q.prototype.getMeshByUniqueID=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].uniqueId===H)return this.meshes[X];return null},q.prototype.getLastMeshByID=function(H){for(var X=this.meshes.length-1;X>=0;X--)if(this.meshes[X].id===H)return this.meshes[X];return null},q.prototype.getLastEntryByID=function(H){var X;for(X=this.meshes.length-1;X>=0;X--)if(this.meshes[X].id===H)return this.meshes[X];for(X=this.transformNodes.length-1;X>=0;X--)if(this.transformNodes[X].id===H)return this.transformNodes[X];for(X=this.cameras.length-1;X>=0;X--)if(this.cameras[X].id===H)return this.cameras[X];for(X=this.lights.length-1;X>=0;X--)if(this.lights[X].id===H)return this.lights[X];return null},q.prototype.getNodeByID=function(H){var X=this.getMeshByID(H);if(X)return X;var ee=this.getTransformNodeByID(H);if(ee)return ee;var Q=this.getLightByID(H);if(Q)return Q;var te=this.getCameraByID(H);if(te)return te;var ge=this.getBoneByID(H);return ge||null},q.prototype.getNodeByName=function(H){var X=this.getMeshByName(H);if(X)return X;var ee=this.getTransformNodeByName(H);if(ee)return ee;var Q=this.getLightByName(H);if(Q)return Q;var te=this.getCameraByName(H);if(te)return te;var ge=this.getBoneByName(H);return ge||null},q.prototype.getMeshByName=function(H){for(var X=0;X<this.meshes.length;X++)if(this.meshes[X].name===H)return this.meshes[X];return null},q.prototype.getTransformNodeByName=function(H){for(var X=0;X<this.transformNodes.length;X++)if(this.transformNodes[X].name===H)return this.transformNodes[X];return null},q.prototype.getLastSkeletonByID=function(H){for(var X=this.skeletons.length-1;X>=0;X--)if(this.skeletons[X].id===H)return this.skeletons[X];return null},q.prototype.getSkeletonByUniqueId=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].uniqueId===H)return this.skeletons[X];return null},q.prototype.getSkeletonById=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].id===H)return this.skeletons[X];return null},q.prototype.getSkeletonByName=function(H){for(var X=0;X<this.skeletons.length;X++)if(this.skeletons[X].name===H)return this.skeletons[X];return null},q.prototype.getMorphTargetManagerById=function(H){for(var X=0;X<this.morphTargetManagers.length;X++)if(this.morphTargetManagers[X].uniqueId===H)return this.morphTargetManagers[X];return null},q.prototype.getMorphTargetById=function(H){for(var X=0;X<this.morphTargetManagers.length;++X)for(var ee=this.morphTargetManagers[X],Q=0;Q<ee.numTargets;++Q){var te=ee.getTarget(Q);if(te.id===H)return te}return null},q.prototype.getMorphTargetByName=function(H){for(var X=0;X<this.morphTargetManagers.length;++X)for(var ee=this.morphTargetManagers[X],Q=0;Q<ee.numTargets;++Q){var te=ee.getTarget(Q);if(te.name===H)return te}return null},q.prototype.getPostProcessByName=function(H){for(var X=0;X<this.postProcesses.length;++X){var ee=this.postProcesses[X];if(ee.name===H)return ee}return null},q.prototype.isActiveMesh=function(H){return this._activeMeshes.indexOf(H)!==-1},Object.defineProperty(q.prototype,"uid",{get:function(){return this._uid||(this._uid=m.b.RandomId()),this._uid},enumerable:!1,configurable:!0}),q.prototype.addExternalData=function(H,X){return this._externalData||(this._externalData=new R.a),this._externalData.add(H,X)},q.prototype.getExternalData=function(H){return this._externalData?this._externalData.get(H):null},q.prototype.getOrAddExternalDataWithFactory=function(H,X){return this._externalData||(this._externalData=new R.a),this._externalData.getOrAddWithFactory(H,X)},q.prototype.removeExternalData=function(H){return this._externalData.remove(H)},q.prototype._evaluateSubMesh=function(H,X,ee){if(ee.hasInstances||ee.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||X.alwaysSelectAsActiveMesh||X.subMeshes.length===1||H.isInFrustum(this._frustumPlanes)){for(var Q=0,te=this._evaluateSubMeshStage;Q<te.length;Q++)te[Q].action(X,H);var ge=H.getMaterial();ge!=null&&(ge.hasRenderTargetTextures&&ge.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(ge)===-1&&(this._processedMaterials.push(ge),this._renderTargets.concatWithNoDuplicate(ge.getRenderTargetTextures())),this._renderingManager.dispatch(H,X,ge))}},q.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(q.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(H){this._preventFreeActiveMeshesAndRenderingGroups!==H&&(H&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=H)},enumerable:!1,configurable:!0}),q.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var H=0;H<this.activeCameras.length;H++){var X=this.activeCameras[H];X&&X._activeMeshes&&X._activeMeshes.dispose()}},q.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var H=0;H<this.textures.length;H++){var X=this.textures[H];X&&X.renderList&&X.freeRenderingGroups()}},q.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},q.prototype.freezeActiveMeshes=function(H,X,ee){var Q=this;return H===void 0&&(H=!1),this.executeWhenReady(function(){if(Q.activeCamera){Q._frustumPlanes||Q.setTransformMatrix(Q.activeCamera.getViewMatrix(),Q.activeCamera.getProjectionMatrix()),Q._evaluateActiveMeshes(),Q._activeMeshesFrozen=!0,Q._skipEvaluateActiveMeshesCompletely=H;for(var te=0;te<Q._activeMeshes.length;te++)Q._activeMeshes.data[te]._freeze();X&&X()}else ee&&ee("No active camera found")}),this},q.prototype.unfreezeActiveMeshes=function(){for(var H=0;H<this.meshes.length;H++){var X=this.meshes[H];X._internalAbstractMeshDataInfo&&(X._internalAbstractMeshDataInfo._isActive=!1)}for(H=0;H<this._activeMeshes.length;H++)this._activeMeshes.data[H]._unFreeze();return this._activeMeshesFrozen=!1,this},q.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var H=this._activeMeshes.length,X=0;X<H;X++)(de=this._activeMeshes.data[X]).computeWorldMatrix();if(this._activeParticleSystems){var ee=this._activeParticleSystems.length;for(X=0;X<ee;X++)this._activeParticleSystems.data[X].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var Q=0,te=this._beforeEvaluateActiveMeshStage;Q<te.length;Q++)te[Q].action();var ge=this.getActiveMeshCandidates(),ce=ge.length;for(X=0;X<ce;X++){var de;if((de=ge.data[X])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!de.isBlocked&&(this._totalVertices.addCount(de.getTotalVertices(),!1),de.isReady()&&de.isEnabled()&&de.scaling.lengthSquared()!==0)){de.computeWorldMatrix(),de.actionManager&&de.actionManager.hasSpecificTriggers2(L.a.ACTION_OnIntersectionEnterTrigger,L.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(de);var ne=this.customLODSelector?this.customLODSelector(de,this.activeCamera):de.getLOD(this.activeCamera);if(de._internalAbstractMeshDataInfo._currentLOD=ne,de._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,ne!=null&&(ne!==de&&ne.billboardMode!==f.a.BILLBOARDMODE_NONE&&ne.computeWorldMatrix(),de._preActivate(),de.isVisible&&de.visibility>0&&(de.layerMask&this.activeCamera.layerMask)!=0&&(this._skipFrustumClipping||de.alwaysSelectAsActiveMesh||de.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(de),this.activeCamera._activeMeshes.push(de),ne!==de&&ne._activate(this._renderId,!1);for(var pe=0,Se=this._preActiveMeshStage;pe<Se.length;pe++)Se[pe].action(de);de._activate(this._renderId,!1)&&(de.isAnInstance?de._internalAbstractMeshDataInfo._actAsRegularMesh&&(ne=de):ne._internalAbstractMeshDataInfo._onlyForInstances=!1,ne._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(de,ne)),de._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var Te=0;Te<this.particleSystems.length;Te++){var Ne=this.particleSystems[Te];if(Ne.isStarted()&&Ne.emitter){var je=Ne.emitter;je.position&&!je.isEnabled()||(this._activeParticleSystems.push(Ne),Ne.animate(),this._renderingManager.dispatchParticles(Ne))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},q.prototype._activeMesh=function(H,X){if(this._skeletonsEnabled&&X.skeleton!==null&&X.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(X.skeleton)&&X.skeleton.prepare(),X.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(X)),X!=null&&X.subMeshes!==void 0&&X.subMeshes!==null&&X.subMeshes.length>0)for(var ee=this.getActiveSubMeshCandidates(X),Q=ee.length,te=0;te<Q;te++){var ge=ee.data[te];this._evaluateSubMesh(ge,X,H)}},q.prototype.updateTransformMatrix=function(H){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(H))},q.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var H=this.activeCamera.outputRenderTarget.getInternalTexture();H?this.getEngine().bindFramebuffer(H):Y.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},q.prototype._renderForCamera=function(H,X){if(!H||!H._skipRendering){var ee=this._engine;if(this._activeCamera=H,!this.activeCamera)throw new Error("Active camera not set");ee.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&H.outputRenderTarget&&H.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(H._rigCameras[0].getViewMatrix(),H._rigCameras[0].getProjectionMatrix(),H._rigCameras[1].getViewMatrix(),H._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var Q=0;Q<this._softwareSkinnedMeshes.length;Q++){var te=this._softwareSkinnedMeshes.data[Q];te.applySkeleton(te.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),H.customRenderTargets&&H.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(H.customRenderTargets),X&&X.customRenderTargets&&X.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(X.customRenderTargets);for(var ge=0,ce=this._gatherActiveCameraRenderTargetsStage;ge<ce.length;ge++)ce[ge].action(this._renderTargets);var de=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){m.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var ne=0;ne<this._renderTargets.length;ne++){var pe=this._renderTargets.data[ne];if(pe._shouldRender()){this._renderId++;var Se=pe.activeCamera&&pe.activeCamera!==this.activeCamera;pe.render(Se,this.dumpNextRenderTargets),de=!0}}m.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var Te=0,Ne=this._cameraDrawRenderTargetStage;Te<Ne.length;Te++)de=Ne[Te].action(this.activeCamera)||de;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(de=!0)}de&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||H._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var je=0,Xe=this._beforeCameraDrawStage;je<Xe.length;je++)Xe[je].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var Ye=0,Ke=this._afterCameraDrawStage;Ye<Ke.length;Ye++)Ke[Ye].action(this.activeCamera);if(this.postProcessManager&&!H._multiviewTexture){var nt=H.outputRenderTarget?H.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(H.isIntermediate,nt)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},q.prototype._processSubCameras=function(H){if(H.cameraRigMode===P.a.RIG_MODE_NONE||H.outputRenderTarget&&H.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(H),void this.onAfterRenderCameraObservable.notifyObservers(H);if(H._useMultiviewToSingleView)this._renderMultiviewToSingleView(H);else for(var X=0;X<H._rigCameras.length;X++)this._renderForCamera(H._rigCameras[X],H);this._activeCamera=H,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(H)},q.prototype._checkIntersections=function(){for(var H=0;H<this._meshesForIntersections.length;H++){var X=this._meshesForIntersections.data[H];if(X.actionManager)for(var ee=0;X.actionManager&&ee<X.actionManager.actions.length;ee++){var Q=X.actionManager.actions[ee];if(Q.trigger===L.a.ACTION_OnIntersectionEnterTrigger||Q.trigger===L.a.ACTION_OnIntersectionExitTrigger){var te=Q.getTriggerParameter(),ge=te instanceof x.a?te:te.mesh,ce=ge.intersectsMesh(X,te.usePreciseIntersection),de=X._intersectionsInProgress.indexOf(ge);ce&&de===-1?Q.trigger===L.a.ACTION_OnIntersectionEnterTrigger?(Q._executeCurrent(O.a.CreateNew(X,void 0,ge)),X._intersectionsInProgress.push(ge)):Q.trigger===L.a.ACTION_OnIntersectionExitTrigger&&X._intersectionsInProgress.push(ge):!ce&&de>-1&&(Q.trigger===L.a.ACTION_OnIntersectionExitTrigger&&Q._executeCurrent(O.a.CreateNew(X,void 0,ge)),X.actionManager.hasSpecificTrigger(L.a.ACTION_OnIntersectionExitTrigger,function(ne){var pe=ne instanceof x.a?ne:ne.mesh;return ge===pe})&&Q.trigger!==L.a.ACTION_OnIntersectionExitTrigger||X._intersectionsInProgress.splice(de,1))}}}},q.prototype._advancePhysicsEngineStep=function(H){},q.prototype._animate=function(){},q.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var H=Math.max(q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),q.MaxDeltaTime))+this._timeAccumulator,X=this._engine.getTimeStep(),ee=1e3/X/1e3,Q=0,te=this._engine.getLockstepMaxSteps(),ge=Math.floor(H/X);for(ge=Math.min(ge,te);H>0&&Q<ge;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=X*ee,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(X),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,Q++,H-=X;this._timeAccumulator=H<0?0:H}else H=this.useConstantAnimationDeltaTime?16:Math.max(q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),q.MaxDeltaTime)),this._animationRatio=.06*H,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(H)},q.prototype.render=function(H,X){if(H===void 0&&(H=!0),X===void 0&&(X=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(L.a.ACTION_OnEveryFrameTrigger),X||this.animate();for(var ee=0,Q=this._beforeCameraUpdateStage;ee<Q.length;ee++)Q[ee].action();if(H){if(this.activeCameras&&this.activeCameras.length>0)for(var te=0;te<this.activeCameras.length;te++){var ge=this.activeCameras[te];if(ge.update(),ge.cameraRigMode!==P.a.RIG_MODE_NONE)for(var ce=0;ce<ge._rigCameras.length;ce++)ge._rigCameras[ce].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==P.a.RIG_MODE_NONE))for(ce=0;ce<this.activeCamera._rigCameras.length;ce++)this.activeCamera._rigCameras[ce].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var de=this.getEngine(),ne=this.activeCamera;if(this.renderTargetsEnabled){m.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var pe=0;pe<this.customRenderTargets.length;pe++){var Se=this.customRenderTargets[pe];if(Se._shouldRender()){if(this._renderId++,this.activeCamera=Se.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");de.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),Se.render(ne!==this.activeCamera,this.dumpNextRenderTargets)}}m.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=ne,this._activeCamera&&this._activeCamera.cameraRigMode!==P.a.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var Te=0,Ne=this._beforeClearStage;Te<Ne.length;Te++)Ne[Te].action();!this.autoClearDepthAndStencil&&!this.autoClear||this.prePass||this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var je=0,Xe=this._gatherRenderTargetsStage;je<Xe.length;je++)Xe[je].action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(te=0;te<this.activeCameras.length;te++)te>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[te]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var Ye=0,Ke=this._afterRenderStage;Ye<Ke.length;Ye++)Ke[Ye].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(ce=0;ce<this._toBeDisposed.length;ce++){var nt=this._toBeDisposed[ce];nt&&nt.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},q.prototype.freezeMaterials=function(){for(var H=0;H<this.materials.length;H++)this.materials[H].freeze()},q.prototype.unfreezeMaterials=function(){for(var H=0;H<this.materials.length;H++)this.materials[H].unfreeze()},q.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,W.a._LastCreatedScene===this&&(W.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var H=0,X=this._components;H<X.length;H++)X[H].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var ee=0,Q=this._activeRequests;ee<Q.length;ee++)Q[ee].abort();var te;if(this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl(),this._engine.getInputElement())for(te=0;te<this.cameras.length;te++)this.cameras[te].detachControl();for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(te=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(te,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(q.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),q.prototype.clearCachedVertexData=function(){for(var H=0;H<this.meshes.length;H++){var X=this.meshes[H].geometry;if(X)for(var ee in X._indices=[],X._vertexBuffers)X._vertexBuffers.hasOwnProperty(ee)&&(X._vertexBuffers[ee]._buffer._data=null)}},q.prototype.cleanCachedTextureBuffer=function(){for(var H=0,X=this.textures;H<X.length;H++){var ee=X[H];ee._buffer&&(ee._buffer=null)}},q.prototype.getWorldExtends=function(H){var X=new b.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ee=new b.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return H=H||function(){return!0},this.meshes.filter(H).forEach(function(Q){if(Q.computeWorldMatrix(!0),Q.subMeshes&&Q.subMeshes.length!==0&&!Q.infiniteDistance){var te=Q.getBoundingInfo(),ge=te.boundingBox.minimumWorld,ce=te.boundingBox.maximumWorld;b.e.CheckExtends(ge,X,ee),b.e.CheckExtends(ce,X,ee)}}),{min:X,max:ee}},q.prototype.createPickingRay=function(H,X,ee,Q,te){throw ie.a.WarnImport("Ray")},q.prototype.createPickingRayToRef=function(H,X,ee,Q,te,ge){throw ie.a.WarnImport("Ray")},q.prototype.createPickingRayInCameraSpace=function(H,X,ee){throw ie.a.WarnImport("Ray")},q.prototype.createPickingRayInCameraSpaceToRef=function(H,X,ee,Q){throw ie.a.WarnImport("Ray")},q.prototype.pick=function(H,X,ee,Q,te,ge){var ce=new M.a;return ce._pickingUnavailable=!0,ce},q.prototype.pickWithBoundingInfo=function(H,X,ee,Q,te){var ge=new M.a;return ge._pickingUnavailable=!0,ge},q.prototype.pickWithRay=function(H,X,ee,Q){throw ie.a.WarnImport("Ray")},q.prototype.multiPick=function(H,X,ee,Q,te){throw ie.a.WarnImport("Ray")},q.prototype.multiPickWithRay=function(H,X,ee){throw ie.a.WarnImport("Ray")},q.prototype.setPointerOverMesh=function(H,X){this._inputManager.setPointerOverMesh(H,X)},q.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},q.prototype._rebuildGeometries=function(){for(var H=0,X=this.geometries;H<X.length;H++)X[H]._rebuild();for(var ee=0,Q=this.meshes;ee<Q.length;ee++)Q[ee]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var te=0,ge=this._components;te<ge.length;te++)ge[te].rebuild();for(var ce=0,de=this.particleSystems;ce<de.length;ce++)de[ce].rebuild()},q.prototype._rebuildTextures=function(){for(var H=0,X=this.textures;H<X.length;H++)X[H]._rebuild();this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag)},q.prototype._getByTags=function(H,X,ee){if(X===void 0)return H;var Q=[];for(var te in ee=ee||function(ce){},H){var ge=H[te];I.a&&I.a.MatchesQuery(ge,X)&&(Q.push(ge),ee(ge))}return Q},q.prototype.getMeshesByTags=function(H,X){return this._getByTags(this.meshes,H,X)},q.prototype.getCamerasByTags=function(H,X){return this._getByTags(this.cameras,H,X)},q.prototype.getLightsByTags=function(H,X){return this._getByTags(this.lights,H,X)},q.prototype.getMaterialByTags=function(H,X){return this._getByTags(this.materials,H,X).concat(this._getByTags(this.multiMaterials,H,X))},q.prototype.getTransformNodesByTags=function(H,X){return this._getByTags(this.transformNodes,H,X)},q.prototype.setRenderingOrder=function(H,X,ee,Q){X===void 0&&(X=null),ee===void 0&&(ee=null),Q===void 0&&(Q=null),this._renderingManager.setRenderingOrder(H,X,ee,Q)},q.prototype.setRenderingAutoClearDepthStencil=function(H,X,ee,Q){ee===void 0&&(ee=!0),Q===void 0&&(Q=!0),this._renderingManager.setRenderingAutoClearDepthStencil(H,X,ee,Q)},q.prototype.getAutoClearDepthStencilSetup=function(H){return this._renderingManager.getAutoClearDepthStencilSetup(H)},Object.defineProperty(q.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(H){this._blockMaterialDirtyMechanism!==H&&(this._blockMaterialDirtyMechanism=H,H||this.markAllMaterialsAsDirty(L.a.MATERIAL_AllDirtyFlag))},enumerable:!1,configurable:!0}),q.prototype.markAllMaterialsAsDirty=function(H,X){if(!this._blockMaterialDirtyMechanism)for(var ee=0,Q=this.materials;ee<Q.length;ee++){var te=Q[ee];X&&!X(te)||te.markAsDirty(H)}},q.prototype._loadFile=function(H,X,ee,Q,te,ge){var ce=this,de=$.a.LoadFile(H,X,ee,Q?this.offlineProvider:void 0,te,ge);return this._activeRequests.push(de),de.onCompleteObservable.add(function(ne){ce._activeRequests.splice(ce._activeRequests.indexOf(ne),1)}),de},q.prototype._loadFileAsync=function(H,X,ee,Q){var te=this;return new Promise(function(ge,ce){te._loadFile(H,function(de){ge(de)},X,ee,Q,function(de,ne){ce(ne)})})},q.prototype._requestFile=function(H,X,ee,Q,te,ge,ce){var de=this,ne=$.a.RequestFile(H,X,ee,Q?this.offlineProvider:void 0,te,ge,ce);return this._activeRequests.push(ne),ne.onCompleteObservable.add(function(pe){de._activeRequests.splice(de._activeRequests.indexOf(pe),1)}),ne},q.prototype._requestFileAsync=function(H,X,ee,Q,te){var ge=this;return new Promise(function(ce,de){ge._requestFile(H,function(ne){ce(ne)},X,ee,Q,function(ne){de(ne)},te)})},q.prototype._readFile=function(H,X,ee,Q,te){var ge=this,ce=$.a.ReadFile(H,X,ee,Q,te);return this._activeRequests.push(ce),ce.onCompleteObservable.add(function(de){ge._activeRequests.splice(ge._activeRequests.indexOf(de),1)}),ce},q.prototype._readFileAsync=function(H,X,ee){var Q=this;return new Promise(function(te,ge){Q._readFile(H,function(ce){te(ce)},X,ee,function(ce){ge(ce)})})},q.FOGMODE_NONE=0,q.FOGMODE_EXP=1,q.FOGMODE_EXP2=2,q.FOGMODE_LINEAR=3,q.MinDeltaTime=1,q.MaxDeltaTime=1e3,q}(A.a)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.WarnImport=function(S){return S+" needs to be imported before as it contains a side-effect required by your code."},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return Object.defineProperty(m,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(m,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),m.Instances=new Array,m._LastCreatedScene=null,m.UseFallbackTexture=!0,m.FallbackTexture="",m}()},function(p,s,c){c.d(s,"c",function(){return E}),c.d(s,"a",function(){return h}),c.d(s,"b",function(){return S});var E,m=c(0);(function(C){C[C.LOCAL=0]="LOCAL",C[C.WORLD=1]="WORLD",C[C.BONE=2]="BONE"})(E||(E={}));var S,h=function(){function C(){}return C.X=new m.e(1,0,0),C.Y=new m.e(0,1,0),C.Z=new m.e(0,0,1),C}();(function(C){C[C.X=0]="X",C[C.Y=1]="Y",C[C.Z=2]="Z"})(S||(S={}))},function(p,s,c){c.d(s,"a",function(){return T});var E=c(1),m=c(3),S=c(33),h=c(12),C=c(6),R=c(0),I=c(29),b=c(8),f=c(11),x=c(21),P=c(58),A=c(90),T=function(_){function g(M,O,N,V){V===void 0&&(V=!0);var U=_.call(this,M,N)||this;return U._position=R.e.Zero(),U._upVector=R.e.Up(),U.orthoLeft=null,U.orthoRight=null,U.orthoBottom=null,U.orthoTop=null,U.fov=.8,U.minZ=1,U.maxZ=1e4,U.inertia=.9,U.mode=g.PERSPECTIVE_CAMERA,U.isIntermediate=!1,U.viewport=new P.a(0,0,1,1),U.layerMask=268435455,U.fovMode=g.FOVMODE_VERTICAL_FIXED,U.cameraRigMode=g.RIG_MODE_NONE,U.customRenderTargets=new Array,U.outputRenderTarget=null,U.onViewMatrixChangedObservable=new C.c,U.onProjectionMatrixChangedObservable=new C.c,U.onAfterCheckInputsObservable=new C.c,U.onRestoreStateObservable=new C.c,U.isRigCamera=!1,U._rigCameras=new Array,U._webvrViewMatrix=R.a.Identity(),U._skipRendering=!1,U._projectionMatrix=new R.a,U._postProcesses=new Array,U._activeMeshes=new S.a(256),U._globalPosition=R.e.Zero(),U._computedViewMatrix=R.a.Identity(),U._doNotComputeProjectionMatrix=!1,U._transformMatrix=R.a.Zero(),U._refreshFrustumPlanes=!0,U._isCamera=!0,U._isLeftCamera=!1,U._isRightCamera=!1,U.getScene().addCamera(U),V&&!U.getScene().activeCamera&&(U.getScene().activeCamera=U),U.position=O,U}return Object(E.d)(g,_),Object.defineProperty(g.prototype,"position",{get:function(){return this._position},set:function(M){this._position=M},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"upVector",{get:function(){return this._upVector},set:function(M){this._upVector=M},enumerable:!1,configurable:!0}),g.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},g.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},g.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},g.prototype.getClassName=function(){return"Camera"},g.prototype.toString=function(M){var O="Name: "+this.name;if(O+=", type: "+this.getClassName(),this.animations)for(var N=0;N<this.animations.length;N++)O+=", animation[0]: "+this.animations[N].toString(M);return O},Object.defineProperty(g.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),g.prototype.getActiveMeshes=function(){return this._activeMeshes},g.prototype.isActiveMesh=function(M){return this._activeMeshes.indexOf(M)!==-1},g.prototype.isReady=function(M){if(M===void 0&&(M=!1),M)for(var O=0,N=this._postProcesses;O<N.length;O++){var V=N[O];if(V&&!V.isReady())return!1}return _.prototype.isReady.call(this,M)},g.prototype._initCache=function(){_.prototype._initCache.call(this),this._cache.position=new R.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new R.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},g.prototype._updateCache=function(M){M||_.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},g.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},g.prototype._isSynchronizedViewMatrix=function(){return!!_.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},g.prototype._isSynchronizedProjectionMatrix=function(){var M=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!M)return!1;var O=this.getEngine();return M=this.mode===g.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===O.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===O.getRenderWidth()&&this._cache.renderHeight===O.getRenderHeight()},g.prototype.attachControl=function(M,O){},g.prototype.detachControl=function(M){},g.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras()},g.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(g.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),g.prototype._getFirstPostProcess=function(){for(var M=0;M<this._postProcesses.length;M++)if(this._postProcesses[M]!==null)return this._postProcesses[M];return null},g.prototype._cascadePostProcessesToRigCams=function(){var M=this._getFirstPostProcess();M&&M.markTextureDirty();for(var O=0,N=this._rigCameras.length;O<N;O++){var V=this._rigCameras[O],U=V._rigPostProcess;U?(U.getEffectName()==="pass"&&(V.isIntermediate=this._postProcesses.length===0),V._postProcesses=this._postProcesses.slice(0).concat(U),U.markTextureDirty()):V._postProcesses=this._postProcesses.slice(0)}},g.prototype.attachPostProcess=function(M,O){return O===void 0&&(O=null),!M.isReusable()&&this._postProcesses.indexOf(M)>-1?(b.a.Error("You're trying to reuse a post process not defined as reusable."),0):(O==null||O<0?this._postProcesses.push(M):this._postProcesses[O]===null?this._postProcesses[O]=M:this._postProcesses.splice(O,0,M),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(M))},g.prototype.detachPostProcess=function(M){var O=this._postProcesses.indexOf(M);O!==-1&&(this._postProcesses[O]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},g.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},g.prototype._getViewMatrix=function(){return R.a.Identity()},g.prototype.getViewMatrix=function(M){return!M&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},g.prototype.freezeProjectionMatrix=function(M){this._doNotComputeProjectionMatrix=!0,M!==void 0&&(this._projectionMatrix=M)},g.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},g.prototype.getProjectionMatrix=function(M){var O,N,V,U,L,j,Y,W;if(this._doNotComputeProjectionMatrix||!M&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var ie=this.getEngine(),re=this.getScene();if(this.mode===g.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=ie.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var ye=ie.useReverseDepthBuffer;(re.useRightHandedSystem?ye?R.a.PerspectiveFovReverseRHToRef:R.a.PerspectiveFovRHToRef:ye?R.a.PerspectiveFovReverseLHToRef:R.a.PerspectiveFovLHToRef)(this.fov,ie.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED)}else{var ve=ie.getRenderWidth()/2,ue=ie.getRenderHeight()/2;re.useRightHandedSystem?R.a.OrthoOffCenterRHToRef((O=this.orthoLeft)!==null&&O!==void 0?O:-ve,(N=this.orthoRight)!==null&&N!==void 0?N:ve,(V=this.orthoBottom)!==null&&V!==void 0?V:-ue,(U=this.orthoTop)!==null&&U!==void 0?U:ue,this.minZ,this.maxZ,this._projectionMatrix):R.a.OrthoOffCenterLHToRef((L=this.orthoLeft)!==null&&L!==void 0?L:-ve,(j=this.orthoRight)!==null&&j!==void 0?j:ve,(Y=this.orthoBottom)!==null&&Y!==void 0?Y:-ue,(W=this.orthoTop)!==null&&W!==void 0?W:ue,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=ie.getRenderWidth(),this._cache.renderHeight=ie.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},g.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},g.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?A.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=A.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},g.prototype.isInFrustum=function(M,O){if(O===void 0&&(O=!1),this._updateFrustumPlanes(),O&&this.rigCameras.length>0){var N=!1;return this.rigCameras.forEach(function(V){V._updateFrustumPlanes(),N=N||M.isInFrustum(V._frustumPlanes)}),N}return M.isInFrustum(this._frustumPlanes)},g.prototype.isCompletelyInFrustum=function(M){return this._updateFrustumPlanes(),M.isCompletelyInFrustum(this._frustumPlanes)},g.prototype.getForwardRay=function(M,O,N){throw x.a.WarnImport("Ray")},g.prototype.getForwardRayToRef=function(M,O,N,V){throw x.a.WarnImport("Ray")},g.prototype.dispose=function(M,O){for(O===void 0&&(O=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var N=this._rigCameras.pop();N&&N.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var V=this._postProcesses.length;--V>=0;){var U=this._postProcesses[V];U&&U.dispose(this)}for(V=this.customRenderTargets.length;--V>=0;)this.customRenderTargets[V].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),_.prototype.dispose.call(this,M,O)},Object.defineProperty(g.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),g.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},g.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},g.prototype.setCameraRigMode=function(M,O){if(this.cameraRigMode!==M){for(;this._rigCameras.length>0;){var N=this._rigCameras.pop();N&&N.dispose()}if(this.cameraRigMode=M,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=O.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=h.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){var V=this.createRigCamera(this.name+"_L",0);V&&(V._isLeftCamera=!0);var U=this.createRigCamera(this.name+"_R",1);U&&(U._isRightCamera=!0),V&&U&&(this._rigCameras.push(V),this._rigCameras.push(U))}switch(this.cameraRigMode){case g.RIG_MODE_STEREOSCOPIC_ANAGLYPH:g._setStereoscopicAnaglyphRigMode(this);break;case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case g.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.RIG_MODE_STEREOSCOPIC_INTERLACED:g._setStereoscopicRigMode(this);break;case g.RIG_MODE_VR:g._setVRRigMode(this,O);break;case g.RIG_MODE_WEBVR:g._setWebVRRigMode(this,O)}this._cascadePostProcessesToRigCams(),this.update()}},g._setStereoscopicRigMode=function(M){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},g._setStereoscopicAnaglyphRigMode=function(M){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},g._setVRRigMode=function(M,O){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},g._setWebVRRigMode=function(M,O){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},g.prototype._getVRProjectionMatrix=function(){return R.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},g.prototype._updateCameraRotationMatrix=function(){},g.prototype._updateWebVRCameraRotationMatrix=function(){},g.prototype._getWebVRProjectionMatrix=function(){return R.a.Identity()},g.prototype._getWebVRViewMatrix=function(){return R.a.Identity()},g.prototype.setCameraRigParameter=function(M,O){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[M]=O,M==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=h.b.ToRadians(O/.0637))},g.prototype.createRigCamera=function(M,O){return null},g.prototype._updateRigCameras=function(){for(var M=0;M<this._rigCameras.length;M++)this._rigCameras[M].minZ=this.minZ,this._rigCameras[M].maxZ=this.maxZ,this._rigCameras[M].fov=this.fov,this._rigCameras[M].upVector.copyFrom(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},g.prototype._setupInputs=function(){},g.prototype.serialize=function(){var M=m.a.Serialize(this);return M.type=this.getClassName(),this.parent&&(M.parentId=this.parent.id),this.inputs&&this.inputs.serialize(M),m.a.AppendSerializedAnimations(this,M),M.ranges=this.serializeAnimationRanges(),M},g.prototype.clone=function(M){return m.a.Clone(g.GetConstructorFromName(this.getClassName(),M,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},g.prototype.getDirection=function(M){var O=R.e.Zero();return this.getDirectionToRef(M,O),O},Object.defineProperty(g.prototype,"absoluteRotation",{get:function(){var M=R.b.Zero();return this.getWorldMatrix().decompose(void 0,M),M},enumerable:!1,configurable:!0}),g.prototype.getDirectionToRef=function(M,O){R.e.TransformNormalToRef(M,this.getWorldMatrix(),O)},g.GetConstructorFromName=function(M,O,N,V,U){V===void 0&&(V=0),U===void 0&&(U=!0);var L=I.a.Construct(M,O,N,{interaxial_distance:V,isStereoscopicSideBySide:U});return L||function(){return g._createDefaultParsedCamera(O,N)}},g.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},g.Parse=function(M,O){var N=M.type,V=g.GetConstructorFromName(N,M.name,O,M.interaxial_distance,M.isStereoscopicSideBySide),U=m.a.Parse(V,M,O);if(M.parentId&&(U._waitingParentId=M.parentId),U.inputs&&(U.inputs.parse(M),U._setupInputs()),M.upVector&&(U.upVector=R.e.FromArray(M.upVector)),U.setPosition&&(U.position.copyFromFloats(0,0,0),U.setPosition(R.e.FromArray(M.position))),M.target&&U.setTarget&&U.setTarget(R.e.FromArray(M.target)),M.cameraRigMode){var L=M.interaxial_distance?{interaxialDistance:M.interaxial_distance}:{};U.setCameraRigMode(M.cameraRigMode,L)}if(M.animations){for(var j=0;j<M.animations.length;j++){var Y=M.animations[j],W=f.a.GetClass("BABYLON.Animation");W&&U.animations.push(W.Parse(Y))}I.a.ParseAnimationRanges(U,M,O)}return M.autoAnimate&&O.beginAnimation(U,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),U},g._createDefaultParsedCamera=function(M,O){throw x.a.WarnImport("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_WEBVR=21,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,Object(E.c)([Object(m.o)("position")],g.prototype,"_position",void 0),Object(E.c)([Object(m.o)("upVector")],g.prototype,"_upVector",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoLeft",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoRight",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoBottom",void 0),Object(E.c)([Object(m.c)()],g.prototype,"orthoTop",void 0),Object(E.c)([Object(m.c)()],g.prototype,"fov",void 0),Object(E.c)([Object(m.c)()],g.prototype,"minZ",void 0),Object(E.c)([Object(m.c)()],g.prototype,"maxZ",void 0),Object(E.c)([Object(m.c)()],g.prototype,"inertia",void 0),Object(E.c)([Object(m.c)()],g.prototype,"mode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"layerMask",void 0),Object(E.c)([Object(m.c)()],g.prototype,"fovMode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"cameraRigMode",void 0),Object(E.c)([Object(m.c)()],g.prototype,"interaxialDistance",void 0),Object(E.c)([Object(m.c)()],g.prototype,"isStereoscopicSideBySide",void 0),g}(I.a)},function(p,s,c){c.d(s,"a",function(){return P});var E=c(1),m=c(3),S=c(12),h=c(6),C=c(22),R=c(61),I=c(85),b=c(2),f=c(8),x=c(64),P=function(){function A(T,_,g){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new h.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=b.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=A.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=T;var M=1;for(this._scene=_||C.a.LastCreatedScene,this.id=T||S.b.RandomId();this._scene.getMaterialByID(this.id);)this.id=T+" "+M++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=A.ClockWiseSideOrientation:this.sideOrientation=A.CounterClockWiseSideOrientation,this._uniformBuffer=new I.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,g||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(A.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"alpha",{get:function(){return this._alpha},set:function(T){this._alpha!==T&&(this._alpha=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(T){this._backFaceCulling!==T&&(this._backFaceCulling=T,this.markAsDirty(A.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onDispose",{set:function(T){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(T)},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new h.c),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onBind",{set:function(T){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(T)},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new h.c),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new h.c),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(T){this._alphaMode!==T&&(this._alphaMode=T,this.markAsDirty(A.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(T){this._needDepthPrePass!==T&&(this._needDepthPrePass=T,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(T){this._fogEnabled!==T&&(this._fogEnabled=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"wireframe",{get:function(){switch(this._fillMode){case A.WireFrameFillMode:case A.LineListDrawMode:case A.LineLoopDrawMode:case A.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(T){this.fillMode=T?A.WireFrameFillMode:A.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case A.PointFillMode:case A.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(T){this.fillMode=T?A.PointFillMode:A.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"fillMode",{get:function(){return this._fillMode},set:function(T){this._fillMode!==T&&(this._fillMode=T,this.markAsDirty(A.MiscDirtyFlag))},enumerable:!1,configurable:!0}),A.prototype.toString=function(T){return"Name: "+this.name},A.prototype.getClassName=function(){return"Material"},Object.defineProperty(A.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),A.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},A.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},A.prototype.isReady=function(T,_){return!0},A.prototype.isReadyForSubMesh=function(T,_,g){return!1},A.prototype.getEffect=function(){return this._effect},A.prototype.getScene=function(){return this._scene},Object.defineProperty(A.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(T){this._transparencyMode!==T&&(this._transparencyMode=T,this._forceAlphaTest=T===A.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===A.MATERIAL_OPAQUE||this._transparencyMode===A.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),A.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},A.prototype.needAlphaBlendingForMesh=function(T){return!(this._disableAlphaBlending&&T.visibility>=1)&&(this.needAlphaBlending()||T.visibility<1||T.hasVertexAlpha)},A.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},A.prototype._shouldTurnAlphaTestOn=function(T){return!this.needAlphaBlendingForMesh(T)&&this.needAlphaTesting()},A.prototype.getAlphaTestTexture=function(){return null},A.prototype.markDirty=function(){for(var T=0,_=this.getScene().meshes;T<_.length;T++){var g=_[T];if(g.subMeshes)for(var M=0,O=g.subMeshes;M<O.length;M++){var N=O[M];N.getMaterial()===this&&N.effect&&(N.effect._wasPreviouslyReady=!1)}}},A.prototype._preBind=function(T,_){_===void 0&&(_=null);var g=this._scene.getEngine(),M=(_??this.sideOrientation)===A.ClockWiseSideOrientation;return g.enableEffect(T||this._effect),g.setState(this.backFaceCulling,this.zOffset,!1,M),M},A.prototype.bind=function(T,_){},A.prototype.bindForSubMesh=function(T,_,g){},A.prototype.bindOnlyWorldMatrix=function(T){},A.prototype.bindSceneUniformBuffer=function(T,_){_.bindToEffect(T,"Scene")},A.prototype.bindView=function(T){this._useUBO?this.bindSceneUniformBuffer(T,this.getScene().getSceneUniformBuffer()):T.setMatrix("view",this.getScene().getViewMatrix())},A.prototype.bindViewProjection=function(T){this._useUBO?this.bindSceneUniformBuffer(T,this.getScene().getSceneUniformBuffer()):T.setMatrix("viewProjection",this.getScene().getTransformMatrix())},A.prototype._afterBind=function(T){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=T?T.visibility:1,this._onBindObservable&&T&&this._onBindObservable.notifyObservers(T),this.disableDepthWrite){var _=this._scene.getEngine();this._cachedDepthWriteState=_.getDepthWrite(),_.setDepthWrite(!1)}this.disableColorWrite&&(_=this._scene.getEngine(),this._cachedColorWriteState=_.getColorWrite(),_.setColorWrite(!1)),this.depthFunction!==0&&(_=this._scene.getEngine(),this._cachedDepthFunctionState=_.getDepthFunction()||0,_.setDepthFunction(this.depthFunction))},A.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},A.prototype.getActiveTextures=function(){return[]},A.prototype.hasTexture=function(T){return!1},A.prototype.clone=function(T){return null},A.prototype.getBindedMeshes=function(){var T=this;if(this.meshMap){var _=new Array;for(var g in this.meshMap){var M=this.meshMap[g];M&&_.push(M)}return _}return this._scene.meshes.filter(function(O){return O.material===T})},A.prototype.forceCompilation=function(T,_,g,M){var O=this,N=Object(E.a)({clipPlane:!1,useInstances:!1},g),V=this.getScene(),U=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var L=function(){if(O._scene&&O._scene.getEngine()){var j=V.clipPlane;if(N.clipPlane&&(V.clipPlane=new x.a(0,0,0,1)),O._storeEffectOnSubMeshes){var Y=!0,W=null;if(T.subMeshes){var ie=new R.a(0,0,0,0,0,T,void 0,!1,!1);ie._materialDefines&&(ie._materialDefines._renderId=-1),O.isReadyForSubMesh(T,ie,N.useInstances)||(ie.effect&&ie.effect.getCompilationError()&&ie.effect.allFallbacksProcessed()?W=ie.effect.getCompilationError():(Y=!1,setTimeout(L,16)))}Y&&(O.allowShaderHotSwapping=U,W&&M&&M(W),_&&_(O))}else O.isReady()?(O.allowShaderHotSwapping=U,_&&_(O)):setTimeout(L,16);N.clipPlane&&(V.clipPlane=j)}};L()},A.prototype.forceCompilationAsync=function(T,_){var g=this;return new Promise(function(M,O){g.forceCompilation(T,function(){M()},_,function(N){O(N)})})},A.prototype.markAsDirty=function(T){this.getScene().blockMaterialDirtyMechanism||(A._DirtyCallbackArray.length=0,T&A.TextureDirtyFlag&&A._DirtyCallbackArray.push(A._TextureDirtyCallBack),T&A.LightDirtyFlag&&A._DirtyCallbackArray.push(A._LightsDirtyCallBack),T&A.FresnelDirtyFlag&&A._DirtyCallbackArray.push(A._FresnelDirtyCallBack),T&A.AttributesDirtyFlag&&A._DirtyCallbackArray.push(A._AttributeDirtyCallBack),T&A.MiscDirtyFlag&&A._DirtyCallbackArray.push(A._MiscDirtyCallBack),T&A.PrePassDirtyFlag&&A._DirtyCallbackArray.push(A._PrePassDirtyCallBack),A._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(A._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},A.prototype._markAllSubMeshesAsDirty=function(T){if(!this.getScene().blockMaterialDirtyMechanism)for(var _=0,g=this.getScene().meshes;_<g.length;_++){var M=g[_];if(M.subMeshes)for(var O=0,N=M.subMeshes;O<N.length;O++){var V=N[O];V.getMaterial()===this&&V._materialDefines&&T(V._materialDefines)}}},A.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var T=this.getScene().enablePrePassRenderer();T&&T.markAsDirty()}},A.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(A._AllDirtyCallBack)},A.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(A._ImageProcessingDirtyCallBack)},A.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(A._TextureDirtyCallBack)},A.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(A._FresnelDirtyCallBack)},A.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(A._FresnelAndMiscDirtyCallBack)},A.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(A._LightsDirtyCallBack)},A.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(A._AttributeDirtyCallBack)},A.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(A._MiscDirtyCallBack)},A.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(A._MiscDirtyCallBack)},A.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(A._TextureAndMiscDirtyCallBack)},A.prototype.setPrePassRenderer=function(T){return!1},A.prototype.dispose=function(T,_,g){var M=this.getScene();if(M.stopAnimation(this),M.freeProcessedMaterials(),M.removeMaterial(this),g!==!0)if(this.meshMap)for(var O in this.meshMap)(U=this.meshMap[O])&&(U.material=null,this.releaseVertexArrayObject(U,T));else for(var N=0,V=M.meshes;N<V.length;N++){var U;(U=V[N]).material!==this||U.sourceMesh||(U.material=null,this.releaseVertexArrayObject(U,T))}this._uniformBuffer.dispose(),T&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},A.prototype.releaseVertexArrayObject=function(T,_){if(T.geometry){var g=T.geometry;if(this._storeEffectOnSubMeshes)for(var M=0,O=T.subMeshes;M<O.length;M++){var N=O[M];g._releaseVertexArrayObject(N._materialEffect),_&&N._materialEffect&&N._materialEffect.dispose()}else g._releaseVertexArrayObject(this._effect)}},A.prototype.serialize=function(){return m.a.Serialize(this)},A.Parse=function(T,_,g){if(T.customType){if(T.customType==="BABYLON.PBRMaterial"&&T.overloadedAlbedo&&(T.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return f.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else T.customType="BABYLON.StandardMaterial";return S.b.Instantiate(T.customType).Parse(T,_,g)},A.TriangleFillMode=b.a.MATERIAL_TriangleFillMode,A.WireFrameFillMode=b.a.MATERIAL_WireFrameFillMode,A.PointFillMode=b.a.MATERIAL_PointFillMode,A.PointListDrawMode=b.a.MATERIAL_PointListDrawMode,A.LineListDrawMode=b.a.MATERIAL_LineListDrawMode,A.LineLoopDrawMode=b.a.MATERIAL_LineLoopDrawMode,A.LineStripDrawMode=b.a.MATERIAL_LineStripDrawMode,A.TriangleStripDrawMode=b.a.MATERIAL_TriangleStripDrawMode,A.TriangleFanDrawMode=b.a.MATERIAL_TriangleFanDrawMode,A.ClockWiseSideOrientation=b.a.MATERIAL_ClockWiseSideOrientation,A.CounterClockWiseSideOrientation=b.a.MATERIAL_CounterClockWiseSideOrientation,A.TextureDirtyFlag=b.a.MATERIAL_TextureDirtyFlag,A.LightDirtyFlag=b.a.MATERIAL_LightDirtyFlag,A.FresnelDirtyFlag=b.a.MATERIAL_FresnelDirtyFlag,A.AttributesDirtyFlag=b.a.MATERIAL_AttributesDirtyFlag,A.MiscDirtyFlag=b.a.MATERIAL_MiscDirtyFlag,A.PrePassDirtyFlag=b.a.MATERIAL_PrePassDirtyFlag,A.AllDirtyFlag=b.a.MATERIAL_AllDirtyFlag,A.MATERIAL_OPAQUE=0,A.MATERIAL_ALPHATEST=1,A.MATERIAL_ALPHABLEND=2,A.MATERIAL_ALPHATESTANDBLEND=3,A.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,A.MATERIAL_NORMALBLENDMETHOD_RNM=1,A._AllDirtyCallBack=function(T){return T.markAllAsDirty()},A._ImageProcessingDirtyCallBack=function(T){return T.markAsImageProcessingDirty()},A._TextureDirtyCallBack=function(T){return T.markAsTexturesDirty()},A._FresnelDirtyCallBack=function(T){return T.markAsFresnelDirty()},A._MiscDirtyCallBack=function(T){return T.markAsMiscDirty()},A._PrePassDirtyCallBack=function(T){return T.markAsPrePassDirty()},A._LightsDirtyCallBack=function(T){return T.markAsLightDirty()},A._AttributeDirtyCallBack=function(T){return T.markAsAttributesDirty()},A._FresnelAndMiscDirtyCallBack=function(T){A._FresnelDirtyCallBack(T),A._MiscDirtyCallBack(T)},A._TextureAndMiscDirtyCallBack=function(T){A._TextureDirtyCallBack(T),A._MiscDirtyCallBack(T)},A._DirtyCallbackArray=[],A._RunDirtyCallBacks=function(T){for(var _=0,g=A._DirtyCallbackArray;_<g.length;_++)(0,g[_])(T)},Object(E.c)([Object(m.c)()],A.prototype,"id",void 0),Object(E.c)([Object(m.c)()],A.prototype,"uniqueId",void 0),Object(E.c)([Object(m.c)()],A.prototype,"name",void 0),Object(E.c)([Object(m.c)()],A.prototype,"checkReadyOnEveryCall",void 0),Object(E.c)([Object(m.c)()],A.prototype,"checkReadyOnlyOnce",void 0),Object(E.c)([Object(m.c)()],A.prototype,"state",void 0),Object(E.c)([Object(m.c)("alpha")],A.prototype,"_alpha",void 0),Object(E.c)([Object(m.c)("backFaceCulling")],A.prototype,"_backFaceCulling",void 0),Object(E.c)([Object(m.c)()],A.prototype,"sideOrientation",void 0),Object(E.c)([Object(m.c)("alphaMode")],A.prototype,"_alphaMode",void 0),Object(E.c)([Object(m.c)()],A.prototype,"_needDepthPrePass",void 0),Object(E.c)([Object(m.c)()],A.prototype,"disableDepthWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"disableColorWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"forceDepthWrite",void 0),Object(E.c)([Object(m.c)()],A.prototype,"depthFunction",void 0),Object(E.c)([Object(m.c)()],A.prototype,"separateCullingPass",void 0),Object(E.c)([Object(m.c)("fogEnabled")],A.prototype,"_fogEnabled",void 0),Object(E.c)([Object(m.c)()],A.prototype,"pointSize",void 0),Object(E.c)([Object(m.c)()],A.prototype,"zOffset",void 0),Object(E.c)([Object(m.c)()],A.prototype,"pointsCloud",null),Object(E.c)([Object(m.c)()],A.prototype,"fillMode",null),Object(E.c)([Object(m.c)()],A.prototype,"transparencyMode",null),A}()},function(p,s,c){c.d(s,"a",function(){return V});var E=c(22),m=c(5),S=c(21),h=c(6),C=c(141),R=c(142),I=c(143),b=c(2),f=c(27),x=c(8),P=c(38),A=function(){function U(){}return U.prototype.postProcessor=function(L,j,Y,W){return W.getCaps().drawBuffersExtension||(L=L.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),L},U}(),T=c(118),_=c(88),g=c(144),M=c(70),O=c(74),N=function(){},V=function(){function U(L,j,Y,W){var ie=this;W===void 0&&(W=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new h.c,this.onContextRestoredObservable=new h.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new C.a,this._stencilState=new R.a,this._alphaState=new I.a,this._alphaMode=b.a.ALPHA_ADD,this._alphaEquation=b.a.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new h.c,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(Q,te,ge,ce,de,ne){var pe=ie._gl,Se=pe.createRenderbuffer();return pe.bindRenderbuffer(pe.RENDERBUFFER,Se),ge>1&&pe.renderbufferStorageMultisample?pe.renderbufferStorageMultisample(pe.RENDERBUFFER,ge,de,Q,te):pe.renderbufferStorage(pe.RENDERBUFFER,ce,Q,te),pe.framebufferRenderbuffer(pe.FRAMEBUFFER,ne,pe.RENDERBUFFER,Se),pe.bindRenderbuffer(pe.RENDERBUFFER,null),Se},this._boundUniforms={};var re=null;if(L){if(Y=Y||{},O.a.SetMatrixPrecision(!!Y.useHighPrecisionMatrix),L.getContext){if(re=L,this._renderingCanvas=re,j!=null&&(Y.antialias=j),Y.deterministicLockstep===void 0&&(Y.deterministicLockstep=!1),Y.lockstepMaxSteps===void 0&&(Y.lockstepMaxSteps=4),Y.timeStep===void 0&&(Y.timeStep=1/60),Y.preserveDrawingBuffer===void 0&&(Y.preserveDrawingBuffer=!1),Y.audioEngine===void 0&&(Y.audioEngine=!0),Y.stencil===void 0&&(Y.stencil=!0),Y.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),Y.xrCompatible===void 0&&(Y.xrCompatible=!0),this._doNotHandleContextLost=!!Y.doNotHandleContextLost,navigator&&navigator.userAgent){var ye=navigator.userAgent;this.hostInformation.isMobile=ye.indexOf("Mobile")!==-1;for(var ve=0,ue=U.ExceptionList;ve<ue.length;ve++){var oe=ue[ve],Z=oe.key,J=oe.targets;if(new RegExp(Z).test(ye)){if(oe.capture&&oe.captureConstraint){var B=oe.capture,G=oe.captureConstraint,$=new RegExp(B).exec(ye);if($&&$.length>0&&parseInt($[$.length-1])>=G)continue}for(var he=0,se=J;he<se.length;he++)switch(se[he]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(Q){Q.preventDefault(),ie._contextWasLost=!0,x.a.Warn("WebGL context lost."),ie.onContextLostObservable.notifyObservers(ie)},this._onContextRestored=function(){setTimeout(function(){ie._initGLContext(),ie._rebuildEffects(),ie._rebuildInternalTextures(),ie._rebuildBuffers(),ie.wipeCaches(!0),x.a.Warn("WebGL context successfully restored."),ie.onContextRestoredObservable.notifyObservers(ie),ie._contextWasLost=!1},0)},re.addEventListener("webglcontextlost",this._onContextLost,!1),re.addEventListener("webglcontextrestored",this._onContextRestored,!1),Y.powerPreference="high-performance"),!Y.disableWebGL2Support)try{this._gl=re.getContext("webgl2",Y)||re.getContext("experimental-webgl2",Y),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(Q){}if(!this._gl){if(!re)throw new Error("The provided canvas is null or undefined.");try{this._gl=re.getContext("webgl",Y)||re.getContext("experimental-webgl",Y)}catch(Q){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=L,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var q=this._gl.getContextAttributes();q&&(Y.stencil=q.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),Y.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=Y.useHighPrecisionFloats);var H=P.a.IsWindowObjectExist()&&window.devicePixelRatio||1,X=Y.limitDeviceRatio||H;this._hardwareScalingLevel=W?1/Math.min(X,H):1,this.resize(),this._isStencilEnable=!!Y.stencil,this._initGLContext();for(var ee=0;ee<this._caps.maxVertexAttribs;ee++)this._currentBufferPointers[ee]=new N;this.webGLVersion>1?this._shaderProcessor=new T.a:this._shaderProcessor=new A,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=Y,console.log("Babylon.js v"+U.Version+" - "+this.description)}}return Object.defineProperty(U,"NpmPackage",{get:function(){return"babylonjs@4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(U,"Version",{get:function(){return"4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"description",{get:function(){var L="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(L+=" - Parallel shader compilation"),L},enumerable:!1,configurable:!0}),Object.defineProperty(U,"ShadersRepository",{get:function(){return m.a.ShadersRepository},set:function(L){m.a.ShadersRepository=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(L){this._doNotHandleContextLost=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"framebufferDimensionsObject",{set:function(L){this._framebufferDimensionsObject=L},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,b.a.TEXTUREFORMAT_RGBA,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var L=new Uint8Array(4),j=[L,L,L,L,L,L];this._emptyCubeTexture=this.createRawCubeTexture(j,1,b.a.TEXTUREFORMAT_RGBA,b.a.TEXTURETYPE_UNSIGNED_INT,!1,!1,b.a.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),U.prototype._rebuildInternalTextures=function(){for(var L=0,j=this._internalTexturesCache.slice();L<j.length;L++)j[L]._rebuild()},U.prototype._rebuildEffects=function(){for(var L in this._compiledEffects)this._compiledEffects[L]._prepareEffect();m.a.ResetCache()},U.prototype.areAllEffectsReady=function(){for(var L in this._compiledEffects)if(!this._compiledEffects[L].isReady())return!1;return!0},U.prototype._rebuildBuffers=function(){for(var L=0,j=this._uniformBuffers;L<j.length;L++)j[L]._rebuild()},U.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var L=this._gl.getExtension("WEBGL_debug_renderer_info");if(L!=null&&(this._glRenderer=this._gl.getParameter(L.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(L.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var j=this._gl.getExtension("WEBGL_draw_buffers");if(j!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=j.drawBuffersWEBGL.bind(j),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var Y=0;Y<16;Y++)this._gl["COLOR_ATTACHMENT"+Y+"_WEBGL"]=j["COLOR_ATTACHMENT"+Y+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var W=this._gl.getExtension("WEBGL_depth_texture");W!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=W.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var ie=this._gl.getExtension("OES_vertex_array_object");ie!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=ie.createVertexArrayOES.bind(ie),this._gl.bindVertexArray=ie.bindVertexArrayOES.bind(ie),this._gl.deleteVertexArray=ie.deleteVertexArrayOES.bind(ie))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var re=this._gl.getExtension("ANGLE_instanced_arrays");re!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=re.drawArraysInstancedANGLE.bind(re),this._gl.drawElementsInstanced=re.drawElementsInstancedANGLE.bind(re),this._gl.vertexAttribDivisor=re.vertexAttribDivisorANGLE.bind(re)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var ye=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),ve=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);ye&&ve&&(this._caps.highPrecisionShaderSupported=ye.precision!==0&&ve.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var ue=this._gl.getExtension("EXT_blend_minmax");ue!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=ue.MAX_EXT,this._gl.MIN=ue.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var oe=0;oe<this._maxSimultaneousTextures;oe++)this._nextFreeTextureSlots.push(oe)},Object.defineProperty(U.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),U.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(U.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),U.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=M.a.CreateCanvas(1,1);var L=this._workingCanvas.getContext("2d");L&&(this._workingContext=L)}},U.prototype.resetTextureCache=function(){for(var L in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(L)&&(this._boundTexturesCache[L]=null);this._currentTextureChannel=-1},U.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},U.prototype.setHardwareScalingLevel=function(L){this._hardwareScalingLevel=L,this.resize()},U.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},U.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},U.prototype.getCaps=function(){return this._caps},U.prototype.stopRenderLoop=function(L){if(L){var j=this._activeRenderLoops.indexOf(L);j>=0&&this._activeRenderLoops.splice(j,1)}else this._activeRenderLoops=[]},U.prototype._renderLoop=function(){if(!this._contextWasLost){var L=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(L=!1),L){this.beginFrame();for(var j=0;j<this._activeRenderLoops.length;j++)(0,this._activeRenderLoops[j])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},U.prototype.getRenderingCanvas=function(){return this._renderingCanvas},U.prototype.getHostWindow=function(){return P.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},U.prototype.getRenderWidth=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},U.prototype.getRenderHeight=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},U.prototype._queueNewFrame=function(L,j){return U.QueueNewFrame(L,j)},U.prototype.runRenderLoop=function(L){this._activeRenderLoops.indexOf(L)===-1&&(this._activeRenderLoops.push(L),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},U.prototype.clear=function(L,j,Y,W){W===void 0&&(W=!1),this.applyStates();var ie=0;j&&L&&(this._gl.clearColor(L.r,L.g,L.b,L.a!==void 0?L.a:1),ie|=this._gl.COLOR_BUFFER_BIT),Y&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),ie|=this._gl.DEPTH_BUFFER_BIT),W&&(this._gl.clearStencil(0),ie|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(ie)},U.prototype._viewport=function(L,j,Y,W){L===this._viewportCached.x&&j===this._viewportCached.y&&Y===this._viewportCached.z&&W===this._viewportCached.w||(this._viewportCached.x=L,this._viewportCached.y=j,this._viewportCached.z=Y,this._viewportCached.w=W,this._gl.viewport(L,j,Y,W))},U.prototype.setViewport=function(L,j,Y){var W=j||this.getRenderWidth(),ie=Y||this.getRenderHeight(),re=L.x||0,ye=L.y||0;this._cachedViewport=L,this._viewport(re*W,ye*ie,W*L.width,ie*L.height)},U.prototype.beginFrame=function(){},U.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},U.prototype.resize=function(){var L,j;P.a.IsWindowObjectExist()?(L=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,j=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(L=this._renderingCanvas?this._renderingCanvas.width:100,j=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(L/this._hardwareScalingLevel,j/this._hardwareScalingLevel)},U.prototype.setSize=function(L,j){return!!this._renderingCanvas&&(L|=0,j|=0,(this._renderingCanvas.width!==L||this._renderingCanvas.height!==j)&&(this._renderingCanvas.width=L,this._renderingCanvas.height=j,!0))},U.prototype.bindFramebuffer=function(L,j,Y,W,ie,re,ye){j===void 0&&(j=0),re===void 0&&(re=0),ye===void 0&&(ye=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=L,this._bindUnboundFramebuffer(L._MSAAFramebuffer?L._MSAAFramebuffer:L._framebuffer);var ve=this._gl;L.is2DArray?ve.framebufferTextureLayer(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,L._webGLTexture,re,ye):L.isCube&&ve.framebufferTexture2D(ve.FRAMEBUFFER,ve.COLOR_ATTACHMENT0,ve.TEXTURE_CUBE_MAP_POSITIVE_X+j,L._webGLTexture,re);var ue=L._depthStencilTexture;if(ue){var oe=ue._generateStencilBuffer?ve.DEPTH_STENCIL_ATTACHMENT:ve.DEPTH_ATTACHMENT;L.is2DArray?ve.framebufferTextureLayer(ve.FRAMEBUFFER,oe,ue._webGLTexture,re,ye):L.isCube?ve.framebufferTexture2D(ve.FRAMEBUFFER,oe,ve.TEXTURE_CUBE_MAP_POSITIVE_X+j,ue._webGLTexture,re):ve.framebufferTexture2D(ve.FRAMEBUFFER,oe,ve.TEXTURE_2D,ue._webGLTexture,re)}this._cachedViewport&&!ie?this.setViewport(this._cachedViewport,Y,W):(Y||(Y=L.width,re&&(Y/=Math.pow(2,re))),W||(W=L.height,re&&(W/=Math.pow(2,re))),this._viewport(0,0,Y,W)),this.wipeCaches()},U.prototype._bindUnboundFramebuffer=function(L){this._currentFramebuffer!==L&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,L),this._currentFramebuffer=L)},U.prototype.unBindFramebuffer=function(L,j,Y){j===void 0&&(j=!1),this._currentRenderTarget=null;var W=this._gl;if(L._MSAAFramebuffer){if(L._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(L._textureArray,j,Y);W.bindFramebuffer(W.READ_FRAMEBUFFER,L._MSAAFramebuffer),W.bindFramebuffer(W.DRAW_FRAMEBUFFER,L._framebuffer),W.blitFramebuffer(0,0,L.width,L.height,0,0,L.width,L.height,W.COLOR_BUFFER_BIT,W.NEAREST)}!L.generateMipMaps||j||L.isCube||(this._bindTextureDirectly(W.TEXTURE_2D,L,!0),W.generateMipmap(W.TEXTURE_2D),this._bindTextureDirectly(W.TEXTURE_2D,null)),Y&&(L._MSAAFramebuffer&&this._bindUnboundFramebuffer(L._framebuffer),Y()),this._bindUnboundFramebuffer(null)},U.prototype.flushFramebuffer=function(){this._gl.flush()},U.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},U.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},U.prototype.createVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.STATIC_DRAW)},U.prototype._createVertexBuffer=function(L,j){var Y=this._gl.createBuffer();if(!Y)throw new Error("Unable to create vertex buffer");var W=new _.a(Y);return this.bindArrayBuffer(W),L instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(L),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,L,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),W.references=1,W},U.prototype.createDynamicVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.DYNAMIC_DRAW)},U.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},U.prototype.createIndexBuffer=function(L,j){var Y=this._gl.createBuffer(),W=new _.a(Y);if(!Y)throw new Error("Unable to create index buffer");this.bindIndexBuffer(W);var ie=this._normalizeIndexData(L);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,ie,j?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),W.references=1,W.is32Bits=ie.BYTES_PER_ELEMENT===4,W},U.prototype._normalizeIndexData=function(L){if(L instanceof Uint16Array)return L;if(this._caps.uintIndices){if(L instanceof Uint32Array)return L;for(var j=0;j<L.length;j++)if(L[j]>=65535)return new Uint32Array(L);return new Uint16Array(L)}return new Uint16Array(L)},U.prototype.bindArrayBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ARRAY_BUFFER)},U.prototype.bindUniformBlock=function(L,j,Y){var W=L.program,ie=this._gl.getUniformBlockIndex(W,j);this._gl.uniformBlockBinding(W,ie,Y)},U.prototype.bindIndexBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ELEMENT_ARRAY_BUFFER)},U.prototype.bindBuffer=function(L,j){(this._vaoRecordInProgress||this._currentBoundBuffer[j]!==L)&&(this._gl.bindBuffer(j,L?L.underlyingResource:null),this._currentBoundBuffer[j]=L)},U.prototype.updateArrayBuffer=function(L){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,L)},U.prototype._vertexAttribPointer=function(L,j,Y,W,ie,re,ye){var ve=this._currentBufferPointers[j];if(ve){var ue=!1;ve.active?(ve.buffer!==L&&(ve.buffer=L,ue=!0),ve.size!==Y&&(ve.size=Y,ue=!0),ve.type!==W&&(ve.type=W,ue=!0),ve.normalized!==ie&&(ve.normalized=ie,ue=!0),ve.stride!==re&&(ve.stride=re,ue=!0),ve.offset!==ye&&(ve.offset=ye,ue=!0)):(ue=!0,ve.active=!0,ve.index=j,ve.size=Y,ve.type=W,ve.normalized=ie,ve.stride=re,ve.offset=ye,ve.buffer=L),(ue||this._vaoRecordInProgress)&&(this.bindArrayBuffer(L),this._gl.vertexAttribPointer(j,Y,W,ie,re,ye))}},U.prototype._bindIndexBufferWithCache=function(L){L!=null&&this._cachedIndexBuffer!==L&&(this._cachedIndexBuffer=L,this.bindIndexBuffer(L),this._uintIndicesCurrentlySet=L.is32Bits)},U.prototype._bindVertexBuffersAttributes=function(L,j){var Y=j.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var W=0;W<Y.length;W++){var ie=j.getAttributeLocation(W);if(ie>=0){var re=L[Y[W]];if(!re)continue;this._gl.enableVertexAttribArray(ie),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[ie]=!0);var ye=re.getBuffer();ye&&(this._vertexAttribPointer(ye,ie,re.getSize(),re.type,re.normalized,re.byteStride,re.byteOffset),re.getIsInstanced()&&(this._gl.vertexAttribDivisor(ie,re.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(ie),this._currentInstanceBuffers.push(ye))))}}},U.prototype.recordVertexArrayObject=function(L,j,Y){var W=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(W),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(L,Y),this.bindIndexBuffer(j),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),W},U.prototype.bindVertexArrayObject=function(L,j){this._cachedVertexArrayObject!==L&&(this._cachedVertexArrayObject=L,this._gl.bindVertexArray(L),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=j!=null&&j.is32Bits,this._mustWipeVertexAttributes=!0)},U.prototype.bindBuffersDirectly=function(L,j,Y,W,ie){if(this._cachedVertexBuffers!==L||this._cachedEffectForVertexBuffers!==ie){this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=ie;var re=ie.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var ye=0,ve=0;ve<re;ve++)if(ve<Y.length){var ue=ie.getAttributeLocation(ve);ue>=0&&(this._gl.enableVertexAttribArray(ue),this._vertexAttribArraysEnabled[ue]=!0,this._vertexAttribPointer(L,ue,Y[ve],this._gl.FLOAT,!1,W,ye)),ye+=4*Y[ve]}}this._bindIndexBufferWithCache(j)},U.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},U.prototype.bindBuffers=function(L,j,Y){this._cachedVertexBuffers===L&&this._cachedEffectForVertexBuffers===Y||(this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=Y,this._bindVertexBuffersAttributes(L,Y)),this._bindIndexBufferWithCache(j)},U.prototype.unbindInstanceAttributes=function(){for(var L,j=0,Y=this._currentInstanceLocations.length;j<Y;j++){var W=this._currentInstanceBuffers[j];L!=W&&W.references&&(L=W,this.bindArrayBuffer(W));var ie=this._currentInstanceLocations[j];this._gl.vertexAttribDivisor(ie,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},U.prototype.releaseVertexArrayObject=function(L){this._gl.deleteVertexArray(L)},U.prototype._releaseBuffer=function(L){return L.references--,L.references===0&&(this._deleteBuffer(L),!0)},U.prototype._deleteBuffer=function(L){this._gl.deleteBuffer(L.underlyingResource)},U.prototype.updateAndBindInstancesBuffer=function(L,j,Y){if(this.bindArrayBuffer(L),j&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,j),Y[0].index!==void 0)this.bindInstancesBuffer(L,Y,!0);else for(var W=0;W<4;W++){var ie=Y[W];this._vertexAttribArraysEnabled[ie]||(this._gl.enableVertexAttribArray(ie),this._vertexAttribArraysEnabled[ie]=!0),this._vertexAttribPointer(L,ie,4,this._gl.FLOAT,!1,64,16*W),this._gl.vertexAttribDivisor(ie,1),this._currentInstanceLocations.push(ie),this._currentInstanceBuffers.push(L)}},U.prototype.bindInstancesBuffer=function(L,j,Y){Y===void 0&&(Y=!0),this.bindArrayBuffer(L);var W=0;if(Y)for(var ie=0;ie<j.length;ie++)W+=4*(re=j[ie]).attributeSize;for(ie=0;ie<j.length;ie++){var re;(re=j[ie]).index===void 0&&(re.index=this._currentEffect.getAttributeLocationByName(re.attributeName)),re.index<0||(this._vertexAttribArraysEnabled[re.index]||(this._gl.enableVertexAttribArray(re.index),this._vertexAttribArraysEnabled[re.index]=!0),this._vertexAttribPointer(L,re.index,re.attributeSize,re.attributeType||this._gl.FLOAT,re.normalized||!1,W,re.offset),this._gl.vertexAttribDivisor(re.index,re.divisor===void 0?1:re.divisor),this._currentInstanceLocations.push(re.index),this._currentInstanceBuffers.push(L))}},U.prototype.disableInstanceAttributeByName=function(L){if(this._currentEffect){var j=this._currentEffect.getAttributeLocationByName(L);this.disableInstanceAttribute(j)}},U.prototype.disableInstanceAttribute=function(L){for(var j,Y=!1;(j=this._currentInstanceLocations.indexOf(L))!==-1;)this._currentInstanceLocations.splice(j,1),this._currentInstanceBuffers.splice(j,1),Y=!0,j=this._currentInstanceLocations.indexOf(L);Y&&(this._gl.vertexAttribDivisor(L,0),this.disableAttributeByIndex(L))},U.prototype.disableAttributeByIndex=function(L){this._gl.disableVertexAttribArray(L),this._vertexAttribArraysEnabled[L]=!1,this._currentBufferPointers[L].active=!1},U.prototype.draw=function(L,j,Y,W){this.drawElementsType(L?b.a.MATERIAL_TriangleFillMode:b.a.MATERIAL_WireFrameFillMode,j,Y,W)},U.prototype.drawPointClouds=function(L,j,Y){this.drawArraysType(b.a.MATERIAL_PointFillMode,L,j,Y)},U.prototype.drawUnIndexed=function(L,j,Y,W){this.drawArraysType(L?b.a.MATERIAL_TriangleFillMode:b.a.MATERIAL_WireFrameFillMode,j,Y,W)},U.prototype.drawElementsType=function(L,j,Y,W){this.applyStates(),this._reportDrawCall();var ie=this._drawMode(L),re=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,ye=this._uintIndicesCurrentlySet?4:2;W?this._gl.drawElementsInstanced(ie,Y,re,j*ye,W):this._gl.drawElements(ie,Y,re,j*ye)},U.prototype.drawArraysType=function(L,j,Y,W){this.applyStates(),this._reportDrawCall();var ie=this._drawMode(L);W?this._gl.drawArraysInstanced(ie,j,Y,W):this._gl.drawArrays(ie,j,Y)},U.prototype._drawMode=function(L){switch(L){case b.a.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case b.a.MATERIAL_PointFillMode:return this._gl.POINTS;case b.a.MATERIAL_WireFrameFillMode:return this._gl.LINES;case b.a.MATERIAL_PointListDrawMode:return this._gl.POINTS;case b.a.MATERIAL_LineListDrawMode:return this._gl.LINES;case b.a.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case b.a.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case b.a.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case b.a.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},U.prototype._reportDrawCall=function(){},U.prototype._releaseEffect=function(L){this._compiledEffects[L._key]&&(delete this._compiledEffects[L._key],this._deletePipelineContext(L.getPipelineContext()))},U.prototype._deletePipelineContext=function(L){var j=L;j&&j.program&&(j.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(j.program))},U.prototype.createEffect=function(L,j,Y,W,ie,re,ye,ve,ue){var oe=(L.vertexElement||L.vertex||L.vertexToken||L.vertexSource||L)+"+"+(L.fragmentElement||L.fragment||L.fragmentToken||L.fragmentSource||L)+"@"+(ie||j.defines);if(this._compiledEffects[oe]){var Z=this._compiledEffects[oe];return ye&&Z.isReady()&&ye(Z),Z}var J=new m.a(L,j,Y,W,this,ie,re,ye,ve,ue);return J._key=oe,this._compiledEffects[oe]=J,J},U._ConcatenateShader=function(L,j,Y){return Y===void 0&&(Y=""),Y+(j?j+`
`:"")+L},U.prototype._compileShader=function(L,j,Y,W){return this._compileRawShader(U._ConcatenateShader(L,Y,W),j)},U.prototype._compileRawShader=function(L,j){var Y=this._gl,W=Y.createShader(j==="vertex"?Y.VERTEX_SHADER:Y.FRAGMENT_SHADER);if(!W)throw new Error("Something went wrong while compile the shader.");return Y.shaderSource(W,L),Y.compileShader(W),W},U.prototype._getShaderSource=function(L){return this._gl.getShaderSource(L)},U.prototype.createRawShaderProgram=function(L,j,Y,W,ie){ie===void 0&&(ie=null),W=W||this._gl;var re=this._compileRawShader(j,"vertex"),ye=this._compileRawShader(Y,"fragment");return this._createShaderProgram(L,re,ye,W,ie)},U.prototype.createShaderProgram=function(L,j,Y,W,ie,re){re===void 0&&(re=null),ie=ie||this._gl;var ye=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",ve=this._compileShader(j,"vertex",W,ye),ue=this._compileShader(Y,"fragment",W,ye);return this._createShaderProgram(L,ve,ue,ie,re)},U.prototype.createPipelineContext=function(){var L=new g.a;return L.engine=this,this._caps.parallelShaderCompile&&(L.isParallelCompiled=!0),L},U.prototype._createShaderProgram=function(L,j,Y,W,ie){var re=W.createProgram();if(L.program=re,!re)throw new Error("Unable to create program");return W.attachShader(re,j),W.attachShader(re,Y),W.linkProgram(re),L.context=W,L.vertexShader=j,L.fragmentShader=Y,L.isParallelCompiled||this._finalizePipelineContext(L),re},U.prototype._finalizePipelineContext=function(L){var j=L.context,Y=L.vertexShader,W=L.fragmentShader,ie=L.program;if(!j.getProgramParameter(ie,j.LINK_STATUS)){var re,ye;if(!this._gl.getShaderParameter(Y,this._gl.COMPILE_STATUS)&&(re=this._gl.getShaderInfoLog(Y)))throw L.vertexCompilationError=re,new Error("VERTEX SHADER "+re);if(!this._gl.getShaderParameter(W,this._gl.COMPILE_STATUS)&&(re=this._gl.getShaderInfoLog(W)))throw L.fragmentCompilationError=re,new Error("FRAGMENT SHADER "+re);if(ye=j.getProgramInfoLog(ie))throw L.programLinkError=ye,new Error(ye)}if(this.validateShaderPrograms&&(j.validateProgram(ie),!j.getProgramParameter(ie,j.VALIDATE_STATUS)&&(ye=j.getProgramInfoLog(ie))))throw L.programValidationError=ye,new Error(ye);j.deleteShader(Y),j.deleteShader(W),L.vertexShader=void 0,L.fragmentShader=void 0,L.onCompiled&&(L.onCompiled(),L.onCompiled=void 0)},U.prototype._preparePipelineContext=function(L,j,Y,W,ie,re,ye){var ve=L;ve.program=W?this.createRawShaderProgram(ve,j,Y,void 0,ye):this.createShaderProgram(ve,j,Y,re,void 0,ye),ve.program.__SPECTOR_rebuildProgram=ie},U.prototype._isRenderingStateCompiled=function(L){var j=L;return!!this._gl.getProgramParameter(j.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(j),!0)},U.prototype._executeWhenRenderingStateIsCompiled=function(L,j){var Y=L;if(Y.isParallelCompiled){var W=Y.onCompiled;Y.onCompiled=W?function(){W(),j()}:j}else j()},U.prototype.getUniforms=function(L,j){for(var Y=new Array,W=L,ie=0;ie<j.length;ie++)Y.push(this._gl.getUniformLocation(W.program,j[ie]));return Y},U.prototype.getAttributes=function(L,j){for(var Y=[],W=L,ie=0;ie<j.length;ie++)try{Y.push(this._gl.getAttribLocation(W.program,j[ie]))}catch(re){Y.push(-1)}return Y},U.prototype.enableEffect=function(L){L&&L!==this._currentEffect&&(this.bindSamplers(L),this._currentEffect=L,L.onBind&&L.onBind(L),L._onBindObservable&&L._onBindObservable.notifyObservers(L))},U.prototype.setInt=function(L,j){return!!L&&(this._gl.uniform1i(L,j),!0)},U.prototype.setIntArray=function(L,j){return!!L&&(this._gl.uniform1iv(L,j),!0)},U.prototype.setIntArray2=function(L,j){return!(!L||j.length%2!=0)&&(this._gl.uniform2iv(L,j),!0)},U.prototype.setIntArray3=function(L,j){return!(!L||j.length%3!=0)&&(this._gl.uniform3iv(L,j),!0)},U.prototype.setIntArray4=function(L,j){return!(!L||j.length%4!=0)&&(this._gl.uniform4iv(L,j),!0)},U.prototype.setArray=function(L,j){return!!L&&(this._gl.uniform1fv(L,j),!0)},U.prototype.setArray2=function(L,j){return!(!L||j.length%2!=0)&&(this._gl.uniform2fv(L,j),!0)},U.prototype.setArray3=function(L,j){return!(!L||j.length%3!=0)&&(this._gl.uniform3fv(L,j),!0)},U.prototype.setArray4=function(L,j){return!(!L||j.length%4!=0)&&(this._gl.uniform4fv(L,j),!0)},U.prototype.setMatrices=function(L,j){return!!L&&(this._gl.uniformMatrix4fv(L,!1,j),!0)},U.prototype.setMatrix3x3=function(L,j){return!!L&&(this._gl.uniformMatrix3fv(L,!1,j),!0)},U.prototype.setMatrix2x2=function(L,j){return!!L&&(this._gl.uniformMatrix2fv(L,!1,j),!0)},U.prototype.setFloat=function(L,j){return!!L&&(this._gl.uniform1f(L,j),!0)},U.prototype.setFloat2=function(L,j,Y){return!!L&&(this._gl.uniform2f(L,j,Y),!0)},U.prototype.setFloat3=function(L,j,Y,W){return!!L&&(this._gl.uniform3f(L,j,Y,W),!0)},U.prototype.setFloat4=function(L,j,Y,W,ie){return!!L&&(this._gl.uniform4f(L,j,Y,W,ie),!0)},U.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var L=this._colorWrite;this._gl.colorMask(L,L,L,L)}},U.prototype.setColorWrite=function(L){L!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=L)},U.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(U.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),U.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},U.prototype.wipeCaches=function(L){this.preventCacheWipeBetweenFrames&&!L||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),L&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=b.a.ALPHA_ADD,this._alphaEquation=b.a.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},U.prototype._getSamplingParameters=function(L,j){var Y=this._gl,W=Y.NEAREST,ie=Y.NEAREST;switch(L){case b.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:W=Y.LINEAR,ie=j?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case b.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:W=Y.LINEAR,ie=j?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:W=Y.NEAREST,ie=j?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case b.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:W=Y.NEAREST,ie=j?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case b.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:W=Y.NEAREST,ie=j?Y.LINEAR_MIPMAP_NEAREST:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:W=Y.NEAREST,ie=j?Y.LINEAR_MIPMAP_LINEAR:Y.LINEAR;break;case b.a.TEXTURE_NEAREST_LINEAR:W=Y.NEAREST,ie=Y.LINEAR;break;case b.a.TEXTURE_NEAREST_NEAREST:W=Y.NEAREST,ie=Y.NEAREST;break;case b.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:W=Y.LINEAR,ie=j?Y.NEAREST_MIPMAP_NEAREST:Y.NEAREST;break;case b.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:W=Y.LINEAR,ie=j?Y.NEAREST_MIPMAP_LINEAR:Y.NEAREST;break;case b.a.TEXTURE_LINEAR_LINEAR:W=Y.LINEAR,ie=Y.LINEAR;break;case b.a.TEXTURE_LINEAR_NEAREST:W=Y.LINEAR,ie=Y.NEAREST}return{min:ie,mag:W}},U.prototype._createTexture=function(){var L=this._gl.createTexture();if(!L)throw new Error("Unable to create texture");return L},U.prototype.createTexture=function(L,j,Y,W,ie,re,ye,ve,ue,oe,Z,J,B){var G=this;ie===void 0&&(ie=b.a.TEXTURE_TRILINEAR_SAMPLINGMODE),re===void 0&&(re=null),ye===void 0&&(ye=null),ve===void 0&&(ve=null),ue===void 0&&(ue=null),oe===void 0&&(oe=null),Z===void 0&&(Z=null);var $=(L=L||"").substr(0,5)==="data:",he=L.substr(0,5)==="blob:",se=$&&L.indexOf(";base64,")!==-1,q=ue||new f.a(this,f.b.Url),H=L;!this._transformTextureUrl||se||ue||ve||(L=this._transformTextureUrl(L)),H!==L&&(q._originalUrl=H);var X=L.lastIndexOf("."),ee=Z||(X>-1?L.substring(X).toLowerCase():""),Q=null;ee.indexOf("?")>-1&&(ee=ee.split("?")[0]);for(var te=0,ge=U._TextureLoaders;te<ge.length;te++){var ce=ge[te];if(ce.canLoad(ee,J)){Q=ce;break}}W&&W._addPendingData(q),q.url=L,q.generateMipMaps=!j,q.samplingMode=ie,q.invertY=Y,this._doNotHandleContextLost||(q._buffer=ve);var de=null;re&&!ue&&(de=q.onLoadedObservable.add(re)),ue||this._internalTexturesCache.push(q);var ne=function(Te,Ne){W&&W._removePendingData(q),L===H?(de&&q.onLoadedObservable.remove(de),E.a.UseFallbackTexture&&G.createTexture(E.a.FallbackTexture,j,q.invertY,W,ie,null,ye,ve,q),ye&&ye((Te||"Unknown error")+(E.a.UseFallbackTexture?" - Fallback texture was used":""),Ne)):(x.a.Warn("Failed to load "+L+", falling back to "+H),G.createTexture(H,j,q.invertY,W,ie,re,ye,ve,q,oe,Z,J,B))};if(Q){var pe=function(Te){Q.loadData(Te,q,function(Ne,je,Xe,Ye,Ke,nt){nt?ne("TextureLoader failed to load data"):G._prepareWebGLTexture(q,W,Ne,je,q.invertY,!Xe,Ye,function(){return Ke(),!1},ie)},B)};ve?ve instanceof ArrayBuffer?pe(new Uint8Array(ve)):ArrayBuffer.isView(ve)?pe(ve):ye&&ye("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(L,function(Te){return pe(new Uint8Array(Te))},void 0,W?W.offlineProvider:void 0,!0,function(Te,Ne){ne("Unable to load "+(Te&&Te.responseURL,Ne))})}else{var Se=function(Te){he&&!G._doNotHandleContextLost&&(q._buffer=Te),G._prepareWebGLTexture(q,W,Te.width,Te.height,q.invertY,j,!1,function(Ne,je,Xe){var Ye=G._gl,Ke=Te.width===Ne&&Te.height===je,nt=oe?G._getInternalFormat(oe):ee===".jpg"?Ye.RGB:Ye.RGBA;if(Ke)return Ye.texImage2D(Ye.TEXTURE_2D,0,nt,nt,Ye.UNSIGNED_BYTE,Te),!1;var qe=G._caps.maxTextureSize;if(Te.width>qe||Te.height>qe||!G._supportsHardwareTextureRescaling)return G._prepareWorkingCanvas(),!(!G._workingCanvas||!G._workingContext)&&(G._workingCanvas.width=Ne,G._workingCanvas.height=je,G._workingContext.drawImage(Te,0,0,Te.width,Te.height,0,0,Ne,je),Ye.texImage2D(Ye.TEXTURE_2D,0,nt,nt,Ye.UNSIGNED_BYTE,G._workingCanvas),q.width=Ne,q.height=je,!1);var ct=new f.a(G,f.b.Temp);return G._bindTextureDirectly(Ye.TEXTURE_2D,ct,!0),Ye.texImage2D(Ye.TEXTURE_2D,0,nt,nt,Ye.UNSIGNED_BYTE,Te),G._rescaleTexture(ct,q,W,nt,function(){G._releaseTexture(ct),G._bindTextureDirectly(Ye.TEXTURE_2D,q,!0),Xe()}),!0},ie)};!$||se?ve&&(ve.decoding||ve.close)?Se(ve):U._FileToolsLoadImage(L,Se,ne,W?W.offlineProvider:null,J):typeof ve=="string"||ve instanceof ArrayBuffer||ArrayBuffer.isView(ve)||ve instanceof Blob?U._FileToolsLoadImage(ve,Se,ne,W?W.offlineProvider:null,J):ve&&Se(ve)}return q},U._FileToolsLoadImage=function(L,j,Y,W,ie){throw S.a.WarnImport("FileTools")},U.prototype._rescaleTexture=function(L,j,Y,W,ie){},U.prototype.createRawTexture=function(L,j,Y,W,ie,re,ye,ve,ue){throw ue===void 0&&(ue=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawCubeTexture=function(L,j,Y,W,ie,re,ye,ve){throw S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawTexture3D=function(L,j,Y,W,ie,re,ye,ve,ue,oe){throw oe===void 0&&(oe=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype.createRawTexture2DArray=function(L,j,Y,W,ie,re,ye,ve,ue,oe){throw oe===void 0&&(oe=b.a.TEXTURETYPE_UNSIGNED_INT),S.a.WarnImport("Engine.RawTexture")},U.prototype._unpackFlipY=function(L){this._unpackFlipYCached!==L&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,L?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=L))},U.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},U.prototype._getTextureTarget=function(L){return L.isCube?this._gl.TEXTURE_CUBE_MAP:L.is3D?this._gl.TEXTURE_3D:L.is2DArray||L.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},U.prototype.updateTextureSamplingMode=function(L,j,Y){Y===void 0&&(Y=!1);var W=this._getTextureTarget(j),ie=this._getSamplingParameters(L,j.generateMipMaps||Y);this._setTextureParameterInteger(W,this._gl.TEXTURE_MAG_FILTER,ie.mag,j),this._setTextureParameterInteger(W,this._gl.TEXTURE_MIN_FILTER,ie.min),Y&&(j.generateMipMaps=!0,this._gl.generateMipmap(W)),this._bindTextureDirectly(W,null),j.samplingMode=L},U.prototype.updateTextureWrappingMode=function(L,j,Y,W){Y===void 0&&(Y=null),W===void 0&&(W=null);var ie=this._getTextureTarget(L);j!==null&&(this._setTextureParameterInteger(ie,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(j),L),L._cachedWrapU=j),Y!==null&&(this._setTextureParameterInteger(ie,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Y),L),L._cachedWrapV=Y),(L.is2DArray||L.is3D)&&W!==null&&(this._setTextureParameterInteger(ie,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(W),L),L._cachedWrapR=W),this._bindTextureDirectly(ie,null)},U.prototype._setupDepthStencilTexture=function(L,j,Y,W,ie){var re=j.width||j,ye=j.height||j,ve=j.layers||0;L.baseWidth=re,L.baseHeight=ye,L.width=re,L.height=ye,L.is2DArray=ve>0,L.depth=ve,L.isReady=!0,L.samples=1,L.generateMipMaps=!1,L._generateDepthBuffer=!0,L._generateStencilBuffer=Y,L.samplingMode=W?b.a.TEXTURE_BILINEAR_SAMPLINGMODE:b.a.TEXTURE_NEAREST_SAMPLINGMODE,L.type=b.a.TEXTURETYPE_UNSIGNED_INT,L._comparisonFunction=ie;var ue=this._gl,oe=this._getTextureTarget(L),Z=this._getSamplingParameters(L.samplingMode,!1);ue.texParameteri(oe,ue.TEXTURE_MAG_FILTER,Z.mag),ue.texParameteri(oe,ue.TEXTURE_MIN_FILTER,Z.min),ue.texParameteri(oe,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(oe,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ie===0?(ue.texParameteri(oe,ue.TEXTURE_COMPARE_FUNC,b.a.LEQUAL),ue.texParameteri(oe,ue.TEXTURE_COMPARE_MODE,ue.NONE)):(ue.texParameteri(oe,ue.TEXTURE_COMPARE_FUNC,ie),ue.texParameteri(oe,ue.TEXTURE_COMPARE_MODE,ue.COMPARE_REF_TO_TEXTURE))},U.prototype._uploadCompressedDataToTextureDirectly=function(L,j,Y,W,ie,re,ye){re===void 0&&(re=0),ye===void 0&&(ye=0);var ve=this._gl,ue=ve.TEXTURE_2D;L.isCube&&(ue=ve.TEXTURE_CUBE_MAP_POSITIVE_X+re),this._gl.compressedTexImage2D(ue,ye,j,Y,W,0,ie)},U.prototype._uploadDataToTextureDirectly=function(L,j,Y,W,ie,re){Y===void 0&&(Y=0),W===void 0&&(W=0),re===void 0&&(re=!1);var ye=this._gl,ve=this._getWebGLTextureType(L.type),ue=this._getInternalFormat(L.format),oe=ie===void 0?this._getRGBABufferInternalSizedFormat(L.type,L.format):this._getInternalFormat(ie);this._unpackFlipY(L.invertY);var Z=ye.TEXTURE_2D;L.isCube&&(Z=ye.TEXTURE_CUBE_MAP_POSITIVE_X+Y);var J=Math.round(Math.log(L.width)*Math.LOG2E),B=Math.round(Math.log(L.height)*Math.LOG2E),G=re?L.width:Math.pow(2,Math.max(J-W,0)),$=re?L.height:Math.pow(2,Math.max(B-W,0));ye.texImage2D(Z,W,oe,G,$,0,ue,ve,j)},U.prototype.updateTextureData=function(L,j,Y,W,ie,re,ye,ve){ye===void 0&&(ye=0),ve===void 0&&(ve=0);var ue=this._gl,oe=this._getWebGLTextureType(L.type),Z=this._getInternalFormat(L.format);this._unpackFlipY(L.invertY);var J=ue.TEXTURE_2D;L.isCube&&(J=ue.TEXTURE_CUBE_MAP_POSITIVE_X+ye),ue.texSubImage2D(J,ve,Y,W,ie,re,Z,oe,j)},U.prototype._uploadArrayBufferViewToTexture=function(L,j,Y,W){Y===void 0&&(Y=0),W===void 0&&(W=0);var ie=this._gl,re=L.isCube?ie.TEXTURE_CUBE_MAP:ie.TEXTURE_2D;this._bindTextureDirectly(re,L,!0),this._uploadDataToTextureDirectly(L,j,Y,W),this._bindTextureDirectly(re,null,!0)},U.prototype._prepareWebGLTextureContinuation=function(L,j,Y,W,ie){var re=this._gl;if(re){var ye=this._getSamplingParameters(ie,!Y);re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,ye.mag),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,ye.min),Y||W||re.generateMipmap(re.TEXTURE_2D),this._bindTextureDirectly(re.TEXTURE_2D,null),j&&j._removePendingData(L),L.onLoadedObservable.notifyObservers(L),L.onLoadedObservable.clear()}},U.prototype._prepareWebGLTexture=function(L,j,Y,W,ie,re,ye,ve,ue){var oe=this;ue===void 0&&(ue=b.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var Z=this.getCaps().maxTextureSize,J=Math.min(Z,this.needPOTTextures?U.GetExponentOfTwo(Y,Z):Y),B=Math.min(Z,this.needPOTTextures?U.GetExponentOfTwo(W,Z):W),G=this._gl;G&&(L._webGLTexture?(this._bindTextureDirectly(G.TEXTURE_2D,L,!0),this._unpackFlipY(ie===void 0||!!ie),L.baseWidth=Y,L.baseHeight=W,L.width=J,L.height=B,L.isReady=!0,ve(J,B,function(){oe._prepareWebGLTextureContinuation(L,j,re,ye,ue)})||this._prepareWebGLTextureContinuation(L,j,re,ye,ue)):j&&j._removePendingData(L))},U.prototype._setupFramebufferDepthAttachments=function(L,j,Y,W,ie){ie===void 0&&(ie=1);var re=this._gl;if(L&&j)return this._getDepthStencilBuffer(Y,W,ie,re.DEPTH_STENCIL,re.DEPTH24_STENCIL8,re.DEPTH_STENCIL_ATTACHMENT);if(j){var ye=re.DEPTH_COMPONENT16;return this._webGLVersion>1&&(ye=re.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(Y,W,ie,ye,ye,re.DEPTH_ATTACHMENT)}return L?this._getDepthStencilBuffer(Y,W,ie,re.STENCIL_INDEX8,re.STENCIL_INDEX8,re.STENCIL_ATTACHMENT):null},U.prototype._releaseFramebufferObjects=function(L){var j=this._gl;L._framebuffer&&(j.deleteFramebuffer(L._framebuffer),L._framebuffer=null),L._depthStencilBuffer&&(j.deleteRenderbuffer(L._depthStencilBuffer),L._depthStencilBuffer=null),L._MSAAFramebuffer&&(j.deleteFramebuffer(L._MSAAFramebuffer),L._MSAAFramebuffer=null),L._MSAARenderBuffer&&(j.deleteRenderbuffer(L._MSAARenderBuffer),L._MSAARenderBuffer=null)},U.prototype._releaseTexture=function(L){this._releaseFramebufferObjects(L),this._deleteTexture(L._webGLTexture),this.unbindAllTextures();var j=this._internalTexturesCache.indexOf(L);j!==-1&&this._internalTexturesCache.splice(j,1),L._lodTextureHigh&&L._lodTextureHigh.dispose(),L._lodTextureMid&&L._lodTextureMid.dispose(),L._lodTextureLow&&L._lodTextureLow.dispose(),L._irradianceTexture&&L._irradianceTexture.dispose()},U.prototype._deleteTexture=function(L){this._gl.deleteTexture(L)},U.prototype._setProgram=function(L){this._currentProgram!==L&&(this._gl.useProgram(L),this._currentProgram=L)},U.prototype.bindSamplers=function(L){var j=L.getPipelineContext();this._setProgram(j.program);for(var Y=L.getSamplers(),W=0;W<Y.length;W++){var ie=L.getUniform(Y[W]);ie&&(this._boundUniforms[W]=ie)}this._currentEffect=null},U.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},U.prototype._bindTextureDirectly=function(L,j,Y,W){Y===void 0&&(Y=!1),W===void 0&&(W=!1);var ie=!1,re=j&&j._associatedChannel>-1;return Y&&re&&(this._activeChannel=j._associatedChannel),this._boundTexturesCache[this._activeChannel]!==j||W?(this._activateCurrentTexture(),j&&j.isMultiview?this._gl.bindTexture(L,j?j._colorTextureArray:null):this._gl.bindTexture(L,j?j._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=j,j&&(j._associatedChannel=this._activeChannel)):Y&&(ie=!0,this._activateCurrentTexture()),re&&!Y&&this._bindSamplerUniformToChannel(j._associatedChannel,this._activeChannel),ie},U.prototype._bindTexture=function(L,j){if(L!==void 0){j&&(j._associatedChannel=L),this._activeChannel=L;var Y=j?this._getTextureTarget(j):this._gl.TEXTURE_2D;this._bindTextureDirectly(Y,j)}},U.prototype.unbindAllTextures=function(){for(var L=0;L<this._maxSimultaneousTextures;L++)this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},U.prototype.setTexture=function(L,j,Y){L!==void 0&&(j&&(this._boundUniforms[L]=j),this._setTexture(L,Y))},U.prototype._bindSamplerUniformToChannel=function(L,j){var Y=this._boundUniforms[L];Y&&Y._currentState!==j&&(this._gl.uniform1i(Y,j),Y._currentState=j)},U.prototype._getTextureWrapMode=function(L){switch(L){case b.a.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case b.a.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case b.a.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},U.prototype._setTexture=function(L,j,Y,W){if(Y===void 0&&(Y=!1),W===void 0&&(W=!1),!j)return this._boundTexturesCache[L]!=null&&(this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(j.video)this._activeChannel=L,j.update();else if(j.delayLoadState===b.a.DELAYLOADSTATE_NOTLOADED)return j.delayLoad(),!1;var ie;ie=W?j.depthStencilTexture:j.isReady()?j.getInternalTexture():j.isCube?this.emptyCubeTexture:j.is3D?this.emptyTexture3D:j.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!Y&&ie&&(ie._associatedChannel=L);var re=!0;this._boundTexturesCache[L]===ie&&(Y||this._bindSamplerUniformToChannel(ie._associatedChannel,L),re=!1),this._activeChannel=L;var ye=this._getTextureTarget(ie);if(re&&this._bindTextureDirectly(ye,ie,Y),ie&&!ie.isMultiview){if(ie.isCube&&ie._cachedCoordinatesMode!==j.coordinatesMode){ie._cachedCoordinatesMode=j.coordinatesMode;var ve=j.coordinatesMode!==b.a.TEXTURE_CUBIC_MODE&&j.coordinatesMode!==b.a.TEXTURE_SKYBOX_MODE?b.a.TEXTURE_WRAP_ADDRESSMODE:b.a.TEXTURE_CLAMP_ADDRESSMODE;j.wrapU=ve,j.wrapV=ve}ie._cachedWrapU!==j.wrapU&&(ie._cachedWrapU=j.wrapU,this._setTextureParameterInteger(ye,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(j.wrapU),ie)),ie._cachedWrapV!==j.wrapV&&(ie._cachedWrapV=j.wrapV,this._setTextureParameterInteger(ye,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(j.wrapV),ie)),ie.is3D&&ie._cachedWrapR!==j.wrapR&&(ie._cachedWrapR=j.wrapR,this._setTextureParameterInteger(ye,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(j.wrapR),ie)),this._setAnisotropicLevel(ye,ie,j.anisotropicFilteringLevel)}return!0},U.prototype.setTextureArray=function(L,j,Y){if(L!==void 0&&j){this._textureUnits&&this._textureUnits.length===Y.length||(this._textureUnits=new Int32Array(Y.length));for(var W=0;W<Y.length;W++){var ie=Y[W].getInternalTexture();ie?(this._textureUnits[W]=L+W,ie._associatedChannel=L+W):this._textureUnits[W]=-1}this._gl.uniform1iv(j,this._textureUnits);for(var re=0;re<Y.length;re++)this._setTexture(this._textureUnits[re],Y[re],!0)}},U.prototype._setAnisotropicLevel=function(L,j,Y){var W=this._caps.textureAnisotropicFilterExtension;j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&j.samplingMode!==b.a.TEXTURE_LINEAR_LINEAR&&(Y=1),W&&j._cachedAnisotropicFilteringLevel!==Y&&(this._setTextureParameterFloat(L,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y,this._caps.maxAnisotropy),j),j._cachedAnisotropicFilteringLevel=Y)},U.prototype._setTextureParameterFloat=function(L,j,Y,W){this._bindTextureDirectly(L,W,!0,!0),this._gl.texParameterf(L,j,Y)},U.prototype._setTextureParameterInteger=function(L,j,Y,W){W&&this._bindTextureDirectly(L,W,!0,!0),this._gl.texParameteri(L,j,Y)},U.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var L=0;L<this._caps.maxVertexAttribs;L++)this.disableAttributeByIndex(L)}else{L=0;for(var j=this._vertexAttribArraysEnabled.length;L<j;L++)L>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[L]||this.disableAttributeByIndex(L)}},U.prototype.releaseEffects=function(){for(var L in this._compiledEffects){var j=this._compiledEffects[L].getPipelineContext();this._deletePipelineContext(j)}this._compiledEffects={}},U.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],P.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,m.a.ResetCache();for(var L=0,j=this._activeRequests;L<j.length;L++)j[L].abort()},U.prototype.attachContextLostEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",L,!1)},U.prototype.attachContextRestoredEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",L,!1)},U.prototype.getError=function(){return this._gl.getError()},U.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(b.a.TEXTURETYPE_FLOAT)},U.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(b.a.TEXTURETYPE_HALF_FLOAT)},U.prototype._canRenderToFramebuffer=function(L){for(var j=this._gl;j.getError()!==j.NO_ERROR;);var Y=!0,W=j.createTexture();j.bindTexture(j.TEXTURE_2D,W),j.texImage2D(j.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(L),1,1,0,j.RGBA,this._getWebGLTextureType(L),null),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.NEAREST),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.NEAREST);var ie=j.createFramebuffer();j.bindFramebuffer(j.FRAMEBUFFER,ie),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,W,0);var re=j.checkFramebufferStatus(j.FRAMEBUFFER);if((Y=(Y=Y&&re===j.FRAMEBUFFER_COMPLETE)&&j.getError()===j.NO_ERROR)&&(j.clear(j.COLOR_BUFFER_BIT),Y=Y&&j.getError()===j.NO_ERROR),Y){j.bindFramebuffer(j.FRAMEBUFFER,null);var ye=j.RGBA,ve=j.UNSIGNED_BYTE,ue=new Uint8Array(4);j.readPixels(0,0,1,1,ye,ve,ue),Y=Y&&j.getError()===j.NO_ERROR}for(j.deleteTexture(W),j.deleteFramebuffer(ie),j.bindFramebuffer(j.FRAMEBUFFER,null);!Y&&j.getError()!==j.NO_ERROR;);return Y},U.prototype._getWebGLTextureType=function(L){if(this._webGLVersion===1){switch(L){case b.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case b.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case b.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(L){case b.a.TEXTURETYPE_BYTE:return this._gl.BYTE;case b.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case b.a.TEXTURETYPE_SHORT:return this._gl.SHORT;case b.a.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case b.a.TEXTURETYPE_INT:return this._gl.INT;case b.a.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case b.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case b.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case b.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case b.a.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case b.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case b.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case b.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},U.prototype._getInternalFormat=function(L){var j=this._gl.RGBA;switch(L){case b.a.TEXTUREFORMAT_ALPHA:j=this._gl.ALPHA;break;case b.a.TEXTUREFORMAT_LUMINANCE:j=this._gl.LUMINANCE;break;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:j=this._gl.LUMINANCE_ALPHA;break;case b.a.TEXTUREFORMAT_RED:j=this._gl.RED;break;case b.a.TEXTUREFORMAT_RG:j=this._gl.RG;break;case b.a.TEXTUREFORMAT_RGB:j=this._gl.RGB;break;case b.a.TEXTUREFORMAT_RGBA:j=this._gl.RGBA}if(this._webGLVersion>1)switch(L){case b.a.TEXTUREFORMAT_RED_INTEGER:j=this._gl.RED_INTEGER;break;case b.a.TEXTUREFORMAT_RG_INTEGER:j=this._gl.RG_INTEGER;break;case b.a.TEXTUREFORMAT_RGB_INTEGER:j=this._gl.RGB_INTEGER;break;case b.a.TEXTUREFORMAT_RGBA_INTEGER:j=this._gl.RGBA_INTEGER}return j},U.prototype._getRGBABufferInternalSizedFormat=function(L,j){if(this._webGLVersion===1){if(j!==void 0)switch(j){case b.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case b.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB}return this._gl.RGBA}switch(L){case b.a.TEXTURETYPE_BYTE:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case b.a.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case b.a.TEXTURETYPE_UNSIGNED_BYTE:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R8;case b.a.TEXTUREFORMAT_RG:return this._gl.RG8;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB8;case b.a.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case b.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case b.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case b.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case b.a.TEXTURETYPE_SHORT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case b.a.TEXTURETYPE_UNSIGNED_SHORT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case b.a.TEXTURETYPE_INT:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case b.a.TEXTURETYPE_UNSIGNED_INTEGER:switch(j){case b.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case b.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case b.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case b.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case b.a.TEXTURETYPE_FLOAT:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R32F;case b.a.TEXTUREFORMAT_RG:return this._gl.RG32F;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case b.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case b.a.TEXTURETYPE_HALF_FLOAT:switch(j){case b.a.TEXTUREFORMAT_RED:return this._gl.R16F;case b.a.TEXTUREFORMAT_RG:return this._gl.RG16F;case b.a.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case b.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case b.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case b.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case b.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case b.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case b.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(j){case b.a.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case b.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},U.prototype._getRGBAMultiSampleBufferFormat=function(L){return L===b.a.TEXTURETYPE_FLOAT?this._gl.RGBA32F:L===b.a.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},U.prototype._loadFile=function(L,j,Y,W,ie,re){var ye=this,ve=U._FileToolsLoadFile(L,j,Y,W,ie,re);return this._activeRequests.push(ve),ve.onCompleteObservable.add(function(ue){ye._activeRequests.splice(ye._activeRequests.indexOf(ue),1)}),ve},U._FileToolsLoadFile=function(L,j,Y,W,ie,re){throw S.a.WarnImport("FileTools")},U.prototype.readPixels=function(L,j,Y,W,ie){ie===void 0&&(ie=!0);var re=ie?4:3,ye=ie?this._gl.RGBA:this._gl.RGB,ve=new Uint8Array(W*Y*re);return this._gl.readPixels(L,j,Y,W,ye,this._gl.UNSIGNED_BYTE,ve),ve},Object.defineProperty(U,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),U.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var L=M.a.CreateCanvas(1,1),j=L.getContext("webgl")||L.getContext("experimental-webgl");this._IsSupported=j!=null&&!!window.WebGLRenderingContext}catch(Y){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(U,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var L=M.a.CreateCanvas(1,1),j=L.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||L.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!j}catch(Y){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),U.CeilingPOT=function(L){return L--,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L|=L>>16,++L},U.FloorPOT=function(L){return L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,(L|=L>>16)-(L>>1)},U.NearestPOT=function(L){var j=U.CeilingPOT(L),Y=U.FloorPOT(L);return j-L>L-Y?Y:j},U.GetExponentOfTwo=function(L,j,Y){var W;switch(Y===void 0&&(Y=b.a.SCALEMODE_NEAREST),Y){case b.a.SCALEMODE_FLOOR:W=U.FloorPOT(L);break;case b.a.SCALEMODE_NEAREST:W=U.NearestPOT(L);break;case b.a.SCALEMODE_CEILING:default:W=U.CeilingPOT(L)}return Math.min(W,j)},U.QueueNewFrame=function(L,j){return P.a.IsWindowObjectExist()?(j||(j=window),j.requestPostAnimationFrame?j.requestPostAnimationFrame(L):j.requestAnimationFrame?j.requestAnimationFrame(L):j.msRequestAnimationFrame?j.msRequestAnimationFrame(L):j.webkitRequestAnimationFrame?j.webkitRequestAnimationFrame(L):j.mozRequestAnimationFrame?j.mozRequestAnimationFrame(L):j.oRequestAnimationFrame?j.oRequestAnimationFrame(L):window.setTimeout(L,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(L):setTimeout(L,16)},U.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},U.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],U._TextureLoaders=[],U.CollisionsEpsilon=.001,U._IsSupported=null,U._HasMajorPerformanceCaveat=null,U}()},function(p,s,c){c.d(s,"b",function(){return E}),c.d(s,"a",function(){return R});var E,m=c(6),S=c(102),h=c(2),C=c(21);(function(I){I[I.Unknown=0]="Unknown",I[I.Url=1]="Url",I[I.Temp=2]="Temp",I[I.Raw=3]="Raw",I[I.Dynamic=4]="Dynamic",I[I.RenderTarget=5]="RenderTarget",I[I.MultiRenderTarget=6]="MultiRenderTarget",I[I.Cube=7]="Cube",I[I.CubeRaw=8]="CubeRaw",I[I.CubePrefiltered=9]="CubePrefiltered",I[I.Raw3D=10]="Raw3D",I[I.Raw2DArray=11]="Raw2DArray",I[I.Depth=12]="Depth",I[I.CubeRawRGBD=13]="CubeRawRGBD"})(E||(E={}));var R=function(){function I(b,f,x){x===void 0&&(x=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new m.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=E.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=b,this._source=f,x||(this._webGLTexture=b._createTexture())}return I.prototype.getEngine=function(){return this._engine},Object.defineProperty(I.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),I.prototype.incrementReferences=function(){this._references++},I.prototype.updateSize=function(b,f,x){x===void 0&&(x=1),this.width=b,this.height=f,this.depth=x,this.baseWidth=b,this.baseHeight=f,this.baseDepth=x,this._size=b*f*x},I.prototype._rebuild=function(){var b,f,x=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case E.Temp:return;case E.Url:return void(f=this._engine.createTexture((b=this._originalUrl)!==null&&b!==void 0?b:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){f._swapAndDie(x),x.isReady=!0},null,this._buffer,void 0,this.format));case E.Raw:return(f=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Raw3D:return(f=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Raw2DArray:return(f=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.Dynamic:return(f=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case E.RenderTarget:var P=new S.a;if(P.generateDepthBuffer=this._generateDepthBuffer,P.generateMipMaps=this.generateMipMaps,P.generateStencilBuffer=this._generateStencilBuffer,P.samplingMode=this.samplingMode,P.type=this.type,this.isCube)f=this._engine.createRenderTargetCubeTexture(this.width,P);else{var A={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};f=this._engine.createRenderTargetTexture(A,P)}return f._swapAndDie(this),void(this.isReady=!0);case E.Depth:var T={bilinearFiltering:this.samplingMode!==h.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},_={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(f=this._engine.createDepthStencilTexture(_,T))._swapAndDie(this),void(this.isReady=!0);case E.Cube:return void(f=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){f._swapAndDie(x),x.isReady=!0},null,this.format,this._extension));case E.CubeRaw:return(f=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case E.CubeRawRGBD:return f=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void I._UpdateRGBDAsync(f,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){f._swapAndDie(x),x.isReady=!0});case E.CubePrefiltered:return void((f=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(g){g&&g._swapAndDie(x),x.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},I.prototype._swapAndDie=function(b){b._webGLTexture=this._webGLTexture,b._isRGBD=this._isRGBD,this._framebuffer&&(b._framebuffer=this._framebuffer),this._depthStencilBuffer&&(b._depthStencilBuffer=this._depthStencilBuffer),b._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(b._lodTextureHigh&&b._lodTextureHigh.dispose(),b._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(b._lodTextureMid&&b._lodTextureMid.dispose(),b._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(b._lodTextureLow&&b._lodTextureLow.dispose(),b._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(b._irradianceTexture&&b._irradianceTexture.dispose(),b._irradianceTexture=this._irradianceTexture);var f,x=this._engine.getLoadedTexturesCache();(f=x.indexOf(this))!==-1&&x.splice(f,1),(f=x.indexOf(b))===-1&&x.push(b)},I.prototype.dispose=function(){this._webGLTexture&&(this._references--,this._references===0&&(this._engine._releaseTexture(this),this._webGLTexture=null))},I._UpdateRGBDAsync=function(b,f,x,P,A){throw C.a.WarnImport("environmentTextureTools")},I}()},function(p,s,c){c.d(s,"b",function(){return E}),c.d(s,"c",function(){return m}),c.d(s,"a",function(){return S});var E=1/2.2,m=2.2,S=.001},function(p,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(0),S=c(3),h=c(6),C=c(22),R=c(21),I=function(){function b(f,x){x===void 0&&(x=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=m.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new h.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=f,this.id=f,this._scene=x||C.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return b.AddNodeConstructor=function(f,x){this._NodeConstructors[f]=x},b.Construct=function(f,x,P,A){var T=this._NodeConstructors[f];return T?T(x,P,A):null},Object.defineProperty(b.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(f){this._doNotSerialize=f},enumerable:!1,configurable:!0}),b.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(b.prototype,"parent",{get:function(){return this._parentNode},set:function(f){if(this._parentNode!==f){var x=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var P=this._parentNode._children.indexOf(this);P!==-1&&this._parentNode._children.splice(P,1),f||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=f,this._parentNode&&(this._parentNode._children!==void 0&&this._parentNode._children!==null||(this._parentNode._children=new Array),this._parentNode._children.push(this),x||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),b.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},b.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var f=this._scene.rootNodes,x=f.length-1;f[this._sceneRootNodesIndex]=f[x],f[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(b.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(f){this._animationPropertiesOverride=f},enumerable:!1,configurable:!0}),b.prototype.getClassName=function(){return"Node"},Object.defineProperty(b.prototype,"onDispose",{set:function(f){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(f)},enumerable:!1,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getEngine=function(){return this._scene.getEngine()},b.prototype.addBehavior=function(f,x){var P=this;return x===void 0&&(x=!1),this._behaviors.indexOf(f)!==-1||(f.init(),this._scene.isLoading&&!x?this._scene.onDataLoadedObservable.addOnce(function(){f.attach(P)}):f.attach(this),this._behaviors.push(f)),this},b.prototype.removeBehavior=function(f){var x=this._behaviors.indexOf(f);return x===-1||(this._behaviors[x].detach(),this._behaviors.splice(x,1)),this},Object.defineProperty(b.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),b.prototype.getBehaviorByName=function(f){for(var x=0,P=this._behaviors;x<P.length;x++){var A=P[x];if(A.name===f)return A}return null},b.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},b.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(b.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),b.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},b.prototype.updateCache=function(f){!f&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},b.prototype._getActionManagerForTrigger=function(f,x){return this.parent?this.parent._getActionManagerForTrigger(f,!1):null},b.prototype._updateCache=function(f){},b.prototype._isSynchronized=function(){return!0},b.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},b.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},b.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},b.prototype.isReady=function(f){return this._isReady},b.prototype.isEnabled=function(f){return f===void 0&&(f=!0),f===!1?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},b.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(f){f._syncParentEnabledState()})},b.prototype.setEnabled=function(f){this._isEnabled=f,this._syncParentEnabledState()},b.prototype.isDescendantOf=function(f){return!!this.parent&&(this.parent===f||this.parent.isDescendantOf(f))},b.prototype._getDescendants=function(f,x,P){if(x===void 0&&(x=!1),this._children)for(var A=0;A<this._children.length;A++){var T=this._children[A];P&&!P(T)||f.push(T),x||T._getDescendants(f,!1,P)}},b.prototype.getDescendants=function(f,x){var P=new Array;return this._getDescendants(P,f,x),P},b.prototype.getChildMeshes=function(f,x){var P=[];return this._getDescendants(P,f,function(A){return(!x||x(A))&&A.cullingStrategy!==void 0}),P},b.prototype.getChildren=function(f,x){return x===void 0&&(x=!0),this.getDescendants(x,f)},b.prototype._setReady=function(f){f!==this._isReady&&(f?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},b.prototype.getAnimationByName=function(f){for(var x=0;x<this.animations.length;x++){var P=this.animations[x];if(P.name===f)return P}return null},b.prototype.createAnimationRange=function(f,x,P){if(!this._ranges[f]){this._ranges[f]=b._AnimationRangeFactory(f,x,P);for(var A=0,T=this.animations.length;A<T;A++)this.animations[A]&&this.animations[A].createRange(f,x,P)}},b.prototype.deleteAnimationRange=function(f,x){x===void 0&&(x=!0);for(var P=0,A=this.animations.length;P<A;P++)this.animations[P]&&this.animations[P].deleteRange(f,x);this._ranges[f]=null},b.prototype.getAnimationRange=function(f){return this._ranges[f]||null},b.prototype.getAnimationRanges=function(){var f,x=[];for(f in this._ranges)x.push(this._ranges[f]);return x},b.prototype.beginAnimation=function(f,x,P,A){var T=this.getAnimationRange(f);return T?this._scene.beginAnimation(this,T.from,T.to,x,P,A):null},b.prototype.serializeAnimationRanges=function(){var f=[];for(var x in this._ranges){var P=this._ranges[x];if(P){var A={};A.name=x,A.from=P.from,A.to=P.to,f.push(A)}}return f},b.prototype.computeWorldMatrix=function(f){return this._worldMatrix||(this._worldMatrix=m.a.Identity()),this._worldMatrix},b.prototype.dispose=function(f,x){if(x===void 0&&(x=!1),this._isDisposed=!0,!f)for(var P=0,A=this.getDescendants(!0);P<A.length;P++)A[P].dispose(f,x);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var T=0,_=this._behaviors;T<_.length;T++)_[T].detach();this._behaviors=[]},b.ParseAnimationRanges=function(f,x,P){if(x.ranges)for(var A=0;A<x.ranges.length;A++){var T=x.ranges[A];f.createAnimationRange(T.name,T.from,T.to)}},b.prototype.getHierarchyBoundingVectors=function(f,x){var P,A;if(f===void 0&&(f=!0),x===void 0&&(x=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var T=this.getBoundingInfo();P=T.boundingBox.minimumWorld.clone(),A=T.boundingBox.maximumWorld.clone()}else P=new m.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new m.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(f)for(var _=0,g=this.getDescendants(!1);_<g.length;_++){var M=g[_];if(M.computeWorldMatrix(!0),(!x||x(M))&&M.getBoundingInfo&&M.getTotalVertices()!==0){var O=M.getBoundingInfo().boundingBox,N=O.minimumWorld,V=O.maximumWorld;m.e.CheckExtends(N,P,A),m.e.CheckExtends(V,P,A)}}return{min:P,max:A}},b._AnimationRangeFactory=function(f,x,P){throw R.a.WarnImport("AnimationRange")},b._NodeConstructors={},Object(E.c)([Object(S.c)()],b.prototype,"name",void 0),Object(E.c)([Object(S.c)()],b.prototype,"id",void 0),Object(E.c)([Object(S.c)()],b.prototype,"uniqueId",void 0),Object(E.c)([Object(S.c)()],b.prototype,"state",void 0),Object(E.c)([Object(S.c)()],b.prototype,"metadata",void 0),b}()},function(p,s,c){c.d(s,"b",function(){return ye}),c.d(s,"a",function(){return ve});var E=c(1),m=c(3),S=c(33),h=c(20),C=c(0),R=c(9),I=c(4),b=c(105),f=c(42),x=c(25),P=c(76),A=c(87),T=c(15),_=c(10),g=c(11),M=c(19),O=c(5),N=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;O.a.IncludesShadersStore.defaultFragmentDeclaration=N;var V=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
vec4 vDetailInfos;
mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;O.a.IncludesShadersStore.defaultUboDeclaration=V,c(160),c(59),c(106),c(107),c(154),c(130),c(161),c(131),c(108),c(109),c(132),c(133),c(115),c(116),c(125),c(110),c(134),c(162),c(135),c(155),c(136);var U=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector);
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif

vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
gl_FragData[0]=color;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=specularMapColor;
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
}
`;O.a.ShadersStore.defaultPixelShader=U;var L=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;O.a.IncludesShadersStore.defaultVertexDeclaration=L,c(78),c(79),c(163),c(164),c(117),c(137),c(93),c(94),c(100),c(80),c(81),c(165),c(156),c(111),c(157),c(138),O.a.IncludesShadersStore.pointCloudVertex=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,c(158);var j=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;O.a.ShadersStore.defaultVertexShader=j;var Y=c(2),W=c(67),ie=c(92),re={effect:null,subMesh:null},ye=function(ue){function oe(){var Z=ue.call(this)||this;return Z.MAINUV1=!1,Z.MAINUV2=!1,Z.DIFFUSE=!1,Z.DIFFUSEDIRECTUV=0,Z.DETAIL=!1,Z.DETAILDIRECTUV=0,Z.DETAIL_NORMALBLENDMETHOD=0,Z.AMBIENT=!1,Z.AMBIENTDIRECTUV=0,Z.OPACITY=!1,Z.OPACITYDIRECTUV=0,Z.OPACITYRGB=!1,Z.REFLECTION=!1,Z.EMISSIVE=!1,Z.EMISSIVEDIRECTUV=0,Z.SPECULAR=!1,Z.SPECULARDIRECTUV=0,Z.BUMP=!1,Z.BUMPDIRECTUV=0,Z.PARALLAX=!1,Z.PARALLAXOCCLUSION=!1,Z.SPECULAROVERALPHA=!1,Z.CLIPPLANE=!1,Z.CLIPPLANE2=!1,Z.CLIPPLANE3=!1,Z.CLIPPLANE4=!1,Z.CLIPPLANE5=!1,Z.CLIPPLANE6=!1,Z.ALPHATEST=!1,Z.DEPTHPREPASS=!1,Z.ALPHAFROMDIFFUSE=!1,Z.POINTSIZE=!1,Z.FOG=!1,Z.SPECULARTERM=!1,Z.DIFFUSEFRESNEL=!1,Z.OPACITYFRESNEL=!1,Z.REFLECTIONFRESNEL=!1,Z.REFRACTIONFRESNEL=!1,Z.EMISSIVEFRESNEL=!1,Z.FRESNEL=!1,Z.NORMAL=!1,Z.UV1=!1,Z.UV2=!1,Z.VERTEXCOLOR=!1,Z.VERTEXALPHA=!1,Z.NUM_BONE_INFLUENCERS=0,Z.BonesPerMesh=0,Z.BONETEXTURE=!1,Z.BONES_VELOCITY_ENABLED=!1,Z.INSTANCES=!1,Z.THIN_INSTANCES=!1,Z.GLOSSINESS=!1,Z.ROUGHNESS=!1,Z.EMISSIVEASILLUMINATION=!1,Z.LINKEMISSIVEWITHDIFFUSE=!1,Z.REFLECTIONFRESNELFROMSPECULAR=!1,Z.LIGHTMAP=!1,Z.LIGHTMAPDIRECTUV=0,Z.OBJECTSPACE_NORMALMAP=!1,Z.USELIGHTMAPASSHADOWMAP=!1,Z.REFLECTIONMAP_3D=!1,Z.REFLECTIONMAP_SPHERICAL=!1,Z.REFLECTIONMAP_PLANAR=!1,Z.REFLECTIONMAP_CUBIC=!1,Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Z.REFLECTIONMAP_PROJECTION=!1,Z.REFLECTIONMAP_SKYBOX=!1,Z.REFLECTIONMAP_EXPLICIT=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR=!1,Z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Z.INVERTCUBICMAP=!1,Z.LOGARITHMICDEPTH=!1,Z.REFRACTION=!1,Z.REFRACTIONMAP_3D=!1,Z.REFLECTIONOVERALPHA=!1,Z.TWOSIDEDLIGHTING=!1,Z.SHADOWFLOAT=!1,Z.MORPHTARGETS=!1,Z.MORPHTARGETS_NORMAL=!1,Z.MORPHTARGETS_TANGENT=!1,Z.MORPHTARGETS_UV=!1,Z.NUM_MORPH_INFLUENCERS=0,Z.NONUNIFORMSCALING=!1,Z.PREMULTIPLYALPHA=!1,Z.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,Z.ALPHABLEND=!0,Z.PREPASS=!1,Z.PREPASS_IRRADIANCE=!1,Z.PREPASS_IRRADIANCE_INDEX=-1,Z.PREPASS_ALBEDO=!1,Z.PREPASS_ALBEDO_INDEX=-1,Z.PREPASS_DEPTHNORMAL=!1,Z.PREPASS_DEPTHNORMAL_INDEX=-1,Z.PREPASS_POSITION=!1,Z.PREPASS_POSITION_INDEX=-1,Z.PREPASS_VELOCITY=!1,Z.PREPASS_VELOCITY_INDEX=-1,Z.PREPASS_REFLECTIVITY=!1,Z.PREPASS_REFLECTIVITY_INDEX=-1,Z.SCENE_MRT_COUNT=0,Z.RGBDLIGHTMAP=!1,Z.RGBDREFLECTION=!1,Z.RGBDREFRACTION=!1,Z.IMAGEPROCESSING=!1,Z.VIGNETTE=!1,Z.VIGNETTEBLENDMODEMULTIPLY=!1,Z.VIGNETTEBLENDMODEOPAQUE=!1,Z.TONEMAPPING=!1,Z.TONEMAPPING_ACES=!1,Z.CONTRAST=!1,Z.COLORCURVES=!1,Z.COLORGRADING=!1,Z.COLORGRADING3D=!1,Z.SAMPLER3DGREENDEPTH=!1,Z.SAMPLER3DBGRMAP=!1,Z.IMAGEPROCESSINGPOSTPROCESS=!1,Z.MULTIVIEW=!1,Z.IS_REFLECTION_LINEAR=!1,Z.IS_REFRACTION_LINEAR=!1,Z.EXPOSURE=!1,Z.rebuild(),Z}return Object(E.d)(oe,ue),oe.prototype.setReflectionMode=function(Z){for(var J=0,B=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];J<B.length;J++){var G=B[J];this[G]=G===Z}},oe}(P.a),ve=function(ue){function oe(Z,J){var B=ue.call(this,Z,J)||this;return B._diffuseTexture=null,B._ambientTexture=null,B._opacityTexture=null,B._reflectionTexture=null,B._emissiveTexture=null,B._specularTexture=null,B._bumpTexture=null,B._lightmapTexture=null,B._refractionTexture=null,B.ambientColor=new R.a(0,0,0),B.diffuseColor=new R.a(1,1,1),B.specularColor=new R.a(1,1,1),B.emissiveColor=new R.a(0,0,0),B.specularPower=64,B._useAlphaFromDiffuseTexture=!1,B._useEmissiveAsIllumination=!1,B._linkEmissiveWithDiffuse=!1,B._useSpecularOverAlpha=!1,B._useReflectionOverAlpha=!1,B._disableLighting=!1,B._useObjectSpaceNormalMap=!1,B._useParallax=!1,B._useParallaxOcclusion=!1,B.parallaxScaleBias=.05,B._roughness=0,B.indexOfRefraction=.98,B.invertRefractionY=!0,B.alphaCutOff=.4,B._useLightmapAsShadowmap=!1,B._useReflectionFresnelFromSpecular=!1,B._useGlossinessFromSpecularMapAlpha=!1,B._maxSimultaneousLights=4,B._invertNormalMapX=!1,B._invertNormalMapY=!1,B._twoSidedLighting=!1,B.detailMap=new ie.a(B._markAllSubMeshesAsTexturesDirty.bind(B)),B._renderTargets=new S.a(16),B._worldViewProjectionMatrix=C.a.Zero(),B._globalAmbientColor=new R.a(0,0,0),B._rebuildInParallel=!1,B._attachImageProcessingConfiguration(null),B.prePassConfiguration=new b.a,B.getRenderTargetTextures=function(){return B._renderTargets.reset(),oe.ReflectionTextureEnabled&&B._reflectionTexture&&B._reflectionTexture.isRenderTarget&&B._renderTargets.push(B._reflectionTexture),oe.RefractionTextureEnabled&&B._refractionTexture&&B._refractionTexture.isRenderTarget&&B._renderTargets.push(B._refractionTexture),B._renderTargets},B}return Object(E.d)(oe,ue),Object.defineProperty(oe.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(Z){this._attachImageProcessingConfiguration(Z),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),oe.prototype._attachImageProcessingConfiguration=function(Z){var J=this;Z!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=Z||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){J._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(oe.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(Z){this.imageProcessingConfiguration.colorCurvesEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(Z){this.imageProcessingConfiguration.colorGradingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(Z){this._imageProcessingConfiguration.toneMappingEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(Z){this._imageProcessingConfiguration.exposure=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(Z){this._imageProcessingConfiguration.contrast=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(Z){this._imageProcessingConfiguration.colorGradingTexture=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(Z){this._imageProcessingConfiguration.colorCurves=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(oe.prototype,"hasRenderTargetTextures",{get:function(){return!!(oe.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(oe.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),oe.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(oe.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(Z){this._useLogarithmicDepth=Z&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),oe.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},oe.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===x.a.MATERIAL_ALPHATEST)},oe.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==x.a.MATERIAL_OPAQUE},oe.prototype._hasAlphaChannel=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null},oe.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},oe.prototype.isReadyForSubMesh=function(Z,J,B){if(B===void 0&&(B=!1),J.effect&&this.isFrozen&&J.effect._wasPreviouslyReady)return!0;J._materialDefines||(J._materialDefines=new ye);var G=this.getScene(),$=J._materialDefines;if(this._isReadyForSubMesh(J))return!0;var he=G.getEngine();if($._needNormals=T.a.PrepareDefinesForLights(G,Z,$,!0,this._maxSimultaneousLights,this._disableLighting),T.a.PrepareDefinesForMultiview(G,$),T.a.PrepareDefinesForPrePass(G,$,this.canRenderToMRT),$._areTexturesDirty){if($._needUVs=!1,$.MAINUV1=!1,$.MAINUV2=!1,G.texturesEnabled){if(this._diffuseTexture&&oe.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._diffuseTexture,$,"DIFFUSE")}else $.DIFFUSE=!1;if(this._ambientTexture&&oe.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._ambientTexture,$,"AMBIENT")}else $.AMBIENT=!1;if(this._opacityTexture&&oe.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._opacityTexture,$,"OPACITY"),$.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else $.OPACITY=!1;if(this._reflectionTexture&&oe.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch($._needNormals=!0,$.REFLECTION=!0,$.ROUGHNESS=this._roughness>0,$.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,$.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===_.a.INVCUBIC_MODE,$.REFLECTIONMAP_3D=this._reflectionTexture.isCube,$.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case _.a.EXPLICIT_MODE:$.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case _.a.PLANAR_MODE:$.setReflectionMode("REFLECTIONMAP_PLANAR");break;case _.a.PROJECTION_MODE:$.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case _.a.SKYBOX_MODE:$.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case _.a.SPHERICAL_MODE:$.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case _.a.EQUIRECTANGULAR_MODE:$.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case _.a.FIXED_EQUIRECTANGULAR_MODE:$.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case _.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:$.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case _.a.CUBIC_MODE:case _.a.INVCUBIC_MODE:default:$.setReflectionMode("REFLECTIONMAP_CUBIC")}$.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else $.REFLECTION=!1;if(this._emissiveTexture&&oe.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._emissiveTexture,$,"EMISSIVE")}else $.EMISSIVE=!1;if(this._lightmapTexture&&oe.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._lightmapTexture,$,"LIGHTMAP"),$.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,$.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else $.LIGHTMAP=!1;if(this._specularTexture&&oe.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;T.a.PrepareDefinesForMergedUV(this._specularTexture,$,"SPECULAR"),$.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else $.SPECULAR=!1;if(G.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&oe.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;T.a.PrepareDefinesForMergedUV(this._bumpTexture,$,"BUMP"),$.PARALLAX=this._useParallax,$.PARALLAXOCCLUSION=this._useParallaxOcclusion,$.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else $.BUMP=!1;if(this._refractionTexture&&oe.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;$._needUVs=!0,$.REFRACTION=!0,$.REFRACTIONMAP_3D=this._refractionTexture.isCube,$.RGBDREFRACTION=this._refractionTexture.isRGBD}else $.REFRACTION=!1;$.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else $.DIFFUSE=!1,$.AMBIENT=!1,$.OPACITY=!1,$.REFLECTION=!1,$.EMISSIVE=!1,$.LIGHTMAP=!1,$.BUMP=!1,$.REFRACTION=!1;$.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),$.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,$.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,$.SPECULAROVERALPHA=this._useSpecularOverAlpha,$.PREMULTIPLYALPHA=this.alphaMode===Y.a.ALPHA_PREMULTIPLIED||this.alphaMode===Y.a.ALPHA_PREMULTIPLIED_PORTERDUFF,$.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,$.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(Z)}if(!this.detailMap.isReadyForSubMesh($,G))return!1;if($._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines($),$.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,$.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if($._areFresnelDirty&&(oe.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&($.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,$.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,$.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,$.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,$.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,$.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,$._needNormals=!0,$.FRESNEL=!0):$.FRESNEL=!1),T.a.PrepareDefinesForMisc(Z,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(Z)||this._forceAlphaTest,$),T.a.PrepareDefinesForAttributes(Z,$,!0,!0,!0),T.a.PrepareDefinesForFrameBoundValues(G,he,$,B,null,J.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines($,G),$.isDirty){var se=$._areLightsDisposed;$.markAsProcessed();var q=new W.a;$.REFLECTION&&q.addFallback(0,"REFLECTION"),$.SPECULAR&&q.addFallback(0,"SPECULAR"),$.BUMP&&q.addFallback(0,"BUMP"),$.PARALLAX&&q.addFallback(1,"PARALLAX"),$.PARALLAXOCCLUSION&&q.addFallback(0,"PARALLAXOCCLUSION"),$.SPECULAROVERALPHA&&q.addFallback(0,"SPECULAROVERALPHA"),$.FOG&&q.addFallback(1,"FOG"),$.POINTSIZE&&q.addFallback(0,"POINTSIZE"),$.LOGARITHMICDEPTH&&q.addFallback(0,"LOGARITHMICDEPTH"),T.a.HandleFallbacksForShadows($,q,this._maxSimultaneousLights),$.SPECULARTERM&&q.addFallback(0,"SPECULARTERM"),$.DIFFUSEFRESNEL&&q.addFallback(1,"DIFFUSEFRESNEL"),$.OPACITYFRESNEL&&q.addFallback(2,"OPACITYFRESNEL"),$.REFLECTIONFRESNEL&&q.addFallback(3,"REFLECTIONFRESNEL"),$.EMISSIVEFRESNEL&&q.addFallback(4,"EMISSIVEFRESNEL"),$.FRESNEL&&q.addFallback(4,"FRESNEL"),$.MULTIVIEW&&q.addFallback(0,"MULTIVIEW");var H=[I.b.PositionKind];$.NORMAL&&H.push(I.b.NormalKind),$.UV1&&H.push(I.b.UVKind),$.UV2&&H.push(I.b.UV2Kind),$.VERTEXCOLOR&&H.push(I.b.ColorKind),T.a.PrepareAttributesForBones(H,Z,$,q),T.a.PrepareAttributesForInstances(H,$),T.a.PrepareAttributesForMorphTargets(H,Z,$);var X="default",ee=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],Q=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],te=["Material","Scene"];ie.a.AddUniforms(ee),ie.a.AddSamplers(Q),b.a.AddUniforms(ee),b.a.AddSamplers(ee),f.a&&(f.a.PrepareUniforms(ee,$),f.a.PrepareSamplers(Q,$)),T.a.PrepareUniformsAndSamplersList({uniformsNames:ee,uniformBuffersNames:te,samplers:Q,defines:$,maxSimultaneousLights:this._maxSimultaneousLights});var ge={};this.customShaderNameResolve&&(X=this.customShaderNameResolve(X,ee,te,Q,$,H,ge));var ce=$.toString(),de=J.effect,ne=G.getEngine().createEffect(X,{attributes:H,uniformsNames:ee,uniformBuffersNames:te,samplers:Q,defines:ce,fallbacks:q,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:$.NUM_MORPH_INFLUENCERS},processFinalCode:ge.processFinalCode,multiTarget:$.PREPASS},he);if(ne)if(this._onEffectCreatedObservable&&(re.effect=ne,re.subMesh=J,this._onEffectCreatedObservable.notifyObservers(re)),this.allowShaderHotSwapping&&de&&!ne.isReady()){if(ne=de,this._rebuildInParallel=!0,$.markAsUnprocessed(),se)return $._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,G.resetCachedMaterial(),J.setEffect(ne,$),this.buildUniformLayout()}return!(!J.effect||!J.effect.isReady())&&($._renderId=G.getRenderId(),J.effect._wasPreviouslyReady=!0,!0)},oe.prototype.buildUniformLayout=function(){var Z=this._uniformBuffer;Z.addUniform("diffuseLeftColor",4),Z.addUniform("diffuseRightColor",4),Z.addUniform("opacityParts",4),Z.addUniform("reflectionLeftColor",4),Z.addUniform("reflectionRightColor",4),Z.addUniform("refractionLeftColor",4),Z.addUniform("refractionRightColor",4),Z.addUniform("emissiveLeftColor",4),Z.addUniform("emissiveRightColor",4),Z.addUniform("vDiffuseInfos",2),Z.addUniform("vAmbientInfos",2),Z.addUniform("vOpacityInfos",2),Z.addUniform("vReflectionInfos",2),Z.addUniform("vReflectionPosition",3),Z.addUniform("vReflectionSize",3),Z.addUniform("vEmissiveInfos",2),Z.addUniform("vLightmapInfos",2),Z.addUniform("vSpecularInfos",2),Z.addUniform("vBumpInfos",3),Z.addUniform("diffuseMatrix",16),Z.addUniform("ambientMatrix",16),Z.addUniform("opacityMatrix",16),Z.addUniform("reflectionMatrix",16),Z.addUniform("emissiveMatrix",16),Z.addUniform("lightmapMatrix",16),Z.addUniform("specularMatrix",16),Z.addUniform("bumpMatrix",16),Z.addUniform("vTangentSpaceParams",2),Z.addUniform("pointSize",1),Z.addUniform("refractionMatrix",16),Z.addUniform("vRefractionInfos",4),Z.addUniform("vSpecularColor",4),Z.addUniform("vEmissiveColor",3),Z.addUniform("visibility",1),Z.addUniform("vDiffuseColor",4),ie.a.PrepareUniformBuffer(Z),Z.create()},oe.prototype.unbind=function(){if(this._activeEffect){var Z=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),Z=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),Z=!0),Z&&this._markAllSubMeshesAsTexturesDirty()}ue.prototype.unbind.call(this)},oe.prototype.bindForSubMesh=function(Z,J,B){var G=this.getScene(),$=B._materialDefines;if($){var he=B.effect;if(he){this._activeEffect=he,$.INSTANCES&&!$.THIN_INSTANCES||this.bindOnlyWorldMatrix(Z),this.prePassConfiguration.bindForSubMesh(this._activeEffect,G,J,Z,this.isFrozen),$.OBJECTSPACE_NORMALMAP&&(Z.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var se=this._mustRebind(G,he,J.visibility);T.a.BindBonesParameters(J,he);var q=this._uniformBuffer;if(se){if(q.bindToEffect(he,"Material"),this.bindViewProjection(he),!q.useUbo||!this.isFrozen||!q.isSync){if(oe.FresnelEnabled&&$.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(q.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),q.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&q.updateColor4("opacityParts",new R.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(q.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),q.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(q.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),q.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(q.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),q.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),G.texturesEnabled){if(this._diffuseTexture&&oe.DiffuseTextureEnabled&&(q.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),T.a.BindTextureMatrix(this._diffuseTexture,q,"diffuse")),this._ambientTexture&&oe.AmbientTextureEnabled&&(q.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),T.a.BindTextureMatrix(this._ambientTexture,q,"ambient")),this._opacityTexture&&oe.OpacityTextureEnabled&&(q.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),T.a.BindTextureMatrix(this._opacityTexture,q,"opacity")),this._hasAlphaChannel()&&he.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&oe.ReflectionTextureEnabled&&(q.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),q.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var H=this._reflectionTexture;q.updateVector3("vReflectionPosition",H.boundingBoxPosition),q.updateVector3("vReflectionSize",H.boundingBoxSize)}if(this._emissiveTexture&&oe.EmissiveTextureEnabled&&(q.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),T.a.BindTextureMatrix(this._emissiveTexture,q,"emissive")),this._lightmapTexture&&oe.LightmapTextureEnabled&&(q.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),T.a.BindTextureMatrix(this._lightmapTexture,q,"lightmap")),this._specularTexture&&oe.SpecularTextureEnabled&&(q.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),T.a.BindTextureMatrix(this._specularTexture,q,"specular")),this._bumpTexture&&G.getEngine().getCaps().standardDerivatives&&oe.BumpTextureEnabled&&(q.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),T.a.BindTextureMatrix(this._bumpTexture,q,"bump"),G._mirroredCameraPosition?q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&oe.RefractionTextureEnabled){var X=1;this._refractionTexture.isCube||(q.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(X=this._refractionTexture.depth)),q.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,X,this.invertRefractionY?-1:1)}}this.pointsCloud&&q.updateFloat("pointSize",this.pointSize),$.SPECULARTERM&&q.updateColor4("vSpecularColor",this.specularColor,this.specularPower),q.updateColor3("vEmissiveColor",oe.EmissiveTextureEnabled?this.emissiveColor:R.a.BlackReadOnly),q.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}q.updateFloat("visibility",J.visibility),G.texturesEnabled&&(this._diffuseTexture&&oe.DiffuseTextureEnabled&&he.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&oe.AmbientTextureEnabled&&he.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&oe.OpacityTextureEnabled&&he.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&oe.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?he.setTexture("reflectionCubeSampler",this._reflectionTexture):he.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&oe.EmissiveTextureEnabled&&he.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&oe.LightmapTextureEnabled&&he.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&oe.SpecularTextureEnabled&&he.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&G.getEngine().getCaps().standardDerivatives&&oe.BumpTextureEnabled&&he.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&oe.RefractionTextureEnabled)&&(X=1,this._refractionTexture.isCube?he.setTexture("refractionCubeSampler",this._refractionTexture):he.setTexture("refraction2DSampler",this._refractionTexture)),this.detailMap.bindForSubMesh(q,G,this.isFrozen),T.a.BindClipPlane(he,G),G.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),T.a.BindEyePosition(he,G),he.setColor3("vAmbientColor",this._globalAmbientColor)}!se&&this.isFrozen||(G.lightsEnabled&&!this._disableLighting&&T.a.BindLights(G,J,he,$,this._maxSimultaneousLights,this._rebuildInParallel),(G.fogEnabled&&J.applyFog&&G.fogMode!==h.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(he),T.a.BindFogParameters(G,J,he),$.NUM_MORPH_INFLUENCERS&&T.a.BindMorphTargetParameters(J,he),this.useLogarithmicDepth&&T.a.BindLogDepth($,he,G),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),q.update(),this._afterBind(J,this._activeEffect)}}},oe.prototype.getAnimatables=function(){var Z=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&Z.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&Z.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&Z.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&Z.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&Z.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&Z.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&Z.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&Z.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&Z.push(this._refractionTexture),this.detailMap.getAnimatables(Z),Z},oe.prototype.getActiveTextures=function(){var Z=ue.prototype.getActiveTextures.call(this);return this._diffuseTexture&&Z.push(this._diffuseTexture),this._ambientTexture&&Z.push(this._ambientTexture),this._opacityTexture&&Z.push(this._opacityTexture),this._reflectionTexture&&Z.push(this._reflectionTexture),this._emissiveTexture&&Z.push(this._emissiveTexture),this._specularTexture&&Z.push(this._specularTexture),this._bumpTexture&&Z.push(this._bumpTexture),this._lightmapTexture&&Z.push(this._lightmapTexture),this._refractionTexture&&Z.push(this._refractionTexture),this.detailMap.getActiveTextures(Z),Z},oe.prototype.hasTexture=function(Z){return!!ue.prototype.hasTexture.call(this,Z)||this._diffuseTexture===Z||this._ambientTexture===Z||this._opacityTexture===Z||this._reflectionTexture===Z||this._emissiveTexture===Z||this._specularTexture===Z||this._bumpTexture===Z||this._lightmapTexture===Z||this._refractionTexture===Z||this.detailMap.hasTexture(Z)},oe.prototype.dispose=function(Z,J){var B,G,$,he,se,q,H,X,ee;J&&((B=this._diffuseTexture)===null||B===void 0||B.dispose(),(G=this._ambientTexture)===null||G===void 0||G.dispose(),($=this._opacityTexture)===null||$===void 0||$.dispose(),(he=this._reflectionTexture)===null||he===void 0||he.dispose(),(se=this._emissiveTexture)===null||se===void 0||se.dispose(),(q=this._specularTexture)===null||q===void 0||q.dispose(),(H=this._bumpTexture)===null||H===void 0||H.dispose(),(X=this._lightmapTexture)===null||X===void 0||X.dispose(),(ee=this._refractionTexture)===null||ee===void 0||ee.dispose()),this.detailMap.dispose(J),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),ue.prototype.dispose.call(this,Z,J)},oe.prototype.clone=function(Z){var J=this,B=m.a.Clone(function(){return new oe(Z,J.getScene())},this);return B.name=Z,B.id=Z,B},oe.prototype.serialize=function(){return m.a.Serialize(this)},oe.Parse=function(Z,J,B){return m.a.Parse(function(){return new oe(Z.name,J)},Z,J,B)},Object.defineProperty(oe,"DiffuseTextureEnabled",{get:function(){return M.a.DiffuseTextureEnabled},set:function(Z){M.a.DiffuseTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"DetailTextureEnabled",{get:function(){return M.a.DetailTextureEnabled},set:function(Z){M.a.DetailTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"AmbientTextureEnabled",{get:function(){return M.a.AmbientTextureEnabled},set:function(Z){M.a.AmbientTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"OpacityTextureEnabled",{get:function(){return M.a.OpacityTextureEnabled},set:function(Z){M.a.OpacityTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"ReflectionTextureEnabled",{get:function(){return M.a.ReflectionTextureEnabled},set:function(Z){M.a.ReflectionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"EmissiveTextureEnabled",{get:function(){return M.a.EmissiveTextureEnabled},set:function(Z){M.a.EmissiveTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"SpecularTextureEnabled",{get:function(){return M.a.SpecularTextureEnabled},set:function(Z){M.a.SpecularTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"BumpTextureEnabled",{get:function(){return M.a.BumpTextureEnabled},set:function(Z){M.a.BumpTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"LightmapTextureEnabled",{get:function(){return M.a.LightmapTextureEnabled},set:function(Z){M.a.LightmapTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"RefractionTextureEnabled",{get:function(){return M.a.RefractionTextureEnabled},set:function(Z){M.a.RefractionTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"ColorGradingTextureEnabled",{get:function(){return M.a.ColorGradingTextureEnabled},set:function(Z){M.a.ColorGradingTextureEnabled=Z},enumerable:!1,configurable:!0}),Object.defineProperty(oe,"FresnelEnabled",{get:function(){return M.a.FresnelEnabled},set:function(Z){M.a.FresnelEnabled=Z},enumerable:!1,configurable:!0}),Object(E.c)([Object(m.m)("diffuseTexture")],oe.prototype,"_diffuseTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],oe.prototype,"diffuseTexture",void 0),Object(E.c)([Object(m.m)("ambientTexture")],oe.prototype,"_ambientTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"ambientTexture",void 0),Object(E.c)([Object(m.m)("opacityTexture")],oe.prototype,"_opacityTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],oe.prototype,"opacityTexture",void 0),Object(E.c)([Object(m.m)("reflectionTexture")],oe.prototype,"_reflectionTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"reflectionTexture",void 0),Object(E.c)([Object(m.m)("emissiveTexture")],oe.prototype,"_emissiveTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"emissiveTexture",void 0),Object(E.c)([Object(m.m)("specularTexture")],oe.prototype,"_specularTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"specularTexture",void 0),Object(E.c)([Object(m.m)("bumpTexture")],oe.prototype,"_bumpTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"bumpTexture",void 0),Object(E.c)([Object(m.m)("lightmapTexture")],oe.prototype,"_lightmapTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"lightmapTexture",void 0),Object(E.c)([Object(m.m)("refractionTexture")],oe.prototype,"_refractionTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"refractionTexture",void 0),Object(E.c)([Object(m.e)("ambient")],oe.prototype,"ambientColor",void 0),Object(E.c)([Object(m.e)("diffuse")],oe.prototype,"diffuseColor",void 0),Object(E.c)([Object(m.e)("specular")],oe.prototype,"specularColor",void 0),Object(E.c)([Object(m.e)("emissive")],oe.prototype,"emissiveColor",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"specularPower",void 0),Object(E.c)([Object(m.c)("useAlphaFromDiffuseTexture")],oe.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],oe.prototype,"useAlphaFromDiffuseTexture",void 0),Object(E.c)([Object(m.c)("useEmissiveAsIllumination")],oe.prototype,"_useEmissiveAsIllumination",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useEmissiveAsIllumination",void 0),Object(E.c)([Object(m.c)("linkEmissiveWithDiffuse")],oe.prototype,"_linkEmissiveWithDiffuse",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"linkEmissiveWithDiffuse",void 0),Object(E.c)([Object(m.c)("useSpecularOverAlpha")],oe.prototype,"_useSpecularOverAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useSpecularOverAlpha",void 0),Object(E.c)([Object(m.c)("useReflectionOverAlpha")],oe.prototype,"_useReflectionOverAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useReflectionOverAlpha",void 0),Object(E.c)([Object(m.c)("disableLighting")],oe.prototype,"_disableLighting",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],oe.prototype,"disableLighting",void 0),Object(E.c)([Object(m.c)("useObjectSpaceNormalMap")],oe.prototype,"_useObjectSpaceNormalMap",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useObjectSpaceNormalMap",void 0),Object(E.c)([Object(m.c)("useParallax")],oe.prototype,"_useParallax",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useParallax",void 0),Object(E.c)([Object(m.c)("useParallaxOcclusion")],oe.prototype,"_useParallaxOcclusion",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useParallaxOcclusion",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"parallaxScaleBias",void 0),Object(E.c)([Object(m.c)("roughness")],oe.prototype,"_roughness",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"roughness",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"indexOfRefraction",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"invertRefractionY",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"alphaCutOff",void 0),Object(E.c)([Object(m.c)("useLightmapAsShadowmap")],oe.prototype,"_useLightmapAsShadowmap",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useLightmapAsShadowmap",void 0),Object(E.c)([Object(m.h)("diffuseFresnelParameters")],oe.prototype,"_diffuseFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],oe.prototype,"diffuseFresnelParameters",void 0),Object(E.c)([Object(m.h)("opacityFresnelParameters")],oe.prototype,"_opacityFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],oe.prototype,"opacityFresnelParameters",void 0),Object(E.c)([Object(m.h)("reflectionFresnelParameters")],oe.prototype,"_reflectionFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],oe.prototype,"reflectionFresnelParameters",void 0),Object(E.c)([Object(m.h)("refractionFresnelParameters")],oe.prototype,"_refractionFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],oe.prototype,"refractionFresnelParameters",void 0),Object(E.c)([Object(m.h)("emissiveFresnelParameters")],oe.prototype,"_emissiveFresnelParameters",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],oe.prototype,"emissiveFresnelParameters",void 0),Object(E.c)([Object(m.c)("useReflectionFresnelFromSpecular")],oe.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],oe.prototype,"useReflectionFresnelFromSpecular",void 0),Object(E.c)([Object(m.c)("useGlossinessFromSpecularMapAlpha")],oe.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(E.c)([Object(m.c)("maxSimultaneousLights")],oe.prototype,"_maxSimultaneousLights",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],oe.prototype,"maxSimultaneousLights",void 0),Object(E.c)([Object(m.c)("invertNormalMapX")],oe.prototype,"_invertNormalMapX",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"invertNormalMapX",void 0),Object(E.c)([Object(m.c)("invertNormalMapY")],oe.prototype,"_invertNormalMapY",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"invertNormalMapY",void 0),Object(E.c)([Object(m.c)("twoSidedLighting")],oe.prototype,"_twoSidedLighting",void 0),Object(E.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],oe.prototype,"twoSidedLighting",void 0),Object(E.c)([Object(m.c)()],oe.prototype,"useLogarithmicDepth",null),oe}(A.a);g.a.RegisteredTypes["BABYLON.StandardMaterial"]=ve,h.a.DefaultMaterialFactory=function(ue){return new ve("default material",ue)}},function(p,s,c){c.d(s,"a",function(){return L});var E=c(1),m=c(12),S=c(6),h=c(0),C=c(13),R=c(4),I=c(16),b=c(46),f=c(54),x=c(43),P=c(2),A=c(147),T=c(21),_=c(101),g=c(9),M=c(28),O=c(23),N=c(11),V=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=h.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},U=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new V,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1},L=function(j){function Y(W,ie){ie===void 0&&(ie=null);var re=j.call(this,W,ie,!1)||this;return re._internalAbstractMeshDataInfo=new U,re.cullingStrategy=Y.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,re.onCollideObservable=new S.c,re.onCollisionPositionChangeObservable=new S.c,re.onMaterialChangedObservable=new S.c,re.definedFacingForward=!0,re._occlusionQuery=null,re._renderingGroup=null,re.alphaIndex=Number.MAX_VALUE,re.isVisible=!0,re.isPickable=!0,re.showSubMeshesBoundingBox=!1,re.isBlocker=!1,re.enablePointerMoveEvents=!1,re._renderingGroupId=0,re._material=null,re.outlineColor=g.a.Red(),re.outlineWidth=.02,re.overlayColor=g.a.Red(),re.overlayAlpha=.5,re.useOctreeForRenderingSelection=!0,re.useOctreeForPicking=!0,re.useOctreeForCollisions=!0,re.alwaysSelectAsActiveMesh=!1,re.doNotSyncBoundingInfo=!1,re.actionManager=null,re._meshCollisionData=new A.a,re.ellipsoid=new h.e(.5,1,.5),re.ellipsoidOffset=new h.e(0,0,0),re.edgesWidth=1,re.edgesColor=new g.b(1,0,0,1),re._edgesRenderer=null,re._masterMesh=null,re._boundingInfo=null,re._renderId=0,re._intersectionsInProgress=new Array,re._unIndexed=!1,re._lightSources=new Array,re._waitingData={lods:null,actions:null,freezeWorldMatrix:null},re._bonesTransformMatrices=null,re._transformMatrixTexture=null,re.onRebuildObservable=new S.c,re._onCollisionPositionChange=function(ye,ve,ue){ue===void 0&&(ue=null),ve.subtractToRef(re._meshCollisionData._oldPositionForCollisions,re._meshCollisionData._diffPositionForCollisions),re._meshCollisionData._diffPositionForCollisions.length()>C.a.CollisionsEpsilon&&re.position.addInPlace(re._meshCollisionData._diffPositionForCollisions),ue&&re.onCollideObservable.notifyObservers(ue),re.onCollisionPositionChangeObservable.notifyObservers(re.position)},re.getScene().addMesh(re),re._resyncLightSources(),re}return Object(E.d)(Y,j),Object.defineProperty(Y,"BILLBOARDMODE_NONE",{get:function(){return b.a.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_X",{get:function(){return b.a.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Y",{get:function(){return b.a.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_Z",{get:function(){return b.a.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_ALL",{get:function(){return b.a.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(Y,"BILLBOARDMODE_USE_POSITION",{get:function(){return b.a.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(W){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(W){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Y.prototype._updateNonUniformScalingState=function(W){return!!j.prototype._updateNonUniformScalingState.call(this,W)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(Y.prototype,"onCollide",{set:function(W){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"onCollisionPositionChange",{set:function(W){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(W){this._internalAbstractMeshDataInfo._visibility!==W&&(this._internalAbstractMeshDataInfo._visibility=W,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(W){this._renderingGroupId=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"material",{get:function(){return this._material},set:function(W){this._material!==W&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=W,W&&W.meshMap&&(W.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(W){this._internalAbstractMeshDataInfo._receiveShadows!==W&&(this._internalAbstractMeshDataInfo._receiveShadows=W,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(W){this._internalAbstractMeshDataInfo._hasVertexAlpha!==W&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=W,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(W){this._internalAbstractMeshDataInfo._useVertexColors!==W&&(this._internalAbstractMeshDataInfo._useVertexColors=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(W){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==W&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(W){this._internalAbstractMeshDataInfo._numBoneInfluencers!==W&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=W,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(W){this._internalAbstractMeshDataInfo._applyFog!==W&&(this._internalAbstractMeshDataInfo._applyFog=W,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(W){W!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=W,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(W){this._meshCollisionData._collisionMask=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(W){this._meshCollisionData._collisionResponse=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(W){this._meshCollisionData._collisionGroup=isNaN(W)?-1:W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(W){this._meshCollisionData._surroundingMeshes=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(W){var ie=this._internalAbstractMeshDataInfo._skeleton;ie&&ie.needInitialSkinMatrix&&ie._unregisterMeshWithPoseMatrix(this),W&&W.needInitialSkinMatrix&&W._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=W,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),Y.prototype.getClassName=function(){return"AbstractMesh"},Y.prototype.toString=function(W){var ie="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");ie+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var re=this._internalAbstractMeshDataInfo._skeleton;return re&&(ie+=", skeleton: "+re.name),W&&(ie+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],ie+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),ie},Y.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==b.a.BILLBOARDMODE_NONE?this._masterMesh:j.prototype._getEffectiveParent.call(this)},Y.prototype._getActionManagerForTrigger=function(W,ie){if(ie===void 0&&(ie=!0),this.actionManager&&(ie||this.actionManager.isRecursive)){if(!W)return this.actionManager;if(this.actionManager.hasSpecificTrigger(W))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(W,!1):null},Y.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var W=0,ie=this.subMeshes;W<ie.length;W++)ie[W]._rebuild()},Y.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var W=0,ie=this.getScene().lights;W<ie.length;W++){var re=ie[W];re.isEnabled()&&re.canAffectMesh(this)&&this._lightSources.push(re)}this._markSubMeshesAsLightDirty()},Y.prototype._resyncLightSource=function(W){var ie=W.isEnabled()&&W.canAffectMesh(this),re=this._lightSources.indexOf(W),ye=!1;if(re===-1){if(!ie)return;this._lightSources.push(W)}else{if(ie)return;ye=!0,this._lightSources.splice(re,1)}this._markSubMeshesAsLightDirty(ye)},Y.prototype._unBindEffect=function(){for(var W=0,ie=this.subMeshes;W<ie.length;W++)ie[W].setEffect(null)},Y.prototype._removeLightSource=function(W,ie){var re=this._lightSources.indexOf(W);re!==-1&&(this._lightSources.splice(re,1),this._markSubMeshesAsLightDirty(ie))},Y.prototype._markSubMeshesAsDirty=function(W){if(this.subMeshes)for(var ie=0,re=this.subMeshes;ie<re.length;ie++){var ye=re[ie];ye._materialDefines&&W(ye._materialDefines)}},Y.prototype._markSubMeshesAsLightDirty=function(W){W===void 0&&(W=!1),this._markSubMeshesAsDirty(function(ie){return ie.markAsLightDirty(W)})},Y.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(W){return W.markAsAttributesDirty()})},Y.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(W){return W.markAsMiscDirty()})},Object.defineProperty(Y.prototype,"scaling",{get:function(){return this._scaling},set:function(W){this._scaling=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.getLOD=function(W){return this},Y.prototype.getTotalVertices=function(){return 0},Y.prototype.getTotalIndices=function(){return 0},Y.prototype.getIndices=function(){return null},Y.prototype.getVerticesData=function(W){return null},Y.prototype.setVerticesData=function(W,ie,re,ye){return this},Y.prototype.updateVerticesData=function(W,ie,re,ye){return this},Y.prototype.setIndices=function(W,ie){return this},Y.prototype.isVerticesDataPresent=function(W){return!1},Y.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Y.prototype.normalizeToUnitCube=function(W,ie,re){return W===void 0&&(W=!0),ie===void 0&&(ie=!1),j.prototype.normalizeToUnitCube.call(this,W,ie,re)},Y.prototype.setBoundingInfo=function(W){return this._boundingInfo=W,this},Object.defineProperty(Y.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(R.b.MatricesIndicesKind)&&this.isVerticesDataPresent(R.b.MatricesWeightsKind)},enumerable:!1,configurable:!0}),Y.prototype._preActivate=function(){},Y.prototype._preActivateForIntermediateRendering=function(W){},Y.prototype._activate=function(W,ie){return this._renderId=W,!0},Y.prototype._postActivate=function(){},Y.prototype._freeze=function(){},Y.prototype._unFreeze=function(){},Y.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===b.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():j.prototype.getWorldMatrix.call(this)},Y.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():j.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(Y.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Y.prototype.movePOV=function(W,ie,re){return this.position.addInPlace(this.calcMovePOV(W,ie,re)),this},Y.prototype.calcMovePOV=function(W,ie,re){var ye=new h.a;(this.rotationQuaternion?this.rotationQuaternion:h.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(ye);var ve=h.e.Zero(),ue=this.definedFacingForward?-1:1;return h.e.TransformCoordinatesFromFloatsToRef(W*ue,ie,re*ue,ye,ve),ve},Y.prototype.rotatePOV=function(W,ie,re){return this.rotation.addInPlace(this.calcRotatePOV(W,ie,re)),this},Y.prototype.calcRotatePOV=function(W,ie,re){var ye=this.definedFacingForward?1:-1;return new h.e(W*ye,ie,re*ye)},Y.prototype.refreshBoundingInfo=function(W){return W===void 0&&(W=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(W),null),this},Y.prototype._refreshBoundingInfo=function(W,ie){if(W){var re=Object(_.a)(W,0,this.getTotalVertices(),ie);this._boundingInfo?this._boundingInfo.reConstruct(re.minimum,re.maximum):this._boundingInfo=new x.a(re.minimum,re.maximum)}if(this.subMeshes)for(var ye=0;ye<this.subMeshes.length;ye++)this.subMeshes[ye].refreshBoundingInfo(W);this._updateBoundingInfo()},Y.prototype._getPositionData=function(W){var ie=this.getVerticesData(R.b.PositionKind);if(ie&&W&&this.skeleton){ie=m.b.Slice(ie),this._generatePointsArray();var re=this.getVerticesData(R.b.MatricesIndicesKind),ye=this.getVerticesData(R.b.MatricesWeightsKind);if(ye&&re){var ve=this.numBoneInfluencers>4,ue=ve?this.getVerticesData(R.b.MatricesIndicesExtraKind):null,oe=ve?this.getVerticesData(R.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var Z=this.skeleton.getTransformMatrices(this),J=h.c.Vector3[0],B=h.c.Matrix[0],G=h.c.Matrix[1],$=0,he=0;he<ie.length;he+=3,$+=4){var se,q;for(B.reset(),se=0;se<4;se++)(q=ye[$+se])>0&&(h.a.FromFloat32ArrayToRefScaled(Z,Math.floor(16*re[$+se]),q,G),B.addToSelf(G));if(ve)for(se=0;se<4;se++)(q=oe[$+se])>0&&(h.a.FromFloat32ArrayToRefScaled(Z,Math.floor(16*ue[$+se]),q,G),B.addToSelf(G));h.e.TransformCoordinatesFromFloatsToRef(ie[he],ie[he+1],ie[he+2],B,J),J.toArray(ie,he),this._positions&&this._positions[he/3].copyFrom(J)}}}return ie},Y.prototype._updateBoundingInfo=function(){var W=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(W.worldMatrixFromCache):this._boundingInfo=new x.a(this.absolutePosition,this.absolutePosition,W.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(W.worldMatrixFromCache),this},Y.prototype._updateSubMeshesBoundingInfo=function(W){if(!this.subMeshes)return this;for(var ie=this.subMeshes.length,re=0;re<ie;re++){var ye=this.subMeshes[re];(ie>1||!ye.IsGlobal)&&ye.updateBoundingInfo(W)}return this},Y.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(Y.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),Y.prototype.isInFrustum=function(W){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(W,this.cullingStrategy)},Y.prototype.isCompletelyInFrustum=function(W){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(W)},Y.prototype.intersectsMesh=function(W,ie,re){if(ie===void 0&&(ie=!1),!this._boundingInfo||!W._boundingInfo)return!1;if(this._boundingInfo.intersects(W._boundingInfo,ie))return!0;if(re){for(var ye=0,ve=this.getChildMeshes();ye<ve.length;ye++)if(ve[ye].intersectsMesh(W,ie,!0))return!0}return!1},Y.prototype.intersectsPoint=function(W){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(W)},Object.defineProperty(Y.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(W){this._meshCollisionData._checkCollisions=W},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),Y.prototype.moveWithCollisions=function(W){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var ie=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=ie.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,ie.getNewPosition(this._meshCollisionData._oldPositionForCollisions,W,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},Y.prototype._collideForSubMesh=function(W,ie,re){if(this._generatePointsArray(),!this._positions)return this;if(!W._lastColliderWorldVertices||!W._lastColliderTransformMatrix.equals(ie)){W._lastColliderTransformMatrix=ie.clone(),W._lastColliderWorldVertices=[],W._trianglePlanes=[];for(var ye=W.verticesStart,ve=W.verticesStart+W.verticesCount,ue=ye;ue<ve;ue++)W._lastColliderWorldVertices.push(h.e.TransformCoordinates(this._positions[ue],ie))}return re._collide(W._trianglePlanes,W._lastColliderWorldVertices,this.getIndices(),W.indexStart,W.indexStart+W.indexCount,W.verticesStart,!!W.getMaterial(),this),this},Y.prototype._processCollisionsForSubMeshes=function(W,ie){for(var re=this._scene.getCollidingSubMeshCandidates(this,W),ye=re.length,ve=0;ve<ye;ve++){var ue=re.data[ve];ye>1&&!ue._checkCollision(W)||this._collideForSubMesh(ue,ie,W)}return this},Y.prototype._checkCollision=function(W){if(!this._boundingInfo||!this._boundingInfo._checkCollision(W))return this;var ie=h.c.Matrix[0],re=h.c.Matrix[1];return h.a.ScalingToRef(1/W._radius.x,1/W._radius.y,1/W._radius.z,ie),this.worldMatrixFromCache.multiplyToRef(ie,re),this._processCollisionsForSubMeshes(W,re),this},Y.prototype._generatePointsArray=function(){return!1},Y.prototype.intersects=function(W,ie,re,ye,ve,ue){var oe;ye===void 0&&(ye=!1),ue===void 0&&(ue=!1);var Z=new f.a,J=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,B=this._boundingInfo;if(!this.subMeshes||!B||!(ue||W.intersectsSphere(B.boundingSphere,J)&&W.intersectsBox(B.boundingBox,J)))return Z;if(ye)return Z.hit=!ue,Z.pickedMesh=ue?null:this,Z.distance=ue?0:h.e.Distance(W.origin,B.boundingSphere.center),Z.subMeshId=0,Z;if(!this._generatePointsArray())return Z;for(var G=null,$=this._scene.getIntersectingSubMeshCandidates(this,W),he=$.length,se=!1,q=0;q<he;q++){var H=(X=$.data[q]).getMaterial();if(H&&((oe=this.getIndices())===null||oe===void 0?void 0:oe.length)&&(H.fillMode==P.a.MATERIAL_TriangleStripDrawMode||H.fillMode==P.a.MATERIAL_TriangleFillMode||H.fillMode==P.a.MATERIAL_WireFrameFillMode||H.fillMode==P.a.MATERIAL_PointFillMode)){se=!0;break}}if(!se)return Z.hit=!0,Z.pickedMesh=this,Z.distance=h.e.Distance(W.origin,B.boundingSphere.center),Z.subMeshId=-1,Z;for(q=0;q<he;q++){var X=$.data[q];if(!(he>1)||X.canIntersects(W)){var ee=X.intersects(W,this._positions,this.getIndices(),ie,re);if(ee&&(ie||!G||ee.distance<G.distance)&&((G=ee).subMeshId=q,ie))break}}if(G){var Q=ve??(this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix()),te=h.c.Vector3[0],ge=h.c.Vector3[1];h.e.TransformCoordinatesToRef(W.origin,Q,te),W.direction.scaleToRef(G.distance,ge);var ce=h.e.TransformNormal(ge,Q).addInPlace(te);return Z.hit=!0,Z.distance=h.e.Distance(te,ce),Z.pickedPoint=ce,Z.pickedMesh=this,Z.bu=G.bu||0,Z.bv=G.bv||0,Z.subMeshFaceId=G.faceId,Z.faceId=G.faceId+$.data[G.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),Z.subMeshId=G.subMeshId,Z}return Z},Y.prototype.clone=function(W,ie,re){return null},Y.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},Y.prototype.dispose=function(W,ie){var re,ye=this;for(ie===void 0&&(ie=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),re=0;re<this._intersectionsInProgress.length;re++){var ve=this._intersectionsInProgress[re],ue=ve._intersectionsInProgress.indexOf(this);ve._intersectionsInProgress.splice(ue,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(Z){var J=Z.includedOnlyMeshes.indexOf(ye);J!==-1&&Z.includedOnlyMeshes.splice(J,1),(J=Z.excludedMeshes.indexOf(ye))!==-1&&Z.excludedMeshes.splice(J,1);var B=Z.getShadowGenerator();if(B){var G=B.getShadowMap();G&&G.renderList&&(J=G.renderList.indexOf(ye))!==-1&&G.renderList.splice(J,1)}}),this.getClassName()==="InstancedMesh"&&this.getClassName()==="InstancedLinesMesh"||this.releaseSubMeshes();var oe=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,oe.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),oe.wipeCaches(),this.getScene().removeMesh(this),ie&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!W)for(re=0;re<this.getScene().particleSystems.length;re++)this.getScene().particleSystems[re].emitter===this&&(this.getScene().particleSystems[re].dispose(),re--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),j.prototype.dispose.call(this,W,ie)},Y.prototype.addChild=function(W){return W.setParent(this),this},Y.prototype.removeChild=function(W){return W.setParent(null),this},Y.prototype._initFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetNormals||(W.facetNormals=new Array),W.facetPositions||(W.facetPositions=new Array),W.facetPartitioning||(W.facetPartitioning=new Array),W.facetNb=this.getIndices().length/3|0,W.partitioningSubdivisions=W.partitioningSubdivisions?W.partitioningSubdivisions:10,W.partitioningBBoxRatio=W.partitioningBBoxRatio?W.partitioningBBoxRatio:1.01;for(var ie=0;ie<W.facetNb;ie++)W.facetNormals[ie]=h.e.Zero(),W.facetPositions[ie]=h.e.Zero();return W.facetDataEnabled=!0,this},Y.prototype.updateFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;W.facetDataEnabled||this._initFacetData();var ie=this.getVerticesData(R.b.PositionKind),re=this.getIndices(),ye=this.getVerticesData(R.b.NormalKind),ve=this.getBoundingInfo();if(W.facetDepthSort&&!W.facetDepthSortEnabled){if(W.facetDepthSortEnabled=!0,re instanceof Uint16Array)W.depthSortedIndices=new Uint16Array(re);else if(re instanceof Uint32Array)W.depthSortedIndices=new Uint32Array(re);else{for(var ue=!1,oe=0;oe<re.length;oe++)if(re[oe]>65535){ue=!0;break}W.depthSortedIndices=ue?new Uint32Array(re):new Uint16Array(re)}if(W.facetDepthSortFunction=function(se,q){return q.sqDistance-se.sqDistance},!W.facetDepthSortFrom){var Z=this.getScene().activeCamera;W.facetDepthSortFrom=Z?Z.position:h.e.Zero()}W.depthSortedFacets=[];for(var J=0;J<W.facetNb;J++){var B={ind:3*J,sqDistance:0};W.depthSortedFacets.push(B)}W.invertedMatrix=h.a.Identity(),W.facetDepthSortOrigin=h.e.Zero()}W.bbSize.x=ve.maximum.x-ve.minimum.x>M.a?ve.maximum.x-ve.minimum.x:M.a,W.bbSize.y=ve.maximum.y-ve.minimum.y>M.a?ve.maximum.y-ve.minimum.y:M.a,W.bbSize.z=ve.maximum.z-ve.minimum.z>M.a?ve.maximum.z-ve.minimum.z:M.a;var G=W.bbSize.x>W.bbSize.y?W.bbSize.x:W.bbSize.y;if(G=G>W.bbSize.z?G:W.bbSize.z,W.subDiv.max=W.partitioningSubdivisions,W.subDiv.X=Math.floor(W.subDiv.max*W.bbSize.x/G),W.subDiv.Y=Math.floor(W.subDiv.max*W.bbSize.y/G),W.subDiv.Z=Math.floor(W.subDiv.max*W.bbSize.z/G),W.subDiv.X=W.subDiv.X<1?1:W.subDiv.X,W.subDiv.Y=W.subDiv.Y<1?1:W.subDiv.Y,W.subDiv.Z=W.subDiv.Z<1?1:W.subDiv.Z,W.facetParameters.facetNormals=this.getFacetLocalNormals(),W.facetParameters.facetPositions=this.getFacetLocalPositions(),W.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),W.facetParameters.bInfo=ve,W.facetParameters.bbSize=W.bbSize,W.facetParameters.subDiv=W.subDiv,W.facetParameters.ratio=this.partitioningBBoxRatio,W.facetParameters.depthSort=W.facetDepthSort,W.facetDepthSort&&W.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(W.invertedMatrix),h.e.TransformCoordinatesToRef(W.facetDepthSortFrom,W.invertedMatrix,W.facetDepthSortOrigin),W.facetParameters.distanceTo=W.facetDepthSortOrigin),W.facetParameters.depthSortedFacets=W.depthSortedFacets,I.a.ComputeNormals(ie,re,ye,W.facetParameters),W.facetDepthSort&&W.facetDepthSortEnabled){W.depthSortedFacets.sort(W.facetDepthSortFunction);var $=W.depthSortedIndices.length/3|0;for(J=0;J<$;J++){var he=W.depthSortedFacets[J].ind;W.depthSortedIndices[3*J]=re[he],W.depthSortedIndices[3*J+1]=re[he+1],W.depthSortedIndices[3*J+2]=re[he+2]}this.updateIndices(W.depthSortedIndices,void 0,!0)}return this},Y.prototype.getFacetLocalNormals=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetNormals||this.updateFacetData(),W.facetNormals},Y.prototype.getFacetLocalPositions=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPositions||this.updateFacetData(),W.facetPositions},Y.prototype.getFacetLocalPartitioning=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetPartitioning||this.updateFacetData(),W.facetPartitioning},Y.prototype.getFacetPosition=function(W){var ie=h.e.Zero();return this.getFacetPositionToRef(W,ie),ie},Y.prototype.getFacetPositionToRef=function(W,ie){var re=this.getFacetLocalPositions()[W],ye=this.getWorldMatrix();return h.e.TransformCoordinatesToRef(re,ye,ie),this},Y.prototype.getFacetNormal=function(W){var ie=h.e.Zero();return this.getFacetNormalToRef(W,ie),ie},Y.prototype.getFacetNormalToRef=function(W,ie){var re=this.getFacetLocalNormals()[W];return h.e.TransformNormalToRef(re,this.getWorldMatrix(),ie),this},Y.prototype.getFacetsAtLocalCoordinates=function(W,ie,re){var ye=this.getBoundingInfo(),ve=this._internalAbstractMeshDataInfo._facetData,ue=Math.floor((W-ye.minimum.x*ve.partitioningBBoxRatio)*ve.subDiv.X*ve.partitioningBBoxRatio/ve.bbSize.x),oe=Math.floor((ie-ye.minimum.y*ve.partitioningBBoxRatio)*ve.subDiv.Y*ve.partitioningBBoxRatio/ve.bbSize.y),Z=Math.floor((re-ye.minimum.z*ve.partitioningBBoxRatio)*ve.subDiv.Z*ve.partitioningBBoxRatio/ve.bbSize.z);return ue<0||ue>ve.subDiv.max||oe<0||oe>ve.subDiv.max||Z<0||Z>ve.subDiv.max?null:ve.facetPartitioning[ue+ve.subDiv.max*oe+ve.subDiv.max*ve.subDiv.max*Z]},Y.prototype.getClosestFacetAtCoordinates=function(W,ie,re,ye,ve,ue){ve===void 0&&(ve=!1),ue===void 0&&(ue=!0);var oe=this.getWorldMatrix(),Z=h.c.Matrix[5];oe.invertToRef(Z);var J=h.c.Vector3[8];h.e.TransformCoordinatesFromFloatsToRef(W,ie,re,Z,J);var B=this.getClosestFacetAtLocalCoordinates(J.x,J.y,J.z,ye,ve,ue);return ye&&h.e.TransformCoordinatesFromFloatsToRef(ye.x,ye.y,ye.z,oe,ye),B},Y.prototype.getClosestFacetAtLocalCoordinates=function(W,ie,re,ye,ve,ue){ve===void 0&&(ve=!1),ue===void 0&&(ue=!0);var oe=null,Z=0,J=0,B=0,G=0,$=0,he=0,se=0,q=0,H=this.getFacetLocalPositions(),X=this.getFacetLocalNormals(),ee=this.getFacetsAtLocalCoordinates(W,ie,re);if(!ee)return null;for(var Q,te,ge,ce=Number.MAX_VALUE,de=ce,ne=0;ne<ee.length;ne++)te=X[Q=ee[ne]],G=(W-(ge=H[Q]).x)*te.x+(ie-ge.y)*te.y+(re-ge.z)*te.z,(!ve||ve&&ue&&G>=0||ve&&!ue&&G<=0)&&(G=te.x*ge.x+te.y*ge.y+te.z*ge.z,$=-(te.x*W+te.y*ie+te.z*re-G)/(te.x*te.x+te.y*te.y+te.z*te.z),(de=(Z=(he=W+te.x*$)-W)*Z+(J=(se=ie+te.y*$)-ie)*J+(B=(q=re+te.z*$)-re)*B)<ce&&(ce=de,oe=Q,ye&&(ye.x=he,ye.y=se,ye.z=q)));return oe},Y.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},Y.prototype.disableFacetData=function(){var W=this._internalAbstractMeshDataInfo._facetData;return W.facetDataEnabled&&(W.facetDataEnabled=!1,W.facetPositions=new Array,W.facetNormals=new Array,W.facetPartitioning=new Array,W.facetParameters=null,W.depthSortedIndices=new Uint32Array(0)),this},Y.prototype.updateIndices=function(W,ie,re){return this},Y.prototype.createNormals=function(W){var ie,re=this.getVerticesData(R.b.PositionKind),ye=this.getIndices();return ie=this.isVerticesDataPresent(R.b.NormalKind)?this.getVerticesData(R.b.NormalKind):[],I.a.ComputeNormals(re,ye,ie,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(R.b.NormalKind,ie,W),this},Y.prototype.alignWithNormal=function(W,ie){ie||(ie=O.a.Y);var re=h.c.Vector3[0],ye=h.c.Vector3[1];return h.e.CrossToRef(ie,W,ye),h.e.CrossToRef(W,ye,re),this.rotationQuaternion?h.b.RotationQuaternionFromAxisToRef(re,W,ye,this.rotationQuaternion):h.e.RotationFromAxisToRef(re,W,ye,this.rotation),this},Y.prototype._checkOcclusionQuery=function(){return!1},Y.prototype.disableEdgesRendering=function(){throw T.a.WarnImport("EdgesRenderer")},Y.prototype.enableEdgesRendering=function(W,ie,re){throw T.a.WarnImport("EdgesRenderer")},Y.prototype.getConnectedParticleSystems=function(){var W=this;return this._scene.particleSystems.filter(function(ie){return ie.emitter===W})},Y.OCCLUSION_TYPE_NONE=0,Y.OCCLUSION_TYPE_OPTIMISTIC=1,Y.OCCLUSION_TYPE_STRICT=2,Y.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,Y.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,Y.CULLINGSTRATEGY_STANDARD=P.a.MESHES_CULLINGSTRATEGY_STANDARD,Y.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=P.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=P.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,Y.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=P.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,Y}(b.a);N.a.RegisteredTypes["BABYLON.AbstractMesh"]=L},function(p,s,c){c.d(s,"a",function(){return b});var E=c(8),m=c(44),S=c(0),h=c(31),C=c(7),R=c(50),I=c(23);C.a._PhysicsImpostorParser=function(f,x,P){return new b(x,P.physicsImpostor,{mass:P.physicsMass,friction:P.physicsFriction,restitution:P.physicsRestitution},f)};var b=function(){function f(x,P,A,T){var _=this;A===void 0&&(A={mass:0}),this.object=x,this.type=P,this._options=A,this._scene=T,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=S.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new S.b,this._tmpQuat2=new S.b,this.beforeStep=function(){_._physicsEngine&&(_.object.translate(_._deltaPosition,-1),_._deltaRotationConjugated&&_.object.rotationQuaternion&&_.object.rotationQuaternion.multiplyToRef(_._deltaRotationConjugated,_.object.rotationQuaternion),_.object.computeWorldMatrix(!1),_.object.parent&&_.object.rotationQuaternion?(_.getParentsRotation(),_._tmpQuat.multiplyToRef(_.object.rotationQuaternion,_._tmpQuat)):_._tmpQuat.copyFrom(_.object.rotationQuaternion||new S.b),_._options.disableBidirectionalTransformation||_.object.rotationQuaternion&&_._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(_,_.object.getAbsolutePosition(),_._tmpQuat),_._onBeforePhysicsStepCallbacks.forEach(function(g){g(_)}))},this.afterStep=function(){_._physicsEngine&&(_._onAfterPhysicsStepCallbacks.forEach(function(g){g(_)}),_._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(_),_.object.parent&&_.object.rotationQuaternion&&(_.getParentsRotation(),_._tmpQuat.conjugateInPlace(),_._tmpQuat.multiplyToRef(_.object.rotationQuaternion,_.object.rotationQuaternion)),_.object.setAbsolutePosition(_.object.position),_._deltaRotation&&_.object.rotationQuaternion&&_.object.rotationQuaternion.multiplyToRef(_._deltaRotation,_.object.rotationQuaternion),_.object.translate(_._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(g){if((_._onPhysicsCollideCallbacks.length||_.onCollideEvent)&&_._physicsEngine){var M=_._physicsEngine.getImpostorWithPhysicsBody(g.body);M&&(_.onCollideEvent&&_.onCollideEvent(_,M),_._onPhysicsCollideCallbacks.filter(function(O){return O.otherImpostors.indexOf(M)!==-1}).forEach(function(O){O.callback(_,M,g.point)}))}},this.object?(this.object.parent&&A.mass!==0&&E.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&x.getScene&&(this._scene=x.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=S.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new S.b),this._options.mass=A.mass===void 0?0:A.mass,this._options.friction=A.friction===void 0?.2:A.friction,this._options.restitution=A.restitution===void 0?.2:A.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=A.pressure===void 0?200:A.pressure,this._options.stiffness=A.stiffness===void 0?1:A.stiffness,this._options.velocityIterations=A.velocityIterations===void 0?20:A.velocityIterations,this._options.positionIterations=A.positionIterations===void 0?20:A.positionIterations,this._options.fixedPoints=A.fixedPoints===void 0?0:A.fixedPoints,this._options.margin=A.margin===void 0?0:A.margin,this._options.damping=A.damping===void 0?0:A.damping,this._options.path=A.path===void 0?null:A.path,this._options.shape=A.shape===void 0?null:A.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&E.a.Warn("You must affect impostors to children before affecting impostor to parent.")):E.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):E.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(f.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(x){this.setMass(x)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,x)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,x)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.setBodyPressure?x.getBodyPressure(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyPressure&&P.setBodyPressure(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyStiffness?x.getBodyStiffness(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyStiffness&&P.setBodyStiffness(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyVelocityIterations?x.getBodyVelocityIterations(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyVelocityIterations&&P.setBodyVelocityIterations(this,x)}},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var x=this._physicsEngine.getPhysicsPlugin();return x.getBodyPositionIterations?x.getBodyPositionIterations(this):0},set:function(x){if(this._physicsEngine){var P=this._physicsEngine.getPhysicsPlugin();P.setBodyPositionIterations&&P.setBodyPositionIterations(this,x)}},enumerable:!1,configurable:!0}),f.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},f.prototype._getPhysicsParent=function(){return this.object.parent instanceof h.a?this.object.parent.physicsImpostor:null},f.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},f.prototype.setScalingUpdated=function(){this.forceUpdate()},f.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(f.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(x){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=x,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(x){this._parent=x},enumerable:!1,configurable:!0}),f.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},f.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var x=this.object.rotationQuaternion,P=this.object.scaling.clone();this.object.rotationQuaternion=f.IDENTITY_QUATERNION;var A=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);A&&A.decompose(P,void 0,void 0);var T=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(P);return this.object.rotationQuaternion=x,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),T}return f.DEFAULT_OBJECT_SIZE},f.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},f.prototype.getParam=function(x){return this._options[x]},f.prototype.setParam=function(x,P){this._options[x]=P,this._bodyUpdateRequired=!0},f.prototype.setMass=function(x){this.getParam("mass")!==x&&this.setParam("mass",x),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,x)},f.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):S.e.Zero()},f.prototype.setLinearVelocity=function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,x)},f.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):S.e.Zero()},f.prototype.setAngularVelocity=function(x){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,x)},f.prototype.executeNativeFunction=function(x){this._physicsEngine&&x(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},f.prototype.registerBeforePhysicsStep=function(x){this._onBeforePhysicsStepCallbacks.push(x)},f.prototype.unregisterBeforePhysicsStep=function(x){var P=this._onBeforePhysicsStepCallbacks.indexOf(x);P>-1?this._onBeforePhysicsStepCallbacks.splice(P,1):E.a.Warn("Function to remove was not found")},f.prototype.registerAfterPhysicsStep=function(x){this._onAfterPhysicsStepCallbacks.push(x)},f.prototype.unregisterAfterPhysicsStep=function(x){var P=this._onAfterPhysicsStepCallbacks.indexOf(x);P>-1?this._onAfterPhysicsStepCallbacks.splice(P,1):E.a.Warn("Function to remove was not found")},f.prototype.registerOnPhysicsCollide=function(x,P){var A=x instanceof Array?x:[x];this._onPhysicsCollideCallbacks.push({callback:P,otherImpostors:A})},f.prototype.unregisterOnPhysicsCollide=function(x,P){var A=x instanceof Array?x:[x],T=-1;this._onPhysicsCollideCallbacks.some(function(_,g){if(_.callback===P&&_.otherImpostors.length===A.length){var M=_.otherImpostors.every(function(O){return A.indexOf(O)>-1});return M&&(T=g),M}return!1})?this._onPhysicsCollideCallbacks.splice(T,1):E.a.Warn("Function to remove was not found")},f.prototype.getParentsRotation=function(){var x=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);x;)x.rotationQuaternion?this._tmpQuat2.copyFrom(x.rotationQuaternion):S.b.RotationYawPitchRollToRef(x.rotation.y,x.rotation.x,x.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),x=x.parent;return this._tmpQuat},f.prototype.applyForce=function(x,P){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,x,P),this},f.prototype.applyImpulse=function(x,P){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,x,P),this},f.prototype.createJoint=function(x,P,A){var T=new R.e(P,A);return this.addJoint(x,T),this},f.prototype.addJoint=function(x,P){return this._joints.push({otherImpostor:x,joint:P}),this._physicsEngine&&this._physicsEngine.addJoint(this,x,P),this},f.prototype.addAnchor=function(x,P,A,T,_){if(!this._physicsEngine)return this;var g=this._physicsEngine.getPhysicsPlugin();return g.appendAnchor?(this._physicsEngine&&g.appendAnchor(this,x,P,A,T,_),this):this},f.prototype.addHook=function(x,P,A,T){if(!this._physicsEngine)return this;var _=this._physicsEngine.getPhysicsPlugin();return _.appendAnchor?(this._physicsEngine&&_.appendHook(this,x,P,A,T),this):this},f.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},f.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},f.prototype.clone=function(x){return x?new f(x,this.type,this._options,this._scene):null},f.prototype.dispose=function(){var x=this;this._physicsEngine&&(this._joints.forEach(function(P){x._physicsEngine&&x._physicsEngine.removeJoint(x,P.otherImpostor,P.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},f.prototype.setDeltaPosition=function(x){this._deltaPosition.copyFrom(x)},f.prototype.setDeltaRotation=function(x){this._deltaRotation||(this._deltaRotation=new S.b),this._deltaRotation.copyFrom(x),this._deltaRotationConjugated=this._deltaRotation.conjugate()},f.prototype.getBoxSizeToRef=function(x){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,x),this},f.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},f.prototype.syncBoneWithImpostor=function(x,P,A,T,_){var g=f._tmpVecs[0],M=this.object;if(M.rotationQuaternion)if(_){var O=f._tmpQuat;M.rotationQuaternion.multiplyToRef(_,O),x.setRotationQuaternion(O,I.c.WORLD,P)}else x.setRotationQuaternion(M.rotationQuaternion,I.c.WORLD,P);g.x=0,g.y=0,g.z=0,A&&(g.x=A.x,g.y=A.y,g.z=A.z,x.getDirectionToRef(g,P,g),T==null&&(T=A.length()),g.x*=T,g.y*=T,g.z*=T),x.getParent()?(g.addInPlace(M.getAbsolutePosition()),x.setAbsolutePosition(g,P)):(P.setAbsolutePosition(M.getAbsolutePosition()),P.position.x-=g.x,P.position.y-=g.y,P.position.z-=g.z)},f.prototype.syncImpostorWithBone=function(x,P,A,T,_,g){var M=this.object;if(M.rotationQuaternion)if(_){var O=f._tmpQuat;x.getRotationQuaternionToRef(I.c.WORLD,P,O),O.multiplyToRef(_,M.rotationQuaternion)}else x.getRotationQuaternionToRef(I.c.WORLD,P,M.rotationQuaternion);var N=f._tmpVecs[0],V=f._tmpVecs[1];g||((g=f._tmpVecs[2]).x=0,g.y=1,g.z=0),x.getDirectionToRef(g,P,V),x.getAbsolutePositionToRef(P,N),T==null&&A&&(T=A.length()),T!=null&&(N.x+=V.x*T,N.y+=V.y*T,N.z+=V.z*T),M.setAbsolutePosition(N)},f.DEFAULT_OBJECT_SIZE=new S.e(1,1,1),f.IDENTITY_QUATERNION=S.b.Identity(),f._tmpVecs=m.a.BuildArray(3,S.e.Zero),f._tmpQuat=S.b.Identity(),f.NoImpostor=0,f.SphereImpostor=1,f.BoxImpostor=2,f.PlaneImpostor=3,f.MeshImpostor=4,f.CapsuleImpostor=6,f.CylinderImpostor=7,f.ParticleImpostor=8,f.HeightmapImpostor=9,f.ConvexHullImpostor=10,f.CustomImpostor=100,f.RopeImpostor=101,f.ClothImpostor=102,f.SoftbodyImpostor=103,f}()},function(p,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(1),m=function(){function h(C){this.length=0,this.data=new Array(C),this._id=h._GlobalId++}return h.prototype.push=function(C){this.data[this.length++]=C,this.length>this.data.length&&(this.data.length*=2)},h.prototype.forEach=function(C){for(var R=0;R<this.length;R++)C(this.data[R])},h.prototype.sort=function(C){this.data.sort(C)},h.prototype.reset=function(){this.length=0},h.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},h.prototype.concat=function(C){if(C.length!==0){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(var R=0;R<C.length;R++)this.data[this.length++]=(C.data||C)[R]}},h.prototype.indexOf=function(C){var R=this.data.indexOf(C);return R>=this.length?-1:R},h.prototype.contains=function(C){return this.indexOf(C)!==-1},h._GlobalId=0,h}(),S=function(h){function C(){var R=h!==null&&h.apply(this,arguments)||this;return R._duplicateId=0,R}return Object(E.d)(C,h),C.prototype.push=function(R){h.prototype.push.call(this,R),R.__smartArrayFlags||(R.__smartArrayFlags={}),R.__smartArrayFlags[this._id]=this._duplicateId},C.prototype.pushNoDuplicate=function(R){return(!R.__smartArrayFlags||R.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(R),!0)},C.prototype.reset=function(){h.prototype.reset.call(this),this._duplicateId++},C.prototype.concatWithNoDuplicate=function(R){if(R.length!==0){this.length+R.length>this.data.length&&(this.data.length=2*(this.length+R.length));for(var I=0;I<R.length;I++){var b=(R.data||R)[I];this.pushNoDuplicate(b)}}},C}(m)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.EndsWith=function(S,h){return S.indexOf(h,S.length-h.length)!==-1},m.StartsWith=function(S,h){return!!S&&S.indexOf(h)===0},m.Decode=function(S){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(S);for(var h="",C=0;C<S.byteLength;C++)h+=String.fromCharCode(S[C]);return h},m.EncodeArrayBufferToBase64=function(S){for(var h,C,R,I,b,f,x,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A="",T=0,_=ArrayBuffer.isView(S)?new Uint8Array(S.buffer,S.byteOffset,S.byteLength):new Uint8Array(S);T<_.length;)I=(h=_[T++])>>2,b=(3&h)<<4|(C=T<_.length?_[T++]:Number.NaN)>>4,f=(15&C)<<2|(R=T<_.length?_[T++]:Number.NaN)>>6,x=63&R,isNaN(C)?f=x=64:isNaN(R)&&(x=64),A+=P.charAt(I)+P.charAt(b)+P.charAt(f)+P.charAt(x);return A},m.PadNumber=function(S,h){for(var C=String(S);C.length<h;)C="0"+C;return C},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return m.AddParser=function(S,h){this._BabylonFileParsers[S]=h},m.GetParser=function(S){return this._BabylonFileParsers[S]?this._BabylonFileParsers[S]:null},m.AddIndividualParser=function(S,h){this._IndividualBabylonFileParsers[S]=h},m.GetIndividualParser=function(S){return this._IndividualBabylonFileParsers[S]?this._IndividualBabylonFileParsers[S]:null},m.Parse=function(S,h,C,R){for(var I in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(I)&&this._BabylonFileParsers[I](S,h,C,R)},Object.defineProperty(m.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(S){this._environmentTexture=S},enumerable:!1,configurable:!0}),m.prototype.getNodes=function(){var S=new Array;return S=(S=(S=(S=S.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(h){return S=S.concat(h.bones)}),S},m._BabylonFileParsers={},m._IndividualBabylonFileParsers={},m}()},function(p,s,c){c.d(s,"a",function(){return b});var E=c(20),m=c(6),S=c(18),h=c(22),C=c(86),R=c(0),I=c(9),b=function(){function f(x,P){var A=this;P===void 0&&(P=!0),this.originalScene=x,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new m.c,this.utilityLayerScene=new E.a(x.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=x.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),P&&(this._originalPointerObserver=x.onPrePointerObservable.add(function(T,_){if(A.utilityLayerScene.activeCamera&&(A.processAllEvents||T.type===S.a.POINTERMOVE||T.type===S.a.POINTERUP||T.type===S.a.POINTERDOWN||T.type===S.a.POINTERDOUBLETAP)){A.utilityLayerScene.pointerX=x.pointerX,A.utilityLayerScene.pointerY=x.pointerY;var g=T.event;if(x.isPointerCaptured(g.pointerId))A._pointerCaptures[g.pointerId]=!1;else{var M=T.ray?A.utilityLayerScene.pickWithRay(T.ray):A.utilityLayerScene.pick(x.pointerX,x.pointerY);if(!T.ray&&M&&(T.ray=M.ray),A.utilityLayerScene.onPrePointerObservable.notifyObservers(T),A.onlyCheckPointerDownEvents&&T.type!=S.a.POINTERDOWN)return T.skipOnPointerObservable||A.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(T.type,T.event,M),T.type),void(T.type===S.a.POINTERUP&&A._pointerCaptures[g.pointerId]&&(A._pointerCaptures[g.pointerId]=!1));if(A.utilityLayerScene.autoClearDepthAndStencil||A.pickUtilitySceneFirst)M&&M.hit&&(T.skipOnPointerObservable||A.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(T.type,T.event,M),T.type),T.skipOnPointerObservable=!0);else{var O=T.ray?x.pickWithRay(T.ray):x.pick(x.pointerX,x.pointerY),N=T.event;O&&M&&(M.distance===0&&O.pickedMesh?A.mainSceneTrackerPredicate&&A.mainSceneTrackerPredicate(O.pickedMesh)?(A._notifyObservers(T,O,N),T.skipOnPointerObservable=!0):T.type===S.a.POINTERDOWN?A._pointerCaptures[N.pointerId]=!0:A._lastPointerEvents[N.pointerId]&&(A.onPointerOutObservable.notifyObservers(N.pointerId),delete A._lastPointerEvents[N.pointerId]):!A._pointerCaptures[N.pointerId]&&(M.distance<O.distance||O.distance===0)?(A._notifyObservers(T,M,N),T.skipOnPointerObservable||(T.skipOnPointerObservable=M.distance>0)):!A._pointerCaptures[N.pointerId]&&M.distance>O.distance&&(A.mainSceneTrackerPredicate&&A.mainSceneTrackerPredicate(O.pickedMesh)?(A._notifyObservers(T,O,N),T.skipOnPointerObservable=!0):A._lastPointerEvents[N.pointerId]&&(A.onPointerOutObservable.notifyObservers(N.pointerId),delete A._lastPointerEvents[N.pointerId])),T.type===S.a.POINTERUP&&A._pointerCaptures[N.pointerId]&&(A._pointerCaptures[N.pointerId]=!1))}}}}),this._originalPointerObserver&&x.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(T){A.shouldRender&&T==A.getRenderCamera()&&A.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){A.dispose()}),this._updateCamera()}return f.prototype.getRenderCamera=function(x){if(this._renderCamera)return this._renderCamera;var P=void 0;return P=this.originalScene.activeCameras&&this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,x&&P&&P.isRigCamera?P.rigParent:P},f.prototype.setRenderCamera=function(x){this._renderCamera=x},f.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new C.a("shared gizmo light",new R.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=I.a.Gray()),this._sharedGizmoLight},Object.defineProperty(f,"DefaultUtilityLayer",{get:function(){return f._DefaultUtilityLayer==null&&(f._DefaultUtilityLayer=new f(h.a.LastCreatedScene),f._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){f._DefaultUtilityLayer=null})),f._DefaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(f,"DefaultKeepDepthUtilityLayer",{get:function(){return f._DefaultKeepDepthUtilityLayer==null&&(f._DefaultKeepDepthUtilityLayer=new f(h.a.LastCreatedScene),f._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,f._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){f._DefaultKeepDepthUtilityLayer=null})),f._DefaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),f.prototype._notifyObservers=function(x,P,A){x.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new S.b(x.type,x.event,P),x.type),this._lastPointerEvents[A.pointerId]=!0)},f.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var x=this.utilityLayerScene.activeCamera.getScene(),P=this.utilityLayerScene.activeCamera;P._scene=this.utilityLayerScene,P.leftCamera&&(P.leftCamera._scene=this.utilityLayerScene),P.rightCamera&&(P.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),P._scene=x,P.leftCamera&&(P.leftCamera._scene=x),P.rightCamera&&(P.rightCamera._scene=x)}},f.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},f.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()},f._DefaultUtilityLayer=null,f._DefaultKeepDepthUtilityLayer=null,f}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(139),m=function(){function S(){}return S.EnableFor=function(h){h._tags=h._tags||{},h.hasTags=function(){return S.HasTags(h)},h.addTags=function(C){return S.AddTagsTo(h,C)},h.removeTags=function(C){return S.RemoveTagsFrom(h,C)},h.matchesTagsQuery=function(C){return S.MatchesQuery(h,C)}},S.DisableFor=function(h){delete h._tags,delete h.hasTags,delete h.addTags,delete h.removeTags,delete h.matchesTagsQuery},S.HasTags=function(h){if(!h._tags)return!1;var C=h._tags;for(var R in C)if(C.hasOwnProperty(R))return!0;return!1},S.GetTags=function(h,C){if(C===void 0&&(C=!0),!h._tags)return null;if(C){var R=[];for(var I in h._tags)h._tags.hasOwnProperty(I)&&h._tags[I]===!0&&R.push(I);return R.join(" ")}return h._tags},S.AddTagsTo=function(h,C){C&&typeof C=="string"&&C.split(" ").forEach(function(R,I,b){S._AddTagTo(h,R)})},S._AddTagTo=function(h,C){(C=C.trim())!==""&&C!=="true"&&C!=="false"&&(C.match(/[\s]/)||C.match(/^([!]|([|]|[&]){2})/)||(S.EnableFor(h),h._tags[C]=!0))},S.RemoveTagsFrom=function(h,C){if(S.HasTags(h)){var R=C.split(" ");for(var I in R)S._RemoveTagFrom(h,R[I])}},S._RemoveTagFrom=function(h,C){delete h._tags[C]},S.MatchesQuery=function(h,C){return C===void 0||(C===""?S.HasTags(h):E.a.Eval(C,function(R){return S.HasTags(h)&&h._tags[R]}))},S}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.IsWindowObjectExist=function(){return typeof window!="undefined"},m.IsNavigatorAvailable=function(){return typeof navigator!="undefined"},m.IsDocumentAvailable=function(){return typeof document!="undefined"},m.GetDOMTextContent=function(S){for(var h="",C=S.firstChild;C;)C.nodeType===3&&(h+=C.textContent),C=C.nextSibling;return h},m}()},function(p,s,c){c.d(s,"a",function(){return I});var E=c(44),m=c(0),S=c(54),h=c(114),C=c(20),R=c(24),I=function(){function b(f,x,P){P===void 0&&(P=Number.MAX_VALUE),this.origin=f,this.direction=x,this.length=P}return b.prototype.intersectsBoxMinMax=function(f,x,P){P===void 0&&(P=0);var A,T,_,g,M=b._TmpVector3[0].copyFromFloats(f.x-P,f.y-P,f.z-P),O=b._TmpVector3[1].copyFromFloats(x.x+P,x.y+P,x.z+P),N=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<M.x||this.origin.x>O.x)return!1}else if(A=1/this.direction.x,T=(M.x-this.origin.x)*A,(_=(O.x-this.origin.x)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<M.y||this.origin.y>O.y)return!1}else if(A=1/this.direction.y,T=(M.y-this.origin.y)*A,(_=(O.y-this.origin.y)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<M.z||this.origin.z>O.z)return!1}else if(A=1/this.direction.z,T=(M.z-this.origin.z)*A,(_=(O.z-this.origin.z)*A)==-1/0&&(_=1/0),T>_&&(g=T,T=_,_=g),(N=Math.max(T,N))>(V=Math.min(_,V)))return!1;return!0},b.prototype.intersectsBox=function(f,x){return x===void 0&&(x=0),this.intersectsBoxMinMax(f.minimum,f.maximum,x)},b.prototype.intersectsSphere=function(f,x){x===void 0&&(x=0);var P=f.center.x-this.origin.x,A=f.center.y-this.origin.y,T=f.center.z-this.origin.z,_=P*P+A*A+T*T,g=f.radius+x,M=g*g;if(_<=M)return!0;var O=P*this.direction.x+A*this.direction.y+T*this.direction.z;return!(O<0)&&_-O*O<=M},b.prototype.intersectsTriangle=function(f,x,P){var A=b._TmpVector3[0],T=b._TmpVector3[1],_=b._TmpVector3[2],g=b._TmpVector3[3],M=b._TmpVector3[4];x.subtractToRef(f,A),P.subtractToRef(f,T),m.e.CrossToRef(this.direction,T,_);var O=m.e.Dot(A,_);if(O===0)return null;var N=1/O;this.origin.subtractToRef(f,g);var V=m.e.Dot(g,_)*N;if(V<0||V>1)return null;m.e.CrossToRef(g,A,M);var U=m.e.Dot(this.direction,M)*N;if(U<0||V+U>1)return null;var L=m.e.Dot(T,M)*N;return L>this.length?null:new h.a(1-V-U,V,L)},b.prototype.intersectsPlane=function(f){var x,P=m.e.Dot(f.normal,this.direction);if(Math.abs(P)<999999997475243e-21)return null;var A=m.e.Dot(f.normal,this.origin);return(x=(-f.d-A)/P)<0?x<-999999997475243e-21?null:0:x},b.prototype.intersectsAxis=function(f,x){switch(x===void 0&&(x=0),f){case"y":return(P=(this.origin.y-x)/this.direction.y)>0?null:new m.e(this.origin.x+this.direction.x*-P,x,this.origin.z+this.direction.z*-P);case"x":return(P=(this.origin.x-x)/this.direction.x)>0?null:new m.e(x,this.origin.y+this.direction.y*-P,this.origin.z+this.direction.z*-P);case"z":var P;return(P=(this.origin.z-x)/this.direction.z)>0?null:new m.e(this.origin.x+this.direction.x*-P,this.origin.y+this.direction.y*-P,x);default:return null}},b.prototype.intersectsMesh=function(f,x){var P=m.c.Matrix[0];return f.getWorldMatrix().invertToRef(P),this._tmpRay?b.TransformToRef(this,P,this._tmpRay):this._tmpRay=b.Transform(this,P),f.intersects(this._tmpRay,x)},b.prototype.intersectsMeshes=function(f,x,P){P?P.length=0:P=[];for(var A=0;A<f.length;A++){var T=this.intersectsMesh(f[A],x);T.hit&&P.push(T)}return P.sort(this._comparePickingInfo),P},b.prototype._comparePickingInfo=function(f,x){return f.distance<x.distance?-1:f.distance>x.distance?1:0},b.prototype.intersectionSegment=function(f,x,P){var A=this.origin,T=m.c.Vector3[0],_=m.c.Vector3[1],g=m.c.Vector3[2],M=m.c.Vector3[3];x.subtractToRef(f,T),this.direction.scaleToRef(b.rayl,g),A.addToRef(g,_),f.subtractToRef(A,M);var O,N,V,U,L=m.e.Dot(T,T),j=m.e.Dot(T,g),Y=m.e.Dot(g,g),W=m.e.Dot(T,M),ie=m.e.Dot(g,M),re=L*Y-j*j,ye=re,ve=re;re<b.smallnum?(N=0,ye=1,U=ie,ve=Y):(U=L*ie-j*W,(N=j*ie-Y*W)<0?(N=0,U=ie,ve=Y):N>ye&&(N=ye,U=ie+j,ve=Y)),U<0?(U=0,-W<0?N=0:-W>L?N=ye:(N=-W,ye=L)):U>ve&&(U=ve,-W+j<0?N=0:-W+j>L?N=ye:(N=-W+j,ye=L)),O=Math.abs(N)<b.smallnum?0:N/ye,V=Math.abs(U)<b.smallnum?0:U/ve;var ue=m.c.Vector3[4];g.scaleToRef(V,ue);var oe=m.c.Vector3[5];T.scaleToRef(O,oe),oe.addInPlace(M);var Z=m.c.Vector3[6];return oe.subtractToRef(ue,Z),V>0&&V<=this.length&&Z.lengthSquared()<P*P?oe.length():-1},b.prototype.update=function(f,x,P,A,T,_,g){return this.unprojectRayToRef(f,x,P,A,T,_,g),this},b.Zero=function(){return new b(m.e.Zero(),m.e.Zero())},b.CreateNew=function(f,x,P,A,T,_,g){return b.Zero().update(f,x,P,A,T,_,g)},b.CreateNewFromTo=function(f,x,P){P===void 0&&(P=m.a.IdentityReadOnly);var A=x.subtract(f),T=Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z);return A.normalize(),b.Transform(new b(f,A,T),P)},b.Transform=function(f,x){var P=new b(new m.e(0,0,0),new m.e(0,0,0));return b.TransformToRef(f,x,P),P},b.TransformToRef=function(f,x,P){m.e.TransformCoordinatesToRef(f.origin,x,P.origin),m.e.TransformNormalToRef(f.direction,x,P.direction),P.length=f.length;var A=P.direction,T=A.length();if(T!==0&&T!==1){var _=1/T;A.x*=_,A.y*=_,A.z*=_,P.length*=T}},b.prototype.unprojectRayToRef=function(f,x,P,A,T,_,g){var M=m.c.Matrix[0];T.multiplyToRef(_,M),M.multiplyToRef(g,M),M.invert();var O=m.c.Vector3[0];O.x=f/P*2-1,O.y=-(x/A*2-1),O.z=-1;var N=m.c.Vector3[1].copyFromFloats(O.x,O.y,1),V=m.c.Vector3[2],U=m.c.Vector3[3];m.e._UnprojectFromInvertedMatrixToRef(O,M,V),m.e._UnprojectFromInvertedMatrixToRef(N,M,U),this.origin.copyFrom(V),U.subtractToRef(V,this.direction),this.direction.normalize()},b._TmpVector3=E.a.BuildArray(6,m.e.Zero),b.smallnum=1e-8,b.rayl=1e9,b}();C.a.prototype.createPickingRay=function(b,f,x,P,A){A===void 0&&(A=!1);var T=I.Zero();return this.createPickingRayToRef(b,f,x,T,P,A),T},C.a.prototype.createPickingRayToRef=function(b,f,x,P,A,T){T===void 0&&(T=!1);var _=this.getEngine();if(!A){if(!this.activeCamera)return this;A=this.activeCamera}var g=A.viewport.toGlobal(_.getRenderWidth(),_.getRenderHeight());return b=b/_.getHardwareScalingLevel()-g.x,f=f/_.getHardwareScalingLevel()-(_.getRenderHeight()-g.y-g.height),P.update(b,f,g.width,g.height,x||m.a.IdentityReadOnly,T?m.a.IdentityReadOnly:A.getViewMatrix(),A.getProjectionMatrix()),this},C.a.prototype.createPickingRayInCameraSpace=function(b,f,x){var P=I.Zero();return this.createPickingRayInCameraSpaceToRef(b,f,P,x),P},C.a.prototype.createPickingRayInCameraSpaceToRef=function(b,f,x,P){if(!S.a)return this;var A=this.getEngine();if(!P){if(!this.activeCamera)throw new Error("Active camera not set");P=this.activeCamera}var T=P.viewport.toGlobal(A.getRenderWidth(),A.getRenderHeight()),_=m.a.Identity();return b=b/A.getHardwareScalingLevel()-T.x,f=f/A.getHardwareScalingLevel()-(A.getRenderHeight()-T.y-T.height),x.update(b,f,T.width,T.height,_,_,P.getProjectionMatrix()),this},C.a.prototype._internalPickForMesh=function(b,f,x,P,A,T,_,g){var M=f(P),O=x.intersects(M,A,_,T,P,g);return O&&O.hit?!A&&b!=null&&O.distance>=b.distance?null:O:null},C.a.prototype._internalPick=function(b,f,x,P,A){if(!S.a)return null;for(var T=null,_=0;_<this.meshes.length;_++){var g=this.meshes[_];if(f){if(!f(g))continue}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;var M,O=g.skeleton&&g.skeleton.overrideMesh?g.skeleton.overrideMesh.getWorldMatrix():g.getWorldMatrix();if(g.hasThinInstances&&g.thinInstanceEnablePicking){if(M=this._internalPickForMesh(T,b,g,O,!0,!0,A)){if(P)return T;for(var N=m.c.Matrix[1],V=g.thinInstanceGetWorldMatrices(),U=0;U<V.length;U++){V[U].multiplyToRef(O,N);var L=this._internalPickForMesh(T,b,g,N,x,P,A,!0);if(L&&((T=L).thinInstanceIndex=U,x))return T}}}else if((M=this._internalPickForMesh(T,b,g,O,x,P,A))&&(T=M,x))return T}return T||new S.a},C.a.prototype._internalMultiPick=function(b,f,x){if(!S.a)return null;for(var P=new Array,A=0;A<this.meshes.length;A++){var T=this.meshes[A];if(f){if(!f(T))continue}else if(!T.isEnabled()||!T.isVisible||!T.isPickable)continue;var _,g=T.skeleton&&T.skeleton.overrideMesh?T.skeleton.overrideMesh.getWorldMatrix():T.getWorldMatrix();if(T.hasThinInstances&&T.thinInstanceEnablePicking){if(_=this._internalPickForMesh(null,b,T,g,!0,!0,x))for(var M=m.c.Matrix[1],O=T.thinInstanceGetWorldMatrices(),N=0;N<O.length;N++){O[N].multiplyToRef(g,M);var V=this._internalPickForMesh(null,b,T,M,!1,!1,x,!0);V&&(V.thinInstanceIndex=N,P.push(V))}}else(_=this._internalPickForMesh(null,b,T,g,!1,!1,x))&&P.push(_)}return P},C.a.prototype.pickWithBoundingInfo=function(b,f,x,P,A){var T=this;if(!S.a)return null;var _=this._internalPick(function(g){return T._tempPickingRay||(T._tempPickingRay=I.Zero()),T.createPickingRayToRef(b,f,g,T._tempPickingRay,A||null),T._tempPickingRay},x,P,!0);return _&&(_.ray=this.createPickingRay(b,f,m.a.Identity(),A||null)),_},C.a.prototype.pick=function(b,f,x,P,A,T){var _=this;if(!S.a)return null;var g=this._internalPick(function(M){return _._tempPickingRay||(_._tempPickingRay=I.Zero()),_.createPickingRayToRef(b,f,M,_._tempPickingRay,A||null),_._tempPickingRay},x,P,!1,T);return g&&(g.ray=this.createPickingRay(b,f,m.a.Identity(),A||null)),g},C.a.prototype.pickWithRay=function(b,f,x,P){var A=this,T=this._internalPick(function(_){return A._pickWithRayInverseMatrix||(A._pickWithRayInverseMatrix=m.a.Identity()),_.invertToRef(A._pickWithRayInverseMatrix),A._cachedRayForTransform||(A._cachedRayForTransform=I.Zero()),I.TransformToRef(b,A._pickWithRayInverseMatrix,A._cachedRayForTransform),A._cachedRayForTransform},f,x,!1,P);return T&&(T.ray=b),T},C.a.prototype.multiPick=function(b,f,x,P,A){var T=this;return this._internalMultiPick(function(_){return T.createPickingRay(b,f,_,P||null)},x,A)},C.a.prototype.multiPickWithRay=function(b,f,x){var P=this;return this._internalMultiPick(function(A){return P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=m.a.Identity()),A.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=I.Zero()),I.TransformToRef(b,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform},f,x)},R.a.prototype.getForwardRay=function(b,f,x){return b===void 0&&(b=100),this.getForwardRayToRef(new I(m.e.Zero(),m.e.Zero(),b),b,f,x)},R.a.prototype.getForwardRayToRef=function(b,f,x,P){return f===void 0&&(f=100),x||(x=this.getWorldMatrix()),b.length=f,P?b.origin.copyFrom(P):b.origin.copyFrom(this.position),m.c.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),m.e.TransformNormalToRef(m.c.Vector3[2],x,m.c.Vector3[3]),m.e.NormalizeToRef(m.c.Vector3[3],b.direction),b}},function(p,s,c){c.d(s,"a",function(){return R});var E=c(0),m=c(7),S=c(16),h=c(98),C=c(4);S.a.CreateLineSystem=function(I){for(var b=[],f=[],x=I.lines,P=I.colors,A=[],T=0,_=0;_<x.length;_++)for(var g=x[_],M=0;M<g.length;M++){if(f.push(g[M].x,g[M].y,g[M].z),P){var O=P[_];A.push(O[M].r,O[M].g,O[M].b,O[M].a)}M>0&&(b.push(T-1),b.push(T)),T++}var N=new S.a;return N.indices=b,N.positions=f,P&&(N.colors=A),N},S.a.CreateDashedLines=function(I){var b,f,x=I.dashSize||3,P=I.gapSize||1,A=I.dashNb||200,T=I.points,_=new Array,g=new Array,M=E.e.Zero(),O=0,N=0,V=0,U=0,L=0;for(L=0;L<T.length-1;L++)T[L+1].subtractToRef(T[L],M),O+=M.length();for(f=x*(b=O/A)/(x+P),L=0;L<T.length-1;L++){T[L+1].subtractToRef(T[L],M),N=Math.floor(M.length()/b),M.normalize();for(var j=0;j<N;j++)V=b*j,_.push(T[L].x+V*M.x,T[L].y+V*M.y,T[L].z+V*M.z),_.push(T[L].x+(V+f)*M.x,T[L].y+(V+f)*M.y,T[L].z+(V+f)*M.z),g.push(U,U+1),U+=2}var Y=new S.a;return Y.positions=_,Y.indices=g,Y},m.a.CreateLines=function(I,b,f,x,P){f===void 0&&(f=null),x===void 0&&(x=!1),P===void 0&&(P=null);var A={points:b,updatable:x,instance:P};return R.CreateLines(I,A,f)},m.a.CreateDashedLines=function(I,b,f,x,P,A,T,_){A===void 0&&(A=null);var g={points:b,dashSize:f,gapSize:x,dashNb:P,updatable:T,instance:_};return R.CreateDashedLines(I,g,A)};var R=function(){function I(){}return I.CreateLineSystem=function(b,f,x){var P=f.instance,A=f.lines,T=f.colors;if(P){var _,g,M=P.getVerticesData(C.b.PositionKind);T&&(_=P.getVerticesData(C.b.ColorKind));for(var O=0,N=0,V=0;V<A.length;V++)for(var U=A[V],L=0;L<U.length;L++)M[O]=U[L].x,M[O+1]=U[L].y,M[O+2]=U[L].z,T&&_&&(g=T[V],_[N]=g[L].r,_[N+1]=g[L].g,_[N+2]=g[L].b,_[N+3]=g[L].a,N+=4),O+=3;return P.updateVerticesData(C.b.PositionKind,M,!1,!1),T&&_&&P.updateVerticesData(C.b.ColorKind,_,!1,!1),P}var j=!!T,Y=new h.b(b,x,null,void 0,void 0,j,f.useVertexAlpha);return S.a.CreateLineSystem(f).applyToMesh(Y,f.updatable),Y},I.CreateLines=function(b,f,x){x===void 0&&(x=null);var P=f.colors?[f.colors]:null;return I.CreateLineSystem(b,{lines:[f.points],updatable:f.updatable,instance:f.instance,colors:P,useVertexAlpha:f.useVertexAlpha},x)},I.CreateDashedLines=function(b,f,x){x===void 0&&(x=null);var P=f.points,A=f.instance,T=f.gapSize||1,_=f.dashSize||3;if(A)return A.updateMeshPositions(function(M){var O,N,V=E.e.Zero(),U=M.length/6,L=0,j=0,Y=0,W=0,ie=0,re=0;for(ie=0;ie<P.length-1;ie++)P[ie+1].subtractToRef(P[ie],V),L+=V.length();O=L/U;var ye=A._creationDataStorage.dashSize;for(N=ye*O/(ye+A._creationDataStorage.gapSize),ie=0;ie<P.length-1;ie++)for(P[ie+1].subtractToRef(P[ie],V),j=Math.floor(V.length()/O),V.normalize(),re=0;re<j&&W<M.length;)Y=O*re,M[W]=P[ie].x+Y*V.x,M[W+1]=P[ie].y+Y*V.y,M[W+2]=P[ie].z+Y*V.z,M[W+3]=P[ie].x+(Y+N)*V.x,M[W+4]=P[ie].y+(Y+N)*V.y,M[W+5]=P[ie].z+(Y+N)*V.z,W+=6,re++;for(;W<M.length;)M[W]=P[ie].x,M[W+1]=P[ie].y,M[W+2]=P[ie].z,W+=3},!1),A;var g=new h.b(b,x,null,void 0,void 0,void 0,f.useVertexAlpha);return S.a.CreateDashedLines(f).applyToMesh(g,f.updatable),g._creationDataStorage=new m.b,g._creationDataStorage.dashSize=_,g._creationDataStorage.gapSize=T,g},I}()},function(p,s,c){c.d(s,"a",function(){return h});var E=c(34),m=c(8),S=function(C,R){return C?C.getClassName&&C.getClassName()==="Mesh"?null:C.getClassName&&C.getClassName()==="SubMesh"?C.clone(R):C.clone?C.clone():null:null},h=function(){function C(){}return C.DeepCopy=function(R,I,b,f){for(var x=0,P=function(O){var N=[];do Object.getOwnPropertyNames(O).forEach(function(V){N.indexOf(V)===-1&&N.push(V)});while(O=Object.getPrototypeOf(O));return N}(R);x<P.length;x++){var A=P[x];if((A[0]!=="_"||f&&f.indexOf(A)!==-1)&&!(E.a.EndsWith(A,"Observable")||b&&b.indexOf(A)!==-1)){var T=R[A],_=typeof T;if(_!=="function")try{if(_==="object")if(T instanceof Array){if(I[A]=[],T.length>0)if(typeof T[0]=="object")for(var g=0;g<T.length;g++){var M=S(T[g],I);I[A].indexOf(M)===-1&&I[A].push(M)}else I[A]=T.slice(0)}else I[A]=S(T,I);else I[A]=T}catch(O){m.a.Warn(O.message)}}}},C}()},function(p,s,c){c.d(s,"b",function(){return b}),c.d(s,"a",function(){return f});var E=c(1),m=c(3),S=c(6),h=c(12),C=c(9),R=c(76),I=c(121),b=function(x){function P(){var A=x.call(this)||this;return A.IMAGEPROCESSING=!1,A.VIGNETTE=!1,A.VIGNETTEBLENDMODEMULTIPLY=!1,A.VIGNETTEBLENDMODEOPAQUE=!1,A.TONEMAPPING=!1,A.TONEMAPPING_ACES=!1,A.CONTRAST=!1,A.COLORCURVES=!1,A.COLORGRADING=!1,A.COLORGRADING3D=!1,A.SAMPLER3DGREENDEPTH=!1,A.SAMPLER3DBGRMAP=!1,A.IMAGEPROCESSINGPOSTPROCESS=!1,A.EXPOSURE=!1,A.rebuild(),A}return Object(E.d)(P,x),P}(R.a),f=function(){function x(){this.colorCurves=new I.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=x.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new C.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=x.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new S.c}return Object.defineProperty(x.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(P){this._colorCurvesEnabled!==P&&(this._colorCurvesEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(P){this._colorGradingTexture!==P&&(this._colorGradingTexture=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(P){this._colorGradingEnabled!==P&&(this._colorGradingEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(P){this._colorGradingWithGreenDepth!==P&&(this._colorGradingWithGreenDepth=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(P){this._colorGradingBGR!==P&&(this._colorGradingBGR=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"exposure",{get:function(){return this._exposure},set:function(P){this._exposure!==P&&(this._exposure=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(P){this._toneMappingEnabled!==P&&(this._toneMappingEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(P){this._toneMappingType!==P&&(this._toneMappingType=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"contrast",{get:function(){return this._contrast},set:function(P){this._contrast!==P&&(this._contrast=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(P){this._vignetteBlendMode!==P&&(this._vignetteBlendMode=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(P){this._vignetteEnabled!==P&&(this._vignetteEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(P){this._applyByPostProcess!==P&&(this._applyByPostProcess=P,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(P){this._isEnabled!==P&&(this._isEnabled=P,this._updateParameters())},enumerable:!1,configurable:!0}),x.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},x.prototype.getClassName=function(){return"ImageProcessingConfiguration"},x.PrepareUniforms=function(P,A){A.EXPOSURE&&P.push("exposureLinear"),A.CONTRAST&&P.push("contrast"),A.COLORGRADING&&P.push("colorTransformSettings"),A.VIGNETTE&&(P.push("vInverseScreenSize"),P.push("vignetteSettings1"),P.push("vignetteSettings2")),A.COLORCURVES&&I.a.PrepareUniforms(P)},x.PrepareSamplers=function(P,A){A.COLORGRADING&&P.push("txColorTransform")},x.prototype.prepareDefines=function(P,A){if(A===void 0&&(A=!1),A!==this.applyByPostProcess||!this._isEnabled)return P.VIGNETTE=!1,P.TONEMAPPING=!1,P.TONEMAPPING_ACES=!1,P.CONTRAST=!1,P.EXPOSURE=!1,P.COLORCURVES=!1,P.COLORGRADING=!1,P.COLORGRADING3D=!1,P.IMAGEPROCESSING=!1,void(P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(P.VIGNETTE=this.vignetteEnabled,P.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===x._VIGNETTEMODE_MULTIPLY,P.VIGNETTEBLENDMODEOPAQUE=!P.VIGNETTEBLENDMODEMULTIPLY,P.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case x.TONEMAPPING_ACES:P.TONEMAPPING_ACES=!0;break;default:P.TONEMAPPING_ACES=!1}P.CONTRAST=this.contrast!==1,P.EXPOSURE=this.exposure!==1,P.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,P.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,P.COLORGRADING?P.COLORGRADING3D=this.colorGradingTexture.is3D:P.COLORGRADING3D=!1,P.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,P.SAMPLER3DBGRMAP=this.colorGradingBGR,P.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,P.IMAGEPROCESSING=P.VIGNETTE||P.TONEMAPPING||P.CONTRAST||P.EXPOSURE||P.COLORCURVES||P.COLORGRADING},x.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},x.prototype.bind=function(P,A){if(this._colorCurvesEnabled&&this.colorCurves&&I.a.Bind(this.colorCurves,P),this._vignetteEnabled){var T=1/P.getEngine().getRenderWidth(),_=1/P.getEngine().getRenderHeight();P.setFloat2("vInverseScreenSize",T,_);var g=A??_/T,M=Math.tan(.5*this.vignetteCameraFov),O=M*g,N=Math.sqrt(O*M);O=h.b.Mix(O,N,this.vignetteStretch),M=h.b.Mix(M,N,this.vignetteStretch),P.setFloat4("vignetteSettings1",O,M,-O*this.vignetteCentreX,-M*this.vignetteCentreY);var V=-2*this.vignetteWeight;P.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,V)}if(P.setFloat("exposureLinear",this.exposure),P.setFloat("contrast",this.contrast),this.colorGradingTexture){P.setTexture("txColorTransform",this.colorGradingTexture);var U=this.colorGradingTexture.getSize().height;P.setFloat4("colorTransformSettings",(U-1)/U,.5/U,U,this.colorGradingTexture.level)}},x.prototype.clone=function(){return m.a.Clone(function(){return new x},this)},x.prototype.serialize=function(){return m.a.Serialize(this)},x.Parse=function(P){return m.a.Parse(function(){return new x},P,null,null)},Object.defineProperty(x,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(x,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),x.TONEMAPPING_STANDARD=0,x.TONEMAPPING_ACES=1,x._VIGNETTEMODE_MULTIPLY=0,x._VIGNETTEMODE_OPAQUE=1,Object(E.c)([Object(m.g)()],x.prototype,"colorCurves",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorCurvesEnabled",void 0),Object(E.c)([Object(m.m)("colorGradingTexture")],x.prototype,"_colorGradingTexture",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingWithGreenDepth",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_colorGradingBGR",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_exposure",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_toneMappingEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_toneMappingType",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_contrast",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteStretch",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCentreX",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCentreY",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteWeight",void 0),Object(E.c)([Object(m.f)()],x.prototype,"vignetteColor",void 0),Object(E.c)([Object(m.c)()],x.prototype,"vignetteCameraFov",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_vignetteBlendMode",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_vignetteEnabled",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_applyByPostProcess",void 0),Object(E.c)([Object(m.c)()],x.prototype,"_isEnabled",void 0),x}();m.a._ImageProcessingConfigurationParser=f.Parse},function(p,s,c){c.d(s,"a",function(){return x});var E=c(44),m=c(0),S=c(2),h=c(103),C=c(113),R={min:0,max:0},I={min:0,max:0},b=function(P,A,T){var _=m.e.Dot(A.centerWorld,P),g=Math.abs(m.e.Dot(A.directions[0],P))*A.extendSize.x+Math.abs(m.e.Dot(A.directions[1],P))*A.extendSize.y+Math.abs(m.e.Dot(A.directions[2],P))*A.extendSize.z;T.min=_-g,T.max=_+g},f=function(P,A,T){return b(P,A,R),b(P,T,I),!(R.min>I.max||I.min>R.max)},x=function(){function P(A,T,_){this._isLocked=!1,this.boundingBox=new h.a(A,T,_),this.boundingSphere=new C.a(A,T,_)}return P.prototype.reConstruct=function(A,T,_){this.boundingBox.reConstruct(A,T,_),this.boundingSphere.reConstruct(A,T,_)},Object.defineProperty(P.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isLocked",{get:function(){return this._isLocked},set:function(A){this._isLocked=A},enumerable:!1,configurable:!0}),P.prototype.update=function(A){this._isLocked||(this.boundingBox._update(A),this.boundingSphere._update(A))},P.prototype.centerOn=function(A,T){var _=P.TmpVector3[0].copyFrom(A).subtractInPlace(T),g=P.TmpVector3[1].copyFrom(A).addInPlace(T);return this.boundingBox.reConstruct(_,g,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(_,g,this.boundingBox.getWorldMatrix()),this},P.prototype.scale=function(A){return this.boundingBox.scale(A),this.boundingSphere.scale(A),this},P.prototype.isInFrustum=function(A,T){return T===void 0&&(T=S.a.MESHES_CULLINGSTRATEGY_STANDARD),!(T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(A))||!!this.boundingSphere.isInFrustum(A)&&(!(T!==S.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&T!==S.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(A))},Object.defineProperty(P.prototype,"diagonalLength",{get:function(){var A=this.boundingBox;return A.maximumWorld.subtractToRef(A.minimumWorld,P.TmpVector3[0]).length()},enumerable:!1,configurable:!0}),P.prototype.isCompletelyInFrustum=function(A){return this.boundingBox.isCompletelyInFrustum(A)},P.prototype._checkCollision=function(A){return A._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},P.prototype.intersectsPoint=function(A){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(A)&&!!this.boundingBox.intersectsPoint(A)},P.prototype.intersects=function(A,T){if(!C.a.Intersects(this.boundingSphere,A.boundingSphere)||!h.a.Intersects(this.boundingBox,A.boundingBox))return!1;if(!T)return!0;var _=this.boundingBox,g=A.boundingBox;return!!f(_.directions[0],_,g)&&!!f(_.directions[1],_,g)&&!!f(_.directions[2],_,g)&&!!f(g.directions[0],_,g)&&!!f(g.directions[1],_,g)&&!!f(g.directions[2],_,g)&&!!f(m.e.Cross(_.directions[0],g.directions[0]),_,g)&&!!f(m.e.Cross(_.directions[0],g.directions[1]),_,g)&&!!f(m.e.Cross(_.directions[0],g.directions[2]),_,g)&&!!f(m.e.Cross(_.directions[1],g.directions[0]),_,g)&&!!f(m.e.Cross(_.directions[1],g.directions[1]),_,g)&&!!f(m.e.Cross(_.directions[1],g.directions[2]),_,g)&&!!f(m.e.Cross(_.directions[2],g.directions[0]),_,g)&&!!f(m.e.Cross(_.directions[2],g.directions[1]),_,g)&&!!f(m.e.Cross(_.directions[2],g.directions[2]),_,g)},P.TmpVector3=E.a.BuildArray(2,m.e.Zero),P}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.BuildArray=function(S,h){for(var C=[],R=0;R<S;++R)C.push(h());return C},m}()},function(p,s,c){c.d(s,"a",function(){return h});var E=c(0),m=c(7),S=c(16);S.a.CreateSphere=function(C){for(var R=C.segments||32,I=C.diameterX||C.diameter||1,b=C.diameterY||C.diameter||1,f=C.diameterZ||C.diameter||1,x=C.arc&&(C.arc<=0||C.arc>1)?1:C.arc||1,P=C.slice&&C.slice<=0?1:C.slice||1,A=C.sideOrientation===0?0:C.sideOrientation||S.a.DEFAULTSIDE,T=!!C.dedupTopBottomIndices,_=new E.e(I/2,b/2,f/2),g=2+R,M=2*g,O=[],N=[],V=[],U=[],L=0;L<=g;L++){for(var j=L/g,Y=j*Math.PI*P,W=0;W<=M;W++){var ie=W/M,re=ie*Math.PI*2*x,ye=E.a.RotationZ(-Y),ve=E.a.RotationY(re),ue=E.e.TransformCoordinates(E.e.Up(),ye),oe=E.e.TransformCoordinates(ue,ve),Z=oe.multiply(_),J=oe.divide(_).normalize();N.push(Z.x,Z.y,Z.z),V.push(J.x,J.y,J.z),U.push(ie,j)}if(L>0)for(var B=N.length/3,G=B-2*(M+1);G+M+2<B;G++)T?(L>1&&(O.push(G),O.push(G+1),O.push(G+M+1)),(L<g||P<1)&&(O.push(G+M+1),O.push(G+1),O.push(G+M+2))):(O.push(G),O.push(G+1),O.push(G+M+1),O.push(G+M+1),O.push(G+1),O.push(G+M+2))}S.a._ComputeSides(A,N,O,V,U,C.frontUVs,C.backUVs);var $=new S.a;return $.indices=O,$.positions=N,$.normals=V,$.uvs=U,$},m.a.CreateSphere=function(C,R,I,b,f,x){var P={segments:R,diameterX:I,diameterY:I,diameterZ:I,sideOrientation:x,updatable:f};return h.CreateSphere(C,P,b)};var h=function(){function C(){}return C.CreateSphere=function(R,I,b){b===void 0&&(b=null);var f=new m.a(R,b);return I.sideOrientation=m.a._GetDefaultSideOrientation(I.sideOrientation),f._originalBuilderSideOrientation=I.sideOrientation,S.a.CreateSphere(I).applyToMesh(f,I.updatable),f},C}()},function(p,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(3),S=c(6),h=c(0),C=c(29),R=c(23),I=function(b){function f(x,P,A){P===void 0&&(P=null),A===void 0&&(A=!0);var T=b.call(this,x,P)||this;return T._forward=new h.e(0,0,1),T._forwardInverted=new h.e(0,0,-1),T._up=new h.e(0,1,0),T._right=new h.e(1,0,0),T._rightInverted=new h.e(-1,0,0),T._position=h.e.Zero(),T._rotation=h.e.Zero(),T._rotationQuaternion=null,T._scaling=h.e.One(),T._isDirty=!1,T._transformToBoneReferal=null,T._isAbsoluteSynced=!1,T._billboardMode=f.BILLBOARDMODE_NONE,T._preserveParentRotationForBillboard=!1,T.scalingDeterminant=1,T._infiniteDistance=!1,T.ignoreNonUniformScaling=!1,T.reIntegrateRotationIntoRotationQuaternion=!1,T._poseMatrix=null,T._localMatrix=h.a.Zero(),T._usePivotMatrix=!1,T._absolutePosition=h.e.Zero(),T._absoluteScaling=h.e.Zero(),T._absoluteRotationQuaternion=h.b.Identity(),T._pivotMatrix=h.a.Identity(),T._postMultiplyPivotMatrix=!1,T._isWorldMatrixFrozen=!1,T._indexInSceneTransformNodesArray=-1,T.onAfterWorldMatrixUpdateObservable=new S.c,T._nonUniformScaling=!1,A&&T.getScene().addTransformNode(T),T}return Object(E.d)(f,b),Object.defineProperty(f.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(x){this._billboardMode!==x&&(this._billboardMode=x)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(x){x!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=x)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(x){this._infiniteDistance!==x&&(this._infiniteDistance=x)},enumerable:!1,configurable:!0}),f.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(f.prototype,"position",{get:function(){return this._position},set:function(x){this._position=x,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"rotation",{get:function(){return this._rotation},set:function(x){this._rotation=x,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"scaling",{get:function(){return this._scaling},set:function(x){this._scaling=x,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(x){this._rotationQuaternion=x,x&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"forward",{get:function(){return h.e.Normalize(h.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"up",{get:function(){return h.e.Normalize(h.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"right",{get:function(){return h.e.Normalize(h.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),f.prototype.updatePoseMatrix=function(x){return this._poseMatrix?(this._poseMatrix.copyFrom(x),this):(this._poseMatrix=x.clone(),this)},f.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=h.a.Identity()),this._poseMatrix},f.prototype._isSynchronized=function(){var x=this._cache;return this.billboardMode===x.billboardMode&&this.billboardMode===f.BILLBOARDMODE_NONE&&!x.pivotMatrixUpdated&&!this.infiniteDistance&&!this.position._isDirty&&!this.scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},f.prototype._initCache=function(){b.prototype._initCache.call(this);var x=this._cache;x.localMatrixUpdated=!1,x.billboardMode=-1,x.infiniteDistance=!1},f.prototype.markAsDirty=function(x){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(f.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),f.prototype.setPreTransformMatrix=function(x){return this.setPivotMatrix(x,!1)},f.prototype.setPivotMatrix=function(x,P){return P===void 0&&(P=!0),this._pivotMatrix.copyFrom(x),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=P,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=h.a.Invert(this._pivotMatrix)),this},f.prototype.getPivotMatrix=function(){return this._pivotMatrix},f.prototype.instantiateHierarchy=function(x,P,A){x===void 0&&(x=null);var T=this.clone("Clone of "+(this.name||this.id),x||this.parent,!0);T&&A&&A(this,T);for(var _=0,g=this.getChildTransformNodes(!0);_<g.length;_++)g[_].instantiateHierarchy(T,P,A);return T},f.prototype.freezeWorldMatrix=function(x){return x===void 0&&(x=null),x?this._worldMatrix=x:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},f.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(f.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),f.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},f.prototype.setAbsolutePosition=function(x){if(!x)return this;var P,A,T;if(x.x===void 0){if(arguments.length<3)return this;P=arguments[0],A=arguments[1],T=arguments[2]}else P=x.x,A=x.y,T=x.z;if(this.parent){var _=h.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(_),h.e.TransformCoordinatesFromFloatsToRef(P,A,T,_,this.position)}else this.position.x=P,this.position.y=A,this.position.z=T;return this._absolutePosition.copyFrom(x),this},f.prototype.setPositionWithLocalVector=function(x){return this.computeWorldMatrix(),this.position=h.e.TransformNormal(x,this._localMatrix),this},f.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var x=h.c.Matrix[0];return this._localMatrix.invertToRef(x),h.e.TransformNormal(this.position,x)},f.prototype.locallyTranslate=function(x){return this.computeWorldMatrix(!0),this.position=h.e.TransformCoordinates(x,this._localMatrix),this},f.prototype.lookAt=function(x,P,A,T,_){P===void 0&&(P=0),A===void 0&&(A=0),T===void 0&&(T=0),_===void 0&&(_=R.c.LOCAL);var g=f._lookAtVectorCache,M=_===R.c.LOCAL?this.position:this.getAbsolutePosition();if(x.subtractToRef(M,g),this.setDirection(g,P,A,T),_===R.c.WORLD&&this.parent)if(this.rotationQuaternion){var O=h.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(O);var N=h.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),O.multiplyToRef(N,O),this.rotationQuaternion.fromRotationMatrix(O)}else{var V=h.c.Quaternion[0];h.b.FromEulerVectorToRef(this.rotation,V),O=h.c.Matrix[0],V.toRotationMatrix(O),N=h.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),O.multiplyToRef(N,O),V.fromRotationMatrix(O),V.toEulerAnglesToRef(this.rotation)}return this},f.prototype.getDirection=function(x){var P=h.e.Zero();return this.getDirectionToRef(x,P),P},f.prototype.getDirectionToRef=function(x,P){return h.e.TransformNormalToRef(x,this.getWorldMatrix(),P),this},f.prototype.setDirection=function(x,P,A,T){P===void 0&&(P=0),A===void 0&&(A=0),T===void 0&&(T=0);var _=-Math.atan2(x.z,x.x)+Math.PI/2,g=Math.sqrt(x.x*x.x+x.z*x.z),M=-Math.atan2(x.y,g);return this.rotationQuaternion?h.b.RotationYawPitchRollToRef(_+P,M+A,T,this.rotationQuaternion):(this.rotation.x=M+A,this.rotation.y=_+P,this.rotation.z=T),this},f.prototype.setPivotPoint=function(x,P){P===void 0&&(P=R.c.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var A=this.getWorldMatrix();if(P==R.c.WORLD){var T=h.c.Matrix[0];A.invertToRef(T),x=h.e.TransformCoordinates(x,T)}return this.setPivotMatrix(h.a.Translation(-x.x,-x.y,-x.z),!0)},f.prototype.getPivotPoint=function(){var x=h.e.Zero();return this.getPivotPointToRef(x),x},f.prototype.getPivotPointToRef=function(x){return x.x=-this._pivotMatrix.m[12],x.y=-this._pivotMatrix.m[13],x.z=-this._pivotMatrix.m[14],this},f.prototype.getAbsolutePivotPoint=function(){var x=h.e.Zero();return this.getAbsolutePivotPointToRef(x),x},f.prototype.getAbsolutePivotPointToRef=function(x){return this.getPivotPointToRef(x),h.e.TransformCoordinatesToRef(x,this.getWorldMatrix(),x),this},f.prototype.setParent=function(x){if(!x&&!this.parent)return this;var P=h.c.Quaternion[0],A=h.c.Vector3[0],T=h.c.Vector3[1];if(x){var _=h.c.Matrix[0],g=h.c.Matrix[1];this.computeWorldMatrix(!0),x.computeWorldMatrix(!0),x.getWorldMatrix().invertToRef(g),this.getWorldMatrix().multiplyToRef(g,_),_.decompose(T,P,A)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(T,P,A);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(P):P.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(T),this.position.copyFrom(A),this.parent=x,this},Object.defineProperty(f.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),f.prototype._updateNonUniformScalingState=function(x){return this._nonUniformScaling!==x&&(this._nonUniformScaling=x,!0)},f.prototype.attachToBone=function(x,P){return this._transformToBoneReferal=P,this.parent=x,x.getSkeleton().prepare(),x.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},f.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},f.prototype.rotate=function(x,P,A){var T;if(x.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),A&&A!==R.c.LOCAL){if(this.parent){var _=h.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(_),x=h.e.TransformNormal(x,_)}(T=h.b.RotationAxisToRef(x,P,f._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else T=h.b.RotationAxisToRef(x,P,f._rotationAxisCache),this.rotationQuaternion.multiplyToRef(T,this.rotationQuaternion);return this},f.prototype.rotateAround=function(x,P,A){P.normalize(),this.rotationQuaternion||(this.rotationQuaternion=h.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var T=h.c.Vector3[0],_=h.c.Vector3[1],g=h.c.Vector3[2],M=h.c.Quaternion[0],O=h.c.Matrix[0],N=h.c.Matrix[1],V=h.c.Matrix[2],U=h.c.Matrix[3];return x.subtractToRef(this.position,T),h.a.TranslationToRef(T.x,T.y,T.z,O),h.a.TranslationToRef(-T.x,-T.y,-T.z,N),h.a.RotationAxisToRef(P,A,V),N.multiplyToRef(V,U),U.multiplyToRef(O,U),U.decompose(_,M,g),this.position.addInPlace(g),M.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},f.prototype.translate=function(x,P,A){var T=x.scale(P);if(A&&A!==R.c.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(T));else{var _=this.getPositionExpressedInLocalSpace().add(T);this.setPositionWithLocalVector(_)}return this},f.prototype.addRotation=function(x,P,A){var T;this.rotationQuaternion?T=this.rotationQuaternion:(T=h.c.Quaternion[1],h.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,T));var _=h.c.Quaternion[0];return h.b.RotationYawPitchRollToRef(P,x,A,_),T.multiplyInPlace(_),this.rotationQuaternion||T.toEulerAnglesToRef(this.rotation),this},f.prototype._getEffectiveParent=function(){return this.parent},f.prototype.computeWorldMatrix=function(x){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var P=this.getScene().getRenderId();if(!this._isDirty&&!x&&this.isSynchronized())return this._currentRenderId=P,this._worldMatrix;var A=this.getScene().activeCamera,T=(this._billboardMode&f.BILLBOARDMODE_USE_POSITION)!=0,_=this._billboardMode!==f.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;_&&A&&T&&(this.lookAt(A.position),(this.billboardMode&f.BILLBOARDMODE_X)!==f.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&f.BILLBOARDMODE_Y)!==f.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&f.BILLBOARDMODE_Z)!==f.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var g=this._cache;g.pivotMatrixUpdated=!1,g.billboardMode=this.billboardMode,g.infiniteDistance=this.infiniteDistance,this._currentRenderId=P,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var M,O=this._getEffectiveParent(),N=f._TmpScaling,V=this._position;if(this._infiniteDistance&&!this.parent&&A){var U=A.getWorldMatrix(),L=new h.e(U.m[12],U.m[13],U.m[14]);(V=f._TmpTranslation).copyFromFloats(this._position.x+L.x,this._position.y+L.y,this._position.z+L.z)}if(N.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,M=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(h.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(M=f._TmpRotation,h.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,M)),this._usePivotMatrix){var j=h.c.Matrix[1];h.a.ScalingToRef(N.x,N.y,N.z,j);var Y=h.c.Matrix[0];M.toRotationMatrix(Y),this._pivotMatrix.multiplyToRef(j,h.c.Matrix[4]),h.c.Matrix[4].multiplyToRef(Y,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(V.x,V.y,V.z)}else h.a.ComposeToRef(N,M,V,this._localMatrix);if(O&&O.getWorldMatrix){if(x&&O.computeWorldMatrix(),_){this._transformToBoneReferal?O.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),h.c.Matrix[7]):h.c.Matrix[7].copyFrom(O.getWorldMatrix());var W=h.c.Vector3[5],ie=h.c.Vector3[6];h.c.Matrix[7].decompose(ie,void 0,W),h.a.ScalingToRef(ie.x,ie.y,ie.z,h.c.Matrix[7]),h.c.Matrix[7].setTranslation(W),this._localMatrix.multiplyToRef(h.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(O.getWorldMatrix(),h.c.Matrix[6]),h.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(O.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(_&&A&&this.billboardMode&&!T){var re=h.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(re),h.c.Matrix[1].copyFrom(A.getViewMatrix()),h.c.Matrix[1].setTranslationFromFloats(0,0,0),h.c.Matrix[1].invertToRef(h.c.Matrix[0]),(this.billboardMode&f.BILLBOARDMODE_ALL)!==f.BILLBOARDMODE_ALL){h.c.Matrix[0].decompose(void 0,h.c.Quaternion[0],void 0);var ye=h.c.Vector3[1];h.c.Quaternion[0].toEulerAnglesToRef(ye),(this.billboardMode&f.BILLBOARDMODE_X)!==f.BILLBOARDMODE_X&&(ye.x=0),(this.billboardMode&f.BILLBOARDMODE_Y)!==f.BILLBOARDMODE_Y&&(ye.y=0),(this.billboardMode&f.BILLBOARDMODE_Z)!==f.BILLBOARDMODE_Z&&(ye.z=0),h.a.RotationYawPitchRollToRef(ye.y,ye.x,ye.z,h.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(h.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(h.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):O&&O._nonUniformScaling?this._updateNonUniformScalingState(O._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=h.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},f.prototype.resetLocalMatrix=function(x){if(x===void 0&&(x=!0),this.computeWorldMatrix(),x)for(var P=this.getChildren(),A=0;A<P.length;++A){var T=P[A];if(T){T.computeWorldMatrix();var _=h.c.Matrix[0];T._localMatrix.multiplyToRef(this._localMatrix,_);var g=h.c.Quaternion[0];_.decompose(T.scaling,g,T.position),T.rotationQuaternion?T.rotationQuaternion=g:g.toEulerAnglesToRef(T.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=h.b.Identity()),this._worldMatrix=h.a.Identity()},f.prototype._afterComputeWorldMatrix=function(){},f.prototype.registerAfterWorldMatrixUpdate=function(x){return this.onAfterWorldMatrixUpdateObservable.add(x),this},f.prototype.unregisterAfterWorldMatrixUpdate=function(x){return this.onAfterWorldMatrixUpdateObservable.removeCallback(x),this},f.prototype.getPositionInCameraSpace=function(x){return x===void 0&&(x=null),x||(x=this.getScene().activeCamera),h.e.TransformCoordinates(this.getAbsolutePosition(),x.getViewMatrix())},f.prototype.getDistanceToCamera=function(x){return x===void 0&&(x=null),x||(x=this.getScene().activeCamera),this.getAbsolutePosition().subtract(x.globalPosition).length()},f.prototype.clone=function(x,P,A){var T=this,_=m.a.Clone(function(){return new f(x,T.getScene())},this);if(_.name=x,_.id=x,P&&(_.parent=P),!A)for(var g=this.getDescendants(!0),M=0;M<g.length;M++){var O=g[M];O.clone&&O.clone(x+"."+O.name,_)}return _},f.prototype.serialize=function(x){var P=m.a.Serialize(this,x);return P.type=this.getClassName(),this.parent&&(P.parentId=this.parent.id),P.localMatrix=this.getPivotMatrix().asArray(),P.isEnabled=this.isEnabled(),this.parent&&(P.parentId=this.parent.id),P},f.Parse=function(x,P,A){var T=m.a.Parse(function(){return new f(x.name,P)},x,P,A);return x.localMatrix?T.setPreTransformMatrix(h.a.FromArray(x.localMatrix)):x.pivotMatrix&&T.setPivotMatrix(h.a.FromArray(x.pivotMatrix)),T.setEnabled(x.isEnabled),x.parentId&&(T._waitingParentId=x.parentId),T},f.prototype.getChildTransformNodes=function(x,P){var A=[];return this._getDescendants(A,x,function(T){return(!P||P(T))&&T instanceof f}),A},f.prototype.dispose=function(x,P){if(P===void 0&&(P=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),x)for(var A=0,T=this.getChildTransformNodes(!0);A<T.length;A++){var _=T[A];_.parent=null,_.computeWorldMatrix(!0)}b.prototype.dispose.call(this,x,P)},f.prototype.normalizeToUnitCube=function(x,P,A){x===void 0&&(x=!0),P===void 0&&(P=!1);var T=null,_=null;P&&(this.rotationQuaternion?(_=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(T=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var g=this.getHierarchyBoundingVectors(x,A),M=g.max.subtract(g.min),O=Math.max(M.x,M.y,M.z);if(O===0)return this;var N=1/O;return this.scaling.scaleInPlace(N),P&&(this.rotationQuaternion&&_?this.rotationQuaternion.copyFrom(_):this.rotation&&T&&this.rotation.copyFrom(T)),this},f.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},f.BILLBOARDMODE_NONE=0,f.BILLBOARDMODE_X=1,f.BILLBOARDMODE_Y=2,f.BILLBOARDMODE_Z=4,f.BILLBOARDMODE_ALL=7,f.BILLBOARDMODE_USE_POSITION=128,f._TmpRotation=h.b.Zero(),f._TmpScaling=h.e.Zero(),f._TmpTranslation=h.e.Zero(),f._lookAtVectorCache=new h.e(0,0,0),f._rotationAxisCache=new h.b,Object(E.c)([Object(m.o)("position")],f.prototype,"_position",void 0),Object(E.c)([Object(m.o)("rotation")],f.prototype,"_rotation",void 0),Object(E.c)([Object(m.l)("rotationQuaternion")],f.prototype,"_rotationQuaternion",void 0),Object(E.c)([Object(m.o)("scaling")],f.prototype,"_scaling",void 0),Object(E.c)([Object(m.c)("billboardMode")],f.prototype,"_billboardMode",void 0),Object(E.c)([Object(m.c)()],f.prototype,"scalingDeterminant",void 0),Object(E.c)([Object(m.c)("infiniteDistance")],f.prototype,"_infiniteDistance",void 0),Object(E.c)([Object(m.c)()],f.prototype,"ignoreNonUniformScaling",void 0),Object(E.c)([Object(m.c)()],f.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),f}(C.a)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,h,C,R,I,b){this.source=S,this.pointerX=h,this.pointerY=C,this.meshUnderPointer=R,this.sourceEvent=I,this.additionalData=b}return m.CreateNew=function(S,h,C){var R=S.getScene();return new m(S,R.pointerX,R.pointerY,R.meshUnderPointer||S,h,C)},m.CreateNewFromSprite=function(S,h,C,R){return new m(S,h.pointerX,h.pointerY,h.meshUnderPointer,C,R)},m.CreateNewFromScene=function(S,h){return new m(null,S.pointerX,S.pointerY,S.meshUnderPointer,h)},m.CreateNewFromPrimitive=function(S,h,C,R){return new m(S,h.x,h.y,null,C,R)},m}()},function(p,s,c){c.d(s,"a",function(){return b});var E=c(1),m=c(3),S=c(0),h=c(9),C=c(29),R=c(85),I=c(11),b=function(f){function x(P,A){var T=f.call(this,P,A)||this;return T.diffuse=new h.a(1,1,1),T.specular=new h.a(1,1,1),T.falloffType=x.FALLOFF_DEFAULT,T.intensity=1,T._range=Number.MAX_VALUE,T._inverseSquaredRange=0,T._photometricScale=1,T._intensityMode=x.INTENSITYMODE_AUTOMATIC,T._radius=1e-5,T.renderPriority=0,T._shadowEnabled=!0,T._excludeWithLayerMask=0,T._includeOnlyWithLayerMask=0,T._lightmapMode=0,T._excludedMeshesIds=new Array,T._includedOnlyMeshesIds=new Array,T._isLight=!0,T.getScene().addLight(T),T._uniformBuffer=new R.a(T.getScene().getEngine()),T._buildUniformLayout(),T.includedOnlyMeshes=new Array,T.excludedMeshes=new Array,T._resyncMeshes(),T}return Object(E.d)(x,f),Object.defineProperty(x.prototype,"range",{get:function(){return this._range},set:function(P){this._range=P,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(P){this._intensityMode=P,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"radius",{get:function(){return this._radius},set:function(P){this._radius=P,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(P){this._shadowEnabled!==P&&(this._shadowEnabled=P,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(P){this._includedOnlyMeshes=P,this._hookArrayForIncludedOnly(P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(P){this._excludedMeshes=P,this._hookArrayForExcluded(P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(P){this._excludeWithLayerMask=P,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(P){this._includeOnlyWithLayerMask=P,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(P){this._lightmapMode!==P&&(this._lightmapMode=P,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),x.prototype.transferTexturesToEffect=function(P,A){return this},x.prototype._bindLight=function(P,A,T,_,g){g===void 0&&(g=!1);var M=P.toString(),O=!1;if(!g||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(T,"Light"+M),this._renderId!==A.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=A.getRenderId();var N=this.getScaledIntensity();this.transferToEffect(T,M),this.diffuse.scaleToRef(N,h.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",h.c.Color3[0],this.range,M),_&&(this.specular.scaleToRef(N,h.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",h.c.Color3[1],this.radius,M)),O=!0}if(this.transferTexturesToEffect(T,M),A.shadowsEnabled&&this.shadowEnabled){var V=this.getShadowGenerator();V&&(V.bindShadowLight(M,T),O=!0)}O&&this._uniformBuffer.update()}},x.prototype.getClassName=function(){return"Light"},x.prototype.toString=function(P){var A="Name: "+this.name;if(A+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var T=0;T<this.animations.length;T++)A+=", animation[0]: "+this.animations[T].toString(P);return A},x.prototype._syncParentEnabledState=function(){f.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},x.prototype.setEnabled=function(P){f.prototype.setEnabled.call(this,P),this._resyncMeshes()},x.prototype.getShadowGenerator=function(){return this._shadowGenerator},x.prototype.getAbsolutePosition=function(){return S.e.Zero()},x.prototype.canAffectMesh=function(P){return!P||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(P)===-1)&&!(this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(P)!==-1)&&(this.includeOnlyWithLayerMask===0||(this.includeOnlyWithLayerMask&P.layerMask)!=0)&&!(this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&P.layerMask)},x.CompareLightsPriority=function(P,A){return P.shadowEnabled!==A.shadowEnabled?(A.shadowEnabled?1:0)-(P.shadowEnabled?1:0):A.renderPriority-P.renderPriority},x.prototype.dispose=function(P,A){A===void 0&&(A=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var T=0,_=this.getScene().meshes;T<_.length;T++)_[T]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),f.prototype.dispose.call(this,P,A)},x.prototype.getTypeID=function(){return 0},x.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},x.prototype.clone=function(P,A){A===void 0&&(A=null);var T=x.GetConstructorFromName(this.getTypeID(),P,this.getScene());if(!T)return null;var _=m.a.Clone(T,this);return A&&(_.parent=A),_.setEnabled(this.isEnabled()),_},x.prototype.serialize=function(){var P=m.a.Serialize(this);return P.type=this.getTypeID(),this.parent&&(P.parentId=this.parent.id),this.excludedMeshes.length>0&&(P.excludedMeshesIds=[],this.excludedMeshes.forEach(function(A){P.excludedMeshesIds.push(A.id)})),this.includedOnlyMeshes.length>0&&(P.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(A){P.includedOnlyMeshesIds.push(A.id)})),m.a.AppendSerializedAnimations(this,P),P.ranges=this.serializeAnimationRanges(),P},x.GetConstructorFromName=function(P,A,T){var _=C.a.Construct("Light_Type_"+P,A,T);return _||null},x.Parse=function(P,A){var T=x.GetConstructorFromName(P.type,P.name,A);if(!T)return null;var _=m.a.Parse(T,P,A);if(P.excludedMeshesIds&&(_._excludedMeshesIds=P.excludedMeshesIds),P.includedOnlyMeshesIds&&(_._includedOnlyMeshesIds=P.includedOnlyMeshesIds),P.parentId&&(_._waitingParentId=P.parentId),P.falloffType!==void 0&&(_.falloffType=P.falloffType),P.lightmapMode!==void 0&&(_.lightmapMode=P.lightmapMode),P.animations){for(var g=0;g<P.animations.length;g++){var M=P.animations[g],O=I.a.GetClass("BABYLON.Animation");O&&_.animations.push(O.Parse(M))}C.a.ParseAnimationRanges(_,P,A)}return P.autoAnimate&&A.beginAnimation(_,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),_},x.prototype._hookArrayForExcluded=function(P){var A=this,T=P.push;P.push=function(){for(var O=[],N=0;N<arguments.length;N++)O[N]=arguments[N];for(var V=T.apply(P,O),U=0,L=O;U<L.length;U++){var j=L[U];j._resyncLightSource(A)}return V};var _=P.splice;P.splice=function(O,N){for(var V=_.apply(P,[O,N]),U=0,L=V;U<L.length;U++)L[U]._resyncLightSource(A);return V};for(var g=0,M=P;g<M.length;g++)M[g]._resyncLightSource(this)},x.prototype._hookArrayForIncludedOnly=function(P){var A=this,T=P.push;P.push=function(){for(var g=[],M=0;M<arguments.length;M++)g[M]=arguments[M];var O=T.apply(P,g);return A._resyncMeshes(),O};var _=P.splice;P.splice=function(g,M){var O=_.apply(P,[g,M]);return A._resyncMeshes(),O},this._resyncMeshes()},x.prototype._resyncMeshes=function(){for(var P=0,A=this.getScene().meshes;P<A.length;P++)A[P]._resyncLightSource(this)},x.prototype._markMeshesAsLightDirty=function(){for(var P=0,A=this.getScene().meshes;P<A.length;P++){var T=A[P];T.lightSources.indexOf(this)!==-1&&T._markSubMeshesAsLightDirty()}},x.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},x.prototype._getPhotometricScale=function(){var P=0,A=this.getTypeID(),T=this.intensityMode;switch(T===x.INTENSITYMODE_AUTOMATIC&&(T=A===x.LIGHTTYPEID_DIRECTIONALLIGHT?x.INTENSITYMODE_ILLUMINANCE:x.INTENSITYMODE_LUMINOUSINTENSITY),A){case x.LIGHTTYPEID_POINTLIGHT:case x.LIGHTTYPEID_SPOTLIGHT:switch(T){case x.INTENSITYMODE_LUMINOUSPOWER:P=1/(4*Math.PI);break;case x.INTENSITYMODE_LUMINOUSINTENSITY:P=1;break;case x.INTENSITYMODE_LUMINANCE:P=this.radius*this.radius}break;case x.LIGHTTYPEID_DIRECTIONALLIGHT:switch(T){case x.INTENSITYMODE_ILLUMINANCE:P=1;break;case x.INTENSITYMODE_LUMINANCE:var _=this.radius;_=Math.max(_,.001),P=2*Math.PI*(1-Math.cos(_))}break;case x.LIGHTTYPEID_HEMISPHERICLIGHT:P=1}return P},x.prototype._reorderLightsInScene=function(){var P=this.getScene();this._renderPriority!=0&&(P.requireLightSorting=!0),this.getScene().sortLightsByPriority()},x.FALLOFF_DEFAULT=0,x.FALLOFF_PHYSICAL=1,x.FALLOFF_GLTF=2,x.FALLOFF_STANDARD=3,x.LIGHTMAP_DEFAULT=0,x.LIGHTMAP_SPECULAR=1,x.LIGHTMAP_SHADOWSONLY=2,x.INTENSITYMODE_AUTOMATIC=0,x.INTENSITYMODE_LUMINOUSPOWER=1,x.INTENSITYMODE_LUMINOUSINTENSITY=2,x.INTENSITYMODE_ILLUMINANCE=3,x.INTENSITYMODE_LUMINANCE=4,x.LIGHTTYPEID_POINTLIGHT=0,x.LIGHTTYPEID_DIRECTIONALLIGHT=1,x.LIGHTTYPEID_SPOTLIGHT=2,x.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(E.c)([Object(m.e)()],x.prototype,"diffuse",void 0),Object(E.c)([Object(m.e)()],x.prototype,"specular",void 0),Object(E.c)([Object(m.c)()],x.prototype,"falloffType",void 0),Object(E.c)([Object(m.c)()],x.prototype,"intensity",void 0),Object(E.c)([Object(m.c)()],x.prototype,"range",null),Object(E.c)([Object(m.c)()],x.prototype,"intensityMode",null),Object(E.c)([Object(m.c)()],x.prototype,"radius",null),Object(E.c)([Object(m.c)()],x.prototype,"_renderPriority",void 0),Object(E.c)([Object(m.b)("_reorderLightsInScene")],x.prototype,"renderPriority",void 0),Object(E.c)([Object(m.c)("shadowEnabled")],x.prototype,"_shadowEnabled",void 0),Object(E.c)([Object(m.c)("excludeWithLayerMask")],x.prototype,"_excludeWithLayerMask",void 0),Object(E.c)([Object(m.c)("includeOnlyWithLayerMask")],x.prototype,"_includeOnlyWithLayerMask",void 0),Object(E.c)([Object(m.c)("lightmapMode")],x.prototype,"_lightmapMode",void 0),x}(C.a)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._xhr=typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}return m.prototype._injectCustomRequestHeaders=function(){for(var S in m.CustomRequestHeaders){var h=m.CustomRequestHeaders[S];h&&this._xhr.setRequestHeader(S,h)}},Object.defineProperty(m.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(S){this._xhr.onprogress=S},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(S){this._xhr.responseType=S},enumerable:!1,configurable:!0}),m.prototype.addEventListener=function(S,h,C){this._xhr.addEventListener(S,h,C)},m.prototype.removeEventListener=function(S,h,C){this._xhr.removeEventListener(S,h,C)},m.prototype.abort=function(){this._xhr.abort()},m.prototype.send=function(S){m.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(S)},m.prototype.open=function(S,h){for(var C=0,R=m.CustomRequestModifiers;C<R.length;C++)(0,R[C])(this._xhr,h);return h=(h=h.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(S,h,!0)},m.prototype.setRequestHeader=function(S,h){this._xhr.setRequestHeader(S,h)},m.prototype.getResponseHeader=function(S){return this._xhr.getResponseHeader(S)},m.CustomRequestHeaders={},m.CustomRequestModifiers=new Array,m}()},function(p,s,c){c.d(s,"e",function(){return m}),c.d(s,"a",function(){return S}),c.d(s,"d",function(){return h}),c.d(s,"c",function(){return C}),c.d(s,"b",function(){return R});var E=c(1),m=function(){function I(b,f){this.type=b,this.jointData=f,f.nativeParams=f.nativeParams||{}}return Object.defineProperty(I.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(b){this._physicsJoint,this._physicsJoint=b},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"physicsPlugin",{set:function(b){this._physicsPlugin=b},enumerable:!1,configurable:!0}),I.prototype.executeNativeFunction=function(b){b(this._physicsPlugin.world,this._physicsJoint)},I.DistanceJoint=0,I.HingeJoint=1,I.BallAndSocketJoint=2,I.WheelJoint=3,I.SliderJoint=4,I.PrismaticJoint=5,I.UniversalJoint=6,I.Hinge2Joint=I.WheelJoint,I.PointToPointJoint=8,I.SpringJoint=9,I.LockJoint=10,I}(),S=function(I){function b(f){return I.call(this,m.DistanceJoint,f)||this}return Object(E.d)(b,I),b.prototype.updateDistance=function(f,x){this._physicsPlugin.updateDistanceJoint(this,f,x)},b}(m),h=function(I){function b(f,x){return I.call(this,f,x)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(f,x){this._physicsPlugin.setMotor(this,f||0,x)},b.prototype.setLimit=function(f,x){this._physicsPlugin.setLimit(this,f,x)},b}(m),C=function(I){function b(f){return I.call(this,m.HingeJoint,f)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(f,x){this._physicsPlugin.setMotor(this,f||0,x)},b.prototype.setLimit=function(f,x){this._physicsPlugin.setLimit(this,f,x)},b}(h),R=function(I){function b(f){return I.call(this,m.Hinge2Joint,f)||this}return Object(E.d)(b,I),b.prototype.setMotor=function(f,x,P){P===void 0&&(P=0),this._physicsPlugin.setMotor(this,f||0,x,P)},b.prototype.setLimit=function(f,x,P){P===void 0&&(P=0),this._physicsPlugin.setLimit(this,f,x,P)},b}(h)},function(p,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(7),S=c(36),h=c(18),C=function(){function R(I){var b=this;I===void 0&&(I=S.a.DefaultUtilityLayer),this.gizmoLayer=I,this._attachedMesh=null,this._attachedNode=null,this._scaleRatio=1,this._isHovered=!1,this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempQuaternion=new E.b(0,0,0,1),this._tempVector=new E.e,this._tempVector2=new E.e,this._tempMatrix1=new E.a,this._tempMatrix2=new E.a,this._rightHandtoLeftHandMatrix=E.a.RotationY(Math.PI),this._rootMesh=new m.a("gizmoRootNode",I.utilityLayerScene),this._rootMesh.rotationQuaternion=E.b.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){b._update()})}return Object.defineProperty(R.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(I){this._scaleRatio=I},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isHovered",{get:function(){return this._isHovered},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(I){this._attachedMesh=I,I&&(this._attachedNode=I),this._rootMesh.setEnabled(!!I),this._attachedNodeChanged(I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(I){this._attachedNode=I,this._attachedMesh=null,this._rootMesh.setEnabled(!!I),this._attachedNodeChanged(I)},enumerable:!1,configurable:!0}),R.prototype.setCustomMesh=function(I){if(I.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(b){b.dispose()}),I.parent=this._rootMesh,this._customMeshSet=!0},Object.defineProperty(R.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(I){this._updateGizmoRotationToMatchAttachedMesh=I},enumerable:!1,configurable:!0}),R.prototype._attachedNodeChanged=function(I){},R.prototype._update=function(){if(this.attachedNode){var I=this.attachedNode;if(this.attachedMesh&&(I=this.attachedMesh._effectiveMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh){var b=I.getWorldMatrix().getRow(3),f=b?b.toVector3():new E.e(0,0,0);this._rootMesh.position.copyFrom(f)}if(this.updateGizmoRotationToMatchAttachedMesh?I.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){var x=this.gizmoLayer.utilityLayerScene.activeCamera,P=x.globalPosition;x.devicePosition&&(P=x.devicePosition),this._rootMesh.position.subtractToRef(P,this._tempVector);var A=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(A,A,A),I._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},R.prototype._matrixChanged=function(){if(this._attachedNode){if(this._attachedNode._isCamera){var I,b,f=this._attachedNode;if(f.parent){var x=this._tempMatrix2;f.parent._worldMatrix.invertToRef(x),this._attachedNode._worldMatrix.multiplyToRef(x,this._tempMatrix1),I=this._tempMatrix1}else I=this._attachedNode._worldMatrix;if(f.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(I,this._tempMatrix2),b=this._tempMatrix2):b=I,b.decompose(this._tempVector2,this._tempQuaternion,this._tempVector),this._attachedNode.getClassName()==="FreeCamera"||this._attachedNode.getClassName()==="FlyCamera"||this._attachedNode.getClassName()==="ArcFollowCamera"||this._attachedNode.getClassName()==="TargetCamera"||this._attachedNode.getClassName()==="TouchCamera"||this._attachedNode.getClassName()==="UniversalCamera"){var P=this._attachedNode;P.rotation=this._tempQuaternion.toEulerAngles(),P.rotationQuaternion&&P.rotationQuaternion.copyFrom(this._tempQuaternion)}f.position.copyFrom(this._tempVector)}else if(this._attachedNode._isMesh||this._attachedNode.getClassName()==="AbstractMesh"||this._attachedNode.getClassName()==="TransformNode"||this._attachedNode.getClassName()==="InstancedMesh"){var A=this._attachedNode;if(A.parent){x=this._tempMatrix1;var T=this._tempMatrix2;A.parent.getWorldMatrix().invertToRef(x),this._attachedNode.getWorldMatrix().multiplyToRef(x,T),T.decompose(A.scaling,this._tempQuaternion,A.position)}else this._attachedNode._worldMatrix.decompose(A.scaling,this._tempQuaternion,A.position);A.billboardMode||(A.rotationQuaternion?A.rotationQuaternion.copyFrom(this._tempQuaternion):A.rotation=this._tempQuaternion.toEulerAngles())}else if(this._attachedNode.getClassName()==="Bone"){var _=this._attachedNode,g=_.getParent();if(g){var M=this._tempMatrix1,O=this._tempMatrix2;g.getWorldMatrix().invertToRef(M),_.getWorldMatrix().multiplyToRef(M,O),_.getLocalMatrix().copyFrom(O)}else _.getLocalMatrix().copyFrom(_.getWorldMatrix());_.markAsDirty()}}},R.GizmoAxisPointerObserver=function(I,b){var f=!1;return I.utilityLayerScene.onPointerObservable.add(function(x){var P,A;if(x.pickInfo){if(x.type===h.a.POINTERMOVE){if(f)return;b.forEach(function(T){var _,g;if(T.colliderMeshes&&T.gizmoMeshes){var M=((_=T.colliderMeshes)===null||_===void 0?void 0:_.indexOf((g=x==null?void 0:x.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||T.active?T.hoverMaterial:T.material;T.gizmoMeshes.forEach(function(O){O.material=M,O.color&&(O.color=M.diffuseColor)})}})}x.type===h.a.POINTERDOWN&&b.has((P=x.pickInfo.pickedMesh)===null||P===void 0?void 0:P.parent)&&(f=!0,b.get((A=x.pickInfo.pickedMesh)===null||A===void 0?void 0:A.parent).active=!0,b.forEach(function(T){var _,g,M=((_=T.colliderMeshes)===null||_===void 0?void 0:_.indexOf((g=x==null?void 0:x.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||T.active?T.hoverMaterial:T.disableMaterial;T.gizmoMeshes.forEach(function(O){O.material=M,O.color&&(O.color=M.diffuseColor)})})),x.type===h.a.POINTERUP&&b.forEach(function(T){T.active=!1,f=!1,T.gizmoMeshes.forEach(function(_){_.material=T.material,_.color&&(_.color=T.material.diffuseColor)})})}})},R.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},R}()},function(p,s,c){c.d(s,"a",function(){return f});var E=c(1),m=c(3),S=c(6),h=c(0),C=c(22),R=c(2),I=c(120),b=(c(56),c(77)),f=function(x){function P(A){var T=x.call(this,null)||this;return T.metadata=null,T.reservedDataStore=null,T._hasAlpha=!1,T.getAlphaFromRGB=!1,T.level=1,T.coordinatesIndex=0,T._coordinatesMode=R.a.TEXTURE_EXPLICIT_MODE,T.wrapR=R.a.TEXTURE_WRAP_ADDRESSMODE,T.anisotropicFilteringLevel=P.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,T._isCube=!1,T._gammaSpace=!0,T.invertZ=!1,T.lodLevelInAlpha=!1,T.isRenderTarget=!1,T._prefiltered=!1,T.animations=new Array,T.onDisposeObservable=new S.c,T._onDisposeObserver=null,T._scene=null,T._texture=null,T._uid=null,A?P._isScene(A)?T._scene=A:T._engine=A:T._scene=C.a.LastCreatedScene,T._scene&&(T.uniqueId=T._scene.getUniqueId(),T._scene.addTexture(T),T._engine=T._scene.getEngine()),T._uid=null,T}return Object(E.d)(P,x),Object.defineProperty(P.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(A){this._hasAlpha!==A&&(this._hasAlpha=A,this._scene&&this._scene.markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag|R.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(A){this._coordinatesMode!==A&&(this._coordinatesMode=A,this._scene&&this._scene.markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"wrapU",{get:function(){return this._wrapU},set:function(A){this._wrapU=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"wrapV",{get:function(){return this._wrapV},set:function(A){this._wrapV=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(A){this._texture?this._texture.isCube=A:this._isCube=A},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(A){this._texture&&(this._texture.is3D=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(A){this._texture&&(this._texture.is2DArray=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"gammaSpace",{get:function(){return this._texture?(this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace):this._gammaSpace},set:function(A){if(this._texture){if(this._texture._gammaSpace===A)return;this._texture._gammaSpace=A}else{if(this._gammaSpace===A)return;this._gammaSpace=A}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(A){this._texture&&(this._texture._isRGBD=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(A){this._texture&&(this._texture._lodGenerationOffset=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(A){this._texture&&(this._texture._lodGenerationScale=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(A){this._texture&&(this._texture._linearSpecularLOD=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(A){this._texture&&(this._texture._irradianceTexture=A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"uid",{get:function(){return this._uid||(this._uid=I.a.RandomId()),this._uid},enumerable:!1,configurable:!0}),P.prototype.toString=function(){return this.name},P.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(P.prototype,"onDispose",{set:function(A){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(A)},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),P.prototype.getScene=function(){return this._scene},P.prototype._getEngine=function(){return this._engine},P.prototype.checkTransformsAreIdentical=function(A){return A!==null},P.prototype.getTextureMatrix=function(){return h.a.IdentityReadOnly},P.prototype.getReflectionTextureMatrix=function(){return h.a.IdentityReadOnly},P.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},P.prototype.scale=function(A){},Object.defineProperty(P.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),P.prototype._getFromCache=function(A,T,_,g){var M=this._getEngine();if(!M)return null;for(var O=M.getLoadedTexturesCache(),N=0;N<O.length;N++){var V=O[N];if(!(g!==void 0&&g!==V.invertY||V.url!==A||V.generateMipMaps!==!T||_&&_!==V.samplingMode))return V.incrementReferences(),V}return null},P.prototype._rebuild=function(){},P.prototype.clone=function(){return null},Object.defineProperty(P.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:R.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:R.a.TEXTUREFORMAT_RGBA},enumerable:!1,configurable:!0}),P.prototype._markAllSubMeshesAsTexturesDirty=function(){var A=this.getScene();A&&A.markAllMaterialsAsDirty(R.a.MATERIAL_TextureDirtyFlag)},P.prototype.readPixels=function(A,T,_){if(A===void 0&&(A=0),T===void 0&&(T=0),_===void 0&&(_=null),!this._texture)return null;var g=this.getSize(),M=g.width,O=g.height,N=this._getEngine();if(!N)return null;T!=0&&(M/=Math.pow(2,T),O/=Math.pow(2,T),M=Math.round(M),O=Math.round(O));try{return this._texture.isCube?N._readTexturePixels(this._texture,M,O,A,T,_):N._readTexturePixels(this._texture,M,O,-1,T,_)}catch(V){return null}},Object.defineProperty(P.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),P.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var A=this._scene.textures.indexOf(this);A>=0&&this._scene.textures.splice(A,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),x.prototype.dispose.call(this)},P.prototype.serialize=function(){if(!this.name)return null;var A=m.a.Serialize(this);return m.a.AppendSerializedAnimations(this,A),A},P.WhenAllReady=function(A,T){var _=A.length;if(_!==0)for(var g=0;g<A.length;g++){var M=A[g];if(M.isReady())--_==0&&T();else{var O=M.onLoadObservable;O&&O.addOnce(function(){--_==0&&T()})}}else T()},P._isScene=function(A){return A.getClassName()==="Scene"},P.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(E.c)([Object(m.c)()],P.prototype,"uniqueId",void 0),Object(E.c)([Object(m.c)()],P.prototype,"name",void 0),Object(E.c)([Object(m.c)()],P.prototype,"metadata",void 0),Object(E.c)([Object(m.c)("hasAlpha")],P.prototype,"_hasAlpha",void 0),Object(E.c)([Object(m.c)()],P.prototype,"getAlphaFromRGB",void 0),Object(E.c)([Object(m.c)()],P.prototype,"level",void 0),Object(E.c)([Object(m.c)()],P.prototype,"coordinatesIndex",void 0),Object(E.c)([Object(m.c)("coordinatesMode")],P.prototype,"_coordinatesMode",void 0),Object(E.c)([Object(m.c)()],P.prototype,"wrapU",null),Object(E.c)([Object(m.c)()],P.prototype,"wrapV",null),Object(E.c)([Object(m.c)()],P.prototype,"wrapR",void 0),Object(E.c)([Object(m.c)()],P.prototype,"anisotropicFilteringLevel",void 0),Object(E.c)([Object(m.c)()],P.prototype,"isCube",null),Object(E.c)([Object(m.c)()],P.prototype,"is3D",null),Object(E.c)([Object(m.c)()],P.prototype,"is2DArray",null),Object(E.c)([Object(m.c)()],P.prototype,"gammaSpace",null),Object(E.c)([Object(m.c)()],P.prototype,"invertZ",void 0),Object(E.c)([Object(m.c)()],P.prototype,"lodLevelInAlpha",void 0),Object(E.c)([Object(m.c)()],P.prototype,"lodGenerationOffset",null),Object(E.c)([Object(m.c)()],P.prototype,"lodGenerationScale",null),Object(E.c)([Object(m.c)()],P.prototype,"linearSpecularLOD",null),Object(E.c)([Object(m.m)()],P.prototype,"irradianceTexture",null),Object(E.c)([Object(m.c)()],P.prototype,"isRenderTarget",void 0),P}(function(){function x(P){this._wrapU=R.a.TEXTURE_WRAP_ADDRESSMODE,this._wrapV=R.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=R.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.delayLoadState=R.a.DELAYLOADSTATE_NONE,this._texture=null,this._engine=null,this._cachedSize=b.a.Zero(),this._cachedBaseSize=b.a.Zero(),this._texture=P,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(x.prototype,"wrapU",{get:function(){return this._wrapU},set:function(P){this._wrapU=P},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"wrapV",{get:function(){return this._wrapV},set:function(P){this._wrapV=P},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(P){this._texture&&(this._texture.isCube=P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(P){this._texture&&(this._texture.is3D=P)},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(P){this._texture&&(this._texture.is2DArray=P)},enumerable:!1,configurable:!0}),x.prototype.getClassName=function(){return"ThinTexture"},x.prototype.isReady=function(){return this.delayLoadState===R.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},x.prototype.delayLoad=function(){},x.prototype.getInternalTexture=function(){return this._texture},x.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},x.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},x.prototype.updateSamplingMode=function(P){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(P,this._texture)},x.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},x.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},x}())},function(p,s,c){c.d(s,"a",function(){return I});var E=c(0),m=c(9),S=c(7),h=c(16),C=c(20),R=c(23);h.a.CreateCylinder=function(b){var f=b.height||2,x=b.diameterTop===0?0:b.diameterTop||b.diameter||1,P=b.diameterBottom===0?0:b.diameterBottom||b.diameter||1;x=x||1e-5,P=P||1e-5;var A,T=b.tessellation||24,_=b.subdivisions||1,g=!!b.hasRings,M=!!b.enclose,O=b.cap===0?0:b.cap||S.a.CAP_ALL,N=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,V=b.sideOrientation===0?0:b.sideOrientation||h.a.DEFAULTSIDE,U=b.faceUV||new Array(3),L=b.faceColors,j=2+(1+(N!==1&&M?2:0))*(g?_:1);for(A=0;A<j;A++)L&&L[A]===void 0&&(L[A]=new m.b(1,1,1,1));for(A=0;A<j;A++)U&&U[A]===void 0&&(U[A]=new E.f(0,0,1,1));var Y,W,ie,re,ye,ve,ue=new Array,oe=new Array,Z=new Array,J=new Array,B=new Array,G=2*Math.PI*N/T,$=(P-x)/2/f,he=E.e.Zero(),se=E.e.Zero(),q=E.e.Zero(),H=E.e.Zero(),X=E.e.Zero(),ee=R.a.Y,Q=1,te=1,ge=0,ce=0;for(re=0;re<=_;re++)for(ie=((W=re/_)*(x-P)+P)/2,Q=g&&re!==0&&re!==_?2:1,ve=0;ve<Q;ve++){for(g&&(te+=ve),M&&(te+=2*ve),ye=0;ye<=T;ye++)Y=ye*G,he.x=Math.cos(-Y)*ie,he.y=-f/2+W*f,he.z=Math.sin(-Y)*ie,x===0&&re===_?(se.x=Z[Z.length-3*(T+1)],se.y=Z[Z.length-3*(T+1)+1],se.z=Z[Z.length-3*(T+1)+2]):(se.x=he.x,se.z=he.z,se.y=Math.sqrt(se.x*se.x+se.z*se.z)*$,se.normalize()),ye===0&&(q.copyFrom(he),H.copyFrom(se)),oe.push(he.x,he.y,he.z),Z.push(se.x,se.y,se.z),ce=g?ge!==te?U[te].y:U[te].w:U[te].y+(U[te].w-U[te].y)*W,J.push(U[te].x+(U[te].z-U[te].x)*ye/T,ce),L&&B.push(L[te].r,L[te].g,L[te].b,L[te].a);N!==1&&M&&(oe.push(he.x,he.y,he.z),oe.push(0,he.y,0),oe.push(0,he.y,0),oe.push(q.x,q.y,q.z),E.e.CrossToRef(ee,se,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),E.e.CrossToRef(H,ee,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),ce=g?ge!==te?U[te+1].y:U[te+1].w:U[te+1].y+(U[te+1].w-U[te+1].y)*W,J.push(U[te+1].x,ce),J.push(U[te+1].z,ce),ce=g?ge!==te?U[te+2].y:U[te+2].w:U[te+2].y+(U[te+2].w-U[te+2].y)*W,J.push(U[te+2].x,ce),J.push(U[te+2].z,ce),L&&(B.push(L[te+1].r,L[te+1].g,L[te+1].b,L[te+1].a),B.push(L[te+1].r,L[te+1].g,L[te+1].b,L[te+1].a),B.push(L[te+2].r,L[te+2].g,L[te+2].b,L[te+2].a),B.push(L[te+2].r,L[te+2].g,L[te+2].b,L[te+2].a))),ge!==te&&(ge=te)}var de=N!==1&&M?T+4:T;for(re=0,te=0;te<_;te++){var ne=0,pe=0,Se=0,Te=0;for(ye=0;ye<T;ye++)ne=re*(de+1)+ye,pe=(re+1)*(de+1)+ye,Se=re*(de+1)+(ye+1),Te=(re+1)*(de+1)+(ye+1),ue.push(ne,pe,Se),ue.push(Te,Se,pe);N!==1&&M&&(ue.push(ne+2,pe+2,Se+2),ue.push(Te+2,Se+2,pe+2),ue.push(ne+4,pe+4,Se+4),ue.push(Te+4,Se+4,pe+4)),re=g?re+2:re+1}var Ne=function(Xe){var Ye=Xe?x/2:P/2;if(Ye!==0){var Ke,nt,qe,ct=Xe?U[j-1]:U[0],ot=null;L&&(ot=Xe?L[j-1]:L[0]);var _t=oe.length/3,gt=Xe?f/2:-f/2,At=new E.e(0,gt,0);oe.push(At.x,At.y,At.z),Z.push(0,Xe?1:-1,0),J.push(ct.x+.5*(ct.z-ct.x),ct.y+.5*(ct.w-ct.y)),ot&&B.push(ot.r,ot.g,ot.b,ot.a);var wt=new E.d(.5,.5);for(qe=0;qe<=T;qe++){Ke=2*Math.PI*qe*N/T;var Qt=Math.cos(-Ke),Wt=Math.sin(-Ke);nt=new E.e(Qt*Ye,gt,Wt*Ye);var Ft=new E.d(Qt*wt.x+.5,Wt*wt.y+.5);oe.push(nt.x,nt.y,nt.z),Z.push(0,Xe?1:-1,0),J.push(ct.x+(ct.z-ct.x)*Ft.x,ct.y+(ct.w-ct.y)*Ft.y),ot&&B.push(ot.r,ot.g,ot.b,ot.a)}for(qe=0;qe<T;qe++)Xe?(ue.push(_t),ue.push(_t+(qe+2)),ue.push(_t+(qe+1))):(ue.push(_t),ue.push(_t+(qe+1)),ue.push(_t+(qe+2)))}};O!==S.a.CAP_START&&O!==S.a.CAP_ALL||Ne(!1),O!==S.a.CAP_END&&O!==S.a.CAP_ALL||Ne(!0),h.a._ComputeSides(V,oe,ue,Z,J,b.frontUVs,b.backUVs);var je=new h.a;return je.indices=ue,je.positions=oe,je.normals=Z,je.uvs=J,L&&(je.colors=B),je},S.a.CreateCylinder=function(b,f,x,P,A,T,_,g,M){_!==void 0&&_ instanceof C.a||(_!==void 0&&(M=g||S.a.DEFAULTSIDE,g=_),_=T,T=1);var O={height:f,diameterTop:x,diameterBottom:P,tessellation:A,subdivisions:T,sideOrientation:M,updatable:g};return I.CreateCylinder(b,O,_)};var I=function(){function b(){}return b.CreateCylinder=function(f,x,P){var A=new S.a(f,P);return x.sideOrientation=S.a._GetDefaultSideOrientation(x.sideOrientation),A._originalBuilderSideOrientation=x.sideOrientation,h.a.CreateCylinder(x).applyToMesh(A,x.updatable),A},b}()},function(p,s,c){c.d(s,"a",function(){return S});var E=c(0),m=c(4),S=function(){function h(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return h.prototype.getNormal=function(C,R){if(C===void 0&&(C=!1),R===void 0&&(R=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.NormalKind))return null;var I,b=this.pickedMesh.getIndices();if(!b)return null;if(R){var f=this.pickedMesh.getVerticesData(m.b.NormalKind),x=E.e.FromArray(f,3*b[3*this.faceId]),P=E.e.FromArray(f,3*b[3*this.faceId+1]),A=E.e.FromArray(f,3*b[3*this.faceId+2]);x=x.scale(this.bu),P=P.scale(this.bv),A=A.scale(1-this.bu-this.bv),I=new E.e(x.x+P.x+A.x,x.y+P.y+A.y,x.z+P.z+A.z)}else{var T=this.pickedMesh.getVerticesData(m.b.PositionKind),_=E.e.FromArray(T,3*b[3*this.faceId]),g=E.e.FromArray(T,3*b[3*this.faceId+1]),M=E.e.FromArray(T,3*b[3*this.faceId+2]),O=_.subtract(g),N=M.subtract(g);I=E.e.Cross(O,N)}if(C){var V=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(E.c.Matrix[0].copyFrom(V),(V=E.c.Matrix[0]).setTranslationFromFloats(0,0,0),V.invert(),V.transposeToRef(E.c.Matrix[1]),V=E.c.Matrix[1]),I=E.e.TransformNormal(I,V)}return I.normalize(),I},h.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.UVKind))return null;var C=this.pickedMesh.getIndices();if(!C)return null;var R=this.pickedMesh.getVerticesData(m.b.UVKind);if(!R)return null;var I=E.d.FromArray(R,2*C[3*this.faceId]),b=E.d.FromArray(R,2*C[3*this.faceId+1]),f=E.d.FromArray(R,2*C[3*this.faceId+2]);return I=I.scale(this.bu),b=b.scale(this.bv),f=f.scale(1-this.bu-this.bv),new E.d(I.x+b.x+f.x,I.y+b.y+f.y)},h}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(57),m=function(){function S(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(S.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),S.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},S.prototype.addCount=function(h,C){S.Enabled&&(this._current+=h,C&&this._fetchResult())},S.prototype.beginMonitoring=function(){S.Enabled&&(this._startMonitoringTime=E.a.Now)},S.prototype.endMonitoring=function(h){if(h===void 0&&(h=!0),S.Enabled){h&&this.fetchNewFrame();var C=E.a.Now;this._current=C-this._startMonitoringTime,h&&this._fetchResult()}},S.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var h=E.a.Now;h-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=h,this._lastSecAccumulated=0,this._lastSecValueCount=0)},S.Enabled=!0,S}()},function(p,s,c){c.d(s,"b",function(){return P}),c.d(s,"d",function(){return A}),c.d(s,"c",function(){return T}),c.d(s,"a",function(){return _});var E=c(1),m=c(49),S=c(38),h=c(6),C=c(83),R=c(140),I=function(g){function M(){return g!==null&&g.apply(this,arguments)||this}return Object(E.d)(M,g),M._setPrototypeOf=Object.setPrototypeOf||function(O,N){return O.__proto__=N,O},M}(Error),b=c(34),f=c(26),x=c(128),P=function(g){function M(O,N){var V=g.call(this,O)||this;return V.name="LoadFileError",I._setPrototypeOf(V,M.prototype),N instanceof m.a?V.request=N:V.file=N,V}return Object(E.d)(M,g),M}(I),A=function(g){function M(O,N){var V=g.call(this,O)||this;return V.request=N,V.name="RequestFileError",I._setPrototypeOf(V,M.prototype),V}return Object(E.d)(M,g),M}(I),T=function(g){function M(O,N){var V=g.call(this,O)||this;return V.file=N,V.name="ReadFileError",I._setPrototypeOf(V,M.prototype),V}return Object(E.d)(M,g),M}(I),_=function(){function g(){}return g._CleanUrl=function(M){return M=M.replace(/#/gm,"%23")},g.SetCorsBehavior=function(M,O){if((!M||M.indexOf("data:")!==0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||this.CorsBehavior instanceof String)O.crossOrigin=g.CorsBehavior;else{var N=g.CorsBehavior(M);N&&(O.crossOrigin=N)}},g.LoadImage=function(M,O,N,V,U){var L;U===void 0&&(U="");var j=!1;if(M instanceof ArrayBuffer||ArrayBuffer.isView(M)?typeof Blob!="undefined"?(L=URL.createObjectURL(new Blob([M],{type:U})),j=!0):L="data:"+U+";base64,"+b.a.EncodeArrayBufferToBase64(M):M instanceof Blob?(L=URL.createObjectURL(M),j=!0):(L=g._CleanUrl(M),L=g.PreprocessUrl(M)),typeof Image=="undefined")return g.LoadFile(L,function(ue){createImageBitmap(new Blob([ue],{type:U})).then(function(oe){O(oe),j&&URL.revokeObjectURL(L)}).catch(function(oe){N&&N("Error while trying to load image: "+M,oe)})},void 0,V||void 0,!0,function(ue,oe){N&&N("Error while trying to load image: "+M,oe)}),null;var Y=new Image;g.SetCorsBehavior(L,Y);var W=function(){Y.removeEventListener("load",W),Y.removeEventListener("error",ie),O(Y),j&&Y.src&&URL.revokeObjectURL(Y.src)},ie=function(ue){if(Y.removeEventListener("load",W),Y.removeEventListener("error",ie),N){var oe=M.toString();N("Error while trying to load image: "+(oe.length<32?oe:oe.slice(0,32)+"..."),ue)}j&&Y.src&&URL.revokeObjectURL(Y.src)};Y.addEventListener("load",W),Y.addEventListener("error",ie);var re=function(){Y.src=L};if(L.substr(0,5)!=="data:"&&V&&V.enableTexturesOffline)V.open(function(){V&&V.loadImage(L,Y)},re);else{if(L.indexOf("file:")!==-1){var ye=decodeURIComponent(L.substring(5).toLowerCase());if(C.a.FilesToLoad[ye]){try{var ve;try{ve=URL.createObjectURL(C.a.FilesToLoad[ye])}catch(ue){ve=URL.createObjectURL(C.a.FilesToLoad[ye])}Y.src=ve,j=!0}catch(ue){Y.src=""}return Y}}re()}return Y},g.ReadFile=function(M,O,N,V,U){var L=new FileReader,j={onCompleteObservable:new h.c,abort:function(){return L.abort()}};return L.onloadend=function(Y){return j.onCompleteObservable.notifyObservers(j)},U&&(L.onerror=function(Y){U(new T("Unable to read "+M.name,M))}),L.onload=function(Y){O(Y.target.result)},N&&(L.onprogress=N),V?L.readAsArrayBuffer(M):L.readAsText(M),j},g.LoadFile=function(M,O,N,V,U,L){if(M.indexOf("file:")!==-1){var j=decodeURIComponent(M.substring(5).toLowerCase());j.indexOf("./")===0&&(j=j.substring(2));var Y=C.a.FilesToLoad[j];if(Y)return g.ReadFile(Y,O,N,U,L?function(W){return L(void 0,new P(W.message,W.file))}:void 0)}return g.RequestFile(M,function(W,ie){O(W,ie?ie.responseURL:void 0)},N,V,U,L?function(W){L(W.request,new P(W.message,W.request))}:void 0)},g.RequestFile=function(M,O,N,V,U,L,j){M=g._CleanUrl(M),M=g.PreprocessUrl(M);var Y=g.BaseUrl+M,W=!1,ie={onCompleteObservable:new h.c,abort:function(){return W=!0}},re=function(){var ve=new m.a,ue=null;ie.abort=function(){W=!0,ve.readyState!==(XMLHttpRequest.DONE||4)&&ve.abort(),ue!==null&&(clearTimeout(ue),ue=null)};var oe=function(Z){ve.open("GET",Y),j&&j(ve),U&&(ve.responseType="arraybuffer"),N&&ve.addEventListener("progress",N);var J=function(){ve.removeEventListener("loadend",J),ie.onCompleteObservable.notifyObservers(ie),ie.onCompleteObservable.clear()};ve.addEventListener("loadend",J);var B=function(){if(!W&&ve.readyState===(XMLHttpRequest.DONE||4)){if(ve.removeEventListener("readystatechange",B),ve.status>=200&&ve.status<300||ve.status===0&&(!S.a.IsWindowObjectExist()||g.IsFileURL()))return void O(U?ve.response:ve.responseText,ve);var G=g.DefaultRetryStrategy;if(G){var $=G(Y,ve,Z);if($!==-1)return ve.removeEventListener("loadend",J),ve=new m.a,void(ue=setTimeout(function(){return oe(Z+1)},$))}var he=new A("Error status: "+ve.status+" "+ve.statusText+" - Unable to load "+Y,ve);L&&L(he)}};ve.addEventListener("readystatechange",B),ve.send()};oe(0)};if(V&&V.enableSceneOffline){var ye=function(ve){ve&&ve.status>400?L&&L(ve):re()};V.open(function(){V&&V.loadFile(g.BaseUrl+M,function(ve){W||O(ve),ie.onCompleteObservable.notifyObservers(ie)},N?function(ve){W||N(ve)}:void 0,ye,U)},ye)}else re();return ie},g.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},g.DefaultRetryStrategy=R.a.ExponentialBackoff(),g.BaseUrl="",g.CorsBehavior="anonymous",g.PreprocessUrl=function(M){return M},g}();f.a._FileToolsLoadImage=_.LoadImage.bind(_),f.a._FileToolsLoadFile=_.LoadFile.bind(_),x.a._FileToolsLoadFile=_.LoadFile.bind(_)},function(p,s,c){c.d(s,"a",function(){return m});var E=c(38),m=function(){function S(){}return Object.defineProperty(S,"Now",{get:function(){return E.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),S}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,h,C,R){this.x=S,this.y=h,this.width=C,this.height=R}return m.prototype.toGlobal=function(S,h){return new m(this.x*S,this.y*h,this.width*S,this.height*h)},m.prototype.toGlobalToRef=function(S,h,C){return C.x=this.x*S,C.y=this.y*h,C.width=this.width*S,C.height=this.height*h,this},m.prototype.clone=function(){return new m(this.x,this.y,this.width,this.height)},m}()},function(p,s,c){var E="helperFunctions",m=`const float PI=3.1415926535897932384626433832795;
const float HALF_MIN=5.96046448e-08;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float toLinearSpace(float color)
{
return pow(color,LinearEncodePowerApprox);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec4 toLinearSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
vec4 toGammaSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){function S(){}return S._RemoveAndStorePivotPoint=function(h){h&&S._PivotCached===0&&(h.getPivotPointToRef(S._OldPivotPoint),S._PivotPostMultiplyPivotMatrix=h._postMultiplyPivotMatrix,S._OldPivotPoint.equalsToFloats(0,0,0)||(h.setPivotMatrix(E.a.IdentityReadOnly),S._OldPivotPoint.subtractToRef(h.getPivotPoint(),S._PivotTranslation),S._PivotTmpVector.copyFromFloats(1,1,1),S._PivotTmpVector.subtractInPlace(h.scaling),S._PivotTmpVector.multiplyInPlace(S._PivotTranslation),h.position.addInPlace(S._PivotTmpVector))),S._PivotCached++},S._RestorePivotPoint=function(h){h&&!S._OldPivotPoint.equalsToFloats(0,0,0)&&S._PivotCached===1&&(h.setPivotPoint(S._OldPivotPoint),h._postMultiplyPivotMatrix=S._PivotPostMultiplyPivotMatrix,S._PivotTmpVector.copyFromFloats(1,1,1),S._PivotTmpVector.subtractInPlace(h.scaling),S._PivotTmpVector.multiplyInPlace(S._PivotTranslation),h.position.subtractInPlace(S._PivotTmpVector)),this._PivotCached--},S._PivotCached=0,S._OldPivotPoint=new E.e,S._PivotTranslation=new E.e,S._PivotTmpVector=new E.e,S._PivotPostMultiplyPivotMatrix=!1,S}()},function(p,s,c){c.d(s,"a",function(){return R});var E=c(4),m=c(114),S=c(43),h=c(2),C=c(101),R=function(){function I(b,f,x,P,A,T,_,g,M){g===void 0&&(g=!0),M===void 0&&(M=!0),this.materialIndex=b,this.verticesStart=f,this.verticesCount=x,this.indexStart=P,this.indexCount=A,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=T,this._renderingMesh=_||T,M&&T.subMeshes.push(this),this._trianglePlanes=[],this._id=T.subMeshes.length-1,g&&(this.refreshBoundingInfo(),T.computeWorldMatrix(!0))}return Object.defineProperty(I.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(b){this._materialDefines=b},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"effect",{get:function(){var b;return(b=this._effectOverride)!==null&&b!==void 0?b:this._materialEffect},enumerable:!1,configurable:!0}),I.prototype.setEffect=function(b,f){f===void 0&&(f=null),this._materialEffect!==b?(this._materialDefines=f,this._materialEffect=b):b||(this._materialDefines=null)},I.AddToMesh=function(b,f,x,P,A,T,_,g){return g===void 0&&(g=!0),new I(b,f,x,P,A,T,_,g)},Object.defineProperty(I.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),I.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},I.prototype.setBoundingInfo=function(b){return this._boundingInfo=b,this},I.prototype.getMesh=function(){return this._mesh},I.prototype.getRenderingMesh=function(){return this._renderingMesh},I.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},I.prototype.getEffectiveMesh=function(){var b=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return b||this._renderingMesh},I.prototype.getMaterial=function(){var b=this._renderingMesh.material;if(b==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(b)){var f=b.getSubMaterial(this.materialIndex);return this._currentMaterial!==f&&(this._currentMaterial=f,this._materialDefines=null),f}return b},I.prototype._IsMultiMaterial=function(b){return b.getSubMaterial!==void 0},I.prototype.refreshBoundingInfo=function(b){if(b===void 0&&(b=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(b||(b=this._renderingMesh.getVerticesData(E.b.PositionKind)),!b)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var f,x=this._renderingMesh.getIndices();if(this.indexStart===0&&this.indexCount===x.length){var P=this._renderingMesh.getBoundingInfo();f={minimum:P.minimum.clone(),maximum:P.maximum.clone()}}else f=Object(C.b)(b,x,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(f.minimum,f.maximum):this._boundingInfo=new S.a(f.minimum,f.maximum),this},I.prototype._checkCollision=function(b){return this.getBoundingInfo()._checkCollision(b)},I.prototype.updateBoundingInfo=function(b){var f=this.getBoundingInfo();return f||(this.refreshBoundingInfo(),f=this.getBoundingInfo()),f&&f.update(b),this},I.prototype.isInFrustum=function(b){var f=this.getBoundingInfo();return!!f&&f.isInFrustum(b,this._mesh.cullingStrategy)},I.prototype.isCompletelyInFrustum=function(b){var f=this.getBoundingInfo();return!!f&&f.isCompletelyInFrustum(b)},I.prototype.render=function(b){return this._renderingMesh.render(this,b,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},I.prototype._getLinesIndexBuffer=function(b,f){if(!this._linesIndexBuffer){for(var x=[],P=this.indexStart;P<this.indexStart+this.indexCount;P+=3)x.push(b[P],b[P+1],b[P+1],b[P+2],b[P+2],b[P]);this._linesIndexBuffer=f.createIndexBuffer(x),this._linesIndexCount=x.length}return this._linesIndexBuffer},I.prototype.canIntersects=function(b){var f=this.getBoundingInfo();return!!f&&b.intersectsBox(f.boundingBox)},I.prototype.intersects=function(b,f,x,P,A){var T=this.getMaterial();if(!T)return null;var _=3,g=!1;switch(T.fillMode){case h.a.MATERIAL_PointListDrawMode:case h.a.MATERIAL_LineListDrawMode:case h.a.MATERIAL_LineLoopDrawMode:case h.a.MATERIAL_LineStripDrawMode:case h.a.MATERIAL_TriangleFanDrawMode:return null;case h.a.MATERIAL_TriangleStripDrawMode:_=1,g=!0}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?x.length?this._intersectLines(b,f,x,this._mesh.intersectionThreshold,P):this._intersectUnIndexedLines(b,f,x,this._mesh.intersectionThreshold,P):!x.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(b,f,x,P,A):this._intersectTriangles(b,f,x,_,g,P,A)},I.prototype._intersectLines=function(b,f,x,P,A){for(var T=null,_=this.indexStart;_<this.indexStart+this.indexCount;_+=2){var g=f[x[_]],M=f[x[_+1]],O=b.intersectionSegment(g,M,P);if(!(O<0)&&(A||!T||O<T.distance)&&((T=new m.a(null,null,O)).faceId=_/2,A))break}return T},I.prototype._intersectUnIndexedLines=function(b,f,x,P,A){for(var T=null,_=this.verticesStart;_<this.verticesStart+this.verticesCount;_+=2){var g=f[_],M=f[_+1],O=b.intersectionSegment(g,M,P);if(!(O<0)&&(A||!T||O<T.distance)&&((T=new m.a(null,null,O)).faceId=_/2,A))break}return T},I.prototype._intersectTriangles=function(b,f,x,P,A,T,_){for(var g=null,M=-1,O=this.indexStart;O<this.indexStart+this.indexCount;O+=P){M++;var N=x[O],V=x[O+1],U=x[O+2];if(A&&U===4294967295)O+=2;else{var L=f[N],j=f[V],Y=f[U];if(!_||_(L,j,Y,b)){var W=b.intersectsTriangle(L,j,Y);if(W){if(W.distance<0)continue;if((T||!g||W.distance<g.distance)&&((g=W).faceId=M,T))break}}}}return g},I.prototype._intersectUnIndexedTriangles=function(b,f,x,P,A){for(var T=null,_=this.verticesStart;_<this.verticesStart+this.verticesCount;_+=3){var g=f[_],M=f[_+1],O=f[_+2];if(!A||A(g,M,O,b)){var N=b.intersectsTriangle(g,M,O);if(N){if(N.distance<0)continue;if((P||!T||N.distance<T.distance)&&((T=N).faceId=_/3,P))break}}}return T},I.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},I.prototype.clone=function(b,f){var x=new I(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,b,f,!1);if(!this.IsGlobal){var P=this.getBoundingInfo();if(!P)return x;x._boundingInfo=new S.a(P.minimum,P.maximum)}return x},I.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var b=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(b,1)},I.prototype.getClassName=function(){return"SubMesh"},I.CreateFromIndices=function(b,f,x,P,A){for(var T=Number.MAX_VALUE,_=-Number.MAX_VALUE,g=(A||P).getIndices(),M=f;M<f+x;M++){var O=g[M];O<T&&(T=O),O>_&&(_=O)}return new I(b,T,_-T+1,f,x,P,A)},I}()},function(p,s,c){c.d(s,"a",function(){return R});var E=c(1),m=c(8),S=c(10),h=c(2),C=(c(126),c(70)),R=function(I){function b(f,x,P,A,T,_,g){P===void 0&&(P=null),T===void 0&&(T=h.a.TEXTURE_TRILINEAR_SAMPLINGMODE),_===void 0&&(_=h.a.TEXTUREFORMAT_RGBA);var M=I.call(this,null,P,!A,g,T,void 0,void 0,void 0,void 0,_)||this;M.name=f,M.wrapU=S.a.CLAMP_ADDRESSMODE,M.wrapV=S.a.CLAMP_ADDRESSMODE,M._generateMipMaps=A;var O=M._getEngine();if(!O)return M;x.getContext?(M._canvas=x,M._texture=O.createDynamicTexture(x.width,x.height,A,T)):(M._canvas=C.a.CreateCanvas(1,1),x.width||x.width===0?M._texture=O.createDynamicTexture(x.width,x.height,A,T):M._texture=O.createDynamicTexture(x,x,A,T));var N=M.getSize();return M._canvas.width=N.width,M._canvas.height=N.height,M._context=M._canvas.getContext("2d"),M}return Object(E.d)(b,I),b.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),b.prototype._recreate=function(f){this._canvas.width=f.width,this._canvas.height=f.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(f.width,f.height,this._generateMipMaps,this.samplingMode)},b.prototype.scale=function(f){var x=this.getSize();x.width*=f,x.height*=f,this._recreate(x)},b.prototype.scaleTo=function(f,x){var P=this.getSize();P.width=f,P.height=x,this._recreate(P)},b.prototype.getContext=function(){return this._context},b.prototype.clear=function(){var f=this.getSize();this._context.fillRect(0,0,f.width,f.height)},b.prototype.update=function(f,x){x===void 0&&(x=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,f===void 0||f,x,this._format||void 0)},b.prototype.drawText=function(f,x,P,A,T,_,g,M){M===void 0&&(M=!0);var O=this.getSize();if(_&&(this._context.fillStyle=_,this._context.fillRect(0,0,O.width,O.height)),this._context.font=A,x==null){var N=this._context.measureText(f);x=(O.width-N.width)/2}if(P==null){var V=parseInt(A.replace(/\D/g,""));P=O.height/2+V/3.65}this._context.fillStyle=T||"",this._context.fillText(f,x,P),M&&this.update(g)},b.prototype.clone=function(){var f=this.getScene();if(!f)return this;var x=this.getSize(),P=new b(this.name,x,f,this._generateMipMaps);return P.hasAlpha=this.hasAlpha,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P},b.prototype.serialize=function(){var f=this.getScene();f&&!f.isReady()&&m.a.Warn("The scene must be ready before serializing the dynamic texture");var x=I.prototype.serialize.call(this);return this._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x},b.prototype._IsCanvasElement=function(f){return f.toDataURL!==void 0},b.prototype._rebuild=function(){this.update()},b}(S.a)},function(p,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(9),S=c(7),h=c(16);h.a.CreateBox=function(R){var I,b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],f=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],x=[],P=R.width||R.size||1,A=R.height||R.size||1,T=R.depth||R.size||1,_=R.wrap||!1,g=R.topBaseAt===void 0?1:R.topBaseAt,M=R.bottomBaseAt===void 0?0:R.bottomBaseAt,O=[2,0,3,1][g=(g+4)%4],N=[2,0,1,3][M=(M+4)%4],V=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(_){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],V=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var U=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],j=[17,18,19,16],Y=[22,23,20,21];O>0;)U.unshift(U.pop()),j.unshift(j.pop()),O--;for(;N>0;)L.unshift(L.pop()),Y.unshift(Y.pop()),N--;U=U.flat(),L=L.flat(),V=V.concat(U).concat(L),b.push(j[0],j[2],j[3],j[0],j[1],j[2]),b.push(Y[0],Y[2],Y[3],Y[0],Y[1],Y[2])}var W=[P/2,A/2,T/2];I=V.reduce(function(G,$,he){return G.concat($*W[he%3])},[]);for(var ie=R.sideOrientation===0?0:R.sideOrientation||h.a.DEFAULTSIDE,re=R.faceUV||new Array(6),ye=R.faceColors,ve=[],ue=0;ue<6;ue++)re[ue]===void 0&&(re[ue]=new E.f(0,0,1,1)),ye&&ye[ue]===void 0&&(ye[ue]=new m.b(1,1,1,1));for(var oe=0;oe<6;oe++)if(x.push(re[oe].z,re[oe].w),x.push(re[oe].x,re[oe].w),x.push(re[oe].x,re[oe].y),x.push(re[oe].z,re[oe].y),ye)for(var Z=0;Z<4;Z++)ve.push(ye[oe].r,ye[oe].g,ye[oe].b,ye[oe].a);h.a._ComputeSides(ie,I,b,f,x,R.frontUVs,R.backUVs);var J=new h.a;if(J.indices=b,J.positions=I,J.normals=f,J.uvs=x,ye){var B=ie===h.a.DOUBLESIDE?ve.concat(ve):ve;J.colors=B}return J},S.a.CreateBox=function(R,I,b,f,x){b===void 0&&(b=null);var P={size:I,sideOrientation:x,updatable:f};return C.CreateBox(R,P,b)};var C=function(){function R(){}return R.CreateBox=function(I,b,f){f===void 0&&(f=null);var x=new S.a(I,f);return b.sideOrientation=S.a._GetDefaultSideOrientation(b.sideOrientation),x._originalBuilderSideOrientation=b.sideOrientation,h.a.CreateBox(b).applyToMesh(x,b.updatable),x},R}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){function S(h,C,R,I){this.normal=new E.e(h,C,R),this.d=I}return S.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},S.prototype.clone=function(){return new S(this.normal.x,this.normal.y,this.normal.z,this.d)},S.prototype.getClassName=function(){return"Plane"},S.prototype.getHashCode=function(){var h=this.normal.getHashCode();return h=397*h^(0|this.d)},S.prototype.normalize=function(){var h=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),C=0;return h!==0&&(C=1/h),this.normal.x*=C,this.normal.y*=C,this.normal.z*=C,this.d*=C,this},S.prototype.transform=function(h){var C=S._TmpMatrix;h.invertToRef(C);var R=C.m,I=this.normal.x,b=this.normal.y,f=this.normal.z,x=this.d;return new S(I*R[0]+b*R[1]+f*R[2]+x*R[3],I*R[4]+b*R[5]+f*R[6]+x*R[7],I*R[8]+b*R[9]+f*R[10]+x*R[11],I*R[12]+b*R[13]+f*R[14]+x*R[15])},S.prototype.dotCoordinate=function(h){return this.normal.x*h.x+this.normal.y*h.y+this.normal.z*h.z+this.d},S.prototype.copyFromPoints=function(h,C,R){var I,b=C.x-h.x,f=C.y-h.y,x=C.z-h.z,P=R.x-h.x,A=R.y-h.y,T=R.z-h.z,_=f*T-x*A,g=x*P-b*T,M=b*A-f*P,O=Math.sqrt(_*_+g*g+M*M);return I=O!==0?1/O:0,this.normal.x=_*I,this.normal.y=g*I,this.normal.z=M*I,this.d=-(this.normal.x*h.x+this.normal.y*h.y+this.normal.z*h.z),this},S.prototype.isFrontFacingTo=function(h,C){return E.e.Dot(this.normal,h)<=C},S.prototype.signedDistanceTo=function(h){return E.e.Dot(h,this.normal)+this.d},S.FromArray=function(h){return new S(h[0],h[1],h[2],h[3])},S.FromPoints=function(h,C,R){var I=new S(0,0,0,0);return I.copyFromPoints(h,C,R),I},S.FromPositionAndNormal=function(h,C){var R=new S(0,0,0,0);return C.normalize(),R.normal=C,R.d=-(C.x*h.x+C.y*h.y+C.z*h.z),R},S.SignedDistanceToPlaneFromPositionAndNormal=function(h,C,R){var I=-(C.x*h.x+C.y*h.y+C.z*h.z);return E.e.Dot(R,C)+I},S._TmpMatrix=E.a.Identity(),S}()},function(p,s,c){c.d(s,"a",function(){return b});var E=c(7),m=c(20),S=c(6),h=c(0),C=c(18),R=c(39),I=c(60),b=(c(84),function(){function f(x){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new S.c,this.onDragStartObservable=new S.c,this.onDragEndObservable=new S.c,this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(A){return!0},this._tmpVector=new h.e(0,0,0),this._alternatePickedPoint=new h.e(0,0,0),this._worldDragAxis=new h.e(0,0,0),this._targetPosition=new h.e(0,0,0),this._attachedToElement=!1,this._startDragRay=new R.a(new h.e,new h.e),this._lastPointerRay={},this._dragDelta=new h.e,this._pointA=new h.e(0,0,0),this._pointC=new h.e(0,0,0),this._localAxis=new h.e(0,0,0),this._lookAt=new h.e(0,0,0),this._options=x||{};var P=0;if(this._options.dragAxis&&P++,this._options.dragPlaneNormal&&P++,P>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(f.prototype,"options",{get:function(){return this._options},set:function(x){this._options=x},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!1,configurable:!0}),f.prototype.init=function(){},f.prototype.attach=function(x,P){var A=this;this._scene=x.getScene(),this.attachedNode=x,f._planeScene||(this._debugMode?f._planeScene=this._scene:(f._planeScene=new m.a(this._scene.getEngine(),{virtual:!0}),f._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){f._planeScene.dispose(),f._planeScene=null}))),this._dragPlane=E.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,f._planeScene,!1,E.a.DOUBLESIDE),this.lastDragPosition=new h.e(0,0,0);var T=P||function(_){return A.attachedNode==_||_.isDescendantOf(A.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(_,g){if(A.enabled){if(_.type==C.a.POINTERDOWN)A.startAndReleaseDragOnPointerEvents&&!A.dragging&&_.pickInfo&&_.pickInfo.hit&&_.pickInfo.pickedMesh&&_.pickInfo.pickedPoint&&_.pickInfo.ray&&T(_.pickInfo.pickedMesh)&&A._startDrag(_.event.pointerId,_.pickInfo.ray,_.pickInfo.pickedPoint);else if(_.type==C.a.POINTERUP)A.startAndReleaseDragOnPointerEvents&&A.currentDraggingPointerID==_.event.pointerId&&A.releaseDrag();else if(_.type==C.a.POINTERMOVE){var M=_.event.pointerId;if(A.currentDraggingPointerID===f._AnyMouseID&&M!==f._AnyMouseID){var O=_.event;(O.pointerType==="mouse"||!A._scene.getEngine().hostInformation.isMobile&&O instanceof MouseEvent)&&(A._lastPointerRay[A.currentDraggingPointerID]&&(A._lastPointerRay[M]=A._lastPointerRay[A.currentDraggingPointerID],delete A._lastPointerRay[A.currentDraggingPointerID]),A.currentDraggingPointerID=M)}A._lastPointerRay[M]||(A._lastPointerRay[M]=new R.a(new h.e,new h.e)),_.pickInfo&&_.pickInfo.ray&&(A._lastPointerRay[M].origin.copyFrom(_.pickInfo.ray.origin),A._lastPointerRay[M].direction.copyFrom(_.pickInfo.ray.direction),A.currentDraggingPointerID==M&&A.dragging&&A._moveDrag(_.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){A._moving&&A.moveAttached&&(I.a._RemoveAndStorePivotPoint(A.attachedNode),A._targetPosition.subtractToRef(A.attachedNode.absolutePosition,A._tmpVector),A._tmpVector.scaleInPlace(A.dragDeltaRatio),A.attachedNode.getAbsolutePosition().addToRef(A._tmpVector,A._tmpVector),A.validateDrag(A._tmpVector)&&A.attachedNode.setAbsolutePosition(A._tmpVector),I.a._RestorePivotPoint(A.attachedNode))})},f.prototype.releaseDrag=function(){if(this.dragging&&(this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID})),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedToElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera){if(this._scene.activeCamera.getClassName()==="ArcRotateCamera"){var x=this._scene.activeCamera;x.attachControl(!x.inputs||x.inputs.noPreventDefault,x._useCtrlForPanning,x._panningMouseButton)}else this._scene.activeCamera.attachControl(!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault);this._attachedToElement=!1}},f.prototype.startDrag=function(x,P,A){x===void 0&&(x=f._AnyMouseID),this._startDrag(x,P,A);var T=this._lastPointerRay[x];x===f._AnyMouseID&&(T=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),T&&this._moveDrag(T)},f.prototype._startDrag=function(x,P,A){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){I.a._RemoveAndStorePivotPoint(this.attachedNode),P?(this._startDragRay.direction.copyFrom(P.direction),this._startDragRay.origin.copyFrom(P.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,A||this._tmpVector);var T=this._pickWithRayOnDragPlane(this._startDragRay);T&&(this.dragging=!0,this.currentDraggingPointerID=x,this.lastDragPosition.copyFrom(T),this.onDragStartObservable.notifyObservers({dragPlanePoint:T,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedToElement?(this._scene.activeCamera.detachControl(),this._attachedToElement=!0):this._attachedToElement=!1)),I.a._RestorePivotPoint(this.attachedNode)}},f.prototype._moveDrag=function(x){this._moving=!0;var P=this._pickWithRayOnDragPlane(x);if(P){this.updateDragPlane&&this._updateDragPlanePosition(x,P);var A=0;this._options.dragAxis?(this.useObjectOrientationForDragging?h.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),P.subtractToRef(this.lastDragPosition,this._tmpVector),A=h.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(A,this._dragDelta)):(A=this._dragDelta.length(),P.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:A,delta:this._dragDelta,dragPlanePoint:P,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(P)}},f.prototype._pickWithRayOnDragPlane=function(x){var P=this;if(!x)return null;var A=Math.acos(h.e.Dot(this._dragPlane.forward,x.direction));if(A>Math.PI/2&&(A=Math.PI-A),this.maxDragAngle>0&&A>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(x.direction),this.attachedNode.absolutePosition.subtractToRef(x.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*h.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var T=h.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-T,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var _=f._planeScene.pickWithRay(x,function(g){return g==P._dragPlane});return _&&_.hit&&_.pickedMesh&&_.pickedPoint?_.pickedPoint:null},f.prototype._updateDragPlanePosition=function(x,P){this._pointA.copyFrom(P),this._options.dragAxis?(this.useObjectOrientationForDragging?h.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),x.origin.subtractToRef(this._pointA,this._pointC),this._pointC.normalize(),Math.abs(h.e.Dot(this._localAxis,this._pointC))>.999?Math.abs(h.e.Dot(h.e.UpReadOnly,this._pointC))>.999?this._lookAt.copyFrom(h.e.Right()):this._lookAt.copyFrom(h.e.UpReadOnly):(h.e.CrossToRef(this._localAxis,this._pointC,this._lookAt),h.e.CrossToRef(this._localAxis,this._lookAt,this._lookAt),this._lookAt.normalize()),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?h.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(x.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},f.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},f._AnyMouseID=-2,f}())},function(p,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S}),c.d(s,"c",function(){return h});var E=c(1),m=function(){function C(){}return C.KEYDOWN=1,C.KEYUP=2,C}(),S=function(C,R){this.type=C,this.event=R},h=function(C){function R(I,b){var f=C.call(this,I,b)||this;return f.type=I,f.event=b,f.skipOnPointerObservable=!1,f}return Object(E.d)(R,C),R}(S)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return m.prototype.unBindMesh=function(){this._mesh=null},m.prototype.addFallback=function(S,h){this._defines[S]||(S<this._currentRank&&(this._currentRank=S),S>this._maxRank&&(this._maxRank=S),this._defines[S]=new Array),this._defines[S].push(h)},m.prototype.addCPUSkinningFallback=function(S,h){this._mesh=h,S<this._currentRank&&(this._currentRank=S),S>this._maxRank&&(this._maxRank=S)},Object.defineProperty(m.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),m.prototype.reduce=function(S,h){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,S=S.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),h._bonesComputationForcedToCPU=!0;for(var C=this._mesh.getScene(),R=0;R<C.meshes.length;R++){var I=C.meshes[R];if(I.material){if(I.computeBonesUsingShaders&&I.numBoneInfluencers!==0){if(I.material.getEffect()===h)I.computeBonesUsingShaders=!1;else if(I.subMeshes){for(var b=0,f=I.subMeshes;b<f.length;b++)if(f[b].effect===h){I.computeBonesUsingShaders=!1;break}}}}else!this._mesh.material&&I.computeBonesUsingShaders&&I.numBoneInfluencers>0&&(I.computeBonesUsingShaders=!1)}}else{var x=this._defines[this._currentRank];if(x)for(R=0;R<x.length;R++)S=S.replace("#define "+x[R],"");this._currentRank++}return S},m}()},function(p,s,c){c.d(s,"a",function(){return C});var E=c(1),m=c(25),S=c(37),h=c(11),C=function(R){function I(b,f){var x=R.call(this,b,f,!0)||this;return f.multiMaterials.push(x),x.subMaterials=new Array,x._storeEffectOnSubMeshes=!0,x}return Object(E.d)(I,R),Object.defineProperty(I.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(b){this._subMaterials=b,this._hookArray(b)},enumerable:!1,configurable:!0}),I.prototype.getChildren=function(){return this.subMaterials},I.prototype._hookArray=function(b){var f=this,x=b.push;b.push=function(){for(var A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];var _=x.apply(b,A);return f._markAllSubMeshesAsTexturesDirty(),_};var P=b.splice;b.splice=function(A,T){var _=P.apply(b,[A,T]);return f._markAllSubMeshesAsTexturesDirty(),_}},I.prototype.getSubMaterial=function(b){return b<0||b>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[b]},I.prototype.getActiveTextures=function(){var b;return(b=R.prototype.getActiveTextures.call(this)).concat.apply(b,this.subMaterials.map(function(f){return f?f.getActiveTextures():[]}))},I.prototype.hasTexture=function(b){var f;if(R.prototype.hasTexture.call(this,b))return!0;for(var x=0;x<this.subMaterials.length;x++)if((f=this.subMaterials[x])===null||f===void 0?void 0:f.hasTexture(b))return!0;return!1},I.prototype.getClassName=function(){return"MultiMaterial"},I.prototype.isReadyForSubMesh=function(b,f,x){for(var P=0;P<this.subMaterials.length;P++){var A=this.subMaterials[P];if(A){if(A._storeEffectOnSubMeshes){if(!A.isReadyForSubMesh(b,f,x))return!1;continue}if(!A.isReady(b))return!1}}return!0},I.prototype.clone=function(b,f){for(var x=new I(b,this.getScene()),P=0;P<this.subMaterials.length;P++){var A=null,T=this.subMaterials[P];A=f&&T?T.clone(b+"-"+T.name):this.subMaterials[P],x.subMaterials.push(A)}return x},I.prototype.serialize=function(){var b={};b.name=this.name,b.id=this.id,S.a&&(b.tags=S.a.GetTags(this)),b.materials=[];for(var f=0;f<this.subMaterials.length;f++){var x=this.subMaterials[f];x?b.materials.push(x.id):b.materials.push(null)}return b},I.prototype.dispose=function(b,f,x){var P=this.getScene();if(P){if(x)for(var A=0;A<this.subMaterials.length;A++){var T=this.subMaterials[A];T&&T.dispose(b,f)}(A=P.multiMaterials.indexOf(this))>=0&&P.multiMaterials.splice(A,1),R.prototype.dispose.call(this,b,f)}},I.ParseMultiMaterial=function(b,f){var x=new I(b.name,f);x.id=b.id,S.a&&S.a.AddTagsTo(x,b.tags);for(var P=0;P<b.materials.length;P++){var A=b.materials[P];A?x.subMaterials.push(f.getLastMaterialByID(A)):x.subMaterials.push(null)}return x},I}(m.a);h.a.RegisteredTypes["BABYLON.MultiMaterial"]=C},function(p,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){}return Object.defineProperty(S,"ForceFullSceneLoadingForIncremental",{get:function(){return S._ForceFullSceneLoadingForIncremental},set:function(h){S._ForceFullSceneLoadingForIncremental=h},enumerable:!1,configurable:!0}),Object.defineProperty(S,"ShowLoadingScreen",{get:function(){return S._ShowLoadingScreen},set:function(h){S._ShowLoadingScreen=h},enumerable:!1,configurable:!0}),Object.defineProperty(S,"loggingLevel",{get:function(){return S._loggingLevel},set:function(h){S._loggingLevel=h},enumerable:!1,configurable:!0}),Object.defineProperty(S,"CleanBoneMatrixWeights",{get:function(){return S._CleanBoneMatrixWeights},set:function(h){S._CleanBoneMatrixWeights=h},enumerable:!1,configurable:!0}),S._ForceFullSceneLoadingForIncremental=!1,S._ShowLoadingScreen=!0,S._CleanBoneMatrixWeights=!1,S._loggingLevel=E.a.SCENELOADER_NO_LOGGING,S}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.CreateCanvas=function(S,h){if(typeof document=="undefined")return new OffscreenCanvas(S,h);var C=document.createElement("canvas");return C.width=S,C.height=h,C},m}()},function(p,s,c){c.d(s,"a",function(){return A});var E=c(0),m=c(9),S=c(16),h=c(4),C=c(61),R=c(69),I=c(43),b=c(2),f=c(12),x=c(37),P=c(101),A=function(){function T(_,g,M,O,N){O===void 0&&(O=!1),N===void 0&&(N=null),this.delayLoadState=b.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=_,this.uniqueId=g.getUniqueId(),this._engine=g.getEngine(),this._meshes=[],this._scene=g,this._vertexBuffers={},this._indices=[],this._updatable=O,M?this.setAllVerticesData(M,O):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),N&&(this.applyToMesh(N),N.computeWorldMatrix(!0))}return Object.defineProperty(T.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(_){this._boundingBias?this._boundingBias.copyFrom(_):this._boundingBias=_.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),T.CreateGeometryForMesh=function(_){var g=new T(T.RandomId(),_.getScene());return g.applyToMesh(_),g},Object.defineProperty(T.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),T.prototype.getScene=function(){return this._scene},T.prototype.getEngine=function(){return this._engine},T.prototype.isReady=function(){return this.delayLoadState===b.a.DELAYLOADSTATE_LOADED||this.delayLoadState===b.a.DELAYLOADSTATE_NONE},Object.defineProperty(T.prototype,"doNotSerialize",{get:function(){for(var _=0;_<this._meshes.length;_++)if(!this._meshes[_].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),T.prototype._rebuild=function(){for(var _ in this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[_]._rebuild()},T.prototype.setAllVerticesData=function(_,g){_.applyToGeometry(this,g),this.notifyUpdate()},T.prototype.setVerticesData=function(_,g,M,O){M===void 0&&(M=!1),M&&Array.isArray(g)&&(g=new Float32Array(g));var N=new h.b(this._engine,g,_,M,this._meshes.length===0,O);this.setVerticesBuffer(N)},T.prototype.removeVerticesData=function(_){this._vertexBuffers[_]&&(this._vertexBuffers[_].dispose(),delete this._vertexBuffers[_])},T.prototype.setVerticesBuffer=function(_,g){g===void 0&&(g=null);var M=_.getKind();if(this._vertexBuffers[M]&&this._vertexBuffers[M].dispose(),this._vertexBuffers[M]=_,M===h.b.PositionKind){var O=_.getData();g!=null?this._totalVertices=g:O!=null&&(this._totalVertices=O.length/(_.byteStride/4)),this._updateExtend(O),this._resetPointsArrayCache();for(var N=this._meshes,V=N.length,U=0;U<V;U++){var L=N[U];L._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),L._createGlobalSubMesh(!1),L.computeWorldMatrix(!0)}}this.notifyUpdate(M),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},T.prototype.updateVerticesDataDirectly=function(_,g,M,O){O===void 0&&(O=!1);var N=this.getVertexBuffer(_);N&&(N.updateDirectly(g,M,O),this.notifyUpdate(_))},T.prototype.updateVerticesData=function(_,g,M){M===void 0&&(M=!1);var O=this.getVertexBuffer(_);O&&(O.update(g),_===h.b.PositionKind&&this._updateBoundingInfo(M,g),this.notifyUpdate(_))},T.prototype._updateBoundingInfo=function(_,g){if(_&&this._updateExtend(g),this._resetPointsArrayCache(),_)for(var M=0,O=this._meshes;M<O.length;M++){var N=O[M];N._boundingInfo?N._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):N._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum);for(var V=0,U=N.subMeshes;V<U.length;V++)U[V].refreshBoundingInfo()}},T.prototype._bind=function(_,g){if(_){g===void 0&&(g=this._indexBuffer);var M=this.getVertexBuffers();M&&(g==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[_.key]||(this._vertexArrayObjects[_.key]=this._engine.recordVertexArrayObject(M,g,_)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[_.key],g)):this._engine.bindBuffers(M,g,_))}},T.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},T.prototype.getVerticesData=function(_,g,M){var O=this.getVertexBuffer(_);if(!O)return null;var N=O.getData();if(!N)return null;var V=O.getSize()*h.b.GetTypeByteLength(O.type),U=this._totalVertices*O.getSize();if(O.type!==h.b.FLOAT||O.byteStride!==V){var L=[];return O.forEach(U,function(re){return L.push(re)}),L}if(!(N instanceof Array||N instanceof Float32Array)||O.byteOffset!==0||N.length!==U){if(N instanceof Array){var j=O.byteOffset/4;return f.b.Slice(N,j,j+U)}if(N instanceof ArrayBuffer)return new Float32Array(N,O.byteOffset,U);if(j=N.byteOffset+O.byteOffset,M||g&&this._meshes.length!==1){var Y=new Float32Array(U),W=new Float32Array(N.buffer,j,U);return Y.set(W),Y}var ie=j%4;return ie&&(j=Math.max(0,j-ie)),new Float32Array(N.buffer,j,U)}return M||g&&this._meshes.length!==1?f.b.Slice(N):N},T.prototype.isVertexBufferUpdatable=function(_){var g=this._vertexBuffers[_];return!!g&&g.isUpdatable()},T.prototype.getVertexBuffer=function(_){return this.isReady()?this._vertexBuffers[_]:null},T.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},T.prototype.isVerticesDataPresent=function(_){return this._vertexBuffers?this._vertexBuffers[_]!==void 0:!!this._delayInfo&&this._delayInfo.indexOf(_)!==-1},T.prototype.getVerticesDataKinds=function(){var _,g=[];if(!this._vertexBuffers&&this._delayInfo)for(_ in this._delayInfo)g.push(_);else for(_ in this._vertexBuffers)g.push(_);return g},T.prototype.updateIndices=function(_,g,M){if(M===void 0&&(M=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var O=_.length!==this._indices.length;if(M||(this._indices=_.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,_,g),O)for(var N=0,V=this._meshes;N<V.length;N++)V[N]._createGlobalSubMesh(!0)}else this.setIndices(_,null,!0)},T.prototype.setIndices=function(_,g,M){g===void 0&&(g=null),M===void 0&&(M=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=_,this._indexBufferIsUpdatable=M,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,M)),g!=null&&(this._totalVertices=g);for(var O=0,N=this._meshes;O<N.length;O++)N[O]._createGlobalSubMesh(!0);this.notifyUpdate()},T.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},T.prototype.getIndices=function(_,g){if(!this.isReady())return null;var M=this._indices;if(g||_&&this._meshes.length!==1){for(var O=M.length,N=[],V=0;V<O;V++)N.push(M[V]);return N}return M},T.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},T.prototype._releaseVertexArrayObject=function(_){_===void 0&&(_=null),_&&this._vertexArrayObjects&&this._vertexArrayObjects[_.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[_.key]),delete this._vertexArrayObjects[_.key])},T.prototype.releaseForMesh=function(_,g){var M=this._meshes,O=M.indexOf(_);O!==-1&&(M.splice(O,1),_._geometry=null,M.length===0&&g&&this.dispose())},T.prototype.applyToMesh=function(_){if(_._geometry!==this){var g=_._geometry;g&&g.releaseForMesh(_);var M=this._meshes;_._geometry=this,this._scene.pushGeometry(this),M.push(_),this.isReady()?this._applyToMesh(_):_._boundingInfo=this._boundingInfo}},T.prototype._updateExtend=function(_){_===void 0&&(_=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(_||(_=this.getVerticesData(h.b.PositionKind)),this._extend=Object(P.a)(_,0,this._totalVertices,this.boundingBias,3))},T.prototype._applyToMesh=function(_){var g=this._meshes.length;for(var M in this._vertexBuffers){g===1&&this._vertexBuffers[M].create();var O=this._vertexBuffers[M].getBuffer();O&&(O.references=g),M===h.b.PositionKind&&(this._extend||this._updateExtend(),_._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),_._createGlobalSubMesh(!1),_._updateBoundingInfo())}g===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=g),_._syncGeometryWithMorphTargetManager(),_.synchronizeInstances()},T.prototype.notifyUpdate=function(_){this.onGeometryUpdated&&this.onGeometryUpdated(this,_);for(var g=0,M=this._meshes;g<M.length;g++)M[g]._markSubMeshesAsAttributesDirty()},T.prototype.load=function(_,g){this.delayLoadState!==b.a.DELAYLOADSTATE_LOADING&&(this.isReady()?g&&g():(this.delayLoadState=b.a.DELAYLOADSTATE_LOADING,this._queueLoad(_,g)))},T.prototype._queueLoad=function(_,g){var M=this;this.delayLoadingFile&&(_._addPendingData(this),_._loadFile(this.delayLoadingFile,function(O){if(M._delayLoadingFunction){M._delayLoadingFunction(JSON.parse(O),M),M.delayLoadState=b.a.DELAYLOADSTATE_LOADED,M._delayInfo=[],_._removePendingData(M);for(var N=M._meshes,V=N.length,U=0;U<V;U++)M._applyToMesh(N[U]);g&&g()}},void 0,!0))},T.prototype.toLeftHanded=function(){var _=this.getIndices(!1);if(_!=null&&_.length>0){for(var g=0;g<_.length;g+=3){var M=_[g+0];_[g+0]=_[g+2],_[g+2]=M}this.setIndices(_)}var O=this.getVerticesData(h.b.PositionKind,!1);if(O!=null&&O.length>0){for(g=0;g<O.length;g+=3)O[g+2]=-O[g+2];this.setVerticesData(h.b.PositionKind,O,!1)}var N=this.getVerticesData(h.b.NormalKind,!1);if(N!=null&&N.length>0){for(g=0;g<N.length;g+=3)N[g+2]=-N[g+2];this.setVerticesData(h.b.NormalKind,N,!1)}},T.prototype._resetPointsArrayCache=function(){this._positions=null},T.prototype._generatePointsArray=function(){if(this._positions)return!0;var _=this.getVerticesData(h.b.PositionKind);if(!_||_.length===0)return!1;for(var g=3*this._positionsCache.length,M=this._positionsCache.length;g<_.length;g+=3,++M)this._positionsCache[M]=E.e.FromArray(_,g);for(g=0,M=0;g<_.length;g+=3,++M)this._positionsCache[M].set(_[0+g],_[1+g],_[2+g]);return this._positionsCache.length=_.length/3,this._positions=this._positionsCache,!0},T.prototype.isDisposed=function(){return this._isDisposed},T.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var _ in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[_]);this._vertexArrayObjects={}}},T.prototype.dispose=function(){var _,g=this._meshes,M=g.length;for(_=0;_<M;_++)this.releaseForMesh(g[_]);for(var O in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[O].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=b.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},T.prototype.copy=function(_){var g=new S.a;g.indices=[];var M=this.getIndices();if(M)for(var O=0;O<M.length;O++)g.indices.push(M[O]);var N,V=!1,U=!1;for(N in this._vertexBuffers){var L=this.getVerticesData(N);if(L&&(L instanceof Float32Array?g.set(new Float32Array(L),N):g.set(L.slice(0),N),!U)){var j=this.getVertexBuffer(N);j&&(U=!(V=j.isUpdatable()))}}var Y=new T(_,this._scene,g,V);for(N in Y.delayLoadState=this.delayLoadState,Y.delayLoadingFile=this.delayLoadingFile,Y._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)Y._delayInfo=Y._delayInfo||[],Y._delayInfo.push(N);return Y._boundingInfo=new I.a(this._extend.minimum,this._extend.maximum),Y},T.prototype.serialize=function(){var _={};return _.id=this.id,_.updatable=this._updatable,x.a&&x.a.HasTags(this)&&(_.tags=x.a.GetTags(this)),_},T.prototype.toNumberArray=function(_){return Array.isArray(_)?_:Array.prototype.slice.call(_)},T.prototype.serializeVerticeData=function(){var _=this.serialize();return this.isVerticesDataPresent(h.b.PositionKind)&&(_.positions=this.toNumberArray(this.getVerticesData(h.b.PositionKind)),this.isVertexBufferUpdatable(h.b.PositionKind)&&(_.positions._updatable=!0)),this.isVerticesDataPresent(h.b.NormalKind)&&(_.normals=this.toNumberArray(this.getVerticesData(h.b.NormalKind)),this.isVertexBufferUpdatable(h.b.NormalKind)&&(_.normals._updatable=!0)),this.isVerticesDataPresent(h.b.TangentKind)&&(_.tangets=this.toNumberArray(this.getVerticesData(h.b.TangentKind)),this.isVertexBufferUpdatable(h.b.TangentKind)&&(_.tangets._updatable=!0)),this.isVerticesDataPresent(h.b.UVKind)&&(_.uvs=this.toNumberArray(this.getVerticesData(h.b.UVKind)),this.isVertexBufferUpdatable(h.b.UVKind)&&(_.uvs._updatable=!0)),this.isVerticesDataPresent(h.b.UV2Kind)&&(_.uv2s=this.toNumberArray(this.getVerticesData(h.b.UV2Kind)),this.isVertexBufferUpdatable(h.b.UV2Kind)&&(_.uv2s._updatable=!0)),this.isVerticesDataPresent(h.b.UV3Kind)&&(_.uv3s=this.toNumberArray(this.getVerticesData(h.b.UV3Kind)),this.isVertexBufferUpdatable(h.b.UV3Kind)&&(_.uv3s._updatable=!0)),this.isVerticesDataPresent(h.b.UV4Kind)&&(_.uv4s=this.toNumberArray(this.getVerticesData(h.b.UV4Kind)),this.isVertexBufferUpdatable(h.b.UV4Kind)&&(_.uv4s._updatable=!0)),this.isVerticesDataPresent(h.b.UV5Kind)&&(_.uv5s=this.toNumberArray(this.getVerticesData(h.b.UV5Kind)),this.isVertexBufferUpdatable(h.b.UV5Kind)&&(_.uv5s._updatable=!0)),this.isVerticesDataPresent(h.b.UV6Kind)&&(_.uv6s=this.toNumberArray(this.getVerticesData(h.b.UV6Kind)),this.isVertexBufferUpdatable(h.b.UV6Kind)&&(_.uv6s._updatable=!0)),this.isVerticesDataPresent(h.b.ColorKind)&&(_.colors=this.toNumberArray(this.getVerticesData(h.b.ColorKind)),this.isVertexBufferUpdatable(h.b.ColorKind)&&(_.colors._updatable=!0)),this.isVerticesDataPresent(h.b.MatricesIndicesKind)&&(_.matricesIndices=this.toNumberArray(this.getVerticesData(h.b.MatricesIndicesKind)),_.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(h.b.MatricesIndicesKind)&&(_.matricesIndices._updatable=!0)),this.isVerticesDataPresent(h.b.MatricesWeightsKind)&&(_.matricesWeights=this.toNumberArray(this.getVerticesData(h.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(h.b.MatricesWeightsKind)&&(_.matricesWeights._updatable=!0)),_.indices=this.toNumberArray(this.getIndices()),_},T.ExtractFromMesh=function(_,g){var M=_._geometry;return M?M.copy(g):null},T.RandomId=function(){return f.b.RandomId()},T._ImportGeometry=function(_,g){var M=g.getScene(),O=_.geometryId;if(O){var N=M.getGeometryByID(O);N&&N.applyToMesh(g)}else if(_ instanceof ArrayBuffer){var V=g._binaryInfo;if(V.positionsAttrDesc&&V.positionsAttrDesc.count>0){var U=new Float32Array(_,V.positionsAttrDesc.offset,V.positionsAttrDesc.count);g.setVerticesData(h.b.PositionKind,U,!1)}if(V.normalsAttrDesc&&V.normalsAttrDesc.count>0){var L=new Float32Array(_,V.normalsAttrDesc.offset,V.normalsAttrDesc.count);g.setVerticesData(h.b.NormalKind,L,!1)}if(V.tangetsAttrDesc&&V.tangetsAttrDesc.count>0){var j=new Float32Array(_,V.tangetsAttrDesc.offset,V.tangetsAttrDesc.count);g.setVerticesData(h.b.TangentKind,j,!1)}if(V.uvsAttrDesc&&V.uvsAttrDesc.count>0){var Y=new Float32Array(_,V.uvsAttrDesc.offset,V.uvsAttrDesc.count);g.setVerticesData(h.b.UVKind,Y,!1)}if(V.uvs2AttrDesc&&V.uvs2AttrDesc.count>0){var W=new Float32Array(_,V.uvs2AttrDesc.offset,V.uvs2AttrDesc.count);g.setVerticesData(h.b.UV2Kind,W,!1)}if(V.uvs3AttrDesc&&V.uvs3AttrDesc.count>0){var ie=new Float32Array(_,V.uvs3AttrDesc.offset,V.uvs3AttrDesc.count);g.setVerticesData(h.b.UV3Kind,ie,!1)}if(V.uvs4AttrDesc&&V.uvs4AttrDesc.count>0){var re=new Float32Array(_,V.uvs4AttrDesc.offset,V.uvs4AttrDesc.count);g.setVerticesData(h.b.UV4Kind,re,!1)}if(V.uvs5AttrDesc&&V.uvs5AttrDesc.count>0){var ye=new Float32Array(_,V.uvs5AttrDesc.offset,V.uvs5AttrDesc.count);g.setVerticesData(h.b.UV5Kind,ye,!1)}if(V.uvs6AttrDesc&&V.uvs6AttrDesc.count>0){var ve=new Float32Array(_,V.uvs6AttrDesc.offset,V.uvs6AttrDesc.count);g.setVerticesData(h.b.UV6Kind,ve,!1)}if(V.colorsAttrDesc&&V.colorsAttrDesc.count>0){var ue=new Float32Array(_,V.colorsAttrDesc.offset,V.colorsAttrDesc.count);g.setVerticesData(h.b.ColorKind,ue,!1,V.colorsAttrDesc.stride)}if(V.matricesIndicesAttrDesc&&V.matricesIndicesAttrDesc.count>0){for(var oe=new Int32Array(_,V.matricesIndicesAttrDesc.offset,V.matricesIndicesAttrDesc.count),Z=[],J=0;J<oe.length;J++){var B=oe[J];Z.push(255&B),Z.push((65280&B)>>8),Z.push((16711680&B)>>16),Z.push(B>>24&255)}g.setVerticesData(h.b.MatricesIndicesKind,Z,!1)}if(V.matricesIndicesExtraAttrDesc&&V.matricesIndicesExtraAttrDesc.count>0){for(oe=new Int32Array(_,V.matricesIndicesExtraAttrDesc.offset,V.matricesIndicesExtraAttrDesc.count),Z=[],J=0;J<oe.length;J++)B=oe[J],Z.push(255&B),Z.push((65280&B)>>8),Z.push((16711680&B)>>16),Z.push(B>>24&255);g.setVerticesData(h.b.MatricesIndicesExtraKind,Z,!1)}if(V.matricesWeightsAttrDesc&&V.matricesWeightsAttrDesc.count>0){var G=new Float32Array(_,V.matricesWeightsAttrDesc.offset,V.matricesWeightsAttrDesc.count);g.setVerticesData(h.b.MatricesWeightsKind,G,!1)}if(V.indicesAttrDesc&&V.indicesAttrDesc.count>0){var $=new Int32Array(_,V.indicesAttrDesc.offset,V.indicesAttrDesc.count);g.setIndices($,null)}if(V.subMeshesAttrDesc&&V.subMeshesAttrDesc.count>0){var he=new Int32Array(_,V.subMeshesAttrDesc.offset,5*V.subMeshesAttrDesc.count);for(g.subMeshes=[],J=0;J<V.subMeshesAttrDesc.count;J++){var se=he[5*J+0],q=he[5*J+1],H=he[5*J+2],X=he[5*J+3],ee=he[5*J+4];C.a.AddToMesh(se,q,H,X,ee,g)}}}else if(_.positions&&_.normals&&_.indices){if(g.setVerticesData(h.b.PositionKind,_.positions,_.positions._updatable),g.setVerticesData(h.b.NormalKind,_.normals,_.normals._updatable),_.tangents&&g.setVerticesData(h.b.TangentKind,_.tangents,_.tangents._updatable),_.uvs&&g.setVerticesData(h.b.UVKind,_.uvs,_.uvs._updatable),_.uvs2&&g.setVerticesData(h.b.UV2Kind,_.uvs2,_.uvs2._updatable),_.uvs3&&g.setVerticesData(h.b.UV3Kind,_.uvs3,_.uvs3._updatable),_.uvs4&&g.setVerticesData(h.b.UV4Kind,_.uvs4,_.uvs4._updatable),_.uvs5&&g.setVerticesData(h.b.UV5Kind,_.uvs5,_.uvs5._updatable),_.uvs6&&g.setVerticesData(h.b.UV6Kind,_.uvs6,_.uvs6._updatable),_.colors&&g.setVerticesData(h.b.ColorKind,m.b.CheckColors4(_.colors,_.positions.length/3),_.colors._updatable),_.matricesIndices)if(_.matricesIndices._isExpanded)delete _.matricesIndices._isExpanded,g.setVerticesData(h.b.MatricesIndicesKind,_.matricesIndices,_.matricesIndices._updatable);else{for(Z=[],J=0;J<_.matricesIndices.length;J++){var Q=_.matricesIndices[J];Z.push(255&Q),Z.push((65280&Q)>>8),Z.push((16711680&Q)>>16),Z.push(Q>>24&255)}g.setVerticesData(h.b.MatricesIndicesKind,Z,_.matricesIndices._updatable)}if(_.matricesIndicesExtra)if(_.matricesIndicesExtra._isExpanded)delete _.matricesIndices._isExpanded,g.setVerticesData(h.b.MatricesIndicesExtraKind,_.matricesIndicesExtra,_.matricesIndicesExtra._updatable);else{for(Z=[],J=0;J<_.matricesIndicesExtra.length;J++)Q=_.matricesIndicesExtra[J],Z.push(255&Q),Z.push((65280&Q)>>8),Z.push((16711680&Q)>>16),Z.push(Q>>24&255);g.setVerticesData(h.b.MatricesIndicesExtraKind,Z,_.matricesIndicesExtra._updatable)}_.matricesWeights&&(T._CleanMatricesWeights(_,g),g.setVerticesData(h.b.MatricesWeightsKind,_.matricesWeights,_.matricesWeights._updatable)),_.matricesWeightsExtra&&g.setVerticesData(h.b.MatricesWeightsExtraKind,_.matricesWeightsExtra,_.matricesWeights._updatable),g.setIndices(_.indices,null)}if(_.subMeshes){g.subMeshes=[];for(var te=0;te<_.subMeshes.length;te++){var ge=_.subMeshes[te];C.a.AddToMesh(ge.materialIndex,ge.verticesStart,ge.verticesCount,ge.indexStart,ge.indexCount,g)}}g._shouldGenerateFlatShading&&(g.convertToFlatShadedMesh(),g._shouldGenerateFlatShading=!1),g.computeWorldMatrix(!0),M.onMeshImportedObservable.notifyObservers(g)},T._CleanMatricesWeights=function(_,g){if(R.a.CleanBoneMatrixWeights){var M=0;if(_.skeletonId>-1){var O=g.getScene().getLastSkeletonByID(_.skeletonId);if(O){M=O.bones.length;for(var N=g.getVerticesData(h.b.MatricesIndicesKind),V=g.getVerticesData(h.b.MatricesIndicesExtraKind),U=_.matricesWeights,L=_.matricesWeightsExtra,j=_.numBoneInfluencer,Y=U.length,W=0;W<Y;W+=4){for(var ie=0,re=-1,ye=0;ye<4;ye++)ie+=ve=U[W+ye],ve<.001&&re<0&&(re=ye);if(L)for(ye=0;ye<4;ye++){var ve;ie+=ve=L[W+ye],ve<.001&&re<0&&(re=ye+4)}if((re<0||re>j-1)&&(re=j-1),ie>.001){var ue=1/ie;for(ye=0;ye<4;ye++)U[W+ye]*=ue;if(L)for(ye=0;ye<4;ye++)L[W+ye]*=ue}else re>=4?(L[W+re-4]=1-ie,V[W+re-4]=M):(U[W+re]=1-ie,N[W+re]=M)}g.setVerticesData(h.b.MatricesIndicesKind,N),_.matricesWeightsExtra&&g.setVerticesData(h.b.MatricesIndicesExtraKind,V)}}}},T.Parse=function(_,g,M){if(g.getGeometryByID(_.id))return null;var O=new T(_.id,g,void 0,_.updatable);return x.a&&x.a.AddTagsTo(O,_.tags),_.delayLoadingFile?(O.delayLoadState=b.a.DELAYLOADSTATE_NOTLOADED,O.delayLoadingFile=M+_.delayLoadingFile,O._boundingInfo=new I.a(E.e.FromArray(_.boundingBoxMinimum),E.e.FromArray(_.boundingBoxMaximum)),O._delayInfo=[],_.hasUVs&&O._delayInfo.push(h.b.UVKind),_.hasUVs2&&O._delayInfo.push(h.b.UV2Kind),_.hasUVs3&&O._delayInfo.push(h.b.UV3Kind),_.hasUVs4&&O._delayInfo.push(h.b.UV4Kind),_.hasUVs5&&O._delayInfo.push(h.b.UV5Kind),_.hasUVs6&&O._delayInfo.push(h.b.UV6Kind),_.hasColors&&O._delayInfo.push(h.b.ColorKind),_.hasMatricesIndices&&O._delayInfo.push(h.b.MatricesIndicesKind),_.hasMatricesWeights&&O._delayInfo.push(h.b.MatricesWeightsKind),O._delayLoadingFunction=S.a.ImportVertexData):S.a.ImportVertexData(_,O),g.pushGeometry(O,!0),O},T}()},function(p,s,c){c.d(s,"e",function(){return E}),c.d(s,"c",function(){return C}),c.d(s,"a",function(){return R}),c.d(s,"b",function(){return I}),c.d(s,"f",function(){return b}),c.d(s,"g",function(){return f}),c.d(s,"d",function(){return x});var E,m=c(14),S=c(0),h=c(28);(function(P){P[P.CW=0]="CW",P[P.CCW=1]="CCW"})(E||(E={}));var C=function(){function P(){}return P.Interpolate=function(A,T,_,g,M){for(var O=1-3*g+3*T,N=3*g-6*T,V=3*T,U=A,L=0;L<5;L++){var j=U*U;U-=(O*(j*U)+N*j+V*U-A)*(1/(3*O*j+2*N*U+V)),U=Math.min(1,Math.max(0,U))}return 3*Math.pow(1-U,2)*U*_+3*(1-U)*Math.pow(U,2)*M+Math.pow(U,3)},P}(),R=function(){function P(A){this._radians=A,this._radians<0&&(this._radians+=2*Math.PI)}return P.prototype.degrees=function(){return 180*this._radians/Math.PI},P.prototype.radians=function(){return this._radians},P.BetweenTwoPoints=function(A,T){var _=T.subtract(A);return new P(Math.atan2(_.y,_.x))},P.FromRadians=function(A){return new P(A)},P.FromDegrees=function(A){return new P(A*Math.PI/180)},P}(),I=function(P,A,T){this.startPoint=P,this.midPoint=A,this.endPoint=T;var _=Math.pow(A.x,2)+Math.pow(A.y,2),g=(Math.pow(P.x,2)+Math.pow(P.y,2)-_)/2,M=(_-Math.pow(T.x,2)-Math.pow(T.y,2))/2,O=(P.x-A.x)*(A.y-T.y)-(A.x-T.x)*(P.y-A.y);this.centerPoint=new S.d((g*(A.y-T.y)-M*(P.y-A.y))/O,((P.x-A.x)*M-(A.x-T.x)*g)/O),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=R.BetweenTwoPoints(this.centerPoint,this.startPoint);var N=this.startAngle.degrees(),V=R.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),U=R.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();V-N>180&&(V-=360),V-N<-180&&(V+=360),U-V>180&&(U-=360),U-V<-180&&(U+=360),this.orientation=V-N<0?E.CW:E.CCW,this.angle=R.FromDegrees(this.orientation===E.CW?N-U:U-N)},b=function(){function P(A,T){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new S.d(A,T))}return P.prototype.addLineTo=function(A,T){if(this.closed)return this;var _=new S.d(A,T),g=this._points[this._points.length-1];return this._points.push(_),this._length+=_.subtract(g).length(),this},P.prototype.addArcTo=function(A,T,_,g,M){if(M===void 0&&(M=36),this.closed)return this;var O=this._points[this._points.length-1],N=new S.d(A,T),V=new S.d(_,g),U=new I(O,N,V),L=U.angle.radians()/M;U.orientation===E.CW&&(L*=-1);for(var j=U.startAngle.radians()+L,Y=0;Y<M;Y++){var W=Math.cos(j)*U.radius+U.centerPoint.x,ie=Math.sin(j)*U.radius+U.centerPoint.y;this.addLineTo(W,ie),j+=L}return this},P.prototype.close=function(){return this.closed=!0,this},P.prototype.length=function(){var A=this._length;if(this.closed){var T=this._points[this._points.length-1];A+=this._points[0].subtract(T).length()}return A},P.prototype.getPoints=function(){return this._points},P.prototype.getPointAtLengthPosition=function(A){if(A<0||A>1)return S.d.Zero();for(var T=A*this.length(),_=0,g=0;g<this._points.length;g++){var M=(g+1)%this._points.length,O=this._points[g],N=this._points[M].subtract(O),V=N.length()+_;if(T>=_&&T<=V){var U=N.normalize(),L=T-_;return new S.d(O.x+U.x*L,O.y+U.y*L)}_=V}return S.d.Zero()},P.StartingAt=function(A,T){return new P(A,T)},P}(),f=function(){function P(A,T,_,g){T===void 0&&(T=null),g===void 0&&(g=!1),this.path=A,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:S.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:S.a.Identity()};for(var M=0;M<A.length;M++)this._curve[M]=A[M].clone();this._raw=_||!1,this._alignTangentsWithPath=g,this._compute(T,g)}return P.prototype.getCurve=function(){return this._curve},P.prototype.getPoints=function(){return this._curve},P.prototype.length=function(){return this._distances[this._distances.length-1]},P.prototype.getTangents=function(){return this._tangents},P.prototype.getNormals=function(){return this._normals},P.prototype.getBinormals=function(){return this._binormals},P.prototype.getDistances=function(){return this._distances},P.prototype.getPointAt=function(A){return this._updatePointAtData(A).point},P.prototype.getTangentAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},P.prototype.getNormalAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},P.prototype.getBinormalAt=function(A,T){return T===void 0&&(T=!1),this._updatePointAtData(A,T),T?S.e.TransformCoordinates(S.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},P.prototype.getDistanceAt=function(A){return this.length()*A},P.prototype.getPreviousPointIndexAt=function(A){return this._updatePointAtData(A),this._pointAtData.previousPointArrayIndex},P.prototype.getSubPositionAt=function(A){return this._updatePointAtData(A),this._pointAtData.subPosition},P.prototype.getClosestPositionTo=function(A){for(var T=Number.MAX_VALUE,_=0,g=0;g<this._curve.length-1;g++){var M=this._curve[g+0],O=this._curve[g+1].subtract(M).normalize(),N=this._distances[g+1]-this._distances[g+0],V=Math.min(Math.max(S.e.Dot(O,A.subtract(M).normalize()),0)*S.e.Distance(M,A)/N,1),U=S.e.Distance(M.add(O.scale(V*N)),A);U<T&&(T=U,_=(this._distances[g+0]+N*V)/this.length())}return _},P.prototype.slice=function(A,T){if(A===void 0&&(A=0),T===void 0&&(T=1),A<0&&(A=1- -1*A%1),T<0&&(T=1- -1*T%1),A>T){var _=A;A=T,T=_}var g=this.getCurve(),M=this.getPointAt(A),O=this.getPreviousPointIndexAt(A),N=this.getPointAt(T),V=this.getPreviousPointIndexAt(T)+1,U=[];return A!==0&&(O++,U.push(M)),U.push.apply(U,g.slice(O,V)),T===1&&A!==1||U.push(N),new P(U,this.getNormalAt(A),this._raw,this._alignTangentsWithPath)},P.prototype.update=function(A,T,_){T===void 0&&(T=null),_===void 0&&(_=!1);for(var g=0;g<A.length;g++)this._curve[g].x=A[g].x,this._curve[g].y=A[g].y,this._curve[g].z=A[g].z;return this._compute(T,_),this},P.prototype._compute=function(A,T){T===void 0&&(T=!1);var _=this._curve.length;if(!(_<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[_-1]=this._curve[_-1].subtract(this._curve[_-2]),this._raw||this._tangents[_-1].normalize();var g,M,O,N,V,U=this._tangents[0],L=this._normalVector(U,A);this._normals[0]=L,this._raw||this._normals[0].normalize(),this._binormals[0]=S.e.Cross(U,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var j=1;j<_;j++)g=this._getLastNonNullVector(j),j<_-1&&(M=this._getFirstNonNullVector(j),this._tangents[j]=T?M:g.add(M),this._tangents[j].normalize()),this._distances[j]=this._distances[j-1]+this._curve[j].subtract(this._curve[j-1]).length(),O=this._tangents[j],V=this._binormals[j-1],this._normals[j]=S.e.Cross(V,O),this._raw||(this._normals[j].length()===0?(N=this._normals[j-1],this._normals[j]=N.clone()):this._normals[j].normalize()),this._binormals[j]=S.e.Cross(O,this._normals[j]),this._raw||this._binormals[j].normalize();this._pointAtData.id=NaN}},P.prototype._getFirstNonNullVector=function(A){for(var T=1,_=this._curve[A+T].subtract(this._curve[A]);_.length()===0&&A+T+1<this._curve.length;)T++,_=this._curve[A+T].subtract(this._curve[A]);return _},P.prototype._getLastNonNullVector=function(A){for(var T=1,_=this._curve[A].subtract(this._curve[A-T]);_.length()===0&&A>T+1;)T++,_=this._curve[A].subtract(this._curve[A-T]);return _},P.prototype._normalVector=function(A,T){var _,g,M=A.length();return M===0&&(M=1),T==null?(g=m.a.WithinEpsilon(Math.abs(A.y)/M,1,h.a)?m.a.WithinEpsilon(Math.abs(A.x)/M,1,h.a)?m.a.WithinEpsilon(Math.abs(A.z)/M,1,h.a)?S.e.Zero():new S.e(0,0,1):new S.e(1,0,0):new S.e(0,-1,0),_=S.e.Cross(A,g)):(_=S.e.Cross(A,T),S.e.CrossToRef(_,A,_)),_.normalize(),_},P.prototype._updatePointAtData=function(A,T){if(T===void 0&&(T=!1),this._pointAtData.id===A)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=A;var _=this.getPoints();if(A<=0)return this._setPointAtData(0,0,_[0],0,T);if(A>=1)return this._setPointAtData(1,1,_[_.length-1],_.length-1,T);for(var g,M=_[0],O=0,N=A*this.length(),V=1;V<_.length;V++){g=_[V];var U=S.e.Distance(M,g);if((O+=U)===N)return this._setPointAtData(A,1,g,V,T);if(O>N){var L=(O-N)/U,j=M.subtract(g),Y=g.add(j.scaleInPlace(L));return this._setPointAtData(A,1-L,Y,V-1,T)}M=g}return this._pointAtData},P.prototype._setPointAtData=function(A,T,_,g,M){return this._pointAtData.point=_,this._pointAtData.position=A,this._pointAtData.subPosition=T,this._pointAtData.previousPointArrayIndex=g,this._pointAtData.interpolateReady=M,M&&this._updateInterpolationMatrix(),this._pointAtData},P.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=S.a.Identity();var A=this._pointAtData.previousPointArrayIndex;if(A!==this._tangents.length-1){var T=A+1,_=this._tangents[A].clone(),g=this._normals[A].clone(),M=this._binormals[A].clone(),O=this._tangents[T].clone(),N=this._normals[T].clone(),V=this._binormals[T].clone(),U=S.b.RotationQuaternionFromAxis(g,M,_),L=S.b.RotationQuaternionFromAxis(N,V,O);S.b.Slerp(U,L,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},P}(),x=function(){function P(A){this._length=0,this._points=A,this._length=this._computeLength(A)}return P.CreateQuadraticBezier=function(A,T,_,g){g=g>2?g:3;for(var M=new Array,O=function(V,U,L,j){return(1-V)*(1-V)*U+2*V*(1-V)*L+V*V*j},N=0;N<=g;N++)M.push(new S.e(O(N/g,A.x,T.x,_.x),O(N/g,A.y,T.y,_.y),O(N/g,A.z,T.z,_.z)));return new P(M)},P.CreateCubicBezier=function(A,T,_,g,M){M=M>3?M:4;for(var O=new Array,N=function(U,L,j,Y,W){return(1-U)*(1-U)*(1-U)*L+3*U*(1-U)*(1-U)*j+3*U*U*(1-U)*Y+U*U*U*W},V=0;V<=M;V++)O.push(new S.e(N(V/M,A.x,T.x,_.x,g.x),N(V/M,A.y,T.y,_.y,g.y),N(V/M,A.z,T.z,_.z,g.z)));return new P(O)},P.CreateHermiteSpline=function(A,T,_,g,M){for(var O=new Array,N=1/M,V=0;V<=M;V++)O.push(S.e.Hermite(A,T,_,g,V*N));return new P(O)},P.CreateCatmullRomSpline=function(A,T,_){var g=new Array,M=1/T,O=0;if(_){for(var N=A.length,V=0;V<N;V++){O=0;for(var U=0;U<T;U++)g.push(S.e.CatmullRom(A[V%N],A[(V+1)%N],A[(V+2)%N],A[(V+3)%N],O)),O+=M}g.push(g[0])}else{var L=new Array;for(L.push(A[0].clone()),Array.prototype.push.apply(L,A),L.push(A[A.length-1].clone()),V=0;V<L.length-3;V++)for(O=0,U=0;U<T;U++)g.push(S.e.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],O)),O+=M;V--,g.push(S.e.CatmullRom(L[V],L[V+1],L[V+2],L[V+3],O))}return new P(g)},P.prototype.getPoints=function(){return this._points},P.prototype.length=function(){return this._length},P.prototype.continue=function(A){for(var T=this._points[this._points.length-1],_=this._points.slice(),g=A.getPoints(),M=1;M<g.length;M++)_.push(g[M].subtract(g[0]).add(T));return new P(_)},P.prototype._computeLength=function(A){for(var T=0,_=1;_<A.length;_++)T+=A[_].subtract(A[_-1]).length();return T},P}()},function(p,s,c){c.d(s,"a",function(){return _});var E=c(1),m=c(3),S=c(0),h=c(4),C=c(10),R=c(15),I=c(25),b=c(11),f=c(9),x=c(67),P=c(49),A=c(13),T={effect:null,subMesh:null},_=function(g){function M(O,N,V,U){U===void 0&&(U={});var L=g.call(this,O,N)||this;return L._textures={},L._textureArrays={},L._floats={},L._ints={},L._floatsArrays={},L._colors3={},L._colors3Arrays={},L._colors4={},L._colors4Arrays={},L._vectors2={},L._vectors3={},L._vectors4={},L._matrices={},L._matrixArrays={},L._matrices3x3={},L._matrices2x2={},L._vectors2Arrays={},L._vectors3Arrays={},L._vectors4Arrays={},L._cachedWorldViewMatrix=new S.a,L._cachedWorldViewProjectionMatrix=new S.a,L._multiview=!1,L._shaderPath=V,L._options=Object(E.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},U),L}return Object(E.d)(M,g),Object.defineProperty(M.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(O){this._shaderPath=O},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),M.prototype.getClassName=function(){return"ShaderMaterial"},M.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},M.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},M.prototype._checkUniform=function(O){this._options.uniforms.indexOf(O)===-1&&this._options.uniforms.push(O)},M.prototype.setTexture=function(O,N){return this._options.samplers.indexOf(O)===-1&&this._options.samplers.push(O),this._textures[O]=N,this},M.prototype.setTextureArray=function(O,N){return this._options.samplers.indexOf(O)===-1&&this._options.samplers.push(O),this._checkUniform(O),this._textureArrays[O]=N,this},M.prototype.setFloat=function(O,N){return this._checkUniform(O),this._floats[O]=N,this},M.prototype.setInt=function(O,N){return this._checkUniform(O),this._ints[O]=N,this},M.prototype.setFloats=function(O,N){return this._checkUniform(O),this._floatsArrays[O]=N,this},M.prototype.setColor3=function(O,N){return this._checkUniform(O),this._colors3[O]=N,this},M.prototype.setColor3Array=function(O,N){return this._checkUniform(O),this._colors3Arrays[O]=N.reduce(function(V,U){return U.toArray(V,V.length),V},[]),this},M.prototype.setColor4=function(O,N){return this._checkUniform(O),this._colors4[O]=N,this},M.prototype.setColor4Array=function(O,N){return this._checkUniform(O),this._colors4Arrays[O]=N.reduce(function(V,U){return U.toArray(V,V.length),V},[]),this},M.prototype.setVector2=function(O,N){return this._checkUniform(O),this._vectors2[O]=N,this},M.prototype.setVector3=function(O,N){return this._checkUniform(O),this._vectors3[O]=N,this},M.prototype.setVector4=function(O,N){return this._checkUniform(O),this._vectors4[O]=N,this},M.prototype.setMatrix=function(O,N){return this._checkUniform(O),this._matrices[O]=N,this},M.prototype.setMatrices=function(O,N){this._checkUniform(O);for(var V=new Float32Array(16*N.length),U=0;U<N.length;U++)N[U].copyToArray(V,16*U);return this._matrixArrays[O]=V,this},M.prototype.setMatrix3x3=function(O,N){return this._checkUniform(O),this._matrices3x3[O]=N,this},M.prototype.setMatrix2x2=function(O,N){return this._checkUniform(O),this._matrices2x2[O]=N,this},M.prototype.setArray2=function(O,N){return this._checkUniform(O),this._vectors2Arrays[O]=N,this},M.prototype.setArray3=function(O,N){return this._checkUniform(O),this._vectors3Arrays[O]=N,this},M.prototype.setArray4=function(O,N){return this._checkUniform(O),this._vectors4Arrays[O]=N,this},M.prototype._checkCache=function(O,N){return!O||!this._effect||this._effect.defines.indexOf("#define INSTANCES")!==-1===N},M.prototype.isReadyForSubMesh=function(O,N,V){return this.isReady(O,V)},M.prototype.isReady=function(O,N){var V,U;if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var L=this.getScene(),j=L.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===L.getRenderId()&&this._checkCache(O,N))return!0;var Y=[],W=[],ie=new x.a;j.getCaps().multiview&&L.activeCamera&&L.activeCamera.outputRenderTarget&&L.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,Y.push("#define MULTIVIEW"),this._options.uniforms.indexOf("viewProjection")!==-1&&this._options.uniforms.push("viewProjectionR")===-1&&this._options.uniforms.push("viewProjectionR"));for(var re=0;re<this._options.defines.length;re++)Y.push(this._options.defines[re]);for(re=0;re<this._options.attributes.length;re++)W.push(this._options.attributes[re]);O&&O.isVerticesDataPresent(h.b.ColorKind)&&(W.push(h.b.ColorKind),Y.push("#define VERTEXCOLOR")),N&&(Y.push("#define INSTANCES"),R.a.PushAttributesForInstances(W),(O==null?void 0:O.hasThinInstances)&&Y.push("#define THIN_INSTANCES"));var ye=0;if(O&&O.useBones&&O.computeBonesUsingShaders&&O.skeleton){W.push(h.b.MatricesIndicesKind),W.push(h.b.MatricesWeightsKind),O.numBoneInfluencers>4&&(W.push(h.b.MatricesIndicesExtraKind),W.push(h.b.MatricesWeightsExtraKind));var ve=O.skeleton;ye=O.numBoneInfluencers,Y.push("#define NUM_BONE_INFLUENCERS "+ye),ie.addCPUSkinningFallback(0,O),ve.isUsingTextureForMatrices?(Y.push("#define BONETEXTURE"),this._options.uniforms.indexOf("boneTextureWidth")===-1&&this._options.uniforms.push("boneTextureWidth"),this._options.samplers.indexOf("boneSampler")===-1&&this._options.samplers.push("boneSampler")):(Y.push("#define BonesPerMesh "+(ve.bones.length+1)),this._options.uniforms.indexOf("mBones")===-1&&this._options.uniforms.push("mBones"))}else Y.push("#define NUM_BONE_INFLUENCERS 0");for(var ue in this._textures)if(!this._textures[ue].isReady())return!1;O&&this._shouldTurnAlphaTestOn(O)&&Y.push("#define ALPHATEST");var oe=this._shaderPath,Z=this._options.uniforms,J=this._options.uniformBuffers,B=this._options.samplers;this.customShaderNameResolve&&(Z=Z.slice(),J=J.slice(),B=B.slice(),oe=this.customShaderNameResolve(oe,Z,J,B,Y,W));var G=this._effect,$=Y.join(`
`);return this._cachedDefines!==$&&(this._cachedDefines=$,this._effect=j.createEffect(oe,{attributes:W,uniformsNames:Z,uniformBuffersNames:J,samplers:B,defines:$,fallbacks:ie,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:ye}},j),this._onEffectCreatedObservable&&(T.effect=this._effect,this._onEffectCreatedObservable.notifyObservers(T))),(U=!((V=this._effect)===null||V===void 0?void 0:V.isReady()))!==null&&U!==void 0&&!U&&(G!==this._effect&&L.resetCachedMaterial(),this._renderId=L.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},M.prototype.bindOnlyWorldMatrix=function(O,N){var V=this.getScene(),U=N??this._effect;U&&(this._options.uniforms.indexOf("world")!==-1&&U.setMatrix("world",O),this._options.uniforms.indexOf("worldView")!==-1&&(O.multiplyToRef(V.getViewMatrix(),this._cachedWorldViewMatrix),U.setMatrix("worldView",this._cachedWorldViewMatrix)),this._options.uniforms.indexOf("worldViewProjection")!==-1&&(O.multiplyToRef(V.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),U.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},M.prototype.bindForSubMesh=function(O,N,V){this.bind(O,N,V._effectOverride)},M.prototype.bind=function(O,N,V){this.bindOnlyWorldMatrix(O,V);var U=V??this._effect;if(U&&this.getScene().getCachedMaterial()!==this){var L;for(L in this._options.uniforms.indexOf("view")!==-1&&U.setMatrix("view",this.getScene().getViewMatrix()),this._options.uniforms.indexOf("projection")!==-1&&U.setMatrix("projection",this.getScene().getProjectionMatrix()),this._options.uniforms.indexOf("viewProjection")!==-1&&(U.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&U.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1&&U.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),R.a.BindBonesParameters(N,U),this._textures)U.setTexture(L,this._textures[L]);for(L in this._textureArrays)U.setTextureArray(L,this._textureArrays[L]);for(L in this._ints)U.setInt(L,this._ints[L]);for(L in this._floats)U.setFloat(L,this._floats[L]);for(L in this._floatsArrays)U.setArray(L,this._floatsArrays[L]);for(L in this._colors3)U.setColor3(L,this._colors3[L]);for(L in this._colors3Arrays)U.setArray3(L,this._colors3Arrays[L]);for(L in this._colors4){var j=this._colors4[L];U.setFloat4(L,j.r,j.g,j.b,j.a)}for(L in this._colors4Arrays)U.setArray4(L,this._colors4Arrays[L]);for(L in this._vectors2)U.setVector2(L,this._vectors2[L]);for(L in this._vectors3)U.setVector3(L,this._vectors3[L]);for(L in this._vectors4)U.setVector4(L,this._vectors4[L]);for(L in this._matrices)U.setMatrix(L,this._matrices[L]);for(L in this._matrixArrays)U.setMatrices(L,this._matrixArrays[L]);for(L in this._matrices3x3)U.setMatrix3x3(L,this._matrices3x3[L]);for(L in this._matrices2x2)U.setMatrix2x2(L,this._matrices2x2[L]);for(L in this._vectors2Arrays)U.setArray2(L,this._vectors2Arrays[L]);for(L in this._vectors3Arrays)U.setArray3(L,this._vectors3Arrays[L]);for(L in this._vectors4Arrays)U.setArray4(L,this._vectors4Arrays[L])}var Y=this._effect;this._effect=U,this._afterBind(N),this._effect=Y},M.prototype._afterBind=function(O){g.prototype._afterBind.call(this,O),this.getScene()._cachedEffect=this._effect},M.prototype.getActiveTextures=function(){var O=g.prototype.getActiveTextures.call(this);for(var N in this._textures)O.push(this._textures[N]);for(var N in this._textureArrays)for(var V=this._textureArrays[N],U=0;U<V.length;U++)O.push(V[U]);return O},M.prototype.hasTexture=function(O){if(g.prototype.hasTexture.call(this,O))return!0;for(var N in this._textures)if(this._textures[N]===O)return!0;for(var N in this._textureArrays)for(var V=this._textureArrays[N],U=0;U<V.length;U++)if(V[U]===O)return!0;return!1},M.prototype.clone=function(O){var N=this,V=m.a.Clone(function(){return new M(O,N.getScene(),N._shaderPath,N._options)},this);for(var U in V.name=O,V.id=O,typeof V._shaderPath=="object"&&(V._shaderPath=Object(E.a)({},V._shaderPath)),this._options=Object(E.a)({},this._options),Object.keys(this._options).forEach(function(L){var j=N._options[L];Array.isArray(j)&&(N._options[L]=j.slice(0))}),this._textures)V.setTexture(U,this._textures[U]);for(var U in this._floats)V.setFloat(U,this._floats[U]);for(var U in this._floatsArrays)V.setFloats(U,this._floatsArrays[U]);for(var U in this._colors3)V.setColor3(U,this._colors3[U]);for(var U in this._colors4)V.setColor4(U,this._colors4[U]);for(var U in this._vectors2)V.setVector2(U,this._vectors2[U]);for(var U in this._vectors3)V.setVector3(U,this._vectors3[U]);for(var U in this._vectors4)V.setVector4(U,this._vectors4[U]);for(var U in this._matrices)V.setMatrix(U,this._matrices[U]);for(var U in this._matrices3x3)V.setMatrix3x3(U,this._matrices3x3[U]);for(var U in this._matrices2x2)V.setMatrix2x2(U,this._matrices2x2[U]);return V},M.prototype.dispose=function(O,N,V){if(N){var U;for(U in this._textures)this._textures[U].dispose();for(U in this._textureArrays)for(var L=this._textureArrays[U],j=0;j<L.length;j++)L[j].dispose()}this._textures={},g.prototype.dispose.call(this,O,N,V)},M.prototype.serialize=function(){var O,N=m.a.Serialize(this);for(O in N.customType="BABYLON.ShaderMaterial",N.options=this._options,N.shaderPath=this._shaderPath,N.textures={},this._textures)N.textures[O]=this._textures[O].serialize();for(O in N.textureArrays={},this._textureArrays){N.textureArrays[O]=[];for(var V=this._textureArrays[O],U=0;U<V.length;U++)N.textureArrays[O].push(V[U].serialize())}for(O in N.floats={},this._floats)N.floats[O]=this._floats[O];for(O in N.FloatArrays={},this._floatsArrays)N.FloatArrays[O]=this._floatsArrays[O];for(O in N.colors3={},this._colors3)N.colors3[O]=this._colors3[O].asArray();for(O in N.colors3Arrays={},this._colors3Arrays)N.colors3Arrays[O]=this._colors3Arrays[O];for(O in N.colors4={},this._colors4)N.colors4[O]=this._colors4[O].asArray();for(O in N.colors4Arrays={},this._colors4Arrays)N.colors4Arrays[O]=this._colors4Arrays[O];for(O in N.vectors2={},this._vectors2)N.vectors2[O]=this._vectors2[O].asArray();for(O in N.vectors3={},this._vectors3)N.vectors3[O]=this._vectors3[O].asArray();for(O in N.vectors4={},this._vectors4)N.vectors4[O]=this._vectors4[O].asArray();for(O in N.matrices={},this._matrices)N.matrices[O]=this._matrices[O].asArray();for(O in N.matrixArray={},this._matrixArrays)N.matrixArray[O]=this._matrixArrays[O];for(O in N.matrices3x3={},this._matrices3x3)N.matrices3x3[O]=this._matrices3x3[O];for(O in N.matrices2x2={},this._matrices2x2)N.matrices2x2[O]=this._matrices2x2[O];for(O in N.vectors2Arrays={},this._vectors2Arrays)N.vectors2Arrays[O]=this._vectors2Arrays[O];for(O in N.vectors3Arrays={},this._vectors3Arrays)N.vectors3Arrays[O]=this._vectors3Arrays[O];for(O in N.vectors4Arrays={},this._vectors4Arrays)N.vectors4Arrays[O]=this._vectors4Arrays[O];return N},M.Parse=function(O,N,V){var U,L=m.a.Parse(function(){return new M(O.name,N,O.shaderPath,O.options)},O,N,V);for(U in O.textures)L.setTexture(U,C.a.Parse(O.textures[U],N,V));for(U in O.textureArrays){for(var j=O.textureArrays[U],Y=new Array,W=0;W<j.length;W++)Y.push(C.a.Parse(j[W],N,V));L.setTextureArray(U,Y)}for(U in O.floats)L.setFloat(U,O.floats[U]);for(U in O.floatsArrays)L.setFloats(U,O.floatsArrays[U]);for(U in O.colors3)L.setColor3(U,f.a.FromArray(O.colors3[U]));for(U in O.colors3Arrays){var ie=O.colors3Arrays[U].reduce(function(re,ye,ve){return ve%3==0?re.push([ye]):re[re.length-1].push(ye),re},[]).map(function(re){return f.a.FromArray(re)});L.setColor3Array(U,ie)}for(U in O.colors4)L.setColor4(U,f.b.FromArray(O.colors4[U]));for(U in O.colors4Arrays)ie=O.colors4Arrays[U].reduce(function(re,ye,ve){return ve%4==0?re.push([ye]):re[re.length-1].push(ye),re},[]).map(function(re){return f.b.FromArray(re)}),L.setColor4Array(U,ie);for(U in O.vectors2)L.setVector2(U,S.d.FromArray(O.vectors2[U]));for(U in O.vectors3)L.setVector3(U,S.e.FromArray(O.vectors3[U]));for(U in O.vectors4)L.setVector4(U,S.f.FromArray(O.vectors4[U]));for(U in O.matrices)L.setMatrix(U,S.a.FromArray(O.matrices[U]));for(U in O.matrixArray)L._matrixArrays[U]=new Float32Array(O.matrixArray[U]);for(U in O.matrices3x3)L.setMatrix3x3(U,O.matrices3x3[U]);for(U in O.matrices2x2)L.setMatrix2x2(U,O.matrices2x2[U]);for(U in O.vectors2Arrays)L.setArray2(U,O.vectors2Arrays[U]);for(U in O.vectors3Arrays)L.setArray3(U,O.vectors3Arrays[U]);for(U in O.vectors4Arrays)L.setArray4(U,O.vectors4Arrays[U]);return L},M.ParseFromFileAsync=function(O,N,V,U){var L=this;return U===void 0&&(U=""),new Promise(function(j,Y){var W=new P.a;W.addEventListener("readystatechange",function(){if(W.readyState==4)if(W.status==200){var ie=JSON.parse(W.responseText),re=L.Parse(ie,V||A.a.LastCreatedScene,U);O&&(re.name=O),j(re)}else Y("Unable to load the ShaderMaterial")}),W.open("GET",N),W.send()})},M.CreateFromSnippetAsync=function(O,N,V){var U=this;return V===void 0&&(V=""),new Promise(function(L,j){var Y=new P.a;Y.addEventListener("readystatechange",function(){if(Y.readyState==4)if(Y.status==200){var W=JSON.parse(JSON.parse(Y.responseText).jsonPayload),ie=JSON.parse(W.shaderMaterial),re=U.Parse(ie,N||A.a.LastCreatedScene,V);re.snippetId=O,L(re)}else j("Unable to load the snippet "+O)}),Y.open("GET",U.SnippetUrl+"/"+O.replace(/#/g,"/")),Y.send()})},M.SnippetUrl="https://snippet.babylonjs.com",M}(I.a);b.a.RegisteredTypes["BABYLON.ShaderMaterial"]=_},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.SetMatrixPrecision=function(S){if(m.MatrixTrackPrecisionChange=!1,S&&!m.MatrixUse64Bits&&m.MatrixTrackedMatrices)for(var h=0;h<m.MatrixTrackedMatrices.length;++h){var C=m.MatrixTrackedMatrices[h],R=C._m;C._m=new Array(16);for(var I=0;I<16;++I)C._m[I]=R[I]}m.MatrixUse64Bits=S,m.MatrixCurrentType=m.MatrixUse64Bits?Array:Float32Array,m.MatrixTrackedMatrices=null},m.MatrixUse64Bits=!1,m.MatrixTrackPrecisionChange=!0,m.MatrixCurrentType=Float32Array,m.MatrixTrackedMatrices=[],m}()},function(p,s,c){c.d(s,"a",function(){return A});var E=c(1),m=c(6),S=c(0),h=c(46),C=c(7),R=c(53),I=c(65),b=c(51),f=c(36),x=c(30),P=c(9),A=function(T){function _(g,M,O,N,V){var U;M===void 0&&(M=P.a.Gray()),O===void 0&&(O=f.a.DefaultUtilityLayer),N===void 0&&(N=null),V===void 0&&(V=1);var L=T.call(this,O)||this;L._pointerObserver=null,L.snapDistance=0,L.onSnapObservable=new m.c,L._isEnabled=!0,L._parent=null,L._dragging=!1,L._parent=N,L._coloredMaterial=new x.a("",O.utilityLayerScene),L._coloredMaterial.diffuseColor=M,L._coloredMaterial.specularColor=M.subtract(new P.a(.1,.1,.1)),L._hoverMaterial=new x.a("",O.utilityLayerScene),L._hoverMaterial.diffuseColor=P.a.Yellow(),L._disableMaterial=new x.a("",O.utilityLayerScene),L._disableMaterial.diffuseColor=P.a.Gray(),L._disableMaterial.alpha=.4;var j=_._CreateArrow(O.utilityLayerScene,L._coloredMaterial,V),Y=_._CreateArrow(O.utilityLayerScene,L._coloredMaterial,V+4,!0);L._gizmoMesh=new C.a("",O.utilityLayerScene),L._gizmoMesh.addChild(j),L._gizmoMesh.addChild(Y),L._gizmoMesh.lookAt(L._rootMesh.position.add(g)),L._gizmoMesh.scaling.scaleInPlace(1/3),L._gizmoMesh.parent=L._rootMesh;var W=0,ie=new S.e,re={snapDistance:0};L.dragBehavior=new I.a({dragAxis:g}),L.dragBehavior.moveAttached=!1,L._rootMesh.addBehavior(L.dragBehavior),L.dragBehavior.onDragObservable.add(function(ue){if(L.attachedNode){if(L.snapDistance==0)L.attachedNode.position&&L.attachedNode.position.addInPlaceFromFloats(ue.delta.x,ue.delta.y,ue.delta.z),L.attachedNode.getWorldMatrix().addTranslationFromFloats(ue.delta.x,ue.delta.y,ue.delta.z),L.attachedNode.updateCache();else if(W+=ue.dragDistance,Math.abs(W)>L.snapDistance){var oe=Math.floor(Math.abs(W)/L.snapDistance);W%=L.snapDistance,ue.delta.normalizeToRef(ie),ie.scaleInPlace(L.snapDistance*oe),L.attachedNode.getWorldMatrix().addTranslationFromFloats(ie.x,ie.y,ie.z),L.attachedNode.updateCache(),re.snapDistance=L.snapDistance*oe,L.onSnapObservable.notifyObservers(re)}L._matrixChanged()}}),L.dragBehavior.onDragStartObservable.add(function(){L._dragging=!0}),L.dragBehavior.onDragEndObservable.add(function(){L._dragging=!1});var ye=O._getSharedGizmoLight();ye.includedOnlyMeshes=ye.includedOnlyMeshes.concat(L._rootMesh.getChildMeshes(!1));var ve={gizmoMeshes:j.getChildMeshes(),colliderMeshes:Y.getChildMeshes(),material:L._coloredMaterial,hoverMaterial:L._hoverMaterial,disableMaterial:L._disableMaterial,active:!1};return(U=L._parent)===null||U===void 0||U.addToAxisCache(Y,ve),L._pointerObserver=O.utilityLayerScene.onPointerObservable.add(function(ue){var oe;if(!L._customMeshSet&&(L._isHovered=ve.colliderMeshes.indexOf((oe=ue==null?void 0:ue.pickInfo)===null||oe===void 0?void 0:oe.pickedMesh)!=-1,!L._parent)){var Z=L._isHovered||L._dragging?L._hoverMaterial:L._coloredMaterial;ve.gizmoMeshes.forEach(function(J){J.material=Z,J.color&&(J.color=Z.diffuseColor)})}}),L}return Object(E.d)(_,T),_._CreateArrow=function(g,M,O,N){O===void 0&&(O=1),N===void 0&&(N=!1);var V=new h.a("arrow",g),U=R.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(O-1)/4),tessellation:96},g),L=R.a.CreateCylinder("cylinder",{diameterTop:.005*O,height:.275,diameterBottom:.005*O,tessellation:96},g);return U.parent=V,U.material=M,U.rotation.x=Math.PI/2,U.position.z+=.3,L.parent=V,L.material=M,L.position.z+=.1375,L.rotation.x=Math.PI/2,N&&(L.visibility=0,U.visibility=0),V},_._CreateArrowInstance=function(g,M){for(var O=new h.a("arrow",g),N=0,V=M.getChildMeshes();N<V.length;N++){var U=V[N];U.createInstance(U.name).parent=O}return O},_.prototype._attachedNodeChanged=function(g){this.dragBehavior&&(this.dragBehavior.enabled=!!g)},Object.defineProperty(_.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(g){this._isEnabled=g,g?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),_.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(g){g&&g.dispose()}),T.prototype.dispose.call(this)},_}(b.a)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),m.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},m.prototype.markAsUnprocessed=function(){this._isDirty=!0},m.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsLightDirty=function(S){S===void 0&&(S=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||S,this._isDirty=!0},m.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},m.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},m.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},m.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},m.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},m.prototype.rebuild=function(){this._keys=[];for(var S=0,h=Object.keys(this);S<h.length;S++){var C=h[S];C[0]!=="_"&&this._keys.push(C)}},m.prototype.isEqual=function(S){if(this._keys.length!==S._keys.length)return!1;for(var h=0;h<this._keys.length;h++){var C=this._keys[h];if(this[C]!==S[C])return!1}return!0},m.prototype.cloneTo=function(S){this._keys.length!==S._keys.length&&(S._keys=this._keys.slice(0));for(var h=0;h<this._keys.length;h++){var C=this._keys[h];S[C]=this[C]}},m.prototype.reset=function(){for(var S=0;S<this._keys.length;S++){var h=this._keys[S];switch(typeof this[h]){case"number":this[h]=0;break;case"string":this[h]="";break;default:this[h]=!1}}},m.prototype.toString=function(){for(var S="",h=0;h<this._keys.length;h++){var C=this._keys[h],R=this[C];switch(typeof R){case"number":case"string":S+="#define "+C+" "+R+`
`;break;default:R&&(S+="#define "+C+`
`)}}return S},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(S,h){this.width=S,this.height=h}return m.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},m.prototype.getClassName=function(){return"Size"},m.prototype.getHashCode=function(){var S=0|this.width;return S=397*S^(0|this.height)},m.prototype.copyFrom=function(S){this.width=S.width,this.height=S.height},m.prototype.copyFromFloats=function(S,h){return this.width=S,this.height=h,this},m.prototype.set=function(S,h){return this.copyFromFloats(S,h)},m.prototype.multiplyByFloats=function(S,h){return new m(this.width*S,this.height*h)},m.prototype.clone=function(){return new m(this.width,this.height)},m.prototype.equals=function(S){return!!S&&this.width===S.width&&this.height===S.height},Object.defineProperty(m.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),m.Zero=function(){return new m(0,0)},m.prototype.add=function(S){return new m(this.width+S.width,this.height+S.height)},m.prototype.subtract=function(S){return new m(this.width-S.width,this.height-S.height)},m.Lerp=function(S,h,C){return new m(S.width+(h.width-S.width)*C,S.height+(h.height-S.height)*C)},m}()},function(p,s,c){var E="bonesDeclaration",m=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="instancesDeclaration",m=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#ifdef THIN_INSTANCES
uniform mat4 world;
#endif
#else
uniform mat4 world;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="instancesVertex",m=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#endif
#else
mat4 finalWorld=world;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;c(5).a.IncludesShadersStore.bonesVertex=E},function(p,s,c){c.d(s,"a",function(){return R});var E=c(0),m=c(7),S=c(4),h=c(16),C=c(43);h.a.CreateRibbon=function(I){var b=I.pathArray,f=I.closeArray||!1,x=I.closePath||!1,P=I.invertUV||!1,A=Math.floor(b[0].length/2),T=I.offset||A;T=T>A?A:Math.floor(T);var _,g,M,O,N=I.sideOrientation===0?0:I.sideOrientation||h.a.DEFAULTSIDE,V=I.uvs,U=I.colors,L=[],j=[],Y=[],W=[],ie=[],re=[],ye=[],ve=[],ue=[],oe=[];if(b.length<2){var Z=[],J=[];for(M=0;M<b[0].length-T;M++)Z.push(b[0][M]),J.push(b[0][M+T]);b=[Z,J]}var B,G,$,he,se,q=0,H=x?1:0;for(_=b[0].length,g=0;g<b.length;g++){for(ye[g]=0,ie[g]=[0],_=_<(G=(B=b[g]).length)?_:G,O=0;O<G;)L.push(B[O].x,B[O].y,B[O].z),O>0&&($=B[O].subtract(B[O-1]).length()+ye[g],ie[g].push($),ye[g]=$),O++;x&&(O--,L.push(B[0].x,B[0].y,B[0].z),$=B[O].subtract(B[0]).length()+ye[g],ie[g].push($),ye[g]=$),ue[g]=G+H,oe[g]=q,q+=G+H}var X,ee,Q=null,te=null;for(M=0;M<_+H;M++){for(ve[M]=0,re[M]=[0],g=0;g<b.length-1;g++)he=b[g],se=b[g+1],M===_?(Q=he[0],te=se[0]):(Q=he[M],te=se[M]),$=te.subtract(Q).length()+ve[M],re[M].push($),ve[M]=$;f&&te&&Q&&(he=b[g],se=b[0],M===_&&(te=se[0]),$=te.subtract(Q).length()+ve[M],ve[M]=$)}if(V)for(g=0;g<V.length;g++)W.push(V[g].x,V[g].y);else for(g=0;g<b.length;g++)for(M=0;M<_+H;M++)X=ye[g]!=0?ie[g][M]/ye[g]:0,ee=ve[M]!=0?re[M][g]/ve[M]:0,P?W.push(ee,X):W.push(X,ee);for(var ge=0,ce=ue[g=0]-1,de=ue[g+1]-1,ne=ce<de?ce:de,pe=oe[1]-oe[0],Se=f?ue.length:ue.length-1;ge<=ne&&g<Se;)j.push(ge,ge+pe,ge+1),j.push(ge+pe+1,ge+1,ge+pe),(ge+=1)===ne&&(++g==ue.length-1?(pe=oe[0]-oe[g],ce=ue[g]-1,de=ue[0]-1):(pe=oe[g+1]-oe[g],ce=ue[g]-1,de=ue[g+1]-1),ge=oe[g],ne=ce<de?ce+ge:de+ge);if(h.a.ComputeNormals(L,j,Y),x){var Te=0,Ne=0;for(g=0;g<b.length;g++)Te=3*oe[g],Ne=g+1<b.length?3*(oe[g+1]-1):Y.length-3,Y[Te]=.5*(Y[Te]+Y[Ne]),Y[Te+1]=.5*(Y[Te+1]+Y[Ne+1]),Y[Te+2]=.5*(Y[Te+2]+Y[Ne+2]),Y[Ne]=Y[Te],Y[Ne+1]=Y[Te+1],Y[Ne+2]=Y[Te+2]}h.a._ComputeSides(N,L,j,Y,W,I.frontUVs,I.backUVs);var je=null;if(U){je=new Float32Array(4*U.length);for(var Xe=0;Xe<U.length;Xe++)je[4*Xe]=U[Xe].r,je[4*Xe+1]=U[Xe].g,je[4*Xe+2]=U[Xe].b,je[4*Xe+3]=U[Xe].a}var Ye=new h.a,Ke=new Float32Array(L),nt=new Float32Array(Y),qe=new Float32Array(W);return Ye.indices=j,Ye.positions=Ke,Ye.normals=nt,Ye.uvs=qe,je&&Ye.set(je,S.b.ColorKind),x&&(Ye._idx=oe),Ye},m.a.CreateRibbon=function(I,b,f,x,P,A,T,_,g){return f===void 0&&(f=!1),T===void 0&&(T=!1),R.CreateRibbon(I,{pathArray:b,closeArray:f,closePath:x,offset:P,updatable:T,sideOrientation:_,instance:g},A)};var R=function(){function I(){}return I.CreateRibbon=function(b,f,x){x===void 0&&(x=null);var P=f.pathArray,A=f.closeArray,T=f.closePath,_=m.a._GetDefaultSideOrientation(f.sideOrientation),g=f.instance,M=f.updatable;if(g){var O=E.c.Vector3[0].setAll(Number.MAX_VALUE),N=E.c.Vector3[1].setAll(-Number.MAX_VALUE),V=g.getVerticesData(S.b.PositionKind);if(function(G){for(var $=P[0].length,he=g,se=0,q=he._originalBuilderSideOrientation===m.a.DOUBLESIDE?2:1,H=1;H<=q;++H)for(var X=0;X<P.length;++X){var ee=P[X],Q=ee.length;$=$<Q?$:Q;for(var te=0;te<$;++te){var ge=ee[te];G[se]=ge.x,G[se+1]=ge.y,G[se+2]=ge.z,O.minimizeInPlaceFromFloats(ge.x,ge.y,ge.z),N.maximizeInPlaceFromFloats(ge.x,ge.y,ge.z),se+=3}he._creationDataStorage&&he._creationDataStorage.closePath&&(ge=ee[0],G[se]=ge.x,G[se+1]=ge.y,G[se+2]=ge.z,se+=3)}}(V),g._boundingInfo?g._boundingInfo.reConstruct(O,N,g._worldMatrix):g._boundingInfo=new C.a(O,N,g._worldMatrix),g.updateVerticesData(S.b.PositionKind,V,!1,!1),f.colors){for(var U=g.getVerticesData(S.b.ColorKind),L=0,j=0;L<f.colors.length;L++,j+=4){var Y=f.colors[L];U[j]=Y.r,U[j+1]=Y.g,U[j+2]=Y.b,U[j+3]=Y.a}g.updateVerticesData(S.b.ColorKind,U,!1,!1)}if(f.uvs){for(var W=g.getVerticesData(S.b.UVKind),ie=0;ie<f.uvs.length;ie++)W[2*ie]=f.uvs[ie].x,W[2*ie+1]=f.uvs[ie].y;g.updateVerticesData(S.b.UVKind,W,!1,!1)}if(!g.areNormalsFrozen||g.isFacetDataEnabled){var re=g.getIndices(),ye=g.getVerticesData(S.b.NormalKind),ve=g.isFacetDataEnabled?g.getFacetDataParameters():null;if(h.a.ComputeNormals(V,re,ye,ve),g._creationDataStorage&&g._creationDataStorage.closePath)for(var ue=0,oe=0,Z=0;Z<P.length;Z++)ue=3*g._creationDataStorage.idx[Z],oe=Z+1<P.length?3*(g._creationDataStorage.idx[Z+1]-1):ye.length-3,ye[ue]=.5*(ye[ue]+ye[oe]),ye[ue+1]=.5*(ye[ue+1]+ye[oe+1]),ye[ue+2]=.5*(ye[ue+2]+ye[oe+2]),ye[oe]=ye[ue],ye[oe+1]=ye[ue+1],ye[oe+2]=ye[ue+2];g.areNormalsFrozen||g.updateVerticesData(S.b.NormalKind,ye,!1,!1)}return g}var J=new m.a(b,x);J._originalBuilderSideOrientation=_,J._creationDataStorage=new m.b;var B=h.a.CreateRibbon(f);return T&&(J._creationDataStorage.idx=B._idx),J._creationDataStorage.closePath=T,J._creationDataStorage.closeArray=A,B.applyToMesh(J,M),J},I}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.FilesToLoad={},m}()},function(p,s,c){c.d(s,"a",function(){return S});var E=c(7),m=c(16);m.a.CreatePlane=function(h){var C=[],R=[],I=[],b=[],f=h.width||h.size||1,x=h.height||h.size||1,P=h.sideOrientation===0?0:h.sideOrientation||m.a.DEFAULTSIDE,A=f/2,T=x/2;R.push(-A,-T,0),I.push(0,0,-1),b.push(0,0),R.push(A,-T,0),I.push(0,0,-1),b.push(1,0),R.push(A,T,0),I.push(0,0,-1),b.push(1,1),R.push(-A,T,0),I.push(0,0,-1),b.push(0,1),C.push(0),C.push(1),C.push(2),C.push(0),C.push(2),C.push(3),m.a._ComputeSides(P,R,C,I,b,h.frontUVs,h.backUVs);var _=new m.a;return _.indices=C,_.positions=R,_.normals=I,_.uvs=b,_},E.a.CreatePlane=function(h,C,R,I,b){var f={size:C,width:C,height:C,sideOrientation:b,updatable:I};return S.CreatePlane(h,f,R)};var S=function(){function h(){}return h.CreatePlane=function(C,R,I){I===void 0&&(I=null);var b=new E.a(C,I);return R.sideOrientation=E.a._GetDefaultSideOrientation(R.sideOrientation),b._originalBuilderSideOrientation=R.sideOrientation,m.a.CreatePlane(R).applyToMesh(b,R.updatable),R.sourcePlane&&(b.translate(R.sourcePlane.normal,-R.sourcePlane.d),b.setDirection(R.sourcePlane.normal.scale(-1))),b},h}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(8),m=(c(153),function(){function S(h,C,R){this._alreadyBound=!1,this._valueCache={},this._engine=h,this._noUBO=!h.supportsUniformBuffers,this._dynamic=R,this._data=C||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(S.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),S.prototype.isDynamic=function(){return this._dynamic!==void 0},S.prototype.getData=function(){return this._bufferData},S.prototype.getBuffer=function(){return this._buffer},S.prototype._fillAlignment=function(h){var C;if(C=h<=2?h:4,this._uniformLocationPointer%C!=0){var R=this._uniformLocationPointer;this._uniformLocationPointer+=C-this._uniformLocationPointer%C;for(var I=this._uniformLocationPointer-R,b=0;b<I;b++)this._data.push(0)}},S.prototype.addUniform=function(h,C){if(!this._noUBO&&this._uniformLocations[h]===void 0){var R;if(C instanceof Array)C=(R=C).length;else{C=C,R=[];for(var I=0;I<C;I++)R.push(0)}for(this._fillAlignment(C),this._uniformSizes[h]=C,this._uniformLocations[h]=this._uniformLocationPointer,this._uniformLocationPointer+=C,I=0;I<C;I++)this._data.push(R[I]);this._needSync=!0}},S.prototype.addMatrix=function(h,C){this.addUniform(h,Array.prototype.slice.call(C.toArray()))},S.prototype.addFloat2=function(h,C,R){var I=[C,R];this.addUniform(h,I)},S.prototype.addFloat3=function(h,C,R,I){var b=[C,R,I];this.addUniform(h,b)},S.prototype.addColor3=function(h,C){var R=new Array;C.toArray(R),this.addUniform(h,R)},S.prototype.addColor4=function(h,C,R){var I=new Array;C.toArray(I),I.push(R),this.addUniform(h,I)},S.prototype.addVector3=function(h,C){var R=new Array;C.toArray(R),this.addUniform(h,R)},S.prototype.addMatrix3x3=function(h){this.addUniform(h,12)},S.prototype.addMatrix2x2=function(h){this.addUniform(h,8)},S.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},S.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},S.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},S.prototype.updateUniform=function(h,C,R){var I=this._uniformLocations[h];if(I===void 0){if(this._buffer)return void E.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(h,R),I=this._uniformLocations[h]}if(this._buffer||this.create(),this._dynamic)for(f=0;f<R;f++)this._bufferData[I+f]=C[f];else{for(var b=!1,f=0;f<R;f++)R!==16&&this._bufferData[I+f]===C[f]||(b=!0,this._bufferData[I+f]=C[f]);this._needSync=this._needSync||b}},S.prototype._cacheMatrix=function(h,C){var R=this._valueCache[h],I=C.updateFlag;return(R===void 0||R!==I)&&(this._valueCache[h]=I,!0)},S.prototype._updateMatrix3x3ForUniform=function(h,C){for(var R=0;R<3;R++)S._tempBuffer[4*R]=C[3*R],S._tempBuffer[4*R+1]=C[3*R+1],S._tempBuffer[4*R+2]=C[3*R+2],S._tempBuffer[4*R+3]=0;this.updateUniform(h,S._tempBuffer,12)},S.prototype._updateMatrix3x3ForEffect=function(h,C){this._currentEffect.setMatrix3x3(h,C)},S.prototype._updateMatrix2x2ForEffect=function(h,C){this._currentEffect.setMatrix2x2(h,C)},S.prototype._updateMatrix2x2ForUniform=function(h,C){for(var R=0;R<2;R++)S._tempBuffer[4*R]=C[2*R],S._tempBuffer[4*R+1]=C[2*R+1],S._tempBuffer[4*R+2]=0,S._tempBuffer[4*R+3]=0;this.updateUniform(h,S._tempBuffer,8)},S.prototype._updateFloatForEffect=function(h,C){this._currentEffect.setFloat(h,C)},S.prototype._updateFloatForUniform=function(h,C){S._tempBuffer[0]=C,this.updateUniform(h,S._tempBuffer,1)},S.prototype._updateFloat2ForEffect=function(h,C,R,I){I===void 0&&(I=""),this._currentEffect.setFloat2(h+I,C,R)},S.prototype._updateFloat2ForUniform=function(h,C,R){S._tempBuffer[0]=C,S._tempBuffer[1]=R,this.updateUniform(h,S._tempBuffer,2)},S.prototype._updateFloat3ForEffect=function(h,C,R,I,b){b===void 0&&(b=""),this._currentEffect.setFloat3(h+b,C,R,I)},S.prototype._updateFloat3ForUniform=function(h,C,R,I){S._tempBuffer[0]=C,S._tempBuffer[1]=R,S._tempBuffer[2]=I,this.updateUniform(h,S._tempBuffer,3)},S.prototype._updateFloat4ForEffect=function(h,C,R,I,b,f){f===void 0&&(f=""),this._currentEffect.setFloat4(h+f,C,R,I,b)},S.prototype._updateFloat4ForUniform=function(h,C,R,I,b){S._tempBuffer[0]=C,S._tempBuffer[1]=R,S._tempBuffer[2]=I,S._tempBuffer[3]=b,this.updateUniform(h,S._tempBuffer,4)},S.prototype._updateMatrixForEffect=function(h,C){this._currentEffect.setMatrix(h,C)},S.prototype._updateMatrixForUniform=function(h,C){this._cacheMatrix(h,C)&&this.updateUniform(h,C.toArray(),16)},S.prototype._updateVector3ForEffect=function(h,C){this._currentEffect.setVector3(h,C)},S.prototype._updateVector3ForUniform=function(h,C){C.toArray(S._tempBuffer),this.updateUniform(h,S._tempBuffer,3)},S.prototype._updateVector4ForEffect=function(h,C){this._currentEffect.setVector4(h,C)},S.prototype._updateVector4ForUniform=function(h,C){C.toArray(S._tempBuffer),this.updateUniform(h,S._tempBuffer,4)},S.prototype._updateColor3ForEffect=function(h,C,R){R===void 0&&(R=""),this._currentEffect.setColor3(h+R,C)},S.prototype._updateColor3ForUniform=function(h,C){C.toArray(S._tempBuffer),this.updateUniform(h,S._tempBuffer,3)},S.prototype._updateColor4ForEffect=function(h,C,R,I){I===void 0&&(I=""),this._currentEffect.setColor4(h+I,C,R)},S.prototype._updateColor4ForUniform=function(h,C,R){C.toArray(S._tempBuffer),S._tempBuffer[3]=R,this.updateUniform(h,S._tempBuffer,4)},S.prototype.setTexture=function(h,C){this._currentEffect.setTexture(h,C)},S.prototype.updateUniformDirectly=function(h,C){this.updateUniform(h,C,C.length),this.update()},S.prototype.bindToEffect=function(h,C){this._currentEffect=h,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,h.bindUniformBuffer(this._buffer,C))},S.prototype.dispose=function(){if(!this._noUBO){var h=this._engine._uniformBuffers,C=h.indexOf(this);C!==-1&&(h[C]=h[h.length-1],h.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},S._MAX_UNIFORM_SIZE=256,S._tempBuffer=new Float32Array(S._MAX_UNIFORM_SIZE),S}())},function(p,s,c){c.d(s,"a",function(){return I});var E=c(1),m=c(3),S=c(0),h=c(9),C=c(29),R=c(48);C.a.AddNodeConstructor("Light_Type_3",function(b,f){return function(){return new I(b,S.e.Zero(),f)}});var I=function(b){function f(x,P,A){var T=b.call(this,x,A)||this;return T.groundColor=new h.a(0,0,0),T.direction=P||S.e.Up(),T}return Object(E.d)(f,b),f.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},f.prototype.getClassName=function(){return"HemisphericLight"},f.prototype.setDirectionToTarget=function(x){return this.direction=S.e.Normalize(x.subtract(S.e.Zero())),this.direction},f.prototype.getShadowGenerator=function(){return null},f.prototype.transferToEffect=function(x,P){var A=S.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,P),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),P),this},f.prototype.transferToNodeMaterialEffect=function(x,P){var A=S.e.Normalize(this.direction);return x.setFloat3(P,A.x,A.y,A.z),this},f.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=S.a.Identity()),this._worldMatrix},f.prototype.getTypeID=function(){return R.a.LIGHTTYPEID_HEMISPHERICLIGHT},f.prototype.prepareLightSpecificDefines=function(x,P){x["HEMILIGHT"+P]=!0},Object(E.c)([Object(m.e)()],f.prototype,"groundColor",void 0),Object(E.c)([Object(m.o)()],f.prototype,"direction",void 0),f}(R.a)},function(p,s,c){c.d(s,"a",function(){return S});var E=c(1),m=c(0),S=function(h){function C(R,I){var b=h.call(this,R,I)||this;return b._normalMatrix=new m.a,b._storeEffectOnSubMeshes=!0,b}return Object(E.d)(C,h),C.prototype.getEffect=function(){return this._activeEffect},C.prototype.isReady=function(R,I){return!!R&&(!R.subMeshes||R.subMeshes.length===0||this.isReadyForSubMesh(R,R.subMeshes[0],I))},C.prototype._isReadyForSubMesh=function(R){var I=R._materialDefines;return!(this.checkReadyOnEveryCall||!R.effect||!I||I._renderId!==this.getScene().getRenderId())},C.prototype.bindOnlyWorldMatrix=function(R){this._activeEffect.setMatrix("world",R)},C.prototype.bindOnlyNormalMatrix=function(R){this._activeEffect.setMatrix("normalMatrix",R)},C.prototype.bind=function(R,I){I&&this.bindForSubMesh(R,I,I.subMeshes[0])},C.prototype._afterBind=function(R,I){I===void 0&&(I=null),h.prototype._afterBind.call(this,R),this.getScene()._cachedEffect=I},C.prototype._mustRebind=function(R,I,b){return b===void 0&&(b=1),R.isCachedMaterialInvalid(this,I,b)},C}(c(25).a)},function(p,s,c){c.d(s,"a",function(){return m});var E=c(1),m=function(S){function h(C){var R=S.call(this)||this;return R._buffer=C,R}return Object(E.d)(h,S),Object.defineProperty(h.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),h}(c(89).a)},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(m.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),m}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(64),m=function(){function S(){}return S.GetPlanes=function(h){for(var C=[],R=0;R<6;R++)C.push(new E.a(0,0,0,0));return S.GetPlanesToRef(h,C),C},S.GetNearPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]+R[2],C.normal.y=R[7]+R[6],C.normal.z=R[11]+R[10],C.d=R[15]+R[14],C.normalize()},S.GetFarPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]-R[2],C.normal.y=R[7]-R[6],C.normal.z=R[11]-R[10],C.d=R[15]-R[14],C.normalize()},S.GetLeftPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]+R[0],C.normal.y=R[7]+R[4],C.normal.z=R[11]+R[8],C.d=R[15]+R[12],C.normalize()},S.GetRightPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]-R[0],C.normal.y=R[7]-R[4],C.normal.z=R[11]-R[8],C.d=R[15]-R[12],C.normalize()},S.GetTopPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]-R[1],C.normal.y=R[7]-R[5],C.normal.z=R[11]-R[9],C.d=R[15]-R[13],C.normalize()},S.GetBottomPlaneToRef=function(h,C){var R=h.m;C.normal.x=R[3]+R[1],C.normal.y=R[7]+R[5],C.normal.z=R[11]+R[9],C.d=R[15]+R[13],C.normalize()},S.GetPlanesToRef=function(h,C){S.GetNearPlaneToRef(h,C[0]),S.GetFarPlaneToRef(h,C[1]),S.GetLeftPlaneToRef(h,C[2]),S.GetRightPlaneToRef(h,C[3]),S.GetTopPlaneToRef(h,C[4]),S.GetBottomPlaneToRef(h,C[5])},S}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(S,"HasTriggers",{get:function(){for(var h in S.Triggers)if(S.Triggers.hasOwnProperty(h))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(S,"HasPickTriggers",{get:function(){for(var h in S.Triggers)if(S.Triggers.hasOwnProperty(h)){var C=parseInt(h);if(C>=E.a.ACTION_OnPickTrigger&&C<=E.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),S.HasSpecificTrigger=function(h){for(var C in S.Triggers)if(S.Triggers.hasOwnProperty(C)&&parseInt(C)===h)return!0;return!1},S.Triggers={},S}()},function(p,s,c){c.d(s,"a",function(){return R});var E=c(1),m=c(25),S=c(3),h=c(19),C=c(15),R=function(){function I(b){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=m.a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=b}return I.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},I.prototype.isReadyForSubMesh=function(b,f){var x=f.getEngine();return!(b._areTexturesDirty&&f.texturesEnabled&&x.getCaps().standardDerivatives&&this._texture&&h.a.DetailTextureEnabled&&!this._texture.isReady())},I.prototype.prepareDefines=function(b,f){if(this._isEnabled){b.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var x=f.getEngine();b._areTexturesDirty&&(x.getCaps().standardDerivatives&&this._texture&&h.a.DetailTextureEnabled&&this._isEnabled?(C.a.PrepareDefinesForMergedUV(this._texture,b,"DETAIL"),b.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):b.DETAIL=!1)}else b.DETAIL=!1},I.prototype.bindForSubMesh=function(b,f,x){this._isEnabled&&(b.useUbo&&x&&b.isSync||this._texture&&h.a.DetailTextureEnabled&&(b.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),C.a.BindTextureMatrix(this._texture,b,"detail")),f.texturesEnabled&&this._texture&&h.a.DetailTextureEnabled&&b.setTexture("detailSampler",this._texture))},I.prototype.hasTexture=function(b){return this._texture===b},I.prototype.getActiveTextures=function(b){this._texture&&b.push(this._texture)},I.prototype.getAnimatables=function(b){this._texture&&this._texture.animations&&this._texture.animations.length>0&&b.push(this._texture)},I.prototype.dispose=function(b){var f;b&&((f=this._texture)===null||f===void 0||f.dispose())},I.prototype.getClassName=function(){return"DetailMap"},I.AddUniforms=function(b){b.push("vDetailInfos")},I.AddSamplers=function(b){b.push("detailSampler")},I.PrepareUniformBuffer=function(b){b.addUniform("vDetailInfos",4),b.addUniform("detailMatrix",16)},I.prototype.copyTo=function(b){S.a.Clone(function(){return b},this)},I.prototype.serialize=function(){return S.a.Serialize(this)},I.prototype.parse=function(b,f,x){var P=this;S.a.Parse(function(){return P},b,f,x)},Object(E.c)([Object(S.m)("detailTexture"),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"texture",void 0),Object(E.c)([Object(S.c)()],I.prototype,"diffuseBlendLevel",void 0),Object(E.c)([Object(S.c)()],I.prototype,"roughnessBlendLevel",void 0),Object(E.c)([Object(S.c)()],I.prototype,"bumpLevel",void 0),Object(E.c)([Object(S.c)(),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"normalBlendMethod",void 0),Object(E.c)([Object(S.c)(),Object(S.b)("_markAllSubMeshesAsTexturesDirty")],I.prototype,"isEnabled",void 0),I}()},function(p,s,c){var E="morphTargetsVertexGlobalDeclaration",m=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="morphTargetsVertexDeclaration",m=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"a",function(){return h});var E=c(25),m=c(4),S=c(2),h=function(){function C(R){this._vertexBuffers={},this._scene=R}return C.prototype._prepareBuffers=function(){if(!this._vertexBuffers[m.b.PositionKind]){var R=[];R.push(1,1),R.push(-1,1),R.push(-1,-1),R.push(1,-1),this._vertexBuffers[m.b.PositionKind]=new m.b(this._scene.getEngine(),R,m.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},C.prototype._buildIndexBuffer=function(){var R=[];R.push(0),R.push(1),R.push(2),R.push(0),R.push(2),R.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(R)},C.prototype._rebuild=function(){var R=this._vertexBuffers[m.b.PositionKind];R&&(R._rebuild(),this._buildIndexBuffer())},C.prototype._prepareFrame=function(R,I){R===void 0&&(R=null),I===void 0&&(I=null);var b=this._scene.activeCamera;return!!b&&!(!(I=I||b._postProcesses.filter(function(f){return f!=null}))||I.length===0||!this._scene.postProcessesEnabled)&&(I[0].activate(b,R,I!=null),!0)},C.prototype.directRender=function(R,I,b,f,x,P){I===void 0&&(I=null),b===void 0&&(b=!1),f===void 0&&(f=0),x===void 0&&(x=0),P===void 0&&(P=!1);for(var A=this._scene.getEngine(),T=0;T<R.length;T++){T<R.length-1?R[T+1].activate(this._scene.activeCamera,I):I?A.bindFramebuffer(I,f,void 0,void 0,b,x):P||A.restoreDefaultFramebuffer();var _=R[T],g=_.apply();g&&(_.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,g),A.drawElementsType(E.a.TriangleFillMode,0,6),_.onAfterRenderObservable.notifyObservers(g))}A.setDepthBuffer(!0),A.setDepthWrite(!0)},C.prototype._finalizeFrame=function(R,I,b,f,x){x===void 0&&(x=!1);var P=this._scene.activeCamera;if(P&&(f=f||P._postProcesses.filter(function(O){return O!=null})).length!==0&&this._scene.postProcessesEnabled){for(var A=this._scene.getEngine(),T=0,_=f.length;T<_;T++){var g=f[T];if(T<_-1?g._outputTexture=f[T+1].activate(P,I):I?(A.bindFramebuffer(I,b,void 0,void 0,x),g._outputTexture=I):(A.restoreDefaultFramebuffer(),g._outputTexture=null),R)break;var M=g.apply();M&&(g.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,M),A.drawElementsType(E.a.TriangleFillMode,0,6),g.onAfterRenderObservable.notifyObservers(M))}A.setDepthBuffer(!0),A.setDepthWrite(!0),A.setAlphaMode(S.a.ALPHA_DISABLE)}},C.prototype.dispose=function(){var R=this._vertexBuffers[m.b.PositionKind];R&&(R.dispose(),this._vertexBuffers[m.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},C}()},function(p,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(148),m=function(){},S=function(){function h(C){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new m,this._scene=C;for(var R=h.MIN_RENDERINGGROUPS;R<h.MAX_RENDERINGGROUPS;R++)this._autoClearDepthStencil[R]={autoClear:!0,depth:!0,stencil:!0}}return h.prototype._clearDepthStencilBuffer=function(C,R){C===void 0&&(C=!0),R===void 0&&(R=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,C,R),this._depthStencilBufferAlreadyCleaned=!0)},h.prototype.render=function(C,R,I,b){var f=this._renderingGroupInfo;if(f.scene=this._scene,f.camera=this._scene.activeCamera,this._scene.spriteManagers&&b)for(var x=0;x<this._scene.spriteManagers.length;x++){var P=this._scene.spriteManagers[x];this.dispatchSprites(P)}for(x=h.MIN_RENDERINGGROUPS;x<h.MAX_RENDERINGGROUPS;x++){this._depthStencilBufferAlreadyCleaned=x===h.MIN_RENDERINGGROUPS;var A=this._renderingGroups[x];if(A){var T=Math.pow(2,x);if(f.renderingGroupId=x,this._scene.onBeforeRenderingGroupObservable.notifyObservers(f,T),h.AUTOCLEAR){var _=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(x):this._autoClearDepthStencil[x];_&&_.autoClear&&this._clearDepthStencilBuffer(_.depth,_.stencil)}for(var g=0,M=this._scene._beforeRenderingGroupDrawStage;g<M.length;g++)M[g].action(x);A.render(C,b,I,R);for(var O=0,N=this._scene._afterRenderingGroupDrawStage;O<N.length;O++)N[O].action(x);this._scene.onAfterRenderingGroupObservable.notifyObservers(f,T)}}},h.prototype.reset=function(){for(var C=h.MIN_RENDERINGGROUPS;C<h.MAX_RENDERINGGROUPS;C++){var R=this._renderingGroups[C];R&&R.prepare()}},h.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},h.prototype.freeRenderingGroups=function(){for(var C=h.MIN_RENDERINGGROUPS;C<h.MAX_RENDERINGGROUPS;C++){var R=this._renderingGroups[C];R&&R.dispose()}},h.prototype._prepareRenderingGroup=function(C){this._renderingGroups[C]===void 0&&(this._renderingGroups[C]=new E.a(C,this._scene,this._customOpaqueSortCompareFn[C],this._customAlphaTestSortCompareFn[C],this._customTransparentSortCompareFn[C]))},h.prototype.dispatchSprites=function(C){var R=C.renderingGroupId||0;this._prepareRenderingGroup(R),this._renderingGroups[R].dispatchSprites(C)},h.prototype.dispatchParticles=function(C){var R=C.renderingGroupId||0;this._prepareRenderingGroup(R),this._renderingGroups[R].dispatchParticles(C)},h.prototype.dispatch=function(C,R,I){R===void 0&&(R=C.getMesh());var b=R.renderingGroupId||0;this._prepareRenderingGroup(b),this._renderingGroups[b].dispatch(C,R,I)},h.prototype.setRenderingOrder=function(C,R,I,b){if(R===void 0&&(R=null),I===void 0&&(I=null),b===void 0&&(b=null),this._customOpaqueSortCompareFn[C]=R,this._customAlphaTestSortCompareFn[C]=I,this._customTransparentSortCompareFn[C]=b,this._renderingGroups[C]){var f=this._renderingGroups[C];f.opaqueSortCompareFn=this._customOpaqueSortCompareFn[C],f.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[C],f.transparentSortCompareFn=this._customTransparentSortCompareFn[C]}},h.prototype.setRenderingAutoClearDepthStencil=function(C,R,I,b){I===void 0&&(I=!0),b===void 0&&(b=!0),this._autoClearDepthStencil[C]={autoClear:R,depth:I,stencil:b}},h.prototype.getAutoClearDepthStencilSetup=function(C){return this._autoClearDepthStencil[C]},h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0,h}()},function(p,s,c){c.d(s,"a",function(){return C});var E=c(0),m=c(7),S=c(82),h=c(72);m.a.ExtrudeShape=function(R,I,b,f,x,P,A,T,_,g){A===void 0&&(A=null);var M={shape:I,path:b,scale:f,rotation:x,cap:P===0?0:P||m.a.NO_CAP,sideOrientation:_,instance:g,updatable:T};return C.ExtrudeShape(R,M,A)},m.a.ExtrudeShapeCustom=function(R,I,b,f,x,P,A,T,_,g,M,O){var N={shape:I,path:b,scaleFunction:f,rotationFunction:x,ribbonCloseArray:P,ribbonClosePath:A,cap:T===0?0:T||m.a.NO_CAP,sideOrientation:M,instance:O,updatable:g};return C.ExtrudeShapeCustom(R,N,_)};var C=function(){function R(){}return R.ExtrudeShape=function(I,b,f){f===void 0&&(f=null);var x=b.path,P=b.shape,A=b.scale||1,T=b.rotation||0,_=b.cap===0?0:b.cap||m.a.NO_CAP,g=b.updatable,M=m.a._GetDefaultSideOrientation(b.sideOrientation),O=b.instance||null,N=b.invertUV||!1;return R._ExtrudeShapeGeneric(I,P,x,A,T,null,null,!1,!1,_,!1,f,!!g,M,O,N,b.frontUVs||null,b.backUVs||null)},R.ExtrudeShapeCustom=function(I,b,f){f===void 0&&(f=null);var x=b.path,P=b.shape,A=b.scaleFunction||function(){return 1},T=b.rotationFunction||function(){return 0},_=b.ribbonCloseArray||!1,g=b.ribbonClosePath||!1,M=b.cap===0?0:b.cap||m.a.NO_CAP,O=b.updatable,N=m.a._GetDefaultSideOrientation(b.sideOrientation),V=b.instance,U=b.invertUV||!1;return R._ExtrudeShapeGeneric(I,P,x,null,null,A,T,_,g,M,!0,f,!!O,N,V||null,U,b.frontUVs||null,b.backUVs||null)},R._ExtrudeShapeGeneric=function(I,b,f,x,P,A,T,_,g,M,O,N,V,U,L,j,Y,W){var ie,re,ye=function(oe,Z,J,B,G,$,he,se,q,H){for(var X=J.getTangents(),ee=J.getNormals(),Q=J.getBinormals(),te=J.getDistances(),ge=0,ce=H&&se?se:function(){return $!==null?$:0},de=H&&he?he:function(){return G!==null?G:1},ne=q===m.a.NO_CAP||q===m.a.CAP_END?0:2,pe=E.c.Matrix[0],Se=0;Se<Z.length;Se++){for(var Te=new Array,Ne=ce(Se,te[Se]),je=de(Se,te[Se]),Xe=0;Xe<oe.length;Xe++){E.a.RotationAxisToRef(X[Se],ge,pe);var Ye=X[Se].scale(oe[Xe].z).add(ee[Se].scale(oe[Xe].x)).add(Q[Se].scale(oe[Xe].y)),Ke=Te[Xe]?Te[Xe]:E.e.Zero();E.e.TransformCoordinatesToRef(Ye,pe,Ke),Ke.scaleInPlace(je).addInPlace(Z[Se]),Te[Xe]=Ke}B[ne]=Te,ge+=Ne,ne++}var nt=function(qe){var ct,ot=Array(),_t=E.e.Zero();for(ct=0;ct<qe.length;ct++)_t.addInPlace(qe[ct]);for(_t.scaleInPlace(1/qe.length),ct=0;ct<qe.length;ct++)ot.push(_t);return ot};switch(q){case m.a.NO_CAP:break;case m.a.CAP_START:B[0]=nt(B[2]),B[1]=B[2];break;case m.a.CAP_END:B[ne]=B[ne-1],B[ne+1]=nt(B[ne-1]);break;case m.a.CAP_ALL:B[0]=nt(B[2]),B[1]=B[2],B[ne]=B[ne-1],B[ne+1]=nt(B[ne-1])}return B};if(L){var ve=L._creationDataStorage;return ie=ve.path3D.update(f),re=ye(b,f,ve.path3D,ve.pathArray,x,P,A,T,ve.cap,O),L=m.a.CreateRibbon("",re,!1,!1,0,N||void 0,!1,0,L)}re=ye(b,f,ie=new h.g(f),new Array,x,P,A,T,M=M<0||M>3?0:M,O);var ue=S.a.CreateRibbon(I,{pathArray:re,closeArray:_,closePath:g,updatable:V,sideOrientation:U,invertUV:j,frontUVs:Y||void 0,backUVs:W||void 0},N);return ue._creationDataStorage.pathArray=re,ue._creationDataStorage.path3D=ie,ue._creationDataStorage.cap=M,ue},R}()},function(p,s,c){c.d(s,"b",function(){return f}),c.d(s,"a",function(){return x});var E=c(1),m=c(9),S=c(4),h=c(7),C=c(151),R=c(25),I=c(73),b=c(15),f=(c(166),c(167),function(P){function A(T,_,g,M,O,N,V){_===void 0&&(_=null),g===void 0&&(g=null),M===void 0&&(M=null);var U=P.call(this,T,_,g,M,O)||this;U.useVertexColor=N,U.useVertexAlpha=V,U.color=new m.a(1,1,1),U.alpha=1,M&&(U.color=M.color.clone(),U.alpha=M.alpha,U.useVertexColor=M.useVertexColor,U.useVertexAlpha=M.useVertexAlpha),U.intersectionThreshold=.1;var L={attributes:[S.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return V===!1&&(L.needAlphaBlending=!1),N?(L.defines.push("#define VERTEXCOLOR"),L.attributes.push(S.b.ColorKind)):(L.uniforms.push("color"),U.color4=new m.b),U._colorShader=new I.a("colorShader",U.getScene(),"color",L),U}return Object(E.d)(A,P),A.prototype._addClipPlaneDefine=function(T){var _="#define "+T;this._colorShader.options.defines.indexOf(_)===-1&&this._colorShader.options.defines.push(_)},A.prototype._removeClipPlaneDefine=function(T){var _="#define "+T,g=this._colorShader.options.defines.indexOf(_);g!==-1&&this._colorShader.options.defines.splice(g,1)},A.prototype.isReady=function(){var T=this.getScene();return T.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),T.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),T.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),T.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),T.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),T.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady(this)&&P.prototype.isReady.call(this)},A.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(A.prototype,"material",{get:function(){return this._colorShader},set:function(T){},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"checkCollisions",{get:function(){return!1},enumerable:!1,configurable:!0}),A.prototype._bind=function(T,_,g){if(!this._geometry)return this;var M=this._colorShader.getEffect(),O=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(M,O),!this.useVertexColor){var N=this.color,V=N.r,U=N.g,L=N.b;this.color4.set(V,U,L,this.alpha),this._colorShader.setColor4("color",this.color4)}return b.a.BindClipPlane(M,this.getScene()),this},A.prototype._draw=function(T,_,g){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var M=this.getScene().getEngine();return this._unIndexed?M.drawArraysType(R.a.LineListDrawMode,T.verticesStart,T.verticesCount,g):M.drawElementsType(R.a.LineListDrawMode,T.indexStart,T.indexCount,g),this},A.prototype.dispose=function(T){this._colorShader.dispose(!1,!1,!0),P.prototype.dispose.call(this,T)},A.prototype.clone=function(T,_,g){return _===void 0&&(_=null),new A(T,this.getScene(),_,this,g)},A.prototype.createInstance=function(T){return new x(T,this)},A}(h.a)),x=function(P){function A(T,_){var g=P.call(this,T,_)||this;return g.intersectionThreshold=_.intersectionThreshold,g}return Object(E.d)(A,P),A.prototype.getClassName=function(){return"InstancedLinesMesh"},A}(C.a)},function(p,s,c){c.r(s),c.d(s,"AxesViewer",function(){return R}),c.d(s,"BoneAxesViewer",function(){return f}),c.d(s,"DebugLayerTab",function(){return E}),c.d(s,"DebugLayer",function(){return _}),c.d(s,"PhysicsViewer",function(){return j}),c.d(s,"RayHelper",function(){return W}),c.d(s,"SkeletonViewer",function(){return Z});var E,m=c(0),S=c(30),h=c(75),C=c(9),R=function(){function J(B,G,$,he,se,q){if(G===void 0&&(G=1),$===void 0&&($=2),this._scaleLinesFactor=4,this._instanced=!1,this.scene=null,this.scaleLines=1,this.scaleLines=G,!he){var H=new S.a("",B);H.disableLighting=!0,H.emissiveColor=C.a.Red().scale(.5),he=h.a._CreateArrow(B,H)}if(!se){var X=new S.a("",B);X.disableLighting=!0,X.emissiveColor=C.a.Green().scale(.5),se=h.a._CreateArrow(B,X)}if(!q){var ee=new S.a("",B);ee.disableLighting=!0,ee.emissiveColor=C.a.Blue().scale(.5),q=h.a._CreateArrow(B,ee)}this._xAxis=he,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=se,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=q,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),$!=null&&(J._SetRenderingGroupId(this._xAxis,$),J._SetRenderingGroupId(this._yAxis,$),J._SetRenderingGroupId(this._zAxis,$)),this.scene=B,this.update(new m.e,m.e.Right(),m.e.Up(),m.e.Forward())}return Object.defineProperty(J.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!1,configurable:!0}),J.prototype.update=function(B,G,$,he){this._xAxis.position.copyFrom(B),this._xAxis.setDirection(G),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(B),this._yAxis.setDirection($),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(B),this._zAxis.setDirection(he),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},J.prototype.createInstance=function(){var B=h.a._CreateArrowInstance(this.scene,this._xAxis),G=h.a._CreateArrowInstance(this.scene,this._yAxis),$=h.a._CreateArrowInstance(this.scene,this._zAxis),he=new J(this.scene,this.scaleLines,null,B,G,$);return he._instanced=!0,he},J.prototype.dispose=function(){this._xAxis&&this._xAxis.dispose(!1,!this._instanced),this._yAxis&&this._yAxis.dispose(!1,!this._instanced),this._zAxis&&this._zAxis.dispose(!1,!this._instanced),this.scene=null},J._SetRenderingGroupId=function(B,G){B.getChildMeshes().forEach(function($){$.renderingGroupId=G})},J}(),I=c(1),b=c(23),f=function(J){function B(G,$,he,se){se===void 0&&(se=1);var q=J.call(this,G,se)||this;return q.pos=m.e.Zero(),q.xaxis=m.e.Zero(),q.yaxis=m.e.Zero(),q.zaxis=m.e.Zero(),q.mesh=he,q.bone=$,q}return Object(I.d)(B,J),B.prototype.update=function(){if(this.mesh&&this.bone){var G=this.bone;G._markAsDirtyAndCompose(),G.getAbsolutePositionToRef(this.mesh,this.pos),G.getDirectionToRef(b.a.X,this.mesh,this.xaxis),G.getDirectionToRef(b.a.Y,this.mesh,this.yaxis),G.getDirectionToRef(b.a.Z,this.mesh,this.zaxis),J.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},B.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,J.prototype.dispose.call(this))},B}(R),x=c(12),P=c(6),A=c(20),T=c(13);Object.defineProperty(A.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new _(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(J){J[J.Properties=0]="Properties",J[J.Debug=1]="Debug",J[J.Statistics=2]="Statistics",J[J.Tools=3]="Tools",J[J.Settings=4]="Settings"}(E||(E={}));var _=function(){function J(B){var G=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=B,this._scene.onDisposeObservable.add(function(){G._scene._debugLayer&&G._scene._debugLayer.hide()})}return Object.defineProperty(J.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new P.c),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),J.prototype._createInspector=function(B){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var G=0,$=this._onPropertyChangedObservable.observers;G<$.length;G++){var he=$[G];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(he)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var se=Object(I.a)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},B);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,se)}},J.prototype.select=function(B,G){this.BJSINSPECTOR&&(G&&(Object.prototype.toString.call(G)=="[object String]"?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(G):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(G)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(B))},J.prototype._getGlobalInspector=function(){return typeof INSPECTOR!="undefined"?INSPECTOR:typeof BABYLON!="undefined"&&BABYLON.Inspector!==void 0?BABYLON:void 0},J.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},J.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},J.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},J.prototype.show=function(B){var G=this;return new Promise(function($,he){if(G.BJSINSPECTOR===void 0){var se=B&&B.inspectorURL?B.inspectorURL:J.InspectorURL;x.b.LoadScript(se,function(){G._createInspector(B),$(G)})}else G._createInspector(B),$(G)})},J.InspectorURL="https://unpkg.com/babylonjs-inspector@"+T.a.Version+"/babylon.inspector.bundle.js",J}(),g=c(7),M=c(63),O=c(45),N=c(22),V=c(32),U=c(36),L=c(53),j=function(){function J(B){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=B||N.a.LastCreatedScene;var G=this._scene.getPhysicsEngine();G&&(this._physicsEnginePlugin=G.getPhysicsPlugin()),this._utilityLayer=new U.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return J.prototype._updateDebugMeshes=function(){for(var B=this._physicsEnginePlugin,G=0;G<this._numMeshes;G++){var $=this._impostors[G];if($)if($.isDisposed)this.hideImpostor(this._impostors[G--]);else{if($.type===V.a.MeshImpostor)continue;var he=this._meshes[G];he&&B&&B.syncMeshWithImpostor(he,$)}}},J.prototype.showImpostor=function(B,G){if(!this._scene)return null;for(var $=0;$<this._numMeshes;$++)if(this._impostors[$]==B)return null;var he=this._getDebugMesh(B,G);return he&&(this._impostors[this._numMeshes]=B,this._meshes[this._numMeshes]=he,this._numMeshes===0&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),he},J.prototype.hideImpostor=function(B){if(B&&this._scene&&this._utilityLayer){for(var G=!1,$=this._utilityLayer.utilityLayerScene,he=0;he<this._numMeshes;he++)if(this._impostors[he]==B){var se=this._meshes[he];if(!se)continue;$.removeMesh(se),se.dispose();var q=this._debugMeshMeshes.indexOf(se);q>-1&&this._debugMeshMeshes.splice(q,1),this._numMeshes--,this._numMeshes>0?(this._meshes[he]=this._meshes[this._numMeshes],this._impostors[he]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),G=!0;break}G&&this._numMeshes===0&&this._scene.unregisterBeforeRender(this._renderFunction)}},J.prototype._getDebugMaterial=function(B){return this._debugMaterial||(this._debugMaterial=new S.a("",B),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=C.a.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},J.prototype._getDebugBoxMesh=function(B){return this._debugBoxMesh||(this._debugBoxMesh=M.a.CreateBox("physicsBodyBoxViewMesh",{size:1},B),this._debugBoxMesh.rotationQuaternion=m.b.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(B),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},J.prototype._getDebugSphereMesh=function(B){return this._debugSphereMesh||(this._debugSphereMesh=O.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},B),this._debugSphereMesh.rotationQuaternion=m.b.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(B),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},J.prototype._getDebugCylinderMesh=function(B){return this._debugCylinderMesh||(this._debugCylinderMesh=L.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},B),this._debugCylinderMesh.rotationQuaternion=m.b.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(B),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},J.prototype._getDebugMeshMesh=function(B,G){var $=new g.a(B.name,G,null,B);return $.position=m.e.Zero(),$.setParent(B),$.material=this._getDebugMaterial(G),this._debugMeshMeshes.push($),$},J.prototype._getDebugMesh=function(B,G){var $=this;if(!this._utilityLayer||G&&G.parent&&G.parent.physicsImpostor)return null;var he=null,se=this._utilityLayer.utilityLayerScene;switch(B.type){case V.a.BoxImpostor:he=this._getDebugBoxMesh(se),B.getBoxSizeToRef(he.scaling);break;case V.a.SphereImpostor:he=this._getDebugSphereMesh(se);var q=B.getRadius();he.scaling.x=2*q,he.scaling.y=2*q,he.scaling.z=2*q;break;case V.a.MeshImpostor:G&&(he=this._getDebugMeshMesh(G,se));break;case V.a.NoImpostor:G&&G.getChildMeshes().filter(function(X){return X.physicsImpostor?1:0}).forEach(function(X){$._getDebugBoxMesh(se).parent=X});break;case V.a.CylinderImpostor:he=this._getDebugCylinderMesh(se);var H=B.object.getBoundingInfo();he.scaling.x=H.boundingBox.maximum.x-H.boundingBox.minimum.x,he.scaling.y=H.boundingBox.maximum.y-H.boundingBox.minimum.y,he.scaling.z=H.boundingBox.maximum.z-H.boundingBox.minimum.z}return he},J.prototype.dispose=function(){for(var B=this._numMeshes,G=0;G<B;G++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},J}(),Y=c(40),W=function(){function J(B){this.ray=B}return J.CreateAndShow=function(B,G,$){var he=new J(B);return he.show(G,$),he},J.prototype.show=function(B,G){if(!this._renderFunction&&this.ray){var $=this.ray;this._renderFunction=this._render.bind(this),this._scene=B,this._renderPoints=[$.origin,$.origin.add($.direction.scale($.length))],this._renderLine=g.a.CreateLines("ray",this._renderPoints,B,!0),this._renderLine.isPickable=!1,this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}G&&this._renderLine&&this._renderLine.color.copyFrom(G)},J.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},J.prototype._render=function(){var B=this.ray;if(B){var G=this._renderPoints[1],$=Math.min(B.length,1e6);G.copyFrom(B.direction),G.scaleInPlace($),G.addInPlace(B.origin),this._renderPoints[0].copyFrom(B.origin),g.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},J.prototype.attachToMesh=function(B,G,$,he){var se=this;this._attachedToMesh=B;var q=this.ray;q&&(q.direction||(q.direction=m.e.Zero()),q.origin||(q.origin=m.e.Zero()),he&&(q.length=he),$||($=m.e.Zero()),G||(G=new m.e(0,0,-1)),this._scene||(this._scene=B.getScene()),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(G),this._meshSpaceOrigin.copyFrom($)):(this._meshSpaceDirection=G.clone(),this._meshSpaceOrigin=$.clone()),this._onAfterRenderObserver||(this._onAfterRenderObserver=this._scene.onBeforeRenderObservable.add(function(){return se._updateToMesh()}),this._onAfterStepObserver=this._scene.onAfterStepObservable.add(function(){return se._updateToMesh()})),this._attachedToMesh.computeWorldMatrix(!0),this._updateToMesh())},J.prototype.detachFromMesh=function(){this._attachedToMesh&&this._scene&&(this._onAfterRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._onAfterRenderObserver),this._scene.onAfterStepObservable.remove(this._onAfterStepObserver)),this._attachedToMesh=null,this._onAfterRenderObserver=null,this._onAfterStepObserver=null,this._scene=null)},J.prototype._updateToMesh=function(){var B=this.ray;this._attachedToMesh&&B&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,B.direction),m.e.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),B.origin)))},J.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},J}(),ie=c(25),re=c(73),ye=c(62),ve=c(4),ue=c(5),oe=c(97),Z=function(){function J(B,G,$,he,se,q){var H,X,ee,Q,te,ge,ce,de,ne,pe,Se,Te,Ne,je;he===void 0&&(he=!0),se===void 0&&(se=3),q===void 0&&(q={}),this.skeleton=B,this.mesh=G,this.autoUpdateBonesMatrices=he,this.renderingGroupId=se,this.options=q,this.color=C.a.White(),this._debugLines=new Array,this._localAxes=null,this._isEnabled=!1,this._obs=null,this._scene=$,this._ready=!1,q.pauseAnimations=(H=q.pauseAnimations)===null||H===void 0||H,q.returnToRest=(X=q.returnToRest)!==null&&X!==void 0&&X,q.displayMode=(ee=q.displayMode)!==null&&ee!==void 0?ee:J.DISPLAY_LINES,q.displayOptions=(Q=q.displayOptions)!==null&&Q!==void 0?Q:{},q.displayOptions.midStep=(te=q.displayOptions.midStep)!==null&&te!==void 0?te:.235,q.displayOptions.midStepFactor=(ge=q.displayOptions.midStepFactor)!==null&&ge!==void 0?ge:.155,q.displayOptions.sphereBaseSize=(ce=q.displayOptions.sphereBaseSize)!==null&&ce!==void 0?ce:.15,q.displayOptions.sphereScaleUnit=(de=q.displayOptions.sphereScaleUnit)!==null&&de!==void 0?de:2,q.displayOptions.sphereFactor=(ne=q.displayOptions.sphereFactor)!==null&&ne!==void 0?ne:.865,q.displayOptions.spurFollowsChild=(pe=q.displayOptions.spurFollowsChild)!==null&&pe!==void 0&&pe,q.displayOptions.showLocalAxes=(Se=q.displayOptions.showLocalAxes)!==null&&Se!==void 0&&Se,q.displayOptions.localAxesSize=(Te=q.displayOptions.localAxesSize)!==null&&Te!==void 0?Te:.075,q.computeBonesUsingShaders=(Ne=q.computeBonesUsingShaders)===null||Ne===void 0||Ne,q.useAllBones=(je=q.useAllBones)===null||je===void 0||je;var Xe=G.getVerticesData(ve.b.MatricesIndicesKind),Ye=G.getVerticesData(ve.b.MatricesWeightsKind);if(this._boneIndices=new Set,!q.useAllBones&&Xe&&Ye)for(var Ke=0;Ke<Xe.length;++Ke){var nt=Xe[Ke];Ye[Ke]!==0&&this._boneIndices.add(nt)}this._utilityLayer=new U.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0;var qe=this.options.displayMode||0;qe>J.DISPLAY_SPHERE_AND_SPURS&&(qe=J.DISPLAY_LINES),this.displayMode=qe,this.update(),this._bindObs()}return J.CreateBoneWeightShader=function(B,G){var $,he,se,q,H,X,ee=B.skeleton,Q=($=B.colorBase)!==null&&$!==void 0?$:C.a.Black(),te=(he=B.colorZero)!==null&&he!==void 0?he:C.a.Blue(),ge=(se=B.colorQuarter)!==null&&se!==void 0?se:C.a.Green(),ce=(q=B.colorHalf)!==null&&q!==void 0?q:C.a.Yellow(),de=(H=B.colorFull)!==null&&H!==void 0?H:C.a.Red(),ne=(X=B.targetBoneIndex)!==null&&X!==void 0?X:0;ue.a.ShadersStore["boneWeights:"+ee.name+"VertexShader"]=`precision highp float;

        attribute vec3 position;
        attribute vec2 uv;

        uniform mat4 view;
        uniform mat4 projection;
        uniform mat4 worldViewProjection;

        #include<bonesDeclaration>
        #if NUM_BONE_INFLUENCERS == 0
            attribute vec4 matricesIndices;
            attribute vec4 matricesWeights;
        #endif

        #include<instancesDeclaration>

        varying vec3 vColor;

        uniform vec3 colorBase;
        uniform vec3 colorZero;
        uniform vec3 colorQuarter;
        uniform vec3 colorHalf;
        uniform vec3 colorFull;

        uniform float targetBoneIndex;

        void main() {
            vec3 positionUpdated = position;

            #include<instancesVertex>
            #include<bonesVertex>

            vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

            vec3 color = colorBase;
            float totalWeight = 0.;
            if(matricesIndices[0] == targetBoneIndex && matricesWeights[0] > 0.){
                totalWeight += matricesWeights[0];
            }
            if(matricesIndices[1] == targetBoneIndex && matricesWeights[1] > 0.){
                totalWeight += matricesWeights[1];
            }
            if(matricesIndices[2] == targetBoneIndex && matricesWeights[2] > 0.){
                totalWeight += matricesWeights[2];
            }
            if(matricesIndices[3] == targetBoneIndex && matricesWeights[3] > 0.){
                totalWeight += matricesWeights[3];
            }

            color = mix(color, colorZero, smoothstep(0., 0.25, totalWeight));
            color = mix(color, colorQuarter, smoothstep(0.25, 0.5, totalWeight));
            color = mix(color, colorHalf, smoothstep(0.5, 0.75, totalWeight));
            color = mix(color, colorFull, smoothstep(0.75, 1.0, totalWeight));
            vColor = color;

        gl_Position = projection * view * worldPos;
        }`,ue.a.ShadersStore["boneWeights:"+ee.name+"FragmentShader"]=`
            precision highp float;
            varying vec3 vPosition;

            varying vec3 vColor;

            void main() {
                vec4 color = vec4(vColor, 1.0);
                gl_FragColor = color;
            }
        `;var pe=new re.a("boneWeight:"+ee.name,G,{vertex:"boneWeights:"+ee.name,fragment:"boneWeights:"+ee.name},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorBase","colorZero","colorQuarter","colorHalf","colorFull","targetBoneIndex"]});return pe.setColor3("colorBase",Q),pe.setColor3("colorZero",te),pe.setColor3("colorQuarter",ge),pe.setColor3("colorHalf",ce),pe.setColor3("colorFull",de),pe.setFloat("targetBoneIndex",ne),pe.getClassName=function(){return"BoneWeightShader"},pe.transparencyMode=ie.a.MATERIAL_OPAQUE,pe},J.CreateSkeletonMapShader=function(B,G){var $,he=B.skeleton,se=($=B.colorMap)!==null&&$!==void 0?$:[{color:new C.a(1,.38,.18),location:0},{color:new C.a(.59,.18,1),location:.2},{color:new C.a(.59,1,.18),location:.4},{color:new C.a(1,.87,.17),location:.6},{color:new C.a(1,.17,.42),location:.8},{color:new C.a(.17,.68,1),location:1}],q=he.bones.length+1,H=J._CreateBoneMapColorBuffer(q,se,G),X=new re.a("boneWeights:"+he.name,G,{vertexSource:`precision highp float;

            attribute vec3 position;
            attribute vec2 uv;

            uniform mat4 view;
            uniform mat4 projection;
            uniform mat4 worldViewProjection;
            uniform float colorMap[`+4*he.bones.length+`];

            #include<bonesDeclaration>
            #if NUM_BONE_INFLUENCERS == 0
                attribute vec4 matricesIndices;
                attribute vec4 matricesWeights;
            #endif
            #include<instancesDeclaration>

            varying vec3 vColor;

            void main() {
                vec3 positionUpdated = position;

                #include<instancesVertex>
                #include<bonesVertex>

                vec3 color = vec3(0.);
                bool first = true;

                for (int i = 0; i < 4; i++) {
                    int boneIdx = int(matricesIndices[i]);
                    float boneWgt = matricesWeights[i];

                    vec3 c = vec3(colorMap[boneIdx * 4 + 0], colorMap[boneIdx * 4 + 1], colorMap[boneIdx * 4 + 2]);

                    if (boneWgt > 0.) {
                        if (first) {
                            first = false;
                            color = c;
                        } else {
                            color = mix(color, c, boneWgt);
                        }
                    }
                }

                vColor = color;

                vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

                gl_Position = projection * view * worldPos;
            }`,fragmentSource:`
            precision highp float;
            varying vec3 vColor;

            void main() {
                vec4 color = vec4( vColor, 1.0 );
                gl_FragColor = color;
            }
            `},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorMap"]});return X.setFloats("colorMap",H),X.getClassName=function(){return"SkeletonMapShader"},X.transparencyMode=ie.a.MATERIAL_OPAQUE,X},J._CreateBoneMapColorBuffer=function(B,G,$){var he=new ye.a("temp",{width:B,height:1},$,!1),se=he.getContext(),q=se.createLinearGradient(0,0,B,0);G.forEach(function(Q){q.addColorStop(Q.location,Q.color.toHexString())}),se.fillStyle=q,se.fillRect(0,0,B,1),he.update();for(var H=[],X=se.getImageData(0,0,B,1).data,ee=0;ee<X.length;ee++)H.push(X[ee]*(1/255));return he.dispose(),H},Object.defineProperty(J.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"isReady",{get:function(){return this._ready},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"ready",{set:function(B){this._ready=B},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"debugMesh",{get:function(){return this._debugMesh},set:function(B){this._debugMesh=B},enumerable:!1,configurable:!0}),Object.defineProperty(J.prototype,"displayMode",{get:function(){return this.options.displayMode||J.DISPLAY_LINES},set:function(B){B>J.DISPLAY_SPHERE_AND_SPURS&&(B=J.DISPLAY_LINES),this.options.displayMode=B},enumerable:!1,configurable:!0}),J.prototype._bindObs=function(){var B=this;switch(this.displayMode){case J.DISPLAY_LINES:this._obs=this.scene.onBeforeRenderObservable.add(function(){B._displayLinesUpdate()})}},J.prototype.update=function(){switch(this.displayMode){case J.DISPLAY_LINES:this._displayLinesUpdate();break;case J.DISPLAY_SPHERES:this._buildSpheresAndSpurs(!0);break;case J.DISPLAY_SPHERE_AND_SPURS:this._buildSpheresAndSpurs(!1)}this._buildLocalAxes()},Object.defineProperty(J.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(B){this.isEnabled!==B&&(this._isEnabled=B,this.debugMesh&&this.debugMesh.setEnabled(B),B&&!this._obs?this._bindObs():!B&&this._obs&&(this.scene.onBeforeRenderObservable.remove(this._obs),this._obs=null))},enumerable:!1,configurable:!0}),J.prototype._getBonePosition=function(B,G,$,he,se,q){he===void 0&&(he=0),se===void 0&&(se=0),q===void 0&&(q=0);var H=m.c.Matrix[0],X=G.getParent();if(H.copyFrom(G.getLocalMatrix()),he!==0||se!==0||q!==0){var ee=m.c.Matrix[1];m.a.IdentityToRef(ee),ee.setTranslationFromFloats(he,se,q),ee.multiplyToRef(H,H)}X&&H.multiplyToRef(X.getAbsoluteTransform(),H),H.multiplyToRef($,H),B.x=H.m[12],B.y=H.m[13],B.z=H.m[14]},J.prototype._getLinesForBonesWithLength=function(B,G){for(var $=B.length,he=this.mesh._effectiveMesh.position,se=0,q=0;q<$;q++){var H=B[q],X=this._debugLines[se];H._index!==-1&&(this._boneIndices.has(H.getIndex())||this.options.useAllBones)&&(X||(X=[m.e.Zero(),m.e.Zero()],this._debugLines[se]=X),this._getBonePosition(X[0],H,G),this._getBonePosition(X[1],H,G,0,H.length,0),X[0].subtractInPlace(he),X[1].subtractInPlace(he),se++)}},J.prototype._getLinesForBonesNoLength=function(B){for(var G=B.length,$=0,he=this.mesh._effectiveMesh,se=he.position,q=G-1;q>=0;q--){var H=B[q],X=H.getParent();if(X&&(this._boneIndices.has(H.getIndex())||this.options.useAllBones)){var ee=this._debugLines[$];ee||(ee=[m.e.Zero(),m.e.Zero()],this._debugLines[$]=ee),H.getAbsolutePositionToRef(he,ee[0]),X.getAbsolutePositionToRef(he,ee[1]),ee[0].subtractInPlace(se),ee[1].subtractInPlace(se),$++}}},J.prototype._revert=function(B){this.options.pauseAnimations&&(this.scene.animationsEnabled=B,this.utilityLayer.utilityLayerScene.animationsEnabled=B)},J.prototype._getAbsoluteBindPoseToRef=function(B,G){B!==null&&B._index!==-1?(this._getAbsoluteBindPoseToRef(B.getParent(),G),B.getBindPose().multiplyToRef(G,G)):G.copyFrom(m.a.Identity())},J.prototype._buildSpheresAndSpurs=function(B){var G,$;B===void 0&&(B=!0),this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this._ready=!1;var he=(G=this.utilityLayer)===null||G===void 0?void 0:G.utilityLayerScene,se=this.skeleton.bones,q=[],H=[],X=this.scene.animationsEnabled;try{this.options.pauseAnimations&&(this.scene.animationsEnabled=!1,he.animationsEnabled=!1),this.options.returnToRest&&this.skeleton.returnToRest(),this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();for(var ee=Number.NEGATIVE_INFINITY,Q=this.options.displayOptions||{},te=function(Ke){var nt=se[Ke];if(nt._index===-1||!ge._boneIndices.has(nt.getIndex())&&!ge.options.useAllBones)return"continue";var qe=new m.a;ge._getAbsoluteBindPoseToRef(nt,qe);var ct=new m.e;qe.decompose(void 0,void 0,ct),nt.children.forEach(function(Wt,Ft){var Ht=new m.a;Wt.getBindPose().multiplyToRef(qe,Ht);var fn=new m.e;Ht.decompose(void 0,void 0,fn);var un=m.e.Distance(ct,fn);if(un>ee&&(ee=un),!B){for(var wn=fn.clone().subtract(ct.clone()),Fe=wn.length(),gr=wn.normalize().scale(Fe),On=Q.midStep||.165,$n=Q.midStepFactor||.215,He=gr.scale(On),jn=oe.a.ExtrudeShapeCustom("skeletonViewer",{shape:[new m.e(1,-1,0),new m.e(1,1,0),new m.e(-1,1,0),new m.e(-1,-1,0),new m.e(1,-1,0)],path:[m.e.Zero(),He,gr],scaleFunction:function(ns){switch(ns){case 0:case 2:return 0;case 1:return Fe*$n}return 0},sideOrientation:g.a.DEFAULTSIDE,updatable:!1},he),Io=jn.getTotalVertices(),et=[],dr=[],Kr=0;Kr<Io;Kr++)et.push(1,0,0,0),Q.spurFollowsChild&&Kr>9?dr.push(Wt.getIndex(),0,0,0):dr.push(nt.getIndex(),0,0,0);jn.position=ct.clone(),jn.setVerticesData(ve.b.MatricesWeightsKind,et,!1),jn.setVerticesData(ve.b.MatricesIndicesKind,dr,!1),jn.convertToFlatShadedMesh(),H.push(jn)}});for(var ot=Q.sphereBaseSize||.2,_t=O.a.CreateSphere("skeletonViewer",{segments:6,diameter:ot,updatable:!0},he),gt=_t.getTotalVertices(),At=[],wt=[],Qt=0;Qt<gt;Qt++)At.push(1,0,0,0),wt.push(nt.getIndex(),0,0,0);_t.setVerticesData(ve.b.MatricesWeightsKind,At,!1),_t.setVerticesData(ve.b.MatricesIndicesKind,wt,!1),_t.position=ct.clone(),q.push([_t,nt])},ge=this,ce=0;ce<se.length;ce++)te(ce);var de=Q.sphereScaleUnit||2,ne=Q.sphereFactor||.85,pe=[];for(ce=0;ce<q.length;ce++){for(var Se=q[ce],Te=Se[0],Ne=Se[1],je=1/(de/ee),Xe=0,Ye=Ne;Ye.getParent()&&Ye.getParent().getIndex()!==-1;)Xe++,Ye=Ye.getParent();Te.scaling.scaleInPlace(je*Math.pow(ne,Xe)),pe.push(Te)}this.debugMesh=g.a.MergeMeshes(pe.concat(H),!0,!0),this.debugMesh&&(this.debugMesh.renderingGroupId=this.renderingGroupId,this.debugMesh.skeleton=this.skeleton,this.debugMesh.parent=this.mesh,this.debugMesh.computeBonesUsingShaders=($=this.options.computeBonesUsingShaders)===null||$===void 0||$,this.debugMesh.alwaysSelectAsActiveMesh=!0),this.utilityLayer._getSharedGizmoLight().intensity=.7,this._revert(X),this.ready=!0}catch(Ke){console.error(Ke),this._revert(X),this.dispose()}},J.prototype._buildLocalAxes=function(){var B;this._localAxes&&this._localAxes.dispose(),this._localAxes=null;var G=this.options.displayOptions||{};if(G.showLocalAxes){var $=this._utilityLayer.utilityLayerScene,he=G.localAxesSize||.075,se=[],q=[],H=new C.b(1,0,0,1),X=new C.b(0,1,0,1),ee=new C.b(0,0,1,1),Q=[],te=[];for(var ge in this.skeleton.bones){var ce=this.skeleton.bones[ge];if(ce._index!==-1&&(this._boneIndices.has(ce.getIndex())||this.options.useAllBones)){var de=new m.a,ne=new m.e;this._getAbsoluteBindPoseToRef(ce,de),de.decompose(void 0,void 0,ne);var pe=ce.getBindPose().getRotationMatrix(),Se=m.e.TransformCoordinates(new m.e(0+he,0,0),pe),Te=m.e.TransformCoordinates(new m.e(0,0+he,0),pe),Ne=m.e.TransformCoordinates(new m.e(0,0,0+he),pe),je=[[ne,ne.add(Se)],[ne,ne.add(Te)],[ne,ne.add(Ne)]],Xe=[[H,H],[X,X],[ee,ee]];se.push.apply(se,je),q.push.apply(q,Xe);for(var Ye=0;Ye<6;Ye++)Q.push(1,0,0,0),te.push(ce.getIndex(),0,0,0)}}this._localAxes=Y.a.CreateLineSystem("localAxes",{lines:se,colors:q,updatable:!0},$),this._localAxes.setVerticesData(ve.b.MatricesWeightsKind,Q,!1),this._localAxes.setVerticesData(ve.b.MatricesIndicesKind,te,!1),this._localAxes.skeleton=this.skeleton,this._localAxes.renderingGroupId=this.renderingGroupId,this._localAxes.parent=this.mesh,this._localAxes.computeBonesUsingShaders=(B=this.options.computeBonesUsingShaders)===null||B===void 0||B}},J.prototype._displayLinesUpdate=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var B=this.mesh._effectiveMesh;this.skeleton.bones[0].length===void 0?this._getLinesForBonesNoLength(this.skeleton.bones):this._getLinesForBonesWithLength(this.skeleton.bones,B.getWorldMatrix());var G=this._utilityLayer.utilityLayerScene;G&&(this._debugMesh?Y.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},G):(this._debugMesh=Y.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},G),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color)}},J.prototype.changeDisplayMode=function(B){var G=!!this.isEnabled;this.displayMode!==B&&(this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.displayMode=B,this.update(),this._bindObs(),this.isEnabled=G)},J.prototype.changeDisplayOptions=function(B,G){var $=!!this.isEnabled;this.options.displayOptions[B]=G,this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.update(),this._bindObs(),this.isEnabled=$},J.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null),this.ready=!1},J.DISPLAY_LINES=0,J.DISPLAY_SPHERES=1,J.DISPLAY_SPHERE_AND_SPURS=2,J}()},function(p,s,c){var E="morphTargetsVertex",m=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"b",function(){return m}),c.d(s,"a",function(){return S});var E=c(0);function m(h,C,R,I,b){b===void 0&&(b=null);for(var f=new E.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new E.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),P=R;P<R+I;P++){var A=3*C[P],T=h[A],_=h[A+1],g=h[A+2];f.minimizeInPlaceFromFloats(T,_,g),x.maximizeInPlaceFromFloats(T,_,g)}return b&&(f.x-=f.x*b.x+b.y,f.y-=f.y*b.x+b.y,f.z-=f.z*b.x+b.y,x.x+=x.x*b.x+b.y,x.y+=x.y*b.x+b.y,x.z+=x.z*b.x+b.y),{minimum:f,maximum:x}}function S(h,C,R,I,b){I===void 0&&(I=null);var f=new E.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new E.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);b||(b=3);for(var P=C,A=C*b;P<C+R;P++,A+=b){var T=h[A],_=h[A+1],g=h[A+2];f.minimizeInPlaceFromFloats(T,_,g),x.maximizeInPlaceFromFloats(T,_,g)}return I&&(f.x-=f.x*I.x+I.y,f.y-=f.y*I.x+I.y,f.z-=f.z*I.x+I.y,x.x+=x.x*I.x+I.y,x.y+=x.y*I.x+I.y,x.z+=x.z*I.x+I.y),{minimum:f,maximum:x}}},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){}},function(p,s,c){c.d(s,"a",function(){return h});var E=c(44),m=c(0),S=c(28),h=function(){function C(R,I,b){this.vectors=E.a.BuildArray(8,m.e.Zero),this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.extendSize=m.e.Zero(),this.extendSizeWorld=m.e.Zero(),this.directions=E.a.BuildArray(3,m.e.Zero),this.vectorsWorld=E.a.BuildArray(8,m.e.Zero),this.minimumWorld=m.e.Zero(),this.maximumWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(R,I,b)}return C.prototype.reConstruct=function(R,I,b){var f=R.x,x=R.y,P=R.z,A=I.x,T=I.y,_=I.z,g=this.vectors;this.minimum.copyFromFloats(f,x,P),this.maximum.copyFromFloats(A,T,_),g[0].copyFromFloats(f,x,P),g[1].copyFromFloats(A,T,_),g[2].copyFromFloats(A,x,P),g[3].copyFromFloats(f,T,P),g[4].copyFromFloats(f,x,_),g[5].copyFromFloats(A,T,P),g[6].copyFromFloats(f,T,_),g[7].copyFromFloats(A,x,_),I.addToRef(R,this.center).scaleInPlace(.5),I.subtractToRef(R,this.extendSize).scaleInPlace(.5),this._worldMatrix=b||m.a.IdentityReadOnly,this._update(this._worldMatrix)},C.prototype.scale=function(R){var I=C.TmpVector3,b=this.maximum.subtractToRef(this.minimum,I[0]),f=b.length();b.normalizeFromLength(f);var x=f*R,P=b.scaleInPlace(.5*x),A=this.center.subtractToRef(P,I[1]),T=this.center.addToRef(P,I[2]);return this.reConstruct(A,T,this._worldMatrix),this},C.prototype.getWorldMatrix=function(){return this._worldMatrix},C.prototype._update=function(R){var I=this.minimumWorld,b=this.maximumWorld,f=this.directions,x=this.vectorsWorld,P=this.vectors;if(R.isIdentity()){for(I.copyFrom(this.minimum),b.copyFrom(this.maximum),A=0;A<8;++A)x[A].copyFrom(P[A]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{I.setAll(Number.MAX_VALUE),b.setAll(-Number.MAX_VALUE);for(var A=0;A<8;++A){var T=x[A];m.e.TransformCoordinatesToRef(P[A],R,T),I.minimizeInPlace(T),b.maximizeInPlace(T)}b.subtractToRef(I,this.extendSizeWorld).scaleInPlace(.5),b.addToRef(I,this.centerWorld).scaleInPlace(.5)}m.e.FromArrayToRef(R.m,0,f[0]),m.e.FromArrayToRef(R.m,4,f[1]),m.e.FromArrayToRef(R.m,8,f[2]),this._worldMatrix=R},C.prototype.isInFrustum=function(R){return C.IsInFrustum(this.vectorsWorld,R)},C.prototype.isCompletelyInFrustum=function(R){return C.IsCompletelyInFrustum(this.vectorsWorld,R)},C.prototype.intersectsPoint=function(R){var I=this.minimumWorld,b=this.maximumWorld,f=I.x,x=I.y,P=I.z,A=b.x,T=b.y,_=b.z,g=R.x,M=R.y,O=R.z,N=-S.a;return!(A-g<N||N>g-f)&&!(T-M<N||N>M-x)&&!(_-O<N||N>O-P)},C.prototype.intersectsSphere=function(R){return C.IntersectsSphere(this.minimumWorld,this.maximumWorld,R.centerWorld,R.radiusWorld)},C.prototype.intersectsMinMax=function(R,I){var b=this.minimumWorld,f=this.maximumWorld,x=b.x,P=b.y,A=b.z,T=f.x,_=f.y,g=f.z,M=R.x,O=R.y,N=R.z,V=I.x,U=I.y,L=I.z;return!(T<M||x>V)&&!(_<O||P>U)&&!(g<N||A>L)},C.Intersects=function(R,I){return R.intersectsMinMax(I.minimumWorld,I.maximumWorld)},C.IntersectsSphere=function(R,I,b,f){var x=C.TmpVector3[0];return m.e.ClampToRef(b,R,I,x),m.e.DistanceSquared(b,x)<=f*f},C.IsCompletelyInFrustum=function(R,I){for(var b=0;b<6;++b)for(var f=I[b],x=0;x<8;++x)if(f.dotCoordinate(R[x])<0)return!1;return!0},C.IsInFrustum=function(R,I){for(var b=0;b<6;++b){for(var f=!0,x=I[b],P=0;P<8;++P)if(x.dotCoordinate(R[P])>=0){f=!1;break}if(f)return!1}return!0},C.TmpVector3=E.a.BuildArray(3,m.e.Zero),C}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(38),m=function(){function S(){}return S.SetImmediate=function(h){E.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(h):setTimeout(h,1)},S}()},function(p,s,c){c.d(s,"a",function(){return S});var E=c(0),m=c(2),S=function(){function h(){this.previousWorldMatrices={},this.previousBones={}}return h.AddUniforms=function(C){C.push("previousWorld","previousViewProjection")},h.AddSamplers=function(C){},h.prototype.bindForSubMesh=function(C,R,I,b,f){R.prePassRenderer&&R.prePassRenderer.enabled&&R.prePassRenderer.getIndex(m.a.PREPASS_VELOCITY_TEXTURE_TYPE)!==-1&&(this.previousWorldMatrices[I.uniqueId]||(this.previousWorldMatrices[I.uniqueId]=E.a.Identity()),this.previousViewProjection||(this.previousViewProjection=R.getTransformMatrix()),C.setMatrix("previousWorld",this.previousWorldMatrices[I.uniqueId]),C.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[I.uniqueId]=b.clone(),this.previousViewProjection=R.getTransformMatrix().clone())},h}()},function(p,s,c){var E="lightFragmentDeclaration",m=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="lightUboDeclaration",m=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="imageProcessingDeclaration",m=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="imageProcessingFunctions",m=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="clipPlaneFragment",m=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="clipPlaneVertex",m=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._count=0,this._data={}}return m.prototype.copyFrom=function(S){var h=this;this.clear(),S.forEach(function(C,R){return h.add(C,R)})},m.prototype.get=function(S){var h=this._data[S];if(h!==void 0)return h},m.prototype.getOrAddWithFactory=function(S,h){var C=this.get(S);return C!==void 0||(C=h(S))&&this.add(S,C),C},m.prototype.getOrAdd=function(S,h){var C=this.get(S);return C!==void 0?C:(this.add(S,h),h)},m.prototype.contains=function(S){return this._data[S]!==void 0},m.prototype.add=function(S,h){return this._data[S]===void 0&&(this._data[S]=h,++this._count,!0)},m.prototype.set=function(S,h){return this._data[S]!==void 0&&(this._data[S]=h,!0)},m.prototype.getAndRemove=function(S){var h=this.get(S);return h!==void 0?(delete this._data[S],--this._count,h):null},m.prototype.remove=function(S){return!!this.contains(S)&&(delete this._data[S],--this._count,!0)},m.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(m.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),m.prototype.forEach=function(S){for(var h in this._data)S(h,this._data[h])},m.prototype.first=function(S){for(var h in this._data){var C=S(h,this._data[h]);if(C)return C}return null},m}()},function(p,s,c){c.d(s,"a",function(){return S});var E=c(44),m=c(0),S=function(){function h(C,R,I){this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(C,R,I)}return h.prototype.reConstruct=function(C,R,I){this.minimum.copyFrom(C),this.maximum.copyFrom(R);var b=m.e.Distance(C,R);R.addToRef(C,this.center).scaleInPlace(.5),this.radius=.5*b,this._update(I||m.a.IdentityReadOnly)},h.prototype.scale=function(C){var R=this.radius*C,I=h.TmpVector3,b=I[0].setAll(R),f=this.center.subtractToRef(b,I[1]),x=this.center.addToRef(b,I[2]);return this.reConstruct(f,x,this._worldMatrix),this},h.prototype.getWorldMatrix=function(){return this._worldMatrix},h.prototype._update=function(C){if(C.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{m.e.TransformCoordinatesToRef(this.center,C,this.centerWorld);var R=h.TmpVector3[0];m.e.TransformNormalFromFloatsToRef(1,1,1,C,R),this.radiusWorld=Math.max(Math.abs(R.x),Math.abs(R.y),Math.abs(R.z))*this.radius}},h.prototype.isInFrustum=function(C){for(var R=this.centerWorld,I=this.radiusWorld,b=0;b<6;b++)if(C[b].dotCoordinate(R)<=-I)return!1;return!0},h.prototype.isCenterInFrustum=function(C){for(var R=this.centerWorld,I=0;I<6;I++)if(C[I].dotCoordinate(R)<0)return!1;return!0},h.prototype.intersectsPoint=function(C){var R=m.e.DistanceSquared(this.centerWorld,C);return!(this.radiusWorld*this.radiusWorld<R)},h.Intersects=function(C,R){var I=m.e.DistanceSquared(C.centerWorld,R.centerWorld),b=C.radiusWorld+R.radiusWorld;return!(b*b<I)},h.TmpVector3=E.a.BuildArray(3,m.e.Zero),h}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(m,S,h){this.bu=m,this.bv=S,this.distance=h,this.faceId=0,this.subMeshId=0}},function(p,s,c){var E="clipPlaneFragmentDeclaration",m=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="logDepthDeclaration",m=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="clipPlaneVertexDeclaration",m=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.prototype.attributeProcessor=function(S){return S.replace("attribute","in")},m.prototype.varyingProcessor=function(S,h){return S.replace("varying",h?"in":"out")},m.prototype.postProcessor=function(S,h,C){var R=S.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1;if(S=(S=S.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),C)S=(S=(S=(S=(S=(S=(S=S.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(R?"":`out vec4 glFragColor;
`)+"void main(");else if(h.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+S;return S},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.BindClipPlane=function(S,h){if(h.clipPlane){var C=h.clipPlane;S.setFloat4("vClipPlane",C.normal.x,C.normal.y,C.normal.z,C.d)}h.clipPlane2&&(C=h.clipPlane2,S.setFloat4("vClipPlane2",C.normal.x,C.normal.y,C.normal.z,C.d)),h.clipPlane3&&(C=h.clipPlane3,S.setFloat4("vClipPlane3",C.normal.x,C.normal.y,C.normal.z,C.d)),h.clipPlane4&&(C=h.clipPlane4,S.setFloat4("vClipPlane4",C.normal.x,C.normal.y,C.normal.z,C.d)),h.clipPlane5&&(C=h.clipPlane5,S.setFloat4("vClipPlane5",C.normal.x,C.normal.y,C.normal.z,C.d)),h.clipPlane6&&(C=h.clipPlane6,S.setFloat4("vClipPlane6",C.normal.x,C.normal.y,C.normal.z,C.d))},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(S){var h=16*Math.random()|0;return(S==="x"?h:3&h|8).toString(16)})},m}()},function(p,s,c){c.d(s,"a",function(){return h});var E=c(1),m=c(3),S=c(9),h=function(){function C(){this._dirty=!0,this._tempColor=new S.b(0,0,0,0),this._globalCurve=new S.b(0,0,0,0),this._highlightsCurve=new S.b(0,0,0,0),this._midtonesCurve=new S.b(0,0,0,0),this._shadowsCurve=new S.b(0,0,0,0),this._positiveCurve=new S.b(0,0,0,0),this._negativeCurve=new S.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(C.prototype,"globalHue",{get:function(){return this._globalHue},set:function(R){this._globalHue=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(R){this._globalDensity=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(R){this._globalSaturation=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(R){this._globalExposure=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(R){this._highlightsHue=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(R){this._highlightsDensity=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(R){this._highlightsSaturation=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(R){this._highlightsExposure=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(R){this._midtonesHue=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(R){this._midtonesDensity=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(R){this._midtonesSaturation=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(R){this._midtonesExposure=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(R){this._shadowsHue=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(R){this._shadowsDensity=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(R){this._shadowsSaturation=R,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(R){this._shadowsExposure=R,this._dirty=!0},enumerable:!1,configurable:!0}),C.prototype.getClassName=function(){return"ColorCurves"},C.Bind=function(R,I,b,f,x){b===void 0&&(b="vCameraColorCurvePositive"),f===void 0&&(f="vCameraColorCurveNeutral"),x===void 0&&(x="vCameraColorCurveNegative"),R._dirty&&(R._dirty=!1,R.getColorGradingDataToRef(R._globalHue,R._globalDensity,R._globalSaturation,R._globalExposure,R._globalCurve),R.getColorGradingDataToRef(R._highlightsHue,R._highlightsDensity,R._highlightsSaturation,R._highlightsExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._highlightsCurve),R.getColorGradingDataToRef(R._midtonesHue,R._midtonesDensity,R._midtonesSaturation,R._midtonesExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._midtonesCurve),R.getColorGradingDataToRef(R._shadowsHue,R._shadowsDensity,R._shadowsSaturation,R._shadowsExposure,R._tempColor),R._tempColor.multiplyToRef(R._globalCurve,R._shadowsCurve),R._highlightsCurve.subtractToRef(R._midtonesCurve,R._positiveCurve),R._midtonesCurve.subtractToRef(R._shadowsCurve,R._negativeCurve)),I&&(I.setFloat4(b,R._positiveCurve.r,R._positiveCurve.g,R._positiveCurve.b,R._positiveCurve.a),I.setFloat4(f,R._midtonesCurve.r,R._midtonesCurve.g,R._midtonesCurve.b,R._midtonesCurve.a),I.setFloat4(x,R._negativeCurve.r,R._negativeCurve.g,R._negativeCurve.b,R._negativeCurve.a))},C.PrepareUniforms=function(R){R.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},C.prototype.getColorGradingDataToRef=function(R,I,b,f,x){R!=null&&(R=C.clamp(R,0,360),I=C.clamp(I,-100,100),b=C.clamp(b,-100,100),f=C.clamp(f,-100,100),I=C.applyColorGradingSliderNonlinear(I),I*=.5,f=C.applyColorGradingSliderNonlinear(f),I<0&&(I*=-1,R=(R+180)%360),C.fromHSBToRef(R,I,50+.25*f,x),x.scaleToRef(2,x),x.a=1+.01*b)},C.applyColorGradingSliderNonlinear=function(R){R/=100;var I=Math.abs(R);return I=Math.pow(I,2),R<0&&(I*=-1),I*=100},C.fromHSBToRef=function(R,I,b,f){var x=C.clamp(R,0,360),P=C.clamp(I/100,0,1),A=C.clamp(b/100,0,1);if(P===0)f.r=A,f.g=A,f.b=A;else{x/=60;var T=Math.floor(x),_=x-T,g=A*(1-P),M=A*(1-P*_),O=A*(1-P*(1-_));switch(T){case 0:f.r=A,f.g=O,f.b=g;break;case 1:f.r=M,f.g=A,f.b=g;break;case 2:f.r=g,f.g=A,f.b=O;break;case 3:f.r=g,f.g=M,f.b=A;break;case 4:f.r=O,f.g=g,f.b=A;break;default:f.r=A,f.g=g,f.b=M}}f.a=1},C.clamp=function(R,I,b){return Math.min(Math.max(R,I),b)},C.prototype.clone=function(){return m.a.Clone(function(){return new C},this)},C.prototype.serialize=function(){return m.a.Serialize(this)},C.Parse=function(R){return m.a.Parse(function(){return new C},R,null,null)},Object(E.c)([Object(m.c)()],C.prototype,"_globalHue",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_globalDensity",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_globalSaturation",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_globalExposure",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_highlightsHue",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_highlightsDensity",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_highlightsSaturation",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_highlightsExposure",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_midtonesHue",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_midtonesDensity",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_midtonesSaturation",void 0),Object(E.c)([Object(m.c)()],C.prototype,"_midtonesExposure",void 0),C}();m.a._ColorCurvesParser=h.Parse},function(p,s,c){c.d(s,"a",function(){return S});var E=c(8),m=c(11),S=function(){function h(){}return h.Instantiate=function(C){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[C])return this.RegisteredExternalClasses[C];var R=m.a.GetClass(C);if(R)return R;E.a.Warn(C+" not found, you may have missed an import.");for(var I=C.split("."),b=window||this,f=0,x=I.length;f<x;f++)b=b[I[f]];return typeof b!="function"?null:b},h.RegisteredExternalClasses={},h}()},function(p,s,c){var E=c(26),m=c(2);E.a.prototype.setAlphaConstants=function(S,h,C,R){this._alphaState.setAlphaBlendConstants(S,h,C,R)},E.a.prototype.setAlphaMode=function(S,h){if(h===void 0&&(h=!1),this._alphaMode!==S){switch(S){case m.a.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case m.a.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_EXCLUSION:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}h||(this.depthCullingState.depthMask=S===m.a.ALPHA_DISABLE),this._alphaMode=S}},E.a.prototype.getAlphaMode=function(){return this._alphaMode},E.a.prototype.setAlphaEquation=function(S){if(this._alphaEquation!==S){switch(S){case m.a.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case m.a.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case m.a.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case m.a.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case m.a.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case m.a.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=S}},E.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},function(p,s,c){var E=c(26);E.a.prototype.updateDynamicIndexBuffer=function(m,S,h){var C;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(m),C=S instanceof Uint16Array||S instanceof Uint32Array?S:m.is32Bits?new Uint32Array(S):new Uint16Array(S),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,C,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},E.a.prototype.updateDynamicVertexBuffer=function(m,S,h,C){this.bindArrayBuffer(m),h===void 0&&(h=0);var R=S.length||S.byteLength;C===void 0||C>=R&&h===0?S instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,h,new Float32Array(S)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,h,S):S instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(S).subarray(h,h+C)):(S=S instanceof ArrayBuffer?new Uint8Array(S,h,C):new Uint8Array(S.buffer,S.byteOffset+h,C),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,S)),this._resetVertexBufferBinding()}},function(p,s,c){var E="fogFragmentDeclaration",m=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=c(26),m=c(27);E.a.prototype.createDynamicTexture=function(S,h,C,R){var I=new m.a(this,m.b.Dynamic);return I.baseWidth=S,I.baseHeight=h,C&&(S=this.needPOTTextures?E.a.GetExponentOfTwo(S,this._caps.maxTextureSize):S,h=this.needPOTTextures?E.a.GetExponentOfTwo(h,this._caps.maxTextureSize):h),I.width=S,I.height=h,I.isReady=!1,I.generateMipMaps=C,I.samplingMode=R,this.updateTextureSamplingMode(R,I),this._internalTexturesCache.push(I),I},E.a.prototype.updateDynamicTexture=function(S,h,C,R,I,b){if(R===void 0&&(R=!1),b===void 0&&(b=!1),S){var f=this._gl,x=f.TEXTURE_2D,P=this._bindTextureDirectly(x,S,!0,b);this._unpackFlipY(C===void 0?S.invertY:C),R&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var A=this._getWebGLTextureType(S.type),T=this._getInternalFormat(I||S.format),_=this._getRGBABufferInternalSizedFormat(S.type,T);f.texImage2D(x,0,_,T,A,h),S.generateMipMaps&&f.generateMipmap(x),P||this._bindTextureDirectly(x,null),R&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),S.isReady=!0}}},function(p,s,c){c.r(s),c.d(s,"AbstractScene",function(){return E.a}),c.d(s,"AbstractActionManager",function(){return m.a}),c.d(s,"Action",function(){return I}),c.d(s,"ActionEvent",function(){return b.a}),c.d(s,"ActionManager",function(){return ve}),c.d(s,"Condition",function(){return x}),c.d(s,"ValueCondition",function(){return P}),c.d(s,"PredicateCondition",function(){return A}),c.d(s,"StateCondition",function(){return T}),c.d(s,"SwitchBooleanAction",function(){return M}),c.d(s,"SetStateAction",function(){return O}),c.d(s,"SetValueAction",function(){return N}),c.d(s,"IncrementValueAction",function(){return V}),c.d(s,"PlayAnimationAction",function(){return U}),c.d(s,"StopAnimationAction",function(){return L}),c.d(s,"DoNothingAction",function(){return j}),c.d(s,"CombineAction",function(){return Y}),c.d(s,"ExecuteCodeAction",function(){return W}),c.d(s,"SetParentAction",function(){return ie}),c.d(s,"PlaySoundAction",function(){return ue}),c.d(s,"StopSoundAction",function(){return oe}),c.d(s,"InterpolateValueAction",function(){return X}),c.d(s,"Animatable",function(){return je}),c.d(s,"_IAnimationState",function(){return q}),c.d(s,"Animation",function(){return H}),c.d(s,"TargetedAnimation",function(){return Xe}),c.d(s,"AnimationGroup",function(){return Ye}),c.d(s,"AnimationPropertiesOverride",function(){return Ke}),c.d(s,"EasingFunction",function(){return qe}),c.d(s,"CircleEase",function(){return ct}),c.d(s,"BackEase",function(){return ot}),c.d(s,"BounceEase",function(){return _t}),c.d(s,"CubicEase",function(){return gt}),c.d(s,"ElasticEase",function(){return At}),c.d(s,"ExponentialEase",function(){return wt}),c.d(s,"PowerEase",function(){return Qt}),c.d(s,"QuadraticEase",function(){return Wt}),c.d(s,"QuarticEase",function(){return Ft}),c.d(s,"QuinticEase",function(){return Ht}),c.d(s,"SineEase",function(){return fn}),c.d(s,"BezierCurveEase",function(){return un}),c.d(s,"RuntimeAnimation",function(){return de}),c.d(s,"AnimationEvent",function(){return wn}),c.d(s,"AnimationKeyInterpolation",function(){return Z}),c.d(s,"AnimationRange",function(){return G}),c.d(s,"KeepAssets",function(){return gr}),c.d(s,"InstantiatedEntries",function(){return On}),c.d(s,"AssetContainer",function(){return $n}),c.d(s,"Analyser",function(){return jn}),c.d(s,"AudioEngine",function(){return Io}),c.d(s,"AudioSceneComponent",function(){return Qr}),c.d(s,"Sound",function(){return Kr}),c.d(s,"SoundTrack",function(){return ns}),c.d(s,"WeightedSound",function(){return hp}),c.d(s,"AutoRotationBehavior",function(){return Uu}),c.d(s,"BouncingBehavior",function(){return Vu}),c.d(s,"FramingBehavior",function(){return $i}),c.d(s,"AttachToBoxBehavior",function(){return dp}),c.d(s,"FadeInOutBehavior",function(){return fp}),c.d(s,"MultiPointerScaleBehavior",function(){return pp}),c.d(s,"PointerDragBehavior",function(){return vi.a}),c.d(s,"SixDofDragBehavior",function(){return ku}),c.d(s,"Bone",function(){return Ne}),c.d(s,"BoneIKController",function(){return mp}),c.d(s,"BoneLookController",function(){return _p}),c.d(s,"Skeleton",function(){return ba}),c.d(s,"ArcRotateCameraGamepadInput",function(){return Dc}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return wc}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return Lc}),c.d(s,"ArcRotateCameraPointersInput",function(){return Nc}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return Fc}),c.d(s,"FlyCameraKeyboardInput",function(){return Bc}),c.d(s,"FlyCameraMouseInput",function(){return wo}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return Ta}),c.d(s,"FollowCameraMouseWheelInput",function(){return Uc}),c.d(s,"FollowCameraPointersInput",function(){return Vc}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return zc}),c.d(s,"FreeCameraGamepadInput",function(){return Sa}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return os}),c.d(s,"FreeCameraMouseInput",function(){return kc}),c.d(s,"FreeCameraMouseWheelInput",function(){return as}),c.d(s,"FreeCameraTouchInput",function(){return jc}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return Lo}),c.d(s,"CameraInputTypes",function(){return Kn}),c.d(s,"CameraInputsManager",function(){return ya}),c.d(s,"Camera",function(){return Pt.a}),c.d(s,"TargetCamera",function(){return ai}),c.d(s,"FreeCamera",function(){return Ar}),c.d(s,"FreeCameraInputsManager",function(){return Ea}),c.d(s,"TouchCamera",function(){return Hc}),c.d(s,"ArcRotateCamera",function(){return Fi}),c.d(s,"ArcRotateCameraInputsManager",function(){return is}),c.d(s,"DeviceOrientationCamera",function(){return No}),c.d(s,"FlyCamera",function(){return eo}),c.d(s,"FlyCameraInputsManager",function(){return Wc}),c.d(s,"FollowCamera",function(){return Xc}),c.d(s,"ArcFollowCamera",function(){return Wu}),c.d(s,"FollowCameraInputsManager",function(){return Fo}),c.d(s,"GamepadCamera",function(){return Tn}),c.d(s,"AnaglyphArcRotateCamera",function(){return oy}),c.d(s,"AnaglyphFreeCamera",function(){return ay}),c.d(s,"AnaglyphGamepadCamera",function(){return sy}),c.d(s,"AnaglyphUniversalCamera",function(){return cy}),c.d(s,"StereoscopicArcRotateCamera",function(){return ly}),c.d(s,"StereoscopicFreeCamera",function(){return uy}),c.d(s,"StereoscopicGamepadCamera",function(){return hy}),c.d(s,"StereoscopicUniversalCamera",function(){return dy}),c.d(s,"UniversalCamera",function(){return Xt}),c.d(s,"VirtualJoysticksCamera",function(){return fy}),c.d(s,"VRCameraMetrics",function(){return ls}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return gy}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return Yu}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return vy}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return oI}),c.d(s,"VRExperienceHelper",function(){return Ey}),c.d(s,"WebVRFreeCamera",function(){return Qu}),c.d(s,"Collider",function(){return Sy}),c.d(s,"DefaultCollisionCoordinator",function(){return xy}),c.d(s,"PickingInfo",function(){return Pa.a}),c.d(s,"IntersectionInfo",function(){return aI.a}),c.d(s,"_MeshCollisionData",function(){return sI.a}),c.d(s,"BoundingBox",function(){return Pp.a}),c.d(s,"BoundingInfo",function(){return ko.a}),c.d(s,"BoundingSphere",function(){return Ay.a}),c.d(s,"Octree",function(){return Kc}),c.d(s,"OctreeBlock",function(){return Py}),c.d(s,"OctreeSceneComponent",function(){return Ip}),c.d(s,"Ray",function(){return Qn.a}),c.d(s,"AxesViewer",function(){return Ca.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return Ca.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return Ca.DebugLayerTab}),c.d(s,"DebugLayer",function(){return Ca.DebugLayer}),c.d(s,"PhysicsViewer",function(){return Ca.PhysicsViewer}),c.d(s,"RayHelper",function(){return Ca.RayHelper}),c.d(s,"SkeletonViewer",function(){return Ca.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return Cy}),c.d(s,"DeviceType",function(){return En}),c.d(s,"PointerInput",function(){return Cp}),c.d(s,"DualShockInput",function(){return Rp}),c.d(s,"XboxInput",function(){return Op}),c.d(s,"SwitchInput",function(){return Mp}),c.d(s,"DeviceSource",function(){return Ry}),c.d(s,"DeviceSourceManager",function(){return cI}),c.d(s,"Constants",function(){return g.a}),c.d(s,"ThinEngine",function(){return en.a}),c.d(s,"Engine",function(){return He.a}),c.d(s,"EngineStore",function(){return re.a}),c.d(s,"NullEngineOptions",function(){return Oy.b}),c.d(s,"NullEngine",function(){return Oy.a}),c.d(s,"_OcclusionDataStorage",function(){return Iy}),c.d(s,"_forceTransformFeedbackToBundle",function(){return lI}),c.d(s,"EngineView",function(){return uI}),c.d(s,"WebGLPipelineContext",function(){return dI.a}),c.d(s,"WebGL2ShaderProcessor",function(){return Dy.a}),c.d(s,"NativeEngine",function(){return gI}),c.d(s,"ShaderCodeInliner",function(){return wp}),c.d(s,"PerformanceConfigurator",function(){return vI.a}),c.d(s,"KeyboardEventTypes",function(){return Ji.a}),c.d(s,"KeyboardInfo",function(){return Ji.b}),c.d(s,"KeyboardInfoPre",function(){return Ji.c}),c.d(s,"PointerEventTypes",function(){return Ot.a}),c.d(s,"PointerInfoBase",function(){return Ot.c}),c.d(s,"PointerInfoPre",function(){return Ot.d}),c.d(s,"PointerInfo",function(){return Ot.b}),c.d(s,"ClipboardEventTypes",function(){return Ju}),c.d(s,"ClipboardInfo",function(){return bI}),c.d(s,"DaydreamController",function(){return Np}),c.d(s,"GearVRController",function(){return Fp}),c.d(s,"GenericController",function(){return eh}),c.d(s,"OculusTouchController",function(){return Bp}),c.d(s,"PoseEnabledControllerType",function(){return qr}),c.d(s,"PoseEnabledControllerHelper",function(){return Ui}),c.d(s,"PoseEnabledController",function(){return we}),c.d(s,"ViveController",function(){return Fy}),c.d(s,"WebVRController",function(){return Uo}),c.d(s,"WindowsMotionController",function(){return th}),c.d(s,"XRWindowsMotionController",function(){return TI}),c.d(s,"StickValues",function(){return gp}),c.d(s,"Gamepad",function(){return zn}),c.d(s,"GenericPad",function(){return zu}),c.d(s,"GamepadManager",function(){return gn}),c.d(s,"GamepadSystemSceneComponent",function(){return Mn}),c.d(s,"Xbox360Button",function(){return vr}),c.d(s,"Xbox360Dpad",function(){return Bi}),c.d(s,"Xbox360Pad",function(){return xt}),c.d(s,"DualShockButton",function(){return Ge}),c.d(s,"DualShockDpad",function(){return Je}),c.d(s,"DualShockPad",function(){return tn}),c.d(s,"AxisDragGizmo",function(){return nh.a}),c.d(s,"AxisScaleGizmo",function(){return Zc}),c.d(s,"BoundingBoxGizmo",function(){return By}),c.d(s,"Gizmo",function(){return kr.a}),c.d(s,"GizmoManager",function(){return EI}),c.d(s,"PlaneRotationGizmo",function(){return rh}),c.d(s,"PositionGizmo",function(){return Vy}),c.d(s,"RotationGizmo",function(){return Uy}),c.d(s,"ScaleGizmo",function(){return ky}),c.d(s,"LightGizmo",function(){return SI}),c.d(s,"CameraGizmo",function(){return AI}),c.d(s,"PlaneDragGizmo",function(){return ih}),c.d(s,"EnvironmentHelper",function(){return Gp}),c.d(s,"PhotoDome",function(){return BI}),c.d(s,"_forceSceneHelpersToBundle",function(){return RD}),c.d(s,"VideoDome",function(){return OD}),c.d(s,"EngineInstrumentation",function(){return MD}),c.d(s,"SceneInstrumentation",function(){return ID}),c.d(s,"_TimeToken",function(){return My}),c.d(s,"EffectLayer",function(){return ol}),c.d(s,"EffectLayerSceneComponent",function(){return r0}),c.d(s,"GlowLayer",function(){return fh}),c.d(s,"HighlightLayer",function(){return Zp}),c.d(s,"Layer",function(){return VD}),c.d(s,"LayerSceneComponent",function(){return o0}),c.d(s,"LensFlare",function(){return a0}),c.d(s,"LensFlareSystem",function(){return $p}),c.d(s,"LensFlareSystemSceneComponent",function(){return s0}),c.d(s,"Light",function(){return so.a}),c.d(s,"ShadowLight",function(){return oh}),c.d(s,"ShadowGenerator",function(){return Gr}),c.d(s,"CascadedShadowGenerator",function(){return Jp}),c.d(s,"ShadowGeneratorSceneComponent",function(){return p0}),c.d(s,"DirectionalLight",function(){return Vp}),c.d(s,"HemisphericLight",function(){return Ku.a}),c.d(s,"PointLight",function(){return em}),c.d(s,"SpotLight",function(){return kp}),c.d(s,"DefaultLoadingScreen",function(){return m0}),c.d(s,"_BabylonLoaderRegistered",function(){return iw}),c.d(s,"BabylonFileLoaderConfiguration",function(){return vh}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return oo}),c.d(s,"SceneLoader",function(){return an}),c.d(s,"SceneLoaderFlags",function(){return ao.a}),c.d(s,"BackgroundMaterial",function(){return Jc}),c.d(s,"ColorCurves",function(){return aw.a}),c.d(s,"EffectFallbacks",function(){return _s.a}),c.d(s,"Effect",function(){return Qe.a}),c.d(s,"FresnelParameters",function(){return C0}),c.d(s,"ImageProcessingConfigurationDefines",function(){return fr.b}),c.d(s,"ImageProcessingConfiguration",function(){return fr.a}),c.d(s,"Material",function(){return pn.a}),c.d(s,"MaterialDefines",function(){return sh.a}),c.d(s,"ThinMaterialHelper",function(){return R0.a}),c.d(s,"MaterialHelper",function(){return lt.a}),c.d(s,"MultiMaterial",function(){return Ra.a}),c.d(s,"PBRMaterialDefines",function(){return Wp}),c.d(s,"PBRBaseMaterial",function(){return nr}),c.d(s,"PBRBaseSimpleMaterial",function(){return om}),c.d(s,"PBRMaterial",function(){return nl}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return O0}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return M0}),c.d(s,"PushMaterial",function(){return ch.a}),c.d(s,"ShaderMaterial",function(){return bh.a}),c.d(s,"StandardMaterialDefines",function(){return rn.b}),c.d(s,"StandardMaterial",function(){return rn.a}),c.d(s,"BaseTexture",function(){return Zr.a}),c.d(s,"ColorGradingTexture",function(){return I0}),c.d(s,"CubeTexture",function(){return yi}),c.d(s,"DynamicTexture",function(){return to.a}),c.d(s,"EquiRectangularCubeTexture",function(){return D0}),c.d(s,"HDRFiltering",function(){return b0}),c.d(s,"HDRCubeTexture",function(){return mh}),c.d(s,"HtmlElementTexture",function(){return sw}),c.d(s,"InternalTextureSource",function(){return Nt.b}),c.d(s,"InternalTexture",function(){return Nt.a}),c.d(s,"_DDSTextureLoader",function(){return Wy}),c.d(s,"_ENVTextureLoader",function(){return Xy}),c.d(s,"_KTXTextureLoader",function(){return Yy}),c.d(s,"_TGATextureLoader",function(){return w0}),c.d(s,"_BasisTextureLoader",function(){return L0}),c.d(s,"MirrorTexture",function(){return zp}),c.d(s,"MultiRenderTarget",function(){return am}),c.d(s,"TexturePacker",function(){return uw}),c.d(s,"TexturePackerFrame",function(){return sm}),c.d(s,"CustomProceduralTexture",function(){return dw}),c.d(s,"NoiseProceduralTexture",function(){return F0}),c.d(s,"ProceduralTexture",function(){return cl}),c.d(s,"ProceduralTextureSceneComponent",function(){return N0}),c.d(s,"RawCubeTexture",function(){return pw}),c.d(s,"RawTexture",function(){return xr}),c.d(s,"RawTexture2DArray",function(){return mw}),c.d(s,"RawTexture3D",function(){return _w}),c.d(s,"RefractionTexture",function(){return gw}),c.d(s,"RenderTargetTexture",function(){return qn}),c.d(s,"Texture",function(){return ke.a}),c.d(s,"VideoTexture",function(){return n0}),c.d(s,"UniformBuffer",function(){return py.a}),c.d(s,"MaterialFlags",function(){return bt.a}),c.d(s,"NodeMaterialBlockTargets",function(){return Me}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return _e}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return cr}),c.d(s,"NodeMaterialSystemValues",function(){return Mt}),c.d(s,"NodeMaterialModes",function(){return Ir}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return Si}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return br}),c.d(s,"NodeMaterialConnectionPoint",function(){return Th}),c.d(s,"NodeMaterialBlock",function(){return Et}),c.d(s,"NodeMaterialDefines",function(){return dl}),c.d(s,"NodeMaterial",function(){return Ph}),c.d(s,"VertexOutputBlock",function(){return ll}),c.d(s,"BonesBlock",function(){return j0}),c.d(s,"InstancesBlock",function(){return z0}),c.d(s,"MorphTargetsBlock",function(){return G0}),c.d(s,"LightInformationBlock",function(){return H0}),c.d(s,"FragmentOutputBlock",function(){return Ps}),c.d(s,"ImageProcessingBlock",function(){return W0}),c.d(s,"PerturbNormalBlock",function(){return X0}),c.d(s,"DiscardBlock",function(){return Y0}),c.d(s,"FrontFacingBlock",function(){return K0}),c.d(s,"DerivativeBlock",function(){return Q0}),c.d(s,"FragCoordBlock",function(){return q0}),c.d(s,"ScreenSizeBlock",function(){return Z0}),c.d(s,"FogBlock",function(){return $0}),c.d(s,"LightBlock",function(){return J0}),c.d(s,"TextureBlock",function(){return eT}),c.d(s,"ReflectionTextureBlock",function(){return tT}),c.d(s,"CurrentScreenBlock",function(){return lm}),c.d(s,"InputBlock",function(){return Bt}),c.d(s,"AnimatedInputBlockTypes",function(){return Ho}),c.d(s,"MultiplyBlock",function(){return Sh}),c.d(s,"AddBlock",function(){return nT}),c.d(s,"ScaleBlock",function(){return rT}),c.d(s,"ClampBlock",function(){return iT}),c.d(s,"CrossBlock",function(){return oT}),c.d(s,"DotBlock",function(){return aT}),c.d(s,"TransformBlock",function(){return Eh}),c.d(s,"RemapBlock",function(){return fm}),c.d(s,"NormalizeBlock",function(){return sT}),c.d(s,"TrigonometryBlockOperations",function(){return Un}),c.d(s,"TrigonometryBlock",function(){return ym}),c.d(s,"ColorMergerBlock",function(){return cT}),c.d(s,"VectorMergerBlock",function(){return ul}),c.d(s,"ColorSplitterBlock",function(){return bm}),c.d(s,"VectorSplitterBlock",function(){return lT}),c.d(s,"LerpBlock",function(){return uT}),c.d(s,"DivideBlock",function(){return hT}),c.d(s,"SubtractBlock",function(){return dT}),c.d(s,"StepBlock",function(){return fT}),c.d(s,"OneMinusBlock",function(){return Sm}),c.d(s,"ViewDirectionBlock",function(){return xm}),c.d(s,"FresnelBlock",function(){return pT}),c.d(s,"MaxBlock",function(){return mT}),c.d(s,"MinBlock",function(){return _T}),c.d(s,"DistanceBlock",function(){return gT}),c.d(s,"LengthBlock",function(){return vT}),c.d(s,"NegateBlock",function(){return bT}),c.d(s,"PowBlock",function(){return yT}),c.d(s,"RandomNumberBlock",function(){return TT}),c.d(s,"ArcTan2Block",function(){return ET}),c.d(s,"SmoothStepBlock",function(){return ST}),c.d(s,"ReciprocalBlock",function(){return xT}),c.d(s,"ReplaceColorBlock",function(){return AT}),c.d(s,"PosterizeBlock",function(){return PT}),c.d(s,"WaveBlockKind",function(){return Oa}),c.d(s,"WaveBlock",function(){return CT}),c.d(s,"GradientBlockColorStep",function(){return Ch}),c.d(s,"GradientBlock",function(){return RT}),c.d(s,"NLerpBlock",function(){return OT}),c.d(s,"WorleyNoise3DBlock",function(){return MT}),c.d(s,"SimplexPerlin3DBlock",function(){return IT}),c.d(s,"NormalBlendBlock",function(){return DT}),c.d(s,"Rotate2dBlock",function(){return wT}),c.d(s,"ReflectBlock",function(){return LT}),c.d(s,"RefractBlock",function(){return NT}),c.d(s,"DesaturateBlock",function(){return FT}),c.d(s,"PBRMetallicRoughnessBlock",function(){return BT}),c.d(s,"SheenBlock",function(){return Am}),c.d(s,"AnisotropyBlock",function(){return Pm}),c.d(s,"ReflectionBlock",function(){return Cm}),c.d(s,"ClearCoatBlock",function(){return Rh}),c.d(s,"RefractionBlock",function(){return Rm}),c.d(s,"SubSurfaceBlock",function(){return Oh}),c.d(s,"ParticleTextureBlock",function(){return um}),c.d(s,"ParticleRampGradientBlock",function(){return hm}),c.d(s,"ParticleBlendMultiplyBlock",function(){return dm}),c.d(s,"ModBlock",function(){return UT}),c.d(s,"NodeMaterialOptimizer",function(){return Ew}),c.d(s,"PropertyTypeForEdition",function(){return $t}),c.d(s,"editableInPropertyPage",function(){return sn}),c.d(s,"EffectRenderer",function(){return g0}),c.d(s,"EffectWrapper",function(){return v0}),c.d(s,"ShadowDepthWrapper",function(){return Aw}),c.d(s,"Scalar",function(){return J.a}),c.d(s,"extractMinAndMaxIndexed",function(){return VT.b}),c.d(s,"extractMinAndMax",function(){return VT.a}),c.d(s,"Space",function(){return Te.c}),c.d(s,"Axis",function(){return Te.a}),c.d(s,"Coordinate",function(){return Te.b}),c.d(s,"Color3",function(){return C.a}),c.d(s,"Color4",function(){return C.b}),c.d(s,"TmpColors",function(){return C.c}),c.d(s,"ToGammaSpace",function(){return Zt.b}),c.d(s,"ToLinearSpace",function(){return Zt.c}),c.d(s,"Epsilon",function(){return Zt.a}),c.d(s,"Frustum",function(){return _y.a}),c.d(s,"Orientation",function(){return nt.e}),c.d(s,"BezierCurve",function(){return nt.c}),c.d(s,"Angle",function(){return nt.a}),c.d(s,"Arc2",function(){return nt.b}),c.d(s,"Path2",function(){return nt.f}),c.d(s,"Path3D",function(){return nt.g}),c.d(s,"Curve3",function(){return nt.d}),c.d(s,"Plane",function(){return hs.a}),c.d(s,"Size",function(){return he.a}),c.d(s,"Vector2",function(){return h.d}),c.d(s,"Vector3",function(){return h.e}),c.d(s,"Vector4",function(){return h.f}),c.d(s,"Quaternion",function(){return h.b}),c.d(s,"Matrix",function(){return h.a}),c.d(s,"TmpVectors",function(){return h.c}),c.d(s,"PositionNormalVertex",function(){return jp}),c.d(s,"PositionNormalTextureVertex",function(){return xI}),c.d(s,"Viewport",function(){return si.a}),c.d(s,"SphericalHarmonics",function(){return Dp}),c.d(s,"SphericalPolynomial",function(){return qc}),c.d(s,"AbstractMesh",function(){return jt.a}),c.d(s,"Buffer",function(){return De.a}),c.d(s,"VertexBuffer",function(){return De.b}),c.d(s,"DracoCompression",function(){return Cw}),c.d(s,"CSG",function(){return Mw}),c.d(s,"Geometry",function(){return tm.a}),c.d(s,"GroundMesh",function(){return Zu}),c.d(s,"TrailMesh",function(){return Iw}),c.d(s,"InstancedMesh",function(){return Dw.a}),c.d(s,"LinesMesh",function(){return pl.b}),c.d(s,"InstancedLinesMesh",function(){return pl.a}),c.d(s,"_CreationDataStorage",function(){return Fe.b}),c.d(s,"_InstancesBatch",function(){return Fe.c}),c.d(s,"Mesh",function(){return Fe.a}),c.d(s,"VertexData",function(){return Tt.a}),c.d(s,"MeshBuilder",function(){return Nw}),c.d(s,"SimplificationSettings",function(){return Fw}),c.d(s,"SimplificationQueue",function(){return WT}),c.d(s,"SimplificationType",function(){return gl}),c.d(s,"QuadraticErrorSimplification",function(){return YT}),c.d(s,"SimplicationQueueSceneComponent",function(){return KT}),c.d(s,"Polygon",function(){return Lw}),c.d(s,"PolygonMeshBuilder",function(){return GT}),c.d(s,"SubMesh",function(){return fl.a}),c.d(s,"MeshLODLevel",function(){return kw.a}),c.d(s,"TransformNode",function(){return ms.a}),c.d(s,"BoxBuilder",function(){return ps.a}),c.d(s,"TiledBoxBuilder",function(){return zT}),c.d(s,"DiscBuilder",function(){return Mh}),c.d(s,"RibbonBuilder",function(){return ml.a}),c.d(s,"SphereBuilder",function(){return jr.a}),c.d(s,"HemisphereBuilder",function(){return ah}),c.d(s,"CylinderBuilder",function(){return Vi.a}),c.d(s,"TorusBuilder",function(){return us}),c.d(s,"TorusKnotBuilder",function(){return Im}),c.d(s,"LinesBuilder",function(){return Jn.a}),c.d(s,"PolygonBuilder",function(){return _l}),c.d(s,"ShapeBuilder",function(){return gh.a}),c.d(s,"LatheBuilder",function(){return wm}),c.d(s,"PlaneBuilder",function(){return Up.a}),c.d(s,"TiledPlaneBuilder",function(){return HT}),c.d(s,"GroundBuilder",function(){return Vo}),c.d(s,"TubeBuilder",function(){return Lm}),c.d(s,"PolyhedronBuilder",function(){return $c}),c.d(s,"IcoSphereBuilder",function(){return Nm}),c.d(s,"DecalBuilder",function(){return Fm}),c.d(s,"CapsuleBuilder",function(){return Bm}),c.d(s,"DataBuffer",function(){return wy.a}),c.d(s,"WebGLDataBuffer",function(){return jw.a}),c.d(s,"MorphTarget",function(){return y0}),c.d(s,"MorphTargetManager",function(){return _h}),c.d(s,"RecastJSPlugin",function(){return zw}),c.d(s,"RecastJSCrowd",function(){return QT}),c.d(s,"Node",function(){return $.a}),c.d(s,"Database",function(){return qT}),c.d(s,"BaseParticleSystem",function(){return hl}),c.d(s,"BoxParticleEmitter",function(){return Cs}),c.d(s,"ConeParticleEmitter",function(){return pm}),c.d(s,"CylinderParticleEmitter",function(){return xh}),c.d(s,"CylinderDirectedParticleEmitter",function(){return mm}),c.d(s,"HemisphericParticleEmitter",function(){return _m}),c.d(s,"PointParticleEmitter",function(){return gm}),c.d(s,"SphereParticleEmitter",function(){return Ah}),c.d(s,"SphereDirectedParticleEmitter",function(){return vm}),c.d(s,"CustomParticleEmitter",function(){return Rs}),c.d(s,"MeshParticleEmitter",function(){return V0}),c.d(s,"GPUParticleSystem",function(){return Ma}),c.d(s,"Particle",function(){return $T}),c.d(s,"ParticleHelper",function(){return qw}),c.d(s,"ParticleSystem",function(){return er}),c.d(s,"ParticleSystemSet",function(){return Ih}),c.d(s,"SolidParticle",function(){return km}),c.d(s,"ModelShape",function(){return jm}),c.d(s,"DepthSortedParticle",function(){return JT}),c.d(s,"SolidParticleVertex",function(){return eE}),c.d(s,"SolidParticleSystem",function(){return Zw}),c.d(s,"CloudPoint",function(){return tE}),c.d(s,"PointsGroup",function(){return Dh}),c.d(s,"PointColor",function(){return yr}),c.d(s,"PointsCloudSystem",function(){return $w}),c.d(s,"SubEmitterType",function(){return Os}),c.d(s,"SubEmitter",function(){return vl}),c.d(s,"PhysicsEngine",function(){return xs}),c.d(s,"PhysicsEngineSceneComponent",function(){return nE}),c.d(s,"PhysicsHelper",function(){return Jw}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return Is}),c.d(s,"PhysicsUpdraftEventOptions",function(){return zm}),c.d(s,"PhysicsVortexEventOptions",function(){return Gm}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return bl}),c.d(s,"PhysicsUpdraftMode",function(){return Ms}),c.d(s,"PhysicsImpostor",function(){return Ut.a}),c.d(s,"PhysicsJoint",function(){return Fn.e}),c.d(s,"DistanceJoint",function(){return Fn.a}),c.d(s,"MotorEnabledJoint",function(){return Fn.d}),c.d(s,"HingeJoint",function(){return Fn.c}),c.d(s,"Hinge2Joint",function(){return Fn.b}),c.d(s,"CannonJSPlugin",function(){return im}),c.d(s,"AmmoJSPlugin",function(){return E0}),c.d(s,"OimoJSPlugin",function(){return T0}),c.d(s,"AnaglyphPostProcess",function(){return bp}),c.d(s,"BlackAndWhitePostProcess",function(){return iE}),c.d(s,"BloomEffect",function(){return Xm}),c.d(s,"BloomMergePostProcess",function(){return Wm}),c.d(s,"BlurPostProcess",function(){return ar}),c.d(s,"ChromaticAberrationPostProcess",function(){return Ym}),c.d(s,"CircleOfConfusionPostProcess",function(){return Km}),c.d(s,"ColorCorrectionPostProcess",function(){return oE}),c.d(s,"ConvolutionPostProcess",function(){return aE}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return wh}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return Ia}),c.d(s,"DepthOfFieldEffect",function(){return Qm}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return hL}),c.d(s,"DepthOfFieldMergePostProcess",function(){return sE}),c.d(s,"DisplayPassPostProcess",function(){return cE}),c.d(s,"ExtractHighlightsPostProcess",function(){return Hm}),c.d(s,"FilterPostProcess",function(){return lE}),c.d(s,"FxaaPostProcess",function(){return yl}),c.d(s,"GrainPostProcess",function(){return qm}),c.d(s,"HighlightsPostProcess",function(){return vL}),c.d(s,"ImageProcessingPostProcess",function(){return qu}),c.d(s,"MotionBlurPostProcess",function(){return Zm}),c.d(s,"PassPostProcess",function(){return Bo}),c.d(s,"PassCubePostProcess",function(){return J1}),c.d(s,"PostProcess",function(){return St}),c.d(s,"PostProcessManager",function(){return Tp.a}),c.d(s,"RefractionPostProcess",function(){return hE}),c.d(s,"DefaultRenderingPipeline",function(){return pE}),c.d(s,"LensRenderingPipeline",function(){return CL}),c.d(s,"SSAO2RenderingPipeline",function(){return mE}),c.d(s,"SSAORenderingPipeline",function(){return DL}),c.d(s,"StandardRenderingPipeline",function(){return _E}),c.d(s,"PostProcessRenderEffect",function(){return Yt}),c.d(s,"PostProcessRenderPipeline",function(){return Ds}),c.d(s,"PostProcessRenderPipelineManager",function(){return dE}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return fE}),c.d(s,"SharpenPostProcess",function(){return $m}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return BL}),c.d(s,"StereoscopicInterlacePostProcess",function(){return UL}),c.d(s,"TonemappingOperator",function(){return Da}),c.d(s,"TonemapPostProcess",function(){return kL}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return gE}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return yp}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return Ep}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return Jm}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return vE}),c.d(s,"ReflectionProbe",function(){return S0}),c.d(s,"BoundingBoxRenderer",function(){return bE}),c.d(s,"DepthRenderer",function(){return ph}),c.d(s,"DepthRendererSceneComponent",function(){return yE}),c.d(s,"EdgesRenderer",function(){return e_}),c.d(s,"LineEdgesRenderer",function(){return TE}),c.d(s,"GeometryBufferRenderer",function(){return xi}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return uE}),c.d(s,"PrePassRenderer",function(){return t_}),c.d(s,"PrePassRendererSceneComponent",function(){return EE}),c.d(s,"SubSurfaceSceneComponent",function(){return xE}),c.d(s,"OutlineRenderer",function(){return AE}),c.d(s,"RenderingGroup",function(){return JL.a}),c.d(s,"RenderingGroupInfo",function(){return Yc.a}),c.d(s,"RenderingManager",function(){return Yc.b}),c.d(s,"UtilityLayerRenderer",function(){return Mr.a}),c.d(s,"Scene",function(){return ne.a}),c.d(s,"SceneComponentConstants",function(){return dt.a}),c.d(s,"Stage",function(){return dt.b}),c.d(s,"Sprite",function(){return PE}),c.d(s,"SpriteManager",function(){return RE}),c.d(s,"SpriteMap",function(){return oN}),c.d(s,"SpritePackedManager",function(){return aN}),c.d(s,"SpriteSceneComponent",function(){return CE}),c.d(s,"AlphaState",function(){return sN.a}),c.d(s,"DepthCullingState",function(){return cN.a}),c.d(s,"StencilState",function(){return lN.a}),c.d(s,"AndOrNotEvaluator",function(){return uN.a}),c.d(s,"AssetTaskState",function(){return ji}),c.d(s,"AbstractAssetTask",function(){return zi}),c.d(s,"AssetsProgressEvent",function(){return OE}),c.d(s,"ContainerAssetTask",function(){return ME}),c.d(s,"MeshAssetTask",function(){return IE}),c.d(s,"TextFileAssetTask",function(){return DE}),c.d(s,"BinaryFileAssetTask",function(){return wE}),c.d(s,"ImageAssetTask",function(){return LE}),c.d(s,"TextureAssetTask",function(){return NE}),c.d(s,"CubeTextureAssetTask",function(){return FE}),c.d(s,"HDRCubeTextureAssetTask",function(){return BE}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return UE}),c.d(s,"AssetsManager",function(){return hN}),c.d(s,"BasisTranscodeConfiguration",function(){return cw}),c.d(s,"BasisTools",function(){return sl}),c.d(s,"DDSTools",function(){return zo}),c.d(s,"expandToProperty",function(){return B.b}),c.d(s,"serialize",function(){return B.c}),c.d(s,"serializeAsTexture",function(){return B.m}),c.d(s,"serializeAsColor3",function(){return B.e}),c.d(s,"serializeAsFresnelParameters",function(){return B.h}),c.d(s,"serializeAsVector2",function(){return B.n}),c.d(s,"serializeAsVector3",function(){return B.o}),c.d(s,"serializeAsMeshReference",function(){return B.k}),c.d(s,"serializeAsColorCurves",function(){return B.g}),c.d(s,"serializeAsColor4",function(){return B.f}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return B.i}),c.d(s,"serializeAsQuaternion",function(){return B.l}),c.d(s,"serializeAsMatrix",function(){return B.j}),c.d(s,"serializeAsCameraReference",function(){return B.d}),c.d(s,"SerializationHelper",function(){return B.a}),c.d(s,"Deferred",function(){return dN}),c.d(s,"EnvironmentTextureTools",function(){return io}),c.d(s,"MeshExploder",function(){return fN}),c.d(s,"FilesInput",function(){return pN}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return $u}),c.d(s,"HDRTools",function(){return _0}),c.d(s,"PanoramaToCubeMapTools",function(){return nm}),c.d(s,"KhronosTextureContainer",function(){return dh}),c.d(s,"EventState",function(){return S.a}),c.d(s,"Observer",function(){return S.d}),c.d(s,"MultiObserver",function(){return S.b}),c.d(s,"Observable",function(){return S.c}),c.d(s,"PerformanceMonitor",function(){return VE.a}),c.d(s,"RollingAverage",function(){return VE.b}),c.d(s,"PromisePolyfill",function(){return mN.a}),c.d(s,"SceneOptimization",function(){return Gi}),c.d(s,"TextureOptimization",function(){return Lh}),c.d(s,"HardwareScalingOptimization",function(){return r_}),c.d(s,"ShadowsOptimization",function(){return Nh}),c.d(s,"PostProcessesOptimization",function(){return Fh}),c.d(s,"LensFlaresOptimization",function(){return Bh}),c.d(s,"CustomOptimization",function(){return kE}),c.d(s,"ParticlesOptimization",function(){return Uh}),c.d(s,"RenderTargetsOptimization",function(){return i_}),c.d(s,"MergeMeshesOptimization",function(){return Vh}),c.d(s,"SceneOptimizerOptions",function(){return o_}),c.d(s,"SceneOptimizer",function(){return _N}),c.d(s,"SceneSerializer",function(){return s_}),c.d(s,"SmartArray",function(){return Gn.a}),c.d(s,"SmartArrayNoDuplicate",function(){return Gn.b}),c.d(s,"StringDictionary",function(){return Hu.a}),c.d(s,"Tags",function(){return gN.a}),c.d(s,"TextureTools",function(){return vN}),c.d(s,"TGATools",function(){return yh}),c.d(s,"Tools",function(){return et.b}),c.d(s,"className",function(){return et.c}),c.d(s,"AsyncLoop",function(){return et.a}),c.d(s,"VideoRecorder",function(){return bN}),c.d(s,"JoystickAxis",function(){return Nn}),c.d(s,"VirtualJoystick",function(){return Gc}),c.d(s,"WorkerPool",function(){return Yp}),c.d(s,"Logger",function(){return _.a}),c.d(s,"_TypeStore",function(){return R.a}),c.d(s,"FilesInputStore",function(){return Lp.a}),c.d(s,"DeepCopier",function(){return ye.a}),c.d(s,"PivotTools",function(){return Or.a}),c.d(s,"PrecisionDate",function(){return pe.a}),c.d(s,"ScreenshotTools",function(){return Tl}),c.d(s,"WebRequest",function(){return se.a}),c.d(s,"InspectableType",function(){return n_}),c.d(s,"BRDFTextureTools",function(){return lh}),c.d(s,"RGBDTextureTools",function(){return jy}),c.d(s,"ColorGradient",function(){return Um}),c.d(s,"Color3Gradient",function(){return ZT}),c.d(s,"FactorGradient",function(){return Vm}),c.d(s,"GradientHelper",function(){return Dr}),c.d(s,"PerfCounter",function(){return $r.a}),c.d(s,"RetryStrategy",function(){return yN.a}),c.d(s,"CanvasGenerator",function(){return Sp.a}),c.d(s,"LoadFileError",function(){return Qc.b}),c.d(s,"RequestFileError",function(){return Qc.d}),c.d(s,"ReadFileError",function(){return Qc.c}),c.d(s,"FileTools",function(){return Qc.a}),c.d(s,"StringTools",function(){return ci.a}),c.d(s,"DataReader",function(){return TN}),c.d(s,"MinMaxReducer",function(){return u0}),c.d(s,"DepthReducer",function(){return h0}),c.d(s,"DataStorage",function(){return EN}),c.d(s,"SceneRecorder",function(){return SN}),c.d(s,"KhronosTextureContainer2",function(){return Kp}),c.d(s,"Trajectory",function(){return xN}),c.d(s,"TrajectoryClassifier",function(){return AN}),c.d(s,"TimerState",function(){return Go}),c.d(s,"setAndStartTimer",function(){return qp}),c.d(s,"AdvancedTimer",function(){return PD}),c.d(s,"CopyTools",function(){return PN.a}),c.d(s,"WebXRCamera",function(){return Ky}),c.d(s,"WebXREnterExitUIButton",function(){return Jy}),c.d(s,"WebXREnterExitUIOptions",function(){return AD}),c.d(s,"WebXREnterExitUI",function(){return e0}),c.d(s,"WebXRExperienceHelper",function(){return Qy}),c.d(s,"WebXRInput",function(){return $y}),c.d(s,"WebXRInputSource",function(){return Zy}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return xp}),c.d(s,"WebXRManagedOutputCanvas",function(){return by}),c.d(s,"WebXRState",function(){return tr}),c.d(s,"WebXRTrackingState",function(){return Aa}),c.d(s,"WebXRSessionManager",function(){return Ap}),c.d(s,"WebXRDefaultExperienceOptions",function(){return CD}),c.d(s,"WebXRDefaultExperience",function(){return t0}),c.d(s,"WebXRFeatureName",function(){return Ti}),c.d(s,"WebXRFeaturesManager",function(){return li}),c.d(s,"WebXRAbstractFeature",function(){return Ei}),c.d(s,"WebXRHitTestLegacy",function(){return jh}),c.d(s,"WebXRAnchorSystem",function(){return zh}),c.d(s,"WebXRPlaneDetector",function(){return Gh}),c.d(s,"WebXRBackgroundRemover",function(){return Hh}),c.d(s,"WebXRMotionControllerTeleportation",function(){return il}),c.d(s,"WebXRControllerPointerSelection",function(){return rl}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return ON}),c.d(s,"WebXRControllerPhysics",function(){return Wh}),c.d(s,"WebXRHitTest",function(){return Xh}),c.d(s,"WebXRFeaturePointSystem",function(){return Yh}),c.d(s,"WebXRHand",function(){return HE}),c.d(s,"WebXRHandTracking",function(){return Kh}),c.d(s,"WebXRAbstractMotionController",function(){return Ts}),c.d(s,"WebXRControllerComponent",function(){return ys}),c.d(s,"WebXRGenericTriggerMotionController",function(){return Qp}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return WE}),c.d(s,"WebXRMotionControllerManager",function(){return zr}),c.d(s,"WebXROculusTouchMotionController",function(){return l_}),c.d(s,"WebXRHTCViveMotionController",function(){return XE}),c.d(s,"WebXRProfiledMotionController",function(){return qy});var E=c(35),m=c(91),S=c(6),h=c(0),C=c(9),R=c(11),I=function(){function i(t,e){this.triggerOptions=t,this.onBeforeExecuteObservable=new S.c,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):t.trigger?this.trigger=t.trigger:this.trigger=t,this._nextActiveAction=this,this._condition=e}return i.prototype._prepare=function(){},i.prototype.getTriggerParameter=function(){return this._triggerParameter},i.prototype._executeCurrent=function(t){if(this._nextActiveAction._condition){var e=this._nextActiveAction._condition,n=this._actionManager.getScene().getRenderId();if(e._evaluationId===n){if(!e._currentResult)return}else{if(e._evaluationId=n,!e.isValid())return void(e._currentResult=!1);e._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(t),this.skipToNextActiveAction()},i.prototype.execute=function(t){},i.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},i.prototype.then=function(t){return this._child=t,t._actionManager=this._actionManager,t._prepare(),t},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(t){},i.prototype._serialize=function(t,e){var n={type:1,children:[],name:t.name,properties:t.properties||[]};if(this._child&&this._child.serialize(n),this._condition){var r=this._condition.serialize();return r.children.push(n),e&&e.children.push(r),r}return e&&e.children.push(n),n},i._SerializeValueAsString=function(t){return typeof t=="number"?t.toString():typeof t=="boolean"?t?"true":"false":t instanceof h.d?t.x+", "+t.y:t instanceof h.e?t.x+", "+t.y+", "+t.z:t instanceof C.a?t.r+", "+t.g+", "+t.b:t instanceof C.b?t.r+", "+t.g+", "+t.b+", "+t.a:t},i._GetTargetProperty=function(t){return{name:"target",targetType:t._isMesh?"MeshProperties":t._isLight?"LightProperties":t._isCamera?"CameraProperties":"SceneProperties",value:t._isScene?"Scene":t.name}},i}();R.a.RegisteredTypes["BABYLON.Action"]=I;var b=c(47),f=c(1),x=function(){function i(t){this._actionManager=t}return i.prototype.isValid=function(){return!0},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(){},i.prototype._serialize=function(t){return{type:2,children:[],name:t.name,properties:t.properties}},i}(),P=function(i){function t(e,n,r,o,l){l===void 0&&(l=t.IsEqual);var d=i.call(this,e)||this;return d.propertyPath=r,d.value=o,d.operator=l,d._target=n,d._effectiveTarget=d._getEffectiveTarget(n,d.propertyPath),d._property=d._getProperty(d.propertyPath),d}return Object(f.d)(t,i),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!1,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?e:!e}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(e){switch(e){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(x),A=function(i){function t(e,n){var r=i.call(this,e)||this;return r.predicate=n,r}return Object(f.d)(t,i),t.prototype.isValid=function(){return this.predicate()},t}(x),T=function(i){function t(e,n,r){var o=i.call(this,e)||this;return o.value=r,o._target=n,o}return Object(f.d)(t,i),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[I._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(x);R.a.RegisteredTypes["BABYLON.ValueCondition"]=P,R.a.RegisteredTypes["BABYLON.PredicateCondition"]=A,R.a.RegisteredTypes["BABYLON.StateCondition"]=T;var _=c(8),g=c(2),M=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l.propertyPath=r,l._target=l._effectiveTarget=n,l}return Object(f.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},e)},t}(I),O=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l.value=r,l._target=n,l}return Object(f.d)(t,i),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetStateAction",properties:[I._GetTargetProperty(this._target),{name:"value",value:this.value}]},e)},t}(I),N=function(i){function t(e,n,r,o,l){var d=i.call(this,e,l)||this;return d.propertyPath=r,d.value=o,d._target=d._effectiveTarget=n,d}return Object(f.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)}]},e)},t}(I),V=function(i){function t(e,n,r,o,l){var d=i.call(this,e,l)||this;return d.propertyPath=r,d.value=o,d._target=d._effectiveTarget=n,d}return Object(f.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&_.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)}]},e)},t}(I),U=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,d)||this;return v.from=r,v.to=o,v.loop=l,v._target=n,v}return Object(f.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[I._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:I._SerializeValueAsString(this.loop)||!1}]},e)},t}(I),L=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._target=n,o}return Object(f.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[I._GetTargetProperty(this._target)]},e)},t}(I),j=function(i){function t(e,n){return e===void 0&&(e=g.a.ACTION_NothingTrigger),i.call(this,e,n)||this}return Object(f.d)(t,i),t.prototype.execute=function(){},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},t}(I),Y=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.children=n,o}return Object(f.d)(t,i),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var n=0;n<this.children.length;n++)this.children[n].execute(e)},t.prototype.serialize=function(e){for(var n=i.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},e),r=0;r<this.children.length;r++)n.combine.push(this.children[r].serialize(null));return n},t}(I),W=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.func=n,o}return Object(f.d)(t,i),t.prototype.execute=function(e){this.func(e)},t}(I),ie=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l._target=n,l._parent=r,l}return Object(f.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=h.e.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetParentAction",properties:[I._GetTargetProperty(this._target),I._GetTargetProperty(this._parent)]},e)},t}(I);R.a.RegisteredTypes["BABYLON.SetParentAction"]=ie,R.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=W,R.a.RegisteredTypes["BABYLON.DoNothingAction"]=j,R.a.RegisteredTypes["BABYLON.StopAnimationAction"]=L,R.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=U,R.a.RegisteredTypes["BABYLON.IncrementValueAction"]=V,R.a.RegisteredTypes["BABYLON.SetValueAction"]=N,R.a.RegisteredTypes["BABYLON.SetStateAction"]=O,R.a.RegisteredTypes["BABYLON.SetParentAction"]=ie;var re=c(22),ye=c(41),ve=function(i){function t(e){var n=i.call(this)||this;return n._scene=e||re.a.LastCreatedScene,e.actionManagers.push(n),n}return Object(f.d)(t,i),t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),n=0;n<this.actions.length;n++){var r=this.actions[n];t.Triggers[r.trigger]--,t.Triggers[r.trigger]===0&&delete t.Triggers[r.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(e.indexOf(r.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(e==o.trigger||n==o.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e&&(!n||n(o.getTriggerParameter())))return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.registerAction=function(e){return e.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(_.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),t.Triggers[e.trigger]?t.Triggers[e.trigger]++:t.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)},t.prototype.unregisterAction=function(e){var n=this.actions.indexOf(e);return n!==-1&&(this.actions.splice(n,1),t.Triggers[e.trigger]-=1,t.Triggers[e.trigger]===0&&delete t.Triggers[e.trigger],e._actionManager=null,!0)},t.prototype.processTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e){if(n&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var l=o.getTriggerParameter();if(l&&l!==n.sourceEvent.keyCode){if(!l.toLowerCase)continue;var d=l.toLowerCase();if(d!==n.sourceEvent.key){var v=n.sourceEvent.charCode?n.sourceEvent.charCode:n.sourceEvent.keyCode;if(String.fromCharCode(v).toLowerCase()!==d)continue}}}o._executeCurrent(n)}}},t.prototype._getEffectiveTarget=function(e,n){for(var r=n.split("."),o=0;o<r.length-1;o++)e=e[r[o]];return e},t.prototype._getProperty=function(e){var n=e.split(".");return n[n.length-1]},t.prototype.serialize=function(e){for(var n={children:new Array,name:e,type:3,properties:new Array},r=0;r<this.actions.length;r++){var o={type:0,children:new Array,name:t.GetTriggerName(this.actions[r].trigger),properties:new Array},l=this.actions[r].triggerOptions;if(l&&typeof l!="number")if(l.parameter instanceof Node)o.properties.push(I._GetTargetProperty(l.parameter));else{var d={};ye.a.DeepCopy(l.parameter,d,["mesh"]),l.parameter&&l.parameter.mesh&&(d._meshId=l.parameter.mesh.id),o.properties.push({name:"parameter",targetType:null,value:d})}this.actions[r].serialize(o),n.children.push(o)}return n},t.Parse=function(e,n,r){var o=new t(r);n===null?r.actionManager=o:n.actionManager=o;for(var l=function(k,K,ae,le){if(le===null){var fe=parseFloat(K);return K==="true"||K==="false"?K==="true":isNaN(fe)?K:fe}for(var me=le.split("."),be=K.split(","),Ee=0;Ee<me.length;Ee++)ae=ae[me[Ee]];if(typeof ae=="boolean")return be[0]==="true";if(typeof ae=="string")return be[0];var xe=new Array;for(Ee=0;Ee<be.length;Ee++)xe.push(parseFloat(be[Ee]));return ae instanceof h.e?h.e.FromArray(xe):ae instanceof h.f?h.f.FromArray(xe):ae instanceof C.a?C.a.FromArray(xe):ae instanceof C.b?C.b.FromArray(xe):parseFloat(be[0])},d=function(k,K,ae,le,fe){if(fe===void 0&&(fe=null),!k.detached){var me=new Array,be=null,Ee=null,xe=k.combine&&k.combine.length>0;if(k.type===2?me.push(o):me.push(K),xe){for(var Ae=new Array,Ie=0;Ie<k.combine.length;Ie++)d(k.combine[Ie],t.NothingTrigger,ae,le,Ae);me.push(Ae)}else for(var Re=0;Re<k.properties.length;Re++){var Pe=k.properties[Re].value,Ce=k.properties[Re].name,Ue=k.properties[Re].targetType;Ce==="target"?Pe=be=Ue!==null&&Ue==="SceneProperties"?r:r.getNodeByName(Pe):Ce==="parent"?Pe=r.getNodeByName(Pe):Ce==="sound"?r.getSoundByName&&(Pe=r.getSoundByName(Pe)):Ce!=="propertyPath"?Pe=k.type===2&&Ce==="operator"?P[Pe]:l(0,Pe,be,Ce==="value"?Ee:null):Ee=Pe,me.push(Pe)}if(fe===null?me.push(ae):me.push(null),k.name==="InterpolateValueAction"){var Oe=me[me.length-2];me[me.length-1]=Oe,me[me.length-2]=ae}var Ve=function(ze,tt){var ut=R.a.GetClass("BABYLON."+ze);if(ut){var ft=Object.create(ut.prototype);return ft.constructor.apply(ft,tt),ft}}(k.name,me);if(Ve instanceof x&&ae!==null){var Le=new j(K,ae);le?le.then(Le):o.registerAction(Le),le=Le}for(fe===null?Ve instanceof x?(ae=Ve,Ve=le):(ae=null,le?le.then(Ve):o.registerAction(Ve)):fe.push(Ve),Re=0;Re<k.children.length;Re++)d(k.children[Re],K,ae,Ve,null)}},v=0;v<e.children.length;v++){var y,D=e.children[v];if(D.properties.length>0){var w=D.properties[0].value,F=D.properties[0].targetType===null?w:r.getMeshByName(w);F._meshId&&(F.mesh=r.getMeshByID(F._meshId)),y={trigger:t[D.name],parameter:F}}else y=t[D.name];for(var z=0;z<D.children.length;z++)D.detached||d(D.children[z],y,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=g.a.ACTION_NothingTrigger,t.OnPickTrigger=g.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=g.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=g.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=g.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=g.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=g.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=g.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=g.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=g.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=g.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=g.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=g.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=g.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=g.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=g.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(m.a),ue=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(f.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.play()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(I),oe=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(f.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.stop()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(I);R.a.RegisteredTypes["BABYLON.PlaySoundAction"]=oe,R.a.RegisteredTypes["BABYLON.StopSoundAction"]=oe;var Z,J=c(14),B=c(3);(function(i){i[i.STEP=1]="STEP"})(Z||(Z={}));var G=function(){function i(t,e,n){this.name=t,this.from=e,this.to=n}return i.prototype.clone=function(){return new i(this.name,this.from,this.to)},i}(),$=c(29),he=c(77),se=c(49),q=function(){},H=function(){function i(t,e,n,r,o,l){this.name=t,this.targetProperty=e,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this.enableBlending=l,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=r,this.loopMode=o===void 0?i.ANIMATIONLOOPMODE_CYCLE:o}return i._PrepareAnimation=function(t,e,n,r,o,l,d,v){var y=void 0;if(!isNaN(parseFloat(o))&&isFinite(o)?y=i.ANIMATIONTYPE_FLOAT:o instanceof h.b?y=i.ANIMATIONTYPE_QUATERNION:o instanceof h.e?y=i.ANIMATIONTYPE_VECTOR3:o instanceof h.d?y=i.ANIMATIONTYPE_VECTOR2:o instanceof C.a?y=i.ANIMATIONTYPE_COLOR3:o instanceof C.b?y=i.ANIMATIONTYPE_COLOR4:o instanceof he.a&&(y=i.ANIMATIONTYPE_SIZE),y==null)return null;var D=new i(t,e,n,y,d),w=[{frame:0,value:o},{frame:r,value:l}];return D.setKeys(w),v!==void 0&&D.setEasingFunction(v),D},i.CreateAnimation=function(t,e,n,r){var o=new i(t+"Animation",t,n,e,i.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(r),o},i.CreateAndStartAnimation=function(t,e,n,r,o,l,d,v,y,D){var w=i._PrepareAnimation(t,n,r,o,l,d,v,y);return w?e.getScene().beginDirectAnimation(e,[w],0,o,w.loopMode===1,1,D):null},i.CreateAndStartHierarchyAnimation=function(t,e,n,r,o,l,d,v,y,D,w){var F=i._PrepareAnimation(t,r,o,l,d,v,y,D);return F?e.getScene().beginDirectHierarchyAnimation(e,n,[F],0,l,F.loopMode===1,1,w):null},i.CreateMergeAndStartAnimation=function(t,e,n,r,o,l,d,v,y,D){var w=i._PrepareAnimation(t,n,r,o,l,d,v,y);return w?(e.animations.push(w),e.getScene().beginAnimation(e,0,o,w.loopMode===1,1,D)):null},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var l=t;if(r&&((l=t.clone()).name=o||l.name),!l._keys.length)return l;e=e>=0?e:0;var d=0,v=l._keys[0],y=l._keys.length-1,D=l._keys[y],w={referenceValue:v.value,referencePosition:h.c.Vector3[0],referenceQuaternion:h.c.Quaternion[0],referenceScaling:h.c.Vector3[1],keyPosition:h.c.Vector3[2],keyQuaternion:h.c.Quaternion[1],keyScaling:h.c.Vector3[3]},F=!1,z=v.frame,k=D.frame;if(n){var K=l.getRange(n);K&&(z=K.from,k=K.to)}var ae=v.frame===z,le=D.frame===k;if(l._keys.length===1){var fe=l._getKeyValue(l._keys[0]);w.referenceValue=fe.clone?fe.clone():fe,F=!0}else e<=v.frame?(fe=l._getKeyValue(v.value),w.referenceValue=fe.clone?fe.clone():fe,F=!0):e>=D.frame&&(fe=l._getKeyValue(D.value),w.referenceValue=fe.clone?fe.clone():fe,F=!0);for(var me=0;!F||!ae||!le&&me<l._keys.length-1;){var be=l._keys[me],Ee=l._keys[me+1];if(!F&&e>=be.frame&&e<=Ee.frame){if(fe=void 0,e===be.frame)fe=l._getKeyValue(be.value);else if(e===Ee.frame)fe=l._getKeyValue(Ee.value);else{var xe={key:me,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};fe=l._interpolate(e,xe)}w.referenceValue=fe.clone?fe.clone():fe,F=!0}if(!ae&&z>=be.frame&&z<=Ee.frame){if(z===be.frame)d=me;else if(z===Ee.frame)d=me+1;else{xe={key:me,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var Ae={frame:z,value:(fe=l._interpolate(z,xe)).clone?fe.clone():fe};l._keys.splice(me+1,0,Ae),d=me+1}ae=!0}!le&&k>=be.frame&&k<=Ee.frame&&(k===be.frame?y=me:k===Ee.frame?y=me+1:(xe={key:me,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},Ae={frame:k,value:(fe=l._interpolate(k,xe)).clone?fe.clone():fe},l._keys.splice(me+1,0,Ae),y=me+1),le=!0),me++}for(l.dataType===i.ANIMATIONTYPE_QUATERNION?w.referenceValue.normalize().conjugateInPlace():l.dataType===i.ANIMATIONTYPE_MATRIX&&(w.referenceValue.decompose(w.referenceScaling,w.referenceQuaternion,w.referencePosition),w.referenceQuaternion.normalize().conjugateInPlace()),me=d;me<=y;me++)if(Ae=l._keys[me],!me||l.dataType===i.ANIMATIONTYPE_FLOAT||Ae.value!==v.value)switch(l.dataType){case i.ANIMATIONTYPE_MATRIX:Ae.value.decompose(w.keyScaling,w.keyQuaternion,w.keyPosition),w.keyPosition.subtractInPlace(w.referencePosition),w.keyScaling.divideInPlace(w.referenceScaling),w.referenceQuaternion.multiplyToRef(w.keyQuaternion,w.keyQuaternion),h.a.ComposeToRef(w.keyScaling,w.keyQuaternion,w.keyPosition,Ae.value);break;case i.ANIMATIONTYPE_QUATERNION:w.referenceValue.multiplyToRef(Ae.value,Ae.value);break;case i.ANIMATIONTYPE_VECTOR2:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:Ae.value.subtractToRef(w.referenceValue,Ae.value);break;case i.ANIMATIONTYPE_SIZE:Ae.value.width-=w.referenceValue.width,Ae.value.height-=w.referenceValue.height;break;default:Ae.value-=w.referenceValue}return l},i.TransitionTo=function(t,e,n,r,o,l,d,v){if(v===void 0&&(v=null),d<=0)return n[t]=e,v&&v(),null;var y=o*(d/1e3);l.setKeys([{frame:0,value:n[t].clone?n[t].clone():n[t]},{frame:y,value:e}]),n.animations||(n.animations=[]),n.animations.push(l);var D=r.beginAnimation(n,0,y,!1);return D.onAnimationEnd=v,D},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var t=0,e=this._runtimeAnimations;t<e.length;t++)if(!e[t].isStopped)return!0;return!1},enumerable:!1,configurable:!0}),i.prototype.toString=function(t){var e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.addEvent=function(t){this._events.push(t),this._events.sort(function(e,n){return e.frame-n.frame})},i.prototype.removeEvents=function(t){for(var e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(t,e,n){this._ranges[t]||(this._ranges[t]=new G(t,e,n))},i.prototype.deleteRange=function(t,e){e===void 0&&(e=!0);var n=this._ranges[t];if(n){if(e)for(var r=n.from,o=n.to,l=this._keys.length-1;l>=0;l--)this._keys[l].frame>=r&&this._keys[l].frame<=o&&this._keys.splice(l,1);this._ranges[t]=null}},i.prototype.getRange=function(t){return this._ranges[t]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var t=0,e=0,n=this._keys.length;e<n;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(t){this._easingFunction=t},i.prototype.floatInterpolateFunction=function(t,e,n){return J.a.Lerp(t,e,n)},i.prototype.floatInterpolateFunctionWithTangents=function(t,e,n,r,o){return J.a.Hermite(t,e,n,r,o)},i.prototype.quaternionInterpolateFunction=function(t,e,n){return h.b.Slerp(t,e,n)},i.prototype.quaternionInterpolateFunctionWithTangents=function(t,e,n,r,o){return h.b.Hermite(t,e,n,r,o).normalize()},i.prototype.vector3InterpolateFunction=function(t,e,n){return h.e.Lerp(t,e,n)},i.prototype.vector3InterpolateFunctionWithTangents=function(t,e,n,r,o){return h.e.Hermite(t,e,n,r,o)},i.prototype.vector2InterpolateFunction=function(t,e,n){return h.d.Lerp(t,e,n)},i.prototype.vector2InterpolateFunctionWithTangents=function(t,e,n,r,o){return h.d.Hermite(t,e,n,r,o)},i.prototype.sizeInterpolateFunction=function(t,e,n){return he.a.Lerp(t,e,n)},i.prototype.color3InterpolateFunction=function(t,e,n){return C.a.Lerp(t,e,n)},i.prototype.color4InterpolateFunction=function(t,e,n){return C.b.Lerp(t,e,n)},i.prototype._getKeyValue=function(t){return typeof t=="function"?t():t},i.prototype._interpolate=function(t,e){if(e.loopMode===i.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;var n=this._keys;if(n.length===1)return this._getKeyValue(n[0].value);var r=e.key;if(n[r].frame>=t)for(;r-1>=0&&n[r].frame>=t;)r--;for(var o=r;o<n.length;o++){var l=n[o+1];if(l.frame>=t){e.key=o;var d=n[o],v=this._getKeyValue(d.value);if(d.interpolation===Z.STEP)return v;var y=this._getKeyValue(l.value),D=d.outTangent!==void 0&&l.inTangent!==void 0,w=l.frame-d.frame,F=(t-d.frame)/w,z=this.getEasingFunction();switch(z!=null&&(F=z.ease(F)),this.dataType){case i.ANIMATIONTYPE_FLOAT:var k=D?this.floatInterpolateFunctionWithTangents(v,d.outTangent*w,y,l.inTangent*w,F):this.floatInterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return k;case i.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+k}break;case i.ANIMATIONTYPE_QUATERNION:var K=D?this.quaternionInterpolateFunctionWithTangents(v,d.outTangent.scale(w),y,l.inTangent.scale(w),F):this.quaternionInterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return K;case i.ANIMATIONLOOPMODE_RELATIVE:return K.addInPlace(e.offsetValue.scale(e.repeatCount))}return K;case i.ANIMATIONTYPE_VECTOR3:var ae=D?this.vector3InterpolateFunctionWithTangents(v,d.outTangent.scale(w),y,l.inTangent.scale(w),F):this.vector3InterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return ae;case i.ANIMATIONLOOPMODE_RELATIVE:return ae.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_VECTOR2:var le=D?this.vector2InterpolateFunctionWithTangents(v,d.outTangent.scale(w),y,l.inTangent.scale(w),F):this.vector2InterpolateFunction(v,y,F);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return le;case i.ANIMATIONLOOPMODE_RELATIVE:return le.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_SIZE:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR3:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR4:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(v,y,F);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(v,y,F).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:if(i.AllowMatricesInterpolation)return this.matrixInterpolateFunction(v,y,F,e.workValue);case i.ANIMATIONLOOPMODE_RELATIVE:return v}}break}}return this._getKeyValue(n[n.length-1].value)},i.prototype.matrixInterpolateFunction=function(t,e,n,r){return i.AllowMatrixDecomposeForInterpolation?r?(h.a.DecomposeLerpToRef(t,e,n,r),r):h.a.DecomposeLerp(t,e,n):r?(h.a.LerpToRef(t,e,n,r),r):h.a.Lerp(t,e,n)},i.prototype.clone=function(){var t=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var e in t._ranges={},this._ranges){var n=this._ranges[e];n&&(t._ranges[e]=n.clone())}return t},i.prototype.setKeys=function(t){this._keys=t.slice(0)},i.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var e=this.dataType;t.keys=[];for(var n=this.getKeys(),r=0;r<n.length;r++){var o=n[r],l={};switch(l.frame=o.frame,e){case i.ANIMATIONTYPE_FLOAT:l.values=[o.value],o.inTangent!==void 0&&l.values.push(o.inTangent),o.outTangent!==void 0&&(o.inTangent===void 0&&l.values.push(void 0),l.values.push(o.outTangent));break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:l.values=o.value.asArray(),o.inTangent!=null&&l.values.push(o.inTangent.asArray()),o.outTangent!=null&&(o.inTangent===void 0&&l.values.push(void 0),l.values.push(o.outTangent.asArray()))}t.keys.push(l)}for(var d in t.ranges=[],this._ranges){var v=this._ranges[d];if(v){var y={};y.name=d,y.from=v.from,y.to=v.to,t.ranges.push(y)}}return t},i._UniversalLerp=function(t,e,n){var r=t.constructor;return r.Lerp?r.Lerp(t,e,n):r.Slerp?r.Slerp(t,e,n):t.toFixed?t*(1-n)+n*e:e},i.Parse=function(t){var e,n,r=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),o=t.dataType,l=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),n=0;n<t.keys.length;n++){var d,v,y=t.keys[n];switch(o){case i.ANIMATIONTYPE_FLOAT:e=y.values[0],y.values.length>=1&&(d=y.values[1]),y.values.length>=2&&(v=y.values[2]);break;case i.ANIMATIONTYPE_QUATERNION:if(e=h.b.FromArray(y.values),y.values.length>=8){var D=h.b.FromArray(y.values.slice(4,8));D.equals(h.b.Zero())||(d=D)}if(y.values.length>=12){var w=h.b.FromArray(y.values.slice(8,12));w.equals(h.b.Zero())||(v=w)}break;case i.ANIMATIONTYPE_MATRIX:e=h.a.FromArray(y.values);break;case i.ANIMATIONTYPE_COLOR3:e=C.a.FromArray(y.values);break;case i.ANIMATIONTYPE_COLOR4:e=C.b.FromArray(y.values);break;case i.ANIMATIONTYPE_VECTOR3:default:e=h.e.FromArray(y.values)}var F={};F.frame=y.frame,F.value=e,d!=null&&(F.inTangent=d),v!=null&&(F.outTangent=v),l.push(F)}if(r.setKeys(l),t.ranges)for(n=0;n<t.ranges.length;n++)e=t.ranges[n],r.createRange(e.name,e.from,e.to);return r},i.AppendSerializedAnimations=function(t,e){B.a.AppendSerializedAnimations(t,e)},i.ParseFromFileAsync=function(t,e){var n=this;return new Promise(function(r,o){var l=new se.a;l.addEventListener("readystatechange",function(){if(l.readyState==4)if(l.status==200){var d=JSON.parse(l.responseText);if(d.length){for(var v=new Array,y=0,D=d;y<D.length;y++){var w=D[y];v.push(n.Parse(w))}r(v)}else v=n.Parse(d),t&&(v.name=t),r(v)}else o("Unable to load the animation")}),l.open("GET",e),l.send()})},i.CreateFromSnippetAsync=function(t){var e=this;return new Promise(function(n,r){var o=new se.a;o.addEventListener("readystatechange",function(){if(o.readyState==4)if(o.status==200){var l=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(l.animations){for(var d=JSON.parse(l.animations),v=new Array,y=0,D=d;y<D.length;y++){var w=D[y];v.push(e.Parse(w))}n(v)}else d=JSON.parse(l.animation),(v=e.Parse(d)).snippetId=t,n(v)}else r("Unable to load the snippet "+t)}),o.open("GET",e.SnippetUrl+"/"+t.replace(/#/g,"/")),o.send()})},i.AllowMatricesInterpolation=!1,i.AllowMatrixDecomposeForInterpolation=!0,i.SnippetUrl="https://snippet.babylonjs.com",i.ANIMATIONTYPE_FLOAT=0,i.ANIMATIONTYPE_VECTOR3=1,i.ANIMATIONTYPE_QUATERNION=2,i.ANIMATIONTYPE_MATRIX=3,i.ANIMATIONTYPE_COLOR3=4,i.ANIMATIONTYPE_COLOR4=7,i.ANIMATIONTYPE_VECTOR2=5,i.ANIMATIONTYPE_SIZE=6,i.ANIMATIONLOOPMODE_RELATIVE=0,i.ANIMATIONLOOPMODE_CYCLE=1,i.ANIMATIONLOOPMODE_CONSTANT=2,i}();R.a.RegisteredTypes["BABYLON.Animation"]=H,$.a._AnimationRangeFactory=function(i,t,e){return new G(i,t,e)};var X=function(i){function t(e,n,r,o,l,d,v,y){l===void 0&&(l=1e3);var D=i.call(this,e,d)||this;return D.duration=1e3,D.onInterpolationDoneObservable=new S.c,D.propertyPath=r,D.value=o,D.duration=l,D.stopOtherAnimations=v,D.onInterpolationDone=y,D._target=D._effectiveTarget=n,D}return Object(f.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var e,n=this,r=this._actionManager.getScene(),o=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if(typeof this.value=="number")e=H.ANIMATIONTYPE_FLOAT;else if(this.value instanceof C.a)e=H.ANIMATIONTYPE_COLOR3;else if(this.value instanceof h.e)e=H.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof h.a)e=H.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof h.b))return void _.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");e=H.ANIMATIONTYPE_QUATERNION}var l=new H("InterpolateValueAction",this._property,1e3/this.duration*100,e,H.ANIMATIONLOOPMODE_CONSTANT);l.setKeys(o),this.stopOtherAnimations&&r.stopAnimation(this._effectiveTarget),r.beginDirectAnimation(this._effectiveTarget,[l],0,100,!1,1,function(){n.onInterpolationDoneObservable.notifyObservers(n),n.onInterpolationDone&&n.onInterpolationDone()})},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[I._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:I._SerializeValueAsString(this.value)},{name:"duration",value:I._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:I._SerializeValueAsString(this.stopOtherAnimations)||!1}]},e)},t}(I);R.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=X;var ee=Object.freeze(new h.b(0,0,0,0)),Q=Object.freeze(h.e.Zero()),te=Object.freeze(h.d.Zero()),ge=Object.freeze(he.a.Zero()),ce=Object.freeze(C.a.Black()),de=function(){function i(t,e,n,r){var o=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=e,this._target=t,this._scene=n,this._host=r,this._activeTargets=[],e._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===H.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=h.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var l={frame:0,value:this._minValue};this._keys.splice(0,0,l)}if(this._target instanceof Array){for(var d=0,v=0,y=this._target;v<y.length;v++){var D=y[v];this._preparePath(D,d),this._getOriginalValues(d),d++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var w=e.getEvents();w&&w.length>0&&w.forEach(function(F){o._events.push(F._clone())}),this._enableBlending=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),i.prototype._preparePath=function(t,e){e===void 0&&(e=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var r=t[n[0]],o=1;o<n.length-1;o++)r=r[n[o]];this._targetPath=n[n.length-1],this._activeTargets[e]=r}else this._targetPath=n[0],this._activeTargets[e]=t},Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),i.prototype.reset=function(t){if(t===void 0&&(t=!1),t)if(this._target instanceof Array)for(var e=0,n=0,r=this._target;n<r.length;n++){var o=r[n];this._originalValue[e]!==void 0&&this._setValue(o,this._activeTargets[e],this._originalValue[e],-1,e),e++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,e=0;e<this._events.length;e++)this._events[e].isDone=!1},i.prototype.isStopped=function(){return this._stopped},i.prototype.dispose=function(){var t=this._animation.runtimeAnimations.indexOf(this);t>-1&&this._animation.runtimeAnimations.splice(t,1)},i.prototype.setValue=function(t,e){if(this._targetIsArray)for(var n=0;n<this._target.length;n++){var r=this._target[n];this._setValue(r,this._activeTargets[n],t,e,n)}else this._setValue(this._target,this._directTarget,t,e,0)},i.prototype._getOriginalValues=function(t){var e;t===void 0&&(t=0);var n=this._activeTargets[t];(e=n.getRestPose&&this._targetPath==="_matrix"?n.getRestPose():n[this._targetPath])&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e},i.prototype._setValue=function(t,e,n,r,o){if(this._currentActiveTarget=e,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var l=e[this._targetPath];l.clone?this._originalBlendValue=l.clone():this._originalBlendValue=l}this._originalBlendValue.m?H.AllowMatrixDecomposeForInterpolation?this._currentValue?h.a.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=h.a.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?h.a.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=h.a.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=H._UniversalLerp(this._originalBlendValue,n,this._blendingFactor);var d=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=d}else this._currentValue=n;r!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[o]):e[this._targetPath]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)},i.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},i.prototype.goToFrame=function(t){var e=this._animation.getKeys();t<e[0].frame?t=e[0].frame:t>e[e.length-1].frame&&(t=e[e.length-1].frame);var n=this._events;if(n.length)for(var r=0;r<n.length;r++)n[r].onlyOnce||(n[r].isDone=n[r].frame<t);this._currentFrame=t;var o=this._animation._interpolate(t,this._animationState);this.setValue(o,-1)},i.prototype._prepareForSpeedRatioChange=function(t){var e=this._previousDelay*(this._animation.framePerSecond*t)/1e3;this._ratioOffset=this._previousRatio-e},i.prototype.animate=function(t,e,n,r,o,l){l===void 0&&(l=-1);var d=this._animation,v=d.targetPropertyPath;if(!v||v.length<1)return this._stopped=!0,!1;var y=!0;(e<this._minFrame||e>this._maxFrame)&&(e=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var D,w,F=n-e,z=t*(d.framePerSecond*o)/1e3+this._ratioOffset,k=0;if(this._previousDelay=t,this._previousRatio=z,!r&&n>=e&&z>=F)y=!1,k=d._getKeyValue(this._maxValue);else if(!r&&e>=n&&z<=F)y=!1,k=d._getKeyValue(this._minValue);else if(this._animationState.loopMode!==H.ANIMATIONLOOPMODE_CYCLE){var K=n.toString()+e.toString();if(!this._offsetsCache[K]){this._animationState.repeatCount=0,this._animationState.loopMode=H.ANIMATIONLOOPMODE_CYCLE;var ae=d._interpolate(e,this._animationState),le=d._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),d.dataType){case H.ANIMATIONTYPE_FLOAT:this._offsetsCache[K]=le-ae;break;case H.ANIMATIONTYPE_QUATERNION:this._offsetsCache[K]=le.subtract(ae);break;case H.ANIMATIONTYPE_VECTOR3:this._offsetsCache[K]=le.subtract(ae);case H.ANIMATIONTYPE_VECTOR2:this._offsetsCache[K]=le.subtract(ae);case H.ANIMATIONTYPE_SIZE:this._offsetsCache[K]=le.subtract(ae);case H.ANIMATIONTYPE_COLOR3:this._offsetsCache[K]=le.subtract(ae)}this._highLimitsCache[K]=le}k=this._highLimitsCache[K],D=this._offsetsCache[K]}if(D===void 0)switch(d.dataType){case H.ANIMATIONTYPE_FLOAT:D=0;break;case H.ANIMATIONTYPE_QUATERNION:D=ee;break;case H.ANIMATIONTYPE_VECTOR3:D=Q;break;case H.ANIMATIONTYPE_VECTOR2:D=te;break;case H.ANIMATIONTYPE_SIZE:D=ge;break;case H.ANIMATIONTYPE_COLOR3:D=ce}if(this._host&&this._host.syncRoot){var fe=this._host.syncRoot;w=e+(n-e)*((fe.masterFrame-fe.fromFrame)/(fe.toFrame-fe.fromFrame))}else w=y&&F!==0?e+z%F:n;var me=this._events;if((F>0&&this.currentFrame>w||F<0&&this.currentFrame<w)&&(this._onLoop(),me.length))for(var be=0;be<me.length;be++)me[be].onlyOnce||(me[be].isDone=!1);this._currentFrame=w,this._animationState.repeatCount=F===0?0:z/F>>0,this._animationState.highLimitValue=k,this._animationState.offsetValue=D;var Ee=d._interpolate(w,this._animationState);if(this.setValue(Ee,l),me.length){for(be=0;be<me.length;be++)if(F>0&&w>=me[be].frame&&me[be].frame>=e||F<0&&w<=me[be].frame&&me[be].frame<=e){var xe=me[be];xe.isDone||(xe.onlyOnce&&(me.splice(be,1),be--),xe.isDone=!0,xe.action(w))}}return y||(this._stopped=!0),y},i}(),ne=c(20),pe=c(57),Se=c(44),Te=c(23),Ne=function(i){function t(e,n,r,o,l,d,v){r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),v===void 0&&(v=null);var y=i.call(this,e,n.getScene())||this;return y.name=e,y.children=new Array,y.animations=new Array,y._index=null,y._absoluteTransform=new h.a,y._invertedAbsoluteTransform=new h.a,y._scalingDeterminant=1,y._worldTransform=new h.a,y._needToDecompose=!0,y._needToCompose=!1,y._linkedTransformNode=null,y._waitingTransformNodeId=null,y._skeleton=n,y._localMatrix=o?o.clone():h.a.Identity(),y._restPose=l||y._localMatrix.clone(),y._bindPose=y._localMatrix.clone(),y._baseMatrix=d||y._localMatrix.clone(),y._index=v,n.bones.push(y),y.setParent(r,!1),(d||o)&&y._updateDifferenceMatrix(),y}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},t.prototype.setParent=function(e,n){if(n===void 0&&(n=!0),this._parent!==e){if(this._parent){var r=this._parent.children.indexOf(this);r!==-1&&this._parent.children.splice(r,1)}this._parent=e,this._parent&&this._parent.children.push(this),n&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.setRestPose=function(e){this._restPose.copyFrom(e)},t.prototype.getBindPose=function(){return this._bindPose},t.prototype.setBindPose=function(e){this._bindPose.copyFrom(e)},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},t.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=h.e.Zero(),this._localRotation=h.b.Zero(),this._localPosition=h.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,h.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},t.prototype.updateMatrix=function(e,n,r){n===void 0&&(n=!0),r===void 0&&(r=!0),this._baseMatrix.copyFrom(e),n&&this._updateDifferenceMatrix(),r?(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(e,n){if(n===void 0&&(n=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),n)for(var r=0;r<this.children.length;r++)this.children[r]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(e,n,r){n===void 0&&(n=Te.c.LOCAL);var o=this.getLocalMatrix();if(n==Te.c.LOCAL)o.addAtIndex(12,e.x),o.addAtIndex(13,e.y),o.addAtIndex(14,e.z);else{var l=null;r&&(l=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var d=t._tmpMats[0],v=t._tmpVecs[0];this._parent?r&&l?(d.copyFrom(this._parent.getAbsoluteTransform()),d.multiplyToRef(l,d)):d.copyFrom(this._parent.getAbsoluteTransform()):h.a.IdentityToRef(d),d.setTranslationFromFloats(0,0,0),d.invert(),h.e.TransformCoordinatesToRef(e,d,v),o.addAtIndex(12,v.x),o.addAtIndex(13,v.y),o.addAtIndex(14,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(e,n,r){n===void 0&&(n=Te.c.LOCAL);var o=this.getLocalMatrix();if(n==Te.c.LOCAL)o.setTranslationFromFloats(e.x,e.y,e.z);else{var l=null;r&&(l=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var d=t._tmpMats[0],v=t._tmpVecs[0];this._parent?(r&&l?(d.copyFrom(this._parent.getAbsoluteTransform()),d.multiplyToRef(l,d)):d.copyFrom(this._parent.getAbsoluteTransform()),d.invert()):h.a.IdentityToRef(d),h.e.TransformCoordinatesToRef(e,d,v),o.setTranslationFromFloats(v.x,v.y,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(e,n){this.setPosition(e,Te.c.WORLD,n)},t.prototype.scale=function(e,n,r,o){o===void 0&&(o=!1);var l=this.getLocalMatrix(),d=t._tmpMats[0];h.a.ScalingToRef(e,n,r,d),d.multiplyToRef(l,l),d.invert();for(var v=0,y=this.children;v<y.length;v++){var D=(z=y[v]).getLocalMatrix();D.multiplyToRef(d,D),D.multiplyAtIndex(12,e),D.multiplyAtIndex(13,n),D.multiplyAtIndex(14,r),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(var w=0,F=this.children;w<F.length;w++){var z;(z=F[w]).scale(e,n,r,o)}},t.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(e,n,r,o,l){if(o===void 0&&(o=Te.c.LOCAL),o===Te.c.LOCAL){var d=t._tmpQuat;return h.b.RotationYawPitchRollToRef(e,n,r,d),void this.setRotationQuaternion(d,o,l)}var v=t._tmpMats[0];if(this._getNegativeRotationToRef(v,l)){var y=t._tmpMats[1];h.a.RotationYawPitchRollToRef(e,n,r,y),v.multiplyToRef(y,y),this._rotateWithMatrix(y,o,l)}},t.prototype.rotate=function(e,n,r,o){r===void 0&&(r=Te.c.LOCAL);var l=t._tmpMats[0];l.setTranslationFromFloats(0,0,0),h.a.RotationAxisToRef(e,n,l),this._rotateWithMatrix(l,r,o)},t.prototype.setAxisAngle=function(e,n,r,o){if(r===void 0&&(r=Te.c.LOCAL),r===Te.c.LOCAL){var l=t._tmpQuat;return h.b.RotationAxisToRef(e,n,l),void this.setRotationQuaternion(l,r,o)}var d=t._tmpMats[0];if(this._getNegativeRotationToRef(d,o)){var v=t._tmpMats[1];h.a.RotationAxisToRef(e,n,v),d.multiplyToRef(v,v),this._rotateWithMatrix(v,r,o)}},t.prototype.setRotation=function(e,n,r){n===void 0&&(n=Te.c.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,n,r)},t.prototype.setRotationQuaternion=function(e,n,r){if(n===void 0&&(n=Te.c.LOCAL),n===Te.c.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var o=t._tmpMats[0];if(this._getNegativeRotationToRef(o,r)){var l=t._tmpMats[1];h.a.FromQuaternionToRef(e,l),o.multiplyToRef(l,l),this._rotateWithMatrix(l,n,r)}},t.prototype.setRotationMatrix=function(e,n,r){if(n===void 0&&(n=Te.c.LOCAL),n===Te.c.LOCAL){var o=t._tmpQuat;return h.b.FromRotationMatrixToRef(e,o),void this.setRotationQuaternion(o,n,r)}var l=t._tmpMats[0];if(this._getNegativeRotationToRef(l,r)){var d=t._tmpMats[1];d.copyFrom(e),l.multiplyToRef(e,d),this._rotateWithMatrix(d,n,r)}},t.prototype._rotateWithMatrix=function(e,n,r){n===void 0&&(n=Te.c.LOCAL);var o=this.getLocalMatrix(),l=o.m[12],d=o.m[13],v=o.m[14],y=this.getParent(),D=t._tmpMats[3],w=t._tmpMats[4];y&&n==Te.c.WORLD?(r?(D.copyFrom(r.getWorldMatrix()),y.getAbsoluteTransform().multiplyToRef(D,D)):D.copyFrom(y.getAbsoluteTransform()),w.copyFrom(D),w.invert(),o.multiplyToRef(D,o),o.multiplyToRef(e,o),o.multiplyToRef(w,o)):n==Te.c.WORLD&&r?(D.copyFrom(r.getWorldMatrix()),w.copyFrom(D),w.invert(),o.multiplyToRef(D,o),o.multiplyToRef(e,o),o.multiplyToRef(w,o)):o.multiplyToRef(e,o),o.setTranslationFromFloats(l,d,v),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(e,n){var r=t._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),n&&(e.multiplyToRef(n.getWorldMatrix(),e),h.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,r)),e.invert(),!isNaN(e.m[0])&&(r.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(r,e),!0)},t.prototype.getPosition=function(e,n){e===void 0&&(e=Te.c.LOCAL),n===void 0&&(n=null);var r=h.e.Zero();return this.getPositionToRef(e,n,r),r},t.prototype.getPositionToRef=function(e,n,r){if(e===void 0&&(e=Te.c.LOCAL),e==Te.c.LOCAL){var o=this.getLocalMatrix();r.x=o.m[12],r.y=o.m[13],r.z=o.m[14]}else{var l=null;n&&(l=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var d=t._tmpMats[0];n&&l?(d.copyFrom(this.getAbsoluteTransform()),d.multiplyToRef(l,d)):d=this.getAbsoluteTransform(),r.x=d.m[12],r.y=d.m[13],r.z=d.m[14]}},t.prototype.getAbsolutePosition=function(e){e===void 0&&(e=null);var n=h.e.Zero();return this.getPositionToRef(Te.c.WORLD,e,n),n},t.prototype.getAbsolutePositionToRef=function(e,n){this.getPositionToRef(Te.c.WORLD,e,n)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var n=this.children,r=n.length,o=0;o<r;o++)n[o].computeAbsoluteTransforms()},t.prototype.getDirection=function(e,n){n===void 0&&(n=null);var r=h.e.Zero();return this.getDirectionToRef(e,n,r),r},t.prototype.getDirectionToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];l.copyFrom(this.getAbsoluteTransform()),n&&o&&l.multiplyToRef(o,l),h.e.TransformNormalToRef(e,l,r),r.normalize()},t.prototype.getRotation=function(e,n){e===void 0&&(e=Te.c.LOCAL),n===void 0&&(n=null);var r=h.e.Zero();return this.getRotationToRef(e,n,r),r},t.prototype.getRotationToRef=function(e,n,r){e===void 0&&(e=Te.c.LOCAL),n===void 0&&(n=null);var o=t._tmpQuat;this.getRotationQuaternionToRef(e,n,o),o.toEulerAnglesToRef(r)},t.prototype.getRotationQuaternion=function(e,n){e===void 0&&(e=Te.c.LOCAL),n===void 0&&(n=null);var r=h.b.Identity();return this.getRotationQuaternionToRef(e,n,r),r},t.prototype.getRotationQuaternionToRef=function(e,n,r){if(e===void 0&&(e=Te.c.LOCAL),n===void 0&&(n=null),e==Te.c.LOCAL)this._decompose(),r.copyFrom(this._localRotation);else{var o=t._tmpMats[0],l=this.getAbsoluteTransform();n?l.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(l),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,r,void 0)}},t.prototype.getRotationMatrix=function(e,n){e===void 0&&(e=Te.c.LOCAL);var r=h.a.Identity();return this.getRotationMatrixToRef(e,n,r),r},t.prototype.getRotationMatrixToRef=function(e,n,r){if(e===void 0&&(e=Te.c.LOCAL),e==Te.c.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(r);else{var o=t._tmpMats[0],l=this.getAbsoluteTransform();n?l.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(l),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(r)}},t.prototype.getAbsolutePositionFromLocal=function(e,n){n===void 0&&(n=null);var r=h.e.Zero();return this.getAbsolutePositionFromLocalToRef(e,n,r),r},t.prototype.getAbsolutePositionFromLocalToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];n&&o?(l.copyFrom(this.getAbsoluteTransform()),l.multiplyToRef(o,l)):l=this.getAbsoluteTransform(),h.e.TransformCoordinatesToRef(e,l,r)},t.prototype.getLocalPositionFromAbsolute=function(e,n){n===void 0&&(n=null);var r=h.e.Zero();return this.getLocalPositionFromAbsoluteToRef(e,n,r),r},t.prototype.getLocalPositionFromAbsoluteToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];l.copyFrom(this.getAbsoluteTransform()),n&&o&&l.multiplyToRef(o,l),l.invert(),h.e.TransformCoordinatesToRef(e,l,r)},t.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},t._tmpVecs=Se.a.BuildArray(2,h.e.Zero),t._tmpQuat=h.b.Identity(),t._tmpMats=Se.a.BuildArray(5,h.a.Identity),t}($.a),je=function(){function i(t,e,n,r,o,l,d,v,y,D){n===void 0&&(n=0),r===void 0&&(r=100),o===void 0&&(o=!1),l===void 0&&(l=1),D===void 0&&(D=!1),this.target=e,this.fromFrame=n,this.toFrame=r,this.loopAnimation=o,this.onAnimationEnd=d,this.onAnimationLoop=y,this.isAdditive=D,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new S.c,this.onAnimationLoopObservable=new S.c,this._scene=t,v&&this.appendAnimations(e,v),this._speedRatio=l,t._activeAnimatables.push(this)}return Object.defineProperty(i.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=t!==-1?Math.min(Math.max(t,0),1):-1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){for(var e=0;e<this._runtimeAnimations.length;e++)this._runtimeAnimations[e]._prepareForSpeedRatioChange(t);this._speedRatio=t},enumerable:!1,configurable:!0}),i.prototype.syncWith=function(t){if(this._syncRoot=t,t){var e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this},i.prototype.getAnimations=function(){return this._runtimeAnimations},i.prototype.appendAnimations=function(t,e){for(var n=this,r=0;r<e.length;r++){var o=e[r],l=new de(t,o,this._scene,this);l._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(l)}},i.prototype.getAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n].animation;return null},i.prototype.getRuntimeAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n];return null},i.prototype.reset=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},i.prototype.enableBlending=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)e[n].animation.enableBlending=!0,e[n].animation.blendingSpeed=t},i.prototype.disableBlending=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].animation.enableBlending=!1},i.prototype.goToFrame=function(t){var e=this._runtimeAnimations;if(e[0]){var n=e[0].animation.framePerSecond,r=e[0].currentFrame,o=this.speedRatio===0?0:(t-r)/n*1e3/this.speedRatio;this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=o}for(var l=0;l<e.length;l++)e[l].goToFrame(t)},i.prototype.pause=function(){this._paused||(this._paused=!0)},i.prototype.restart=function(){this._paused=!1},i.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},i.prototype.stop=function(t,e){if(t||e){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var r=(l=this._runtimeAnimations).length-1;r>=0;r--){var o=l[r];t&&o.animation.name!=t||e&&!e(o.target)||(o.dispose(),l.splice(r,1))}l.length==0&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else if((r=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(r,1);var l=this._runtimeAnimations;for(r=0;r<l.length;r++)l[r].dispose();this._raiseOnAnimationEnd()}},i.prototype.waitAsync=function(){var t=this;return new Promise(function(e,n){t.onAnimationEndObservable.add(function(){e(t)},void 0,void 0,t,!0)})},i.prototype._animate=function(t){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=t),!0;if(this._localDelayOffset===null?(this._localDelayOffset=t,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var e,n=!1,r=this._runtimeAnimations;for(e=0;e<r.length;e++){var o=r[e].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||o}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<r.length;e++)r[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},i}();ne.a.prototype._animate=function(){if(this.animationsEnabled){var i=pe.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=i}this.deltaTime=this.useConstantAnimationDeltaTime?16:(i-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=i;var t=this._activeAnimatables;if(t.length!==0){this._animationTime+=this.deltaTime;for(var e=this._animationTime,n=0;n<t.length;n++){var r=t[n];!r._animate(e)&&r.disposeOnEnd&&n--}this._processLateAnimationBindings()}}},ne.a.prototype.beginWeightedAnimation=function(i,t,e,n,r,o,l,d,v,y,D){n===void 0&&(n=1),o===void 0&&(o=1),D===void 0&&(D=!1);var w=this.beginAnimation(i,t,e,r,o,l,d,!1,v,y,D);return w.weight=n,w},ne.a.prototype.beginAnimation=function(i,t,e,n,r,o,l,d,v,y,D){r===void 0&&(r=1),d===void 0&&(d=!0),D===void 0&&(D=!1),t>e&&r>0&&(r*=-1),d&&this.stopAnimation(i,void 0,v),l||(l=new je(this,i,t,e,n,r,o,void 0,y,D));var w=!v||v(i);if(i.animations&&w&&l.appendAnimations(i,i.animations),i.getAnimatables)for(var F=i.getAnimatables(),z=0;z<F.length;z++)this.beginAnimation(F[z],t,e,n,r,o,l,d,v,y);return l.reset(),l},ne.a.prototype.beginHierarchyAnimation=function(i,t,e,n,r,o,l,d,v,y,D,w){o===void 0&&(o=1),v===void 0&&(v=!0),w===void 0&&(w=!1);var F=i.getDescendants(t),z=[];z.push(this.beginAnimation(i,e,n,r,o,l,d,v,y,void 0,w));for(var k=0,K=F;k<K.length;k++){var ae=K[k];z.push(this.beginAnimation(ae,e,n,r,o,l,d,v,y,void 0,w))}return z},ne.a.prototype.beginDirectAnimation=function(i,t,e,n,r,o,l,d,v){return v===void 0&&(v=!1),o===void 0&&(o=1),e>n&&o>0&&(o*=-1),new je(this,i,e,n,r,o,l,t,d,v)},ne.a.prototype.beginDirectHierarchyAnimation=function(i,t,e,n,r,o,l,d,v,y){y===void 0&&(y=!1);var D=i.getDescendants(t),w=[];w.push(this.beginDirectAnimation(i,e,n,r,o,l,d,v,y));for(var F=0,z=D;F<z.length;F++){var k=z[F];w.push(this.beginDirectAnimation(k,e,n,r,o,l,d,v,y))}return w},ne.a.prototype.getAnimatableByTarget=function(i){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===i)return this._activeAnimatables[t];return null},ne.a.prototype.getAllAnimatablesByTarget=function(i){for(var t=[],e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].target===i&&t.push(this._activeAnimatables[e]);return t},ne.a.prototype.stopAnimation=function(i,t,e){for(var n=0,r=this.getAllAnimatablesByTarget(i);n<r.length;n++)r[n].stop(t,e)},ne.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].stop();this._activeAnimatables=[]}for(var t=0,e=this.animationGroups;t<e.length;t++)e[t].stop()},ne.a.prototype._registerTargetForLateAnimationBinding=function(i,t){var e=i.target;this._registeredForLateAnimationBindings.pushNoDuplicate(e),e._lateAnimationHolders||(e._lateAnimationHolders={}),e._lateAnimationHolders[i.targetPath]||(e._lateAnimationHolders[i.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),i.isAdditive?(e._lateAnimationHolders[i.targetPath].additiveAnimations.push(i),e._lateAnimationHolders[i.targetPath].totalAdditiveWeight+=i.weight):(e._lateAnimationHolders[i.targetPath].animations.push(i),e._lateAnimationHolders[i.targetPath].totalWeight+=i.weight)},ne.a.prototype._processLateAnimationBindingsForMatrices=function(i){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return i.originalValue;var t=1,e=h.c.Vector3[0],n=h.c.Vector3[1],r=h.c.Quaternion[0],o=0,l=i.animations[0],d=i.originalValue,v=1,y=!1;if(i.totalWeight<1)v=1-i.totalWeight,d.decompose(n,r,e);else{if(o=1,t=i.totalWeight,(v=l.weight/t)==1){if(!i.totalAdditiveWeight)return l.currentValue;y=!0}l.currentValue.decompose(n,r,e)}if(!y){n.scaleInPlace(v),e.scaleInPlace(v),r.scaleInPlace(v);for(var D=o;D<i.animations.length;D++)if((K=i.animations[D]).weight!==0){v=K.weight/t;var w=h.c.Vector3[2],F=h.c.Vector3[3],z=h.c.Quaternion[1];K.currentValue.decompose(F,z,w),F.scaleAndAddToRef(v,n),z.scaleAndAddToRef(v,r),w.scaleAndAddToRef(v,e)}}for(var k=0;k<i.additiveAnimations.length;k++){var K;(K=i.additiveAnimations[k]).weight!==0&&(w=h.c.Vector3[2],F=h.c.Vector3[3],z=h.c.Quaternion[1],K.currentValue.decompose(F,z,w),F.multiplyToRef(n,F),h.e.LerpToRef(n,F,K.weight,n),r.multiplyToRef(z,z),h.b.SlerpToRef(r,z,K.weight,r),w.scaleAndAddToRef(K.weight,e))}var ae=l?l._animationState.workValue:h.c.Matrix[0].clone();return h.a.ComposeToRef(n,r,e,ae),ae},ne.a.prototype._processLateAnimationBindingsForQuaternions=function(i,t){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return t;var e=i.animations[0],n=i.originalValue,r=t;if(i.totalWeight===0&&i.totalAdditiveWeight>0)r.copyFrom(n);else if(i.animations.length===1){if(h.b.SlerpToRef(n,e.currentValue,Math.min(1,i.totalWeight),r),i.totalAdditiveWeight===0)return r}else if(i.animations.length>1){var o=1,l=void 0,d=void 0;if(i.totalWeight<1){var v=1-i.totalWeight;d=[],(l=[]).push(n),d.push(v)}else{if(i.animations.length===2&&(h.b.SlerpToRef(i.animations[0].currentValue,i.animations[1].currentValue,i.animations[1].weight/i.totalWeight,t),i.totalAdditiveWeight===0))return t;l=[],d=[],o=i.totalWeight}for(var y=0;y<i.animations.length;y++){var D=i.animations[y];l.push(D.currentValue),d.push(D.weight/o)}for(var w=0,F=0;F<l.length;)F?(w+=d[F],h.b.SlerpToRef(r,l[F],d[F]/w,r),F++):(h.b.SlerpToRef(l[F],l[F+1],d[F+1]/(d[F]+d[F+1]),t),r=t,w=d[F]+d[F+1],F+=2)}for(var z=0;z<i.additiveAnimations.length;z++)(D=i.additiveAnimations[z]).weight!==0&&(r.multiplyToRef(D.currentValue,h.c.Quaternion[0]),h.b.SlerpToRef(r,h.c.Quaternion[0],D.weight,r));return r},ne.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var i=0;i<this._registeredForLateAnimationBindings.length;i++){var t=this._registeredForLateAnimationBindings.data[i];for(var e in t._lateAnimationHolders){var n=t._lateAnimationHolders[e],r=n.animations[0],o=n.originalValue,l=H.AllowMatrixDecomposeForInterpolation&&o.m,d=t[e];if(l)d=this._processLateAnimationBindingsForMatrices(n);else if(o.w!==void 0)d=this._processLateAnimationBindingsForQuaternions(n,d||h.b.Identity());else{var v=0,y=1;if(n.totalWeight<1)d=r&&o.scale?o.scale(1-n.totalWeight):r?o*(1-n.totalWeight):o.clone?o.clone():o;else if(r){y=n.totalWeight;var D=r.weight/y;d=D!==1?r.currentValue.scale?r.currentValue.scale(D):r.currentValue*D:r.currentValue,v=1}for(var w=v;w<n.animations.length;w++)(k=(z=n.animations[w]).weight/y)&&(z.currentValue.scaleAndAddToRef?z.currentValue.scaleAndAddToRef(k,d):d+=z.currentValue*k);for(var F=0;F<n.additiveAnimations.length;F++){var z,k;(k=(z=n.additiveAnimations[F]).weight)&&(z.currentValue.scaleAndAddToRef?z.currentValue.scaleAndAddToRef(k,d):d+=z.currentValue*k)}}t[e]=d}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Ne.prototype.copyAnimationRange=function(i,t,e,n,r){n===void 0&&(n=!1),r===void 0&&(r=null),this.animations.length===0&&(this.animations.push(new H(this.name,"_matrix",i.animations[0].framePerSecond,H.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=i.animations[0].getRange(t);if(!o)return!1;for(var l,d,v,y=o.from,D=o.to,w=i.animations[0].getKeys(),F=i.length,z=i.getParent(),k=this.getParent(),K=n&&z&&F&&this.length&&F!==this.length,ae=K&&k&&z?k.length/z.length:1,le=n&&!k&&r&&(r.x!==1||r.y!==1||r.z!==1),fe=this.animations[0].getKeys(),me=0,be=w.length;me<be;me++)(l=w[me]).frame>=y&&l.frame<=D&&(n?(v=l.value.clone(),K?(d=v.getTranslation(),v.setTranslation(d.scaleInPlace(ae))):le&&r?(d=v.getTranslation(),v.setTranslation(d.multiplyInPlace(r))):v=l.value):v=l.value,fe.push({frame:l.frame+e,value:v}));return this.animations[0].createRange(t,y+e,D+e),!0};var Xe=function(){function i(){}return i.prototype.getClassName=function(){return"TargetedAnimation"},i.prototype.serialize=function(){var t={};return t.animation=this.animation.serialize(),t.targetId=this.target.id,t},i}(),Ye=function(){function i(t,e){e===void 0&&(e=null),this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this.onAnimationEndObservable=new S.c,this.onAnimationLoopObservable=new S.c,this.onAnimationGroupLoopObservable=new S.c,this.onAnimationGroupEndObservable=new S.c,this.onAnimationGroupPauseObservable=new S.c,this.onAnimationGroupPlayObservable=new S.c,this._scene=e||re.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(i.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){if(this._speedRatio!==t){this._speedRatio=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].speedRatio=this._speedRatio}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(t){if(this._loopAnimation!==t){this._loopAnimation=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].loopAnimation=this._loopAnimation}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(t){if(this._isAdditive!==t){this._isAdditive=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].isAdditive=this._isAdditive}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),i.prototype.addTargetedAnimation=function(t,e){var n=new Xe;n.animation=t,n.target=e;var r=t.getKeys();return this._from>r[0].frame&&(this._from=r[0].frame),this._to<r[r.length-1].frame&&(this._to=r[r.length-1].frame),this._targetedAnimations.push(n),n},i.prototype.normalize=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null),t==null&&(t=this._from),e==null&&(e=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var r=this._targetedAnimations[n].animation.getKeys(),o=r[0],l=r[r.length-1];if(o.frame>t){var d={frame:t,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};r.splice(0,0,d)}l.frame<e&&(d={frame:e,value:l.value,inTangent:l.inTangent,outTangent:l.outTangent,interpolation:l.interpolation},r.push(d))}return this._from=t,this._to=e,this},i.prototype._processLoop=function(t,e,n){var r=this;t.onAnimationLoop=function(){r.onAnimationLoopObservable.notifyObservers(e),r._animationLoopFlags[n]||(r._animationLoopFlags[n]=!0,r._animationLoopCount++,r._animationLoopCount===r._targetedAnimations.length&&(r.onAnimationGroupLoopObservable.notifyObservers(r),r._animationLoopCount=0,r._animationLoopFlags=[]))}},i.prototype.start=function(t,e,n,r,o){var l=this;if(t===void 0&&(t=!1),e===void 0&&(e=1),this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=t,this._animationLoopCount=0,this._animationLoopFlags=[];for(var d=function(){var w=v._targetedAnimations[y],F=v._scene.beginDirectAnimation(w.target,[w.animation],n!==void 0?n:v._from,r!==void 0?r:v._to,t,e,void 0,void 0,o!==void 0?o:v._isAdditive);F.onAnimationEnd=function(){l.onAnimationEndObservable.notifyObservers(w),l._checkAnimationGroupEnded(F)},v._processLoop(F,w,y),v._animatables.push(F)},v=this,y=0;y<this._targetedAnimations.length;y++)d();if(this._speedRatio=e,n!==void 0&&r!==void 0)if(n<r&&this._speedRatio<0){var D=r;r=n,n=D}else n>r&&this._speedRatio>0&&(this._speedRatio=-e);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var t=0;t<this._animatables.length;t++)this._animatables[t].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},i.prototype.play=function(t){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(t!==void 0&&(this.loopAnimation=t),this.restart()):(this.stop(),this.start(t,this._speedRatio)),this._isPaused=!1,this},i.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].reset();return this},i.prototype.restart=function(){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.stop=function(){if(!this._isStarted)return this;for(var t=this._animatables.slice(),e=0;e<t.length;e++)t[e].stop();return this._isStarted=!1,this},i.prototype.setWeightForAllAnimatables=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].weight=t;return this},i.prototype.syncAllAnimationsWith=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].syncWith(t);return this},i.prototype.goToFrame=function(t){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].goToFrame(t);return this},i.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var t=this._scene.animationGroups.indexOf(this);t>-1&&this._scene.animationGroups.splice(t,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},i.prototype._checkAnimationGroupEnded=function(t){var e=this._animatables.indexOf(t);e>-1&&this._animatables.splice(e,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},i.prototype.clone=function(t,e){for(var n=new i(t||this.name,this._scene),r=0,o=this._targetedAnimations;r<o.length;r++){var l=o[r];n.addTargetedAnimation(l.animation.clone(),e?e(l.target):l.target)}return n},i.prototype.serialize=function(){var t={};t.name=this.name,t.from=this.from,t.to=this.to,t.targetedAnimations=[];for(var e=0;e<this.targetedAnimations.length;e++){var n=this.targetedAnimations[e];t.targetedAnimations[e]=n.serialize()}return t},i.Parse=function(t,e){for(var n=new i(t.name,e),r=0;r<t.targetedAnimations.length;r++){var o=t.targetedAnimations[r],l=H.Parse(o.animation),d=o.targetId;if(o.animation.property==="influence"){var v=e.getMorphTargetById(d);v&&n.addTargetedAnimation(l,v)}else{var y=e.getNodeByID(d);y!=null&&n.addTargetedAnimation(l,y)}}return t.from!==null&&t.to!==null&&n.normalize(t.from,t.to),n},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var l=t;r&&(l=t.clone(o||l.name));for(var d=l.targetedAnimations,v=0;v<d.length;v++){var y=d[v];H.MakeAnimationAdditive(y.animation,e,n)}return l.isAdditive=!0,l},i.prototype.getClassName=function(){return"AnimationGroup"},i.prototype.toString=function(t){var e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e},i}(),Ke=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=H.ANIMATIONLOOPMODE_CYCLE},nt=c(72),qe=function(){function i(){this._easingMode=i.EASINGMODE_EASEIN}return i.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},i.prototype.getEasingMode=function(){return this._easingMode},i.prototype.easeInCore=function(t){throw new Error("You must implement this method")},i.prototype.ease=function(t){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(t);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2,i}(),ct=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(qe),ot=function(i){function t(e){e===void 0&&(e=1);var n=i.call(this)||this;return n.amplitude=e,n}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.amplitude);return Math.pow(e,3)-e*n*Math.sin(3.141592653589793*e)},t}(qe),_t=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=2);var r=i.call(this)||this;return r.bounces=e,r.bounciness=n,r}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.bounces),r=this.bounciness;r<=1&&(r=1.001);var o=Math.pow(r,n),l=1-r,d=(1-o)/l+.5*o,v=e*d,y=Math.log(-v*(1-r)+1)/Math.log(r),D=Math.floor(y),w=D+1,F=(1-Math.pow(r,D))/(l*d),z=.5*(F+(1-Math.pow(r,w))/(l*d)),k=e-z,K=z-F;return-Math.pow(1/r,n-D)/(K*K)*(k-K)*(k+K)},t}(qe),gt=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e},t}(qe),At=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=3);var r=i.call(this)||this;return r.oscillations=e,r.springiness=n,r}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return(r==0?e:(Math.exp(r*e)-1)/(Math.exp(r)-1))*Math.sin((6.283185307179586*n+1.5707963267948966)*e)},t}(qe),wt=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.exponent=e,n}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(qe),Qt=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.power=e,n}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.power);return Math.pow(e,n)},t}(qe),Wt=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return e*e},t}(qe),Ft=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e},t}(qe),Ht=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(qe),fn=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(qe),un=function(i){function t(e,n,r,o){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=1),o===void 0&&(o=1);var l=i.call(this)||this;return l.x1=e,l.y1=n,l.x2=r,l.y2=o,l}return Object(f.d)(t,i),t.prototype.easeInCore=function(e){return nt.c.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t}(qe),wn=function(){function i(t,e,n){this.frame=t,this.action=e,this.onlyOnce=n,this.isDone=!1}return i.prototype._clone=function(){return new i(this.frame,this.action,this.onlyOnce)},i}(),Fe=c(7),gr=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t}(E.a),On=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},$n=function(i){function t(e){var n=i.call(this)||this;return n._wasAddedToScene=!1,n.scene=e,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],e.onDisposeObservable.add(function(){n._wasAddedToScene||n.dispose()}),n}return Object(f.d)(t,i),t.prototype.instantiateModelsToScene=function(e,n){var r=this;n===void 0&&(n=!1);var o={},l={},d=new On,v=[],y=[],D={doNotInstantiate:!0},w=function(F,z){if(o[F.uniqueId]=z.uniqueId,l[z.uniqueId]=z,e&&(z.name=e(F.name)),z instanceof Fe.a){var k=z;if(k.morphTargetManager){var K=F.morphTargetManager;k.morphTargetManager=K.clone();for(var ae=0;ae<K.numTargets;ae++){var le=K.getTarget(ae),fe=k.morphTargetManager.getTarget(ae);o[le.uniqueId]=fe.uniqueId,l[fe.uniqueId]=fe}}}};return this.transformNodes.forEach(function(F){if(!F.parent){var z=F.instantiateHierarchy(null,D,function(k,K){w(k,K)});z&&d.rootNodes.push(z)}}),this.meshes.forEach(function(F){if(!F.parent){var z=F.instantiateHierarchy(null,D,function(k,K){if(w(k,K),K.material){var ae=K;if(ae.material)if(n){var le=k.material;if(y.indexOf(le)===-1){var fe=le.clone(e?e(le.name):"Clone of "+le.name);if(y.push(le),o[le.uniqueId]=fe.uniqueId,l[fe.uniqueId]=fe,le.getClassName()==="MultiMaterial"){for(var me=le,be=0,Ee=me.subMaterials;be<Ee.length;be++){var xe=Ee[be];xe&&(fe=xe.clone(e?e(xe.name):"Clone of "+xe.name),y.push(xe),o[xe.uniqueId]=fe.uniqueId,l[fe.uniqueId]=fe)}me.subMaterials=me.subMaterials.map(function(Ae){return Ae&&l[o[Ae.uniqueId]]})}}ae.material=l[o[le.uniqueId]]}else ae.material.getClassName()==="MultiMaterial"?r.scene.multiMaterials.indexOf(ae.material)===-1&&r.scene.addMultiMaterial(ae.material):r.scene.materials.indexOf(ae.material)===-1&&r.scene.addMaterial(ae.material)}});z&&d.rootNodes.push(z)}}),this.skeletons.forEach(function(F){var z=F.clone(e?e(F.name):"Clone of "+F.name);F.overrideMesh&&(z.overrideMesh=l[o[F.overrideMesh.uniqueId]]);for(var k=0,K=r.meshes;k<K.length;k++){var ae=K[k];if(ae.skeleton===F&&!ae.isAnInstance){if(l[o[ae.uniqueId]].skeleton=z,v.indexOf(z)!==-1)continue;v.push(z);for(var le=0,fe=z.bones;le<fe.length;le++){var me=fe[le];me._linkedTransformNode&&(me._linkedTransformNode=l[o[me._linkedTransformNode.uniqueId]])}}}d.skeletons.push(z)}),this.animationGroups.forEach(function(F){var z=F.clone(F.name,function(k){return l[o[k.uniqueId]]||k});d.animationGroups.push(z)}),d},t.prototype.addAllToScene=function(){var e=this;this._wasAddedToScene=!0,this.cameras.forEach(function(o){e.scene.addCamera(o)}),this.lights.forEach(function(o){e.scene.addLight(o)}),this.meshes.forEach(function(o){e.scene.addMesh(o)}),this.skeletons.forEach(function(o){e.scene.addSkeleton(o)}),this.animations.forEach(function(o){e.scene.addAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.addAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.addMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.addMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.addMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.addGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.addTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.addActionManager(o)}),this.textures.forEach(function(o){e.scene.addTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.addReflectionProbe(o)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var e=this;this._wasAddedToScene=!1,this.cameras.forEach(function(o){e.scene.removeCamera(o)}),this.lights.forEach(function(o){e.scene.removeLight(o)}),this.meshes.forEach(function(o){e.scene.removeMesh(o)}),this.skeletons.forEach(function(o){e.scene.removeSkeleton(o)}),this.animations.forEach(function(o){e.scene.removeAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.removeAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.removeMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.removeMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.removeMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.removeGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.removeTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.removeActionManager(o)}),this.textures.forEach(function(o){e.scene.removeTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.removeReflectionProbe(o)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach(function(r){r.dispose()}),this.cameras=[],this.lights.forEach(function(r){r.dispose()}),this.lights=[],this.meshes.forEach(function(r){r.dispose()}),this.meshes=[],this.skeletons.forEach(function(r){r.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(r){r.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(r){r.dispose()}),this.multiMaterials=[],this.materials.forEach(function(r){r.dispose()}),this.materials=[],this.geometries.forEach(function(r){r.dispose()}),this.geometries=[],this.transformNodes.forEach(function(r){r.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(r){r.dispose()}),this.actionManagers=[],this.textures.forEach(function(r){r.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(r){r.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,n=this.scene._serializableComponents;e<n.length;e++)n[e].removeFromContainer(this,!0)},t.prototype._moveAssets=function(e,n,r){if(e)for(var o=0,l=e;o<l.length;o++){var d=l[o],v=!0;if(r){for(var y=0,D=r;y<D.length;y++)if(d===D[y]){v=!1;break}}v&&n.push(d)}},t.prototype.moveAllFromScene=function(e){for(var n in this._wasAddedToScene=!1,e===void 0&&(e=new gr),this)this.hasOwnProperty(n)&&(this[n]=this[n]||(n==="environmentTexture"?null:[]),this._moveAssets(this.scene[n],this[n],e[n]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new Fe.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(n){n.parent||e.addChild(n)}),this.meshes.unshift(e),e},t.prototype.mergeAnimationsTo=function(e,n,r){if(e===void 0&&(e=re.a.LastCreatedScene),r===void 0&&(r=null),!e)return _.a.Error("No scene available to merge animations to"),[];var o=r||function(d){var v=null,y=d.animations.length?d.animations[0].targetProperty:"",D=d.name.split(".").join("").split("_primitive")[0];switch(y){case"position":case"rotationQuaternion":v=e.getTransformNodeByName(d.name)||e.getTransformNodeByName(D);break;case"influence":v=e.getMorphTargetByName(d.name)||e.getMorphTargetByName(D);break;default:v=e.getNodeByName(d.name)||e.getNodeByName(D)}return v};this.getNodes().forEach(function(d){var v=o(d);if(v!==null){for(var y=function(F){for(var z=0,k=v.animations.filter(function(le){return le.targetProperty===F.targetProperty});z<k.length;z++){var K=k[z],ae=v.animations.indexOf(K,0);ae>-1&&v.animations.splice(ae,1)}},D=0,w=d.animations;D<w.length;D++)y(w[D]);v.animations=v.animations.concat(d.animations)}});var l=new Array;return this.animationGroups.slice().forEach(function(d){l.push(d.clone(d.name,o)),d.animatables.forEach(function(v){v.stop()})}),n.forEach(function(d){var v=o(d.target);v&&(e.beginAnimation(v,d.fromFrame,d.toFrame,d.loopAnimation,d.speedRatio,d.onAnimationEnd?d.onAnimationEnd:void 0,void 0,!0,void 0,d.onAnimationLoop?d.onAnimationLoop:void 0),e.stopAnimation(d.target))}),l},t}(E.a),He=c(13),jn=function(){function i(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=He.a.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return i.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},i.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},i.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},i.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},i.prototype.drawDebugCanvas=function(){var t=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){t.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var e=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var n=0;n<this.getFrequencyBinCount();n++){var r=e[n]/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*r,l=this.DEBUGCANVASSIZE.height-o-1,d=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),v=n/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+v+", 100%, 50%)",this._debugCanvasContext.fillRect(n*d,l,d,o)}}},i.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},i.prototype.connectAudioNodes=function(t,e){this._audioEngine.canUseWebAudio&&(t.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(e))},i.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},i}();He.a.AudioEngineFactory=function(i){return new Io(i)};var Io=function(){function i(t){var e=this;t===void 0&&(t=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new S.c,this.onAudioLockedObservable=new S.c,this._tryToRun=!1,this._onResize=function(){e._moveButtonToTopLeft()},window.AudioContext===void 0&&window.webkitAudioContext===void 0||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var n=document.createElement("audio");this._hostElement=t;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}return Object.defineProperty(i.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!1,configurable:!0}),i.prototype.lock=function(){this._triggerSuspendedState()},i.prototype.unlock=function(){this._triggerRunningState()},i.prototype._resumeAudioContext=function(){var t;return this._audioContext.resume!==void 0&&(t=this._audioContext.resume()),t||Promise.resolve()},i.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(t){this.canUseWebAudio=!1,_.a.Error("Web Audio: "+t.message)}},i.prototype._triggerRunningState=function(){var t=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){t._tryToRun=!1,t._muteButton&&t._hideMuteButton(),t.unlocked=!0,t.onAudioUnlockedObservable.notifyObservers(t)}).catch(function(){t._tryToRun=!1,t.unlocked=!1}))},i.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},i.prototype._displayMuteButton=function(){var t=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",n=document.createElement("style");n.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(n),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){t._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){t._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},i.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},i.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},i.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},i.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},i.prototype.setGlobalVolume=function(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},i}(),et=c(12),dr=c(21),Kr=function(){function i(t,e,n,r,o){var l,d,v,y,D=this;if(r===void 0&&(r=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new S.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=h.e.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new h.e(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=n,i._SceneComponentInitialization(n),this._readyToPlayCallback=r,this._customAttenuationFunction=function(ae,le,fe,me,be){return le<fe?ae*(1-le/fe):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,o.volume!==void 0&&(this._volume=o.volume),this.spatialSound=(l=o.spatialSound)!==null&&l!==void 0&&l,this.maxDistance=(d=o.maxDistance)!==null&&d!==void 0?d:100,this.useCustomAttenuation=(v=o.useCustomAttenuation)!==null&&v!==void 0&&v,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=(y=o.streaming)!==null&&y!==void 0&&y,this._length=o.length,this._offset=o.offset),He.a.audioEngine.canUseWebAudio&&He.a.audioEngine.audioContext){this._soundGain=He.a.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var w=!0;if(e)try{typeof e=="string"?this._urlType="String":e instanceof ArrayBuffer?this._urlType="ArrayBuffer":e instanceof MediaStream?this._urlType="MediaStream":Array.isArray(e)&&(this._urlType="Array");var F=[],z=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=He.a.audioEngine.audioContext.createMediaStreamSource(e),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":e.byteLength>0&&(z=!0,this._soundLoaded(e));break;case"String":F.push(e);case"Array":F.length===0&&(F=e);for(var k=0;k<F.length;k++){var K=F[k];if(z=o&&o.skipCodecCheck||K.indexOf(".mp3",K.length-4)!==-1&&He.a.audioEngine.isMP3supported||K.indexOf(".ogg",K.length-4)!==-1&&He.a.audioEngine.isOGGsupported||K.indexOf(".wav",K.length-4)!==-1||K.indexOf(".m4a",K.length-4)!==-1||K.indexOf("blob:")!==-1){this._streaming?(this._htmlAudioElement=new Audio(K),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,et.b.SetCorsBehavior(K,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){D._isReadyToPlay=!0,D.autoplay&&D.play(0,D._offset,D._length),D._readyToPlayCallback&&D._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(K,function(ae){D._soundLoaded(ae)},void 0,!0,!0,function(ae){ae&&_.a.Error("XHR "+ae.status+" error on: "+K+"."),_.a.Error("Sound creation aborted."),D._scene.mainSoundTrack.removeSound(D)});break}}break;default:w=!1}w?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){D._readyToPlayCallback&&D._readyToPlayCallback()},1e3)):_.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(ae){_.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),He.a.audioEngine.WarnedWebAudioUnsupported||(_.a.Error("Web Audio is not supported by your browser."),He.a.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){D._readyToPlayCallback&&D._readyToPlayCallback()},1e3)}return Object.defineProperty(i.prototype,"currentTime",{get:function(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var t=this._startOffset;return this.isPlaying&&He.a.audioEngine.audioContext&&(t+=He.a.audioEngine.audioContext.currentTime-this._startTime),t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){He.a.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,this.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},i.prototype.isReady=function(){return this._isReadyToPlay},i.prototype._soundLoaded=function(t){var e=this;He.a.audioEngine.audioContext&&He.a.audioEngine.audioContext.decodeAudioData(t,function(n){e._audioBuffer=n,e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length),e._readyToPlayCallback&&e._readyToPlayCallback()},function(n){_.a.Error("Error while decoding audio data for: "+e.name+" / Error: "+n)})},i.prototype.setAudioBuffer=function(t){He.a.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},i.prototype.updateOptions=function(t){var e,n,r,o,l,d,v,y,D;t&&(this.loop=(e=t.loop)!==null&&e!==void 0?e:this.loop,this.maxDistance=(n=t.maxDistance)!==null&&n!==void 0?n:this.maxDistance,this.useCustomAttenuation=(r=t.useCustomAttenuation)!==null&&r!==void 0?r:this.useCustomAttenuation,this.rolloffFactor=(o=t.rolloffFactor)!==null&&o!==void 0?o:this.rolloffFactor,this.refDistance=(l=t.refDistance)!==null&&l!==void 0?l:this.refDistance,this.distanceModel=(d=t.distanceModel)!==null&&d!==void 0?d:this.distanceModel,this._playbackRate=(v=t.playbackRate)!==null&&v!==void 0?v:this._playbackRate,this._length=(y=t.length)!==null&&y!==void 0?y:void 0,this._offset=(D=t.offset)!==null&&D!==void 0?D:void 0,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),this._offset!==void 0&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),this._length!==void 0&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},i.prototype._createSpatialParameters=function(){He.a.audioEngine.canUseWebAudio&&He.a.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=He.a.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},i.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},i.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},i.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},i.prototype._switchPanningModel=function(){He.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},i.prototype.connectToSoundTrackAudioNode=function(t){He.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)},i.prototype.setDirectionalCone=function(t,e,n){e<t?_.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=e,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!=this._coneInnerAngle){if(this._coneOuterAngle<t)return void _.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,He.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!=this._coneOuterAngle){if(t<this._coneInnerAngle)return void _.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,He.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t){this._position=t,He.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},i.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,He.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},i.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var t=this._connectedTransformNode.getWorldMatrix(),e=h.e.TransformNormal(this._localDirection,t);e.normalize(),this._soundPanner.setOrientation(e.x,e.y,e.z)}},i.prototype.updateDistanceFromListener=function(){if(He.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},i.prototype.setAttenuationFunction=function(t){this._customAttenuationFunction=t},i.prototype.play=function(t,e,n){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&He.a.audioEngine.audioContext)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var o=t?He.a.audioEngine.audioContext.currentTime+t:He.a.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=He.a.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){r._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(l=function(){if(He.a.audioEngine.unlocked){var d=r._htmlAudioElement.play();d!==void 0&&d.catch(function(v){He.a.audioEngine.lock(),(r.loop||r.autoplay)&&He.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})})}else(r.loop||r.autoplay)&&He.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})})();else{var l=function(){if(He.a.audioEngine.audioContext){if(n=n||r._length,e=e||r._offset,r._soundSource){var d=r._soundSource;d.onended=function(){d.disconnect()}}if(r._soundSource=He.a.audioEngine.audioContext.createBufferSource(),r._soundSource&&r._inputAudioNode){r._soundSource.buffer=r._audioBuffer,r._soundSource.connect(r._inputAudioNode),r._soundSource.loop=r.loop,e!==void 0&&(r._soundSource.loopStart=e),n!==void 0&&(r._soundSource.loopEnd=(0|e)+n),r._soundSource.playbackRate.value=r._playbackRate,r._soundSource.onended=function(){r._onended()},o=t?He.a.audioEngine.audioContext.currentTime+t:He.a.audioEngine.audioContext.currentTime;var v=r.isPaused?r._startOffset%r._soundSource.buffer.duration:e||0;r._soundSource.start(o,v,r.loop?void 0:n)}}};He.a.audioEngine.audioContext.state==="suspended"?setTimeout(function(){He.a.audioEngine.audioContext.state==="suspended"?(He.a.audioEngine.lock(),(r.loop||r.autoplay)&&He.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})):l()},500):l()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(d){_.a.Error("Error while trying to play audio: "+this.name+", "+d.message)}},i.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},i.prototype.stop=function(t){var e=this;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(He.a.audioEngine.audioContext&&this._soundSource){var n=t?He.a.audioEngine.audioContext.currentTime+t:He.a.audioEngine.audioContext.currentTime;this._soundSource.stop(n),this._soundSource.onended=function(){e.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},i.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():He.a.audioEngine.audioContext&&(this.stop(0),this._startOffset+=He.a.audioEngine.audioContext.currentTime-this._startTime))},i.prototype.setVolume=function(t,e){He.a.audioEngine.canUseWebAudio&&this._soundGain&&(e&&He.a.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(He.a.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,He.a.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,He.a.audioEngine.audioContext.currentTime+e)):this._soundGain.gain.value=t),this._volume=t},i.prototype.setPlaybackRate=function(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},i.prototype.getVolume=function(){return this._volume},i.prototype.attachToMesh=function(t){var e=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(n){return e._onRegisterAfterWorldMatrixUpdate(n)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},i.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},i.prototype._onRegisterAfterWorldMatrixUpdate=function(t){if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(h.c.Matrix[0]),this.setPosition(h.c.Matrix[0].getTranslation());else if(t.getBoundingInfo){var e=t.getBoundingInfo();this.setPosition(e.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);He.a.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},i.prototype.clone=function(){var t=this;if(this._streaming)return null;var e=function(){t._isReadyToPlay?(r._audioBuffer=t.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,t._offset,t._length)):window.setTimeout(e,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new i(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),e(),r},i.prototype.getAudioBuffer=function(){return this._audioBuffer},i.prototype.getSoundSource=function(){return this._soundSource},i.prototype.getSoundGain=function(){return this._soundGain},i.prototype.serialize=function(){var t={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this.spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.asArray(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.asArray(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t},i.Parse=function(t,e,n,r){var o,l=t.name;o=t.url?n+t.url:n+l;var d,v={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};if(r){var y=function(){r._isReadyToPlay?(d._audioBuffer=r.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,d._offset,d._length)):window.setTimeout(y,300)};d=new i(l,new ArrayBuffer(0),e,null,v),y()}else d=new i(l,o,e,function(){e._removePendingData(d)},v),e._addPendingData(d);if(t.position){var D=h.e.FromArray(t.position);d.setPosition(D)}if(t.isDirectional&&(d.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var w=h.e.FromArray(t.localDirectionToMesh);d.setLocalDirectionToMesh(w)}if(t.connectedMeshId){var F=e.getMeshByID(t.connectedMeshId);F&&d.attachToMesh(F)}return t.metadata&&(d.metadata=t.metadata),d},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("AudioSceneComponent")},i}(),ns=function(){function i(t,e){e===void 0&&(e={}),this.id=-1,this._isInitialized=!1,this._scene=t,this.soundCollection=new Array,this._options=e,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return i.prototype._initializeSoundTrackAudioGraph=function(){He.a.audioEngine.canUseWebAudio&&He.a.audioEngine.audioContext&&(this._outputAudioNode=He.a.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(He.a.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},i.prototype.dispose=function(){if(He.a.audioEngine&&He.a.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},i.prototype.addSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),He.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(t.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},i.prototype.removeSound=function(t){var e=this.soundCollection.indexOf(t);e!==-1&&this.soundCollection.splice(e,1)},i.prototype.setVolume=function(t){He.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)},i.prototype.switchPanningModelToHRTF=function(){if(He.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},i.prototype.switchPanningModelToEqualPower=function(){if(He.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,He.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,He.a.audioEngine.masterGain))},i}(),dt=c(17);E.a.AddParser(dt.a.NAME_AUDIO,function(i,t,e,n){var r,o=[];if(e.sounds=e.sounds||[],i.sounds!==void 0&&i.sounds!==null)for(var l=0,d=i.sounds.length;l<d;l++){var v=i.sounds[l];He.a.audioEngine.canUseWebAudio?(v.url||(v.url=v.name),o[v.url]?e.sounds.push(Kr.Parse(v,t,n,o[v.url])):(r=Kr.Parse(v,t,n),o[v.url]=r,e.sounds.push(r))):e.sounds.push(new Kr(v.name,null,t))}o=[]}),Object.defineProperty(ne.a.prototype,"mainSoundTrack",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new Qr(this),this._addComponent(i)),this._mainSoundTrack||(this._mainSoundTrack=new ns(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ne.a.prototype.getSoundByName=function(i){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===i)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks){for(var e=0;e<this.soundTracks.length;e++)for(t=0;t<this.soundTracks[e].soundCollection.length;t++)if(this.soundTracks[e].soundCollection[t].name===i)return this.soundTracks[e].soundCollection[t]}return null},Object.defineProperty(ne.a.prototype,"audioEnabled",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new Qr(this),this._addComponent(i)),i.audioEnabled},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new Qr(this),this._addComponent(t)),i?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"headphone",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new Qr(this),this._addComponent(i)),i.headphone},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new Qr(this),this._addComponent(t)),i?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"audioListenerPositionProvider",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new Qr(this),this._addComponent(i)),i.audioListenerPositionProvider},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);if(t||(t=new Qr(this),this._addComponent(t)),typeof i!="function")throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=i},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"audioPositioningRefreshRate",{get:function(){var i=this._getComponent(dt.a.NAME_AUDIO);return i||(i=new Qr(this),this._addComponent(i)),i.audioPositioningRefreshRate},set:function(i){var t=this._getComponent(dt.a.NAME_AUDIO);t||(t=new Qr(this),this._addComponent(t)),t.audioPositioningRefreshRate=i},enumerable:!0,configurable:!0});var Qr=function(){function i(t){this.name=dt.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new h.e,this._cachedCameraPosition=new h.e,this._lastCheck=0,this.scene=t,t.soundTracks=new Array,t.sounds=new Array}return Object.defineProperty(i.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"headphone",{get:function(){return this._headphone},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(t){this._audioListenerPositionProvider=t},enumerable:!1,configurable:!0}),i.prototype.register=function(){this.scene._afterRenderStage.registerStep(dt.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){if(t.sounds=[],this.scene.soundTracks)for(var e=0;e<this.scene.soundTracks.length;e++)for(var n=this.scene.soundTracks[e],r=0;r<n.soundCollection.length;r++)t.sounds.push(n.soundCollection[r].serialize())},i.prototype.addFromContainer=function(t){var e=this;t.sounds&&t.sounds.forEach(function(n){n.play(),n.autoplay=!0,e.scene.mainSoundTrack.addSound(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.sounds&&t.sounds.forEach(function(r){r.stop(),r.autoplay=!1,n.scene.mainSoundTrack.removeSound(r),e&&r.dispose()})},i.prototype.dispose=function(){var t=this.scene;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].dispose()},i.prototype.disableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!1,He.a.audioEngine&&He.a.audioEngine.audioContext&&He.a.audioEngine.audioContext.suspend(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].pause();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].pause()},i.prototype.enableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!0,He.a.audioEngine&&He.a.audioEngine.audioContext&&He.a.audioEngine.audioContext.resume(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].isPaused&&e.mainSoundTrack.soundCollection[t].play();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].isPaused&&e.soundTracks[t].soundCollection[n].play()},i.prototype.switchAudioModeForHeadphones=function(){var t=this.scene;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToHRTF()},i.prototype.switchAudioModeForNormalSpeakers=function(){var t=this.scene;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToEqualPower()},i.prototype._afterRender=function(){var t=pe.a.Now;if(!(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=t;var e=this.scene;if(this._audioEnabled&&e._mainSoundTrack&&e.soundTracks&&(e._mainSoundTrack.soundCollection.length!==0||e.soundTracks.length!==1)){var n=He.a.audioEngine;if(n&&n.audioContext){if(this._audioListenerPositionProvider){var r=this._audioListenerPositionProvider();r.x=r.x||0,r.y=r.y||0,r.z=r.z||0,n.audioContext.listener.setPosition(r.x,r.y,r.z)}else{var o;if(o=e.activeCameras&&e.activeCameras.length>0?e.activeCameras[0]:e.activeCamera){this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.copyFrom(o.globalPosition),n.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)),o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]);var l=h.a.Invert(o.getViewMatrix()),d=h.e.TransformNormal(e.useRightHandedSystem?i._CameraDirectionRH:i._CameraDirectionLH,l);d.normalize(),isNaN(d.x)||isNaN(d.y)||isNaN(d.z)||this._cachedCameraDirection.equals(d)||(this._cachedCameraDirection.copyFrom(d),n.audioContext.listener.setOrientation(d.x,d.y,d.z,0,1,0))}else n.audioContext.listener.setPosition(0,0,0)}var v;for(v=0;v<e.mainSoundTrack.soundCollection.length;v++){var y=e.mainSoundTrack.soundCollection[v];y.useCustomAttenuation&&y.updateDistanceFromListener()}if(e.soundTracks)for(v=0;v<e.soundTracks.length;v++)for(var D=0;D<e.soundTracks[v].soundCollection.length;D++)(y=e.soundTracks[v].soundCollection[D]).useCustomAttenuation&&y.updateDistanceFromListener()}}}},i._CameraDirectionLH=new h.e(0,0,-1),i._CameraDirectionRH=new h.e(0,0,1),i}();Kr._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_AUDIO);t||(t=new Qr(i),i._addComponent(t))};var hp=function(){function i(t,e,n){var r=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],e.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=n;for(var o=0,l=0,d=n;l<d.length;l++)o+=d[l];for(var v=o>0?1/o:0,y=0;y<this._weights.length;y++)this._weights[y]*=v;this._sounds=e;for(var D=0,w=this._sounds;D<w.length;D++)w[D].onEndedObservable.add(function(){r._onended()})}return Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void _.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeInnerAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void _.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeOuterAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t!==this._volume)for(var e=0,n=this._sounds;e<n.length;e++)n[e].setVolume(t)},enumerable:!1,configurable:!0}),i.prototype._onended=function(){this._currentIndex!==void 0&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},i.prototype.pause=function(){this.isPaused=!0,this._currentIndex!==void 0&&this._sounds[this._currentIndex].pause()},i.prototype.stop=function(){this.isPlaying=!1,this._currentIndex!==void 0&&this._sounds[this._currentIndex].stop()},i.prototype.play=function(t){if(!this.isPaused){this.stop();for(var e=Math.random(),n=0,r=0;r<this._weights.length;r++)if(e<=(n+=this._weights[r])){this._currentIndex=r;break}}var o=this._sounds[this._currentIndex];o.isReady()?o.play(0,this.isPaused?void 0:t):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},i}(),Ot=c(18),Uu=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==Ot.a.POINTERDOWN?r.type===Ot.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){var r=pe.a.Now,o=0;e._lastFrameTime!=null&&(o=r-e._lastFrameTime),e._lastFrameTime=r,e._applyUserInteraction();var l=r-e._lastInteractionTime-e._idleRotationWaitTime,d=Math.max(Math.min(l/e._idleRotationSpinupTime,1),0);e._cameraRotationSpeed=e._idleRotationSpeed*d,e._attachedCamera&&(e._attachedCamera.alpha-=e._cameraRotationSpeed*(o/1e3))})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype._userIsZooming=function(){return!!this._attachedCamera&&this._attachedCamera.inertialRadiusOffset!==0},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=pe.a.Now)},i.prototype._userIsMoving=function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},i}(),Vu=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(t){var e=this;if(this._autoTransitionRange!==t){this._autoTransitionRange=t;var n=this._attachedCamera;n&&(t?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add(function(r){if(r){r.computeWorldMatrix(!0);var o=r.getBoundingInfo().diagonalLength;e.lowerRadiusTransitionRange=.05*o,e.upperRadiusTransitionRange=.05*o}}):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._attachedCamera&&(e._isRadiusAtLimit(e._attachedCamera.lowerRadiusLimit)&&e._applyBoundRadiusAnimation(e.lowerRadiusTransitionRange),e._isRadiusAtLimit(e._attachedCamera.upperRadiusLimit)&&e._applyBoundRadiusAnimation(e.upperRadiusTransitionRange))})},i.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(t){return!!this._attachedCamera&&this._attachedCamera.radius===t&&!this._radiusIsAnimating},i.prototype._applyBoundRadiusAnimation=function(t){var e=this;if(this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=H.CreateAnimation("radius",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=H.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});n&&this._animatables.push(n)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new ot(.3),i.EasingMode=qe.EASINGMODE_EASEOUT,i}(),$i=function(){function i(){this._mode=i.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();i.EasingFunction.setEasingMode(i.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==Ot.a.POINTERDOWN?r.type===Ot.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(r){r&&e.zoomOnMesh(r)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._applyUserInteraction(),e._maintainCameraAboveGround()})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},i.prototype.zoomOnMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,e,n)},i.prototype.zoomOnMeshHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,e,n)},i.prototype.zoomOnMeshesHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null);for(var r=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new h.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=0;l<t.length;l++){var d=t[l].getHierarchyBoundingVectors(!0);h.e.CheckExtends(d.min,r,o),h.e.CheckExtends(d.max,r,o)}this.zoomOnBoundingInfo(r,o,e,n)},i.prototype.zoomOnBoundingInfo=function(t,e,n,r){var o,l=this;if(n===void 0&&(n=!1),r===void 0&&(r=null),this._attachedCamera){var d=t.y,v=d+(e.y-d)*this._positionScale,y=e.subtract(t).scale(.5);if(n)o=new h.e(0,v,0);else{var D=t.add(y);o=new h.e(D.x,v,D.z)}this._vectorTransition||(this._vectorTransition=H.CreateAnimation("target",H.ANIMATIONTYPE_VECTOR3,60,i.EasingFunction)),this._betaIsAnimating=!0;var w=H.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);w&&this._animatables.push(w);var F=0;if(this._mode===i.FitFrustumSidesMode){var z=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=y.length()+this._attachedCamera.minZ),F=z}else this._mode===i.IgnoreBoundsSizeMode&&(F=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var k=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/k,this._attachedCamera.wheelPrecision=100/F}this._radiusTransition||(this._radiusTransition=H.CreateAnimation("radius",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),(w=H.TransitionTo("radius",F,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){l.stopAllAnimations(),r&&r(),l._attachedCamera&&l._attachedCamera.useInputToRestoreState&&l._attachedCamera.storeState()}))&&this._animatables.push(w)}},i.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var n=e.subtract(t).length(),r=this._getFrustumSlope(),o=.5*n*this._radiusScale,l=o*Math.sqrt(1+1/(r.x*r.x)),d=o*Math.sqrt(1+1/(r.y*r.y)),v=Math.max(l,d),y=this._attachedCamera;return y?(y.lowerRadiusLimit&&this._mode===i.IgnoreBoundsSizeMode&&(v=v<y.lowerRadiusLimit?y.lowerRadiusLimit:v),y.upperRadiusLimit&&(v=v>y.upperRadiusLimit?y.upperRadiusLimit:v),v):0},i.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=pe.a.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=H.CreateAnimation("beta",H.ANIMATIONTYPE_FLOAT,60,i.EasingFunction));var o=H.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});o&&this._animatables.push(o)}}},i.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return h.d.Zero();var e=t.getScene().getEngine().getAspectRatio(t),n=Math.tan(t.fov/2),r=n*e;return new h.d(r,n)},i.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},i.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=pe.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(i.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},enumerable:!1,configurable:!0}),i.EasingFunction=new wt,i.EasingMode=qe.EASINGMODE_EASEINOUT,i.IgnoreBoundsSizeMode=0,i.FitFrustumSidesMode=1,i}(),Do=function(i,t,e,n){t===void 0&&(t=new h.e),e===void 0&&(e=0),n===void 0&&(n=!1),this.direction=i,this.rotatedDirection=t,this.diff=e,this.ignore=n},dp=function(){function i(t){this.ui=t,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new Do(h.e.Up()),new Do(h.e.Down()),new Do(h.e.Left()),new Do(h.e.Right()),new Do(h.e.Forward()),new Do(h.e.Forward().scaleInPlace(-1))],this._tmpMatrix=new h.a,this._tmpVector=new h.e,this._zeroVector=h.e.Zero(),this._lookAtTmpMatrix=new h.a}return i.prototype.init=function(){},i.prototype._closestFace=function(t){var e=this;return this._faceVectors.forEach(function(n){e._target.rotationQuaternion||(e._target.rotationQuaternion=h.b.RotationYawPitchRoll(e._target.rotation.y,e._target.rotation.x,e._target.rotation.z)),e._target.rotationQuaternion.toRotationMatrix(e._tmpMatrix),h.e.TransformCoordinatesToRef(n.direction,e._tmpMatrix,n.rotatedDirection),n.diff=h.e.GetAngleBetweenVectors(n.rotatedDirection,t,h.e.Cross(n.rotatedDirection,t))}),this._faceVectors.reduce(function(n,r){return n.ignore?r:r.ignore||n.diff<r.diff?n:r},this._faceVectors[0])},i.prototype._lookAtToRef=function(t,e,n){e===void 0&&(e=new h.e(0,1,0)),h.a.LookAtLHToRef(this._zeroVector,t,e,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),h.b.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},i.prototype.attach=function(t){var e=this;this._target=t,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(e._scene.activeCamera){var n=e._scene.activeCamera.position;e._scene.activeCamera.devicePosition&&(n=e._scene.activeCamera.devicePosition);var r=e._closestFace(n.subtract(t.position));e._scene.activeCamera.leftCamera?e._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix):e._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix),h.e.TransformCoordinatesToRef(h.e.Up(),e._tmpMatrix,e._tmpVector),e._faceVectors.forEach(function(l){r.direction.x&&l.direction.x&&(l.ignore=!0),r.direction.y&&l.direction.y&&(l.ignore=!0),r.direction.z&&l.direction.z&&(l.ignore=!0)});var o=e._closestFace(e._tmpVector);e._faceVectors.forEach(function(l){l.ignore=!1}),e.ui.position.copyFrom(t.position),r.direction.x&&(r.rotatedDirection.scaleToRef(t.scaling.x/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.y&&(r.rotatedDirection.scaleToRef(t.scaling.y/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.z&&(r.rotatedDirection.scaleToRef(t.scaling.z/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),e.ui.rotationQuaternion||(e.ui.rotationQuaternion=h.b.RotationYawPitchRoll(e.ui.rotation.y,e.ui.rotation.x,e.ui.rotation.z)),r.rotatedDirection.scaleToRef(-1,e._tmpVector),e._lookAtToRef(e._tmpVector,o.rotatedDirection,e.ui.rotationQuaternion),o.direction.x&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.x/2,e._tmpVector),o.direction.y&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.y/2,e._tmpVector),o.direction.z&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.z/2,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)}})},i.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},i}(),fp=function(){function i(){var t=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(t._ownerNode){if(t._hoverValue+=t._hovered?t._millisecondsPerFrame:-t._millisecondsPerFrame,t._setAllVisibility(t._ownerNode,(t._hoverValue-t.delay)/t.fadeInTime),t._ownerNode.visibility>1)return t._setAllVisibility(t._ownerNode,1),void(t._hoverValue=t.fadeInTime+t.delay);if(t._ownerNode.visibility<0&&(t._setAllVisibility(t._ownerNode,0),t._hoverValue<0))return void(t._hoverValue=0);setTimeout(t._update,t._millisecondsPerFrame)}}}return Object.defineProperty(i.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){this._ownerNode=t,this._setAllVisibility(this._ownerNode,0)},i.prototype.detach=function(){this._ownerNode=null},i.prototype.fadeIn=function(t){this._hovered=t,this._update()},i.prototype._setAllVisibility=function(t,e){var n=this;t.visibility=e,t.getChildMeshes().forEach(function(r){n._setAllVisibility(r,e)})},i}(),vi=c(65),pp=function(){function i(){this._startDistance=0,this._initialScale=new h.e(0,0,0),this._targetScale=new h.e(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new vi.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new vi.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._dragBehaviorA.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorA.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorB.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(n){n.onDragObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var r=e._getCurrentDistance()/e._startDistance;e._initialScale.scaleToRef(r,e._targetScale)}})}),t.addBehavior(this._dragBehaviorA),t.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var n=e._targetScale.subtract(t.scaling).scaleInPlace(.1);n.length()>.01&&t.scaling.addInPlace(n)}})},i.prototype.detach=function(){var t=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(e){e.onDragStartObservable.clear(),e.onDragObservable.clear(),t._ownerNode.removeBehavior(e)})},i}(),jt=c(31),Pt=c(24),Or=c(60),ku=function(){function i(){this._sceneRenderObserver=null,this._targetPosition=new h.e(0,0,0),this._moving=!1,this._startingOrientation=new h.b,this._attachedToElement=!1,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new S.c,this.onDragObservable=new S.c,this.onDragEndObservable=new S.c}return Object.defineProperty(i.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},Object.defineProperty(i.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._scene=this._ownerNode.getScene(),i._virtualScene||(i._virtualScene=new ne.a(this._scene.getEngine(),{virtual:!0}),i._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var n=null,r=new h.e(0,0,0);this._virtualOriginMesh=new jt.a("",i._virtualScene),this._virtualOriginMesh.rotationQuaternion=new h.b,this._virtualDragMesh=new jt.a("",i._virtualScene),this._virtualDragMesh.rotationQuaternion=new h.b,this._pointerObserver=this._scene.onPointerObservable.add(function(l,d){if(l.type==Ot.a.POINTERDOWN){if(!e.dragging&&l.pickInfo&&l.pickInfo.hit&&l.pickInfo.pickedMesh&&l.pickInfo.ray&&(F=l.pickInfo.pickedMesh,e._ownerNode==F||F.isDescendantOf(e._ownerNode))){e._pointerCamera&&e._pointerCamera.cameraRigMode==Pt.a.RIG_MODE_NONE&&l.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),n=e._ownerNode,Or.a._RemoveAndStorePivotPoint(n),r.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.position.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(l.pickInfo.ray.origin.add(l.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),n.computeWorldMatrix(),e._virtualDragMesh.position.copyFrom(n.absolutePosition),n.rotationQuaternion||(n.rotationQuaternion=h.b.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z));var v=n.parent;n.setParent(null),e._virtualDragMesh.rotationQuaternion.copyFrom(n.rotationQuaternion),n.setParent(v),e._virtualOriginMesh.addChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),e.dragging=!0,e.currentDraggingPointerID=l.event.pointerId,e.detachCameraControls&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.inputs.attachedToElement?(e._pointerCamera.detachControl(),e._attachedToElement=!0):e._attachedToElement=!1),Or.a._RestorePivotPoint(n),e.onDragStartObservable.notifyObservers({})}}else if(l.type==Ot.a.POINTERUP||l.type==Ot.a.POINTERDOUBLETAP)e.currentDraggingPointerID==l.event.pointerId&&(e.dragging=!1,e._moving=!1,e.currentDraggingPointerID=-1,n=null,e._virtualOriginMesh.removeChild(e._virtualDragMesh),e.detachCameraControls&&e._attachedToElement&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.attachControl(!0),e._attachedToElement=!1),e.onDragEndObservable.notifyObservers({}));else if(l.type==Ot.a.POINTERMOVE&&e.currentDraggingPointerID==l.event.pointerId&&e.dragging&&l.pickInfo&&l.pickInfo.ray&&n){var y=e.zDragFactor;e._pointerCamera&&e._pointerCamera.cameraRigMode==Pt.a.RIG_MODE_NONE&&(l.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),y=0);var D=l.pickInfo.ray.origin.subtract(r);r.copyFrom(l.pickInfo.ray.origin);var w=-h.e.Dot(D,l.pickInfo.ray.direction);e._virtualOriginMesh.addChild(e._virtualDragMesh),e._virtualDragMesh.position.z-=e._virtualDragMesh.position.z<1?w*e.zDragFactor:w*y*e._virtualDragMesh.position.z,e._virtualDragMesh.position.z<0&&(e._virtualDragMesh.position.z=0),e._virtualOriginMesh.position.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(l.pickInfo.ray.origin.add(l.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),n.parent&&h.e.TransformCoordinatesToRef(e._targetPosition,h.a.Invert(n.parent.getWorldMatrix()),e._targetPosition),e._moving||e._startingOrientation.copyFrom(e._virtualDragMesh.rotationQuaternion),e._moving=!0}var F});var o=new h.b;this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e.dragging&&e._moving&&n){if(Or.a._RemoveAndStorePivotPoint(n),n.position.addInPlace(e._targetPosition.subtract(n.position).scale(e.dragDeltaRatio)),e.rotateDraggedObject){o.copyFrom(e._startingOrientation),o.x=-o.x,o.y=-o.y,o.z=-o.z,e._virtualDragMesh.rotationQuaternion.multiplyToRef(o,o),h.b.RotationYawPitchRollToRef(o.toEulerAngles("xyz").y,0,0,o),o.multiplyToRef(e._startingOrientation,o);var l=n.parent;(!l||l.scaling&&!l.scaling.isNonUniformWithinEpsilon(.001))&&(n.setParent(null),h.b.SlerpToRef(n.rotationQuaternion,o,e.dragDeltaRatio,n.rotationQuaternion),n.setParent(l))}Or.a._RestorePivotPoint(n),e.onDragObservable.notifyObservers()}})},i.prototype.detach=function(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.attachControl(!0),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver)),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()},i}(),mp=function(){function i(t,e,n){if(this.targetPosition=h.e.Zero(),this.poleTargetPosition=h.e.Zero(),this.poleTargetLocalOffset=h.e.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=h.b.Identity(),this._bone1Mat=h.a.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=h.e.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=e,this._bone1=e.getParent(),this._bone1){this.mesh=t;var r=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,r.x>r.y&&r.x>r.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var o=this._bone1.getScale(),l=this._bone2.getScale();this._bone1Length=this._bone1.length*o.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*l.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var d=this._bone2.children[0].getAbsolutePosition(t),v=this._bone2.getAbsolutePosition(t),y=this._bone1.getAbsolutePosition(t);this._bone1Length=h.e.Distance(d,v),this._bone2Length=h.e.Distance(v,y)}this._bone1.getRotationMatrixToRef(Te.c.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,n&&(n.targetMesh&&(this.targetMesh=n.targetMesh,this.targetMesh.computeWorldMatrix(!0)),n.poleTargetMesh?(this.poleTargetMesh=n.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):n.poleTargetBone?this.poleTargetBone=n.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),n.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(n.poleTargetLocalOffset),n.poleAngle&&(this.poleAngle=n.poleAngle),n.bendAxis&&this._bendAxis.copyFrom(n.bendAxis),n.maxAngle&&(this.maxAngle=n.maxAngle),n.slerpAmount&&(this.slerpAmount=n.slerpAmount))}}return Object.defineProperty(i.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){this._setMaxAngle(t)},enumerable:!1,configurable:!0}),i.prototype._setMaxAngle=function(t){t<0&&(t=0),(t>Math.PI||t==null)&&(t=Math.PI),this._maxAngle=t;var e=this._bone1Length,n=this._bone2Length;this._maxReach=Math.sqrt(e*e+n*n-2*e*n*Math.cos(t))},i.prototype.update=function(){var t=this._bone1;if(t){var e=this.targetPosition,n=this.poleTargetPosition,r=i._tmpMats[0],o=i._tmpMats[1];this.targetMesh&&e.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,n):this.poleTargetMesh&&h.e.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),n);var l=i._tmpVecs[0],d=i._tmpVecs[1],v=i._tmpVecs[2],y=i._tmpVecs[3],D=i._tmpVecs[4],w=i._tmpQuat;t.getAbsolutePositionToRef(this.mesh,l),n.subtractToRef(l,D),D.x==0&&D.y==0&&D.z==0?D.y=1:D.normalize(),e.subtractToRef(l,y),y.normalize(),h.e.CrossToRef(y,D,d),d.normalize(),h.e.CrossToRef(y,d,v),v.normalize(),h.a.FromXYZAxesToRef(v,y,d,r);var F=this._bone1Length,z=this._bone2Length,k=h.e.Distance(l,e);this._maxReach>0&&(k=Math.min(this._maxReach,k));var K=(z*z+k*k-F*F)/(2*z*k),ae=(k*k+F*F-z*z)/(2*k*F);K>1&&(K=1),ae>1&&(ae=1),K<-1&&(K=-1),ae<-1&&(ae=-1);var le=Math.acos(K),fe=Math.acos(ae),me=-le-fe;if(this._rightHandedSystem)h.a.RotationYawPitchRollToRef(0,0,this._adjustRoll,o),o.multiplyToRef(r,r),h.a.RotationAxisToRef(this._bendAxis,fe,o),o.multiplyToRef(r,r);else{var be=i._tmpVecs[5];be.copyFrom(this._bendAxis),be.x*=-1,h.a.RotationAxisToRef(be,-fe,o),o.multiplyToRef(r,r)}this.poleAngle&&(h.a.RotationAxisToRef(y,this.poleAngle,o),r.multiplyToRef(o,r)),this._bone1&&(this.slerpAmount<1?(this._slerping||h.b.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),h.b.FromRotationMatrixToRef(r,w),h.b.SlerpToRef(this._bone1Quat,w,this.slerpAmount,this._bone1Quat),me=this._bone2Ang*(1-this.slerpAmount)+me*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,Te.c.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(r,Te.c.WORLD,this.mesh),this._bone1Mat.copyFrom(r),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,me,Te.c.LOCAL),this._bone2Ang=me}},i._tmpVecs=[h.e.Zero(),h.e.Zero(),h.e.Zero(),h.e.Zero(),h.e.Zero(),h.e.Zero()],i._tmpQuat=h.b.Identity(),i._tmpMats=[h.a.Identity(),h.a.Identity()],i}(),_p=function(){function i(t,e,n,r){if(this.upAxis=h.e.Up(),this.upAxisSpace=Te.c.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=h.b.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=h.e.Forward(),this.mesh=t,this.bone=e,this.target=n,r&&(r.adjustYaw&&(this.adjustYaw=r.adjustYaw),r.adjustPitch&&(this.adjustPitch=r.adjustPitch),r.adjustRoll&&(this.adjustRoll=r.adjustRoll),r.maxYaw!=null?this.maxYaw=r.maxYaw:this.maxYaw=Math.PI,r.minYaw!=null?this.minYaw=r.minYaw:this.minYaw=-Math.PI,r.maxPitch!=null?this.maxPitch=r.maxPitch:this.maxPitch=Math.PI,r.minPitch!=null?this.minPitch=r.minPitch:this.minPitch=-Math.PI,r.slerpAmount!=null&&(this.slerpAmount=r.slerpAmount),r.upAxis!=null&&(this.upAxis=r.upAxis),r.upAxisSpace!=null&&(this.upAxisSpace=r.upAxisSpace),r.yawAxis!=null||r.pitchAxis!=null)){var o=Te.a.Y,l=Te.a.X;r.yawAxis!=null&&(o=r.yawAxis.clone()).normalize(),r.pitchAxis!=null&&(l=r.pitchAxis.clone()).normalize();var d=h.e.Cross(l,o);this._transformYawPitch=h.a.Identity(),h.a.FromXYZAxesToRef(l,o,d,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=Te.c.BONE||(this.upAxisSpace=Te.c.LOCAL)}return Object.defineProperty(i.prototype,"minYaw",{get:function(){return this._minYaw},set:function(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),this._maxYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),this._minYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPitch",{get:function(){return this._minPitch},set:function(t){this._minPitch=t,this._minPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),i.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var t=this.bone,e=i._tmpVecs[0];t.getAbsolutePositionToRef(this.mesh,e);var n=this.target,r=i._tmpMats[0],o=i._tmpMats[1],l=this.mesh,d=t.getParent(),v=i._tmpVecs[1];v.copyFrom(this.upAxis),this.upAxisSpace==Te.c.BONE&&d?(this._transformYawPitch&&h.e.TransformCoordinatesToRef(v,this._transformYawPitchInv,v),d.getDirectionToRef(v,this.mesh,v)):this.upAxisSpace==Te.c.LOCAL&&(l.getDirectionToRef(v,v),l.scaling.x==1&&l.scaling.y==1&&l.scaling.z==1||v.normalize());var y=!1,D=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(y=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(D=!0),y||D){var w=i._tmpMats[2],F=i._tmpMats[3];if(this.upAxisSpace==Te.c.BONE&&v.y==1&&d)d.getRotationMatrixToRef(Te.c.WORLD,this.mesh,w);else if(this.upAxisSpace!=Te.c.LOCAL||v.y!=1||d){(k=i._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&h.e.TransformCoordinatesToRef(k,this._transformYawPitchInv,k),d?d.getDirectionToRef(k,this.mesh,k):l.getDirectionToRef(k,k);var z=h.e.Cross(v,k);z.normalize();var k=h.e.Cross(z,v);h.a.FromXYZAxesToRef(z,v,k,w)}else w.copyFrom(l.getWorldMatrix());w.invertToRef(F);var K=null;if(D){var ae=i._tmpVecs[3];n.subtractToRef(e,ae),h.e.TransformCoordinatesToRef(ae,F,ae),K=Math.sqrt(ae.x*ae.x+ae.z*ae.z);var le=Math.atan2(ae.y,K),fe=le;le>this._maxPitch?(ae.y=this._maxPitchTan*K,fe=this._maxPitch):le<this._minPitch&&(ae.y=this._minPitchTan*K,fe=this._minPitch),le!=fe&&(h.e.TransformCoordinatesToRef(ae,w,ae),ae.addInPlace(e),n=ae)}if(y){ae=i._tmpVecs[4],n.subtractToRef(e,ae),h.e.TransformCoordinatesToRef(ae,F,ae);var me=Math.atan2(ae.x,ae.z),be=me;if((me>this._maxYaw||me<this._minYaw)&&(K==null&&(K=Math.sqrt(ae.x*ae.x+ae.z*ae.z)),this._yawRange>Math.PI?this._isAngleBetween(me,this._maxYaw,this._midYawConstraint)?(ae.z=this._maxYawCos*K,ae.x=this._maxYawSin*K,be=this._maxYaw):this._isAngleBetween(me,this._midYawConstraint,this._minYaw)&&(ae.z=this._minYawCos*K,ae.x=this._minYawSin*K,be=this._minYaw):me>this._maxYaw?(ae.z=this._maxYawCos*K,ae.x=this._maxYawSin*K,be=this._maxYaw):me<this._minYaw&&(ae.z=this._minYawCos*K,ae.x=this._minYawSin*K,be=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var Ee=i._tmpVecs[8];Ee.copyFrom(Te.a.Z),this._transformYawPitch&&h.e.TransformCoordinatesToRef(Ee,this._transformYawPitchInv,Ee);var xe=i._tmpMats[4];this._boneQuat.toRotationMatrix(xe),this.mesh.getWorldMatrix().multiplyToRef(xe,xe),h.e.TransformCoordinatesToRef(Ee,xe,Ee),h.e.TransformCoordinatesToRef(Ee,F,Ee);var Ae=Math.atan2(Ee.x,Ee.z);if(this._getAngleBetween(Ae,me)>this._getAngleBetween(Ae,this._midYawConstraint)){K==null&&(K=Math.sqrt(ae.x*ae.x+ae.z*ae.z));var Ie=this._getAngleBetween(Ae,this._maxYaw);this._getAngleBetween(Ae,this._minYaw)<Ie?(be=Ae+.75*Math.PI,ae.z=Math.cos(be)*K,ae.x=Math.sin(be)*K):(be=Ae-.75*Math.PI,ae.z=Math.cos(be)*K,ae.x=Math.sin(be)*K)}}me!=be&&(h.e.TransformCoordinatesToRef(ae,w,ae),ae.addInPlace(e),n=ae)}}var Re=i._tmpVecs[5],Pe=i._tmpVecs[6],Ce=i._tmpVecs[7],Ue=i._tmpQuat;n.subtractToRef(e,Re),Re.normalize(),h.e.CrossToRef(v,Re,Pe),Pe.normalize(),h.e.CrossToRef(Re,Pe,Ce),Ce.normalize(),h.a.FromXYZAxesToRef(Pe,Ce,Re,r),Pe.x===0&&Pe.y===0&&Pe.z===0||Ce.x===0&&Ce.y===0&&Ce.z===0||Re.x===0&&Re.y===0&&Re.z===0||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(h.a.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,o),o.multiplyToRef(r,r)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(Te.c.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),h.b.FromRotationMatrixToRef(r,Ue),h.b.SlerpToRef(this._boneQuat,Ue,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,Te.c.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),this.bone.setRotationMatrix(r,Te.c.WORLD,this.mesh),this._slerping=!1))}},i.prototype._getAngleDiff=function(t,e){var n=e-t;return(n%=2*Math.PI)>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),n},i.prototype._getAngleBetween=function(t,e){var n=0;return(n=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},i.prototype._isAngleBetween=function(t,e,n){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(n=(n%=2*Math.PI)<0?n+2*Math.PI:n)){if(t>e&&t<n)return!0}else if(t>n&&t<e)return!0;return!1},i._tmpVecs=Se.a.BuildArray(10,h.e.Zero),i._tmpQuat=h.b.Identity(),i._tmpMats=Se.a.BuildArray(5,h.a.Identity),i}(),ke=c(10),Nt=c(27),en=c(26);function va(i,t,e,n){var r;r=n===g.a.TEXTURETYPE_FLOAT?new Float32Array(t*e*4):new Uint32Array(t*e*4);for(var o=0;o<t;o++)for(var l=0;l<e;l++){var d=3*(l*t+o),v=4*(l*t+o);r[v+0]=i[d+0],r[v+1]=i[d+1],r[v+2]=i[d+2],r[v+3]=1}return r}function rs(i){return function(t,e,n,r,o,l,d,v,y,D){y===void 0&&(y=null),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var w=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,F=i?Nt.b.Raw3D:Nt.b.Raw2DArray,z=new Nt.a(this,F);z.baseWidth=e,z.baseHeight=n,z.baseDepth=r,z.width=e,z.height=n,z.depth=r,z.format=o,z.type=D,z.generateMipMaps=l,z.samplingMode=v,i?z.is3D=!0:z.is2DArray=!0,this._doNotHandleContextLost||(z._bufferView=t),i?this.updateRawTexture3D(z,t,o,d,y,D):this.updateRawTexture2DArray(z,t,o,d,y,D),this._bindTextureDirectly(w,z,!0);var k=this._getSamplingParameters(v,l);return this._gl.texParameteri(w,this._gl.TEXTURE_MAG_FILTER,k.mag),this._gl.texParameteri(w,this._gl.TEXTURE_MIN_FILTER,k.min),l&&this._gl.generateMipmap(w),this._bindTextureDirectly(w,null),this._internalTexturesCache.push(z),z}}function ju(i){return function(t,e,n,r,o,l){o===void 0&&(o=null),l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT);var d=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,v=this._getWebGLTextureType(l),y=this._getInternalFormat(n),D=this._getRGBABufferInternalSizedFormat(l,n);this._bindTextureDirectly(d,t,!0),this._unpackFlipY(r===void 0||!!r),this._doNotHandleContextLost||(t._bufferView=e,t.format=n,t.invertY=r,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&e?this._gl.compressedTexImage3D(d,0,this.getCaps().s3tc[o],t.width,t.height,t.depth,0,e):this._gl.texImage3D(d,0,D,t.width,t.height,t.depth,0,y,v,e),t.generateMipMaps&&this._gl.generateMipmap(d),this._bindTextureDirectly(d,null),t.isReady=!0}}en.a.prototype.updateRawTexture=function(i,t,e,n,r,o){if(r===void 0&&(r=null),o===void 0&&(o=g.a.TEXTURETYPE_UNSIGNED_INT),i){var l=this._getRGBABufferInternalSizedFormat(o,e),d=this._getInternalFormat(e),v=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._unpackFlipY(n===void 0||!!n),this._doNotHandleContextLost||(i._bufferView=t,i.format=e,i.type=o,i.invertY=n,i._compression=r),i.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],i.width,i.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,i.width,i.height,0,d,v,t),i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}},en.a.prototype.createRawTexture=function(i,t,e,n,r,o,l,d,v){d===void 0&&(d=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=new Nt.a(this,Nt.b.Raw);y.baseWidth=t,y.baseHeight=e,y.width=t,y.height=e,y.format=n,y.generateMipMaps=r,y.samplingMode=l,y.invertY=o,y._compression=d,y.type=v,this._doNotHandleContextLost||(y._bufferView=i),this.updateRawTexture(y,i,n,o,d,v),this._bindTextureDirectly(this._gl.TEXTURE_2D,y,!0);var D=this._getSamplingParameters(l,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,D.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(y),y},en.a.prototype.createRawCubeTexture=function(i,t,e,n,r,o,l,d){d===void 0&&(d=null);var v=this._gl,y=new Nt.a(this,Nt.b.CubeRaw);y.isCube=!0,y.format=e,y.type=n,this._doNotHandleContextLost||(y._bufferViewArray=i);var D=this._getWebGLTextureType(n),w=this._getInternalFormat(e);w===v.RGB&&(w=v.RGBA),D!==v.FLOAT||this._caps.textureFloatLinearFiltering?D!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?D!==v.FLOAT||this._caps.textureFloatRender?D!==v.HALF_FLOAT||this._caps.colorBufferFloat||(r=!1,_.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(r=!1,_.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(r=!1,l=g.a.TEXTURE_NEAREST_SAMPLINGMODE,_.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(r=!1,l=g.a.TEXTURE_NEAREST_SAMPLINGMODE,_.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var F=t,z=F;y.width=F,y.height=z,!this.needPOTTextures||et.b.IsExponentOfTwo(y.width)&&et.b.IsExponentOfTwo(y.height)||(r=!1),i&&this.updateRawCubeTexture(y,i,e,n,o,d),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,y,!0),i&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var k=this._getSamplingParameters(l,r);return v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,k.mag),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,k.min),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null),y.generateMipMaps=r,y},en.a.prototype.updateRawCubeTexture=function(i,t,e,n,r,o,l){o===void 0&&(o=null),l===void 0&&(l=0),i._bufferViewArray=t,i.format=e,i.type=n,i.invertY=r,i._compression=o;var d=this._gl,v=this._getWebGLTextureType(n),y=this._getInternalFormat(e),D=this._getRGBABufferInternalSizedFormat(n),w=!1;y===d.RGB&&(y=d.RGBA,w=!0),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,i,!0),this._unpackFlipY(r===void 0||!!r),i.width%4!=0&&d.pixelStorei(d.UNPACK_ALIGNMENT,1);for(var F=0;F<6;F++){var z=t[F];o?d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+F,l,this.getCaps().s3tc[o],i.width,i.height,0,z):(w&&(z=va(z,i.width,i.height,n)),d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+F,l,D,i.width,i.height,0,y,v,z))}(!this.needPOTTextures||et.b.IsExponentOfTwo(i.width)&&et.b.IsExponentOfTwo(i.height))&&i.generateMipMaps&&l===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),i.isReady=!0},en.a.prototype.createRawCubeTextureFromUrl=function(i,t,e,n,r,o,l,d,v,y,D,w){var F=this;v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),w===void 0&&(w=!1);var z=this._gl,k=this.createRawCubeTexture(null,e,n,r,!o,w,D,null);return t==null||t._addPendingData(k),k.url=i,this._internalTexturesCache.push(k),this._loadFile(i,function(K){(function(ae){var le=k.width,fe=l(ae);if(fe){if(d){var me=F._getWebGLTextureType(r),be=F._getInternalFormat(n),Ee=F._getRGBABufferInternalSizedFormat(r),xe=!1;be===z.RGB&&(be=z.RGBA,xe=!0),F._bindTextureDirectly(z.TEXTURE_CUBE_MAP,k,!0),F._unpackFlipY(!1);for(var Ae=d(fe),Ie=0;Ie<Ae.length;Ie++)for(var Re=le>>Ie,Pe=0;Pe<6;Pe++){var Ce=Ae[Ie][Pe];xe&&(Ce=va(Ce,Re,Re,r)),z.texImage2D(Pe,Ie,Ee,Re,Re,0,be,me,Ce)}F._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)}else F.updateRawCubeTexture(k,fe,n,r,w);k.isReady=!0,t==null||t._removePendingData(k),v&&v()}})(K)},void 0,t==null?void 0:t.offlineProvider,!0,function(K,ae){t==null||t._removePendingData(k),y&&K&&y(K.status+" "+K.statusText,ae)}),k},en.a.prototype.createRawTexture2DArray=rs(!1),en.a.prototype.createRawTexture3D=rs(!0),en.a.prototype.updateRawTexture2DArray=ju(!1),en.a.prototype.updateRawTexture3D=ju(!0);var xr=function(i){function t(e,n,r,o,l,d,v,y,D){d===void 0&&(d=!0),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var w=i.call(this,null,l,!d,v)||this;return w.format=o,w._engine&&(w._texture=w._engine.createRawTexture(e,n,r,o,d,v,y,null,D),w.wrapU=ke.a.CLAMP_ADDRESSMODE,w.wrapV=ke.a.CLAMP_ADDRESSMODE),w}return Object(f.d)(t,i),t.prototype.update=function(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(e,n,r,o,l,d,v){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE,o,l,d,v)},t.CreateLuminanceAlphaTexture=function(e,n,r,o,l,d,v){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE_ALPHA,o,l,d,v)},t.CreateAlphaTexture=function(e,n,r,o,l,d,v){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_ALPHA,o,l,d,v)},t.CreateRGBTexture=function(e,n,r,o,l,d,v,y){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGB,o,l,d,v,y)},t.CreateRGBATexture=function(e,n,r,o,l,d,v,y){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGBA,o,l,d,v,y)},t.CreateRTexture=function(e,n,r,o,l,d,v,y){return l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=ke.a.TRILINEAR_SAMPLINGMODE),y===void 0&&(y=g.a.TEXTURETYPE_FLOAT),new t(e,n,r,g.a.TEXTUREFORMAT_R,o,l,d,v,y)},t}(ke.a),ba=function(){function i(t,e,n){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=h.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._waitingOverrideMeshId=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new S.c,this.bones=[],this._scene=n||re.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}return Object.defineProperty(i.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Skeleton"},i.prototype.getChildren=function(){return this.bones.filter(function(t){return!t.getParent()})},i.prototype.getTransformMatrices=function(t){return this.needInitialSkinMatrix&&t._bonesTransformMatrices?t._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},i.prototype.getTransformMatrixTexture=function(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture},i.prototype.getScene=function(){return this._scene},i.prototype.toString=function(t){var e="Name: "+this.name+", nBones: "+this.bones.length;if(e+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.getBoneIndexByName=function(t){for(var e=0,n=this.bones.length;e<n;e++)if(this.bones[e].name===t)return e;return-1},i.prototype.createAnimationRange=function(t,e,n){if(!this._ranges[t]){this._ranges[t]=new G(t,e,n);for(var r=0,o=this.bones.length;r<o;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(t,e,n)}},i.prototype.deleteAnimationRange=function(t,e){e===void 0&&(e=!0);for(var n=0,r=this.bones.length;n<r;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(t,e);this._ranges[t]=null},i.prototype.getAnimationRange=function(t){return this._ranges[t]||null},i.prototype.getAnimationRanges=function(){var t,e=[];for(t in this._ranges)e.push(this._ranges[t]);return e},i.prototype.copyAnimationRange=function(t,e,n){if(n===void 0&&(n=!1),this._ranges[e]||!t.getAnimationRange(e))return!1;var r,o,l=!0,d=this._getHighestAnimationFrame()+1,v={},y=t.bones;for(o=0,r=y.length;o<r;o++)v[y[o].name]=y[o];this.bones.length!==y.length&&(_.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+y.length),l=!1);var D=n&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(o=0,r=this.bones.length;o<r;o++){var w=this.bones[o].name,F=v[w];F?l=l&&this.bones[o].copyAnimationRange(F,e,d,n,D):(_.a.Warn("copyAnimationRange: not same rig, missing source bone "+w),l=!1)}var z=t.getAnimationRange(e);return z&&(this._ranges[e]=new G(e,z.from+d,z.to+d)),l},i.prototype.returnToRest=function(){for(var t=h.c.Vector3[0],e=h.c.Quaternion[0],n=h.c.Vector3[1],r=0;r<this.bones.length;r++){var o=this.bones[r];o._index!==-1&&(o.returnToRest(),o._linkedTransformNode&&(o.getRestPose().decompose(t,e,n),o._linkedTransformNode.position=n.clone(),o._linkedTransformNode.rotationQuaternion=e.clone(),o._linkedTransformNode.scaling=t.clone()))}},i.prototype._getHighestAnimationFrame=function(){for(var t=0,e=0,n=this.bones.length;e<n;e++)if(this.bones[e].animations[0]){var r=this.bones[e].animations[0].getHighestFrame();t<r&&(t=r)}return t},i.prototype.beginAnimation=function(t,e,n,r){var o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,n,r):null},i.MakeAnimationAdditive=function(t,e,n){e===void 0&&(e=0);var r=t.getAnimationRange(n);if(!r)return null;for(var o=t._scene.getAllAnimatablesByTarget(t),l=null,d=0;d<o.length;d++){var v=o[d];if(v.fromFrame===(r==null?void 0:r.from)&&v.toFrame===(r==null?void 0:r.to)){l=v;break}}var y=t.getAnimatables();for(d=0;d<y.length;d++){var D=y[d].animations;if(D)for(var w=0;w<D.length;w++)H.MakeAnimationAdditive(D[w],e,n)}return l&&(l.isAdditive=!0),t},i.prototype._markAsDirty=function(){this._isDirty=!0},i.prototype._registerMeshWithPoseMatrix=function(t){this._meshesWithPoseMatrix.push(t)},i.prototype._unregisterMeshWithPoseMatrix=function(t){var e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)},i.prototype._computeTransformMatrices=function(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var r=this.bones[n];r._childUpdateId++;var o=r.getParent();if(o?r.getLocalMatrix().multiplyToRef(o.getWorldMatrix(),r.getWorldMatrix()):e?r.getLocalMatrix().multiplyToRef(e,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),r._index!==-1){var l=r._index===null?n:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),t,16*l)}}this._identity.copyToArray(t,16*this.bones.length)},i.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];n._linkedTransformNode&&(n._linkedTransformNode.computeWorldMatrix(),n._matrix=n._linkedTransformNode._localMatrix,n.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var o=this._meshesWithPoseMatrix[r],l=o.getPoseMatrix();if(o._bonesTransformMatrices&&o._bonesTransformMatrices.length===16*(this.bones.length+1)||(o._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==o){this._synchronizedWithMesh=o;for(var d=0;d<this.bones.length;d++){var v=this.bones[d];v.getParent()||(v.getBaseMatrix().multiplyToRef(l,h.c.Matrix[1]),v._updateDifferenceMatrix(h.c.Matrix[1]))}if(this.isUsingTextureForMatrices){var y=4*(this.bones.length+1);o._transformMatrixTexture&&o._transformMatrixTexture.getSize().width===y||(o._transformMatrixTexture&&o._transformMatrixTexture.dispose(),o._transformMatrixTexture=xr.CreateRGBATexture(o._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))}}this._computeTransformMatrices(o._bonesTransformMatrices,l),this.isUsingTextureForMatrices&&o._transformMatrixTexture&&o._transformMatrixTexture.update(o._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=xr.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},i.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables},i.prototype.clone=function(t,e){var n=new i(t,e||t,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMesh=this.overrideMesh;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],l=null,d=o.getParent();if(d){var v=this.bones.indexOf(d);l=n.bones[v]}var y=new Ne(o.name,n,l,o.getBaseMatrix().clone(),o.getRestPose().clone());y._index=o._index,o._linkedTransformNode&&y.linkTransformNode(o._linkedTransformNode),ye.a.DeepCopy(o.animations,y.animations)}if(this._ranges)for(var D in n._ranges={},this._ranges){var w=this._ranges[D];w&&(n._ranges[D]=w.clone())}return this._isDirty=!0,n},i.prototype.enableBlending=function(t){t===void 0&&(t=.01),this.bones.forEach(function(e){e.animations.forEach(function(n){n.enableBlending=!0,n.blendingSpeed=t})})},i.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},i.prototype.serialize=function(){var t,e,n={};n.name=this.name,n.id=this.id,this.dimensionsAtRest&&(n.dimensionsAtRest=this.dimensionsAtRest.asArray()),n.bones=[],n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMeshId=(t=this.overrideMesh)===null||t===void 0?void 0:t.id;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],l=o.getParent(),d={parentBoneIndex:l?this.bones.indexOf(l):-1,index:o.getIndex(),name:o.name,matrix:o.getBaseMatrix().toArray(),rest:o.getRestPose().toArray(),linkedTransformNodeId:(e=o.getTransformNode())===null||e===void 0?void 0:e.id};for(var v in n.bones.push(d),o.length&&(d.length=o.length),o.metadata&&(d.metadata=o.metadata),o.animations&&o.animations.length>0&&(d.animation=o.animations[0].serialize()),n.ranges=[],this._ranges){var y=this._ranges[v];if(y){var D={};D.name=v,D.from=y.from,D.to=y.to,n.ranges.push(D)}}}return n},i.Parse=function(t,e){var n,r=new i(t.name,t.id,e);for(t.dimensionsAtRest&&(r.dimensionsAtRest=h.e.FromArray(t.dimensionsAtRest)),r.needInitialSkinMatrix=t.needInitialSkinMatrix,t.overrideMeshId&&(r._hasWaitingData=!0,r._waitingOverrideMeshId=t.overrideMeshId),n=0;n<t.bones.length;n++){var o=t.bones[n],l=t.bones[n].index,d=null;o.parentBoneIndex>-1&&(d=r.bones[o.parentBoneIndex]);var v=o.rest?h.a.FromArray(o.rest):null,y=new Ne(o.name,r,d,h.a.FromArray(o.matrix),v,null,l);o.id!==void 0&&o.id!==null&&(y.id=o.id),o.length&&(y.length=o.length),o.metadata&&(y.metadata=o.metadata),o.animation&&y.animations.push(H.Parse(o.animation)),o.linkedTransformNodeId!==void 0&&o.linkedTransformNodeId!==null&&(r._hasWaitingData=!0,y._waitingTransformNodeId=o.linkedTransformNodeId)}if(t.ranges)for(n=0;n<t.ranges.length;n++){var D=t.ranges[n];r.createAnimationRange(D.name,D.from,D.to)}return r},i.prototype.computeAbsoluteTransforms=function(t){t===void 0&&(t=!1);var e=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=e||t)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=e)},i.prototype.getPoseMatrix=function(){var t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t},i.prototype.sortBones=function(){for(var t=new Array,e=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,t,e);this.bones=t},i.prototype._sortBones=function(t,e,n){if(!n[t]){n[t]=!0;var r=this.bones[t];r._index===void 0&&(r._index=t);var o=r.getParent();o&&this._sortBones(this.bones.indexOf(o),e,n),e.push(r)}},i.prototype.setCurrentPoseAsRest=function(){this.bones.forEach(function(t){t.setCurrentPoseAsRest()})},i}(),Kn={},ya=function(){function i(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return i.prototype.add=function(t){var e=t.getSimpleName();this.attached[e]?_.a.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl())},i.prototype.remove=function(t){for(var e in this.attached){var n=this.attached[e];n===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype.removeByType=function(t){for(var e in this.attached){var n=this.attached[e];n.getClassName()===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},i.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},i.prototype.attachElement=function(t){if(t===void 0&&(t=!1),!this.attachedToElement)for(var e in t=!Pt.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t,this.attached)this.attached[e].attachControl(t)},i.prototype.detachElement=function(t){for(var e in t===void 0&&(t=!1),this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},i.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},i.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},i.prototype.serialize=function(t){var e={};for(var n in this.attached){var r=this.attached[n],o=B.a.Serialize(r);e[r.getClassName()]=o}t.inputsmgr=e},i.prototype.parse=function(t){var e=t.inputsmgr;if(e){for(var n in this.clear(),e)if(l=Kn[n]){var r=e[n],o=B.a.Parse(function(){return new l},r,null);this.add(o)}}else for(var n in this.attached){var l;(l=Kn[this.attached[n].getClassName()])&&(o=B.a.Parse(function(){return new l},t,null),this.remove(this.attached[n]),this.add(o))}},i}(),gp=function(i,t){this.x=i,this.y=t},zn=function(){function i(t,e,n,r,o,l,d){r===void 0&&(r=0),o===void 0&&(o=1),l===void 0&&(l=2),d===void 0&&(d=3),this.id=t,this.index=e,this.browserGamepad=n,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=i.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=o,this._rightStickAxisX=l,this._rightStickAxisY=d,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0}),i.prototype.onleftstickchanged=function(t){this._onleftstickchanged=t},i.prototype.onrightstickchanged=function(t){this._onrightstickchanged=t},Object.defineProperty(i.prototype,"leftStick",{get:function(){return this._leftStick},set:function(t){!this._onleftstickchanged||this._leftStick.x===t.x&&this._leftStick.y===t.y||this._onleftstickchanged(t),this._leftStick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightStick",{get:function(){return this._rightStick},set:function(t){!this._onrightstickchanged||this._rightStick.x===t.x&&this._rightStick.y===t.y||this._onrightstickchanged(t),this._rightStick=t},enumerable:!1,configurable:!0}),i.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},i.prototype.dispose=function(){},i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,i.DUALSHOCK=4,i}(),zu=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.onButtonDownObservable=new S.c,o.onButtonUpObservable=new S.c,o.type=zn.GENERIC,o._buttons=new Array(r.buttons.length),o}return Object(f.d)(t,i),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(zn),Dc=function(){function i(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==zn.POSE_ENABLED&&(t.gamepad&&n.type!==zn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(zn.XBOX)},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(e.x!=0){var n=e.x/this.gamepadRotationSensibility;n!=0&&Math.abs(n)>.005&&(t.inertialAlphaOffset+=n)}if(e.y!=0){var r=e.y/this.gamepadRotationSensibility*this._yAxisScale;r!=0&&Math.abs(r)>.005&&(t.inertialBetaOffset+=r)}}var o=this.gamepad.leftStick;if(o&&o.y!=0){var l=o.y/this.gamepadMoveSensibility;l!=0&&Math.abs(l)>.005&&(this.camera.inertialRadiusOffset-=l)}}},i.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(f.c)([Object(B.c)()],i.prototype,"gamepadRotationSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Kn.ArcRotateCameraGamepadInput=Dc;var Ji=c(66),wc=function(){function i(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Ji.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,(e.keysUp.indexOf(o.keyCode)!==-1||e.keysDown.indexOf(o.keyCode)!==-1||e.keysLeft.indexOf(o.keyCode)!==-1||e.keysRight.indexOf(o.keyCode)!==-1||e.keysReset.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysReset.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e];this.keysLeft.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(n)!==-1&&t.useInputToRestoreState&&t.restoreState()}},i.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},Object(f.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRight",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysReset",void 0),Object(f.c)([Object(B.c)()],i.prototype,"panningSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"zoomingSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"useAltToZoom",void 0),Object(f.c)([Object(B.c)()],i.prototype,"angularSpeed",void 0),i}();Kn.ArcRotateCameraKeyboardMoveInput=wc;var Lc=function(){function i(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.computeDeltaFromMouseWheelLegacyEvent=function(t,e){var n=.01*t*this.wheelDeltaPercentage*e;return t>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)},i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===Ot.a.POINTERWHEEL){var o=n.event,l=0,d=o,v=0;if(v=d.wheelDelta?d.wheelDelta:60*-(o.deltaY||o.detail),e.wheelDeltaPercentage){if((l=e.computeDeltaFromMouseWheelLegacyEvent(v,e.camera.radius))>0){for(var y=e.camera.radius,D=e.camera.inertialRadiusOffset+l,w=0;w<20&&Math.abs(D)>.001;w++)y-=D,D*=e.camera.inertia;y=J.a.Clamp(y,0,Number.MAX_VALUE),l=e.computeDeltaFromMouseWheelLegacyEvent(v,y)}}else l=v/(40*e.wheelPrecision);l&&(e.camera.inertialRadiusOffset+=l),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(f.c)([Object(B.c)()],i.prototype,"wheelPrecision",void 0),Object(f.c)([Object(B.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Kn.ArcRotateCameraMouseWheelInput=Lc;var Gu=function(){function i(){this.buttons=[0,1,2]}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement(),o=0,l=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(v,y){var D=v.event,w=D.pointerType==="touch";if(!n.isInVRExclusivePointerMode&&(v.type===Ot.a.POINTERMOVE||e.buttons.indexOf(D.button)!==-1)){var F=D.srcElement||D.target;if(e._altKey=D.altKey,e._ctrlKey=D.ctrlKey,e._metaKey=D.metaKey,e._shiftKey=D.shiftKey,e._buttonsPressed=D.buttons,n.isPointerLock){var z=D.movementX||D.mozMovementX||D.webkitMovementX||D.msMovementX||0,k=D.movementY||D.mozMovementY||D.webkitMovementY||D.msMovementY||0;e.onTouch(null,z,k),e.pointA=null,e.pointB=null}else if(v.type===Ot.a.POINTERDOWN&&F){try{F.setPointerCapture(D.pointerId)}catch(be){}e.pointA===null?e.pointA={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}:e.pointB===null&&(e.pointB={x:D.clientX,y:D.clientY,pointerId:D.pointerId,type:D.pointerType}),e.onButtonDown(D),t||(D.preventDefault(),r&&r.focus())}else if(v.type===Ot.a.POINTERDOUBLETAP)e.onDoubleTap(D.pointerType);else if(v.type===Ot.a.POINTERUP&&F){try{F.releasePointerCapture(D.pointerId)}catch(be){}w||(e.pointB=null),n._badOS?e.pointA=e.pointB=null:e.pointB&&e.pointA&&e.pointA.pointerId==D.pointerId?(e.pointA=e.pointB,e.pointB=null):e.pointA&&e.pointB&&e.pointB.pointerId==D.pointerId?e.pointB=null:e.pointA=e.pointB=null,(o!==0||l)&&(e.onMultiTouch(e.pointA,e.pointB,o,0,l,null),o=0,l=null),e.onButtonUp(D),t||D.preventDefault()}else if(v.type===Ot.a.POINTERMOVE){if(t||D.preventDefault(),e.pointA&&e.pointB===null)z=D.clientX-e.pointA.x,k=D.clientY-e.pointA.y,e.onTouch(e.pointA,z,k),e.pointA.x=D.clientX,e.pointA.y=D.clientY;else if(e.pointA&&e.pointB){var K=e.pointA.pointerId===D.pointerId?e.pointA:e.pointB;K.x=D.clientX,K.y=D.clientY;var ae=e.pointA.x-e.pointB.x,le=e.pointA.y-e.pointB.y,fe=ae*ae+le*le,me={x:(e.pointA.x+e.pointB.x)/2,y:(e.pointA.y+e.pointB.y)/2,pointerId:D.pointerId,type:v.type};e.onMultiTouch(e.pointA,e.pointB,o,fe,l,me),l=me,o=fe}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._onLostFocus=function(){e.pointA=e.pointB=null,o=0,l=null,e.onLostFocus()},r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var d=this.camera.getScene().getEngine().getHostWindow();d&&et.b.RegisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])},i.prototype.detachControl=function(t){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&et.b.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var n=this.camera.getScene().getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},i.prototype.getClassName=function(){return"BaseCameraPointersInput"},i.prototype.getSimpleName=function(){return"pointers"},i.prototype.onDoubleTap=function(t){},i.prototype.onTouch=function(t,e,n){},i.prototype.onMultiTouch=function(t,e,n,r,o,l){},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.onButtonDown=function(t){},i.prototype.onButtonUp=function(t){},i.prototype.onLostFocus=function(){},Object(f.c)([Object(B.c)()],i.prototype,"buttons",void 0),i}(),Nc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility):(this.camera.inertialAlphaOffset-=n/this.angularSensibilityX,this.camera.inertialBetaOffset-=r/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,n,r,o,l,d){if(!(r===0&&l===null||o===0&&d===null)){var v=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(r)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this.panningSensibility!==0&&l&&d){var y=d.x-l.x,D=d.y-l.y;this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility}}else{this._twoFingerActivityCount++;var w=Math.sqrt(r),F=Math.sqrt(o);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(F-w)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):this.panningSensibility!==0&&this.multiTouchPanning&&d&&l&&(y=d.x-l.x,D=d.y-l.y,this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility)}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(f.c)([Object(B.c)()],t.prototype,"buttons",void 0),Object(f.c)([Object(B.c)()],t.prototype,"angularSensibilityX",void 0),Object(f.c)([Object(B.c)()],t.prototype,"angularSensibilityY",void 0),Object(f.c)([Object(B.c)()],t.prototype,"pinchPrecision",void 0),Object(f.c)([Object(B.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(f.c)([Object(B.c)()],t.prototype,"useNaturalPinchZoom",void 0),Object(f.c)([Object(B.c)()],t.prototype,"panningSensibility",void 0),Object(f.c)([Object(B.c)()],t.prototype,"multiTouchPanning",void 0),Object(f.c)([Object(B.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(Gu);Kn.ArcRotateCameraPointersInput=Nc;var is=function(i){function t(e){return i.call(this,e)||this}return Object(f.d)(t,i),t.prototype.addMouseWheel=function(){return this.add(new Lc),this},t.prototype.addPointers=function(){return this.add(new Nc),this},t.prototype.addKeyboard=function(){return this.add(new wc),this},t}(ya);is.prototype.addVRDeviceOrientation=function(){return this.add(new Fc),this};var Fc=function(){function i(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);var n=this.camera.getScene().getEngine().getHostWindow();n&&(typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n.addEventListener("deviceorientation",e._deviceOrientationHandler):et.b.Warn("Permission not granted.")}).catch(function(r){et.b.Error(r)}):n.addEventListener("deviceorientation",this._deviceOrientationHandler))},i.prototype._onOrientationEvent=function(t){t.alpha!==null&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),t.gamma!==null&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},i.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},i.prototype.detachControl=function(t){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},i.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"VRDeviceOrientation"},i}();Kn.ArcRotateCameraVRDeviceOrientationInput=Fc;var Bc=function(){function i(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;n.type===Ji.a.KEYDOWN?e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault())}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},i.prototype._onLostFocus=function(t){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysForward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysBackward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,-r,0):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysLeft.indexOf(n)!==-1&&t._localDirection.copyFromFloats(-r,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),h.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},Object(f.c)([Object(B.c)()],i.prototype,"keysForward",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysBackward",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRight",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),i}();Kn.FlyCameraKeyboardInput=Bc;var wo=function(){function i(t){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this.noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(n,r){e._pointerInput(n,r)},Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){e.camera.rollCorrect&&e.camera.restoreRoll(e.camera.rollCorrect)})},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},i.prototype.getClassName=function(){return"FlyCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},i.prototype._pointerInput=function(t,e){var n=t.event,r=this.camera.getEngine();if(!r.isInVRExclusivePointerMode&&(this.touchEnabled||n.pointerType!=="touch")&&(t.type===Ot.a.POINTERMOVE||this.buttons.indexOf(n.button)!==-1)){var o=n.srcElement||n.target;if(t.type===Ot.a.POINTERDOWN&&o){try{o.setPointerCapture(n.pointerId)}catch(v){}this.previousPosition={x:n.clientX,y:n.clientY},this.activeButton=n.button,this.noPreventDefault||(n.preventDefault(),this.element.focus()),r.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===Ot.a.POINTERUP&&o){try{o.releasePointerCapture(n.pointerId)}catch(v){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||n.preventDefault()}else if(t.type===Ot.a.POINTERMOVE){if(!this.previousPosition)return void(r.isPointerLock&&this._onMouseMove(t.event));var l=n.clientX-this.previousPosition.x,d=n.clientY-this.previousPosition.y;this.rotateCamera(l,d),this.previousPosition={x:n.clientX,y:n.clientY},this.noPreventDefault||n.preventDefault()}}},i.prototype._onMouseMove=function(t){var e=this.camera.getEngine();if(e.isPointerLock&&!e.isInVRExclusivePointerMode){var n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this.rotateCamera(n,r),this.previousPosition=null,this.noPreventDefault||t.preventDefault()}},i.prototype.rotateCamera=function(t,e){var n=this,r=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),r.parent&&r.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var o,l=t/this.angularSensibility,d=e/this.angularSensibility,v=h.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z);if(this.buttonsPitch.some(function(w){return w===n.activeButton})&&(o=h.b.RotationAxis(Te.a.X,d),v.multiplyInPlace(o)),this.buttonsYaw.some(function(w){return w===n.activeButton})){o=h.b.RotationAxis(Te.a.Y,l),v.multiplyInPlace(o);var y=r.bankedTurnLimit+r._trackRoll;if(r.bankedTurn&&-y<r.rotation.z&&r.rotation.z<y){var D=r.bankedTurnMultiplier*-l;o=h.b.RotationAxis(Te.a.Z,D),v.multiplyInPlace(o)}}this.buttonsRoll.some(function(w){return w===n.activeButton})&&(o=h.b.RotationAxis(Te.a.Z,-l),r._trackRoll-=l,v.multiplyInPlace(o)),v.toEulerAnglesToRef(r.rotation)},Object(f.c)([Object(B.c)()],i.prototype,"buttons",void 0),Object(f.c)([Object(B.c)()],i.prototype,"angularSensibility",void 0),i}();Kn.FlyCameraMouseInput=wo;var Ta=function(){function i(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Ji.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,e._shiftPressed=o.shiftKey,(e.keysHeightOffsetIncr.indexOf(o.keyCode)!==-1||e.keysHeightOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetIncr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRadiusIncr.indexOf(o.keyCode)!==-1||e.keysRadiusDecr.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysHeightOffsetIncr.indexOf(o.keyCode)===-1&&e.keysHeightOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetIncr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRadiusIncr.indexOf(o.keyCode)===-1&&e.keysRadiusDecr.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){var t=this;this._onKeyboardObserver&&this._keys.forEach(function(e){t.keysHeightOffsetIncr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset+=t.heightSensibility:t.keysHeightOffsetDecr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset-=t.heightSensibility:t.keysRotationOffsetIncr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset+=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRotationOffsetDecr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset-=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRadiusIncr.indexOf(e)!==-1&&t._modifierRadius()?t.camera.radius+=t.radiusSensibility:t.keysRadiusDecr.indexOf(e)!==-1&&t._modifierRadius()&&(t.camera.radius-=t.radiusSensibility)})},i.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},i.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},i.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},Object(f.c)([Object(B.c)()],i.prototype,"keysHeightOffsetIncr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysHeightOffsetDecr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierAlt",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierCtrl",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysHeightOffsetModifierShift",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRotationOffsetIncr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRotationOffsetDecr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierAlt",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierCtrl",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRotationOffsetModifierShift",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRadiusIncr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRadiusDecr",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRadiusModifierAlt",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRadiusModifierCtrl",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRadiusModifierShift",void 0),Object(f.c)([Object(B.c)()],i.prototype,"heightSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"rotationSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"radiusSensibility",void 0),i}();Kn.FollowCameraKeyboardMoveInput=Ta;var Uc=function(){function i(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===Ot.a.POINTERWHEEL){var o=n.event,l=0,d=Math.max(-1,Math.min(1,o.deltaY||o.wheelDelta||-o.detail));e.wheelDeltaPercentage?(console.assert(e.axisControlRadius+e.axisControlHeight+e.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+e.axisControlRadius+", axisControlHeightOffset: "+e.axisControlHeight+", axisControlRotationOffset: "+e.axisControlRotation),e.axisControlRadius?l=.01*d*e.wheelDeltaPercentage*e.camera.radius:e.axisControlHeight?l=.01*d*e.wheelDeltaPercentage*e.camera.heightOffset:e.axisControlRotation&&(l=.01*d*e.wheelDeltaPercentage*e.camera.rotationOffset)):l=d*e.wheelPrecision,l&&(e.axisControlRadius?e.camera.radius+=l:e.axisControlHeight?e.camera.heightOffset-=l:e.axisControlRotation&&(e.camera.rotationOffset-=l)),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(f.c)([Object(B.c)()],i.prototype,"axisControlRadius",void 0),Object(f.c)([Object(B.c)()],i.prototype,"axisControlHeight",void 0),Object(f.c)([Object(B.c)()],i.prototype,"axisControlRotation",void 0),Object(f.c)([Object(B.c)()],i.prototype,"wheelPrecision",void 0),Object(f.c)([Object(B.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Kn.FollowCameraMouseWheelInput=Uc;var Vc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.angularSensibilityX=1,e.angularSensibilityY=1,e.pinchPrecision=1e4,e.pinchDeltaPercentage=0,e.axisXControlRadius=!1,e.axisXControlHeight=!1,e.axisXControlRotation=!0,e.axisYControlRadius=!1,e.axisYControlHeight=!0,e.axisYControlRotation=!1,e.axisPinchControlRadius=!0,e.axisPinchControlHeight=!1,e.axisPinchControlRotation=!1,e.warningEnable=!0,e._warningCounter=0,e}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=n/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=r/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=n/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=r/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=n/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=r/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,n,r,o,l,d){if(!(r===0&&l===null||o===0&&d===null)){var v=(o-r)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(v*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=v*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=v*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=v*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=v),this.axisPinchControlHeight&&(this.camera.heightOffset+=v),this.axisPinchControlRadius&&(this.camera.radius-=v))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},Object(f.c)([Object(B.c)()],t.prototype,"angularSensibilityX",void 0),Object(f.c)([Object(B.c)()],t.prototype,"angularSensibilityY",void 0),Object(f.c)([Object(B.c)()],t.prototype,"pinchPrecision",void 0),Object(f.c)([Object(B.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisXControlRadius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisXControlHeight",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisXControlRotation",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisYControlRadius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisYControlHeight",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisYControlRotation",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisPinchControlRadius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisPinchControlHeight",void 0),Object(f.c)([Object(B.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(Gu);Kn.FollowCameraPointersInput=Vc;var os=function(){function i(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Ji.a.KEYDOWN?e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault()))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysLeft.indexOf(n)!==-1?t._localDirection.copyFromFloats(-r,0,0):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUpward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDownward.indexOf(n)!==-1&&t._localDirection.copyFromFloats(0,-r,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),h.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},i.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},i.prototype._onLostFocus=function(){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},Object(f.c)([Object(B.c)()],i.prototype,"keysUp",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysUpward",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysDown",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysDownward",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysLeft",void 0),Object(f.c)([Object(B.c)()],i.prototype,"keysRight",void 0),i}();Kn.FreeCameraKeyboardMoveInput=os;var kc=function(){function i(t){t===void 0&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new S.c,this._allowCameraRotation=!0}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement();this._pointerInput||(this._pointerInput=function(o){var l=o.event;if(!n.isInVRExclusivePointerMode&&(e.touchEnabled||l.pointerType!=="touch")&&(o.type===Ot.a.POINTERMOVE||e.buttons.indexOf(l.button)!==-1)){var d=l.srcElement||l.target;if(o.type===Ot.a.POINTERDOWN&&d){try{d.setPointerCapture(l.pointerId)}catch(D){}e.previousPosition={x:l.clientX,y:l.clientY},t||(l.preventDefault(),r&&r.focus()),n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event)}else if(o.type===Ot.a.POINTERUP&&d){try{d.releasePointerCapture(l.pointerId)}catch(D){}e.previousPosition=null,t||l.preventDefault()}else if(o.type===Ot.a.POINTERMOVE){if(!e.previousPosition)return void(n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event));var v=l.clientX-e.previousPosition.x,y=l.clientY-e.previousPosition.y;e.camera.getScene().useRightHandedSystem&&(v*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(v*=-1),e._allowCameraRotation&&(e.camera.cameraRotation.y+=v/e.angularSensibility,e.camera.cameraRotation.x+=y/e.angularSensibility),e.onPointerMovedObservable.notifyObservers({offsetX:v,offsetY:y}),e.previousPosition={x:l.clientX,y:l.clientY},t||l.preventDefault()}}}),this._onMouseMove=function(o){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var l=o.movementX||o.mozMovementX||o.webkitMovementX||o.msMovementX||0;e.camera.getScene().useRightHandedSystem&&(l*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(l*=-1),e.camera.cameraRotation.y+=l/e.angularSensibility;var d=o.movementY||o.mozMovementY||o.webkitMovementY||o.msMovementY||0;e.camera.cameraRotation.x+=d/e.angularSensibility,e.previousPosition=null,t||o.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.detachControl=function(t){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this.onContextMenu){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this.onContextMenu)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null}},i.prototype.getClassName=function(){return"FreeCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},Object(f.c)([Object(B.c)()],i.prototype,"buttons",void 0),Object(f.c)([Object(B.c)()],i.prototype,"angularSensibility",void 0),i}();Kn.FreeCameraMouseInput=kc;var nn,vp=function(){function i(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new S.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n){if(n.type===Ot.a.POINTERWHEEL){var r=n.event,o=r.deltaMode===WheelEvent.DOM_DELTA_LINE?e._ffMultiplier:1;r.deltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.deltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.deltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.deltaZ/e._normalize):r.wheelDeltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.wheelDeltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.wheelDeltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.wheelDeltaZ/e._normalize):r.wheelDelta&&(e._wheelDeltaY-=e.wheelPrecisionY*r.wheelDelta/e._normalize),r.preventDefault&&(t||r.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ot.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},i.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},i.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(f.c)([Object(B.c)()],i.prototype,"wheelPrecisionX",void 0),Object(f.c)([Object(B.c)()],i.prototype,"wheelPrecisionY",void 0),Object(f.c)([Object(B.c)()],i.prototype,"wheelPrecisionZ",void 0),i}();(function(i){i[i.MoveRelative=0]="MoveRelative",i[i.RotateRelative=1]="RotateRelative",i[i.MoveScene=2]="MoveScene"})(nn||(nn={}));var as=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._moveRelative=h.e.Zero(),e._rotateRelative=h.e.Zero(),e._moveScene=h.e.Zero(),e._wheelXAction=nn.MoveRelative,e._wheelXActionCoordinate=Te.b.X,e._wheelYAction=nn.MoveRelative,e._wheelYActionCoordinate=Te.b.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(t.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==nn.MoveRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==nn.MoveRelative||(this._wheelXAction=nn.MoveRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==nn.MoveRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==nn.MoveRelative||(this._wheelYAction=nn.MoveRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==nn.MoveRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==nn.MoveRelative||(this._wheelZAction=nn.MoveRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==nn.RotateRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==nn.RotateRelative||(this._wheelXAction=nn.RotateRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==nn.RotateRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==nn.RotateRelative||(this._wheelYAction=nn.RotateRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==nn.RotateRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==nn.RotateRelative||(this._wheelZAction=nn.RotateRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==nn.MoveScene?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==nn.MoveScene||(this._wheelXAction=nn.MoveScene,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==nn.MoveScene?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==nn.MoveScene||(this._wheelYAction=nn.MoveScene,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==nn.MoveScene?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==nn.MoveScene||(this._wheelZAction=nn.MoveScene,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),t.prototype.checkInputs=function(){if(this._wheelDeltaX!==0||this._wheelDeltaY!==0||this._wheelDeltaZ!=0){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=h.a.Zero();this.camera.getViewMatrix().invertToRef(e);var n=h.e.Zero();h.e.TransformNormalToRef(this._moveRelative,e,n),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(n),this.camera.cameraDirection.addInPlace(this._moveScene),i.prototype.checkInputs.call(this)}},t.prototype._updateCamera=function(){var e=this._moveRelative,n=this._rotateRelative,r=this._moveScene,o=function(l,d,v){if(l!==0&&d!==null&&v!==null){var y=null;switch(d){case nn.MoveRelative:y=e;break;case nn.RotateRelative:y=n;break;case nn.MoveScene:y=r}switch(v){case Te.b.X:y.set(l,0,0);break;case Te.b.Y:y.set(0,l,0);break;case Te.b.Z:y.set(0,0,l)}}};o(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),o(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),o(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},Object(f.c)([Object(B.c)()],t.prototype,"wheelXMoveRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelYMoveRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelZMoveRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelXRotateRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelYRotateRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelZRotateRelative",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelXMoveScene",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelYMoveScene",null),Object(f.c)([Object(B.c)()],t.prototype,"wheelZMoveScene",null),t}(vp);Kn.FreeCameraMouseWheelInput=as;var jc=function(){function i(t){t===void 0&&(t=!1),this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return i.prototype.attachControl=function(t){var e=this;t=et.b.BackCompatCameraNoPreventDefault(arguments);var n=null;if(this._pointerInput===void 0&&(this._onLostFocus=function(){e._offsetX=null,e._offsetY=null},this._pointerInput=function(l){var d=l.event,v=!e.camera.getEngine().hostInformation.isMobile&&d instanceof MouseEvent;if(e.allowMouse||d.pointerType!=="mouse"&&!v){if(l.type===Ot.a.POINTERDOWN){if(t||d.preventDefault(),e._pointerPressed.push(d.pointerId),e._pointerPressed.length!==1)return;n={x:d.clientX,y:d.clientY}}else if(l.type===Ot.a.POINTERUP){if(t||d.preventDefault(),(y=e._pointerPressed.indexOf(d.pointerId))===-1||(e._pointerPressed.splice(y,1),y!=0))return;n=null,e._offsetX=null,e._offsetY=null}else if(l.type===Ot.a.POINTERMOVE){if(t||d.preventDefault(),!n)return;var y;if((y=e._pointerPressed.indexOf(d.pointerId))!=0)return;e._offsetX=d.clientX-n.x,e._offsetY=-(d.clientY-n.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ot.a.POINTERDOWN|Ot.a.POINTERUP|Ot.a.POINTERMOVE),this._onLostFocus){var r=this.camera.getEngine(),o=r.getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}},i.prototype.detachControl=function(t){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},i.prototype.checkInputs=function(){if(this._offsetX!==null&&this._offsetY!==null&&(this._offsetX!==0||this._offsetY!==0)){var t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var e=t._computeLocalCameraSpeed(),n=new h.e(0,0,e*this._offsetY/this.touchMoveSensibility);h.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(h.e.TransformCoordinates(n,t._cameraRotationMatrix))}}},i.prototype.getClassName=function(){return"FreeCameraTouchInput"},i.prototype.getSimpleName=function(){return"touch"},Object(f.c)([Object(B.c)()],i.prototype,"touchAngularSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"touchMoveSensibility",void 0),i}();Kn.FreeCameraTouchInput=jc;var Ea=function(i){function t(e){var n=i.call(this,e)||this;return n._mouseInput=null,n._mouseWheelInput=null,n}return Object(f.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new os),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this._mouseInput||(this._mouseInput=new kc(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new as,this.add(this._mouseWheelInput)),this},t.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},t.prototype.addTouch=function(){return this.add(new jc),this},t.prototype.clear=function(){i.prototype.clear.call(this),this._mouseInput=null},t}(ya);Ea.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new zc,this.add(this._deviceOrientationInput)),this};var zc=function(){function i(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new h.b,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new S.c,this._orientationChanged=function(){t._screenOrientationAngle=window.orientation!==void 0?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-et.b.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=e.alpha!==null?e.alpha:0,t._beta=e.beta!==null?e.beta:0,t._gamma=e.gamma!==null?e.gamma:0,e.alpha!==null&&t._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new h.b(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return i.WaitForOrientationChangeAsync=function(t){return new Promise(function(e,n){var r=!1,o=function(){window.removeEventListener("deviceorientation",o),r=!0,e()};t&&setTimeout(function(){r||(window.removeEventListener("deviceorientation",o),n("WaitForOrientationChangeAsync timed out"))},t),typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(l){l=="granted"?window.addEventListener("deviceorientation",o):et.b.Warn("Permission not granted.")}).catch(function(l){et.b.Error(l)}):window.addEventListener("deviceorientation",o)})},Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},set:function(t){var e=this;this._camera=t,this._camera==null||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new h.b),this._camera&&this._camera.onDisposeObservable.add(function(){e._onDeviceOrientationChangedObservable.clear()})},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().getEngine().getHostWindow();if(e){var n=function(){e.addEventListener("orientationchange",t._orientationChanged),e.addEventListener("deviceorientation",t._deviceOrientation),t._orientationChanged()};typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n():et.b.Warn("Permission not granted.")}).catch(function(r){et.b.Error(r)}):n()}},i.prototype.detachControl=function(t){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},i.prototype.checkInputs=function(){this._alpha&&(h.b.RotationYawPitchRollToRef(et.b.ToRadians(this._alpha),et.b.ToRadians(this._beta),-et.b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},i.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"deviceOrientation"},i}();Kn.FreeCameraDeviceOrientationInput=zc;var Sa=function(){function i(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._yAxisScale=1,this._cameraTransform=h.a.Identity(),this._deltaTransform=h.e.Zero(),this._vector3=h.e.Zero(),this._vector2=h.d.Zero()}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==zn.POSE_ENABLED&&(t.gamepad&&n.type!==zn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(zn.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick,n=e.x/this.gamepadMoveSensibility,r=e.y/this.gamepadMoveSensibility;e.x=Math.abs(n)>.005?0+n:0,e.y=Math.abs(r)>.005?0+r:0;var o=this.gamepad.rightStick;if(o){var l=o.x/this.gamepadAngularSensibility,d=o.y/this.gamepadAngularSensibility*this._yAxisScale;o.x=Math.abs(l)>.001?0+l:0,o.y=Math.abs(d)>.001?0+d:0}else o={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):h.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var v=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*v,0,-e.y*v),h.e.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(o.y,o.x),t.cameraRotation.addInPlace(this._vector2)}},i.prototype.getClassName=function(){return"FreeCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(f.c)([Object(B.c)()],i.prototype,"gamepadAngularSensibility",void 0),Object(f.c)([Object(B.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Kn.FreeCameraGamepadInput=Sa;var Nn,Hu=c(112);(function(i){i[i.X=0]="X",i[i.Y=1]="Y",i[i.Z=2]="Z"})(Nn||(Nn={}));var Gc=function(){function i(t,e){var n=this,r=Object(f.a)(Object(f.a)({},i._GetDefaultOptions()),e);if(this._leftJoystick=!!t,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=Nn.X,this._axisTargetedByUpAndDown=Nn.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new Hu.a,this.deltaPosition=h.e.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(l){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas&&(i.Canvas.width=i.vjCanvasWidth,i.Canvas.height=i.vjCanvasHeight),i.halfWidth=i.vjCanvasWidth/2},!i.Canvas){window.addEventListener("resize",this._onResize,!1),i.Canvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas.width=window.innerWidth,i.Canvas.height=window.innerHeight,i.Canvas.style.width="100%",i.Canvas.style.height="100%",i.Canvas.style.position="absolute",i.Canvas.style.backgroundColor="transparent",i.Canvas.style.top="0px",i.Canvas.style.left="0px",i.Canvas.style.zIndex="5",i.Canvas.style.msTouchAction="none",i.Canvas.style.touchAction="none",i.Canvas.setAttribute("touch-action","none");var o=i.Canvas.getContext("2d");if(!o)throw new Error("Unable to create canvas for virtual joystick");i.vjCanvasContext=o,i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.Canvas)}i.halfWidth=i.Canvas.width/2,this.pressed=!1,this.limitToContainer=r.limitToContainer,this._joystickColor=r.color,this.containerSize=r.containerSize,this.puckSize=r.puckSize,r.position&&this.setPosition(r.position.x,r.position.y),r.puckImage&&this.setPuckImage(r.puckImage),r.containerImage&&this.setContainerImage(r.containerImage),r.alwaysVisible&&i._alwaysVisibleSticks++,this.alwaysVisible=r.alwaysVisible,this._joystickPointerID=-1,this._joystickPointerPos=new h.d(0,0),this._joystickPreviousPointerPos=new h.d(0,0),this._joystickPointerStartPos=new h.d(0,0),this._deltaJoystickVector=new h.d(0,0),this._onPointerDownHandlerRef=function(l){n._onPointerDown(l)},this._onPointerMoveHandlerRef=function(l){n._onPointerMove(l)},this._onPointerUpHandlerRef=function(l){n._onPointerUp(l)},i.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("contextmenu",function(l){l.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return i._GetDefaultOptions=function(){return{puckSize:40,containerSize:60,color:"cyan",puckImage:void 0,containerImage:void 0,position:void 0,alwaysVisible:!1,limitToContainer:!1}},i.prototype.setJoystickSensibility=function(t){this._joystickSensibility=t,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(t){t.preventDefault(),(this._leftJoystick===!0?t.clientX<i.halfWidth:t.clientX>i.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPosition?(this._joystickPointerStartPos=this._joystickPosition.clone(),this._joystickPointerPos=this._joystickPosition.clone(),this._joystickPreviousPointerPos=this._joystickPosition.clone(),this._onPointerMove(t)):(this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone()),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},i.prototype._onPointerMove=function(t){if(this._joystickPointerID==t.pointerId){if(this.limitToContainer){var e=new h.d(t.clientX-this._joystickPointerStartPos.x,t.clientY-this._joystickPointerStartPos.y),n=e.length();n>this.containerSize&&e.scaleInPlace(this.containerSize/n),this._joystickPointerPos.x=this._joystickPointerStartPos.x+e.x,this._joystickPointerPos.y=this._joystickPointerStartPos.y+e.y}else this._joystickPointerPos.x=t.clientX,this._joystickPointerPos.y=t.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos),0<i._alwaysVisibleSticks&&(this._leftJoystick?this._joystickPointerPos.x=Math.min(i.halfWidth,this._joystickPointerPos.x):this._joystickPointerPos.x=Math.max(i.halfWidth,this._joystickPointerPos.x));var r=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case Nn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case Nn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case Nn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}var o=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case Nn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case Nn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case Nn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var l=this._touches.get(t.pointerId.toString());l&&(l.x=t.clientX,l.y=t.clientY)}},i.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)this._clearPreviousDraw(),this._joystickPointerID=-1,this.pressed=!1;else{var e=this._touches.get(t.pointerId.toString());e&&i.vjCanvasContext.clearRect(e.prevX-44,e.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},i.prototype.setJoystickColor=function(t){this._joystickColor=t},Object.defineProperty(i.prototype,"containerSize",{get:function(){return this._joystickContainerSize},set:function(t){this._joystickContainerSize=t,this._clearContainerSize=~~(2.1*this._joystickContainerSize),this._clearContainerSizeOffset=~~(this._clearContainerSize/2)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"puckSize",{get:function(){return this._joystickPuckSize},set:function(t){this._joystickPuckSize=t,this._clearPuckSize=~~(2.1*this._joystickPuckSize),this._clearPuckSizeOffset=~~(this._clearPuckSize/2)},enumerable:!1,configurable:!0}),i.prototype.clearPosition=function(){this.alwaysVisible=!1,this._joystickPosition=null},Object.defineProperty(i.prototype,"alwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible!==t&&(t&&this._joystickPosition?(i._alwaysVisibleSticks++,this._alwaysVisible=!0):(i._alwaysVisibleSticks--,this._alwaysVisible=!1))},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t,e){this._joystickPointerStartPos&&this._clearPreviousDraw(),this._joystickPosition=new h.d(t,e)},i.prototype.setActionOnTouch=function(t){this._action=t},i.prototype.setAxisForLeftRight=function(t){switch(t){case Nn.X:case Nn.Y:case Nn.Z:this._axisTargetedByLeftAndRight=t;break;default:this._axisTargetedByLeftAndRight=Nn.X}},i.prototype.setAxisForUpDown=function(t){switch(t){case Nn.X:case Nn.Y:case Nn.Z:this._axisTargetedByUpAndDown=t;break;default:this._axisTargetedByUpAndDown=Nn.Y}},i.prototype._clearPreviousDraw=function(){var t=this._joystickPosition||this._joystickPointerStartPos;i.vjCanvasContext.clearRect(t.x-this._clearContainerSizeOffset,t.y-this._clearContainerSizeOffset,this._clearContainerSize,this._clearContainerSize),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-this._clearPuckSizeOffset,this._joystickPreviousPointerPos.y-this._clearPuckSizeOffset,this._clearPuckSize,this._clearPuckSize)},i.prototype.setContainerImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._containerImage=n}},i.prototype.setPuckImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._puckImage=n}},i.prototype._drawContainer=function(){var t=this._joystickPosition||this._joystickPointerStartPos;this._clearPreviousDraw(),this._containerImage?i.vjCanvasContext.drawImage(this._containerImage,t.x-this.containerSize,t.y-this.containerSize,2*this.containerSize,2*this.containerSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(t.x,t.y,this.containerSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.arc(t.x,t.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawPuck=function(){this._puckImage?i.vjCanvasContext.drawImage(this._puckImage,this._joystickPointerPos.x-this.puckSize,this._joystickPointerPos.y-this.puckSize,2*this.puckSize,2*this.puckSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(this._joystickPointerPos.x,this._joystickPointerPos.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawVirtualJoystick=function(){var t=this;this.alwaysVisible&&this._drawContainer(),this.pressed&&this._touches.forEach(function(e,n){n.pointerId===t._joystickPointerID?(t.alwaysVisible||t._drawContainer(),t._drawPuck(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(n.x,n.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),n.prevX=n.x,n.prevY=n.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},i.prototype.releaseCanvas=function(){i.Canvas&&(i.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.Canvas),i.Canvas=null)},i._globalJoystickIndex=0,i._alwaysVisibleSticks=0,i}();Ea.prototype.addVirtualJoystick=function(){return this.add(new Lo),this};var Lo=function(){function i(){}return i.prototype.getLeftJoystick=function(){return this._leftjoystick},i.prototype.getRightJoystick=function(){return this._rightjoystick},i.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=50*t._computeLocalCameraSpeed(),n=h.a.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),r=h.e.TransformCoordinates(new h.e(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),n);t.cameraDirection=t.cameraDirection.add(r),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},i.prototype.attachControl=function(){this._leftjoystick=new Gc(!0),this._leftjoystick.setAxisForUpDown(Nn.Z),this._leftjoystick.setAxisForLeftRight(Nn.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new Gc(!1),this._rightjoystick.setAxisForUpDown(Nn.X),this._rightjoystick.setAxisForLeftRight(Nn.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},i.prototype.detachControl=function(t){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},i.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},i.prototype.getSimpleName=function(){return"virtualJoystick"},i}();Kn.FreeCameraVirtualJoystickInput=Lo;var Zt=c(28),ai=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l._tmpUpVector=h.e.Zero(),l._tmpTargetVector=h.e.Zero(),l.cameraDirection=new h.e(0,0,0),l.cameraRotation=new h.d(0,0),l.ignoreParentScaling=!1,l.updateUpVectorFromRotation=!1,l._tmpQuaternion=new h.b,l.rotation=new h.e(0,0,0),l.speed=2,l.noRotationConstraint=!1,l.invertRotation=!1,l.inverseRotationSpeed=.2,l.lockedTarget=null,l._currentTarget=h.e.Zero(),l._initialFocalDistance=1,l._viewMatrix=h.a.Zero(),l._camMatrix=h.a.Zero(),l._cameraTransformMatrix=h.a.Zero(),l._cameraRotationMatrix=h.a.Zero(),l._referencePoint=new h.e(0,0,1),l._transformedReferencePoint=h.e.Zero(),l._defaultUp=h.e.Up(),l._cachedRotationZ=0,l._cachedQuaternionRotationZ=0,l}return Object(f.d)(t,i),t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var n=this.getTarget().subtract(this.position);return n.normalize(),n.scaleInPlace(e),this.globalPosition.add(n)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.lockedTarget=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new h.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this);var n=this._getLockedTargetPosition();n?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(n):this._cache.lockedTarget=n.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!i.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=Zt.a),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),h.a.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var n=e.subtract(this.position);n.x>=0?this.rotation.y=-Math.atan(n.z/n.x)+Math.PI/2:this.rotation.y=-Math.atan(n.z/n.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&h.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(t.prototype,"target",{get:function(){return this.getTarget()},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(h.c.Matrix[0]),h.e.TransformNormalToRef(this.cameraDirection,h.c.Matrix[0],h.c.Vector3[0]),void this.position.addInPlace(h.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,n=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;n&&this._updatePosition(),r&&(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint&&(this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796)),this.rotationQuaternion&&this.rotation.lengthSquared()&&h.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)),n&&(Math.abs(this.cameraDirection.x)<this.speed*Zt.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Zt.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Zt.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*Zt.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Zt.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),i.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):h.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return h.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),h.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Te.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(h.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Te.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,n,r){if(this.ignoreParentScaling){if(this.parent){var o=this.parent.getWorldMatrix();h.e.TransformCoordinatesToRef(e,o,this._globalPosition),h.e.TransformCoordinatesToRef(n,o,this._tmpTargetVector),h.e.TransformNormalToRef(r,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(n),this._tmpUpVector.copyFrom(r);this.getScene().useRightHandedSystem?h.a.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):h.a.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else this.getScene().useRightHandedSystem?h.a.LookAtRHToRef(e,n,r,this._viewMatrix):h.a.LookAtLHToRef(e,n,r,this._viewMatrix),this.parent?(o=this.parent.getWorldMatrix(),this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(e)},t.prototype.createRigCamera=function(e,n){if(this.cameraRigMode!==Pt.a.RIG_MODE_NONE){var r=new t(e,this.position.clone(),this.getScene());return r.isRigCamera=!0,r.rigParent=this,this.cameraRigMode!==Pt.a.RIG_MODE_VR&&this.cameraRigMode!==Pt.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new h.b),r._cameraRigParams={},r.rotationQuaternion=new h.b),r}return null},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var r=this.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,n);break;case Pt.a.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),n.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),n.position.copyFrom(this.position)}i.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,n){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var r=t._TargetFocalPoint.addInPlace(this.position);h.a.TranslationToRef(-r.x,-r.y,-r.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(h.a.RotationAxis(n.upVector,e),t._RigCamTransformMatrix),h.a.TranslationToRef(r.x,r.y,r.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),h.e.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,n.position),n.setTarget(r)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new h.a,t._TargetTransformMatrix=new h.a,t._TargetFocalPoint=new h.e,Object(f.c)([Object(B.o)()],t.prototype,"rotation",void 0),Object(f.c)([Object(B.c)()],t.prototype,"speed",void 0),Object(f.c)([Object(B.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Pt.a),Ar=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l.ellipsoid=new h.e(.5,1,.5),l.ellipsoidOffset=new h.e(0,0,0),l.checkCollisions=!1,l.applyGravity=!1,l._needMoveForGravity=!1,l._oldPosition=h.e.Zero(),l._diffPosition=h.e.Zero(),l._newPosition=h.e.Zero(),l._collisionMask=-1,l._onCollisionPositionChange=function(d,v,y){y===void 0&&(y=null);var D;D=v,l._newPosition.copyFrom(D),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>He.a.CollisionsEpsilon&&(l.position.addInPlace(l._diffPosition),l.onCollide&&y&&l.onCollide(y))},l.inputs=new Ea(l),l.inputs.addKeyboard().addMouse(),l}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUpward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUpward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUpward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDownward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDownward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDownward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(e){this.inputs.detachElement(),this.cameraDirection=new h.e(0,0,0),this.cameraRotation=new h.d(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?h.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=h.e.Zero(),this._transformedDirection=h.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},Object(f.c)([Object(B.o)()],t.prototype,"ellipsoid",void 0),Object(f.c)([Object(B.o)()],t.prototype,"ellipsoidOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"checkCollisions",void 0),Object(f.c)([Object(B.c)()],t.prototype,"applyGravity",void 0),t}(ai);$.a.AddNodeConstructor("TouchCamera",function(i,t){return function(){return new Hc(i,h.e.Zero(),t)}});var Hc=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addTouch(),o._setupInputs(),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.touch,n=this.inputs.attached.mouse;n?n.touchEnabled=!1:e.allowMouse=!0},t}(Ar);$.a.AddNodeConstructor("ArcRotateCamera",function(i,t){return function(){return new Fi(i,0,0,1,h.e.Zero(),t)}});var Fi=function(i){function t(e,n,r,o,l,d,v){v===void 0&&(v=!0);var y=i.call(this,e,h.e.Zero(),d,v)||this;return y.inertialAlphaOffset=0,y.inertialBetaOffset=0,y.inertialRadiusOffset=0,y.lowerAlphaLimit=null,y.upperAlphaLimit=null,y.lowerBetaLimit=.01,y.upperBetaLimit=Math.PI-.01,y.lowerRadiusLimit=null,y.upperRadiusLimit=null,y.inertialPanningX=0,y.inertialPanningY=0,y.pinchToPanMaxDistance=20,y.panningDistanceLimit=null,y.panningOriginTarget=h.e.Zero(),y.panningInertia=.9,y.zoomOnFactor=1,y.targetScreenOffset=h.d.Zero(),y.allowUpsideDown=!0,y.useInputToRestoreState=!0,y._viewMatrix=new h.a,y.panningAxis=new h.e(1,1,0),y.onMeshTargetChangedObservable=new S.c,y.checkCollisions=!1,y.collisionRadius=new h.e(.5,.5,.5),y._previousPosition=h.e.Zero(),y._collisionVelocity=h.e.Zero(),y._newPosition=h.e.Zero(),y._computationVector=h.e.Zero(),y._onCollisionPositionChange=function(D,w,F){F===void 0&&(F=null),F?(y.setPosition(w),y.onCollide&&y.onCollide(F)):y._previousPosition.copyFrom(y._position);var z=Math.cos(y.alpha),k=Math.sin(y.alpha),K=Math.cos(y.beta),ae=Math.sin(y.beta);ae===0&&(ae=1e-4);var le=y._getTargetPosition();y._computationVector.copyFromFloats(y.radius*z*ae,y.radius*K,y.radius*k*ae),le.addToRef(y._computationVector,y._newPosition),y._position.copyFrom(y._newPosition);var fe=y.upVector;y.allowUpsideDown&&y.beta<0&&(fe=(fe=fe.clone()).negate()),y._computeViewMatrix(y._position,le,fe),y._viewMatrix.addAtIndex(12,y.targetScreenOffset.x),y._viewMatrix.addAtIndex(13,y.targetScreenOffset.y),y._collisionTriggered=!1},y._target=h.e.Zero(),l&&y.setTarget(l),y.alpha=n,y.beta=r,y.radius=o,y.getViewMatrix(),y.inputs=new is(y),y.inputs.addKeyboard().addMouseWheel().addPointers(),y}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new h.a,this._upToYMatrix=new h.a,this._upVector=h.e.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!1,configurable:!0}),t.prototype.setMatUp=function(){h.a.RotationAlignToRef(h.e.UpReadOnly,this._upVector,this._YToUpMatrix),h.a.RotationAlignToRef(this._upVector,h.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityX=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityY=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var n=this.inputs.attached.pointers;n&&(n.useNaturalPinchZoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.panningSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Vu,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new $i,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Uu,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache._target=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=h.d.Zero()},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var n=this._getLockedTargetPosition();return n||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!i.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(e,n,r,o){var l=this;r===void 0&&(r=!0),o===void 0&&(o=2),n=et.b.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=r,this._panningMouseButton=o,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(n),this._reset=function(){l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.inertialPanningX=0,l.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Zt.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Zt.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Zt.a&&(this.inertialRadiusOffset=0)}(this.inertialPanningX!==0||this.inertialPanningY!==0)&&(this._localDirection||(this._localDirection=h.e.Zero(),this._transformedDirection=h.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),h.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost&&(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),h.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Zt.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Zt.a&&(this.inertialPanningY=0)),this._checkLimits(),i.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||h.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var e=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var n=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,n,r){if(n===void 0&&(n=!1),r===void 0&&(r=!1),e.getBoundingInfo)this._targetBoundingCenter=n?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var o=e,l=this._getTargetPosition();if(l&&!r&&l.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),n=Math.sin(this.alpha),r=Math.cos(this.beta),o=Math.sin(this.beta);o===0&&(o=1e-4),this.radius===0&&(this.radius=1e-4);var l=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*o,this.radius*r,this.radius*n*o),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||h.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),l.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var d=this.getScene().collisionCoordinator;this._collider||(this._collider=d.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,d.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var v=this.upVector;this.allowUpsideDown&&o<0&&(v=v.negate()),this._computeViewMatrix(this._position,l,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=l,this._viewMatrix},t.prototype.zoomOn=function(e,n){n===void 0&&(n=!1),e=e||this.getScene().meshes;var r=Fe.a.MinMax(e),o=h.e.Distance(r.min,r.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:r.min,max:r.max,distance:o},n)},t.prototype.focusOn=function(e,n){var r,o;if(n===void 0&&(n=!1),e.min===void 0){var l=e||this.getScene().meshes;r=Fe.a.MinMax(l),o=h.e.Distance(r.min,r.max)}else r=e,o=e.distance;this._target=Fe.a.Center(r),n||(this.maxZ=2*o)},t.prototype.createRigCamera=function(e,n){var r=0;switch(this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Pt.a.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(n===0?1:-1);break;case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(n===0?-1:1)}var o=new t(e,this.alpha+r,this.beta,this.radius,this._target,this.getScene());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(e.beta=n.beta=this.beta,this.cameraRigMode){case Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Pt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Pt.a.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}i.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},Object(f.c)([Object(B.c)()],t.prototype,"alpha",void 0),Object(f.c)([Object(B.c)()],t.prototype,"beta",void 0),Object(f.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(f.c)([Object(B.o)("target")],t.prototype,"_target",void 0),Object(f.c)([Object(B.c)()],t.prototype,"inertialAlphaOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"inertialBetaOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"inertialRadiusOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerAlphaLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperAlphaLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerBetaLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperBetaLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperRadiusLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"inertialPanningX",void 0),Object(f.c)([Object(B.c)()],t.prototype,"inertialPanningY",void 0),Object(f.c)([Object(B.c)()],t.prototype,"pinchToPanMaxDistance",void 0),Object(f.c)([Object(B.c)()],t.prototype,"panningDistanceLimit",void 0),Object(f.c)([Object(B.o)()],t.prototype,"panningOriginTarget",void 0),Object(f.c)([Object(B.c)()],t.prototype,"panningInertia",void 0),Object(f.c)([Object(B.c)()],t.prototype,"zoomOnFactor",void 0),Object(f.c)([Object(B.c)()],t.prototype,"targetScreenOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"allowUpsideDown",void 0),Object(f.c)([Object(B.c)()],t.prototype,"useInputToRestoreState",void 0),t}(ai);$.a.AddNodeConstructor("DeviceOrientationCamera",function(i,t){return function(){return new No(i,h.e.Zero(),t)}});var No=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o._tmpDragQuaternion=new h.b,o._disablePointerInputWhenUsingDeviceOrientation=!0,o._dragFactor=0,o._quaternionCache=new h.b,o.inputs.addDeviceOrientation(),o.inputs._deviceOrientationInput&&o.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){o._disablePointerInputWhenUsingDeviceOrientation&&o.inputs._mouseInput&&(o.inputs._mouseInput._allowCameraRotation=!1,o.inputs._mouseInput.onPointerMovedObservable.add(function(l){o._dragFactor!=0&&(o._initialQuaternion||(o._initialQuaternion=new h.b),h.b.FromEulerAnglesToRef(0,l.offsetX*o._dragFactor,0,o._tmpDragQuaternion),o._initialQuaternion.multiplyToRef(o._tmpDragQuaternion,o._initialQuaternion))}))}),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(e){this._disablePointerInputWhenUsingDeviceOrientation=e},enumerable:!1,configurable:!0}),t.prototype.enableHorizontalDragging=function(e){e===void 0&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var n=this;e===void 0&&(e=Te.a.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new h.b),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(r){e[r]?n._initialQuaternion[r]*=-1:n._initialQuaternion[r]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(Ar),Wc=function(i){function t(e){return i.call(this,e)||this}return Object(f.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new Bc),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this.add(new wo(e)),this},t}(ya),eo=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l.ellipsoid=new h.e(1,1,1),l.ellipsoidOffset=new h.e(0,0,0),l.checkCollisions=!1,l.applyGravity=!1,l.cameraDirection=h.e.Zero(),l._trackRoll=0,l.rollCorrect=100,l.bankedTurn=!1,l.bankedTurnLimit=Math.PI/2,l.bankedTurnMultiplier=1,l._needMoveForGravity=!1,l._oldPosition=h.e.Zero(),l._diffPosition=h.e.Zero(),l._newPosition=h.e.Zero(),l._collisionMask=-1,l._onCollisionPositionChange=function(d,v,y){y===void 0&&(y=null);var D;D=v,l._newPosition.copyFrom(D),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>He.a.CollisionsEpsilon&&(l.position.addInPlace(l._diffPosition),l.onCollide&&y&&l.onCollide(y))},l.inputs=new Wc(l),l.inputs.addKeyboard().addMouse(),l}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysForward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysBackward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new h.e(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?h.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=h.e.Zero(),this._transformedDirection=h.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var n=this._trackRoll,r=n-this.rotation.z;Math.abs(r)>=.001&&(this.rotation.z+=r/e,Math.abs(n-this.rotation.z)<=.001&&(this.rotation.z=n))},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},Object(f.c)([Object(B.o)()],t.prototype,"ellipsoid",void 0),Object(f.c)([Object(B.o)()],t.prototype,"ellipsoidOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"checkCollisions",void 0),Object(f.c)([Object(B.c)()],t.prototype,"applyGravity",void 0),t}(ai),Fo=function(i){function t(e){return i.call(this,e)||this}return Object(f.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new Ta),this},t.prototype.addMouseWheel=function(){return this.add(new Uc),this},t.prototype.addPointers=function(){return this.add(new Vc),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(ya);$.a.AddNodeConstructor("FollowCamera",function(i,t){return function(){return new Xc(i,h.e.Zero(),t)}}),$.a.AddNodeConstructor("ArcFollowCamera",function(i,t){return function(){return new Wu(i,0,0,1,null,t)}});var qr,Xc=function(i){function t(e,n,r,o){o===void 0&&(o=null);var l=i.call(this,e,n,r)||this;return l.radius=12,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.rotationOffset=0,l.lowerRotationOffsetLimit=null,l.upperRotationOffsetLimit=null,l.heightOffset=4,l.lowerHeightOffsetLimit=null,l.upperHeightOffsetLimit=null,l.cameraAcceleration=.05,l.maxCameraSpeed=20,l.lockedTarget=o,l.inputs=new Fo(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return Object(f.d)(t,i),t.prototype._follow=function(e){if(e){var n;if(e.rotationQuaternion){var r=new h.a;e.rotationQuaternion.toRotationMatrix(r),n=Math.atan2(r.m[8],r.m[10])}else n=e.rotation.y;var o=et.b.ToRadians(this.rotationOffset)+n,l=e.getAbsolutePosition(),d=l.x+Math.sin(o)*this.radius,v=l.z+Math.cos(o)*this.radius,y=d-this.position.x,D=l.y+this.heightOffset-this.position.y,w=v-this.position.z,F=y*this.cameraAcceleration*2,z=D*this.cameraAcceleration,k=w*this.cameraAcceleration*2;(F>this.maxCameraSpeed||F<-this.maxCameraSpeed)&&(F=F<1?-this.maxCameraSpeed:this.maxCameraSpeed),(z>this.maxCameraSpeed||z<-this.maxCameraSpeed)&&(z=z<1?-this.maxCameraSpeed:this.maxCameraSpeed),(k>this.maxCameraSpeed||k<-this.maxCameraSpeed)&&(k=k<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new h.e(this.position.x+F,this.position.y+z,this.position.z+k),this.setTarget(l)}},t.prototype.attachControl=function(e,n){n=et.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n),this._reset=function(){}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),i.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),this.lowerHeightOffsetLimit!==null&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),this.upperHeightOffsetLimit!==null&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),this.lowerRotationOffsetLimit!==null&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),this.upperRotationOffsetLimit!==null&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},Object(f.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperRadiusLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"rotationOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperRotationOffsetLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"heightOffset",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"upperHeightOffsetLimit",void 0),Object(f.c)([Object(B.c)()],t.prototype,"cameraAcceleration",void 0),Object(f.c)([Object(B.c)()],t.prototype,"maxCameraSpeed",void 0),Object(f.c)([Object(B.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(ai),Wu=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,h.e.Zero(),d)||this;return v.alpha=n,v.beta=r,v.radius=o,v._cartesianCoordinates=h.e.Zero(),v._meshTarget=l,v._follow(),v}return Object(f.d)(t,i),t.prototype._follow=function(){if(this._meshTarget){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this._meshTarget.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(ai),ss=c(38),Qn=c(39);(function(i){i[i.VIVE=0]="VIVE",i[i.OCULUS=1]="OCULUS",i[i.WINDOWS=2]="WINDOWS",i[i.GEAR_VR=3]="GEAR_VR",i[i.DAYDREAM=4]="DAYDREAM",i[i.GENERIC=5]="GENERIC"})(qr||(qr={}));var vr,Bi,Ui=function(){function i(){}return i.InitiateController=function(t){for(var e=0,n=this._ControllerFactories;e<n.length;e++){var r=n[e];if(r.canCreate(t))return r.create(t)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(t);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},i._ControllerFactories=[],i._DefaultControllerFactory=null,i}(),we=function(i){function t(e){var n=i.call(this,e.id,e.index,e)||this;return n.isXR=!1,n._deviceRoomPosition=h.e.Zero(),n._deviceRoomRotationQuaternion=new h.b,n.devicePosition=h.e.Zero(),n.deviceRotationQuaternion=new h.b,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new h.b,n._deviceToWorld=h.a.Identity(),n._pointingPoseNode=null,n._workingMatrix=h.a.Identity(),n._meshAttachedObservable=new S.c,n.type=zn.POSE_ENABLED,n.controllerType=qr.GENERIC,n.position=h.e.Zero(),n.rotationQuaternion=new h.b,n._calculatedPosition=h.e.Zero(),n._calculatedRotation=new h.b,h.b.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return Object(f.d)(t,i),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(!this.isXR){var e=this.browserGamepad.pose;if(this.updateFromDevice(e),!this._trackPosition&&re.a.LastCreatedScene&&re.a.LastCreatedScene.activeCamera&&re.a.LastCreatedScene.activeCamera.devicePosition&&((n=re.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(n.devicePosition),n.deviceRotationQuaternion)){var n;(n=n)._deviceRoomRotationQuaternion.toEulerAnglesToRef(h.c.Vector3[0]);var r=Math.atan2(Math.sin(h.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(h.c.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(r)>this._maxRotationDistFromHeadset){var o=r-(r<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=o;var l=Math.sin(-o),d=Math.cos(-o);this._calculatedPosition.x=this._calculatedPosition.x*d-this._calculatedPosition.z*l,this._calculatedPosition.z=this._calculatedPosition.x*l+this._calculatedPosition.z*d}}h.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),h.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},t.prototype.updateFromDevice=function(e){if(!this.isXR&&e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var n=this.rawPose;e.orientation&&n.orientation&&n.orientation.length===4&&(this._deviceRoomRotationQuaternion.copyFromFloats(n.orientation[0],n.orientation[1],-n.orientation[2],-n.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new h.b),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var n=[],r=this._pointingPoseNode;r.parent;)n.push(r.parent),r=r.parent;n.reverse().forEach(function(o){o.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this.mesh)return new Qn.a(h.e.Zero(),new h.e(0,0,1),e);var n=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),r=n.getTranslation(),o=new h.e(0,0,-1),l=h.e.TransformNormal(o,n),d=h.e.Normalize(l);return new Qn.a(r,d,e)},t.POINTING_POSE="POINTING_POSE",t}(zn);(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(vr||(vr={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(Bi||(Bi={}));var Ge,Je,xt=function(i){function t(e,n,r,o){o===void 0&&(o=!1);var l=i.call(this,e,n,r,0,1,2,3)||this;return l._leftTrigger=0,l._rightTrigger=0,l.onButtonDownObservable=new S.c,l.onButtonUpObservable=new S.c,l.onPadDownObservable=new S.c,l.onPadUpObservable=new S.c,l._buttonA=0,l._buttonB=0,l._buttonX=0,l._buttonY=0,l._buttonBack=0,l._buttonStart=0,l._buttonLB=0,l._buttonRB=0,l._buttonLeftStick=0,l._buttonRightStick=0,l._dPadUp=0,l._dPadDown=0,l._dPadLeft=0,l._dPadRight=0,l._isXboxOnePad=!1,l.type=zn.XBOX,l._isXboxOnePad=o,l}return Object(f.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,vr.A)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,vr.B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,vr.X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,vr.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,vr.Start)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,vr.Back)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,vr.LB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,vr.RB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,vr.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,vr.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Bi.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Bi.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Bi.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Bi.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(zn);(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(Ge||(Ge={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(Je||(Je={}));var tn=function(i){function t(e,n,r){var o=i.call(this,e.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),n,r,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new S.c,o.onButtonUpObservable=new S.c,o.onPadDownObservable=new S.c,o.onPadUpObservable=new S.c,o._buttonCross=0,o._buttonCircle=0,o._buttonSquare=0,o._buttonTriangle=0,o._buttonShare=0,o._buttonOptions=0,o._buttonL1=0,o._buttonR1=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o.type=zn.DUALSHOCK,o}return Object(f.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,Ge.Cross)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,Ge.Circle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,Ge.Square)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,Ge.Triangle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,Ge.Options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,Ge.Share)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,Ge.L1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,Ge.R1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,Ge.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,Ge.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Je.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Je.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Je.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Je.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(zn),gn=function(){function i(t){var e=this;if(this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new S.c,ss.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new S.c(function(r){for(var o in e._babylonGamepads){var l=e._babylonGamepads[o];l&&l._isConnected&&e.onGamepadConnectedObservable.notifyObserver(r,l)}}),this._onGamepadConnectedEvent=function(r){var o,l=r.gamepad;l.index in e._babylonGamepads&&e._babylonGamepads[l.index].isConnected||(e._babylonGamepads[l.index]?((o=e._babylonGamepads[l.index]).browserGamepad=l,o._isConnected=!0):o=e._addNewGamepad(l),e.onGamepadConnectedObservable.notifyObservers(o),e._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(r){var o=r.gamepad;for(var l in e._babylonGamepads)if(e._babylonGamepads[l].index===o.index){var d=e._babylonGamepads[l];d._isConnected=!1,e.onGamepadDisconnectedObservable.notifyObservers(d),d.dispose&&d.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var n=this._scene?this._scene.getEngine().getHostWindow():window;n&&(n.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),n.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(i.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0}),i.prototype.getGamepadByType=function(t){t===void 0&&(t=zn.XBOX);for(var e=0,n=this._babylonGamepads;e<n.length;e++){var r=n[e];if(r&&r.type===t)return r}return null},i.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(t){t.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},i.prototype._addNewGamepad=function(t){var e;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=t.id.search("054c")!==-1,r=t.id.search("Xbox One")!==-1;return e=r||t.id.search("Xbox 360")!==-1||t.id.search("xinput")!==-1?new xt(t.id,t.index,t,r):n?new tn(t.id,t.index,t):t.pose?Ui.InitiateController(t):new zu(t.id,t.index,t),this._babylonGamepads[e.index]=e,e},i.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},i.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},i.prototype._checkGamepadsStatus=function(){var t=this;for(var e in this._updateGamepadObjects(),this._babylonGamepads){var n=this._babylonGamepads[e];n&&n.isConnected&&n.update()}this._isMonitoring&&!this._scene&&He.a.QueueNewFrame(function(){t._checkGamepadsStatus()})},i.prototype._updateGamepadObjects=function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++){var n=t[e];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[e].browserGamepad=n,this._babylonGamepads[e].isConnected||(this._babylonGamepads[e]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[e]));else{var r=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(r)}}},i}();Object.defineProperty(ne.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new gn(this);var i=this._getComponent(dt.a.NAME_GAMEPAD);i||(i=new Mn(this),this._addComponent(i))}return this._gamepadManager},enumerable:!0,configurable:!0}),Ea.prototype.addGamepad=function(){return this.add(new Sa),this},is.prototype.addGamepad=function(){return this.add(new Dc),this};var Mn=function(){function i(t){this.name=dt.a.NAME_GAMEPAD,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(dt.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){var t=this.scene._gamepadManager;t&&(t.dispose(),this.scene._gamepadManager=null)},i.prototype._beforeCameraUpdate=function(){var t=this.scene._gamepadManager;t&&t._isMonitoring&&t._checkGamepadsStatus()},i}();$.a.AddNodeConstructor("FreeCamera",function(i,t){return function(){return new Xt(i,h.e.Zero(),t)}});var Xt=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addGamepad(),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Hc);Pt.a._createDefaultParsedCamera=function(i,t){return new Xt(i,h.e.Zero(),t)},$.a.AddNodeConstructor("GamepadCamera",function(i,t){return function(){return new Tn(i,h.e.Zero(),t)}});var Tn=function(i){function t(e,n,r){return i.call(this,e,n,r)||this}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"GamepadCamera"},t}(Xt),Gn=c(33),Qe=c(5),xa=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.postprocessVertexShader=xa;var cs=c(102);en.a.prototype.createRenderTargetTexture=function(i,t){var e=new cs.a;t!==void 0&&typeof t=="object"?(e.generateMipMaps=t.generateMipMaps,e.generateDepthBuffer=!!t.generateDepthBuffer,e.generateStencilBuffer=!!t.generateStencilBuffer,e.type=t.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:t.type,e.samplingMode=t.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,e.format=t.format===void 0?g.a.TEXTUREFORMAT_RGBA:t.format):(e.generateMipMaps=t,e.generateDepthBuffer=!0,e.generateStencilBuffer=!1,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,e.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.format=g.a.TEXTUREFORMAT_RGBA),(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE),e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var n=this._gl,r=new Nt.a(this,Nt.b.RenderTarget),o=i.width||i,l=i.height||i,d=i.layers||0,v=this._getSamplingParameters(e.samplingMode,!!e.generateMipMaps),y=d!==0?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D,D=this._getRGBABufferInternalSizedFormat(e.type,e.format),w=this._getInternalFormat(e.format),F=this._getWebGLTextureType(e.type);this._bindTextureDirectly(y,r),d!==0?(r.is2DArray=!0,n.texImage3D(y,0,D,o,l,d,0,w,F,null)):n.texImage2D(y,0,D,o,l,0,w,F,null),n.texParameteri(y,n.TEXTURE_MAG_FILTER,v.mag),n.texParameteri(y,n.TEXTURE_MIN_FILTER,v.min),n.texParameteri(y,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(y,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.generateMipMaps&&this._gl.generateMipmap(y),this._bindTextureDirectly(y,null);var z=this._currentFramebuffer,k=n.createFramebuffer();return this._bindUnboundFramebuffer(k),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!e.generateStencilBuffer,e.generateDepthBuffer,o,l),r.is2DArray||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r._webGLTexture,0),this._bindUnboundFramebuffer(z),r._framebuffer=k,r.baseWidth=o,r.baseHeight=l,r.width=o,r.height=l,r.depth=d,r.isReady=!0,r.samples=1,r.generateMipMaps=!!e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=!!e.generateStencilBuffer,this._internalTexturesCache.push(r),r},en.a.prototype.createDepthStencilTexture=function(i,t){if(t.isCube){var e=i.width||i;return this._createDepthStencilCubeTexture(e,t)}return this._createDepthStencilTexture(i,t)},en.a.prototype._createDepthStencilTexture=function(i,t){var e=this._gl,n=i.layers||0,r=n!==0?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,o=new Nt.a(this,Nt.b.Depth);if(!this._caps.depthTextureExtension)return _.a.Error("Depth texture is not supported by your browser or hardware."),o;var l=Object(f.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(r,o,!0),this._setupDepthStencilTexture(o,i,l.generateStencil,l.bilinearFiltering,l.comparisonFunction);var d=l.generateStencil?e.UNSIGNED_INT_24_8:e.UNSIGNED_INT,v=l.generateStencil?e.DEPTH_STENCIL:e.DEPTH_COMPONENT,y=v;return this.webGLVersion>1&&(y=l.generateStencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24),o.is2DArray?e.texImage3D(r,0,y,o.width,o.height,n,0,v,d,null):e.texImage2D(r,0,y,o.width,o.height,0,v,d,null),this._bindTextureDirectly(r,null),o};var St=function(){function i(t,e,n,r,o,l,d,v,y,D,w,F,z,k,K){d===void 0&&(d=g.a.TEXTURE_NEAREST_SAMPLINGMODE),D===void 0&&(D=null),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F="postprocess"),k===void 0&&(k=!1),K===void 0&&(K=g.a.TEXTUREFORMAT_RGBA),this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=g.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=g.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new Gn.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new h.d(1,1),this._texelSize=h.d.Zero(),this.onActivateObservable=new S.c,this.onSizeChangedObservable=new S.c,this.onApplyObservable=new S.c,this.onBeforeRenderObservable=new S.c,this.onAfterRenderObservable=new S.c,this.name=t,l!=null?(this._camera=l,this._scene=l.getScene(),l.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):v&&(this._engine=v,this._engine.postProcesses.push(this)),this._options=o,this.renderTargetSamplingMode=d||g.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=y||!1,this._textureType=w,this._textureFormat=K,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=e,this._vertexUrl=F,this._parameters=n||[],this._parameters.push("scale"),this._indexParameters=z,k||this.updateEffect(D)}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(t){var e=this;this._samples=Math.min(t,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(n){n.samples!==e._samples&&e._engine.updateRenderTargetTextureSampleCount(n,e._samples)})},enumerable:!1,configurable:!0}),i.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(i.prototype,"onActivate",{set:function(t){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),t&&(this._onActivateObserver=this.onActivateObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSizeChanged",{set:function(t){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onApply",{set:function(t){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(t){this._forcedOutputTexture=t},enumerable:!1,configurable:!0}),i.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture=null},i.prototype.getCamera=function(){return this._camera},Object.defineProperty(i.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcess"},i.prototype.getEngine=function(){return this._engine},i.prototype.getEffect=function(){return this._effect},i.prototype.shareOutputWith=function(t){return this._disposeTextures(),this._shareOutputWithPostProcess=t,this},i.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new Gn.a(2)),this._shareOutputWithPostProcess=null},i.prototype.updateEffect=function(t,e,n,r,o,l,d,v){t===void 0&&(t=null),e===void 0&&(e=null),n===void 0&&(n=null),this._effect=this._engine.createEffect({vertex:d??this._vertexUrl,fragment:v??this._fragmentUrl},["position"],e||this._parameters,n||this._samplers,t!==null?t:"",void 0,o,l,r||this._indexParameters)},i.prototype.isReusable=function(){return this._reusable},i.prototype.markTextureDirty=function(){this.width=-1},i.prototype.activate=function(t,e,n){var r=this;e===void 0&&(e=null);var o=(t=t||this._camera).getScene(),l=o.getEngine(),d=l.getCaps().maxTextureSize,v=(e?e.width:this._engine.getRenderWidth(!0))*this._options|0,y=(e?e.height:this._engine.getRenderHeight(!0))*this._options|0,D=t.parent;!D||D.leftCamera!=t&&D.rightCamera!=t||(v/=2);var w,F=this._options.width||v,z=this._options.height||y,k=this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==g.a.TEXTURE_LINEAR_LINEAR;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var K=l.currentViewport;K&&(F*=K.width,z*=K.height)}if((k||this.alwaysForcePOT)&&(this._options.width||(F=l.needPOTTextures?He.a.GetExponentOfTwo(F,d,this.scaleMode):F),this._options.height||(z=l.needPOTTextures?He.a.GetExponentOfTwo(z,d,this.scaleMode):z)),this.width!==F||this.height!==z){if(this._textures.length>0){for(var ae=0;ae<this._textures.length;ae++)this._engine._releaseTexture(this._textures.data[ae]);this._textures.reset()}this.width=F,this.height=z;var le={width:this.width,height:this.height},fe={generateMipMaps:k,generateDepthBuffer:n||t._postProcesses.indexOf(this)===0,generateStencilBuffer:(n||t._postProcesses.indexOf(this)===0)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(le,fe)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(le,fe)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(me){me.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(me,r.samples)})}return this._shareOutputWithPostProcess?w=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(w=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):w=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(v/F,y/z),this._engine.bindFramebuffer(w,0,v,y,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(w,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===g.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),w},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),i.prototype.isReady=function(){return this._effect&&this._effect.isReady()},i.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",t),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var t},i.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.dispose()}},i.prototype.setPrePassRenderer=function(t){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=t.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},i.prototype.dispose=function(t){var e;if(t=t||this._camera,this._disposeTextures(),this._scene&&(e=this._scene.postProcesses.indexOf(this))!==-1&&this._scene.postProcesses.splice(e,1),(e=this._engine.postProcesses.indexOf(this))!==-1&&this._engine.postProcesses.splice(e,1),t){if(t.detachPostProcess(this),(e=t._postProcesses.indexOf(this))===0&&t._postProcesses.length>0){var n=this._camera._getFirstPostProcess();n&&n.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},i.prototype.serialize=function(){var t=B.a.Serialize(this);return t.customType="BABYLON."+this.getClassName(),t.cameraId=this.getCamera().id,t.reusable=this._reusable,t.options=this._options,t.textureType=this._textureType,t},i.Parse=function(t,e,n){var r=R.a.GetClass(t.customType);if(!r||!r._Parse)return null;var o=e.getCameraByID(t.cameraId);return o?r._Parse(t,o,e,n):null},Object(f.c)([Object(B.c)()],i.prototype,"uniqueId",void 0),Object(f.c)([Object(B.c)()],i.prototype,"name",void 0),Object(f.c)([Object(B.c)()],i.prototype,"width",void 0),Object(f.c)([Object(B.c)()],i.prototype,"height",void 0),Object(f.c)([Object(B.c)()],i.prototype,"renderTargetSamplingMode",void 0),Object(f.c)([Object(B.f)()],i.prototype,"clearColor",void 0),Object(f.c)([Object(B.c)()],i.prototype,"autoClear",void 0),Object(f.c)([Object(B.c)()],i.prototype,"alphaMode",void 0),Object(f.c)([Object(B.c)()],i.prototype,"alphaConstants",void 0),Object(f.c)([Object(B.c)()],i.prototype,"enablePixelPerfectMode",void 0),Object(f.c)([Object(B.c)()],i.prototype,"forceFullscreenViewport",void 0),Object(f.c)([Object(B.c)()],i.prototype,"scaleMode",void 0),Object(f.c)([Object(B.c)()],i.prototype,"alwaysForcePOT",void 0),Object(f.c)([Object(B.c)("samples")],i.prototype,"_samples",void 0),Object(f.c)([Object(B.c)()],i.prototype,"adaptScaleToCurrentViewport",void 0),i}();R.a.RegisteredTypes["BABYLON.PostProcess"]=St;var Xu=`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
}`;Qe.a.ShadersStore.passPixelShader=Xu;var $1=`
varying vec2 vUV;
uniform samplerCube textureSampler;
void main(void)
{
vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;Qe.a.ShadersStore.passCubePixelShader=$1;var Bo=function(i){function t(e,n,r,o,l,d,v,y){return r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1),i.call(this,e,"pass",null,null,n,r,o,l,d,void 0,v,void 0,null,y)||this}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PassPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);R.a.RegisteredTypes["BABYLON.PassPostProcess"]=Bo;var J1=function(i){function t(e,n,r,o,l,d,v,y){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"passCube",null,null,n,r,o,l,d,"#define POSITIVEX",v,void 0,null,y)||this;return D._face=0,D}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PassCubePostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);He.a._RescalePostProcessFactory=function(i){return new Bo("rescale",1,null,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,i,!1,g.a.TEXTURETYPE_UNSIGNED_INT)};var eI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`;Qe.a.ShadersStore.anaglyphPixelShader=eI;var bp=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,"anaglyph",null,["leftSampler"],n,r[1],o,l,d)||this;return v._passedProcess=r[0]._rigPostProcess,v.onApplyObservable.add(function(y){y.setTextureFromPostProcess("leftSampler",v._passedProcess)}),v}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphPostProcess"},t}(St);R.a.RegisteredTypes["BABYLON.AnaglyphPostProcess"]=bp,Pt.a._setStereoscopicAnaglyphRigMode=function(i){i._rigCameras[0]._rigPostProcess=new Bo(i.name+"_passthru",1,i._rigCameras[0]),i._rigCameras[1]._rigPostProcess=new bp(i.name+"_anaglyph",1,i._rigCameras)},$.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(i,t,e){return function(){return new oy(i,0,0,1,h.e.Zero(),e.interaxial_distance,t)}});var oy=function(i){function t(e,n,r,o,l,d,v){var y=i.call(this,e,n,r,o,l,v)||this;return y.interaxialDistance=d,y.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d}),y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(Fi);$.a.AddNodeConstructor("AnaglyphFreeCamera",function(i,t,e){return function(){return new ay(i,h.e.Zero(),e.interaxial_distance,t)}});var ay=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(Ar);$.a.AddNodeConstructor("AnaglyphGamepadCamera",function(i,t,e){return function(){return new sy(i,h.e.Zero(),e.interaxial_distance,t)}});var sy=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(Tn);$.a.AddNodeConstructor("AnaglyphUniversalCamera",function(i,t,e){return function(){return new cy(i,h.e.Zero(),e.interaxial_distance,t)}});var cy=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Pt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(Xt),si=c(58);Pt.a._setStereoscopicRigMode=function(i){var t=i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,e=i.cameraRigMode===Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;i._rigCameras[e?1:0].viewport=new si.a(0,0,t?.5:1,t?1:.5),i._rigCameras[e?0:1].viewport=new si.a(t?.5:0,t?0:.5,t?.5:1,t?1:.5)},$.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(i,t,e){return function(){return new ly(i,0,0,1,h.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var ly=function(i){function t(e,n,r,o,l,d,v,y){var D=i.call(this,e,n,r,o,l,y)||this;return D.interaxialDistance=d,D.isStereoscopicSideBySide=v,D.setCameraRigMode(v?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d}),D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(Fi);$.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new uy(i,h.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var uy=function(i){function t(e,n,r,o,l){var d=i.call(this,e,n,l)||this;return d.interaxialDistance=r,d.isStereoscopicSideBySide=o,d.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(Ar);$.a.AddNodeConstructor("StereoscopicGamepadCamera",function(i,t,e){return function(){return new hy(i,h.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var hy=function(i){function t(e,n,r,o,l){var d=i.call(this,e,n,l)||this;return d.interaxialDistance=r,d.isStereoscopicSideBySide=o,d.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(Tn);$.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new dy(i,h.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var dy=function(i){function t(e,n,r,o,l){var d=i.call(this,e,n,l)||this;return d.interaxialDistance=r,d.isStereoscopicSideBySide=o,d.setCameraRigMode(o?Pt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Pt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(Xt);$.a.AddNodeConstructor("VirtualJoysticksCamera",function(i,t){return function(){return new fy(i,h.e.Zero(),t)}});var fy=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addVirtualJoystick(),o}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(Ar),ls=function(){function i(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return h.a.Translation(t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return h.a.Translation(-t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftPreViewMatrix",{get:function(){return h.a.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightPreViewMatrix",{get:function(){return h.a.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),i.GetDefault=function(){var t=new i;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},i}(),tI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn;
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`;Qe.a.ShadersStore.vrDistortionCorrectionPixelShader=tI;var yp=function(i){function t(e,n,r,o){var l=i.call(this,e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,n,ke.a.BILINEAR_SAMPLINGMODE)||this;return l._isRightEye=r,l._distortionFactors=o.distortionK,l._postProcessScaleFactor=o.postProcessScaleFactor,l._lensCenterOffset=o.lensCenterOffset,l.adaptScaleToCurrentViewport=!0,l.onSizeChangedObservable.add(function(){l._scaleIn=new h.d(2,2/l.aspectRatio),l._scaleFactor=new h.d(1/l._postProcessScaleFactor*.5,1/l._postProcessScaleFactor*.5*l.aspectRatio),l._lensCenter=new h.d(l._isRightEye?.5-.5*l._lensCenterOffset:.5+.5*l._lensCenterOffset,.5)}),l.onApplyObservable.add(function(d){d.setFloat2("LensCenter",l._lensCenter.x,l._lensCenter.y),d.setFloat2("Scale",l._scaleFactor.x,l._scaleFactor.y),d.setFloat2("ScaleIn",l._scaleIn.x,l._scaleIn.y),d.setFloat4("HmdWarpParam",l._distortionFactors[0],l._distortionFactors[1],l._distortionFactors[2],l._distortionFactors[3])}),l}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VRDistortionCorrectionPostProcess"},t}(St),nI=`precision mediump sampler2DArray;
varying vec2 vUV;
uniform sampler2DArray multiviewSampler;
uniform int imageIndex;
void main(void)
{
gl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));
}`;Qe.a.ShadersStore.vrMultiviewToSingleviewPixelShader=nI;var py=c(85),Tp=c(95),Yc=c(96);en.a.prototype.createRenderTargetCubeTexture=function(i,t){var e=Object(f.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:g.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,format:g.a.TEXTUREFORMAT_RGBA},t);e.generateStencilBuffer=e.generateDepthBuffer&&e.generateStencilBuffer,(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,r=new Nt.a(this,Nt.b.RenderTarget);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,r,!0);var o=this._getSamplingParameters(e.samplingMode,e.generateMipMaps);e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,o.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,o.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(var l=0;l<6;l++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this._getRGBABufferInternalSizedFormat(e.type,e.format),i,i,0,this._getInternalFormat(e.format),this._getWebGLTextureType(e.type),null);var d=n.createFramebuffer();return this._bindUnboundFramebuffer(d),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(e.generateStencilBuffer,e.generateDepthBuffer,i,i),e.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),r._framebuffer=d,r.width=i,r.height=i,r.isReady=!0,r.isCube=!0,r.samples=1,r.generateMipMaps=e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=e.generateStencilBuffer,this._internalTexturesCache.push(r),r};var qn=function(i){function t(e,n,r,o,l,d,v,y,D,w,F,z,k){l===void 0&&(l=!0),d===void 0&&(d=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=!1),y===void 0&&(y=ke.a.TRILINEAR_SAMPLINGMODE),D===void 0&&(D=!0),w===void 0&&(w=!1),F===void 0&&(F=!1),z===void 0&&(z=g.a.TEXTUREFORMAT_RGBA),k===void 0&&(k=!1);var K=i.call(this,null,r,!o)||this;return K.renderParticles=!0,K.renderSprites=!1,K.ignoreCameraViewport=!1,K.onBeforeBindObservable=new S.c,K.onAfterUnbindObservable=new S.c,K.onBeforeRenderObservable=new S.c,K.onAfterRenderObservable=new S.c,K.onClearObservable=new S.c,K.onResizeObservable=new S.c,K._currentRefreshId=-1,K._refreshRate=1,K._samples=1,K.boundingBoxPosition=h.e.Zero(),(r=K.getScene())&&(K._coordinatesMode=ke.a.PROJECTION_MODE,K.renderList=new Array,K.name=e,K.isRenderTarget=!0,K._initialSizeParameter=n,K._processSizeParameter(n),K._resizeObserver=K.getScene().getEngine().onResizeObservable.add(function(){}),K._generateMipMaps=!!o,K._doNotChangeAspectRatio=l,K._renderingManager=new Yc.b(r),K._renderingManager._useSceneAutoClearSetup=!0,F||(K._renderTargetOptions={generateMipMaps:o,type:d,format:z,samplingMode:y,generateDepthBuffer:D,generateStencilBuffer:w},y===ke.a.NEAREST_SAMPLINGMODE&&(K.wrapU=ke.a.CLAMP_ADDRESSMODE,K.wrapV=ke.a.CLAMP_ADDRESSMODE),k||(v?(K._texture=r.getEngine().createRenderTargetCubeTexture(K.getRenderSize(),K._renderTargetOptions),K.coordinatesMode=ke.a.INVCUBIC_MODE,K._textureMatrix=h.a.Identity()):K._texture=r.getEngine().createRenderTargetTexture(K._size,K._renderTargetOptions)))),K}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),t.prototype._hookArray=function(e){var n=this,r=e.push;e.push=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var v=e.length===0,y=r.apply(e,l);return v&&n.getScene()&&n.getScene().meshes.forEach(function(D){D._markSubMeshesAsLightDirty()}),y};var o=e.splice;e.splice=function(l,d){var v=o.apply(e,[l,d]);return e.length===0&&n.getScene().meshes.forEach(function(y){y._markSubMeshesAsLightDirty()}),v}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var e;return((e=this.getInternalTexture())===null||e===void 0?void 0:e._depthStencilTexture)||null},enumerable:!1,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,n,r){e===void 0&&(e=0),n===void 0&&(n=!0),r===void 0&&(r=!1);var o=this.getInternalTexture();if(this.getScene()&&o){var l=this.getScene().getEngine();o._depthStencilTexture=l.createDepthStencilTexture(this._size,{bilinearFiltering:n,comparisonFunction:e,generateStencil:r,isCube:this.isCube})}},t.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var n=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(n.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(n.getRenderHeight(),this._sizeRatio)}}else this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var n=this.getScene();n&&(this._samples=n.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!1,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var n=this.getScene();if(!n)return;this._postProcessManager=new Tp.a(n),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(e===void 0&&(e=!1),this._postProcesses){if(e)for(var n=0,r=this._postProcesses;n<r.length;n++)r[n].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var n=this._postProcesses.indexOf(e);n!==-1&&(this._postProcesses.splice(n,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.scale=function(e){var n=Math.max(1,this.getRenderSize()*e);this.resize(n)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:i.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var n=this.isCube;this.releaseInternalTexture();var r=this.getScene();r&&(this._processSizeParameter(e),this._texture=n?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(e,n){if(e===void 0&&(e=!1),n===void 0&&(n=!1),y=this.getScene()){var r,o=y.getEngine();if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var l=0;l<this._waitingRenderList.length;l++){var d=this._waitingRenderList[l],v=y.getMeshByID(d);v&&this.renderList.push(v)}this._waitingRenderList=void 0}if(this.renderListPredicate){var y;if(this.renderList?this.renderList.length=0:this.renderList=[],!(y=this.getScene()))return;var D=y.meshes;for(l=0;l<D.length;l++){var w=D[l];this.renderListPredicate(w)&&this.renderList.push(w)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,o.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==y.activeCamera&&y.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=y.activeCamera)&&o.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var F=0;F<this.getRenderLayers();F++)this.renderToTarget(0,e,n,F,r),y.incrementRenderId(),y.resetCachedMaterial();else if(this.isCube)for(var z=0;z<6;z++)this.renderToTarget(z,e,n,void 0,r),y.incrementRenderId(),y.resetCachedMaterial();else this.renderToTarget(0,e,n,void 0,r);this.onAfterUnbindObservable.notifyObservers(this),y.activeCamera&&((y.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==y.activeCamera)&&y.setTransformMatrix(y.activeCamera.getViewMatrix(),y.activeCamera.getProjectionMatrix(!0)),o.setViewport(y.activeCamera.viewport)),y.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,n){var r=e*n,o=He.a.NearestPOT(r+16384/(128+r));return Math.min(He.a.FloorPOT(e),o)},t.prototype._prepareRenderingManager=function(e,n,r,o){var l=this.getScene();if(l){this._renderingManager.reset();for(var d=l.getRenderId(),v=0;v<n;v++){var y=e[v];if(y&&!y.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(y,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!y.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!y._internalAbstractMeshDataInfo._currentLODIsUpToDate&&l.activeCamera&&(y._internalAbstractMeshDataInfo._currentLOD=l.customLODSelector?l.customLODSelector(y,l.activeCamera):y.getLOD(l.activeCamera),y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!y._internalAbstractMeshDataInfo._currentLOD)continue;var D=y._internalAbstractMeshDataInfo._currentLOD;D._preActivateForIntermediateRendering(d);var w=void 0;if(w=!(!o||!r)&&(y.layerMask&r.layerMask)==0,y.isEnabled()&&y.isVisible&&y.subMeshes&&!w&&(D!==y&&D._activate(d,!0),y._activate(d,!0)&&y.subMeshes.length)){y.isAnInstance?y._internalAbstractMeshDataInfo._actAsRegularMesh&&(D=y):D._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,D._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var F=0;F<D.subMeshes.length;F++){var z=D.subMeshes[F];this._renderingManager.dispatch(z,D)}}}}for(var k=0;k<l.particleSystems.length;k++){var K=l.particleSystems[k],ae=K.emitter;K.isStarted()&&ae&&ae.position&&ae.isEnabled()&&e.indexOf(ae)>=0&&this._renderingManager.dispatchParticles(K)}}},t.prototype._bindFrameBuffer=function(e,n){e===void 0&&(e=0),n===void 0&&(n=0);var r=this.getScene();if(r){var o=r.getEngine();this._texture&&o.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,n)}},t.prototype.unbindFrameBuffer=function(e,n){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.renderToTarget=function(e,n,r,o,l){o===void 0&&(o=0),l===void 0&&(l=null);var d=this.getScene();if(d){var v=d.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&d.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e,o),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(o):this.onBeforeRenderObservable.notifyObservers(e);var y=null,D=this.renderList?this.renderList:d.getActiveMeshes().data,w=this.renderList?this.renderList.length:d.getActiveMeshes().length;this.getCustomRenderList&&(y=this.getCustomRenderList(this.is2DArray?o:e,D,w)),y?this._prepareRenderingManager(y,y.length,l,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(D,w,l,!this.renderList),this._defaultRenderListPrepared=!0),y=D),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(v):v.clear(this.clearColor||d.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0);for(var F=0,z=d._beforeRenderTargetDrawStage;F<z.length;F++)z[F].action(this);this._renderingManager.render(this.customRenderFunction,y,this.renderParticles,this.renderSprites);for(var k=0,K=d._afterRenderTargetDrawStage;k<K.length;k++)K[k].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):n&&d.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0),r&&et.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),v),this.isCube&&e!==5?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&e===5&&v.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(v,e))}}},t.prototype.setRenderingOrder=function(e,n,r,o){n===void 0&&(n=null),r===void 0&&(r=null),o===void 0&&(o=null),this._renderingManager.setRenderingOrder(e,n,r,o)},t.prototype.setRenderingAutoClearDepthStencil=function(e,n){this._renderingManager.setRenderingAutoClearDepthStencil(e,n),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,this.renderList&&(n.renderList=this.renderList.slice(0)),n},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var n=0;n<this.renderList.length;n++)e.renderList.push(this.renderList[n].id);return e},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),n=this.getScene();e&&n&&n.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var n=e.customRenderTargets.indexOf(this);n>=0&&e.customRenderTargets.splice(n,1);for(var r=0,o=e.cameras;r<o.length;r++){var l=o[r];(n=l.customRenderTargets.indexOf(this))>=0&&l.customRenderTargets.splice(n,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),i.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(ke.a);ke.a._CreateRenderTargetTexture=function(i,t,e,n){return new qn(i,t,e,n)};var my=function(i){function t(e,n){n===void 0&&(n=512);var r=i.call(this,"multiview rtt",n,e,!1,!0,Nt.b.Unknown,!1,void 0,!1,!1,!0,void 0,!0)||this,o=e.getEngine().createMultiviewRenderTargetTexture(r.getRenderWidth(),r.getRenderHeight());return o.isMultiview=!0,o.format=g.a.TEXTUREFORMAT_RGBA,r._texture=o,r.samples=r._getEngine().getCaps().maxSamples||r.samples,r}return Object(f.d)(t,i),t.prototype._bindFrameBuffer=function(e){this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(qn),_y=c(90);He.a.prototype.createMultiviewRenderTargetTexture=function(i,t){var e=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var n=new Nt.a(this,Nt.b.Unknown,!0);return n.width=i,n.height=t,n._framebuffer=e.createFramebuffer(),n._colorTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._colorTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.RGBA8,i,t,2),n._depthStencilTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._depthStencilTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.DEPTH32F_STENCIL8,i,t,2),n.isReady=!0,n},He.a.prototype.bindMultiviewFramebuffer=function(i){var t=this._gl,e=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(i,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i._framebuffer),!i._colorTextureArray||!i._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,i.samples,0,2),e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,i.samples,0,2)):(e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,0,2),e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,0,2))},Pt.a.prototype._useMultiviewToSingleView=!1,Pt.a.prototype._multiviewTexture=null,Pt.a.prototype._resizeOrCreateMultiviewTexture=function(i,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==i&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new my(this.getScene(),{width:i,height:t})):this._multiviewTexture=new my(this.getScene(),{width:i,height:t})},ne.a.prototype._transformMatrixR=h.a.Zero(),ne.a.prototype._multiviewSceneUbo=null,ne.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new py.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},ne.a.prototype._updateMultiviewUbo=function(i,t){i&&t&&i.multiplyToRef(t,this._transformMatrixR),i&&t&&(i.multiplyToRef(t,h.c.Matrix[0]),_y.a.GetRightPlaneToRef(h.c.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},ne.a.prototype._renderMultiviewToSingleView=function(i){i._resizeOrCreateMultiviewTexture(i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.width>0?i._rigPostProcess.width:this.getEngine().getRenderWidth(!0),i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.height>0?i._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),i.outputRenderTarget=i._multiviewTexture,this._renderForCamera(i),i.outputRenderTarget=null;for(var t=0;t<i._rigCameras.length;t++){var e=this.getEngine();this._activeCamera=i._rigCameras[t],e.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var Ep=function(i){function t(e,n,r){var o=i.call(this,e,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],r,n,ke.a.BILINEAR_SAMPLINGMODE)||this;return o.onSizeChangedObservable.add(function(){}),o.onApplyObservable.add(function(l){n._scene.activeCamera&&n._scene.activeCamera.isLeftCamera?l.setInt("imageIndex",0):l.setInt("imageIndex",1),l.setTexture("multiviewSampler",n._multiviewTexture)}),o}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VRMultiviewToSingleviewPostProcess"},t}(St);Pt.a._setVRRigMode=function(i,t){var e=t.vrCameraMetrics||ls.GetDefault();i._rigCameras[0]._cameraRigParams.vrMetrics=e,i._rigCameras[0].viewport=new si.a(0,0,.5,1),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new h.a,i._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,i._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,i._rigCameras[0].getProjectionMatrix=i._rigCameras[0]._getVRProjectionMatrix,i._rigCameras[1]._cameraRigParams.vrMetrics=e,i._rigCameras[1].viewport=new si.a(.5,0,.5,1),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new h.a,i._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,i._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,i._rigCameras[1].getProjectionMatrix=i._rigCameras[1]._getVRProjectionMatrix,e.multiviewEnabled&&(i.getScene().getEngine().getCaps().multiview?(i._useMultiviewToSingleView=!0,i._rigPostProcess=new Ep("VRMultiviewToSingleview",i,e.postProcessScaleFactor)):(_.a.Warn("Multiview is not supported, falling back to standard rendering"),e.multiviewEnabled=!1)),e.compensateDistortion&&(i._rigCameras[0]._rigPostProcess=new yp("VR_Distort_Compensation_Left",i._rigCameras[0],!1,e),i._rigCameras[1]._rigPostProcess=new yp("VR_Distort_Compensation_Right",i._rigCameras[1],!0,e))},$.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new gy(i,0,0,1,h.e.Zero(),t)}});var gy=function(i){function t(e,n,r,o,l,d,v,y){v===void 0&&(v=!0),y===void 0&&(y=ls.GetDefault());var D=i.call(this,e,n,r,o,l,d)||this;return y.compensateDistortion=v,D.setCameraRigMode(Pt.a.RIG_MODE_VR,{vrCameraMetrics:y}),D.inputs.addVRDeviceOrientation(),D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(Fi);$.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new Yu(i,h.e.Zero(),t)}});var Yu=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=ls.GetDefault());var d=i.call(this,e,n,r)||this;return l.compensateDistortion=o,d.setCameraRigMode(Pt.a.RIG_MODE_VR,{vrCameraMetrics:l}),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(No);$.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(i,t){return function(){return new vy(i,h.e.Zero(),t)}});var vy=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=ls.GetDefault());var d=i.call(this,e,n,r,o,l)||this;return d.inputs.addGamepad(),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(Yu),Ku=c(86);Pt.a._setWebVRRigMode=function(i,t){if(t.vrDisplay){var e=t.vrDisplay.getEyeParameters("left"),n=t.vrDisplay.getEyeParameters("right");i._rigCameras[0].viewport=new si.a(0,0,.5,1),i._rigCameras[0].setCameraRigParameter("left",!0),i._rigCameras[0].setCameraRigParameter("specs",t.specs),i._rigCameras[0].setCameraRigParameter("eyeParameters",e),i._rigCameras[0].setCameraRigParameter("frameData",t.frameData),i._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new h.a,i._rigCameras[0].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[0].parent=i,i._rigCameras[0]._getViewMatrix=i._getWebVRViewMatrix,i._rigCameras[1].viewport=new si.a(.5,0,.5,1),i._rigCameras[1].setCameraRigParameter("eyeParameters",n),i._rigCameras[1].setCameraRigParameter("specs",t.specs),i._rigCameras[1].setCameraRigParameter("frameData",t.frameData),i._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new h.a,i._rigCameras[1].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[1].parent=i,i._rigCameras[1]._getViewMatrix=i._getWebVRViewMatrix}},Object.defineProperty(He.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),He.a.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new S.c,this.onVRRequestPresentComplete=new S.c,this.onVRRequestPresentStart=new S.c},He.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},He.a.prototype.getVRDevice=function(){return this._vrDisplay},He.a.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},He.a.prototype.initWebVRAsync=function(){var i=this,t=function(){var n={vrDisplay:i._vrDisplay,vrSupported:i._vrSupported};i.onVRDisplayChangedObservable.notifyObservers(n),i._webVRInitPromise=new Promise(function(r){r(n)})};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(n){i._vrDisplay=n.display,t()},this._onVrDisplayDisconnect=function(){i._vrDisplay.cancelAnimationFrame(i._frameHandler),i._vrDisplay=void 0,i._frameHandler=He.a.QueueNewFrame(i._boundRenderFunction),t()},this._onVrDisplayPresentChange=function(){i._vrExclusivePointerMode=i._vrDisplay&&i._vrDisplay.isPresenting};var e=this.getHostWindow();e&&(e.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),e.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),e.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},He.a.prototype._getVRDisplaysAsync=function(){var i=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){i._vrSupported=!0,i._vrDisplay=e[0],t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported})}):(i._vrDisplay=void 0,i._vrSupported=!1,t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported}))})},He.a.prototype.enableVR=function(i){var t=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var e={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&i.useMultiview};this._vrDisplay.requestPresent([Object(f.a)({source:this.getRenderingCanvas(),attributes:e},e)]).then(function(){t.onVRRequestPresentComplete.notifyObservers(!0),t._onVRFullScreenTriggered()}).catch(function(){t.onVRRequestPresentComplete.notifyObservers(!1)})}},He.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new he.a(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var i=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*i.renderWidth,i.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},He.a.prototype.disableVR=function(){var i=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return i._onVRFullScreenTriggered()}).catch(function(){return i._onVRFullScreenTriggered()}),ss.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},He.a.prototype._connectVREvents=function(i,t){var e=this;if(this._onVRDisplayPointerRestricted=function(){i&&i.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(t)t.exitPointerLock&&t.exitPointerLock();else{var r=e.getHostWindow();r.document&&r.document.exitPointerLock&&r.document.exitPointerLock()}},ss.a.IsWindowObjectExist()){var n=this.getHostWindow();n.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),n.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},He.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(i){et.b.Warn("webVR submitFrame has had an unexpected failure: "+i)}},He.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},He.a.prototype._requestVRFrame=function(){this._frameHandler=He.a.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)},$.a.AddNodeConstructor("WebVRFreeCamera",function(i,t){return function(){return new Qu(i,h.e.Zero(),t)}}),$.a.AddNodeConstructor("WebVRGamepadCamera",function(i,t){return function(){return new Qu(i,h.e.Zero(),t)}});var Qu=function(i){function t(e,n,r,o){o===void 0&&(o={});var l=i.call(this,e,n,r)||this;l.webVROptions=o,l._vrDevice=null,l.rawPose=null,l._specsVersion="1.1",l._attached=!1,l._descendants=[],l._deviceRoomPosition=h.e.Zero(),l._deviceRoomRotationQuaternion=h.b.Identity(),l._standingMatrix=null,l.devicePosition=h.e.Zero(),l.deviceRotationQuaternion=h.b.Identity(),l.deviceScaleFactor=1,l._deviceToWorld=h.a.Identity(),l._worldToDevice=h.a.Identity(),l.controllers=[],l.onControllersAttachedObservable=new S.c,l.onControllerMeshLoadedObservable=new S.c,l.onPoseUpdatedFromDeviceObservable=new S.c,l._poseSet=!1,l.rigParenting=!0,l._defaultHeight=void 0,l._detachIfAttached=function(){var v=l.getEngine().getVRDevice();v&&!v.isPresenting&&l.detachControl()},l._workingVector=h.e.Zero(),l._oneVector=h.e.One(),l._workingMatrix=h.a.Identity(),l._tmpMatrix=new h.a,l._cache.position=h.e.Zero(),o.defaultHeight&&(l._defaultHeight=o.defaultHeight,l.position.y=l._defaultHeight),l.minZ=.1,arguments.length===5&&(l.webVROptions=arguments[4]),l.webVROptions.trackPosition==null&&(l.webVROptions.trackPosition=!0),l.webVROptions.controllerMeshes==null&&(l.webVROptions.controllerMeshes=!0),l.webVROptions.defaultLightingOnControllers==null&&(l.webVROptions.defaultLightingOnControllers=!0),l.rotationQuaternion=new h.b,l.webVROptions&&l.webVROptions.positionScale&&(l.deviceScaleFactor=l.webVROptions.positionScale);var d=l.getEngine();return l._onVREnabled=function(v){v&&l.initControllers()},d.onVRRequestPresentComplete.add(l._onVREnabled),d.initWebVR().add(function(v){v.vrDisplay&&l._vrDevice!==v.vrDisplay&&(l._vrDevice=v.vrDisplay,l.setCameraRigMode(Pt.a.RIG_MODE_WEBVR,{parentCamera:l,vrDisplay:l._vrDevice,frameData:l._frameData,specs:l._specsVersion}),l._attached&&l.getEngine().enableVR(l.webVROptions))}),typeof VRFrameData!="undefined"&&(l._frameData=new VRFrameData),o.useMultiview&&(l.getScene().getEngine().getCaps().multiview?(l._useMultiviewToSingleView=!0,l._rigPostProcess=new Ep("VRMultiviewToSingleview",l,1)):(_.a.Warn("Multiview is not supported, falling back to standard rendering"),l._useMultiviewToSingleView=!1)),r.onBeforeCameraRenderObservable.add(function(v){v.parent===l&&l.rigParenting&&(l._descendants=l.getDescendants(!0,function(y){var D=l.controllers.some(function(F){return F._mesh===y}),w=l._rigCameras.indexOf(y)!==-1;return!D&&!w}),l._descendants.forEach(function(y){y.parent=v}))}),r.onAfterCameraRenderObservable.add(function(v){v.parent===l&&l.rigParenting&&l._descendants.forEach(function(y){y.parent=l})}),l}return Object(f.d)(t,i),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var n=this;e===void 0&&(e=function(r){}),this.getEngine().initWebVRAsync().then(function(r){r.vrDisplay&&r.vrDisplay.stageParameters&&r.vrDisplay.stageParameters.sittingToStandingTransform&&n.webVROptions.trackPosition?(n._standingMatrix=new h.a,h.a.FromFloat32ArrayToRefScaled(r.vrDisplay.stageParameters.sittingToStandingTransform,0,1,n._standingMatrix),n.getScene().useRightHandedSystem||n._standingMatrix&&n._standingMatrix.toggleModelMatrixHandInPlace(),e(!0)):e(!1)})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(n){e.useStandingMatrix(function(r){n(r)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),i.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var n=0,r=this.controllers;n<r.length;n++){var o=r[n];if(o.hand===e)return o}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){return e===void 0&&(e=100),this.leftCamera?i.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):i.prototype.getForwardRay.call(this,e)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),i.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&e.orientation.length===4&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(e){e=et.b.BackCompatCameraNoPreventDefault(arguments),i.prototype.attachControl.call(this,e),this._attached=!0,e=!Pt.a.ForceAttachControlToAlwaysPreventDefault&&e,this._vrDevice&&this.getEngine().enableVR(this.webVROptions);var n=this._scene.getEngine().getHostWindow();n&&n.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),i.prototype.detachControl.call(this),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),n.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),n.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,n){n===void 0&&(n=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(h.a.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),n||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(e){var n=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),h.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),h.a.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(r){r._deviceToWorld.copyFrom(n._deviceToWorld),n._correctPositionIfNotTrackPosition(r._deviceToWorld),r.update()})),e||i.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){h.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),h.a.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),h.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),i.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return h.a.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;e._updateCache();var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return h.a.FromArrayToRef(n,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),h.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.deviceScaleFactor!==1&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||h.a.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ;var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return h.a.FromArrayToRef(n,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers=[];var n=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(r){if(r.type===zn.POSE_ENABLED){var o=r;o.defaultModel&&o.defaultModel.setEnabled(!1),o.hand==="right"&&(e._rightController=null),o.hand==="left"&&(e._leftController=null);var l=e.controllers.indexOf(o);l!==-1&&e.controllers.splice(l,1)}}),this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(r){if(r.type===zn.POSE_ENABLED){var o=r;if(e.webVROptions.trackPosition||(o._disableTrackPosition(new h.e(o.hand=="left"?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),o.deviceScaleFactor=e.deviceScaleFactor,o._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(o._deviceToWorld),e.webVROptions.controllerMeshes&&(o.defaultModel?o.defaultModel.setEnabled(!0):o.initControllerMesh(e.getScene(),function(v){if(v.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(o),e.webVROptions.defaultLightingOnControllers){e._lightOnControllers||(e._lightOnControllers=new Ku.a("vrControllersLight",new h.e(0,1,0),e.getScene()));var y=function(D,w){var F=D.getChildren();F&&F.length!==0&&F.forEach(function(z){w.includedOnlyMeshes.push(z),y(z,w)})};e._lightOnControllers.includedOnlyMeshes.push(v),y(v,e._lightOnControllers)}})),o.attachToPoseControlledCamera(e),e.controllers.indexOf(o)===-1){e.controllers.push(o);for(var l=!1,d=0;d<e.controllers.length;d++)e.controllers[d].controllerType===qr.VIVE&&(l?e.controllers[d].hand="right":(l=!0,e.controllers[d].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(Ar),Uo=function(i){function t(e){var n=i.call(this,e)||this;return n.onTriggerStateChangedObservable=new S.c,n.onMainButtonStateChangedObservable=new S.c,n.onSecondaryButtonStateChangedObservable=new S.c,n.onPadStateChangedObservable=new S.c,n.onPadValuesChangedObservable=new S.c,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(e.buttons.length),n.hand=e.hand,n}return Object(f.d)(t,i),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[e],this._buttons[e],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,n,r){e||(e={pressed:!1,touched:!1,value:0}),n?(this._checkChanges(e,n),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,r,e),this._handleButtonChange(r,e,this._changes)),this._buttons[r].pressed=e.pressed,this._buttons[r].touched=e.touched,this._buttons[r].value=e.value<1e-8?0:e.value):this._buttons[r]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,n){return this._changes.pressChanged=e.pressed!==n.pressed,this._changes.touchChanged=e.touched!==n.touched,this._changes.valueChanged=e.value!==n.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(we),fr=c(42),rn=c(30),to=c(62),rI=(c(108),c(59),c(109),`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`);Qe.a.ShadersStore.imageProcessingPixelShader=rI;var qu=function(i){function t(e,n,r,o,l,d,v,y){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"imageProcessing",[],[],n,r,o,l,d,null,v,"postprocess",null,!0)||this;return D._fromLinearSpace=!0,D._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},y?(y.applyByPostProcess=!0,D._attachImageProcessingConfiguration(y,!0),D.fromLinearSpace=!1):(D._attachImageProcessingConfiguration(null,!0),D.imageProcessingConfiguration.applyByPostProcess=!0),D.onApply=function(w){D.imageProcessingConfiguration.bind(w,D.aspectRatio)},D}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){e.applyByPostProcess=!0,this._attachImageProcessingConfiguration(e)},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,n){var r=this;if(n===void 0&&(n=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var o=null,l=this.getEngine(),d=this.getCamera();if(d)o=d.getScene();else if(l&&l.scenes){var v=l.scenes;o=v[v.length-1]}else o=re.a.LastCreatedScene;this._imageProcessingConfiguration=o?o.imageProcessingConfiguration:new fr.a}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){r._updateParameters()})),n||this._updateParameters()}},Object.defineProperty(t.prototype,"isSupported",{get:function(){var e=this.getEffect();return!e||e.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var n in this._defines)this._defines[n]&&(e+="#define "+n+`;\r
`);var r=["textureSampler"],o=["scale"];fr.a&&(fr.a.PrepareSamplers(r,this._defines),fr.a.PrepareUniforms(o,this._defines)),this.updateEffect(e,o,r)},t.prototype.dispose=function(e){i.prototype.dispose.call(this,e),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},Object(f.c)([Object(B.c)()],t.prototype,"_fromLinearSpace",void 0),t}(St),Tt=c(16),De=c(4);Fe.a._GroundMeshParser=function(i,t){return Zu.Parse(i,t)};var Zu=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.generateOctree=!1,r}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),t.prototype.optimize=function(e,n){n===void 0&&(n=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(n)},t.prototype.getHeightAtCoordinates=function(e,n){var r=this.getWorldMatrix(),o=h.c.Matrix[5];r.invertToRef(o);var l=h.c.Vector3[8];if(h.e.TransformCoordinatesFromFloatsToRef(e,0,n,o,l),e=l.x,n=l.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this.position.y;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var d=this._getFacetAt(e,n),v=-(d.x*e+d.z*n+d.w)/d.y;return h.e.TransformCoordinatesFromFloatsToRef(0,v,0,r,l),l.y},t.prototype.getNormalAtCoordinates=function(e,n){var r=new h.e(0,1,0);return this.getNormalAtCoordinatesToRef(e,n,r),r},t.prototype.getNormalAtCoordinatesToRef=function(e,n,r){var o=this.getWorldMatrix(),l=h.c.Matrix[5];o.invertToRef(l);var d=h.c.Vector3[8];if(h.e.TransformCoordinatesFromFloatsToRef(e,0,n,l,d),e=d.x,n=d.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var v=this._getFacetAt(e,n);return h.e.TransformNormalFromFloatsToRef(v.x,v.y,v.z,o,r),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&this._heightQuads.length!=0||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,n){var r=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(n+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),l=this._heightQuads[o*this._subdivisionsX+r];return n<l.slope.x*e+l.slope.y?l.facet1:l.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,n=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<n;r++)for(var o=0;o<e;o++){var l={slope:h.d.Zero(),facet1:new h.f(0,0,0,0),facet2:new h.f(0,0,0,0)};this._heightQuads[r*e+o]=l}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(De.b.PositionKind);if(!e)return this;for(var n=h.c.Vector3[3],r=h.c.Vector3[2],o=h.c.Vector3[1],l=h.c.Vector3[0],d=h.c.Vector3[4],v=h.c.Vector3[5],y=h.c.Vector3[6],D=h.c.Vector3[7],w=h.c.Vector3[8],F=0,z=0,k=0,K=0,ae=0,le=0,fe=0,me=this._subdivisionsX,be=this._subdivisionsY,Ee=0;Ee<be;Ee++)for(var xe=0;xe<me;xe++){F=3*xe,z=Ee*(me+1)*3,k=(Ee+1)*(me+1)*3,n.x=e[z+F],n.y=e[z+F+1],n.z=e[z+F+2],r.x=e[z+F+3],r.y=e[z+F+4],r.z=e[z+F+5],o.x=e[k+F],o.y=e[k+F+1],o.z=e[k+F+2],l.x=e[k+F+3],l.y=e[k+F+4],l.z=e[k+F+5],K=(l.z-n.z)/(l.x-n.x),ae=n.z-K*n.x,r.subtractToRef(n,d),o.subtractToRef(n,v),l.subtractToRef(n,y),h.e.CrossToRef(y,v,D),h.e.CrossToRef(d,y,w),D.normalize(),w.normalize(),le=-(D.x*n.x+D.y*n.y+D.z*n.z),fe=-(w.x*r.x+w.y*r.y+w.z*r.z);var Ae=this._heightQuads[Ee*me+xe];Ae.slope.copyFromFloats(K,ae),Ae.facet1.copyFromFloats(D.x,D.y,D.z,le),Ae.facet2.copyFromFloats(w.x,w.y,w.z,fe)}return this},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},t.Parse=function(e,n){var r=new t(e.name,n);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},t}(Fe.a),Sp=c(70);Tt.a.CreateGround=function(i){var t,e,n=[],r=[],o=[],l=[],d=i.width||1,v=i.height||1,y=i.subdivisionsX||i.subdivisions||1,D=i.subdivisionsY||i.subdivisions||1;for(t=0;t<=D;t++)for(e=0;e<=y;e++){var w=new h.e(e*d/y-d/2,0,(D-t)*v/D-v/2),F=new h.e(0,1,0);r.push(w.x,w.y,w.z),o.push(F.x,F.y,F.z),l.push(e/y,1-t/D)}for(t=0;t<D;t++)for(e=0;e<y;e++)n.push(e+1+(t+1)*(y+1)),n.push(e+1+t*(y+1)),n.push(e+t*(y+1)),n.push(e+(t+1)*(y+1)),n.push(e+1+(t+1)*(y+1)),n.push(e+t*(y+1));var z=new Tt.a;return z.indices=n,z.positions=r,z.normals=o,z.uvs=l,z},Tt.a.CreateTiledGround=function(i){var t,e,n,r,o=i.xmin!==void 0&&i.xmin!==null?i.xmin:-1,l=i.zmin!==void 0&&i.zmin!==null?i.zmin:-1,d=i.xmax!==void 0&&i.xmax!==null?i.xmax:1,v=i.zmax!==void 0&&i.zmax!==null?i.zmax:1,y=i.subdivisions||{w:1,h:1},D=i.precision||{w:1,h:1},w=new Array,F=new Array,z=new Array,k=new Array;y.h=y.h<1?1:y.h,y.w=y.w<1?1:y.w,D.w=D.w<1?1:D.w,D.h=D.h<1?1:D.h;var K=(d-o)/y.w,ae=(v-l)/y.h;function le(me,be,Ee,xe){var Ae=F.length/3,Ie=D.w+1;for(t=0;t<D.h;t++)for(e=0;e<D.w;e++){var Re=[Ae+e+t*Ie,Ae+(e+1)+t*Ie,Ae+(e+1)+(t+1)*Ie,Ae+e+(t+1)*Ie];w.push(Re[1]),w.push(Re[2]),w.push(Re[3]),w.push(Re[0]),w.push(Re[1]),w.push(Re[3])}var Pe=h.e.Zero(),Ce=new h.e(0,1,0);for(t=0;t<=D.h;t++)for(Pe.z=t*(xe-be)/D.h+be,e=0;e<=D.w;e++)Pe.x=e*(Ee-me)/D.w+me,Pe.y=0,F.push(Pe.x,Pe.y,Pe.z),z.push(Ce.x,Ce.y,Ce.z),k.push(e/D.w,t/D.h)}for(n=0;n<y.h;n++)for(r=0;r<y.w;r++)le(o+r*K,l+n*ae,o+(r+1)*K,l+(n+1)*ae);var fe=new Tt.a;return fe.indices=w,fe.positions=F,fe.normals=z,fe.uvs=k,fe},Tt.a.CreateGroundFromHeightMap=function(i){var t,e,n=[],r=[],o=[],l=[],d=i.colorFilter||new C.a(.3,.59,.11),v=i.alphaFilter||0,y=!1;if(i.minHeight>i.maxHeight){y=!0;var D=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=D}for(t=0;t<=i.subdivisions;t++)for(e=0;e<=i.subdivisions;e++){var w=new h.e(e*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-t)*i.height/i.subdivisions-i.height/2),F=4*(((w.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(w.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth),z=i.buffer[F]/255,k=i.buffer[F+1]/255,K=i.buffer[F+2]/255,ae=i.buffer[F+3]/255;y&&(z=1-z,k=1-k,K=1-K);var le=z*d.r+k*d.g+K*d.b;w.y=ae>=v?i.minHeight+(i.maxHeight-i.minHeight)*le:i.minHeight-Zt.a,r.push(w.x,w.y,w.z),o.push(0,0,0),l.push(e/i.subdivisions,1-t/i.subdivisions)}for(t=0;t<i.subdivisions;t++)for(e=0;e<i.subdivisions;e++){var fe=e+1+(t+1)*(i.subdivisions+1),me=e+1+t*(i.subdivisions+1),be=e+t*(i.subdivisions+1),Ee=e+(t+1)*(i.subdivisions+1),xe=r[3*fe+1]>=i.minHeight,Ae=r[3*me+1]>=i.minHeight,Ie=r[3*be+1]>=i.minHeight;xe&&Ae&&Ie&&(n.push(fe),n.push(me),n.push(be)),r[3*Ee+1]>=i.minHeight&&xe&&Ie&&(n.push(Ee),n.push(fe),n.push(be))}Tt.a.ComputeNormals(r,n,o);var Re=new Tt.a;return Re.indices=n,Re.positions=r,Re.normals=o,Re.uvs=l,Re},Fe.a.CreateGround=function(i,t,e,n,r,o){var l={width:t,height:e,subdivisions:n,updatable:o};return Vo.CreateGround(i,l,r)},Fe.a.CreateTiledGround=function(i,t,e,n,r,o,l,d,v){var y={xmin:t,zmin:e,xmax:n,zmax:r,subdivisions:o,precision:l,updatable:v};return Vo.CreateTiledGround(i,y,d)},Fe.a.CreateGroundFromHeightMap=function(i,t,e,n,r,o,l,d,v,y,D){var w={width:e,height:n,subdivisions:r,minHeight:o,maxHeight:l,updatable:v,onReady:y,alphaFilter:D};return Vo.CreateGroundFromHeightMap(i,t,w,d)};var Vo=function(){function i(){}return i.CreateGround=function(t,e,n){var r=new Zu(t,n);return r._setReady(!1),r._subdivisionsX=e.subdivisionsX||e.subdivisions||1,r._subdivisionsY=e.subdivisionsY||e.subdivisions||1,r._width=e.width||1,r._height=e.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,Tt.a.CreateGround(e).applyToMesh(r,e.updatable),r._setReady(!0),r},i.CreateTiledGround=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return Tt.a.CreateTiledGround(e).applyToMesh(r,e.updatable),r},i.CreateGroundFromHeightMap=function(t,e,n,r){r===void 0&&(r=null);var o=n.width||10,l=n.height||10,d=n.subdivisions||1,v=n.minHeight||0,y=n.maxHeight||1,D=n.colorFilter||new C.a(.3,.59,.11),w=n.alphaFilter||0,F=n.updatable,z=n.onReady;r=r||re.a.LastCreatedScene;var k=new Zu(t,r);return k._subdivisionsX=d,k._subdivisionsY=d,k._width=o,k._height=l,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),et.b.LoadImage(e,function(K){var ae=K.width,le=K.height,fe=Sp.a.CreateCanvas(ae,le).getContext("2d");if(!fe)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!r.isDisposed){fe.drawImage(K,0,0);var me=fe.getImageData(0,0,ae,le).data;Tt.a.CreateGroundFromHeightMap({width:o,height:l,subdivisions:d,minHeight:v,maxHeight:y,colorFilter:D,buffer:me,bufferWidth:ae,bufferHeight:le,alphaFilter:w}).applyToMesh(k,F),z&&z(k),k._setReady(!0)}},function(){},r.offlineProvider),k},i}();Tt.a.CreateTorus=function(i){for(var t=[],e=[],n=[],r=[],o=i.diameter||1,l=i.thickness||.5,d=i.tessellation||16,v=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,y=d+1,D=0;D<=d;D++)for(var w=D/d,F=D*Math.PI*2/d-Math.PI/2,z=h.a.Translation(o/2,0,0).multiply(h.a.RotationY(F)),k=0;k<=d;k++){var K=1-k/d,ae=k*Math.PI*2/d+Math.PI,le=Math.cos(ae),fe=Math.sin(ae),me=new h.e(le,fe,0),be=me.scale(l/2),Ee=new h.d(w,K);be=h.e.TransformCoordinates(be,z),me=h.e.TransformNormal(me,z),e.push(be.x,be.y,be.z),n.push(me.x,me.y,me.z),r.push(Ee.x,Ee.y);var xe=(D+1)%y,Ae=(k+1)%y;t.push(D*y+k),t.push(D*y+Ae),t.push(xe*y+k),t.push(D*y+Ae),t.push(xe*y+Ae),t.push(xe*y+k)}Tt.a._ComputeSides(v,e,t,n,r,i.frontUVs,i.backUVs);var Ie=new Tt.a;return Ie.indices=t,Ie.positions=e,Ie.normals=n,Ie.uvs=r,Ie},Fe.a.CreateTorus=function(i,t,e,n,r,o,l){var d={diameter:t,thickness:e,tessellation:n,sideOrientation:l,updatable:o};return us.CreateTorus(i,d,r)};var tr,Aa,us=function(){function i(){}return i.CreateTorus=function(t,e,n){var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTorus(e).applyToMesh(r,e.updatable),r},i}(),Vi=c(53),xp=function(){function i(){}return i.GetDefaults=function(t){var e=new i;return e.canvasOptions={antialias:!0,depth:!0,stencil:!t||t.isStencilEnable,alpha:!0,multiview:!1,framebufferScaleFactor:1},e.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",e},i}(),by=function(){function i(t,e){var n=this;if(e===void 0&&(e=xp.GetDefaults()),this._options=e,this._canvas=null,this.xrLayer=null,this.onXRLayerInitObservable=new S.c,this._engine=t.scene.getEngine(),e.canvasElement)this._setManagedOutputCanvas(e.canvasElement);else{var r=document.createElement("canvas");r.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(r)}t.onXRSessionInit.add(function(){n._addCanvas()}),t.onXRSessionEnded.add(function(){n._removeCanvas()})}return i.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},i.prototype.initializeXRLayerAsync=function(t){var e=this,n=function(){var r=new XRWebGLLayer(t,e.canvasContext,e._options.canvasOptions);return e.onXRLayerInitObservable.notifyObservers(r),r};return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then(function(){return e.xrLayer=n(),e.xrLayer}):(this.xrLayer=n(),Promise.resolve(this.xrLayer))},i.prototype._addCanvas=function(){var t=this;this._canvas&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce(function(e){t._setCanvasSize(!0,e)})},i.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)},i.prototype._setCanvasSize=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=this.xrLayer),this._canvas&&(t?e&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=e.framebufferWidth+"px",this._canvas.style.height=e.framebufferHeight+"px"):this._engine.setSize(e.framebufferWidth,e.framebufferHeight)):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))},i.prototype._setManagedOutputCanvas=function(t){this._removeCanvas(),t?(this._originalCanvasSize={width:t.offsetWidth,height:t.offsetHeight},this._canvas=t,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},i}(),Ap=function(){function i(t){this.scene=t,this._sessionEnded=!1,this.baseLayer=null,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new S.c,this.onXRReferenceSpaceChanged=new S.c,this.onXRSessionEnded=new S.c,this.onXRSessionInit=new S.c}return Object.defineProperty(i.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(t){this._referenceSpace=t,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._sessionEnded||this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear()},i.prototype.exitXRAsync=function(){return this.session&&!this._sessionEnded?(this._sessionEnded=!0,this.session.end().catch(function(t){_.a.Warn("Could not end XR session.")})):Promise.resolve()},i.prototype.getRenderTargetTextureForEye=function(t){return this._rttProvider.getRenderTargetForEye(t)},i.prototype.getWebXRRenderTarget=function(t){var e=this.scene.getEngine();return this._xrNavigator.xr.native?this._xrNavigator.xr.getWebXRRenderTarget(e):((t=t||xp.GetDefaults(e)).canvasElement=e.getRenderingCanvas()||void 0,new by(this,t))},i.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},i.prototype.initializeSessionAsync=function(t,e){var n=this;return t===void 0&&(t="immersive-vr"),e===void 0&&(e={}),this._xrNavigator.xr.requestSession(t,e).then(function(r){return n.session=r,n.onXRSessionInit.notifyObservers(r),n._sessionEnded=!1,n.session.addEventListener("end",function(){var o=n.scene.getEngine();n._sessionEnded=!0,n._rttProvider=null,o.framebufferDimensionsObject=null,o.restoreDefaultFramebuffer(),o.customAnimationFrameRequester=null,n.onXRSessionEnded.notifyObservers(null),o._renderLoop()},{once:!0}),n.session})},i.prototype.isSessionSupportedAsync=function(t){return i.IsSessionSupportedAsync(t)},i.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},i.prototype.runXRRenderLoop=function(){var t=this,e=this.scene.getEngine();if(e.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(r,o){t._sessionEnded||(t.currentFrame=o,t.currentTimestamp=r,o&&(e.framebufferDimensionsObject=t.baseLayer,t.onXRFrameObservable.notifyObservers(o),e._renderLoop(),e.framebufferDimensionsObject=null))}},this._xrNavigator.xr.native)this._rttProvider=this._xrNavigator.xr.getNativeRenderTargetProvider(this.session,this._createRenderTargetTexture.bind(this));else{var n=this._createRenderTargetTexture(this.baseLayer.framebufferWidth,this.baseLayer.framebufferHeight,this.baseLayer.framebuffer);this._rttProvider={getRenderTargetForEye:function(){return n}},e.framebufferDimensionsObject=this.baseLayer}typeof window!="undefined"&&window.cancelAnimationFrame&&window.cancelAnimationFrame(e._frameHandler),e._renderLoop()},i.prototype.setReferenceSpaceTypeAsync=function(t){var e=this;return t===void 0&&(t="local-floor"),this.session.requestReferenceSpace(t).then(function(n){return n},function(n){return _.a.Error("XR.requestReferenceSpace failed for the following reason: "),_.a.Error(n),_.a.Log('Defaulting to universally-supported "viewer" reference space type.'),e.session.requestReferenceSpace("viewer").then(function(r){var o=new XRRigidTransform({x:0,y:-e.defaultHeightCompensation,z:0});return r.getOffsetReferenceSpace(o)},function(r){throw _.a.Error(r),'XR initialization failed: required "viewer" reference space type not supported.'})}).then(function(n){return e.session.requestReferenceSpace("viewer").then(function(r){return e.viewerReferenceSpace=r,n})}).then(function(n){return e.referenceSpace=e.baseReferenceSpace=n,e.referenceSpace})},i.prototype.updateRenderStateAsync=function(t){return t.baseLayer&&(this.baseLayer=t.baseLayer),this.session.updateRenderState(t)},i.IsSessionSupportedAsync=function(t){if(!navigator.xr)return Promise.resolve(!1);var e=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return e?e.call(navigator.xr,t).then(function(n){var r=n===void 0||n;return Promise.resolve(r)}).catch(function(n){return _.a.Warn(n),Promise.resolve(!1)}):Promise.resolve(!1)},i.prototype._createRenderTargetTexture=function(t,e,n){n===void 0&&(n=null);var r=new Nt.a(this.scene.getEngine(),Nt.b.Unknown,!0);r.width=t,r.height=e,r._framebuffer=n;var o=new qn("XR renderTargetTexture",{width:t,height:e},this.scene,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return o._texture=r,o},i}();(function(i){i[i.ENTERING_XR=0]="ENTERING_XR",i[i.EXITING_XR=1]="EXITING_XR",i[i.IN_XR=2]="IN_XR",i[i.NOT_IN_XR=3]="NOT_IN_XR"})(tr||(tr={})),function(i){i[i.NOT_TRACKING=0]="NOT_TRACKING",i[i.TRACKING_LOST=1]="TRACKING_LOST",i[i.TRACKING=2]="TRACKING"}(Aa||(Aa={}));var bi,yy=function(){function i(t,e){if(e===void 0&&(e=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=i._idCounter++,e)this._gazeTracker=e.clone("gazeTracker");else{this._gazeTracker=Fe.a.CreateTorus("gazeTracker",.0035,.0025,20,t,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var n=new rn.a("targetMat",t);n.specularColor=C.a.Black(),n.emissiveColor=new C.a(.7,.7,.7),n.backFaceCulling=!1,this._gazeTracker.material=n}}return i.prototype._getForwardRay=function(t){return new Qn.a(h.e.Zero(),new h.e(0,0,t))},i.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},i.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},i.prototype._activatePointer=function(){this._activePointer=!0},i.prototype._deactivatePointer=function(){this._activePointer=!1},i.prototype._updatePointerDistance=function(t){},i.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},i._idCounter=0,i}(),iI=function(i){function t(e,n,r){var o=i.call(this,n,r)||this;o.webVRController=e,o._laserPointer=Fe.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,n,!1);var l=new rn.a("laserPointerMat",n);if(l.emissiveColor=new C.a(.7,.7,.7),l.alpha=.6,o._laserPointer.material=l,o._laserPointer.rotation.x=Math.PI/2,o._laserPointer.position.z=-.5,o._laserPointer.isVisible=!1,o._laserPointer.isPickable=!1,!e.mesh){var d=new Fe.a("preloadControllerMesh",n),v=new Fe.a(we.POINTING_POSE,n);v.rotation.x=-.7,d.addChild(v),e.attachToMesh(d)}return o._setLaserPointerParent(e.mesh),o._meshAttachedObserver=e._meshAttachedObservable.add(function(y){o._setLaserPointerParent(y)}),o}return Object(f.d)(t,i),t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){i.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){i.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerLightingDisabled=function(e){this._laserPointer.material.disableLighting=e},t.prototype._setLaserPointerParent=function(e){var n=function(d){d.isPickable=!1,d.getChildMeshes().forEach(function(v){n(v)})};n(e);var r=e.getChildren(void 0,!1),o=e;this.webVRController._pointingPoseNode=null;for(var l=0;l<r.length;l++)if(r[l].name&&r[l].name.indexOf(we.POINTING_POSE)>=0){o=r[l],this.webVRController._pointingPoseNode=o;break}this._laserPointer.parent=o},t.prototype._updatePointerDistance=function(e){e===void 0&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(yy),Ty=function(i){function t(e,n){var r=i.call(this,n)||this;return r.getCamera=e,r}return Object(f.d)(t,i),t.prototype._getForwardRay=function(e){var n=this.getCamera();return n?n.getForwardRay(e):new Qn.a(h.e.Zero(),h.e.Forward())},t}(yy),oI=function(){},Ey=function(){function i(t,e){var n=this;if(e===void 0&&(e={}),this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new S.c,this.onAfterEnteringVRObservable=new S.c,this.onExitingVRObservable=new S.c,this.onControllerMeshLoadedObservable=new S.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=i.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new h.e(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new h.e(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new C.a(.7,.7,.7),this._laserColor=new C.a(.7,.7,.7),this._pickedLaserColor=new C.a(.2,.2,1),this._pickedGazeColor=new C.a(0,0,1),this.onNewMeshSelected=new S.c,this.onMeshSelectedWithController=new S.c,this.onNewMeshPicked=new S.c,this.onBeforeCameraTeleport=new S.c,this.onAfterCameraTeleport=new S.c,this.onSelectedMeshUnselected=new S.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){n.moveButtonToBottomRight(),n._fullscreenVRpresenting&&n._webVRready&&n.exitVR()},this._onFullscreenChange=function(){var o=document;o.fullscreen!==void 0?n._fullscreenVRpresenting=document.fullscreen:o.mozFullScreen!==void 0?n._fullscreenVRpresenting=o.mozFullScreen:o.webkitIsFullScreen!==void 0?n._fullscreenVRpresenting=o.webkitIsFullScreen:o.msIsFullScreen!==void 0?n._fullscreenVRpresenting=o.msIsFullScreen:document.msFullscreenElement!==void 0&&(n._fullscreenVRpresenting=document.msFullscreenElement),!n._fullscreenVRpresenting&&n._inputElement&&(n.exitVR(),!n._useCustomVRButton&&n._btnVR&&(n._btnVR.style.top=n._inputElement.offsetTop+n._inputElement.offsetHeight-70+"px",n._btnVR.style.left=n._inputElement.offsetLeft+n._inputElement.offsetWidth-100+"px",n.updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){n._leftController&&n._leftController._activePointer&&n._castRayAndSelectObject(n._leftController),n._rightController&&n._rightController._activePointer&&n._castRayAndSelectObject(n._rightController),n._noControllerIsActive&&(n._scene.getEngine().isPointerLock||n.enableGazeEvenWhenNoPointerLock)?n._castRayAndSelectObject(n._cameraGazer):n._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(o){if(o.type!==zn.POSE_ENABLED)o.leftStick&&o.onleftstickchanged(function(v){n._teleportationInitialized&&n.teleportationEnabled&&(!n._leftController&&!n._rightController||n._leftController&&!n._leftController._activePointer&&n._rightController&&!n._rightController._activePointer)&&(n._checkTeleportWithRay(v,n._cameraGazer),n._checkTeleportBackwards(v,n._cameraGazer))}),o.rightStick&&o.onrightstickchanged(function(v){n._teleportationInitialized&&n._checkRotate(v,n._cameraGazer)}),o.type===zn.XBOX&&(o.onbuttondown(function(v){n._interactionsEnabled&&v===vr.A&&n._cameraGazer._selectionPointerDown()}),o.onbuttonup(function(v){n._interactionsEnabled&&v===vr.A&&n._cameraGazer._selectionPointerUp()}));else{var l=o,d=new iI(l,n._scene,n._cameraGazer._gazeTracker);l.hand==="right"||n._leftController&&n._leftController.webVRController!=l?n._rightController=d:n._leftController=d,n._tryEnableInteractionOnController(d)}},this._tryEnableInteractionOnController=function(o){n._interactionsRequested&&!o._interactionsEnabled&&n._enableInteractionOnController(o),n._teleportationRequested&&!o._teleportationEnabled&&n._enableTeleportationOnController(o)},this._onNewGamepadDisconnected=function(o){o instanceof Uo&&(o.hand==="left"&&n._leftController!=null&&(n._leftController.dispose(),n._leftController=null),o.hand==="right"&&n._rightController!=null&&(n._rightController.dispose(),n._rightController=null))},this._workingVector=h.e.Zero(),this._workingQuaternion=h.b.Identity(),this._workingMatrix=h.a.Identity(),this._scene=t,this._inputElement=t.getEngine().getInputElement(),"getVRDisplays"in navigator||(e.useXR=!0),e.createFallbackVRDeviceOrientationFreeCamera===void 0&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),e.createDeviceOrientationCamera===void 0&&(e.createDeviceOrientationCamera=!0),e.laserToggle===void 0&&(e.laserToggle=!0),e.defaultHeight===void 0&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new h.e(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new No("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof ai&&this._scene.activeCamera.rotation)){var r=this._scene.activeCamera;r.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(r.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(h.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z)),this._deviceOrientationCamera.rotation=r.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?Ap.IsSessionSupportedAsync("immersive-vr").then(function(o){o?(_.a.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),t.createDefaultXRExperienceAsync({floorMeshes:e.floorMeshes||[]}).then(function(l){n.xr=l,n.xrTestDone=!0,n._cameraGazer=new Ty(function(){return n.xr.baseExperience.camera},t),n.xr.baseExperience.onStateChangedObservable.add(function(d){switch(d){case tr.ENTERING_XR:n.onEnteringVRObservable.notifyObservers(n),n._interactionsEnabled||n.xr.pointerSelection.detach(),n.xr.pointerSelection.displayLaserPointer=n._displayLaserPointer;break;case tr.EXITING_XR:n.onExitingVRObservable.notifyObservers(n),n._scene.getEngine().resize();break;case tr.IN_XR:n._hasEnteredVR=!0;break;case tr.NOT_IN_XR:n._hasEnteredVR=!1}})})):n.completeVRInit(t,e)}):this.completeVRInit(t,e)}return Object.defineProperty(i.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||this._leftController!==null&&this._leftController._teleportationRequestInitiated||this._rightController!==null&&this._rightController._teleportationRequestInitiated},enumerable:!1,configurable:!0}),i.prototype.completeVRInit=function(t,e){var n=this;if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=ls.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Yu("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new Qu("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new Ty(function(){return n.currentVRCamera},t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var r=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";r+=".babylonVRicon.vrdisplaypresenting { display: none; }";var o=document.createElement("style");o.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(o),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){n.isInVRMode?n._scene.getEngine().disableVR():n.enterVR()});var l=this._scene.getEngine().getHostWindow();l&&(l.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(d){d.vrDisplay&&n.displayVRButton()}),this._onKeyDown=function(d){d.keyCode===27&&n.isInVRMode&&n.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){n._hasEnteredVR&&n.exitVROnDoubleTap&&(n.exitVR(),n._fullscreenVRpresenting&&n._scene.getEngine().exitFullscreen())},Ot.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(d){return n.onVRDisplayChanged(d)},this._onVrDisplayPresentChange=function(){return n.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){n._webVRrequesting=!0,n.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){n._webVRrequesting=!1,n.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),l.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add(function(){n.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(d){return n._onDefaultMeshLoaded(d)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new ct,this._circleEase.setEasingMode(qe.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add(function(d){n._interactionsEnabled&&t.activeCamera===n.vrDeviceOrientationCamera&&d.event.pointerType==="mouse"&&(d.type===Ot.a.POINTERDOWN?n._cameraGazer._selectionPointerDown():d.type===Ot.a.POINTERUP&&n._cameraGazer._selectionPointerUp())}),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},i.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(e){_.a.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(i.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===tr.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!1,configurable:!0}),i.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else _.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},i.prototype.onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this.updateButtonVisibility()},i.prototype.moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}},i.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},i.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},i.prototype.enterVR=function(){var t=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(o){_.a.Warn("Error in your custom logic onEnteringVR: "+o)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=h.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var e=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,n=h.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-e,r=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=h.b.FromEulerAngles(0,r+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(o){t.onAfterEnteringVRObservable.notifyObservers({success:o})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){t.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(o){o&&o._activatePointer()}),this._hasEnteredVR=!0)}},i.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){_.a.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!1,configurable:!0}),i.prototype.enableInteractions=function(){var t=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===tr.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return!!(t._isTeleportationFloor(e)||e.name.indexOf("gazeTracker")===-1&&e.name.indexOf("teleportationTarget")===-1&&e.name.indexOf("torusTeleportation")===-1)&&t.raySelectionPredicate(e)},this._interactionsEnabled=!0}},Object.defineProperty(i.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!1,configurable:!0}),i.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)},i.prototype.addFloorMesh=function(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))},i.prototype.removeFloorMesh=function(t){if(this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);e!==-1&&this._floorMeshesCollection.splice(e,1)}},i.prototype.enableTeleportation=function(t){var e=this;if(t===void 0&&(t={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){var n=t.floorMeshes||[];if(!n.length){var r=this._scene.getMeshByName(t.floorMeshName);r&&n.push(r)}if(this.xr)return n.forEach(function(d){e.xr.teleportation.addFloorMesh(d)}),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var o=function(){e.xrTestDone&&(e._scene.unregisterBeforeRender(o),e.xr?e.xr.teleportation.attached||e.xr.teleportation.attach():e.enableTeleportation(t))};return void this._scene.registerBeforeRender(o)}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),t.easingFunction!==void 0&&(this._teleportationEasing=t.easingFunction),this._leftController!=null&&this._enableTeleportationOnController(this._leftController),this._rightController!=null&&this._enableTeleportationOnController(this._rightController);var l=new fr.a;l.vignetteColor=new C.b(0,0,0,0),l.vignetteEnabled=!0,this._postProcessMove=new qu("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,l),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},i.prototype._enableInteractionOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add(function(n){e._displayLaserPointer&&n.value===1&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))}),t.webVRController.onTriggerStateChangedObservable.add(function(n){var r=t;e._noControllerIsActive&&(r=e._cameraGazer),r._pointerDownOnMeshAsked?n.value<e._padSensibilityDown&&r._selectionPointerUp():n.value>e._padSensibilityUp&&r._selectionPointerDown()}))},i.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},i.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},i.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var n=h.b.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),r=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(n=this.currentVRCamera.deviceRotationQuaternion,r=this.currentVRCamera.devicePosition),n.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,h.b.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),h.e.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var o=new Qn.a(r,this._workingVector),l=this._scene.pickWithRay(o,this._raySelectionPredicate);l&&l.pickedPoint&&l.pickedMesh&&this._isTeleportationFloor(l.pickedMesh)&&l.distance<5&&this.teleportCamera(l.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},i.prototype._enableTeleportationOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===qr.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add(function(n){t._dpadPressed=n.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)})),t.webVRController.onPadValuesChangedObservable.add(function(n){e.teleportationEnabled&&(e._checkTeleportBackwards(n,t),e._checkTeleportWithRay(n,t)),e._checkRotate(n,t)}))},i.prototype._createTeleportationCircles=function(){this._teleportationTarget=Fe.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new to.a("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();var n=new rn.a("TextPlaneMaterial",this._scene);n.diffuseTexture=t,this._teleportationTarget.material=n;var r=Fe.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);r.isPickable=!1,r.parent=this._teleportationTarget;var o=new H("animationInnerCircle","position.y",30,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CYCLE),l=[];l.push({frame:0,value:0}),l.push({frame:30,value:.4}),l.push({frame:60,value:0}),o.setKeys(l);var d=new fn;d.setEasingMode(qe.EASINGMODE_EASEINOUT),o.setEasingFunction(d),r.animations=[],r.animations.push(o),this._scene.beginAnimation(r,0,60,!0),this._hideTeleportationTarget()},i.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},i.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},i.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof Ar){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var n=h.b.FromRotationMatrix(h.a.RotationY(Math.PI/4*this._rotationAngle)),r=new H("animationRotation","rotationQuaternion",90,H.ANIMATIONTYPE_QUATERNION,H.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),o.push({frame:6,value:n}),r.setKeys(o),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var l=new H("animationPP","vignetteWeight",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),d=[];d.push({frame:0,value:0}),d.push({frame:3,value:4}),d.push({frame:6,value:0}),l.setKeys(d),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l);var v=new H("animationPP2","vignetteStretch",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),y=[];y.push({frame:0,value:0}),y.push({frame:3,value:10}),y.push({frame:6,value:0}),v.setKeys(y),v.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(v),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},i.prototype._moveTeleportationSelectorTo=function(t,e,n){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var r=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),n);if(r){var o=h.e.Cross(Te.a.Y,r),l=h.e.Cross(r,o);h.e.RotationFromAxisToRef(l,r,o,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},i.prototype.teleportCamera=function(t){var e=this;if(this.currentVRCamera instanceof Ar){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var n,r;if(this._teleportationMode==i.TELEPORTATIONMODE_CONSTANTSPEED){r=90;var o=h.e.Distance(this.currentVRCamera.position,this._workingVector);n=this._teleportationSpeed/o}else r=Math.round(90*this._teleportationTime/1e3),n=1;this.currentVRCamera.animations=[];var l=new H("animationCameraTeleportation","position",90,H.ANIMATIONTYPE_VECTOR3,H.ANIMATIONLOOPMODE_CONSTANT),d=[{frame:0,value:this.currentVRCamera.position},{frame:r,value:this._workingVector}];l.setKeys(d),l.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(l),this._postProcessMove.animations=[];var v=Math.round(r/2),y=new H("animationPP","vignetteWeight",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),D=[];D.push({frame:0,value:0}),D.push({frame:v,value:8}),D.push({frame:r,value:0}),y.setKeys(D),this._postProcessMove.animations.push(y);var w=new H("animationPP2","vignetteStretch",90,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CONSTANT),F=[];F.push({frame:0,value:0}),F.push({frame:v,value:10}),F.push({frame:r,value:0}),w.setKeys(F),this._postProcessMove.animations.push(w),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,r,!1,n,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,r,!1,n,function(){e.onAfterCameraTeleport.notifyObservers(e._workingVector)}),this._hideTeleportationTarget()}},i.prototype._convertNormalToDirectionOfRay=function(t,e){return t&&Math.acos(h.e.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1),t},i.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof Ar){var e=t._getForwardRay(this._rayLength),n=this._scene.pickWithRay(e,this._raySelectionPredicate);if(n&&(t._laserPointer&&(n.originMesh=t._laserPointer.parent),this._scene.simulatePointerMove(n,{pointerId:t._id})),t._currentHit=n,n&&n.pickedPoint){if(this._displayGaze){var r=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(r=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=n.distance*r,t._gazeTracker.scaling.y=n.distance*r,t._gazeTracker.scaling.z=n.distance*r);var o=this._convertNormalToDirectionOfRay(n.getNormal(),e);if(o){var l=h.e.Cross(Te.a.Y,o),d=h.e.Cross(o,l);h.e.RotationFromAxisToRef(d,o,l,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(n.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=.002:t._gazeTracker.position.x-=.002,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=.002:t._gazeTracker.position.y-=.002,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=.002:t._gazeTracker.position.z-=.002}t._updatePointerDistance(n.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(n&&n.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(n.pickedMesh)&&n.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(n,t,e));if(n.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(n.pickedMesh)){this.onNewMeshPicked.notifyObservers(n),t._currentMeshSelected=n.pickedMesh,n.pickedMesh.isPickable&&n.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(n.pickedMesh);var v=t;v.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:n.pickedMesh,controller:v.webVRController})}catch(y){_.a.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+y)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},i.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},i.prototype.setLaserColor=function(t,e){e===void 0&&(e=this._pickedLaserColor),this._laserColor=t,this._pickedLaserColor=e},i.prototype.setLaserLightingState=function(t){t===void 0&&(t=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)},i.prototype.setGazeColor=function(t,e){e===void 0&&(e=this._pickedGazeColor),this._gazeColor=t,this._pickedGazeColor=e},i.prototype.changeLaserColor=function(t){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))},i.prototype.changeGazeColor=function(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},i.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},i.prototype.getClassName=function(){return"VRExperienceHelper"},i.TELEPORTATIONMODE_CONSTANTTIME=0,i.TELEPORTATIONMODE_CONSTANTSPEED=1,i}(),hs=c(64),ds=(bi={root:0,found:!1},function(i,t,e,n){bi.root=0,bi.found=!1;var r=t*t-4*i*e;if(r<0)return bi;var o=Math.sqrt(r),l=(-t-o)/(2*i),d=(-t+o)/(2*i);if(l>d){var v=d;d=l,l=v}return l>0&&l<n?(bi.root=l,bi.found=!0,bi):(d>0&&d<n&&(bi.root=d,bi.found=!0),bi)}),Sy=function(){function i(){this._collisionPoint=h.e.Zero(),this._planeIntersectionPoint=h.e.Zero(),this._tempVector=h.e.Zero(),this._tempVector2=h.e.Zero(),this._tempVector3=h.e.Zero(),this._tempVector4=h.e.Zero(),this._edge=h.e.Zero(),this._baseToVertex=h.e.Zero(),this._destinationPoint=h.e.Zero(),this._slidePlaneNormal=h.e.Zero(),this._displacementVector=h.e.Zero(),this._radius=h.e.One(),this._retry=0,this._basePointWorld=h.e.Zero(),this._velocityWorld=h.e.Zero(),this._normalizedVelocity=h.e.Zero(),this._collisionMask=-1}return Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!1,configurable:!0}),i.prototype._initialize=function(t,e,n){this._velocity=e,h.e.NormalizeToRef(e,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=n,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(t,e,n,r,o){e.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),h.e.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var l=h.e.Dot(this._tempVector4,o);return!(l<0)&&(r.subtractToRef(t,this._tempVector3),h.e.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((l=h.e.Dot(this._tempVector4,o))<0)&&(h.e.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(l=h.e.Dot(this._tempVector4,o))>=0))},i.prototype._canDoCollision=function(t,e,n,r){var o=h.e.Distance(this._basePointWorld,t),l=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(o>this._velocityWorldLength+l+e)&&!!function(d,v,y,D){return!(d.x>y.x+D)&&!(y.x-D>v.x)&&!(d.y>y.y+D)&&!(y.y-D>v.y)&&!(d.z>y.z+D)&&!(y.z-D>v.z)}(n,r,this._basePointWorld,this._velocityWorldLength+l)},i.prototype._testTriangle=function(t,e,n,r,o,l,d){var v,y=!1;e||(e=[]),e[t]||(e[t]=new hs.a(0,0,0,0),e[t].copyFromPoints(n,r,o));var D=e[t];if(l||D.isFrontFacingTo(this._normalizedVelocity,0)){var w=D.signedDistanceTo(this._basePoint),F=h.e.Dot(D.normal,this._velocity);if(F==0){if(Math.abs(w)>=1)return;y=!0,v=0}else{var z=(1-w)/F;if((v=(-1-w)/F)>z){var k=z;z=v,v=k}if(v>1||z<0)return;v<0&&(v=0),v>1&&(v=1)}this._collisionPoint.copyFromFloats(0,0,0);var K=!1,ae=1;if(y||(this._basePoint.subtractToRef(D.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(v,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,r,o,D.normal)&&(K=!0,ae=v,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!K){var le=this._velocity.lengthSquared(),fe=le;this._basePoint.subtractToRef(n,this._tempVector);var me=2*h.e.Dot(this._velocity,this._tempVector),be=this._tempVector.lengthSquared()-1,Ee=ds(fe,me,be,ae);Ee.found&&(ae=Ee.root,K=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(r,this._tempVector),me=2*h.e.Dot(this._velocity,this._tempVector),be=this._tempVector.lengthSquared()-1,(Ee=ds(fe,me,be,ae)).found&&(ae=Ee.root,K=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(o,this._tempVector),me=2*h.e.Dot(this._velocity,this._tempVector),be=this._tempVector.lengthSquared()-1,(Ee=ds(fe,me,be,ae)).found&&(ae=Ee.root,K=!0,this._collisionPoint.copyFrom(o)),r.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var xe=this._edge.lengthSquared(),Ae=h.e.Dot(this._edge,this._velocity),Ie=h.e.Dot(this._edge,this._baseToVertex);if(fe=xe*-le+Ae*Ae,me=xe*(2*h.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,be=xe*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(Ee=ds(fe,me,be,ae)).found){var Re=(Ae*Ee.root-Ie)/xe;Re>=0&&Re<=1&&(ae=Ee.root,K=!0,this._edge.scaleInPlace(Re),n.addToRef(this._edge,this._collisionPoint))}o.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),xe=this._edge.lengthSquared(),Ae=h.e.Dot(this._edge,this._velocity),Ie=h.e.Dot(this._edge,this._baseToVertex),fe=xe*-le+Ae*Ae,me=xe*(2*h.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,be=xe*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(Ee=ds(fe,me,be,ae)).found&&(Re=(Ae*Ee.root-Ie)/xe)>=0&&Re<=1&&(ae=Ee.root,K=!0,this._edge.scaleInPlace(Re),r.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),xe=this._edge.lengthSquared(),Ae=h.e.Dot(this._edge,this._velocity),Ie=h.e.Dot(this._edge,this._baseToVertex),fe=xe*-le+Ae*Ae,me=xe*(2*h.e.Dot(this._velocity,this._baseToVertex))-2*Ae*Ie,be=xe*(1-this._baseToVertex.lengthSquared())+Ie*Ie,(Ee=ds(fe,me,be,ae)).found&&(Re=(Ae*Ee.root-Ie)/xe)>=0&&Re<=1&&(ae=Ee.root,K=!0,this._edge.scaleInPlace(Re),o.addToRef(this._edge,this._collisionPoint))}if(K){var Pe=ae*this._velocity.length();(!this.collisionFound||Pe<this._nearestDistance)&&(d.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=Pe,this.collisionFound=!0),this.collidedMesh=d)}}},i.prototype._collide=function(t,e,n,r,o,l,d,v){if(n&&n.length!==0)for(y=r;y<o;y+=3)D=e[n[y]-l],w=e[n[y+1]-l],F=e[n[y+2]-l],this._testTriangle(y,t,F,w,D,d,v);else for(var y=0;y<e.length;y+=3){var D=e[y],w=e[y+1],F=e[y+2];this._testTriangle(y,t,F,w,D,d,v)}},i.prototype._getResponse=function(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(hs.a.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)},i}(),xy=function(){function i(){this._scaledPosition=h.e.Zero(),this._scaledVelocity=h.e.Zero(),this._finalPosition=h.e.Zero()}return i.prototype.getNewPosition=function(t,e,n,r,o,l,d){t.divideToRef(n._radius,this._scaledPosition),e.divideToRef(n._radius,this._scaledVelocity),n.collidedMesh=null,n._retry=0,n._initialVelocity=this._scaledVelocity,n._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,n,r,this._finalPosition,o),this._finalPosition.multiplyInPlace(n._radius),l(d,this._finalPosition,n.collidedMesh)},i.prototype.createCollider=function(){return new Sy},i.prototype.init=function(t){this._scene=t},i.prototype._collideWithWorld=function(t,e,n,r,o,l){l===void 0&&(l=null);var d=10*He.a.CollisionsEpsilon;if(n._retry>=r)o.copyFrom(t);else{var v=l?l.collisionMask:n.collisionMask;n._initialize(t,e,d);for(var y=l&&l.surroundingMeshes||this._scene.meshes,D=0;D<y.length;D++){var w=y[D];w.isEnabled()&&w.checkCollisions&&w.subMeshes&&w!==l&&(v&w.collisionGroup)!=0&&w._checkCollision(n)}n.collisionFound?(e.x===0&&e.y===0&&e.z===0||n._getResponse(t,e),e.length()<=d?o.copyFrom(t):(n._retry++,this._collideWithWorld(t,e,n,r,o,l))):t.addToRef(e,o)}},i}();ne.a.CollisionCoordinatorFactory=function(){return new xy};var Pa=c(54),aI=c(114),sI=c(147),Pp=c(103),ko=c(43),Ay=c(113),Py=function(){function i(t,e,n,r,o,l){this.entries=new Array,this._boundingVectors=new Array,this._capacity=n,this._depth=r,this._maxDepth=o,this._creationFunc=l,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),i.prototype.addEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t);else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},i.prototype.removeEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t);else{var n=this.entries.indexOf(t);n>-1&&this.entries.splice(n,1)}},i.prototype.addEntries=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.addEntry(n)}},i.prototype.select=function(t,e,n){if(Pp.a.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++)this.blocks[r].select(t,e,n);return}n?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}},i.prototype.intersects=function(t,e,n,r){if(Pp.a.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(var o=0;o<this.blocks.length;o++)this.blocks[o].intersects(t,e,n,r);return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},i.prototype.intersectsRay=function(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var n=0;n<this.blocks.length;n++)this.blocks[n].intersectsRay(t,e);return}e.concatWithNoDuplicate(this.entries)}},i.prototype.createInnerBlocks=function(){i._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},i._CreateBlocks=function(t,e,n,r,o,l,d,v){d.blocks=new Array;for(var y=new h.e((e.x-t.x)/2,(e.y-t.y)/2,(e.z-t.z)/2),D=0;D<2;D++)for(var w=0;w<2;w++)for(var F=0;F<2;F++){var z=new i(t.add(y.multiplyByFloats(D,w,F)),t.add(y.multiplyByFloats(D+1,w+1,F+1)),r,o+1,l,v);z.addEntries(n),d.blocks.push(z)}},i}(),Kc=function(){function i(t,e,n){n===void 0&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new Gn.b(1024),this._creationFunc=t}return i.prototype.update=function(t,e,n){Py._CreateBlocks(t,e,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},i.prototype.addMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t)},i.prototype.removeMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t)},i.prototype.select=function(t,e){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++)this.blocks[n].select(t,this._selectionContent,e);return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersects=function(t,e,n){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++)this.blocks[r].intersects(t,e,this._selectionContent,n);return n?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersectsRay=function(t){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].intersectsRay(t,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.CreationFuncForMeshes=function(t,e){var n=t.getBoundingInfo();!t.isBlocked&&n.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i.CreationFuncForSubMeshes=function(t,e){t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i}();ne.a.prototype.createOrUpdateSelectionOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this._getComponent(dt.a.NAME_OCTREE);e||(e=new Ip(this),this._addComponent(e)),this._selectionOctree||(this._selectionOctree=new Kc(Kc.CreationFuncForMeshes,i,t));var n=this.getWorldExtends();return this._selectionOctree.update(n.min,n.max,this.meshes),this._selectionOctree},Object.defineProperty(ne.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),jt.a.prototype.createOrUpdateSubmeshesOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this.getScene(),n=e._getComponent(dt.a.NAME_OCTREE);n||(n=new Ip(e),e._addComponent(n)),this._submeshesOctree||(this._submeshesOctree=new Kc(Kc.CreationFuncForSubMeshes,i,t)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree};var En,Cp,Rp,Op,Mp,Ip=function(){function i(t){this.name=dt.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Qn.a(h.e.Zero(),new h.e(1,1,1)),this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return i.prototype.register=function(){var t=this;this.scene.onMeshRemovedObservable.add(function(e){var n=t.scene.selectionOctree;if(n!=null){var r=n.dynamicContent.indexOf(e);r!==-1&&n.dynamicContent.splice(r,1)}}),this.scene.onMeshImportedObservable.add(function(e){var n=t.scene.selectionOctree;n!=null&&n.addMesh(e)})},i.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},i.prototype.getActiveSubMeshCandidates=function(t){return t._submeshesOctree&&t.useOctreeForRenderingSelection?t._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getIntersectingSubMeshCandidates=function(t,e){return t._submeshesOctree&&t.useOctreeForPicking?(Qn.a.TransformToRef(e,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getCollidingSubMeshCandidates=function(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){var n=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,n)}return this.scene._getDefaultSubMeshCandidates(t)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}(),Ca=c(99);(function(i){i[i.Generic=0]="Generic",i[i.Keyboard=1]="Keyboard",i[i.Mouse=2]="Mouse",i[i.Touch=3]="Touch",i[i.DualShock=4]="DualShock",i[i.Xbox=5]="Xbox",i[i.Switch=6]="Switch"})(En||(En={})),function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.LeftClick=2]="LeftClick",i[i.MiddleClick=3]="MiddleClick",i[i.RightClick=4]="RightClick",i[i.BrowserBack=5]="BrowserBack",i[i.BrowserForward=6]="BrowserForward"}(Cp||(Cp={})),function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.L2=6]="L2",i[i.R2=7]="R2",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.L3=10]="L3",i[i.R3=11]="R3",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.TouchPad=17]="TouchPad",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Rp||(Rp={})),function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.LT=6]="LT",i[i.RT=7]="RT",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.LStickXAxis=17]="LStickXAxis",i[i.LStickYAxis=18]="LStickYAxis",i[i.RStickXAxis=19]="RStickXAxis",i[i.RStickYAxis=20]="RStickYAxis"}(Op||(Op={})),function(i){i[i.B=0]="B",i[i.A=1]="A",i[i.Y=2]="Y",i[i.X=3]="X",i[i.L=4]="L",i[i.R=5]="R",i[i.ZL=6]="ZL",i[i.ZR=7]="ZR",i[i.Minus=8]="Minus",i[i.Plus=9]="Plus",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.Capture=17]="Capture",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Mp||(Mp={}));var Cy=function(){function i(t){this.onDeviceDisconnected=function(){},this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._keyboardDownEvent=function(n){},this._keyboardUpEvent=function(n){},this._pointerMoveEvent=function(n){},this._pointerDownEvent=function(n){},this._pointerUpEvent=function(n){},this._gamepadConnectedEvent=function(n){},this._gamepadDisconnectedEvent=function(n){},this._onDeviceConnected=function(){};var e=t.getInputElement();e&&(this._elementToAttachTo=e,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._checkForConnectedDevices())}return Object.defineProperty(i.prototype,"onDeviceConnected",{get:function(){return this._onDeviceConnected},set:function(t){this._onDeviceConnected=t;for(var e=0;e<this._inputs.length;e++)if(this._inputs[e])for(var n=0;n<this._inputs[e].length;n++)this._inputs[e][n]&&this._onDeviceConnected(e,n)},enumerable:!1,configurable:!0}),i.Create=function(t){return typeof _native!="undefined"&&_native.DeviceInputSystem?new _native.DeviceInputSystem(t):new i(t)},i.prototype.pollInput=function(t,e,n){var r=this._inputs[t][e];if(!r)throw"Unable to find device "+En[t];if(this._updateDevice(t,e,n),r[n]===void 0)throw"Unable to find input "+n+" for device "+En[t]+" in slot "+e;return r[n]},i.prototype.dispose=function(){this._keyboardActive&&(window.removeEventListener("keydown",this._keyboardDownEvent),window.removeEventListener("keyup",this._keyboardUpEvent)),this._pointerActive&&(this._elementToAttachTo.removeEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.removeEventListener("pointerup",this._pointerUpEvent)),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._checkForConnectedDevices=function(){for(var t=0,e=navigator.getGamepads();t<e.length;t++){var n=e[t];n&&this._addGamePad(n)}matchMedia("(pointer:fine)").matches&&this._addPointerDevice(En.Mouse,0,0,0)},i.prototype._addGamePad=function(t){var e=this._getGamepadDeviceType(t.id),n=t.index;this._registerDevice(e,n,t.buttons.length+t.axes.length),this._gamepads=this._gamepads||new Array(t.index+1),this._gamepads[n]=e},i.prototype._addPointerDevice=function(t,e,n,r){this._pointerActive=!0,this._registerDevice(t,e,i._MAX_POINTER_INPUTS);var o=this._inputs[t][e];o[0]=n,o[1]=r},i.prototype._registerDevice=function(t,e,n){if(this._inputs[t]||(this._inputs[t]=[]),!this._inputs[t][e]){for(var r=new Array(n),o=0;o<n;o++)r[o]=0;this._inputs[t][e]=r,this.onDeviceConnected(t,e)}},i.prototype._unregisterDevice=function(t,e){this._inputs[t][e]&&(delete this._inputs[t][e],this.onDeviceDisconnected(t,e))},i.prototype._handleKeyActions=function(){var t=this;this._keyboardDownEvent=function(e){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(En.Keyboard,0,i._MAX_KEYCODES));var n=t._inputs[En.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(En.Keyboard,0,e.keyCode,n[e.keyCode],1),n[e.keyCode]=1)},this._keyboardUpEvent=function(e){var n=t._inputs[En.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(En.Keyboard,0,e.keyCode,n[e.keyCode],0),n[e.keyCode]=0)},window.addEventListener("keydown",this._keyboardDownEvent),window.addEventListener("keyup",this._keyboardUpEvent)},i.prototype._handlePointerActions=function(){var t=this;this._pointerMoveEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY)),o[0]=e.clientX,o[1]=e.clientY)},this._pointerDownEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY),t.onInputChanged(n,r,e.button+2,o[e.button+2],1)),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=1)},this._pointerUpEvent=function(e){var n=e.pointerType=="mouse"?En.Mouse:En.Touch,r=e.pointerType=="mouse"?0:e.pointerId,o=t._inputs[n][r];o&&(t.onInputChanged&&t.onInputChanged(n,r,e.button+2,o[e.button+2],0),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=0),e.pointerType!="mouse"&&t._unregisterDevice(n,r)},this._elementToAttachTo.addEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.addEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.addEventListener("pointerup",this._pointerUpEvent)},i.prototype._handleGamepadActions=function(){var t=this;this._gamepadConnectedEvent=function(e){t._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=function(e){if(t._gamepads){var n=t._getGamepadDeviceType(e.gamepad.id),r=e.gamepad.index;t._unregisterDevice(n,r),delete t._gamepads[r]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._updateDevice=function(t,e,n){var r=navigator.getGamepads()[e];if(r&&t==this._gamepads[e]){var o=this._inputs[t][e];n>=r.buttons.length?o[n]=r.axes[n-r.buttons.length].valueOf():o[n]=r.buttons[n].value}},i.prototype._getGamepadDeviceType=function(t){return t.indexOf("054c")!==-1?En.DualShock:t.indexOf("Xbox One")!==-1||t.search("Xbox 360")!==-1||t.search("xinput")!==-1?En.Xbox:t.indexOf("057e")!==-1?En.Switch:En.Generic},i._MAX_KEYCODES=255,i._MAX_POINTER_INPUTS=7,i}(),Ry=function(){function i(t,e,n){n===void 0&&(n=0),this.deviceType=e,this.deviceSlot=n,this.onInputChangedObservable=new S.c,this._deviceInputSystem=t}return i.prototype.getInput=function(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)},i}(),cI=function(){function i(t){var e=this;this.onDeviceConnectedObservable=new S.c(function(r){e.getDevices().forEach(function(o){e.onDeviceConnectedObservable.notifyObserver(r,o)})}),this.onDeviceDisconnectedObservable=new S.c;var n=Object.keys(En).length/2;this._devices=new Array(n),this._firstDevice=new Array(n),this._deviceInputSystem=Cy.Create(t),this._deviceInputSystem.onDeviceConnected=function(r,o){e._addDevice(r,o),e.onDeviceConnectedObservable.notifyObservers(e.getDeviceSource(r,o))},this._deviceInputSystem.onDeviceDisconnected=function(r,o){var l=e.getDeviceSource(r,o);e._removeDevice(r,o),e.onDeviceDisconnectedObservable.notifyObservers(l)},this._deviceInputSystem.onInputChanged||(this._deviceInputSystem.onInputChanged=function(r,o,l,d,v){var y;(y=e.getDeviceSource(r,o))===null||y===void 0||y.onInputChangedObservable.notifyObservers({inputIndex:l,previousState:d,currentState:v})})}return i.prototype.getDeviceSource=function(t,e){if(e===void 0){if(this._firstDevice[t]===void 0)return null;e=this._firstDevice[t]}return this._devices[t]&&this._devices[t][e]!==void 0?this._devices[t][e]:null},i.prototype.getDeviceSources=function(t){return this._devices[t].filter(function(e){return!!e})},i.prototype.getDevices=function(){var t=new Array;return this._devices.forEach(function(e){t.push.apply(t,e)}),t},i.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._deviceInputSystem.dispose()},i.prototype._addDevice=function(t,e){this._devices[t]||(this._devices[t]=new Array),this._devices[t][e]||(this._devices[t][e]=new Ry(this._deviceInputSystem,t,e),this._updateFirstDevices(t))},i.prototype._removeDevice=function(t,e){delete this._devices[t][e],this._updateFirstDevices(t)},i.prototype._updateFirstDevices=function(t){switch(t){case En.Keyboard:case En.Mouse:this._firstDevice[t]=0;break;case En.Touch:case En.DualShock:case En.Xbox:case En.Switch:case En.Generic:var e=this._devices[t];delete this._firstDevice[t];for(var n=0;n<e.length;n++)if(e[n]){this._firstDevice[t]=n;break}}},i}(),Oy=c(168),My=(c(123),function(){this._timeElapsedQueryEnded=!1}),Iy=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=jt.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=jt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};He.a.prototype.createQuery=function(){return this._gl.createQuery()},He.a.prototype.deleteQuery=function(i){return this._gl.deleteQuery(i),this},He.a.prototype.isQueryResultAvailable=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT_AVAILABLE)},He.a.prototype.getQueryResult=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT)},He.a.prototype.beginOcclusionQuery=function(i,t){var e=this._getGlAlgorithmType(i);return this._gl.beginQuery(e,t),this},He.a.prototype.endOcclusionQuery=function(i){var t=this._getGlAlgorithmType(i);return this._gl.endQuery(t),this},He.a.prototype._createTimeQuery=function(){var i=this.getCaps().timerQuery;return i.createQueryEXT?i.createQueryEXT():this.createQuery()},He.a.prototype._deleteTimeQuery=function(i){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(i):this.deleteQuery(i)},He.a.prototype._getTimeQueryResult=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_EXT):this.getQueryResult(i)},He.a.prototype._getTimeQueryAvailability=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(i)},He.a.prototype.startTimeQuery=function(){var i=this.getCaps(),t=i.timerQuery;if(!t)return null;var e=new My;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),i.canUseTimestampForTimerQuery)e._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(e._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;e._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,e._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,e._timeElapsedQuery),this._currentNonTimestampToken=e}return e},He.a.prototype.endTimeQuery=function(i){var t=this.getCaps(),e=t.timerQuery;if(!e||!i)return-1;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery)return-1;i._endTimeQuery||(i._endTimeQuery=this._createTimeQuery(),e.queryCounterEXT(i._endTimeQuery,e.TIMESTAMP_EXT))}else if(!i._timeElapsedQueryEnded){if(!i._timeElapsedQuery)return-1;e.endQueryEXT?e.endQueryEXT(e.TIME_ELAPSED_EXT):this._gl.endQuery(e.TIME_ELAPSED_EXT),i._timeElapsedQueryEnded=!0}var n=this._gl.getParameter(e.GPU_DISJOINT_EXT),r=!1;if(i._endTimeQuery?r=this._getTimeQueryAvailability(i._endTimeQuery):i._timeElapsedQuery&&(r=this._getTimeQueryAvailability(i._timeElapsedQuery)),r&&!n){var o=0;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery||!i._endTimeQuery)return-1;var l=this._getTimeQueryResult(i._startTimeQuery);o=this._getTimeQueryResult(i._endTimeQuery)-l,this._deleteTimeQuery(i._startTimeQuery),this._deleteTimeQuery(i._endTimeQuery),i._startTimeQuery=null,i._endTimeQuery=null}else{if(!i._timeElapsedQuery)return-1;o=this._getTimeQueryResult(i._timeElapsedQuery),this._deleteTimeQuery(i._timeElapsedQuery),i._timeElapsedQuery=null,i._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},He.a.prototype._getGlAlgorithmType=function(i){return i===jt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(jt.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(i){this._occlusionDataStorage.isOcclusionQueryInProgress=i},enumerable:!1,configurable:!0}),Object.defineProperty(jt.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new Iy),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(jt.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(i){this._occlusionDataStorage.isOccluded=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(i){this._occlusionDataStorage.occlusionQueryAlgorithmType=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(i){this._occlusionDataStorage.occlusionType=i},enumerable:!0,configurable:!0}),Object.defineProperty(jt.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(i){this._occlusionDataStorage.occlusionRetryCount=i},enumerable:!0,configurable:!0}),jt.a.prototype._checkOcclusionQuery=function(){var i=this._occlusionDataStorage;if(i.occlusionType===jt.a.OCCLUSION_TYPE_NONE)return i.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2||!t.isQueryResultAvailable)return i.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var e=t.getQueryResult(this._occlusionQuery);i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=e!==1}else{if(i.occlusionInternalRetryCounter++,!(i.occlusionRetryCount!==-1&&i.occlusionInternalRetryCounter>i.occlusionRetryCount))return!1;i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=i.occlusionType!==jt.a.OCCLUSION_TYPE_OPTIMISTIC&&i.isOccluded}var n=this.getScene();if(n.getBoundingBoxRenderer){var r=n.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(i.occlusionQueryAlgorithmType,this._occlusionQuery),r.renderOcclusionBoundingBox(this),t.endOcclusionQuery(i.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return i.isOccluded};var lI=!0;He.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},He.a.prototype.deleteTransformFeedback=function(i){this._gl.deleteTransformFeedback(i)},He.a.prototype.bindTransformFeedback=function(i){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,i)},He.a.prototype.beginTransformFeedback=function(i){i===void 0&&(i=!0),this._gl.beginTransformFeedback(i?this._gl.POINTS:this._gl.TRIANGLES)},He.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},He.a.prototype.setTranformFeedbackVaryings=function(i,t){this._gl.transformFeedbackVaryings(i,t,this._gl.INTERLEAVED_ATTRIBS)},He.a.prototype.bindTransformFeedbackBuffer=function(i){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,i?i.underlyingResource:null)},c(126),en.a.prototype.updateVideoTexture=function(i,t,e){if(i&&!i._isDisabled){var n=this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);this._unpackFlipY(!e);try{if(this._videoTextureSupported===void 0&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.getError()!==0?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!i._workingCanvas){i._workingCanvas=Sp.a.CreateCanvas(i.width,i.height);var r=i._workingCanvas.getContext("2d");if(!r)throw new Error("Unable to get 2d context");i._workingContext=r,i._workingCanvas.width=i.width,i._workingCanvas.height=i.height}i._workingContext.clearRect(0,0,i.width,i.height),i._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,i.width,i.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i._workingCanvas)}i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),n||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}catch(o){i._isDisabled=!0}}},en.a.prototype.restoreSingleAttachment=function(){var i=this._gl;this.bindAttachments([i.BACK])},en.a.prototype.buildTextureLayout=function(i){for(var t=this._gl,e=[],n=0;n<i.length;n++)i[n]?e.push(t["COLOR_ATTACHMENT"+n]):e.push(t.NONE);return e},en.a.prototype.bindAttachments=function(i){this._gl.drawBuffers(i)},en.a.prototype.unBindMultiColorAttachmentFramebuffer=function(i,t,e){t===void 0&&(t=!1),this._currentRenderTarget=null;var n=this._gl,r=i[0]._attachments,o=r.length;if(i[0]._MSAAFramebuffer){n.bindFramebuffer(n.READ_FRAMEBUFFER,i[0]._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,i[0]._framebuffer);for(var l=0;l<o;l++){for(var d=i[l],v=0;v<o;v++)r[v]=n.NONE;r[l]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+l:"COLOR_ATTACHMENT"+l+"_WEBGL"],n.readBuffer(r[l]),n.drawBuffers(r),n.blitFramebuffer(0,0,d.width,d.height,0,0,d.width,d.height,n.COLOR_BUFFER_BIT,n.NEAREST)}for(l=0;l<o;l++)r[l]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+l:"COLOR_ATTACHMENT"+l+"_WEBGL"];n.drawBuffers(r)}for(l=0;l<o;l++)!(d=i[l]).generateMipMaps||t||d.isCube||(this._bindTextureDirectly(n.TEXTURE_2D,d,!0),n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null));e&&(i[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(i[0]._framebuffer),e()),this._bindUnboundFramebuffer(null)},en.a.prototype.createMultipleRenderTarget=function(i,t){var e=!1,n=!0,r=!1,o=!1,l=1,d=g.a.TEXTURETYPE_UNSIGNED_INT,v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,y=new Array,D=new Array;t!==void 0&&(e=t.generateMipMaps!==void 0&&t.generateMipMaps,n=t.generateDepthBuffer===void 0||t.generateDepthBuffer,r=t.generateStencilBuffer!==void 0&&t.generateStencilBuffer,o=t.generateDepthTexture!==void 0&&t.generateDepthTexture,l=t.textureCount||1,t.types&&(y=t.types),t.samplingModes&&(D=t.samplingModes));var w=this._gl,F=w.createFramebuffer();this._bindUnboundFramebuffer(F);for(var z=i.width||i,k=i.height||i,K=[],ae=[],le=this._setupFramebufferDepthAttachments(r,n,z,k),fe=0;fe<l;fe++){var me=D[fe]||v,be=y[fe]||d;(be!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(be!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(me=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var Ee=this._getSamplingParameters(me,e);be!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(be=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var xe=new Nt.a(this,Nt.b.MultiRenderTarget),Ae=w[this.webGLVersion>1?"COLOR_ATTACHMENT"+fe:"COLOR_ATTACHMENT"+fe+"_WEBGL"];K.push(xe),ae.push(Ae),w.activeTexture(w["TEXTURE"+fe]),w.bindTexture(w.TEXTURE_2D,xe._webGLTexture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,Ee.mag),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,Ee.min),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texImage2D(w.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(be),z,k,0,w.RGBA,this._getWebGLTextureType(be),null),w.framebufferTexture2D(w.DRAW_FRAMEBUFFER,Ae,w.TEXTURE_2D,xe._webGLTexture,0),e&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(w.TEXTURE_2D,null),xe._framebuffer=F,xe._depthStencilBuffer=le,xe.baseWidth=z,xe.baseHeight=k,xe.width=z,xe.height=k,xe.isReady=!0,xe.samples=1,xe.generateMipMaps=e,xe.samplingMode=me,xe.type=be,xe._generateDepthBuffer=n,xe._generateStencilBuffer=r,xe._attachments=ae,xe._textureArray=K,this._internalTexturesCache.push(xe)}if(o&&this._caps.depthTextureExtension){var Ie=new Nt.a(this,Nt.b.MultiRenderTarget);w.activeTexture(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,Ie._webGLTexture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texImage2D(w.TEXTURE_2D,0,this.webGLVersion<2?w.DEPTH_COMPONENT:w.DEPTH_COMPONENT16,z,k,0,w.DEPTH_COMPONENT,w.UNSIGNED_SHORT,null),w.framebufferTexture2D(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.TEXTURE_2D,Ie._webGLTexture,0),Ie._framebuffer=F,Ie.baseWidth=z,Ie.baseHeight=k,Ie.width=z,Ie.height=k,Ie.isReady=!0,Ie.samples=1,Ie.generateMipMaps=e,Ie.samplingMode=w.NEAREST,Ie._generateDepthBuffer=n,Ie._generateStencilBuffer=r,K.push(Ie),this._internalTexturesCache.push(Ie)}return w.drawBuffers(ae),this._bindUnboundFramebuffer(null),this.resetTextureCache(),K},en.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(i,t){if(this.webGLVersion<2||!i)return 1;if(i[0].samples===t)return t;var e=i[0]._attachments.length;if(e===0)return 1;var n=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),i[0]._depthStencilBuffer&&(n.deleteRenderbuffer(i[0]._depthStencilBuffer),i[0]._depthStencilBuffer=null),i[0]._MSAAFramebuffer&&(n.deleteFramebuffer(i[0]._MSAAFramebuffer),i[0]._MSAAFramebuffer=null);for(var r=0;r<e;r++)i[r]._MSAARenderBuffer&&(n.deleteRenderbuffer(i[r]._MSAARenderBuffer),i[r]._MSAARenderBuffer=null);if(t>1&&n.renderbufferStorageMultisample){var o=n.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(o);var l=this._setupFramebufferDepthAttachments(i[0]._generateStencilBuffer,i[0]._generateDepthBuffer,i[0].width,i[0].height,t),d=[];for(r=0;r<e;r++){var v=i[r],y=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+r:"COLOR_ATTACHMENT"+r+"_WEBGL"],D=n.createRenderbuffer();if(!D)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,D),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(v.type),v.width,v.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,y,n.RENDERBUFFER,D),v._MSAAFramebuffer=o,v._MSAARenderBuffer=D,v.samples=t,v._depthStencilBuffer=l,n.bindRenderbuffer(n.RENDERBUFFER,null),d.push(y)}n.drawBuffers(d)}else this._bindUnboundFramebuffer(i[0]._framebuffer);return this._bindUnboundFramebuffer(null),t};var Qc=c(56);en.a.prototype._createDepthStencilCubeTexture=function(i,t){var e=new Nt.a(this,Nt.b.Unknown);if(e.isCube=!0,this.webGLVersion===1)return _.a.Error("Depth cube texture is not supported by WebGL 1."),e;var n=Object(f.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,i,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var o=0;o<6;o++)n.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH24_STENCIL8,i,i,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH_COMPONENT24,i,i,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),e},en.a.prototype._partialLoadFile=function(i,t,e,n,r){r===void 0&&(r=null),this._loadFile(i,function(o){e[t]=o,e._internalCount++,e._internalCount===6&&n(e)},void 0,void 0,!0,function(o,l){r&&o&&r(o.status+" "+o.statusText,l)})},en.a.prototype._cascadeLoadFiles=function(i,t,e,n){n===void 0&&(n=null);var r=[];r._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(e[o],o,r,t,n)},en.a.prototype._cascadeLoadImgs=function(i,t,e,n,r){n===void 0&&(n=null);var o=[];o._internalCount=0;for(var l=0;l<6;l++)this._partialLoadImg(e[l],l,o,i,t,n,r)},en.a.prototype._partialLoadImg=function(i,t,e,n,r,o,l){var d;o===void 0&&(o=null),d=Qc.a.LoadImage(i,function(){d&&(e[t]=d,e._internalCount++,n&&n._removePendingData(d)),e._internalCount===6&&r(e)},function(v,y){n&&n._removePendingData(d),o&&o(v,y)},n?n.offlineProvider:null,l),n&&d&&n._addPendingData(d)},en.a.prototype._setCubeMapTextureParams=function(i,t){var e=this._gl;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i.samplingMode=t?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.a.TEXTURE_LINEAR_LINEAR,this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)},en.a.prototype.createCubeTexture=function(i,t,e,n,r,o,l,d,v,y,D,w,F){var z=this;r===void 0&&(r=null),o===void 0&&(o=null),d===void 0&&(d=null),v===void 0&&(v=!1),y===void 0&&(y=0),D===void 0&&(D=0),w===void 0&&(w=null);var k=this._gl,K=w||new Nt.a(this,Nt.b.Cube);K.isCube=!0,K.url=i,K.generateMipMaps=!n,K._lodGenerationScale=y,K._lodGenerationOffset=D,this._doNotHandleContextLost||(K._extension=d,K._files=e);var ae=i;this._transformTextureUrl&&!w&&(i=this._transformTextureUrl(i));for(var le=i.lastIndexOf("."),fe=d||(le>-1?i.substring(le).toLowerCase():""),me=null,be=0,Ee=en.a._TextureLoaders;be<Ee.length;be++){var xe=Ee[be];if(xe.canLoad(fe)){me=xe;break}}if(me){var Ae=function(Ie){z._bindTextureDirectly(k.TEXTURE_CUBE_MAP,K,!0),me.loadCubeData(Ie,K,v,r,o)};e&&e.length===6?me.supportCascades?this._cascadeLoadFiles(t,function(Ie){return Ae(Ie.map(function(Re){return new Uint8Array(Re)}))},e,o):o?o("Textures type does not support cascades."):_.a.Warn("Texture loader does not support cascades."):this._loadFile(i,function(Ie){return Ae(new Uint8Array(Ie))},void 0,void 0,!0,function(Ie,Re){i===ae?o&&Ie&&o(Ie.status+" "+Ie.statusText,Re):(_.a.Warn("Failed to load "+i+", falling back to the "+ae),z.createCubeTexture(ae,t,e,n,r,o,l,d,v,y,D,K,F))})}else{if(!e)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(Ie){var Re=z.needPOTTextures?en.a.GetExponentOfTwo(Ie[0].width,z._caps.maxCubemapTextureSize):Ie[0].width,Pe=Re,Ce=[k.TEXTURE_CUBE_MAP_POSITIVE_X,k.TEXTURE_CUBE_MAP_POSITIVE_Y,k.TEXTURE_CUBE_MAP_POSITIVE_Z,k.TEXTURE_CUBE_MAP_NEGATIVE_X,k.TEXTURE_CUBE_MAP_NEGATIVE_Y,k.TEXTURE_CUBE_MAP_NEGATIVE_Z];z._bindTextureDirectly(k.TEXTURE_CUBE_MAP,K,!0),z._unpackFlipY(!1);for(var Ue=l?z._getInternalFormat(l):z._gl.RGBA,Oe=0;Oe<Ce.length;Oe++)if(Ie[Oe].width!==Re||Ie[Oe].height!==Pe){if(z._prepareWorkingCanvas(),!z._workingCanvas||!z._workingContext)return void _.a.Warn("Cannot create canvas to resize texture.");z._workingCanvas.width=Re,z._workingCanvas.height=Pe,z._workingContext.drawImage(Ie[Oe],0,0,Ie[Oe].width,Ie[Oe].height,0,0,Re,Pe),k.texImage2D(Ce[Oe],0,Ue,Ue,k.UNSIGNED_BYTE,z._workingCanvas)}else k.texImage2D(Ce[Oe],0,Ue,Ue,k.UNSIGNED_BYTE,Ie[Oe]);n||k.generateMipmap(k.TEXTURE_CUBE_MAP),z._setCubeMapTextureParams(K,!n),K.width=Re,K.height=Pe,K.isReady=!0,l&&(K.format=l),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),r&&r()},e,o)}return this._internalTexturesCache.push(K),K},c(153),c(124);var uI=function(){};He.a.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},He.a.prototype.registerView=function(i,t){var e=this;this.views||(this.views=[]);for(var n=0,r=this.views;n<r.length;n++){var o=r[n];if(o.target===i)return o}var l=this.getRenderingCanvas();l&&(i.width=l.width,i.height=l.height);var d={target:i,camera:t};return this.views.push(d),t&&t.onDisposeObservable.add(function(){e.unRegisterView(i)}),d},He.a.prototype.unRegisterView=function(i){if(!this.views)return this;for(var t=0,e=this.views;t<e.length;t++){var n=e[t];if(n.target===i){var r=this.views.indexOf(n);r!==-1&&this.views.splice(r,1);break}}return this},He.a.prototype._renderViews=function(){if(!this.views)return!1;var i=this.getRenderingCanvas();if(!i)return!1;for(var t=0,e=this.views;t<e.length;t++){var n=e[t],r=n.target,o=r.getContext("2d");if(o){var l=n.camera,d=null,v=null;if(l){if((v=l.getScene()).activeCameras&&v.activeCameras.length)continue;this.activeView=n,d=v.activeCamera,v.activeCamera=l}var y=r.width!==r.clientWidth||r.height!==r.clientHeight;if(r.clientWidth&&r.clientHeight&&y&&(r.width=r.clientWidth,r.height=r.clientHeight,i.width=r.clientWidth,i.height=r.clientHeight,this.resize()),!i.width||!i.height)return!1;this._renderFrame(),o.drawImage(i,0,0),d&&v&&(v.activeCamera=d)}}return this.activeView=null,!0},c(129);function hI(i){if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some(function(r){var o="\\b"+r+"\\b";return i&&(i===r||i.match(new RegExp(o,"g")))}))return i;var t=i.lastIndexOf("."),e=i.lastIndexOf("?"),n=e>-1?i.substring(e,i.length):"";return(t>-1?i.substring(0,t):i)+this._textureFormatInUse+n}Object.defineProperty(He.a.prototype,"texturesSupported",{get:function(){var i=new Array;return this._caps.astc&&i.push("-astc.ktx"),this._caps.s3tc&&i.push("-dxt.ktx"),this._caps.pvrtc&&i.push("-pvrtc.ktx"),this._caps.etc2&&i.push("-etc2.ktx"),this._caps.etc1&&i.push("-etc1.ktx"),i},enumerable:!0,configurable:!0}),Object.defineProperty(He.a.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0}),He.a.prototype.setCompressedTextureExclusions=function(i){this._excludedCompressedTextures=i},He.a.prototype.setTextureFormatToUse=function(i){for(var t=this.texturesSupported,e=0,n=t.length;e<n;e++)for(var r=0,o=i.length;r<o;r++)if(t[e]===i[r].toLowerCase())return this._transformTextureUrl=hI.bind(this),this._textureFormatInUse=t[e];return this._textureFormatInUse="",this._transformTextureUrl=null,null};var dI=c(144),Dy=c(118),wy=c(89),ki=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],fI=[function(i){return 1},function(i){return i.y},function(i){return i.z},function(i){return i.x},function(i){return i.x*i.y},function(i){return i.y*i.z},function(i){return 3*i.z*i.z-1},function(i){return i.x*i.z},function(i){return i.x*i.x-i.y*i.y}],no=function(i,t){return ki[i]*fI[i](t)},ro=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],Dp=function(){function i(){this.preScaled=!1,this.l00=h.e.Zero(),this.l1_1=h.e.Zero(),this.l10=h.e.Zero(),this.l11=h.e.Zero(),this.l2_2=h.e.Zero(),this.l2_1=h.e.Zero(),this.l20=h.e.Zero(),this.l21=h.e.Zero(),this.l22=h.e.Zero()}return i.prototype.addLight=function(t,e,n){var r=new h.e(e.r,e.g,e.b).scale(n);this.l00=this.l00.add(r.scale(no(0,t))),this.l1_1=this.l1_1.add(r.scale(no(1,t))),this.l10=this.l10.add(r.scale(no(2,t))),this.l11=this.l11.add(r.scale(no(3,t))),this.l2_2=this.l2_2.add(r.scale(no(4,t))),this.l2_1=this.l2_1.add(r.scale(no(5,t))),this.l20=this.l20.add(r.scale(no(6,t))),this.l21=this.l21.add(r.scale(no(7,t))),this.l22=this.l22.add(r.scale(no(8,t)))},i.prototype.scaleInPlace=function(t){this.l00.scaleInPlace(t),this.l1_1.scaleInPlace(t),this.l10.scaleInPlace(t),this.l11.scaleInPlace(t),this.l2_2.scaleInPlace(t),this.l2_1.scaleInPlace(t),this.l20.scaleInPlace(t),this.l21.scaleInPlace(t),this.l22.scaleInPlace(t)},i.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(ro[0]),this.l1_1.scaleInPlace(ro[1]),this.l10.scaleInPlace(ro[2]),this.l11.scaleInPlace(ro[3]),this.l2_2.scaleInPlace(ro[4]),this.l2_1.scaleInPlace(ro[5]),this.l20.scaleInPlace(ro[6]),this.l21.scaleInPlace(ro[7]),this.l22.scaleInPlace(ro[8])},i.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},i.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(ki[0]),this.l1_1.scaleInPlace(ki[1]),this.l10.scaleInPlace(ki[2]),this.l11.scaleInPlace(ki[3]),this.l2_2.scaleInPlace(ki[4]),this.l2_1.scaleInPlace(ki[5]),this.l20.scaleInPlace(ki[6]),this.l21.scaleInPlace(ki[7]),this.l22.scaleInPlace(ki[8])},i.FromArray=function(t){var e=new i;return h.e.FromArrayToRef(t[0],0,e.l00),h.e.FromArrayToRef(t[1],0,e.l1_1),h.e.FromArrayToRef(t[2],0,e.l10),h.e.FromArrayToRef(t[3],0,e.l11),h.e.FromArrayToRef(t[4],0,e.l2_2),h.e.FromArrayToRef(t[5],0,e.l2_1),h.e.FromArrayToRef(t[6],0,e.l20),h.e.FromArrayToRef(t[7],0,e.l21),h.e.FromArrayToRef(t[8],0,e.l22),e},i.FromPolynomial=function(t){var e=new i;return e.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),e.l1_1=t.y.scale(.977204),e.l10=t.z.scale(.977204),e.l11=t.x.scale(.977204),e.l2_2=t.xy.scale(1.16538),e.l2_1=t.yz.scale(1.16538),e.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),e.l21=t.zx.scale(1.16538),e.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),e.l1_1.scaleInPlace(-1),e.l11.scaleInPlace(-1),e.l2_1.scaleInPlace(-1),e.l21.scaleInPlace(-1),e.scaleInPlace(Math.PI),e},i}(),qc=function(){function i(){this.x=h.e.Zero(),this.y=h.e.Zero(),this.z=h.e.Zero(),this.xx=h.e.Zero(),this.yy=h.e.Zero(),this.zz=h.e.Zero(),this.xy=h.e.Zero(),this.yz=h.e.Zero(),this.zx=h.e.Zero()}return Object.defineProperty(i.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=Dp.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),i.prototype.addAmbient=function(t){var e=new h.e(t.r,t.g,t.b);this.xx=this.xx.add(e),this.yy=this.yy.add(e),this.zz=this.zz.add(e)},i.prototype.scaleInPlace=function(t){this.x.scaleInPlace(t),this.y.scaleInPlace(t),this.z.scaleInPlace(t),this.xx.scaleInPlace(t),this.yy.scaleInPlace(t),this.zz.scaleInPlace(t),this.yz.scaleInPlace(t),this.zx.scaleInPlace(t),this.xy.scaleInPlace(t)},i.FromHarmonics=function(t){var e=new i;return e._harmonics=t,e.x=t.l11.scale(1.02333).scale(-1),e.y=t.l1_1.scale(1.02333).scale(-1),e.z=t.l10.scale(1.02333),e.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)),e.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)),e.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),e.yz=t.l2_1.scale(.858086).scale(-1),e.zx=t.l21.scale(.858086).scale(-1),e.xy=t.l2_2.scale(.858086),e.scaleInPlace(1/Math.PI),e},i.FromArray=function(t){var e=new i;return h.e.FromArrayToRef(t[0],0,e.x),h.e.FromArrayToRef(t[1],0,e.y),h.e.FromArrayToRef(t[2],0,e.z),h.e.FromArrayToRef(t[3],0,e.xx),h.e.FromArrayToRef(t[4],0,e.yy),h.e.FromArrayToRef(t[5],0,e.zz),h.e.FromArrayToRef(t[6],0,e.yz),h.e.FromArrayToRef(t[7],0,e.zx),h.e.FromArrayToRef(t[8],0,e.xy),e},i}(),Zr=c(52),fs=function(i,t,e,n){this.name=i,this.worldAxisForNormal=t,this.worldAxisForFileX=e,this.worldAxisForFileY=n},$u=function(){function i(){}return i.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var e,n,r=t.getSize().width,o=t.readPixels(0),l=t.readPixels(1);t.isRenderTarget?(e=t.readPixels(3),n=t.readPixels(2)):(e=t.readPixels(2),n=t.readPixels(3));var d=t.readPixels(4),v=t.readPixels(5),y=t.gammaSpace,D=g.a.TEXTUREFORMAT_RGBA,w=g.a.TEXTURETYPE_UNSIGNED_INT;t.textureType!=g.a.TEXTURETYPE_FLOAT&&t.textureType!=g.a.TEXTURETYPE_HALF_FLOAT||(w=g.a.TEXTURETYPE_FLOAT);var F={size:r,right:o,left:l,up:e,down:n,front:d,back:v,format:D,type:w,gammaSpace:y};return this.ConvertCubeMapToSphericalPolynomial(F)},i.ConvertCubeMapToSphericalPolynomial=function(t){for(var e=new Dp,n=0,r=2/t.size,o=r,l=.5*r-1,d=0;d<6;d++)for(var v=this.FileFaces[d],y=t[v.name],D=l,w=t.format===g.a.TEXTUREFORMAT_RGBA?4:3,F=0;F<t.size;F++){for(var z=l,k=0;k<t.size;k++){var K=v.worldAxisForFileX.scale(z).add(v.worldAxisForFileY.scale(D)).add(v.worldAxisForNormal);K.normalize();var ae=Math.pow(1+z*z+D*D,-1.5),le=y[F*t.size*w+k*w+0],fe=y[F*t.size*w+k*w+1],me=y[F*t.size*w+k*w+2];isNaN(le)&&(le=0),isNaN(fe)&&(fe=0),isNaN(me)&&(me=0),t.type===g.a.TEXTURETYPE_UNSIGNED_INT&&(le/=255,fe/=255,me/=255),t.gammaSpace&&(le=Math.pow(J.a.Clamp(le),Zt.c),fe=Math.pow(J.a.Clamp(fe),Zt.c),me=Math.pow(J.a.Clamp(me),Zt.c)),le=J.a.Clamp(le,0,4096),fe=J.a.Clamp(fe,0,4096),me=J.a.Clamp(me,0,4096);var be=new C.a(le,fe,me);e.addLight(K,be,ae),n+=ae,z+=r}D+=o}var Ee=6*(4*Math.PI)/6/n;return e.scaleInPlace(Ee),e.convertIncidentRadianceToIrradiance(),e.convertIrradianceToLambertianRadiance(),qc.FromHarmonics(e)},i.FileFaces=[new fs("right",new h.e(1,0,0),new h.e(0,0,-1),new h.e(0,-1,0)),new fs("left",new h.e(-1,0,0),new h.e(0,0,1),new h.e(0,-1,0)),new fs("up",new h.e(0,1,0),new h.e(1,0,0),new h.e(0,0,1)),new fs("down",new h.e(0,-1,0),new h.e(1,0,0),new h.e(0,0,-1)),new fs("front",new h.e(0,0,1),new h.e(1,0,0),new h.e(0,-1,0)),new fs("back",new h.e(0,0,-1),new h.e(-1,0,0),new h.e(0,-1,0))],i}();Object.defineProperty(Zr.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomial=$u.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomial}return null},set:function(i){this._texture&&(this._texture._sphericalPolynomial=i)},enumerable:!0,configurable:!0});var pI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`;Qe.a.ShadersStore.rgbdEncodePixelShader=pI;var mI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`;Qe.a.ShadersStore.rgbdDecodePixelShader=mI;var io=function(){function i(){}return i.GetEnvInfo=function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),n=0,r=0;r<i._MagicBytes.length;r++)if(e.getUint8(n++)!==i._MagicBytes[r])return _.a.Error("Not a babylon environment map"),null;for(var o="",l=0;l=e.getUint8(n++);)o+=String.fromCharCode(l);var d=JSON.parse(o);return d.specular&&(d.specular.specularDataPosition=n,d.specular.lodGenerationScale=d.specular.lodGenerationScale||.8),d},i.CreateEnvTextureAsync=function(t){var e=this,n=t.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");var r=n.getEngine();if(r&&r.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===g.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=r.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var l=g.a.TEXTURETYPE_FLOAT;if(!r.getCaps().textureFloatRender&&(l=g.a.TEXTURETYPE_HALF_FLOAT,!r.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var d=n.width,v=new ne.a(r),y={},D=[],w=J.a.Log2(n.width);w=Math.round(w);for(var F=function(k){for(var K=Math.pow(2,w-k),ae=function(fe){var me=t.readPixels(fe,k),be=r.createRawTexture(me,K,K,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,l),Ee=new Promise(function(xe,Ae){var Ie=new St("rgbdEncode","rgbdEncode",null,null,1,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,r,!1,void 0,g.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);Ie.getEffect().executeWhenCompiled(function(){Ie.onApply=function(Ce){Ce._bindTexture("textureSampler",be)};var Re=r.getRenderWidth(),Pe=r.getRenderHeight();r.setSize(K,K),v.postProcessManager.directRender([Ie],null),et.b.ToBlob(o,function(Ce){var Ue=new FileReader;Ue.onload=function(Oe){var Ve=Oe.target.result;y[6*k+fe]=Ve,xe()},Ue.readAsArrayBuffer(Ce)}),r.setSize(Re,Pe)})});D.push(Ee)},le=0;le<6;le++)ae(le)},z=0;z<=w;z++)F(z);return Promise.all(D).then(function(){v.dispose();for(var k={version:1,width:d,irradiance:e._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},K=0,ae=0;ae<=w;ae++)for(var le=0;le<6;le++){var fe=y[6*ae+le].byteLength;k.specular.mipmaps.push({length:fe,position:K}),K+=fe}for(var me=JSON.stringify(k),be=new ArrayBuffer(me.length+1),Ee=new Uint8Array(be),xe=(ae=0,me.length);ae<xe;ae++)Ee[ae]=me.charCodeAt(ae);Ee[me.length]=0;var Ae=i._MagicBytes.length+K+be.byteLength,Ie=new ArrayBuffer(Ae),Re=new Uint8Array(Ie),Pe=new DataView(Ie),Ce=0;for(ae=0;ae<i._MagicBytes.length;ae++)Pe.setUint8(Ce++,i._MagicBytes[ae]);for(Re.set(new Uint8Array(be),Ce),Ce+=be.byteLength,ae=0;ae<=w;ae++)for(le=0;le<6;le++){var Ue=y[6*ae+le];Re.set(new Uint8Array(Ue),Ce),Ce+=Ue.byteLength}return Ie})},i._CreateEnvTextureIrradiance=function(t){var e=t.sphericalPolynomial;return e==null?null:{x:[e.x.x,e.x.y,e.x.z],y:[e.y.x,e.y.y,e.y.z],z:[e.z.x,e.z.y,e.z.z],xx:[e.xx.x,e.xx.y,e.xx.z],yy:[e.yy.x,e.yy.y,e.yy.z],zz:[e.zz.x,e.zz.y,e.zz.z],yz:[e.yz.x,e.yz.y,e.yz.z],zx:[e.zx.x,e.zx.y,e.zx.z],xy:[e.xy.x,e.xy.y,e.xy.z]}},i.CreateImageDataArrayBufferViews=function(t,e){if(e.version!==1)throw new Error('Unsupported babylon environment map version "'+e.version+'"');var n=e.specular,r=J.a.Log2(e.width);if(r=Math.round(r)+1,n.mipmaps.length!==6*r)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');for(var o=new Array(r),l=0;l<r;l++){o[l]=new Array(6);for(var d=0;d<6;d++){var v=n.mipmaps[6*l+d];o[l][d]=new Uint8Array(t.buffer,t.byteOffset+n.specularDataPosition+v.position,v.length)}}return o},i.UploadEnvLevelsAsync=function(t,e,n){if(n.version!==1)throw new Error('Unsupported babylon environment map version "'+n.version+'"');var r=n.specular;if(!r)return Promise.resolve();t._lodGenerationScale=r.lodGenerationScale;var o=i.CreateImageDataArrayBufferViews(e,n);return i.UploadLevelsAsync(t,o)},i._OnImageReadyAsync=function(t,e,n,r,o,l,d,v,y,D,w){return new Promise(function(F,z){if(n){var k=e.createTexture(null,!0,!0,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(ae){z(ae)},t);r.getEffect().executeWhenCompiled(function(){r.onApply=function(ae){ae._bindTexture("textureSampler",k),ae.setFloat2("scale",1,1)},e.scenes[0].postProcessManager.directRender([r],D,!0,l,d),e.restoreDefaultFramebuffer(),k.dispose(),URL.revokeObjectURL(o),F()})}else{if(e._uploadImageToTexture(w,t,l,d),v){var K=y[d];K&&e._uploadImageToTexture(K._texture,t,l,0)}F()}})},i.UploadLevelsAsync=function(t,e){var n=this;if(!et.b.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");var r=Math.round(J.a.Log2(t.width))+1,o=t.getEngine(),l=!1,d=!1,v=null,y=null,D=null,w=o.getCaps();if(t.format=g.a.TEXTUREFORMAT_RGBA,t.type=g.a.TEXTURETYPE_UNSIGNED_INT,t.generateMipMaps=!0,t._cachedAnisotropicFilteringLevel=null,o.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t),w.textureLOD?o.webGLVersion<2?l=!1:w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering?(l=!0,t.type=g.a.TEXTURETYPE_HALF_FLOAT):w.textureFloatRender&&w.textureFloatLinearFiltering&&(l=!0,t.type=g.a.TEXTURETYPE_FLOAT):(l=!1,d=!0,D={}),l)v=new St("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,o,!1,void 0,t.type,void 0,null,!1),t._isRGBD=!1,t.invertY=!1,y=o.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:t.type,format:g.a.TEXTUREFORMAT_RGBA});else if(t._isRGBD=!0,t.invertY=!0,d)for(var F=t._lodGenerationScale,z=t._lodGenerationOffset,k=0;k<3;k++){var K=(r-1)*F+z,ae=z+(K-z)*(1-k/2),le=Math.round(Math.min(Math.max(ae,0),K)),fe=new Nt.a(o,Nt.b.Temp);fe.isCube=!0,fe.invertY=!0,fe.generateMipMaps=!1,o.updateTextureSamplingMode(g.a.TEXTURE_LINEAR_LINEAR,fe);var me=new Zr.a(null);switch(me.isCube=!0,me._texture=fe,D[le]=me,k){case 0:t._lodTextureLow=me;break;case 1:t._lodTextureMid=me;break;case 2:t._lodTextureHigh=me}}var be=[],Ee=function(Pe){for(var Ce=function(Oe){var Ve=e[Pe][Oe],Le=new Blob([Ve],{type:"image/png"}),ze=URL.createObjectURL(Le),tt=void 0;if(typeof Image=="undefined")tt=createImageBitmap(Le).then(function(ft){return n._OnImageReadyAsync(ft,o,l,v,ze,Oe,Pe,d,D,y,t)});else{var ut=new Image;ut.src=ze,tt=new Promise(function(ft,vt){ut.onload=function(){n._OnImageReadyAsync(ut,o,l,v,ze,Oe,Pe,d,D,y,t).then(function(){return ft()}).catch(function(rt){vt(rt)})},ut.onerror=function(rt){vt(rt)}})}be.push(tt)},Ue=0;Ue<6;Ue++)Ce(Ue)};for(k=0;k<e.length;k++)Ee(k);if(e.length<r){var xe=void 0,Ae=Math.pow(2,r-1-e.length),Ie=Ae*Ae*4;switch(t.type){case g.a.TEXTURETYPE_UNSIGNED_INT:xe=new Uint8Array(Ie);break;case g.a.TEXTURETYPE_HALF_FLOAT:xe=new Uint16Array(Ie);break;case g.a.TEXTURETYPE_FLOAT:xe=new Float32Array(Ie)}for(k=e.length;k<r;k++)for(var Re=0;Re<6;Re++)o._uploadArrayBufferViewToTexture(t,xe,Re,k)}return Promise.all(be).then(function(){y&&(o._releaseFramebufferObjects(y),o._releaseTexture(t),y._swapAndDie(t)),v&&v.dispose(),d&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))})},i.UploadEnvSpherical=function(t,e){e.version!==1&&_.a.Warn('Unsupported babylon environment map version "'+e.version+'"');var n=e.irradiance;if(n){var r=new qc;h.e.FromArrayToRef(n.x,0,r.x),h.e.FromArrayToRef(n.y,0,r.y),h.e.FromArrayToRef(n.z,0,r.z),h.e.FromArrayToRef(n.xx,0,r.xx),h.e.FromArrayToRef(n.yy,0,r.yy),h.e.FromArrayToRef(n.zz,0,r.zz),h.e.FromArrayToRef(n.yz,0,r.yz),h.e.FromArrayToRef(n.zx,0,r.zx),h.e.FromArrayToRef(n.xy,0,r.xy),t._sphericalPolynomial=r}},i._UpdateRGBDAsync=function(t,e,n,r,o){return t._source=Nt.b.CubeRawRGBD,t._bufferViewArrayArray=e,t._lodGenerationScale=r,t._lodGenerationOffset=o,t._sphericalPolynomial=n,i.UploadLevelsAsync(t,e).then(function(){t.isReady=!0})},i._MagicBytes=[134,22,135,150,246,214,150,54],i}();Nt.a._UpdateRGBDAsync=io._UpdateRGBDAsync;var oo,wp=function(){function i(t,e){e===void 0&&(e=20),this.debug=!1,this._sourceCode=t,this._numMaxIterations=e,this._functionDescr=[],this.inlineToken="#define inline"}return Object.defineProperty(i.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),i.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size="+this._sourceCode.length+")..."),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&console.log("End of inlining process.")},i.prototype._collectFunctions=function(){for(var t=0;t<this._sourceCode.length;){var e=this._sourceCode.indexOf(this.inlineToken,t);if(e<0)break;var n=this._sourceCode.indexOf("(",e+this.inlineToken.length);if(n<0)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex="+t),t=e+this.inlineToken.length;else{var r=i._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(e+this.inlineToken.length,n));if(r){var o=[r[3],r[4]],l=o[0],d=o[1],v=this._extractBetweenMarkers("(",")",this._sourceCode,n);if(v<0)this.debug&&console.warn("Could not extract the parameters the function '"+d+"' (type="+l+"). funcParamsStartIndex="+n),t=e+this.inlineToken.length;else{var y=this._sourceCode.substring(n+1,v),D=this._skipWhitespaces(this._sourceCode,v+1);if(D!==this._sourceCode.length){var w=this._extractBetweenMarkers("{","}",this._sourceCode,D);if(w<0)this.debug&&console.warn("Could not extract the body of the function '"+d+"' (type="+l+"). funcBodyStartIndex="+D),t=e+this.inlineToken.length;else{for(var F=this._sourceCode.substring(D,w+1),z=this._removeComments(y).split(","),k=[],K=0;K<z.length;++K){var ae=z[K].trim(),le=ae.lastIndexOf(" ");le>=0&&k.push(ae.substring(le+1))}l!=="void"&&k.push("return"),this._functionDescr.push({name:d,type:l,parameters:k,body:F,callIndex:0}),t=w+1;var fe=e>0?this._sourceCode.substring(0,e):"",me=w+1<this._sourceCode.length-1?this._sourceCode.substring(w+1):"";this._sourceCode=fe+me,t-=w+1-e}}else this.debug&&console.warn("Could not extract the body of the function '"+d+"' (type="+l+"). funcParamsEndIndex="+v),t=e+this.inlineToken.length}}else this.debug&&console.warn("Could not extract the name/type of the function from: "+this._sourceCode.substring(e+this.inlineToken.length,n)),t=e+this.inlineToken.length}}this.debug&&console.log("Collect functions: "+this._functionDescr.length+" functions found. functionDescr=",this._functionDescr)},i.prototype._processInlining=function(t){for(t===void 0&&(t=20);t-->=0&&this._replaceFunctionCallsByCode(););return this.debug&&console.log("numMaxIterations is "+t+" after inlining process"),t>=0},i.prototype._extractBetweenMarkers=function(t,e,n,r){for(var o=r,l=0,d="";o<n.length;){var v=n.charAt(o);if(d)v===d?d==='"'||d==="'"?n.charAt(o-1)!=="\\"&&(d=""):d="":d==="*/"&&v==="*"&&o+1<n.length&&(n.charAt(o+1)==="/"&&(d=""),d===""&&o++);else switch(v){case t:l++;break;case e:l--;break;case'"':case"'":case"`":d=v;break;case"/":if(o+1<n.length){var y=n.charAt(o+1);y==="/"?d=`
`:y==="*"&&(d="*/")}}if(o++,l===0)break}return l===0?o-1:-1},i.prototype._skipWhitespaces=function(t,e){for(;e<t.length;){var n=t[e];if(n!==" "&&n!==`
`&&n!=="\r"&&n!=="	"&&n!==`
`&&n!=="\xA0")break;e++}return e},i.prototype._removeComments=function(t){for(var e=0,n="",r=!1,o=[];e<t.length;){var l=t.charAt(e);if(n)l===n?n==='"'||n==="'"?(t.charAt(e-1)!=="\\"&&(n=""),o.push(l)):(n="",r=!1):n==="*/"&&l==="*"&&e+1<t.length?(t.charAt(e+1)==="/"&&(n=""),n===""&&(r=!1,e++)):r||o.push(l);else{switch(l){case'"':case"'":case"`":n=l;break;case"/":if(e+1<t.length){var d=t.charAt(e+1);d==="/"?(n=`
`,r=!0):d==="*"&&(n="*/",r=!0)}}r||o.push(l)}e++}return o.join("")},i.prototype._replaceFunctionCallsByCode=function(){for(var t=!1,e=0,n=this._functionDescr;e<n.length;e++)for(var r=n[e],o=r.name,l=r.type,d=r.parameters,v=r.body,y=0;y<this._sourceCode.length;){var D=this._sourceCode.indexOf(o,y);if(D<0)break;var w=this._skipWhitespaces(this._sourceCode,D+o.length);if(w!==this._sourceCode.length&&this._sourceCode.charAt(w)==="("){var F=this._extractBetweenMarkers("(",")",this._sourceCode,w);if(F<0)this.debug&&console.warn("Could not extract the parameters of the function call. Function '"+o+"' (type="+l+"). callParamsStartIndex="+w),y=D+o.length;else{for(var z=this._sourceCode.substring(w+1,F),k=this._removeComments(z).split(","),K=[],ae=0;ae<k.length;++ae){var le=k[ae].trim();K.push(le)}var fe=l!=="void"?o+"_"+r.callIndex++:null;if(fe&&K.push(fe+" ="),K.length===d.length){y=F+1;var me=this._replaceNames(v,d,K),be=D>0?this._sourceCode.substring(0,D):"",Ee=F+1<this._sourceCode.length-1?this._sourceCode.substring(F+1):"";if(fe){var xe=this._findBackward(this._sourceCode,D-1,`
`);be=this._sourceCode.substring(0,xe+1);var Ae=this._sourceCode.substring(xe+1,D);this._sourceCode=be+l+" "+fe+`;
`+me+`
`+Ae+fe+Ee,this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+l+"). injectDeclarationIndex="+xe)}else this._sourceCode=be+me+Ee,y+=me.length-(F+1-D),this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+l+"). functionCallIndex="+D);t=!0}else this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '"+o+"' (type="+l+"). function parameters="+d+", call parameters="+K),y=D+o.length}}else y=D+o.length}return t},i.prototype._findBackward=function(t,e,n){for(;e>=0&&t.charAt(e)!==n;)e--;return e},i.prototype._escapeRegExp=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},i.prototype._replaceNames=function(t,e,n){for(var r=0;r<e.length;++r){var o=new RegExp(this._escapeRegExp(e[r]),"g"),l=n[r];t=t.replace(o,l)}return t},i._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,i}(),_I=function(){function i(){this.isAsync=!1,this.isReady=!1}return i.prototype._getVertexShaderCode=function(){return null},i.prototype._getFragmentShaderCode=function(){return null},i.prototype._handlesSpectorRebuildCallback=function(t){throw new Error("Not implemented")},i}(),Ly=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t}(wy.a),Ny=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getInternalTexture=function(){return this},t.prototype.getViewCount=function(){return 1},t}(Nt.a),gI=function(i){function t(){var e=i.call(this,null)||this;return e._native=new _native.Engine,e.INVALID_HANDLE=65535,e._boundBuffersVertexArray=null,e._currentDepthTest=e._native.DEPTH_TEST_LEQUAL,e._webGLVersion=2,e.disableUniformBuffers=!0,e._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1},et.b.Log("Babylon Native (v"+He.a.Version+") launched"),et.b.LoadScript=function(n,r,o,l){et.b.LoadFile(n,function(d){Function(d).apply(null),r&&r()},void 0,void 0,!1,function(d,v){o&&o("LoadScript Error",v)})},typeof URL=="undefined"&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(window.Blob=function(){}),e._shaderProcessor=new Dy.a,e}return Object(f.d)(t,i),t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._native.dispose()},t.prototype._queueNewFrame=function(e,n){return n.requestAnimationFrame&&n!==window?n.requestAnimationFrame(e):this._native.requestAnimationFrame(e),0},t.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._currentFramebuffer&&this._native.unbindFramebuffer(this._currentFramebuffer),e&&this._native.bindFramebuffer(e),this._currentFramebuffer=e)},t.prototype.getHostDocument=function(){return null},t.prototype.clear=function(e,n,r,o){o===void 0&&(o=!1);var l=0;n&&e&&(this._native.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),l|=this._native.CLEAR_FLAG_COLOR),r&&(this._native.clearDepth(1),l|=this._native.CLEAR_FLAG_DEPTH),o&&(this._native.clearStencil(0),l|=this._native.CLEAR_FLAG_STENCIL),this._native.clear(l)},t.prototype.createIndexBuffer=function(e,n){var r=this._normalizeIndexData(e),o=new Ly;if(o.references=1,o.is32Bits=r.BYTES_PER_ELEMENT===4,r.length){if(o.nativeIndexBuffer=this._native.createIndexBuffer(r,n!=null&&n),o.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native index buffer.")}else o.nativeVertexBuffer=this.INVALID_HANDLE;return o},t.prototype.createVertexBuffer=function(e,n){var r=new Ly;if(r.references=1,r.nativeVertexBuffer=this._native.createVertexBuffer(ArrayBuffer.isView(e)?e:new Float32Array(e),n!=null&&n),r.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native vertex buffer.");return r},t.prototype._recordVertexArrayObject=function(e,n,r,o){r&&this._native.recordIndexBuffer(e,r.nativeIndexBuffer);for(var l=o.getAttributesNames(),d=0;d<l.length;d++){var v=o.getAttributeLocation(d);if(v>=0){var y=n[l[d]];if(y){var D=y.getBuffer();D&&this._native.recordVertexBuffer(e,D.nativeVertexBuffer,v,y.byteOffset,y.byteStride,y.getSize(),this._getNativeAttribType(y.type),y.normalized)}}}},t.prototype.bindBuffers=function(e,n,r){this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._boundBuffersVertexArray=this._native.createVertexArray(),this._recordVertexArrayObject(this._boundBuffersVertexArray,e,n,r),this._native.bindVertexArray(this._boundBuffersVertexArray)},t.prototype.recordVertexArrayObject=function(e,n,r){var o=this._native.createVertexArray();return this._recordVertexArrayObject(o,e,n,r),o},t.prototype.bindVertexArrayObject=function(e){this._native.bindVertexArray(e)},t.prototype.releaseVertexArrayObject=function(e){this._native.deleteVertexArray(e)},t.prototype.getAttributes=function(e,n){var r=e;return this._native.getAttributes(r.nativeProgram,n)},t.prototype.drawElementsType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.drawIndexed(e,n,r)},t.prototype.drawArraysType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.draw(e,n,r)},t.prototype.createPipelineContext=function(){return new _I},t.prototype._preparePipelineContext=function(e,n,r,o,l,d,v){var y=e;y.nativeProgram=o?this.createRawShaderProgram(e,n,r,void 0,v):this.createShaderProgram(e,n,r,d,void 0,v)},t.prototype._isRenderingStateCompiled=function(e){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,n){n()},t.prototype.createRawShaderProgram=function(e,n,r,o,l){throw new Error("Not Supported")},t.prototype.createShaderProgram=function(e,n,r,o,l,d){this.onBeforeShaderCompilationObservable.notifyObservers(this);var v=new wp(n);v.processCode(),n=v.code;var y=new wp(r);y.processCode(),r=y.code,n=en.a._ConcatenateShader(n,o),r=en.a._ConcatenateShader(r,o);var D=this._native.createProgram(n,r);return this.onAfterShaderCompilationObservable.notifyObservers(this),D},t.prototype._setProgram=function(e){this._currentProgram!==e&&(this._native.setProgram(e),this._currentProgram=e)},t.prototype._releaseEffect=function(e){},t.prototype._deletePipelineContext=function(e){},t.prototype.getUniforms=function(e,n){var r=e;return this._native.getUniforms(r.nativeProgram,n)},t.prototype.bindUniformBlock=function(e,n,r){throw new Error("Not Implemented")},t.prototype.bindSamplers=function(e){var n=e.getPipelineContext();this._setProgram(n.nativeProgram);for(var r=e.getSamplers(),o=0;o<r.length;o++){var l=e.getUniform(r[o]);l&&(this._boundUniforms[o]=l)}this._currentEffect=null},t.prototype.setMatrix=function(e,n){e&&this._native.setMatrix(e,n.toArray())},t.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._native.getRenderWidth()},t.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._native.getRenderHeight()},t.prototype.setViewport=function(e,n,r){this._cachedViewport=e,this._native.setViewPort(e.x,e.y,e.width,e.height)},t.prototype.setState=function(e,n,r,o){n===void 0&&(n=0),o===void 0&&(o=!1),this._native.setState(e,n,o)},t.prototype.setZOffset=function(e){this._native.setZOffset(e)},t.prototype.getZOffset=function(){return this._native.getZOffset()},t.prototype.setDepthBuffer=function(e){this._native.setDepthTest(e?this._currentDepthTest:this._native.DEPTH_TEST_ALWAYS)},t.prototype.getDepthWrite=function(){return this._native.getDepthWrite()},t.prototype.setDepthFunctionToGreater=function(){this._currentDepthTest=this._native.DEPTH_TEST_GREATER,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_GEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLess=function(){this._currentDepthTest=this._native.DEPTH_TEST_LESS,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLessOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_LEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthWrite=function(e){this._native.setDepthWrite(e)},t.prototype.setColorWrite=function(e){this._native.setColorWrite(e),this._colorWrite=e},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.setAlphaConstants=function(e,n,r,o){throw new Error("Setting alpha blend constant color not yet implemented.")},t.prototype.setAlphaMode=function(e,n){n===void 0&&(n=!1),this._alphaMode!==e&&(e=this._getNativeAlphaMode(e),this._native.setBlendMode(e),n||this.setDepthWrite(e===g.a.ALPHA_DISABLE),this._alphaMode=e)},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setInt=function(e,n){return!!e&&(this._native.setInt(e,n),!0)},t.prototype.setIntArray=function(e,n){return!!e&&(this._native.setIntArray(e,n),!0)},t.prototype.setIntArray2=function(e,n){return!!e&&(this._native.setIntArray2(e,n),!0)},t.prototype.setIntArray3=function(e,n){return!!e&&(this._native.setIntArray3(e,n),!0)},t.prototype.setIntArray4=function(e,n){return!!e&&(this._native.setIntArray4(e,n),!0)},t.prototype.setFloatArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setFloatArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setFloatArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setFloatArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setMatrices=function(e,n){return!!e&&(this._native.setMatrices(e,n),!0)},t.prototype.setMatrix3x3=function(e,n){return!!e&&(this._native.setMatrix3x3(e,n),!0)},t.prototype.setMatrix2x2=function(e,n){return!!e&&(this._native.setMatrix2x2(e,n),!0)},t.prototype.setFloat=function(e,n){return!!e&&(this._native.setFloat(e,n),!0)},t.prototype.setFloat2=function(e,n,r){return!!e&&(this._native.setFloat2(e,n,r),!0)},t.prototype.setFloat3=function(e,n,r,o){return!!e&&(this._native.setFloat3(e,n,r,o),!0)},t.prototype.setFloat4=function(e,n,r,o,l){return!!e&&(this._native.setFloat4(e,n,r,o,l),!0)},t.prototype.setColor3=function(e,n){return!!e&&(this._native.setFloat3(e,n.r,n.g,n.b),!0)},t.prototype.setColor4=function(e,n,r){return!!e&&(this._native.setFloat4(e,n.r,n.g,n.b,r),!0)},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype._createTexture=function(){return this._native.createTexture()},t.prototype._deleteTexture=function(e){this._native.deleteTexture(e)},t.prototype.updateDynamicTexture=function(e,n,r,o,l){this.createTexture("data:my_image_name",!0,r,null,ke.a.BILINEAR_SAMPLINGMODE,void 0,void 0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYSURBVChTY/z//z8DPsAEpXGC4aCAgQEAGGMDDWwwgqsAAAAASUVORK5CYII=",e,t.TEXTUREFORMAT_RGBA,null,void 0)},t.prototype.createTexture=function(e,n,r,o,l,d,v,y,D,w,F,z,k){var K=this;l===void 0&&(l=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),d===void 0&&(d=null),v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=null),w===void 0&&(w=null),F===void 0&&(F=null);var ae=(e=e||"").substr(0,5)==="data:",le=ae&&e.indexOf(";base64,")!==-1,fe=D||new Nt.a(this,Nt.b.Url),me=e;!this._transformTextureUrl||le||D||y||(e=this._transformTextureUrl(e));for(var be=e.lastIndexOf("."),Ee=F||(be>-1?e.substring(be).toLowerCase():""),xe=null,Ae=0,Ie=He.a._TextureLoaders;Ae<Ie.length;Ae++){var Re=Ie[Ae];if(Re.canLoad(Ee)){xe=Re;break}}o&&o._addPendingData(fe),fe.url=e,fe.generateMipMaps=!n,fe.samplingMode=l,fe.invertY=r,this.doNotHandleContextLost||(fe._buffer=y);var Pe=null;if(d&&!D&&(Pe=fe.onLoadedObservable.add(d)),D||this._internalTexturesCache.push(fe),xe)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var Ce=function(Ue){var Oe=fe._webGLTexture;Oe?K._native.loadTexture(Oe,Ue,!n,r,function(){fe.baseWidth=K._native.getTextureWidth(Oe),fe.baseHeight=K._native.getTextureHeight(Oe),fe.width=fe.baseWidth,fe.height=fe.baseHeight,fe.isReady=!0;var Ve=K._getNativeSamplingMode(l);K._native.setTextureSampling(Oe,Ve),o&&o._removePendingData(fe),fe.onLoadedObservable.notifyObservers(fe),fe.onLoadedObservable.clear()},function(){throw new Error("Could not load a native texture.")}):o&&o._removePendingData(fe)};if(ae)if(y instanceof ArrayBuffer)Ce(new Uint8Array(y));else if(ArrayBuffer.isView(y))Ce(y);else{if(typeof y!="string")throw new Error("Unsupported buffer type");Ce(new Uint8Array(et.b.DecodeBase64(y)))}else le?Ce(new Uint8Array(et.b.DecodeBase64(e))):this._loadFile(e,function(Ue){return Ce(new Uint8Array(Ue))},void 0,void 0,!0,function(Ue,Oe){(function(Ve,Le){o&&o._removePendingData(fe),e===me?(Pe&&fe.onLoadedObservable.remove(Pe),re.a.UseFallbackTexture&&K.createTexture(re.a.FallbackTexture,n,fe.invertY,o,l,null,v,y,fe),v&&v((Ve||"Unknown error")+(re.a.UseFallbackTexture?" - Fallback texture was used":""),Le)):(_.a.Warn("Failed to load "+e+", falling back to "+me),K.createTexture(me,n,fe.invertY,o,l,d,v,y,fe,w,F,z,k))})("Unable to load "+(Ue&&Ue.responseURL,Oe))});return fe},t.prototype._createDepthStencilTexture=function(e,n){var r=new Ny(this,Nt.b.Depth),o=e.width||e,l=e.height||e,d=this._native.createDepthTexture(r._webGLTexture,o,l);return r._framebuffer=d,r},t.prototype._releaseFramebufferObjects=function(e){},t.prototype.createCubeTexture=function(e,n,r,o,l,d,v,y,D,w,F,z){var k=this;l===void 0&&(l=null),d===void 0&&(d=null),y===void 0&&(y=null),w===void 0&&(w=0),F===void 0&&(F=0),z===void 0&&(z=null);var K=z||new Nt.a(this,Nt.b.Cube);K.isCube=!0,K.url=e,K.generateMipMaps=!o,K._lodGenerationScale=w,K._lodGenerationOffset=F,this._doNotHandleContextLost||(K._extension=y,K._files=r);var ae=e.lastIndexOf(".");if((y||(ae>-1?e.substring(ae).toLowerCase():""))===".env"){if(r&&r.length===6)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(e,function(fe){return function(me){var be=io.GetEnvInfo(me);if(K.width=be.width,K.height=be.width,io.UploadEnvSpherical(K,be),be.version!==1)throw new Error('Unsupported babylon environment map version "'+be.version+'"');var Ee=be.specular;if(!Ee)throw new Error("Nothing else parsed so far");K._lodGenerationScale=Ee.lodGenerationScale;var xe=io.CreateImageDataArrayBufferViews(me,be);K.format=g.a.TEXTUREFORMAT_RGBA,K.type=g.a.TEXTURETYPE_UNSIGNED_INT,K.generateMipMaps=!0,K.getEngine().updateTextureSamplingMode(ke.a.TRILINEAR_SAMPLINGMODE,K),K._isRGBD=!0,K.invertY=!0,k._native.loadCubeTextureWithMips(K._webGLTexture,xe,function(){K.isReady=!0,l&&l()},function(){throw new Error("Could not load a native cube texture.")})}(new Uint8Array(fe))},void 0,void 0,!0,function(fe,me){d&&fe&&d(fe.status+" "+fe.statusText,me)})}else{if(!r||r.length!==6)throw new Error("Cannot load cubemap because 6 files were not defined");var le=[r[0],r[3],r[1],r[4],r[2],r[5]];Promise.all(le.map(function(fe){return et.b.LoadFileAsync(fe).then(function(me){return new Uint8Array(me)})})).then(function(fe){return new Promise(function(me,be){k._native.loadCubeTexture(K._webGLTexture,fe,!o,me,be)})}).then(function(){K.isReady=!0,l&&l()},function(fe){d&&d("Failed to load cubemap: "+fe.message,fe)})}return this._internalTexturesCache.push(K),K},t.prototype.createRenderTargetTexture=function(e,n){var r=new cs.a;n!==void 0&&typeof n=="object"?(r.generateMipMaps=n.generateMipMaps,r.generateDepthBuffer=n.generateDepthBuffer===void 0||n.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&n.generateStencilBuffer,r.type=n.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:n.type,r.samplingMode=n.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,r.format=n.format===void 0?g.a.TEXTUREFORMAT_RGBA:n.format):(r.generateMipMaps=n,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=g.a.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=g.a.TEXTUREFORMAT_RGBA),(r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var o=new Ny(this,Nt.b.RenderTarget),l=e.width||e,d=e.height||e;r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=g.a.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var v=this._native.createFramebuffer(o._webGLTexture,l,d,this._getNativeTextureFormat(r.format,r.type),r.samplingMode,!!r.generateStencilBuffer,r.generateDepthBuffer,!!r.generateMipMaps);return o._framebuffer=v,o.baseWidth=l,o.baseHeight=d,o.width=l,o.height=d,o.isReady=!0,o.samples=1,o.generateMipMaps=!!r.generateMipMaps,o.samplingMode=r.samplingMode,o.type=r.type,o.format=r.format,o._generateDepthBuffer=r.generateDepthBuffer,o._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(o),o},t.prototype.updateTextureSamplingMode=function(e,n){if(n._webGLTexture){var r=this._getNativeSamplingMode(e);this._native.setTextureSampling(n._webGLTexture,r)}n.samplingMode=e},t.prototype.bindFramebuffer=function(e,n,r,o,l){if(n)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(r||o)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");e._depthStencilTexture?this._bindUnboundFramebuffer(e._depthStencilTexture._framebuffer):this._bindUnboundFramebuffer(e._framebuffer)},t.prototype.unBindFramebuffer=function(e,n,r){n===void 0&&(n=!1),n&&_.a.Warn("Disabling mipmap generation not yet supported in NativeEngine. Ignoring."),r&&r(),this._bindUnboundFramebuffer(null)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e,!0)},t.prototype.updateDynamicIndexBuffer=function(e,n,r){r===void 0&&(r=0);var o=e,l=this._normalizeIndexData(n);o.is32Bits=l.BYTES_PER_ELEMENT===4,this._native.updateDynamicIndexBuffer(o.nativeIndexBuffer,l,r)},t.prototype.updateDynamicVertexBuffer=function(e,n,r,o){var l=e,d=ArrayBuffer.isView(n)?n:new Float32Array(n);this._native.updateDynamicVertexBuffer(l.nativeVertexBuffer,d,r??0,o??d.byteLength)},t.prototype._setTexture=function(e,n,r,o){o===void 0&&(o=!1);var l,d=this._boundUniforms[e];if(!d)return!1;if(!n)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._native.setTexture(d,null)),!1;if(n.video)this._activeChannel=e,n.update();else if(n.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED)return n.delayLoad(),!1;return l=o?n.depthStencilTexture:n.isReady()?n.getInternalTexture():n.isCube?this.emptyCubeTexture:n.is3D?this.emptyTexture3D:n.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=e,!(!l||!l._webGLTexture)&&(this._native.setTextureWrapMode(l._webGLTexture,this._getAddressMode(n.wrapU),this._getAddressMode(n.wrapV),this._getAddressMode(n.wrapR)),this._updateAnisotropicLevel(n),this._native.setTexture(d,l._webGLTexture),!0)},t.prototype._updateAnisotropicLevel=function(e){var n=e.getInternalTexture(),r=e.anisotropicFilteringLevel;n&&n._webGLTexture&&n._cachedAnisotropicFilteringLevel!==r&&(this._native.setTextureAnisotropicLevel(n._webGLTexture,r),n._cachedAnisotropicFilteringLevel=r)},t.prototype._getAddressMode=function(e){switch(e){case g.a.TEXTURE_WRAP_ADDRESSMODE:return this._native.ADDRESS_MODE_WRAP;case g.a.TEXTURE_CLAMP_ADDRESSMODE:return this._native.ADDRESS_MODE_CLAMP;case g.a.TEXTURE_MIRROR_ADDRESSMODE:return this._native.ADDRESS_MODE_MIRROR;default:throw new Error("Unexpected wrap mode: "+e+".")}},t.prototype._bindTexture=function(e,n){var r=this._boundUniforms[e];r&&this._native.setTexture(r,n._webGLTexture)},t.prototype._deleteBuffer=function(e){e.nativeIndexBuffer&&(this._native.deleteIndexBuffer(e.nativeIndexBuffer),delete e.nativeIndexBuffer),e.nativeVertexBuffer&&(this._native.deleteVertexBuffer(e.nativeVertexBuffer),delete e.nativeVertexBuffer)},t.prototype.releaseEffects=function(){},t.prototype._uploadCompressedDataToTextureDirectly=function(e,n,r,o,l,d,v){throw new Error("_uploadCompressedDataToTextureDirectly not implemented.")},t.prototype._uploadDataToTextureDirectly=function(e,n,r,o){throw new Error("_uploadDataToTextureDirectly not implemented.")},t.prototype._uploadArrayBufferViewToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._uploadImageToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._getNativeSamplingMode=function(e){switch(e){case g.a.TEXTURE_NEAREST_NEAREST:return this._native.TEXTURE_NEAREST_NEAREST;case g.a.TEXTURE_LINEAR_LINEAR:return this._native.TEXTURE_LINEAR_LINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:return this._native.TEXTURE_LINEAR_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:return this._native.TEXTURE_NEAREST_NEAREST_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:return this._native.TEXTURE_NEAREST_LINEAR_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:return this._native.TEXTURE_NEAREST_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_LINEAR:return this._native.TEXTURE_NEAREST_LINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:return this._native.TEXTURE_NEAREST_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:return this._native.TEXTURE_LINEAR_NEAREST_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:return this._native.TEXTURE_LINEAR_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:return this._native.TEXTURE_LINEAR_LINEAR_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST:return this._native.TEXTURE_LINEAR_NEAREST;default:throw new Error("Unsupported sampling mode: "+e+".")}},t.prototype._getNativeTextureFormat=function(e,n){if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_UNSIGNED_INT)return this._native.TEXTURE_FORMAT_RGBA8;if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_FLOAT)return this._native.TEXTURE_FORMAT_RGBA32F;throw new Error("Unsupported texture format or type: format "+e+", type "+n+".")},t.prototype._getNativeAlphaMode=function(e){switch(e){case g.a.ALPHA_DISABLE:return this._native.ALPHA_DISABLE;case g.a.ALPHA_ADD:return this._native.ALPHA_ADD;case g.a.ALPHA_COMBINE:return this._native.ALPHA_COMBINE;case g.a.ALPHA_SUBTRACT:return this._native.ALPHA_SUBTRACT;case g.a.ALPHA_MULTIPLY:return this._native.ALPHA_MULTIPLY;case g.a.ALPHA_MAXIMIZED:return this._native.ALPHA_MAXIMIZED;case g.a.ALPHA_ONEONE:return this._native.ALPHA_ONEONE;case g.a.ALPHA_PREMULTIPLIED:return this._native.ALPHA_PREMULTIPLIED;case g.a.ALPHA_PREMULTIPLIED_PORTERDUFF:return this._native.ALPHA_PREMULTIPLIED_PORTERDUFF;case g.a.ALPHA_INTERPOLATE:return this._native.ALPHA_INTERPOLATE;case g.a.ALPHA_SCREENMODE:return this._native.ALPHA_SCREENMODE;default:throw new Error("Unsupported alpha mode: "+e+".")}},t.prototype._getNativeAttribType=function(e){switch(e){case De.b.UNSIGNED_BYTE:return this._native.ATTRIB_TYPE_UINT8;case De.b.SHORT:return this._native.ATTRIB_TYPE_INT16;case De.b.FLOAT:return this._native.ATTRIB_TYPE_FLOAT;default:throw new Error("Unsupported attribute type: "+e+".")}},t}(He.a),vI=c(74),Ju=function(){function i(){}return i.COPY=1,i.CUT=2,i.PASTE=3,i}(),bI=function(){function i(t,e){this.type=t,this.event=e}return i.GetTypeFromCharacter=function(t){switch(t){case 67:return Ju.COPY;case 86:return Ju.PASTE;case 88:return Ju.CUT;default:return-1}},i}(),Lp=c(83),ao=c(69);(function(i){i[i.Clean=0]="Clean",i[i.Stop=1]="Stop",i[i.Sync=2]="Sync",i[i.NoSync=3]="NoSync"})(oo||(oo={}));var an=function(){function i(){}return Object.defineProperty(i,"ForceFullSceneLoadingForIncremental",{get:function(){return ao.a.ForceFullSceneLoadingForIncremental},set:function(t){ao.a.ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ShowLoadingScreen",{get:function(){return ao.a.ShowLoadingScreen},set:function(t){ao.a.ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"loggingLevel",{get:function(){return ao.a.loggingLevel},set:function(t){ao.a.loggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"CleanBoneMatrixWeights",{get:function(){return ao.a.CleanBoneMatrixWeights},set:function(t){ao.a.CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),i.GetDefaultPlugin=function(){return i._registeredPlugins[".babylon"]},i._GetPluginForExtension=function(t){var e=i._registeredPlugins[t];return e||(_.a.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),i.GetDefaultPlugin())},i._GetPluginForDirectLoad=function(t){for(var e in i._registeredPlugins){var n=i._registeredPlugins[e].plugin;if(n.canDirectLoad&&n.canDirectLoad(t))return i._registeredPlugins[e]}return i.GetDefaultPlugin()},i._GetPluginForFilename=function(t){var e=t.indexOf("?");e!==-1&&(t=t.substring(0,e));var n=t.lastIndexOf("."),r=t.substring(n,t.length).toLowerCase();return i._GetPluginForExtension(r)},i._GetDirectLoad=function(t){return t.substr(0,5)==="data:"?t.substr(5):null},i._LoadData=function(t,e,n,r,o,l,d){var v,y=i._GetDirectLoad(t.name),D=d?i._GetPluginForExtension(d):y?i._GetPluginForDirectLoad(t.name):i._GetPluginForFilename(t.name);if(!(v=D.plugin.createPlugin!==void 0?D.plugin.createPlugin():D.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(i.OnPluginActivatedObservable.notifyObservers(v),y){if(v.directLoad){var w=v.directLoad(e,y);w.then?w.then(function(Re){n(v,Re)}).catch(function(Re){o("Error in directLoad of _loadData: "+Re,Re)}):n(v,w)}else n(v,y);return v}var F=D.isBinary,z=function(Re,Pe){e.isDisposed?o("Scene has been disposed"):n(v,Re,Pe)},k=null,K=!1,ae=v.onDisposeObservable;ae&&ae.add(function(){K=!0,k&&(k.abort(),k=null),l()});var le=function(){if(!K){var Re=function(Ce,Ue){z(Ce,Ue?Ue.responseURL:void 0)},Pe=function(Ce){o(Ce.message,Ce)};k=v.requestFile?v.requestFile(e,t.url,Re,r,F,Pe):e._requestFile(t.url,Re,r,!0,F,Pe)}},fe=t.file||Lp.a.FilesToLoad[t.name.toLowerCase()];if(t.rootUrl.indexOf("file:")===-1||t.rootUrl.indexOf("file:")!==-1&&!fe){var me=e.getEngine(),be=me.enableOfflineSupport;if(be){for(var Ee=!1,xe=0,Ae=e.disableOfflineSupportExceptionRules;xe<Ae.length;xe++)if(Ae[xe].test(t.url)){Ee=!0;break}be=!Ee}be&&He.a.OfflineProviderFactory?e.offlineProvider=He.a.OfflineProviderFactory(t.url,le,me.disableManifestCheck):le()}else if(fe){var Ie=function(Re){o(Re.message,Re)};k=v.readFile?v.readFile(e,fe,z,r,F,Ie):e._readFile(fe,z,r,F,Ie)}else o("Unable to find file named "+t.name);return v},i._GetFileInfo=function(t,e){var n,r,o=null;if(e)if(e.name){var l=e;n=t+l.name,r=l.name,o=l}else{var d=e;if(d.substr(0,1)==="/")return et.b.Error("Wrong sceneFilename parameter"),null;n=t+d,r=d}else n=t,r=et.b.GetFilename(t),t=et.b.GetFolderPath(t);return{url:n,rootUrl:t,name:r,file:o}},i.GetPluginForExtension=function(t){return i._GetPluginForExtension(t).plugin},i.IsPluginForExtensionAvailable=function(t){return!!i._registeredPlugins[t]},i.RegisterPlugin=function(t){if(typeof t.extensions=="string"){var e=t.extensions;i._registeredPlugins[e.toLowerCase()]={plugin:t,isBinary:!1}}else{var n=t.extensions;Object.keys(n).forEach(function(r){i._registeredPlugins[r.toLowerCase()]={plugin:t,isBinary:n[r].isBinary}})}},i.ImportMesh=function(t,e,n,r,o,l,d,v){if(n===void 0&&(n=""),r===void 0&&(r=re.a.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),v===void 0&&(v=null),!r)return _.a.Error("No scene available to import mesh to"),null;var y=i._GetFileInfo(e,n);if(!y)return null;var D={};r._addPendingData(D);var w=function(){r._removePendingData(D)},F=function(K,ae){var le="Unable to import meshes from "+y.url+": "+K;d?d(r,le,ae):_.a.Error(le),w()},z=l?function(K){try{l(K)}catch(ae){F("Error in onProgress callback: "+ae,ae)}}:void 0,k=function(K,ae,le,fe,me,be,Ee){if(r.importedMeshesFiles.push(y.url),o)try{o(K,ae,le,fe,me,be,Ee)}catch(xe){F("Error in onSuccess callback: "+xe,xe)}r._removePendingData(D)};return i._LoadData(y,r,function(K,ae,le){if(K.rewriteRootURL&&(y.rootUrl=K.rewriteRootURL(y.rootUrl,le)),K.importMesh){var fe=K,me=new Array,be=new Array,Ee=new Array;if(!fe.importMesh(t,r,ae,y.rootUrl,me,be,Ee,F))return;r.loadingPluginName=K.name,k(me,be,Ee,[],[],[],[])}else K.importMeshAsync(t,r,ae,y.rootUrl,z,y.name).then(function(xe){r.loadingPluginName=K.name,k(xe.meshes,xe.particleSystems,xe.skeletons,xe.animationGroups,xe.transformNodes,xe.geometries,xe.lights)}).catch(function(xe){F(xe.message,xe)})},z,F,w,v)},i.ImportMeshAsync=function(t,e,n,r,o,l){return n===void 0&&(n=""),r===void 0&&(r=re.a.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),new Promise(function(d,v){i.ImportMesh(t,e,n,r,function(y,D,w,F,z,k,K){d({meshes:y,particleSystems:D,skeletons:w,animationGroups:F,transformNodes:z,geometries:k,lights:K})},o,function(y,D,w){v(w||new Error(D))},l)})},i.Load=function(t,e,n,r,o,l,d){return e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),n?i.Append(t,e,new ne.a(n),r,o,l,d):(et.b.Error("No engine available"),null)},i.LoadAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,d){i.Load(t,e,n,function(v){l(v)},r,function(v,y,D){d(D||new Error(y))},o)})},i.Append=function(t,e,n,r,o,l,d){var v=this;if(e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),!n)return _.a.Error("No scene available to append to"),null;var y=i._GetFileInfo(t,e);if(!y)return null;i.ShowLoadingScreen&&!this._showingLoadingScreen&&(this._showingLoadingScreen=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady(function(){n.getEngine().hideLoadingUI(),v._showingLoadingScreen=!1}));var D={};n._addPendingData(D);var w=function(){n._removePendingData(D)},F=function(K,ae){var le="Unable to load from "+y.url+(K?": "+K:"");l?l(n,le,ae):_.a.Error(le),w()},z=o?function(K){try{o(K)}catch(ae){F("Error in onProgress callback",ae)}}:void 0,k=function(){if(r)try{r(n)}catch(K){F("Error in onSuccess callback",K)}n._removePendingData(D)};return i._LoadData(y,n,function(K,ae){if(K.load){if(!K.load(n,ae,y.rootUrl,F))return;n.loadingPluginName=K.name,k()}else K.loadAsync(n,ae,y.rootUrl,z,y.name).then(function(){n.loadingPluginName=K.name,k()}).catch(function(le){F(le.message,le)})},z,F,w,d)},i.AppendAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,d){i.Append(t,e,n,function(v){l(v)},r,function(v,y,D){d(D||new Error(y))},o)})},i.LoadAssetContainer=function(t,e,n,r,o,l,d){if(e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),!n)return _.a.Error("No scene available to load asset container to"),null;var v=i._GetFileInfo(t,e);if(!v)return null;var y={};n._addPendingData(y);var D=function(){n._removePendingData(y)},w=function(k,K){var ae="Unable to load assets from "+v.url+(k?": "+k:"");K&&K.message&&(ae+=" ("+K.message+")"),l?l(n,ae,K):_.a.Error(ae),D()},F=o?function(k){try{o(k)}catch(K){w("Error in onProgress callback",K)}}:void 0,z=function(k){if(r)try{r(k)}catch(K){w("Error in onSuccess callback",K)}n._removePendingData(y)};return i._LoadData(v,n,function(k,K){if(k.loadAssetContainer){var ae=k.loadAssetContainer(n,K,v.rootUrl,w);if(!ae)return;n.loadingPluginName=k.name,z(ae)}else k.loadAssetContainerAsync?k.loadAssetContainerAsync(n,K,v.rootUrl,F,v.name).then(function(le){n.loadingPluginName=k.name,z(le)}).catch(function(le){w(le.message,le)}):w("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")},F,w,D,d)},i.LoadAssetContainerAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,d){i.LoadAssetContainer(t,e,n,function(v){l(v)},r,function(v,y,D){d(D||new Error(y))},o)})},i.ImportAnimations=function(t,e,n,r,o,l,d,v,y,D){if(e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=oo.Clean),l===void 0&&(l=null),d===void 0&&(d=null),v===void 0&&(v=null),y===void 0&&(y=null),D===void 0&&(D=null),n){if(r){for(var w=0,F=n.animatables;w<F.length;w++)F[w].reset();n.stopAllAnimations(),n.animationGroups.slice().forEach(function(k){k.dispose()}),n.getNodes().forEach(function(k){k.animations&&(k.animations=[])})}else switch(o){case oo.Clean:n.animationGroups.slice().forEach(function(k){k.dispose()});break;case oo.Stop:n.animationGroups.forEach(function(k){k.stop()});break;case oo.Sync:n.animationGroups.forEach(function(k){k.reset(),k.restart()});break;case oo.NoSync:break;default:return void _.a.Error("Unknown animation group loading mode value '"+o+"'")}var z=n.animatables.length;this.LoadAssetContainer(t,e,n,function(k){k.mergeAnimationsTo(n,n.animatables.slice(z),l),k.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),d&&d(n)},v,y,D)}else _.a.Error("No scene available to load animations to")},i.ImportAnimationsAsync=function(t,e,n,r,o,l,d,v,y,D){return e===void 0&&(e=""),n===void 0&&(n=re.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=oo.Clean),l===void 0&&(l=null),v===void 0&&(v=null),D===void 0&&(D=null),new Promise(function(w,F){i.ImportAnimations(t,e,n,r,o,l,function(z){w(z)},v,function(z,k,K){F(K||new Error(k))},D)})},i.NO_LOGGING=g.a.SCENELOADER_NO_LOGGING,i.MINIMAL_LOGGING=g.a.SCENELOADER_MINIMAL_LOGGING,i.SUMMARY_LOGGING=g.a.SCENELOADER_SUMMARY_LOGGING,i.DETAILED_LOGGING=g.a.SCENELOADER_DETAILED_LOGGING,i.OnPluginActivatedObservable=new S.c,i._registeredPlugins={},i._showingLoadingScreen=!1,i}(),Np=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=qr.DAYDREAM,n}return Object(f.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e===0){var o=this.onTriggerStateChangedObservable;o&&o.notifyObservers(n)}else _.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(Uo);Ui._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(Np.GAMEPAD_ID_PREFIX)===0},create:function(i){return new Np(i)}});var Fp=function(i){function t(e){var n=i.call(this,e)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=qr.GEAR_VR,n._calculatedPosition=new h.e(n.hand=="left"?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return Object(f.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){var l=new Fe.a("",e);o[1].parent=l,o[1].position.z=-.15,r._defaultModel=l,r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e<this._buttonIndexToObservableNameMap.length){var o=this[this._buttonIndexToObservableNameMap[e]];o&&o.notifyObservers(n)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(Uo);Ui._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(Fp.GAMEPAD_ID_PREFIX)===0||i.id.indexOf("Oculus Go")!==-1||i.id.indexOf("Vive Focus")!==-1},create:function(i){return new Fp(i)}});var eh=function(i){function t(e){return i.call(this,e)||this}return Object(f.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){console.log("Button id: "+e+"state: "),console.dir(n)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(Uo);Ui._DefaultControllerFactory=function(i){return new eh(i)};var Bp=function(i){function t(e){var n=i.call(this,e)||this;return n.onSecondaryTriggerStateChangedObservable=new S.c,n.onThumbRestChangedObservable=new S.c,n.controllerType=qr.OCULUS,n}return Object(f.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r,o=this;r=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,an.ImportMesh("",t._IsQuest?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL,r,e,function(l){o._defaultModel=t._IsQuest?l[0]:l[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n,l=this.hand==="right"?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-o.value,this._defaultModel.getChildren()[3].position.y=.005*-o.value,this._defaultModel.getChildren()[3].position.z=.005*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=l*o.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(o);case 3:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(o);case 4:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o);case 5:return void this.onThumbRestChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t._IsQuest=!1,t}(Uo);Ui._ControllerFactories.push({canCreate:function(i){return He.a.LastCreatedEngine&&He.a.LastCreatedEngine._vrDisplay&&He.a.LastCreatedEngine._vrDisplay.displayName==="Oculus Quest"&&(Bp._IsQuest=!0),i.id.indexOf("Oculus Touch")!==-1},create:function(i){return new Bp(i)}});var Fy=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=qr.VIVE,n._invertLeftStickY=!0,n}return Object(f.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;an.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(o);case 3:return this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(Uo);Ui._ControllerFactories.push({canCreate:function(i){return i.id.toLowerCase().indexOf("openvr")!==-1},create:function(i){return new Fy(i)}});var yI=function(){this.buttonMeshes={},this.axisMeshes={}},th=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:we.POINTING_POSE},n.onTrackpadChangedObservable=new S.c,n.onTrackpadValuesChangedObservable=new S.c,n.trackpad={x:0,y:0},n.controllerType=qr.WINDOWS,n._loadedMeshInfo=null,n}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(i.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var e=0;e<this._mapping.axisMeshNames.length;e++)this._lerpAxisTransform(e,this.browserGamepad.axes[e])},t.prototype._handleButtonChange=function(e,n,r){var o=this._mapping.buttons[e];if(o){this._updateTrackpad();var l=this[this._mapping.buttonObservableNames[o]];l&&l.notifyObservers(n),this._lerpButtonTransform(o,n.value)}},t.prototype._lerpButtonTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[e];r&&r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(h.b.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,n,r.value.rotationQuaternion),h.e.LerpToRef(r.unpressed.position,r.pressed.position,n,r.value.position))}},t.prototype._lerpAxisTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[e];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var o=.5*n+.5;h.b.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,o,r.value.rotationQuaternion),h.e.LerpToRef(r.min.position,r.max.position,o,r.value.position)}}},t.prototype.initControllerMesh=function(e,n,r){var o,l,d=this;if(r===void 0&&(r=!1),an.IsPluginForExtensionAvailable(".glb")){var v="default";if(this.id&&!r){var y=this.id.match(t.GAMEPAD_ID_PATTERN);v=y&&y[0]||v}l=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,o=t.MODEL_BASE_URL+v+"/"}else _.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),o=eh.MODEL_BASE_URL,l=eh.MODEL_FILENAME;an.ImportMesh("",o,l,e,function(D){d._loadedMeshInfo=d.processModel(e,D),d._loadedMeshInfo&&(d._defaultModel=d._loadedMeshInfo.rootNode,d.attachToMesh(d._defaultModel),n&&n(d._defaultModel))},null,function(D,w){_.a.Log(w),_.a.Warn("Failed to retrieve controller model from the remote server: "+o+l),r||d.initControllerMesh(D,n,!0)})},t.prototype.processModel=function(e,n){for(var r=null,o=new Fe.a(this.id+" "+this.hand,e),l=null,d=0;d<n.length;d++){var v=n[d];if(!v.parent){v.isPickable=!1,l=v;break}}return l?(l.setParent(o),r=this.createMeshInfo(o)):_.a.Warn("Could not find root node in model file."),r},t.prototype.createMeshInfo=function(e){var n,r=new yI;for(r.rootNode=e,r.buttonMeshes={},r.axisMeshes={},n=0;n<this._mapping.buttons.length;n++){var o=this._mapping.buttonMeshNames[this._mapping.buttons[n]];if(o){var l=w(e,o);if(l){var d={index:n,value:F(l,"VALUE"),pressed:F(l,"PRESSED"),unpressed:F(l,"UNPRESSED")};d.value&&d.pressed&&d.unpressed?r.buttonMeshes[this._mapping.buttons[n]]=d:_.a.Warn("Missing button submesh under mesh with name: "+o+"(VALUE: "+!!d.value+", PRESSED: "+!!d.pressed+", UNPRESSED:"+!!d.unpressed+")")}else _.a.Warn("Missing button mesh with name: "+o)}else _.a.Log("Skipping unknown button at index: "+n+" with mapped name: "+this._mapping.buttons[n])}for(n=0;n<this._mapping.axisMeshNames.length;n++){var v=this._mapping.axisMeshNames[n];if(v){var y=w(e,v);if(y){var D={index:n,value:F(y,"VALUE"),min:F(y,"MIN"),max:F(y,"MAX")};D.value&&D.min&&D.max?r.axisMeshes[n]=D:_.a.Warn("Missing axis submesh under mesh with name: "+v+"(VALUE: "+!!D.value+", MIN: "+!!D.min+", MAX:"+!!D.max+")")}else _.a.Warn("Missing axis mesh with name: "+v)}else _.a.Log("Skipping unknown axis at index: "+n)}return r.pointingPoseNode=w(e,this._mapping.pointingPoseMeshName),r.pointingPoseNode?this._pointingPoseNode=r.pointingPoseNode:_.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),r;function w(z,k){return z.getChildren(function(K){return K.name===k},!1)[0]}function F(z,k){return z.getChildren(function(K){return K.name==k},!0)[0]}},t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return i.prototype.getForwardRay.call(this,e);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),r=n.getTranslation(),o=new h.e(0,0,-1),l=h.e.TransformNormal(o,n),d=h.e.Normalize(l);return new Qn.a(r,d,e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(Uo),TI=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:we.POINTING_POSE},n.thumbstickValues={x:0,y:0},n.onThumbstickStateChangedObservable=new S.c,n.onThumbstickValuesChangedObservable=new S.c,n.onTrackpadChangedObservable=n.onPadStateChangedObservable,n.onTrackpadValuesChangedObservable=n.onPadValuesChangedObservable,n}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},t}(th);Ui._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(th.GAMEPAD_ID_PREFIX)===0},create:function(i){return new th(i)}});var nh=c(75),ps=c(63),kr=c(51),Mr=c(36),Zc=function(i){function t(e,n,r,o,l){var d,v,y,D,w,F,z;n===void 0&&(n=C.a.Gray()),r===void 0&&(r=Mr.a.DefaultUtilityLayer),o===void 0&&(o=null),l===void 0&&(l=1);var k=i.call(this,r)||this;k._pointerObserver=null,k.snapDistance=0,k.onSnapObservable=new S.c,k.uniformScaling=!1,k.sensitivity=1,k._isEnabled=!0,k._parent=null,k._dragging=!1,k._tmpVector=new h.e,k._tmpMatrix=new h.a,k._tmpMatrix2=new h.a,k._parent=o,k._coloredMaterial=new rn.a("",r.utilityLayerScene),k._coloredMaterial.diffuseColor=n,k._coloredMaterial.specularColor=n.subtract(new C.a(.1,.1,.1)),k._hoverMaterial=new rn.a("",r.utilityLayerScene),k._hoverMaterial.diffuseColor=C.a.Yellow(),k._disableMaterial=new rn.a("",r.utilityLayerScene),k._disableMaterial.diffuseColor=C.a.Gray(),k._disableMaterial.alpha=.4,k._gizmoMesh=new Fe.a("axis",r.utilityLayerScene);var K=k._createGizmoMesh(k._gizmoMesh,l),ae=K.arrowMesh,le=K.arrowTail,fe=k._createGizmoMesh(k._gizmoMesh,l+4,!0);k._gizmoMesh.lookAt(k._rootMesh.position.add(e)),k._rootMesh.addChild(k._gizmoMesh),k._gizmoMesh.scaling.scaleInPlace(1/3);var me=ae.position.clone(),be=le.position.clone(),Ee=le.scaling.clone(),xe=function(Oe){var Ve=Oe*(3/k._rootMesh.scaling.length())*6;ae.position.z+=Ve/3.5,le.scaling.y+=Ve,le.position.z=ae.position.z/2},Ae=function(){ae.position.set(me.x,me.y,me.z),le.position.set(be.x,be.y,be.z),le.scaling.set(Ee.x,Ee.y,Ee.z),k._dragging=!1};k.dragBehavior=new vi.a({dragAxis:e}),k.dragBehavior.moveAttached=!1,k._rootMesh.addBehavior(k.dragBehavior);var Ie=0,Re=new h.e,Pe={snapDistance:0};k.dragBehavior.onDragObservable.add(function(Oe){if(k.attachedNode){var Ve=k.sensitivity*Oe.dragDistance*(3*k.scaleRatio/k._rootMesh.scaling.length()),Le=!1,ze=0;k.uniformScaling?(k.attachedNode.getWorldMatrix().decompose(Re),Re.normalize(),Re.y<0&&Re.scaleInPlace(-1)):Re.copyFrom(e),k.snapDistance==0?Re.scaleToRef(Ve,Re):(Ie+=Ve,Math.abs(Ie)>k.snapDistance?(ze=Math.floor(Math.abs(Ie)/k.snapDistance),Ie<0&&(ze*=-1),Ie%=k.snapDistance,Re.scaleToRef(k.snapDistance*ze,Re),Le=!0):Re.scaleInPlace(0)),h.a.ScalingToRef(1+Re.x,1+Re.y,1+Re.z,k._tmpMatrix2),k._tmpMatrix2.multiplyToRef(k.attachedNode.getWorldMatrix(),k._tmpMatrix),k._tmpMatrix.decompose(k._tmpVector),Math.abs(k._tmpVector.x)<1e5&&Math.abs(k._tmpVector.y)<1e5&&Math.abs(k._tmpVector.z)<1e5&&k.attachedNode.getWorldMatrix().copyFrom(k._tmpMatrix),Le&&(Pe.snapDistance=k.snapDistance*ze,k.onSnapObservable.notifyObservers(Pe)),k._matrixChanged()}}),k.dragBehavior.onDragStartObservable.add(function(){k._dragging=!0}),k.dragBehavior.onDragObservable.add(function(Oe){return xe(Oe.dragDistance)}),k.dragBehavior.onDragEndObservable.add(Ae),(y=(v=(d=o==null?void 0:o.uniformScaleGizmo)===null||d===void 0?void 0:d.dragBehavior)===null||v===void 0?void 0:v.onDragObservable)===null||y===void 0||y.add(function(Oe){return xe(Oe.delta.y)}),(F=(w=(D=o==null?void 0:o.uniformScaleGizmo)===null||D===void 0?void 0:D.dragBehavior)===null||w===void 0?void 0:w.onDragEndObservable)===null||F===void 0||F.add(Ae);var Ce={gizmoMeshes:[ae,le],colliderMeshes:[fe.arrowMesh,fe.arrowTail],material:k._coloredMaterial,hoverMaterial:k._hoverMaterial,disableMaterial:k._disableMaterial,active:!1};(z=k._parent)===null||z===void 0||z.addToAxisCache(k._gizmoMesh,Ce),k._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Oe){var Ve;if(!k._customMeshSet&&(k._isHovered=Ce.colliderMeshes.indexOf((Ve=Oe==null?void 0:Oe.pickInfo)===null||Ve===void 0?void 0:Ve.pickedMesh)!=-1,!k._parent)){var Le=k._isHovered||k._dragging?k._hoverMaterial:k._coloredMaterial;Ce.gizmoMeshes.forEach(function(ze){ze.material=Le,ze.color&&(ze.color=Le.diffuseColor)})}});var Ue=r._getSharedGizmoLight();return Ue.includedOnlyMeshes=Ue.includedOnlyMeshes.concat(k._rootMesh.getChildMeshes()),k}return Object(f.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){r===void 0&&(r=!1);var o=ps.a.CreateBox("yPosMesh",{size:.4*(1+(n-1)/4)},this.gizmoLayer.utilityLayerScene),l=Vi.a.CreateCylinder("cylinder",{diameterTop:.005*n,height:.275,diameterBottom:.005*n,tessellation:96},this.gizmoLayer.utilityLayerScene);return o.scaling.scaleInPlace(.1),o.material=this._coloredMaterial,o.rotation.x=Math.PI/2,o.position.z+=.3,l.material=this._coloredMaterial,l.position.z+=.1375,l.rotation.x=Math.PI/2,r&&(o.visibility=0,l.visibility=0),e.addChild(o),e.addChild(l),{arrowMesh:o,arrowTail:l}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(e,n){var r=this;n===void 0&&(n=!1),i.prototype.setCustomMesh.call(this,e),n&&(this._rootMesh.getChildMeshes().forEach(function(o){o.material=r._coloredMaterial,o.color&&(o.color=r._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},t}(kr.a),jr=c(45),Jn=c(40),By=function(i){function t(e,n){e===void 0&&(e=C.a.Gray()),n===void 0&&(n=Mr.a.DefaultKeepDepthUtilityLayer);var r=i.call(this,n)||this;r._boundingDimensions=new h.e(1,1,1),r._renderObserver=null,r._pointerObserver=null,r._scaleDragSpeed=.2,r._tmpQuaternion=new h.b,r._tmpVector=new h.e(0,0,0),r._tmpRotationMatrix=new h.a,r.ignoreChildren=!1,r.includeChildPredicate=null,r.rotationSphereSize=.1,r.scaleBoxSize=.1,r.fixedDragMeshScreenSize=!1,r.fixedDragMeshBoundsSize=!1,r.fixedDragMeshScreenSizeDistanceFactor=10,r.onDragStartObservable=new S.c,r.onScaleBoxDragObservable=new S.c,r.onScaleBoxDragEndObservable=new S.c,r.onRotationSphereDragObservable=new S.c,r.onRotationSphereDragEndObservable=new S.c,r.scalePivot=null,r._existingMeshScale=new h.e,r._dragMesh=null,r.pointerDragBehavior=new vi.a,r.updateScale=!1,r._anchorMesh=new jt.a("anchor",n.utilityLayerScene),r.coloredMaterial=new rn.a("",n.utilityLayerScene),r.coloredMaterial.disableLighting=!0,r.hoverColoredMaterial=new rn.a("",n.utilityLayerScene),r.hoverColoredMaterial.disableLighting=!0,r._lineBoundingBox=new jt.a("",n.utilityLayerScene),r._lineBoundingBox.rotationQuaternion=new h.b;var o=[];o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,0,0),new h.e(r._boundingDimensions.x,0,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,0,0),new h.e(0,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,0,0),new h.e(0,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(r._boundingDimensions.x,0,0),new h.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(r._boundingDimensions.x,0,0),new h.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,r._boundingDimensions.y,0),new h.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,r._boundingDimensions.y,0),new h.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,0,r._boundingDimensions.z),new h.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(0,0,r._boundingDimensions.z),new h.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new h.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new h.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(Jn.a.CreateLines("lines",{points:[new h.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new h.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.forEach(function(ae){ae.color=e,ae.position.addInPlace(new h.e(-r._boundingDimensions.x/2,-r._boundingDimensions.y/2,-r._boundingDimensions.z/2)),ae.isPickable=!1,r._lineBoundingBox.addChild(ae)}),r._rootMesh.addChild(r._lineBoundingBox),r.setColor(e),r._rotateSpheresParent=new jt.a("",n.utilityLayerScene),r._rotateSpheresParent.rotationQuaternion=new h.b;for(var l=function(ae){var le=jr.a.CreateSphere("",{diameter:1},n.utilityLayerScene);le.rotationQuaternion=new h.b,le.material=d.coloredMaterial,(w=new vi.a({})).moveAttached=!1,w.updateDragPlane=!1,le.addBehavior(w);var fe=new h.e(1,0,0),me=0;w.onDragStartObservable.add(function(){fe.copyFrom(le.forward),me=0}),w.onDragObservable.add(function(be){if(r.onRotationSphereDragObservable.notifyObservers({}),r.attachedMesh){var Ee=r.attachedMesh.parent;if(Ee&&Ee.scaling&&Ee.scaling.isNonUniformWithinEpsilon(.001))return void _.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Or.a._RemoveAndStorePivotPoint(r.attachedMesh);var xe=fe,Ae=be.dragPlaneNormal.scale(h.e.Dot(be.dragPlaneNormal,xe)),Ie=xe.subtract(Ae).normalizeToNew(),Re=h.e.Dot(Ie,be.delta)<0?Math.abs(be.delta.length()):-Math.abs(be.delta.length());Re=Re/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),r.attachedMesh.rotationQuaternion||(r.attachedMesh.rotationQuaternion=h.b.RotationYawPitchRoll(r.attachedMesh.rotation.y,r.attachedMesh.rotation.x,r.attachedMesh.rotation.z)),r._anchorMesh.rotationQuaternion||(r._anchorMesh.rotationQuaternion=h.b.RotationYawPitchRoll(r._anchorMesh.rotation.y,r._anchorMesh.rotation.x,r._anchorMesh.rotation.z)),me+=Re,Math.abs(me)<=2*Math.PI&&(ae>=8?h.b.RotationYawPitchRollToRef(0,0,Re,r._tmpQuaternion):ae>=4?h.b.RotationYawPitchRollToRef(Re,0,0,r._tmpQuaternion):h.b.RotationYawPitchRollToRef(0,Re,0,r._tmpQuaternion),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.rotationQuaternion.multiplyToRef(r._tmpQuaternion,r._anchorMesh.rotationQuaternion),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(Ee)),r.updateBoundingBox(),Or.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),w.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(le)}),w.onDragEndObservable.add(function(){r.onRotationSphereDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),d._rotateSpheresParent.addChild(le)},d=this,v=0;v<12;v++)l(v);r._rootMesh.addChild(r._rotateSpheresParent),r._scaleBoxesParent=new jt.a("",n.utilityLayerScene),r._scaleBoxesParent.rotationQuaternion=new h.b;for(var y=0;y<3;y++)for(var D=0;D<3;D++)for(var w,F=function(){var ae=(y===1?1:0)+(D===1?1:0)+(k===1?1:0);if(ae===1||ae===3)return"continue";var le=ps.a.CreateBox("",{size:1},n.utilityLayerScene);le.material=z.coloredMaterial,le.metadata=ae===2;var fe=new h.e(y-1,D-1,k-1).normalize();(w=new vi.a({dragAxis:fe})).updateDragPlane=!1,w.moveAttached=!1,le.addBehavior(w),w.onDragObservable.add(function(me){if(r.onScaleBoxDragObservable.notifyObservers({}),r.attachedMesh){var be=r.attachedMesh.parent;if(be&&be.scaling&&be.scaling.isNonUniformWithinEpsilon(.001))return void _.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Or.a._RemoveAndStorePivotPoint(r.attachedMesh);var Ee=me.dragDistance/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),xe=new h.e(Ee,Ee,Ee);ae===2&&(xe.x*=Math.abs(fe.x),xe.y*=Math.abs(fe.y),xe.z*=Math.abs(fe.z)),xe.scaleInPlace(r._scaleDragSpeed),r.updateBoundingBox(),r.scalePivot?(r.attachedMesh.getWorldMatrix().getRotationMatrixToRef(r._tmpRotationMatrix),r._boundingDimensions.scaleToRef(.5,r._tmpVector),h.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector),r._boundingDimensions.multiplyToRef(r.scalePivot,r._tmpVector),h.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.addInPlace(r._tmpVector)):(le.absolutePosition.subtractToRef(r._anchorMesh.position,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector)),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.scaling.addInPlace(xe),(r._anchorMesh.scaling.x<0||r._anchorMesh.scaling.y<0||r._anchorMesh.scaling.z<0)&&r._anchorMesh.scaling.subtractInPlace(xe),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(be),Or.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),w.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(le)}),w.onDragEndObservable.add(function(){r.onScaleBoxDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),z._scaleBoxesParent.addChild(le)},z=this,k=0;k<3;k++)F();r._rootMesh.addChild(r._scaleBoxesParent);var K=new Array;return r._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(ae){K[ae.event.pointerId]?ae.pickInfo&&ae.pickInfo.pickedMesh!=K[ae.event.pointerId]&&(K[ae.event.pointerId].material=r.coloredMaterial,delete K[ae.event.pointerId]):r._rotateSpheresParent.getChildMeshes().concat(r._scaleBoxesParent.getChildMeshes()).forEach(function(le){ae.pickInfo&&ae.pickInfo.pickedMesh==le&&(K[ae.event.pointerId]=le,le.material=r.hoverColoredMaterial)})}),r._renderObserver=r.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){r.attachedMesh&&!r._existingMeshScale.equals(r.attachedMesh.scaling)?r.updateBoundingBox():(r.fixedDragMeshScreenSize||r.fixedDragMeshBoundsSize)&&(r._updateRotationSpheres(),r._updateScaleBoxes()),r._dragMesh&&r.attachedMesh&&r.pointerDragBehavior.dragging&&(r._lineBoundingBox.position.rotateByQuaternionToRef(r._rootMesh.rotationQuaternion,r._tmpVector),r.attachedMesh.setAbsolutePosition(r._dragMesh.position.add(r._tmpVector.scale(-1))))}),r.updateBoundingBox(),r}return Object(f.d)(t,i),t.prototype.setColor=function(e){this.coloredMaterial.emissiveColor=e,this.hoverColoredMaterial.emissiveColor=e.clone().add(new C.a(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(n){n.color&&(n.color=e)})},t.prototype._attachedNodeChanged=function(e){var n=this;if(e){Or.a._RemoveAndStorePivotPoint(e);var r=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(r),Or.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(o){o.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){n._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(n){n.isVisible=!e||n==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Or.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null);var n=null;this.attachedMesh.skeleton&&(n=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=h.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=h.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var r=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);r.max.subtractToRef(r.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((r.max.x+r.min.x)/2,(r.max.y+r.min.y)/2,(r.max.z+r.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=n)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Or.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),n=0;n<3;n++)for(var r=0;r<2;r++)for(var o=0;o<2;o++){var l=4*n+2*r+o;if(n==0&&(e[l].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*r,this._boundingDimensions.z*o),e[l].position.addInPlace(new h.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(h.e.Cross(e[l].position.normalizeToNew(),h.e.Right()).normalizeToNew().add(e[l].position))),n==1&&(e[l].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y/2,this._boundingDimensions.z*o),e[l].position.addInPlace(new h.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(h.e.Cross(e[l].position.normalizeToNew(),h.e.Up()).normalizeToNew().add(e[l].position))),n==2&&(e[l].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y*o,this._boundingDimensions.z/2),e[l].position.addInPlace(new h.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(h.e.Cross(e[l].position.normalizeToNew(),h.e.Forward()).normalizeToNew().add(e[l].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[l].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var d=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[l].scaling.set(d,d,d)}else this.fixedDragMeshBoundsSize?e[l].scaling.set(this.rotationSphereSize*this._boundingDimensions.x,this.rotationSphereSize*this._boundingDimensions.y,this.rotationSphereSize*this._boundingDimensions.z):e[l].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),n=0,r=0;r<3;r++)for(var o=0;o<3;o++)for(var l=0;l<3;l++){var d=(r===1?1:0)+(o===1?1:0)+(l===1?1:0);if(d!==1&&d!==3){if(e[n])if(e[n].position.set(this._boundingDimensions.x*(r/2),this._boundingDimensions.y*(o/2),this._boundingDimensions.z*(l/2)),e[n].position.addInPlace(new h.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var v=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(v,v,v)}else this.fixedDragMeshBoundsSize?e[n].scaling.set(this.scaleBoxSize*this._boundingDimensions.x,this.scaleBoxSize*this._boundingDimensions.y,this.scaleBoxSize*this._boundingDimensions.z):e[n].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize);n++}}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(n,r){r<4?n.setEnabled(e.indexOf("x")!=-1):r<8?n.setEnabled(e.indexOf("y")!=-1):n.setEnabled(e.indexOf("z")!=-1)})},t.prototype.setEnabledScaling=function(e,n){n===void 0&&(n=!1),this._scaleBoxesParent.getChildMeshes().forEach(function(r,o){var l=e;n&&r.metadata===!0&&(l=!1),r.setEnabled(l)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=Fe.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new h.b,this.pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),i.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var n=function(v){v.isPickable=!1,v.getChildMeshes().forEach(function(y){n(y)})};n(e),e.rotationQuaternion||(e.rotationQuaternion=h.b.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var r=e.position.clone(),o=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var l=ps.a.CreateBox("box",{size:1},e.getScene()),d=e.getHierarchyBoundingVectors();return d.max.subtractToRef(d.min,l.scaling),l.scaling.y===0&&(l.scaling.y=Zt.a),l.scaling.x===0&&(l.scaling.x=Zt.a),l.scaling.z===0&&(l.scaling.z=Zt.a),l.position.set((d.max.x+d.min.x)/2,(d.max.y+d.min.y)/2,(d.max.z+d.min.z)/2),e.addChild(l),e.rotationQuaternion.copyFrom(o),e.position.copyFrom(r),e.removeChild(l),l.addChild(e),l.visibility=0,l},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo")},t}(kr.a),rh=function(i){function t(e,n,r,o,l,d,v){var y;n===void 0&&(n=C.a.Gray()),r===void 0&&(r=Mr.a.DefaultUtilityLayer),o===void 0&&(o=32),l===void 0&&(l=null),v===void 0&&(v=1);var D=i.call(this,r)||this;D._pointerObserver=null,D.snapDistance=0,D.onSnapObservable=new S.c,D._isEnabled=!0,D._parent=null,D._dragging=!1,D._parent=l,D._coloredMaterial=new rn.a("",r.utilityLayerScene),D._coloredMaterial.diffuseColor=n,D._coloredMaterial.specularColor=n.subtract(new C.a(.1,.1,.1)),D._hoverMaterial=new rn.a("",r.utilityLayerScene),D._hoverMaterial.diffuseColor=C.a.Yellow(),D._disableMaterial=new rn.a("",r.utilityLayerScene),D._disableMaterial.diffuseColor=C.a.Gray(),D._disableMaterial.alpha=.4,D._gizmoMesh=new Fe.a("",r.utilityLayerScene);var w=D._createGizmoMesh(D._gizmoMesh,v,o),F=w.rotationMesh,z=w.collider,k=[];D._rotationCircle=D.setupRotationCircle(k,D._gizmoMesh),D._gizmoMesh.lookAt(D._rootMesh.position.add(e)),D._rootMesh.addChild(D._gizmoMesh),D._gizmoMesh.scaling.scaleInPlace(1/3),D.dragBehavior=new vi.a({dragPlaneNormal:e}),D.dragBehavior.moveAttached=!1,D.dragBehavior.maxDragAngle=9*Math.PI/20,D.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,D._rootMesh.addBehavior(D.dragBehavior);var K=0,ae=new h.e,le=new h.e,fe=new h.a,me=new h.e,be=new h.e;D.dragBehavior.onDragStartObservable.add(function(Ce){if(D.attachedNode){ae.copyFrom(Ce.dragPlanePoint);var Ue=new h.e(0,0,1),Oe=D._rotationCircle.getDirection(Ue);Oe.normalize(),D._gizmoMesh.removeChild(D._rotationCircle),ae.copyFrom(Ce.dragPlanePoint),le=Ce.dragPlanePoint;var Ve=D._rotationCircle.getAbsolutePosition().clone(),Le=D._rotationCircle.getAbsolutePosition().clone().addInPlace(Oe),ze=Ce.dragPlanePoint,tt=h.e.GetAngleBetweenVectors(Le.subtract(Ve),ze.subtract(Ve),D._rotationCircle.up);D._rotationCircle.addRotation(0,tt,0),D._dragging=!0}}),D.dragBehavior.onDragEndObservable.add(function(){K=0,D.updateRotationCircle(D._rotationCircle,k,K,le),D._gizmoMesh.addChild(D._rotationCircle),D._dragging=!1});var Ee={snapDistance:0},xe=0,Ae=new h.a,Ie=new h.b;D.dragBehavior.onDragObservable.add(function(Ce){if(D.attachedNode){var Ue=new h.e(1,1,1),Oe=new h.b(0,0,0,1),Ve=new h.e(0,0,0);D.attachedNode.getWorldMatrix().decompose(Ue,Oe,Ve);var Le=Ce.dragPlanePoint.subtract(Ve).normalize(),ze=ae.subtract(Ve).normalize(),tt=h.e.Cross(Le,ze),ut=h.e.Dot(Le,ze),ft=Math.atan2(tt.length(),ut);me.copyFrom(e),be.copyFrom(e),D.updateGizmoRotationToMatchAttachedMesh&&(Oe.toRotationMatrix(fe),be=h.e.TransformCoordinates(me,fe));var vt=!1;if(r.utilityLayerScene.activeCamera){var rt=r.utilityLayerScene.activeCamera.position.subtract(Ve);h.e.Dot(rt,be)>0&&(me.scaleInPlace(-1),be.scaleInPlace(-1),vt=!0)}h.e.Dot(be,tt)>0&&(ft=-ft);var mt=!1;if(D.snapDistance!=0)if(xe+=ft,Math.abs(xe)>D.snapDistance){var pt=Math.floor(Math.abs(xe)/D.snapDistance);xe<0&&(pt*=-1),xe%=D.snapDistance,ft=D.snapDistance*pt,mt=!0}else ft=0;K+=vt?-ft:ft,D.updateRotationCircle(D._rotationCircle,k,K,le);var it=Math.sin(ft/2);if(Ie.set(me.x*it,me.y*it,me.z*it,Math.cos(ft/2)),Ae.determinant()>0){var yt=new h.e;Ie.toEulerAnglesToRef(yt),h.b.RotationYawPitchRollToRef(yt.y,-yt.x,-yt.z,Ie)}D.updateGizmoRotationToMatchAttachedMesh?Oe.multiplyToRef(Ie,Oe):Ie.multiplyToRef(Oe,Oe),D.attachedNode.getWorldMatrix().copyFrom(h.a.Compose(Ue,Oe,Ve)),ae.copyFrom(Ce.dragPlanePoint),mt&&(Ee.snapDistance=ft,D.onSnapObservable.notifyObservers(Ee)),D._matrixChanged()}});var Re=r._getSharedGizmoLight();Re.includedOnlyMeshes=Re.includedOnlyMeshes.concat(D._rootMesh.getChildMeshes(!1));var Pe={colliderMeshes:[z],gizmoMeshes:[F],material:D._coloredMaterial,hoverMaterial:D._hoverMaterial,disableMaterial:D._disableMaterial,active:!1};return(y=D._parent)===null||y===void 0||y.addToAxisCache(D._gizmoMesh,Pe),D._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Ce){var Ue;if(!D._customMeshSet&&(D._isHovered=Pe.colliderMeshes.indexOf((Ue=Ce==null?void 0:Ce.pickInfo)===null||Ue===void 0?void 0:Ue.pickedMesh)!=-1,!D._parent)){var Oe=D._isHovered||D._dragging?D._hoverMaterial:D._coloredMaterial;Pe.gizmoMeshes.forEach(function(Ve){Ve.material=Oe,Ve.color&&(Ve.color=Oe.diffuseColor)})}}),D}return Object(f.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){var o=Fe.a.CreateTorus("ignore",.6,.03*n,r,this.gizmoLayer.utilityLayerScene);o.visibility=0;var l=Fe.a.CreateTorus("",.6,.005*n,r,this.gizmoLayer.utilityLayerScene);return l.material=this._coloredMaterial,l.rotation.x=Math.PI/2,o.rotation.x=Math.PI/2,e.addChild(l),e.addChild(o),{rotationMesh:l,collider:o}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.setupRotationCircle=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=-Math.PI/2;o<Math.PI/2-1.5;o+=r/2){for(var l=[],d=0;d<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;d+=r)if(d<0){var v=t._CircleConstants.radius*Math.sin(d)*Math.cos(o),y=t._CircleConstants.radius*Math.cos(d)*Math.cos(o);l.push(new h.e(v,0,y))}else l.push(new h.e(0,0,0));e.push(l)}var D=new rn.a("",this.gizmoLayer.utilityLayerScene);D.diffuseColor=C.a.Yellow(),D.backFaceCulling=!1;var w=Fe.a.CreateRibbon("rotationCircle",e,!1,!1,0,this.gizmoLayer.utilityLayerScene,!0);return w.material=D,w.material.alpha=.25,w.rotation.x=Math.PI/2,n.addChild(w),w},t.prototype.updateRotationPath=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=0,l=-Math.PI/2;l<Math.PI/2-1.5;l+=r/2){var d=e[o];if(d)for(var v=0,y=0;y<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;y+=r){if(d[v])if(y<Math.abs(n)){var D=n>0?y:-1*y,w=n>0?l:-1*l;d[v].set(t._CircleConstants.radius*Math.sin(D)*Math.cos(w),0,t._CircleConstants.radius*Math.cos(D)*Math.cos(w))}else d[v].set(0,0,0);v++}o++}},t.prototype.updateRotationCircle=function(e,n,r,o){this.updateRotationPath(n,r),Fe.a.CreateRibbon("rotationCircle",n,!1,!1,0,this.gizmoLayer.utilityLayerScene,void 0,void 0,e.geometry?e:void 0)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),this._rotationCircle&&this._rotationCircle.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t._CircleConstants={radius:.3,pi2:2*Math.PI,tessellation:70,rotationCircleRange:4},t}(kr.a),Uy=function(i){function t(e,n,r,o,l){e===void 0&&(e=Mr.a.DefaultUtilityLayer),n===void 0&&(n=32),r===void 0&&(r=!1),o===void 0&&(o=1);var d=i.call(this,e)||this;return d.onDragStartObservable=new S.c,d.onDragEndObservable=new S.c,d._observables=[],d._gizmoAxisCache=new Map,d.xGizmo=new rh(new h.e(1,0,0),C.a.Red().scale(.5),e,n,d,r,o),d.yGizmo=new rh(new h.e(0,1,0),C.a.Green().scale(.5),e,n,d,r,o),d.zGizmo=new rh(new h.e(0,0,1),C.a.Blue().scale(.5),e,n,d,r,o),[d.xGizmo,d.yGizmo,d.zGizmo].forEach(function(v){v.dragBehavior.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({})}),v.dragBehavior.onDragEndObservable.add(function(){d.onDragEndObservable.notifyObservers({})})}),d.attachedMesh=null,d.attachedNode=null,l?l.addToAxisCache(d._gizmoAxisCache):kr.a.GizmoAxisPointerObserver(e,d._gizmoAxisCache),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),t.prototype._checkBillboardTransform=function(){this._nodeAttached&&this._nodeAttached.billboardMode&&console.log("Rotation Gizmo will not work with transforms in billboard mode.")},Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)})},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(kr.a),ms=c(46),Up=c(84),ih=function(i){function t(e,n,r,o){var l;n===void 0&&(n=C.a.Gray()),r===void 0&&(r=Mr.a.DefaultUtilityLayer),o===void 0&&(o=null);var d=i.call(this,r)||this;d._pointerObserver=null,d.snapDistance=0,d.onSnapObservable=new S.c,d._isEnabled=!1,d._parent=null,d._dragging=!1,d._parent=o,d._coloredMaterial=new rn.a("",r.utilityLayerScene),d._coloredMaterial.diffuseColor=n,d._coloredMaterial.specularColor=n.subtract(new C.a(.1,.1,.1)),d._hoverMaterial=new rn.a("",r.utilityLayerScene),d._hoverMaterial.diffuseColor=C.a.Yellow(),d._disableMaterial=new rn.a("",r.utilityLayerScene),d._disableMaterial.diffuseColor=C.a.Gray(),d._disableMaterial.alpha=.4,d._gizmoMesh=t._CreatePlane(r.utilityLayerScene,d._coloredMaterial),d._gizmoMesh.lookAt(d._rootMesh.position.add(e)),d._gizmoMesh.scaling.scaleInPlace(1/3),d._gizmoMesh.parent=d._rootMesh;var v=0,y=new h.e,D={snapDistance:0};d.dragBehavior=new vi.a({dragPlaneNormal:e}),d.dragBehavior.moveAttached=!1,d._rootMesh.addBehavior(d.dragBehavior),d.dragBehavior.onDragObservable.add(function(z){if(d.attachedNode){if(d.snapDistance==0)d.attachedNode.getWorldMatrix().addTranslationFromFloats(z.delta.x,z.delta.y,z.delta.z);else if(v+=z.dragDistance,Math.abs(v)>d.snapDistance){var k=Math.floor(Math.abs(v)/d.snapDistance);v%=d.snapDistance,z.delta.normalizeToRef(y),y.scaleInPlace(d.snapDistance*k),d.attachedNode.getWorldMatrix().addTranslationFromFloats(y.x,y.y,y.z),D.snapDistance=d.snapDistance*k,d.onSnapObservable.notifyObservers(D)}d._matrixChanged()}}),d.dragBehavior.onDragStartObservable.add(function(){d._dragging=!0}),d.dragBehavior.onDragEndObservable.add(function(){d._dragging=!1});var w=r._getSharedGizmoLight();w.includedOnlyMeshes=w.includedOnlyMeshes.concat(d._rootMesh.getChildMeshes(!1));var F={gizmoMeshes:d._gizmoMesh.getChildMeshes(),colliderMeshes:d._gizmoMesh.getChildMeshes(),material:d._coloredMaterial,hoverMaterial:d._hoverMaterial,disableMaterial:d._disableMaterial,active:!1};return(l=d._parent)===null||l===void 0||l.addToAxisCache(d._gizmoMesh,F),d._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(z){var k;if(!d._customMeshSet&&(d._isHovered=F.colliderMeshes.indexOf((k=z==null?void 0:z.pickInfo)===null||k===void 0?void 0:k.pickedMesh)!=-1,!d._parent)){var K=d._isHovered||d._dragging?d._hoverMaterial:d._coloredMaterial;F.gizmoMeshes.forEach(function(ae){ae.material=K})}}),d}return Object(f.d)(t,i),t._CreatePlane=function(e,n){var r=new ms.a("plane",e),o=Up.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return o.material=n,o.parent=r,r},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),i.prototype.dispose.call(this),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()})},t}(kr.a),Vy=function(i){function t(e,n,r){e===void 0&&(e=Mr.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new S.c,o.onDragEndObservable=new S.c,o._planarGizmoEnabled=!1,o.xGizmo=new nh.a(new h.e(1,0,0),C.a.Red().scale(.5),e,o,n),o.yGizmo=new nh.a(new h.e(0,1,0),C.a.Green().scale(.5),e,o,n),o.zGizmo=new nh.a(new h.e(0,0,1),C.a.Blue().scale(.5),e,o,n),o.xPlaneGizmo=new ih(new h.e(1,0,0),C.a.Red().scale(.5),o.gizmoLayer,o),o.yPlaneGizmo=new ih(new h.e(0,1,0),C.a.Green().scale(.5),o.gizmoLayer,o),o.zPlaneGizmo=new ih(new h.e(0,0,1),C.a.Blue().scale(.5),o.gizmoLayer,o),[o.xGizmo,o.yGizmo,o.zGizmo,o.xPlaneGizmo,o.yPlaneGizmo,o.zPlaneGizmo].forEach(function(l){l.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),l.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,r?r.addToAxisCache(o._gizmoAxisCache):kr.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=null,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(e){var n=this;this._planarGizmoEnabled=e,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(r){r&&(r.isEnabled=e,e&&(r.attachedMesh?r.attachedMesh=n.attachedMesh:r.attachedNode=n.attachedNode))},this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){_.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},t}(kr.a);Tt.a.CreatePolyhedron=function(i){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var e,n,r,o,l,d,v=i.type&&(i.type<0||i.type>=t.length)?0:i.type||0,y=i.size,D=i.sizeX||y||1,w=i.sizeY||y||1,F=i.sizeZ||y||1,z=i.custom||t[v],k=z.face.length,K=i.faceUV||new Array(k),ae=i.faceColors,le=i.flat===void 0||i.flat,fe=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,me=new Array,be=new Array,Ee=new Array,xe=new Array,Ae=new Array,Ie=0,Re=0,Pe=new Array,Ce=0,Ue=0;if(le)for(Ue=0;Ue<k;Ue++)ae&&ae[Ue]===void 0&&(ae[Ue]=new C.b(1,1,1,1)),K&&K[Ue]===void 0&&(K[Ue]=new h.f(0,0,1,1));if(le)for(Ue=0;Ue<k;Ue++){var Oe=z.face[Ue].length;for(r=2*Math.PI/Oe,o=.5*Math.tan(r/2),l=.5,Ce=0;Ce<Oe;Ce++)me.push(z.vertex[z.face[Ue][Ce]][0]*D,z.vertex[z.face[Ue][Ce]][1]*w,z.vertex[z.face[Ue][Ce]][2]*F),Pe.push(Ie),Ie++,e=K[Ue].x+(K[Ue].z-K[Ue].x)*(.5+o),n=K[Ue].y+(K[Ue].w-K[Ue].y)*(l-.5),xe.push(e,n),d=o*Math.cos(r)-l*Math.sin(r),l=o*Math.sin(r)+l*Math.cos(r),o=d,ae&&Ae.push(ae[Ue].r,ae[Ue].g,ae[Ue].b,ae[Ue].a);for(Ce=0;Ce<Oe-2;Ce++)be.push(Pe[0+Re],Pe[Ce+2+Re],Pe[Ce+1+Re]);Re+=Oe}else{for(Ce=0;Ce<z.vertex.length;Ce++)me.push(z.vertex[Ce][0]*D,z.vertex[Ce][1]*w,z.vertex[Ce][2]*F),xe.push(0,0);for(Ue=0;Ue<k;Ue++)for(Ce=0;Ce<z.face[Ue].length-2;Ce++)be.push(z.face[Ue][0],z.face[Ue][Ce+2],z.face[Ue][Ce+1])}Tt.a.ComputeNormals(me,be,Ee),Tt.a._ComputeSides(fe,me,be,Ee,xe,i.frontUVs,i.backUVs);var Ve=new Tt.a;return Ve.positions=me,Ve.indices=be,Ve.normals=Ee,Ve.uvs=xe,ae&&le&&(Ve.colors=Ae),Ve},Fe.a.CreatePolyhedron=function(i,t,e){return $c.CreatePolyhedron(i,t,e)};var $c=function(){function i(){}return i.CreatePolyhedron=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreatePolyhedron(e).applyToMesh(r,e.updatable),r},i}(),ky=function(i){function t(e,n,r){e===void 0&&(e=Mr.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._sensitivity=1,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new S.c,o.onDragEndObservable=new S.c,o.uniformScaleGizmo=o._createUniformScaleMesh(),o.xGizmo=new Zc(new h.e(1,0,0),C.a.Red().scale(.5),e,o,n),o.yGizmo=new Zc(new h.e(0,1,0),C.a.Green().scale(.5),e,o,n),o.zGizmo=new Zc(new h.e(0,0,1),C.a.Blue().scale(.5),e,o,n),[o.xGizmo,o.yGizmo,o.zGizmo,o.uniformScaleGizmo].forEach(function(l){l.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),l.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,o.attachedNode=null,r?r.addToAxisCache(o._gizmoAxisCache):kr.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),t.prototype._createUniformScaleMesh=function(){this._coloredMaterial=new rn.a("",this.gizmoLayer.utilityLayerScene),this._coloredMaterial.diffuseColor=C.a.Gray(),this._hoverMaterial=new rn.a("",this.gizmoLayer.utilityLayerScene),this._hoverMaterial.diffuseColor=C.a.Yellow(),this._disableMaterial=new rn.a("",this.gizmoLayer.utilityLayerScene),this._disableMaterial.diffuseColor=C.a.Gray(),this._disableMaterial.alpha=.4;var e=new Zc(new h.e(0,1,0),C.a.Gray().scale(.5),this.gizmoLayer,this);e.updateGizmoRotationToMatchAttachedMesh=!1,e.uniformScaling=!0,this._uniformScalingMesh=$c.CreatePolyhedron("uniform",{type:1},e.gizmoLayer.utilityLayerScene),this._uniformScalingMesh.scaling.scaleInPlace(.01),this._uniformScalingMesh.visibility=0,this._octahedron=$c.CreatePolyhedron("",{type:1},e.gizmoLayer.utilityLayerScene),this._octahedron.scaling.scaleInPlace(.007),this._uniformScalingMesh.addChild(this._octahedron),e.setCustomMesh(this._uniformScalingMesh,!0);var n=this.gizmoLayer._getSharedGizmoLight();n.includedOnlyMeshes=n.includedOnlyMeshes.concat(this._octahedron);var r={gizmoMeshes:[this._octahedron,this._uniformScalingMesh],colliderMeshes:[this._uniformScalingMesh],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1};return this.addToAxisCache(e._rootMesh,r),e},Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){e?(this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})):_.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.sensitivity=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach(function(n){n&&n.dispose()}),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(n){n&&n.dispose()})},t}(kr.a),EI=function(){function i(t,e,n,r){e===void 0&&(e=1),n===void 0&&(n=Mr.a.DefaultUtilityLayer),r===void 0&&(r=Mr.a.DefaultKeepDepthUtilityLayer),this.scene=t,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new S.c,this.onAttachedToNodeObservable=new S.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObservers=[],this._attachedMesh=null,this._attachedNode=null,this._boundingBoxColor=C.a.FromHexString("#0984e3"),this._thickness=1,this._gizmoAxisCache=new Map,this.boundingBoxDragBehavior=new ku,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultUtilityLayer=n,this._defaultKeepDepthUtilityLayer=r,this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._thickness=e,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null};var o=this._attachToMeshPointerObserver(t),l=kr.a.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache);this._pointerObservers=[o,l]}return Object.defineProperty(i.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isHovered",{get:function(){var t=!1;for(var e in this.gizmos){var n=this.gizmos[e];if(n&&n.isHovered){t=!0;break}}return t},enumerable:!1,configurable:!0}),i.prototype._attachToMeshPointerObserver=function(t){var e=this;return t.onPointerObservable.add(function(n){if(e.usePointerToAttachGizmos&&n.type==Ot.a.POINTERDOWN)if(n.pickInfo&&n.pickInfo.pickedMesh){var r=n.pickInfo.pickedMesh;if(e.attachableMeshes==null)for(;r&&r.parent!=null;)r=r.parent;else{var o=!1;e.attachableMeshes.forEach(function(l){r&&(r==l||r.isDescendantOf(l))&&(r=l,o=!0)}),o||(r=null)}r instanceof jt.a?e._attachedMesh!=r&&e.attachToMesh(r):e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)}else e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)})},i.prototype.attachToMesh=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=t,this._attachedNode=null,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedMesh=t)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(t)},i.prototype.attachToNode=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=null,this._attachedNode=t,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedNode=t)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(t)},Object.defineProperty(i.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(t){t?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new Vy(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null),this._gizmosEnabled.positionGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(t){t?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Uy(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null),this._gizmosEnabled.rotationGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(t){t?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new ky(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(t){t?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new By(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=t},enumerable:!1,configurable:!0}),i.prototype.addToAxisCache=function(t){var e=this;t.size>0&&t.forEach(function(n,r){e._gizmoAxisCache.set(r,n)})},i.prototype.dispose=function(){var t=this;for(var e in this._pointerObservers.forEach(function(r){t.scene.onPointerObservable.remove(r)}),this.gizmos){var n=this.gizmos[e];n&&n.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},i}(),so=c(48),oh=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._needProjectionMatrixCompute=!0,e}return Object(f.d)(t,i),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!1,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=h.e.Zero()),h.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=h.e.Zero()),h.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=h.e.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=h.e.Cross(this.direction,Te.a.Y),n=h.e.Cross(e,this.direction);return h.e.RotationFromAxis(e,n,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=h.e.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=h.a.Identity()),h.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return this.shadowMinZ!==void 0?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return this.shadowMaxZ!==void 0?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,n,r){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(n,r,e):this._setDefaultShadowProjectionMatrix(e,n,r),this},Object(f.c)([Object(B.o)()],t.prototype,"position",null),Object(f.c)([Object(B.o)()],t.prototype,"direction",null),Object(f.c)([Object(B.c)()],t.prototype,"shadowMinZ",null),Object(f.c)([Object(B.c)()],t.prototype,"shadowMaxZ",null),t}(so.a);$.a.AddNodeConstructor("Light_Type_1",function(i,t){return function(){return new Vp(i,h.e.Zero(),t)}});var Vp=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowFrustumSize=0,o._shadowOrthoScale=.1,o.autoUpdateExtends=!0,o.autoCalcShadowZBounds=!1,o._orthoLeft=Number.MAX_VALUE,o._orthoRight=Number.MIN_VALUE,o._orthoTop=Number.MIN_VALUE,o._orthoBottom=Number.MAX_VALUE,o.position=n.scale(-1),o.direction=n,o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return so.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,n,r)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var n=this.getScene().activeCamera;n&&h.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,this.shadowMinZ!==void 0?this.shadowMinZ:n.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:n.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var l=h.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var d=Number.MAX_VALUE,v=Number.MIN_VALUE,y=0;y<r.length;y++){var D=r[y];if(D)for(var w=D.getBoundingInfo().boundingBox,F=0;F<w.vectorsWorld.length;F++)h.e.TransformCoordinatesToRef(w.vectorsWorld[F],n,l),l.x<this._orthoLeft&&(this._orthoLeft=l.x),l.y<this._orthoBottom&&(this._orthoBottom=l.y),l.x>this._orthoRight&&(this._orthoRight=l.x),l.y>this._orthoTop&&(this._orthoTop=l.y),this.autoCalcShadowZBounds&&(l.z<d&&(d=l.z),l.z>v&&(v=l.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=d,this._shadowMaxZ=v)}var z=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom;h.a.OrthoOffCenterLHToRef(this._orthoLeft-z*this.shadowOrthoScale,this._orthoRight+z*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,this.shadowMinZ!==void 0?this.shadowMinZ:o.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:o.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,n),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,n),this)},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?(e.setFloat3(n,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(n,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,n){e["DIRLIGHT"+n]=!0},Object(f.c)([Object(B.c)()],t.prototype,"shadowFrustumSize",null),Object(f.c)([Object(B.c)()],t.prototype,"shadowOrthoScale",null),Object(f.c)([Object(B.c)()],t.prototype,"autoUpdateExtends",void 0),Object(f.c)([Object(B.c)()],t.prototype,"autoCalcShadowZBounds",void 0),t}(oh);Fe.a.CreateHemisphere=function(i,t,e,n){var r={segments:t,diameter:e};return ah.CreateHemisphere(i,r,n)};var ah=function(){function i(){}return i.CreateHemisphere=function(t,e,n){e.diameter||(e.diameter=1),e.segments||(e.segments=16);var r=jr.a.CreateSphere("",{slice:.5,diameter:e.diameter,segments:e.segments},n),o=Fe.a.CreateDisc("",e.diameter/2,3*e.segments+(4-e.segments),n);o.rotation.x=-Math.PI/2,o.parent=r;var l=Fe.a.MergeMeshes([o,r],!0);return l.name=t,l},i}();$.a.AddNodeConstructor("Light_Type_2",function(i,t){return function(){return new kp(i,h.e.Zero(),h.e.Zero(),0,0,t)}});var kp=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,d)||this;return v._innerAngle=0,v._projectionTextureMatrix=h.a.Zero(),v._projectionTextureLightNear=1e-6,v._projectionTextureLightFar=1e3,v._projectionTextureUpDirection=h.e.Up(),v._projectionTextureViewLightDirty=!0,v._projectionTextureProjectionLightDirty=!0,v._projectionTextureDirty=!0,v._projectionTextureViewTargetVector=h.e.Zero(),v._projectionTextureViewLightMatrix=h.a.Zero(),v._projectionTextureProjectionLightMatrix=h.a.Zero(),v._projectionTextureScalingMatrix=h.a.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),v.position=n,v.direction=r,v.angle=o,v.exponent=l,v}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var n=this;this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled(function(){n._markMeshesAsLightDirty()}):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce(function(){n._markMeshesAsLightDirty()})))},enumerable:!1,configurable:!0}),t._IsProceduralTexture=function(e){return e.onGeneratedObservable!==void 0},t._IsTexture=function(e){return e.onLoadObservable!==void 0},t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return so.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(e){i.prototype._setDirection.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(e){i.prototype._setPosition.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){this._shadowAngleScale=this._shadowAngleScale||1;var l=this._shadowAngleScale*this._angle;h.a.PerspectiveFovLHToRef(l,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),h.a.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,n=this.projectionTextureLightNear,r=e/(e-n),o=-r*n,l=1/Math.tan(this._angle/2);h.a.FromValuesToRef(l/1,0,0,0,0,l,0,0,0,0,r,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof ke.a){var e=this._projectionTexture.uScale/2,n=this._projectionTexture.vScale/2;h.a.FromValuesToRef(e,0,0,0,0,n,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferTexturesToEffect=function(e,n){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+n,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+n,this.projectionTexture)),this},t.prototype.transferToEffect=function(e,n){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,n),r=h.e.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,n),r=h.e.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){var r;return r=this.computeTransformedInformation()?h.e.Normalize(this.transformedDirection):h.e.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(n,-r.x,-r.y,-r.z):e.setFloat3(n,r.x,r.y,r.z),this},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,n){e["SPOTLIGHT"+n]=!0,e["PROJECTEDLIGHTTEXTURE"+n]=!(!this.projectionTexture||!this.projectionTexture.isReady())},Object(f.c)([Object(B.c)()],t.prototype,"angle",null),Object(f.c)([Object(B.c)()],t.prototype,"innerAngle",null),Object(f.c)([Object(B.c)()],t.prototype,"shadowAngleScale",null),Object(f.c)([Object(B.c)()],t.prototype,"exponent",void 0),Object(f.c)([Object(B.c)()],t.prototype,"projectionTextureLightNear",null),Object(f.c)([Object(B.c)()],t.prototype,"projectionTextureLightFar",null),Object(f.c)([Object(B.c)()],t.prototype,"projectionTextureUpDirection",null),Object(f.c)([Object(B.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(oh),SI=function(i){function t(e){e===void 0&&(e=Mr.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._cachedPosition=new h.e,n._cachedForward=new h.e(0,0,1),n._pointerObserver=null,n.onClickedObservable=new S.c,n._light=null,n.attachedMesh=new jt.a("",n.gizmoLayer.utilityLayerScene),n._attachedMeshParent=new ms.a("parent",n.gizmoLayer.utilityLayerScene),n.attachedMesh.parent=n._attachedMeshParent,n._material=new rn.a("light",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new C.a(.5,.5,.5),n._material.specularColor=new C.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._light&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._light))},Ot.a.POINTERDOWN),n}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var n=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),e instanceof Ku.a?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=e instanceof Vp?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof kp?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._lightMesh.parent=this._rootMesh;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new h.b,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,e.parent&&this._attachedMeshParent.freezeWorldMatrix(e.parent.getWorldMatrix()),e.position&&(this.attachedMesh.position.copyFrom(e.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(this.attachedMesh.setDirection(e.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)):(this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(h.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):h.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))))},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._material.dispose(),i.prototype.dispose.call(this),this._attachedMeshParent.dispose()},t._CreateHemisphericLightMesh=function(e){var n=new Fe.a("hemisphereLight",e),r=ah.CreateHemisphere(n.name,{segments:10,diameter:1},e);r.position.z=-.15,r.rotation.x=Math.PI/2,r.parent=n;var o=this._CreateLightLines(3,e);return o.parent=n,o.position.z,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreatePointLightMesh=function(e){var n=new Fe.a("pointLight",e),r=jr.a.CreateSphere(n.name,{segments:10,diameter:1},e);return r.rotation.x=Math.PI/2,r.parent=n,this._CreateLightLines(5,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateSpotLightMesh=function(e){var n=new Fe.a("spotLight",e);jr.a.CreateSphere(n.name,{segments:10,diameter:1},e).parent=n;var r=ah.CreateHemisphere(n.name,{segments:10,diameter:2},e);return r.parent=n,r.rotation.x=-Math.PI/2,this._CreateLightLines(2,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateDirectionalLightMesh=function(e){var n=new Fe.a("directionalLight",e),r=new Fe.a(n.name,e);r.parent=n,jr.a.CreateSphere(n.name,{diameter:1.2,segments:10},e).parent=r;var o=Fe.a.CreateCylinder(n.name,6,.3,.3,6,1,e);o.parent=r,(l=o.clone(n.name)).scaling.y=.5,l.position.x+=1.25,(d=o.clone(n.name)).scaling.y=.5,d.position.x+=-1.25;var l,d,v=Fe.a.CreateCylinder(n.name,1,0,.6,6,1,e);return v.position.y+=3,v.parent=r,(l=v.clone(n.name)).position.y=1.5,l.position.x+=1.25,(d=v.clone(n.name)).position.y=1.5,d.position.x+=-1.25,r.scaling.scaleInPlace(t._Scale),r.rotation.z=Math.PI/2,r.rotation.y=Math.PI/2,n},t._Scale=.007,t._CreateLightLines=function(e,n){var r=new Fe.a("root",n);r.rotation.x=Math.PI/2;var o=new Fe.a("linePivot",n);o.parent=r;var l=Fe.a.CreateCylinder("line",2,.2,.3,6,1,n);if(l.position.y=l.scaling.y/2+1.2,l.parent=o,e<2)return o;for(var d=0;d<4;d++)(v=o.clone("lineParentClone")).rotation.z=Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*d,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2;if(e<3)return r;for(d=0;d<4;d++)(v=o.clone("linePivotClone")).rotation.z=Math.PI/2,v.rotation.y=Math.PI/2*d;if(e<4)return r;for(d=0;d<4;d++){var v;(v=o.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*d,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2}return e<5||((v=o.clone("linePivotClone")).rotation.z=Math.PI),r},t}(kr.a),jp=function(){function i(t,e){t===void 0&&(t=h.e.Zero()),e===void 0&&(e=h.e.Up()),this.position=t,this.normal=e}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone())},i}(),xI=function(){function i(t,e,n){t===void 0&&(t=h.e.Zero()),e===void 0&&(e=h.e.Up()),n===void 0&&(n=h.d.Zero()),this.position=t,this.normal=e,this.uv=n}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone(),this.uv.clone())},i}(),AI=function(i){function t(e){e===void 0&&(e=Mr.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._pointerObserver=null,n.onClickedObservable=new S.c,n._camera=null,n._invProjection=new h.a,n._material=new rn.a("cameraGizmoMaterial",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new C.a(.5,.5,.5),n._material.specularColor=new C.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._camera&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._camera))},Ot.a.POINTERDOWN),n}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(e){this._cameraLinesMesh.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){var n=this;if(this._camera=e,this.attachedNode=e,e){this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._cameraMesh=t._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=t._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*e.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=1.5*e.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),this.attachedNode.reservedDataStore.cameraGizmo=this;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._camera&&(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._material.dispose(),i.prototype.dispose.call(this)},t._CreateCameraMesh=function(e){var n=new Fe.a("rootCameraGizmo",e),r=new Fe.a(n.name,e);r.parent=n,ps.a.CreateBox(n.name,{width:1,height:.8,depth:.5},e).parent=r;var o=Vi.a.CreateCylinder(n.name,{height:.5,diameterTop:.8,diameterBottom:.8},e);o.parent=r,o.position.y=.3,o.position.x=-.6,o.rotation.x=.5*Math.PI;var l=Vi.a.CreateCylinder(n.name,{height:.5,diameterTop:.6,diameterBottom:.6},e);l.parent=r,l.position.y=.5,l.position.x=.4,l.rotation.x=.5*Math.PI;var d=Vi.a.CreateCylinder(n.name,{height:.5,diameterTop:.5,diameterBottom:.5},e);return d.parent=r,d.position.y=0,d.position.x=.6,d.rotation.z=.5*Math.PI,n.scaling.scaleInPlace(t._Scale),r.position.x=-.9,n},t._CreateCameraFrustum=function(e){var n=new Fe.a("rootCameraGizmo",e),r=new Fe.a(n.name,e);r.parent=n;for(var o=0;o<4;o+=2)for(var l=0;l<4;l+=2){var d;(d=Jn.a.CreateLines("lines",{points:[new h.e(-1+l,-1+o,-1),new h.e(-1+l,-1+o,1)]},e)).parent=r,d.alwaysSelectAsActiveMesh=!0,d.isPickable=!1,(d=Jn.a.CreateLines("lines",{points:[new h.e(-1,-1+l,-1+o),new h.e(1,-1+l,-1+o)]},e)).parent=r,d.alwaysSelectAsActiveMesh=!0,d.isPickable=!1,(d=Jn.a.CreateLines("lines",{points:[new h.e(-1+l,-1,-1+o),new h.e(-1+l,1,-1+o)]},e)).parent=r,d.alwaysSelectAsActiveMesh=!0,d.isPickable=!1}return n},t._Scale=.05,t}(kr.a);Qe.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};";var PI=`vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}`;Qe.a.IncludesShadersStore.packingFunctions=PI;var CI=`#ifdef DOF
factor=sampleCoC(sampleCoord{X});
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`;Qe.a.IncludesShadersStore.kernelBlurFragment=CI;var RI=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`;Qe.a.IncludesShadersStore.kernelBlurFragment2=RI;var OI=`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g;
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r;
return coc;
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
#include<packingFunctions>
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT;
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;Qe.a.ShadersStore.kernelBlurPixelShader=OI,Qe.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";var MI=`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) {
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.kernelBlurVertexShader=MI;var ar=function(i){function t(e,n,r,o,l,d,v,y,D,w,F){d===void 0&&(d=ke.a.BILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),w===void 0&&(w=""),F===void 0&&(F=!1);var z=i.call(this,e,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],o,l,d,v,y,null,D,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return z.blockCompilation=F,z._packedFloat=!1,z._staticDefines="",z._staticDefines=w,z.direction=n,z.onApplyObservable.add(function(k){z._outputTexture?k.setFloat2("delta",1/z._outputTexture.width*z.direction.x,1/z._outputTexture.height*z.direction.y):k.setFloat2("delta",1/z.width*z.direction.x,1/z.height*z.direction.y)}),z.kernel=r,z}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"BlurPostProcess"},t.prototype.updateEffect=function(e,n,r,o,l,d){this._updateParameters(l,d)},t.prototype._updateParameters=function(e,n){for(var r=this._kernel,o=(r-1)/2,l=[],d=[],v=0,y=0;y<r;y++){var D=y/(r-1),w=this._gaussianWeight(2*D-1);l[y]=y-o,d[y]=w,v+=w}for(y=0;y<d.length;y++)d[y]/=v;var F=[],z=[],k=[];for(y=0;y<=o;y+=2){var K=Math.min(y+1,Math.floor(o));if(y===K)k.push({o:l[y],w:d[y]});else{var ae=K===o,le=d[y]+d[K]*(ae?.5:1),fe=l[y]+1/(1+d[y]/d[K]);fe===0?(k.push({o:l[y],w:d[y]}),k.push({o:l[y+1],w:d[y+1]})):(k.push({o:fe,w:le}),k.push({o:-fe,w:le}))}}for(y=0;y<k.length;y++)z[y]=k[y].o,F[y]=k[y].w;l=z,d=F;var me=this.getEngine().getCaps().maxVaryingVectors,be=Math.max(me,0)-1,Ee=Math.min(l.length,be),xe="";for(xe+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(xe+="#define CENTER_WEIGHT "+this._glslFloat(d[Ee-1])+`\r
`,Ee--),y=0;y<Ee;y++)xe+="#define KERNEL_OFFSET"+y+" "+this._glslFloat(l[y])+`\r
`,xe+="#define KERNEL_WEIGHT"+y+" "+this._glslFloat(d[y])+`\r
`;var Ae=0;for(y=be;y<l.length;y++)xe+="#define KERNEL_DEP_OFFSET"+Ae+" "+this._glslFloat(l[y])+`\r
`,xe+="#define KERNEL_DEP_WEIGHT"+Ae+" "+this._glslFloat(d[y])+`\r
`,Ae++;this.packedFloat&&(xe+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,i.prototype.updateEffect.call(this,xe,null,null,{varyingCount:Ee,depCount:Ae},e,n)},t.prototype._nearestBestKernel=function(e){for(var n=Math.round(e),r=0,o=[n,n-1,n+1,n-2,n+2];r<o.length;r++){var l=o[r];if(l%2!=0&&Math.floor(l/2)%2==0&&l>0)return Math.max(l,3)}return Math.max(n,3)},t.prototype._gaussianWeight=function(e){var n=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(n)},t.prototype._glslFloat=function(e,n){return n===void 0&&(n=8),e.toFixed(n).replace(/0+$/,"")},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.direction,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,void 0,!1)},e,r,o)},Object(f.c)([Object(B.c)("kernel")],t.prototype,"_kernel",void 0),Object(f.c)([Object(B.c)("packedFloat")],t.prototype,"_packedFloat",void 0),Object(f.c)([Object(B.n)()],t.prototype,"direction",void 0),t}(St);R.a.RegisteredTypes["BABYLON.BlurPostProcess"]=ar;var zp=function(i){function t(e,n,r,o,l,d,v){l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),d===void 0&&(d=ke.a.BILINEAR_SAMPLINGMODE),v===void 0&&(v=!0);var y=i.call(this,e,n,r,o,!0,l,!1,d,v)||this;return y.scene=r,y.mirrorPlane=new hs.a(0,1,0,1),y._transformMatrix=h.a.Zero(),y._mirrorMatrix=h.a.Zero(),y._adaptiveBlurKernel=0,y._blurKernelX=0,y._blurKernelY=0,y._blurRatio=1,y.ignoreCameraViewport=!0,y._updateGammaSpace(),y._imageProcessingConfigChangeObserver=r.imageProcessingConfiguration.onUpdateParameters.add(function(){y._updateGammaSpace}),y.onBeforeRenderObservable.add(function(){h.a.ReflectionToRef(y.mirrorPlane,y._mirrorMatrix),y._savedViewMatrix=r.getViewMatrix(),y._mirrorMatrix.multiplyToRef(y._savedViewMatrix,y._transformMatrix),r.setTransformMatrix(y._transformMatrix,r.getProjectionMatrix()),r.clipPlane=y.mirrorPlane,r.getEngine().cullBackFaces=!1,r._mirroredCameraPosition=h.e.TransformCoordinates(r.activeCamera.globalPosition,y._mirrorMatrix)}),y.onAfterRenderObservable.add(function(){r.setTransformMatrix(y._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,r._mirroredCameraPosition=null,r.clipPlane=null}),y}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),n=this.getRenderWidth()/e.getRenderWidth(),r=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*n,this.blurKernelY=this._adaptiveBlurKernel*r},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),n=e.getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new ar("horizontal blur",new h.d(1,0),this._blurKernelX,this._blurRatio,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurX.autoClear=!1,this._blurRatio===1&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new ar("vertical blur",new h.d(0,1),this._blurKernelY,this._blurRatio,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=this._blurRatio!==1,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(qn);ke.a._CreateMirror=function(i,t,e,n){return new zp(i,t,e,n)};var ci=c(34),yi=function(i){function t(e,n,r,o,l,d,v,y,D,w,F,z,k,K){var ae;r===void 0&&(r=null),o===void 0&&(o=!1),l===void 0&&(l=null),d===void 0&&(d=null),v===void 0&&(v=null),y===void 0&&(y=g.a.TEXTUREFORMAT_RGBA),D===void 0&&(D=!1),w===void 0&&(w=null),F===void 0&&(F=!1),z===void 0&&(z=.8),k===void 0&&(k=0);var le=i.call(this,n)||this;if(le.onLoadObservable=new S.c,le.boundingBoxPosition=h.e.Zero(),le._rotationY=0,le._files=null,le._forcedExtension=null,le._extensions=null,le.name=e,le.url=e,le._noMipmap=o,le.hasAlpha=!1,le._format=y,le.isCube=!0,le._textureMatrix=h.a.Identity(),le._createPolynomials=F,le.coordinatesMode=ke.a.CUBIC_MODE,le._extensions=r,le._files=l,le._forcedExtension=w,le._loaderOptions=K,!e&&!l)return le;var fe=e.lastIndexOf("."),me=w||(fe>-1?e.substring(fe).toLowerCase():""),be=me===".dds",Ee=me===".env";if(Ee?(le.gammaSpace=!1,le._prefiltered=!1,le.anisotropicFilteringLevel=1):(le._prefiltered=D,D&&(le.gammaSpace=!1,le.anisotropicFilteringLevel=1)),le._texture=le._getFromCache(e,o),!l&&(Ee||be||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),l=[],r))for(var xe=0;xe<r.length;xe++)l.push(e+r[xe]);le._files=l;var Ae=function(){le.onLoadObservable.notifyObservers(le),d&&d()};if(le._texture)le._texture.isReady?et.b.SetImmediate(function(){return Ae()}):le._texture.onLoadedObservable.add(function(){return Ae()});else{var Ie=le.getScene();(Ie==null?void 0:Ie.useDelayedTextureLoading)?le.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:(le._texture=D?le._getEngine().createPrefilteredCubeTexture(e,Ie,z,k,d,v,y,w,le._createPolynomials):le._getEngine().createCubeTexture(e,Ie,l,o,d,v,le._format,w,!1,z,k,null,K),(ae=le._texture)===null||ae===void 0||ae.onLoadedObservable.add(function(){return le.onLoadObservable.notifyObservers(le)}))}return le}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(h.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),t.CreateFromImages=function(e,n,r){var o="";return e.forEach(function(l){return o+=l}),new t(o,n,null,r,e)},t.CreateFromPrefilteredData=function(e,n,r,o){r===void 0&&(r=null),o===void 0&&(o=!0);var l=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;var d=new t(e,n,null,!1,null,null,null,void 0,!0,r,o);return n.useDelayedTextureLoading=l,d},t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,n,r,o){var l;o===void 0&&(o=!1),this.url&&(this.releaseInternalTexture(),(l=this.getScene())===null||l===void 0||l.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)),this.name&&!ci.a.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=o,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=n||null,r&&(this._delayedOnLoad=r),this.delayLoad(n)},t.prototype.delayLoad=function(e){var n,r=this;if(this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),!this._texture)){var o=this.getScene();this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,.8,0,this._delayedOnLoad,void 0,this._format,e,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,e,!1,0,0,null,this._loaderOptions),(n=this._texture)===null||n===void 0||n.onLoadedObservable.add(function(){return r.onLoadObservable.notifyObservers(r)})}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1})),this._textureMatrix=e)},t.Parse=function(e,n,r){var o=B.a.Parse(function(){var y=!1;return e.prefiltered&&(y=e.prefiltered),new t(r+e.name,n,e.extensions,!1,e.files||null,null,null,void 0,y,e.forcedExtension)},e,n);if(e.boundingBoxPosition&&(o.boundingBoxPosition=h.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=h.e.FromArray(e.boundingBoxSize)),e.animations)for(var l=0;l<e.animations.length;l++){var d=e.animations[l],v=R.a.GetClass("BABYLON.Animation");v&&o.animations.push(v.Parse(d))}return o},t.prototype.clone=function(){var e=this,n=0,r=B.a.Clone(function(){var o=new t(e.url,e.getScene()||e._getEngine(),e._extensions,e._noMipmap,e._files);return n=o.uniqueId,o},this);return r.uniqueId=n,r},Object(f.c)([Object(B.c)()],t.prototype,"url",void 0),Object(f.c)([Object(B.c)("rotationY")],t.prototype,"rotationY",null),Object(f.c)([Object(B.c)("files")],t.prototype,"_files",void 0),Object(f.c)([Object(B.c)("forcedExtension")],t.prototype,"_forcedExtension",void 0),Object(f.c)([Object(B.c)("extensions")],t.prototype,"_extensions",void 0),Object(f.c)([Object(B.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(Zr.a);ke.a._CubeTextureParser=yi.Parse,R.a.RegisteredTypes["BABYLON.CubeTexture"]=yi;var lt=c(15),sh=c(76),ch=c(87),bt=c(19),II=` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`;Qe.a.IncludesShadersStore.backgroundFragmentDeclaration=II;var DI=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Qe.a.IncludesShadersStore.backgroundUboDeclaration=DI,c(131),c(106),c(107),c(154),c(130),c(115),c(125),c(110),c(135),c(136);var wI=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif
#ifndef BACKMAT_SHADOWONLY

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=saturate(viewAngleToFloor/startAngle);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#else
vec4 color=vec4(vPrimaryColor.rgb,(1.0-clamp(globalShadow,0.,1.))*alpha);
#endif
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`;Qe.a.ShadersStore.backgroundPixelShader=wI;var LI=`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`;Qe.a.IncludesShadersStore.backgroundVertexDeclaration=LI,c(78),c(79),c(117),c(137),c(80),c(81),c(111),c(157),c(138);var NI=`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=position;
#endif
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(position,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#endif
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;Qe.a.ShadersStore.backgroundVertexShader=NI;var _s=c(67),FI=function(i){function t(){var e=i.call(this)||this;return e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.GAMMADIFFUSE=!1,e.DIFFUSEHASALPHA=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONBLUR=!1,e.REFLECTIONFRESNEL=!1,e.REFLECTIONFALLOFF=!1,e.TEXTURELODSUPPORT=!1,e.PREMULTIPLYALPHA=!1,e.USERGBCOLOR=!1,e.USEHIGHLIGHTANDSHADOWCOLORS=!1,e.BACKMAT_SHADOWONLY=!1,e.NOISE=!1,e.REFLECTIONBGR=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.EQUIRECTANGULAR_RELFECTION_FOV=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.NORMAL=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.INSTANCES=!1,e.SHADOWFLOAT=!1,e.rebuild(),e}return Object(f.d)(t,i),t}(sh.a),Jc=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.primaryColor=C.a.White(),r._primaryColorShadowLevel=0,r._primaryColorHighlightLevel=0,r.reflectionTexture=null,r.reflectionBlur=0,r.diffuseTexture=null,r._shadowLights=null,r.shadowLights=null,r.shadowLevel=0,r.sceneCenter=h.e.Zero(),r.opacityFresnel=!0,r.reflectionFresnel=!1,r.reflectionFalloffDistance=0,r.reflectionAmount=1,r.reflectionReflectance0=.05,r.reflectionReflectance90=.5,r.useRGBColor=!0,r.enableNoise=!1,r._fovMultiplier=1,r.useEquirectangularFOV=!1,r._maxSimultaneousLights=4,r.maxSimultaneousLights=4,r._shadowOnly=!1,r.shadowOnly=!1,r._imageProcessingObserver=null,r.switchToBGR=!1,r._renderTargets=new Gn.a(16),r._reflectionControls=h.f.Zero(),r._white=C.a.White(),r._primaryShadowColor=C.a.Black(),r._primaryHighlightColor=C.a.Black(),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._diffuseTexture&&r._diffuseTexture.isRenderTarget&&r._renderTargets.push(r._diffuseTexture),r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r._renderTargets},r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var n=e;n<.5?(n*=2,this.reflectionReflectance0=t.StandardReflectance0*n,this.reflectionReflectance90=t.StandardReflectance90*n):(n=2*n-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*n,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._computePrimaryColorFromPerceptualColor(),n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._shadowOnly},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new FI);var l=this.getScene(),d=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var v=l.getEngine();if(lt.a.PrepareDefinesForLights(l,e,d,!1,this._maxSimultaneousLights),d._needNormals=!0,lt.a.PrepareDefinesForMultiview(l,d),d._areTexturesDirty){if(d._needUVs=!1,l.texturesEnabled){if(l.getEngine().getCaps().textureLOD&&(d.TEXTURELODSUPPORT=!0),this._diffuseTexture&&bt.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;lt.a.PrepareDefinesForMergedUV(this._diffuseTexture,d,"DIFFUSE"),d.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,d.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,d.OPACITYFRESNEL=this._opacityFresnel}else d.DIFFUSE=!1,d.DIFFUSEHASALPHA=!1,d.GAMMADIFFUSE=!1,d.OPACITYFRESNEL=!1;var y=this._reflectionTexture;if(y&&bt.a.ReflectionTextureEnabled){if(!y.isReadyOrNotBlocking())return!1;switch(d.REFLECTION=!0,d.GAMMAREFLECTION=y.gammaSpace,d.RGBDREFLECTION=y.isRGBD,d.REFLECTIONBLUR=this._reflectionBlur>0,d.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!y.invertZ:y.invertZ,d.LODINREFLECTIONALPHA=y.lodLevelInAlpha,d.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,d.REFLECTIONBGR=this.switchToBGR,y.coordinatesMode===ke.a.INVCUBIC_MODE&&(d.INVERTCUBICMAP=!0),d.REFLECTIONMAP_3D=y.isCube,y.coordinatesMode){case ke.a.EXPLICIT_MODE:d.REFLECTIONMAP_EXPLICIT=!0;break;case ke.a.PLANAR_MODE:d.REFLECTIONMAP_PLANAR=!0;break;case ke.a.PROJECTION_MODE:d.REFLECTIONMAP_PROJECTION=!0;break;case ke.a.SKYBOX_MODE:d.REFLECTIONMAP_SKYBOX=!0;break;case ke.a.SPHERICAL_MODE:d.REFLECTIONMAP_SPHERICAL=!0;break;case ke.a.EQUIRECTANGULAR_MODE:d.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MODE:d.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:d.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ke.a.CUBIC_MODE:case ke.a.INVCUBIC_MODE:default:d.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(d.REFLECTIONFRESNEL=!0,d.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(d.REFLECTIONFRESNEL=!1,d.REFLECTIONFALLOFF=!1)}else d.REFLECTION=!1,d.REFLECTIONFRESNEL=!1,d.REFLECTIONFALLOFF=!1,d.REFLECTIONBLUR=!1,d.REFLECTIONMAP_3D=!1,d.REFLECTIONMAP_SPHERICAL=!1,d.REFLECTIONMAP_PLANAR=!1,d.REFLECTIONMAP_CUBIC=!1,d.REFLECTIONMAP_PROJECTION=!1,d.REFLECTIONMAP_SKYBOX=!1,d.REFLECTIONMAP_EXPLICIT=!1,d.REFLECTIONMAP_EQUIRECTANGULAR=!1,d.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,d.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,d.INVERTCUBICMAP=!1,d.REFLECTIONMAP_OPPOSITEZ=!1,d.LODINREFLECTIONALPHA=!1,d.GAMMAREFLECTION=!1,d.RGBDREFLECTION=!1}d.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,d.USERGBCOLOR=this._useRGBColor,d.NOISE=this._enableNoise}if(d._areLightsDirty&&(d.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(this._primaryColorShadowLevel!==0||this._primaryColorHighlightLevel!==0),d.BACKMAT_SHADOWONLY=this._shadowOnly),d._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(d)}if(lt.a.PrepareDefinesForMisc(e,l,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),d),lt.a.PrepareDefinesForFrameBoundValues(l,v,d,r,null,n.getRenderingMesh().hasThinInstances),lt.a.PrepareDefinesForAttributes(e,d,!1,!0,!1)&&e&&(l.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(De.b.NormalKind)||(e.createNormals(!0),_.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),d.isDirty){d.markAsProcessed(),l.resetCachedMaterial();var D=new _s.a;d.FOG&&D.addFallback(0,"FOG"),d.POINTSIZE&&D.addFallback(1,"POINTSIZE"),d.MULTIVIEW&&D.addFallback(0,"MULTIVIEW"),lt.a.HandleFallbacksForShadows(d,D,this._maxSimultaneousLights);var w=[De.b.PositionKind];d.NORMAL&&w.push(De.b.NormalKind),d.UV1&&w.push(De.b.UVKind),d.UV2&&w.push(De.b.UV2Kind),lt.a.PrepareAttributesForBones(w,e,d,D),lt.a.PrepareAttributesForInstances(w,d);var F=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],z=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],k=["Material","Scene"];fr.a&&(fr.a.PrepareUniforms(F,d),fr.a.PrepareSamplers(z,d)),lt.a.PrepareUniformsAndSamplersList({uniformsNames:F,uniformBuffersNames:k,samplers:z,defines:d,maxSimultaneousLights:this._maxSimultaneousLights});var K=d.toString();n.setEffect(l.getEngine().createEffect("background",{attributes:w,uniformsNames:F,uniformBuffersNames:k,samplers:z,defines:K,fallbacks:D,onCompiled:function(ae){o.onCompiled&&o.onCompiled(ae),o.bindSceneUniformBuffer(ae,l.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},v),d),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(d._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){this._primaryColorShadowLevel===0&&this._primaryColorHighlightLevel===0||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),i.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r._materialDefines;if(l){var d=r.effect;if(d){this._activeEffect=d,this.bindOnlyWorldMatrix(e),lt.a.BindBonesParameters(n,this._activeEffect);var v=this._mustRebind(o,d,n.visibility);if(v){this._uniformBuffer.bindToEffect(d,"Material"),this.bindViewProjection(d);var y=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(o.texturesEnabled&&(this._diffuseTexture&&bt.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),lt.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),y&&bt.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",y.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",y.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),l.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),o.texturesEnabled&&(this._diffuseTexture&&bt.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),y&&bt.a.ReflectionTextureEnabled&&(l.REFLECTIONBLUR&&l.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",y):l.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",y._lodTextureMid||y),this._uniformBuffer.setTexture("reflectionSamplerLow",y._lodTextureLow||y),this._uniformBuffer.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)):this._uniformBuffer.setTexture("reflectionSampler",y),l.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),lt.a.BindClipPlane(this._activeEffect,o),lt.a.BindEyePosition(d,o)}!v&&this.isFrozen||(o.lightsEnabled&&lt.a.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,!1),this.bindView(d),lt.a.BindFogParameters(o,n,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._reflectionTexture===e||this._diffuseTexture===e},t.prototype.dispose=function(e,n){e===void 0&&(e=!1),n===void 0&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e)},t.prototype.clone=function(e){var n=this;return B.a.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.BackgroundMaterial",e},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e.name,n)},e,n,r)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,Object(f.c)([Object(B.e)()],t.prototype,"_primaryColor",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),Object(f.c)([Object(B.e)()],t.prototype,"__perceptualColor",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_primaryColorShadowLevel",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),Object(f.c)([Object(B.m)()],t.prototype,"_reflectionTexture",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionBlur",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),Object(f.c)([Object(B.m)()],t.prototype,"_diffuseTexture",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_shadowLevel",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),Object(f.c)([Object(B.o)()],t.prototype,"_sceneCenter",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_opacityFresnel",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionFresnel",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionFalloffDistance",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionAmount",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionReflectance0",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_reflectionReflectance90",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_useRGBColor",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_enableNoise",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_maxSimultaneousLights",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_shadowOnly",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"shadowOnly",void 0),Object(f.c)([Object(B.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(ch.a);R.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=Jc;var Gp=function(){function i(t,e){var n=this;this._errorHandler=function(r,o){n.onErrorObservable.notifyObservers({message:r,exception:o})},this._options=Object(f.a)(Object(f.a)({},i._getDefaultOptions()),t),this._scene=e,this.onErrorObservable=new S.c,this._setupBackground(),this._setupImageProcessing()}return i._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new C.a(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:g.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new C.a(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:h.e.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(i.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skybox",{get:function(){return this._skybox},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ground",{get:function(){return this._ground},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!1,configurable:!0}),i.prototype.updateOptions=function(t){var e=Object(f.a)(Object(f.a)({},this._options),t);this._ground&&!e.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!e.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=e.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!e.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!e.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=e.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!e.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=e.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=e,this._setupBackground(),this._setupImageProcessing()},i.prototype.setMainColor=function(t){this.groundMaterial&&(this.groundMaterial.primaryColor=t),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=t),this.groundMirror&&(this.groundMirror.clearColor=new C.b(t.r,t.g,t.b,1))},i.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},i.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof Zr.a)this._scene.environmentTexture=this._options.environmentTexture;else{var t=yi.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=t}},i.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new Fe.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var t=this._getSceneSize();this._options.createGround&&(this._setupGround(t),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(t),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(t),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=t.rootPosition.x,this._rootMesh.position.z=t.rootPosition.z,this._rootMesh.position.y=t.rootPosition.y},i.prototype._getSceneSize=function(){var t=this,e=this._options.groundSize,n=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||this._scene.meshes.length===1)return{groundSize:e,skyboxSize:n,rootPosition:r};var o=this._scene.getWorldExtends(function(v){return v!==t._ground&&v!==t._rootMesh&&v!==t._skybox}),l=o.max.subtract(o.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Fi&&this._scene.activeCamera.upperRadiusLimit&&(n=e=2*this._scene.activeCamera.upperRadiusLimit);var d=l.length();d>e&&(n=e=2*d),e*=1.1,n*=1.5,(r=o.min.add(l.scale(.5))).y=o.min.y-this._options.groundYBias}return{groundSize:e,skyboxSize:n,rootPosition:r}},i.prototype._setupGround=function(t){var e=this;this._ground&&!this._ground.isDisposed()||(this._ground=Fe.a.CreatePlane("BackgroundPlane",t.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){e._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},i.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new Jc("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},i.prototype._setupGroundDiffuseTexture=function(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof Zr.a?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new ke.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))},i.prototype._setupGroundMirrorTexture=function(t){var e=ke.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new zp("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,ke.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new hs.a(0,-1,0,t.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=e,this._groundMirror.wrapV=e,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var n=0;n<this._scene.meshes.length;n++){var r=this._scene.meshes[n];r!==this._ground&&r!==this._skybox&&r!==this._rootMesh&&this._groundMirror.renderList.push(r)}this._groundMirror.clearColor=new C.b(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},i.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},i.prototype._setupSkybox=function(t){var e=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=Fe.a.CreateBox("BackgroundSkybox",t.skyboxSize,this._scene,void 0,Fe.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){e._skybox=null})),this._skybox.parent=this._rootMesh},i.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Jc("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},i.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof Zr.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new yi(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=ke.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},i.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},i._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",i._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",i._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",i}(),jo=function(i){function t(e,n,r,o,l){l===void 0&&(l=null);var d=i.call(this,e,o)||this;d.onError=l,d._halfDome=!1,d._crossEye=!1,d._useDirectMapping=!1,d._textureMode=t.MODE_MONOSCOPIC,d._onBeforeCameraRenderObserver=null,d.onLoadErrorObservable=new S.c,o=d.getScene(),e=e||"textureDome",r.resolution=0|Math.abs(r.resolution)||32,r.clickToPlay=Boolean(r.clickToPlay),r.autoPlay=r.autoPlay===void 0||Boolean(r.autoPlay),r.loop=r.loop===void 0||Boolean(r.loop),r.size=Math.abs(r.size)||(o.activeCamera?.48*o.activeCamera.maxZ:1e3),r.useDirectMapping===void 0?d._useDirectMapping=!0:d._useDirectMapping=r.useDirectMapping,r.faceForward===void 0&&(r.faceForward=!0),d._setReady(!1),d._mesh=Fe.a.CreateSphere(e+"_mesh",r.resolution,r.size,o,!1,Fe.a.BACKSIDE);var v=d._material=new Jc(e+"_material",o);v.useEquirectangularFOV=!0,v.fovMultiplier=1,v.opacityFresnel=!1;var y=d._initTexture(n,o,r);if(d.texture=y,d._mesh.material=v,d._mesh.parent=d,d._halfDomeMask=jr.a.CreateSphere("",{slice:.5,diameter:.98*r.size,segments:2*r.resolution,sideOrientation:Fe.a.BACKSIDE},o),d._halfDomeMask.rotate(Te.a.X,-Math.PI/2),d._halfDomeMask.parent=d._mesh,d._halfDome=!!r.halfDomeMode,d._halfDomeMask.setEnabled(d._halfDome),d._crossEye=!!r.crossEyeMode,d._texture.anisotropicFilteringLevel=1,d._texture.onLoadObservable.addOnce(function(){d._setReady(!0)}),r.faceForward&&o.activeCamera){var D=o.activeCamera,w=h.e.Forward(),F=h.e.TransformNormal(w,D.getViewMatrix());F.normalize(),d.rotation.y=Math.acos(h.e.Dot(w,F))}return d._changeTextureMode(d._textureMode),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._useDirectMapping?(this._texture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._texture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._texture):(this._texture.coordinatesMode=ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._texture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._texture),this._changeTextureMode(this._textureMode))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureMode",{get:function(){return this._textureMode},set:function(e){this._textureMode!==e&&this._changeTextureMode(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDome",{get:function(){return this._halfDome},set:function(e){this._halfDome=e,this._halfDomeMask.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"crossEye",{get:function(){return this._crossEye},set:function(e){this._crossEye=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._changeTextureMode=function(e){var n=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._textureMode=e,this._texture.uScale=1,this._texture.vScale=1,this._texture.uOffset=0,this._texture.vOffset=0,this._texture.vAng=0,e){case t.MODE_MONOSCOPIC:this._halfDome&&(this._texture.uScale=2,this._texture.uOffset=-1);break;case t.MODE_SIDEBYSIDE:this._texture.uScale=this._halfDome?.99999:.5;var r=this._halfDome?0:.5,o=this._halfDome?-.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(l){var d=l.isRightCamera;n._crossEye&&(d=!d),n._texture.uOffset=d?r:o});break;case t.MODE_TOPBOTTOM:this._texture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(l){var d=l.isRightCamera;n._crossEye&&(d=!d),n._texture.vOffset=d?.5:0})}},t.prototype.dispose=function(e,n){n===void 0&&(n=!1),this._texture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this.onLoadErrorObservable.clear(),i.prototype.dispose.call(this,e,n)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(ms.a),BI=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this.texture},set:function(e){this.texture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this;return new ke.a(e,n,!r.generateMipMaps,!this._useDirectMapping,void 0,void 0,function(l,d){o.onLoadErrorObservable.notifyObservers(l||"Unknown error occured"),o.onError&&o.onError(l,d)})},t.MODE_MONOSCOPIC=jo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=jo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=jo.MODE_SIDEBYSIDE,t}(jo),jy=function(){function i(){}return i.ExpandRGBDTexture=function(t){var e=t._texture;if(e&&t.isRGBD){var n=e.getEngine(),r=n.getCaps(),o=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(o=!0,e.type=g.a.TEXTURETYPE_HALF_FLOAT):r.textureFloatRender&&r.textureFloatLinearFiltering&&(o=!0,e.type=g.a.TEXTURETYPE_FLOAT),o&&(e.isReady=!1,e._isRGBD=!1,e.invertY=!1),t.onLoadObservable.addOnce(function(){if(o){var l=new St("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!1,void 0,e.type,void 0,null,!1),d=n.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:e.samplingMode,type:e.type,format:g.a.TEXTUREFORMAT_RGBA});l.getEffect().executeWhenCompiled(function(){l.onApply=function(v){v._bindTexture("textureSampler",e),v.setFloat2("scale",1,1)},t.getScene().postProcessManager.directRender([l],d,!0),n.restoreDefaultFramebuffer(),n._releaseTexture(e),n._releaseFramebufferObjects(d),l&&l.dispose(),d._swapAndDie(e),e.isReady=!0})}})}},i}(),lh=function(){function i(){}return i.GetEnvironmentBRDFTexture=function(t){if(!t.environmentBRDFTexture){var e=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;var n=t._blockEntityCollection;t._blockEntityCollection=!1;var r=ke.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+this._instanceNumber++,t,!0,!1,ke.a.BILINEAR_SAMPLINGMODE);t._blockEntityCollection=n;var o=t.getEngine().getLoadedTexturesCache(),l=o.indexOf(r.getInternalTexture());l!==-1&&o.splice(l,1),r.isRGBD=!0,r.wrapU=ke.a.CLAMP_ADDRESSMODE,r.wrapV=ke.a.CLAMP_ADDRESSMODE,t.environmentBRDFTexture=r,t.useDelayedTextureLoading=e,jy.ExpandRGBDTexture(r)}return t.environmentBRDFTexture},i._instanceNumber=0,i._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",i}(),gs=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=i._DefaultIndexOfRefraction,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=C.a.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e,n,r){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&bt.a.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()||n.getCaps().standardDerivatives&&this._bumpTexture&&bt.a.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady()||this._isTintEnabled&&this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&bt.a.ClearCoatTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&bt.a.ClearCoatBumpTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===i._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&bt.a.ClearCoatTintTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r,o,l,d,v){var y,D,w,F,z,k,K,ae,le=v._materialDefines,fe=le.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!t.useUbo||!o||!t.isSync){fe&&bt.a.ClearCoatTextureEnabled?(t.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),lt.a.BindTextureMatrix(this._texture,t,"clearCoat")):(this._texture||this._textureRoughness)&&bt.a.ClearCoatTextureEnabled&&(t.updateFloat4("vClearCoatInfos",(D=(y=this._texture)===null||y===void 0?void 0:y.coordinatesIndex)!==null&&D!==void 0?D:0,(F=(w=this._texture)===null||w===void 0?void 0:w.level)!==null&&F!==void 0?F:0,(k=(z=this._textureRoughness)===null||z===void 0?void 0:z.coordinatesIndex)!==null&&k!==void 0?k:0,(ae=(K=this._textureRoughness)===null||K===void 0?void 0:K.level)!==null&&ae!==void 0?ae:0),this._texture&&lt.a.BindTextureMatrix(this._texture,t,"clearCoat"),!this._textureRoughness||fe||le.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||lt.a.BindTextureMatrix(this._textureRoughness,t,"clearCoatRoughness")),this._bumpTexture&&n.getCaps().standardDerivatives&&bt.a.ClearCoatTextureEnabled&&!r&&(t.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),lt.a.BindTextureMatrix(this._bumpTexture,t,"clearCoatBump"),e._mirroredCameraPosition?t.updateFloat2("vClearCoatTangentSpaceParams",l?1:-1,d?1:-1):t.updateFloat2("vClearCoatTangentSpaceParams",l?-1:1,d?-1:1)),this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&(t.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),lt.a.BindTextureMatrix(this._tintTexture,t,"clearCoatTint")),t.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var me=1-this._indexOfRefraction,be=1+this._indexOfRefraction,Ee=Math.pow(-me/be,2),xe=1/this._indexOfRefraction;t.updateFloat4("vClearCoatRefractionParams",Ee,xe,me,be),this._isTintEnabled&&(t.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),t.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}e.texturesEnabled&&(this._texture&&bt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!fe&&!le.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&bt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&n.getCaps().standardDerivatives&&bt.a.ClearCoatBumpTextureEnabled&&!r&&t.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&bt.a.ClearCoatTintTextureEnabled&&t.setTexture("clearCoatTintSampler",this._tintTexture))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t||this._bumpTexture===t||this._tintTexture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness),this._bumpTexture&&t.push(this._bumpTexture),this._tintTexture&&t.push(this._tintTexture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&t.push(this._tintTexture)},i.prototype.dispose=function(t){var e,n,r,o;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose(),(r=this._bumpTexture)===null||r===void 0||r.dispose(),(o=this._tintTexture)===null||o===void 0||o.dispose())},i.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},i.AddFallbacks=function(t,e,n){return t.CLEARCOAT_BUMP&&e.addFallback(n++,"CLEARCOAT_BUMP"),t.CLEARCOAT_TINT&&e.addFallback(n++,"CLEARCOAT_TINT"),t.CLEARCOAT&&e.addFallback(n++,"CLEARCOAT"),n},i.AddUniforms=function(t){t.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatRoughnessMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},i.AddSamplers=function(t){t.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},i.PrepareUniformBuffer=function(t){t.addUniform("vClearCoatParams",2),t.addUniform("vClearCoatRefractionParams",4),t.addUniform("vClearCoatInfos",4),t.addUniform("clearCoatMatrix",16),t.addUniform("clearCoatRoughnessMatrix",16),t.addUniform("vClearCoatBumpInfos",2),t.addUniform("vClearCoatTangentSpaceParams",2),t.addUniform("clearCoatBumpMatrix",16),t.addUniform("vClearCoatTintParams",4),t.addUniform("clearCoatColorAtDistance",1),t.addUniform("vClearCoatTintInfos",2),t.addUniform("clearCoatTintMatrix",16)},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},i._DefaultIndexOfRefraction=1.5,Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(f.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(f.c)([Object(B.c)()],i.prototype,"roughness",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"remapF0OnInterfaceChange",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTintEnabled",void 0),Object(f.c)([Object(B.e)()],i.prototype,"tintColor",void 0),Object(f.c)([Object(B.c)()],i.prototype,"tintColorAtDistance",void 0),Object(f.c)([Object(B.c)()],i.prototype,"tintThickness",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"tintTexture",void 0),i}(),vs=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new h.d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&this._texture&&bt.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},i.prototype.prepareDefines=function(t,e,n){this._isEnabled?(t.ANISOTROPIC=this._isEnabled,this._isEnabled&&!e.isVerticesDataPresent(De.b.TangentKind)&&(t._needUVs=!0,t.MAINUV1=!0),t._areTexturesDirty&&n.texturesEnabled&&(this._texture&&bt.a.AnisotropicTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"ANISOTROPIC_TEXTURE"):t.ANISOTROPIC_TEXTURE=!1)):(t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1)},i.prototype.bindForSubMesh=function(t,e,n){t.useUbo&&n&&t.isSync||(this._texture&&bt.a.AnisotropicTextureEnabled&&(t.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),lt.a.BindTextureMatrix(this._texture,t,"anisotropy")),t.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),e.texturesEnabled&&this._texture&&bt.a.AnisotropicTextureEnabled&&t.setTexture("anisotropySampler",this._texture)},i.prototype.hasTexture=function(t){return this._texture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture)},i.prototype.dispose=function(t){t&&this._texture&&this._texture.dispose()},i.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},i.AddFallbacks=function(t,e,n){return t.ANISOTROPIC&&e.addFallback(n++,"ANISOTROPIC"),n},i.AddUniforms=function(t){t.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vAnisotropy",3),t.addUniform("vAnisotropyInfos",2),t.addUniform("anisotropyMatrix",16)},i.AddSamplers=function(t){t.push("anisotropySampler")},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(f.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(f.c)([Object(B.n)()],i.prototype,"direction",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),i}(),UI=function(){function i(t){this._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t}return i.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},i.prototype.prepareDefines=function(t){t.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,t.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,t.SPHERICAL_HARMONICS=this._useSphericalHarmonics,t.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},i.prototype.getClassName=function(){return"PBRBRDFConfiguration"},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),i}(),el=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=C.a.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&bt.a.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.SHEEN=this._isEnabled,t.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,t.SHEEN_ROUGHNESS=this._roughness!==null,t.SHEEN_ALBEDOSCALING=this._albedoScaling,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._texture,t,"SHEEN_TEXTURE"):t.SHEEN_TEXTURE=!1,this._textureRoughness&&bt.a.SheenTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"SHEEN_TEXTURE_ROUGHNESS"):t.SHEEN_TEXTURE_ROUGHNESS=!1)):(t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS=!1,t.SHEEN_LINKWITHALBEDO=!1,t.SHEEN_ROUGHNESS=!1,t.SHEEN_ALBEDOSCALING=!1,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r){var o,l,d,v,y,D,w,F,z=r._materialDefines,k=z.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;t.useUbo&&n&&t.isSync||(k&&bt.a.SheenTextureEnabled?(t.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),lt.a.BindTextureMatrix(this._texture,t,"sheen")):(this._texture||this._textureRoughness)&&bt.a.SheenTextureEnabled&&(t.updateFloat4("vSheenInfos",(l=(o=this._texture)===null||o===void 0?void 0:o.coordinatesIndex)!==null&&l!==void 0?l:0,(v=(d=this._texture)===null||d===void 0?void 0:d.level)!==null&&v!==void 0?v:0,(D=(y=this._textureRoughness)===null||y===void 0?void 0:y.coordinatesIndex)!==null&&D!==void 0?D:0,(F=(w=this._textureRoughness)===null||w===void 0?void 0:w.level)!==null&&F!==void 0?F:0),this._texture&&lt.a.BindTextureMatrix(this._texture,t,"sheen"),!this._textureRoughness||k||z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||lt.a.BindTextureMatrix(this._textureRoughness,t,"sheenRoughness")),t.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),this._roughness!==null&&t.updateFloat("vSheenRoughness",this._roughness)),e.texturesEnabled&&(this._texture&&bt.a.SheenTextureEnabled&&t.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k&&!z.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&bt.a.SheenTextureEnabled&&t.setTexture("sheenRoughnessSampler",this._textureRoughness))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness)},i.prototype.dispose=function(t){var e,n;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose())},i.prototype.getClassName=function(){return"PBRSheenConfiguration"},i.AddFallbacks=function(t,e,n){return t.SHEEN&&e.addFallback(n++,"SHEEN"),n},i.AddUniforms=function(t){t.push("vSheenColor","vSheenRoughness","vSheenInfos","sheenMatrix","sheenRoughnessMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vSheenColor",4),t.addUniform("vSheenRoughness",1),t.addUniform("vSheenInfos",4),t.addUniform("sheenMatrix",16),t.addUniform("sheenRoughnessMatrix",16)},i.AddSamplers=function(t){t.push("sheenSampler"),t.push("sheenRoughnessSampler")},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkSheenWithAlbedo",void 0),Object(f.c)([Object(B.c)()],i.prototype,"intensity",void 0),Object(f.c)([Object(B.e)()],i.prototype,"color",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoScaling",void 0),i}(),tl=function(){function i(t,e,n){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=C.a.White(),this.tintColorAtDistance=1,this.diffusionDistance=C.a.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._useMaskFromThicknessTextureGltf=!1,this.useMaskFromThicknessTextureGltf=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t,this._internalMarkScenePrePassDirty=e,this._scene=n}return Object.defineProperty(i.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(t){this._scene.enableSubSurfaceForPrePass()&&t&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(t){this._volumeIndexOfRefraction=t>=1?t:-1},enumerable:!1,configurable:!0}),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},i.prototype.isReadyForSubMesh=function(t,e){if(t._areTexturesDirty&&e.texturesEnabled){if(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var n=this._getRefractionTexture(e);if(n&&bt.a.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(t,e){if(t._areTexturesDirty&&(t.SUBSURFACE=!1,t.SS_TRANSLUCENCY=this._isTranslucencyEnabled,t.SS_SCATTERING=this._isScatteringEnabled,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,t.SS_REFRACTION=!1,t.SS_REFRACTIONMAP_3D=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(t.SUBSURFACE=!0,t._areTexturesDirty&&e.texturesEnabled&&this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&lt.a.PrepareDefinesForMergedUV(this._thicknessTexture,t,"SS_THICKNESSANDMASK_TEXTURE"),t.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=this._useMaskFromThicknessTextureGltf),this._isRefractionEnabled&&e.texturesEnabled)){var n=this._getRefractionTexture(e);n&&bt.a.RefractionTextureEnabled&&(t.SS_REFRACTION=!0,t.SS_REFRACTIONMAP_3D=n.isCube,t.SS_GAMMAREFRACTION=n.gammaSpace,t.SS_RGBDREFRACTION=n.isRGBD,t.SS_LINEARSPECULARREFRACTION=n.linearSpecularLOD,t.SS_REFRACTIONMAP_OPPOSITEZ=n.invertZ,t.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,t.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,t.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction)}},i.prototype.bindForSubMesh=function(t,e,n,r,o,l){var d=this._getRefractionTexture(e);if(!t.useUbo||!r||!t.isSync){if(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&(t.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),lt.a.BindTextureMatrix(this._thicknessTexture,t,"thickness")),t.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),d&&bt.a.RefractionTextureEnabled){t.updateMatrix("refractionMatrix",d.getReflectionTextureMatrix());var v=1;d.isCube||d.depth&&(v=d.depth);var y=d.getSize().width,D=this.volumeIndexOfRefraction;t.updateFloat4("vRefractionInfos",d.level,1/D,v,this._invertRefractionY?-1:1),t.updateFloat3("vRefractionMicrosurfaceInfos",y,d.lodGenerationScale,d.lodGenerationOffset),l&&t.updateFloat2("vRefractionFilteringInfo",y,J.a.Log2(y))}this.isScatteringEnabled&&t.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),t.updateColor3("vDiffusionDistance",this.diffusionDistance),t.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),t.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}e.texturesEnabled&&(this._thicknessTexture&&bt.a.ThicknessTextureEnabled&&t.setTexture("thicknessSampler",this._thicknessTexture),d&&bt.a.RefractionTextureEnabled&&(o?t.setTexture("refractionSampler",d):(t.setTexture("refractionSampler",d._lodTextureMid||d),t.setTexture("refractionSamplerLow",d._lodTextureLow||d),t.setTexture("refractionSamplerHigh",d._lodTextureHigh||d))))},i.prototype.unbind=function(t){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(t.setTexture("refractionSampler",null),!0)},i.prototype._getRefractionTexture=function(t){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?t.environmentTexture:null},Object.defineProperty(i.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),i.prototype.fillRenderTargetTextures=function(t){bt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&t.push(this._refractionTexture)},i.prototype.hasTexture=function(t){return this._thicknessTexture===t||this._refractionTexture===t},i.prototype.hasRenderTargetTextures=function(){return!!(bt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},i.prototype.getActiveTextures=function(t){this._thicknessTexture&&t.push(this._thicknessTexture),this._refractionTexture&&t.push(this._refractionTexture)},i.prototype.getAnimatables=function(t){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&t.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture)},i.prototype.dispose=function(t){t&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},i.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},i.AddFallbacks=function(t,e,n){return t.SS_SCATTERING&&e.addFallback(n++,"SS_SCATTERING"),t.SS_TRANSLUCENCY&&e.addFallback(n++,"SS_TRANSLUCENCY"),n},i.AddUniforms=function(t){t.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionFilteringInfo","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix","scatteringDiffusionProfile")},i.AddSamplers=function(t){t.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},i.PrepareUniformBuffer=function(t){t.addUniform("vRefractionMicrosurfaceInfos",3),t.addUniform("vRefractionFilteringInfo",2),t.addUniform("vRefractionInfos",4),t.addUniform("refractionMatrix",16),t.addUniform("vThicknessInfos",2),t.addUniform("thicknessMatrix",16),t.addUniform("vThicknessParam",2),t.addUniform("vDiffusionDistance",3),t.addUniform("vTintColor",4),t.addUniform("vSubSurfaceIntensity",3),t.addUniform("scatteringDiffusionProfile",1)},i.prototype.copyTo=function(t){B.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return B.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;B.a.Parse(function(){return r},t,e,n)},Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isRefractionEnabled",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTranslucencyEnabled",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markScenePrePassDirty")],i.prototype,"isScatteringEnabled",void 0),Object(f.c)([Object(B.c)()],i.prototype,"_scatteringDiffusionProfileIndex",void 0),Object(f.c)([Object(B.c)()],i.prototype,"refractionIntensity",void 0),Object(f.c)([Object(B.c)()],i.prototype,"translucencyIntensity",void 0),Object(f.c)([Object(B.c)()],i.prototype,"useAlbedoToTintRefraction",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(f.c)([Object(B.c)()],i.prototype,"_volumeIndexOfRefraction",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"volumeIndexOfRefraction",null),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertRefractionY",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkRefractionWithTransparency",void 0),Object(f.c)([Object(B.c)()],i.prototype,"minimumThickness",void 0),Object(f.c)([Object(B.c)()],i.prototype,"maximumThickness",void 0),Object(f.c)([Object(B.e)()],i.prototype,"tintColor",void 0),Object(f.c)([Object(B.c)()],i.prototype,"tintColorAtDistance",void 0),Object(f.c)([Object(B.e)()],i.prototype,"diffusionDistance",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTextureGltf",void 0),i}(),Hp=c(105),pn=c(25),VI=(c(160),`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec4 vMetallicReflectanceFactors;
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)
uniform mat4 view;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#ifdef REALTIME_FILTERING
uniform vec2 vReflectionFilteringInfo;
#endif
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif

#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif

#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_ROUGHNESS
uniform float vSheenRoughness;
#endif
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#ifdef REALTIME_FILTERING
uniform vec2 vRefractionFilteringInfo;
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
#endif
#ifdef PREPASS
#ifdef PREPASS_IRRADIANCE
uniform float scatteringDiffusionProfile;
#endif
#endif`);Qe.a.IncludesShadersStore.pbrFragmentDeclaration=VI;var kI=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec2 vReflectionInfos;
uniform vec2 vReflectionFilteringInfo;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float pointSize;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;
uniform vec4 vMetallicReflectanceFactors;
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
uniform vec4 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
uniform mat4 clearCoatRoughnessMatrix;
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
uniform vec3 vAnisotropy;
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
uniform vec4 vSheenColor;
uniform float vSheenRoughness;
uniform vec4 vSheenInfos;
uniform mat4 sheenMatrix;
uniform mat4 sheenRoughnessMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec2 vRefractionFilteringInfo;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
uniform float scatteringDiffusionProfile;
uniform vec4 vDetailInfos;
uniform mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;Qe.a.IncludesShadersStore.pbrUboDeclaration=kI;var jI=`uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#if DEBUGMODE>0
uniform vec2 vDebugMode;
varying vec4 vClipSpacePosition;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif`;Qe.a.IncludesShadersStore.pbrFragmentExtraDeclaration=jI;var zI=`#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif
#ifdef METALLIC_REFLECTANCE
#if METALLIC_REFLECTANCEDIRECTUV == 1
#define vMetallicReflectanceUV vMainUV1
#elif METALLIC_REFLECTANCEDIRECTUV == 2
#define vMetallicReflectanceUV vMainUV2
#else
varying vec2 vMetallicReflectanceUV;
#endif
uniform sampler2D metallicReflectanceSampler;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE)
#if CLEARCOAT_TEXTUREDIRECTUV == 1
#define vClearCoatUV vMainUV1
#elif CLEARCOAT_TEXTUREDIRECTUV == 2
#define vClearCoatUV vMainUV2
#else
varying vec2 vClearCoatUV;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)
#if CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vClearCoatRoughnessUV vMainUV1
#elif CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vClearCoatRoughnessUV vMainUV2
#else
varying vec2 vClearCoatRoughnessUV;
#endif
#endif
#ifdef CLEARCOAT_TEXTURE
uniform sampler2D clearCoatSampler;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D clearCoatRoughnessSampler;
#endif
#ifdef CLEARCOAT_BUMP
#if CLEARCOAT_BUMPDIRECTUV == 1
#define vClearCoatBumpUV vMainUV1
#elif CLEARCOAT_BUMPDIRECTUV == 2
#define vClearCoatBumpUV vMainUV2
#else
varying vec2 vClearCoatBumpUV;
#endif
uniform sampler2D clearCoatBumpSampler;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1
#define vClearCoatTintUV vMainUV1
#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2
#define vClearCoatTintUV vMainUV2
#else
varying vec2 vClearCoatTintUV;
#endif
uniform sampler2D clearCoatTintSampler;
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_TEXTURE
#if SHEEN_TEXTUREDIRECTUV == 1
#define vSheenUV vMainUV1
#elif SHEEN_TEXTUREDIRECTUV == 2
#define vSheenUV vMainUV2
#else
varying vec2 vSheenUV;
#endif
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
#if SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vSheenRoughnessUV vMainUV1
#elif SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vSheenRoughnessUV vMainUV2
#else
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef SHEEN_TEXTURE
uniform sampler2D sheenSampler;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D sheenRoughnessSampler;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
#if ANISOTROPIC_TEXTUREDIRECTUV == 1
#define vAnisotropyUV vMainUV1
#elif ANISOTROPIC_TEXTUREDIRECTUV == 2
#define vAnisotropyUV vMainUV2
#else
varying vec2 vAnisotropyUV;
#endif
uniform sampler2D anisotropySampler;
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform samplerCube irradianceSampler;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D reflectionSamplerLow;
uniform sampler2D reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform sampler2D irradianceSampler;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D refractionSamplerLow;
uniform sampler2D refractionSamplerHigh;
#endif
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1
#define vThicknessUV vMainUV1
#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2
#define vThicknessUV vMainUV2
#else
varying vec2 vThicknessUV;
#endif
uniform sampler2D thicknessSampler;
#endif
#endif`;Qe.a.IncludesShadersStore.pbrFragmentSamplersDeclaration=zI,c(116),Qe.a.IncludesShadersStore.subSurfaceScatteringFunctions=`bool testLightingForSSS(float diffusionProfile)
{
return diffusionProfile<1.;
}`;var GI=`




























vec3 hemisphereCosSample(vec2 u) {

float phi=2.*PI*u.x;
float cosTheta2=1.-u.y;
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}





































vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {

float phi=2.*PI*u.x;

float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}

























































vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) {

float phi=2.*PI*u.x;
float sinTheta=pow(u.y,a/(2.*a+1.));
float cosTheta=sqrt(1.-sinTheta*sinTheta);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}`;Qe.a.IncludesShadersStore.importanceSampling=GI;var HI=`
#define RECIPROCAL_PI2 0.15915494
#define RECIPROCAL_PI 0.31830988618

#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{

return square(roughness)+MINIMUMVARIANCE;
}
float fresnelGrazingReflectance(float reflectance0) {


float reflectance90=saturate(reflectance0*25.0);
return reflectance90;
}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);
vec3 nDfdy=dFdy(normalVector.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);

geometricAlphaGFactor*=0.75;
return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC


vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {
float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);
float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);
return vec2(alphaT,alphaB);
}


vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {
vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;
vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);
vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);
vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));
return anisotropicNormal;

}
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)



vec3 cocaLambert(vec3 alpha,float distance) {
return exp(-alpha*distance);
}

vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {
return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));
}

vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {
return -log(color)/distance;
}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);
return clearCoatAbsorption;
}
#endif




#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}
#endif`;Qe.a.IncludesShadersStore.pbrHelperFunctions=HI;var WI=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;
uniform vec3 vSphericalL1_1;
uniform vec3 vSphericalL10;
uniform vec3 vSphericalL11;
uniform vec3 vSphericalL2_2;
uniform vec3 vSphericalL2_1;
uniform vec3 vSphericalL20;
uniform vec3 vSphericalL21;
uniform vec3 vSphericalL22;







vec3 computeEnvironmentIrradiance(vec3 normal) {
return vSphericalL00
+vSphericalL1_1*(normal.y)
+vSphericalL10*(normal.z)
+vSphericalL11*(normal.x)
+vSphericalL2_2*(normal.y*normal.x)
+vSphericalL2_1*(normal.y*normal.z)
+vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+vSphericalL21*(normal.z*normal.x)
+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));
}
#else
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;

vec3 computeEnvironmentIrradiance(vec3 normal) {









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif
#endif`;Qe.a.IncludesShadersStore.harmonicsFunctions=WI;var XI=`
struct preLightingInfo
{

vec3 lightOffset;
float lightDistanceSquared;
float lightDistance;

float attenuation;

vec3 L;
vec3 H;
float NdotV;
float NdotLUnclamped;
float NdotL;
float VdotH;
float roughness;
};
preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);

result.lightDistance=sqrt(result.lightDistanceSquared);

result.L=normalize(result.lightOffset);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightDistance=length(-lightData.xyz);

result.L=normalize(-lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;


result.NdotL=dot(N,lightData.xyz)*0.5+0.5;
result.NdotL=saturateEps(result.NdotL);
result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
#endif
return result;
}`;Qe.a.IncludesShadersStore.pbrDirectLightingSetupFunctions=XI;var YI=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/maxEps(lightDistanceSquared);
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=saturate(1.0-factor*factor);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977;





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=saturate(cd*lightAngleScale+lightAngleOffset);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;Qe.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions=YI;var KI=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;

#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif

#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif
























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN


float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}

#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;Qe.a.IncludesShadersStore.pbrBRDFFunctions=KI;var QI=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#ifdef WEBGL2


float radicalInverse_VdC(uint bits)
{
bits=(bits << 16u) | (bits >> 16u);
bits=((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
bits=((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
bits=((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
bits=((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
return float(bits)*2.3283064365386963e-10;
}
vec2 hammersley(uint i,uint N)
{
return vec2(float(i)/float(N),radicalInverse_VdC(i));
}
#else
float vanDerCorpus(int n,int base)
{
float invBase=1.0/float(base);
float denom=1.0;
float result=0.0;
for(int i=0; i<32; ++i)
{
if(n>0)
{
denom=mod(float(n),2.0);
result+=denom*invBase;
invBase=invBase/2.0;
n=int(float(n)/2.0);
}
}
return result;
}
vec2 hammersley(int i,int N)
{
return vec2(float(i)/float(N),vanDerCorpus(i,2));
}
#endif
float log4(float x) {
return log2(x)/2.;
}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);
const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;
const float K=4.;



















































































































#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
vec3 result=vec3(0.0);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 Ls=hemisphereCosSample(Xi);
Ls=normalize(Ls);
vec3 Ns=vec3(0.,0.,1.);
float NoL=dot(Ns,Ls);
if (NoL>0.) {
float pdf_inversed=PI/NoL;
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(l,0.0,maxLevel);
vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;
}
}
result=result*NUM_SAMPLES_FLOAT_INVERSED;
return result;
}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
if (alphaG == 0.) {
vec3 c=textureCube(inputTexture,n).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;
}
vec3 result=vec3(0.);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
float weight=0.;
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);
float NoV=1.;
float NoH=H.z;
float NoH2=H.z*H.z;
float NoL=2.*NoH2-1.;
vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);
L=normalize(L);
if (NoL>0.) {
float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(float(l),0.0,maxLevel);
weight+=NoL;
vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;
}
}
result=result/weight;
return result;
}
#endif
#endif`;Qe.a.IncludesShadersStore.hdrFilteringFunctions=QI;var qI=`#define CLEARCOATREFLECTANCE90 1.0

struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT


vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};

float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=saturate(lightRoughness+roughness);
return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {
return mix(groundColor,lightColor,info.NdotL);
}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {
float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*info.attenuation*info.NdotL*lightColor;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {
float NdotL=absEps(info.NdotLUnclamped);

float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);

float trAdapt=step(0.,info.NdotLUnclamped);
vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);
float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;
}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float TdotH=dot(T,info.H);
float BdotH=dot(B,info.H);
float TdotV=dot(T,V);
float BdotV=dot(B,V);
float TdotL=dot(T,info.L);
float BdotL=dot(B,info.L);
float alphaG=convertRoughnessToAverageSlope(info.roughness);
vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);
alphaTB=max(alphaTB,square(geometricRoughnessFactor));
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);
float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {
float NccdotL=saturateEps(dot(Ncc,info.L));
float NccdotH=saturateEps(dot(Ncc,info.H));
float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnel*=clearCoatIntensity;
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);
float kelemenVisibility=visibility_Kelemen(info.VdotH);
float clearCoatTerm=fresnel*distribution*kelemenVisibility;
return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);
}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);
float NdotLRefract=saturateEps(dot(Ncc,LRefract));
vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
return absorption;
}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);


float fresnel=1.;
float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);

float visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);

float sheenTerm=fresnel*distribution*visibility;
return sheenTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
`;Qe.a.IncludesShadersStore.pbrDirectLightingFunctions=qI;var ZI=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {
float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
float getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {
float lod=log2(cubeMapDimensionPixels)*roughness;
return lod;
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return saturate(square(temp)-1.0+ambientOcclusion);
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {

vec3 reflection=reflect(view,normal);
float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));
return square(temp);
}
#endif




#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);
}
#endif`;Qe.a.IncludesShadersStore.pbrIBLFunctions=ZI,c(132),c(133);var $I=`struct albedoOpacityOutParams
{
vec3 surfaceAlbedo;
float alpha;
};
#define pbr_inline
void albedoOpacityBlock(
const in vec4 vAlbedoColor,
#ifdef ALBEDO
const in vec4 albedoTexture,
const in vec2 albedoInfos,
#endif
#ifdef OPACITY
const in vec4 opacityMap,
const in vec2 vOpacityInfos,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out albedoOpacityOutParams outParams
)
{

vec3 surfaceAlbedo=vAlbedoColor.rgb;
float alpha=vAlbedoColor.a;
#ifdef ALBEDO
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
#ifdef GAMMAALBEDO
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
#else
surfaceAlbedo*=albedoTexture.rgb;
#endif
surfaceAlbedo*=albedoInfos.y;
#endif
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif
#ifdef DETAIL
float detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);
surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO

#ifdef OPACITY
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
outParams.surfaceAlbedo=surfaceAlbedo;
outParams.alpha=alpha;
}
`;Qe.a.IncludesShadersStore.pbrBlockAlbedoOpacity=$I;var JI=`struct reflectivityOutParams
{
float microSurface;
float roughness;
vec3 surfaceReflectivityColor;
#ifdef METALLICWORKFLOW
vec3 surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
vec3 ambientOcclusionColor;
#endif
#if DEBUGMODE>0
vec4 surfaceMetallicColorMap;
vec4 surfaceReflectivityColorMap;
vec2 metallicRoughness;
vec3 metallicF0;
#endif
};
#define pbr_inline
void reflectivityBlock(
const in vec4 vReflectivityColor,
#ifdef METALLICWORKFLOW
const in vec3 surfaceAlbedo,
const in vec4 metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
const in vec3 reflectivityInfos,
const in vec4 surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
const in vec3 ambientOcclusionColorIn,
#endif
#ifdef MICROSURFACEMAP
const in vec4 microSurfaceTexel,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out reflectivityOutParams outParams
)
{
float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
#if DEBUGMODE>0
outParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);
outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;
#endif
#endif
#endif
#ifdef DETAIL
float detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);
float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);
float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);
metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));
#endif
#ifdef MICROSURFACEMAP
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#if DEBUGMODE>0
outParams.metallicRoughness=metallicRoughness;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;
#ifdef FROSTBITE_REFLECTANCE






outParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);

surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else
vec3 metallicF0=metallicReflectanceFactors.rgb;
#if DEBUGMODE>0
outParams.metallicF0=metallicF0;
#endif

outParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
surfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;
#if DEBUGMODE>0
outParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceMetallicOrReflectivityColorMap.a;
microSurface*=reflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif

microSurface=saturate(microSurface);

float roughness=1.-microSurface;
outParams.microSurface=microSurface;
outParams.roughness=roughness;
outParams.surfaceReflectivityColor=surfaceReflectivityColor;
}
`;Qe.a.IncludesShadersStore.pbrBlockReflectivity=JI;var eD=`struct ambientOcclusionOutParams
{
vec3 ambientOcclusionColor;
#if DEBUGMODE>0
vec3 ambientOcclusionColorMap;
#endif
};
#define pbr_inline
void ambientOcclusionBlock(
#ifdef AMBIENT
const in vec3 ambientOcclusionColorMap_,
const in vec4 vAmbientInfos,
#endif
out ambientOcclusionOutParams outParams
)
{
vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#if DEBUGMODE>0
outParams.ambientOcclusionColorMap=ambientOcclusionColorMap;
#endif
#endif
outParams.ambientOcclusionColor=ambientOcclusionColor;
}
`;Qe.a.IncludesShadersStore.pbrBlockAmbientOcclusion=eD;var tD=`#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
struct alphaFresnelOutParams
{
float alpha;
};
#define pbr_inline
void alphaFresnelBlock(
const in vec3 normalW,
const in vec3 viewDirectionW,
const in float alpha,
const in float microSurface,
out alphaFresnelOutParams outParams
)
{



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (outParams.alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

outParams.alpha=1.0;
#endif
#endif
}
#endif
#endif
`;Qe.a.IncludesShadersStore.pbrBlockAlphaFresnel=tD;var nD=`#ifdef ANISOTROPIC
struct anisotropicOutParams
{
float anisotropy;
vec3 anisotropicTangent;
vec3 anisotropicBitangent;
vec3 anisotropicNormal;
#if DEBUGMODE>0
vec3 anisotropyMapData;
#endif
};
#define pbr_inline
void anisotropicBlock(
const in vec3 vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
const in vec3 anisotropyMapData,
#endif
const in mat3 TBN,
const in vec3 normalW,
const in vec3 viewDirectionW,
out anisotropicOutParams outParams
)
{
float anisotropy=vAnisotropy.b;
vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
anisotropy*=anisotropyMapData.b;
anisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;
#if DEBUGMODE>0
outParams.anisotropyMapData=anisotropyMapData;
#endif
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));
vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);
vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));
outParams.anisotropy=anisotropy;
outParams.anisotropicTangent=anisotropicTangent;
outParams.anisotropicBitangent=anisotropicBitangent;
outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);
}
#endif
`;Qe.a.IncludesShadersStore.pbrBlockAnisotropic=nD;var rD=`#ifdef REFLECTION
struct reflectionOutParams
{
vec4 environmentRadiance;
vec3 environmentIrradiance;
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords;
#else
vec2 reflectionCoords;
#endif
#ifdef SS_TRANSLUCENCY
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
vec3 irradianceVector;
#endif
#endif
#endif
};
#define pbr_inline
void createReflectionCoords(
const in vec3 vPositionW,
const in vec3 normalW,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REFLECTIONMAP_3D
out vec3 reflectionCoords
#else
out vec2 reflectionCoords
#endif
)
{
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
reflectionCoords=reflectionVector;
#else
reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
}
#define pbr_inline
#define inline
void sampleReflectionTexture(
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const vec2 reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out vec4 environmentRadiance
)
{

#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);
#else
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#endif
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);
if (lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentMid,
lodReflectionNormalizedDoubled
);
} else {
environmentRadiance=mix(
environmentMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
}
#define pbr_inline
#define inline
void reflectionBlock(
const in vec3 vPositionW,
const in vec3 normalW,
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
const in vec3 vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in mat4 reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out reflectionOutParams outParams
)
{

vec4 environmentRadiance=vec4(0.,0.,0.,0.);
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=vec3(0.);
#else
vec2 reflectionCoords=vec2(0.);
#endif
createReflectionCoords(
vPositionW,
normalW,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
reflectionCoords
);
sampleReflectionTexture(
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
#ifdef REFLECTIONMAP_3D
reflectionSampler,
reflectionCoords,
#else
reflectionSampler,
reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentRadiance
);

vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#if defined(REALTIME_FILTERING)
environmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);
#else
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#ifdef SS_TRANSLUCENCY
outParams.irradianceVector=irradianceVector;
#endif
#endif
#elif defined(USEIRRADIANCEMAP)
vec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);
environmentIrradiance=environmentIrradiance4.rgb;
#ifdef RGBDREFLECTION
environmentIrradiance.rgb=fromRGBD(environmentIrradiance4);
#endif
#ifdef GAMMAREFLECTION
environmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);
#endif
#endif
environmentIrradiance*=vReflectionColor.rgb;
outParams.environmentRadiance=environmentRadiance;
outParams.environmentIrradiance=environmentIrradiance;
outParams.reflectionCoords=reflectionCoords;
}
#endif
`;Qe.a.IncludesShadersStore.pbrBlockReflection=rD;var iD=`#ifdef SHEEN
struct sheenOutParams
{
float sheenIntensity;
vec3 sheenColor;
float sheenRoughness;
#ifdef SHEEN_LINKWITHALBEDO
vec3 surfaceAlbedo;
#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
float sheenAlbedoScaling;
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
vec3 finalSheenRadianceScaled;
#endif
#if DEBUGMODE>0
vec4 sheenMapData;
vec3 sheenEnvironmentReflectance;
#endif
};
#define pbr_inline
#define inline
void sheenBlock(
const in vec4 vSheenColor,
#ifdef SHEEN_ROUGHNESS
const in float vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 sheenMapRoughnessData,
#endif
#endif
const in float roughness,
#ifdef SHEEN_TEXTURE
const in vec4 sheenMapData,
#endif
const in float reflectance,
#ifdef SHEEN_LINKWITHALBEDO
const in vec3 baseColor,
const in vec3 surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
const in float NdotV,
const in vec3 environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
const in vec2 AARoughnessFactors,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const in vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const in vec2 reflectionCoords,
#endif
const in float NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
const in float seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
const in float eho,
#endif
#endif
out sheenOutParams outParams
)
{
float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
#if DEBUGMODE>0
outParams.sheenMapData=sheenMapData;
#endif
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);
vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);
float sheenRoughness=sheenIntensity;
outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
sheenColor.rgb*=sheenMapData.rgb;
#endif
#ifdef SHEEN_ROUGHNESS
float sheenRoughness=vSheenRoughness;
#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE
#if defined(SHEEN_TEXTURE)
sheenRoughness*=sheenMapData.a;
#endif
#elif defined(SHEEN_TEXTURE_ROUGHNESS)
#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL
sheenRoughness*=sheenMapData.a;
#else
sheenRoughness*=sheenMapRoughnessData.a;
#endif
#endif
#else
float sheenRoughness=roughness;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#endif

#if !defined(SHEEN_ALBEDOSCALING)
sheenIntensity*=(1.-reflectance);
#endif

sheenColor*=sheenIntensity;
#endif

#ifdef ENVIRONMENTBRDF

#ifdef SHEEN_ROUGHNESS
vec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);
#else
vec3 environmentSheenBrdf=environmentBrdf;
#endif

#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA

sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);
sampleReflectionTexture(
sheenAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
sheenRoughness,
#endif
reflectionSampler,
reflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentSheenRadiance
);
vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
sheenEnvironmentReflectance*=seo;
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
sheenEnvironmentReflectance*=eho;
#endif
#if DEBUGMODE>0
outParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;
#endif
outParams.finalSheenRadianceScaled=
environmentSheenRadiance.rgb *
sheenEnvironmentReflectance *
vLightingIntensity.z;





#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)



outParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;
#endif

outParams.sheenIntensity=sheenIntensity;
outParams.sheenColor=sheenColor;
outParams.sheenRoughness=sheenRoughness;
}
#endif
`;Qe.a.IncludesShadersStore.pbrBlockSheen=iD;var oD=`struct clearcoatOutParams
{
vec3 specularEnvironmentR0;
float conservationFactor;
vec3 clearCoatNormalW;
vec2 clearCoatAARoughnessFactors;
float clearCoatIntensity;
float clearCoatRoughness;
#ifdef REFLECTION
vec3 finalClearCoatRadianceScaled;
#endif
#ifdef CLEARCOAT_TINT
vec3 absorption;
float clearCoatNdotVRefract;
vec3 clearCoatColor;
float clearCoatThickness;
#endif
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
vec3 energyConservationFactorClearCoat;
#endif
#if DEBUGMODE>0
mat3 TBNClearCoat;
vec2 clearCoatMapData;
vec4 clearCoatTintMapData;
vec4 environmentClearCoatRadiance;
float clearCoatNdotV;
vec3 clearCoatEnvironmentReflectance;
#endif
};
#ifdef CLEARCOAT
#define pbr_inline
#define inline
void clearcoatBlock(
const in vec3 vPositionW,
const in vec3 geometricNormalW,
const in vec3 viewDirectionW,
const in vec2 vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 clearCoatMapRoughnessData,
#endif
const in vec3 specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
const in vec2 clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
const in vec4 vClearCoatTintParams,
const in float clearCoatColorAtDistance,
const in vec4 vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
const in vec4 clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
const in vec2 vClearCoatBumpInfos,
const in vec4 clearCoatBumpMapData,
const in vec2 vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
const in mat3 vTBN,
#else
const in vec2 vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
const in mat4 normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
const in vec3 faceNormal,
#endif
#ifdef REFLECTION
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
const in float ambientMonochrome,
#endif
#endif
out clearcoatOutParams outParams
)
{

float clearCoatIntensity=vClearCoatParams.x;
float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
clearCoatIntensity*=clearCoatMapData.x;
#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE
clearCoatRoughness*=clearCoatMapData.y;
#endif
#if DEBUGMODE>0
outParams.clearCoatMapData=clearCoatMapData;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL
clearCoatRoughness*=clearCoatMapData.y;
#else
clearCoatRoughness*=clearCoatMapRoughnessData.y;
#endif
#endif
outParams.clearCoatIntensity=clearCoatIntensity;
outParams.clearCoatRoughness=clearCoatRoughness;
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;
float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatColor*=clearCoatTintMapData.rgb;
clearCoatThickness*=clearCoatTintMapData.a;
#if DEBUGMODE>0
outParams.clearCoatTintMapData=clearCoatTintMapData;
#endif
#endif
outParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);
outParams.clearCoatThickness=clearCoatThickness;
#endif




#ifdef CLEARCOAT_REMAP_F0
vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
#else
vec3 specularEnvironmentR0Updated=specularEnvironmentR0;
#endif
outParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);

vec3 clearCoatNormalW=geometricNormalW;
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);
#endif
#if DEBUGMODE>0
outParams.TBNClearCoat=TBNClearCoat;
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(clearCoatBumpMapData.xyz*2.0-1.0);
clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;
#endif
outParams.clearCoatNormalW=clearCoatNormalW;

outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);

float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);

float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);
#if DEBUGMODE>0
outParams.clearCoatNdotV=clearCoatNdotV;
#endif
#ifdef CLEARCOAT_TINT

vec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);

outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);
#endif

#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA

clearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);
vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
sampleReflectionTexture(
clearCoatAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
clearCoatNdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
clearCoatRoughness,
#endif
reflectionSampler,
clearCoatReflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentClearCoatRadiance
);
#if DEBUGMODE>0
outParams.environmentClearCoatRadiance=environmentClearCoatRadiance;
#endif

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef RADIANCEOCCLUSION
float clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);
clearCoatEnvironmentReflectance*=clearCoatSeo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);
clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else

vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#if DEBUGMODE>0
outParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;
#endif
outParams.finalClearCoatRadianceScaled=
environmentClearCoatRadiance.rgb *
clearCoatEnvironmentReflectance *
vLightingIntensity.z;
#endif
#if defined(CLEARCOAT_TINT)

outParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);
#endif

float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnelIBLClearCoat*=clearCoatIntensity;
outParams.conservationFactor=(1.-fresnelIBLClearCoat);
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
outParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);
#endif
}
#endif
`;Qe.a.IncludesShadersStore.pbrBlockClearcoat=oD;var aD=`struct subSurfaceOutParams
{
vec3 specularEnvironmentReflectance;
#ifdef SS_REFRACTION
vec3 finalRefraction;
vec3 surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
float alpha;
#endif
#ifdef REFLECTION
float refractionFactorForIrradiance;
#endif
#endif
#ifdef SS_TRANSLUCENCY
vec3 transmittance;
float translucencyIntensity;
#ifdef REFLECTION
vec3 refractionIrradiance;
#endif
#endif
#if DEBUGMODE>0
vec4 thicknessMap;
vec4 environmentRefraction;
vec3 refractionTransmittance;
#endif
};
#ifdef SUBSURFACE
#define pbr_inline
#define inline
void subSurfaceBlock(
const in vec3 vSubSurfaceIntensity,
const in vec2 vThicknessParam,
const in vec4 vTintColor,
const in vec3 normalW,
const in vec3 specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
const in vec4 thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
const in mat4 reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in vec3 irradianceVector_,
#endif
#if defined(REALTIME_FILTERING)
const in samplerCube reflectionSampler,
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#endif
#endif
#ifdef SS_REFRACTION
const in vec3 vPositionW,
const in vec3 viewDirectionW,
const in mat4 view,
const in vec3 surfaceAlbedo,
const in vec4 vRefractionInfos,
const in mat4 refractionMatrix,
const in vec3 vRefractionMicrosurfaceInfos,
const in vec4 vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
const in float alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
const in float NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
const in float roughness,
#else
const in float alphaG,
#endif
#ifdef SS_REFRACTIONMAP_3D
const in samplerCube refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in samplerCube refractionSamplerLow,
const in samplerCube refractionSamplerHigh,
#endif
#else
const in sampler2D refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in sampler2D refractionSamplerLow,
const in sampler2D refractionSamplerHigh,
#endif
#endif
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
const in vec2 vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
const in vec3 vDiffusionDistance,
#endif
out subSurfaceOutParams outParams
)
{
outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;



#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);

outParams.alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#if DEBUGMODE>0
outParams.thicknessMap=thicknessMap;
#endif
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.g;
#endif
#ifdef SS_TRANSLUCENCY
translucencyIntensity*=thicknessMap.b;
#endif
#elif defined(SS_MASK_FROM_THICKNESS_TEXTURE_GLTF)
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.r;
#elif defined(SS_TRANSLUCENCY)
translucencyIntensity*=thicknessMap.r;
#endif
thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;
#endif
#else
float thickness=vThicknessParam.y;
#endif



#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);
vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);
transmittance*=translucencyIntensity;
outParams.transmittance=transmittance;
outParams.translucencyIntensity=translucencyIntensity;
#endif



#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef SS_REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(SS_LINEARSPECULARREFRACTION)
float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);
#else
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#endif
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if (lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
} else {
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif



#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);





refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)

float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);
vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);

environmentRefraction.rgb*=volumeAlbedo;
#else

vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);
refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif
#ifdef SS_ALBEDOFORREFRACTIONTINT

environmentRefraction.rgb*=surfaceAlbedo.rgb;
#endif

outParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);
#ifdef REFLECTION

outParams.refractionFactorForIrradiance=(1.-refractionIntensity);

#endif

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);

refractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;
#if DEBUGMODE>0
outParams.refractionTransmittance=refractionTransmittance;
#endif
outParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;
#if DEBUGMODE>0
outParams.environmentRefraction=environmentRefraction;
#endif
#endif



#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)
#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#else
vec3 irradianceVector=irradianceVector_;
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP)
#if defined(REALTIME_FILTERING)
vec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);
#else
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
#endif
#elif defined(USEIRRADIANCEMAP)
#ifdef REFLECTIONMAP_3D
vec3 irradianceCoords=irradianceVector;
#else
vec2 irradianceCoords=irradianceVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
irradianceCoords/=irradianceVector.z;
#endif
irradianceCoords.y=1.0-irradianceCoords.y;
#endif
vec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);
#ifdef RGBDREFLECTION
refractionIrradiance.rgb=fromRGBD(refractionIrradiance);
#endif
#ifdef GAMMAREFLECTION
refractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);
#endif
#else
vec4 refractionIrradiance=vec4(0.);
#endif
refractionIrradiance.rgb*=transmittance;
outParams.refractionIrradiance=refractionIrradiance.rgb;
#endif
}
#endif
`;Qe.a.IncludesShadersStore.pbrBlockSubSurface=aD;var sD=`vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
vec3 geometricNormalW=normalW;
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
geometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;
#endif
`;Qe.a.IncludesShadersStore.pbrBlockNormalGeometric=sD,c(134);var cD=`#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
`;Qe.a.IncludesShadersStore.pbrBlockNormalFinal=cD,c(162);var lD=`#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
#ifdef GAMMALIGHTMAP
lightmapColor.rgb=toLinearSpace(lightmapColor.rgb);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
`;Qe.a.IncludesShadersStore.pbrBlockLightmapInit=lD;var uD=`float NdotVUnclamped=dot(normalW,viewDirectionW);

float NdotV=absEps(NdotVUnclamped);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA

alphaG+=AARoughnessFactors.y;
#endif
#if defined(ENVIRONMENTBRDF)

vec3 environmentBrdf=getBRDFLookup(NdotV,roughness);
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=aoOut.ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);
#endif
#endif
#endif
#endif
`;Qe.a.IncludesShadersStore.pbrBlockGeometryInfo=uD;var hD=`float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);
vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);
#else
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);
#endif

#ifdef ALPHAFRESNEL
float reflectance90=fresnelGrazingReflectance(reflectance);
specularEnvironmentR90=specularEnvironmentR90*reflectance90;
#endif
`;Qe.a.IncludesShadersStore.pbrBlockReflectance0=hD;var dD=`#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);
#ifdef RADIANCEOCCLUSION
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif
#ifdef CLEARCOAT
specularEnvironmentReflectance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
specularEnvironmentReflectance*=clearcoatOut.absorption;
#endif
#endif
`;Qe.a.IncludesShadersStore.pbrBlockReflectance=dD;var fD=`vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif

preLightingInfo preInfo;
lightingInfo info;
float shadow=1.;
#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
vec3 absorption=vec3(0.);
#endif
`;Qe.a.IncludesShadersStore.pbrBlockDirectLighting=fD;var pD=`



#if defined(ENVIRONMENTBRDF)
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);
#endif
#endif
#ifndef METALLICWORKFLOW
#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif
#endif
#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)
surfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;
#endif

#ifdef REFLECTION
vec3 finalIrradiance=reflectionOut.environmentIrradiance;
#if defined(CLEARCOAT)
finalIrradiance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
finalIrradiance*=clearcoatOut.absorption;
#endif
#endif
#if defined(SS_REFRACTION)
finalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;
#endif
#if defined(SS_TRANSLUCENCY)
finalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);
finalIrradiance+=subSurfaceOut.refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;
finalIrradiance*=vLightingIntensity.z;
finalIrradiance*=aoOut.ambientOcclusionColor;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);
vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalSpecularScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef REFLECTION
vec3 finalRadiance=reflectionOut.environmentRadiance.rgb;
finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;
vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalRadianceScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenOut.sheenColor;
finalSheen=max(finalSheen,0.0);
vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;
#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;
finalClearCoat=max(finalClearCoat,0.0);
vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;
#ifdef CLEARCOAT_TINT
subSurfaceOut.finalRefraction*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
`;Qe.a.IncludesShadersStore.pbrBlockFinalLitComponents=pD;var mD=`
vec3 finalDiffuse=diffuseBase;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);
finalDiffuse*=vLightingIntensity.x;

vec3 finalAmbient=vAmbientColor;
finalAmbient*=surfaceAlbedo.rgb;

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif
finalEmissive*=vLightingIntensity.y;

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;
#endif
finalAmbient*=aoOut.ambientOcclusionColor;
finalDiffuse*=ambientOcclusionForDirectDiffuse;
`;Qe.a.IncludesShadersStore.pbrBlockFinalUnlitComponents=mD;var _D=`vec4 finalColor=vec4(
finalAmbient +
finalDiffuse +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance +
#endif
#ifdef SPECULARTERM
finalSpecularScaled +
#endif
#ifdef SHEEN
finalSheenScaled +
#endif
#ifdef CLEARCOAT
finalClearCoatScaled +
#endif
#ifdef REFLECTION
finalRadianceScaled +
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled +
#endif
#ifdef CLEARCOAT
clearcoatOut.finalClearCoatRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction +
#endif
#endif
finalEmissive,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor.rgb;
#else
finalColor.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG

finalColor=max(finalColor,0.0);
`;Qe.a.IncludesShadersStore.pbrBlockFinalColorComposition=_D,c(155);var gD=`#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
`;Qe.a.IncludesShadersStore.pbrBlockImageProcessing=gD;var vD=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {

#if DEBUGMODE == 1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 3 && defined(BUMP) || DEBUGMODE == 3 && defined(PARALLAX) || DEBUGMODE == 3 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 4 && defined(BUMP) || DEBUGMODE == 4 && defined(PARALLAX) || DEBUGMODE == 4 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 5

gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE == 7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 10 && defined(CLEARCOAT)

gl_FragColor.rgb=clearcoatOut.clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicBitangent;
#define DEBUGMODE_NORMALIZE

#elif DEBUGMODE == 20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#elif DEBUGMODE == 21 && defined(AMBIENT)
gl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;
#elif DEBUGMODE == 22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE == 23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;
#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);
#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;
#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenOut.sheenMapData.rgb;
#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;
#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;

#elif DEBUGMODE == 40 && defined(SS_REFRACTION)

gl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 41 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 54 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 61
gl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);
#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.metallicF0;
#elif DEBUGMODE == 63
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE == 64
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE == 65
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);
#elif DEBUGMODE == 68 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);
#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=subSurfaceOut.transmittance;
#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=subSurfaceOut.refractionTransmittance;

#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 86 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE == 87
gl_FragColor.rgb=vec3(alpha);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#ifdef PREPASS
gl_FragData[0]=toLinearSpace(gl_FragColor);
gl_FragData[1]=vec4(0.,0.,0.,0.);
#endif
return;
}
#endif`;Qe.a.IncludesShadersStore.pbrDebug=vD;var bD=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
precision highp float;

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE
#endif

#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>

#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<importanceSampling>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
#include<pbrBlockAlbedoOpacity>
#include<pbrBlockReflectivity>
#include<pbrBlockAmbientOcclusion>
#include<pbrBlockAlphaFresnel>
#include<pbrBlockAnisotropic>
#include<pbrBlockReflection>
#include<pbrBlockSheen>
#include<pbrBlockClearcoat>
#include<pbrBlockSubSurface>

void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>

#include<pbrBlockNormalGeometric>
#include<bumpFragment>
#include<pbrBlockNormalFinal>

albedoOpacityOutParams albedoOpacityOut;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#endif
albedoOpacityBlock(
vAlbedoColor,
#ifdef ALBEDO
albedoTexture,
vAlbedoInfos,
#endif
#ifdef OPACITY
opacityMap,
vOpacityInfos,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
albedoOpacityOut
);
vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;
float alpha=albedoOpacityOut.alpha;
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

ambientOcclusionOutParams aoOut;
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;
#endif
ambientOcclusionBlock(
#ifdef AMBIENT
ambientOcclusionColorMap,
vAmbientInfos,
#endif
aoOut
);
#include<pbrBlockLightmapInit>
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

vec3 baseColor=surfaceAlbedo;
reflectivityOutParams reflectivityOut;
#if defined(REFLECTIVITY)
vec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;
#ifndef METALLICWORKFLOW
surfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);
surfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;
#endif
#endif
#if defined(MICROSURFACEMAP)
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
#endif
#ifdef METALLICWORKFLOW
vec4 metallicReflectanceFactors=vMetallicReflectanceFactors;
#ifdef METALLIC_REFLECTANCE
vec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);
metallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);
metallicReflectanceFactors*=metallicReflectanceFactorsMap;
#endif
#endif
reflectivityBlock(
vReflectivityColor,
#ifdef METALLICWORKFLOW
surfaceAlbedo,
metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
vReflectivityInfos,
surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor,
#endif
#ifdef MICROSURFACEMAP
microSurfaceTexel,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
reflectivityOut
);
float microSurface=reflectivityOut.microSurface;
float roughness=reflectivityOut.roughness;
#ifdef METALLICWORKFLOW
surfaceAlbedo=reflectivityOut.surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;
#endif

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
alphaFresnelOutParams alphaFresnelOut;
alphaFresnelBlock(
normalW,
viewDirectionW,
alpha,
microSurface,
alphaFresnelOut
);
alpha=alphaFresnelOut.alpha;
#endif
#endif

#include<pbrBlockGeometryInfo>

#ifdef ANISOTROPIC
anisotropicOutParams anisotropicOut;
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
#endif
anisotropicBlock(
vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
anisotropyMapData,
#endif
TBN,
normalW,
viewDirectionW,
anisotropicOut
);
#endif

#ifdef REFLECTION
reflectionOutParams reflectionOut;
reflectionBlock(
vPositionW,
normalW,
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
reflectionSampler,
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
reflectionOut
);
#endif

#include<pbrBlockReflectance0>

#ifdef SHEEN
sheenOutParams sheenOut;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=toLinearSpace(texture2D(sheenSampler,vSheenUV+uvOffset))*vSheenInfos.y;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;
#endif
sheenBlock(
vSheenColor,
#ifdef SHEEN_ROUGHNESS
vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
sheenMapRoughnessData,
#endif
#endif
roughness,
#ifdef SHEEN_TEXTURE
sheenMapData,
#endif
reflectance,
#ifdef SHEEN_LINKWITHALBEDO
baseColor,
surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
NdotV,
environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
AARoughnessFactors,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
reflectionOut.reflectionCoords,
NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
eho,
#endif
#endif
sheenOut
);
#ifdef SHEEN_LINKWITHALBEDO
surfaceAlbedo=sheenOut.surfaceAlbedo;
#endif
#endif

clearcoatOutParams clearcoatOut;
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;
#endif
#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
vec4 clearCoatTintMapData=toLinearSpace(texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset));
#endif
#ifdef CLEARCOAT_BUMP
vec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);
#endif
clearcoatBlock(
vPositionW,
geometricNormalW,
viewDirectionW,
vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
clearCoatMapRoughnessData,
#endif
specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
vClearCoatTintParams,
clearCoatColorAtDistance,
vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
vClearCoatBumpInfos,
clearCoatBumpMapData,
vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
vTBN,
#else
vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
faceNormal,
#endif
#ifdef REFLECTION
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
ambientMonochrome,
#endif
#endif
clearcoatOut
);
#else
clearcoatOut.specularEnvironmentR0=specularEnvironmentR0;
#endif

#include<pbrBlockReflectance>

subSurfaceOutParams subSurfaceOut;
#ifdef SUBSURFACE
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
#endif
subSurfaceBlock(
vSubSurfaceIntensity,
vThicknessParam,
vTintColor,
normalW,
specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionOut.irradianceVector,
#endif
#if defined(REALTIME_FILTERING)
reflectionSampler,
vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#endif
#endif
#ifdef SS_REFRACTION
vPositionW,
viewDirectionW,
view,
surfaceAlbedo,
vRefractionInfos,
refractionMatrix,
vRefractionMicrosurfaceInfos,
vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
roughness,
#else
alphaG,
#endif
refractionSampler,
#ifndef LODBASEDMICROSFURACE
refractionSamplerLow,
refractionSamplerHigh,
#endif
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
vDiffusionDistance,
#endif
subSurfaceOut
);
#ifdef SS_REFRACTION
surfaceAlbedo=subSurfaceOut.surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha=subSurfaceOut.alpha;
#endif
#endif
#else
subSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;
#endif

#include<pbrBlockDirectLighting>
#include<lightFragment>[0..maxSimultaneousLights]

#include<pbrBlockFinalLitComponents>
#endif
#include<pbrBlockFinalUnlitComponents>
#include<pbrBlockFinalColorComposition>
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#include<pbrBlockImageProcessing>
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
vec3 irradiance=finalDiffuse;
#ifndef UNLIT
#ifdef REFLECTION
irradiance+=finalIrradiance;
#endif
#endif
vec3 sqAlbedo=sqrt(surfaceAlbedo);
#ifdef SS_SCATTERING
gl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a);
irradiance/=sqAlbedo;
#else
gl_FragData[0]=finalColor;
float scatteringDiffusionProfile=255.;
#endif
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(irradiance,scatteringDiffusionProfile/255.);
#else
gl_FragData[0]=vec4(finalColor.rgb,finalColor.a);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(sqAlbedo,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(REFLECTIVITY)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(baseReflectivity.rgb,1.0);
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=finalColor;
#endif
#include<pbrDebug>
}
`;Qe.a.ShadersStore.pbrPixelShader=bD;var yD=`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef METALLIC_REFLECTANCE
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
#endif

#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif

#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
#endif
`;Qe.a.IncludesShadersStore.pbrVertexDeclaration=yD,c(163),c(164),c(93),c(94),c(100),c(165),c(156),c(158);var TD=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
varying vec2 vMetallicReflectanceUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatUV;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vClearCoatRoughnessUV;
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
varying vec2 vClearCoatBumpUV;
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatTintUV;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
varying vec2 vSheenUV;
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
varying vec2 vAnisotropyUV;
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
varying vec2 vThicknessUV;
#endif
#endif

varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#include<prePassVertex>
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
if (vMetallicReflectanceInfos.x == 0.)
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
if (vClearCoatInfos.x == 0.)
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vClearCoatInfos.z == 0.)
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
if (vClearCoatBumpInfos.x == 0.)
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
if (vClearCoatTintInfos.x == 0.)
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
if (vSheenInfos.x == 0.)
{
vSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vSheenInfos.z == 0.)
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
if (vAnisotropyInfos.x == 0.)
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
if (vThicknessInfos.x == 0.)
{
vThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;Qe.a.ShadersStore.pbrVertexShader=TD;var uh=c(92),bs={effect:null,subMesh:null},Wp=function(i){function t(){var e=i.call(this)||this;return e.PBR=!0,e.NUM_SAMPLES="0",e.REALTIME_FILTERING=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.ALBEDO=!1,e.GAMMAALBEDO=!1,e.ALBEDODIRECTUV=0,e.VERTEXCOLOR=!1,e.DETAIL=!1,e.DETAILDIRECTUV=0,e.DETAIL_NORMALBLENDMETHOD=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.AMBIENTINGRAYSCALE=!1,e.OPACITY=!1,e.VERTEXALPHA=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHABLEND=!1,e.ALPHAFROMALBEDO=!1,e.ALPHATESTVALUE="0.5",e.SPECULAROVERALPHA=!1,e.RADIANCEOVERALPHA=!1,e.ALPHAFRESNEL=!1,e.LINEARALPHAFRESNEL=!1,e.PREMULTIPLYALPHA=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.REFLECTIVITY=!1,e.REFLECTIVITYDIRECTUV=0,e.SPECULARTERM=!1,e.MICROSURFACEFROMREFLECTIVITYMAP=!1,e.MICROSURFACEAUTOMATIC=!1,e.LODBASEDMICROSFURACE=!1,e.MICROSURFACEMAP=!1,e.MICROSURFACEMAPDIRECTUV=0,e.METALLICWORKFLOW=!1,e.ROUGHNESSSTOREINMETALMAPALPHA=!1,e.ROUGHNESSSTOREINMETALMAPGREEN=!1,e.METALLNESSSTOREINMETALMAPBLUE=!1,e.AOSTOREINMETALMAPRED=!1,e.METALLIC_REFLECTANCE=!1,e.METALLIC_REFLECTANCEDIRECTUV=0,e.ENVIRONMENTBRDF=!1,e.ENVIRONMENTBRDF_RGBD=!1,e.NORMAL=!1,e.TANGENT=!1,e.BUMP=!1,e.BUMPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.NORMALXYSCALE=!0,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.USELIGHTMAPASSHADOWMAP=!1,e.GAMMALIGHTMAP=!1,e.RGBDLIGHTMAP=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USEIRRADIANCEMAP=!1,e.SPHERICAL_HARMONICS=!1,e.USESPHERICALINVERTEX=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.LINEARSPECULARREFLECTION=!1,e.RADIANCEOCCLUSION=!1,e.HORIZONOCCLUSION=!1,e.INSTANCES=!1,e.THIN_INSTANCES=!1,e.PREPASS=!1,e.PREPASS_IRRADIANCE=!1,e.PREPASS_IRRADIANCE_INDEX=-1,e.PREPASS_ALBEDO=!1,e.PREPASS_ALBEDO_INDEX=-1,e.PREPASS_DEPTHNORMAL=!1,e.PREPASS_DEPTHNORMAL_INDEX=-1,e.PREPASS_POSITION=!1,e.PREPASS_POSITION_INDEX=-1,e.PREPASS_VELOCITY=!1,e.PREPASS_VELOCITY_INDEX=-1,e.PREPASS_REFLECTIVITY=!1,e.PREPASS_REFLECTIVITY_INDEX=-1,e.SCENE_MRT_COUNT=0,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.BONES_VELOCITY_ENABLED=!1,e.NONUNIFORMSCALING=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.LOGARITHMICDEPTH=!1,e.FORCENORMALFORWARD=!1,e.SPECULARAA=!1,e.CLEARCOAT=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!0,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.BRDF_V_HEIGHT_CORRELATED=!1,e.MS_BRDF_ENERGY_CONSERVATION=!1,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.SUBSURFACE=!1,e.SS_REFRACTION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,e.UNLIT=!1,e.DEBUGMODE=0,e.rebuild(),e}return Object(f.d)(t,i),t.prototype.reset=function(){i.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(sh.a),nr=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._directIntensity=1,r._emissiveIntensity=1,r._environmentIntensity=1,r._specularIntensity=1,r._lightingInfos=new h.f(r._directIntensity,r._emissiveIntensity,r._environmentIntensity,r._specularIntensity),r._disableBumpMap=!1,r._albedoTexture=null,r._ambientTexture=null,r._ambientTextureStrength=1,r._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._reflectivityTexture=null,r._metallicTexture=null,r._metallic=null,r._roughness=null,r._metallicF0Factor=1,r._metallicReflectanceColor=C.a.White(),r._metallicReflectanceTexture=null,r._microSurfaceTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._ambientColor=new C.a(0,0,0),r._albedoColor=new C.a(1,1,1),r._reflectivityColor=new C.a(1,1,1),r._reflectionColor=new C.a(1,1,1),r._emissiveColor=new C.a(0,0,0),r._microSurface=.9,r._useLightmapAsShadowmap=!1,r._useHorizonOcclusion=!0,r._useRadianceOcclusion=!0,r._useAlphaFromAlbedoTexture=!1,r._useSpecularOverAlpha=!0,r._useMicroSurfaceFromReflectivityMapAlpha=!1,r._useRoughnessFromMetallicTextureAlpha=!0,r._useRoughnessFromMetallicTextureGreen=!1,r._useMetallnessFromMetallicTextureBlue=!1,r._useAmbientOcclusionFromMetallicTextureRed=!1,r._useAmbientInGrayScale=!1,r._useAutoMicroSurfaceFromReflectivityMap=!1,r._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,r._useRadianceOverAlpha=!0,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r._parallaxScaleBias=.05,r._disableLighting=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._alphaCutOff=.4,r._forceAlphaTest=!1,r._useAlphaFresnel=!1,r._useLinearAlphaFresnel=!1,r._environmentBRDFTexture=null,r._forceIrradianceInFragment=!1,r._realTimeFiltering=!1,r._realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,r._forceNormalForward=!1,r._enableSpecularAntiAliasing=!1,r._imageProcessingObserver=null,r._renderTargets=new Gn.a(16),r._globalAmbientColor=new C.a(0,0,0),r._useLogarithmicDepth=!1,r._unlit=!1,r._debugMode=0,r.debugMode=0,r.debugLimit=-1,r.debugFactor=1,r.clearCoat=new gs(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.anisotropy=new vs(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.brdf=new UI(r._markAllSubMeshesAsMiscDirty.bind(r)),r.sheen=new el(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.detailMap=new uh.a(r._markAllSubMeshesAsTexturesDirty.bind(r)),r._rebuildInParallel=!1,r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),bt.a.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r.subSurface.fillRenderTargetTextures(r._renderTargets),r._renderTargets},r._environmentBRDFTexture=lh.GetEnvironmentBRDFTexture(n),r.subSurface=new tl(r._markAllSubMeshesAsTexturesDirty.bind(r),r._markScenePrePassDirty.bind(r),n),r.prePassConfiguration=new Hp.a,r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(e){this._realTimeFiltering=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(e){this._realTimeFilteringQuality=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(bt.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype._hasAlphaChannel=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,n,r){if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new Wp);var o=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var l=this.getScene(),d=l.getEngine();if(o._areTexturesDirty&&l.texturesEnabled){if(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._ambientTexture&&bt.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&bt.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var v=this._getReflectionTexture();if(v&&bt.a.ReflectionTextureEnabled&&(!v.isReadyOrNotBlocking()||v.irradianceTexture&&!v.irradianceTexture.isReadyOrNotBlocking())||this._lightmapTexture&&bt.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(bt.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking()||this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(d.getCaps().standardDerivatives&&this._bumpTexture&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady()||this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(o,l)&&this.clearCoat.isReadyForSubMesh(o,l,d,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(o,l)&&this.anisotropy.isReadyForSubMesh(o,l)&&this.detailMap.isReadyForSubMesh(o,l))||o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;d.getCaps().standardDerivatives||e.isVerticesDataPresent(De.b.NormalKind)||(e.createNormals(!0),_.a.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var y=n.effect,D=o._areLightsDisposed,w=this._prepareEffect(e,o,this.onCompiled,this.onError,r,null,n.getRenderingMesh().hasThinInstances);if(w)if(this._onEffectCreatedObservable&&(bs.effect=w,bs.subMesh=n,this._onEffectCreatedObservable.notifyObservers(bs)),this.allowShaderHotSwapping&&y&&!w.isReady()){if(w=y,this._rebuildInParallel=!0,o.markAsUnprocessed(),D)return o._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,l.resetCachedMaterial(),n.setEffect(w,o),this.buildUniformLayout();return!(!n.effect||!n.effect.isReady())&&(o._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype.isMetallicWorkflow=function(){return!(this._metallic==null&&this._roughness==null&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,n,r,o,l,d,v){if(r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),this._prepareDefines(e,n,l,d,v),!n.isDirty)return null;n.markAsProcessed();var y=this.getScene().getEngine(),D=new _s.a,w=0;n.USESPHERICALINVERTEX&&D.addFallback(w++,"USESPHERICALINVERTEX"),n.FOG&&D.addFallback(w,"FOG"),n.SPECULARAA&&D.addFallback(w,"SPECULARAA"),n.POINTSIZE&&D.addFallback(w,"POINTSIZE"),n.LOGARITHMICDEPTH&&D.addFallback(w,"LOGARITHMICDEPTH"),n.PARALLAX&&D.addFallback(w,"PARALLAX"),n.PARALLAXOCCLUSION&&D.addFallback(w++,"PARALLAXOCCLUSION"),w=vs.AddFallbacks(n,D,w),w=vs.AddFallbacks(n,D,w),w=tl.AddFallbacks(n,D,w),w=el.AddFallbacks(n,D,w),n.ENVIRONMENTBRDF&&D.addFallback(w++,"ENVIRONMENTBRDF"),n.TANGENT&&D.addFallback(w++,"TANGENT"),n.BUMP&&D.addFallback(w++,"BUMP"),w=lt.a.HandleFallbacksForShadows(n,D,this._maxSimultaneousLights,w++),n.SPECULARTERM&&D.addFallback(w++,"SPECULARTERM"),n.USESPHERICALFROMREFLECTIONMAP&&D.addFallback(w++,"USESPHERICALFROMREFLECTIONMAP"),n.USEIRRADIANCEMAP&&D.addFallback(w++,"USEIRRADIANCEMAP"),n.LIGHTMAP&&D.addFallback(w++,"LIGHTMAP"),n.NORMAL&&D.addFallback(w++,"NORMAL"),n.AMBIENT&&D.addFallback(w++,"AMBIENT"),n.EMISSIVE&&D.addFallback(w++,"EMISSIVE"),n.VERTEXCOLOR&&D.addFallback(w++,"VERTEXCOLOR"),n.MORPHTARGETS&&D.addFallback(w++,"MORPHTARGETS"),n.MULTIVIEW&&D.addFallback(0,"MULTIVIEW");var F=[De.b.PositionKind];n.NORMAL&&F.push(De.b.NormalKind),n.TANGENT&&F.push(De.b.TangentKind),n.UV1&&F.push(De.b.UVKind),n.UV2&&F.push(De.b.UV2Kind),n.VERTEXCOLOR&&F.push(De.b.ColorKind),lt.a.PrepareAttributesForBones(F,e,n,D),lt.a.PrepareAttributesForInstances(F,n),lt.a.PrepareAttributesForMorphTargets(F,e,n);var z="pbr",k=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],K=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler"],ae=["Material","Scene"];uh.a.AddUniforms(k),uh.a.AddSamplers(K),tl.AddUniforms(k),tl.AddSamplers(K),gs.AddUniforms(k),gs.AddSamplers(K),vs.AddUniforms(k),vs.AddSamplers(K),el.AddUniforms(k),el.AddSamplers(K),Hp.a.AddUniforms(k),Hp.a.AddSamplers(k),fr.a&&(fr.a.PrepareUniforms(k,n),fr.a.PrepareSamplers(K,n)),lt.a.PrepareUniformsAndSamplersList({uniformsNames:k,uniformBuffersNames:ae,samplers:K,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var le={};this.customShaderNameResolve&&(z=this.customShaderNameResolve(z,k,ae,K,n,F,le));var fe=n.toString();return y.createEffect(z,{attributes:F,uniformsNames:k,uniformBuffersNames:ae,samplers:K,defines:fe,fallbacks:D,onCompiled:r,onError:o,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},processFinalCode:le.processFinalCode,multiTarget:n.PREPASS},y)},t.prototype._prepareDefines=function(e,n,r,o,l){r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=!1);var d=this.getScene(),v=d.getEngine();if(lt.a.PrepareDefinesForLights(d,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,lt.a.PrepareDefinesForMultiview(d,n),lt.a.PrepareDefinesForPrePass(d,n,this.canRenderToMRT),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,d.texturesEnabled){d.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&bt.a.DiffuseTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"),n.GAMMAALBEDO=this._albedoTexture.gammaSpace):n.ALBEDO=!1,this._ambientTexture&&bt.a.AmbientTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&bt.a.OpacityTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var y=this._getReflectionTexture();if(y&&bt.a.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=y.gammaSpace,n.RGBDREFLECTION=y.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!y.invertZ:y.invertZ,n.LODINREFLECTIONALPHA=y.lodLevelInAlpha,n.LINEARSPECULARREFLECTION=y.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(n.NUM_SAMPLES=""+this.realTimeFilteringQuality,v.webGLVersion>1&&(n.NUM_SAMPLES=n.NUM_SAMPLES+"u"),n.REALTIME_FILTERING=!0):n.REALTIME_FILTERING=!1,y.coordinatesMode===ke.a.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=y.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,y.coordinatesMode){case ke.a.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case ke.a.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case ke.a.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case ke.a.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case ke.a.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case ke.a.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case ke.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case ke.a.CUBIC_MODE:case ke.a.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!y.boundingBoxSize}y.coordinatesMode!==ke.a.SKYBOX_MODE&&(y.irradianceTexture?(n.USEIRRADIANCEMAP=!0,n.USESPHERICALFROMREFLECTIONMAP=!1):y.isCube&&(n.USESPHERICALFROMREFLECTIONMAP=!0,n.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||d.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0))}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USEIRRADIANCEMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1,n.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&bt.a.LightmapTextureEnabled?(lt.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,n.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):n.LIGHTMAP=!1,this._emissiveTexture&&bt.a.EmissiveTextureEnabled?lt.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,bt.a.SpecularTextureEnabled?(this._metallicTexture?(lt.a.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(lt.a.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._metallicReflectanceTexture?lt.a.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,n,"METALLIC_REFLECTANCE"):n.METALLIC_REFLECTANCE=!1,this._microSurfaceTexture?lt.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),d.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&bt.a.BumpTextureEnabled&&!this._disableBumpMap?(lt.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&bt.a.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.SPECULARAA=d.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(n._areTexturesDirty||n._areMiscDirty)&&(n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(lt.a.PrepareDefinesForMisc(e,d,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(De.b.NormalKind),n.DEBUGMODE=this._debugMode),this.detailMap.prepareDefines(n,d),this.subSurface.prepareDefines(n,d),this.clearCoat.prepareDefines(n,d),this.anisotropy.prepareDefines(n,e,d),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,d),lt.a.PrepareDefinesForFrameBoundValues(d,v,n,!!r,o,l),lt.a.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(e,n,r){var o=this,l=Object(f.a)({clipPlane:!1,useInstances:!1},r),d=new Wp,v=this._prepareEffect(e,d,void 0,void 0,l.useInstances,l.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(bs.effect=v,bs.subMesh=null,this._onEffectCreatedObservable.notifyObservers(bs)),v.isReady()?n&&n(this):v.onCompileObservable.add(function(){n&&n(o)})},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),gs.PrepareUniformBuffer(e),vs.PrepareUniformBuffer(e),el.PrepareUniformBuffer(e),tl.PrepareUniformBuffer(e),uh.a.PrepareUniformBuffer(e),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this.subSurface.unbind(this._activeEffect)&&(e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}i.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r._materialDefines;if(l){var d=r.effect;if(d){this._activeEffect=d,l.INSTANCES&&!l.THIN_INSTANCES||this.bindOnlyWorldMatrix(e),this.prePassConfiguration.bindForSubMesh(this._activeEffect,o,n,e,this.isFrozen),l.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var v=this._mustRebind(o,d,n.visibility);lt.a.BindBonesParameters(n,this._activeEffect,this.prePassConfiguration);var y=null,D=this._uniformBuffer;if(v){var w=o.getEngine();if(D.bindToEffect(d,"Material"),this.bindViewProjection(d),y=this._getReflectionTexture(),!D.useUbo||!this.isFrozen||!D.isSync){if(o.texturesEnabled){if(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&(D.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),lt.a.BindTextureMatrix(this._albedoTexture,D,"albedo")),this._ambientTexture&&bt.a.AmbientTextureEnabled&&(D.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),lt.a.BindTextureMatrix(this._ambientTexture,D,"ambient")),this._opacityTexture&&bt.a.OpacityTextureEnabled&&(D.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),lt.a.BindTextureMatrix(this._opacityTexture,D,"opacity")),y&&bt.a.ReflectionTextureEnabled){if(D.updateMatrix("reflectionMatrix",y.getReflectionTextureMatrix()),D.updateFloat2("vReflectionInfos",y.level,0),y.boundingBoxSize){var F=y;D.updateVector3("vReflectionPosition",F.boundingBoxPosition),D.updateVector3("vReflectionSize",F.boundingBoxSize)}if(this.realTimeFiltering){var z=y.getSize().width;D.updateFloat2("vReflectionFilteringInfo",z,J.a.Log2(z))}if(!l.USEIRRADIANCEMAP){var k=y.sphericalPolynomial;if(l.USESPHERICALFROMREFLECTIONMAP&&k)if(l.SPHERICAL_HARMONICS){var K=k.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",K.l00),this._activeEffect.setVector3("vSphericalL1_1",K.l1_1),this._activeEffect.setVector3("vSphericalL10",K.l10),this._activeEffect.setVector3("vSphericalL11",K.l11),this._activeEffect.setVector3("vSphericalL2_2",K.l2_2),this._activeEffect.setVector3("vSphericalL2_1",K.l2_1),this._activeEffect.setVector3("vSphericalL20",K.l20),this._activeEffect.setVector3("vSphericalL21",K.l21),this._activeEffect.setVector3("vSphericalL22",K.l22)}else this._activeEffect.setFloat3("vSphericalX",k.x.x,k.x.y,k.x.z),this._activeEffect.setFloat3("vSphericalY",k.y.x,k.y.y,k.y.z),this._activeEffect.setFloat3("vSphericalZ",k.z.x,k.z.y,k.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",k.xx.x-k.zz.x,k.xx.y-k.zz.y,k.xx.z-k.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",k.yy.x-k.zz.x,k.yy.y-k.zz.y,k.yy.z-k.zz.z),this._activeEffect.setFloat3("vSphericalZZ",k.zz.x,k.zz.y,k.zz.z),this._activeEffect.setFloat3("vSphericalXY",k.xy.x,k.xy.y,k.xy.z),this._activeEffect.setFloat3("vSphericalYZ",k.yz.x,k.yz.y,k.yz.z),this._activeEffect.setFloat3("vSphericalZX",k.zx.x,k.zx.y,k.zx.z)}D.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset)}this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&(D.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),lt.a.BindTextureMatrix(this._emissiveTexture,D,"emissive")),this._lightmapTexture&&bt.a.LightmapTextureEnabled&&(D.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),lt.a.BindTextureMatrix(this._lightmapTexture,D,"lightmap")),bt.a.SpecularTextureEnabled&&(this._metallicTexture?(D.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),lt.a.BindTextureMatrix(this._metallicTexture,D,"reflectivity")):this._reflectivityTexture&&(D.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),lt.a.BindTextureMatrix(this._reflectivityTexture,D,"reflectivity")),this._metallicReflectanceTexture&&(D.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),lt.a.BindTextureMatrix(this._metallicReflectanceTexture,D,"metallicReflectance")),this._microSurfaceTexture&&(D.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),lt.a.BindTextureMatrix(this._microSurfaceTexture,D,"microSurfaceSampler"))),this._bumpTexture&&w.getCaps().standardDerivatives&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&(D.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),lt.a.BindTextureMatrix(this._bumpTexture,D,"bump"),o._mirroredCameraPosition?D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&D.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW){C.c.Color3[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic,C.c.Color3[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness,D.updateColor4("vReflectivityColor",C.c.Color3[0],1);var ae=this.subSurface.indexOfRefraction,le=Math.pow((ae-1)/(ae+1),2);this._metallicReflectanceColor.scaleToRef(le*this._metallicF0Factor,C.c.Color3[0]);var fe=this._metallicF0Factor;D.updateColor4("vMetallicReflectanceFactors",C.c.Color3[0],fe)}else D.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);D.updateColor3("vEmissiveColor",bt.a.EmissiveTextureEnabled?this._emissiveColor:C.a.BlackReadOnly),D.updateColor3("vReflectionColor",this._reflectionColor),!l.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?D.updateColor4("vAlbedoColor",this._albedoColor,1):D.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*o.environmentIntensity,this._lightingInfos.w=this._specularIntensity,D.updateVector4("vLightingIntensity",this._lightingInfos)}D.updateFloat("visibility",n.visibility),o.texturesEnabled&&(this._albedoTexture&&bt.a.DiffuseTextureEnabled&&D.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&bt.a.AmbientTextureEnabled&&D.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&bt.a.OpacityTextureEnabled&&D.setTexture("opacitySampler",this._opacityTexture),y&&bt.a.ReflectionTextureEnabled&&(l.LODBASEDMICROSFURACE?D.setTexture("reflectionSampler",y):(D.setTexture("reflectionSampler",y._lodTextureMid||y),D.setTexture("reflectionSamplerLow",y._lodTextureLow||y),D.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)),l.USEIRRADIANCEMAP&&D.setTexture("irradianceSampler",y.irradianceTexture)),l.ENVIRONMENTBRDF&&D.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&bt.a.EmissiveTextureEnabled&&D.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&bt.a.LightmapTextureEnabled&&D.setTexture("lightmapSampler",this._lightmapTexture),bt.a.SpecularTextureEnabled&&(this._metallicTexture?D.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&D.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&D.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._microSurfaceTexture&&D.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&w.getCaps().standardDerivatives&&bt.a.BumpTextureEnabled&&!this._disableBumpMap&&D.setTexture("bumpSampler",this._bumpTexture)),this.detailMap.bindForSubMesh(D,o,this.isFrozen),this.subSurface.bindForSubMesh(D,o,w,this.isFrozen,l.LODBASEDMICROSFURACE,this.realTimeFiltering),this.clearCoat.bindForSubMesh(D,o,w,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY,r),this.anisotropy.bindForSubMesh(D,o,this.isFrozen),this.sheen.bindForSubMesh(D,o,this.isFrozen,r),lt.a.BindClipPlane(this._activeEffect,o),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var me=o._forcedViewPosition?o._forcedViewPosition:o._mirroredCameraPosition?o._mirroredCameraPosition:o.activeCamera.globalPosition,be=o.useRightHandedSystem===(o._mirroredCameraPosition!=null);d.setFloat4("vEyePosition",me.x,me.y,me.z,be?-1:1),d.setColor3("vAmbientColor",this._globalAmbientColor),d.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!v&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&lt.a.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,this._rebuildInParallel),(o.fogEnabled&&n.applyFog&&o.fogMode!==ne.a.FOGMODE_NONE||y)&&this.bindView(d),lt.a.BindFogParameters(o,n,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&lt.a.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),lt.a.BindLogDepth(l,this._activeEffect,o)),D.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.detailMap.getAnimatables(e),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this.detailMap.getActiveTextures(e),this.subSurface.getActiveTextures(e),this.clearCoat.getActiveTextures(e),this.sheen.getActiveTextures(e),this.anisotropy.getActiveTextures(e),e},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._albedoTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this.detailMap.hasTexture(e)||this.subSurface.hasTexture(e)||this.clearCoat.hasTexture(e)||this.sheen.hasTexture(e)||this.anisotropy.hasTexture(e)},t.prototype.setPrePassRenderer=function(e){if(this.subSurface.isScatteringEnabled){var n=this.getScene().enableSubSurfaceForPrePass();return n&&(n.enabled=!0),!0}return!1},t.prototype.dispose=function(e,n){var r,o,l,d,v,y,D,w,F,z,k;n&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),(r=this._albedoTexture)===null||r===void 0||r.dispose(),(o=this._ambientTexture)===null||o===void 0||o.dispose(),(l=this._opacityTexture)===null||l===void 0||l.dispose(),(d=this._reflectionTexture)===null||d===void 0||d.dispose(),(v=this._emissiveTexture)===null||v===void 0||v.dispose(),(y=this._metallicTexture)===null||y===void 0||y.dispose(),(D=this._reflectivityTexture)===null||D===void 0||D.dispose(),(w=this._bumpTexture)===null||w===void 0||w.dispose(),(F=this._lightmapTexture)===null||F===void 0||F.dispose(),(z=this._metallicReflectanceTexture)===null||z===void 0||z.dispose(),(k=this._microSurfaceTexture)===null||k===void 0||k.dispose()),this.detailMap.dispose(n),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,n)},t.PBRMATERIAL_OPAQUE=pn.a.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=pn.a.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=pn.a.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=pn.a.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,Object(f.c)([Object(B.i)()],t.prototype,"_imageProcessingConfiguration",void 0),Object(f.c)([Object(B.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),Object(f.c)([Object(B.c)()],t.prototype,"useLogarithmicDepth",null),t}(ch.a),nl=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.directIntensity=1,r.emissiveIntensity=1,r.environmentIntensity=1,r.specularIntensity=1,r.disableBumpMap=!1,r.ambientTextureStrength=1,r.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r.metallicF0Factor=1,r.metallicReflectanceColor=C.a.White(),r.ambientColor=new C.a(0,0,0),r.albedoColor=new C.a(1,1,1),r.reflectivityColor=new C.a(1,1,1),r.reflectionColor=new C.a(1,1,1),r.emissiveColor=new C.a(0,0,0),r.microSurface=1,r.useLightmapAsShadowmap=!1,r.useAlphaFromAlbedoTexture=!1,r.forceAlphaTest=!1,r.alphaCutOff=.4,r.useSpecularOverAlpha=!0,r.useMicroSurfaceFromReflectivityMapAlpha=!1,r.useRoughnessFromMetallicTextureAlpha=!0,r.useRoughnessFromMetallicTextureGreen=!1,r.useMetallnessFromMetallicTextureBlue=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.useAmbientInGrayScale=!1,r.useAutoMicroSurfaceFromReflectivityMap=!1,r.useRadianceOverAlpha=!0,r.useObjectSpaceNormalMap=!1,r.useParallax=!1,r.useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r.disableLighting=!1,r.forceIrradianceInFragment=!1,r.maxSimultaneousLights=4,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.twoSidedLighting=!1,r.useAlphaFresnel=!1,r.useLinearAlphaFresnel=!1,r.environmentBRDFTexture=null,r.forceNormalForward=!1,r.enableSpecularAntiAliasing=!1,r.useHorizonOcclusion=!0,r.useRadianceOcclusion=!0,r.unlit=!1,r._environmentBRDFTexture=lh.GetEnvironmentBRDFTexture(n),r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===nr.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?nr.LIGHTFALLOFF_PHYSICAL:nr.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===nr.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?nr.LIGHTFALLOFF_GLTF:nr.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},t.PBRMATERIAL_OPAQUE=nr.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=nr.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=nr.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=nr.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=nr.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicF0Factor",void 0),Object(f.c)([Object(B.e)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceColor",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(f.c)([Object(B.e)("ambient"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),Object(f.c)([Object(B.e)("albedo"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),Object(f.c)([Object(B.e)("reflectivity"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),Object(f.c)([Object(B.e)("reflection"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),Object(f.c)([Object(B.e)("emissive"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Object(f.c)([Object(B.c)()],t.prototype,"usePhysicalLightFalloff",null),Object(f.c)([Object(B.c)()],t.prototype,"useGLTFLightFalloff",null),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(nr);R.a.RegisteredTypes["BABYLON.PBRMaterial"]=nl;function hh(i){return i.charCodeAt(0)+(i.charCodeAt(1)<<8)+(i.charCodeAt(2)<<16)+(i.charCodeAt(3)<<24)}var zy=hh("DXT1"),Gy=hh("DXT3"),Hy=hh("DXT5"),Xp=hh("DX10"),zo=function(){function i(){}return i.GetDDSInfo=function(t){var e=new Int32Array(t.buffer,t.byteOffset,31),n=new Int32Array(t.buffer,t.byteOffset,35),r=1;131072&e[2]&&(r=Math.max(1,e[7]));var o=e[21],l=o===Xp?n[32]:0,d=g.a.TEXTURETYPE_UNSIGNED_INT;switch(o){case 113:d=g.a.TEXTURETYPE_HALF_FLOAT;break;case 116:d=g.a.TEXTURETYPE_FLOAT;break;case Xp:if(l===10){d=g.a.TEXTURETYPE_HALF_FLOAT;break}if(l===2){d=g.a.TEXTURETYPE_FLOAT;break}}return{width:e[4],height:e[3],mipmapCount:r,isFourCC:(4&e[20])==4,isRGB:(64&e[20])==64,isLuminance:(131072&e[20])==131072,isCube:(512&e[28])==512,isCompressed:o===zy||o===Gy||o===Hy,dxgiFormat:l,textureType:d}},i._ToHalfFloat=function(t){i._FloatView||(i._FloatView=new Float32Array(1),i._Int32View=new Int32Array(i._FloatView.buffer)),i._FloatView[0]=t;var e=i._Int32View[0],n=e>>16&32768,r=e>>12&2047,o=e>>23&255;return o<103?n:o>142?(n|=31744,n|=(o==255?0:1)&&8388607&e):o<113?n|=((r|=2048)>>114-o)+(r>>113-o&1):(n|=o-112<<10|r>>1,n+=1&r)},i._FromHalfFloat=function(t){var e=(32768&t)>>15,n=(31744&t)>>10,r=1023&t;return n===0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},i._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,e,n,r,o,l){for(var d=new Float32Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);d[y]=i._FromHalfFloat(v[F]),d[y+1]=i._FromHalfFloat(v[F+1]),d[y+2]=i._FromHalfFloat(v[F+2]),i.StoreLODInAlphaChannel?d[y+3]=l:d[y+3]=i._FromHalfFloat(v[F+3]),y+=4}return d},i._GetHalfFloatRGBAArrayBuffer=function(t,e,n,r,o,l){if(i.StoreLODInAlphaChannel){for(var d=new Uint16Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);d[y]=v[F],d[y+1]=v[F+1],d[y+2]=v[F+2],d[y+3]=i._ToHalfFloat(l),y+=4}return d}return new Uint16Array(o,n,r)},i._GetFloatRGBAArrayBuffer=function(t,e,n,r,o,l){if(i.StoreLODInAlphaChannel){for(var d=new Float32Array(r),v=new Float32Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);d[y]=v[F],d[y+1]=v[F+1],d[y+2]=v[F+2],d[y+3]=l,y+=4}return d}return new Float32Array(o,n,r)},i._GetFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,l){for(var d=new Uint8Array(r),v=new Float32Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);d[y]=255*J.a.Clamp(v[F]),d[y+1]=255*J.a.Clamp(v[F+1]),d[y+2]=255*J.a.Clamp(v[F+2]),i.StoreLODInAlphaChannel?d[y+3]=l:d[y+3]=255*J.a.Clamp(v[F+3]),y+=4}return d},i._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,l){for(var d=new Uint8Array(r),v=new Uint16Array(o,n),y=0,D=0;D<e;D++)for(var w=0;w<t;w++){var F=4*(w+D*t);d[y]=255*J.a.Clamp(i._FromHalfFloat(v[F])),d[y+1]=255*J.a.Clamp(i._FromHalfFloat(v[F+1])),d[y+2]=255*J.a.Clamp(i._FromHalfFloat(v[F+2])),i.StoreLODInAlphaChannel?d[y+3]=l:d[y+3]=255*J.a.Clamp(i._FromHalfFloat(v[F+3])),y+=4}return d},i._GetRGBAArrayBuffer=function(t,e,n,r,o,l,d,v,y){for(var D=new Uint8Array(r),w=new Uint8Array(o,n),F=0,z=0;z<e;z++)for(var k=0;k<t;k++){var K=4*(k+z*t);D[F]=w[K+l],D[F+1]=w[K+d],D[F+2]=w[K+v],D[F+3]=w[K+y],F+=4}return D},i._ExtractLongWordOrder=function(t){return t===0||t===255||t===-16777216?0:1+i._ExtractLongWordOrder(t>>8)},i._GetRGBArrayBuffer=function(t,e,n,r,o,l,d,v){for(var y=new Uint8Array(r),D=new Uint8Array(o,n),w=0,F=0;F<e;F++)for(var z=0;z<t;z++){var k=3*(z+F*t);y[w]=D[k+l],y[w+1]=D[k+d],y[w+2]=D[k+v],w+=3}return y},i._GetLuminanceArrayBuffer=function(t,e,n,r,o){for(var l=new Uint8Array(r),d=new Uint8Array(o,n),v=0,y=0;y<e;y++)for(var D=0;D<t;D++){var w=D+y*t;l[v]=d[w],v++}return l},i.UploadDDSLevels=function(t,e,n,r,o,l,d,v){d===void 0&&(d=-1);var y=null;r.sphericalPolynomial&&(y=new Array);var D,w,F,z,k,K,ae,le=t.getCaps().s3tc,fe=new Int32Array(n.buffer,n.byteOffset,31),me=0,be=0,Ee=1;if(fe[0]===542327876)if(r.isFourCC||r.isRGB||r.isLuminance)if(!r.isCompressed||le){var xe=fe[22];z=fe[1]+4;var Ae,Ie=!1;if(r.isFourCC)switch(D=fe[21]){case zy:Ee=8,be=le.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case Gy:Ee=16,be=le.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Hy:Ee=16,be=le.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:Ie=!0;break;case Xp:z+=20;var Re=!1;switch(r.dxgiFormat){case 10:case 2:Ie=!0,Re=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,xe=32,Re=!0}if(Re)break;default:return void console.error("Unsupported FourCC code:",(Ae=D,String.fromCharCode(255&Ae,Ae>>8&255,Ae>>16&255,Ae>>24&255)))}var Pe=i._ExtractLongWordOrder(fe[23]),Ce=i._ExtractLongWordOrder(fe[24]),Ue=i._ExtractLongWordOrder(fe[25]),Oe=i._ExtractLongWordOrder(fe[26]);Ie&&(be=t._getRGBABufferInternalSizedFormat(r.textureType)),K=1,131072&fe[2]&&o!==!1&&(K=Math.max(1,fe[7]));for(var Ve=v||0;Ve<l;Ve++){for(w=fe[4],F=fe[3],ae=0;ae<K;++ae){if(d===-1||d===ae){var Le=d===-1?ae:0;if(!r.isCompressed&&r.isFourCC){e.format=g.a.TEXTUREFORMAT_RGBA,me=w*F*4;var ze=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(xe===128?(ze=i._GetFloatAsUIntRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le),y&&Le==0&&y.push(i._GetFloatRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le))):xe===64&&(ze=i._GetHalfFloatAsUIntRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le),y&&Le==0&&y.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le))),e.type=g.a.TEXTURETYPE_UNSIGNED_INT):xe===128?(e.type=g.a.TEXTURETYPE_FLOAT,ze=i._GetFloatRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le),y&&Le==0&&y.push(ze)):xe!==64||t.getCaps().textureHalfFloat?(e.type=g.a.TEXTURETYPE_HALF_FLOAT,ze=i._GetHalfFloatRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le),y&&Le==0&&y.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,z,me,n.buffer,Le))):(e.type=g.a.TEXTURETYPE_FLOAT,ze=i._GetHalfFloatAsFloatRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Le),y&&Le==0&&y.push(ze)),ze&&t._uploadDataToTextureDirectly(e,ze,Ve,Le)}else if(r.isRGB)e.type=g.a.TEXTURETYPE_UNSIGNED_INT,xe===24?(e.format=g.a.TEXTUREFORMAT_RGB,me=w*F*3,k=i._GetRGBArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Pe,Ce,Ue),t._uploadDataToTextureDirectly(e,k,Ve,Le)):(e.format=g.a.TEXTUREFORMAT_RGBA,me=w*F*4,k=i._GetRGBAArrayBuffer(w,F,n.byteOffset+z,me,n.buffer,Pe,Ce,Ue,Oe),t._uploadDataToTextureDirectly(e,k,Ve,Le));else if(r.isLuminance){var tt=t._getUnpackAlignement(),ut=w;me=Math.floor((w+tt-1)/tt)*tt*(F-1)+ut,k=i._GetLuminanceArrayBuffer(w,F,n.byteOffset+z,me,n.buffer),e.format=g.a.TEXTUREFORMAT_LUMINANCE,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(e,k,Ve,Le)}else me=Math.max(4,w)/4*Math.max(4,F)/4*Ee,k=new Uint8Array(n.buffer,n.byteOffset+z,me),e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(e,be,w,F,k,Ve,Le)}z+=xe?w*F*(xe/8):me,w*=.5,F*=.5,w=Math.max(1,w),F=Math.max(1,F)}if(v!==void 0)break}y&&y.length>0?r.sphericalPolynomial=$u.ConvertCubeMapToSphericalPolynomial({size:fe[4],right:y[0],left:y[1],up:y[2],down:y[3],front:y[4],back:y[5],format:g.a.TEXTUREFORMAT_RGBA,type:g.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):r.sphericalPolynomial=void 0}else _.a.Error("Compressed textures are not supported on this platform.");else _.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else _.a.Error("Invalid magic number in DDS header")},i.StoreLODInAlphaChannel=!1,i}();en.a.prototype.createPrefilteredCubeTexture=function(i,t,e,n,r,o,l,d,v){var y=this;return r===void 0&&(r=null),o===void 0&&(o=null),d===void 0&&(d=null),v===void 0&&(v=!0),this.createCubeTexture(i,t,null,!1,function(D){if(D){var w=D.texture;if(v?D.info.sphericalPolynomial&&(w._sphericalPolynomial=D.info.sphericalPolynomial):w._sphericalPolynomial=new qc,w._source=Nt.b.CubePrefiltered,y.getCaps().textureLOD)r&&r(w);else{var F=y._gl,z=D.width;if(z){for(var k=[],K=0;K<3;K++){var ae=1-K/2,le=n,fe=J.a.Log2(z)*e+n,me=le+(fe-le)*ae,be=Math.round(Math.min(Math.max(me,0),fe)),Ee=new Nt.a(y,Nt.b.Temp);if(Ee.type=w.type,Ee.format=w.format,Ee.width=Math.pow(2,Math.max(J.a.Log2(z)-be,0)),Ee.height=Ee.width,Ee.isCube=!0,y._bindTextureDirectly(F.TEXTURE_CUBE_MAP,Ee,!0),Ee.samplingMode=g.a.TEXTURE_LINEAR_LINEAR,F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),D.isDDS){var xe=D.info,Ae=D.data;y._unpackFlipY(xe.isCompressed),zo.UploadDDSLevels(y,Ee,Ae,xe,!0,6,be)}else _.a.Warn("DDS is the only prefiltered cube map supported so far.");y._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null);var Ie=new Zr.a(t);Ie.isCube=!0,Ie._texture=Ee,Ee.isReady=!0,k.push(Ie)}w._lodTextureHigh=k[2],w._lodTextureMid=k[1],w._lodTextureLow=k[0],r&&r(w)}}}else r&&r(null)},o,l,d,v,e,n)};var Wy=function(){function i(){this.supportCascades=!0}return i.prototype.canLoad=function(t){return ci.a.EndsWith(t,".dds")},i.prototype.loadCubeData=function(t,e,n,r,o){var l,d=e.getEngine(),v=!1;if(Array.isArray(t))for(var y=0;y<t.length;y++){var D=t[y];l=zo.GetDDSInfo(D),e.width=l.width,e.height=l.height,v=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&e.generateMipMaps,d._unpackFlipY(l.isCompressed),zo.UploadDDSLevels(d,e,D,l,v,6,-1,y),l.isFourCC||l.mipmapCount!==1||d.generateMipMapsForCubemap(e)}else{var w=t;l=zo.GetDDSInfo(w),e.width=l.width,e.height=l.height,n&&(l.sphericalPolynomial=new qc),v=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&e.generateMipMaps,d._unpackFlipY(l.isCompressed),zo.UploadDDSLevels(d,e,w,l,v,6),l.isFourCC||l.mipmapCount!==1||d.generateMipMapsForCubemap(e,!1)}d._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r({isDDS:!0,width:e.width,info:l,data:t,texture:e})},i.prototype.loadData=function(t,e,n){var r=zo.GetDDSInfo(t),o=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&e.generateMipMaps&&r.width>>r.mipmapCount-1==1;n(r.width,r.height,o,r.isFourCC,function(){zo.UploadDDSLevels(e.getEngine(),e,t,r,o,1)})},i}();He.a._TextureLoaders.push(new Wy);var Xy=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ci.a.EndsWith(t,".env")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var l=io.GetEnvInfo(t);l?(e.width=l.width,e.height=l.width,io.UploadEnvSpherical(e,l),io.UploadEnvLevelsAsync(e,t,l).then(function(){e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()})):o&&o("Can not parse the environment file",null)}},i.prototype.loadData=function(t,e,n){throw".env not supported in 2d."},i}();He.a._TextureLoaders.push(new Xy);var dh=function(){function i(t,e,n,r){if(this.data=t,this.isInvalid=!1,!i.IsValid(t))return this.isInvalid=!0,void _.a.Error("texture missing KTX identifier");var o=Uint32Array.BYTES_PER_ELEMENT,l=new DataView(this.data.buffer,this.data.byteOffset+12,13*o),d=l.getUint32(0,!0)===67305985;this.glType=l.getUint32(1*o,d),this.glTypeSize=l.getUint32(2*o,d),this.glFormat=l.getUint32(3*o,d),this.glInternalFormat=l.getUint32(4*o,d),this.glBaseInternalFormat=l.getUint32(5*o,d),this.pixelWidth=l.getUint32(6*o,d),this.pixelHeight=l.getUint32(7*o,d),this.pixelDepth=l.getUint32(8*o,d),this.numberOfArrayElements=l.getUint32(9*o,d),this.numberOfFaces=l.getUint32(10*o,d),this.numberOfMipmapLevels=l.getUint32(11*o,d),this.bytesOfKeyValueData=l.getUint32(12*o,d),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===e?this.loadType=i.COMPRESSED_2D:_.a.Error("number of faces expected"+e+", but found "+this.numberOfFaces):_.a.Error("texture arrays not currently supported"):_.a.Error("only 2D textures currently supported")):_.a.Error("only compressed formats currently supported")}return i.prototype.uploadLevels=function(t,e){switch(this.loadType){case i.COMPRESSED_2D:this._upload2DCompressedLevels(t,e);break}},i.prototype._upload2DCompressedLevels=function(t,e){for(var n=i.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight,l=e?this.numberOfMipmapLevels:1,d=0;d<l;d++){var v=new Int32Array(this.data.buffer,this.data.byteOffset+n,1)[0];n+=4;for(var y=0;y<this.numberOfFaces;y++){var D=new Uint8Array(this.data.buffer,this.data.byteOffset+n,v);t.getEngine()._uploadCompressedDataToTextureDirectly(t,this.glInternalFormat,r,o,D,y,d),n+=v,n+=3-(v+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===49&&e[6]===49&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.HEADER_LEN=64,i.COMPRESSED_2D=0,i.COMPRESSED_3D=1,i.TEX_2D=2,i.TEX_3D=3,i}(),Yp=function(){function i(t){this._pendingActions=new Array,this._workerInfos=t.map(function(e){return{worker:e,active:!1}})}return i.prototype.dispose=function(){for(var t=0,e=this._workerInfos;t<e.length;t++)e[t].worker.terminate();this._workerInfos=[],this._pendingActions=[]},i.prototype.push=function(t){for(var e=0,n=this._workerInfos;e<n.length;e++){var r=n[e];if(!r.active)return void this._execute(r,t)}this._pendingActions.push(t)},i.prototype._execute=function(t,e){var n=this;t.active=!0,e(t.worker,function(){t.active=!1;var r=n._pendingActions.shift();r&&n._execute(t,r)})},i}(),Kp=function(){function i(t,e){e===void 0&&(e=i.DefaultNumWorkers),this._engine=t,i._Initialized||i._CreateWorkerPool(e)}return i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},i._CreateWorkerPool=function(t){this._Initialized=!0,t&&typeof Worker=="function"?i._WorkerPoolPromise=new Promise(function(e){for(var n="("+ED+")()",r=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),o=new Array(t),l=0;l<o.length;l++)o[l]=new Promise(function(d,v){var y=new Worker(r),D=function(F){y.removeEventListener("error",D),y.removeEventListener("message",w),v(F)},w=function(F){F.data.action==="init"&&(y.removeEventListener("error",D),y.removeEventListener("message",w),d(y))};y.addEventListener("error",D),y.addEventListener("message",w),y.postMessage({action:"init",urls:i.URLConfig})});Promise.all(o).then(function(d){e(new Yp(d))})}):(KTX2DECODER.MSCTranscoder.UseFromWorkerThread=!1,KTX2DECODER.WASMMemoryManager.LoadBinariesFromCurrentThread=!0)},i.prototype.uploadAsync=function(t,e,n){var r=this,o=this._engine.getCaps(),l={astc:!!o.astc,bptc:!!o.bptc,s3tc:!!o.s3tc,pvrtc:!!o.pvrtc,etc2:!!o.etc2,etc1:!!o.etc1};return i._WorkerPoolPromise?i._WorkerPoolPromise.then(function(d){return new Promise(function(v,y){d.push(function(D,w){var F=function(k){D.removeEventListener("error",F),D.removeEventListener("message",z),y(k),w()},z=function(k){if(k.data.action==="decoded"){if(D.removeEventListener("error",F),D.removeEventListener("message",z),k.data.success)try{r._createTexture(k.data.decodedData,e,n),v()}catch(K){y({message:K})}else y({message:k.data.msg});w()}};D.addEventListener("error",F),D.addEventListener("message",z),D.postMessage({action:"decode",data:t,caps:l,options:n})})})}):new Promise(function(d,v){i._Ktx2Decoder||(i._Ktx2Decoder=new KTX2DECODER.KTX2Decoder),i._Ktx2Decoder.decode(t,o).then(function(y){r._createTexture(y,e),d()}).catch(function(y){v({message:y})})})},i.prototype.dispose=function(){i._WorkerPoolPromise&&i._WorkerPoolPromise.then(function(t){t.dispose()}),delete i._WorkerPoolPromise},i.prototype._createTexture=function(t,e,n){if(this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,e),n&&(n.transcodedFormat=t.transcodedFormat,n.isInGammaSpace=t.isInGammaSpace,n.transcoderName=t.transcoderName),t.transcodedFormat===32856?(e.type=g.a.TEXTURETYPE_UNSIGNED_BYTE,e.format=g.a.TEXTUREFORMAT_RGBA):e.format=t.transcodedFormat,e._gammaSpace=t.isInGammaSpace,t.errors)throw new Error("KTX2 container - could not transcode the data. "+t.errors);for(var r=0;r<t.mipmaps.length;++r){var o=t.mipmaps[r];if(!o||!o.data)throw new Error("KTX2 container - could not transcode one of the image");t.transcodedFormat===32856?(e.width=o.width,e.height=o.height,this._engine._uploadDataToTextureDirectly(e,o.data,0,r,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(e,t.transcodedFormat,o.width,o.height,o.data,0,r)}e.width=t.mipmaps[0].width,e.height=t.mipmaps[0].height,e.generateMipMaps=t.mipmaps.length>1,e.isReady=!0,this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,null)},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.URLConfig={jsDecoderModule:"https://preview.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,jsMSCTranscoder:null,wasmMSCTranscoder:null},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i}();function ED(){var i;onmessage=function(t){switch(t.data.action){case"init":var e=t.data.urls;importScripts(e.jsDecoderModule),e.wasmUASTCToASTC!==null&&(KTX2DECODER.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7!==null&&(KTX2DECODER.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.jsMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),i=new KTX2DECODER.KTX2Decoder,postMessage({action:"init"});break;case"decode":i.decode(t.data.data,t.data.caps,t.data.options).then(function(n){for(var r=[],o=0;o<n.mipmaps.length;++o){var l=n.mipmaps[o];l&&l.data&&r.push(l.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:n},r)}).catch(function(n){postMessage({action:"decoded",success:!1,msg:n})})}}}var Yy=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t,e){return ci.a.EndsWith(t,".ktx")||ci.a.EndsWith(t,".ktx2")||e==="image/ktx"||e==="image/ktx2"},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){e._invertVScale=!e.invertY;var l=e.getEngine(),d=new dh(t,6),v=d.numberOfMipmapLevels>1&&e.generateMipMaps;l._unpackFlipY(!0),d.uploadLevels(e,e.generateMipMaps),e.width=d.pixelWidth,e.height=d.pixelHeight,l._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}},i.prototype.loadData=function(t,e,n,r){if(dh.IsValid(t)){e._invertVScale=!e.invertY;var o=new dh(t,1);n(o.pixelWidth,o.pixelHeight,e.generateMipMaps,!0,function(){o.uploadLevels(e,e.generateMipMaps)},o.isInvalid)}else Kp.IsValid(t)?new Kp(e.getEngine()).uploadAsync(t,e,r).then(function(){n(e.width,e.height,e.generateMipMaps,!0,function(){},!1)},function(l){_.a.Warn("Failed to load KTX2 texture data: "+l.message),n(0,0,!1,!1,function(){},!0)}):(_.a.Error("texture missing KTX identifier"),n(0,0,!1,!1,function(){},!0))},i}();He.a._TextureLoaders.unshift(new Yy);var Ky=function(i){function t(e,n,r){var o=i.call(this,e,h.e.Zero(),n)||this;return o._xrSessionManager=r,o._firstFrame=!1,o._referenceQuaternion=h.b.Identity(),o._referencedPosition=new h.e,o._xrInvPositionCache=new h.e,o._xrInvQuaternionCache=h.b.Identity(),o._trackingState=Aa.NOT_TRACKING,o.onBeforeCameraTeleport=new S.c,o.onAfterCameraTeleport=new S.c,o.onTrackingStateChanged=new S.c,o.compensateOnFirstFrame=!0,o._rotate180=new h.b(0,1,0,0),o.minZ=.1,o.rotationQuaternion=new h.b,o.cameraRigMode=Pt.a.RIG_MODE_CUSTOM,o.updateUpVectorFromRotation=!0,o._updateNumberOfRigCameras(1),o.freezeProjectionMatrix(),o._xrSessionManager.onXRSessionInit.add(function(){o._referencedPosition.copyFromFloats(0,0,0),o._referenceQuaternion.copyFromFloats(0,0,0,1),o._firstFrame=o.compensateOnFirstFrame}),o._xrSessionManager.onXRFrameObservable.add(function(l){o._firstFrame&&o._updateFromXRSession(),o._updateReferenceSpace(),o._updateFromXRSession()},void 0,!0),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"trackingState",{get:function(){return this._trackingState},enumerable:!1,configurable:!0}),t.prototype._setTrackingState=function(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))},Object.defineProperty(t.prototype,"realWorldHeight",{get:function(){var e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y:0},enumerable:!1,configurable:!0}),t.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new si.a(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new si.a(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},t.prototype.setTransformationFromNonVRCamera=function(e,n){e===void 0&&(e=this.getScene().activeCamera),n===void 0&&(n=!0),e&&e!==this&&(e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,h.b.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,n&&this._xrSessionManager.resetReferenceSpace())},t.prototype.getClassName=function(){return"WebXRCamera"},t.prototype._updateFromXRSession=function(){var e=this,n=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(n){var r=n.emulatedPosition?Aa.TRACKING_LOST:Aa.TRACKING;if(this._setTrackingState(r),n.transform){var o=n.transform.position;this._referencedPosition.set(o.x,o.y,o.z);var l=n.transform.orientation;this._referenceQuaternion.set(l.x,l.y,l.z,l.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==n.views.length&&this._updateNumberOfRigCameras(n.views.length),n.views.forEach(function(d,v){var y=e.rigCameras[v];y.isLeftCamera||y.isRightCamera||(d.eye==="right"?y._isRightCamera=!0:d.eye==="left"&&(y._isLeftCamera=!0));var D=d.transform.position,w=d.transform.orientation;if(y.position.set(D.x,D.y,D.z),y.rotationQuaternion.set(w.x,w.y,w.z,w.w),e._scene.useRightHandedSystem?y.rotationQuaternion.multiplyInPlace(e._rotate180):(y.position.z*=-1,y.rotationQuaternion.z*=-1,y.rotationQuaternion.w*=-1),h.a.FromFloat32ArrayToRefScaled(d.projectionMatrix,0,1,y._projectionMatrix),e._scene.useRightHandedSystem||y._projectionMatrix.toggleProjectionMatrixHandInPlace(),v===0&&e._projectionMatrix.copyFrom(y._projectionMatrix),e._xrSessionManager.session.renderState.baseLayer){var F=e._xrSessionManager.session.renderState.baseLayer.getViewport(d),z=e._xrSessionManager.session.renderState.baseLayer.framebufferWidth,k=e._xrSessionManager.session.renderState.baseLayer.framebufferHeight;y.viewport.width=F.width/z,y.viewport.height=F.height/k,y.viewport.x=F.x/z,y.viewport.y=F.y/k}y.outputRenderTarget=e._xrSessionManager.getRenderTargetTextureForEye(d.eye)})}else this._setTrackingState(Aa.NOT_TRACKING)},t.prototype._updateNumberOfRigCameras=function(e){for(e===void 0&&(e=1);this.rigCameras.length<e;){var n=new ai("XR-RigCamera: "+this.rigCameras.length,h.e.Zero(),this.getScene());n.minZ=.1,n.rotationQuaternion=new h.b,n.updateUpVectorFromRotation=!0,n.isRigCamera=!0,n.rigParent=this,n.freezeProjectionMatrix(),this.rigCameras.push(n)}for(;this.rigCameras.length>e;){var r=this.rigCameras.pop();r&&r.dispose()}},t.prototype._updateReferenceSpace=function(){this.position.equals(this._referencedPosition)&&this.rotationQuaternion.equals(this._referenceQuaternion)||(this.position.subtractToRef(this._referencedPosition,this._referencedPosition),this._referenceQuaternion.conjugateInPlace(),this._referenceQuaternion.multiplyToRef(this.rotationQuaternion,this._referenceQuaternion),this._updateReferenceSpaceOffset(this._referencedPosition,this._referenceQuaternion.normalize()))},t.prototype._updateReferenceSpaceOffset=function(e,n,r){if(r===void 0&&(r=!1),this._xrSessionManager.referenceSpace&&this._xrSessionManager.currentFrame){this._xrInvPositionCache.copyFrom(e),n?this._xrInvQuaternionCache.copyFrom(n):this._xrInvQuaternionCache.copyFromFloats(0,0,0,1),this._scene.useRightHandedSystem||(this._xrInvPositionCache.z*=-1,this._xrInvQuaternionCache.z*=-1,this._xrInvQuaternionCache.w*=-1),this._xrInvPositionCache.negateInPlace(),this._xrInvQuaternionCache.conjugateInPlace(),this._xrInvPositionCache.rotateByQuaternionToRef(this._xrInvQuaternionCache,this._xrInvPositionCache),r&&(this._xrInvPositionCache.y=0);var o=new XRRigidTransform({x:this._xrInvPositionCache.x,y:this._xrInvPositionCache.y,z:this._xrInvPositionCache.z},{x:this._xrInvQuaternionCache.x,y:this._xrInvQuaternionCache.y,z:this._xrInvQuaternionCache.z,w:this._xrInvQuaternionCache.w}),l=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(o),d=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(l);if(d){var v=new h.e(d.transform.position.x,d.transform.position.y,d.transform.position.z);this._scene.useRightHandedSystem||(v.z*=-1),this.position.subtractToRef(v,v),this._scene.useRightHandedSystem||(v.z*=-1),v.negateInPlace();var y=new XRRigidTransform({x:v.x,y:v.y,z:v.z});this._xrSessionManager.referenceSpace=l.getOffsetReferenceSpace(y)}}},t}(Ar),Ti=function(){function i(){}return i.ANCHOR_SYSTEM="xr-anchor-system",i.BACKGROUND_REMOVER="xr-background-remover",i.HIT_TEST="xr-hit-test",i.PHYSICS_CONTROLLERS="xr-physics-controller",i.PLANE_DETECTION="xr-plane-detection",i.POINTER_SELECTION="xr-controller-pointer-selection",i.TELEPORTATION="xr-controller-teleportation",i.FEATURE_POINTS="xr-feature-points",i.HAND_TRACKING="xr-hand-tracking",i}(),li=function(){function i(t){var e=this;this._xrSessionManager=t,this._features={},this._xrSessionManager.onXRSessionInit.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];!r.enabled||r.featureImplementation.attached||r.featureImplementation.disableAutoAttach||e.attachFeature(n)})}),this._xrSessionManager.onXRSessionEnded.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];r.enabled&&r.featureImplementation.attached&&e.detachFeature(n)})})}return i.AddWebXRFeature=function(t,e,n,r){n===void 0&&(n=1),r===void 0&&(r=!1),this._AvailableFeatures[t]=this._AvailableFeatures[t]||{latest:n},n>this._AvailableFeatures[t].latest&&(this._AvailableFeatures[t].latest=n),r&&(this._AvailableFeatures[t].stable=n),this._AvailableFeatures[t][n]=e},i.ConstructFeature=function(t,e,n,r){e===void 0&&(e=1);var o=this._AvailableFeatures[t][e];if(!o)throw new Error("feature not found");return o(n,r)},i.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},i.GetAvailableVersions=function(t){return Object.keys(this._AvailableFeatures[t])},i.GetLatestVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].latest||-1},i.GetStableVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].stable||-1},i.prototype.attachFeature=function(t){var e=this._features[t];e&&e.enabled&&!e.featureImplementation.attached&&e.featureImplementation.attach()},i.prototype.detachFeature=function(t){var e=this._features[t];e&&e.featureImplementation.attached&&e.featureImplementation.detach()},i.prototype.disableFeature=function(t){var e=typeof t=="string"?t:t.Name,n=this._features[e];return!(!n||!n.enabled)&&(n.enabled=!1,this.detachFeature(e),n.featureImplementation.dispose(),!0)},i.prototype.dispose=function(){var t=this;this.getEnabledFeatures().forEach(function(e){t.disableFeature(e),t._features[e].featureImplementation.dispose()})},i.prototype.enableFeature=function(t,e,n,r,o){var l=this;e===void 0&&(e="latest"),n===void 0&&(n={}),r===void 0&&(r=!0),o===void 0&&(o=!0);var d=typeof t=="string"?t:t.Name,v=0;if(typeof e=="string"){if(!e)throw new Error("Error in provided version - "+d+" ("+e+")");if((v=e==="stable"?i.GetStableVersionOfFeature(d):e==="latest"?i.GetLatestVersionOfFeature(d):+e)===-1||isNaN(v))throw new Error("feature not found - "+d+" ("+e+")")}else v=e;var y=this._features[d],D=i.ConstructFeature(d,v,this._xrSessionManager,n);if(!D)throw new Error("feature not found - "+d);y&&this.disableFeature(d);var w=D();if(w.dependsOn&&!w.dependsOn.every(function(F){return!!l._features[F]}))throw new Error("Dependant features missing. Make sure the following features are enabled - "+w.dependsOn.join(", "));if(w.isCompatible())return this._features[d]={featureImplementation:w,enabled:!0,version:v,required:o},r?this._xrSessionManager.session&&!this._features[d].featureImplementation.attached&&this.attachFeature(d):this._features[d].featureImplementation.disableAutoAttach=!0,this._features[d].featureImplementation;if(o)throw new Error("required feature not compatible");return et.b.Warn("Feature "+d+" not compatible with the current environment/browser and was not enabled."),w},i.prototype.getEnabledFeature=function(t){return this._features[t]&&this._features[t].featureImplementation},i.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},i.prototype.extendXRSessionInitObject=function(t){var e=this;return this.getEnabledFeatures().forEach(function(n){var r=e._features[n],o=r.featureImplementation.xrNativeFeatureName;o&&(r.required?(t.requiredFeatures=t.requiredFeatures||[],t.requiredFeatures.indexOf(o)===-1&&t.requiredFeatures.push(o)):(t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.indexOf(o)===-1&&t.optionalFeatures.push(o)))}),t},i._AvailableFeatures={},i}(),Qy=function(){function i(t){var e=this;this.scene=t,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.onInitialXRPoseSetObservable=new S.c,this.onStateChangedObservable=new S.c,this.state=tr.NOT_IN_XR,this.sessionManager=new Ap(t),this.camera=new Ky("",t,this.sessionManager),this.featuresManager=new li(this.sessionManager),t.onDisposeObservable.add(function(){e.exitXRAsync()})}return i.CreateAsync=function(t){var e=new i(t);return e.sessionManager.initializeAsync().then(function(){return e._supported=!0,e}).catch(function(n){throw e._setState(tr.NOT_IN_XR),e.dispose(),n})},i.prototype.dispose=function(){this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._nonVRCamera&&(this.scene.activeCamera=this._nonVRCamera)},i.prototype.enterXRAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=this.sessionManager.getWebXRRenderTarget()),r===void 0&&(r={}),!this._supported)throw"WebXR not supported in this browser or environment";return this._setState(tr.ENTERING_XR),e!=="viewer"&&e!=="local"&&(r.optionalFeatures=r.optionalFeatures||[],r.optionalFeatures.push(e)),this.featuresManager.extendXRSessionInitObject(r),t==="immersive-ar"&&e!=="unbounded"&&_.a.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode"),this.sessionManager.initializeSessionAsync(t,r).then(function(){return o.sessionManager.setReferenceSpaceTypeAsync(e)}).then(function(){return n.initializeXRLayerAsync(o.sessionManager.session)}).then(function(){return o.sessionManager.updateRenderStateAsync({depthFar:o.camera.maxZ,depthNear:o.camera.minZ,baseLayer:n.xrLayer})}).then(function(){return o.sessionManager.runXRRenderLoop(),o._originalSceneAutoClear=o.scene.autoClear,o._nonVRCamera=o.scene.activeCamera,o.scene.activeCamera=o.camera,t!=="immersive-ar"?o._nonXRToXRCamera():(o.scene.autoClear=!1,o.camera.compensateOnFirstFrame=!1),o.sessionManager.onXRSessionEnded.addOnce(function(){o.camera.rigCameras.forEach(function(l){l.outputRenderTarget=null}),o.scene.autoClear=o._originalSceneAutoClear,o.scene.activeCamera=o._nonVRCamera,t!=="immersive-ar"&&o.camera.compensateOnFirstFrame&&(o._nonVRCamera.setPosition?o._nonVRCamera.setPosition(o.camera.position):o._nonVRCamera.position.copyFrom(o.camera.position)),o._setState(tr.NOT_IN_XR)}),o.sessionManager.onXRFrameObservable.addOnce(function(){o._setState(tr.IN_XR)}),o.sessionManager}).catch(function(l){throw console.log(l),console.log(l.message),o._setState(tr.NOT_IN_XR),l})},i.prototype.exitXRAsync=function(){return this.state!==tr.IN_XR?Promise.resolve():(this._setState(tr.EXITING_XR),this.sessionManager.exitXRAsync())},i.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},i.prototype._setState=function(t){this.state!==t&&(this.state=t,this.onStateChangedObservable.notifyObservers(this.state))},i}(),ys=function(){function i(t,e,n,r){n===void 0&&(n=-1),r===void 0&&(r=[]),this.id=t,this.type=e,this._buttonIndex=n,this._axesIndices=r,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new S.c,this.onButtonStateChangedObservable=new S.c}return Object.defineProperty(i.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pressed",{get:function(){return this._pressed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"touched",{get:function(){return this._touched},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},i.prototype.isAxes=function(){return this._axesIndices.length!==0},i.prototype.isButton=function(){return this._buttonIndex!==-1},i.prototype.update=function(t){var e=!1,n=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var r=t.buttons[this._buttonIndex];if(!r)return;this._currentValue!==r.value&&(this.changes.value={current:r.value,previous:this._currentValue},e=!0,this._currentValue=r.value),this._touched!==r.touched&&(this.changes.touched={current:r.touched,previous:this._touched},e=!0,this._touched=r.touched),this._pressed!==r.pressed&&(this.changes.pressed={current:r.pressed,previous:this._pressed},e=!0,this._pressed=r.pressed)}this.isAxes()&&(this._axes.x!==t.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:t.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=t.axes[this._axesIndices[0]],n=!0),this._axes.y!==t.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=t.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:t.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=t.axes[this._axesIndices[1]],n=!0)),e&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),n&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},i.BUTTON_TYPE="button",i.SQUEEZE_TYPE="squeeze",i.THUMBSTICK_TYPE="thumbstick",i.TOUCHPAD_TYPE="touchpad",i.TRIGGER_TYPE="trigger",i}(),Ts=function(){function i(t,e,n,r,o){var l=this;this.scene=t,this.layout=e,this.gamepadObject=n,this.handedness=r,this._initComponent=function(d){if(d){var v=l.layout.components[d],y=v.type,D=v.gamepadIndices.button,w=[];v.gamepadIndices.xAxis!==void 0&&v.gamepadIndices.yAxis!==void 0&&w.push(v.gamepadIndices.xAxis,v.gamepadIndices.yAxis),l.components[d]=new ys(d,y,D,w)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new S.c,e.components&&Object.keys(e.components).forEach(this._initComponent)}return i.prototype.dispose=function(){var t=this;this.getComponentIds().forEach(function(e){return t.getComponent(e).dispose()}),this.rootMesh&&this.rootMesh.dispose()},i.prototype.getAllComponentsOfType=function(t){var e=this;return this.getComponentIds().map(function(n){return e.components[n]}).filter(function(n){return n.type===t})},i.prototype.getComponent=function(t){return this.components[t]},i.prototype.getComponentIds=function(){return Object.keys(this.components)},i.prototype.getComponentOfType=function(t){return this.getAllComponentsOfType(t)[0]||null},i.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},i.prototype.loadModel=function(){return Object(f.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(f.e)(this,function(r){return t=!this._getModelLoadingConstraints(),e=this._getGenericFilenameAndPath(),t?_.a.Warn("Falling back to generic models"):e=this._getFilenameAndPath(),[2,new Promise(function(o,l){an.ImportMesh("",e.path,e.filename,n.scene,function(d){t?n._getGenericParentMesh(d):n._setRootMesh(d),n._processLoadedModel(d),n._modelReady=!0,n.onModelLoadedObservable.notifyObservers(n),o(!0)},null,function(d,v){_.a.Log(v),_.a.Warn("Failed to retrieve controller model of type "+n.profileId+" from the remote server: "+e.path+e.filename),l(v)})})]})})},i.prototype.updateFromXRFrame=function(t){var e=this;this.getComponentIds().forEach(function(n){return e.getComponent(n).update(e.gamepadObject)}),this.updateModel(t)},Object.defineProperty(i.prototype,"handness",{get:function(){return this.handedness},enumerable:!1,configurable:!0}),i.prototype.pulse=function(t,e,n){return n===void 0&&(n=0),this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[n]?this.gamepadObject.hapticActuators[n].pulse(t,e):Promise.resolve(!1)},i.prototype._getChildByName=function(t,e){return t.getChildren(function(n){return n.name===e},!1)[0]},i.prototype._getImmediateChildByName=function(t,e){return t.getChildren(function(n){return n.name==e},!0)[0]},i.prototype._lerpTransform=function(t,e,n){if(t.minMesh&&t.maxMesh&&t.valueMesh&&t.minMesh.rotationQuaternion&&t.maxMesh.rotationQuaternion&&t.valueMesh.rotationQuaternion){var r=n?.5*e+.5:e;h.b.SlerpToRef(t.minMesh.rotationQuaternion,t.maxMesh.rotationQuaternion,r,t.valueMesh.rotationQuaternion),h.e.LerpToRef(t.minMesh.position,t.maxMesh.position,r,t.valueMesh.position)}},i.prototype.updateModel=function(t){this._modelReady&&this._updateModel(t)},i.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},i.prototype._getGenericParentMesh=function(t){var e=this;this.rootMesh=new Fe.a(this.profileId+" "+this.handedness,this.scene),t.forEach(function(n){n.parent||(n.isPickable=!1,n.setParent(e.rootMesh))}),this.rootMesh.rotationQuaternion=h.b.FromEulerAngles(0,Math.PI,0)},i}(),Qp=function(i){function t(e,n,r){var o=i.call(this,e,SD[r],n,r)||this;return o.profileId=t.ProfileId,o}return Object(f.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){},t.prototype._setRootMesh=function(e){var n=this;this.rootMesh=new Fe.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(r){r.isPickable=!1,r.parent||r.setParent(n.rootMesh)}),this.rootMesh.rotationQuaternion=h.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.ProfileId="generic-trigger",t}(Ts),SD={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},qy=function(i){function t(e,n,r,o){var l=i.call(this,e,r.layouts[n.handedness||"none"],n.gamepad,n.handedness)||this;return l._repositoryUrl=o,l._buttonMeshMapping={},l._touchDots={},l.profileId=r.profileId,l}return Object(f.d)(t,i),t.prototype.dispose=function(){var e=this;i.prototype.dispose.call(this),Object.keys(this._touchDots).forEach(function(n){e._touchDots[n].dispose()})},t.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:this._repositoryUrl+"/profiles/"+this.profileId+"/"}},t.prototype._getModelLoadingConstraints=function(){var e=an.IsPluginForExtensionAvailable(".glb");return e||_.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=n.layout.components[r];n._buttonMeshMapping[r]={mainMesh:n._getChildByName(n.rootMesh,o.rootNodeName),states:{}},Object.keys(o.visualResponses).forEach(function(l){var d=o.visualResponses[l];if(d.valueNodeProperty==="transform")n._buttonMeshMapping[r].states[l]={valueMesh:n._getChildByName(n.rootMesh,d.valueNodeName),minMesh:n._getChildByName(n.rootMesh,d.minNodeName),maxMesh:n._getChildByName(n.rootMesh,d.maxNodeName)};else{var v=o.type===ys.TOUCHPAD_TYPE&&o.touchPointNodeName?o.touchPointNodeName:d.valueNodeName;if(n._buttonMeshMapping[r].states[l]={valueMesh:n._getChildByName(n.rootMesh,v)},o.type===ys.TOUCHPAD_TYPE&&!n._touchDots[l]){var y=jr.a.CreateSphere(l+"dot",{diameter:.0015,segments:8},n.scene);y.material=new rn.a(l+"mat",n.scene),y.material.diffuseColor=C.a.Red(),y.parent=n._buttonMeshMapping[r].states[l].valueMesh||null,y.isVisible=!1,n._touchDots[l]=y}}})})},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Fe.a(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(Te.a.Y,Math.PI,Te.c.WORLD)},t.prototype._updateModel=function(e){var n=this;this.disableAnimation||this.getComponentIds().forEach(function(r){var o=n.getComponent(r);if(o.hasChanges){var l=n._buttonMeshMapping[r],d=n.layout.components[r];Object.keys(d.visualResponses).forEach(function(v){var y=d.visualResponses[v],D=o.value;if(y.componentProperty==="xAxis"?D=o.axes.x:y.componentProperty==="yAxis"&&(D=o.axes.y),y.valueNodeProperty==="transform")n._lerpTransform(l.states[v],D,y.componentProperty!=="button");else{var w=l.states[v].valueMesh;w&&(w.isVisible=o.touched||o.pressed),n._touchDots[v]&&(n._touchDots[v].isVisible=o.touched||o.pressed)}})}})},t}(Ts),zr=function(){function i(){}return i.ClearProfilesCache=function(){this._ProfilesList=null,this._ProfileLoadingPromises={}},i.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"])},i.FindFallbackWithProfileId=function(t){var e=this._Fallbacks[t]||[];return e.unshift(t),e},i.GetMotionControllerWithXRInput=function(t,e,n){var r=this,o=[];if(n&&o.push(n),o.push.apply(o,t.profiles||[]),o.length&&!o[0]&&o.pop(),t.gamepad&&t.gamepad.id)switch(t.gamepad.id){case(t.gamepad.id.match(/oculus touch/gi)?t.gamepad.id:void 0):o.push("oculus-touch-v2")}var l=o.indexOf("windows-mixed-reality");if(l!==-1&&o.splice(l,0,"microsoft-mixed-reality"),o.length||o.push("generic-trigger"),this.UseOnlineRepository){var d=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,v=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return d.call(this,o,t,e).catch(function(){return v.call(r,o,t,e)})}return this._LoadProfilesFromAvailableControllers(o,t,e)},i.RegisterController=function(t,e){this._AvailableControllers[t]=e},i.RegisterFallbacksForProfileId=function(t,e){var n;this._Fallbacks[t]?(n=this._Fallbacks[t]).push.apply(n,e):this._Fallbacks[t]=e},i.UpdateProfilesList=function(){return this._ProfilesList=et.b.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then(function(t){return JSON.parse(t.toString())}),this._ProfilesList},i._LoadProfileFromRepository=function(t,e,n){var r=this;return Promise.resolve().then(function(){return r._ProfilesList?r._ProfilesList:r.UpdateProfilesList()}).then(function(o){for(var l=0;l<t.length;++l)if(t[l]&&o[t[l]])return t[l];throw new Error("neither controller "+t[0]+" nor all fallbacks were found in the repository,")}).then(function(o){return r._ProfileLoadingPromises[o]||(r._ProfileLoadingPromises[o]=et.b.LoadFileAsync(r.BaseRepositoryUrl+"/profiles/"+o+"/profile.json",!1).then(function(l){return JSON.parse(l)})),r._ProfileLoadingPromises[o]}).then(function(o){return new qy(n,e,o,r.BaseRepositoryUrl)})},i._LoadProfilesFromAvailableControllers=function(t,e,n){for(var r=0;r<t.length;++r)if(t[r])for(var o=this.FindFallbackWithProfileId(t[r]),l=0;l<o.length;++l){var d=this._AvailableControllers[o[l]];if(d)return Promise.resolve(d(e,n))}throw new Error("no controller requested was found in the available controllers list")},i._AvailableControllers={},i._Fallbacks={},i._ProfileLoadingPromises={},i.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",i.PrioritizeOnlineRepository=!0,i.UseOnlineRepository=!0,i}();zr.RegisterController(Qp.ProfileId,function(i,t){return new Qp(t,i.gamepad,i.handedness)}),zr.DefaultFallbacks();var xD=0,Zy=function(){function i(t,e,n){var r=this;n===void 0&&(n={}),this._scene=t,this.inputSource=e,this._options=n,this._tmpVector=new h.e,this._disposed=!1,this.onDisposeObservable=new S.c,this.onMeshLoadedObservable=new S.c,this.onMotionControllerInitObservable=new S.c,this._uniqueId="controller-"+xD+++"-"+e.targetRayMode+"-"+e.handedness,this.pointer=new jt.a(this._uniqueId+"-pointer",t),this.pointer.rotationQuaternion=new h.b,this.inputSource.gripSpace&&(this.grip=new jt.a(this._uniqueId+"-grip",this._scene),this.grip.rotationQuaternion=new h.b),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&zr.GetMotionControllerWithXRInput(e,t,this._options.forceControllerProfile).then(function(o){r.motionController=o,r.onMotionControllerInitObservable.notifyObservers(o),r._options.doNotLoadControllerMesh||r.motionController.loadModel().then(function(l){var d;l&&r.motionController&&r.motionController.rootMesh&&(r._options.renderingGroupId&&(r.motionController.rootMesh.renderingGroupId=r._options.renderingGroupId,r.motionController.rootMesh.getChildMeshes(!1).forEach(function(v){return v.renderingGroupId=r._options.renderingGroupId})),r.onMeshLoadedObservable.notifyObservers(r.motionController.rootMesh),r.motionController.rootMesh.parent=r.grip||r.pointer,r.motionController.disableAnimation=!!r._options.disableMotionControllerAnimation),r._disposed&&((d=r.motionController)===null||d===void 0||d.dispose())})},function(){et.b.Warn("Could not find a matching motion controller for the registered input source")})}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.motionController&&this.motionController.dispose(),this.pointer.dispose(),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0},i.prototype.getWorldPointerRayToRef=function(t,e){e===void 0&&(e=!1);var n=e&&this.grip?this.grip:this.pointer;h.e.TransformNormalToRef(this._tmpVector,n.getWorldMatrix(),t.direction),t.direction.normalize(),t.origin.copyFrom(n.absolutePosition),t.length=1e3},i.prototype.updateFromXRFrame=function(t,e){var n=t.getPose(this.inputSource.targetRaySpace,e);if(n){var r=n.transform.position;this.pointer.position.set(r.x,r.y,r.z);var o=n.transform.orientation;this.pointer.rotationQuaternion.set(o.x,o.y,o.z,o.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1)}if(this.inputSource.gripSpace&&this.grip){var l=t.getPose(this.inputSource.gripSpace,e);if(l){r=l.transform.position;var d=l.transform.orientation;this.grip.position.set(r.x,r.y,r.z),this.grip.rotationQuaternion.set(d.x,d.y,d.z,d.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}}this.motionController&&this.motionController.updateFromXRFrame(t)},i}(),$y=function(){function i(t,e,n){var r=this;if(n===void 0&&(n={}),this.xrSessionManager=t,this.xrCamera=e,this.options=n,this.controllers=[],this.onControllerAddedObservable=new S.c,this.onControllerRemovedObservable=new S.c,this._onInputSourcesChange=function(o){r._addAndRemoveControllers(o.added,o.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add(function(){r._addAndRemoveControllers([],r.controllers.map(function(o){return o.inputSource}))}),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add(function(o){o.addEventListener("inputsourceschange",r._onInputSourcesChange)}),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add(function(o){r.controllers.forEach(function(l){l.updateFromXRFrame(o,r.xrSessionManager.referenceSpace)})}),this.options.customControllersRepositoryURL&&(zr.BaseRepositoryUrl=this.options.customControllersRepositoryURL),zr.UseOnlineRepository=!this.options.disableOnlineControllerRepository,zr.UseOnlineRepository)try{zr.UpdateProfilesList().catch(function(){zr.UseOnlineRepository=!1})}catch(o){zr.UseOnlineRepository=!1}}return i.prototype._addAndRemoveControllers=function(t,e){for(var n=this,r=this.controllers.map(function(w){return w.inputSource}),o=0,l=t;o<l.length;o++){var d=l[o];if(r.indexOf(d)===-1){var v=new Zy(this.xrSessionManager.scene,d,Object(f.a)(Object(f.a)({},this.options.controllerOptions||{}),{forceControllerProfile:this.options.forceInputProfile,doNotLoadControllerMesh:this.options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this.options.disableControllerAnimation}));this.controllers.push(v),this.onControllerAddedObservable.notifyObservers(v)}}var y=[],D=[];this.controllers.forEach(function(w){e.indexOf(w.inputSource)===-1?y.push(w):D.push(w)}),this.controllers=y,D.forEach(function(w){n.onControllerRemovedObservable.notifyObservers(w),w.dispose()})},i.prototype.dispose=function(){this.controllers.forEach(function(t){t.dispose()}),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear()},i}(),Ei=function(){function i(t){this._xrSessionManager=t,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this.xrNativeFeatureName=""}return Object.defineProperty(i.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;if(this.isDisposed)return!1;if(t)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,function(n){return e._onXRFrame(n)}),!0},i.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach(function(t){t.observable.remove(t.observer)}),!0):(this.disableAutoAttach=!0,!1)},i.prototype.dispose=function(){this.detach(),this.isDisposed=!0},i.prototype.isCompatible=function(){return!0},i.prototype._addNewAttachObserver=function(t,e){this._removeOnDetach.push({observable:t,observer:t.add(e)})},i}(),rl=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId]){var l=r._generateNewMeshPair(o.pointer),d=l.laserPointer,v=l.selectionMesh;switch(r._controllers[o.uniqueId]={xrController:o,laserPointer:d,selectionMesh:v,meshUnderPointer:null,pick:null,tmpRay:new Qn.a(new h.e,new h.e),id:t._idCounter++},r._attachedController?!r._options.enablePointerSelectionOnAllControllers&&r._options.preferredHandedness&&o.inputSource.handedness===r._options.preferredHandedness&&(r._attachedController=o.uniqueId):r._options.enablePointerSelectionOnAllControllers||(r._attachedController=o.uniqueId),o.inputSource.targetRayMode){case"tracked-pointer":return r._attachTrackedPointerRayMode(o);case"gaze":return r._attachGazeMode(o);case"screen":return r._attachScreenRayMode(o)}}},r._controllers={},r._tmpVectorForPickCompare=new h.e,r.disablePointerLighting=!0,r.disableSelectionMeshLighting=!0,r.displayLaserPointer=!0,r.displaySelectionMesh=!0,r.laserPointerPickedColor=new C.a(.9,.9,.9),r.laserPointerDefaultColor=new C.a(.7,.7,.7),r.selectionMeshDefaultColor=new C.a(.8,.8,.8),r.selectionMeshPickedColor=new C.a(.3,.3,1),r._identityMatrix=h.a.Identity(),r._screenCoordinatesRef=h.e.Zero(),r._viewportRef=new si.a(0,0,0,0),r._scene=r._xrSessionManager.scene,r}return Object(f.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(d){e._detachController(d.uniqueId)}),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){var n=this._options.gazeCamera,r=this._generateNewMeshPair(n),o=r.laserPointer,l=r.selectionMesh;this._controllers.camera={webXRCamera:n,laserPointer:o,selectionMesh:l,meshUnderPointer:null,pick:null,tmpRay:new Qn.a(new h.e,new h.e),id:t._idCounter++},this._attachGazeMode()}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),!0)},t.prototype.getMeshUnderPointer=function(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(e){for(var n=Object.keys(this._controllers),r=0;r<n.length;++r)if(this._controllers[n[r]].id===e)return this._controllers[n[r]].xrController||null;return null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._controllers).forEach(function(r){var o,l=n._controllers[r];if(!n._options.enablePointerSelectionOnAllControllers&&r!==n._attachedController)return l.selectionMesh.isVisible=!1,l.laserPointer.isVisible=!1,void(l.pick=null);if(l.laserPointer.isVisible=n.displayLaserPointer,l.xrController)o=l.xrController.pointer.position,l.xrController.getWorldPointerRayToRef(l.tmpRay);else{if(!l.webXRCamera)return;o=l.webXRCamera.position,l.webXRCamera.getForwardRayToRef(l.tmpRay)}if(n._options.maxPointerDistance&&(l.tmpRay.length=n._options.maxPointerDistance),!n._options.disableScenePointerVectorUpdate&&o){var d=n._xrSessionManager.scene,v=n._options.xrInput.xrCamera;v&&(v.viewport.toGlobalToRef(d.getEngine().getRenderWidth(),d.getEngine().getRenderHeight(),n._viewportRef),h.e.ProjectToRef(o,n._identityMatrix,d.getTransformMatrix(),n._viewportRef,n._screenCoordinatesRef),d.pointerX=n._screenCoordinatesRef.x,d.pointerY=n._screenCoordinatesRef.y)}l.pick=n._scene.pickWithRay(l.tmpRay,n._scene.pointerMovePredicate||n.raySelectionPredicate);var y=l.pick;if(y&&y.pickedPoint&&y.hit){n._updatePointerDistance(l.laserPointer,y.distance),l.selectionMesh.position.copyFrom(y.pickedPoint),l.selectionMesh.scaling.x=Math.sqrt(y.distance),l.selectionMesh.scaling.y=Math.sqrt(y.distance),l.selectionMesh.scaling.z=Math.sqrt(y.distance);var D=n._convertNormalToDirectionOfRay(y.getNormal(!0),l.tmpRay);if(l.selectionMesh.position.copyFrom(y.pickedPoint),D){var w=h.e.Cross(Te.a.Y,D),F=h.e.Cross(D,w);h.e.RotationFromAxisToRef(F,D,w,l.selectionMesh.rotation),l.selectionMesh.position.addInPlace(D.scale(.001))}l.selectionMesh.isVisible=n.displaySelectionMesh,l.meshUnderPointer=y.pickedMesh}else l.selectionMesh.isVisible=!1,n._updatePointerDistance(l.laserPointer,1),l.meshUnderPointer=null})},t.prototype._attachGazeMode=function(e){var n=this,r=this._controllers[e&&e.uniqueId||"camera"],o=this._options.timeToSelect||3e3,l=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Mr.a.DefaultUtilityLayer.utilityLayerScene:this._scene,d=new Pa.a,v=us.CreateTorus("selection",{diameter:.0525,thickness:.015,tessellation:20},l);v.isVisible=!1,v.isPickable=!1,v.parent=r.selectionMesh;var y=0,D=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){if(r.pick){if(r.laserPointer.material.alpha=0,v.isVisible=!1,r.pick.hit)if(n._pickingMoved(d,r.pick))D&&(n._options.disablePointerUpOnTouchOut||n._scene.simulatePointerUp(r.pick,{pointerId:r.id})),D=!1,y=0;else if(y>o/10&&(v.isVisible=!0),(y+=n._scene.getEngine().getDeltaTime())>=o)n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),D=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.isVisible=!1;else{var w=1-y/o;v.scaling.set(w,w,w)}else D=!1,y=0;n._scene.simulatePointerMove(r.pick,{pointerId:r.id}),d=r.pick}}),this._options.renderingGroupId!==void 0&&(v.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce(function(){r.pick&&!n._options.disablePointerUpOnTouchOut&&D&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.dispose()})},t.prototype._attachScreenRayMode=function(e){var n=this,r=this._controllers[e.uniqueId],o=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){!r.pick||n._options.disablePointerUpOnTouchOut&&o||(o?n._scene.simulatePointerMove(r.pick,{pointerId:r.id}):(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),o=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})))}),e.onDisposeObservable.addOnce(function(){r.pick&&o&&!n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})})},t.prototype._attachTrackedPointerRayMode=function(e){var n=this,r=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);if(r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){r.laserPointer.material.disableLighting=n.disablePointerLighting,r.selectionMesh.material.disableLighting=n.disableSelectionMeshLighting,r.pick&&n._scene.simulatePointerMove(r.pick,{pointerId:r.id})}),e.inputSource.gamepad){var o=function(v){n._options.overrideButtonId&&(r.selectionComponent=v.getComponent(n._options.overrideButtonId)),r.selectionComponent||(r.selectionComponent=v.getMainComponent()),r.onButtonChangedObserver=r.selectionComponent.onButtonStateChangedObservable.add(function(y){if(y.changes.pressed){var D=y.changes.pressed.current;r.pick?(n._options.enablePointerSelectionOnAllControllers||e.uniqueId===n._attachedController)&&(D?(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor):(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)):!D||n._options.enablePointerSelectionOnAllControllers||n._options.disableSwitchOnClick||(n._attachedController=e.uniqueId)}})};e.motionController?o(e.motionController):e.onMotionControllerInitObservable.add(o)}else{var l=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor)},d=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)};r.eventListeners={selectend:d,selectstart:l},this._xrSessionManager.session.addEventListener("selectstart",l),this._xrSessionManager.session.addEventListener("selectend",d)}},t.prototype._convertNormalToDirectionOfRay=function(e,n){return e&&Math.acos(h.e.Dot(e,n.direction))<Math.PI/2&&e.scaleInPlace(-1),e},t.prototype._detachController=function(e){var n=this,r=this._controllers[e];if(r&&(r.selectionComponent&&r.onButtonChangedObserver&&r.selectionComponent.onButtonStateChangedObservable.remove(r.onButtonChangedObserver),r.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(r.onFrameObserver),r.eventListeners&&Object.keys(r.eventListeners).forEach(function(l){var d=r.eventListeners&&r.eventListeners[l];d&&n._xrSessionManager.session.removeEventListener(l,d)}),r.selectionMesh.dispose(),r.laserPointer.dispose(),delete this._controllers[e],this._attachedController===e)){var o=Object.keys(this._controllers);o.length?this._attachedController=o[0]:this._attachedController=""}},t.prototype._generateNewMeshPair=function(e){var n=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Mr.a.DefaultUtilityLayer.utilityLayerScene:this._scene,r=Vi.a.CreateCylinder("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},n);r.parent=e;var o=new rn.a("laserPointerMat",n);o.emissiveColor=this.laserPointerDefaultColor,o.alpha=.7,r.material=o,r.rotation.x=Math.PI/2,this._updatePointerDistance(r,1),r.isPickable=!1;var l=us.CreateTorus("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},n);l.bakeCurrentTransformIntoVertices(),l.isPickable=!1,l.isVisible=!1;var d=new rn.a("targetMat",n);return d.specularColor=C.a.Black(),d.emissiveColor=this.selectionMeshDefaultColor,d.backFaceCulling=!1,l.material=d,this._options.renderingGroupId!==void 0&&(r.renderingGroupId=this._options.renderingGroupId,l.renderingGroupId=this._options.renderingGroupId),{laserPointer:r,selectionMesh:l}},t.prototype._pickingMoved=function(e,n){var r;if(!e.hit||!n.hit||!(e.pickedMesh&&e.pickedPoint&&n.pickedMesh&&n.pickedPoint)||e.pickedMesh!==n.pickedMesh)return!0;(r=e.pickedPoint)===null||r===void 0||r.subtractToRef(n.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var o=.01*(this._options.gazeModePointerMovedFactor||1)*n.distance;return this._tmpVectorForPickCompare.length()>o},t.prototype._updatePointerDistance=function(e,n){n===void 0&&(n=100),e.scaling.y=n,this._scene.useRightHandedSystem&&(n*=-1),e.position.z=n/2+.05},Object.defineProperty(t.prototype,"lasterPointerDefaultColor",{get:function(){return this.laserPointerDefaultColor},enumerable:!1,configurable:!0}),t._idCounter=200,t.Name=Ti.POINTER_SELECTION,t.Version=1,t}(Ei);li.AddWebXRFeature(rl.Name,function(i,t){return function(){return new rl(i,t)}},rl.Version,!0);var Go,Jy=function(){function i(t,e,n){this.element=t,this.sessionMode=e,this.referenceSpaceType=n}return i.prototype.update=function(t){},i}(),AD=function(){},e0=function(){function i(t,e){var n=this;if(this.scene=t,this.options=e,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new S.c,this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",typeof window!="undefined"&&window.location&&window.location.protocol==="http:"&&et.b.Warn("WebXR can only be served over HTTPS"),e.customButtons)this._buttons=e.customButtons;else{var r=e.sessionMode||"immersive-vr",o=e.referenceSpaceType||"local-floor",l=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(typeof SVGSVGElement=="undefined"?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";l+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var d=document.createElement("style");d.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(d);var v=document.createElement("button");v.className="babylonVRicon",v.title=r+" - "+o,this._buttons.push(new Jy(v,r,o)),this._buttons[this._buttons.length-1].update=function(D){this.element.style.display=D===null||D===this?"":"none",v.className="babylonVRicon"+(D===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var y=t.getEngine().getInputElement();y&&y.parentNode&&(y.parentNode.appendChild(this.overlay),t.onDisposeObservable.addOnce(function(){n.dispose()}))}return i.CreateAsync=function(t,e,n){var r=this,o=new i(t,n),l=o._buttons.map(function(d){return e.sessionManager.isSessionSupportedAsync(d.sessionMode)});return e.onStateChangedObservable.add(function(d){d==tr.NOT_IN_XR&&o._updateButtons(null)}),Promise.all(l).then(function(d){return d.forEach(function(v,y){v?(o.overlay.appendChild(o._buttons[y].element),o._buttons[y].element.onclick=function(){return Object(f.b)(r,void 0,void 0,function(){var D,w,F;return Object(f.e)(this,function(z){switch(z.label){case 0:return e.state!=tr.IN_XR?[3,2]:[4,e.exitXRAsync()];case 1:return z.sent(),o._updateButtons(null),[3,6];case 2:if(e.state!=tr.NOT_IN_XR)return[3,6];if(!n.renderTarget)return[3,6];z.label=3;case 3:return z.trys.push([3,5,,6]),[4,e.enterXRAsync(o._buttons[y].sessionMode,o._buttons[y].referenceSpaceType,n.renderTarget,{optionalFeatures:n.optionalFeatures,requiredFeatures:n.requiredFeatures})];case 4:return z.sent(),o._updateButtons(o._buttons[y]),[3,6];case 5:return D=z.sent(),o._updateButtons(null),w=o._buttons[y].element,F=w.title,w.title="Error entering XR session : "+F,w.classList.add("xr-error"),n.onError&&n.onError(D),[3,6];case 6:return[2]}})})}):et.b.Warn('Session mode "'+o._buttons[y].sessionMode+'" not supported in browser')}),o})},i.prototype.dispose=function(){var t=this.scene.getEngine().getInputElement();t&&t.parentNode&&t.parentNode.contains(this.overlay)&&t.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear()},i.prototype._updateButtons=function(t){var e=this;this._activeButton=t,this._buttons.forEach(function(n){n.update(e._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},i}();function qp(i){var t,e=0,n=Date.now();i.observableParameters=(t=i.observableParameters)!==null&&t!==void 0?t:{};var r=i.contextObservable.add(function(o){var l=Date.now(),d={startTime:n,currentTime:l,deltaTime:e=l-n,completeRate:e/i.timeout,payload:o};i.onTick&&i.onTick(d),i.breakCondition&&i.breakCondition()&&(i.contextObservable.remove(r),i.onAborted&&i.onAborted(d)),e>=i.timeout&&(i.contextObservable.remove(r),i.onEnded&&i.onEnded(d))},i.observableParameters.mask,i.observableParameters.insertFirst,i.observableParameters.scope);return r}(function(i){i[i.INIT=0]="INIT",i[i.STARTED=1]="STARTED",i[i.ENDED=2]="ENDED"})(Go||(Go={}));var PD=function(){function i(t){var e,n,r=this;this.onEachCountObservable=new S.c,this.onTimerAbortedObservable=new S.c,this.onTimerEndedObservable=new S.c,this.onStateChangedObservable=new S.c,this._observer=null,this._breakOnNextTick=!1,this._tick=function(o){var l=Date.now();r._timer=l-r._startTime;var d={startTime:r._startTime,currentTime:l,deltaTime:r._timer,completeRate:r._timer/r._timeToEnd,payload:o},v=r._breakOnNextTick||r._breakCondition(d);v||r._timer>=r._timeToEnd?r._stop(d,v):r.onEachCountObservable.notifyObservers(d)},this._setState(Go.INIT),this._contextObservable=t.contextObservable,this._observableParameters=(e=t.observableParameters)!==null&&e!==void 0?e:{},this._breakCondition=(n=t.breakCondition)!==null&&n!==void 0?n:function(){return!1},t.onEnded&&this.onTimerEndedObservable.add(t.onEnded),t.onTick&&this.onEachCountObservable.add(t.onTick),t.onAborted&&this.onTimerAbortedObservable.add(t.onAborted)}return Object.defineProperty(i.prototype,"breakCondition",{set:function(t){this._breakCondition=t},enumerable:!1,configurable:!0}),i.prototype.clearObservables=function(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()},i.prototype.start=function(t){if(t===void 0&&(t=this._timeToEnd),this._state===Go.STARTED)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=t,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(Go.STARTED)},i.prototype.stop=function(){this._state===Go.STARTED&&(this._breakOnNextTick=!0)},i.prototype.dispose=function(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()},i.prototype._setState=function(t){this._state=t,this.onStateChangedObservable.notifyObservers(this._state)},i.prototype._stop=function(t,e){e===void 0&&(e=!1),this._contextObservable.remove(this._observer),this._setState(Go.ENDED),e?this.onTimerAbortedObservable.notifyObservers(t):this.onTimerEndedObservable.notifyObservers(t)},i}(),il=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._controllers={},r._snappedToPoint=!1,r._tmpRay=new Qn.a(new h.e,new h.e),r._tmpVector=new h.e,r._tmpQuaternion=new h.b,r.backwardsMovementEnabled=!0,r.backwardsTeleportationDistance=.7,r.parabolicCheckRadius=5,r.parabolicRayEnabled=!0,r.straightRayEnabled=!0,r.rotationAngle=Math.PI/8,r._rotationEnabled=!0,r._attachController=function(o){if(!(r._controllers[o.uniqueId]||r._options.forceHandedness&&o.inputSource.handedness!==r._options.forceHandedness)){r._controllers[o.uniqueId]={xrController:o,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var l=r._controllers[o.uniqueId];if(l.xrController.inputSource.targetRayMode==="tracked-pointer"&&l.xrController.inputSource.gamepad){var d=function(){if(o.motionController){var v=o.motionController.getComponentOfType(ys.THUMBSTICK_TYPE)||o.motionController.getComponentOfType(ys.TOUCHPAD_TYPE);if(!v||r._options.useMainComponentOnly){var y=o.motionController.getMainComponent();if(!y)return;l.teleportationComponent=y,l.onButtonChangedObserver=y.onButtonStateChangedObservable.add(function(){y.changes.pressed&&(y.changes.pressed.current?(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,l.teleportationState.currentRotation=0,qp({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,breakCondition:function(){return!y.pressed},onEnded:function(){r._currentTeleportationControllerId===l.xrController.uniqueId&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):(l.teleportationState.forward=!1,r._currentTeleportationControllerId=""))})}else l.teleportationComponent=v,l.onAxisChangedObserver=v.onAxisValueChangedObservable.add(function(D){if(D.y<=.7&&l.teleportationState.backwards&&(l.teleportationState.backwards=!1),D.y>.7&&!l.teleportationState.forward&&r.backwardsMovementEnabled&&!r.snapPointsOnly&&!l.teleportationState.backwards){l.teleportationState.backwards=!0,r._tmpQuaternion.copyFrom(r._options.xrInput.xrCamera.rotationQuaternion),r._tmpQuaternion.toEulerAnglesToRef(r._tmpVector),r._tmpVector.x=0,r._tmpVector.z=0,h.b.FromEulerVectorToRef(r._tmpVector,r._tmpQuaternion),r._tmpVector.set(0,0,r.backwardsTeleportationDistance*(r._xrSessionManager.scene.useRightHandedSystem?1:-1)),r._tmpVector.rotateByQuaternionToRef(r._tmpQuaternion,r._tmpVector),r._tmpVector.addInPlace(r._options.xrInput.xrCamera.position),r._tmpRay.origin.copyFrom(r._tmpVector),r._tmpRay.length=r._options.xrInput.xrCamera.realWorldHeight+.1,r._tmpRay.direction.set(0,-1,0);var w=r._xrSessionManager.scene.pickWithRay(r._tmpRay,function(z){return r._floorMeshes.indexOf(z)!==-1});w&&w.pickedPoint&&(r._options.xrInput.xrCamera.position.x=w.pickedPoint.x,r._options.xrInput.xrCamera.position.z=w.pickedPoint.z)}if(D.y<-.7&&!r._currentTeleportationControllerId&&!l.teleportationState.rotating&&(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),D.x){if(l.teleportationState.forward)r._currentTeleportationControllerId===l.xrController.uniqueId&&(r.rotationEnabled?setTimeout(function(){l.teleportationState.currentRotation=Math.atan2(D.x,D.y*(r._xrSessionManager.scene.useRightHandedSystem?1:-1))}):l.teleportationState.currentRotation=0);else if(!l.teleportationState.rotating&&Math.abs(D.x)>.7){l.teleportationState.rotating=!0;var F=r.rotationAngle*(D.x>0?1:-1)*(r._xrSessionManager.scene.useRightHandedSystem?-1:1);r._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(h.b.FromEulerAngles(0,F,0))}}else l.teleportationState.rotating=!1;D.x===0&&D.y===0&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)})}};o.motionController?d():o.onMotionControllerInitObservable.addOnce(function(){d()})}else r._xrSessionManager.scene.onPointerObservable.add(function(v){v.type===Ot.a.POINTERDOWN?(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,l.teleportationState.currentRotation=0,qp({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,onEnded:function(){r._currentTeleportationControllerId===l.xrController.uniqueId&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):v.type===Ot.a.POINTERUP&&(l.teleportationState.forward=!1,r._currentTeleportationControllerId="")})}},r._options.teleportationTargetMesh||r._createDefaultTargetMesh(),r._floorMeshes=r._options.floorMeshes||[],r._snapToPositions=r._options.snapPositions||[],r._setTargetMeshVisibility(!1),r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this._rotationEnabled},set:function(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){var n=this._options.teleportationTargetMesh.getChildMeshes(!1,function(r){return r.name==="rotationCone"});n[0]&&n[0].setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTargetMesh",{get:function(){return this._options.teleportationTargetMesh||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(e){this._options.snapPointsOnly=e},enumerable:!1,configurable:!0}),t.prototype.addFloorMesh=function(e){this._floorMeshes.push(e)},t.prototype.addSnapPoint=function(e){this._snapToPositions.push(e)},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(n){e._detachController(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},t.prototype.removeFloorMesh=function(e){var n=this._floorMeshes.indexOf(e);n!==-1&&this._floorMeshes.splice(n,1)},t.prototype.removeFloorMeshByName=function(e){var n=this._xrSessionManager.scene.getMeshByName(e);n&&this.removeFloorMesh(n)},t.prototype.removeSnapPoint=function(e){var n=this._snapToPositions.indexOf(e);if(n===-1){for(var r=0;r<this._snapToPositions.length;++r)if(this._snapToPositions[r].equals(e)){n=r;break}}return n!==-1&&(this._snapToPositions.splice(n,1),!0)},t.prototype.setSelectionFeature=function(e){this._selectionFeature=e},t.prototype._onXRFrame=function(e){var n=this,r=this._xrSessionManager.currentFrame,o=this._xrSessionManager.scene;if(this.attach&&r){var l=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!l)return;l.rotationQuaternion=l.rotationQuaternion||new h.b;var d=this._controllers[this._currentTeleportationControllerId];if(d&&d.teleportationState.forward){h.b.RotationYawPitchRollToRef(d.teleportationState.currentRotation+d.teleportationState.baseRotation,0,0,l.rotationQuaternion);var v=!1;if(d.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){if((y=o.pickWithRay(this._tmpRay,function(z){if(n._options.pickBlockerMeshes&&n._options.pickBlockerMeshes.indexOf(z)!==-1)return!0;var k=n._floorMeshes.indexOf(z);return k!==-1&&n._floorMeshes[k].absolutePosition.y<n._options.xrInput.xrCamera.position.y}))&&y.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(y.pickedMesh)!==-1)return;y&&y.pickedPoint&&(v=!0,this._setTargetMeshPosition(y.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(y))}if(this.parabolicRayEnabled&&!v){var y,D=d.xrController.pointer.rotationQuaternion.toEulerAngles().x,w=Math.PI/2-Math.abs(D)+1,F=this.parabolicCheckRadius*w;if(this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*F),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(F)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize(),(y=o.pickWithRay(this._tmpRay,function(z){return!(!n._options.pickBlockerMeshes||n._options.pickBlockerMeshes.indexOf(z)===-1)||n._floorMeshes.indexOf(z)!==-1}))&&y.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(y.pickedMesh)!==-1)return;y&&y.pickedPoint&&(v=!0,this._setTargetMeshPosition(y.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(y))}this._setTargetMeshVisibility(v)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},t.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||Mr.a.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,n=Vo.CreateGround("teleportationTarget",{width:2,height:2,subdivisions:2},e);n.isPickable=!1;var r=new to.a("teleportationPlaneDynamicTexture",512,e,!0);r.hasAlpha=!0;var o=r.getContext();o.beginPath(),o.arc(256,256,200,0,2*Math.PI,!1),o.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",o.fill(),o.lineWidth=10,o.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",o.stroke(),o.closePath(),r.update();var l=new rn.a("teleportationPlaneMaterial",e);l.diffuseTexture=r,n.material=l;var d=us.CreateTorus("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(d.isPickable=!1,d.parent=n,!this._options.defaultTargetMeshOptions.disableAnimation){var v=new H("animationInnerCircle","position.y",30,H.ANIMATIONTYPE_FLOAT,H.ANIMATIONLOOPMODE_CYCLE),y=[];y.push({frame:0,value:0}),y.push({frame:30,value:.4}),y.push({frame:60,value:0}),v.setKeys(y);var D=new fn;D.setEasingMode(qe.EASINGMODE_EASEINOUT),v.setEasingFunction(D),d.animations=[],d.animations.push(v),e.beginAnimation(d,0,60,!0)}var w=Vi.a.CreateCylinder("rotationCone",{diameterTop:0,tessellation:4},e);if(w.isPickable=!1,w.scaling.set(.5,.12,.2),w.rotate(Te.a.X,Math.PI/2),w.position.z=.6,w.parent=d,this._options.defaultTargetMeshOptions.torusArrowMaterial)d.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,w.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var F=new rn.a("torusConsMat",e);F.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,F.disableLighting?F.emissiveColor=new C.a(.3,.3,1):F.diffuseColor=new C.a(.3,.3,1),F.alpha=.9,d.material=F,w.material=F,this._teleportationRingMaterial=F}this._options.renderingGroupId!==void 0&&(n.renderingGroupId=this._options.renderingGroupId,d.renderingGroupId=this._options.renderingGroupId,w.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=n},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.teleportationComponent&&(n.onAxisChangedObserver&&n.teleportationComponent.onAxisValueChangedObservable.remove(n.onAxisChangedObserver),n.onButtonChangedObserver&&n.teleportationComponent.onButtonStateChangedObservable.remove(n.onButtonChangedObserver)),delete this._controllers[e])},t.prototype._findClosestSnapPointWithRadius=function(e,n){n===void 0&&(n=this._options.snapToPositionRadius||.8);var r=null,o=Number.MAX_VALUE;if(this._snapToPositions.length){var l=n*n;this._snapToPositions.forEach(function(d){var v=h.e.DistanceSquared(d,e);v<=l&&v<o&&(o=v,r=d)})}return r},t.prototype._setTargetMeshPosition=function(e){if(this._options.teleportationTargetMesh){var n=this._findClosestSnapPointWithRadius(e);this._snappedToPoint=!!n,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(n||e),this._options.teleportationTargetMesh.position.y+=.01}},t.prototype._setTargetMeshVisibility=function(e){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==e&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach(function(n){n.isVisible=e}),e?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&this._selectionFeature.attach()))},t.prototype._showParabolicPath=function(e){if(e.pickedPoint){var n=this._controllers[this._currentTeleportationControllerId],r=nt.d.CreateQuadraticBezier(n.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25);this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(r.getPoints()):this._quadraticBezierCurve=Jn.a.CreateLines("teleportation path line",{points:r.getPoints(),instance:this._quadraticBezierCurve,updatable:!0}),this._quadraticBezierCurve.isPickable=!1}},t.prototype._teleportForward=function(e){var n=this._controllers[e];if(n&&n.teleportationState.forward&&(n.teleportationState.forward=!1,this._currentTeleportationControllerId="",(!this.snapPointsOnly||this._snappedToPoint)&&this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible)){var r=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=r,this._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(h.b.FromEulerAngles(0,n.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0)),this._options.xrInput.xrCamera.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}},t.Name=Ti.TELEPORTATION,t.Version=1,t}(Ei);li.AddWebXRFeature(il.Name,function(i,t){return function(){return new il(i,t)}},il.Version,!0);var CD=function(){},t0=function(){function i(){}return i.CreateAsync=function(t,e){e===void 0&&(e={});var n=new i;return Qy.CreateAsync(t).then(function(r){if(n.baseExperience=r,e.ignoreNativeCameraTransformation&&(n.baseExperience.camera.compensateOnFirstFrame=!1),n.input=new $y(r.sessionManager,r.camera,Object(f.a)({controllerOptions:{renderingGroupId:e.renderingGroupId}},e.inputOptions||{})),n.pointerSelection=n.baseExperience.featuresManager.enableFeature(rl.Name,e.useStablePlugins?"stable":"latest",{xrInput:n.input,renderingGroupId:e.renderingGroupId}),e.disableTeleportation||(n.teleportation=n.baseExperience.featuresManager.enableFeature(il.Name,e.useStablePlugins?"stable":"latest",{floorMeshes:e.floorMeshes,xrInput:n.input,renderingGroupId:e.renderingGroupId}),n.teleportation.setSelectionFeature(n.pointerSelection)),n.renderTarget=n.baseExperience.sessionManager.getWebXRRenderTarget(e.outputCanvasOptions),!e.disableDefaultUI){var o=Object(f.a)({renderTarget:n.renderTarget},e.uiOptions||{});return e.optionalFeatures&&(typeof e.optionalFeatures=="boolean"?o.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:o.optionalFeatures=e.optionalFeatures),e0.CreateAsync(t,n.baseExperience,o).then(function(l){n.enterExitUI=l})}}).then(function(){return n}).catch(function(r){return _.a.Error("Error initializing XR"),_.a.Error(r),n})},i.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},i}(),RD=!0;ne.a.prototype.createDefaultLight=function(i){if(i===void 0&&(i=!1),i&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();this.lights.length===0&&new Ku.a("default light",h.e.Up(),this)},ne.a.prototype.createDefaultCamera=function(i,t,e){if(i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var n,r=this.getWorldExtends(function(w){return w.isVisible&&w.isEnabled()}),o=r.max.subtract(r.min),l=r.min.add(o.scale(.5)),d=1.5*o.length();if(isFinite(d)||(d=1,l.copyFromFloats(0,0,0)),i){var v=new Fi("default camera",-Math.PI/2,Math.PI/2,d,l,this);v.lowerRadiusLimit=.01*d,v.wheelPrecision=100/d,n=v}else{var y=new Ar("default camera",new h.e(l.x,l.y,-d),this);y.setTarget(l),n=y}n.minZ=.01*d,n.maxZ=1e3*d,n.speed=.2*d,this.activeCamera=n;var D=this.getEngine().getInputElement();e&&D&&n.attachControl()}},ne.a.prototype.createDefaultCameraOrLight=function(i,t,e){i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),this.createDefaultLight(t),this.createDefaultCamera(i,t,e)},ne.a.prototype.createDefaultSkybox=function(i,t,e,n,r){if(t===void 0&&(t=!1),e===void 0&&(e=1e3),n===void 0&&(n=0),r===void 0&&(r=!0),!i)return _.a.Warn("Can not create default skybox without environment texture."),null;r&&i&&(this.environmentTexture=i);var o=Fe.a.CreateBox("hdrSkyBox",e,this);if(t){var l=new nl("skyBox",this);l.backFaceCulling=!1,l.reflectionTexture=i.clone(),l.reflectionTexture&&(l.reflectionTexture.coordinatesMode=ke.a.SKYBOX_MODE),l.microSurface=1-n,l.disableLighting=!0,l.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=l}else{var d=new rn.a("skyBox",this);d.backFaceCulling=!1,d.reflectionTexture=i.clone(),d.reflectionTexture&&(d.reflectionTexture.coordinatesMode=ke.a.SKYBOX_MODE),d.disableLighting=!0,o.infiniteDistance=!0,o.material=d}return o.isPickable=!1,o},ne.a.prototype.createDefaultEnvironment=function(i){return Gp?new Gp(i,this):null},ne.a.prototype.createDefaultVRExperience=function(i){return i===void 0&&(i={}),new Ey(this,i)},ne.a.prototype.createDefaultXRExperienceAsync=function(i){return i===void 0&&(i={}),t0.CreateAsync(this,i).then(function(t){return t})};var n0=function(i){function t(e,n,r,o,l,d,v){o===void 0&&(o=!1),l===void 0&&(l=!1),d===void 0&&(d=ke.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var y=i.call(this,null,r,!o,l)||this;y._onUserActionRequestedObservable=null,y._stillImageCaptured=!1,y._displayingPosterTexture=!1,y._frameId=-1,y._currentSrc=null,y._createInternalTexture=function(){if(y._texture!=null){if(!y._displayingPosterTexture)return;y._texture.dispose(),y._displayingPosterTexture=!1}if(!y._getEngine().needPOTTextures||et.b.IsExponentOfTwo(y.video.videoWidth)&&et.b.IsExponentOfTwo(y.video.videoHeight)?(y.wrapU=ke.a.WRAP_ADDRESSMODE,y.wrapV=ke.a.WRAP_ADDRESSMODE):(y.wrapU=ke.a.CLAMP_ADDRESSMODE,y.wrapV=ke.a.CLAMP_ADDRESSMODE,y._generateMipMaps=!1),y._texture=y._getEngine().createDynamicTexture(y.video.videoWidth,y.video.videoHeight,y._generateMipMaps,y.samplingMode),y.video.autoplay||y._settings.poster)y._texture.isReady=!0,y._updateInternalTexture(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y);else{var w=y.video.onplaying,F=!1,z=y.video.muted;y.video.muted=!0,y.video.onplaying=function(){y.video.muted=z,y.video.onplaying=w,y._texture.isReady=!0,y._updateInternalTexture(),F||y.video.pause(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y)};var k=y.video.play();k?k.then(function(){}).catch(function(){F=!0,y._onUserActionRequestedObservable&&y._onUserActionRequestedObservable.hasObservers()&&y._onUserActionRequestedObservable.notifyObservers(y)}):(y.video.onplaying=w,y._texture.isReady=!0,y._updateInternalTexture(),y.onLoadObservable.hasObservers()&&y.onLoadObservable.notifyObservers(y))}},y.reset=function(){y._texture!=null&&(y._displayingPosterTexture||(y._texture.dispose(),y._texture=null))},y._updateInternalTexture=function(){if(y._texture!=null&&y._texture.isReady&&!(y.video.readyState<y.video.HAVE_CURRENT_DATA||y._displayingPosterTexture)){var w=y.getScene().getFrameId();y._frameId!==w&&(y._frameId=w,y._getEngine().updateVideoTexture(y._texture,y.video,y._invertY))}},y._generateMipMaps=o,y._initialSamplingMode=d,y.autoUpdateTexture=v.autoUpdateTexture,y._currentSrc=n,y.name=e||y._getName(n),y.video=y._getVideo(n),y._settings=v,v.poster&&(y.video.poster=v.poster),v.autoPlay!==void 0&&(y.video.autoplay=v.autoPlay),v.loop!==void 0&&(y.video.loop=v.loop),v.muted!==void 0&&(y.video.muted=v.muted),y.video.setAttribute("playsinline",""),y.video.addEventListener("paused",y._updateInternalTexture),y.video.addEventListener("seeked",y._updateInternalTexture),y.video.addEventListener("emptied",y.reset),y._createInternalTextureOnEvent=v.poster&&!v.autoPlay?"play":"canplay",y.video.addEventListener(y._createInternalTextureOnEvent,y._createInternalTexture),v.autoPlay&&y.video.play();var D=y.video.readyState>=y.video.HAVE_CURRENT_DATA;return!v.poster||v.autoPlay&&D?D&&y._createInternalTexture():(y._texture=y._getEngine().createTexture(v.poster,!1,!y.invertY,r),y._displayingPosterTexture=!0),y}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new S.c),this._onUserActionRequestedObservable},enumerable:!1,configurable:!0}),t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:typeof e=="object"?e.toString():e},t.prototype._getVideo=function(e){if(e instanceof HTMLVideoElement)return et.b.SetCorsBehavior(e.currentSrc,e),e;var n=document.createElement("video");return typeof e=="string"?(et.b.SetCorsBehavior(e,n),n.src=e):(et.b.SetCorsBehavior(e[0],n),e.forEach(function(r){var o=document.createElement("source");o.src=r,n.appendChild(o)})),n},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e,this._currentSrc=e},t.prototype.clone=function(){return new t(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(e,n){var r=document.createElement("video");return e.getEngine()._badOS&&(document.body.appendChild(r),r.style.transform="scale(0.0001, 0.0001)",r.style.opacity="0",r.style.position="fixed",r.style.bottom="0px",r.style.right="0px"),r.setAttribute("autoplay",""),r.setAttribute("muted","true"),r.setAttribute("playsinline",""),r.muted=!0,r.mozSrcObject!==void 0?r.mozSrcObject=n:typeof r.srcObject=="object"?r.srcObject=n:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.src=window.URL&&window.URL.createObjectURL(n)),new Promise(function(o){var l=function(){o(new t("video",r,e,!0,!0)),r.removeEventListener("playing",l)};r.addEventListener("playing",l),r.play()})},t.CreateFromWebCamAsync=function(e,n,r){var o,l=this;return r===void 0&&(r=!1),n&&n.deviceId&&(o={exact:n.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:n,audio:r}).then(function(d){return l.CreateFromStreamAsync(e,d)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:o,width:{min:n&&n.minWidth||256,max:n&&n.maxWidth||640},height:{min:n&&n.minHeight||256,max:n&&n.maxHeight||480}},audio:r},function(d){return l.CreateFromStreamAsync(e,d)},function(d){_.a.Error(d.name)}),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(e,n,r,o){o===void 0&&(o=!1),this.CreateFromWebCamAsync(e,r,o).then(function(l){n&&n(l)}).catch(function(l){_.a.Error(l.name)})},t}(ke.a),OD=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this,l={loop:r.loop,autoPlay:r.autoPlay,autoUpdateTexture:!0,poster:r.poster},d=new n0((this.name||"videoDome")+"_texture",e,n,r.generateMipMaps,this._useDirectMapping,ke.a.TRILINEAR_SAMPLINGMODE,l);return r.clickToPlay&&(n.onPointerUp=function(){o._texture.video.play()}),d},t.MODE_MONOSCOPIC=jo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=jo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=jo.MODE_SIDEBYSIDE,t}(jo),$r=c(55),MD=function(){function i(t){this.engine=t,this._captureGPUFrameTime=!1,this._gpuFrameTime=new $r.a,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new $r.a,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(i.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(t){var e=this;t!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=t,t?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){e._gpuFrameTimeToken||(e._gpuFrameTimeToken=e.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(e._gpuFrameTimeToken){var n=e.engine.endTimeQuery(e._gpuFrameTimeToken);n>-1&&(e._gpuFrameTimeToken=null,e._gpuFrameTime.fetchNewFrame(),e._gpuFrameTime.addCount(n,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(t){var e=this;t!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=t,t?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){e._shaderCompilationTime.fetchNewFrame(),e._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){e._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},i}(),ID=function(){function i(t){var e=this;this.scene=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new $r.a,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new $r.a,this._captureFrameTime=!1,this._frameTime=new $r.a,this._captureRenderTime=!1,this._renderTime=new $r.a,this._captureInterFrameTime=!1,this._interFrameTime=new $r.a,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new $r.a,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new $r.a,this._capturePhysicsTime=!1,this._physicsTime=new $r.a,this._captureAnimationsTime=!1,this._animationsTime=new $r.a,this._captureCameraRenderTime=!1,this._cameraRenderTime=new $r.a,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add(function(){e._captureActiveMeshesEvaluationTime&&e._activeMeshesEvaluationTime.fetchNewFrame(),e._captureRenderTargetsRenderTime&&e._renderTargetsRenderTime.fetchNewFrame(),e._captureFrameTime&&(et.b.StartPerformanceCounter("Scene rendering"),e._frameTime.beginMonitoring()),e._captureInterFrameTime&&e._interFrameTime.endMonitoring(),e._captureParticlesRenderTime&&e._particlesRenderTime.fetchNewFrame(),e._captureSpritesRenderTime&&e._spritesRenderTime.fetchNewFrame(),e._captureAnimationsTime&&e._animationsTime.beginMonitoring(),e.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=t.onAfterRenderObservable.add(function(){e._captureFrameTime&&(et.b.EndPerformanceCounter("Scene rendering"),e._frameTime.endMonitoring()),e._captureRenderTime&&e._renderTime.endMonitoring(!1),e._captureInterFrameTime&&e._interFrameTime.beginMonitoring()})}return Object.defineProperty(i.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(t){var e=this;t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){et.b.StartPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){et.b.EndPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(t){var e=this;t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){et.b.StartPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){et.b.EndPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(t){var e=this;t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){et.b.StartPerformanceCounter("Particles"),e._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){et.b.EndPerformanceCounter("Particles"),e._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(t){var e=this;t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.scene.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){et.b.StartPerformanceCounter("Sprites"),e._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){et.b.EndPerformanceCounter("Sprites"),e._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(t){var e=this;t!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){et.b.StartPerformanceCounter("Physics"),e._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){et.b.EndPerformanceCounter("Physics"),e._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(t){var e=this;t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){e._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(t){this._captureFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(t){this._captureInterFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var e=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){e._renderTime.beginMonitoring(),et.b.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){e._renderTime.endMonitoring(!1),et.b.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(t){var e=this;t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(n){e._cameraRenderTime.beginMonitoring(),et.b.StartPerformanceCounter("Rendering camera "+n.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(n){e._cameraRenderTime.endMonitoring(!1),et.b.EndPerformanceCounter("Rendering camera "+n.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},i}(),DD=`#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform sampler2D opacitySampler;
uniform float opacityIntensity;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
#ifdef VERTEXALPHA
varying vec4 vColor;
#endif
uniform vec4 glowColor;
void main(void)
{
vec4 finalColor=glowColor;

#ifdef DIFFUSE
vec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);
#ifdef GLOW

finalColor.a*=albedoTexture.a;
#endif
#ifdef HIGHLIGHT

finalColor.a=albedoTexture.a;
#endif
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vUVOpacity);
#ifdef OPACITYRGB
finalColor.a*=getLuminance(opacityMap.rgb);
#else
finalColor.a*=opacityMap.a;
#endif
finalColor.a*=opacityIntensity;
#endif
#ifdef VERTEXALPHA
finalColor.a*=vColor.a;
#endif
#ifdef ALPHATEST
if (finalColor.a<ALPHATESTVALUE)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;
#else
gl_FragColor=finalColor;
#endif
#ifdef HIGHLIGHT

gl_FragColor.a=glowColor.a;
#endif
}`;Qe.a.ShadersStore.glowMapGenerationPixelShader=DD;var wD=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform mat4 opacityMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
#ifdef VERTEXALPHA
attribute vec4 color;
varying vec4 vColor;
#endif
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef DIFFUSE
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef OPACITY
#ifdef OPACITYUV1
vUVOpacity=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef OPACITYUV2
vUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef VERTEXALPHA
vColor=color;
#endif
}`;Qe.a.ShadersStore.glowMapGenerationVertexShader=wD;var ol=function(){function i(t,e){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new C.b},this.neutralColor=new C.b,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new S.c,this.onBeforeRenderMainTextureObservable=new S.c,this.onBeforeComposeObservable=new S.c,this.onBeforeRenderMeshToEffect=new S.c,this.onAfterRenderMeshToEffect=new S.c,this.onAfterComposeObservable=new S.c,this.onSizeChangedObservable=new S.c,this.name=t,this._scene=e||re.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(i.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(t){this._effectLayerOptions.renderingGroupId=t},enumerable:!1,configurable:!0}),i.prototype._init=function(t){this._effectLayerOptions=Object(f.a)({mainTextureRatio:.5,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},t),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},i.prototype._generateIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._engine.createIndexBuffer(t)},i.prototype._generateVertexBuffer=function(){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1);var e=new De.b(this._engine,t,De.b.PositionKind,!1,!1,2);this._vertexBuffers[De.b.PositionKind]=e},i.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?He.a.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?He.a.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},i.prototype._createMainTexture=function(){var t=this;this._mainTexture=new qn("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(n,r,o,l){var d;t.onBeforeRenderMainTextureObservable.notifyObservers(t);var v=t._scene.getEngine();if(l.length){for(v.setColorWrite(!1),d=0;d<l.length;d++)t._renderSubMesh(l.data[d]);v.setColorWrite(!0)}for(d=0;d<n.length;d++)t._renderSubMesh(n.data[d]);for(d=0;d<r.length;d++)t._renderSubMesh(r.data[d]);var y=v.getAlphaMode();for(d=0;d<o.length;d++)t._renderSubMesh(o.data[d],!0);v.setAlphaMode(y)},this._mainTexture.onClearObservable.add(function(n){n.clear(t.neutralColor,!0,!0,!0)});var e=this._scene.getBoundingBoxRenderer().enabled;this._mainTexture.onBeforeBindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=!t.disableBoundingBoxesFromEffectLayer&&e}),this._mainTexture.onAfterUnbindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=e})},i.prototype._addCustomEffectDefines=function(t){},i.prototype._isReady=function(t,e,n){var r=t.getMaterial();if(!r||!r.isReadyForSubMesh(t.getMesh(),t,e))return!1;var o=[],l=[De.b.PositionKind],d=t.getMesh(),v=!1,y=!1;if(r){var D=r.needAlphaTesting(),w=r.getAlphaTestTexture(),F=w&&w.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);w&&(D||F)&&(o.push("#define DIFFUSE"),d.isVerticesDataPresent(De.b.UV2Kind)&&w.coordinatesIndex===1?(o.push("#define DIFFUSEUV2"),y=!0):d.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define DIFFUSEUV1"),v=!0),D&&(o.push("#define ALPHATEST"),o.push("#define ALPHATESTVALUE 0.4")));var z=r.opacityTexture;z&&(o.push("#define OPACITY"),d.isVerticesDataPresent(De.b.UV2Kind)&&z.coordinatesIndex===1?(o.push("#define OPACITYUV2"),y=!0):d.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define OPACITYUV1"),v=!0))}n&&(o.push("#define EMISSIVE"),d.isVerticesDataPresent(De.b.UV2Kind)&&n.coordinatesIndex===1?(o.push("#define EMISSIVEUV2"),y=!0):d.isVerticesDataPresent(De.b.UVKind)&&(o.push("#define EMISSIVEUV1"),v=!0)),d.isVerticesDataPresent(De.b.ColorKind)&&d.hasVertexAlpha&&(l.push(De.b.ColorKind),o.push("#define VERTEXALPHA")),v&&(l.push(De.b.UVKind),o.push("#define UV1")),y&&(l.push(De.b.UV2Kind),o.push("#define UV2"));var k=new _s.a;if(d.useBones&&d.computeBonesUsingShaders){l.push(De.b.MatricesIndicesKind),l.push(De.b.MatricesWeightsKind),d.numBoneInfluencers>4&&(l.push(De.b.MatricesIndicesExtraKind),l.push(De.b.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+d.numBoneInfluencers);var K=d.skeleton;K&&K.isUsingTextureForMatrices?o.push("#define BONETEXTURE"):o.push("#define BonesPerMesh "+(K?K.bones.length+1:0)),d.numBoneInfluencers>0&&k.addCPUSkinningFallback(0,d)}else o.push("#define NUM_BONE_INFLUENCERS 0");var ae=d.morphTargetManager,le=0;ae&&ae.numInfluencers>0&&(o.push("#define MORPHTARGETS"),le=ae.numInfluencers,o.push("#define NUM_MORPH_INFLUENCERS "+le),lt.a.PrepareAttributesForMorphTargetsInfluencers(l,d,le)),e&&(o.push("#define INSTANCES"),lt.a.PushAttributesForInstances(l),t.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),this._addCustomEffectDefines(o);var fe=o.join(`
`);return this._cachedDefines!==fe&&(this._cachedDefines=fe,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",l,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler"],fe,k,void 0,void 0,{maxSimultaneousMorphTargets:le})),this._effectLayerMapGenerationEffect.isReady()},i.prototype.render=function(){var t=this._mergeEffect;if(t.isReady()){for(var e=0;e<this._postProcesses.length;e++)if(!this._postProcesses[e].isReady())return;var n=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),n.enableEffect(t),n.setState(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,t);var r=n.getAlphaMode();n.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(t),n.setAlphaMode(r),this.onAfterComposeObservable.notifyObservers(this);var o=this._mainTexture.getSize();this._setMainTextureSize(),o.width===this._mainTextureDesiredSize.width&&o.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},i.prototype.hasMesh=function(t){return this.renderingGroupId===-1||t.renderingGroupId===this.renderingGroupId},i.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},i.prototype._shouldRenderMesh=function(t){return!0},i.prototype._canRenderMesh=function(t,e){return!e.needAlphaBlendingForMesh(t)},i.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},i.prototype._renderSubMesh=function(t,e){var n,r=this;if(e===void 0&&(e=!1),this.shouldRender()){var o=t.getMaterial(),l=t.getMesh(),d=t.getReplacementMesh(),v=t.getRenderingMesh(),y=t.getEffectiveMesh(),D=this._scene,w=D.getEngine();if(y._internalAbstractMeshDataInfo._isActiveIntermediate=!1,o&&this._canRenderMesh(v,o)){var F=(n=v.overrideMaterialSideOrientation)!==null&&n!==void 0?n:o.sideOrientation;v._getWorldMatrixDeterminant()<0&&(F=F===pn.a.ClockWiseSideOrientation?pn.a.CounterClockWiseSideOrientation:pn.a.ClockWiseSideOrientation);var z=F===pn.a.ClockWiseSideOrientation;w.setState(o.backFaceCulling,o.zOffset,void 0,z);var k=v._getInstancesRenderList(t._id,!!d);if(!k.mustReturn&&this._shouldRenderMesh(v)){var K=k.hardwareInstancedRendering[t._id]||v.hasThinInstances;if(this._setEmissiveTextureAndColor(v,t,o),this.onBeforeRenderMeshToEffect.notifyObservers(l),this._useMeshMaterial(v))v.render(t,K,d||void 0);else if(this._isReady(t,K,this._emissiveTextureAndColor.texture)){w.enableEffect(this._effectLayerMapGenerationEffect),v._bind(t,this._effectLayerMapGenerationEffect,pn.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",D.getTransformMatrix()),this._effectLayerMapGenerationEffect.setMatrix("world",y.getWorldMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var ae=o.needAlphaTesting(),le=o.getAlphaTestTexture(),fe=le&&le.hasAlpha&&(o.useAlphaFromDiffuseTexture||o._useAlphaFromAlbedoTexture);le&&(ae||fe)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",le),(me=le.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",me));var me,be=o.opacityTexture;if(be&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",be),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",be.level),(me=be.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",me)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),v.useBones&&v.computeBonesUsingShaders&&v.skeleton){var Ee=v.skeleton;if(Ee.isUsingTextureForMatrices){var xe=Ee.getTransformMatrixTexture(v);if(!xe)return;this._effectLayerMapGenerationEffect.setTexture("boneSampler",xe),this._effectLayerMapGenerationEffect.setFloat("boneTextureWidth",4*(Ee.bones.length+1))}else this._effectLayerMapGenerationEffect.setMatrices("mBones",Ee.getTransformMatrices(v))}lt.a.BindMorphTargetParameters(v,this._effectLayerMapGenerationEffect),e&&w.setAlphaMode(o.alphaMode),v._processRendering(y,t,this._effectLayerMapGenerationEffect,o.fillMode,k,K,function(Ae,Ie){return r._effectLayerMapGenerationEffect.setMatrix("world",Ie)})}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(l)}}}},i.prototype._useMeshMaterial=function(t){return!1},i.prototype._rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._generateIndexBuffer()},i.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var t=0;t<this._postProcesses.length;t++)this._postProcesses[t]&&this._postProcesses[t].dispose();for(this._postProcesses=[],t=0;t<this._textures.length;t++)this._textures[t]&&this._textures[t].dispose();this._textures=[]},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var e=this._scene.effectLayers.indexOf(this,0);e>-1&&this._scene.effectLayers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},i.prototype.getClassName=function(){return"EffectLayer"},i.Parse=function(t,e,n){return et.b.Instantiate(t.customType).Parse(t,e,n)},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("EffectLayerSceneComponent")},Object(f.c)([Object(B.c)()],i.prototype,"name",void 0),Object(f.c)([Object(B.f)()],i.prototype,"neutralColor",void 0),Object(f.c)([Object(B.c)()],i.prototype,"isEnabled",void 0),Object(f.c)([Object(B.d)()],i.prototype,"camera",null),Object(f.c)([Object(B.c)()],i.prototype,"renderingGroupId",null),Object(f.c)([Object(B.c)()],i.prototype,"disableBoundingBoxesFromEffectLayer",void 0),i}();E.a.AddParser(dt.a.NAME_EFFECTLAYER,function(i,t,e,n){if(i.effectLayers){e.effectLayers||(e.effectLayers=new Array);for(var r=0;r<i.effectLayers.length;r++){var o=ol.Parse(i.effectLayers[r],t,n);e.effectLayers.push(o)}}}),E.a.prototype.removeEffectLayer=function(i){var t=this.effectLayers.indexOf(i);return t!==-1&&this.effectLayers.splice(t,1),t},E.a.prototype.addEffectLayer=function(i){this.effectLayers.push(i)};var r0=function(){function i(t){this.name=dt.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=t,this._engine=t.getEngine(),t.effectLayers=new Array}return i.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(dt.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(dt.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(dt.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.effectLayers;t<e.length;t++)e[t]._rebuild()},i.prototype.serialize=function(t){t.effectLayers=[];for(var e=0,n=this.scene.effectLayers;e<n.length;e++){var r=n[e];r.serialize&&t.effectLayers.push(r.serialize())}},i.prototype.addFromContainer=function(t){var e=this;t.effectLayers&&t.effectLayers.forEach(function(n){e.scene.addEffectLayer(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.effectLayers&&t.effectLayers.forEach(function(r){n.scene.removeEffectLayer(r),e&&r.dispose()})},i.prototype.dispose=function(){for(var t=this.scene.effectLayers;t.length;)t[0].dispose()},i.prototype._isReadyForMesh=function(t,e){for(var n=0,r=this.scene.effectLayers;n<r.length;n++){var o=r[n];if(o.hasMesh(t))for(var l=0,d=t.subMeshes;l<d.length;l++){var v=d[l];if(!o.isReady(v,e))return!1}}return!0},i.prototype._renderMainTexture=function(t){this._renderEffects=!1,this._needStencil=!1;var e=!1,n=this.scene.effectLayers;if(n&&n.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,o=n;r<o.length;r++){var l=o[r];if(l.shouldRender()&&(!l.camera||l.camera.cameraRigMode===Pt.a.RIG_MODE_NONE&&t===l.camera||l.camera.cameraRigMode!==Pt.a.RIG_MODE_NONE&&l.camera._rigCameras.indexOf(t)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||l.needStencil();var d=l._mainTexture;d._shouldRender()&&(this.scene.incrementRenderId(),d.render(!1,!1),e=!0)}}this.scene.incrementRenderId()}return e},i.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},i.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},i.prototype._draw=function(t){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var e=this.scene.effectLayers,n=0;n<e.length;n++){var r=e[n];r.renderingGroupId===t&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},i.prototype._drawRenderingGroup=function(t){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(t)},i}();ol._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_EFFECTLAYER);t||(t=new r0(i),i._addComponent(t))};var LD=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`;Qe.a.ShadersStore.glowMapMergePixelShader=LD;var ND=`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.glowMapMergeVertexShader=ND,E.a.prototype.getGlowLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===fh.EffectName)return this.effectLayers[t];return null};var fh=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o._intensity=1,o._includedOnlyMeshes=[],o._excludedMeshes=[],o._meshesUsingTheirOwnMaterials=[],o.neutralColor=new C.b(0,0,0,1),o._options=Object(f.a)({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},r),o._init({alphaBlendingMode:g.a.ALPHA_ADD,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[De.b.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width,r=this._mainTextureDesiredSize.height;n=this._engine.needPOTTextures?He.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?He.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new qn("GlowLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture1.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var l=Math.floor(n/2),d=Math.floor(r/2);this._blurTexture2=new qn("GlowLayerBlurRTT2",{width:l,height:d},this._scene,!1,!0,o),this._blurTexture2.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new ar("GlowLayerHBP1",new h.d(1,0),this._options.blurKernelSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess1.width=n,this._horizontalBlurPostprocess1.height=r,this._horizontalBlurPostprocess1.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess1=new ar("GlowLayerVBP1",new h.d(0,1),this._options.blurKernelSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2=new ar("GlowLayerHBP2",new h.d(1,0),this._options.blurKernelSize/2,{width:l,height:d},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2.width=l,this._horizontalBlurPostprocess2.height=d,this._horizontalBlurPostprocess2.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._blurTexture1)}),this._verticalBlurPostprocess2=new ar("GlowLayerVBP2",new h.d(0,1),this._options.blurKernelSize/2,{width:l,height:d},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var v=e._blurTexture1.getInternalTexture();if(v){e._scene.postProcessManager.directRender(e._postProcesses1,v,!0);var y=e._blurTexture2.getInternalTexture();y&&e._scene.postProcessManager.directRender(e._postProcesses2,y,!0),e._engine.unBindFramebuffer(y??v,!0)}}),this._postProcesses.map(function(v){v.autoClear=!1})},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o)return!1;var l=r.emissiveTexture;return i.prototype._isReady.call(this,e,n,l)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var n=this._engine,r=n.getStencilBuffer();n.setStencilBuffer(!1),n.drawElementsType(pn.a.TriangleFillMode,0,6),n.setStencilBuffer(r)},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,n,r):r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.texture&&(o=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,n,r,this._emissiveTextureAndColor.color):r.emissiveColor?this._emissiveTextureAndColor.color.set(r.emissiveColor.r*o,r.emissiveColor.g*o,r.emissiveColor.b*o,r.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){this._excludedMeshes.indexOf(e.uniqueId)===-1&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var n=this._excludedMeshes.indexOf(e.uniqueId);n!==-1&&this._excludedMeshes.splice(n,1)},t.prototype.addIncludedOnlyMesh=function(e){this._includedOnlyMeshes.indexOf(e.uniqueId)===-1&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var n=this._includedOnlyMeshes.indexOf(e.uniqueId);n!==-1&&this._includedOnlyMeshes.splice(n,1)},t.prototype.hasMesh=function(e){return!!i.prototype.hasMesh.call(this,e)&&(this._includedOnlyMeshes.length?this._includedOnlyMeshes.indexOf(e.uniqueId)!==-1:!this._excludedMeshes.length||this._excludedMeshes.indexOf(e.uniqueId)===-1)},t.prototype._useMeshMaterial=function(e){return this._meshesUsingTheirOwnMaterials.length!=0&&this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)>-1},t.prototype.referenceMeshToUseItsOwnMaterial=function(e){this._meshesUsingTheirOwnMaterials.push(e.uniqueId)},t.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(e){for(var n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);n>=0;)this._meshesUsingTheirOwnMaterials.splice(n,1),n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,n=B.a.Serialize(this);if(n.customType="BABYLON.GlowLayer",n.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++)(r=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&n.includedMeshes.push(r.id);if(n.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var r;(r=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&n.excludedMeshes.push(r.id)}return n},t.Parse=function(e,n,r){var o,l=B.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(d=n.getMeshByID(e.excludedMeshes[o]))&&l.addExcludedMesh(d);for(o=0;o<e.includedMeshes.length;o++){var d;(d=n.getMeshByID(e.includedMeshes[o]))&&l.addIncludedOnlyMesh(d)}return l},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,Object(f.c)([Object(B.c)()],t.prototype,"blurKernelSize",null),Object(f.c)([Object(B.c)()],t.prototype,"intensity",null),Object(f.c)([Object(B.c)("options")],t.prototype,"_options",void 0),t}(ol);R.a.RegisteredTypes["BABYLON.GlowLayer"]=fh;var FD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`;Qe.a.ShadersStore.glowBlurPostProcessPixelShader=FD,E.a.prototype.getHighlightLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===Zp.EffectName)return this.effectLayers[t];return null};var i0=function(i){function t(e,n,r,o,l,d,v,y){d===void 0&&(d=ke.a.BILINEAR_SAMPLINGMODE);var D=i.call(this,e,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,o,l,d,v,y)||this;return D.direction=n,D.kernel=r,D.onApplyObservable.add(function(w){w.setFloat2("screenSize",D.width,D.height),w.setVector2("direction",D.direction),w.setFloat("blurWidth",D.kernel)}),D}return Object(f.d)(t,i),t}(St),Zp=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o.name=e,o.innerGlow=!0,o.outerGlow=!0,o.onBeforeBlurObservable=new S.c,o.onAfterBlurObservable=new S.c,o._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,o._meshes={},o._excludedMeshes={},o.neutralColor=t.NeutralColor,o._engine.isStencilEnable||_.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),o._options=Object(f.a)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},r),o._init({alphaBlendingMode:o._options.alphaBlendingMode,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o._shouldRender=!1,o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[De.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,r=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?He.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?He.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new qn("HighlightLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(ke.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===g.a.ALPHA_COMBINE?(this._downSamplePostprocess=new Bo("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",e._mainTexture)}),this._horizontalBlurPostprocess=new i0("HighlightLayerHBP",new h.d(1,0),this._options.blurHorizontalSize,1,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,r)}),this._verticalBlurPostprocess=new i0("HighlightLayerVBP",new h.d(0,1),this._options.blurVerticalSize,1,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,r)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new ar("HighlightLayerHBP",new h.d(1,0),this._options.blurHorizontalSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess.width=n,this._horizontalBlurPostprocess.height=r,this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess=new ar("HighlightLayerVBP",new h.d(0,1),this._options.blurVerticalSize/2,{width:n,height:r},null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){e.onBeforeBlurObservable.notifyObservers(e);var l=e._blurTexture.getInternalTexture();l&&(e._scene.postProcessManager.directRender(e._postProcesses,l,!0),e._engine.unBindFramebuffer(l,!0)),e.onAfterBlurObservable.notifyObservers(e)}),this._postProcesses.map(function(l){l.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o||!this._meshes)return!1;var l=null,d=this._meshes[o.uniqueId];return d&&d.glowEmissiveOnly&&r&&(l=r.emissiveTexture),i.prototype._isReady.call(this,e,n,l)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var n=this._engine;n.cacheStencilState(),n.setStencilOperationPass(g.a.REPLACE),n.setStencilOperationFail(g.a.KEEP),n.setStencilOperationDepthFail(g.a.KEEP),n.setStencilMask(0),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),n.setStencilFunction(g.a.NOTEQUAL),n.drawElementsType(pn.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),n.setStencilFunction(g.a.EQUAL),n.drawElementsType(pn.a.TriangleFillMode,0,6)),n.restoreStencilState()},t.prototype.shouldRender=function(){return!!i.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(e){return(!this._excludedMeshes||!this._excludedMeshes[e.uniqueId])&&!!i.prototype.hasMesh.call(this,e)},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._addCustomEffectDefines=function(e){e.push("#define HIGHLIGHT")},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=this._meshes[e.uniqueId];o?this._emissiveTextureAndColor.color.set(o.color.r,o.color.g,o.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),o&&o.glowEmissiveOnly&&r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add(function(n){n.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(n){n.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var n=this._excludedMeshes[e.uniqueId];n&&(n.beforeBind&&e.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&e.onAfterRenderObservable.remove(n.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(e){return!!this._meshes&&!!i.prototype.hasMesh.call(this,e)&&this._meshes[e.uniqueId]!==void 0&&this._meshes[e.uniqueId]!==null},t.prototype.addMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),this._meshes){var l=this._meshes[e.uniqueId];l?l.color=n:(this._meshes[e.uniqueId]={mesh:e,color:n,observerHighlight:e.onBeforeBindObservable.add(function(d){o.isEnabled&&(o._excludedMeshes&&o._excludedMeshes[d.uniqueId]?o._defaultStencilReference(d):d.getScene().getEngine().setStencilFunctionReference(o._instanceGlowingMeshStencilReference))}),observerDefault:e.onAfterRenderObservable.add(function(d){o.isEnabled&&o._defaultStencilReference(d)}),glowEmissiveOnly:r},e.onDisposeObservable.add(function(){o._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var n=this._meshes[e.uniqueId];for(var r in n&&(n.observerHighlight&&e.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&e.onAfterRenderObservable.remove(n.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[r]){this._shouldRender=!0;break}}},t.prototype.removeAllMeshes=function(){if(this._meshes){for(var e in this._meshes)if(this._meshes.hasOwnProperty(e)){var n=this._meshes[e];n&&this.removeMesh(n.mesh)}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var e in this._meshes)(n=this._meshes[e])&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var e in this._excludedMeshes){var n;(n=this._excludedMeshes[e])&&(n.beforeBind&&n.mesh.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=B.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var n in this._meshes){var r=this._meshes[n];r&&e.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var o in this._excludedMeshes){var l=this._excludedMeshes[o];l&&e.excludedMeshes.push(l.mesh.id)}return e},t.Parse=function(e,n,r){var o,l=B.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(d=n.getMeshByID(e.excludedMeshes[o]))&&l.addExcludedMesh(d);for(o=0;o<e.meshes.length;o++){var d,v=e.meshes[o];(d=n.getMeshByID(v.meshId))&&l.addMesh(d,C.a.FromArray(v.color),v.glowEmissiveOnly)}return l},t.EffectName="HighlightLayer",t.NeutralColor=new C.b(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,Object(f.c)([Object(B.c)()],t.prototype,"innerGlow",void 0),Object(f.c)([Object(B.c)()],t.prototype,"outerGlow",void 0),Object(f.c)([Object(B.c)()],t.prototype,"blurHorizontalSize",null),Object(f.c)([Object(B.c)()],t.prototype,"blurVerticalSize",null),Object(f.c)([Object(B.c)("options")],t.prototype,"_options",void 0),t}(ol);R.a.RegisteredTypes["BABYLON.HighlightLayer"]=Zp;var o0=function(){function i(t){this.name=dt.a.NAME_LAYER,this.scene=t,this._engine=t.getEngine(),t.layers=new Array}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(dt.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(dt.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.layers;t<e.length;t++)e[t]._rebuild()},i.prototype.dispose=function(){for(var t=this.scene.layers;t.length;)t[0].dispose()},i.prototype._draw=function(t){var e=this.scene.layers;if(e.length){this._engine.setDepthBuffer(!1);for(var n=0,r=e;n<r.length;n++){var o=r[n];t(o)&&o.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCameraPredicate=function(t,e,n){return!t.renderOnlyInRenderTargetTextures&&t.isBackground===e&&(t.layerMask&n)!=0},i.prototype._drawCameraBackground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!0,t.layerMask)})},i.prototype._drawCameraForeground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!1,t.layerMask)})},i.prototype._drawRenderTargetPredicate=function(t,e,n,r){return t.renderTargetTextures.length>0&&t.isBackground===e&&t.renderTargetTextures.indexOf(r)>-1&&(t.layerMask&n)!=0},i.prototype._drawRenderTargetBackground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!0,e.scene.activeCamera.layerMask,t)})},i.prototype._drawRenderTargetForeground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!1,e.scene.activeCamera.layerMask,t)})},i.prototype.addFromContainer=function(t){var e=this;t.layers&&t.layers.forEach(function(n){e.scene.layers.push(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.layers&&t.layers.forEach(function(r){var o=n.scene.layers.indexOf(r);o!==-1&&n.scene.layers.splice(o,1),e&&r.dispose()})},i}(),BD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;

#include<helperFunctions>
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef LINEAR
baseColor.rgb=toGammaSpace(baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`;Qe.a.ShadersStore.layerPixelShader=BD;var UD=`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`;Qe.a.ShadersStore.layerVertexShader=UD;var VD=function(){function i(t,e,n,r,o){this.name=t,this.scale=new h.d(1,1),this.offset=new h.d(0,0),this.alphaBlendingMode=g.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new S.c,this.onBeforeRenderObservable=new S.c,this.onAfterRenderObservable=new S.c,this.texture=e?new ke.a(e,n,!0):null,this.isBackground=r===void 0||r,this.color=o===void 0?new C.b(1,1,1,1):o,this._scene=n||re.a.LastCreatedScene;var l=this._scene._getComponent(dt.a.NAME_LAYER);l||(l=new o0(this._scene),this._scene._addComponent(l)),this._scene.layers.push(this);var d=this._scene.getEngine(),v=[];v.push(1,1),v.push(-1,1),v.push(-1,-1),v.push(1,-1);var y=new De.b(d,v,De.b.PositionKind,!1,!1,2);this._vertexBuffers[De.b.PositionKind]=y,this._createIndexBuffer()}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),i.prototype._createIndexBuffer=function(){var t=this._scene.getEngine(),e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=t.createIndexBuffer(e)},i.prototype._rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.render=function(){var t=this._scene.getEngine(),e="";this.alphaTest&&(e="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(e+=`\r
#define LINEAR`),this._previousDefines!==e&&(this._previousDefines=e,this._effect=t.createEffect("layer",[De.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],e));var n=this._effect;n&&n.isReady()&&this.texture&&this.texture.isReady()&&(t=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(n),t.setState(!1),n.setTexture("textureSampler",this.texture),n.setMatrix("textureMatrix",this.texture.getTextureMatrix()),n.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),n.setVector2("offset",this.offset),n.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,n),this.alphaTest?t.drawElementsType(pn.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(pn.a.TriangleFillMode,0,6),t.setAlphaMode(g.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this))},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},i}(),a0=function(){function i(t,e,n,r,o){this.size=t,this.position=e,this.alphaMode=g.a.ALPHA_ONEONE,this.color=n||new C.a(1,1,1),this.texture=r?new ke.a(r,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return i.AddFlare=function(t,e,n,r,o){return new i(t,e,n,r,o)},i.prototype.dispose=function(){this.texture&&this.texture.dispose();var t=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(t,1)},i}(),kD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`;Qe.a.ShadersStore.lensFlarePixelShader=kD;var jD=`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.lensFlareVertexShader=jD;var $p=function(){function i(t,e,n){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=n||re.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._emitter=e,this.id=t,n.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(d){return n.activeCamera&&d.material&&d.isVisible&&d.isEnabled()&&d.isBlocker&&(d.layerMask&n.activeCamera.layerMask)!=0};var r=n.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[De.b.PositionKind]=new De.b(r,o,De.b.PositionKind,!1,!1,2);var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=r.createIndexBuffer(l),this._effect=r.createEffect("lensFlare",[De.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype.getEmitter=function(){return this._emitter},i.prototype.setEmitter=function(t){this._emitter=t},i.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},i.prototype.computeEffectivePosition=function(t){var e=this.getEmitterPosition();return e=h.e.Project(e,h.a.Identity(),this._scene.getTransformMatrix(),t),this._positionX=e.x,this._positionY=e.y,e=h.e.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(t.x-=this.viewportBorder,t.y-=this.viewportBorder,t.width+=2*this.viewportBorder,t.height+=2*this.viewportBorder,e.x+=this.viewportBorder,e.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),e.z>0&&(this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&(this._positionY,t.y,t.height),!0)},i.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var t=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),e=t.length();t.normalize();var n=new Qn.a(this._scene.activeCamera.globalPosition,t),r=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>e},i.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var t,e,n=this._scene.getEngine(),r=this._scene.activeCamera.viewport.toGlobal(n.getRenderWidth(!0),n.getRenderHeight(!0));if(!this.computeEffectivePosition(r)||!this._isVisible())return!1;var o=(t=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0)>(e=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0)?t:e;(o-=this.viewportBorder)>this.borderLimit&&(o=this.borderLimit);var l=1-J.a.Clamp(o/this.borderLimit,0,1);if(l<0)return!1;l>1&&(l=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var d=r.x+r.width/2,v=r.y+r.height/2,y=d-this._positionX,D=v-this._positionY;n.enableEffect(this._effect),n.setState(!1),n.setDepthBuffer(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var w=0;w<this.lensFlares.length;w++){var F=this.lensFlares[w];if(!F.texture||F.texture.isReady()){n.setAlphaMode(F.alphaMode);var z=d-y*F.position,k=v-D*F.position,K=F.size,ae=F.size*n.getAspectRatio(this._scene.activeCamera,!0),le=z/(r.width+2*r.x)*2-1,fe=1-k/(r.height+2*r.y)*2,me=h.a.FromValues(K/2,0,0,0,0,ae/2,0,0,0,0,1,0,le,fe,0,1);this._effect.setMatrix("viewportMatrix",me),this._effect.setTexture("textureSampler",F.texture),this._effect.setFloat4("color",F.color.r*l,F.color.g*l,F.color.b*l,1),n.drawElementsType(pn.a.TriangleFillMode,0,6)}}return n.setDepthBuffer(!0),n.setAlphaMode(g.a.ALPHA_DISABLE),!0},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];for(t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var e=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(e,1)},i.Parse=function(t,e,n){var r=e.getLastEntryByID(t.emitterId),o=t.name||"lensFlareSystem#"+t.emitterId,l=new i(o,r,e);l.id=t.id||o,l.borderLimit=t.borderLimit;for(var d=0;d<t.flares.length;d++){var v=t.flares[d];a0.AddFlare(v.size,v.position,C.a.FromArray(v.color),v.textureName?n+v.textureName:"",l)}return l},i.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var e=0;e<this.lensFlares.length;e++){var n=this.lensFlares[e];t.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:et.b.GetFilename(n.texture?n.texture.name:"")})}return t},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("LensFlareSystemSceneComponent")},i}();E.a.AddParser(dt.a.NAME_LENSFLARESYSTEM,function(i,t,e,n){if(i.lensFlareSystems!==void 0&&i.lensFlareSystems!==null){e.lensFlareSystems||(e.lensFlareSystems=new Array);for(var r=0,o=i.lensFlareSystems.length;r<o;r++){var l=i.lensFlareSystems[r],d=$p.Parse(l,t,n);e.lensFlareSystems.push(d)}}}),E.a.prototype.getLensFlareSystemByName=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===i)return this.lensFlareSystems[t];return null},E.a.prototype.getLensFlareSystemByID=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===i)return this.lensFlareSystems[t];return null},E.a.prototype.removeLensFlareSystem=function(i){var t=this.lensFlareSystems.indexOf(i);return t!==-1&&this.lensFlareSystems.splice(t,1),t},E.a.prototype.addLensFlareSystem=function(i){this.lensFlareSystems.push(i)};var s0=function(){function i(t){this.name=dt.a.NAME_LENSFLARESYSTEM,this.scene=t,t.lensFlareSystems=new Array}return i.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},i.prototype.rebuild=function(){},i.prototype.addFromContainer=function(t){var e=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(n){e.scene.addLensFlareSystem(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(r){n.scene.removeLensFlareSystem(r),e&&r.dispose()})},i.prototype.serialize=function(t){t.lensFlareSystems=[];for(var e=0,n=this.scene.lensFlareSystems;e<n.length;e++){var r=n[e];t.lensFlareSystems.push(r.serialize())}},i.prototype.dispose=function(){for(var t=this.scene.lensFlareSystems;t.length;)t[0].dispose()},i.prototype._draw=function(t){if(this.scene.lensFlaresEnabled){var e=this.scene.lensFlareSystems;et.b.StartPerformanceCounter("Lens flares",e.length>0);for(var n=0,r=e;n<r.length;n++){var o=r[n];(t.layerMask&o.layerMask)!=0&&o.render()}et.b.EndPerformanceCounter("Lens flares",e.length>0)}},i}();$p._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_LENSFLARESYSTEM);t||(t=new s0(i),i._addComponent(t))};var zD=`




float bayerDither2(vec2 _P) {
return mod(2.0*_P.y+_P.x+1.0,4.0);
}


float bayerDither4(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
return 4.0*bayerDither2(P1)+bayerDither2(P2);
}

float bayerDither8(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
vec2 P4=floor(0.25*mod(_P,8.0));
return 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);
}
`;Qe.a.IncludesShadersStore.bayerDitherFunctions=zD;var GD=`#if SM_FLOAT == 0
#include<packingFunctions>
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#include<bayerDitherFunctions>
uniform float softTransparentShadowSM;
#endif
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
uniform vec3 lightDataSM;
varying vec3 vPositionWSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;Qe.a.IncludesShadersStore.shadowMapFragmentDeclaration=GD;var HD=` float depthSM=vDepthMetricSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
#if SM_USEDISTANCE == 1
depthSM=clamp(((length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#else
depthSM=clamp(((zSM+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#endif
gl_FragDepth=depthSM;
#elif SM_USEDISTANCE == 1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y)+biasAndScaleSM.x;
#endif
#if SM_ESM == 1
depthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);
#endif
#if SM_FLOAT == 1
gl_FragColor=vec4(depthSM,1.0,1.0,1.0);
#else
gl_FragColor=pack(depthSM);
#endif
return;`;Qe.a.IncludesShadersStore.shadowMapFragment=HD;var WD=`#include<shadowMapFragmentDeclaration>
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEST
float alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;
if (alphaFromAlphaTexture<0.4)
discard;
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#ifdef ALPHATEST
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;
#else
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;
#endif
#endif
#include<shadowMapFragment>
}`;Qe.a.ShadersStore.shadowMapPixelShader=WD;var XD=`#if SM_NORMALBIAS == 1
uniform vec3 lightDataSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
varying vec3 vPositionWSM;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;Qe.a.IncludesShadersStore.shadowMapVertexDeclaration=XD;var YD=`
#if SM_NORMALBIAS == 1
#if SM_DIRECTIONINLIGHTDATA == 1
vec3 worldLightDirSM=normalize(-lightDataSM.xyz);
#else
vec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;
vec3 worldLightDirSM=normalize(directionToLightSM);
#endif
float ndlSM=dot(vNormalW,worldLightDirSM);
float sinNLSM=sqrt(1.0-ndlSM*ndlSM);
float normalBiasSM=biasAndScaleSM.y*sinNLSM;
worldPos.xyz-=vNormalW*normalBiasSM;
#endif
`;Qe.a.IncludesShadersStore.shadowMapVertexNormalBias=YD;var KD=`#if SM_USEDISTANCE == 1
vPositionWSM=worldPos.xyz;
#endif
#if SM_DEPTHTEXTURE == 1

gl_Position.z+=biasAndScaleSM.x*gl_Position.w;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
zSM=gl_Position.z;
gl_Position.z=0.0;
#elif SM_USEDISTANCE == 0

vDepthMetricSM=((gl_Position.z+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x;
#endif
`;Qe.a.IncludesShadersStore.shadowMapVertexMetric=KD;var QD=`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<shadowMapVertexDeclaration>
#include<clipPlaneVertexDeclaration>
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normWorldSM=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));
vNormalW=normalize(normWorldSM*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normWorldSM=transposeMat3(inverseMat3(normWorldSM));
#endif
vec3 vNormalW=normalize(normWorldSM*normalUpdated);
#endif
#endif
#include<shadowMapVertexNormalBias>

gl_Position=viewProjection*worldPos;
#include<shadowMapVertexMetric>
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<clipPlaneVertex>
}`;Qe.a.ShadersStore.shadowMapVertexShader=QD;var qD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`;Qe.a.ShadersStore.depthBoxBlurPixelShader=qD;var ZD=`#if SM_SOFTTRANSPARENTSHADOW == 1
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;
#endif
`;Qe.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow=ZD;var c0=new h.a,l0=new h.a,Gr=function(){function i(t,e,n){this.onBeforeShadowMapRenderObservable=new S.c,this.onAfterShadowMapRenderObservable=new S.c,this.onBeforeShadowMapRenderMeshObservable=new S.c,this.onAfterShadowMapRenderMeshObservable=new S.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=i.FILTER_NONE,this._filteringQuality=i.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=h.e.Zero(),this._viewMatrix=h.a.Zero(),this._projectionMatrix=h.a.Zero(),this._transformMatrix=h.a.Zero(),this._cachedPosition=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new h.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=h.a.Identity(),this._mapSize=t,this._light=e,this._scene=e.getScene(),e._shadowGenerator=this,this.id=e.id,i._SceneComponentInitialization(this._scene);var r=this._scene.getEngine().getCaps();n?r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(i.prototype,"bias",{get:function(){return this._bias},set:function(t){this._bias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"normalBias",{get:function(){return this._normalBias},set:function(t){this._normalBias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(t){this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurScale",{get:function(){return this._blurScale},set:function(t){this._blurScale!==t&&(this._blurScale=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(t){this._blurKernel!==t&&(this._blurKernel=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(t){this._useKernelBlur!==t&&(this._useKernelBlur=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthScale",{get:function(){return this._depthScale!==void 0?this._depthScale:this._light.getDepthScale()},set:function(t){this._depthScale=t},enumerable:!1,configurable:!0}),i.prototype._validateFilter=function(t){return t},Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},set:function(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===i.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===i.FILTER_PCF||t===i.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==i.FILTER_PCF&&t!==i.FILTER_PCSS||this._scene.getEngine().webGLVersion!==1?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePoissonSampling",{get:function(){return this.filter===i.FILTER_POISSONSAMPLING},set:function(t){var e=this._validateFilter(i.FILTER_POISSONSAMPLING);(t||this.filter===i.FILTER_POISSONSAMPLING)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useExponentialShadowMap",{get:function(){return this.filter===i.FILTER_EXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===i.FILTER_PCF},set:function(t){var e=this._validateFilter(i.FILTER_PCF);(t||this.filter===i.FILTER_PCF)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(t){this._filteringQuality!==t&&(this._filteringQuality=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useContactHardeningShadow",{get:function(){return this.filter===i.FILTER_PCSS},set:function(t){var e=this._validateFilter(i.FILTER_PCSS);(t||this.filter===i.FILTER_PCSS)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(t){this._contactHardeningLightSizeUVRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"darkness",{get:function(){return this._darkness},set:function(t){this.setDarkness(t)},enumerable:!1,configurable:!0}),i.prototype.getDarkness=function(){return this._darkness},i.prototype.setDarkness=function(t){return this._darkness=t>=1?1:t<=0?0:t,this},Object.defineProperty(i.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(t){this.setTransparencyShadow(t)},enumerable:!1,configurable:!0}),i.prototype.setTransparencyShadow=function(t){return this._transparencyShadow=t,this},i.prototype.getShadowMap=function(){return this._shadowMap},i.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},i.prototype.getClassName=function(){return i.CLASSNAME},i.prototype.addShadowCaster=function(t,e){var n;return e===void 0&&(e=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(t),e&&(n=this._shadowMap.renderList).push.apply(n,t.getChildMeshes()),this):this},i.prototype.removeShadowCaster=function(t,e){if(e===void 0&&(e=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var n=this._shadowMap.renderList.indexOf(t);if(n!==-1&&this._shadowMap.renderList.splice(n,1),e)for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];this.removeShadowCaster(l)}return this},i.prototype.getLight=function(){return this._light},Object.defineProperty(i.prototype,"mapSize",{get:function(){return this._mapSize},set:function(t){this._mapSize=t,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()},enumerable:!1,configurable:!0}),i.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},i.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new qn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)):this._shadowMap=new qn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},i.prototype._initializeShadowMap=function(){var t=this;if(this._createTargetRenderTexture(),this._shadowMap!==null){this._shadowMap.wrapU=ke.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=ke.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.customIsReadyFunction=function(l,d){return!0};var e=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add(function(l){if(t._currentFaceIndex=l,t._filter===i.FILTER_PCF&&e.setColorWrite(!1),t._scene.getSceneUniformBuffer().useUbo){var d=t._scene.getSceneUniformBuffer();d.updateMatrix("viewProjection",t.getTransformMatrix()),d.updateMatrix("view",t._viewMatrix),d.update()}}),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._scene.getSceneUniformBuffer().useUbo){var l=t._scene.getSceneUniformBuffer();l.updateMatrix("viewProjection",t._scene.getTransformMatrix()),l.updateMatrix("view",t._scene.getViewMatrix()),l.update()}if(t._filter===i.FILTER_PCF&&e.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var d=t.getShadowMapForRendering();if(d){var v=d.getInternalTexture();t._scene.postProcessManager.directRender(t._blurPostProcesses,v,!0),e.unBindFramebuffer(v,!0)}}});var n=new C.b(0,0,0,0),r=new C.b(1,1,1,1);this._shadowMap.onClearObservable.add(function(l){t._filter===i.FILTER_PCF?l.clear(r,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?l.clear(n,!0,!0,!1):l.clear(r,!0,!0,!1)}),this._shadowMap.onResizeObservable.add(function(l){t._storedUniqueId=t._shadowMap.uniqueId,t._mapSize=l.getRenderSize(),t._light._markMeshesAsLightDirty(),t.recreateShadowMap()});for(var o=Yc.b.MIN_RENDERINGGROUPS;o<Yc.b.MAX_RENDERINGGROUPS;o++)this._shadowMap.setRenderingAutoClearDepthStencil(o,!1)}},i.prototype._initializeBlurRTTAndPostProcesses=function(){var t=this,e=this._scene.getEngine(),n=this._mapSize/this.blurScale;this.useKernelBlur&&this.blurScale===1||(this._shadowMap2=new qn(this._light.name+"_shadowMap2",n,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=ke.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=ke.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new ar(this._light.name+"KernelBlurX",new h.d(1,0),this.blurKernel,1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=n,this._kernelBlurXPostprocess.height=n,this._kernelBlurXPostprocess.onApplyObservable.add(function(r){r.setTexture("textureSampler",t._shadowMap)}),this._kernelBlurYPostprocess=new ar(this._light.name+"KernelBlurY",new h.d(0,1),this.blurKernel,1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===g.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new St(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,ke.a.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(r){r.setFloat2("screenSize",n,n),r.setTexture("textureSampler",t._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},i.prototype._renderForShadowMap=function(t,e,n,r){var o,l=this._scene.getEngine(),d=l.getColorWrite();if(r.length){for(l.setColorWrite(!1),o=0;o<r.length;o++)this._renderSubMeshForShadowMap(r.data[o]);l.setColorWrite(d)}for(o=0;o<t.length;o++)this._renderSubMeshForShadowMap(t.data[o]);for(o=0;o<e.length;o++)this._renderSubMeshForShadowMap(e.data[o]);if(this._transparencyShadow)for(o=0;o<n.length;o++)this._renderSubMeshForShadowMap(n.data[o],!0);else for(o=0;o<n.length;o++)n.data[o].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1},i.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(t,e,n,r){var o,l,d,v,y,D;e.setMatrix((o=n==null?void 0:n.viewProjection)!==null&&o!==void 0?o:"viewProjection",this.getTransformMatrix()),e.setMatrix((l=n==null?void 0:n.view)!==null&&l!==void 0?l:"view",this._viewMatrix),e.setMatrix((d=n==null?void 0:n.projection)!==null&&d!==void 0?d:"projection",this._projectionMatrix);var w=r.getWorldMatrix();e.setMatrix((v=n==null?void 0:n.world)!==null&&v!==void 0?v:"world",w),w.multiplyToRef(this.getTransformMatrix(),c0),e.setMatrix((y=n==null?void 0:n.worldViewProjection)!==null&&y!==void 0?y:"worldViewProjection",c0),w.multiplyToRef(this._viewMatrix,l0),e.setMatrix((D=n==null?void 0:n.worldView)!==null&&D!==void 0?D:"worldView",l0)},i.prototype._renderSubMeshForShadowMap=function(t,e){var n,r;e===void 0&&(e=!1);var o=t.getRenderingMesh(),l=t.getEffectiveMesh(),d=this._scene,v=d.getEngine(),y=t.getMaterial();if(l._internalAbstractMeshDataInfo._isActiveIntermediate=!1,y&&t.verticesCount!==0&&t._renderId!==d.getRenderId()){v.setState(y.backFaceCulling);var D=o._getInstancesRenderList(t._id,!!t.getReplacementMesh());if(!D.mustReturn){var w=v.getCaps().instancedArrays&&(D.visibleInstances[t._id]!==null&&D.visibleInstances[t._id]!==void 0||o.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(t))if(this.isReady(t,w,e)){t._renderId=d.getRenderId();var F=(n=o.material)===null||n===void 0?void 0:n.shadowDepthWrapper,z=(r=F==null?void 0:F.getEffect(t,this))!==null&&r!==void 0?r:this._effect;if(v.enableEffect(z),o._bind(t,z,y.fillMode),this.getTransformMatrix(),z.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===so.a.LIGHTTYPEID_DIRECTIONALLIGHT?z.setVector3("lightDataSM",this._cachedDirection):z.setVector3("lightDataSM",this._cachedPosition),d.activeCamera&&z.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(d.activeCamera),this.getLight().getDepthMinZ(d.activeCamera)+this.getLight().getDepthMaxZ(d.activeCamera)),e&&this.enableSoftTransparentShadow&&z.setFloat("softTransparentShadowSM",l.visibility),F)t._effectOverride=z,F.standalone?F.baseMaterial.bindForSubMesh(l.getWorldMatrix(),o,t):y.bindForSubMesh(l.getWorldMatrix(),o,t),t._effectOverride=null;else{if(z.setMatrix("viewProjection",this.getTransformMatrix()),y&&y.needAlphaTesting()){var k=y.getAlphaTestTexture();k&&(z.setTexture("diffuseSampler",k),z.setMatrix("diffuseMatrix",k.getTextureMatrix()||this._defaultTextureMatrix))}if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){var K=o.skeleton;if(K.isUsingTextureForMatrices){var ae=K.getTransformMatrixTexture(o);if(!ae)return;z.setTexture("boneSampler",ae),z.setFloat("boneTextureWidth",4*(K.bones.length+1))}else z.setMatrices("mBones",K.getTransformMatrices(o))}lt.a.BindMorphTargetParameters(o,z),lt.a.BindClipPlane(z,d)}this._bindCustomEffectForRenderSubMeshForShadowMap(t,z,F==null?void 0:F._matriceNames,l),this.forceBackFacesOnly&&v.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(o),this.onBeforeShadowMapRenderObservable.notifyObservers(z),o._processRendering(l,t,z,y.fillMode,D,w,function(le,fe){return z.setMatrix("world",fe)}),this.forceBackFacesOnly&&v.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(z),this.onAfterShadowMapRenderMeshObservable.notifyObservers(o)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},i.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===i.FILTER_NONE||this.filter===i.FILTER_PCSS?this._shadowMap.updateSamplingMode(ke.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(ke.a.BILINEAR_SAMPLINGMODE))},i.prototype.forceCompilation=function(t,e){var n=this,r=Object(f.a)({useInstances:!1},e),o=this.getShadowMap();if(o){var l=o.renderList;if(l){for(var d=new Array,v=0,y=l;v<y.length;v++){var D=y[v];d.push.apply(d,D.subMeshes)}if(d.length!==0){var w=0,F=function(){var z,k;if(n._scene&&n._scene.getEngine()){for(;n.isReady(d[w],r.useInstances,(k=(z=d[w].getMaterial())===null||z===void 0?void 0:z.needAlphaBlendingForMesh(d[w].getMesh()))!==null&&k!==void 0&&k);)if(++w>=d.length)return void(t&&t(n));setTimeout(F,16)}};F()}else t&&t(this)}else t&&t(this)}else t&&t(this)},i.prototype.forceCompilationAsync=function(t){var e=this;return new Promise(function(n){e.forceCompilation(function(){n()},t)})},i.prototype._isReadyCustomDefines=function(t,e,n){},i.prototype._prepareShadowDefines=function(t,e,n,r){n.push("#define SM_FLOAT "+(this._textureType!==g.a.TEXTURETYPE_UNSIGNED_INT?"1":"0")),n.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),n.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));var o=t.getMesh();return n.push("#define SM_NORMALBIAS "+(this.normalBias&&o.isVerticesDataPresent(De.b.NormalKind)?"1":"0")),n.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===so.a.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),n.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),n.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&r?"1":"0")),this._isReadyCustomDefines(n,t,e),n},i.prototype.isReady=function(t,e,n){var r=t.getMaterial(),o=r==null?void 0:r.shadowDepthWrapper,l=[];if(this._prepareShadowDefines(t,e,l,n),o){if(!o.isReadyForSubMesh(t,l,this,e))return!1}else{var d=[De.b.PositionKind],v=t.getMesh();if(this.normalBias&&v.isVerticesDataPresent(De.b.NormalKind)&&(d.push(De.b.NormalKind),l.push("#define NORMAL"),v.nonUniformScaling&&l.push("#define NONUNIFORMSCALING")),r&&r.needAlphaTesting()){var y=r.getAlphaTestTexture();if(y){if(!y.isReady())return!1;l.push("#define ALPHATEST"),v.isVerticesDataPresent(De.b.UVKind)&&(d.push(De.b.UVKind),l.push("#define UV1")),v.isVerticesDataPresent(De.b.UV2Kind)&&y.coordinatesIndex===1&&(d.push(De.b.UV2Kind),l.push("#define UV2"))}}var D=new _s.a;if(v.useBones&&v.computeBonesUsingShaders&&v.skeleton){d.push(De.b.MatricesIndicesKind),d.push(De.b.MatricesWeightsKind),v.numBoneInfluencers>4&&(d.push(De.b.MatricesIndicesExtraKind),d.push(De.b.MatricesWeightsExtraKind));var w=v.skeleton;l.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),v.numBoneInfluencers>0&&D.addCPUSkinningFallback(0,v),w.isUsingTextureForMatrices?l.push("#define BONETEXTURE"):l.push("#define BonesPerMesh "+(w.bones.length+1))}else l.push("#define NUM_BONE_INFLUENCERS 0");var F=v.morphTargetManager,z=0;F&&F.numInfluencers>0&&(l.push("#define MORPHTARGETS"),z=F.numInfluencers,l.push("#define NUM_MORPH_INFLUENCERS "+z),lt.a.PrepareAttributesForMorphTargetsInfluencers(d,v,z));var k=this._scene;if(k.clipPlane&&l.push("#define CLIPPLANE"),k.clipPlane2&&l.push("#define CLIPPLANE2"),k.clipPlane3&&l.push("#define CLIPPLANE3"),k.clipPlane4&&l.push("#define CLIPPLANE4"),k.clipPlane5&&l.push("#define CLIPPLANE5"),k.clipPlane6&&l.push("#define CLIPPLANE6"),e&&(l.push("#define INSTANCES"),lt.a.PushAttributesForInstances(d),t.getRenderingMesh().hasThinInstances&&l.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(var K=0,ae=this.customShaderOptions.defines;K<ae.length;K++){var le=ae[K];l.indexOf(le)===-1&&l.push(le)}var fe=l.join(`
`);if(this._cachedDefines!==fe){this._cachedDefines=fe;var me="shadowMap",be=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","softTransparentShadowSM"],Ee=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(me=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var xe=0,Ae=this.customShaderOptions.attributes;xe<Ae.length;xe++){var Ie=Ae[xe];d.indexOf(Ie)===-1&&d.push(Ie)}if(this.customShaderOptions.uniforms)for(var Re=0,Pe=this.customShaderOptions.uniforms;Re<Pe.length;Re++){var Ce=Pe[Re];be.indexOf(Ce)===-1&&be.push(Ce)}if(this.customShaderOptions.samplers)for(var Ue=0,Oe=this.customShaderOptions.samplers;Ue<Oe.length;Ue++){var Ve=Oe[Ue];Ee.indexOf(Ve)===-1&&Ee.push(Ve)}}this._effect=this._scene.getEngine().createEffect(me,d,be,Ee,fe,D,void 0,void 0,{maxSimultaneousMorphTargets:z})}if(!this._effect.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())},i.prototype.prepareDefines=function(t,e){var n=this._scene,r=this._light;n.shadowsEnabled&&r.shadowEnabled&&(t["SHADOW"+e]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+e]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+e]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+e]=!0),r.needCube()&&(t["SHADOWCUBE"+e]=!0))},i.prototype.bindShadowLight=function(t,e){var n=this._light,r=this._scene;if(r.shadowsEnabled&&n.shadowEnabled){var o=r.activeCamera;if(o){var l=this.getShadowMap();l&&(n.needCube()||e.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===i.FILTER_PCF?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),l.getSize().width,1/l.getSize().width,this.frustumEdgeFalloff,t)):this._filter===i.FILTER_PCSS?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),e.setTexture("depthSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/l.getSize().width,this._contactHardeningLightSizeUVRatio*l.getSize().width,this.frustumEdgeFalloff,t)):(e.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/l.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),n._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},i.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var e=this._light.position;if(this._light.computeTransformedInformation()&&(e=this._light.transformedPosition),h.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),Math.abs(h.e.Dot(this._lightDirection,h.e.Up()))===1&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!e.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(e),this._cachedDirection.copyFrom(this._lightDirection),h.a.LookAtLHToRef(e,e.add(this._lightDirection),h.e.Up(),this._viewMatrix);var n=this.getShadowMap();if(n){var r=n.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},i.prototype.recreateShadowMap=function(){var t=this._shadowMap;if(t){var e=t.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=e}},i.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},i.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},i.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},i.prototype.serialize=function(){var t={},e=this.getShadowMap();if(!e)return t;if(t.className=this.getClassName(),t.lightId=this._light.id,t.id=this._light.id,t.mapSize=e.getRenderSize(),t.forceBackFacesOnly=this.forceBackFacesOnly,t.darkness=this.getDarkness(),t.transparencyShadow=this._transparencyShadow,t.frustumEdgeFalloff=this.frustumEdgeFalloff,t.bias=this.bias,t.normalBias=this.normalBias,t.usePercentageCloserFiltering=this.usePercentageCloserFiltering,t.useContactHardeningShadow=this.useContactHardeningShadow,t.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,t.filteringQuality=this.filteringQuality,t.useExponentialShadowMap=this.useExponentialShadowMap,t.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,t.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.usePoissonSampling=this.usePoissonSampling,t.depthScale=this.depthScale,t.blurBoxOffset=this.blurBoxOffset,t.blurKernel=this.blurKernel,t.blurScale=this.blurScale,t.useKernelBlur=this.useKernelBlur,t.renderList=[],e.renderList)for(var n=0;n<e.renderList.length;n++){var r=e.renderList[n];t.renderList.push(r.id)}return t},i.Parse=function(t,e,n){for(var r=e.getLightByID(t.lightId),o=n?n(t.mapSize,r):new i(t.mapSize,r),l=o.getShadowMap(),d=0;d<t.renderList.length;d++)e.getMeshesByID(t.renderList[d]).forEach(function(v){l&&(l.renderList||(l.renderList=[]),l.renderList.push(v))});return t.id!==void 0&&(o.id=t.id),o.forceBackFacesOnly=!!t.forceBackFacesOnly,t.darkness!==void 0&&o.setDarkness(t.darkness),t.transparencyShadow&&o.setTransparencyShadow(!0),t.frustumEdgeFalloff!==void 0&&(o.frustumEdgeFalloff=t.frustumEdgeFalloff),t.bias!==void 0&&(o.bias=t.bias),t.normalBias!==void 0&&(o.normalBias=t.normalBias),t.usePercentageCloserFiltering?o.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?o.useContactHardeningShadow=!0:t.usePoissonSampling?o.usePoissonSampling=!0:t.useExponentialShadowMap?o.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?o.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?o.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?o.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?o.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(o.useBlurExponentialShadowMap=!0),t.contactHardeningLightSizeUVRatio!==void 0&&(o.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),t.filteringQuality!==void 0&&(o.filteringQuality=t.filteringQuality),t.depthScale&&(o.depthScale=t.depthScale),t.blurScale&&(o.blurScale=t.blurScale),t.blurBoxOffset&&(o.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(o.useKernelBlur=t.useKernelBlur),t.blurKernel&&(o.blurKernel=t.blurKernel),o},i.CLASSNAME="ShadowGenerator",i.FILTER_NONE=0,i.FILTER_EXPONENTIALSHADOWMAP=1,i.FILTER_POISSONSAMPLING=2,i.FILTER_BLUREXPONENTIALSHADOWMAP=3,i.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,i.FILTER_PCF=6,i.FILTER_PCSS=7,i.QUALITY_HIGH=0,i.QUALITY_MEDIUM=1,i.QUALITY_LOW=2,i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("ShadowGeneratorSceneComponent")},i}(),$D=`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
#ifdef PACKED
#include<packingFunctions>
#endif
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#ifdef NONLINEARDEPTH
#ifdef PACKED
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);
#endif
#else
#ifdef PACKED
gl_FragColor=pack(vDepthMetric);
#else
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
#endif
}`;Qe.a.ShadersStore.depthPixelShader=$D;var JD=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Qe.a.ShadersStore.depthVertexShader=JD;var ph=function(){function i(t,e,n,r){var o=this;e===void 0&&(e=g.a.TEXTURETYPE_FLOAT),n===void 0&&(n=null),r===void 0&&(r=!1),this.enabled=!0,this.useOnlyInActiveCamera=!1,this._scene=t,this._storeNonLinearDepth=r,this.isPacked=e===g.a.TEXTURETYPE_UNSIGNED_BYTE,this.isPacked?this._clearColor=new C.b(1,1,1,1):this._clearColor=new C.b(1,0,0,1),i._SceneComponentInitialization(this._scene),this._camera=n;var l=t.getEngine(),d=this.isPacked||l.webGLVersion===1?g.a.TEXTUREFORMAT_RGBA:g.a.TEXTUREFORMAT_R;this._depthMap=new qn("depthMap",{width:l.getRenderWidth(),height:l.getRenderHeight()},this._scene,!1,!0,e,!1,void 0,void 0,void 0,void 0,d),this._depthMap.wrapU=ke.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=ke.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(y){y.clear(o._clearColor,!0,!0,!0)});var v=function(y){var D=y.getRenderingMesh(),w=y.getEffectiveMesh(),F=o._scene,z=F.getEngine(),k=y.getMaterial();if(w._internalAbstractMeshDataInfo._isActiveIntermediate=!1,k&&y.verticesCount!==0&&y._renderId!==F.getRenderId()){z.setState(k.backFaceCulling,0,!1,F.useRightHandedSystem);var K=D._getInstancesRenderList(y._id,!!y.getReplacementMesh());if(!K.mustReturn){var ae=z.getCaps().instancedArrays&&(K.visibleInstances[y._id]!==null&&K.visibleInstances[y._id]!==void 0||D.hasThinInstances),le=o._camera||F.activeCamera;if(o.isReady(y,ae)&&le){if(y._renderId=F.getRenderId(),z.enableEffect(o._effect),D._bind(y,o._effect,k.fillMode),o._effect.setMatrix("viewProjection",F.getTransformMatrix()),o._effect.setFloat2("depthValues",le.minZ,le.minZ+le.maxZ),k&&k.needAlphaTesting()){var fe=k.getAlphaTestTexture();fe&&(o._effect.setTexture("diffuseSampler",fe),o._effect.setMatrix("diffuseMatrix",fe.getTextureMatrix()))}D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&o._effect.setMatrices("mBones",D.skeleton.getTransformMatrices(D)),lt.a.BindMorphTargetParameters(D,o._effect),D._processRendering(w,y,o._effect,k.fillMode,K,ae,function(me,be){return o._effect.setMatrix("world",be)})}}}};this._depthMap.customRenderFunction=function(y,D,w,F){var z;if(F.length){for(l.setColorWrite(!1),z=0;z<F.length;z++)v(F.data[z]);l.setColorWrite(!0)}for(z=0;z<y.length;z++)v(y.data[z]);for(z=0;z<D.length;z++)v(D.data[z])}}return i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n.disableDepthWrite)return!1;var r=[],o=[De.b.PositionKind],l=t.getMesh();n&&n.needAlphaTesting()&&n.getAlphaTestTexture()&&(r.push("#define ALPHATEST"),l.isVerticesDataPresent(De.b.UVKind)&&(o.push(De.b.UVKind),r.push("#define UV1")),l.isVerticesDataPresent(De.b.UV2Kind)&&(o.push(De.b.UV2Kind),r.push("#define UV2"))),l.useBones&&l.computeBonesUsingShaders?(o.push(De.b.MatricesIndicesKind),o.push(De.b.MatricesWeightsKind),l.numBoneInfluencers>4&&(o.push(De.b.MatricesIndicesExtraKind),o.push(De.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+l.numBoneInfluencers),r.push("#define BonesPerMesh "+(l.skeleton?l.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var d=l.morphTargetManager,v=0;d&&d.numInfluencers>0&&(v=d.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+v),lt.a.PrepareAttributesForMorphTargetsInfluencers(o,l,v)),e&&(r.push("#define INSTANCES"),lt.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._storeNonLinearDepth&&r.push("#define NONLINEARDEPTH"),this.isPacked&&r.push("#define PACKED");var y=r.join(`
`);return this._cachedDefines!==y&&(this._cachedDefines=y,this._effect=this._scene.getEngine().createEffect("depth",o,["world","mBones","viewProjection","diffuseMatrix","depthValues","morphTargetInfluences"],["diffuseSampler"],y,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype.getDepthMap=function(){return this._depthMap},i.prototype.dispose=function(){this._depthMap.dispose()},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("DepthRendererSceneComponent")},i}(),ew=`attribute vec2 vUV;
uniform sampler2D textureSampler;
#if defined(INITIAL)
uniform sampler2D sourceTexture;
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
float f1=texelFetch(sourceTexture,coord,0).r;
float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;
float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;
float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;
float minz=min(min(min(f1,f2),f3),f4);
#ifdef DEPTH_REDUX
float maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);
#else
float maxz=max(max(max(f1,f2),f3),f4);
#endif
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(MAIN)
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
vec2 f1=texelFetch(textureSampler,coord,0).rg;
vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;
vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;
vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;
float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);
float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(ONEBEFORELAST)
uniform ivec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*vec2(texSize-1));
vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;
vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;
vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;
vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;
float minz=min(f1.x,f2.x);
float maxz=max(f1.y,f2.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(LAST)
void main(void)
{
discard;
glFragColor=vec4(0.);
}
#endif
`;Qe.a.ShadersStore.minmaxReduxPixelShader=ew;var u0=function(){function i(t){this.onAfterReductionPerformed=new S.c,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=t,this._postProcessManager=new Tp.a(t.getScene())}return Object.defineProperty(i.prototype,"sourceTexture",{get:function(){return this._sourceTexture},enumerable:!1,configurable:!0}),i.prototype.setSourceTexture=function(t,e,n,r){var o=this;if(n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0),t!==this._sourceTexture){this.dispose(!1),this._sourceTexture=t,this._reductionSteps=[],this._forceFullscreenViewport=r;var l=this._camera.getScene(),d=new St("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,g.a.TEXTURE_NEAREST_NEAREST,l.getEngine(),!1,"#define INITIAL"+(e?`
#define DEPTH_REDUX`:""),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);d.autoClear=!1,d.forceFullscreenViewport=r;var v=this._sourceTexture.getRenderWidth(),y=this._sourceTexture.getRenderHeight();d.onApply=function(F,z){return function(k){k.setTexture("sourceTexture",o._sourceTexture),k.setFloatArray2("texSize",new Float32Array([F,z]))}}(v,y),this._reductionSteps.push(d);for(var D=1;v>1||y>1;){v=Math.max(Math.round(v/2),1),y=Math.max(Math.round(y/2),1);var w=new St("Reduction phase "+D,"minmaxRedux",["texSize"],null,{width:v,height:y},null,g.a.TEXTURE_NEAREST_NEAREST,l.getEngine(),!1,"#define "+(v==1&&y==1?"LAST":v==1||y==1?"ONEBEFORELAST":"MAIN"),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);w.autoClear=!1,w.forceFullscreenViewport=r,w.onApply=function(F,z){return function(k){F==1||z==1?k.setIntArray2("texSize",new Int32Array([F,z])):k.setFloatArray2("texSize",new Float32Array([F,z]))}}(v,y),this._reductionSteps.push(w),D++,v==1&&y==1&&w.onAfterRenderObservable.add(function(F,z,k){var K=new Float32Array(4*F*z),ae={min:0,max:0};return function(){l.getEngine()._readTexturePixels(k.inputTexture,F,z,-1,0,K),ae.min=K[0],ae.max=K[1],o.onAfterReductionPerformed.notifyObservers(ae)}}(v,y,w))}}},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._sourceTexture?this._sourceTexture.refreshRate:-1},set:function(t){this._sourceTexture&&(this._sourceTexture.refreshRate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activated",{get:function(){return this._activated},enumerable:!1,configurable:!0}),i.prototype.activate=function(){var t=this;!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add(function(){t._reductionSteps[0].activate(t._camera),t._postProcessManager.directRender(t._reductionSteps,t._reductionSteps[0].inputTexture,t._forceFullscreenViewport),t._camera.getScene().getEngine().unBindFramebuffer(t._reductionSteps[0].inputTexture,!1)}),this._activated=!0)},i.prototype.deactivate=function(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)},i.prototype.dispose=function(t){if(t===void 0&&(t=!0),t&&this.onAfterReductionPerformed.clear(),this.deactivate(),this._reductionSteps){for(var e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&t&&this._postProcessManager.dispose(),this._sourceTexture=null},i}(),h0=function(i){function t(e){return i.call(this,e)||this}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:!1,configurable:!0}),t.prototype.setDepthRenderer=function(e,n,r){e===void 0&&(e=null),n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0);var o=this._camera.getScene();this._depthRenderer&&(delete o._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),e===null&&(o._depthRenderer||(o._depthRenderer={}),(e=this._depthRenderer=new ph(o,n,this._camera,!1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,o._depthRenderer[this._depthRendererId]=e),i.prototype.setSourceTexture.call(this,e.getDepthMap(),!0,n,r)},t.prototype.setSourceTexture=function(e,n,r,o){r===void 0&&(r=g.a.TEXTURETYPE_HALF_FLOAT),o===void 0&&(o=!0),i.prototype.setSourceTexture.call(this,e,n,r,o)},t.prototype.activate=function(){this._depthRenderer&&(this._depthRenderer.enabled=!0),i.prototype.activate.call(this)},t.prototype.deactivate=function(){i.prototype.deactivate.call(this),this._depthRenderer&&(this._depthRenderer.enabled=!1)},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),i.prototype.dispose.call(this,e),this._depthRenderer&&e){var n=this._depthRenderer.getDepthMap().getScene();n&&delete n._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}},t}(u0),d0=h.e.Up(),tw=h.e.Zero(),sr=new h.e,Es=new h.e,Ss=new h.a,f0=new h.a,Jp=function(i){function t(e,n,r){var o=this;if(t.IsSupported)return(o=i.call(this,e,n,r)||this).usePercentageCloserFiltering=!0,o;_.a.Error("CascadedShadowMap needs WebGL 2 support.")}return Object(f.d)(t,i),t.prototype._validateFilter=function(e){return e===Gr.FILTER_NONE||e===Gr.FILTER_PCF||e===Gr.FILTER_PCSS?e:(console.error('Unsupported filter "'+e+'"!'),Gr.FILTER_NONE)},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(e){(e=Math.min(Math.max(e,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()},enumerable:!1,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var e=this._shadowMap.renderList,n=0;n<e.length;n++)if(l=e[n]){var r=l.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld)}var o=this._scene.meshes;for(n=0;n<o.length;n++){var l;(l=o[n])&&l.isVisible&&l.isEnabled&&l.receiveShadows&&(r=l.getBoundingInfo().boundingBox,this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld))}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(e){this._shadowCastersBoundingInfo=e},enumerable:!1,configurable:!0}),t.prototype.setMinMaxDistance=function(e,n){this._minDistance===e&&this._maxDistance===n||(e>n&&(e=0,n=1),e<0&&(e=0),n>1&&(n=1),this._minDistance=e,this._maxDistance=n,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null},t.prototype.getCascadeMaxExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(e){this._scene&&this._scene.activeCamera?this._shadowMaxZ===e||e<this._scene.activeCamera.minZ||e>this._scene.activeCamera.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(e){this._depthClamp=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(e){var n=Math.min(Math.max(e,0),1);this._lambda!=n&&(this._lambda=n,this._breaksAreDirty=!0)},enumerable:!1,configurable:!0}),t.prototype.getCascadeViewMatrix=function(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null},t.prototype.getCascadeProjectionMatrix=function(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null},t.prototype.getCascadeTransformMatrix=function(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null},t.prototype.setDepthRenderer=function(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(e){var n=this,r=this._scene.activeCamera;if(r){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new h0(r),this._depthReducer.onAfterReductionPerformed.add(function(o){var l=o.min,d=o.max;l>=d&&(l=0,d=1),l==n._minDistance&&d==n._maxDistance||n.setMinMaxDistance(l,d)}),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var e,n,r;return(r=(n=(e=this._depthReducer)===null||e===void 0?void 0:e.depthRenderer)===null||n===void 0?void 0:n.getDepthMap().refreshRate)!==null&&r!==void 0?r:-1},set:function(e){var n;((n=this._depthReducer)===null||n===void 0?void 0:n.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)},enumerable:!1,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var e=this._scene.activeCamera;if(e){for(var n=e.minZ,r=e.maxZ,o=r-n,l=this._minDistance,d=n+l*o,v=n+(this._shadowMaxZ<r&&this._shadowMaxZ>=n?Math.min((this._shadowMaxZ-n)/(r-n),this._maxDistance):this._maxDistance)*o,y=v-d,D=v/d,w=0;w<this._cascades.length;++w){var F=(w+1)/this._numCascades,z=d*Math.pow(D,F),k=d+y*F,K=this._lambda*(z-k)+k;this._cascades[w].prevBreakDistance=w===0?l:this._cascades[w-1].breakDistance,this._cascades[w].breakDistance=(K-n)/o,this._viewSpaceFrustumsZ[w]=n+this._cascades[w].breakDistance*o,this._frustumLengths[w]=(this._cascades[w].breakDistance-this._cascades[w].prevBreakDistance)*o}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){if(this._scene.activeCamera){h.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),Math.abs(h.e.Dot(this._lightDirection,h.e.Up()))===1&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var e=0;e<this._numCascades;++e){this._computeFrustumInWorldSpace(e),this._computeCascadeFrustum(e),this._cascadeMaxExtents[e].subtractToRef(this._cascadeMinExtents[e],sr),this._frustumCenter[e].addToRef(this._lightDirection.scale(this._cascadeMinExtents[e].z),this._shadowCameraPos[e]),h.a.LookAtLHToRef(this._shadowCameraPos[e],this._frustumCenter[e],d0,this._viewMatrices[e]);var n=0,r=sr.z,o=this._shadowCastersBoundingInfo;o.update(this._viewMatrices[e]),r=Math.min(r,o.boundingBox.maximumWorld.z),n=this._depthClamp&&this.filter!==Gr.FILTER_PCSS?Math.max(n,o.boundingBox.minimumWorld.z):Math.min(n,o.boundingBox.minimumWorld.z),h.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[e].x,this._cascadeMaxExtents[e].x,this._cascadeMinExtents[e].y,this._cascadeMaxExtents[e].y,n,r,this._projectionMatrices[e]),this._cascadeMinExtents[e].z=n,this._cascadeMaxExtents[e].z=r,this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),h.e.TransformCoordinatesToRef(tw,this._transformMatrices[e],sr),sr.scaleInPlace(this._mapSize/2),Es.copyFromFloats(Math.round(sr.x),Math.round(sr.y),Math.round(sr.z)),Es.subtractInPlace(sr).scaleInPlace(2/this._mapSize),h.a.TranslationToRef(Es.x,Es.y,0,Ss),this._projectionMatrices[e].multiplyToRef(Ss,this._projectionMatrices[e]),this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),this._transformMatrices[e].copyToArray(this._transformMatricesAsArray,16*e)}}},t.prototype._computeFrustumInWorldSpace=function(e){if(this._scene.activeCamera){var n=this._cascades[e].prevBreakDistance,r=this._cascades[e].breakDistance;this._scene.activeCamera.getViewMatrix();for(var o=h.a.Invert(this._scene.activeCamera.getTransformationMatrix()),l=0;l<t.frustumCornersNDCSpace.length;++l)h.e.TransformCoordinatesToRef(t.frustumCornersNDCSpace[l],o,this._frustumCornersWorldSpace[e][l]);for(l=0;l<t.frustumCornersNDCSpace.length/2;++l)sr.copyFrom(this._frustumCornersWorldSpace[e][l+4]).subtractInPlace(this._frustumCornersWorldSpace[e][l]),Es.copyFrom(sr).scaleInPlace(n),sr.scaleInPlace(r),sr.addInPlace(this._frustumCornersWorldSpace[e][l]),this._frustumCornersWorldSpace[e][l+4].copyFrom(sr),this._frustumCornersWorldSpace[e][l].addInPlace(Es)}},t.prototype._computeCascadeFrustum=function(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._scene.activeCamera){for(var n=0;n<this._frustumCornersWorldSpace[e].length;++n)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][n]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){var r=0;for(n=0;n<this._frustumCornersWorldSpace[e].length;++n){var o=this._frustumCornersWorldSpace[e][n].subtractToRef(this._frustumCenter[e],sr).length();r=Math.max(r,o)}r=Math.ceil(16*r)/16,this._cascadeMaxExtents[e].copyFromFloats(r,r,r),this._cascadeMinExtents[e].copyFromFloats(-r,-r,-r)}else{var l=this._frustumCenter[e];for(this._frustumCenter[e].addToRef(this._lightDirection,sr),h.a.LookAtLHToRef(l,sr,d0,Ss),n=0;n<this._frustumCornersWorldSpace[e].length;++n)h.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][n],Ss,sr),this._cascadeMinExtents[e].minimizeInPlace(sr),this._cascadeMaxExtents[e].maximizeInPlace(sr)}}},Object.defineProperty(t,"IsSupported",{get:function(){var e=re.a.LastCreatedEngine;return!!e&&e.webGLVersion!=1},enumerable:!1,configurable:!0}),t.prototype._initializeGenerator=function(){var e,n,r,o,l,d,v,y,D,w,F,z,k,K,ae,le,fe,me,be,Ee;this.penumbraDarkness=(e=this.penumbraDarkness)!==null&&e!==void 0?e:1,this._numCascades=(n=this._numCascades)!==null&&n!==void 0?n:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=(r=this.stabilizeCascades)!==null&&r!==void 0&&r,this._freezeShadowCastersBoundingInfoObservable=(o=this._freezeShadowCastersBoundingInfoObservable)!==null&&o!==void 0?o:null,this.freezeShadowCastersBoundingInfo=(l=this.freezeShadowCastersBoundingInfo)!==null&&l!==void 0&&l,this._scbiMin=(d=this._scbiMin)!==null&&d!==void 0?d:new h.e(0,0,0),this._scbiMax=(v=this._scbiMax)!==null&&v!==void 0?v:new h.e(0,0,0),this._shadowCastersBoundingInfo=(y=this._shadowCastersBoundingInfo)!==null&&y!==void 0?y:new ko.a(new h.e(0,0,0),new h.e(0,0,0)),this._breaksAreDirty=(D=this._breaksAreDirty)===null||D===void 0||D,this._minDistance=(w=this._minDistance)!==null&&w!==void 0?w:0,this._maxDistance=(F=this._maxDistance)!==null&&F!==void 0?F:1,this._currentLayer=(z=this._currentLayer)!==null&&z!==void 0?z:0,this._shadowMaxZ=(ae=(k=this._shadowMaxZ)!==null&&k!==void 0?k:(K=this._scene.activeCamera)===null||K===void 0?void 0:K.maxZ)!==null&&ae!==void 0?ae:1e4,this._debug=(le=this._debug)!==null&&le!==void 0&&le,this._depthClamp=(fe=this._depthClamp)===null||fe===void 0||fe,this._cascadeBlendPercentage=(me=this._cascadeBlendPercentage)!==null&&me!==void 0?me:.1,this._lambda=(be=this._lambda)!==null&&be!==void 0?be:.5,this._autoCalcDepthBounds=(Ee=this._autoCalcDepthBounds)!==null&&Ee!==void 0&&Ee,i.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var e={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new qn(this._light.name+"_shadowMap",e,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)},t.prototype._initializeShadowMap=function(){var e=this;if(i.prototype._initializeShadowMap.call(this),this._shadowMap!==null){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var n=0;n<this._numCascades;++n){this._cascades[n]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[n]=h.a.Zero(),this._projectionMatrices[n]=h.a.Zero(),this._transformMatrices[n]=h.a.Zero(),this._cascadeMinExtents[n]=new h.e,this._cascadeMaxExtents[n]=new h.e,this._frustumCenter[n]=new h.e,this._shadowCameraPos[n]=new h.e,this._frustumCornersWorldSpace[n]=new Array(t.frustumCornersNDCSpace.length);for(var r=0;r<t.frustumCornersNDCSpace.length;++r)this._frustumCornersWorldSpace[n][r]=new h.e}this._shadowMap.onBeforeRenderObservable.add(function(o){if(e._currentLayer=o,e._scene.getSceneUniformBuffer().useUbo){var l=e._scene.getSceneUniformBuffer();l.updateMatrix("viewProjection",e.getCascadeTransformMatrix(o)),l.updateMatrix("view",e.getCascadeViewMatrix(o)),l.update()}}),this._shadowMap.onBeforeBindObservable.add(function(){e._breaksAreDirty&&e._splitFrustum(),e._computeMatrices()}),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,n,r,o){var l,d,v,y,D,w;n.setMatrix((l=r==null?void 0:r.viewProjection)!==null&&l!==void 0?l:"viewProjection",this.getCascadeTransformMatrix(this._currentLayer)),n.setMatrix((d=r==null?void 0:r.view)!==null&&d!==void 0?d:"view",this.getCascadeViewMatrix(this._currentLayer)),n.setMatrix((v=r==null?void 0:r.projection)!==null&&v!==void 0?v:"projection",this.getCascadeProjectionMatrix(this._currentLayer));var F=o.getWorldMatrix();n.setMatrix((y=r==null?void 0:r.world)!==null&&y!==void 0?y:"world",F),F.multiplyToRef(this.getCascadeTransformMatrix(this._currentLayer),Ss),n.setMatrix((D=r==null?void 0:r.worldViewProjection)!==null&&D!==void 0?D:"worldViewProjection",Ss),F.multiplyToRef(this.getCascadeViewMatrix(this._currentLayer),f0),n.setMatrix((w=r==null?void 0:r.worldView)!==null&&w!==void 0?w:"worldView",f0)},t.prototype._isReadyCustomDefines=function(e,n,r){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==Gr.FILTER_PCSS?"1":"0"))},t.prototype.prepareDefines=function(e,n){i.prototype.prepareDefines.call(this,e,n);var r=this._scene,o=this._light;if(r.shadowsEnabled&&o.shadowEnabled){e["SHADOWCSM"+n]=!0,e["SHADOWCSMDEBUG"+n]=this.debug,e["SHADOWCSMNUM_CASCADES"+n]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+n]=r.useRightHandedSystem;var l=r.activeCamera;l&&this._shadowMaxZ<l.maxZ&&(e["SHADOWCSMUSESHADOWMAXZ"+n]=!0),this.cascadeBlendPercentage===0&&(e["SHADOWCSMNOBLEND"+n]=!0)}},t.prototype.bindShadowLight=function(e,n){var r=this._light,o=this._scene;if(o.shadowsEnabled&&r.shadowEnabled){var l=o.activeCamera;if(l){var d=this.getShadowMap();if(d){var v=d.getSize().width;if(n.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),n.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),n.setFloat("cascadeBlendFactor"+e,this.cascadeBlendPercentage===0?1e4:1/this.cascadeBlendPercentage),n.setArray("frustumLengths"+e,this._frustumLengths),this._filter===Gr.FILTER_PCF)n.setDepthStencilTexture("shadowSampler"+e,d),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);else if(this._filter===Gr.FILTER_PCSS){for(var y=0;y<this._numCascades;++y)this._lightSizeUVCorrection[2*y+0]=y===0?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[y].x-this._cascadeMinExtents[y].x),this._lightSizeUVCorrection[2*y+1]=y===0?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[y].y-this._cascadeMinExtents[y].y),this._depthCorrection[y]=y===0?1:(this._cascadeMaxExtents[y].z-this._cascadeMinExtents[y].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);n.setDepthStencilTexture("shadowSampler"+e,d),n.setTexture("depthSampler"+e,d),n.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),n.setArray("depthCorrection"+e,this._depthCorrection),n.setFloat("penumbraDarkness"+e,this.penumbraDarkness),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/v,this._contactHardeningLightSizeUVRatio*v,this.frustumEdgeFalloff,e)}else n.setTexture("shadowSampler"+e,d),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(l),this.getLight().getDepthMinZ(l)+this.getLight().getDepthMaxZ(l),e)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this),n=this.getShadowMap();if(!n)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.renderList=[],n.renderList)for(var r=0;r<n.renderList.length;r++){var o=n.renderList[r];e.renderList.push(o.id)}return e},t.Parse=function(e,n){var r=Gr.Parse(e,n,function(o,l){return new t(o,l)});return e.numCascades!==void 0&&(r.numCascades=e.numCascades),e.debug!==void 0&&(r.debug=e.debug),e.stabilizeCascades!==void 0&&(r.stabilizeCascades=e.stabilizeCascades),e.lambda!==void 0&&(r.lambda=e.lambda),e.cascadeBlendPercentage!==void 0&&(r.cascadeBlendPercentage=e.cascadeBlendPercentage),e.depthClamp!==void 0&&(r.depthClamp=e.depthClamp),e.autoCalcDepthBounds!==void 0&&(r.autoCalcDepthBounds=e.autoCalcDepthBounds),e.shadowMaxZ!==void 0&&(r.shadowMaxZ=e.shadowMaxZ),e.penumbraDarkness!==void 0&&(r.penumbraDarkness=e.penumbraDarkness),e.freezeShadowCastersBoundingInfo!==void 0&&(r.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),e.minDistance!==void 0&&e.maxDistance!==void 0&&r.setMinMaxDistance(e.minDistance,e.maxDistance),r},t.frustumCornersNDCSpace=[new h.e(-1,1,-1),new h.e(1,1,-1),new h.e(1,-1,-1),new h.e(-1,-1,-1),new h.e(-1,1,1),new h.e(1,1,1),new h.e(1,-1,1),new h.e(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(e){throw dr.a.WarnImport("ShadowGeneratorSceneComponent")},t}(Gr);E.a.AddParser(dt.a.NAME_SHADOWGENERATOR,function(i,t){if(i.shadowGenerators!==void 0&&i.shadowGenerators!==null)for(var e=0,n=i.shadowGenerators.length;e<n;e++){var r=i.shadowGenerators[e];r.className===Jp.CLASSNAME?Jp.Parse(r,t):Gr.Parse(r,t)}});var p0=function(){function i(t){this.name=dt.a.NAME_SHADOWGENERATOR,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){t.shadowGenerators=[];for(var e=0,n=this.scene.lights;e<n.length;e++){var r=n[e].getShadowGenerator();r&&t.shadowGenerators.push(r.serialize())}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){var e=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<e.lights.length;n++){var r=e.lights[n],o=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&o){var l=o.getShadowMap();e.textures.indexOf(l)!==-1&&t.push(l)}}},i}();Gr._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_SHADOWGENERATOR);t||(t=new p0(i),i._addComponent(t))},$.a.AddNodeConstructor("Light_Type_0",function(i,t){return function(){return new em(i,h.e.Zero(),t)}});var em=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowAngle=Math.PI/2,o.position=n,o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var n=this.needCube();this._direction=e,this.needCube()!==n&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return so.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(e){if(this.direction)return i.prototype.getShadowDirection.call(this,e);switch(e){case 0:return new h.e(1,0,0);case 1:return new h.e(-1,0,0);case 2:return new h.e(0,-1,0);case 3:return new h.e(0,1,0);case 4:return new h.e(0,0,1);case 5:return new h.e(0,0,-1)}return h.e.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;o&&h.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,n):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?e.setFloat3(n,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(n,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(e,n){e["POINTLIGHT"+n]=!0},Object(f.c)([Object(B.c)()],t.prototype,"shadowAngle",null),t}(oh),m0=function(){function i(t,e,n){var r=this;e===void 0&&(e=""),n===void 0&&(n="black"),this._renderingCanvas=t,this._loadingText=e,this._loadingDivBackgroundColor=n,this._resizeLoadingUI=function(){var o=r._renderingCanvas.getBoundingClientRect(),l=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position=l==="fixed"?"fixed":"absolute",r._loadingDiv.style.left=o.left+"px",r._loadingDiv.style.top=o.top+"px",r._loadingDiv.style.width=o.width+"px",r._loadingDiv.style.height=o.height+"px")}}return i.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=document.createElement("style");t.type="text/css",t.innerHTML=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`,document.getElementsByTagName("head")[0].appendChild(t);var e=!!window.SVGSVGElement,n=new Image;i.DefaultLogoUrl?n.src=i.DefaultLogoUrl:n.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",n.style.width="150px",n.style.gridColumn="1",n.style.gridRow="1",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.position="absolute";var r=document.createElement("div");r.style.width="300px",r.style.gridColumn="1",r.style.gridRow="1",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.position="absolute";var o=new Image;if(i.DefaultSpinnerUrl?o.src=i.DefaultSpinnerUrl:o.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",o.style.animation="spin1 0.75s infinite linear",o.style.webkitAnimation="spin1 0.75s infinite linear",o.style.transformOrigin="50% 50%",o.style.webkitTransformOrigin="50% 50%",!e){var l={w:16,h:18.5},d={w:30,h:30};n.style.width=l.w+"vh",n.style.height=l.h+"vh",n.style.left="calc(50% - "+l.w/2+"vh)",n.style.top="calc(50% - "+l.h/2+"vh)",o.style.width=d.w+"vh",o.style.height=d.h+"vh",o.style.left="calc(50% - "+d.w/2+"vh)",o.style.top="calc(50% - "+d.h/2+"vh)"}r.appendChild(o),this._loadingDiv.appendChild(n),this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},i.prototype.hideLoadingUI=function(){var t=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){t._loadingDiv&&(t._loadingDiv.parentElement&&t._loadingDiv.parentElement.removeChild(t._loadingDiv),window.removeEventListener("resize",t._resizeLoadingUI),t._loadingDiv=null)}))},Object.defineProperty(i.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(t){this._loadingText=t,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(t){this._loadingDivBackgroundColor=t,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!1,configurable:!0}),i.DefaultLogoUrl="",i.DefaultSpinnerUrl="",i}();He.a.DefaultLoadingScreenFactory=function(i){return new m0(i)};var tm=c(71),Ra=c(68),nm=function(){function i(){}return i.ConvertPanoramaToCubemap=function(t,e,n,r){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*n*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(r,this.FACE_FRONT,t,e,n),back:this.CreateCubemapTexture(r,this.FACE_BACK,t,e,n),left:this.CreateCubemapTexture(r,this.FACE_LEFT,t,e,n),right:this.CreateCubemapTexture(r,this.FACE_RIGHT,t,e,n),up:this.CreateCubemapTexture(r,this.FACE_UP,t,e,n),down:this.CreateCubemapTexture(r,this.FACE_DOWN,t,e,n),size:r,type:g.a.TEXTURETYPE_FLOAT,format:g.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},i.CreateCubemapTexture=function(t,e,n,r,o){for(var l=new ArrayBuffer(t*t*4*3),d=new Float32Array(l),v=e[1].subtract(e[0]).scale(1/t),y=e[3].subtract(e[2]).scale(1/t),D=1/t,w=0,F=0;F<t;F++){for(var z=e[0],k=e[2],K=0;K<t;K++){var ae=k.subtract(z).scale(w).add(z);ae.normalize();var le=this.CalcProjectionSpherical(ae,n,r,o);d[F*t*3+3*K+0]=le.r,d[F*t*3+3*K+1]=le.g,d[F*t*3+3*K+2]=le.b,z=z.add(v),k=k.add(y)}w+=D}return d},i.CalcProjectionSpherical=function(t,e,n,r){for(var o=Math.atan2(t.z,t.x),l=Math.acos(t.y);o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;var d=o/Math.PI,v=l/Math.PI;d=.5*d+.5;var y=Math.round(d*n);y<0?y=0:y>=n&&(y=n-1);var D=Math.round(v*r);D<0?D=0:D>=r&&(D=r-1);var w=r-D-1;return{r:e[w*n*3+3*y+0],g:e[w*n*3+3*y+1],b:e[w*n*3+3*y+2]}},i.FACE_LEFT=[new h.e(-1,-1,-1),new h.e(1,-1,-1),new h.e(-1,1,-1),new h.e(1,1,-1)],i.FACE_RIGHT=[new h.e(1,-1,1),new h.e(-1,-1,1),new h.e(1,1,1),new h.e(-1,1,1)],i.FACE_FRONT=[new h.e(1,-1,-1),new h.e(1,-1,1),new h.e(1,1,-1),new h.e(1,1,1)],i.FACE_BACK=[new h.e(-1,-1,1),new h.e(-1,-1,-1),new h.e(-1,1,1),new h.e(-1,1,-1)],i.FACE_DOWN=[new h.e(1,1,-1),new h.e(1,1,1),new h.e(-1,1,-1),new h.e(-1,1,1)],i.FACE_UP=[new h.e(-1,-1,-1),new h.e(-1,-1,1),new h.e(1,-1,-1),new h.e(1,-1,1)],i}(),_0=function(){function i(){}return i.Ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},i.Rgbe2float=function(t,e,n,r,o,l){o>0?(o=this.Ldexp(1,o-136),t[l+0]=e*o,t[l+1]=n*o,t[l+2]=r*o):(t[l+0]=0,t[l+1]=0,t[l+2]=0)},i.readStringLine=function(t,e){for(var n="",r="",o=e;o<t.length-e&&(r=String.fromCharCode(t[o]))!=`
`;o++)n+=r;return n},i.RGBE_ReadHeader=function(t){var e,n,r=this.readStringLine(t,0);if(r[0]!="#"||r[1]!="?")throw"Bad HDR Format.";var o=!1,l=!1,d=0;do d+=r.length+1,(r=this.readStringLine(t,d))=="FORMAT=32-bit_rle_rgbe"?l=!0:r.length==0&&(o=!0);while(!o);if(!l)throw"HDR Bad header format, unsupported FORMAT";d+=r.length+1,r=this.readStringLine(t,d);var v=/^\-Y (.*) \+X (.*)$/g.exec(r);if(!v||v.length<3)throw"HDR Bad header format, no size";if(n=parseInt(v[2]),e=parseInt(v[1]),n<8||n>32767)throw"HDR Bad header format, unsupported size";return{height:e,width:n,dataPosition:d+=r.length+1}},i.GetCubeMapTextureData=function(t,e){var n=new Uint8Array(t),r=this.RGBE_ReadHeader(n),o=this.RGBE_ReadPixels(n,r);return nm.ConvertPanoramaToCubemap(o,r.width,r.height,e)},i.RGBE_ReadPixels=function(t,e){return this.RGBE_ReadPixels_RLE(t,e)},i.RGBE_ReadPixels_RLE=function(t,e){for(var n,r,o,l,d,v=e.height,y=e.width,D=e.dataPosition,w=0,F=0,z=0,k=new ArrayBuffer(4*y),K=new Uint8Array(k),ae=new ArrayBuffer(e.width*e.height*4*3),le=new Float32Array(ae);v>0;){if(n=t[D++],r=t[D++],o=t[D++],l=t[D++],n!=2||r!=2||128&o||e.width<8||e.width>32767)return this.RGBE_ReadPixels_NOT_RLE(t,e);if((o<<8|l)!=y)throw"HDR Bad header format, wrong scan line width";for(w=0,z=0;z<4;z++)for(F=(z+1)*y;w<F;)if(n=t[D++],r=t[D++],n>128){if((d=n-128)==0||d>F-w)throw"HDR Bad Format, bad scanline data (run)";for(;d-- >0;)K[w++]=r}else{if((d=n)==0||d>F-w)throw"HDR Bad Format, bad scanline data (non-run)";if(K[w++]=r,--d>0)for(var fe=0;fe<d;fe++)K[w++]=t[D++]}for(z=0;z<y;z++)n=K[z],r=K[z+y],o=K[z+2*y],l=K[z+3*y],this.Rgbe2float(le,n,r,o,l,(e.height-v)*y*3+3*z);v--}return le},i.RGBE_ReadPixels_NOT_RLE=function(t,e){for(var n,r,o,l,d,v=e.height,y=e.width,D=e.dataPosition,w=new ArrayBuffer(e.width*e.height*4*3),F=new Float32Array(w);v>0;){for(d=0;d<e.width;d++)n=t[D++],r=t[D++],o=t[D++],l=t[D++],this.Rgbe2float(F,n,r,o,l,(e.height-v)*y*3+3*d);v--}return F},i}(),g0=function(){function i(t,e){var n;e===void 0&&(e=i._DefaultOptions),this.engine=t,this._fullscreenViewport=new si.a(0,0,1,1),e=Object(f.a)(Object(f.a)({},i._DefaultOptions),e),this._vertexBuffers=((n={})[De.b.PositionKind]=new De.b(t,e.positions,De.b.PositionKind,!1,!1,2),n),this._indexBuffer=t.createIndexBuffer(e.indices)}return i.prototype.setViewport=function(t){t===void 0&&(t=this._fullscreenViewport),this.engine.setViewport(t)},i.prototype.bindBuffers=function(t){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,t)},i.prototype.applyEffectWrapper=function(t){this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(t.effect),this.bindBuffers(t.effect),t.onApplyObservable.notifyObservers({})},i.prototype.restoreStates=function(){this.engine.depthCullingState.depthTest=!0,this.engine.stencilState.stencilTest=!0},i.prototype.draw=function(){this.engine.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6)},i.prototype.isRenderTargetTexture=function(t){return t.renderList!==void 0},i.prototype.render=function(t,e){if(e===void 0&&(e=null),t.effect.isReady()){this.setViewport();var n=e===null?null:this.isRenderTargetTexture(e)?e.getInternalTexture():e;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(t),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}},i.prototype.dispose=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),delete this._vertexBuffers[De.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},i._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},i}(),v0=function(){function i(t){var e,n=this;this.onApplyObservable=new S.c;var r=t.uniformNames||[];t.vertexShader?e={fragmentSource:t.fragmentShader,vertexSource:t.vertexShader,spectorName:t.name||"effectWrapper"}:(r.push("scale"),e={fragmentSource:t.fragmentShader,vertex:"postprocess",spectorName:t.name||"effectWrapper"},this.onApplyObservable.add(function(){n.effect.setFloat2("scale",1,1)}));var o=t.defines?t.defines.join(`
`):"";t.useShaderStore?(e.fragment=e.fragmentSource,e.vertex||(e.vertex=e.vertexSource),delete e.fragmentSource,delete e.vertexSource,this.effect=t.engine.createEffect(e.spectorName,t.attributeNames||["position"],r,t.samplerNames,o,void 0,t.onCompiled)):this.effect=new Qe.a(e,t.attributeNames||["position"],r,t.samplerNames,t.engine,o,void 0,t.onCompiled)}return i.prototype.dispose=function(){this.effect.dispose()},i}(),nw=`
attribute vec2 position;

varying vec3 direction;

uniform vec3 up;
uniform vec3 right;
uniform vec3 front;
void main(void) {
mat3 view=mat3(up,right,front);
direction=view*vec3(position,1.0);
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.hdrFilteringVertexShader=nw;var rw=`#include<helperFunctions>
#include<importanceSampling>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
uniform float alphaG;
uniform samplerCube inputTexture;
uniform vec2 vFilteringInfo;
uniform float hdrScale;
varying vec3 direction;
void main() {
vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);
gl_FragColor=vec4(color*hdrScale,1.0);
}`;Qe.a.ShadersStore.hdrFilteringPixelShader=rw;var b0=function(){function i(t,e){e===void 0&&(e={}),this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=g.a.TEXTURE_FILTERING_QUALITY_OFFLINE,this.hdrScale=1,this._engine=t,this.hdrScale=e.hdrScale||this.hdrScale,this.quality=e.hdrScale||this.quality}return i.prototype._createRenderTarget=function(t){var e=g.a.TEXTURETYPE_UNSIGNED_BYTE;this._engine.getCaps().textureHalfFloatRender?e=g.a.TEXTURETYPE_HALF_FLOAT:this._engine.getCaps().textureFloatRender&&(e=g.a.TEXTURETYPE_FLOAT);var n=this._engine.createRenderTargetCubeTexture(t,{format:g.a.TEXTUREFORMAT_RGBA,type:e,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_NEAREST_SAMPLINGMODE});return this._engine.updateTextureWrappingMode(n,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE),this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!0),n},i.prototype._prefilterInternal=function(t){var e=t.getSize().width,n=Math.round(J.a.Log2(e))+1,r=this._effectWrapper.effect,o=this._createRenderTarget(e);this._effectRenderer.setViewport();var l=t.getInternalTexture();l&&this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,l,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var d=[[new h.e(0,0,-1),new h.e(0,-1,0),new h.e(1,0,0)],[new h.e(0,0,1),new h.e(0,-1,0),new h.e(-1,0,0)],[new h.e(1,0,0),new h.e(0,0,1),new h.e(0,1,0)],[new h.e(1,0,0),new h.e(0,0,-1),new h.e(0,-1,0)],[new h.e(1,0,0),new h.e(0,-1,0),new h.e(0,0,1)],[new h.e(-1,0,0),new h.e(0,-1,0),new h.e(0,0,-1)]];r.setFloat("hdrScale",this.hdrScale),r.setFloat2("vFilteringInfo",t.getSize().width,n),r.setTexture("inputTexture",t);for(var v=0;v<6;v++){r.setVector3("up",d[v][0]),r.setVector3("right",d[v][1]),r.setVector3("front",d[v][2]);for(var y=0;y<n;y++){this._engine.bindFramebuffer(o,v,void 0,void 0,!0,y),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var D=Math.pow(2,(y-this._lodGenerationOffset)/this._lodGenerationScale)/e;y===0&&(D=0),r.setFloat("alphaG",D),this._effectRenderer.draw()}}return this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseFramebufferObjects(o),this._engine._releaseTexture(t._texture),o._swapAndDie(t._texture),t._prefiltered=!0,t},i.prototype._createEffect=function(t,e){var n=[];return t.gammaSpace&&n.push("#define GAMMA_INPUT"),n.push("#define NUM_SAMPLES "+this.quality+"u"),new v0({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:n,onCompiled:e})},i.prototype.isReady=function(t){return t.isReady()&&this._effectWrapper.effect.isReady()},i.prototype.prefilter=function(t,e){var n=this;if(e===void 0&&(e=null),this._engine.webGLVersion!==1)return new Promise(function(r){n._effectRenderer=new g0(n._engine),n._effectWrapper=n._createEffect(t),n._effectWrapper.effect.executeWhenCompiled(function(){n._prefilterInternal(t),n._effectRenderer.dispose(),n._effectWrapper.dispose(),r(),e&&e()})});_.a.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.")},i}(),mh=function(i){function t(e,n,r,o,l,d,v,y,D){var w;o===void 0&&(o=!1),l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=!1),y===void 0&&(y=null),D===void 0&&(D=null);var F=i.call(this,n)||this;return F._generateHarmonics=!0,F._onLoad=null,F._onError=null,F._isBlocking=!0,F._rotationY=0,F.boundingBoxPosition=h.e.Zero(),e&&(F._coordinatesMode=ke.a.CUBIC_MODE,F.name=e,F.url=e,F.hasAlpha=!1,F.isCube=!0,F._textureMatrix=h.a.Identity(),F._prefilterOnLoad=v,F._onLoad=y,F._onError=D,F.gammaSpace=d,F._noMipmap=o,F._size=r,F._generateHarmonics=l,F._texture=F._getFromCache(e,F._noMipmap),F._texture?y&&(F._texture.isReady?et.b.SetImmediate(function(){return y()}):F._texture.onLoadedObservable.add(y)):((w=F.getScene())===null||w===void 0?void 0:w.useDelayedTextureLoading)?F.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:F.loadTexture()),F}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(h.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var e=this,n=this._getEngine();if(this._getEngine().webGLVersion>=2&&this._prefilterOnLoad){var r=this._onLoad,o=new b0(n);this._onLoad=function(){o.prefilter(e,r)}}this._texture=n.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,g.a.TEXTUREFORMAT_RGB,n.getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(l){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var d=_0.GetCubeMapTextureData(l,e._size);if(e._generateHarmonics){var v=$u.ConvertCubeMapToSphericalPolynomial(d);e.sphericalPolynomial=v}for(var y=[],D=null,w=0;w<6;w++){if(!n.getCaps().textureFloat){var F=new ArrayBuffer(e._size*e._size*3);D=new Uint8Array(F)}var z=d[t._facesMapping[w]];if(e.gammaSpace||D){for(var k=0;k<e._size*e._size;k++)if(e.gammaSpace&&(z[3*k+0]=Math.pow(z[3*k+0],Zt.b),z[3*k+1]=Math.pow(z[3*k+1],Zt.b),z[3*k+2]=Math.pow(z[3*k+2],Zt.b)),D){var K=Math.max(255*z[3*k+0],0),ae=Math.max(255*z[3*k+1],0),le=Math.max(255*z[3*k+2],0),fe=Math.max(Math.max(K,ae),le);if(fe>255){var me=255/fe;K*=me,ae*=me,le*=me}D[3*k+0]=K,D[3*k+1]=ae,D[3*k+2]=le}}D?y.push(D):y.push(z)}return y},null,this._onLoad,this._onError)},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1}))},t.Parse=function(e,n,r){var o=null;return e.name&&!e.isRenderTarget&&((o=new t(r+e.name,n,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,o.hasAlpha=e.hasAlpha,o.level=e.level,o.coordinatesMode=e.coordinatesMode,o.isBlocking=e.isBlocking),o&&(e.boundingBoxPosition&&(o.boundingBoxPosition=h.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=h.e.FromArray(e.boundingBoxSize)),e.rotationY&&(o.rotationY=e.rotationY)),o},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._facesMapping=["right","left","up","down","front","back"],t}(Zr.a);R.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=mh;var y0=function(){function i(t,e,n){e===void 0&&(e=0),n===void 0&&(n=null),this.name=t,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new S.c,this._onDataLayoutChanged=new S.c,this._animationPropertiesOverride=null,this._scene=n||re.a.LastCreatedScene,this.influence=e,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"influence",{get:function(){return this._influence},set:function(t){if(this._influence!==t){var e=this._influence;this._influence=t,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(e===0||t===0)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),i.prototype.setPositions=function(t){var e=this.hasPositions;this._positions=t,e!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getPositions=function(){return this._positions},i.prototype.setNormals=function(t){var e=this.hasNormals;this._normals=t,e!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getNormals=function(){return this._normals},i.prototype.setTangents=function(t){var e=this.hasTangents;this._tangents=t,e!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getTangents=function(){return this._tangents},i.prototype.setUVs=function(t){var e=this.hasUVs;this._uvs=t,e!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getUVs=function(){return this._uvs},i.prototype.clone=function(){var t=this,e=B.a.Clone(function(){return new i(t.name,t.influence,t._scene)},this);return e._positions=this._positions,e._normals=this._normals,e._tangents=this._tangents,e._uvs=this._uvs,e},i.prototype.serialize=function(){var t={};return t.name=this.name,t.influence=this.influence,t.positions=Array.prototype.slice.call(this.getPositions()),this.id!=null&&(t.id=this.id),this.hasNormals&&(t.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(t.uvs=Array.prototype.slice.call(this.getUVs())),B.a.AppendSerializedAnimations(this,t),t},i.prototype.getClassName=function(){return"MorphTarget"},i.Parse=function(t){var e=new i(t.name,t.influence);if(e.setPositions(t.positions),t.id!=null&&(e.id=t.id),t.normals&&e.setNormals(t.normals),t.tangents&&e.setTangents(t.tangents),t.uvs&&e.setUVs(t.uvs),t.animations)for(var n=0;n<t.animations.length;n++){var r=t.animations[n],o=R.a.GetClass("BABYLON.Animation");o&&e.animations.push(o.Parse(r))}return e},i.FromMesh=function(t,e,n){e||(e=t.name);var r=new i(e,n,t.getScene());return r.setPositions(t.getVerticesData(De.b.PositionKind)),t.isVerticesDataPresent(De.b.NormalKind)&&r.setNormals(t.getVerticesData(De.b.NormalKind)),t.isVerticesDataPresent(De.b.TangentKind)&&r.setTangents(t.getVerticesData(De.b.TangentKind)),t.isVerticesDataPresent(De.b.UVKind)&&r.setUVs(t.getVerticesData(De.b.UVKind)),r},Object(f.c)([Object(B.c)()],i.prototype,"id",void 0),i}(),_h=function(){function i(t){t===void 0&&(t=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Gn.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,t||(t=re.a.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),i.prototype.getActiveTarget=function(t){return this._activeTargets.data[t]},i.prototype.getTarget=function(t){return this._targets[t]},i.prototype.addTarget=function(t){var e=this;this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add(function(n){e._syncActiveTargets(n)})),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add(function(){e._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},i.prototype.removeTarget=function(t){var e=this._targets.indexOf(t);e>=0&&(this._targets.splice(e,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(e,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(e,1)[0]),this._syncActiveTargets(!0))},i.prototype.clone=function(){for(var t=new i(this._scene),e=0,n=this._targets;e<n.length;e++){var r=n[e];t.addTarget(r.clone())}return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t},i.prototype.serialize=function(){var t={};t.id=this.uniqueId,t.targets=[];for(var e=0,n=this._targets;e<n.length;e++){var r=n[e];t.targets.push(r.serialize())}return t},i.prototype._syncActiveTargets=function(t){var e=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var n=0,r=this._targets;n<r.length;n++){var o=r[n];if(o.influence!==0){this._activeTargets.push(o),this._tempInfluences[e++]=o.influence,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs;var l=o.getPositions();if(l){var d=l.length/3;if(this._vertexCount===0)this._vertexCount=d;else if(this._vertexCount!==d)return void _.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(var v=0;v<e;v++)this._influences[v]=this._tempInfluences[v];t&&this.synchronize()},i.prototype.synchronize=function(){if(this._scene)for(var t=0,e=this._scene.meshes;t<e.length;t++){var n=e[t];n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}},i.Parse=function(t,e){var n=new i(e);n._uniqueId=t.id;for(var r=0,o=t.targets;r<o.length;r++){var l=o[r];n.addTarget(y0.Parse(l))}return n},i}(),Ut=c(32),Fn=c(50),xs=function(){function i(t,e){if(e===void 0&&(e=i.DefaultPluginFactory()),this._physicsPlugin=e,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new h.e(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return i.DefaultPluginFactory=function(){throw dr.a.WarnImport("CannonJSPlugin")},i.prototype.setGravity=function(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)},i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._physicsPlugin.setTimeStep(t)},i.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},i.prototype.setSubTimeStep=function(t){t===void 0&&(t=0),this._subTimeStep=t},i.prototype.getSubTimeStep=function(){return this._subTimeStep},i.prototype.dispose=function(){this._impostors.forEach(function(t){t.dispose()}),this._physicsPlugin.dispose()},i.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},i.prototype.addImpostor=function(t){t.uniqueId=this._impostors.push(t),t.parent||this._physicsPlugin.generatePhysicsBody(t)},i.prototype.removeImpostor=function(t){var e=this._impostors.indexOf(t);e>-1&&this._impostors.splice(e,1).length&&this.getPhysicsPlugin().removePhysicsBody(t)},i.prototype.addJoint=function(t,e,n){var r={mainImpostor:t,connectedImpostor:e,joint:n};n.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},i.prototype.removeJoint=function(t,e,n){var r=this._joints.filter(function(o){return o.connectedImpostor===e&&o.joint===n&&o.mainImpostor===t});r.length&&this._physicsPlugin.removeJoint(r[0])},i.prototype._step=function(t){var e=this;this._impostors.forEach(function(n){n.isBodyInitRequired()&&e._physicsPlugin.generatePhysicsBody(n)}),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)},i.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},i.prototype.getImpostors=function(){return this._impostors},i.prototype.getImpostorForPhysicsObject=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].object===t)return this._impostors[e];return null},i.prototype.getImpostorWithPhysicsBody=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].physicsBody===t)return this._impostors[e];return null},i.prototype.raycast=function(t,e){return this._physicsPlugin.raycast(t,e)},i.Epsilon=.001,i}(),rm=function(){function i(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=h.e.Zero(),this._hitPointWorld=h.e.Zero(),this._rayFromWorld=h.e.Zero(),this._rayToWorld=h.e.Zero()}return Object.defineProperty(i.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0}),i.prototype.setHitData=function(t,e){this._hasHit=!0,this._hitNormalWorld=new h.e(t.x,t.y,t.z),this._hitPointWorld=new h.e(e.x,e.y,e.z)},i.prototype.setHitDistance=function(t){this._hitDistance=t},i.prototype.calculateHitDistance=function(){this._hitDistance=h.e.Distance(this._rayFromWorld,this._hitPointWorld)},i.prototype.reset=function(t,e){t===void 0&&(t=h.e.Zero()),e===void 0&&(e=h.e.Zero()),this._rayFromWorld=t,this._rayToWorld=e,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=h.e.Zero(),this._hitPointWorld=h.e.Zero()},i}(),im=function(){function i(t,e,n){t===void 0&&(t=!0),e===void 0&&(e=10),n===void 0&&(n=CANNON),this._useDeltaForWorldStep=t,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._firstFrame=!0,this._minus90X=new h.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new h.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=h.e.Zero(),this._tmpDeltaPosition=h.e.Zero(),this._tmpUnityRotation=new h.b,this.BJSCANNON=n,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=e,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new rm):_.a.Error("CannonJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){var e=t;this.world.gravity.set(e.x,e.y,e.z)},i.prototype.setTimeStep=function(t){this._fixedTimeStep=t},i.prototype.getTimeStep=function(){return this._fixedTimeStep},i.prototype.executeStep=function(t,e){if(this._firstFrame){this._firstFrame=!1;for(var n=0,r=e;n<r.length;n++){var o=r[n];o.type!=Ut.a.HeightmapImpostor&&o.type!==Ut.a.PlaneImpostor&&o.beforeStep()}}this.world.step(this._useDeltaForWorldStep?t:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()},i.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var t=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach(function(e){t.world.remove(e)}),this._physicsBodysToRemoveAfterStep=[])},i.prototype.applyImpulse=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyImpulse(o,r)},i.prototype.applyForce=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyForce(o,r)},i.prototype.generatePhysicsBody=function(t){if(this._removeMarkedPhysicsBodiesFromWorld(),t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.physicsBody;n&&this.removePhysicsBody(t);var r=this._addMaterial("mat-"+t.uniqueId,t.getParam("friction"),t.getParam("restitution")),o={mass:t.getParam("mass"),material:r},l=t.getParam("nativeOptions");for(var d in l)l.hasOwnProperty(d)&&(o[d]=l[d]);t.physicsBody=new this.BJSCANNON.Body(o),t.physicsBody.addEventListener("collide",t.onCollide),this.world.addEventListener("preStep",t.beforeStep),this.world.addEventListener("postStep",t.afterStep),t.physicsBody.addShape(e),this.world.add(t.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(v){var y=n[v];t.physicsBody[v].set(y.x,y.y,y.z)}),this._processChildMeshes(t)}this._updatePhysicsBodyTransformation(t)}},i.prototype._processChildMeshes=function(t){var e=this,n=t.object.getChildMeshes?t.object.getChildMeshes(!0):[],r=t.object.rotationQuaternion;if(n.length){var o=function(l){if(r&&l.rotationQuaternion){var d=l.getPhysicsImpostor();if(d&&d.parent!==t){var v=l.getAbsolutePosition().subtract(l.parent.getAbsolutePosition()),y=l.rotationQuaternion;d.physicsBody&&(e.removePhysicsBody(d),d.physicsBody=null),d.parent=t,d.resetUpdateFlags(),t.physicsBody.addShape(e._createShape(d),new e.BJSCANNON.Vec3(v.x,v.y,v.z),new e.BJSCANNON.Quaternion(y.x,y.y,y.z,y.w)),t.physicsBody.mass+=d.getParam("mass")}r.multiplyInPlace(l.rotationQuaternion),l.getChildMeshes(!0).filter(function(D){return!!D.physicsImpostor}).forEach(o)}};n.filter(function(l){return!!l.physicsImpostor}).forEach(o)}},i.prototype.removePhysicsBody=function(t){t.physicsBody.removeEventListener("collide",t.onCollide),this.world.removeEventListener("preStep",t.beforeStep),this.world.removeEventListener("postStep",t.afterStep),this._physicsBodysToRemoveAfterStep.indexOf(t.physicsBody)===-1&&this._physicsBodysToRemoveAfterStep.push(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,l={pivotA:o.mainPivot?new this.BJSCANNON.Vec3().set(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z):null,pivotB:o.connectedPivot?new this.BJSCANNON.Vec3().set(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z):null,axisA:o.mainAxis?new this.BJSCANNON.Vec3().set(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z):null,axisB:o.connectedAxis?new this.BJSCANNON.Vec3().set(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(t.joint.type){case Fn.e.HingeJoint:case Fn.e.Hinge2Joint:r=new this.BJSCANNON.HingeConstraint(e,n,l);break;case Fn.e.DistanceJoint:r=new this.BJSCANNON.DistanceConstraint(e,n,o.maxDistance||2);break;case Fn.e.SpringJoint:var d=o;r=new this.BJSCANNON.Spring(e,n,{restLength:d.length,stiffness:d.stiffness,damping:d.damping,localAnchorA:l.pivotA,localAnchorB:l.pivotB});break;case Fn.e.LockJoint:r=new this.BJSCANNON.LockConstraint(e,n,l);break;case Fn.e.PointToPointJoint:case Fn.e.BallAndSocketJoint:default:r=new this.BJSCANNON.PointToPointConstraint(e,l.pivotA,n,l.pivotB,l.maxForce)}r.collideConnected=!!o.collision,t.joint.physicsJoint=r,t.joint.type!==Fn.e.SpringJoint?this.world.addConstraint(r):(t.joint.jointData.forceApplicationCallback=t.joint.jointData.forceApplicationCallback||function(){r.applyForce()},t.mainImpostor.registerAfterPhysicsStep(t.joint.jointData.forceApplicationCallback))}},i.prototype.removeJoint=function(t){t.joint.type!==Fn.e.SpringJoint?this.world.removeConstraint(t.joint.physicsJoint):t.mainImpostor.unregisterAfterPhysicsStep(t.joint.jointData.forceApplicationCallback)},i.prototype._addMaterial=function(t,e,n){var r,o;for(r=0;r<this._physicsMaterials.length;r++)if((o=this._physicsMaterials[r]).friction===e&&o.restitution===n)return o;var l=new this.BJSCANNON.Material(t);return l.friction=e,l.restitution=n,this._physicsMaterials.push(l),l},i.prototype._checkWithEpsilon=function(t){return t<xs.Epsilon?xs.Epsilon:t},i.prototype._createShape=function(t){var e,n=t.object,r=t.getObjectExtendSize();switch(t.type){case Ut.a.SphereImpostor:var o=r.x,l=r.y,d=r.z;e=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(l),this._checkWithEpsilon(d))/2);break;case Ut.a.CylinderImpostor:var v=t.getParam("nativeOptions");v||(v={});var y=v.radiusTop!==void 0?v.radiusTop:this._checkWithEpsilon(r.x)/2,D=v.radiusBottom!==void 0?v.radiusBottom:this._checkWithEpsilon(r.x)/2,w=v.height!==void 0?v.height:this._checkWithEpsilon(r.y),F=v.numSegments!==void 0?v.numSegments:16;e=new this.BJSCANNON.Cylinder(y,D,w,F);var z=new this.BJSCANNON.Quaternion;z.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var k=new this.BJSCANNON.Vec3(0,0,0);e.transformAllPoints(k,z);break;case Ut.a.BoxImpostor:var K=r.scale(.5);e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(K.x),this._checkWithEpsilon(K.y),this._checkWithEpsilon(K.z)));break;case Ut.a.PlaneImpostor:_.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),e=new this.BJSCANNON.Plane;break;case Ut.a.MeshImpostor:var ae=n.getVerticesData?n.getVerticesData(De.b.PositionKind):[],le=n.getIndices?n.getIndices():[];if(!ae)return;var fe=n.position.clone(),me=n.rotation&&n.rotation.clone(),be=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace();var Ee,xe=n.computeWorldMatrix(!0),Ae=new Array;for(Ee=0;Ee<ae.length;Ee+=3)h.e.TransformCoordinates(h.e.FromArray(ae,Ee),xe).toArray(Ae,Ee);_.a.Warn("MeshImpostor only collides against spheres."),e=new this.BJSCANNON.Trimesh(Ae,le),n.position.copyFrom(fe),me&&n.rotation&&n.rotation.copyFrom(me),be&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(be);break;case Ut.a.HeightmapImpostor:var Ie=n.position.clone(),Re=n.rotation&&n.rotation.clone(),Pe=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace(),n.rotationQuaternion&&n.rotationQuaternion.multiplyInPlace(this._minus90X),e=this._createHeightmap(n),n.position.copyFrom(Ie),Re&&n.rotation&&n.rotation.copyFrom(Re),Pe&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(Pe),n.computeWorldMatrix(!0);break;case Ut.a.ParticleImpostor:e=new this.BJSCANNON.Particle;break;case Ut.a.NoImpostor:e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return e},i.prototype._createHeightmap=function(t,e){var n,r=t.getVerticesData(De.b.PositionKind),o=t.computeWorldMatrix(!0),l=new Array;for(n=0;n<r.length;n+=3)h.e.TransformCoordinates(h.e.FromArray(r,n),o).toArray(l,n);r=l;for(var d=new Array,v=e||~~(Math.sqrt(r.length/3)-1),y=t.getBoundingInfo(),D=Math.min(y.boundingBox.extendSizeWorld.x,y.boundingBox.extendSizeWorld.y),w=y.boundingBox.extendSizeWorld.z,F=2*D/v,z=0;z<r.length;z+=3){var k=Math.round(r[z+0]/F+v/2),K=Math.round(-1*(r[z+1]/F-v/2)),ae=-r[z+2]+w;d[k]||(d[k]=[]),d[k][K]||(d[k][K]=ae),d[k][K]=Math.max(ae,d[k][K])}for(k=0;k<=v;++k){if(!d[k]){for(var le=1;!d[(k+le)%v];)le++;d[k]=d[(k+le)%v].slice()}for(K=0;K<=v;++K)if(!d[k][K]){var fe;for(le=1;fe===void 0;)fe=d[k][(K+le++)%v];d[k][K]=fe}}var me=new this.BJSCANNON.Heightfield(d,{elementSize:F});return me.minY=w,me},i.prototype._updatePhysicsBodyTransformation=function(t){var e=t.object;if(e.computeWorldMatrix&&e.computeWorldMatrix(!0),e.getBoundingInfo()){var n=t.getObjectCenter();this._tmpDeltaPosition.copyFrom(e.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(t.object.scaling),this._tmpPosition.copyFrom(n);var r=e.rotationQuaternion;if(r){if(t.type!==Ut.a.PlaneImpostor&&t.type!==Ut.a.HeightmapImpostor||(r=r.multiply(this._minus90X),t.setDeltaRotation(this._plus90X)),t.type===Ut.a.HeightmapImpostor){var o=e,l=o.getBoundingInfo(),d=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var v=n.clone(),y=o.getPivotMatrix();y=y?y.clone():h.a.Identity();var D=h.a.Translation(l.boundingBox.extendSizeWorld.x,0,-l.boundingBox.extendSizeWorld.z);o.setPreTransformMatrix(D),o.computeWorldMatrix(!0);var w=l.boundingBox.centerWorld.subtract(n).subtract(o.position).negate();this._tmpPosition.copyFromFloats(w.x,w.y-l.boundingBox.extendSizeWorld.y,w.z),this._tmpDeltaPosition.copyFrom(l.boundingBox.centerWorld.subtract(v)),this._tmpDeltaPosition.y+=l.boundingBox.extendSizeWorld.y,o.rotationQuaternion=d,o.setPreTransformMatrix(y),o.computeWorldMatrix(!0)}else t.type===Ut.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpDeltaPosition),t.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),t.physicsBody.quaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setTransformationFromPhysicsBody=function(t){if(t.object.position.set(t.physicsBody.position.x,t.physicsBody.position.y,t.physicsBody.position.z),t.object.rotationQuaternion){var e=t.physicsBody.quaternion;t.object.rotationQuaternion.set(e.x,e.y,e.z,e.w)}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){t.physicsBody.position.set(e.x,e.y,e.z),t.physicsBody.quaternion.set(n.x,n.y,n.z,n.w)},i.prototype.isSupported=function(){return this.BJSCANNON!==void 0},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.velocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.velocity;return e?new h.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new h.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){t.physicsBody.mass=e,t.physicsBody.updateMassProperties()},i.prototype.getBodyMass=function(t){return t.physicsBody.mass},i.prototype.getBodyFriction=function(t){return t.physicsBody.material.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.material.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.material.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.material.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.wakeUp()},i.prototype.updateDistanceJoint=function(t,e){t.physicsJoint.distance=e},i.prototype.setMotor=function(t,e,n,r){r||(t.physicsJoint.enableMotor(),t.physicsJoint.setMotorSpeed(e),n&&this.setLimit(t,n))},i.prototype.setLimit=function(t,e,n){t.physicsJoint.motorEquation.maxForce=e,t.physicsJoint.motorEquation.minForce=n===void 0?-e:n},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.quaternion.x,t.rotationQuaternion.y=n.quaternion.y,t.rotationQuaternion.z=n.quaternion.z,t.rotationQuaternion.w=n.quaternion.w)},i.prototype.getRadius=function(t){return t.physicsBody.shapes[0].boundingSphereRadius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes[0];e.x=2*n.halfExtents.x,e.y=2*n.halfExtents.y,e.z=2*n.halfExtents.z},i.prototype.dispose=function(){},i.prototype._extendNamespace=function(){var t=new this.BJSCANNON.Vec3,e=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,r,o){if(o=o||10,(r=r||0)===0)this.internalStep(n),this.time+=n;else{var l=Math.floor((this.time+r)/n)-Math.floor(this.time/n);l=Math.min(l,o)||1;for(var d=performance.now(),v=0;v!==l&&(this.internalStep(n),!(performance.now()-d>1e3*n));v++);this.time+=r;for(var y=this.time%n/n,D=t,w=this.bodies,F=0;F!==w.length;F++){var z=w[F];z.type!==e.Body.STATIC&&z.sleepState!==e.Body.SLEEPING?(z.position.vsub(z.previousPosition,D),D.scale(y,D),z.position.vadd(D,z.interpolatedPosition)):(z.interpolatedPosition.set(z.position.x,z.position.y,z.position.z),z.interpolatedQuaternion.set(z.quaternion.x,z.quaternion.y,z.quaternion.z,z.quaternion.w))}}}},i.prototype.raycast=function(t,e){return this._cannonRaycastResult.reset(),this.world.raycastClosest(t,e,{},this._cannonRaycastResult),this._raycastResult.reset(t,e),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},i}();xs.DefaultPluginFactory=function(){return new im};var T0=function(){function i(t,e,n){t===void 0&&(t=!0),n===void 0&&(n=OIMO),this._useDeltaForWorldStep=t,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=h.e.Zero(),this.BJSOIMO=n,this.world=new this.BJSOIMO.World({iterations:e}),this.world.clear(),this._raycastResult=new rm}return i.prototype.setGravity=function(t){this.world.gravity.set(t.x,t.y,t.z)},i.prototype.setTimeStep=function(t){this.world.timeStep=t},i.prototype.getTimeStep=function(){return this.world.timeStep},i.prototype.executeStep=function(t,e){var n=this;e.forEach(function(d){d.beforeStep()}),this.world.timeStep=this._useDeltaForWorldStep?t:this._fixedTimeStep,this.world.step(),e.forEach(function(d){d.afterStep(),n._tmpImpostorsArray[d.uniqueId]=d});for(var r=this.world.contacts;r!==null;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var o=this._tmpImpostorsArray[+r.body1.name],l=this._tmpImpostorsArray[+r.body2.name];o&&l&&(o.onCollide({body:l.physicsBody,point:null}),l.onCollide({body:o.physicsBody,point:null})),r=r.next}else r=r.next},i.prototype.applyImpulse=function(t,e,n){var r=t.physicsBody.mass;t.physicsBody.applyImpulse(n.scale(this.world.invScale),e.scale(this.world.invScale*r))},i.prototype.applyForce=function(t,e,n){_.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,e,n)},i.prototype.generatePhysicsBody=function(t){var e=this;if(t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var n={name:t.uniqueId,config:[t.getParam("mass")||.001,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:t.getParam("mass")!==0,density:t.getParam("mass"),friction:t.getParam("friction"),restitution:t.getParam("restitution"),world:this.world},r=[t];(d=t.object).getChildMeshes&&d.getChildMeshes().forEach(function(v){v.physicsImpostor&&r.push(v.physicsImpostor)});var o=function(v){return Math.max(v,xs.Epsilon)},l=new h.b;r.forEach(function(v){if(v.object.rotationQuaternion){var y=v.object.rotationQuaternion;l.copyFrom(y),v.object.rotationQuaternion.set(0,0,0,1),v.object.computeWorldMatrix(!0);var D=l.toEulerAngles(),w=v.getObjectExtendSize();if(v===t){var F=t.getObjectCenter();t.object.getAbsolutePivotPoint().subtractToRef(F,e._tmpPositionVector),e._tmpPositionVector.divideInPlace(t.object.scaling),n.pos.push(F.x),n.pos.push(F.y),n.pos.push(F.z),n.posShape.push(0,0,0),n.rotShape.push(0,0,0)}else{var z=v.object.position.clone();n.posShape.push(z.x),n.posShape.push(z.y),n.posShape.push(z.z),n.rotShape.push(57.29577951308232*D.x,57.29577951308232*D.y,57.29577951308232*D.z)}switch(v.object.rotationQuaternion.copyFrom(l),v.type){case Ut.a.ParticleImpostor:_.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case Ut.a.SphereImpostor:var k=w.x,K=w.y,ae=w.z,le=Math.max(o(k),o(K),o(ae))/2;n.type.push("sphere"),n.size.push(le),n.size.push(le),n.size.push(le);break;case Ut.a.CylinderImpostor:var fe=o(w.x)/2,me=o(w.y);n.type.push("cylinder"),n.size.push(fe),n.size.push(me),n.size.push(me);break;case Ut.a.PlaneImpostor:case Ut.a.BoxImpostor:default:fe=o(w.x),me=o(w.y);var be=o(w.z);n.type.push("box"),n.size.push(fe),n.size.push(me),n.size.push(be)}v.object.rotationQuaternion=y}}),t.physicsBody=this.world.add(n),t.physicsBody.resetQuaternion(l),t.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var d;t.setDeltaPosition(this._tmpPositionVector)}},i.prototype.removePhysicsBody=function(t){this.world.removeRigidBody(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,l=o.nativeParams||{},d={body1:e,body2:n,axe1:l.axe1||(o.mainAxis?o.mainAxis.asArray():null),axe2:l.axe2||(o.connectedAxis?o.connectedAxis.asArray():null),pos1:l.pos1||(o.mainPivot?o.mainPivot.asArray():null),pos2:l.pos2||(o.connectedPivot?o.connectedPivot.asArray():null),min:l.min,max:l.max,collision:l.collision||o.collision,spring:l.spring,world:this.world};switch(t.joint.type){case Fn.e.BallAndSocketJoint:r="jointBall";break;case Fn.e.SpringJoint:_.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var v=o;d.min=v.length||d.min,d.max=Math.max(d.min,d.max);case Fn.e.DistanceJoint:r="jointDistance",d.max=o.maxDistance;break;case Fn.e.PrismaticJoint:r="jointPrisme";break;case Fn.e.SliderJoint:r="jointSlide";break;case Fn.e.WheelJoint:r="jointWheel";break;case Fn.e.HingeJoint:default:r="jointHinge"}d.type=r,t.joint.physicsJoint=this.world.add(d)}},i.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(e){_.a.Warn(e)}},i.prototype.isSupported=function(){return this.BJSOIMO!==void 0},i.prototype.setTransformationFromPhysicsBody=function(t){if(!t.physicsBody.sleeping){if(t.physicsBody.shapes.next){for(var e=t.physicsBody.shapes;e.next;)e=e.next;t.object.position.set(e.position.x,e.position.y,e.position.z)}else{var n=t.physicsBody.getPosition();t.object.position.set(n.x,n.y,n.z)}if(t.object.rotationQuaternion){var r=t.physicsBody.getQuaternion();t.object.rotationQuaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody;t.physicsBody.shapes.next||(r.position.set(e.x,e.y,e.z),r.orientation.set(n.x,n.y,n.z,n.w),r.syncShapes(),r.awake())},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.linearVelocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.linearVelocity;return e?new h.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new h.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){var n=e===0;t.physicsBody.shapes.density=n?1:e,t.physicsBody.setupMass(n?2:1)},i.prototype.getBodyMass=function(t){return t.physicsBody.shapes.density},i.prototype.getBodyFriction=function(t){return t.physicsBody.shapes.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.shapes.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.shapes.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.shapes.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.awake()},i.prototype.updateDistanceJoint=function(t,e,n){t.physicsJoint.limitMotor.upperLimit=e,n!==void 0&&(t.physicsJoint.limitMotor.lowerLimit=n)},i.prototype.setMotor=function(t,e,n,r){n!==void 0?_.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):n=1e6,e*=-1;var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setMotor(e,n)},i.prototype.setLimit=function(t,e,n,r){var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setLimit(e,n===void 0?-e:n)},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.orientation.x,t.rotationQuaternion.y=n.orientation.y,t.rotationQuaternion.z=n.orientation.z,t.rotationQuaternion.w=n.orientation.s)},i.prototype.getRadius=function(t){return t.physicsBody.shapes.radius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes;e.x=2*n.halfWidth,e.y=2*n.halfHeight,e.z=2*n.halfDepth},i.prototype.dispose=function(){this.world.clear()},i.prototype.raycast=function(t,e){return _.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(t,e),this._raycastResult},i}(),gh=c(97),E0=function(){function i(t,e,n){var r=this;t===void 0&&(t=!0),e===void 0&&(e=Ammo),n===void 0&&(n=null),this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new h.b,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new h.e,this._tmpMatrix=new h.a,typeof e=="function"?e(this.bjsAMMO):this.bjsAMMO=e,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=n||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(o,l,d,v){var y=(o=r.bjsAMMO.wrapPointer(o,Ammo.btManifoldPoint)).getPositionWorldOnA();r._tmpContactPoint.x=y.x(),r._tmpContactPoint.y=y.y(),r._tmpContactPoint.z=y.z(),r._tmpContactCallbackResult=!0},this._raycastResult=new rm,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):_.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},i.prototype.setTimeStep=function(t){this._timeStep=t},i.prototype.setFixedTimeStep=function(t){this._fixedTimeStep=t},i.prototype.setMaxSteps=function(t){this._maxSteps=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype._isImpostorInContact=function(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._isImpostorPairInContact=function(t,e){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._stepSimulation=function(t,e,n){if(t===void 0&&(t=1/60),e===void 0&&(e=10),n===void 0&&(n=1/60),e==0)this.world.stepSimulation(t,0);else for(;e>0&&t>0;)t-n<n?(this.world.stepSimulation(t,0),t=0):(t-=n,this.world.stepSimulation(n,0)),e--},i.prototype.executeStep=function(t,e){for(var n=0,r=e;n<r.length;n++){var o=r[n];o.soft||o.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var l=0,d=e;l<d.length;l++){var v=d[l];if(v.soft?this._afterSoftStep(v):v.afterStep(),v._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(v))for(var y=0,D=v._onPhysicsCollideCallbacks;y<D.length;y++)for(var w=0,F=D[y].otherImpostors;w<F.length;w++){var z=F[w];(v.physicsBody.isActive()||z.physicsBody.isActive())&&this._isImpostorPairInContact(v,z)&&(v.onCollide({body:z.physicsBody,point:this._tmpContactPoint}),z.onCollide({body:v.physicsBody,point:this._tmpContactPoint}))}}},i.prototype._afterSoftStep=function(t){t.type===Ut.a.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)},i.prototype._ropeStep=function(t){for(var e,n,r,o,l=t.physicsBody.get_m_nodes(),d=l.size(),v=new Array,y=0;y<d;y++)n=(e=l.at(y).get_m_x()).x(),r=e.y(),o=e.z(),v.push(new h.e(n,r,o));var D=t.object,w=t.getParam("shape");t._isFromLine?t.object=Jn.a.CreateLines("lines",{points:v,instance:D}):t.object=gh.a.ExtrudeShape("ext",{shape:w,path:v,instance:D})},i.prototype._softbodyOrClothStep=function(t){var e=t.type===Ut.a.ClothImpostor?1:-1,n=t.object,r=n.getVerticesData(De.b.PositionKind);r||(r=[]);var o=n.getVerticesData(De.b.NormalKind);o||(o=[]);for(var l,d,v,y,D,w,F,z,k=r.length/3,K=t.physicsBody.get_m_nodes(),ae=0;ae<k;ae++){var le;v=(d=(l=K.at(ae)).get_m_x()).x(),y=d.y(),D=d.z()*e,w=(le=l.get_m_n()).x(),F=le.y(),z=le.z()*e,r[3*ae]=v,r[3*ae+1]=y,r[3*ae+2]=D,o[3*ae]=w,o[3*ae+1]=F,o[3*ae+2]=z}var fe=new Tt.a;fe.positions=r,fe.normals=o,fe.uvs=n.getVerticesData(De.b.UVKind),fe.colors=n.getVerticesData(De.b.ColorKind),n&&n.getIndices&&(fe.indices=n.getIndices()),fe.applyToMesh(n)},i.prototype.applyImpulse=function(t,e,n){if(t.soft)_.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyImpulse(o,r)}},i.prototype.applyForce=function(t,e,n){if(t.soft)_.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyForce(o,r)}},i.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.getParam("mass");if(t._pluginData.mass=n,t.soft)e.get_m_cfg().set_collisions(17),e.get_m_cfg().set_kDP(t.getParam("damping")),this.bjsAMMO.castObject(e,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),e.setActivationState(i.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(e,1,-1),t.physicsBody=e,t._pluginData.toDispose.push(e),this.setBodyPressure(t,0),t.type===Ut.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var r=new this.bjsAMMO.btVector3(0,0,0),o=new this.bjsAMMO.btTransform;o.setIdentity(),n!==0&&e.calculateLocalInertia(n,r),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),o.setOrigin(this._tmpAmmoVectorA),o.setRotation(this._tmpAmmoQuaternion);var l=new this.bjsAMMO.btDefaultMotionState(o),d=new this.bjsAMMO.btRigidBodyConstructionInfo(n,l,e,r),v=new this.bjsAMMO.btRigidBody(d);n===0&&(v.setCollisionFlags(v.getCollisionFlags()|i.KINEMATIC_FLAG),v.setActivationState(i.DISABLE_DEACTIVATION_FLAG)),t.type!=Ut.a.NoImpostor||e.getChildShape||v.setCollisionFlags(v.getCollisionFlags()|i.DISABLE_COLLISION_FLAG);var y=t.getParam("group"),D=t.getParam("mask");y&&D?this.world.addRigidBody(v,y,D):this.world.addRigidBody(v),t.physicsBody=v,t._pluginData.toDispose=t._pluginData.toDispose.concat([v,d,l,o,r,e])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},i.prototype.removePhysicsBody=function(t){var e=this;this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach(function(n){e.bjsAMMO.destroy(n)}),t._pluginData.toDispose=[]))},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData;switch(o.mainPivot||(o.mainPivot=new h.e(0,0,0)),o.connectedPivot||(o.connectedPivot=new h.e(0,0,0)),t.joint.type){case Fn.e.DistanceJoint:var l=o.maxDistance;l&&(o.mainPivot=new h.e(0,-l/2,0),o.connectedPivot=new h.e(0,l/2,0)),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;case Fn.e.HingeJoint:o.mainAxis||(o.mainAxis=new h.e(0,0,0)),o.connectedAxis||(o.connectedAxis=new h.e(0,0,0));var d=new this.bjsAMMO.btVector3(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z),v=new this.bjsAMMO.btVector3(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z);r=new this.bjsAMMO.btHingeConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z),d,v);break;case Fn.e.BallAndSocketJoint:r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;default:_.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z))}this.world.addConstraint(r,!t.joint.jointData.collision),t.joint.physicsJoint=r}},i.prototype.removeJoint=function(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)},i.prototype._addMeshVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var l=n.getIndices();l||(l=[]);var d=n.getVerticesData(De.b.PositionKind);d||(d=[]),n.computeWorldMatrix(!1);for(var v=l.length/3,y=0;y<v;y++){for(var D=[],w=0;w<3;w++){var F,z=new h.e(d[3*l[3*y+w]+0],d[3*l[3*y+w]+1],d[3*l[3*y+w]+2]);h.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),z=h.e.TransformCoordinates(z,this._tmpMatrix),(F=w==0?this._tmpAmmoVectorA:w==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(z.x,z.y,z.z),D.push(F)}t.addTriangle(D[0],D[1],D[2]),o++}n.getChildMeshes().forEach(function(k){o+=r._addMeshVerts(t,e,k)})}return o},i.prototype._softVertexData=function(t){var e=t.object;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){e.getIndices();var n=e.getVerticesData(De.b.PositionKind);n||(n=[]);var r=e.getVerticesData(De.b.NormalKind);r||(r=[]),e.computeWorldMatrix(!1);for(var o=[],l=[],d=0;d<n.length;d+=3){var v=new h.e(n[d],n[d+1],n[d+2]),y=new h.e(r[d],r[d+1],r[d+2]);v=h.e.TransformCoordinates(v,e.getWorldMatrix()),y=h.e.TransformNormal(y,e.getWorldMatrix()),o.push(v.x,v.y,v.z),l.push(y.x,y.y,y.z)}var D=new Tt.a;return D.positions=o,D.normals=l,D.uvs=e.getVerticesData(De.b.UVKind),D.colors=e.getVerticesData(De.b.ColorKind),e&&e.getIndices&&(D.indices=e.getIndices()),D.applyToMesh(e),e.position=h.e.Zero(),e.rotationQuaternion=null,e.rotation=h.e.Zero(),e.computeWorldMatrix(!0),D}return Tt.a.ExtractFromMesh(e)},i.prototype._createSoftbody=function(t){var e=t.object;if(e&&e.getIndices){var n=e.getIndices();n||(n=[]);var r=this._softVertexData(t),o=r.positions,l=r.normals;if(o===null||l===null)return new this.bjsAMMO.btCompoundShape;for(var d=[],v=[],y=0;y<o.length;y+=3){var D=new h.e(o[y],o[y+1],o[y+2]),w=new h.e(l[y],l[y+1],l[y+2]);d.push(D.x,D.y,-D.z),v.push(w.x,w.y,-w.z)}var F=new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),d,e.getIndices(),n.length/3,!0),z=o.length/3,k=F.get_m_nodes();for(y=0;y<z;y++){var K;(K=k.at(y).get_m_n()).setX(v[3*y]),K.setY(v[3*y+1]),K.setZ(v[3*y+2])}return F}},i.prototype._createCloth=function(t){var e=t.object;if(e&&e.getIndices){e.getIndices();var n=this._softVertexData(t),r=n.positions,o=n.normals;if(r===null||o===null)return new this.bjsAMMO.btCompoundShape;var l=r.length,d=Math.sqrt(l/3);t.segments=d;var v=d-1;return this._tmpAmmoVectorA.setValue(r[0],r[1],r[2]),this._tmpAmmoVectorB.setValue(r[3*v],r[3*v+1],r[3*v+2]),this._tmpAmmoVectorD.setValue(r[l-3],r[l-2],r[l-1]),this._tmpAmmoVectorC.setValue(r[l-3-3*v],r[l-2-3*v],r[l-1-3*v]),new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,d,d,t.getParam("fixedPoints"),!0)}},i.prototype._createRope=function(t){var e,n,r=this._softVertexData(t),o=r.positions,l=r.normals;if(o===null||l===null)return new this.bjsAMMO.btCompoundShape;if(r.applyToMesh(t.object,!0),t._isFromLine=!0,l.map(function(D){return D*D}).reduce(function(D,w){return D+w})===0)n=(e=o.length)/3-1,this._tmpAmmoVectorA.setValue(o[0],o[1],o[2]),this._tmpAmmoVectorB.setValue(o[e-3],o[e-2],o[e-1]);else{t._isFromLine=!1;var d=t.getParam("path");if(t.getParam("shape")===null)return _.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;if(o.length%(3*d.length)!=0)return _.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;n=(e=d.length)-1,this._tmpAmmoVectorA.setValue(d[0].x,d[0].y,d[0].z),this._tmpAmmoVectorB.setValue(d[e-1].x,d[e-1].y,d[e-1].z)}t.segments=n;var v=t.getParam("fixedPoints");v=v>3?3:v;var y=new this.bjsAMMO.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,n-1,v);return y.get_m_cfg().set_collisions(17),y},i.prototype._createCustom=function(t){var e=null;return this.onCreateCustomShape&&(e=this.onCreateCustomShape(t)),e==null&&(e=new this.bjsAMMO.btCompoundShape),e},i.prototype._addHullVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var l=n.getIndices();l||(l=[]);var d=n.getVerticesData(De.b.PositionKind);d||(d=[]),n.computeWorldMatrix(!1);for(var v=l.length/3,y=0;y<v;y++){for(var D=[],w=0;w<3;w++){var F,z=new h.e(d[3*l[3*y+w]+0],d[3*l[3*y+w]+1],d[3*l[3*y+w]+2]);h.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),z=h.e.TransformCoordinates(z,this._tmpMatrix),(F=w==0?this._tmpAmmoVectorA:w==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(z.x,z.y,z.z),D.push(F)}t.addPoint(D[0],!0),t.addPoint(D[1],!0),t.addPoint(D[2],!0),o++}n.getChildMeshes().forEach(function(k){o+=r._addHullVerts(t,e,k)})}return o},i.prototype._createShape=function(t,e){var n=this;e===void 0&&(e=!1);var r,o=t.object,l=t.getObjectExtendSize();if(!e){var d=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];r=new this.bjsAMMO.btCompoundShape;var v=0;if(d.forEach(function(k){var K=k.getPhysicsImpostor();if(K){if(K.type==Ut.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var ae=n._createShape(K),le=k.parent.getWorldMatrix().clone(),fe=new h.e;le.decompose(fe),n._tmpAmmoTransform.getOrigin().setValue(k.position.x*fe.x,k.position.y*fe.y,k.position.z*fe.z),n._tmpAmmoQuaternion.setValue(k.rotationQuaternion.x,k.rotationQuaternion.y,k.rotationQuaternion.z,k.rotationQuaternion.w),n._tmpAmmoTransform.setRotation(n._tmpAmmoQuaternion),r.addChildShape(n._tmpAmmoTransform,ae),K.dispose(),v++}}),v>0){if(t.type!=Ut.a.NoImpostor){var y=this._createShape(t,!0);y&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,y))}return r}this.bjsAMMO.destroy(r),r=null}switch(t.type){case Ut.a.SphereImpostor:if(J.a.WithinEpsilon(l.x,l.y,1e-4)&&J.a.WithinEpsilon(l.x,l.z,1e-4))r=new this.bjsAMMO.btSphereShape(l.x/2);else{var D=[new this.bjsAMMO.btVector3(0,0,0)];(r=new this.bjsAMMO.btMultiSphereShape(D,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(l.x/2,l.y/2,l.z/2))}break;case Ut.a.CapsuleImpostor:r=new this.bjsAMMO.btCapsuleShape(l.x/2,l.y/2);break;case Ut.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(l.x/2,l.y/2,l.z/2),r=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case Ut.a.PlaneImpostor:case Ut.a.BoxImpostor:this._tmpAmmoVectorA.setValue(l.x/2,l.y/2,l.z/2),r=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case Ut.a.MeshImpostor:if(t.getParam("mass")==0){var w=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(w);var F=this._addMeshVerts(w,o,o);r=F==0?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(w);break}case Ut.a.ConvexHullImpostor:var z=new this.bjsAMMO.btConvexHullShape;(F=this._addHullVerts(z,o,o))==0?(t._pluginData.toDispose.push(z),r=new this.bjsAMMO.btCompoundShape):r=z;break;case Ut.a.NoImpostor:r=new this.bjsAMMO.btSphereShape(l.x/2);break;case Ut.a.CustomImpostor:r=this._createCustom(t);break;case Ut.a.SoftbodyImpostor:r=this._createSoftbody(t);break;case Ut.a.ClothImpostor:r=this._createCloth(t);break;case Ut.a.RopeImpostor:r=this._createRope(t);break;default:_.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return r},i.prototype.setTransformationFromPhysicsBody=function(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody.getWorldTransform();if(Math.abs(r.getOrigin().x()-e.x)>Zt.a||Math.abs(r.getOrigin().y()-e.y)>Zt.a||Math.abs(r.getOrigin().z()-e.z)>Zt.a||Math.abs(r.getRotation().x()-n.x)>Zt.a||Math.abs(r.getRotation().y()-n.y)>Zt.a||Math.abs(r.getRotation().z()-n.z)>Zt.a||Math.abs(r.getRotation().w()-n.w)>Zt.a)if(this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),r.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(n.x,n.y,n.z,n.w),r.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(r),t.mass==0){var o=t.physicsBody.getMotionState();o&&o.setWorldTransform(r)}else t.physicsBody.activate()},i.prototype.isSupported=function(){return this.bjsAMMO!==void 0},i.prototype.setLinearVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},i.prototype.setAngularVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},i.prototype.getLinearVelocity=function(t){if(t.soft)var e=t.physicsBody.linearVelocity();else e=t.physicsBody.getLinearVelocity();if(!e)return null;var n=new h.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.getAngularVelocity=function(t){if(t.soft)var e=t.physicsBody.angularVelocity();else e=t.physicsBody.getAngularVelocity();if(!e)return null;var n=new h.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.setBodyMass=function(t,e){t.soft?t.physicsBody.setTotalMass(e,!1):t.physicsBody.setMassProps(e),t._pluginData.mass=e},i.prototype.getBodyMass=function(t){return t._pluginData.mass||0},i.prototype.getBodyFriction=function(t){return t._pluginData.friction||0},i.prototype.setBodyFriction=function(t,e){t.soft?t.physicsBody.get_m_cfg().set_kDF(e):t.physicsBody.setFriction(e),t._pluginData.friction=e},i.prototype.getBodyRestitution=function(t){return t._pluginData.restitution||0},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.setRestitution(e),t._pluginData.restitution=e},i.prototype.getBodyPressure=function(t){return t.soft?t._pluginData.pressure||0:(_.a.Warn("Pressure is not a property of a rigid body"),0)},i.prototype.setBodyPressure=function(t,e){t.soft?t.type===Ut.a.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(e),t._pluginData.pressure=e):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):_.a.Warn("Pressure can only be applied to a softbody")},i.prototype.getBodyStiffness=function(t){return t.soft?t._pluginData.stiffness||0:(_.a.Warn("Stiffness is not a property of a rigid body"),0)},i.prototype.setBodyStiffness=function(t,e){t.soft?(e=(e=e<0?0:e)>1?1:e,t.physicsBody.get_m_materials().at(0).set_m_kLST(e),t._pluginData.stiffness=e):_.a.Warn("Stiffness cannot be applied to a rigid body")},i.prototype.getBodyVelocityIterations=function(t){return t.soft?t._pluginData.velocityIterations||0:(_.a.Warn("Velocity iterations is not a property of a rigid body"),0)},i.prototype.setBodyVelocityIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_viterations(e),t._pluginData.velocityIterations=e):_.a.Warn("Velocity iterations cannot be applied to a rigid body")},i.prototype.getBodyPositionIterations=function(t){return t.soft?t._pluginData.positionIterations||0:(_.a.Warn("Position iterations is not a property of a rigid body"),0)},i.prototype.setBodyPositionIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_piterations(e),t._pluginData.positionIterations=e):_.a.Warn("Position iterations cannot be applied to a rigid body")},i.prototype.appendAnchor=function(t,e,n,r,o,l){o===void 0&&(o=1),l===void 0&&(l=!1);var d=t.segments,v=Math.round((d-1)*n)+d*(d-1-Math.round((d-1)*r));t.physicsBody.appendAnchor(v,e.physicsBody,l,o)},i.prototype.appendHook=function(t,e,n,r,o){r===void 0&&(r=1),o===void 0&&(o=!1);var l=Math.round(t.segments*n);t.physicsBody.appendAnchor(l,e.physicsBody,o,r)},i.prototype.sleepBody=function(t){_.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},i.prototype.wakeUpBody=function(t){t.physicsBody.activate()},i.prototype.updateDistanceJoint=function(t,e,n){_.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},i.prototype.setMotor=function(t,e,n,r){t.physicsJoint.enableAngularMotor(!0,e,n)},i.prototype.setLimit=function(t,e,n){_.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},i.prototype.syncMeshWithImpostor=function(t,e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},i.prototype.getRadius=function(t){return t.getObjectExtendSize().x/2},i.prototype.getBoxSizeToRef=function(t,e){var n=t.getObjectExtendSize();e.x=n.x,e.y=n.y,e.z=n.z},i.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},i.prototype.raycast=function(t,e){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(e.x,e.y,e.z);var n=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,n),this._raycastResult.reset(t,e),n.hasHit()&&(this._raycastResult.setHitData({x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()},{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(n),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},i.DISABLE_COLLISION_FLAG=4,i.KINEMATIC_FLAG=2,i.DISABLE_DEACTIVATION_FLAG=4,i}();E.a.prototype.removeReflectionProbe=function(i){if(!this.reflectionProbes)return-1;var t=this.reflectionProbes.indexOf(i);return t!==-1&&this.reflectionProbes.splice(t,1),t},E.a.prototype.addReflectionProbe=function(i){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(i)};var S0=function(){function i(t,e,n,r,o){var l=this;r===void 0&&(r=!0),o===void 0&&(o=!1),this.name=t,this._viewMatrix=h.a.Identity(),this._target=h.e.Zero(),this._add=h.e.Zero(),this._invertYAxis=!1,this.position=h.e.Zero(),this._scene=n,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this);var d=g.a.TEXTURETYPE_UNSIGNED_BYTE;if(o){var v=this._scene.getEngine().getCaps();v.textureHalfFloatRender?d=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(d=g.a.TEXTURETYPE_FLOAT)}this._renderTargetTexture=new qn(t,e,n,r,!0,d,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(y){switch(y){case 0:l._add.copyFromFloats(1,0,0);break;case 1:l._add.copyFromFloats(-1,0,0);break;case 2:l._add.copyFromFloats(0,l._invertYAxis?1:-1,0);break;case 3:l._add.copyFromFloats(0,l._invertYAxis?-1:1,0);break;case 4:l._add.copyFromFloats(0,0,1);break;case 5:l._add.copyFromFloats(0,0,-1)}l._attachedMesh&&l.position.copyFrom(l._attachedMesh.getAbsolutePosition()),l.position.addToRef(l._add,l._target),h.a.LookAtLHToRef(l.position,l._target,h.e.Up(),l._viewMatrix),n.activeCamera&&(l._projectionMatrix=h.a.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ),n.setTransformMatrix(l._viewMatrix,l._projectionMatrix)),n._forcedViewPosition=l.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n._forcedViewPosition=null,n.updateTransformMatrix(!0)})}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(t){this._renderTargetTexture.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(t){this._renderTargetTexture.refreshRate=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},Object.defineProperty(i.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!1,configurable:!0}),i.prototype.attachToMesh=function(t){this._attachedMesh=t},i.prototype.setRenderingAutoClearDepthStencil=function(t,e){this._renderTargetTexture.setRenderingAutoClearDepthStencil(t,e)},i.prototype.dispose=function(){var t=this._scene.reflectionProbes.indexOf(this);t!==-1&&this._scene.reflectionProbes.splice(t,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},i.prototype.toString=function(t){var e="Name: "+this.name;return t&&(e+=", position: "+this.position.toString(),this._attachedMesh&&(e+=", attached mesh: "+this._attachedMesh.name)),e},i.prototype.getClassName=function(){return"ReflectionProbe"},i.prototype.serialize=function(){var t=B.a.Serialize(this,this._renderTargetTexture.serialize());return t.isReflectionProbe=!0,t},i.Parse=function(t,e,n){var r=null;if(e.reflectionProbes)for(var o=0;o<e.reflectionProbes.length;o++){var l=e.reflectionProbes[o];if(l.name===t.name){r=l;break}}return(r=B.a.Parse(function(){return r||new i(t.name,t.renderTargetSize,e,t._generateMipMaps)},t,e,n)).cubeTexture._waitingRenderList=t.renderList,t._attachedMesh&&r.attachToMesh(e.getMeshByID(t._attachedMesh)),r},Object(f.c)([Object(B.k)()],i.prototype,"_attachedMesh",void 0),Object(f.c)([Object(B.o)()],i.prototype,"position",void 0),i}(),iw=!0,vh=function(){function i(){}return i.LoaderInjectedPhysicsEngine=void 0,i}(),x0=function(i,t,e,n){for(var r=0,o=t.materials.length;r<o;r++){var l=t.materials[r];if(l.id===i)return pn.a.Parse(l,e,n)}return null},ow=function(i,t,e){for(var n in t)if(i.name===t[n])return e.push(i.id),!0;return!(!i.parentId||e.indexOf(i.parentId)===-1)&&(e.push(i.id),!0)},As=function(i,t){return i+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},A0=function(i,t){var e=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var n=t._waitingData.lods.ids,r=e.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=n.length){var l=o.length>n.length?o[o.length-1]:0;e.setEnabled(!1);for(var d=0;d<n.length;d++){var v=n[d],y=i.getMeshByID(v);y!=null&&e.addLODLevel(o[d],y)}l>0&&e.addLODLevel(l,null),r===!0&&e.setEnabled(!0)}else et.b.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},P0=function(i,t,e,n,r){r===void 0&&(r=!1);var o=new $n(i),l="importScene has failed JSON parse";try{var d=JSON.parse(t);l="";var v,y,D=an.loggingLevel===an.DETAILED_LOGGING;if(d.environmentTexture!==void 0&&d.environmentTexture!==null){var w=d.isPBR===void 0||d.isPBR;if(d.environmentTextureType&&d.environmentTextureType==="BABYLON.HDRCubeTexture"){var F=d.environmentTextureSize?d.environmentTextureSize:128,z=new mh((d.environmentTexture.match(/https?:\/\//g)?"":e)+d.environmentTexture,i,F,!0,!w);d.environmentTextureRotationY&&(z.rotationY=d.environmentTextureRotationY),i.environmentTexture=z}else if(ci.a.EndsWith(d.environmentTexture,".env")){var k=new yi((d.environmentTexture.match(/https?:\/\//g)?"":e)+d.environmentTexture,i);d.environmentTextureRotationY&&(k.rotationY=d.environmentTextureRotationY),i.environmentTexture=k}else{var K=yi.CreateFromPrefilteredData((d.environmentTexture.match(/https?:\/\//g)?"":e)+d.environmentTexture,i);d.environmentTextureRotationY&&(K.rotationY=d.environmentTextureRotationY),i.environmentTexture=K}if(d.createDefaultSkybox===!0){var ae=i.activeCamera!==void 0&&i.activeCamera!==null?(i.activeCamera.maxZ-i.activeCamera.minZ)/2:1e3,le=d.skyboxBlurLevel||0;i.createDefaultSkybox(i.environmentTexture,w,ae,le)}o.environmentTexture=i.environmentTexture}if(d.environmentIntensity!==void 0&&d.environmentIntensity!==null&&(i.environmentIntensity=d.environmentIntensity),d.lights!==void 0&&d.lights!==null)for(v=0,y=d.lights.length;v<y;v++){var fe=d.lights[v],me=so.a.Parse(fe,i);me&&(o.lights.push(me),l+=v===0?`
	Lights:`:"",l+=`
		`+me.toString(D))}if(d.reflectionProbes!==void 0&&d.reflectionProbes!==null)for(v=0,y=d.reflectionProbes.length;v<y;v++){var be=d.reflectionProbes[v],Ee=S0.Parse(be,i,e);Ee&&(o.reflectionProbes.push(Ee),l+=v===0?`
	Reflection Probes:`:"",l+=`
		`+Ee.toString(D))}if(d.animations!==void 0&&d.animations!==null)for(v=0,y=d.animations.length;v<y;v++){var xe=d.animations[v],Ae=R.a.GetClass("BABYLON.Animation");if(Ae){var Ie=Ae.Parse(xe);i.animations.push(Ie),o.animations.push(Ie),l+=v===0?`
	Animations:`:"",l+=`
		`+Ie.toString(D)}}if(d.materials!==void 0&&d.materials!==null)for(v=0,y=d.materials.length;v<y;v++){var Re=d.materials[v],Pe=pn.a.Parse(Re,i,e);Pe&&(o.materials.push(Pe),l+=v===0?`
	Materials:`:"",l+=`
		`+Pe.toString(D),Pe.getActiveTextures().forEach(function(xn){o.textures.indexOf(xn)==-1&&o.textures.push(xn)}))}if(d.multiMaterials!==void 0&&d.multiMaterials!==null)for(v=0,y=d.multiMaterials.length;v<y;v++){var Ce=d.multiMaterials[v],Ue=Ra.a.ParseMultiMaterial(Ce,i);o.multiMaterials.push(Ue),l+=v===0?`
	MultiMaterials:`:"",l+=`
		`+Ue.toString(D),Ue.getActiveTextures().forEach(function(xn){o.textures.indexOf(xn)==-1&&o.textures.push(xn)})}if(d.morphTargetManagers!==void 0&&d.morphTargetManagers!==null)for(var Oe=0,Ve=d.morphTargetManagers;Oe<Ve.length;Oe++){var Le=Ve[Oe];o.morphTargetManagers.push(_h.Parse(Le,i))}if(d.skeletons!==void 0&&d.skeletons!==null)for(v=0,y=d.skeletons.length;v<y;v++){var ze=d.skeletons[v],tt=ba.Parse(ze,i);o.skeletons.push(tt),l+=v===0?`
	Skeletons:`:"",l+=`
		`+tt.toString(D)}var ut=d.geometries;if(ut!=null){var ft=new Array,vt=ut.vertexData;if(vt!=null)for(v=0,y=vt.length;v<y;v++){var rt=vt[v];ft.push(tm.a.Parse(rt,i,e))}ft.forEach(function(xn){xn&&o.geometries.push(xn)})}if(d.transformNodes!==void 0&&d.transformNodes!==null)for(v=0,y=d.transformNodes.length;v<y;v++){var mt=d.transformNodes[v],pt=ms.a.Parse(mt,i,e);o.transformNodes.push(pt)}if(d.meshes!==void 0&&d.meshes!==null)for(v=0,y=d.meshes.length;v<y;v++){var it=d.meshes[v],yt=Fe.a.Parse(it,i,e);if(o.meshes.push(yt),yt.hasInstances)for(var We=0,at=yt.instances;We<at.length;We++){var It=at[We];o.meshes.push(It)}l+=v===0?`
	Meshes:`:"",l+=`
		`+yt.toString(D)}if(d.cameras!==void 0&&d.cameras!==null)for(v=0,y=d.cameras.length;v<y;v++){var vn=d.cameras[v],Jt=Pt.a.Parse(vn,i);o.cameras.push(Jt),l+=v===0?`
	Cameras:`:"",l+=`
		`+Jt.toString(D)}if(d.postProcesses!==void 0&&d.postProcesses!==null)for(v=0,y=d.postProcesses.length;v<y;v++){var Sn=d.postProcesses[v],Rt=St.Parse(Sn,i,e);Rt&&(o.postProcesses.push(Rt),l+=v===0?`
Postprocesses:`:"",l+=`
		`+Rt.toString())}if(d.animationGroups!==void 0&&d.animationGroups!==null)for(v=0,y=d.animationGroups.length;v<y;v++){var Rn=d.animationGroups[v],bn=Ye.Parse(Rn,i);o.animationGroups.push(bn),l+=v===0?`
	AnimationGroups:`:"",l+=`
		`+bn.toString(D)}for(v=0,y=i.cameras.length;v<y;v++)(Jt=i.cameras[v])._waitingParentId&&(Jt.parent=i.getLastEntryByID(Jt._waitingParentId),Jt._waitingParentId=null);for(v=0,y=i.lights.length;v<y;v++){var hn=i.lights[v];hn&&hn._waitingParentId&&(hn.parent=i.getLastEntryByID(hn._waitingParentId),hn._waitingParentId=null)}for(v=0,y=i.transformNodes.length;v<y;v++){var yn=i.transformNodes[v];yn._waitingParentId&&(yn.parent=i.getLastEntryByID(yn._waitingParentId),yn._waitingParentId=null)}for(v=0,y=i.meshes.length;v<y;v++)(yt=i.meshes[v])._waitingParentId&&(yt.parent=i.getLastEntryByID(yt._waitingParentId),yt._waitingParentId=null),yt._waitingData.lods&&A0(i,yt);for(v=0,y=i.skeletons.length;v<y;v++)(tt=i.skeletons[v])._hasWaitingData&&(tt.bones!=null&&tt.bones.forEach(function(xn){if(xn._waitingTransformNodeId){var Ai=i.getLastEntryByID(xn._waitingTransformNodeId);Ai&&xn.linkTransformNode(Ai),xn._waitingTransformNodeId=null}}),tt._waitingOverrideMeshId&&(tt.overrideMesh=i.getMeshByID(tt._waitingOverrideMeshId),tt._waitingOverrideMeshId=null),tt._hasWaitingData=null);for(v=0,y=i.meshes.length;v<y;v++){var Lt=i.meshes[v];Lt._waitingData.freezeWorldMatrix?(Lt.freezeWorldMatrix(),Lt._waitingData.freezeWorldMatrix=null):Lt.computeWorldMatrix(!0)}for(v=0,y=i.lights.length;v<y;v++){var Kt=i.lights[v];if(Kt._excludedMeshesIds.length>0){for(var In=0;In<Kt._excludedMeshesIds.length;In++){var wr=i.getMeshByID(Kt._excludedMeshesIds[In]);wr&&Kt.excludedMeshes.push(wr)}Kt._excludedMeshesIds=[]}if(Kt._includedOnlyMeshesIds.length>0){for(var Hr=0;Hr<Kt._includedOnlyMeshesIds.length;Hr++){var di=i.getMeshByID(Kt._includedOnlyMeshesIds[Hr]);di&&Kt.includedOnlyMeshes.push(di)}Kt._includedOnlyMeshesIds=[]}}for(E.a.Parse(d,i,o,e),v=0,y=i.meshes.length;v<y;v++)(yt=i.meshes[v])._waitingData.actions&&(ve.Parse(yt._waitingData.actions,yt,i),yt._waitingData.actions=null);d.actions!==void 0&&d.actions!==null&&ve.Parse(d.actions,null,i)}catch(xn){var Lr=As("loadAssets",d?d.producer:"Unknown")+l;if(!n)throw _.a.Log(Lr),xn;n(Lr,xn)}finally{r||o.removeAllFromScene(),l!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(As("loadAssets",d?d.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?l:""))}return o};an.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(i){return i.indexOf("babylon")!==-1},importMesh:function(i,t,e,n,r,o,l,d){var v="importMesh has failed JSON parse";try{var y=JSON.parse(e);v="";var D=an.loggingLevel===an.DETAILED_LOGGING;i?Array.isArray(i)||(i=[i]):i=null;var w=new Array;if(y.meshes!==void 0&&y.meshes!==null){var F,z,k,K=[],ae=[];for(F=0,z=y.meshes.length;F<z;F++){var le=y.meshes[F];if(i===null||ow(le,i,w)){if(i!==null&&delete i[i.indexOf(le.name)],le.geometryId!==void 0&&le.geometryId!==null&&y.geometries!==void 0&&y.geometries!==null){var fe=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(pt){fe!==!0&&y.geometries[pt]&&Array.isArray(y.geometries[pt])&&y.geometries[pt].forEach(function(it){if(it.id===le.geometryId){switch(pt){case"vertexData":tm.a.Parse(it,t,n)}fe=!0}})}),fe===!1&&_.a.Warn("Geometry not found for mesh "+le.id)}if(le.materialId){var me=ae.indexOf(le.materialId)!==-1;if(me===!1&&y.multiMaterials!==void 0&&y.multiMaterials!==null)for(var be=0,Ee=y.multiMaterials.length;be<Ee;be++){var xe=y.multiMaterials[be];if(xe.id===le.materialId){for(var Ae=0,Ie=xe.materials.length;Ae<Ie;Ae++){var Re,Pe=xe.materials[Ae];ae.push(Pe),(Re=x0(Pe,y,t,n))&&(v+=`
	Material `+Re.toString(D))}ae.push(xe.id);var Ce=Ra.a.ParseMultiMaterial(xe,t);Ce&&(me=!0,v+=`
	Multi-Material `+Ce.toString(D));break}}me===!1&&(ae.push(le.materialId),(Re=x0(le.materialId,y,t,n))?v+=`
	Material `+Re.toString(D):_.a.Warn("Material not found for mesh "+le.id))}if(le.skeletonId>-1&&y.skeletons!==void 0&&y.skeletons!==null&&!(K.indexOf(le.skeletonId)>-1))for(var Ue=0,Oe=y.skeletons.length;Ue<Oe;Ue++){var Ve=y.skeletons[Ue];if(Ve.id===le.skeletonId){var Le=ba.Parse(Ve,t);l.push(Le),K.push(Ve.id),v+=`
	Skeleton `+Le.toString(D)}}if(y.morphTargetManagers!==void 0&&y.morphTargetManagers!==null)for(var ze=0,tt=y.morphTargetManagers;ze<tt.length;ze++){var ut=tt[ze];_h.Parse(ut,t)}var ft=Fe.a.Parse(le,t,n);r.push(ft),v+=`
	Mesh `+ft.toString(D)}}for(F=0,z=t.meshes.length;F<z;F++)(k=t.meshes[F])._waitingParentId&&(k.parent=t.getLastEntryByID(k._waitingParentId),k._waitingParentId=null),k._waitingData.lods&&A0(t,k);for(F=0,z=t.skeletons.length;F<z;F++)(Le=t.skeletons[F])._hasWaitingData&&(Le.bones!=null&&Le.bones.forEach(function(pt){if(pt._waitingTransformNodeId){var it=t.getLastEntryByID(pt._waitingTransformNodeId);it&&pt.linkTransformNode(it),pt._waitingTransformNodeId=null}}),Le._waitingOverrideMeshId&&(Le.overrideMesh=t.getMeshByID(Le._waitingOverrideMeshId),Le._waitingOverrideMeshId=null),Le._hasWaitingData=null);for(F=0,z=t.meshes.length;F<z;F++)(k=t.meshes[F])._waitingData.freezeWorldMatrix?(k.freezeWorldMatrix(),k._waitingData.freezeWorldMatrix=null):k.computeWorldMatrix(!0)}if(y.particleSystems!==void 0&&y.particleSystems!==null){var vt=E.a.GetIndividualParser(dt.a.NAME_PARTICLESYSTEM);if(vt)for(F=0,z=y.particleSystems.length;F<z;F++){var rt=y.particleSystems[F];w.indexOf(rt.emitterId)!==-1&&o.push(vt(rt,t,n))}}return!0}catch(pt){var mt=As("importMesh",y?y.producer:"Unknown")+v;if(!d)throw _.a.Log(mt),pt;d(mt,pt)}finally{v!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(As("importMesh",y?y.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?v:""))}return!1},load:function(i,t,e,n){var r="importScene has failed JSON parse";try{var o=JSON.parse(t);if(r="",o.useDelayedTextureLoading!==void 0&&o.useDelayedTextureLoading!==null&&(i.useDelayedTextureLoading=o.useDelayedTextureLoading&&!an.ForceFullSceneLoadingForIncremental),o.autoClear!==void 0&&o.autoClear!==null&&(i.autoClear=o.autoClear),o.clearColor!==void 0&&o.clearColor!==null&&(i.clearColor=C.b.FromArray(o.clearColor)),o.ambientColor!==void 0&&o.ambientColor!==null&&(i.ambientColor=C.a.FromArray(o.ambientColor)),o.gravity!==void 0&&o.gravity!==null&&(i.gravity=h.e.FromArray(o.gravity)),o.fogMode&&o.fogMode!==0)switch(i.fogMode=o.fogMode,i.fogColor=C.a.FromArray(o.fogColor),i.fogStart=o.fogStart,i.fogEnd=o.fogEnd,i.fogDensity=o.fogDensity,r+="	Fog mode for scene:  ",i.fogMode){case 1:r+=`exp
`;break;case 2:r+=`exp2
`;break;case 3:r+=`linear
`}if(o.physicsEnabled){var l;o.physicsEngine==="cannon"?l=new im(void 0,void 0,vh.LoaderInjectedPhysicsEngine):o.physicsEngine==="oimo"?l=new T0(void 0,vh.LoaderInjectedPhysicsEngine):o.physicsEngine==="ammo"&&(l=new E0(void 0,vh.LoaderInjectedPhysicsEngine,void 0)),r="	Physics engine "+(o.physicsEngine?o.physicsEngine:"oimo")+` enabled
`;var d=o.physicsGravity?h.e.FromArray(o.physicsGravity):null;i.enablePhysics(d,l)}return o.metadata!==void 0&&o.metadata!==null&&(i.metadata=o.metadata),o.collisionsEnabled!==void 0&&o.collisionsEnabled!==null&&(i.collisionsEnabled=o.collisionsEnabled),!!P0(i,t,e,n,!0)&&(o.autoAnimate&&i.beginAnimation(i,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),o.activeCameraID!==void 0&&o.activeCameraID!==null&&i.setActiveCameraByID(o.activeCameraID),!0)}catch(y){var v=As("importScene",o?o.producer:"Unknown")+r;if(!n)throw _.a.Log(v),y;n(v,y)}finally{r!==null&&an.loggingLevel!==an.NO_LOGGING&&_.a.Log(As("importScene",o?o.producer:"Unknown")+(an.loggingLevel!==an.MINIMAL_LOGGING?r:""))}return!1},loadAssetContainer:function(i,t,e,n){return P0(i,t,e,n)}});var aw=c(121),C0=function(){function i(t){t===void 0&&(t={}),this._isEnabled=!0,this.bias=t.bias===void 0?0:t.bias,this.power=t.power===void 0?1:t.power,this.leftColor=t.leftColor||C.a.White(),this.rightColor=t.rightColor||C.a.Black(),t.isEnabled===!1&&(this.isEnabled=!1)}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,He.a.MarkAllMaterialsAsDirty(g.a.MATERIAL_FresnelDirtyFlag|g.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),i.prototype.clone=function(){var t=new i;return ye.a.DeepCopy(this,t),t},i.prototype.equals=function(t){return t&&this.bias===t.bias&&this.power===t.power&&this.leftColor.equals(t.leftColor)&&this.rightColor.equals(t.rightColor)&&this.isEnabled===t.isEnabled},i.prototype.serialize=function(){return{isEnabled:this.isEnabled,leftColor:this.leftColor.asArray(),rightColor:this.rightColor.asArray(),bias:this.bias,power:this.power}},i.Parse=function(t){return new i({isEnabled:t.isEnabled,leftColor:C.a.FromArray(t.leftColor),rightColor:C.a.FromArray(t.rightColor),bias:t.bias,power:t.power||1})},i}();B.a._FresnelParametersParser=C0.Parse;var R0=c(119),om=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.maxSimultaneousLights=4,r.disableLighting=!1,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.emissiveColor=new C.a(0,0,0),r.occlusionStrength=1,r.useLightmapAsShadowmap=!1,r._useAlphaFromAlbedoTexture=!0,r._useAmbientInGrayScale=!0,r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),Object(f.c)([Object(B.e)("emissive"),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),Object(f.c)([Object(B.c)()],t.prototype,"doubleSided",null),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(nr),O0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r.metallic=1,r.roughness=1,r}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(f.c)([Object(B.e)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(om);R.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=O0;var M0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var n=this,r=B.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(f.c)([Object(B.e)("diffuse"),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),Object(f.c)([Object(B.e)("specular"),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),Object(f.c)([Object(B.c)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),Object(f.c)([Object(B.m)(),Object(B.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(om);R.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=M0;var bh=c(73),I0=function(i){function t(e,n,r){r===void 0&&(r=null);var o=i.call(this,n)||this;if(!e)return o;if(o._textureMatrix=h.a.Identity(),o.name=e,o.url=e,o._onLoad=r,o._texture=o._getFromCache(e,!0),o._texture)o._triggerOnLoad();else{var l=o.getScene();l&&l.useDelayedTextureLoading?o.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:o.loadTexture()}return o}return Object(f.d)(t,i),t.prototype._triggerOnLoad=function(){this._onLoad&&this._onLoad()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var e,n=this,r=this._getEngine();e=r.webGLVersion===1?r.createRawTexture(null,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT):r.createRawTexture3D(null,1,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT),this._texture=e,this._texture.isReady=!1,this.isCube=!1,this.is3D=r.webGLVersion>1,this.wrapU=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapV=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapR=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1;var o=function(d){if(typeof d=="string"){for(var v,y=null,D=null,w=d.split(`
`),F=0,z=0,k=0,K=0,ae=0,le=0;le<w.length;le++)if(v=w[le],t._noneEmptyLineRegex.test(v)&&v.indexOf("#")!==0){var fe=v.split(" ");if(F!==0){if(F!=0){var me=Math.max(parseInt(fe[0]),0),be=Math.max(parseInt(fe[1]),0),Ee=Math.max(parseInt(fe[2]),0);ae=Math.max(me,ae),ae=Math.max(be,ae),ae=Math.max(Ee,ae);var xe=4*(z+K*F+k*F*F);D&&(D[xe+0]=me,D[xe+1]=be,D[xe+2]=Ee),++k%F==0&&(k=0,++K%F==0&&(z++,K=0))}}else F=fe.length,y=new Uint8Array(F*F*F*4),D=new Float32Array(F*F*F*4)}if(D&&y)for(le=0;le<D.length;le++)if(le>0&&(le+1)%4==0)y[le]=255;else{var Ae=D[le];y[le]=Ae/ae*255}e.is3D?(e.updateSize(F,F,F),r.updateRawTexture3D(e,y,g.a.TEXTUREFORMAT_RGBA,!1)):(e.updateSize(F*F,F),r.updateRawTexture(e,y,g.a.TEXTUREFORMAT_RGBA,!1)),e.isReady=!0,n._triggerOnLoad()}},l=this.getScene();return l?l._loadFile(this.url,o):r._loadFile(this.url,o),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine());return e.level=this.level,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(e,n){var r=null;return e.name&&!e.isRenderTarget&&((r=new t(e.name,n)).name=e.name,r.level=e.level),r},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._noneEmptyLineRegex=/\S+/,t}(Zr.a);R.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=I0;var D0=function(i){function t(e,n,r,o,l,d,v){o===void 0&&(o=!1),l===void 0&&(l=!0),d===void 0&&(d=null),v===void 0&&(v=null);var y=i.call(this,n)||this;if(y._onLoad=null,y._onError=null,!e)throw new Error("Image url is not set");return y._coordinatesMode=ke.a.CUBIC_MODE,y.name=e,y.url=e,y._size=r,y._noMipmap=o,y.gammaSpace=l,y._onLoad=d,y._onError=v,y.hasAlpha=!1,y.isCube=!0,y._texture=y._getFromCache(e,y._noMipmap),y._texture?d&&(y._texture.isReady?et.b.SetImmediate(function(){return d()}):y._texture.onLoadedObservable.add(d)):n.useDelayedTextureLoading?y.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:y.loadImage(y.loadTexture.bind(y),y._onError),y}return Object(f.d)(t,i),t.prototype.loadImage=function(e,n){var r=this,o=document.createElement("canvas"),l=new Image;l.addEventListener("load",function(){r._width=l.width,r._height=l.height,o.width=r._width,o.height=r._height;var d=o.getContext("2d");d.drawImage(l,0,0);var v=d.getImageData(0,0,l.width,l.height);r._buffer=v.data.buffer,o.remove(),e()}),l.addEventListener("error",function(d){n&&n(r.getClassName()+" could not be loaded",d)}),l.src=this.url},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,g.a.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var r=e.getFloat32ArrayFromArrayBuffer(e._buffer),o=nm.ConvertPanoramaToCubemap(r,e._width,e._height,e._size),l=[],d=0;d<6;d++){var v=o[t._FacesMapping[d]];l.push(v)}return l},null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(e){for(var n=new DataView(e),r=new Float32Array(3*e.byteLength/4),o=0,l=0;l<e.byteLength;l++)(l+1)%4!=0&&(r[o++]=n.getUint8(l)/255);return r},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t._FacesMapping=["right","left","up","down","front","back"],t}(Zr.a),sw=function(i){function t(e,n,r){var o=i.call(this,r.scene||r.engine)||this;return n&&(r.engine||r.scene)&&(r=Object(f.a)(Object(f.a)({},t.DefaultOptions),r),o._generateMipMaps=r.generateMipMaps,o._samplingMode=r.samplingMode,o._textureMatrix=h.a.Identity(),o.name=e,o.element=n,o._isVideo=n instanceof HTMLVideoElement,o.anisotropicFilteringLevel=1,o._createInternalTexture()),o}return Object(f.d)(t,i),t.prototype._createInternalTexture=function(){var e=0,n=0;this._isVideo?(e=this.element.videoWidth,n=this.element.videoHeight):(e=this.element.width,n=this.element.height);var r=this._getEngine();r&&(this._texture=r.createDynamicTexture(e,n,this._generateMipMaps,this._samplingMode)),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){e===void 0&&(e=null);var n=this._getEngine();if(this._texture!=null&&n!=null)if(this._isVideo){var r=this.element;if(r.readyState<r.HAVE_CURRENT_DATA)return;n.updateVideoTexture(this._texture,r,e===null||e)}else{var o=this.element;n.updateDynamicTexture(this._texture,o,e===null||e,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:g.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(Zr.a),yh=function(){function i(){}return i.GetTGAHeader=function(t){var e=0;return{id_length:t[e++],colormap_type:t[e++],image_type:t[e++],colormap_index:t[e++]|t[e++]<<8,colormap_length:t[e++]|t[e++]<<8,colormap_size:t[e++],origin:[t[e++]|t[e++]<<8,t[e++]|t[e++]<<8],width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixel_size:t[e++],flags:t[e++]}},i.UploadContent=function(t,e){if(e.length<19)_.a.Error("Unable to load TGA file - Not enough data to contain header");else{var n=18,r=i.GetTGAHeader(e);if(r.id_length+n>e.length)_.a.Error("Unable to load TGA file - Not enough data");else{n+=r.id_length;var o,l=!1,d=!1,v=!1;switch(r.image_type){case i._TYPE_RLE_INDEXED:l=!0;case i._TYPE_INDEXED:d=!0;break;case i._TYPE_RLE_RGB:l=!0;case i._TYPE_RGB:break;case i._TYPE_RLE_GREY:l=!0;case i._TYPE_GREY:v=!0}var y,D,w,F,z,k,K,ae=r.pixel_size>>3,le=r.width*r.height*ae;if(d&&(y=e.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),l){var fe,me,be;o=new Uint8Array(le);for(var Ee=0,xe=new Uint8Array(ae);n<le&&Ee<le;)if(me=1+(127&(fe=e[n++])),128&fe){for(be=0;be<ae;++be)xe[be]=e[n++];for(be=0;be<me;++be)o.set(xe,Ee+be*ae);Ee+=ae*me}else{for(me*=ae,be=0;be<me;++be)o[Ee+be]=e[n++];Ee+=me}}else o=e.subarray(n,n+=d?r.width*r.height:le);switch((r.flags&i._ORIGIN_MASK)>>i._ORIGIN_SHIFT){default:case i._ORIGIN_UL:D=0,F=1,K=r.width,w=0,z=1,k=r.height;break;case i._ORIGIN_BL:D=0,F=1,K=r.width,w=r.height-1,z=-1,k=-1;break;case i._ORIGIN_UR:D=r.width-1,F=-1,K=-1,w=0,z=1,k=r.height;break;case i._ORIGIN_BR:D=r.width-1,F=-1,K=-1,w=r.height-1,z=-1,k=-1}var Ae=i["_getImageData"+(v?"Grey":"")+r.pixel_size+"bits"](r,y,o,w,z,k,D,F,K);t.getEngine()._uploadDataToTextureDirectly(t,Ae)}}},i._getImageData8bits=function(t,e,n,r,o,l,d,v,y){var D,w,F,z=n,k=e,K=t.width,ae=t.height,le=0,fe=new Uint8Array(K*ae*4);for(F=r;F!==l;F+=o)for(w=d;w!==y;w+=v,le++)D=z[le],fe[4*(w+K*F)+3]=255,fe[4*(w+K*F)+2]=k[3*D+0],fe[4*(w+K*F)+1]=k[3*D+1],fe[4*(w+K*F)+0]=k[3*D+2];return fe},i._getImageData16bits=function(t,e,n,r,o,l,d,v,y){var D,w,F,z=n,k=t.width,K=t.height,ae=0,le=new Uint8Array(k*K*4);for(F=r;F!==l;F+=o)for(w=d;w!==y;w+=v,ae+=2){var fe=255*((31744&(D=z[ae+0]+(z[ae+1]<<8)))>>10)/31|0,me=255*((992&D)>>5)/31|0,be=255*(31&D)/31|0;le[4*(w+k*F)+0]=fe,le[4*(w+k*F)+1]=me,le[4*(w+k*F)+2]=be,le[4*(w+k*F)+3]=32768&D?0:255}return le},i._getImageData24bits=function(t,e,n,r,o,l,d,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,ae=new Uint8Array(z*k*4);for(w=r;w!==l;w+=o)for(D=d;D!==y;D+=v,K+=3)ae[4*(D+z*w)+3]=255,ae[4*(D+z*w)+2]=F[K+0],ae[4*(D+z*w)+1]=F[K+1],ae[4*(D+z*w)+0]=F[K+2];return ae},i._getImageData32bits=function(t,e,n,r,o,l,d,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,ae=new Uint8Array(z*k*4);for(w=r;w!==l;w+=o)for(D=d;D!==y;D+=v,K+=4)ae[4*(D+z*w)+2]=F[K+0],ae[4*(D+z*w)+1]=F[K+1],ae[4*(D+z*w)+0]=F[K+2],ae[4*(D+z*w)+3]=F[K+3];return ae},i._getImageDataGrey8bits=function(t,e,n,r,o,l,d,v,y){var D,w,F,z=n,k=t.width,K=t.height,ae=0,le=new Uint8Array(k*K*4);for(F=r;F!==l;F+=o)for(w=d;w!==y;w+=v,ae++)D=z[ae],le[4*(w+k*F)+0]=D,le[4*(w+k*F)+1]=D,le[4*(w+k*F)+2]=D,le[4*(w+k*F)+3]=255;return le},i._getImageDataGrey16bits=function(t,e,n,r,o,l,d,v,y){var D,w,F=n,z=t.width,k=t.height,K=0,ae=new Uint8Array(z*k*4);for(w=r;w!==l;w+=o)for(D=d;D!==y;D+=v,K+=2)ae[4*(D+z*w)+0]=F[K+0],ae[4*(D+z*w)+1]=F[K+0],ae[4*(D+z*w)+2]=F[K+0],ae[4*(D+z*w)+3]=F[K+1];return ae},i._TYPE_INDEXED=1,i._TYPE_RGB=2,i._TYPE_GREY=3,i._TYPE_RLE_INDEXED=9,i._TYPE_RLE_RGB=10,i._TYPE_RLE_GREY=11,i._ORIGIN_MASK=48,i._ORIGIN_SHIFT=4,i._ORIGIN_BL=0,i._ORIGIN_BR=1,i._ORIGIN_UL=2,i._ORIGIN_UR=3,i}(),w0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ci.a.EndsWith(t,".tga")},i.prototype.loadCubeData=function(t,e,n,r,o){throw".env not supported in Cube."},i.prototype.loadData=function(t,e,n){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o=yh.GetTGAHeader(r);n(o.width,o.height,e.generateMipMaps,!1,function(){yh.UploadContent(e,r)})},i}();He.a._TextureLoaders.push(new w0);var al,cw=function(){};(function(i){i[i.cTFETC1=0]="cTFETC1",i[i.cTFBC1=1]="cTFBC1",i[i.cTFBC4=2]="cTFBC4",i[i.cTFPVRTC1_4_OPAQUE_ONLY=3]="cTFPVRTC1_4_OPAQUE_ONLY",i[i.cTFBC7_M6_OPAQUE_ONLY=4]="cTFBC7_M6_OPAQUE_ONLY",i[i.cTFETC2=5]="cTFETC2",i[i.cTFBC3=6]="cTFBC3",i[i.cTFBC5=7]="cTFBC5"})(al||(al={}));var sl=function(){function i(){}return i.GetInternalFormatFromBasisFormat=function(t){if(t===al.cTFETC1)return 36196;if(t===al.cTFBC1)return 33776;if(t===al.cTFBC3)return 33779;throw"The chosen Basis transcoder format is not currently supported"},i._CreateWorkerAsync=function(){var t=this;return this._WorkerPromise||(this._WorkerPromise=new Promise(function(e){t._Worker?e(t._Worker):et.b.LoadFileAsync(i.WasmModuleURL).then(function(n){var r=URL.createObjectURL(new Blob(["("+lw+")()"],{type:"application/javascript"}));t._Worker=new Worker(r);var o=function(l){l.data.action==="init"&&(t._Worker.removeEventListener("message",o),e(t._Worker))};t._Worker.addEventListener("message",o),t._Worker.postMessage({action:"init",url:i.JSModuleURL,wasmBinary:n})})})),this._WorkerPromise},i.TranscodeAsync=function(t,e){var n=this,r=t instanceof ArrayBuffer?new Uint8Array(t):t;return new Promise(function(o,l){n._CreateWorkerAsync().then(function(){var d=n._actionId++,v=function(D){D.data.action==="transcode"&&D.data.id===d&&(n._Worker.removeEventListener("message",v),D.data.success?o(D.data):l("Transcode is not supported on this device"))};n._Worker.addEventListener("message",v);var y=new Uint8Array(r.byteLength);y.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),n._Worker.postMessage({action:"transcode",id:d,imageData:y,config:e,ignoreSupportedFormats:n._IgnoreSupportedFormats},[y.buffer])})})},i.LoadTextureFromTranscodeResult=function(t,e){for(var n,r=t.getEngine(),o=function(){if(n=e.fileInfo.images[l].levels[0],t._invertVScale=t.invertY,e.format===-1)if(t.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,t.format=g.a.TEXTUREFORMAT_RGB,r.webGLVersion<2&&(J.a.Log2(n.width)%1!=0||J.a.Log2(n.height)%1!=0)){var d=new Nt.a(r,Nt.b.Temp);t._invertVScale=t.invertY,d.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,d.format=g.a.TEXTUREFORMAT_RGB,d.width=n.width+3&-4,d.height=n.height+3&-4,r._bindTextureDirectly(r._gl.TEXTURE_2D,d,!0),r._uploadDataToTextureDirectly(d,n.transcodedPixels,l,0,g.a.TEXTUREFORMAT_RGB,!0),r._rescaleTexture(d,t,r.scenes[0],r._getInternalFormat(g.a.TEXTUREFORMAT_RGB),function(){r._releaseTexture(d),r._bindTextureDirectly(r._gl.TEXTURE_2D,t,!0)})}else t._invertVScale=!t.invertY,t.width=n.width+3&-4,t.height=n.height+3&-4,r._uploadDataToTextureDirectly(t,n.transcodedPixels,l,0,g.a.TEXTUREFORMAT_RGB,!0);else t.width=n.width,t.height=n.height,e.fileInfo.images[l].levels.forEach(function(v,y){r._uploadCompressedDataToTextureDirectly(t,i.GetInternalFormatFromBasisFormat(e.format),v.width,v.height,v.transcodedPixels,l,y)}),r.webGLVersion<2&&(J.a.Log2(t.width)%1!=0||J.a.Log2(t.height)%1!=0)&&(et.b.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),t._cachedWrapU=ke.a.CLAMP_ADDRESSMODE,t._cachedWrapV=ke.a.CLAMP_ADDRESSMODE)},l=0;l<e.fileInfo.images.length;l++)o()},i._IgnoreSupportedFormats=!1,i.JSModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js",i.WasmModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm",i._WorkerPromise=null,i._Worker=null,i._actionId=0,i}();function lw(){var i=0,t=1,e=5,n=6,r=null;function o(l,d,v,y,D){var w=l.getImageTranscodedSizeInBytes(d,v,y),F=new Uint8Array(w);return l.transcodeImage(F,d,v,y,1,0)?(D&&(F=function(z,k,K,ae){for(var le=new Uint16Array(4),fe=new Uint16Array(K*ae),me=K/4,be=ae/4,Ee=0;Ee<be;Ee++)for(var xe=0;xe<me;xe++){var Ae=k+8*(Ee*me+xe);le[0]=z[Ae]|z[Ae+1]<<8,le[1]=z[Ae+2]|z[Ae+3]<<8,le[2]=(2*(31&le[0])+1*(31&le[1]))/3|(2*(2016&le[0])+1*(2016&le[1]))/3&2016|(2*(63488&le[0])+1*(63488&le[1]))/3&63488,le[3]=(2*(31&le[1])+1*(31&le[0]))/3|(2*(2016&le[1])+1*(2016&le[0]))/3&2016|(2*(63488&le[1])+1*(63488&le[0]))/3&63488;for(var Ie=0;Ie<4;Ie++){var Re=z[Ae+4+Ie],Pe=(4*Ee+Ie)*K+4*xe;fe[Pe++]=le[3&Re],fe[Pe++]=le[Re>>2&3],fe[Pe++]=le[Re>>4&3],fe[Pe++]=le[Re>>6&3]}}return fe}(F,0,l.getImageWidth(d,v)+3&-4,l.getImageHeight(d,v)+3&-4)),F):null}onmessage=function(l){if(l.data.action==="init")r||(Module={wasmBinary:l.data.wasmBinary},importScripts(l.data.url),r=new Promise(function(Ee){Module.onRuntimeInitialized=function(){Module.initializeBasis(),Ee()}})),r.then(function(){postMessage({action:"init"})});else if(l.data.action==="transcode"){var d=l.data.config,v=l.data.imageData,y=new Module.BasisFile(v),D=function(Ee){for(var xe=Ee.getHasAlpha(),Ae=Ee.getNumImages(),Ie=[],Re=0;Re<Ae;Re++){for(var Pe={levels:[]},Ce=Ee.getNumLevels(Re),Ue=0;Ue<Ce;Ue++){var Oe={width:Ee.getImageWidth(Re,Ue),height:Ee.getImageHeight(Re,Ue)};Pe.levels.push(Oe)}Ie.push(Pe)}return{hasAlpha:xe,images:Ie}}(y),w=l.data.ignoreSupportedFormats?null:function(Ee,xe){var Ae=null;return Ee.supportedCompressionFormats&&(Ee.supportedCompressionFormats.etc1?Ae=i:Ee.supportedCompressionFormats.s3tc?Ae=xe.hasAlpha?n:t:Ee.supportedCompressionFormats.pvrtc||Ee.supportedCompressionFormats.etc2&&(Ae=e)),Ae}(l.data.config,D),F=!1;w===null&&(F=!0,w=D.hasAlpha?n:t);var z=!0;y.startTranscoding()||(z=!1);for(var k=[],K=0;K<D.images.length&&z;K++){var ae=D.images[K];if(d.loadSingleImage===void 0||d.loadSingleImage===K){var le=ae.levels.length;d.loadMipmapLevels===!1&&(le=1);for(var fe=0;fe<le;fe++){var me=ae.levels[fe],be=o(y,K,fe,w,F);if(!be){z=!1;break}me.transcodedPixels=be,k.push(me.transcodedPixels.buffer)}}}y.close(),y.delete(),F&&(w=-1),z?postMessage({action:"transcode",success:z,id:l.data.id,fileInfo:D,format:w},k):postMessage({action:"transcode",success:z,id:l.data.id})}}}var L0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return ci.a.EndsWith(t,".basis")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var l=e.getEngine().getCaps(),d={supportedCompressionFormats:{etc1:!!l.etc1,s3tc:!!l.s3tc,pvrtc:!!l.pvrtc,etc2:!!l.etc2}};sl.TranscodeAsync(t,d).then(function(v){var y=v.fileInfo.images[0].levels.length>1&&e.generateMipMaps;sl.LoadTextureFromTranscodeResult(e,v),e.getEngine()._setCubeMapTextureParams(e,y),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}).catch(function(v){et.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),e.isReady=!0})}},i.prototype.loadData=function(t,e,n){var r=e.getEngine().getCaps(),o={supportedCompressionFormats:{etc1:!!r.etc1,s3tc:!!r.s3tc,pvrtc:!!r.pvrtc,etc2:!!r.etc2}};sl.TranscodeAsync(t,o).then(function(l){var d=l.fileInfo.images[0].levels[0],v=l.fileInfo.images[0].levels.length>1&&e.generateMipMaps;n(d.width,d.height,v,l.format!==-1,function(){sl.LoadTextureFromTranscodeResult(e,l)})}).catch(function(l){et.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),n(0,0,!1,!1,function(){})})},i}();He.a._TextureLoaders.push(new L0);var am=function(i){function t(e,n,r,o,l){var d=this,v=!(!l||!l.generateMipMaps)&&l.generateMipMaps,y=!(!l||!l.generateDepthTexture)&&l.generateDepthTexture,D=!l||l.doNotChangeAspectRatio===void 0||l.doNotChangeAspectRatio;if((d=i.call(this,e,n,o,v,D)||this).isSupported){var w=[],F=[];d._initTypes(r,w,F,l);var z=!l||l.generateDepthBuffer===void 0||l.generateDepthBuffer,k=!(!l||l.generateStencilBuffer===void 0)&&l.generateStencilBuffer;return d._size=n,d._multiRenderTargetOptions={samplingModes:F,generateMipMaps:v,generateDepthBuffer:z,generateStencilBuffer:k,generateDepthTexture:y,types:w,textureCount:r},d._count=r,d._createInternalTextures(),d._createTextures(),d}d.dispose()}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._getEngine().webGLVersion>1||this._getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapV=e},enumerable:!1,configurable:!0}),t.prototype._initTypes=function(e,n,r,o){for(var l=0;l<e;l++)o&&o.types&&o.types[l]!==void 0?n.push(o.types[l]):n.push(o&&o.defaultType?o.defaultType:g.a.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&o.samplingModes[l]!==void 0?r.push(o.samplingModes[l]):r.push(ke.a.BILINEAR_SAMPLINGMODE)},t.prototype._rebuild=function(e){e===void 0&&(e=!1),this.releaseInternalTextures(),this._createInternalTextures(),e&&this._createTextures();for(var n=0;n<this._internalTextures.length;n++)this._textures[n]._texture=this._internalTextures[n];this._texture=this._internalTextures[0],this.samples!==1&&this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,this.samples)},t.prototype._createInternalTextures=function(){this._internalTextures=this._getEngine().createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var e=0;e<this._internalTextures.length;e++){var n=new ke.a(null,this.getScene());n._texture=this._internalTextures[e],this._textures.push(n)}this._texture=this._internalTextures[0]},t.prototype.replaceTexture=function(e,n){e._texture&&(this._textures[n]=e,this._internalTextures[n]=e._texture)},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!1,configurable:!0}),t.prototype.resize=function(e){this._size=e,this._rebuild()},t.prototype.updateCount=function(e,n){this._multiRenderTargetOptions.textureCount=e,this._count=e;var r=[],o=[];this._initTypes(e,r,o,n),this._multiRenderTargetOptions.types=r,this._multiRenderTargetOptions.samplingModes=o,this._rebuild(!0)},t.prototype.unbindFrameBuffer=function(e,n){var r=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.dispose=function(){this.releaseInternalTextures(),i.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)this._internalTextures[e]!==void 0&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},t}(qn),sm=function(i,t,e){this.id=i,this.scale=t,this.offset=e},uw=function(){function i(t,e,n,r){var o,l,d,v,y,D,w,F,z,k,K,ae,le;return this.name=t,this.meshes=e,this.scene=r,this.options=n,this.options.map=(o=this.options.map)!==null&&o!==void 0?o:["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=(l=this.options.uvsIn)!==null&&l!==void 0?l:De.b.UVKind,this.options.uvsOut=(d=this.options.uvsOut)!==null&&d!==void 0?d:De.b.UVKind,this.options.layout=(v=this.options.layout)!==null&&v!==void 0?v:i.LAYOUT_STRIP,this.options.layout===i.LAYOUT_COLNUM&&(this.options.colnum=(y=this.options.colnum)!==null&&y!==void 0?y:8),this.options.updateInputMeshes=(D=this.options.updateInputMeshes)===null||D===void 0||D,this.options.disposeSources=(w=this.options.disposeSources)===null||w===void 0||w,this._expecting=0,this.options.fillBlanks=(F=this.options.fillBlanks)===null||F===void 0||F,this.options.fillBlanks===!0&&(this.options.customFillColor=(z=this.options.customFillColor)!==null&&z!==void 0?z:"black"),this.options.frameSize=(k=this.options.frameSize)!==null&&k!==void 0?k:256,this.options.paddingRatio=(K=this.options.paddingRatio)!==null&&K!==void 0?K:.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=(ae=this.options.paddingMode)!==null&&ae!==void 0?ae:i.SUBUV_WRAP,this.options.paddingMode===i.SUBUV_COLOR&&(this.options.paddingColor=(le=this.options.paddingColor)!==null&&le!==void 0?le:new C.b(0,0,0,1)),this.sets={},this.frames=[],this}return i.prototype._createFrames=function(t){for(var e=this,n=this._calculateSize(),r=new h.d(1,1).divide(n),o=0,l=this._expecting,d=this.meshes.length,v=Object.keys(this.sets),y=0;y<v.length;y++){var D=v[y],w=new to.a(this.name+".TexturePack."+D+"Set",{width:n.x,height:n.y},this.scene,!0,ke.a.TRILINEAR_SAMPLINGMODE,He.a.TEXTUREFORMAT_RGBA),F=w.getContext();F.fillStyle="rgba(0,0,0,0)",F.fillRect(0,0,n.x,n.y),w.update(!1),this.sets[D]=w}var z=this.options.frameSize||256,k=this._paddingValue,K=z+2*k;for(y=0;y<d;y++)for(var ae=this.meshes[y].material,le=function(be){var Ee=new to.a("temp",K,fe.scene,!0),xe=Ee.getContext(),Ae=fe._getFrameOffset(y),Ie=function(){o++,Ee.update(!1);var Ue=xe.getImageData(0,0,K,K),Oe=e.sets[Re];if(Oe.getContext().putImageData(Ue,n.x*Ae.x,n.y*Ae.y),Ee.dispose(),Oe.update(!1),o==l)return e._calculateMeshUVFrames(z,k,n,r,e.options.updateInputMeshes||!1),void t()},Re=v[be]||"_blank";if(ae&&ae[Re]!==null){var Pe=ae[Re],Ce=new Image;Pe instanceof to.a?Ce.src=Pe.getContext().canvas.toDataURL("image/png"):Ce.src=Pe.url,et.b.SetCorsBehavior(Ce.src,Ce),Ce.onload=function(){xe.fillStyle="rgba(0,0,0,0)",xe.fillRect(0,0,K,K),Ee.update(!1),xe.setTransform(1,0,0,-1,0,0);var Ue=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(e.options.paddingMode){case 0:for(var Oe=0;Oe<9;Oe++)xe.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Ue[Oe],k+z*Ue[Oe+1]-K,z,z);break;case 1:for(var Ve=0;Ve<k;Ve++)xe.drawImage(Ce,0,0,Ce.width,Ce.height,Ve+z*Ue[0],k-K,z,z),xe.drawImage(Ce,0,0,Ce.width,Ce.height,2*k-Ve,k-K,z,z),xe.drawImage(Ce,0,0,Ce.width,Ce.height,k,Ve-K,z,z),xe.drawImage(Ce,0,0,Ce.width,Ce.height,k,2*k-Ve-K,z,z);xe.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Ue[0],k+z*Ue[1]-K,z,z);break;case 2:xe.fillStyle=(e.options.paddingColor||C.a.Black()).toHexString(),xe.fillRect(0,0,K,-K),xe.clearRect(k,k,z,z),xe.drawImage(Ce,0,0,Ce.width,Ce.height,k+z*Ue[0],k+z*Ue[1]-K,z,z)}xe.setTransform(1,0,0,1,0,0),Ie()}}else xe.fillStyle="rgba(0,0,0,0)",fe.options.fillBlanks&&(xe.fillStyle=fe.options.customFillColor),xe.fillRect(0,0,K,K),Ie()},fe=this,me=0;me<v.length;me++)le(me)},i.prototype._calculateSize=function(){var t=this.meshes.length||0,e=this.options.frameSize||0,n=this._paddingValue||0;switch(this.options.layout){case 0:return new h.d(e*t+2*n*t,e+2*n);case 1:var r=Math.max(2,Math.ceil(Math.sqrt(t))),o=e*r+2*n*r;return new h.d(o,o);case 2:var l=this.options.colnum||1,d=Math.max(1,Math.ceil(t/l));return new h.d(e*l+2*n*l,e*d+2*n*d)}return h.d.Zero()},i.prototype._calculateMeshUVFrames=function(t,e,n,r,o){for(var l=this.meshes.length,d=0;d<l;d++){var v=this.meshes[d],y=new h.d(t/n.x,t/n.y),D=r.clone().scale(e),w=this._getFrameOffset(d).add(D),F=new sm(d,y,w);this.frames.push(F),o&&(this._updateMeshUV(v,d),this._updateTextureReferences(v))}},i.prototype._getFrameOffset=function(t){var e,n,r,o=this.meshes.length;switch(this.options.layout){case 0:return e=1/o,new h.d(t*e,0);case 1:var l=Math.max(2,Math.ceil(Math.sqrt(o)));return r=t-(n=Math.floor(t/l))*l,e=1/l,new h.d(r*e,n*e);case 2:var d=this.options.colnum||1,v=Math.max(1,Math.ceil(o/d));return n=t-(r=Math.floor(t/v))*v,e=new h.d(1/d,1/v),new h.d(r*e.x,n*e.y)}return h.d.Zero()},i.prototype._updateMeshUV=function(t,e){var n=this.frames[e],r=t.getVerticesData(this.options.uvsIn||De.b.UVKind),o=[],l=0;r.length&&(l=r.length||0);for(var d=0;d<l;d+=2)o.push(r[d]*n.scale.x+n.offset.x,r[d+1]*n.scale.y+n.offset.y);t.setVerticesData(this.options.uvsOut||De.b.UVKind,o)},i.prototype._updateTextureReferences=function(t,e){e===void 0&&(e=!1);for(var n=t.material,r=Object.keys(this.sets),o=function(v){v.dispose&&v.dispose()},l=0;l<r.length;l++){var d=r[l];if(e)n[d]!==null&&o(n[d]),n[d]=this.sets[d];else{if(!n)return;n[d]!==null&&(o(n[d]),n[d]=this.sets[d])}}},i.prototype.setMeshToFrame=function(t,e,n){n===void 0&&(n=!1),this._updateMeshUV(t,e),n&&this._updateTextureReferences(t,!0)},i.prototype.processAsync=function(){var t=this;return new Promise(function(e,n){try{if(t.meshes.length===0)return void e();for(var r=0,o=function(v){var y=t.meshes[v],D=y.material;if(!D)return++r===t.meshes.length?{value:t._createFrames(e)}:"continue";D.forceCompilationAsync(y).then(function(){(function(w){if(r++,t.options.map){for(var F=0;F<t.options.map.length;F++)w[t.options.map[F]]!==null&&(t.sets[t.options.map[F]]||(t.sets[t.options.map[F]]=!0),t._expecting++);r===t.meshes.length&&t._createFrames(e)}})(D)})},l=0;l<t.meshes.length;l++){var d=o(l);if(typeof d=="object")return d.value}}catch(v){return n(v)}})},i.prototype.dispose=function(){for(var t=Object.keys(this.sets),e=0;e<t.length;e++){var n=t[e];this.sets[n].dispose()}},i.prototype.download=function(t,e){var n=this;t===void 0&&(t="png"),e===void 0&&(e=1),setTimeout(function(){var r={name:n.name,sets:{},options:{},frames:[]},o=Object.keys(n.sets),l=Object.keys(n.options);try{for(var d=0;d<o.length;d++){var v=o[d],y=n.sets[v];r.sets[v]=y.getContext().canvas.toDataURL("image/"+t,e)}for(d=0;d<l.length;d++){var D=l[d];r.options[D]=n.options[D]}for(d=0;d<n.frames.length;d++){var w=n.frames[d];r.frames.push(w.scale.x,w.scale.y,w.offset.x,w.offset.y)}}catch(k){return void _.a.Warn("Unable to download: "+k)}var F="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r,null,4)),z=document.createElement("a");z.setAttribute("href",F),z.setAttribute("download",n.name+"_texurePackage.json"),document.body.appendChild(z),z.click(),z.remove()},0)},i.prototype.updateFromJSON=function(t){try{var e=JSON.parse(t);this.name=e.name;for(var n=Object.keys(e.options),r=0;r<n.length;r++)this.options[n[r]]=e.options[n[r]];for(r=0;r<e.frames.length;r+=4){var o=new sm(r/4,new h.d(e.frames[r],e.frames[r+1]),new h.d(e.frames[r+2],e.frames[r+3]));this.frames.push(o)}var l=Object.keys(e.sets);for(r=0;r<l.length;r++){var d=new ke.a(e.sets[l[r]],this.scene,!1,!1);this.sets[l[r]]=d}}catch(v){_.a.Warn("Unable to update from JSON: "+v)}},i.LAYOUT_STRIP=0,i.LAYOUT_POWER2=1,i.LAYOUT_COLNUM=2,i.SUBUV_WRAP=0,i.SUBUV_EXTEND=1,i.SUBUV_COLOR=2,i}(),N0=function(){function i(t){this.name=dt.a.NAME_PROCEDURALTEXTURE,this.scene=t,this.scene.proceduralTextures=new Array}return i.prototype.register=function(){this.scene._beforeClearStage.registerStep(dt.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){et.b.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var t=0;t<this.scene.proceduralTextures.length;t++){var e=this.scene.proceduralTextures[t];e._shouldRender()&&e.render()}et.b.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},i}(),hw=`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.proceduralVertexShader=hw;var cl=function(i){function t(e,n,r,o,l,d,v,y){l===void 0&&(l=null),d===void 0&&(d=!0),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,null,o,!d)||this;D.isEnabled=!0,D.autoClear=!0,D.onGeneratedObservable=new S.c,D.onBeforeGenerationObservable=new S.c,D.nodeMaterialSource=null,D._textures={},D._currentRefreshId=-1,D._frameId=-1,D._refreshRate=1,D._vertexBuffers={},D._uniforms=new Array,D._samplers=new Array,D._floats={},D._ints={},D._floatsArrays={},D._colors3={},D._colors4={},D._vectors2={},D._vectors3={},D._matrices={},D._fallbackTextureUsed=!1,D._cachedDefines="",D._contentUpdateId=-1;var w=(o=D.getScene()||re.a.LastCreatedScene)._getComponent(dt.a.NAME_PROCEDURALTEXTURE);w||(w=new N0(o),o._addComponent(w)),o.proceduralTextures.push(D),D._fullEngine=o.getEngine(),D.name=e,D.isRenderTarget=!0,D._size=n,D._generateMipMaps=d,D.setFragment(r),D._fallbackTexture=l,v?(D._texture=D._fullEngine.createRenderTargetCubeTexture(n,{generateMipMaps:d,generateDepthBuffer:!1,generateStencilBuffer:!1,type:y}),D.setFloat("face",0)):D._texture=D._fullEngine.createRenderTargetTexture(n,{generateMipMaps:d,generateDepthBuffer:!1,generateStencilBuffer:!1,type:y});var F=[];return F.push(1,1),F.push(-1,1),F.push(-1,-1),F.push(1,-1),D._vertexBuffers[De.b.PositionKind]=new De.b(D._fullEngine,F,De.b.PositionKind,!1,!1,2),D._createIndexBuffer(),D}return Object(f.d)(t,i),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId),this._contentData},t.prototype._createIndexBuffer=function(){var e=this._fullEngine,n=[];n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),this._indexBuffer=e.createIndexBuffer(n)},t.prototype._rebuild=function(){var e=this._vertexBuffers[De.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===qn.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=qn.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){this._effect!==void 0&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,n=this,r=this._fullEngine;if(this.nodeMaterialSource)return this._effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var o=this._getDefines();return!(!this._effect||o!==this._cachedDefines||!this._effect.isReady())||(e=this._fragment.fragmentElement!==void 0?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=o,this._effect=r.createEffect(e,[De.b.PositionKind],this._uniforms,this._samplers,o,void 0,void 0,function(){n.releaseInternalTexture(),n._fallbackTexture&&(n._texture=n._fallbackTexture._texture,n._texture&&n._texture.incrementReferences()),n._fallbackTextureUsed=!0}),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,n){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._fullEngine.createRenderTargetTexture(e,n),this._size=e,this._generateMipMaps=n)},t.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},t.prototype.setTexture=function(e,n){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textures[e]=n,this},t.prototype.setFloat=function(e,n){return this._checkUniform(e),this._floats[e]=n,this},t.prototype.setInt=function(e,n){return this._checkUniform(e),this._ints[e]=n,this},t.prototype.setFloats=function(e,n){return this._checkUniform(e),this._floatsArrays[e]=n,this},t.prototype.setColor3=function(e,n){return this._checkUniform(e),this._colors3[e]=n,this},t.prototype.setColor4=function(e,n){return this._checkUniform(e),this._colors4[e]=n,this},t.prototype.setVector2=function(e,n){return this._checkUniform(e),this._vectors2[e]=n,this},t.prototype.setVector3=function(e,n){return this._checkUniform(e),this._vectors3[e]=n,this},t.prototype.setMatrix=function(e,n){return this._checkUniform(e),this._matrices[e]=n,this},t.prototype.render=function(e){var n=this.getScene();if(n){var r=this._fullEngine;if(r.enableEffect(this._effect),this.onBeforeGenerationObservable.notifyObservers(this),r.setState(!1),!this.nodeMaterialSource){for(var o in this._textures)this._effect.setTexture(o,this._textures[o]);for(o in this._ints)this._effect.setInt(o,this._ints[o]);for(o in this._floats)this._effect.setFloat(o,this._floats[o]);for(o in this._floatsArrays)this._effect.setArray(o,this._floatsArrays[o]);for(o in this._colors3)this._effect.setColor3(o,this._colors3[o]);for(o in this._colors4){var l=this._colors4[o];this._effect.setFloat4(o,l.r,l.g,l.b,l.a)}for(o in this._vectors2)this._effect.setVector2(o,this._vectors2[o]);for(o in this._vectors3)this._effect.setVector3(o,this._vectors3[o]);for(o in this._matrices)this._effect.setMatrix(o,this._matrices[o])}if(this._texture){if(this.isCube)for(var d=0;d<6;d++)r.bindFramebuffer(this._texture,d,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",d),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(pn.a.TriangleFillMode,0,6),d===5&&r.generateMipMapsForCubemap(this._texture);else r.bindFramebuffer(this._texture,0,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(pn.a.TriangleFillMode,0,6);r.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n},t.prototype.dispose=function(){var e=this.getScene();if(e){var n=e.proceduralTextures.indexOf(this);n>=0&&e.proceduralTextures.splice(n,1);var r=this._vertexBuffers[De.b.PositionKind];r&&(r.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),i.prototype.dispose.call(this)}},Object(f.c)([Object(B.c)()],t.prototype,"isEnabled",void 0),Object(f.c)([Object(B.c)()],t.prototype,"autoClear",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_generateMipMaps",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_size",void 0),Object(f.c)([Object(B.c)()],t.prototype,"refreshRate",null),t}(ke.a);R.a.RegisteredTypes["BABYLON.ProceduralTexture"]=cl;var dw=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,r,null,o,l,d)||this;return v._animate=!0,v._time=0,v._texturePath=n,v._loadJson(n),v.refreshRate=1,v}return Object(f.d)(t,i),t.prototype._loadJson=function(e){var n=this,r=function(){try{n.setFragment(n._texturePath)}catch(d){_.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},o=e+"/config.json",l=new se.a;l.open("GET",o),l.addEventListener("load",function(){if(l.status===200||l.responseText&&l.responseText.length>0)try{n._config=JSON.parse(l.response),n.updateShaderUniforms(),n.updateTextures(),n.setFragment(n._texturePath+"/custom"),n._animate=n._config.animate,n.refreshRate=n._config.refreshrate}catch(d){r()}else r()},!1),l.addEventListener("error",function(){r()},!1);try{l.send()}catch(d){_.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!i.prototype.isReady.call(this))return!1;for(var e in this._textures)if(!this._textures[e].isReady())return!1;return!0},t.prototype.render=function(e){var n=this.getScene();this._animate&&n&&(this._time+=.03*n.getAnimationRatio(),this.updateShaderUniforms()),i.prototype.render.call(this,e)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new ke.a(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var n=this._config.uniforms[e];switch(n.type){case"float":this.setFloat(n.name,n.value);break;case"color3":this.setColor3(n.name,new C.a(n.r,n.g,n.b));break;case"color4":this.setColor4(n.name,new C.b(n.r,n.g,n.b,n.a));break;case"vector2":this.setVector2(n.name,new h.d(n.x,n.y));break;case"vector3":this.setVector3(n.name,new h.e(n.x,n.y,n.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!1,configurable:!0}),t}(cl),fw=`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y);
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`;Qe.a.ShadersStore.noisePixelShader=fw;var F0=function(i){function t(e,n,r,o,l){n===void 0&&(n=256),r===void 0&&(r=re.a.LastCreatedScene);var d=i.call(this,e,n,"noise",r,o,l)||this;return d.time=0,d.brightness=.2,d.octaves=3,d.persistence=.8,d.animationSpeedFactor=1,d.autoClear=!1,d._updateShaderUniforms(),d}return Object(f.d)(t,i),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this.time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this.time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(e){this._updateShaderUniforms(),i.prototype.render.call(this,e)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e.time=this.time,e},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this.getScene(),this._fallbackTexture?this._fallbackTexture:void 0,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n.brightness=this.brightness,n.octaves=this.octaves,n.persistence=this.persistence,n.animationSpeedFactor=this.animationSpeedFactor,n.time=this.time,n},t.Parse=function(e,n){var r,o=new t(e.name,e.size,n,void 0,e.generateMipMaps);return o.brightness=e.brightness,o.octaves=e.octaves,o.persistence=e.persistence,o.animationSpeedFactor=e.animationSpeedFactor,o.time=(r=e.time)!==null&&r!==void 0?r:0,o},t}(cl);R.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=F0;var Me,_e,cr,Mt,Ir,Si,br,pw=function(i){function t(e,n,r,o,l,d,v,y,D){o===void 0&&(o=g.a.TEXTUREFORMAT_RGBA),l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),d===void 0&&(d=!1),v===void 0&&(v=!1),y===void 0&&(y=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=null);var w=i.call(this,"",e)||this;return w._texture=e.getEngine().createRawCubeTexture(n,r,o,l,d,v,y,D),w}return Object(f.d)(t,i),t.prototype.update=function(e,n,r,o,l){l===void 0&&(l=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,n,r,o,l)},t.prototype.updateRGBDAsync=function(e,n,r,o){return n===void 0&&(n=null),r===void 0&&(r=.8),o===void 0&&(o=0),t._UpdateRGBDAsync(this._texture,e,n,r,o)},t.prototype.clone=function(){var e=this;return B.a.Clone(function(){var n=e.getScene(),r=e._texture,o=new t(n,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return r.source===Nt.b.CubeRawRGBD&&o.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),o},this)},t._UpdateRGBDAsync=function(e,n,r,o,l){return e._source=Nt.b.CubeRawRGBD,e._bufferViewArrayArray=n,e._lodGenerationScale=o,e._lodGenerationOffset=l,e._sphericalPolynomial=r,io.UploadLevelsAsync(e,n).then(function(){e.isReady=!0})},t}(yi),mw=function(i){function t(e,n,r,o,l,d,v,y,D,w){v===void 0&&(v=!0),y===void 0&&(y=!1),D===void 0&&(D=ke.a.TRILINEAR_SAMPLINGMODE),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT);var F=i.call(this,null,d,!v,y)||this;return F.format=l,F._texture=d.getEngine().createRawTexture2DArray(e,n,r,o,l,v,y,D,null,w),F.is2DArray=!0,F}return Object(f.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(ke.a),_w=function(i){function t(e,n,r,o,l,d,v,y,D,w){v===void 0&&(v=!0),y===void 0&&(y=!1),D===void 0&&(D=ke.a.TRILINEAR_SAMPLINGMODE),w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT);var F=i.call(this,null,d,!v,y)||this;return F.format=l,F._texture=d.getEngine().createRawTexture3D(e,n,r,o,l,v,y,D,null,w),F.is3D=!0,F}return Object(f.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(ke.a),gw=function(i){function t(e,n,r,o){var l=i.call(this,e,n,r,o,!0)||this;return l.refractionPlane=new hs.a(0,1,0,1),l.depth=2,l.onBeforeRenderObservable.add(function(){r.clipPlane=l.refractionPlane}),l.onAfterRenderObservable.add(function(){r.clipPlane=null}),l}return Object(f.d)(t,i),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},t}(qn);(function(i){i[i.Vertex=1]="Vertex",i[i.Fragment=2]="Fragment",i[i.Neutral=4]="Neutral",i[i.VertexAndFragment=3]="VertexAndFragment"})(Me||(Me={})),function(i){i[i.Float=1]="Float",i[i.Int=2]="Int",i[i.Vector2=4]="Vector2",i[i.Vector3=8]="Vector3",i[i.Vector4=16]="Vector4",i[i.Color3=32]="Color3",i[i.Color4=64]="Color4",i[i.Matrix=128]="Matrix",i[i.Object=256]="Object",i[i.AutoDetect=1024]="AutoDetect",i[i.BasedOnInput=2048]="BasedOnInput"}(_e||(_e={})),function(i){i[i.Uniform=0]="Uniform",i[i.Attribute=1]="Attribute",i[i.Varying=2]="Varying",i[i.Undefined=3]="Undefined"}(cr||(cr={})),function(i){i[i.World=1]="World",i[i.View=2]="View",i[i.Projection=3]="Projection",i[i.ViewProjection=4]="ViewProjection",i[i.WorldView=5]="WorldView",i[i.WorldViewProjection=6]="WorldViewProjection",i[i.CameraPosition=7]="CameraPosition",i[i.FogColor=8]="FogColor",i[i.DeltaTime=9]="DeltaTime"}(Mt||(Mt={})),function(i){i[i.Material=0]="Material",i[i.PostProcess=1]="PostProcess",i[i.Particle=2]="Particle",i[i.ProceduralTexture=3]="ProceduralTexture"}(Ir||(Ir={})),function(i){i[i.Compatible=0]="Compatible",i[i.TypeIncompatible=1]="TypeIncompatible",i[i.TargetIncompatible=2]="TargetIncompatible"}(Si||(Si={})),function(i){i[i.Input=0]="Input",i[i.Output=1]="Output"}(br||(br={}));var Th=function(){function i(t,e,n){this._connectedPoint=null,this._endpoints=new Array,this._typeConnectionSource=null,this._linkedConnectionSource=null,this._acceptedConnectionPointType=null,this._type=_e.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=new Array,this.excludedConnectionPointTypes=new Array,this.onConnectionObservable=new S.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Me.VertexAndFragment,this._ownerBlock=e,this.name=t,this._direction=n}return i.AreEquivalentTypes=function(t,e){switch(t){case _e.Vector3:if(e===_e.Color3)return!0;break;case _e.Vector4:if(e===_e.Color4)return!0;break;case _e.Color3:if(e===_e.Vector3)return!0;break;case _e.Color4:if(e===_e.Vector4)return!0}return!1},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(t){this._associatedVariableName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){if(this._type===_e.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===_e.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Me.VertexAndFragment?this._target:this._ownerBlock.target===Me.Fragment?Me.Fragment:Me.Vertex:this._target},set:function(t){this._target=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnected",{get:function(){return this.connectedPoint!==null||this.hasEndpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedToInputBlock",{get:function(){return this.connectedPoint!==null&&this.connectedPoint.ownerBlock.isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedBlocks",{get:function(){return this._endpoints.length===0?[]:this._endpoints.map(function(t){return t.ownerBlock})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===Me.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Me.Vertex||n.target===Me.Vertex||(n.ownerBlock.target===Me.Neutral||n.ownerBlock.target===Me.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInVertexShader}))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===Me.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Me.Fragment||(n.ownerBlock.target===Me.Neutral||n.ownerBlock.target===Me.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInFragmentShader}))return!0}return!1},enumerable:!1,configurable:!0}),i.prototype.createCustomInputBlock=function(){return null},i.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},i.prototype.canConnectTo=function(t){return this.checkCompatibilityState(t)===Si.Compatible},i.prototype.checkCompatibilityState=function(t){if(this._ownerBlock.target===Me.Fragment){var e=t.ownerBlock;if(e.target===Me.Vertex)return Si.TargetIncompatible;for(var n=0,r=e.outputs;n<r.length;n++)if(r[n].isConnectedInVertexShader)return Si.TargetIncompatible}return this.type!==t.type&&t.innerType!==_e.AutoDetect?i.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&t.acceptedConnectionPointTypes.indexOf(this.type)!==-1||t._acceptedConnectionPointType&&i.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?Si.Compatible:Si.TypeIncompatible:t.excludedConnectionPointTypes&&t.excludedConnectionPointTypes.indexOf(this.type)!==-1?1:Si.Compatible},i.prototype.connectTo=function(t,e){if(e===void 0&&(e=!1),!e&&!this.canConnectTo(t))throw"Cannot connect these two connectors.";return this._endpoints.push(t),t._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this},i.prototype.disconnectFrom=function(t){var e=this._endpoints.indexOf(t);return e===-1||(this._endpoints.splice(e,1),t._connectedPoint=null,this._enforceAssociatedVariableName=!1,t._enforceAssociatedVariableName=!1),this},i.prototype.serialize=function(t){t===void 0&&(t=!0);var e={};return e.name=this.name,e.displayName=this.displayName,t&&this.connectedPoint&&(e.inputName=this.name,e.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,e.targetConnectionName=this.connectedPoint.name,e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),e},i.prototype.dispose=function(){this.onConnectionObservable.clear()},i}(),vw=c(152),Et=function(){function i(t,e,n,r){e===void 0&&(e=Me.Vertex),n===void 0&&(n=!1),r===void 0&&(r=!1),this._isFinalMerger=!1,this._isInput=!1,this._name="",this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this._target=e,this._isFinalMerger=n,this._isInput=r,this._name=t,this.uniqueId=vw.a.UniqueId}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this.validateBlockName(t)&&(this._name=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isInput",{get:function(){return this._isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"buildId",{get:function(){return this._buildId},set:function(t){this._buildId=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(t){(this._target&t)==0&&(this._target=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputs",{get:function(){return this._inputs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"outputs",{get:function(){return this._outputs},enumerable:!1,configurable:!0}),i.prototype.getInputByName=function(t){var e=this._inputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.getOutputByName=function(t){var e=this._outputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.initialize=function(t){},i.prototype.bind=function(t,e,n,r){},i.prototype._declareOutput=function(t,e){return e._getGLType(t.type)+" "+t.associatedVariableName},i.prototype._writeVariable=function(t){return t.connectedPoint?""+t.associatedVariableName:"0."},i.prototype._writeFloat=function(t){var e=t.toString();return e.indexOf(".")===-1&&(e+=".0"),""+e},i.prototype.getClassName=function(){return"NodeMaterialBlock"},i.prototype.registerInput=function(t,e,n,r,o){return n===void 0&&(n=!1),(o=o??new Th(t,this,br.Input)).type=e,o.isOptional=n,r&&(o.target=r),this._inputs.push(o),this},i.prototype.registerOutput=function(t,e,n,r){return(r=r??new Th(t,this,br.Output)).type=e,n&&(r.target=n),this._outputs.push(r),this},i.prototype.getFirstAvailableInput=function(t){t===void 0&&(t=null);for(var e=0,n=this._inputs;e<n.length;e++){var r=n[e];if(!(r.connectedPoint||t&&t.type!==r.type&&r.type!==_e.AutoDetect))return r}return null},i.prototype.getFirstAvailableOutput=function(t){t===void 0&&(t=null);for(var e=0,n=this._outputs;e<n.length;e++){var r=n[e];if(!t||!t.target||t.target===Me.Neutral||(t.target&r.target)!=0)return r}return null},i.prototype.getSiblingOutput=function(t){var e=this._outputs.indexOf(t);return e===-1||e>=this._outputs.length?null:this._outputs[e+1]},i.prototype.connectTo=function(t,e){if(this._outputs.length!==0){for(var n=e&&e.output?this.getOutputByName(e.output):this.getFirstAvailableOutput(t),r=!0;r;){var o=e&&e.input?t.getInputByName(e.input):t.getFirstAvailableInput(n);if(n&&o&&n.canConnectTo(o))n.connectTo(o),r=!1;else{if(!n)throw"Unable to find a compatible match";n=this.getSiblingOutput(n)}}return this}},i.prototype._buildBlock=function(t){},i.prototype.updateUniformsAndSamples=function(t,e,n,r){},i.prototype.provideFallbacks=function(t,e){},i.prototype.initializeDefines=function(t,e,n,r){},i.prototype.prepareDefines=function(t,e,n,r,o){},i.prototype.autoConfigure=function(t){},i.prototype.replaceRepeatableContent=function(t,e,n,r){},i.prototype.isReady=function(t,e,n,r){return!0},i.prototype._linkConnectionTypes=function(t,e,n){n===void 0&&(n=!1),n?this._inputs[e]._acceptedConnectionPointType=this._inputs[t]:this._inputs[t]._linkedConnectionSource=this._inputs[e],this._inputs[e]._linkedConnectionSource=this._inputs[t]},i.prototype._processBuild=function(t,e,n,r){t.build(e,r);var o=e._vertexState!=null,l=t._buildTarget===Me.Vertex&&t.target!==Me.VertexAndFragment;if(o&&((t.target&t._buildTarget)==0||(t.target&n.target)==0||this.target!==Me.VertexAndFragment&&l)&&(!t.isInput&&e.target!==t._buildTarget||t.isInput&&t.isAttribute&&!t._noContextSwitch)){var d=n.connectedPoint;e._vertexState._emitVaryingFromString("v_"+d.associatedVariableName,e._getGLType(d.type))&&(e._vertexState.compilationString+="v_"+d.associatedVariableName+" = "+d.associatedVariableName+`;\r
`),n.associatedVariableName="v_"+d.associatedVariableName,n._enforceAssociatedVariableName=!0}},i.prototype.validateBlockName=function(t){for(var e=0,n=["position","normal","tangent","particle_positionw","uv","uv2","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];e<n.length;e++)if(t===n[e])return!1;return!0},i.prototype.build=function(t,e){if(this._buildId===t.sharedData.buildId)return!0;if(!this.isInput)for(var n=0,r=this._outputs;n<r.length;n++)(D=r[n]).associatedVariableName||(D.associatedVariableName=t._getFreeVariableName(D.name));for(var o=0,l=this._inputs;o<l.length;o++){var d=l[o];if(d.connectedPoint){if(this.target!==Me.Neutral&&((d.target&this.target)==0||(d.target&t.target)==0))continue;(z=d.connectedPoint.ownerBlock)&&z!==this&&this._processBuild(z,t,d,e)}else d.isOptional||t.sharedData.checks.notConnectedNonOptionalInputs.push(d)}if(this._buildId===t.sharedData.buildId)return!0;if(t.sharedData.verbose&&console.log((t.target===Me.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]"),this.isFinalMerger)switch(t.target){case Me.Vertex:t.sharedData.checks.emitVertex=!0;break;case Me.Fragment:t.sharedData.checks.emitFragment=!0}!this.isInput&&t.sharedData.emitComments&&(t.compilationString+=`\r
//`+this.name+`\r
`),this._buildBlock(t),this._buildId=t.sharedData.buildId,this._buildTarget=t.target;for(var v=0,y=this._outputs;v<y.length;v++){var D;if(((D=y[v]).target&t.target)!=0)for(var w=0,F=D.endpoints;w<F.length;w++){var z,k=F[w];(z=k.ownerBlock)&&(z.target&t.target)!=0&&e.indexOf(z)!==-1&&this._processBuild(z,t,k,e)}}return!1},i.prototype._inputRename=function(t){return t},i.prototype._outputRename=function(t){return t},i.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".visibleInInspector = "+this.visibleInInspector+`;\r
`},i.prototype._dumpCode=function(t,e){var n;e.push(this);var r=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=r||this.getClassName()+"_"+this.uniqueId,t.indexOf(this._codeVariableName)!==-1){var o=0;do o++,this._codeVariableName=r+o;while(t.indexOf(this._codeVariableName)!==-1)}t.push(this._codeVariableName),n=`\r
// `+this.getClassName()+`\r
`,this.comments&&(n+="// "+this.comments+`\r
`),n+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+`");\r
`,n+=this._dumpPropertiesCode();for(var l=0,d=this.inputs;l<d.length;l++){var v=d[l];if(v.isConnected){var y=v.connectedPoint.ownerBlock;e.indexOf(y)===-1&&(n+=y._dumpCode(t,e))}}for(var D=0,w=this.outputs;D<w.length;D++){var F=w[D];if(F.hasEndpoints)for(var z=0,k=F.endpoints;z<k.length;z++)(y=k[z].ownerBlock)&&e.indexOf(y)===-1&&(n+=y._dumpCode(t,e))}return n},i.prototype._dumpCodeForOutputConnections=function(t){var e="";if(t.indexOf(this)!==-1)return e;t.push(this);for(var n=0,r=this.inputs;n<r.length;n++){var o=r[n];if(o.isConnected){var l=o.connectedPoint,d=l.ownerBlock;e+=d._dumpCodeForOutputConnections(t),e+=d._codeVariableName+"."+d._outputRename(l.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(o.name)+`);\r
`}}return e},i.prototype.clone=function(t,e){e===void 0&&(e="");var n=this.serialize(),r=R.a.GetClass(n.customType);if(r){var o=new r;return o._deserialize(n,t,e),o}return null},i.prototype.serialize=function(){var t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.comments=this.comments,t.visibleInInspector=this.visibleInInspector,t.inputs=[],t.outputs=[];for(var e=0,n=this.inputs;e<n.length;e++){var r=n[e];t.inputs.push(r.serialize())}for(var o=0,l=this.outputs;o<l.length;o++){var d=l[o];t.outputs.push(d.serialize(!1))}return t},i.prototype._deserialize=function(t,e,n){this.name=t.name,this.comments=t.comments,this.visibleInInspector=!!t.visibleInInspector,this._deserializePortDisplayNamesAndExposedOnFrame(t)},i.prototype._deserializePortDisplayNamesAndExposedOnFrame=function(t){var e=this,n=t.inputs,r=t.outputs;n&&n.forEach(function(o,l){o.displayName&&(e.inputs[l].displayName=o.displayName),o.isExposedOnFrame&&(e.inputs[l].isExposedOnFrame=o.isExposedOnFrame,e.inputs[l].exposedPortPosition=o.exposedPortPosition)}),r&&r.forEach(function(o,l){o.displayName&&(e.outputs[l].displayName=o.displayName),o.isExposedOnFrame&&(e.outputs[l].isExposedOnFrame=o.isExposedOnFrame,e.outputs[l].exposedPortPosition=o.exposedPortPosition)})},i.prototype.dispose=function(){for(var t=0,e=this.inputs;t<e.length;t++)e[t].dispose();for(var n=0,r=this.outputs;n<r.length;n++)r[n].dispose()},i}(),B0=function(){function i(){this.supportUniformBuffers=!1,this.attributes=new Array,this.uniforms=new Array,this.constants=new Array,this.samplers=new Array,this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return i.prototype.finalize=function(t){var e=t.sharedData.emitComments,n=this.target===Me.Fragment;this.compilationString=`\r
`+(e?`//Entry point\r
`:"")+`void main(void) {\r
`+this.compilationString,this._constantDeclaration&&(this.compilationString=`\r
`+(e?`//Constants\r
`:"")+this._constantDeclaration+`\r
`+this.compilationString);var r="";for(var o in this.functions)r+=this.functions[o]+`\r
`;for(var l in this.compilationString=`\r
`+r+`\r
`+this.compilationString,!n&&this._varyingTransfer&&(this.compilationString=this.compilationString+`\r
`+this._varyingTransfer),this._injectAtEnd&&(this.compilationString=this.compilationString+`\r
`+this._injectAtEnd),this.compilationString=this.compilationString+`\r
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\r
`+(e?`//Varyings\r
`:"")+this.sharedData.varyingDeclaration+`\r
`+this.compilationString),this._samplerDeclaration&&(this.compilationString=`\r
`+(e?`//Samplers\r
`:"")+this._samplerDeclaration+`\r
`+this.compilationString),this._uniformDeclaration&&(this.compilationString=`\r
`+(e?`//Uniforms\r
`:"")+this._uniformDeclaration+`\r
`+this.compilationString),this._attributeDeclaration&&!n&&(this.compilationString=`\r
`+(e?`//Attributes\r
`:"")+this._attributeDeclaration+`\r
`+this.compilationString),this.compilationString=`precision highp float;\r
`+this.compilationString,this.extensions){var d=this.extensions[l];this.compilationString=`\r
`+d+`\r
`+this.compilationString}this._builtCompilationString=this.compilationString},Object.defineProperty(i.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex+++"___###"},enumerable:!1,configurable:!0}),i.prototype._getFreeVariableName=function(t){return t=t.replace(/[^a-zA-Z_]+/g,""),this.sharedData.variableNames[t]===void 0?(this.sharedData.variableNames[t]=0,t==="output"||t==="texture"?t+this.sharedData.variableNames[t]:t):(this.sharedData.variableNames[t]++,t+this.sharedData.variableNames[t])},i.prototype._getFreeDefineName=function(t){return this.sharedData.defineNames[t]===void 0?this.sharedData.defineNames[t]=0:this.sharedData.defineNames[t]++,t+this.sharedData.defineNames[t]},i.prototype._excludeVariableName=function(t){this.sharedData.variableNames[t]=0},i.prototype._emit2DSampler=function(t){this.samplers.indexOf(t)<0&&(this._samplerDeclaration+="uniform sampler2D "+t+`;\r
`,this.samplers.push(t))},i.prototype._getGLType=function(t){switch(t){case _e.Float:return"float";case _e.Int:return"int";case _e.Vector2:return"vec2";case _e.Color3:case _e.Vector3:return"vec3";case _e.Color4:case _e.Vector4:return"vec4";case _e.Matrix:return"mat4"}return""},i.prototype._emitExtension=function(t,e,n){n===void 0&&(n=""),this.extensions[t]||(n&&(e="#if "+n+`\r
`+e+`\r
#endif`),this.extensions[t]=e)},i.prototype._emitFunction=function(t,e,n){this.functions[t]||(this.sharedData.emitComments&&(e=n+`\r
`+e),this.functions[t]=e)},i.prototype._emitCodeFromInclude=function(t,e,n){if(n&&n.repeatKey)return"#include<"+t+">[0.."+n.repeatKey+`]\r
`;var r=Qe.a.IncludesShadersStore[t]+`\r
`;if(this.sharedData.emitComments&&(r=e+`\r
`+r),!n)return r;if(n.replaceStrings)for(var o=0;o<n.replaceStrings.length;o++){var l=n.replaceStrings[o];r=r.replace(l.search,l.replace)}return r},i.prototype._emitFunctionFromInclude=function(t,e,n,r){r===void 0&&(r="");var o=t+r;if(!this.functions[o]){if(!(n&&(n.removeAttributes||n.removeUniforms||n.removeVaryings||n.removeIfDef||n.replaceStrings)))return n&&n.repeatKey?this.functions[o]="#include<"+t+">[0.."+n.repeatKey+`]\r
`:this.functions[o]="#include<"+t+`>\r
`,void(this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]));if(this.functions[o]=Qe.a.IncludesShadersStore[t],this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]),n.removeIfDef&&(this.functions[o]=this.functions[o].replace(/^\s*?#ifdef.+$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#endif.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#else.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#elif.*$/gm,"")),n.removeAttributes&&(this.functions[o]=this.functions[o].replace(/^\s*?attribute.+$/gm,"")),n.removeUniforms&&(this.functions[o]=this.functions[o].replace(/^\s*?uniform.+$/gm,"")),n.removeVaryings&&(this.functions[o]=this.functions[o].replace(/^\s*?varying.+$/gm,"")),n.replaceStrings)for(var l=0;l<n.replaceStrings.length;l++){var d=n.replaceStrings[l];this.functions[o]=this.functions[o].replace(d.search,d.replace)}}},i.prototype._registerTempVariable=function(t){return this.sharedData.temps.indexOf(t)===-1&&(this.sharedData.temps.push(t),!0)},i.prototype._emitVaryingFromString=function(t,e,n,r){return n===void 0&&(n=""),r===void 0&&(r=!1),this.sharedData.varyings.indexOf(t)===-1&&(this.sharedData.varyings.push(t),n&&(ci.a.StartsWith(n,"defined(")?this.sharedData.varyingDeclaration+="#if "+n+`\r
`:this.sharedData.varyingDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this.sharedData.varyingDeclaration+="varying "+e+" "+t+`;\r
`,n&&(this.sharedData.varyingDeclaration+=`#endif\r
`),!0)},i.prototype._emitUniformFromString=function(t,e,n,r){n===void 0&&(n=""),r===void 0&&(r=!1),this.uniforms.indexOf(t)===-1&&(this.uniforms.push(t),n&&(ci.a.StartsWith(n,"defined(")?this._uniformDeclaration+="#if "+n+`\r
`:this._uniformDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this._uniformDeclaration+="uniform "+e+" "+t+`;\r
`,n&&(this._uniformDeclaration+=`#endif\r
`))},i.prototype._emitFloat=function(t){return t.toString()===t.toFixed(0)?t+".0":t.toString()},i}(),bw=function(){function i(){this.temps=new Array,this.varyings=new Array,this.varyingDeclaration="",this.inputBlocks=new Array,this.textureBlocks=new Array,this.bindableBlocks=new Array,this.blocksWithFallbacks=new Array,this.blocksWithDefines=new Array,this.repeatableContentBlocks=new Array,this.dynamicUniformBlocks=new Array,this.blockingBlocks=new Array,this.animatedInputs=new Array,this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return i.prototype.emitErrors=function(){var t="";this.checks.emitVertex||this.allowEmptyVertexProgram||(t+=`NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r
`),this.checks.emitFragment||(t+=`NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r
`);for(var e=0,n=this.checks.notConnectedNonOptionalInputs;e<n.length;e++){var r=n[e];t+="input "+r.name+" from block "+r.ownerBlock.name+"["+r.ownerBlock.getClassName()+`] is not connected and is not optional.\r
`}if(t)throw`Build of NodeMaterial failed:\r
`+t},i}(),Eh=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.complementW=1,n.complementZ=0,n.registerInput("vector",_e.AutoDetect),n.registerInput("transform",_e.Matrix),n.registerOutput("output",_e.Vector4),n.registerOutput("xyz",_e.Vector3),n._inputs[0].onConnectionObservable.add(function(r){if(r.ownerBlock.isInput){var o=r.ownerBlock;o.name!=="normal"&&o.name!=="tangent"||(n.complementW=0)}}),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector,r=this.transform;if(n.connectedPoint){if(this.complementW===0){var o="//"+this.name;e._emitFunctionFromInclude("helperFunctions",o),e.sharedData.blocksWithDefines.push(this);var l=e._getFreeVariableName(r.associatedVariableName+"_NUS");switch(e.compilationString+="mat3 "+l+" = mat3("+r.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef NONUNIFORMSCALING\r
`,e.compilationString+=l+" = transposeMat3(inverseMat3("+l+`));\r
`,e.compilationString+=`#endif\r
`,n.connectedPoint.type){case _e.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * vec3("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+"), "+this._writeFloat(this.complementW)+`);\r
`;break;case _e.Vector3:case _e.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * "+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * "+n.associatedVariableName+".xyz, "+this._writeFloat(this.complementW)+`);\r
`}}else switch(l=r.associatedVariableName,n.connectedPoint.type){case _e.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+", "+this._writeFloat(this.complementW)+`);\r
`;break;case _e.Vector3:case _e.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * "+n.associatedVariableName+`;\r
`}this.xyz.hasEndpoints&&(e.compilationString+=this._declareOutput(this.xyz,e)+" = "+this.output.associatedVariableName+`.xyz;\r
`)}return this},t.prototype.prepareDefines=function(e,n,r,o,l){e.nonUniformScaling&&r.setValue("NONUNIFORMSCALING",!0)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.complementZ=this.complementZ,e.complementW=this.complementW,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.complementZ=e.complementZ!==void 0?e.complementZ:0,this.complementW=e.complementW!==void 0?e.complementW:1},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".complementZ = "+this.complementZ+`;\r
`;return e+=this._codeVariableName+".complementW = "+this.complementW+`;\r
`},t}(Et);R.a.RegisteredTypes["BABYLON.TransformBlock"]=Eh;var ll=function(i){function t(e){var n=i.call(this,e,Me.Vertex,!0)||this;return n.registerInput("vector",_e.Vector4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector;return e.compilationString+="gl_Position = "+n.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=ll;var Ho,Ps=function(i){function t(e){var n=i.call(this,e,Me.Fragment,!0)||this;return n.registerInput("rgba",_e.Color4,!0),n.registerInput("rgb",_e.Color3,!0),n.registerInput("a",_e.Float,!0),n.rgb.acceptedConnectionPointTypes.push(_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FragmentOutputBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba,r=this.rgb,o=this.a;if(e.sharedData.hints.needAlphaBlending=n.isConnected||o.isConnected,n.connectedPoint)o.isConnected?e.compilationString+="gl_FragColor = vec4("+n.associatedVariableName+".rgb, "+o.associatedVariableName+`);\r
`:e.compilationString+="gl_FragColor = "+n.associatedVariableName+`;\r
`;else if(r.connectedPoint){var l="1.0";o.connectedPoint&&(l=o.associatedVariableName),r.connectedPoint.type===_e.Float?e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+r.associatedVariableName+", "+r.associatedVariableName+", "+l+`);\r
`:e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+l+`);\r
`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(n);return this},t}(Et);R.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=Ps,function(i){i[i.None=0]="None",i[i.Time=1]="Time"}(Ho||(Ho={}));var yw={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},cm={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},U0={particle_texturemask:!0},Bt=function(i){function t(e,n,r){n===void 0&&(n=Me.Vertex),r===void 0&&(r=_e.AutoDetect);var o=i.call(this,e,n,!1,!0)||this;return o._mode=cr.Undefined,o._animationType=Ho.None,o.min=0,o.max=0,o.isBoolean=!1,o.matrixMode=0,o._systemValue=null,o.isConstant=!1,o.groupInInspector="",o.onValueChangedObservable=new S.c,o.convertToGammaSpace=!1,o.convertToLinearSpace=!1,o._type=r,o.setDefaultValue(),o.registerOutput("output",r),o}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"type",{get:function(){if(this._type===_e.AutoDetect){if(this.isUniform&&this.value!=null){if(!isNaN(this.value))return this._type=_e.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=_e.Vector2,this._type;case"Vector3":return this._type=_e.Vector3,this._type;case"Vector4":return this._type=_e.Vector4,this._type;case"Color3":return this._type=_e.Color3,this._type;case"Color4":return this._type=_e.Color4,this._type;case"Matrix":return this._type=_e.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"tangent":case"particle_positionw":return this._type=_e.Vector3,this._type;case"uv":case"uv2":case"position2d":case"particle_uv":return this._type=_e.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":return this._type=_e.Vector4,this._type;case"color":case"particle_color":case"particle_texturemask":return this._type=_e.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case Mt.World:case Mt.WorldView:case Mt.WorldViewProjection:case Mt.View:case Mt.ViewProjection:case Mt.Projection:return this._type=_e.Matrix,this._type;case Mt.CameraPosition:return this._type=_e.Vector3,this._type;case Mt.FogColor:return this._type=_e.Color3,this._type;case Mt.DeltaTime:return this._type=_e.Float,this._type}}return this._type},enumerable:!1,configurable:!0}),t.prototype.validateBlockName=function(e){return!!this.isAttribute||i.prototype.validateBlockName.call(this,e)},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.setAsAttribute=function(e){return this._mode=cr.Attribute,e&&(this.name=e),this},t.prototype.setAsSystemValue=function(e){return this.systemValue=e,this},Object.defineProperty(t.prototype,"value",{get:function(){return this._storedValue},set:function(e){this.type===_e.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=cr.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(e){this._valueCallback=e,this._mode=cr.Uniform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(e){this._associatedVariableName=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationType",{get:function(){return this._animationType},set:function(e){this._animationType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUndefined",{get:function(){return this._mode===cr.Undefined},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUniform",{get:function(){return this._mode===cr.Uniform},set:function(e){this._mode=e?cr.Uniform:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAttribute",{get:function(){return this._mode===cr.Attribute},set:function(e){this._mode=e?cr.Attribute:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVarying",{get:function(){return this._mode===cr.Varying},set:function(e){this._mode=e?cr.Varying:cr.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSystemValue",{get:function(){return this._systemValue!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"systemValue",{get:function(){return this._systemValue},set:function(e){this._mode=cr.Uniform,this.associatedVariableName="",this._systemValue=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"InputBlock"},t.prototype.animate=function(e){switch(this._animationType){case Ho.Time:this.type===_e.Float&&(this.value+=.01*e.getAnimationRatio())}},t.prototype._emitDefine=function(e){return e[0]==="!"?"#ifndef "+e.substring(1)+`\r
`:"#ifdef "+e+`\r
`},t.prototype.initialize=function(e){this.associatedVariableName=""},t.prototype.setDefaultValue=function(){switch(this.type){case _e.Float:this.value=0;break;case _e.Vector2:this.value=h.d.Zero();break;case _e.Vector3:this.value=h.e.Zero();break;case _e.Vector4:this.value=h.f.Zero();break;case _e.Color3:this.value=C.a.White();break;case _e.Color4:this.value=new C.b(1,1,1,1);break;case _e.Matrix:this.value=h.a.Identity()}},t.prototype._emitConstant=function(e){switch(this.type){case _e.Float:return""+e._emitFloat(this.value);case _e.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case _e.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case _e.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case _e.Color3:return C.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&C.c.Color3[0].toGammaSpaceToRef(C.c.Color3[0]),this.convertToLinearSpace&&C.c.Color3[0].toLinearSpaceToRef(C.c.Color3[0]),"vec3("+C.c.Color3[0].r+", "+C.c.Color3[0].g+", "+C.c.Color3[0].b+")";case _e.Color4:return C.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&C.c.Color4[0].toGammaSpaceToRef(C.c.Color4[0]),this.convertToLinearSpace&&C.c.Color4[0].toLinearSpaceToRef(C.c.Color4[0]),"vec4("+C.c.Color4[0].r+", "+C.c.Color4[0].g+", "+C.c.Color4[0].b+", "+C.c.Color4[0].a+")"}return""},Object.defineProperty(t.prototype,"_noContextSwitch",{get:function(){return cm[this.name]},enumerable:!1,configurable:!0}),t.prototype._emit=function(e,n){var r;if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant)return e.constants.indexOf(this.associatedVariableName)!==-1?void 0:(e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=this._declareOutput(this.output,e)+" = "+this._emitConstant(e)+`;\r
`));if(e.uniforms.indexOf(this.associatedVariableName)!==-1)return;e.uniforms.push(this.associatedVariableName),n&&(e._uniformDeclaration+=this._emitDefine(n)),e._uniformDeclaration+="uniform "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._uniformDeclaration+=`#endif\r
`);var o=e.sharedData.hints;if(this._systemValue!==null&&this._systemValue!==void 0)switch(this._systemValue){case Mt.WorldView:o.needWorldViewMatrix=!0;break;case Mt.WorldViewProjection:o.needWorldViewProjectionMatrix=!0}else this._animationType!==Ho.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=(r=yw[this.name])!==null&&r!==void 0?r:this.name,this.target===Me.Vertex&&e._vertexState)return void(cm[this.name]?U0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):this._emit(e._vertexState,n));if(e.attributes.indexOf(this.associatedVariableName)!==-1)return;e.attributes.push(this.associatedVariableName),cm[this.name]?U0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):(n&&(e._attributeDeclaration+=this._emitDefine(n)),e._attributeDeclaration+="attribute "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._attributeDeclaration+=`#endif\r
`))}},t.prototype._transmitWorld=function(e,n,r,o){if(this._systemValue){var l=this.associatedVariableName;switch(this._systemValue){case Mt.World:e.setMatrix(l,n);break;case Mt.WorldView:e.setMatrix(l,r);break;case Mt.WorldViewProjection:e.setMatrix(l,o)}}},t.prototype._transmit=function(e,n){if(!this.isAttribute){var r=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case Mt.World:case Mt.WorldView:case Mt.WorldViewProjection:return;case Mt.View:e.setMatrix(r,n.getViewMatrix());break;case Mt.Projection:e.setMatrix(r,n.getProjectionMatrix());break;case Mt.ViewProjection:e.setMatrix(r,n.getTransformMatrix());break;case Mt.CameraPosition:lt.a.BindEyePosition(e,n,r);break;case Mt.FogColor:e.setColor3(r,n.fogColor);break;case Mt.DeltaTime:e.setFloat(r,n.deltaTime/1e3)}else{var o=this._valueCallback?this._valueCallback():this._storedValue;if(o!==null)switch(this.type){case _e.Float:e.setFloat(r,o);break;case _e.Int:e.setInt(r,o);break;case _e.Color3:C.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&C.c.Color3[0].toGammaSpaceToRef(C.c.Color3[0]),this.convertToLinearSpace&&C.c.Color3[0].toLinearSpaceToRef(C.c.Color3[0]),e.setColor3(r,C.c.Color3[0]);break;case _e.Color4:C.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&C.c.Color4[0].toGammaSpaceToRef(C.c.Color4[0]),this.convertToLinearSpace&&C.c.Color4[0].toLinearSpaceToRef(C.c.Color4[0]),e.setDirectColor4(r,C.c.Color4[0]);break;case _e.Vector2:e.setVector2(r,o);break;case _e.Vector3:e.setVector3(r,o);break;case _e.Vector4:e.setVector4(r,o);break;case _e.Matrix:e.setMatrix(r,o)}}}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName;if(this.isAttribute)return e+'.setAsAttribute("'+this.name+`");\r
`;if(this.isSystemValue)return e+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+Mt[this._systemValue]+`);\r
`;if(this.isUniform){var n=[],r="";switch(this.type){case _e.Float:r=""+this.value;break;case _e.Vector2:r="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case _e.Vector3:r="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case _e.Vector4:r="new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case _e.Color3:r="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case _e.Color4:r="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case _e.Matrix:r="BABYLON.Matrix.FromArray(["+this.value.m+"])"}return n.push(e+".value = "+r),this.type===_e.Float&&n.push(e+".min = "+this.min,e+".max = "+this.max,e+".isBoolean = "+this.isBoolean,e+".matrixMode = "+this.matrixMode,e+".animationType = BABYLON.AnimatedInputBlockTypes."+Ho[this.animationType]),n.push(e+".isConstant = "+this.isConstant),n.push(""),n.join(`;\r
`)}return""},t.prototype.dispose=function(){this.onValueChangedObservable.clear(),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this._storedValue!=null&&this._mode===cr.Uniform&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e},t.prototype._deserialize=function(e,n,r){if(this._mode=e.mode,i.prototype._deserialize.call(this,e,n,r),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.valueType)if(e.valueType==="number")this._storedValue=e.value;else{var o=R.a.GetClass(e.valueType);o&&(this._storedValue=o.FromArray(e.value))}},t}(Et);R.a.RegisteredTypes["BABYLON.InputBlock"]=Bt;var lm=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._samplerName="textureSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",_e.Vector2,!1,Me.VertexAndFragment),n.registerOutput("rgba",_e.Color4,Me.Neutral),n.registerOutput("rgb",_e.Color3,Me.Neutral),n.registerOutput("r",_e.Float,Me.Neutral),n.registerOutput("g",_e.Float,Me.Neutral),n.registerOutput("b",_e.Float,Me.Neutral),n.registerOutput("a",_e.Float,Me.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[0]._prioritizeVertex=!1,n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"CurrentScreenBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("textureSampler")},Object.defineProperty(t.prototype,"target",{get:function(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Me.VertexAndFragment:Me.Fragment:Me.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._injectVertexCode=function(e){var n=this.uv;if(n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,this._outputs.some(function(d){return d.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Me.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Me.Fragment?e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`:e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Me.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else this.uv.ownerBlock.target!==Me.Fragment?(e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Me.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(this._outputs.some(function(d){return d.isConnectedInFragmentShader})){e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);R.a.RegisteredTypes["BABYLON.CurrentScreenBlock"]=lm;var um=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._samplerName="diffuseSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",_e.Vector2,!1,Me.VertexAndFragment),n.registerOutput("rgba",_e.Color4,Me.Neutral),n.registerOutput("rgb",_e.Color3,Me.Neutral),n.registerOutput("r",_e.Float,Me.Neutral),n.registerOutput("g",_e.Float,Me.Neutral),n.registerOutput("b",_e.Float,Me.Neutral),n.registerOutput("a",_e.Float,Me.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ParticleTextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("diffuseSampler")},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.isAttribute&&r.name==="particle_uv"});n||(n=new Bt("uv")).setAsAttribute("particle_uv"),n.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._writeOutput=function(e,n,r){e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex){this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this.uv.associatedVariableName+`);\r
`;for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);R.a.RegisteredTypes["BABYLON.ParticleTextureBlock"]=um;var hm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("color",_e.Color4,!1,Me.Fragment),n.registerOutput("rampColor",_e.Color4,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ParticleRampGradientBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rampColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor"),e._excludeVariableName("finalAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex)return e._emit2DSampler("rampSampler"),e._emitVaryingFromString("remapRanges","vec4","RAMPGRADIENT"),e.compilationString+=`
            #ifdef RAMPGRADIENT
                vec4 baseColor = `+this.color.associatedVariableName+`;
                float alpha = `+this.color.associatedVariableName+`.a;

                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);

                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));
                baseColor.rgb *= rampColor.rgb;

                // Remapped alpha
                float finalAlpha = baseColor.a;
                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);

                `+this._declareOutput(this.rampColor,e)+` = baseColor;
            #else
                `+this._declareOutput(this.rampColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(Et);R.a.RegisteredTypes["BABYLON.ParticleRampGradientBlock"]=hm;var dm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("color",_e.Color4,!1,Me.Fragment),n.registerInput("alphaTexture",_e.Float,!1,Me.Fragment),n.registerInput("alphaColor",_e.Float,!1,Me.Fragment),n.registerOutput("blendColor",_e.Color4,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ParticleBlendMultiplyBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaTexture",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaColor",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("sourceAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Me.Vertex)return e.compilationString+=`
            #ifdef BLENDMULTIPLYMODE
                `+this._declareOutput(this.blendColor,e)+`;
                float sourceAlpha = `+this.alphaColor.associatedVariableName+" * "+this.alphaTexture.associatedVariableName+`;
                `+this.blendColor.associatedVariableName+".rgb = "+this.color.associatedVariableName+`.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);
                `+this.blendColor.associatedVariableName+".a = "+this.color.associatedVariableName+`.a;
            #else
                `+this._declareOutput(this.blendColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(Et);R.a.RegisteredTypes["BABYLON.ParticleBlendMultiplyBlock"]=dm;var $t,ul=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("xyz ",_e.Vector3,!0),n.registerInput("xy ",_e.Vector2,!0),n.registerInput("x",_e.Float,!0),n.registerInput("y",_e.Float,!0),n.registerInput("z",_e.Float,!0),n.registerInput("w",_e.Float,!0),n.registerOutput("xyzw",_e.Vector4),n.registerOutput("xyz",_e.Vector3),n.registerOutput("xy",_e.Vector2),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return this.xyOut},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.x,r=this.y,o=this.z,l=this.w,d=this.xyIn,v=this.xyzIn,y=this._outputs[0],D=this._outputs[1],w=this._outputs[2];return v.isConnected?y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+v.associatedVariableName+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = "+v.associatedVariableName+`;\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = "+v.associatedVariableName+`.xy;\r
`):d.isConnected?y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+d.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = vec3("+d.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = "+d.associatedVariableName+`;\r
`):y.hasEndpoints?e.compilationString+=this._declareOutput(y,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:D.hasEndpoints?e.compilationString+=this._declareOutput(D,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:w.hasEndpoints&&(e.compilationString+=this._declareOutput(w,e)+" = vec2("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+`);\r
`),this},t}(Et);function sn(i,t,e,n){return t===void 0&&(t=$t.Boolean),e===void 0&&(e="PROPERTIES"),function(r,o){var l=r._propStore;l||(l=[],r._propStore=l),l.push({propertyName:o,displayName:i,type:t,groupName:e,options:n??{}})}}R.a.RegisteredTypes["BABYLON.VectorMergerBlock"]=ul,function(i){i[i.Boolean=0]="Boolean",i[i.Float=1]="Float",i[i.Vector2=2]="Vector2",i[i.List=3]="List"}($t||($t={}));var fm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.sourceRange=new h.d(-1,1),n.targetRange=new h.d(0,1),n.registerInput("input",_e.AutoDetect),n.registerInput("sourceMin",_e.Float,!0),n.registerInput("sourceMax",_e.Float,!0),n.registerInput("targetMin",_e.Float,!0),n.registerInput("targetMax",_e.Float,!0),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),o=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),l=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),d=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=this._declareOutput(n,e)+" = "+l+" + ("+this._inputs[0].associatedVariableName+" - "+r+") * ("+d+" - "+l+") / ("+o+" - "+r+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".sourceRange = new BABYLON.Vector2("+this.sourceRange.x+", "+this.sourceRange.y+`);\r
`;return e+=this._codeVariableName+".targetRange = new BABYLON.Vector2("+this.targetRange.x+", "+this.targetRange.y+`);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.sourceRange=h.d.FromArray(e.sourceRange),this.targetRange=h.d.FromArray(e.targetRange)},Object(f.c)([sn("From",$t.Vector2)],t.prototype,"sourceRange",void 0),Object(f.c)([sn("To",$t.Vector2)],t.prototype,"targetRange",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.RemapBlock"]=fm;var Sh=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" * "+this.right.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.MultiplyBlock"]=Sh;var Cs=function(){function i(){this.direction1=new h.e(0,1,0),this.direction2=new h.e(0,1,0),this.minEmitBox=new h.e(-.5,-.5,-.5),this.maxEmitBox=new h.e(.5,.5,.5)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=J.a.RandomRange(this.direction1.x,this.direction2.x),l=J.a.RandomRange(this.direction1.y,this.direction2.y),d=J.a.RandomRange(this.direction1.z,this.direction2.z);if(r)return e.x=o,e.y=l,void(e.z=d);h.e.TransformNormalFromFloatsToRef(o,l,d,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=J.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),l=J.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),d=J.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(r)return e.x=o,e.y=l,void(e.z=d);h.e.TransformCoordinatesFromFloatsToRef(o,l,d,t,e)},i.prototype.clone=function(){var t=new i;return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)},i.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},i.prototype.getClassName=function(){return"BoxParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t},i.prototype.parse=function(t){h.e.FromArrayToRef(t.direction1,0,this.direction1),h.e.FromArrayToRef(t.direction2,0,this.direction2),h.e.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),h.e.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)},i}(),pm=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=Math.PI),n===void 0&&(n=0),this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=e,this.radius=t}return Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._buildHeight()},enumerable:!1,configurable:!0}),i.prototype._buildHeight=function(){this._angle!==0?this._height=this._radius/Math.tan(this._angle/2):this._height=1},i.prototype.startDirectionFunction=function(t,e,n,r){r?h.c.Vector3[0].copyFrom(n._localPosition).normalize():n.position.subtractToRef(t.getTranslation(),h.c.Vector3[0]).normalize();var o=J.a.RandomRange(0,this.directionRandomizer),l=J.a.RandomRange(0,this.directionRandomizer),d=J.a.RandomRange(0,this.directionRandomizer);e.x=h.c.Vector3[0].x+o,e.y=h.c.Vector3[0].y+l,e.z=h.c.Vector3[0].z+d,e.normalize()},i.prototype.startPositionFunction=function(t,e,n,r){var o,l=J.a.RandomRange(0,2*Math.PI);o=this.emitFromSpawnPointOnly?1e-4:1-(o=J.a.RandomRange(0,this.heightRange))*o;var d=this._radius-J.a.RandomRange(0,this._radius*this.radiusRange),v=(d*=o)*Math.sin(l),y=d*Math.cos(l),D=o*this._height;if(r)return e.x=v,e.y=D,void(e.z=y);h.e.TransformCoordinatesFromFloatsToRef(v,D,y,t,e)},i.prototype.clone=function(){var t=new i(this._radius,this._angle,this.directionRandomizer);return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){var t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+=`
#define CONEEMITTERSPAWNPOINT`),t},i.prototype.getClassName=function(){return"ConeParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t},i.prototype.parse=function(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=t.radiusRange!==void 0?t.radiusRange:1,this.heightRange=t.radiusRange!==void 0?t.heightRange:1,this.emitFromSpawnPointOnly=t.emitFromSpawnPointOnly!==void 0&&t.emitFromSpawnPointOnly},i}(),xh=function(){function i(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0),this.radius=t,this.height=e,this.radiusRange=n,this.directionRandomizer=r}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=J.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),d=Math.atan2(o.x,o.z);d+=J.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,o.y=l,o.x=Math.sin(d),o.z=Math.cos(d),o.normalize(),r?e.copyFrom(o):h.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=J.a.RandomRange(-this.height/2,this.height/2),l=J.a.RandomRange(0,2*Math.PI),d=J.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),v=Math.sqrt(d)*this.radius,y=v*Math.cos(l),D=v*Math.sin(l);r?e.copyFromFloats(y,o,D):h.e.TransformCoordinatesFromFloatsToRef(y,o,D,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},i.prototype.getClassName=function(){return"CylinderParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),mm=function(i){function t(e,n,r,o,l){e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=new h.e(0,1,0)),l===void 0&&(l=new h.e(0,1,0));var d=i.call(this,e,n,r)||this;return d.direction1=o,d.direction2=l,d}return Object(f.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=J.a.RandomRange(this.direction1.x,this.direction2.x),l=J.a.RandomRange(this.direction1.y,this.direction2.y),d=J.a.RandomRange(this.direction1.z,this.direction2.z);h.e.TransformNormalFromFloatsToRef(o,l,d,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return ye.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(xh),_m=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=J.a.RandomRange(0,this.directionRandomizer),d=J.a.RandomRange(0,this.directionRandomizer),v=J.a.RandomRange(0,this.directionRandomizer);o.x+=l,o.y+=d,o.z+=v,o.normalize(),r?e.copyFrom(o):h.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-J.a.RandomRange(0,this.radius*this.radiusRange),l=J.a.RandomRange(0,1),d=J.a.RandomRange(0,2*Math.PI),v=Math.acos(2*l-1),y=o*Math.cos(d)*Math.sin(v),D=o*Math.cos(v),w=o*Math.sin(d)*Math.sin(v);r?e.copyFromFloats(y,Math.abs(D),w):h.e.TransformCoordinatesFromFloatsToRef(y,Math.abs(D),w,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},i.prototype.getClassName=function(){return"HemisphericParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),gm=function(){function i(){this.direction1=new h.e(0,1,0),this.direction2=new h.e(0,1,0)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=J.a.RandomRange(this.direction1.x,this.direction2.x),l=J.a.RandomRange(this.direction1.y,this.direction2.y),d=J.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,l,d):h.e.TransformNormalFromFloatsToRef(o,l,d,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){r?e.copyFromFloats(0,0,0):h.e.TransformCoordinatesFromFloatsToRef(0,0,0,t,e)},i.prototype.clone=function(){var t=new i;return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},i.prototype.getClassName=function(){return"PointParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},i.prototype.parse=function(t){h.e.FromArrayToRef(t.direction1,0,this.direction1),h.e.FromArrayToRef(t.direction2,0,this.direction2)},i}(),Ah=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=J.a.RandomRange(0,this.directionRandomizer),d=J.a.RandomRange(0,this.directionRandomizer),v=J.a.RandomRange(0,this.directionRandomizer);o.x+=l,o.y+=d,o.z+=v,o.normalize(),r?e.copyFrom(o):h.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-J.a.RandomRange(0,this.radius*this.radiusRange),l=J.a.RandomRange(0,1),d=J.a.RandomRange(0,2*Math.PI),v=Math.acos(2*l-1),y=o*Math.cos(d)*Math.sin(v),D=o*Math.cos(v),w=o*Math.sin(d)*Math.sin(v);r?e.copyFromFloats(y,D,w):h.e.TransformCoordinatesFromFloatsToRef(y,D,w,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},i.prototype.getClassName=function(){return"SphereParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),vm=function(i){function t(e,n,r){e===void 0&&(e=1),n===void 0&&(n=new h.e(0,1,0)),r===void 0&&(r=new h.e(0,1,0));var o=i.call(this,e)||this;return o.direction1=n,o.direction2=r,o}return Object(f.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=J.a.RandomRange(this.direction1.x,this.direction2.x),l=J.a.RandomRange(this.direction1.y,this.direction2.y),d=J.a.RandomRange(this.direction1.z,this.direction2.z);h.e.TransformNormalFromFloatsToRef(o,l,d,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.direction1,this.direction2);return ye.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(Ah),Rs=function(){function i(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=h.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,o);var l=h.c.Vector3[1];o.subtractToRef(n.position,l),l.scaleToRef(1/n.lifeTime,o)}else o.set(0,0,0);r?e.copyFrom(o):h.e.TransformNormalToRef(o,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=h.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,o):o.set(0,0,0),r?e.copyFrom(o):h.e.TransformCoordinatesToRef(o,t,e)},i.prototype.clone=function(){var t=new i;return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){},i.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},i.prototype.getClassName=function(){return"CustomParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t},i.prototype.parse=function(t){},i}(),V0=function(){function i(t){t===void 0&&(t=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=h.e.Zero(),this._mesh=null,this.direction1=new h.e(0,1,0),this.direction2=new h.e(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}return Object.defineProperty(i.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.getIndices(),this._positions=t.getVerticesData(De.b.PositionKind),this._normals=t.getVerticesData(De.b.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),i.prototype.startDirectionFunction=function(t,e,n,r){if(this.useMeshNormalsForDirection&&this._normals)h.e.TransformNormalToRef(this._storedNormal,t,e);else{var o=J.a.RandomRange(this.direction1.x,this.direction2.x),l=J.a.RandomRange(this.direction1.y,this.direction2.y),d=J.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,l,d):h.e.TransformNormalFromFloatsToRef(o,l,d,t,e)}},i.prototype.startPositionFunction=function(t,e,n,r){if(this._indices&&this._positions){var o=3*Math.random()*(this._indices.length/3)|0,l=Math.random(),d=Math.random()*(1-l),v=1-l-d,y=this._indices[o],D=this._indices[o+1],w=this._indices[o+2],F=h.c.Vector3[0],z=h.c.Vector3[1],k=h.c.Vector3[2],K=h.c.Vector3[3];h.e.FromArrayToRef(this._positions,3*y,F),h.e.FromArrayToRef(this._positions,3*D,z),h.e.FromArrayToRef(this._positions,3*w,k),K.x=l*F.x+d*z.x+v*k.x,K.y=l*F.y+d*z.y+v*k.y,K.z=l*F.z+d*z.z+v*k.z,r?e.copyFromFloats(K.x,K.y,K.z):h.e.TransformCoordinatesFromFloatsToRef(K.x,K.y,K.z,t,e),this.useMeshNormalsForDirection&&this._normals&&(h.e.FromArrayToRef(this._normals,3*y,F),h.e.FromArrayToRef(this._normals,3*D,z),h.e.FromArrayToRef(this._normals,3*w,k),this._storedNormal.x=l*F.x+d*z.x+v*k.x,this._storedNormal.y=l*F.y+d*z.y+v*k.y,this._storedNormal.z=l*F.z+d*z.z+v*k.z)}},i.prototype.clone=function(){var t=new i(this.mesh);return ye.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return""},i.prototype.getClassName=function(){return"MeshParticleEmitter"},i.prototype.serialize=function(){var t,e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.meshId=(t=this.mesh)===null||t===void 0?void 0:t.id,e.useMeshNormalsForDirection=this.useMeshNormalsForDirection,e},i.prototype.parse=function(t,e){h.e.FromArrayToRef(t.direction1,0,this.direction1),h.e.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&e&&(this.mesh=e.getLastMeshByID(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection},i}(),hl=function(){function i(t){this.animations=[],this.renderingGroupId=0,this.emitter=h.e.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new h.e(10,10,10),this.onAnimationEnd=null,this.blendMode=i.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new h.d(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new h.e(0,0,0),this.gravity=h.e.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new C.b(1,1,1,1),this.color2=new C.b(1,1,1,1),this.colorDead=new C.b(0,0,0,1),this.textureMask=new C.b(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=g.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new fr.b,this.id=t,this.name=t}return Object.defineProperty(i.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},i.prototype.getDragGradients=function(){return this._dragGradients},i.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},i.prototype.getColorGradients=function(){return this._colorGradients},i.prototype.getSizeGradients=function(){return this._sizeGradients},i.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},i.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},i.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},i.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},i.prototype.getVelocityGradients=function(){return this._velocityGradients},i.prototype.getStartSizeGradients=function(){return this._startSizeGradients},i.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(i.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:h.e.Zero()},set:function(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:h.e.Zero()},set:function(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:h.e.Zero()},set:function(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:h.e.Zero()},set:function(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(t){this._attachImageProcessingConfiguration(t)},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)},i.prototype._reset=function(){},i.prototype._removeGradientAndTexture=function(t,e,n){if(!e)return this;for(var r=0,o=0,l=e;o<l.length;o++){if(l[o].gradient===t){e.splice(r,1);break}r++}return n&&n.dispose(),this},i.prototype.createPointEmitter=function(t,e){var n=new gm;return n.direction1=t,n.direction2=e,this.particleEmitterType=n,n},i.prototype.createHemisphericEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new _m(t,e);return this.particleEmitterType=n,n},i.prototype.createSphereEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new Ah(t,e);return this.particleEmitterType=n,n},i.prototype.createDirectedSphereEmitter=function(t,e,n){t===void 0&&(t=1),e===void 0&&(e=new h.e(0,1,0)),n===void 0&&(n=new h.e(0,1,0));var r=new vm(t,e,n);return this.particleEmitterType=r,r},i.prototype.createCylinderEmitter=function(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0);var o=new xh(t,e,n,r);return this.particleEmitterType=o,o},i.prototype.createDirectedCylinderEmitter=function(t,e,n,r,o){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=new h.e(0,1,0)),o===void 0&&(o=new h.e(0,1,0));var l=new mm(t,e,n,r,o);return this.particleEmitterType=l,l},i.prototype.createConeEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=Math.PI/4);var n=new pm(t,e);return this.particleEmitterType=n,n},i.prototype.createBoxEmitter=function(t,e,n,r){var o=new Cs;return this.particleEmitterType=o,this.direction1=t,this.direction2=e,this.minEmitBox=n,this.maxEmitBox=r,o},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i.BLENDMODE_ADD=2,i.BLENDMODE_MULTIPLY=3,i.BLENDMODE_MULTIPLYADD=4,i}(),bm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("rgba",_e.Color4,!0),n.registerInput("rgb ",_e.Color3,!0),n.registerOutput("rgb",_e.Color3),n.registerOutput("r",_e.Float),n.registerOutput("g",_e.Float),n.registerOutput("b",_e.Float),n.registerOutput("a",_e.Float),n.inputsAreExclusive=!0,n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return e==="rgb "?"rgbIn":e},t.prototype._outputRename=function(e){return e==="rgb"?"rgbOut":e},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba.isConnected?this.rgba:this.rgbIn;if(n.isConnected){var r=this._outputs[0],o=this._outputs[1],l=this._outputs[2],d=this._outputs[3],v=this._outputs[4];return r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.rgb;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.r;\r
`),l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = "+n.associatedVariableName+`.g;\r
`),d.hasEndpoints&&(e.compilationString+=this._declareOutput(d,e)+" = "+n.associatedVariableName+`.b;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.a;\r
`),this}},t}(Et);R.a.RegisteredTypes["BABYLON.ColorSplitterBlock"]=bm;var Un,k0=c(104);(function(i){i[i.Cos=0]="Cos",i[i.Sin=1]="Sin",i[i.Abs=2]="Abs",i[i.Exp=3]="Exp",i[i.Exp2=4]="Exp2",i[i.Round=5]="Round",i[i.Floor=6]="Floor",i[i.Ceiling=7]="Ceiling",i[i.Sqrt=8]="Sqrt",i[i.Log=9]="Log",i[i.Tan=10]="Tan",i[i.ArcTan=11]="ArcTan",i[i.ArcCos=12]="ArcCos",i[i.ArcSin=13]="ArcSin",i[i.Fract=14]="Fract",i[i.Sign=15]="Sign",i[i.Radians=16]="Radians",i[i.Degrees=17]="Degrees"})(Un||(Un={}));var ym=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.operation=Un.Cos,n.registerInput("input",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="";switch(this.operation){case Un.Cos:r="cos";break;case Un.Sin:r="sin";break;case Un.Abs:r="abs";break;case Un.Exp:r="exp";break;case Un.Exp2:r="exp2";break;case Un.Round:r="round";break;case Un.Floor:r="floor";break;case Un.Ceiling:r="ceil";break;case Un.Sqrt:r="sqrt";break;case Un.Log:r="log";break;case Un.Tan:r="tan";break;case Un.ArcTan:r="atan";break;case Un.ArcCos:r="acos";break;case Un.ArcSin:r="asin";break;case Un.Fract:r="fract";break;case Un.Sign:r="sign";break;case Un.Radians:r="radians";break;case Un.Degrees:r="degrees"}return e.compilationString+=this._declareOutput(n,e)+" = "+r+"("+this.input.associatedVariableName+`);\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.operation=this.operation,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.operation=e.operation},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".operation = BABYLON.TrigonometryBlockOperations."+Un[this.operation]+`;\r
`},t}(Et);R.a.RegisteredTypes["BABYLON.TrigonometryBlock"]=ym;var Tm={effect:null,subMesh:null},dl=function(i){function t(){var e=i.call(this)||this;return e.NORMAL=!1,e.TANGENT=!1,e.UV1=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.BUMPDIRECTUV=0,e.rebuild(),e}return Object(f.d)(t,i),t.prototype.setValue=function(e,n,r){r===void 0&&(r=!1),this[e]===void 0&&this._keys.push(e),r&&this[e]!==n&&this.markAsUnprocessed(),this[e]=n},t}(sh.a),Ph=function(i){function t(e,n,r){r===void 0&&(r={});var o=i.call(this,e,n||He.a.LastCreatedScene)||this;return o._buildId=t._BuildIdGenerator++,o._buildWasSuccessful=!1,o._cachedWorldViewMatrix=new h.a,o._cachedWorldViewProjectionMatrix=new h.a,o._optimizers=new Array,o._animationFrame=-1,o.BJSNODEMATERIALEDITOR=o._getGlobalNodeMaterialEditor(),o.editorData=null,o.ignoreAlpha=!1,o.maxSimultaneousLights=4,o.onBuildObservable=new S.c,o._vertexOutputNodes=new Array,o._fragmentOutputNodes=new Array,o.attachedBlocks=new Array,o._mode=Ir.Material,o._options=Object(f.a)({emitComments:!1},r),o._attachImageProcessingConfiguration(null),o}return Object(f.d)(t,i),t.prototype._getGlobalNodeMaterialEditor=function(){return typeof NODEEDITOR!="undefined"?NODEEDITOR:typeof BABYLON!="undefined"&&BABYLON.NodeEditor!==void 0?BABYLON:void 0},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"NodeMaterial"},t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},t.prototype.getBlockByName=function(e){for(var n=null,r=0,o=this.attachedBlocks;r<o.length;r++){var l=o[r];if(l.name===e){if(n)return et.b.Warn("More than one block was found with the name `"+e+"`"),n;n=l}}return n},t.prototype.getBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(e(o))return o}return null},t.prototype.getInputBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(o.isInput&&e(o))return o}return null},t.prototype.getInputBlocks=function(){for(var e=[],n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];o.isInput&&e.push(o)}return e},t.prototype.registerOptimizer=function(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this},t.prototype.unregisterOptimizer=function(e){var n=this._optimizers.indexOf(e);if(n!==-1)return this._optimizers.splice(n,1),this},t.prototype.addOutputNode=function(e){if(e.target===null)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return(e.target&Me.Vertex)!=0&&this._addVertexOutputNode(e),(e.target&Me.Fragment)!=0&&this._addFragmentOutputNode(e),this},t.prototype.removeOutputNode=function(e){return e.target===null||((e.target&Me.Vertex)!=0&&this._removeVertexOutputNode(e),(e.target&Me.Fragment)!=0&&this._removeFragmentOutputNode(e)),this},t.prototype._addVertexOutputNode=function(e){if(this._vertexOutputNodes.indexOf(e)===-1)return e.target=Me.Vertex,this._vertexOutputNodes.push(e),this},t.prototype._removeVertexOutputNode=function(e){var n=this._vertexOutputNodes.indexOf(e);if(n!==-1)return this._vertexOutputNodes.splice(n,1),this},t.prototype._addFragmentOutputNode=function(e){if(this._fragmentOutputNodes.indexOf(e)===-1)return e.target=Me.Fragment,this._fragmentOutputNodes.push(e),this},t.prototype._removeFragmentOutputNode=function(e){var n=this._fragmentOutputNodes.indexOf(e);if(n!==-1)return this._fragmentOutputNodes.splice(n,1),this},t.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},t.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},t.prototype._initializeBlock=function(e,n,r){if(e.initialize(n),e.autoConfigure(this),e._preparationId=this._buildId,this.attachedBlocks.indexOf(e)===-1){if(e.isUnique){for(var o=e.getClassName(),l=0,d=this.attachedBlocks;l<d.length;l++)if(d[l].getClassName()===o)throw"Cannot have multiple blocks of type "+o+" in the same NodeMaterial"}this.attachedBlocks.push(e)}for(var v=0,y=e.inputs;v<y.length;v++){var D=y[v];D.associatedVariableName="";var w=D.connectedPoint;if(w){var F=w.ownerBlock;F!==e&&((F.target===Me.VertexAndFragment||n.target===Me.Fragment&&F.target===Me.Vertex&&F._preparationId!==this._buildId)&&r.push(F),this._initializeBlock(F,n,r))}}for(var z=0,k=e.outputs;z<k.length;z++)k[z].associatedVariableName=""},t.prototype._resetDualBlocks=function(e,n){e.target===Me.VertexAndFragment&&(e.buildId=n);for(var r=0,o=e.inputs;r<o.length;r++){var l=o[r].connectedPoint;if(l){var d=l.ownerBlock;d!==e&&this._resetDualBlocks(d,n)}}},t.prototype.removeBlock=function(e){var n=this.attachedBlocks.indexOf(e);n>-1&&this.attachedBlocks.splice(n,1),e.isFinalMerger&&this.removeOutputNode(e)},t.prototype.build=function(e){e===void 0&&(e=!1),this._buildWasSuccessful=!1;var n=this.getScene().getEngine(),r=this._mode===Ir.Particle;if(this._vertexOutputNodes.length===0&&!r)throw"You must define at least one vertexOutputNode";if(this._fragmentOutputNodes.length===0)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new B0,this._vertexCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._vertexCompilationState.target=Me.Vertex,this._fragmentCompilationState=new B0,this._fragmentCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._fragmentCompilationState.target=Me.Fragment,this._sharedData=new bw,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=r;for(var o=[],l=[],d=0,v=this._vertexOutputNodes;d<v.length;d++){var y=v[d];o.push(y),this._initializeBlock(y,this._vertexCompilationState,l)}for(var D=0,w=this._fragmentOutputNodes;D<w.length;D++){var F=w[D];l.push(F),this._initializeBlock(F,this._fragmentCompilationState,o)}this.optimize();for(var z=0,k=o;z<k.length;z++)(y=k[z]).build(this._vertexCompilationState,o);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var K=0,ae=l;K<ae.length;K++)F=ae[K],this._resetDualBlocks(F,this._buildId-1);for(var le=0,fe=l;le<fe.length;le++)(F=fe[le]).build(this._fragmentCompilationState,l);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),this._buildId=t._BuildIdGenerator++,this._sharedData.emitErrors(),e&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString)),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var me=0,be=this.getScene().meshes;me<be.length;me++){var Ee=be[me];if(Ee.subMeshes)for(var xe=0,Ae=Ee.subMeshes;xe<Ae.length;xe++){var Ie=Ae[xe];if(Ie.getMaterial()===this&&Ie._materialDefines){var Re=Ie._materialDefines;Re.markAllAsDirty(),Re.reset()}}}},t.prototype.optimize=function(){for(var e=0,n=this._optimizers;e<n.length;e++)n[e].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)},t.prototype._prepareDefinesForAttributes=function(e,n){var r=n.NORMAL,o=n.TANGENT,l=n.UV1;n.NORMAL=e.isVerticesDataPresent(De.b.NormalKind),n.TANGENT=e.isVerticesDataPresent(De.b.TangentKind),n.UV1=e.isVerticesDataPresent(De.b.UVKind),r===n.NORMAL&&o===n.TANGENT&&l===n.UV1||n.markAsAttributesDirty()},t.prototype.createPostProcess=function(e,n,r,o,l,d,v){return n===void 0&&(n=1),r===void 0&&(r=g.a.TEXTURE_NEAREST_SAMPLINGMODE),d===void 0&&(d=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=g.a.TEXTUREFORMAT_RGBA),this.mode!==Ir.PostProcess?(console.log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,n,r,o,l,d,v)},t.prototype.createEffectForPostProcess=function(e){this._createEffectForPostProcess(e)},t.prototype._createEffectForPostProcess=function(e,n,r,o,l,d,v,y){var D=this;r===void 0&&(r=1),o===void 0&&(o=g.a.TEXTURE_NEAREST_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=g.a.TEXTUREFORMAT_RGBA);var w=this.name+this._buildId,F=new dl,z=new jt.a(w+"PostProcess",this.getScene()),k=this._buildId;return this._processDefines(z,F),Qe.a.RegisterShader(w,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),e?e.updateEffect(F.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,w,w):e=new St(this.name+"PostProcess",w,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,r,n,o,l,d,F.toString(),v,w,{maxSimultaneousLights:this.maxSimultaneousLights},!1,y),e.nodeMaterialSource=this,e.onApplyObservable.add(function(K){k!==D._buildId&&(delete Qe.a.ShadersStore[w+"VertexShader"],delete Qe.a.ShadersStore[w+"PixelShader"],w=D.name+D._buildId,F.markAsUnprocessed(),k=D._buildId),D._processDefines(z,F)&&(Qe.a.RegisterShader(w,D._fragmentCompilationState._builtCompilationString,D._vertexCompilationState._builtCompilationString),k0.a.SetImmediate(function(){return e.updateEffect(F.toString(),D._fragmentCompilationState.uniforms,D._fragmentCompilationState.samplers,{maxSimultaneousLights:D.maxSimultaneousLights},void 0,void 0,w,w)})),D._checkInternals(K)}),e},t.prototype.createProceduralTexture=function(e,n){var r=this;if(this.mode!==Ir.ProceduralTexture)return console.log("Incompatible material mode"),null;var o=this.name+this._buildId,l=new cl(o,e,null,n),d=new jt.a(o+"Procedural",this.getScene());d.reservedDataStore={hidden:!0};var v=new dl,y=this._processDefines(d,v);Qe.a.RegisterShader(o,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);var D=this.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[De.b.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,v.toString(),y==null?void 0:y.fallbacks,void 0);l.nodeMaterialSource=this,l._effect=D;var w=this._buildId;return l.onBeforeGenerationObservable.add(function(){w!==r._buildId&&(delete Qe.a.ShadersStore[o+"VertexShader"],delete Qe.a.ShadersStore[o+"PixelShader"],o=r.name+r._buildId,v.markAsUnprocessed(),w=r._buildId);var F=r._processDefines(d,v);F&&(Qe.a.RegisterShader(o,r._fragmentCompilationState._builtCompilationString,r._vertexCompilationState._builtCompilationString),k0.a.SetImmediate(function(){D=r.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[De.b.PositionKind],r._fragmentCompilationState.uniforms,r._fragmentCompilationState.samplers,v.toString(),F==null?void 0:F.fallbacks,void 0),l._effect=D})),r._checkInternals(D)}),l},t.prototype._createEffectForParticles=function(e,n,r,o,l,d,v,y){var D=this;y===void 0&&(y="");var w=this.name+this._buildId+"_"+n;d||(d=new dl),v||(v=this.getScene().getMeshByName(this.name+"Particle"))||((v=new jt.a(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});var F=this._buildId,z=[],k=y;if(!l){var K=this._processDefines(v,d);Qe.a.RegisterShader(w,this._fragmentCompilationState._builtCompilationString),e.fillDefines(z,n),k=z.join(`
`),l=this.getScene().getEngine().createEffectForParticles(w,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,d.toString()+`
`+k,K==null?void 0:K.fallbacks,r,o,e),e.setCustomEffect(l,n)}l.onBindObservable.add(function(ae){F!==D._buildId&&(delete Qe.a.ShadersStore[w+"PixelShader"],w=D.name+D._buildId+"_"+n,d.markAsUnprocessed(),F=D._buildId),z.length=0,e.fillDefines(z,n);var le=z.join(`
`);le!==k&&(d.markAsUnprocessed(),k=le);var fe=D._processDefines(v,d);if(fe)return Qe.a.RegisterShader(w,D._fragmentCompilationState._builtCompilationString),ae=D.getScene().getEngine().createEffectForParticles(w,D._fragmentCompilationState.uniforms,D._fragmentCompilationState.samplers,d.toString()+`
`+k,fe==null?void 0:fe.fallbacks,r,o,e),e.setCustomEffect(ae,n),void D._createEffectForParticles(e,n,r,o,ae,d,v,k);D._checkInternals(ae)})},t.prototype._checkInternals=function(e){if(this._sharedData.animatedInputs){var n=this.getScene(),r=n.getFrameId();if(this._animationFrame!==r){for(var o=0,l=this._sharedData.animatedInputs;o<l.length;o++)l[o].animate(n);this._animationFrame=r}}for(var d=0,v=this._sharedData.bindableBlocks;d<v.length;d++)v[d].bind(e,this);for(var y=0,D=this._sharedData.inputBlocks;y<D.length;y++)D[y]._transmit(e,this.getScene())},t.prototype.createEffectForParticles=function(e,n,r){this.mode===Ir.Particle?(this._createEffectForParticles(e,hl.BLENDMODE_ONEONE,n,r),this._createEffectForParticles(e,hl.BLENDMODE_MULTIPLY,n,r)):console.log("Incompatible material mode")},t.prototype._processDefines=function(e,n,r,o){var l=this;r===void 0&&(r=!1);var d=null;if(this._sharedData.blocksWithDefines.forEach(function(z){z.initializeDefines(e,l,n,r)}),this._sharedData.blocksWithDefines.forEach(function(z){z.prepareDefines(e,l,n,r,o)}),n.isDirty){var v=n._areLightsDisposed;n.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach(function(z){z.replaceRepeatableContent(l._vertexCompilationState,l._fragmentCompilationState,e,n)});var y=[];this._sharedData.dynamicUniformBlocks.forEach(function(z){z.updateUniformsAndSamples(l._vertexCompilationState,l,n,y)});var D=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach(function(z){D.indexOf(z)===-1&&D.push(z)});var w=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach(function(z){w.indexOf(z)===-1&&w.push(z)});var F=new _s.a;this._sharedData.blocksWithFallbacks.forEach(function(z){z.provideFallbacks(e,F)}),d={lightDisposed:v,uniformBuffers:y,mergedUniforms:D,mergedSamplers:w,fallbacks:F}}return d},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),!this._buildWasSuccessful)return!1;var l=this.getScene();if(this._sharedData.animatedInputs){var d=l.getFrameId();if(this._animationFrame!==d){for(var v=0,y=this._sharedData.animatedInputs;v<y.length;v++)y[v].animate(l);this._animationFrame=d}}if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new dl);var D=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var w=l.getEngine();if(this._prepareDefinesForAttributes(e,D),this._sharedData.blockingBlocks.some(function(ae){return!ae.isReady(e,o,D,r)}))return!1;var F=this._processDefines(e,D,r,n);if(F){var z=n.effect,k=D.toString(),K=w.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:F.mergedUniforms,uniformBuffersNames:F.uniformBuffers,samplers:F.mergedSamplers,defines:k,fallbacks:F.fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:D.NUM_MORPH_INFLUENCERS}},w);if(K)if(this._onEffectCreatedObservable&&(Tm.effect=K,Tm.subMesh=n,this._onEffectCreatedObservable.notifyObservers(Tm)),this.allowShaderHotSwapping&&z&&!K.isReady()){if(K=z,D.markAsUnprocessed(),F.lightDisposed)return D._areLightsDisposed=!0,!1}else l.resetCachedMaterial(),n.setEffect(K,D)}return!(!n.effect||!n.effect.isReady())&&(D._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},Object.defineProperty(t.prototype,"compiledShaders",{get:function(){return`// Vertex shader\r
`+this._vertexCompilationState.compilationString+`\r
\r
// Fragment shader\r
`+this._fragmentCompilationState.compilationString},enumerable:!1,configurable:!0}),t.prototype.bindOnlyWorldMatrix=function(e){var n=this.getScene();if(this._activeEffect){var r=this._sharedData.hints;r.needWorldViewMatrix&&e.multiplyToRef(n.getViewMatrix(),this._cachedWorldViewMatrix),r.needWorldViewProjectionMatrix&&e.multiplyToRef(n.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var o=0,l=this._sharedData.inputBlocks;o<l.length;o++)l[o]._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r.effect;if(l){if(this._activeEffect=l,this.bindOnlyWorldMatrix(e),this._mustRebind(o,l,n.visibility)){var d=this._sharedData;if(l&&o.getCachedEffect()!==l){for(var v=0,y=d.bindableBlocks;v<y.length;v++)y[v].bind(l,this,n,r);for(var D=0,w=d.inputBlocks;D<w.length;D++)w[D]._transmit(l,o)}}this._afterBind(n,this._activeEffect)}},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._sharedData&&e.push.apply(e,this._sharedData.textureBlocks.filter(function(n){return n.texture}).map(function(n){return n.texture})),e},t.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},t.prototype.hasTexture=function(e){if(i.prototype.hasTexture.call(this,e))return!0;if(!this._sharedData)return!1;for(var n=0,r=this._sharedData.textureBlocks;n<r.length;n++)if(r[n].texture===e)return!0;return!1},t.prototype.dispose=function(e,n,r){if(n)for(var o=0,l=this._sharedData.textureBlocks.filter(function(y){return y.texture}).map(function(y){return y.texture});o<l.length;o++)l[o].dispose();for(var d=0,v=this.attachedBlocks;d<v.length;d++)v[d].dispose();this.onBuildObservable.clear(),i.prototype.dispose.call(this,e,n,r)},t.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},t.prototype.edit=function(e){var n=this;return new Promise(function(r,o){if(n.BJSNODEMATERIALEDITOR===void 0){var l=e&&e.editorURL?e.editorURL:t.EditorURL;et.b.LoadScript(l,function(){n._createNodeEditor(),r()})}else n._createNodeEditor(),r()})},t.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},t.prototype.setToDefault=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position");var n=new Bt("World");n.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var r=new Eh("WorldPos");e.connectTo(r),n.connectTo(r);var o=new Bt("ViewProjection");o.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);var l=new Eh("WorldPos * ViewProjectionTransform");r.connectTo(l),o.connectTo(l);var d=new ll("VertexOutput");l.connectTo(d);var v=new Bt("color");v.value=new C.b(.8,.8,.8,1);var y=new Ps("FragmentOutput");v.connectTo(y),this.addOutputNode(d),this.addOutputNode(y),this._mode=Ir.Material},t.prototype.setToDefaultPostProcess=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position2d");var n=new Bt("Constant1");n.isConstant=!0,n.value=1;var r=new ul("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new ll("VertexOutput");r.connectTo(o);var l=new Bt("Scale");l.visibleInInspector=!0,l.value=new h.d(1,1);var d=new fm("uv0");e.connectTo(d);var v=new Sh("UV scale");d.connectTo(v),l.connectTo(v);var y=new lm("CurrentScreen");v.connectTo(y),y.texture=new ke.a("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());var D=new Ps("FragmentOutput");y.connectTo(D,{output:"rgba"}),this.addOutputNode(o),this.addOutputNode(D),this._mode=Ir.PostProcess},t.prototype.setToDefaultProceduralTexture=function(){this.clear(),this.editorData=null;var e=new Bt("Position");e.setAsAttribute("position2d");var n=new Bt("Constant1");n.isConstant=!0,n.value=1;var r=new ul("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new ll("VertexOutput");r.connectTo(o);var l=new Bt("Time");l.value=0,l.min=0,l.max=0,l.isBoolean=!1,l.matrixMode=0,l.animationType=Ho.Time,l.isConstant=!1;var d=new Bt("Color3");d.value=new C.a(1,1,1),d.isConstant=!1;var v=new Ps("FragmentOutput"),y=new ul("VectorMerger");y.visibleInInspector=!1;var D=new ym("Cos");D.operation=Un.Cos,e.connectTo(y),l.output.connectTo(D.input),D.output.connectTo(y.z),y.xyzOut.connectTo(v.rgb),this.addOutputNode(o),this.addOutputNode(v),this._mode=Ir.ProceduralTexture},t.prototype.setToDefaultParticle=function(){this.clear(),this.editorData=null;var e=new Bt("uv");e.setAsAttribute("particle_uv");var n=new um("ParticleTexture");e.connectTo(n);var r=new Bt("Color");r.setAsAttribute("particle_color");var o=new Sh("Texture * Color");n.connectTo(o),r.connectTo(o);var l=new hm("ParticleRampGradient");o.connectTo(l);var d=new bm("ColorSplitter");r.connectTo(d);var v=new dm("ParticleBlendMultiply");l.connectTo(v),n.connectTo(v,{output:"a"}),d.connectTo(v,{output:"a"});var y=new Ps("FragmentOutput");v.connectTo(y),this.addOutputNode(y),this._mode=Ir.Particle},t.prototype.loadAsync=function(e){var n=this;return this.getScene()._loadFileAsync(e).then(function(r){var o=JSON.parse(r);n.loadFromSerialization(o,"")})},t.prototype._gatherBlocks=function(e,n){if(n.indexOf(e)===-1){n.push(e);for(var r=0,o=e.inputs;r<o.length;r++){var l=o[r].connectedPoint;if(l){var d=l.ownerBlock;d!==e&&this._gatherBlocks(d,n)}}}},t.prototype.generateCode=function(){for(var e=[],n=[],r=[],o=0,l=this._vertexOutputNodes;o<l.length;o++){var d=l[o];this._gatherBlocks(d,n)}for(var v=[],y=0,D=this._fragmentOutputNodes;y<D.length;y++)d=D[y],this._gatherBlocks(d,v);for(var w='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+`");\r
`,F=0,z=n;F<z.length;F++)(Ie=z[F]).isInput&&e.indexOf(Ie)===-1&&(w+=Ie._dumpCode(r,e));for(var k=0,K=v;k<K.length;k++)(Ie=K[k]).isInput&&e.indexOf(Ie)===-1&&(w+=Ie._dumpCode(r,e));e=[],w+=`\r
// Connections\r
`;for(var ae=0,le=this._vertexOutputNodes;ae<le.length;ae++)w+=(Ie=le[ae])._dumpCodeForOutputConnections(e);for(var fe=0,me=this._fragmentOutputNodes;fe<me.length;fe++)w+=(Ie=me[fe])._dumpCodeForOutputConnections(e);w+=`\r
// Output nodes\r
`;for(var be=0,Ee=this._vertexOutputNodes;be<Ee.length;be++)w+="nodeMaterial.addOutputNode("+(Ie=Ee[be])._codeVariableName+`);\r
`;for(var xe=0,Ae=this._fragmentOutputNodes;xe<Ae.length;xe++){var Ie;w+="nodeMaterial.addOutputNode("+(Ie=Ae[xe])._codeVariableName+`);\r
`}return w+=`nodeMaterial.build();\r
`},t.prototype.serialize=function(e){var n=e?{}:B.a.Serialize(this);n.editorData=JSON.parse(JSON.stringify(this.editorData));var r=[];if(e)r=e;else{n.customType="BABYLON.NodeMaterial",n.outputNodes=[];for(var o=0,l=this._vertexOutputNodes;o<l.length;o++){var d=l[o];this._gatherBlocks(d,r),n.outputNodes.push(d.uniqueId)}for(var v=0,y=this._fragmentOutputNodes;v<y.length;v++)d=y[v],this._gatherBlocks(d,r),n.outputNodes.indexOf(d.uniqueId)===-1&&n.outputNodes.push(d.uniqueId)}n.blocks=[];for(var D=0,w=r;D<w.length;D++){var F=w[D];n.blocks.push(F.serialize())}if(!e)for(var z=0,k=this.attachedBlocks;z<k.length;z++)F=k[z],r.indexOf(F)===-1&&n.blocks.push(F.serialize());return n},t.prototype._restoreConnections=function(e,n,r){for(var o=0,l=e.outputs;o<l.length;o++)for(var d=l[o],v=0,y=n.blocks;v<y.length;v++){var D=y[v],w=r[D.id];if(w)for(var F=0,z=D.inputs;F<z.length;F++){var k=z[F];if(!(r[k.targetBlockId]!==e||k.targetConnectionName!==d.name)){var K=w.getInputByName(k.inputName);if(!K||K.isConnected)continue;d.connectTo(K,!0),this._restoreConnections(w,n,r)}}}},t.prototype.loadFromSerialization=function(e,n,r){var o;n===void 0&&(n=""),r===void 0&&(r=!1),r||this.clear();for(var l={},d=0,v=e.blocks;d<v.length;d++){var y=v[d],D=R.a.GetClass(y.customType);D&&((F=new D)._deserialize(y,this.getScene(),n),l[y.id]=F,this.attachedBlocks.push(F))}for(var w=0;w<e.blocks.length;w++){var F;(F=l[e.blocks[w].id])&&(F.inputs.length&&!r||this._restoreConnections(F,e,l))}if(e.outputNodes)for(var z=0,k=e.outputNodes;z<k.length;z++){var K=k[z];this.addOutputNode(l[K])}if(e.locations||e.editorData&&e.editorData.locations){for(var ae=e.locations||e.editorData.locations,le=0,fe=ae;le<fe.length;le++){var me=fe[le];l[me.blockId]&&(me.blockId=l[me.blockId].uniqueId)}r&&this.editorData&&this.editorData.locations&&ae.concat(this.editorData.locations),e.locations?this.editorData={locations:ae}:(this.editorData=e.editorData,this.editorData.locations=ae);var be=[];for(var Ee in l)be[Ee]=l[Ee].uniqueId;this.editorData.map=be}this.comment=e.comment,r||(this._mode=(o=e.mode)!==null&&o!==void 0?o:Ir.Material)},t.prototype.clone=function(e){var n=this,r=this.serialize(),o=B.a.Clone(function(){return new t(e,n.getScene(),n.options)},this);return o.id=e,o.name=e,o.loadFromSerialization(r),o.build(),o},t.Parse=function(e,n,r){r===void 0&&(r="");var o=B.a.Parse(function(){return new t(e.name,n)},e,n,r);return o.loadFromSerialization(e,r),o.build(),o},t.ParseFromFileAsync=function(e,n,r){var o=new t(e,r);return new Promise(function(l,d){return o.loadAsync(n).then(function(){o.build(),l(o)}).catch(d)})},t.ParseFromSnippetAsync=function(e,n,r,o){var l=this;return r===void 0&&(r=""),e==="_BLANK"?Promise.resolve(this.CreateDefault("blank",n)):new Promise(function(d,v){var y=new se.a;y.addEventListener("readystatechange",function(){if(y.readyState==4)if(y.status==200){var D=JSON.parse(JSON.parse(y.responseText).jsonPayload),w=JSON.parse(D.nodeMaterial);o||((o=B.a.Parse(function(){return new t(e,n)},w,n,r)).uniqueId=n.getUniqueId()),o.loadFromSerialization(w),o.snippetId=e;try{o.build(),d(o)}catch(F){v(F)}}else v("Unable to load the snippet "+e)}),y.open("GET",l.SnippetUrl+"/"+e.replace(/#/g,"/")),y.send()})},t.CreateDefault=function(e,n){var r=new t(e,n);return r.setToDefault(),r.build(),r},t._BuildIdGenerator=0,t.EditorURL="https://unpkg.com/babylonjs-node-editor@"+He.a.Version+"/babylon.nodeEditor.js",t.SnippetUrl="https://snippet.babylonjs.com",t.IgnoreTexturesAtLoadTime=!1,Object(f.c)([Object(B.c)("mode")],t.prototype,"_mode",void 0),Object(f.c)([Object(B.c)("comment")],t.prototype,"comment",void 0),t}(ch.a);R.a.RegisteredTypes["BABYLON.NodeMaterial"]=Ph;var j0=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("matricesIndices",_e.Vector4),n.registerInput("matricesWeights",_e.Vector4),n.registerInput("matricesIndicesExtra",_e.Vector4,!0),n.registerInput("matricesWeightsExtra",_e.Vector4,!0),n.registerInput("world",_e.Matrix),n.registerOutput("output",_e.Matrix),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh")},t.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(t.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.matricesIndices.isConnected){var n=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="matricesIndices"});n||(n=new Bt("matricesIndices")).setAsAttribute("matricesIndices"),n.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var r=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="matricesWeights"});r||(r=new Bt("matricesWeights")).setAsAttribute("matricesWeights"),r.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var o=e.getInputBlockByPredicate(function(l){return l.systemValue===Mt.World});o||(o=new Bt("world")).setAsSystemValue(Mt.World),o.output.connectTo(this.world)}},t.prototype.provideFallbacks=function(e,n){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&n.addCPUSkinningFallback(0,e)},t.prototype.bind=function(e,n,r){lt.a.BindBonesParameters(r,e)},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&lt.a.PrepareDefinesForBones(e,r)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithFallbacks.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.uniforms.push("boneTextureWidth"),e.uniforms.push("mBones"),e.samplers.push("boneSampler");var n="//"+this.name;e._emitFunctionFromInclude("bonesDeclaration",n,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var r=e._getFreeVariableName("influence");e.compilationString+=e._emitCodeFromInclude("bonesVertex",n,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:r}]});var o=this._outputs[0],l=this.world;return e.compilationString+=`#if NUM_BONE_INFLUENCERS>0\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+l.associatedVariableName+" * "+r+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+l.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.BonesBlock"]=j0;var z0=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("world0",_e.Vector4),n.registerInput("world1",_e.Vector4),n.registerInput("world2",_e.Vector4),n.registerInput("world3",_e.Vector4),n.registerInput("world",_e.Matrix,!0),n.registerOutput("output",_e.Matrix),n.registerOutput("instanceID",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(t.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.world0.connectedPoint){var n=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world0"});n||(n=new Bt("world0")).setAsAttribute("world0"),n.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var r=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world1"});r||(r=new Bt("world1")).setAsAttribute("world1"),r.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var o=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world2"});o||(o=new Bt("world2")).setAsAttribute("world2"),o.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var l=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world3"});l||(l=new Bt("world3")).setAsAttribute("world3"),l.output.connectTo(this.world3)}if(!this.world.connectedPoint){var d=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world"});d||(d=new Bt("world")).setAsSystemValue(Mt.World),d.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"},t.prototype.prepareDefines=function(e,n,r,o,l){o===void 0&&(o=!1);var d=!1;r.INSTANCES!==o&&(r.setValue("INSTANCES",o),d=!0),l&&r.THIN_INSTANCES!==!!(l==null?void 0:l.getRenderingMesh().hasThinInstances)&&(r.setValue("THIN_INSTANCES",!!(l==null?void 0:l.getRenderingMesh().hasThinInstances)),d=!0),d&&r.markAsUnprocessed()},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this);var n=this._outputs[0],r=this._outputs[1],o=this.world0,l=this.world1,d=this.world2,v=this.world3;return e.compilationString+=`#ifdef INSTANCES\r
`,e.compilationString+=this._declareOutput(n,e)+" = mat4("+o.associatedVariableName+", "+l.associatedVariableName+", "+d.associatedVariableName+", "+v.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef THIN_INSTANCES\r
`,e.compilationString+=n.associatedVariableName+" = "+this.world.associatedVariableName+" * "+n.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+` = float(gl_InstanceID);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this.world.associatedVariableName+`;\r
`,e.compilationString+=this._declareOutput(r,e)+` = 0.0;\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.InstancesBlock"]=z0;var G0=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("position",_e.Vector3),n.registerInput("normal",_e.Vector3),n.registerInput("tangent",_e.Vector3),n.registerInput("uv",_e.Vector2),n.registerOutput("positionOutput",_e.Vector3),n.registerOutput("normalOutput",_e.Vector3),n.registerOutput("tangentOutput",_e.Vector3),n.registerOutput("uvOutput",_e.Vector2),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("morphTargetInfluences")},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(d){return d.isAttribute&&d.name==="position"});n||(n=new Bt("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.normal.isConnected){var r=e.getInputBlockByPredicate(function(d){return d.isAttribute&&d.name==="normal"});r||(r=new Bt("normal")).setAsAttribute("normal"),r.output.connectTo(this.normal)}if(!this.tangent.isConnected){var o=e.getInputBlockByPredicate(function(d){return d.isAttribute&&d.name==="tangent"});o||(o=new Bt("tangent")).setAsAttribute("tangent"),o.output.connectTo(this.tangent)}if(!this.uv.isConnected){var l=e.getInputBlockByPredicate(function(d){return d.isAttribute&&d.name==="uv"});l||(l=new Bt("uv")).setAsAttribute("uv"),l.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&lt.a.PrepareDefinesForMorphTargets(e,r)},t.prototype.bind=function(e,n,r){r&&r.morphTargetManager&&r.morphTargetManager.numInfluencers>0&&lt.a.BindMorphTargetParameters(r,e)},t.prototype.replaceRepeatableContent=function(e,n,r,o){for(var l=this.position,d=this.normal,v=this.tangent,y=this.uv,D=this.positionOutput,w=this.normalOutput,F=this.tangentOutput,z=this.uvOutput,k=e,K=o.NUM_MORPH_INFLUENCERS,ae=r.morphTargetManager,le=ae&&ae.supportsNormals&&o.NORMAL,fe=ae&&ae.supportsTangents&&o.TANGENT,me=ae&&ae.supportsUVs&&o.UV1,be="",Ee=0;Ee<K;Ee++)be+=`#ifdef MORPHTARGETS\r
`,be+=D.associatedVariableName+" += (position"+Ee+" - "+l.associatedVariableName+") * morphTargetInfluences["+Ee+`];\r
`,le&&(be+=`#ifdef MORPHTARGETS_NORMAL\r
`,be+=w.associatedVariableName+" += (normal"+Ee+" - "+d.associatedVariableName+") * morphTargetInfluences["+Ee+`];\r
`,be+=`#endif\r
`),fe&&(be+=`#ifdef MORPHTARGETS_TANGENT\r
`,be+=F.associatedVariableName+".xyz += (tangent"+Ee+" - "+v.associatedVariableName+".xyz) * morphTargetInfluences["+Ee+`];\r
`,be+=`#endif\r
`),me&&(be+=`#ifdef MORPHTARGETS_UV\r
`,be+=z.associatedVariableName+".xy += (uv_"+Ee+" - "+y.associatedVariableName+".xy) * morphTargetInfluences["+Ee+`];\r
`,be+=`#endif\r
`),be+=`#endif\r
`;if(k.compilationString=k.compilationString.replace(this._repeatableContentAnchor,be),K>0)for(Ee=0;Ee<K;Ee++)k.attributes.push(De.b.PositionKind+Ee),le&&k.attributes.push(De.b.NormalKind+Ee),fe&&k.attributes.push(De.b.TangentKind+Ee),me&&k.attributes.push(De.b.UVKind+"_"+Ee)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.repeatableContentBlocks.push(this);var n=this.position,r=this.normal,o=this.tangent,l=this.uv,d=this.positionOutput,v=this.normalOutput,y=this.tangentOutput,D=this.uvOutput,w="//"+this.name;return e.uniforms.push("morphTargetInfluences"),e._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",w),e._emitFunctionFromInclude("morphTargetsVertexDeclaration",w,{repeatKey:"maxSimultaneousMorphTargets"}),e.compilationString+=this._declareOutput(d,e)+" = "+n.associatedVariableName+`;\r
`,e.compilationString+=`#ifdef NORMAL\r
`,e.compilationString+=this._declareOutput(v,e)+" = "+r.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(v,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef TANGENT\r
`,e.compilationString+=this._declareOutput(y,e)+" = "+o.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(y,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef UV1\r
`,e.compilationString+=this._declareOutput(D,e)+" = "+l.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(D,e)+` = vec2(0., 0.);\r
`,e.compilationString+=`#endif\r
`,this._repeatableContentAnchor=e._repeatableContentAnchor,e.compilationString+=this._repeatableContentAnchor,this},t}(Et);R.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=G0;var H0=function(i){function t(e){var n=i.call(this,e,Me.Vertex)||this;return n.registerInput("worldPosition",_e.Vector4,!1,Me.Vertex),n.registerOutput("direction",_e.Vector3),n.registerOutput("color",_e.Color3),n.registerOutput("intensity",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){if(r){this.light&&this.light.isDisposed&&(this.light=null);var o=this.light,l=n.getScene();if(!o&&l.lights.length&&(o=l.lights[0]),!o||!o.isEnabled)return e.setFloat3(this._lightDataUniformName,0,0,0),void e.setFloat4(this._lightColorUniformName,0,0,0,0);o.transferToNodeMaterialEffect(e,this._lightDataUniformName),e.setColor4(this._lightColorUniformName,o.diffuse,o.intensity)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=this.light;r.setValue(this._lightTypeDefineName,!!(o&&o instanceof em))}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n=this.direction,r=this.color,o=this.intensity;return this._lightDataUniformName=e._getFreeVariableName("lightData"),this._lightColorUniformName=e._getFreeVariableName("lightColor"),this._lightTypeDefineName=e._getFreeDefineName("LIGHTPOINTTYPE"),e._emitUniformFromString(this._lightDataUniformName,"vec3"),e._emitUniformFromString(this._lightColorUniformName,"vec4"),e.compilationString+="#ifdef "+this._lightTypeDefineName+`\r
`,e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+`);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this._lightDataUniformName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+" = "+this._lightColorUniformName+`.rgb;\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+this._lightColorUniformName+`.a;\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(Et);R.a.RegisteredTypes["BABYLON.LightInformationBlock"]=H0;var W0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerInput("color",_e.Color4),n.registerOutput("output",_e.Color4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("exposureLinear"),e._excludeVariableName("contrast"),e._excludeVariableName("vInverseScreenSize"),e._excludeVariableName("vignetteSettings1"),e._excludeVariableName("vignetteSettings2"),e._excludeVariableName("vCameraColorCurveNegative"),e._excludeVariableName("vCameraColorCurveNeutral"),e._excludeVariableName("vCameraColorCurvePositive"),e._excludeVariableName("txColorTransform"),e._excludeVariableName("colorTransformSettings")},t.prototype.isReady=function(e,n,r){return!(r._areImageProcessingDirty&&n.imageProcessingConfiguration&&!n.imageProcessingConfiguration.isReady())},t.prototype.prepareDefines=function(e,n,r){r._areImageProcessingDirty&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.prepareDefines(r)},t.prototype.bind=function(e,n,r){r&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.bind(e)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.blockingBlocks.push(this),e.sharedData.bindableBlocks.push(this),e.uniforms.push("exposureLinear"),e.uniforms.push("contrast"),e.uniforms.push("vInverseScreenSize"),e.uniforms.push("vignetteSettings1"),e.uniforms.push("vignetteSettings2"),e.uniforms.push("vCameraColorCurveNegative"),e.uniforms.push("vCameraColorCurveNeutral"),e.uniforms.push("vCameraColorCurvePositive"),e.uniforms.push("txColorTransform"),e.uniforms.push("colorTransformSettings");var n=this.color,r=this._outputs[0],o="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",o),e._emitFunctionFromInclude("imageProcessingDeclaration",o),e._emitFunctionFromInclude("imageProcessingFunctions",o),n.connectedPoint.type===_e.Color4||n.connectedPoint.type===_e.Vector4?e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`;\r
`:e.compilationString+=this._declareOutput(r,e)+" = vec4("+n.associatedVariableName+`, 1.0);\r
`,e.compilationString+=`#ifdef IMAGEPROCESSINGPOSTPROCESS\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=`#ifdef IMAGEPROCESSING\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=r.associatedVariableName+" = applyImageProcessing("+r.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#endif\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=W0;var X0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._tangentSpaceParameterName="",n.invertX=!1,n.invertY=!1,n.registerInput("worldPosition",_e.Vector4,!1),n.registerInput("worldNormal",_e.Vector4,!1),n.registerInput("worldTangent",_e.Vector4,!0),n.registerInput("uv",_e.Vector2,!1),n.registerInput("normalMapColor",_e.Color3,!1),n.registerInput("strength",_e.Float,!1),n.registerOutput("output",_e.Vector4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue("BUMP",!0)},t.prototype.bind=function(e,n,r){n.getScene()._mirroredCameraPosition?e.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):e.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name==="uv"});n||(n=new Bt("uv")).setAsAttribute(),n.output.connectTo(this.uv)}if(!this.strength.isConnected){var r=new Bt("strength");r.value=1,r.output.connectTo(this.strength)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name,r=this.uv,o=this.worldPosition,l=this.worldNormal,d=this.worldTangent;e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=e._getFreeDefineName("tangentSpaceParameter"),e._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var v=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+e._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var y={search:/defined\(TANGENT\)/g,replace:d.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return d.isConnected&&(e.compilationString+="vec3 tbnNormal = normalize("+l.associatedVariableName+`.xyz);\r
`,e.compilationString+="vec3 tbnTangent = normalize("+d.associatedVariableName+`.xyz);\r
`,e.compilationString+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,e.compilationString+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",n,{replaceStrings:[y]}),e._emitFunctionFromInclude("bumpFragmentFunctions",n,{replaceStrings:[{search:/vBumpInfos.y/g,replace:v},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"}]}),e.compilationString+=this._declareOutput(this.output,e)+` = vec4(0.);\r
`,e.compilationString+=e._emitCodeFromInclude("bumpFragment",n,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:v},{search:/vBumpUV/g,replace:r.associatedVariableName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:l.associatedVariableName+".xyz"},y]}),this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".invertX = "+this.invertX+`;\r
`;return e+=this._codeVariableName+".invertY = "+this.invertY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.invertX=this.invertX,e.invertY=this.invertY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.invertX=e.invertX,this.invertY=e.invertY},Object(f.c)([sn("Invert X axis",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertX",void 0),Object(f.c)([sn("Invert Y axis",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertY",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=X0;var Y0=function(i){function t(e){var n=i.call(this,e,Me.Fragment,!0)||this;return n.registerInput("value",_e.Float,!0),n.registerInput("cutoff",_e.Float,!0),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.sharedData.hints.needAlphaTesting=!0,this.cutoff.isConnected&&this.value.isConnected)return e.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+`) discard;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.DiscardBlock"]=Y0;var K0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("output",_e.Float,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+` = gl_FrontFacing ? 1.0 : 0.0;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=K0;var Q0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerInput("input",_e.AutoDetect,!1),n.registerOutput("dx",_e.BasedOnInput),n.registerOutput("dy",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[1]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._outputs[1];return e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),n.hasEndpoints&&(e.compilationString+=this._declareOutput(n,e)+" = dFdx("+this.input.associatedVariableName+`);\r
`),r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = dFdy("+this.input.associatedVariableName+`);\r
`),this},t}(Et);R.a.RegisteredTypes["BABYLON.DerivativeBlock"]=Q0;var q0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("xy",_e.Vector2,Me.Fragment),n.registerOutput("xyz",_e.Vector3,Me.Fragment),n.registerOutput("xyzw",_e.Vector4,Me.Fragment),n.registerOutput("x",_e.Float,Me.Fragment),n.registerOutput("y",_e.Float,Me.Fragment),n.registerOutput("z",_e.Float,Me.Fragment),n.registerOutput("w",_e.Float,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FragCoordBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),t.prototype.writeOutputs=function(e){for(var n="",r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&(n+=this._declareOutput(l,e)+" = gl_FragCoord."+l.name+`;\r
`)}return n},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Vertex)throw"FragCoordBlock must only be used in a fragment shader";return e.compilationString+=this.writeOutputs(e),this},t}(Et);R.a.RegisteredTypes["BABYLON.FragCoordBlock"]=q0;var Z0=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.registerOutput("xy",_e.Vector2,Me.Fragment),n.registerOutput("x",_e.Float,Me.Fragment),n.registerOutput("y",_e.Float,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ScreenSizeBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){var o=this._scene.getEngine();e.setFloat2(this._varName,o.getRenderWidth(),o.getRenderWidth())},t.prototype.writeOutputs=function(e,n){for(var r="",o=0,l=this._outputs;o<l.length;o++){var d=l[o];d.hasEndpoints&&(r+=this._declareOutput(d,e)+" = "+n+"."+d.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,e.target===Me.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";return e.sharedData.bindableBlocks.push(this),this._varName=e._getFreeVariableName("screenSize"),e._emitUniformFromString(this._varName,"vec2"),e.compilationString+=this.writeOutputs(e,this._varName),this},t}(Et);R.a.RegisteredTypes["BABYLON.ScreenSizeBlock"]=Z0;var $0=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment,!0)||this;return n.registerInput("worldPosition",_e.Vector4,!1,Me.Vertex),n.registerInput("view",_e.Matrix,!1,Me.Vertex),n.registerInput("input",_e.Color3,!1,Me.Fragment),n.registerInput("fogColor",_e.Color3,!1,Me.Fragment),n.registerOutput("output",_e.Color3,Me.Fragment),n.input.acceptedConnectionPointTypes.push(_e.Color4),n.fogColor.acceptedConnectionPointTypes.push(_e.Color4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.view.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});n||(n=new Bt("view")).setAsSystemValue(Mt.View),n.output.connectTo(this.view)}if(!this.fogColor.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.FogColor});r||(r=new Bt("fogColor",void 0,_e.Color3)).setAsSystemValue(Mt.FogColor),r.output.connectTo(this.fogColor)}},t.prototype.prepareDefines=function(e,n,r){var o=e.getScene();r.setValue("FOG",n.fogEnabled&&lt.a.GetFogState(e,o))},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();e.setFloat4(this._fogParameters,o.fogMode,o.fogStart,o.fogEnd,o.fogDensity)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var n=e._getFreeVariableName("fog"),r=this.input,o=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");var l=this._outputs[0];e._emitUniformFromString(this._fogParameters,"vec4"),e.compilationString+=`#ifdef FOG\r
`,e.compilationString+="float "+n+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+`);\r
`,e.compilationString+=this._declareOutput(l,e)+" = "+n+" * "+r.associatedVariableName+".rgb + (1.0 - "+n+") * "+o.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#else\r
`+this._declareOutput(l,e)+" =  "+r.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#endif\r
`}else{var d=this.worldPosition,v=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,"vec3"),e.compilationString+=this._fogDistanceName+" = ("+v.associatedVariableName+" * "+d.associatedVariableName+`).xyz;\r
`}return this},t}(Et);R.a.RegisteredTypes["BABYLON.FogBlock"]=$0;var J0=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._isUnique=!0,n.registerInput("worldPosition",_e.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",_e.Vector4,!1,Me.Fragment),n.registerInput("cameraPosition",_e.Vector3,!1,Me.Fragment),n.registerInput("glossiness",_e.Float,!0,Me.Fragment),n.registerInput("glossPower",_e.Float,!0,Me.Fragment),n.registerInput("diffuseColor",_e.Color3,!0,Me.Fragment),n.registerInput("specularColor",_e.Color3,!0,Me.Fragment),n.registerInput("view",_e.Matrix,!0),n.registerOutput("diffuseOutput",_e.Color3,Me.Fragment),n.registerOutput("specularOutput",_e.Color3,Me.Fragment),n.registerOutput("shadow",_e.Float,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=e.getScene();if(this.light){var l={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};lt.a.PrepareDefinesForLight(o,e,this.light,this._lightId,r,!0,l),l.needRebuild&&r.rebuild()}else lt.a.PrepareDefinesForLights(o,e,r,!0,n.maxSimultaneousLights)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var l=0;l<n.maxSimultaneousLights&&r["LIGHT"+l];l++){var d=e.uniforms.indexOf("vLightData"+l)>=0;lt.a.PrepareUniformsAndSamplersForLight(l,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+l],o,d)}},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();this.light?lt.a.BindLight(this.light,this._lightId,o,e,!0):lt.a.BindLights(o,r,e,!0,n.maxSimultaneousLights)}},t.prototype._injectVertexCode=function(e){var n=this.worldPosition,r="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var o="v_"+n.associatedVariableName;e._emitVaryingFromString(o,"vec4")&&(e.compilationString+=o+" = "+n.associatedVariableName+`;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:n.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+n.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{repeatKey:"maxSimultaneousLights"}))},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Me.Fragment){e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n="//"+this.name,r=this.worldPosition;e._emitFunctionFromInclude("helperFunctions",n),e._emitFunctionFromInclude("lightsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{repeatKey:"maxSimultaneousLights"}),this._lightId===0&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+r.associatedVariableName+`.xyz);\r
`),e.compilationString+=`lightingInfo info;\r
`,e.compilationString+=`float shadow = 1.;\r
`,e.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+`;\r
`,e.compilationString+=`vec3 diffuseBase = vec3(0., 0., 0.);\r
`,e.compilationString+=`vec3 specularBase = vec3(0., 0., 0.);\r
`,e.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+`.xyz;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{repeatKey:"maxSimultaneousLights"});var o=this.diffuseOutput,l=this.specularOutput;return e.compilationString+=this._declareOutput(o,e)+" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+`;\r
`,l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+`;\r
`),this.shadow.hasEndpoints&&(e.compilationString+=this._declareOutput(this.shadow,e)+` = shadow;\r
`),this}this._injectVertexCode(e)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(Et);R.a.RegisteredTypes["BABYLON.LightBlock"]=J0;var eT=function(i){function t(e,n){n===void 0&&(n=!1);var r=i.call(this,e,n?Me.Fragment:Me.VertexAndFragment)||this;return r.convertToGammaSpace=!1,r.convertToLinearSpace=!1,r._fragmentOnly=n,r.registerInput("uv",_e.Vector2,!1,Me.VertexAndFragment),r.registerOutput("rgba",_e.Color4,Me.Neutral),r.registerOutput("rgb",_e.Color3,Me.Neutral),r.registerOutput("r",_e.Float,Me.Neutral),r.registerOutput("g",_e.Float,Me.Neutral),r.registerOutput("b",_e.Float,Me.Neutral),r.registerOutput("a",_e.Float,Me.Neutral),r._inputs[0].acceptedConnectionPointTypes.push(_e.Vector3),r._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),r._inputs[0]._prioritizeVertex=!n,r}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){if(this._fragmentOnly)return Me.Fragment;if(!this.uv.isConnected||this.uv.sourceBlock.isInput)return Me.VertexAndFragment;for(var e=this.uv.connectedPoint;e;){if(e.target===Me.Fragment)return Me.Fragment;if(e.target===Me.Vertex)return Me.VertexAndFragment;if(e.target===Me.Neutral||e.target===Me.VertexAndFragment){var n=e.ownerBlock;e=null;for(var r=0,o=n.inputs;r<o.length;r++){var l=o[r];if(l.connectedPoint){e=l.connectedPoint;break}}}}return Me.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.uv.isConnected)if(e.mode===Ir.PostProcess)(n=e.getBlockByPredicate(function(o){return o.name==="uv"}))&&n.connectTo(this);else{var n,r=e.mode===Ir.Particle?"particle_uv":"uv";(n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name===r}))||(n=new Bt("uv")).setAsAttribute(r),n.output.connectTo(this.uv)}},t.prototype.initializeDefines=function(e,n,r,o){r._areTexturesDirty&&r.setValue(this._mainUVDefineName,!1)},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){if(!this.texture||!this.texture.getTextureMatrix)return r.setValue(this._defineName,!1),void r.setValue(this._mainUVDefineName,!0);r.setValue(this._linearDefineName,this.convertToGammaSpace),r.setValue(this._gammaDefineName,this.convertToLinearSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(r.setValue(this._defineName,!1),r.setValue(this._mainUVDefineName,!0)):r.setValue(this._defineName,!0))}},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){this.texture&&(this._isMixed&&(e.setFloat(this._textureInfoName,this.texture.level),e.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),e.setTexture(this._samplerName,this.texture))},Object.defineProperty(t.prototype,"_isMixed",{get:function(){return this.target!==Me.Fragment},enumerable:!1,configurable:!0}),t.prototype._injectVertexCode=function(e){var n=this.uv;if(this._defineName=e._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+n.associatedVariableName.toUpperCase(),n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,this._transformedUVName=e._getFreeVariableName("transformedUV"),this._textureTransformName=e._getFreeVariableName("textureTransform"),this._textureInfoName=e._getFreeVariableName("textureInfoName"),e._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),e._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),e._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+n.associatedVariableName+`.xy, 1.0, 0.0));\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,e.compilationString+=`#endif\r
`,this._outputs.some(function(d){return d.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Me.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Me.Fragment?(e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+`);\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Me.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else if(this.uv.ownerBlock.target!==Me.Fragment){var l=" * "+this._textureInfoName;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+l+`;\r
`,r!=="a"&&(e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`)}else e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),(e.target===Me.Vertex||this._fragmentOnly)&&(this._tempTextureRead=e._getFreeVariableName("tempTextureRead")),(!this._isMixed&&e.target===Me.Fragment||this._isMixed&&e.target===Me.Vertex)&&(this._samplerName=e._getFreeVariableName(this.name+"Sampler"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this)),e.target===Me.Fragment){if(this._outputs.some(function(d){return d.isConnectedInFragmentShader})){this._isMixed&&e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._isMixed&&e._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}}else this._injectVertexCode(e)},t.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var e=this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`", null);\r
`;return e+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+`;\r
`,e+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+`;\r
`,e+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+`;\r
`,e+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+`;\r
`,e+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+`;\r
`,e+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+`;\r
`,e+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+`;\r
`,e+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+`;\r
`,e+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+`;\r
`,e+=this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+`;\r
`,e+=this._codeVariableName+".convertToLinearSpace = "+this.convertToLinearSpace+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.fragmentOnly=this._fragmentOnly,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this._fragmentOnly=!!e.fragmentOnly,e.texture&&!Ph.IgnoreTexturesAtLoadTime&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);R.a.RegisteredTypes["BABYLON.TextureBlock"]=eT;var Em=function(i){function t(e){return i.call(this,e,Me.VertexAndFragment)||this}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBaseBlock"},t.prototype._getTexture=function(){return this.texture},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="position"});n||(n=new Bt("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.world.isConnected){var r=e.getInputBlockByPredicate(function(l){return l.systemValue===Mt.World});r||(r=new Bt("world")).setAsSystemValue(Mt.World),r.output.connectTo(this.world)}if(this.view&&!this.view.isConnected){var o=e.getInputBlockByPredicate(function(l){return l.systemValue===Mt.View});o||(o=new Bt("view")).setAsSystemValue(Mt.View),o.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){var o=this._getTexture();o&&o.getTextureMatrix&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLocalCubicName,!!o.boundingBoxSize,!0),r.setValue(this._defineExplicitName,o.coordinatesMode===g.a.TEXTURE_EXPLICIT_MODE,!0),r.setValue(this._defineSkyboxName,o.coordinatesMode===g.a.TEXTURE_SKYBOX_MODE,!0),r.setValue(this._defineCubicName,o.coordinatesMode===g.a.TEXTURE_CUBIC_MODE||o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue("INVERTCUBICMAP",o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue(this._defineSphericalName,o.coordinatesMode===g.a.TEXTURE_SPHERICAL_MODE,!0),r.setValue(this._definePlanarName,o.coordinatesMode===g.a.TEXTURE_PLANAR_MODE,!0),r.setValue(this._defineProjectionName,o.coordinatesMode===g.a.TEXTURE_PROJECTION_MODE,!0),r.setValue(this._defineEquirectangularName,o.coordinatesMode===g.a.TEXTURE_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineMirroredEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,!0))}},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){var o=this._getTexture();r&&o&&(e.setMatrix(this._reflectionMatrixName,o.getReflectionTextureMatrix()),o.isCube?e.setTexture(this._cubeSamplerName,o):e.setTexture(this._2DSamplerName,o))},t.prototype.handleVertexSide=function(e){this._define3DName=e._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=e._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=e._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=e._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=e._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=e._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=e._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=e._getFreeDefineName("REFLECTIONMAP_SKYBOX"),this._defineOppositeZ=e._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ"),this._reflectionMatrixName=e._getFreeVariableName("reflectionMatrix"),e._emitUniformFromString(this._reflectionMatrixName,"mat4");var n="",r="v_"+this.worldPosition.associatedVariableName;return e._emitVaryingFromString(r,"vec4")&&(n+=r+" = "+this.worldPosition.associatedVariableName+`;\r
`),this._positionUVWName=e._getFreeVariableName("positionUVW"),this._directionWName=e._getFreeVariableName("directionW"),e._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(n+="#ifdef "+this._defineSkyboxName+`\r
`,n+=this._positionUVWName+" = "+this.position.associatedVariableName+`.xyz;\r
`,n+=`#endif\r
`),e._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")")&&(n+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+`)\r
`,n+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+`.xyz, 0.0)));\r
`,n+=`#endif\r
`),n},t.prototype.handleFragmentSideInits=function(e){e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);var n="//"+this.name;e._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),e._emitFunctionFromInclude("reflectionFunction",n,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]}),this._reflectionColorName=e._getFreeVariableName("reflectionColor"),this._reflectionVectorName=e._getFreeVariableName("reflectionUVW"),this._reflectionCoordsName=e._getFreeVariableName("reflectionCoords")},t.prototype.handleFragmentSideCodeReflectionCoords=function(e,n,r){r===void 0&&(r=!1),n||(n="v_"+this.worldPosition.associatedVariableName);var o=this._reflectionMatrixName,l="normalize("+this._directionWName+")",d=""+this._positionUVWName,v=""+this.cameraPosition.associatedVariableName,y=""+this.view.associatedVariableName;e+=".xyz";var D=`
            #ifdef `+this._defineMirroredEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeMirroredFixedEquirectangularCoords("+n+", "+e+", "+l+`);
            #endif

            #ifdef `+this._defineEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeFixedEquirectangularCoords("+n+", "+e+", "+l+`);
            #endif

            #ifdef `+this._defineEquirectangularName+`
                vec3 `+this._reflectionVectorName+" = computeEquirectangularCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineSphericalName+`
                vec3 `+this._reflectionVectorName+" = computeSphericalCoords("+n+", "+e+", "+y+", "+o+`);
            #endif

            #ifdef `+this._definePlanarName+`
                vec3 `+this._reflectionVectorName+" = computePlanarCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineCubicName+`
                #ifdef `+this._defineLocalCubicName+`
                    vec3 `+this._reflectionVectorName+" = computeCubicLocalCoords("+n+", "+e+", "+v+".xyz, "+o+`, vReflectionSize, vReflectionPosition);
                #else
                vec3 `+this._reflectionVectorName+" = computeCubicCoords("+n+", "+e+", "+v+".xyz, "+o+`);
                #endif
            #endif

            #ifdef `+this._defineProjectionName+`
                vec3 `+this._reflectionVectorName+" = computeProjectionCoords("+n+", "+y+", "+o+`);
            #endif

            #ifdef `+this._defineSkyboxName+`
                vec3 `+this._reflectionVectorName+" = computeSkyBoxCoords("+d+", "+o+`);
            #endif

            #ifdef `+this._defineExplicitName+`
                vec3 `+this._reflectionVectorName+` = vec3(0, 0, 0);
            #endif

            #ifdef `+this._defineOppositeZ+`
                `+this._reflectionVectorName+`.z *= -1.0;
            #endif\r
`;return r||(D+=`
                #ifdef `+this._define3DName+`
                    vec3 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`;
                #else
                    vec2 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`.xy;
                    #ifdef `+this._defineProjectionName+`
                        `+this._reflectionCoordsName+" /= "+this._reflectionVectorName+`.z;
                    #endif
                    `+this._reflectionCoordsName+".y = 1.0 - "+this._reflectionCoordsName+`.y;
                #endif\r
`),D},t.prototype.handleFragmentSideCodeReflectionColor=function(e,n){n===void 0&&(n=".rgb");var r="vec"+(n.length===0?"4":n.length-1)+" "+this._reflectionColorName+`;
            #ifdef `+this._define3DName+`\r
`;return r+=e?this._reflectionColorName+" = textureCubeLodEXT("+this._cubeSamplerName+", "+this._reflectionVectorName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionVectorName+")"+n+`;\r
`,r+=`
            #else\r
`,r+=e?this._reflectionColorName+" = texture2DLodEXT("+this._2DSamplerName+", "+this._reflectionCoordsName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflectionCoordsName+")"+n+`;\r
`,r+=`#endif\r
`},t.prototype.writeOutputs=function(e,n){var r="";if(e.target===Me.Fragment)for(var o=0,l=this._outputs;o<l.length;o++){var d=l[o];d.hasEndpoints&&(r+=this._declareOutput(d,e)+" = "+n+"."+d.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){return i.prototype._buildBlock.call(this,e),this},t.prototype._dumpPropertiesCode=function(){return this.texture?(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`):"";var e},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=yi.Parse(e.texture,n,r):this.texture=ke.a.Parse(e.texture,n,r))},t}(Et);R.a.RegisteredTypes["BABYLON.ReflectionTextureBaseBlock"]=Em;var tT=function(i){function t(e){var n=i.call(this,e)||this;return n.registerInput("position",_e.Vector3,!1,Me.Vertex),n.registerInput("worldPosition",_e.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",_e.Vector4,!1,Me.Fragment),n.registerInput("world",_e.Matrix,!1,Me.Vertex),n.registerInput("cameraPosition",_e.Vector3,!1,Me.Fragment),n.registerInput("view",_e.Matrix,!1,Me.Fragment),n.registerOutput("rgb",_e.Color3,Me.Fragment),n.registerOutput("rgba",_e.Color4,Me.Fragment),n.registerOutput("r",_e.Float,Me.Fragment),n.registerOutput("g",_e.Float,Me.Fragment),n.registerOutput("b",_e.Float,Me.Fragment),n.registerOutput("a",_e.Float,Me.Fragment),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(i.prototype.autoConfigure.call(this,e),!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),!this.texture)return e.compilationString+=this.writeOutputs(e,"vec3(0.)"),this;if(e.target!==Me.Fragment)return e.compilationString+=this.handleVertexSide(e),this;this.handleFragmentSideInits(e);var n=e._getFreeVariableName("normalWUnit");return e.compilationString+="vec4 "+n+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e.compilationString+=this.handleFragmentSideCodeReflectionCoords(n),e.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,""),e.compilationString+=this.writeOutputs(e,this._reflectionColorName),this},t}(Em);R.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=tT;var nT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" + "+this.right.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.AddBlock"]=nT;var rT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",_e.AutoDetect),n.registerInput("factor",_e.Float),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" * "+this.factor.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ScaleBlock"]=rT;var iT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.minimum=0,n.maximum=1,n.registerInput("value",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = clamp("+this.value.associatedVariableName+", "+this._writeFloat(this.minimum)+", "+this._writeFloat(this.maximum)+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".minimum = "+this.minimum+`;\r
`;return e+=this._codeVariableName+".maximum = "+this.maximum+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.minimum=this.minimum,e.maximum=this.maximum,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.minimum=e.minimum,this.maximum=e.maximum},Object(f.c)([sn("Minimum",$t.Float)],t.prototype,"minimum",void 0),Object(f.c)([sn("Maximum",$t.Float)],t.prototype,"maximum",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.ClampBlock"]=iT;var oT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.Vector3),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[0].excludedConnectionPointTypes.push(_e.Vector2),n._inputs[1].excludedConnectionPointTypes.push(_e.Float),n._inputs[1].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[1].excludedConnectionPointTypes.push(_e.Vector2),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = cross("+this.left.associatedVariableName+".xyz, "+this.right.associatedVariableName+`.xyz);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.CrossBlock"]=oT;var aT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[1].excludedConnectionPointTypes.push(_e.Float),n._inputs[1].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = dot("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.DotBlock"]=aT;var sT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+r.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.NormalizeBlock"]=sT;var cT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("rgb ",_e.Color3,!0),n.registerInput("r",_e.Float,!0),n.registerInput("g",_e.Float,!0),n.registerInput("b",_e.Float,!0),n.registerInput("a",_e.Float,!0),n.registerOutput("rgba",_e.Color4),n.registerOutput("rgb",_e.Color3),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.r,r=this.g,o=this.b,l=this.a,d=this.rgbIn,v=this._outputs[0],y=this._outputs[1];return d.isConnected?v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+d.associatedVariableName+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = "+d.associatedVariableName+`;\r
`):v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`),this},t}(Et);R.a.RegisteredTypes["BABYLON.ColorMergerBlock"]=cT;var lT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("xyzw",_e.Vector4,!0),n.registerInput("xyz ",_e.Vector3,!0),n.registerInput("xy ",_e.Vector2,!0),n.registerOutput("xyz",_e.Vector3),n.registerOutput("xy",_e.Vector2),n.registerOutput("x",_e.Float),n.registerOutput("y",_e.Float),n.registerOutput("z",_e.Float),n.registerOutput("w",_e.Float),n.inputsAreExclusive=!0,n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}},t.prototype._outputRename=function(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,r=this._outputs[0],o=this._outputs[1],l=this._outputs[2],d=this._outputs[3],v=this._outputs[4],y=this._outputs[5];return r.hasEndpoints&&(n===this.xyIn?e.compilationString+=this._declareOutput(r,e)+" = vec3("+n.associatedVariableName+`, 0.0);\r
`:e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.xyz;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.xy;\r
`),l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = "+n.associatedVariableName+`.x;\r
`),d.hasEndpoints&&(e.compilationString+=this._declareOutput(d,e)+" = "+n.associatedVariableName+`.y;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.z;\r
`),y.hasEndpoints&&(e.compilationString+=this._declareOutput(y,e)+" = "+n.associatedVariableName+`.w;\r
`),this},t}(Et);R.a.RegisteredTypes["BABYLON.VectorSplitterBlock"]=lT;var uT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerInput("gradient",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.LerpBlock"]=uT;var hT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" / "+this.right.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.DivideBlock"]=hT;var dT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.SubtractBlock"]=dT;var fT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.Float),n.registerInput("edge",_e.Float),n.registerOutput("output",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = step("+this.edge.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.StepBlock"]=fT;var Sm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. - "+this.input.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.OneMinusBlock"]=Sm,R.a.RegisteredTypes["BABYLON.OppositeBlock"]=Sm;var xm=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("worldPosition",_e.Vector4),n.registerInput("cameraPosition",_e.Vector3),n.registerOutput("output",_e.Vector3),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.cameraPosition.associatedVariableName+" - "+this.worldPosition.associatedVariableName+`.xyz);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ViewDirectionBlock"]=xm,c(161);var pT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("worldNormal",_e.Vector4),n.registerInput("viewDirection",_e.Vector3),n.registerInput("bias",_e.Float),n.registerInput("power",_e.Float),n.registerOutput("fresnel",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.viewDirection.isConnected){var n=new xm("View direction");n.output.connectTo(this.viewDirection),n.autoConfigure(e)}if(!this.bias.isConnected){var r=new Bt("bias");r.value=0,r.output.connectTo(this.bias)}if(!this.power.isConnected){var o=new Bt("power");o.value=1,o.output.connectTo(this.power)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name;return e._emitFunctionFromInclude("fresnelFunction",n,{removeIfDef:!0}),e.compilationString+=this._declareOutput(this.fresnel,e)+" = computeFresnelTerm("+this.viewDirection.associatedVariableName+".xyz, "+this.worldNormal.associatedVariableName+".xyz, "+this.bias.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.FresnelBlock"]=pT;var mT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = max("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.MaxBlock"]=mT;var _T=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = min("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.MinBlock"]=_T;var gT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[1].excludedConnectionPointTypes.push(_e.Float),n._inputs[1].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.DistanceBlock"]=gT;var vT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerOutput("output",_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.value.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.LengthBlock"]=vT;var bT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = -1.0 * "+this.value.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.NegateBlock"]=bT;var yT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerInput("power",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = pow("+this.value.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.PowBlock"]=yT;var TT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("seed",_e.Vector2),n.registerOutput("output",_e.Float),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",r),e.compilationString+=this._declareOutput(n,e)+" = getRand("+this.seed.associatedVariableName+`.xy);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.RandomNumberBlock"]=TT;var ET=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("x",_e.Float),n.registerInput("y",_e.Float),n.registerOutput("output",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = atan("+this.x.associatedVariableName+", "+this.y.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ArcTan2Block"]=ET;var ST=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerInput("edge0",_e.Float),n.registerInput("edge1",_e.Float),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = smoothstep("+this.edge0.associatedVariableName+", "+this.edge1.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.SmoothStepBlock"]=ST;var xT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. / "+this.input.associatedVariableName+`;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ReciprocalBlock"]=xT;var AT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerInput("reference",_e.AutoDetect),n.registerInput("distance",_e.Float),n.registerInput("replacement",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(0,3),n._inputs[0].excludedConnectionPointTypes.push(_e.Float),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[1].excludedConnectionPointTypes.push(_e.Float),n._inputs[1].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[3].excludedConnectionPointTypes.push(_e.Float),n._inputs[3].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+="if (length("+this.value.associatedVariableName+" - "+this.reference.associatedVariableName+") < "+this.distance.associatedVariableName+`) {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.replacement.associatedVariableName+`;\r
`,e.compilationString+=`} else {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.value.associatedVariableName+`;\r
`,e.compilationString+=`}\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ReplaceColorBlock"]=AT;var Oa,PT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("value",_e.AutoDetect),n.registerInput("steps",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n._inputs[1].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = floor("+this.value.associatedVariableName+" / (1.0 / "+this.steps.associatedVariableName+")) * (1.0 / "+this.steps.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.PosterizeBlock"]=PT,function(i){i[i.SawTooth=0]="SawTooth",i[i.Square=1]="Square",i[i.Triangle=2]="Triangle"}(Oa||(Oa={}));var CT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.kind=Oa.SawTooth,n.registerInput("input",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(_e.Matrix),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];switch(this.kind){case Oa.SawTooth:e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`);\r
`;break;case Oa.Square:e.compilationString+=this._declareOutput(n,e)+" = 1.0 - 2.0 * round(fract("+this.input.associatedVariableName+`));\r
`;break;case Oa.Triangle:e.compilationString+=this._declareOutput(n,e)+" = 2.0 * abs(2.0 * ("+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`))) - 1.0;\r
`}return this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.kind=this.kind,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.kind=e.kind},t}(Et);R.a.RegisteredTypes["BABYLON.WaveBlock"]=CT;var Ch=function(){function i(t,e){this.step=t,this.color=e}return Object.defineProperty(i.prototype,"step",{get:function(){return this._step},set:function(t){this._step=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!1,configurable:!0}),i}(),RT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.colorSteps=[new Ch(0,C.a.Black()),new Ch(1,C.a.White())],n.onValueChangedObservable=new S.c,n.registerInput("gradient",_e.Float),n.registerOutput("output",_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector2),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color4),n}return Object(f.d)(t,i),t.prototype.colorStepsUpdated=function(){this.onValueChangedObservable.notifyObservers(this)},t.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._writeColorConstant=function(e){var n=this.colorSteps[e];return"vec3("+n.color.r+", "+n.color.g+", "+n.color.b+")"},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var r=e._getFreeVariableName("gradientTempColor"),o=e._getFreeVariableName("gradientTempPosition");e.compilationString+="vec3 "+r+" = "+this._writeColorConstant(0)+`;\r
`,e.compilationString+="float "+o+`;\r
`;var l=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==_e.Float&&(l+=".x");for(var d=1;d<this.colorSteps.length;d++){var v=this.colorSteps[d],y=this.colorSteps[d-1];e.compilationString+=o+" = clamp(("+l+" - "+e._emitFloat(y.step)+") / ("+e._emitFloat(v.step)+" -  "+e._emitFloat(y.step)+"), 0.0, 1.0) * step("+e._emitFloat(d)+", "+e._emitFloat(this.colorSteps.length-1)+`);\r
`,e.compilationString+=r+" = mix("+r+", "+this._writeColorConstant(d)+", "+o+`);\r
`}return e.compilationString+=this._declareOutput(n,e)+" = "+r+`;\r
`,this}e.compilationString+=this._declareOutput(n,e)+` = vec3(0., 0., 0.);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);e.colorSteps=[];for(var n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e.colorSteps.push({step:o.step,color:{r:o.color.r,g:o.color.g,b:o.color.b}})}return e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.colorSteps=[];for(var o=0,l=e.colorSteps;o<l.length;o++){var d=l[o];this.colorSteps.push(new Ch(d.step,new C.a(d.color.r,d.color.g,d.color.b)))}},t.prototype._dumpPropertiesCode=function(){for(var e="",n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e+=this._codeVariableName+".colorSteps.push(new BABYLON.GradientBlockColorStep("+o.step+", new BABYLON.Color3("+o.color.r+", "+o.color.g+", "+o.color.b+`)));\r
`}return e},t}(Et);R.a.RegisteredTypes["BABYLON.GradientBlock"]=RT;var OT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerInput("gradient",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize(mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`));\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.NLerpBlock"]=OT;var MT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.manhattanDistance=!1,n.registerInput("seed",_e.Vector3),n.registerInput("jitter",_e.Float),n.registerOutput("output",_e.Vector2),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("worley3D",`vec3 permute(vec3 x){\r
    return mod((34.0 * x + 1.0) * x, 289.0);\r
}\r
\r
vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r
    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r
}\r
\r
vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r
    float K = 0.142857142857; // 1/7\r
    float Ko = 0.428571428571; // 1/2-K/2\r
    float  K2 = 0.020408163265306; // 1/(7*7)\r
    float Kz = 0.166666666667; // 1/6\r
    float Kzo = 0.416666666667; // 1/2-1/6*2\r
\r
    vec3 Pi = mod(floor(P), 289.0);\r
    vec3 Pf = fract(P) - 0.5;\r
\r
    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r
\r
    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r
    vec3 p1 = permute(p + Pi.y - 1.0);\r
    vec3 p2 = permute(p + Pi.y);\r
    vec3 p3 = permute(p + Pi.y + 1.0);\r
\r
    vec3 p11 = permute(p1 + Pi.z - 1.0);\r
    vec3 p12 = permute(p1 + Pi.z);\r
    vec3 p13 = permute(p1 + Pi.z + 1.0);\r
\r
    vec3 p21 = permute(p2 + Pi.z - 1.0);\r
    vec3 p22 = permute(p2 + Pi.z);\r
    vec3 p23 = permute(p2 + Pi.z + 1.0);\r
\r
    vec3 p31 = permute(p3 + Pi.z - 1.0);\r
    vec3 p32 = permute(p3 + Pi.z);\r
    vec3 p33 = permute(p3 + Pi.z + 1.0);\r
\r
    vec3 ox11 = fract(p11*K) - Ko;\r
    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r
    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r
\r
    vec3 ox12 = fract(p12*K) - Ko;\r
    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r
    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r
\r
    vec3 ox13 = fract(p13*K) - Ko;\r
    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r
    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r
\r
    vec3 ox21 = fract(p21*K) - Ko;\r
    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r
    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r
\r
    vec3 ox22 = fract(p22*K) - Ko;\r
    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r
    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r
\r
    vec3 ox23 = fract(p23*K) - Ko;\r
    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r
    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r
\r
    vec3 ox31 = fract(p31*K) - Ko;\r
    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r
    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r
\r
    vec3 ox32 = fract(p32*K) - Ko;\r
    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r
    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r
\r
    vec3 ox33 = fract(p33*K) - Ko;\r
    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r
    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r
\r
    vec3 dx11 = Pfx + jitter*ox11;\r
    vec3 dy11 = Pfy.x + jitter*oy11;\r
    vec3 dz11 = Pfz.x + jitter*oz11;\r
\r
    vec3 dx12 = Pfx + jitter*ox12;\r
    vec3 dy12 = Pfy.x + jitter*oy12;\r
    vec3 dz12 = Pfz.y + jitter*oz12;\r
\r
    vec3 dx13 = Pfx + jitter*ox13;\r
    vec3 dy13 = Pfy.x + jitter*oy13;\r
    vec3 dz13 = Pfz.z + jitter*oz13;\r
\r
    vec3 dx21 = Pfx + jitter*ox21;\r
    vec3 dy21 = Pfy.y + jitter*oy21;\r
    vec3 dz21 = Pfz.x + jitter*oz21;\r
\r
    vec3 dx22 = Pfx + jitter*ox22;\r
    vec3 dy22 = Pfy.y + jitter*oy22;\r
    vec3 dz22 = Pfz.y + jitter*oz22;\r
\r
    vec3 dx23 = Pfx + jitter*ox23;\r
    vec3 dy23 = Pfy.y + jitter*oy23;\r
    vec3 dz23 = Pfz.z + jitter*oz23;\r
\r
    vec3 dx31 = Pfx + jitter*ox31;\r
    vec3 dy31 = Pfy.z + jitter*oy31;\r
    vec3 dz31 = Pfz.x + jitter*oz31;\r
\r
    vec3 dx32 = Pfx + jitter*ox32;\r
    vec3 dy32 = Pfy.z + jitter*oy32;\r
    vec3 dz32 = Pfz.y + jitter*oz32;\r
\r
    vec3 dx33 = Pfx + jitter*ox33;\r
    vec3 dy33 = Pfy.z + jitter*oy33;\r
    vec3 dz33 = Pfz.z + jitter*oz33;\r
\r
    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r
    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r
    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r
    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r
    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r
    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r
    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r
    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r
    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r
\r
    vec3 d1a = min(d11, d12);\r
    d12 = max(d11, d12);\r
    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r
    d13 = max(d1a, d13);\r
    d12 = min(d12, d13); // 2nd smallest now not in d13\r
    vec3 d2a = min(d21, d22);\r
    d22 = max(d21, d22);\r
    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r
    d23 = max(d2a, d23);\r
    d22 = min(d22, d23); // 2nd smallest now not in d23\r
    vec3 d3a = min(d31, d32);\r
    d32 = max(d31, d32);\r
    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r
    d33 = max(d3a, d33);\r
    d32 = min(d32, d33); // 2nd smallest now not in d33\r
    vec3 da = min(d11, d21);\r
    d21 = max(d11, d21);\r
    d11 = min(da, d31); // Smallest now in d11\r
    d31 = max(da, d31); // 2nd smallest now not in d31\r
    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r
    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r
    d12 = min(d12, d21); // 2nd smallest now not in d21\r
    d12 = min(d12, d22); // nor in d22\r
    d12 = min(d12, d31); // nor in d31\r
    d12 = min(d12, d32); // nor in d32\r
    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r
    d11.y = min(d11.y,d12.z); // Only two more to go\r
    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r
    return sqrt(d11.xy); // F1, F2\r
}\r
\r
`,"// Worley3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = worley("+this.seed.associatedVariableName+", "+this.jitter.associatedVariableName+", "+this.manhattanDistance+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".manhattanDistance = "+this.manhattanDistance+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.manhattanDistance=this.manhattanDistance,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.manhattanDistance=e.manhattanDistance},Object(f.c)([sn("Use Manhattan Distance",$t.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"manhattanDistance",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.WorleyNoise3DBlock"]=MT;var IT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("seed",_e.Vector3),n.registerOutput("output",_e.Float),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("SimplexPerlin3D",`const float SKEWFACTOR = 1.0/3.0;\r
const float UNSKEWFACTOR = 1.0/6.0;\r
const float SIMPLEX_CORNER_POS = 0.5;\r
const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r
float SimplexPerlin3D( vec3 P ){\r
    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r
    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r
    vec3 g = step(x0.yzx, x0.xyz);\r
    vec3 l = 1.0 - g;\r
    vec3 Pi_1 = min( g.xyz, l.zxy );\r
    vec3 Pi_2 = max( g.xyz, l.zxy );\r
    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r
    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r
    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r
    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r
    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r
    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r
    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r
    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r
    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r
    Pt *= Pt;\r
    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r
    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r
    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r
    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r
    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r
    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r
    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r
    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r
    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r
    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r
    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r
    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r
    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r
    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r
    kernel_weights = max(0.5 - kernel_weights, 0.0);\r
    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r
    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r
}\r
`,"// SimplexPerlin3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = SimplexPerlin3D("+this.seed.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"]=IT;var DT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("normalMap0",_e.Vector3),n.registerInput("normalMap1",_e.Vector3),n.registerOutput("output",_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Vector4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(t.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0],o=this._inputs[1],l=e._getFreeVariableName("stepR"),d=e._getFreeVariableName("stepG");return e.compilationString+="float "+l+" = step(0.5, "+r.associatedVariableName+`.r);\r
`,e.compilationString+="float "+d+" = step(0.5, "+r.associatedVariableName+`.g);\r
`,e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+=n.associatedVariableName+".r = (1.0 - "+l+") * "+r.associatedVariableName+".r * "+o.associatedVariableName+".r * 2.0 + "+l+" * (1.0 - "+r.associatedVariableName+".r) * (1.0 - "+o.associatedVariableName+`.r) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".g = (1.0 - "+d+") * "+r.associatedVariableName+".g * "+o.associatedVariableName+".g * 2.0 + "+d+" * (1.0 - "+r.associatedVariableName+".g) * (1.0 - "+o.associatedVariableName+`.g) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".b = "+r.associatedVariableName+".b * "+o.associatedVariableName+`.b;\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.NormalBlendBlock"]=DT;var wT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("input",_e.Vector2),n.registerInput("angle",_e.Float),n.registerOutput("output",_e.Vector2),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.angle.isConnected){var n=new Bt("angle");n.value=0,n.output.connectTo(this.angle)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.angle,o=this.input;return e.compilationString+=this._declareOutput(n,e)+" = vec2(cos("+r.associatedVariableName+") * "+o.associatedVariableName+".x - sin("+r.associatedVariableName+") * "+o.associatedVariableName+".y, sin("+r.associatedVariableName+") * "+o.associatedVariableName+".x + cos("+r.associatedVariableName+") * "+o.associatedVariableName+`.y);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.Rotate2dBlock"]=wT;var LT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("incident",_e.Vector3),n.registerInput("normal",_e.Vector3),n.registerOutput("output",_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = reflect("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+`.xyz);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ReflectBlock"]=LT;var NT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("incident",_e.Vector3),n.registerInput("normal",_e.Vector3),n.registerInput("ior",_e.Float),n.registerOutput("output",_e.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[0].acceptedConnectionPointTypes.push(_e.Color4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color3),n._inputs[1].acceptedConnectionPointTypes.push(_e.Color4),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = refract("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz, "+this.ior.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.RefractBlock"]=NT;var FT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("color",_e.Color3),n.registerInput("level",_e.Float),n.registerOutput("output",_e.Color3),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.color.associatedVariableName,o=e._getFreeVariableName("colorMin"),l=e._getFreeVariableName("colorMax"),d=e._getFreeVariableName("colorMerge");return e.compilationString+="float "+o+" = min(min("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+l+" = max(max("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+d+" = 0.5 * ("+o+" + "+l+`);\r
`,e.compilationString+=this._declareOutput(n,e)+" = mix("+r+", vec3("+d+", "+d+", "+d+"), "+this.level.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.DesaturateBlock"]=FT;var ui=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,n,r)||this;return v._blockType=o,v._blockName=l,v._nameForCheking=d,v._nameForCheking||(v._nameForCheking=e),v.needDualDirectionValidation=!0,v}return Object(f.d)(t,i),t.prototype.checkCompatibilityState=function(e){return e instanceof t&&e.name===this._nameForCheking?Si.Compatible:Si.TypeIncompatible},t.prototype.createCustomInputBlock=function(){return[new this._blockType(this._blockName),this.name]},t}(Th),Am=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.albedoScaling=!1,n.linkSheenWithAlbedo=!1,n._isUnique=!0,n.registerInput("intensity",_e.Float,!0,Me.Fragment),n.registerInput("color",_e.Color3,!0,Me.Fragment),n.registerInput("roughness",_e.Float,!0,Me.Fragment),n.registerOutput("sheen",_e.Object,Me.Fragment,new ui("sheen",n,br.Output,t,"SheenBlock")),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("sheenOut"),e._excludeVariableName("sheenMapData"),e._excludeVariableName("vSheenColor"),e._excludeVariableName("vSheenRoughness")},t.prototype.getClassName=function(){return"SheenBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("SHEEN",!0),r.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("SHEEN_LINKWITHALBEDO",this.linkSheenWithAlbedo,!0),r.setValue("SHEEN_ROUGHNESS",this.roughness.isConnected,!0),r.setValue("SHEEN_ALBEDOSCALING",this.albedoScaling,!0)},t.prototype.getCode=function(e){return`#ifdef SHEEN
            sheenOutParams sheenOut;

            vec4 vSheenColor = vec4(`+(this.color.isConnected?this.color.associatedVariableName:"vec3(1.)")+", "+(this.intensity.isConnected?this.intensity.associatedVariableName:"1.")+`);

            sheenBlock(
                vSheenColor,
            #ifdef SHEEN_ROUGHNESS
                `+(this.roughness.isConnected?this.roughness.associatedVariableName:"0.")+`,
            #endif
                roughness,
            #ifdef SHEEN_TEXTURE
                vec4(0.),
            #endif
                reflectance,
            #ifdef SHEEN_LINKWITHALBEDO
                baseColor,
                surfaceAlbedo,
            #endif
            #ifdef ENVIRONMENTBRDF
                NdotV,
                environmentBrdf,
            #endif
            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
                AARoughnessFactors,
                `+(e==null?void 0:e._vReflectionMicrosurfaceInfosName)+`,
                `+(e==null?void 0:e._vReflectionInfosName)+`,
                `+(e==null?void 0:e.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(e==null?void 0:e._define3DName)+`
                    `+(e==null?void 0:e._cubeSamplerName)+`,
                #else
                    `+(e==null?void 0:e._2DSamplerName)+`,
                #endif
                reflectionOut.reflectionCoords,
                NdotVUnclamped,
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(e==null?void 0:e._define3DName)+`
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                    #else
                        `+(e==null?void 0:e._2DSamplerName)+`,
                        `+(e==null?void 0:e._2DSamplerName)+`,
                    #endif
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+`) && defined(RADIANCEOCCLUSION)
                    seo,
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined("+(e==null?void 0:e._define3DName)+`)
                    eho,
                #endif
            #endif
                sheenOut
            );

            #ifdef SHEEN_LINKWITHALBEDO
                surfaceAlbedo = sheenOut.surfaceAlbedo;
            #endif
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return e+=this._codeVariableName+".albedoScaling = "+this.albedoScaling+`;\r
`,e+=this._codeVariableName+".linkSheenWithAlbedo = "+this.linkSheenWithAlbedo+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.albedoScaling=this.albedoScaling,e.linkSheenWithAlbedo=this.linkSheenWithAlbedo,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.albedoScaling=e.albedoScaling,this.linkSheenWithAlbedo=e.linkSheenWithAlbedo},Object(f.c)([sn("Albedo scaling",$t.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"albedoScaling",void 0),Object(f.c)([sn("Link sheen with albedo",$t.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"linkSheenWithAlbedo",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.SheenBlock"]=Am;var Pm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("intensity",_e.Float,!0,Me.Fragment),n.registerInput("direction",_e.Vector2,!0,Me.Fragment),n.registerInput("uv",_e.Vector2,!0),n.registerInput("worldTangent",_e.Vector4,!0),n.registerOutput("anisotropy",_e.Object,Me.Fragment,new ui("anisotropy",n,br.Output,t,"AnisotropyBlock")),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("anisotropicOut"),e._excludeVariableName("TBN")},t.prototype.getClassName=function(){return"AnisotropyBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._generateTBNSpace=function(e){var n="",r="//"+this.name,o=this.uv,l=this.worldPositionConnectionPoint,d=this.worldNormalConnectionPoint,v=this.worldTangent;o.isConnected||console.error("You must connect the 'uv' input of the Anisotropy block!"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var y={search:/defined\(TANGENT\)/g,replace:v.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return v.isConnected&&(n+="vec3 tbnNormal = normalize("+d.associatedVariableName+`.xyz);\r
`,n+="vec3 tbnTangent = normalize("+v.associatedVariableName+`.xyz);\r
`,n+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,n+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),n+=`
            #if defined(`+(v.isConnected?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                mat3 TBN = vTBN;
            #else
                mat3 TBN = cotangent_frame(`+d.associatedVariableName+".xyz, v_"+l.associatedVariableName+".xyz, "+(o.isConnected?o.associatedVariableName:"vec2(0.)")+`, vec2(1., 1.));
            #endif\r
`,e._emitFunctionFromInclude("bumpFragmentMainFunctions",r,{replaceStrings:[y]}),n},t.prototype.getCode=function(e,n){n===void 0&&(n=!1);var r="";n&&(r+=this._generateTBNSpace(e));var o=this.intensity.isConnected?this.intensity.associatedVariableName:"1.0";return r+=`anisotropicOutParams anisotropicOut;
            anisotropicBlock(
                vec3(`+(this.direction.isConnected?this.direction.associatedVariableName:"vec2(1., 0.)")+", "+o+`),
            #ifdef ANISOTROPIC_TEXTURE
                vec3(0.),
            #endif
                TBN,
                normalW,
                viewDirectionW,
                anisotropicOut
            );\r
`},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("ANISOTROPIC",!0),r.setValue("ANISOTROPIC_TEXTURE",!1,!0)},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(Et);R.a.RegisteredTypes["BABYLON.AnisotropyBlock"]=Pm;var Cm=function(i){function t(e){var n=i.call(this,e)||this;return n.useSphericalHarmonics=!0,n.forceIrradianceInFragment=!1,n._isUnique=!0,n.registerInput("position",_e.Vector3,!1,Me.Vertex),n.registerInput("world",_e.Matrix,!1,Me.Vertex),n.registerInput("color",_e.Color3,!0,Me.Fragment),n.registerOutput("reflection",_e.Object,Me.Fragment,new ui("reflection",n,br.Output,t,"ReflectionBlock")),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ReflectionBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this.worldPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this.worldNormalConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this.cameraPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionColor",{get:function(){return this.color.isConnected?this.color.associatedVariableName:"vec3(1., 1., 1.)"},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),l=o&&o.getTextureMatrix;r.setValue("REFLECTION",l,!0),l&&(r.setValue(this._defineLODReflectionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularReflection,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SPHERICAL_HARMONICS",this.useSphericalHarmonics,!0),r.setValue("GAMMAREFLECTION",o.gammaSpace,!0),r.setValue("RGBDREFLECTION",o.isRGBD,!0),o&&o.coordinatesMode!==ke.a.SKYBOX_MODE&&o.isCube&&(r.setValue("USESPHERICALFROMREFLECTIONMAP",!0),r.setValue("USEIRRADIANCEMAP",!1),this.forceIrradianceInFragment||this._scene.getEngine().getCaps().maxVaryingVectors<=8?r.setValue("USESPHERICALINVERTEX",!1):r.setValue("USESPHERICALINVERTEX",!0)))},t.prototype.bind=function(e,n,r,o){i.prototype.bind.call(this,e,n,r);var l=this._getTexture();if(l&&o){l.isCube?e.setTexture(this._cubeSamplerName,l):e.setTexture(this._2DSamplerName,l);var d=l.getSize().width;e.setFloat3(this._vReflectionMicrosurfaceInfosName,d,l.lodGenerationScale,l.lodGenerationOffset),e.setFloat2(this._vReflectionFilteringInfoName,d,J.a.Log2(d));var v=o._materialDefines,y=l.sphericalPolynomial;if(v.USESPHERICALFROMREFLECTIONMAP&&y)if(v.SPHERICAL_HARMONICS){var D=y.preScaledHarmonics;e.setVector3("vSphericalL00",D.l00),e.setVector3("vSphericalL1_1",D.l1_1),e.setVector3("vSphericalL10",D.l10),e.setVector3("vSphericalL11",D.l11),e.setVector3("vSphericalL2_2",D.l2_2),e.setVector3("vSphericalL2_1",D.l2_1),e.setVector3("vSphericalL20",D.l20),e.setVector3("vSphericalL21",D.l21),e.setVector3("vSphericalL22",D.l22)}else e.setFloat3("vSphericalX",y.x.x,y.x.y,y.x.z),e.setFloat3("vSphericalY",y.y.x,y.y.y,y.y.z),e.setFloat3("vSphericalZ",y.z.x,y.z.y,y.z.z),e.setFloat3("vSphericalXX_ZZ",y.xx.x-y.zz.x,y.xx.y-y.zz.y,y.xx.z-y.zz.z),e.setFloat3("vSphericalYY_ZZ",y.yy.x-y.zz.x,y.yy.y-y.zz.y,y.yy.z-y.zz.z),e.setFloat3("vSphericalZZ",y.zz.x,y.zz.y,y.zz.z),e.setFloat3("vSphericalXY",y.xy.x,y.xy.y,y.xy.z),e.setFloat3("vSphericalYZ",y.yz.x,y.yz.y,y.yz.z),e.setFloat3("vSphericalZX",y.zx.x,y.zx.y,y.zx.z)}},t.prototype.handleVertexSide=function(e){var n=i.prototype.handleVertexSide.call(this,e);e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});var r=e._getFreeVariableName("reflectionVector");return this._vEnvironmentIrradianceName=e._getFreeVariableName("vEnvironmentIrradiance"),e._emitVaryingFromString(this._vEnvironmentIrradianceName,"vec3","defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)"),e._emitUniformFromString("vSphericalL00","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL1_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL10","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL11","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_2","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL20","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL21","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL22","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalX","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXX_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYY_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZX","vec3","SPHERICAL_HARMONICS",!0),n+=`#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
                vec3 `+r+" = vec3("+this._reflectionMatrixName+" * vec4(normalize("+this.worldNormal.associatedVariableName+`).xyz, 0)).xyz;
                #ifdef `+this._defineOppositeZ+`
                    `+r+`.z *= -1.0;
                #endif
                `+this._vEnvironmentIrradianceName+" = computeEnvironmentIrradiance("+r+`);
            #endif\r
`},t.prototype.getCode=function(e,n){var r="";this.handleFragmentSideInits(e),e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]}),e._emitFunction("sampleReflection",`
            #ifdef `+this._define3DName+`
                #define sampleReflection(s, c) textureCube(s, c)
            #else
                #define sampleReflection(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleReflectionLod",`
            #ifdef `+this._define3DName+`
                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name);var o=`
            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {
                `+this.handleFragmentSideCodeReflectionCoords("worldNormal","worldPos",!0)+`
                return `+this._reflectionVectorName+`;
            }\r
`;return e._emitFunction("computeReflectionCoordsPBR",o,"//"+this.name),this._vReflectionMicrosurfaceInfosName=e._getFreeVariableName("vReflectionMicrosurfaceInfos"),e._emitUniformFromString(this._vReflectionMicrosurfaceInfosName,"vec3"),this._vReflectionInfosName=e._getFreeVariableName("vReflectionInfos"),this._vReflectionFilteringInfoName=e._getFreeVariableName("vReflectionFilteringInfo"),e._emitUniformFromString(this._vReflectionFilteringInfoName,"vec2"),r+=`#ifdef REFLECTION
            vec2 `+this._vReflectionInfosName+` = vec2(1., 0.);

            reflectionOutParams reflectionOut;

            reflectionBlock(
                v_`+this.worldPosition.associatedVariableName+`.xyz,
                `+n+`,
                alphaG,
                `+this._vReflectionMicrosurfaceInfosName+`,
                `+this._vReflectionInfosName+`,
                `+this.reflectionColor+`,
            #ifdef ANISOTROPIC
                anisotropicOut,
            #endif
            #if defined(`+this._defineLODReflectionAlpha+") && !defined("+this._defineSkyboxName+`)
                NdotVUnclamped,
            #endif
            #ifdef `+this._defineLinearSpecularReflection+`
                roughness,
            #endif
            #ifdef `+this._define3DName+`
                `+this._cubeSamplerName+`,
            #else
                `+this._2DSamplerName+`,
            #endif
            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)
                `+this._vEnvironmentIrradianceName+`,
            #endif
            #ifdef USESPHERICALFROMREFLECTIONMAP
                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                    `+this._reflectionMatrixName+`,
                #endif
            #endif
            #ifdef USEIRRADIANCEMAP
                irradianceSampler, // ** not handled **
            #endif
            #ifndef LODBASEDMICROSFURACE
                #ifdef `+this._define3DName+`
                    `+this._cubeSamplerName+`,
                    `+this._cubeSamplerName+`,
                #else
                    `+this._2DSamplerName+`,
                    `+this._2DSamplerName+`,
                #endif
            #endif
            #ifdef REALTIME_FILTERING
                `+this._vReflectionFilteringInfoName+`,
            #endif
                reflectionOut
            );
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target!==Me.Fragment&&(this._defineLODReflectionAlpha=e._getFreeDefineName("LODINREFLECTIONALPHA"),this._defineLinearSpecularReflection=e._getFreeDefineName("LINEARSPECULARREFLECTION")),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e+=this._codeVariableName+".texture.gammaSpace = "+this.texture.gammaSpace+`);\r
`),e+=this._codeVariableName+".useSphericalHarmonics = "+this.useSphericalHarmonics+`;\r
`,e+=this._codeVariableName+".forceIrradianceInFragment = "+this.forceIrradianceInFragment+`;\r
`},t.prototype.serialize=function(){var e,n,r=i.prototype.serialize.call(this);return r.useSphericalHarmonics=this.useSphericalHarmonics,r.forceIrradianceInFragment=this.forceIrradianceInFragment,r.gammaSpace=(n=(e=this.texture)===null||e===void 0?void 0:e.gammaSpace)===null||n===void 0||n,r},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.useSphericalHarmonics=e.useSphericalHarmonics,this.forceIrradianceInFragment=e.forceIrradianceInFragment,this.texture&&(this.texture.gammaSpace=e.gammaSpace)},Object(f.c)([sn("Spherical Harmonics",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useSphericalHarmonics",void 0),Object(f.c)([sn("Force irradiance in fragment",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceIrradianceInFragment",void 0),t}(Em);R.a.RegisteredTypes["BABYLON.ReflectionBlock"]=Cm;var Rh=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.remapF0OnInterfaceChange=!0,n._isUnique=!0,n.registerInput("intensity",_e.Float,!1,Me.Fragment),n.registerInput("roughness",_e.Float,!0,Me.Fragment),n.registerInput("indexOfRefraction",_e.Float,!0,Me.Fragment),n.registerInput("normalMapColor",_e.Color3,!0,Me.Fragment),n.registerInput("uv",_e.Vector2,!0,Me.Fragment),n.registerInput("tintColor",_e.Color3,!0,Me.Fragment),n.registerInput("tintAtDistance",_e.Float,!0,Me.Fragment),n.registerInput("tintThickness",_e.Float,!0,Me.Fragment),n.registerInput("worldTangent",_e.Vector4,!0),n.registerOutput("clearcoat",_e.Object,Me.Fragment,new ui("clearcoat",n,br.Output,t,"ClearCoatBlock")),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("clearcoatOut"),e._excludeVariableName("vClearCoatParams"),e._excludeVariableName("vClearCoatTintParams"),e._excludeVariableName("vClearCoatRefractionParams"),e._excludeVariableName("vClearCoatTangentSpaceParams")},t.prototype.getClassName=function(){return"ClearCoatBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintThickness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new Bt("ClearCoat intensity",Me.Fragment,_e.Float);n.value=1,n.output.connectTo(this.intensity)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("CLEARCOAT",!0),r.setValue("CLEARCOAT_TEXTURE",!1,!0),r.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0),r.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0),r.setValue("CLEARCOAT_DEFAULTIOR",!this.indexOfRefraction.isConnected||this.indexOfRefraction.connectInputBlock.value===gs._DefaultIndexOfRefraction,!0),r.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,!0)},t.prototype.bind=function(e,n,r,o){var l,d;i.prototype.bind.call(this,e,n,r);var v=(d=(l=this.indexOfRefraction.connectInputBlock)===null||l===void 0?void 0:l.value)!==null&&d!==void 0?d:gs._DefaultIndexOfRefraction,y=1-v,D=1+v,w=Math.pow(-y/D,2),F=1/v;e.setFloat4("vClearCoatRefractionParams",w,F,y,D);var z=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null,k=(z==null?void 0:z.perturbedNormal.isConnected)?z.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?1:-1,(k==null?void 0:k.invertY)?1:-1):e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?-1:1,(k==null?void 0:k.invertY)?-1:1)},t.prototype._generateTBNSpace=function(e,n,r){var o="",l="//"+this.name,d=this.worldTangent;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var v={search:/defined\(TANGENT\)/g,replace:d.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return d.isConnected&&(o+="vec3 tbnNormal = normalize("+r+`.xyz);\r
`,o+="vec3 tbnTangent = normalize("+d.associatedVariableName+`.xyz);\r
`,o+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,o+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",l,{replaceStrings:[v]}),o},t.GetCode=function(e,n,r,o,l,d,v){var y="",D=(n==null?void 0:n.intensity.isConnected)?n.intensity.associatedVariableName:"1.",w=(n==null?void 0:n.roughness.isConnected)?n.roughness.associatedVariableName:"0.",F=(n==null?void 0:n.normalMapColor.isConnected)?n.normalMapColor.associatedVariableName:"vec3(0.)",z=(n==null?void 0:n.uv.isConnected)?n.uv.associatedVariableName:"vec2(0.)",k=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",K=(n==null?void 0:n.tintThickness.isConnected)?n.tintThickness.associatedVariableName:"1.",ae=(n==null?void 0:n.tintAtDistance.isConnected)?n.tintAtDistance.associatedVariableName:"1.";return n&&(e._emitUniformFromString("vClearCoatRefractionParams","vec4"),e._emitUniformFromString("vClearCoatTangentSpaceParams","vec2")),l&&n&&(y+=n._generateTBNSpace(e,o,v),d=n.worldTangent.isConnected),y+=`clearcoatOutParams clearcoatOut;

        #ifdef CLEARCOAT
            vec2 vClearCoatParams = vec2(`+D+", "+w+`);
            vec4 vClearCoatTintParams = vec4(`+k+", "+K+`);

            clearcoatBlock(
                `+o+`.xyz,
                geometricNormalW,
                viewDirectionW,
                vClearCoatParams,
                specularEnvironmentR0,
            #ifdef CLEARCOAT_TEXTURE
                vec2(0.),
            #endif
            #ifdef CLEARCOAT_TINT
                vClearCoatTintParams,
                `+ae+`,
                vClearCoatRefractionParams,
                #ifdef CLEARCOAT_TINT_TEXTURE
                    vec4(0.),
                #endif
            #endif
            #ifdef CLEARCOAT_BUMP
                vec2(0., 1.),
                vec4(`+F+`, 0.),
                `+z+`,
                #if defined(`+(d?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                    vTBN,
                #else
                    vClearCoatTangentSpaceParams,
                #endif
                #ifdef OBJECTSPACE_NORMALMAP
                    normalMatrix,
                #endif
            #endif
            #if defined(FORCENORMALFORWARD) && defined(NORMAL)
                faceNormal,
            #endif
            #ifdef REFLECTION
                `+(r==null?void 0:r._vReflectionMicrosurfaceInfosName)+`,
                `+(r==null?void 0:r._vReflectionInfosName)+`,
                `+(r==null?void 0:r.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(r==null?void 0:r._define3DName)+`
                    `+(r==null?void 0:r._cubeSamplerName)+`,
                #else
                    `+(r==null?void 0:r._2DSamplerName)+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(r==null?void 0:r._define3DName)+`
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                    #else
                        `+(r==null?void 0:r._2DSamplerName)+`,
                        `+(r==null?void 0:r._2DSamplerName)+`,
                    #endif
                #endif
            #endif
            #if defined(ENVIRONMENTBRDF) && !defined(`+(r==null?void 0:r._defineSkyboxName)+`)
                #ifdef RADIANCEOCCLUSION
                    ambientMonochrome,
                #endif
            #endif
                clearcoatOut
            );
        #else
            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target===Me.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this)),this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".remapF0OnInterfaceChange = "+this.remapF0OnInterfaceChange+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange,e},t.prototype._deserialize=function(e,n,r){var o;i.prototype._deserialize.call(this,e,n,r),this.remapF0OnInterfaceChange=(o=e.remapF0OnInterfaceChange)===null||o===void 0||o},Object(f.c)([sn("Remap F0 on interface change",$t.Boolean,"ADVANCED")],t.prototype,"remapF0OnInterfaceChange",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.ClearCoatBlock"]=Rh;var Rm=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n.linkRefractionWithTransparency=!1,n.invertRefractionY=!1,n._isUnique=!0,n.registerInput("intensity",_e.Float,!1,Me.Fragment),n.registerInput("tintAtDistance",_e.Float,!0,Me.Fragment),n.registerOutput("refraction",_e.Object,Me.Fragment,new ui("refraction",n,br.Output,t,"RefractionBlock")),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"RefractionBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new Bt("Refraction intensity",Me.Fragment,_e.Float);n.value=1,n.output.connectTo(this.intensity)}if(this.view&&!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});r||(r=new Bt("view")).setAsSystemValue(Mt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),l=o&&o.getTextureMatrix;r.setValue("SS_REFRACTION",l,!0),l&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLODRefractionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularRefraction,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SS_LINKREFRACTIONTOTRANSPARENCY",this.linkRefractionWithTransparency,!0),r.setValue("SS_GAMMAREFRACTION",o.gammaSpace,!0),r.setValue("SS_RGBDREFRACTION",o.isRGBD,!0))},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r,o){var l,d;i.prototype.bind.call(this,e,n,r);var v=this._getTexture();if(v){v.isCube?e.setTexture(this._cubeSamplerName,v):e.setTexture(this._2DSamplerName,v),e.setMatrix(this._refractionMatrixName,v.getReflectionTextureMatrix());var y=1;v.isCube||v.depth&&(y=v.depth);var D=(d=(l=this.indexOfRefractionConnectionPoint.connectInputBlock)===null||l===void 0?void 0:l.value)!==null&&d!==void 0?d:1.5;e.setFloat4(this._vRefractionInfosName,v.level,1/D,y,this.invertRefractionY?-1:1),e.setFloat3(this._vRefractionMicrosurfaceInfosName,v.getSize().width,v.lodGenerationScale,v.lodGenerationOffset);var w=v.getSize().width;e.setFloat2(this._vRefractionFilteringInfoName,w,J.a.Log2(w))}},t.prototype.getCode=function(e){return e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),this._define3DName=e._getFreeDefineName("SS_REFRACTIONMAP_3D"),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._defineLODRefractionAlpha=e._getFreeDefineName("SS_LODINREFRACTIONALPHA"),this._defineLinearSpecularRefraction=e._getFreeDefineName("SS_LINEARSPECULARREFRACTION"),this._defineOppositeZ=e._getFreeDefineName("SS_REFRACTIONMAP_OPPOSITEZ"),this._refractionMatrixName=e._getFreeVariableName("refractionMatrix"),e._emitUniformFromString(this._refractionMatrixName,"mat4"),e._emitFunction("sampleRefraction",`
            #ifdef `+this._define3DName+`
                #define sampleRefraction(s, c) textureCube(s, c)
            #else
                #define sampleRefraction(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleRefractionLod",`
            #ifdef `+this._define3DName+`
                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name),this._vRefractionMicrosurfaceInfosName=e._getFreeVariableName("vRefractionMicrosurfaceInfos"),e._emitUniformFromString(this._vRefractionMicrosurfaceInfosName,"vec3"),this._vRefractionInfosName=e._getFreeVariableName("vRefractionInfos"),e._emitUniformFromString(this._vRefractionInfosName,"vec4"),this._vRefractionFilteringInfoName=e._getFreeVariableName("vRefractionFilteringInfo"),e._emitUniformFromString(this._vRefractionFilteringInfoName,"vec2"),""},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`),e+=this._codeVariableName+".linkRefractionWithTransparency = "+this.linkRefractionWithTransparency+`;\r
`,e+=this._codeVariableName+".invertRefractionY = "+this.invertRefractionY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e.linkRefractionWithTransparency=this.linkRefractionWithTransparency,e.invertRefractionY=this.invertRefractionY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=yi.Parse(e.texture,n,r):this.texture=ke.a.Parse(e.texture,n,r)),this.linkRefractionWithTransparency=e.linkRefractionWithTransparency,this.invertRefractionY=e.invertRefractionY},Object(f.c)([sn("Link refraction to transparency",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"linkRefractionWithTransparency",void 0),Object(f.c)([sn("Invert refraction Y",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"invertRefractionY",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.RefractionBlock"]=Rm;var Oh=function(i){function t(e){var n=i.call(this,e,Me.Fragment)||this;return n._isUnique=!0,n.registerInput("thickness",_e.Float,!1,Me.Fragment),n.registerInput("tintColor",_e.Color3,!0,Me.Fragment),n.registerInput("translucencyIntensity",_e.Float,!0,Me.Fragment),n.registerInput("translucencyDiffusionDist",_e.Color3,!0,Me.Fragment),n.registerInput("refraction",_e.Object,!0,Me.Fragment,new ui("refraction",n,br.Input,Rm,"RefractionBlock")),n.registerOutput("subsurface",_e.Object,Me.Fragment,new ui("subsurface",n,br.Output,t,"SubSurfaceBlock")),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("subSurfaceOut"),e._excludeVariableName("vThicknessParam"),e._excludeVariableName("vTintColor"),e._excludeVariableName("vSubSurfaceIntensity")},t.prototype.getClassName=function(){return"SubSurfaceBlock"},Object.defineProperty(t.prototype,"thickness",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyIntensity",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyDiffusionDist",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.thickness.isConnected){var n=new Bt("SubSurface thickness",Me.Fragment,_e.Float);n.value=0,n.output.connectTo(this.thickness)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this.translucencyDiffusionDist.isConnected||this.translucencyIntensity.isConnected;r.setValue("SUBSURFACE",o||this.refraction.isConnected,!0),r.setValue("SS_TRANSLUCENCY",o,!0),r.setValue("SS_THICKNESSANDMASK_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE_GLTF",!1,!0)},t.GetCode=function(e,n,r,o){var l,d,v,y,D,w,F,z,k,K,ae,le,fe,me,be,Ee,xe="",Ae=(n==null?void 0:n.thickness.isConnected)?n.thickness.associatedVariableName:"0.",Ie=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",Re=(n==null?void 0:n.translucencyIntensity.isConnected)?n==null?void 0:n.translucencyIntensity.associatedVariableName:"1.",Pe=(n==null?void 0:n.translucencyDiffusionDist.isConnected)?n==null?void 0:n.translucencyDiffusionDist.associatedVariableName:"vec3(1.)",Ce=(n==null?void 0:n.refraction.isConnected)?(l=n==null?void 0:n.refraction.connectedPoint)===null||l===void 0?void 0:l.ownerBlock:null,Ue=(Ce==null?void 0:Ce.tintAtDistance.isConnected)?Ce.tintAtDistance.associatedVariableName:"1.",Oe=(Ce==null?void 0:Ce.intensity.isConnected)?Ce.intensity.associatedVariableName:"1.",Ve=(Ce==null?void 0:Ce.view.isConnected)?Ce.view.associatedVariableName:"";return xe+=(d=Ce==null?void 0:Ce.getCode(e))!==null&&d!==void 0?d:"",xe+=`subSurfaceOutParams subSurfaceOut;

        #ifdef SUBSURFACE
            vec2 vThicknessParam = vec2(0., `+Ae+`);
            vec4 vTintColor = vec4(`+Ie+", "+Ue+`);
            vec3 vSubSurfaceIntensity = vec3(`+Oe+", "+Re+`, 0.);

            subSurfaceBlock(
                vSubSurfaceIntensity,
                vThicknessParam,
                vTintColor,
                normalW,
                specularEnvironmentReflectance,
            #ifdef SS_THICKNESSANDMASK_TEXTURE
                vec4(0.),
            #endif
            #ifdef REFLECTION
                #ifdef SS_TRANSLUCENCY
                    `+(r==null?void 0:r._reflectionMatrixName)+`,
                    #ifdef USESPHERICALFROMREFLECTIONMAP
                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                            reflectionOut.irradianceVector,
                        #endif
                        #if defined(REALTIME_FILTERING)
                            `+(r==null?void 0:r._cubeSamplerName)+`,
                            `+(r==null?void 0:r._vReflectionFilteringInfoName)+`,
                        #endif
                        #endif
                    #ifdef USEIRRADIANCEMAP
                        irradianceSampler,
                    #endif
                #endif
            #endif
            #ifdef SS_REFRACTION
                `+o+`.xyz,
                viewDirectionW,
                `+Ve+`,
                surfaceAlbedo,
                `+((v=Ce==null?void 0:Ce._vRefractionInfosName)!==null&&v!==void 0?v:"")+`,
                `+((y=Ce==null?void 0:Ce._refractionMatrixName)!==null&&y!==void 0?y:"")+`,
                `+((D=Ce==null?void 0:Ce._vRefractionMicrosurfaceInfosName)!==null&&D!==void 0?D:"")+`,
                vLightingIntensity,
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha,
                #endif
                #ifdef `+((w=Ce==null?void 0:Ce._defineLODRefractionAlpha)!==null&&w!==void 0?w:"IGNORE")+`
                    NdotVUnclamped,
                #endif
                #ifdef `+((F=Ce==null?void 0:Ce._defineLinearSpecularRefraction)!==null&&F!==void 0?F:"IGNORE")+`
                    roughness,
                #else
                    alphaG,
                #endif
                #ifdef `+((z=Ce==null?void 0:Ce._define3DName)!==null&&z!==void 0?z:"IGNORE")+`
                    `+((k=Ce==null?void 0:Ce._cubeSamplerName)!==null&&k!==void 0?k:"")+`,
                #else
                    `+((K=Ce==null?void 0:Ce._2DSamplerName)!==null&&K!==void 0?K:"")+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+((ae=Ce==null?void 0:Ce._define3DName)!==null&&ae!==void 0?ae:"IGNORE")+`
                        `+((le=Ce==null?void 0:Ce._cubeSamplerName)!==null&&le!==void 0?le:"")+`,
                        `+((fe=Ce==null?void 0:Ce._cubeSamplerName)!==null&&fe!==void 0?fe:"")+`,
                    #else
                        `+((me=Ce==null?void 0:Ce._2DSamplerName)!==null&&me!==void 0?me:"")+`,
                        `+((be=Ce==null?void 0:Ce._2DSamplerName)!==null&&be!==void 0?be:"")+`,
                    #endif
                #endif
                #ifdef ANISOTROPIC
                    anisotropicOut,
                #endif
                #ifdef REALTIME_FILTERING
                    `+((Ee=Ce==null?void 0:Ce._vRefractionFilteringInfoName)!==null&&Ee!==void 0?Ee:"")+`,
                #endif
            #endif
            #ifdef SS_TRANSLUCENCY
                `+Pe+`,
            #endif
                subSurfaceOut
            );

            #ifdef SS_REFRACTION
                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha = subSurfaceOut.alpha;
                #endif
            #endif
        #else
            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Me.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(Et);R.a.RegisteredTypes["BABYLON.SubSurfaceBlock"]=Oh;var Tw={ambientClr:["finalAmbient",""],diffuseDir:["finalDiffuse",""],specularDir:["finalSpecularScaled","!defined(UNLIT) && defined(SPECULARTERM)"],clearcoatDir:["finalClearCoatScaled","!defined(UNLIT) && defined(CLEARCOAT)"],sheenDir:["finalSheenScaled","!defined(UNLIT) && defined(SHEEN)"],diffuseInd:["finalIrradiance","!defined(UNLIT) && defined(REFLECTION)"],specularInd:["finalRadianceScaled","!defined(UNLIT) && defined(REFLECTION)"],clearcoatInd:["clearcoatOut.finalClearCoatRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)"],sheenInd:["sheenOut.finalSheenRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)"],refraction:["subSurfaceOut.finalRefraction","!defined(UNLIT) && defined(SS_REFRACTION)"],lighting:["finalColor.rgb",""],shadow:["shadow",""],alpha:["alpha",""]},BT=function(i){function t(e){var n=i.call(this,e,Me.VertexAndFragment)||this;return n._environmentBRDFTexture=null,n._metallicReflectanceColor=C.a.White(),n._metallicF0Factor=1,n.directIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.lightFalloff=0,n.useAlphaTest=!1,n.alphaTestCutoff=.5,n.useAlphaBlending=!1,n.useRadianceOverAlpha=!0,n.useSpecularOverAlpha=!0,n.enableSpecularAntiAliasing=!1,n.realTimeFiltering=!1,n.realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,n.useEnergyConservation=!0,n.useRadianceOcclusion=!0,n.useHorizonOcclusion=!0,n.unlit=!1,n.forceNormalForward=!1,n.debugMode=0,n.debugLimit=0,n.debugFactor=1,n._isUnique=!0,n.registerInput("worldPosition",_e.Vector4,!1,Me.Vertex),n.registerInput("worldNormal",_e.Vector4,!1,Me.Fragment),n.registerInput("view",_e.Matrix,!1),n.registerInput("cameraPosition",_e.Vector3,!1,Me.Fragment),n.registerInput("perturbedNormal",_e.Vector4,!0,Me.Fragment),n.registerInput("baseColor",_e.Color3,!0,Me.Fragment),n.registerInput("metallic",_e.Float,!1,Me.Fragment),n.registerInput("roughness",_e.Float,!1,Me.Fragment),n.registerInput("ambientOcc",_e.Float,!0,Me.Fragment),n.registerInput("opacity",_e.Float,!0,Me.Fragment),n.registerInput("indexOfRefraction",_e.Float,!0,Me.Fragment),n.registerInput("ambientColor",_e.Color3,!0,Me.Fragment),n.registerInput("reflection",_e.Object,!0,Me.Fragment,new ui("reflection",n,br.Input,Cm,"ReflectionBlock")),n.registerInput("clearcoat",_e.Object,!0,Me.Fragment,new ui("clearcoat",n,br.Input,Rh,"ClearCoatBlock")),n.registerInput("sheen",_e.Object,!0,Me.Fragment,new ui("sheen",n,br.Input,Am,"SheenBlock")),n.registerInput("subsurface",_e.Object,!0,Me.Fragment,new ui("subsurface",n,br.Input,Oh,"SubSurfaceBlock")),n.registerInput("anisotropy",_e.Object,!0,Me.Fragment,new ui("anisotropy",n,br.Input,Pm,"AnisotropyBlock")),n.registerOutput("ambientClr",_e.Color3,Me.Fragment),n.registerOutput("diffuseDir",_e.Color3,Me.Fragment),n.registerOutput("specularDir",_e.Color3,Me.Fragment),n.registerOutput("clearcoatDir",_e.Color3,Me.Fragment),n.registerOutput("sheenDir",_e.Color3,Me.Fragment),n.registerOutput("diffuseInd",_e.Color3,Me.Fragment),n.registerOutput("specularInd",_e.Color3,Me.Fragment),n.registerOutput("clearcoatInd",_e.Color3,Me.Fragment),n.registerOutput("sheenInd",_e.Color3,Me.Fragment),n.registerOutput("refraction",_e.Color3,Me.Fragment),n.registerOutput("lighting",_e.Color3,Me.Fragment),n.registerOutput("shadow",_e.Float,Me.Fragment),n.registerOutput("alpha",_e.Float,Me.Fragment),n}return Object(f.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("vLightingIntensity"),e._excludeVariableName("geometricNormalW"),e._excludeVariableName("normalW"),e._excludeVariableName("faceNormal"),e._excludeVariableName("albedoOpacityOut"),e._excludeVariableName("surfaceAlbedo"),e._excludeVariableName("alpha"),e._excludeVariableName("aoOut"),e._excludeVariableName("baseColor"),e._excludeVariableName("reflectivityOut"),e._excludeVariableName("microSurface"),e._excludeVariableName("roughness"),e._excludeVariableName("NdotVUnclamped"),e._excludeVariableName("NdotV"),e._excludeVariableName("alphaG"),e._excludeVariableName("AARoughnessFactors"),e._excludeVariableName("environmentBrdf"),e._excludeVariableName("ambientMonochrome"),e._excludeVariableName("seo"),e._excludeVariableName("eho"),e._excludeVariableName("environmentRadiance"),e._excludeVariableName("irradianceVector"),e._excludeVariableName("environmentIrradiance"),e._excludeVariableName("diffuseBase"),e._excludeVariableName("specularBase"),e._excludeVariableName("preInfo"),e._excludeVariableName("info"),e._excludeVariableName("shadow"),e._excludeVariableName("finalDiffuse"),e._excludeVariableName("finalAmbient"),e._excludeVariableName("ambientOcclusionForDirectDiffuse"),e._excludeVariableName("finalColor"),e._excludeVariableName("vClipSpacePosition"),e._excludeVariableName("vDebugMode")},t.prototype.getClassName=function(){return"PBRMetallicRoughnessBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perturbedNormal",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metallic",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientOcc",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._inputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._inputs[12]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._inputs[13]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._inputs[14]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._inputs[15]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._inputs[16]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientClr",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseDir",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularDir",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatDir",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenDir",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseIndirect",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularIndirect",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatIndirect",{get:function(){return this._outputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenIndirect",{get:function(){return this._outputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lighting",{get:function(){return this._outputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._outputs[12]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.CameraPosition});n||(n=new Bt("cameraPosition")).setAsSystemValue(Mt.CameraPosition),n.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Mt.View});r||(r=new Bt("view")).setAsSystemValue(Mt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){r.setValue("PBR",!0),r.setValue("METALLICWORKFLOW",!0),r.setValue("DEBUGMODE",this.debugMode,!0),r.setValue("NORMALXYSCALE",!0),r.setValue("BUMP",this.perturbedNormal.isConnected,!0),r.setValue("LODBASEDMICROSFURACE",this._scene.getEngine().getCaps().textureLOD),r.setValue("ALBEDO",!1,!0),r.setValue("OPACITY",this.opacity.isConnected,!0),r.setValue("AMBIENT",!0,!0),r.setValue("AMBIENTINGRAYSCALE",!1,!0),r.setValue("REFLECTIVITY",!1,!0),r.setValue("AOSTOREINMETALMAPRED",!1,!0),r.setValue("METALLNESSSTOREINMETALMAPBLUE",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPALPHA",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPGREEN",!1,!0),this.lightFalloff===nr.LIGHTFALLOFF_STANDARD?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!1)):this.lightFalloff===nr.LIGHTFALLOFF_GLTF?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!0)):(r.setValue("USEPHYSICALLIGHTFALLOFF",!0),r.setValue("USEGLTFLIGHTFALLOFF",!1));var o=this.alphaTestCutoff.toString();if(r.setValue("ALPHABLEND",this.useAlphaBlending,!0),r.setValue("ALPHAFROMALBEDO",!1,!0),r.setValue("ALPHATEST",this.useAlphaTest,!0),r.setValue("ALPHATESTVALUE",o.indexOf(".")<0?o+".":o,!0),r.setValue("OPACITYRGB",!1,!0),r.setValue("RADIANCEOVERALPHA",this.useRadianceOverAlpha,!0),r.setValue("SPECULAROVERALPHA",this.useSpecularOverAlpha,!0),r.setValue("SPECULARAA",this._scene.getEngine().getCaps().standardDerivatives&&this.enableSpecularAntiAliasing,!0),r.setValue("REALTIME_FILTERING",this.realTimeFiltering,!0),this._scene.getEngine().webGLVersion>1?r.setValue("NUM_SAMPLES",this.realTimeFilteringQuality+"u",!0):r.setValue("NUM_SAMPLES",""+this.realTimeFilteringQuality,!0),r.setValue("BRDF_V_HEIGHT_CORRELATED",!0),r.setValue("MS_BRDF_ENERGY_CONSERVATION",this.useEnergyConservation,!0),r.setValue("RADIANCEOCCLUSION",this.useRadianceOcclusion,!0),r.setValue("HORIZONOCCLUSION",this.useHorizonOcclusion,!0),r.setValue("UNLIT",this.unlit,!0),r.setValue("FORCENORMALFORWARD",this.forceNormalForward,!0),this._environmentBRDFTexture&&bt.a.ReflectionTextureEnabled?(r.setValue("ENVIRONMENTBRDF",!0),r.setValue("ENVIRONMENTBRDF_RGBD",this._environmentBRDFTexture.isRGBD,!0)):(r.setValue("ENVIRONMENTBRDF",!1),r.setValue("ENVIRONMENTBRDF_RGBD",!1)),r._areLightsDirty){var l=e.getScene();if(this.light){var d={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};lt.a.PrepareDefinesForLight(l,e,this.light,this._lightId,r,!0,d),d.needRebuild&&r.rebuild()}else lt.a.PrepareDefinesForLights(l,e,r,!0,n.maxSimultaneousLights),r._needNormals=!0,lt.a.PrepareDefinesForMultiview(l,r)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var l=0;l<n.maxSimultaneousLights&&r["LIGHT"+l];l++){var d=e.uniforms.indexOf("vLightData"+l)>=0;lt.a.PrepareUniformsAndSamplersForLight(l,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+l],o,d)}},t.prototype.bind=function(e,n,r){var o,l;if(r){var d=r.getScene();this.light?lt.a.BindLight(this.light,this._lightId,d,e,!0):lt.a.BindLights(d,r,e,!0,n.maxSimultaneousLights),e.setTexture(this._environmentBrdfSamplerName,this._environmentBRDFTexture),e.setFloat2("vDebugMode",this.debugLimit,this.debugFactor);var v=this._scene.ambientColor;v&&e.setColor3("ambientFromScene",v);var y=d.useRightHandedSystem===(d._mirroredCameraPosition!=null);e.setFloat(this._invertNormalName,y?-1:1),e.setFloat4("vLightingIntensity",this.directIntensity,1,this.environmentIntensity*this._scene.environmentIntensity,this.specularIntensity);var D=(l=(o=this.indexOfRefraction.connectInputBlock)===null||o===void 0?void 0:o.value)!==null&&l!==void 0?l:1.5,w=Math.pow((D-1)/(D+1),2);this._metallicReflectanceColor.scaleToRef(w*this._metallicF0Factor,C.c.Color3[0]);var F=this._metallicF0Factor;e.setColor4(this._vMetallicReflectanceFactorsName,C.c.Color3[0],F)}},t.prototype._injectVertexCode=function(e){var n,r,o=this.worldPosition,l="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",l,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",l,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var d="v_"+o.associatedVariableName;e._emitVaryingFromString(d,"vec4")&&(e.compilationString+=d+" = "+o.associatedVariableName+`;\r
`);var v=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;v&&(v.viewConnectionPoint=this.view),e.compilationString+=(r=v==null?void 0:v.handleVertexSide(e))!==null&&r!==void 0?r:"",e._emitUniformFromString("vDebugMode","vec2","defined(IGNORE) || DEBUGMODE > 0"),e._emitUniformFromString("ambientFromScene","vec3"),e._emitVaryingFromString("vClipSpacePosition","vec4","defined(IGNORE) || DEBUGMODE > 0")&&(e._injectAtEnd+=`#if DEBUGMODE > 0\r
`,e._injectAtEnd+=`vClipSpacePosition = gl_Position;\r
`,e._injectAtEnd+=`#endif\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",l,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:o.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+o.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",l,{repeatKey:"maxSimultaneousLights"}))},t.prototype._getAlbedoOpacityCode=function(){var e=`albedoOpacityOutParams albedoOpacityOut;\r
`;return e+=`albedoOpacityBlock(
                vec4(`+(this.baseColor.isConnected?this.baseColor.associatedVariableName:"vec3(1.)")+`, 1.),
            #ifdef ALBEDO
                vec4(1.),
                vec2(1., 1.),
            #endif
            #ifdef OPACITY
                vec4(`+(this.opacity.isConnected?this.opacity.associatedVariableName:"1.")+`),
                vec2(1., 1.),
            #endif
                albedoOpacityOut
            );

            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;
            float alpha = albedoOpacityOut.alpha;\r
`},t.prototype._getAmbientOcclusionCode=function(){var e=`ambientOcclusionOutParams aoOut;\r
`;return e+=`ambientOcclusionBlock(
            #ifdef AMBIENT
                vec3(`+(this.ambientOcc.isConnected?this.ambientOcc.associatedVariableName:"1.")+`),
                vec4(0., 1.0, 1.0, 0.),
            #endif
                aoOut
            );\r
`},t.prototype._getReflectivityCode=function(e){var n=`reflectivityOutParams reflectivityOut;\r
`;return this._vMetallicReflectanceFactorsName=e._getFreeVariableName("vMetallicReflectanceFactors"),e._emitUniformFromString(this._vMetallicReflectanceFactorsName,"vec4"),n+=`vec3 baseColor = surfaceAlbedo;

            reflectivityBlock(
                vec4(`+this.metallic.associatedVariableName+", "+this.roughness.associatedVariableName+`, 0., 0.),
            #ifdef METALLICWORKFLOW
                surfaceAlbedo,
                `+this._vMetallicReflectanceFactorsName+`,
            #endif
            #ifdef REFLECTIVITY
                vec3(0., 0., 1.),
                vec4(1.),
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor,
            #endif
            #ifdef MICROSURFACEMAP
                microSurfaceTexel, <== not handled!
            #endif
                reflectivityOut
            );

            float microSurface = reflectivityOut.microSurface;
            float roughness = reflectivityOut.roughness;

            #ifdef METALLICWORKFLOW
                surfaceAlbedo = reflectivityOut.surfaceAlbedo;
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;
            #endif\r
`},t.prototype._buildBlock=function(e){var n,r,o,l,d,v,y,D,w,F,z,k,K,ae,le,fe,me,be,Ee,xe,Ae,Ie,Re,Pe,Ce,Ue,Oe,Ve,Le,ze,tt,ut,ft,vt,rt,mt,pt,it,yt;i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,this._environmentBRDFTexture||(this._environmentBRDFTexture=lh.GetEnvironmentBRDFTexture(this._scene));var We=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;if(We&&(We.worldPositionConnectionPoint=this.worldPosition,We.cameraPositionConnectionPoint=this.cameraPosition,We.worldNormalConnectionPoint=this.worldNormal),e.target!==Me.Fragment)return this._injectVertexCode(e),this;e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var at="//"+this.name,It="v_"+this.worldPosition.associatedVariableName,vn=this.perturbedNormal;this._environmentBrdfSamplerName=e._getFreeVariableName("environmentBrdfSampler"),e._emit2DSampler(this._environmentBrdfSamplerName),e.sharedData.hints.needAlphaBlending=e.sharedData.hints.needAlphaBlending||this.useAlphaBlending,e.sharedData.hints.needAlphaTesting=e.sharedData.hints.needAlphaTesting||this.useAlphaTest,e._emitExtension("lod","#extension GL_EXT_shader_texture_lod : enable","defined(LODBASEDMICROSFURACE)"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",at,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",at,{repeatKey:"maxSimultaneousLights"}),e._emitFunctionFromInclude("helperFunctions",at),e._emitFunctionFromInclude("importanceSampling",at),e._emitFunctionFromInclude("pbrHelperFunctions",at),e._emitFunctionFromInclude("imageProcessingFunctions",at),e._emitFunctionFromInclude("shadowsFragmentFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingSetupFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions",at),e._emitFunctionFromInclude("pbrBRDFFunctions",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(r=We==null?void 0:We._defineSkyboxName)!==null&&r!==void 0?r:"REFLECTIONMAP_SKYBOX"}]}),e._emitFunctionFromInclude("hdrFilteringFunctions",at),e._emitFunctionFromInclude("pbrDirectLightingFunctions",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"}]}),e._emitFunctionFromInclude("pbrIBLFunctions",at),e._emitFunctionFromInclude("pbrBlockAlbedoOpacity",at),e._emitFunctionFromInclude("pbrBlockReflectivity",at),e._emitFunctionFromInclude("pbrBlockAmbientOcclusion",at),e._emitFunctionFromInclude("pbrBlockAlphaFresnel",at),e._emitFunctionFromInclude("pbrBlockAnisotropic",at),e._emitUniformFromString("vLightingIntensity","vec4"),this._vNormalWName=e._getFreeVariableName("vNormalW"),e.compilationString+="vec4 "+this._vNormalWName+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - "+It+`.xyz);\r
`),e.compilationString+="vec3 geometricNormalW = "+this._vNormalWName+`.xyz;\r
`,e.compilationString+="vec3 normalW = "+(vn.isConnected?"normalize("+vn.associatedVariableName+".xyz)":"geometricNormalW")+`;\r
`,this._invertNormalName=e._getFreeVariableName("invertNormal"),e._emitUniformFromString(this._invertNormalName,"float"),e.compilationString+=e._emitCodeFromInclude("pbrBlockNormalFinal",at,{replaceStrings:[{search:/vPositionW/g,replace:It+".xyz"},{search:/vEyePosition.w/g,replace:this._invertNormalName}]}),e.compilationString+=this._getAlbedoOpacityCode(),e.compilationString+=e._emitCodeFromInclude("depthPrePass",at),e.compilationString+=this._getAmbientOcclusionCode(),e.compilationString+=e._emitCodeFromInclude("pbrBlockLightmapInit",at),e.compilationString+=`#ifdef UNLIT
                vec3 diffuseBase = vec3(1., 1., 1.);
            #else\r
`,e.compilationString+=this._getReflectivityCode(e),e.compilationString+=e._emitCodeFromInclude("pbrBlockGeometryInfo",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(o=We==null?void 0:We._defineSkyboxName)!==null&&o!==void 0?o:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(l=We==null?void 0:We._define3DName)!==null&&l!==void 0?l:"REFLECTIONMAP_3D"}]});var Jt=this.anisotropy.isConnected?(d=this.anisotropy.connectedPoint)===null||d===void 0?void 0:d.ownerBlock:null;Jt&&(Jt.worldPositionConnectionPoint=this.worldPosition,Jt.worldNormalConnectionPoint=this.worldNormal,e.compilationString+=Jt.getCode(e,!this.perturbedNormal.isConnected)),We&&We.hasTexture&&(e.compilationString+=We.getCode(e,Jt?"anisotropicOut.anisotropicNormal":"normalW")),e._emitFunctionFromInclude("pbrBlockReflection",at,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(v=We==null?void 0:We._define3DName)!==null&&v!==void 0?v:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(y=We==null?void 0:We._defineOppositeZ)!==null&&y!==void 0?y:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(D=We==null?void 0:We._defineProjectionName)!==null&&D!==void 0?D:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(w=We==null?void 0:We._defineSkyboxName)!==null&&w!==void 0?w:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(F=We==null?void 0:We._defineLODReflectionAlpha)!==null&&F!==void 0?F:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(z=We==null?void 0:We._defineLinearSpecularReflection)!==null&&z!==void 0?z:"LINEARSPECULARREFLECTION"},{search:/vReflectionFilteringInfo/g,replace:(k=We==null?void 0:We._vReflectionFilteringInfoName)!==null&&k!==void 0?k:"vReflectionFilteringInfo"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance0",at,{replaceStrings:[{search:/metallicReflectanceFactors/g,replace:this._vMetallicReflectanceFactorsName}]});var Sn=this.sheen.isConnected?(K=this.sheen.connectedPoint)===null||K===void 0?void 0:K.ownerBlock:null;Sn&&(e.compilationString+=Sn.getCode(We)),e._emitFunctionFromInclude("pbrBlockSheen",at,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(ae=We==null?void 0:We._define3DName)!==null&&ae!==void 0?ae:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(le=We==null?void 0:We._defineSkyboxName)!==null&&le!==void 0?le:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(fe=We==null?void 0:We._defineLODReflectionAlpha)!==null&&fe!==void 0?fe:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(me=We==null?void 0:We._defineLinearSpecularReflection)!==null&&me!==void 0?me:"LINEARSPECULARREFLECTION"}]});var Rt=this.clearcoat.isConnected?(be=this.clearcoat.connectedPoint)===null||be===void 0?void 0:be.ownerBlock:null,Rn=!this.perturbedNormal.isConnected&&!this.anisotropy.isConnected,bn=this.perturbedNormal.isConnected&&((Ee=this.perturbedNormal.connectedPoint)===null||Ee===void 0?void 0:Ee.ownerBlock).worldTangent.isConnected,hn=this.anisotropy.isConnected&&((xe=this.anisotropy.connectedPoint)===null||xe===void 0?void 0:xe.ownerBlock).worldTangent.isConnected,yn=bn||!this.perturbedNormal.isConnected&&hn;e.compilationString+=Rh.GetCode(e,Rt,We,It,Rn,yn,this.worldNormal.associatedVariableName),Rn&&(yn=(Ae=Rt==null?void 0:Rt.worldTangent.isConnected)!==null&&Ae!==void 0&&Ae),e._emitFunctionFromInclude("pbrBlockClearcoat",at,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(Ie=We==null?void 0:We._define3DName)!==null&&Ie!==void 0?Ie:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(Re=We==null?void 0:We._defineOppositeZ)!==null&&Re!==void 0?Re:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(Pe=We==null?void 0:We._defineProjectionName)!==null&&Pe!==void 0?Pe:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(Ce=We==null?void 0:We._defineSkyboxName)!==null&&Ce!==void 0?Ce:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(Ue=We==null?void 0:We._defineLODReflectionAlpha)!==null&&Ue!==void 0?Ue:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(Oe=We==null?void 0:We._defineLinearSpecularReflection)!==null&&Oe!==void 0?Oe:"LINEARSPECULARREFLECTION"},{search:/defined\(TANGENT\)/g,replace:yn?"defined(TANGENT)":"defined(IGNORE)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance",at,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(Ve=We==null?void 0:We._defineSkyboxName)!==null&&Ve!==void 0?Ve:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(Le=We==null?void 0:We._define3DName)!==null&&Le!==void 0?Le:"REFLECTIONMAP_3D"}]});var Lt=this.subsurface.isConnected?(ze=this.subsurface.connectedPoint)===null||ze===void 0?void 0:ze.ownerBlock:null,Kt=this.subsurface.isConnected?(ut=((tt=this.subsurface.connectedPoint)===null||tt===void 0?void 0:tt.ownerBlock).refraction.connectedPoint)===null||ut===void 0?void 0:ut.ownerBlock:null;Kt&&(Kt.viewConnectionPoint=this.view,Kt.indexOfRefractionConnectionPoint=this.indexOfRefraction),e.compilationString+=Oh.GetCode(e,Lt,We,It),e._emitFunctionFromInclude("pbrBlockSubSurface",at,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(ft=We==null?void 0:We._define3DName)!==null&&ft!==void 0?ft:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(vt=We==null?void 0:We._defineOppositeZ)!==null&&vt!==void 0?vt:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(rt=We==null?void 0:We._defineProjectionName)!==null&&rt!==void 0?rt:"REFLECTIONMAP_PROJECTION"},{search:/SS_REFRACTIONMAP_3D/g,replace:(mt=Kt==null?void 0:Kt._define3DName)!==null&&mt!==void 0?mt:"SS_REFRACTIONMAP_3D"},{search:/SS_LODINREFRACTIONALPHA/g,replace:(pt=Kt==null?void 0:Kt._defineLODRefractionAlpha)!==null&&pt!==void 0?pt:"SS_LODINREFRACTIONALPHA"},{search:/SS_LINEARSPECULARREFRACTION/g,replace:(it=Kt==null?void 0:Kt._defineLinearSpecularRefraction)!==null&&it!==void 0?it:"SS_LINEARSPECULARREFRACTION"},{search:/SS_REFRACTIONMAP_OPPOSITEZ/g,replace:(yt=Kt==null?void 0:Kt._defineOppositeZ)!==null&&yt!==void 0?yt:"SS_REFRACTIONMAP_OPPOSITEZ"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockDirectLighting",at),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",at,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",at,{repeatKey:"maxSimultaneousLights"}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalLitComponents",at),e.compilationString+=`#endif\r
`;var In=this.ambientColor.isConnected?this.ambientColor.associatedVariableName:"vec3(0., 0., 0.)",wr=nr.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();wr.indexOf(".")===-1&&(wr+="."),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalUnlitComponents",at,{replaceStrings:[{search:/vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,replace:""},{search:/vAmbientColor/g,replace:In+" * ambientFromScene"},{search:/vAmbientInfos\.w/g,replace:wr}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalColorComposition",at,{replaceStrings:[{search:/finalEmissive/g,replace:"vec3(0.)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockImageProcessing",at,{replaceStrings:[{search:/visibility/g,replace:"1."}]}),e.compilationString+=e._emitCodeFromInclude("pbrDebug",at,{replaceStrings:[{search:/vNormalW/g,replace:this._vNormalWName},{search:/vPositionW/g,replace:It},{search:/albedoTexture\.rgb;/g,replace:`vec3(1.);\r
gl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r
`}]});for(var Hr=0,di=this._outputs;Hr<di.length;Hr++){var Lr=di[Hr];if(Lr.hasEndpoints){var xn=Tw[Lr.name];if(xn){var Ai=xn[0],co=xn[1];co&&(e.compilationString+="#if "+co+`\r
`),e.compilationString+=this._declareOutput(Lr,e)+" = "+Ai+`;\r
`,co&&(e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(Lr,e)+` = vec3(0.);\r
`,e.compilationString+=`#endif\r
`)}else console.error("There's no remapping for the "+Lr.name+" end point! No code generated")}}return this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".lightFalloff = "+this.lightFalloff+`;\r
`,e+=this._codeVariableName+".useAlphaTest = "+this.useAlphaTest+`;\r
`,e+=this._codeVariableName+".alphaTestCutoff = "+this.alphaTestCutoff+`;\r
`,e+=this._codeVariableName+".useAlphaBlending = "+this.useAlphaBlending+`;\r
`,e+=this._codeVariableName+".useRadianceOverAlpha = "+this.useRadianceOverAlpha+`;\r
`,e+=this._codeVariableName+".useSpecularOverAlpha = "+this.useSpecularOverAlpha+`;\r
`,e+=this._codeVariableName+".enableSpecularAntiAliasing = "+this.enableSpecularAntiAliasing+`;\r
`,e+=this._codeVariableName+".realTimeFiltering = "+this.realTimeFiltering+`;\r
`,e+=this._codeVariableName+".realTimeFilteringQuality = "+this.realTimeFilteringQuality+`;\r
`,e+=this._codeVariableName+".useEnergyConservation = "+this.useEnergyConservation+`;\r
`,e+=this._codeVariableName+".useRadianceOcclusion = "+this.useRadianceOcclusion+`;\r
`,e+=this._codeVariableName+".useHorizonOcclusion = "+this.useHorizonOcclusion+`;\r
`,e+=this._codeVariableName+".unlit = "+this.unlit+`;\r
`,e+=this._codeVariableName+".forceNormalForward = "+this.forceNormalForward+`;\r
`,e+=this._codeVariableName+".debugMode = "+this.debugMode+`;\r
`,e+=this._codeVariableName+".debugLimit = "+this.debugLimit+`;\r
`,e+=this._codeVariableName+".debugFactor = "+this.debugFactor+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e.lightFalloff=this.lightFalloff,e.useAlphaTest=this.useAlphaTest,e.alphaTestCutoff=this.alphaTestCutoff,e.useAlphaBlending=this.useAlphaBlending,e.useRadianceOverAlpha=this.useRadianceOverAlpha,e.useSpecularOverAlpha=this.useSpecularOverAlpha,e.enableSpecularAntiAliasing=this.enableSpecularAntiAliasing,e.realTimeFiltering=this.realTimeFiltering,e.realTimeFilteringQuality=this.realTimeFilteringQuality,e.useEnergyConservation=this.useEnergyConservation,e.useRadianceOcclusion=this.useRadianceOcclusion,e.useHorizonOcclusion=this.useHorizonOcclusion,e.unlit=this.unlit,e.forceNormalForward=this.forceNormalForward,e.debugMode=this.debugMode,e.debugLimit=this.debugLimit,e.debugFactor=this.debugFactor,e},t.prototype._deserialize=function(e,n,r){var o,l;i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId)),this.lightFalloff=(o=e.lightFalloff)!==null&&o!==void 0?o:0,this.useAlphaTest=e.useAlphaTest,this.alphaTestCutoff=e.alphaTestCutoff,this.useAlphaBlending=e.useAlphaBlending,this.useRadianceOverAlpha=e.useRadianceOverAlpha,this.useSpecularOverAlpha=e.useSpecularOverAlpha,this.enableSpecularAntiAliasing=e.enableSpecularAntiAliasing,this.realTimeFiltering=!!e.realTimeFiltering,this.realTimeFilteringQuality=(l=e.realTimeFilteringQuality)!==null&&l!==void 0?l:g.a.TEXTURE_FILTERING_QUALITY_LOW,this.useEnergyConservation=e.useEnergyConservation,this.useRadianceOcclusion=e.useRadianceOcclusion,this.useHorizonOcclusion=e.useHorizonOcclusion,this.unlit=e.unlit,this.forceNormalForward=!!e.forceNormalForward,this.debugMode=e.debugMode,this.debugLimit=e.debugLimit,this.debugFactor=e.debugFactor},Object(f.c)([sn("Direct lights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"directIntensity",void 0),Object(f.c)([sn("Environment lights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"environmentIntensity",void 0),Object(f.c)([sn("Specular highlights",$t.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"specularIntensity",void 0),Object(f.c)([sn("Light falloff",$t.List,"LIGHTING & COLORS",{notifiers:{update:!0},options:[{label:"Physical",value:nr.LIGHTFALLOFF_PHYSICAL},{label:"GLTF",value:nr.LIGHTFALLOFF_GLTF},{label:"Standard",value:nr.LIGHTFALLOFF_STANDARD}]})],t.prototype,"lightFalloff",void 0),Object(f.c)([sn("Alpha Testing",$t.Boolean,"OPACITY")],t.prototype,"useAlphaTest",void 0),Object(f.c)([sn("Alpha CutOff",$t.Float,"OPACITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"alphaTestCutoff",void 0),Object(f.c)([sn("Alpha blending",$t.Boolean,"OPACITY")],t.prototype,"useAlphaBlending",void 0),Object(f.c)([sn("Radiance over alpha",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useRadianceOverAlpha",void 0),Object(f.c)([sn("Specular over alpha",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useSpecularOverAlpha",void 0),Object(f.c)([sn("Specular anti-aliasing",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"enableSpecularAntiAliasing",void 0),Object(f.c)([sn("Realtime filtering",$t.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"realTimeFiltering",void 0),Object(f.c)([sn("Realtime filtering quality",$t.List,"RENDERING",{notifiers:{update:!0},options:[{label:"Low",value:g.a.TEXTURE_FILTERING_QUALITY_LOW},{label:"Medium",value:g.a.TEXTURE_FILTERING_QUALITY_MEDIUM},{label:"High",value:g.a.TEXTURE_FILTERING_QUALITY_HIGH}]})],t.prototype,"realTimeFilteringQuality",void 0),Object(f.c)([sn("Energy Conservation",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useEnergyConservation",void 0),Object(f.c)([sn("Radiance occlusion",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useRadianceOcclusion",void 0),Object(f.c)([sn("Horizon occlusion",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useHorizonOcclusion",void 0),Object(f.c)([sn("Unlit",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"unlit",void 0),Object(f.c)([sn("Force normal forward",$t.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceNormalForward",void 0),Object(f.c)([sn("Debug mode",$t.List,"DEBUG",{notifiers:{update:!0},options:[{label:"None",value:0},{label:"Normalized position",value:1},{label:"Normals",value:2},{label:"Tangents",value:3},{label:"Bitangents",value:4},{label:"Bump Normals",value:5},{label:"ClearCoat Normals",value:8},{label:"ClearCoat Tangents",value:9},{label:"ClearCoat Bitangents",value:10},{label:"Anisotropic Normals",value:11},{label:"Anisotropic Tangents",value:12},{label:"Anisotropic Bitangents",value:13},{label:"Env Refraction",value:40},{label:"Env Reflection",value:41},{label:"Env Clear Coat",value:42},{label:"Direct Diffuse",value:50},{label:"Direct Specular",value:51},{label:"Direct Clear Coat",value:52},{label:"Direct Sheen",value:53},{label:"Env Irradiance",value:54},{label:"Surface Albedo",value:60},{label:"Reflectance 0",value:61},{label:"Metallic",value:62},{label:"Metallic F0",value:71},{label:"Roughness",value:63},{label:"AlphaG",value:64},{label:"NdotV",value:65},{label:"ClearCoat Color",value:66},{label:"ClearCoat Roughness",value:67},{label:"ClearCoat NdotV",value:68},{label:"Transmittance",value:69},{label:"Refraction Transmittance",value:70},{label:"SEO",value:80},{label:"EHO",value:81},{label:"Energy Factor",value:82},{label:"Specular Reflectance",value:83},{label:"Clear Coat Reflectance",value:84},{label:"Sheen Reflectance",value:85},{label:"Luminance Over Alpha",value:86},{label:"Alpha",value:87}]})],t.prototype,"debugMode",void 0),Object(f.c)([sn("Split position",$t.Float,"DEBUG",{min:-1,max:1,notifiers:{update:!0}})],t.prototype,"debugLimit",void 0),Object(f.c)([sn("Output factor",$t.Float,"DEBUG",{min:0,max:5,notifiers:{update:!0}})],t.prototype,"debugFactor",void 0),t}(Et);R.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessBlock"]=BT;var UT=function(i){function t(e){var n=i.call(this,e,Me.Neutral)||this;return n.registerInput("left",_e.AutoDetect),n.registerInput("right",_e.AutoDetect),n.registerOutput("output",_e.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ModBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mod("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(Et);R.a.RegisteredTypes["BABYLON.ModBlock"]=UT;var Ew=function(){function i(){}return i.prototype.optimize=function(t,e){},i}(),Sw=c(120),xw=function(){function i(){this.mm=new Map}return i.prototype.get=function(t,e){var n=this.mm.get(t);if(n!==void 0)return n.get(e)},i.prototype.set=function(t,e,n){var r=this.mm.get(t);r===void 0&&this.mm.set(t,r=new Map),r.set(e,n)},i}(),Aw=function(){function i(t,e,n){var r=this;this._baseMaterial=t,this._scene=e,this._options=n,this._subMeshToEffect=new Map,this._subMeshToDepthEffect=new xw,this._meshes=new Map;var o=t.getClassName()==="NodeMaterial"?"u_":"";if(o){this._matriceNames={world:o+"World",view:o+"View",projection:o+"Projection",viewProjection:o+"ViewProjection",worldView:o+"WorldxView",worldViewProjection:o+"WorldxViewxProjection"};for(var l=t.getInputBlocks(),d=0;d<l.length;++d)switch(l[d]._systemValue){case Mt.World:this._matriceNames.world=l[d].associatedVariableName;break;case Mt.View:this._matriceNames.view=l[d].associatedVariableName;break;case Mt.Projection:this._matriceNames.projection=l[d].associatedVariableName;break;case Mt.ViewProjection:this._matriceNames.viewProjection=l[d].associatedVariableName;break;case Mt.WorldView:this._matriceNames.worldView=l[d].associatedVariableName;break;case Mt.WorldViewProjection:this._matriceNames.worldViewProjection=l[d].associatedVariableName}}else this._matriceNames={world:o+"world",view:o+"view",projection:o+"projection",viewProjection:o+"viewProjection",worldView:o+"worldView",worldViewProjection:o+"worldViewProjection"};this._onEffectCreatedObserver=this._baseMaterial.onEffectCreatedObservable.add(function(v){var y,D=(y=v.subMesh)===null||y===void 0?void 0:y.getMesh();D&&!r._meshes.has(D)&&r._meshes.set(D,D.onDisposeObservable.add(function(w){for(var F=r._subMeshToEffect.keys(),z=F.next();z.done!==!0;z=F.next()){var k=z.value;(k==null?void 0:k.getMesh())===w&&(r._subMeshToEffect.delete(k),r._subMeshToDepthEffect.mm.delete(k))}})),r._subMeshToEffect.set(v.subMesh,v.effect),r._subMeshToDepthEffect.mm.delete(v.subMesh)})}return Object.defineProperty(i.prototype,"standalone",{get:function(){var t,e;return(e=(t=this._options)===null||t===void 0?void 0:t.standalone)!==null&&e!==void 0&&e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseMaterial",{get:function(){return this._baseMaterial},enumerable:!1,configurable:!0}),i.prototype.getEffect=function(t,e){var n,r,o,l,d,v;return(v=(o=(r=(n=this._subMeshToDepthEffect.mm.get(t))===null||n===void 0?void 0:n.get(e))===null||r===void 0?void 0:r.depthEffect)!==null&&o!==void 0?o:(d=(l=this._subMeshToDepthEffect.mm.get(null))===null||l===void 0?void 0:l.get(e))===null||d===void 0?void 0:d.depthEffect)!==null&&v!==void 0?v:null},i.prototype.isReadyForSubMesh=function(t,e,n,r){var o,l;return this.standalone&&this._baseMaterial.isReadyForSubMesh(t.getMesh(),t,r),(l=(o=this._makeEffect(t,e,n))===null||o===void 0?void 0:o.isReady())!==null&&l!==void 0&&l},i.prototype.dispose=function(){this._baseMaterial.onEffectCreatedObservable.remove(this._onEffectCreatedObserver),this._onEffectCreatedObserver=null;for(var t=this._meshes.entries(),e=t.next();e.done!==!0;e=t.next()){var n=e.value,r=n[0],o=n[1];r.onDisposeObservable.remove(o)}},i.prototype._makeEffect=function(t,e,n){var r,o=(r=this._subMeshToEffect.get(t))!==null&&r!==void 0?r:this._subMeshToEffect.get(null);if(!o)return null;var l=this._subMeshToDepthEffect.get(t,n);l||(l={depthEffect:null,depthDefines:"",token:Sw.a.RandomId()},this._subMeshToDepthEffect.set(t,n,l));var d=e.join(`
`);if(l.depthEffect&&d===l.depthDefines)return l.depthEffect;l.depthDefines=d;var v=o.rawVertexSourceCode,y=o.rawFragmentSourceCode,D=this._options&&this._options.remappedVariables?"#include<shadowMapVertexNormalBias>("+this._options.remappedVariables.join(",")+")":Qe.a.IncludesShadersStore.shadowMapVertexNormalBias,w=this._options&&this._options.remappedVariables?"#include<shadowMapVertexMetric>("+this._options.remappedVariables.join(",")+")":Qe.a.IncludesShadersStore.shadowMapVertexMetric,F=this._options&&this._options.remappedVariables?"#include<shadowMapFragmentSoftTransparentShadow>("+this._options.remappedVariables.join(",")+")":Qe.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow,z=Qe.a.IncludesShadersStore.shadowMapFragment;v=(v=(v=(v=v.replace(/void\s+?main/g,Qe.a.IncludesShadersStore.shadowMapVertexDeclaration+`\r
void main`)).replace(/#define SHADOWDEPTH_NORMALBIAS|#define CUSTOM_VERTEX_UPDATE_WORLDPOS/g,D)).indexOf("#define SHADOWDEPTH_METRIC")!==-1?v.replace(/#define SHADOWDEPTH_METRIC/g,w):v.replace(/}\s*$/g,w+`\r
}`)).replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var k=y.indexOf("#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW")>=0||y.indexOf("#define CUSTOM_FRAGMENT_BEFORE_FOG")>=0,K=y.indexOf("#define SHADOWDEPTH_FRAGMENT")!==-1,ae="";k?y=y.replace(/#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW|#define CUSTOM_FRAGMENT_BEFORE_FOG/g,F):ae=F+`\r
`,y=y.replace(/void\s+?main/g,Qe.a.IncludesShadersStore.shadowMapFragmentDeclaration+`\r
void main`),K?y=y.replace(/#define SHADOWDEPTH_FRAGMENT/g,z):ae+=z+`\r
`,ae&&(y=y.replace(/}\s*$/g,ae+"}")),y=y.replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var le=o.getUniformNames().slice();return le.push("biasAndScaleSM","depthValuesSM","lightDataSM","softTransparentShadowSM"),l.depthEffect=this._scene.getEngine().createEffect({vertexSource:v,fragmentSource:y,vertexToken:l.token,fragmentToken:l.token},{attributes:o.getAttributesNames(),uniformsNames:le,uniformBuffersNames:o.getUniformBuffersNames(),samplers:o.getSamplers(),defines:d+`
`+o.defines.replace("#define SHADOWS","").replace(/#define SHADOW\d/g,""),indexParameters:o.getIndexParameters()},this._scene.getEngine()),l.depthEffect},i}(),VT=c(101);function Om(i,t,e,n,r){var o=new i.DecoderBuffer;o.Init(t,t.byteLength);var l,d,v=new i.Decoder;try{var y=v.GetEncodedGeometryType(o);switch(y){case i.TRIANGULAR_MESH:l=new i.Mesh,d=v.DecodeBufferToMesh(o,l);break;case i.POINT_CLOUD:l=new i.PointCloud,d=v.DecodeBufferToPointCloud(o,l);break;default:throw new Error("Invalid geometry type "+y)}if(!d.ok()||!l.ptr)throw new Error(d.error_msg());if(y===i.TRIANGULAR_MESH){var D=3*l.num_faces(),w=4*D,F=i._malloc(w);try{v.GetTrianglesUInt32Array(l,w,F);var z=new Uint32Array(D);z.set(new Uint32Array(i.HEAPF32.buffer,F,D)),n(z)}finally{i._free(F)}}var k=function(fe,me){var be=me.num_components(),Ee=l.num_points(),xe=Ee*be,Ae=xe*Float32Array.BYTES_PER_ELEMENT,Ie=i._malloc(Ae);try{v.GetAttributeDataArrayForAllPoints(l,me,i.DT_FLOAT32,Ae,Ie);var Re=new Float32Array(i.HEAPF32.buffer,Ie,xe);if(fe==="color"&&be===3){for(var Pe=new Float32Array(4*Ee),Ce=0,Ue=0;Ce<Pe.length;Ce+=4,Ue+=be)Pe[Ce+0]=Re[Ue+0],Pe[Ce+1]=Re[Ue+1],Pe[Ce+2]=Re[Ue+2],Pe[Ce+3]=1;r(fe,Pe)}else(Pe=new Float32Array(xe)).set(new Float32Array(i.HEAPF32.buffer,Ie,xe)),r(fe,Pe)}finally{i._free(Ie)}};if(e)for(var K in e){var ae=e[K];k(K,v.GetAttributeByUniqueId(l,ae))}else{var le={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var K in le)(ae=v.GetAttributeId(l,i[le[K]]))!==-1&&k(K,v.GetAttribute(l,ae))}}finally{l&&i.destroy(l),i.destroy(v),i.destroy(o)}}function Pw(){var i;onmessage=function(t){var e=t.data;switch(e.id){case"init":var n=e.decoder;n.url&&(importScripts(n.url),i=DracoDecoderModule({wasmBinary:n.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!i)throw new Error("Draco decoder module is not available");i.then(function(r){Om(r,e.dataView,e.attributes,function(o){postMessage({id:"indices",value:o},[o.buffer])},function(o,l){postMessage({id:o,value:l},[l.buffer])}),postMessage("done")})}}}function kT(i){return typeof document!="object"||typeof i!="string"?i:et.b.GetAbsoluteUrl(i)}var Cw=function(){function i(t){t===void 0&&(t=i.DefaultNumWorkers);var e=i.Configuration.decoder,n=e.wasmUrl&&e.wasmBinaryUrl&&typeof WebAssembly=="object"?{url:e.wasmUrl,wasmBinaryPromise:et.b.LoadFileAsync(kT(e.wasmBinaryUrl))}:{url:e.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};t&&typeof Worker=="function"?this._workerPoolPromise=n.wasmBinaryPromise.then(function(r){for(var o=Om+"("+Pw+")()",l=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),d=new Array(t),v=0;v<d.length;v++)d[v]=new Promise(function(y,D){var w=new Worker(l),F=function(k){w.removeEventListener("error",F),w.removeEventListener("message",z),D(k)},z=function(k){k.data==="done"&&(w.removeEventListener("error",F),w.removeEventListener("message",z),y(w))};w.addEventListener("error",F),w.addEventListener("message",z),w.postMessage({id:"init",decoder:{url:kT(n.url),wasmBinary:r}})});return Promise.all(d).then(function(y){return new Yp(y)})}):this._decoderModulePromise=n.wasmBinaryPromise.then(function(r){if(!n.url)throw new Error("Draco decoder module is not available");return et.b.LoadScriptAsync(n.url).then(function(){return o=r,new Promise(function(l){DracoDecoderModule({wasmBinary:o}).then(function(d){l({module:d})})});var o})})}return Object.defineProperty(i,"DecoderAvailable",{get:function(){var t=i.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&typeof WebAssembly=="object"||t.fallbackUrl)},enumerable:!1,configurable:!0}),i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(i,"Default",{get:function(){return i._Default||(i._Default=new i),i._Default},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(t){t.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},i.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},i.prototype.decodeMeshAsync=function(t,e){var n=t instanceof ArrayBuffer?new Uint8Array(t):t;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(r){return new Promise(function(o,l){r.push(function(d,v){var y=new Tt.a,D=function(z){d.removeEventListener("error",D),d.removeEventListener("message",w),l(z),v()},w=function(z){z.data==="done"?(d.removeEventListener("error",D),d.removeEventListener("message",w),o(y),v()):z.data.id==="indices"?y.indices=z.data.value:y.set(z.data.value,z.data.id)};d.addEventListener("error",D),d.addEventListener("message",w);var F=new Uint8Array(n.byteLength);F.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),d.postMessage({id:"decodeMesh",dataView:F,attributes:e},[F.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(r){var o=new Tt.a;return Om(r.module,n,e,function(l){o.indices=l},function(l,d){o.set(d,l)}),o});throw new Error("Draco decoder module is not available")},i.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i._Default=null,i}(),fl=c(61),jT=0,Rw=function(){function i(t,e,n,r){this.pos=t,this.normal=e,this.uv=n,this.vertColor=r}return i.prototype.clone=function(){var t,e;return new i(this.pos.clone(),this.normal.clone(),(t=this.uv)===null||t===void 0?void 0:t.clone(),(e=this.vertColor)===null||e===void 0?void 0:e.clone())},i.prototype.flip=function(){this.normal=this.normal.scale(-1)},i.prototype.interpolate=function(t,e){return new i(h.e.Lerp(this.pos,t.pos,e),h.e.Lerp(this.normal,t.normal,e),this.uv&&t.uv?h.d.Lerp(this.uv,t.uv,e):void 0,this.vertColor&&t.vertColor?C.b.Lerp(this.vertColor,t.vertColor,e):void 0)},i}(),Ow=function(){function i(t,e){this.normal=t,this.w=e}return i.FromPoints=function(t,e,n){var r=n.subtract(t),o=e.subtract(t);if(r.lengthSquared()===0||o.lengthSquared()===0)return null;var l=h.e.Normalize(h.e.Cross(r,o));return new i(l,h.e.Dot(l,t))},i.prototype.clone=function(){return new i(this.normal.clone(),this.w)},i.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},i.prototype.splitPolygon=function(t,e,n,r,o){var l,d,v=0,y=[];for(l=0;l<t.vertices.length;l++){var D=(d=h.e.Dot(this.normal,t.vertices[l].pos)-this.w)<-i.EPSILON?2:d>i.EPSILON?1:0;v|=D,y.push(D)}switch(v){case 0:(h.e.Dot(this.normal,t.plane.normal)>0?e:n).push(t);break;case 1:r.push(t);break;case 2:o.push(t);break;case 3:var w,F=[],z=[];for(l=0;l<t.vertices.length;l++){var k=(l+1)%t.vertices.length,K=y[l],ae=y[k],le=t.vertices[l],fe=t.vertices[k];if(K!==2&&F.push(le),K!==1&&z.push(K!==2?le.clone():le),(K|ae)==3){d=(this.w-h.e.Dot(this.normal,le.pos))/h.e.Dot(this.normal,fe.pos.subtract(le.pos));var me=le.interpolate(fe,d);F.push(me),z.push(me.clone())}}F.length>=3&&(w=new Mm(F,t.shared)).plane&&r.push(w),z.length>=3&&(w=new Mm(z,t.shared)).plane&&o.push(w)}},i.EPSILON=1e-5,i}(),Mm=function(){function i(t,e){this.vertices=t,this.shared=e,this.plane=Ow.FromPoints(t[0].pos,t[1].pos,t[2].pos)}return i.prototype.clone=function(){return new i(this.vertices.map(function(t){return t.clone()}),this.shared)},i.prototype.flip=function(){this.vertices.reverse().map(function(t){t.flip()}),this.plane.flip()},i}(),hi=function(){function i(t){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,t&&this.build(t)}return i.prototype.clone=function(){var t=new i;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},i.prototype.invert=function(){for(var t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var e=this.front;this.front=this.back,this.back=e},i.prototype.clipPolygons=function(t){if(!this.plane)return t.slice();for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],e,n,e,n);return this.front&&(e=this.front.clipPolygons(e)),n=this.back?this.back.clipPolygons(n):[],e.concat(n)},i.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},i.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},i.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,e,n);e.length&&(this.front||(this.front=new i),this.front.build(e)),n.length&&(this.back||(this.back=new i),this.back.build(n))}},i}(),Mw=function(){function i(){this.polygons=new Array}return i.FromMesh=function(t){var e,n,r,o,l,d,v,y,D,w=void 0,F=void 0,z=new Array,k=null;if(!(t instanceof Fe.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),d=t.getWorldMatrix(),v=t.position.clone(),y=t.rotation.clone(),t.rotationQuaternion&&(k=t.rotationQuaternion.clone()),D=t.scaling.clone();for(var K=t.getIndices(),ae=t.getVerticesData(De.b.PositionKind),le=t.getVerticesData(De.b.NormalKind),fe=t.getVerticesData(De.b.UVKind),me=t.getVerticesData(De.b.ColorKind),be=t.subMeshes,Ee=0,xe=be.length;Ee<xe;Ee++)for(var Ae=be[Ee].indexStart,Ie=be[Ee].indexCount+be[Ee].indexStart;Ae<Ie;Ae+=3){l=[];for(var Re=0;Re<3;Re++){var Pe=new h.e(le[3*K[Ae+Re]],le[3*K[Ae+Re]+1],le[3*K[Ae+Re]+2]);fe&&(w=new h.d(fe[2*K[Ae+Re]],fe[2*K[Ae+Re]+1])),me&&(F=new C.b(me[4*K[Ae+Re]],me[4*K[Ae+Re]+1],me[4*K[Ae+Re]+2],me[4*K[Ae+Re]+3]));var Ce=new h.e(ae[3*K[Ae+Re]],ae[3*K[Ae+Re]+1],ae[3*K[Ae+Re]+2]);r=h.e.TransformCoordinates(Ce,d),n=h.e.TransformNormal(Pe,d),e=new Rw(r,n,w,F),l.push(e)}(o=new Mm(l,{subMeshId:Ee,meshId:jT,materialIndex:be[Ee].materialIndex})).plane&&z.push(o)}var Ue=i.FromPolygons(z);return Ue.matrix=d,Ue.position=v,Ue.rotation=y,Ue.scaling=D,Ue.rotationQuaternion=k,jT++,Ue},i.FromPolygons=function(t){var e=new i;return e.polygons=t,e},i.prototype.clone=function(){var t=new i;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},i.prototype.union=function(t){var e=new hi(this.clone().polygons),n=new hi(t.clone().polygons);return e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.unionInPlace=function(t){var e=new hi(this.polygons),n=new hi(t.polygons);e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),this.polygons=e.allPolygons()},i.prototype.subtract=function(t){var e=new hi(this.clone().polygons),n=new hi(t.clone().polygons);return e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.subtractInPlace=function(t){var e=new hi(this.polygons),n=new hi(t.polygons);e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.intersect=function(t){var e=new hi(this.clone().polygons),n=new hi(t.clone().polygons);return e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.intersectInPlace=function(t){var e=new hi(this.polygons),n=new hi(t.polygons);e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.inverse=function(){var t=this.clone();return t.inverseInPlace(),t},i.prototype.inverseInPlace=function(){this.polygons.map(function(t){t.flip()})},i.prototype.copyTransformAttributes=function(t){return this.matrix=t.matrix,this.position=t.position,this.rotation=t.rotation,this.scaling=t.scaling,this.rotationQuaternion=t.rotationQuaternion,this},i.prototype.buildMeshGeometry=function(t,e,n){var r=this.matrix.clone();r.invert();var o,l,d,v=new Fe.a(t,e),y=[],D=[],w=[],F=null,z=null,k=h.e.Zero(),K=h.e.Zero(),ae=h.d.Zero(),le=new C.b(0,0,0,0),fe=this.polygons,me=[0,0,0],be={},Ee=0,xe={};n&&fe.sort(function(vt,rt){return vt.shared.meshId===rt.shared.meshId?vt.shared.subMeshId-rt.shared.subMeshId:vt.shared.meshId-rt.shared.meshId});for(var Ae=0,Ie=fe.length;Ae<Ie;Ae++){xe[(o=fe[Ae]).shared.meshId]||(xe[o.shared.meshId]={}),xe[o.shared.meshId][o.shared.subMeshId]||(xe[o.shared.meshId][o.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:o.shared.materialIndex}),d=xe[o.shared.meshId][o.shared.subMeshId];for(var Re=2,Pe=o.vertices.length;Re<Pe;Re++){me[0]=0,me[1]=Re-1,me[2]=Re;for(var Ce=0;Ce<3;Ce++){k.copyFrom(o.vertices[me[Ce]].pos),K.copyFrom(o.vertices[me[Ce]].normal),o.vertices[me[Ce]].uv&&(F||(F=[]),ae.copyFrom(o.vertices[me[Ce]].uv)),o.vertices[me[Ce]].vertColor&&(z||(z=[]),le.copyFrom(o.vertices[me[Ce]].vertColor));var Ue=h.e.TransformCoordinates(k,r),Oe=h.e.TransformNormal(K,r);l=be[Ue.x+","+Ue.y+","+Ue.z];var Ve=!1;F&&F[2*l]!==ae.x&&F[2*l+1]!==ae.y&&(Ve=!0);var Le=!1;z&&z[4*l]!==le.r&&z[4*l+1]!==le.g&&z[4*l+2]!==le.b&&z[4*l+3]!==le.a&&(Le=!0),(l===void 0||w[3*l]!==Oe.x||w[3*l+1]!==Oe.y||w[3*l+2]!==Oe.z||Ve||Le)&&(y.push(Ue.x,Ue.y,Ue.z),F&&F.push(ae.x,ae.y),w.push(K.x,K.y,K.z),z&&z.push(le.r,le.g,le.b,le.a),l=be[Ue.x+","+Ue.y+","+Ue.z]=y.length/3-1),D.push(l),d.indexStart=Math.min(Ee,d.indexStart),d.indexEnd=Math.max(Ee,d.indexEnd),Ee++}}}if(v.setVerticesData(De.b.PositionKind,y),v.setVerticesData(De.b.NormalKind,w),F&&v.setVerticesData(De.b.UVKind,F),z&&v.setVerticesData(De.b.ColorKind,z),v.setIndices(D,null),n){var ze,tt=0;for(var ut in v.subMeshes=new Array,xe){for(var ft in ze=-1,xe[ut])d=xe[ut][ft],fl.a.CreateFromIndices(d.materialIndex+tt,d.indexStart,d.indexEnd-d.indexStart+1,v),ze=Math.max(d.materialIndex,ze);tt+=++ze}}return v},i.prototype.toMesh=function(t,e,n,r){e===void 0&&(e=null);var o=this.buildMeshGeometry(t,n,r);return o.material=e,o.position.copyFrom(this.position),o.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(o.rotationQuaternion=this.rotationQuaternion.clone()),o.scaling.copyFrom(this.scaling),o.computeWorldMatrix(!0),o},i}(),Iw=function(i){function t(e,n,r,o,l,d){o===void 0&&(o=1),l===void 0&&(l=60),d===void 0&&(d=!0);var v=i.call(this,e,r)||this;v._sectionPolygonPointsCount=4,v._running=!1,v._autoStart=d,v._generator=n,v._diameter=o,v._length=l,v._sectionVectors=[],v._sectionNormalVectors=[];for(var y=0;y<v._sectionPolygonPointsCount;y++)v._sectionVectors[y]=h.e.Zero(),v._sectionNormalVectors[y]=h.e.Zero();return v._createMesh(),v}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new Tt.a,n=[],r=[],o=[],l=h.e.Zero();l=this._generator instanceof jt.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var d=2*Math.PI/this._sectionPolygonPointsCount,v=0;v<this._sectionPolygonPointsCount;v++)n.push(l.x+Math.cos(v*d)*this._diameter,l.y+Math.sin(v*d)*this._diameter,l.z);for(v=1;v<=this._length;v++){for(var y=0;y<this._sectionPolygonPointsCount;y++)n.push(l.x+Math.cos(y*d)*this._diameter,l.y+Math.sin(y*d)*this._diameter,l.z);var D=n.length/3-2*this._sectionPolygonPointsCount;for(y=0;y<this._sectionPolygonPointsCount-1;y++)o.push(D+y,D+y+this._sectionPolygonPointsCount,D+y+this._sectionPolygonPointsCount+1),o.push(D+y,D+y+this._sectionPolygonPointsCount+1,D+y+1);o.push(D+this._sectionPolygonPointsCount-1,D+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,D+this._sectionPolygonPointsCount),o.push(D+this._sectionPolygonPointsCount-1,D+this._sectionPolygonPointsCount,D)}Tt.a.ComputeNormals(n,o,r),e.positions=n,e.normals=r,e.indices=o,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(De.b.PositionKind),n=this.getVerticesData(De.b.NormalKind),r=this._generator.getWorldMatrix();if(e&&n){for(var o=3*this._sectionPolygonPointsCount;o<e.length;o++)e[o-3*this._sectionPolygonPointsCount]=e[o]-n[o]/this._length*this._diameter;for(o=3*this._sectionPolygonPointsCount;o<n.length;o++)n[o-3*this._sectionPolygonPointsCount]=n[o];var l=e.length-3*this._sectionPolygonPointsCount,d=2*Math.PI/this._sectionPolygonPointsCount;for(o=0;o<this._sectionPolygonPointsCount;o++)this._sectionVectors[o].copyFromFloats(Math.cos(o*d)*this._diameter,Math.sin(o*d)*this._diameter,0),this._sectionNormalVectors[o].copyFromFloats(Math.cos(o*d),Math.sin(o*d),0),h.e.TransformCoordinatesToRef(this._sectionVectors[o],r,this._sectionVectors[o]),h.e.TransformNormalToRef(this._sectionNormalVectors[o],r,this._sectionNormalVectors[o]);for(o=0;o<this._sectionPolygonPointsCount;o++)e[l+3*o]=this._sectionVectors[o].x,e[l+3*o+1]=this._sectionVectors[o].y,e[l+3*o+2]=this._sectionVectors[o].z,n[l+3*o]=this._sectionNormalVectors[o].x,n[l+3*o+1]=this._sectionNormalVectors[o].y,n[l+3*o+2]=this._sectionNormalVectors[o].z;this.updateVerticesData(De.b.PositionKind,e,!0,!1),this.updateVerticesData(De.b.NormalKind,n,!0,!1)}},t.prototype.clone=function(e,n){return e===void 0&&(e=""),new t(e,n===void 0?this._generator:n,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e)},t.Parse=function(e,n){return new t(e.name,e._generator,n,e._diameter,e._length,e._autoStart)},t}(Fe.a),Dw=c(151),pl=c(98),ml=c(82);Tt.a.CreateDisc=function(i){var t=new Array,e=new Array,n=new Array,r=new Array,o=i.radius||.5,l=i.tessellation||64,d=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,v=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);for(var y=2*Math.PI*d,D=d===1?y/l:y/(l-1),w=0,F=0;F<l;F++){var z=Math.cos(w),k=Math.sin(w),K=(z+1)/2,ae=(1-k)/2;t.push(o*z,o*k,0),r.push(K,ae),w+=D}d===1&&(t.push(t[3],t[4],t[5]),r.push(r[2],r[3]));for(var le=t.length/3,fe=1;fe<le-1;fe++)e.push(fe+1,0,fe);Tt.a.ComputeNormals(t,e,n),Tt.a._ComputeSides(v,t,e,n,r,i.frontUVs,i.backUVs);var me=new Tt.a;return me.indices=e,me.positions=t,me.normals=n,me.uvs=r,me},Fe.a.CreateDisc=function(i,t,e,n,r,o){n===void 0&&(n=null);var l={radius:t,tessellation:e,sideOrientation:o,updatable:r};return Mh.CreateDisc(i,l,n)};var Mh=function(){function i(){}return i.CreateDisc=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateDisc(e).applyToMesh(r,e.updatable),r},i}();Tt.a.CreateTiledBox=function(i){for(var t=i.faceUV||new Array(6),e=i.faceColors,n=i.pattern||Fe.a.NO_FLIP,r=i.width||i.size||1,o=i.height||i.size||1,l=i.depth||i.size||1,d=i.tileWidth||i.tileSize||1,v=i.tileHeight||i.tileSize||1,y=i.alignHorizontal||0,D=i.alignVertical||0,w=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,F=0;F<6;F++)t[F]===void 0&&(t[F]=new h.f(0,0,1,1)),e&&e[F]===void 0&&(e[F]=new C.b(1,1,1,1));var z=r/2,k=o/2,K=l/2,ae=[];for(F=0;F<2;F++)ae[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:d,tileHeight:v,width:r,height:o,alignVertical:D,alignHorizontal:y,sideOrientation:w});for(F=2;F<4;F++)ae[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:d,tileHeight:v,width:l,height:o,alignVertical:D,alignHorizontal:y,sideOrientation:w});var le=D;for(D===Fe.a.BOTTOM?le=Fe.a.TOP:D===Fe.a.TOP&&(le=Fe.a.BOTTOM),F=4;F<6;F++)ae[F]=Tt.a.CreateTiledPlane({pattern:n,tileWidth:d,tileHeight:v,width:r,height:l,alignVertical:le,alignHorizontal:y,sideOrientation:w});var fe=[],me=[],be=[],Ee=[],xe=[],Ae=[],Ie=[],Re=[],Pe=0,Ce=0,Ue=0;for(F=0;F<6;F++){Pe=ae[F].positions.length,Ae[F]=[],Ie[F]=[];for(var Oe=0;Oe<Pe/3;Oe++)Ae[F].push(new h.e(ae[F].positions[3*Oe],ae[F].positions[3*Oe+1],ae[F].positions[3*Oe+2])),Ie[F].push(new h.e(ae[F].normals[3*Oe],ae[F].normals[3*Oe+1],ae[F].normals[3*Oe+2]));Ce=ae[F].uvs.length,Re[F]=[];for(var Ve=0;Ve<Ce;Ve+=2)Re[F][Ve]=t[F].x+(t[F].z-t[F].x)*ae[F].uvs[Ve],Re[F][Ve+1]=t[F].y+(t[F].w-t[F].y)*ae[F].uvs[Ve+1];if(be=be.concat(Re[F]),Ee=Ee.concat(ae[F].indices.map(function(We){return We+Ue})),Ue+=Ae[F].length,e)for(var Le=0;Le<4;Le++)xe.push(e[F].r,e[F].g,e[F].b,e[F].a)}var ze=new h.e(0,0,K),tt=h.a.RotationY(Math.PI);fe=Ae[0].map(function(We){return h.e.TransformNormal(We,tt).add(ze)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]),me=Ie[0].map(function(We){return h.e.TransformNormal(We,tt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]),fe=fe.concat(Ae[1].map(function(We){return We.subtract(ze)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),me=me.concat(Ie[1].map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]));var ut=new h.e(z,0,0),ft=h.a.RotationY(-Math.PI/2);fe=fe.concat(Ae[2].map(function(We){return h.e.TransformNormal(We,ft).add(ut)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),me=me.concat(Ie[2].map(function(We){return h.e.TransformNormal(We,ft)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]));var vt=h.a.RotationY(Math.PI/2);fe=fe.concat(Ae[3].map(function(We){return h.e.TransformNormal(We,vt).subtract(ut)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),me=me.concat(Ie[3].map(function(We){return h.e.TransformNormal(We,vt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]));var rt=new h.e(0,k,0),mt=h.a.RotationX(Math.PI/2);fe=fe.concat(Ae[4].map(function(We){return h.e.TransformNormal(We,mt).add(rt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),me=me.concat(Ie[4].map(function(We){return h.e.TransformNormal(We,mt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[]));var pt=h.a.RotationX(-Math.PI/2);fe=fe.concat(Ae[5].map(function(We){return h.e.TransformNormal(We,pt).subtract(rt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),me=me.concat(Ie[5].map(function(We){return h.e.TransformNormal(We,pt)}).map(function(We){return[We.x,We.y,We.z]}).reduce(function(We,at){return We.concat(at)},[])),Tt.a._ComputeSides(w,fe,Ee,me,be);var it=new Tt.a;if(it.indices=Ee,it.positions=fe,it.normals=me,it.uvs=be,e){var yt=w===Tt.a.DOUBLESIDE?xe.concat(xe):xe;it.colors=yt}return it};var zT=function(){function i(){}return i.CreateTiledBox=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTiledBox(e).applyToMesh(r,e.updatable),r},i}();Tt.a.CreateTorusKnot=function(i){var t,e,n=new Array,r=new Array,o=new Array,l=new Array,d=i.radius||2,v=i.tube||.5,y=i.radialSegments||32,D=i.tubularSegments||32,w=i.p||2,F=i.q||3,z=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE,k=function(Ve){var Le=Math.cos(Ve),ze=Math.sin(Ve),tt=F/w*Ve,ut=Math.cos(tt),ft=d*(2+ut)*.5*Le,vt=d*(2+ut)*ze*.5,rt=d*Math.sin(tt)*.5;return new h.e(ft,vt,rt)};for(t=0;t<=y;t++){var K=t%y/y*2*w*Math.PI,ae=k(K),le=k(K+.01),fe=le.subtract(ae),me=le.add(ae),be=h.e.Cross(fe,me);for(me=h.e.Cross(be,fe),be.normalize(),me.normalize(),e=0;e<D;e++){var Ee=e%D/D*2*Math.PI,xe=-v*Math.cos(Ee),Ae=v*Math.sin(Ee);r.push(ae.x+xe*me.x+Ae*be.x),r.push(ae.y+xe*me.y+Ae*be.y),r.push(ae.z+xe*me.z+Ae*be.z),l.push(t/y),l.push(e/D)}}for(t=0;t<y;t++)for(e=0;e<D;e++){var Ie=(e+1)%D,Re=t*D+e,Pe=(t+1)*D+e,Ce=(t+1)*D+Ie,Ue=t*D+Ie;n.push(Ue),n.push(Pe),n.push(Re),n.push(Ue),n.push(Ce),n.push(Pe)}Tt.a.ComputeNormals(r,n,o),Tt.a._ComputeSides(z,r,n,o,l,i.frontUVs,i.backUVs);var Oe=new Tt.a;return Oe.indices=n,Oe.positions=r,Oe.normals=o,Oe.uvs=l,Oe},Fe.a.CreateTorusKnot=function(i,t,e,n,r,o,l,d,v,y){var D={radius:t,tube:e,radialSegments:n,tubularSegments:r,p:o,q:l,sideOrientation:y,updatable:v};return Im.CreateTorusKnot(i,D,d)};var Im=function(){function i(){}return i.CreateTorusKnot=function(t,e,n){var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTorusKnot(e).applyToMesh(r,e.updatable),r},i}(),ww=function(i){function t(e,n){var r=i.call(this,e.x,e.y)||this;return r.index=n,r}return Object(f.d)(t,i),t}(h.d),Dm=function(){function i(){this.elements=new Array}return i.prototype.add=function(t){var e=this,n=new Array;return t.forEach(function(r){var o=new ww(r,e.elements.length);n.push(o),e.elements.push(o)}),n},i.prototype.computeBounds=function(){var t=new h.d(this.elements[0].x,this.elements[0].y),e=new h.d(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<t.x?t.x=n.x:n.x>e.x&&(e.x=n.x),n.y<t.y?t.y=n.y:n.y>e.y&&(e.y=n.y)}),{min:t,max:e,width:e.x-t.x,height:e.y-t.y}},i}(),Lw=function(){function i(){}return i.Rectangle=function(t,e,n,r){return[new h.d(t,e),new h.d(n,e),new h.d(n,r),new h.d(t,r)]},i.Circle=function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=32);for(var o=new Array,l=0,d=2*Math.PI/r,v=0;v<r;v++)o.push(new h.d(e+Math.cos(l)*t,n+Math.sin(l)*t)),l-=d;return o},i.Parse=function(t){var e,n=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(o){return!isNaN(o)}),r=[];for(e=0;e<(2147483646&n.length);e+=2)r.push(new h.d(n[e],n[e+1]));return r},i.StartingAt=function(t,e){return nt.f.StartingAt(t,e)},i}(),GT=function(){function i(t,e,n,r){var o;r===void 0&&(r=earcut),this._points=new Dm,this._outlinepoints=new Dm,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=t,this._scene=n||He.a.LastCreatedScene,o=e instanceof nt.f?e.getPoints():e,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),this.bjsEarcut===void 0&&_.a.Warn("Earcut was not found, the polygon will not be built.")}return i.prototype._addToepoint=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this._epoints.push(r.x,r.y)}},i.prototype.addHole=function(t){this._points.add(t);var e=new Dm;return e.add(t),this._holes.push(e),this._eholes.push(this._epoints.length/2),this._addToepoint(t),this},i.prototype.build=function(t,e){t===void 0&&(t=!1),e===void 0&&(e=0);var n=new Fe.a(this._name,this._scene),r=this.buildVertexData(e);return n.setVerticesData(De.b.PositionKind,r.positions,t),n.setVerticesData(De.b.NormalKind,r.normals,t),n.setVerticesData(De.b.UVKind,r.uvs,t),n.setIndices(r.indices),n},i.prototype.buildVertexData=function(t){var e=this;t===void 0&&(t=0);var n=new Tt.a,r=new Array,o=new Array,l=new Array,d=this._points.computeBounds();this._points.elements.forEach(function(ae){r.push(0,1,0),o.push(ae.x,0,ae.y),l.push((ae.x-d.min.x)/d.width,(ae.y-d.min.y)/d.height)});for(var v=new Array,y=this.bjsEarcut(this._epoints,this._eholes,2),D=0;D<y.length;D++)v.push(y[D]);if(t>0){var w=o.length/3;this._points.elements.forEach(function(ae){r.push(0,-1,0),o.push(ae.x,-t,ae.y),l.push(1-(ae.x-d.min.x)/d.width,1-(ae.y-d.min.y)/d.height)});var F=v.length;for(D=0;D<F;D+=3){var z=v[D+0],k=v[D+1],K=v[D+2];v.push(K+w),v.push(k+w),v.push(z+w)}this.addSide(o,r,l,v,d,this._outlinepoints,t,!1),this._holes.forEach(function(ae){e.addSide(o,r,l,v,d,ae,t,!0)})}return n.indices=v,n.positions=o,n.normals=r,n.uvs=l,n},i.prototype.addSide=function(t,e,n,r,o,l,d,v){for(var y=t.length/3,D=0,w=0;w<l.elements.length;w++){var F,z=l.elements[w];F=w+1>l.elements.length-1?l.elements[0]:l.elements[w+1],t.push(z.x,0,z.y),t.push(z.x,-d,z.y),t.push(F.x,0,F.y),t.push(F.x,-d,F.y);var k=new h.e(z.x,0,z.y),K=new h.e(F.x,0,F.y).subtract(k),ae=new h.e(0,1,0),le=h.e.Cross(K,ae);le=le.normalize(),n.push(D/o.width,0),n.push(D/o.width,1),D+=K.length(),n.push(D/o.width,0),n.push(D/o.width,1),v?(e.push(le.x,le.y,le.z),e.push(le.x,le.y,le.z),e.push(le.x,le.y,le.z),e.push(le.x,le.y,le.z),r.push(y),r.push(y+2),r.push(y+1),r.push(y+1),r.push(y+2),r.push(y+3)):(e.push(-le.x,-le.y,-le.z),e.push(-le.x,-le.y,-le.z),e.push(-le.x,-le.y,-le.z),e.push(-le.x,-le.y,-le.z),r.push(y),r.push(y+1),r.push(y+2),r.push(y+1),r.push(y+3),r.push(y+2)),y+=4}},i}();Tt.a.CreatePolygon=function(i,t,e,n,r,o,l){for(var d=e||new Array(3),v=n,y=[],D=l||!1,w=0;w<3;w++)d[w]===void 0&&(d[w]=new h.f(0,0,1,1)),v&&v[w]===void 0&&(v[w]=new C.b(1,1,1,1));var F=i.getVerticesData(De.b.PositionKind),z=i.getVerticesData(De.b.NormalKind),k=i.getVerticesData(De.b.UVKind),K=i.getIndices(),ae=F.length/9,le=0,fe=0,me=0,be=0,Ee=[0];if(D)for(var xe=ae;xe<F.length/3;xe+=4)fe=F[3*(xe+2)]-F[3*xe],me=F[3*(xe+2)+2]-F[3*xe+2],be+=Math.sqrt(fe*fe+me*me),Ee.push(be);xe=0;for(var Ae=0,Ie=0;Ie<z.length;Ie+=3)Math.abs(z[Ie+1])<.001&&(Ae=1),Math.abs(z[Ie+1]-1)<.001&&(Ae=0),Math.abs(z[Ie+1]+1)<.001&&(Ae=2),xe=Ie/3,Ae===1?(le=xe-ae,k[2*xe]=le%4<1.5?D?d[Ae].x+(d[Ae].z-d[Ae].x)*Ee[Math.floor(le/4)]/be:d[Ae].x:D?d[Ae].x+(d[Ae].z-d[Ae].x)*Ee[Math.floor(le/4)+1]/be:d[Ae].z,k[2*xe+1]=le%2==0?d[Ae].w:d[Ae].y):(k[2*xe]=(1-k[2*xe])*d[Ae].x+k[2*xe]*d[Ae].z,k[2*xe+1]=(1-k[2*xe+1])*d[Ae].y+k[2*xe+1]*d[Ae].w),v&&y.push(v[Ae].r,v[Ae].g,v[Ae].b,v[Ae].a);Tt.a._ComputeSides(t,F,K,z,k,r,o);var Re=new Tt.a;if(Re.indices=K,Re.positions=F,Re.normals=z,Re.uvs=k,v){var Pe=t===Tt.a.DOUBLESIDE?y.concat(y):y;Re.colors=Pe}return Re},Fe.a.CreatePolygon=function(i,t,e,n,r,o,l){l===void 0&&(l=earcut);var d={shape:t,holes:n,updatable:r,sideOrientation:o};return _l.CreatePolygon(i,d,e,l)},Fe.a.ExtrudePolygon=function(i,t,e,n,r,o,l,d){d===void 0&&(d=earcut);var v={shape:t,holes:r,depth:e,updatable:o,sideOrientation:l};return _l.ExtrudePolygon(i,v,n,d)};var _l=function(){function i(){}return i.CreatePolygon=function(t,e,n,r){n===void 0&&(n=null),r===void 0&&(r=earcut),e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation);for(var o=e.shape,l=e.holes||[],d=e.depth||0,v=[],y=[],D=0;D<o.length;D++)v[D]=new h.d(o[D].x,o[D].z);v[0].equalsWithEpsilon(v[v.length-1],1e-8)&&v.pop();for(var w=new GT(t,v,n||re.a.LastCreatedScene,r),F=0;F<l.length;F++){y=[];for(var z=0;z<l[F].length;z++)y.push(new h.d(l[F][z].x,l[F][z].z));w.addHole(y)}var k=w.build(e.updatable,d);return k._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreatePolygon(k,e.sideOrientation,e.faceUV,e.faceColors,e.frontUVs,e.backUVs,e.wrap).applyToMesh(k,e.updatable),k},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),i.CreatePolygon(t,e,n,r)},i}();Fe.a.CreateLathe=function(i,t,e,n,r,o,l){var d={shape:t,radius:e,tessellation:n,sideOrientation:l,updatable:o};return wm.CreateLathe(i,d,r)};var wm=function(){function i(){}return i.CreateLathe=function(t,e,n){n===void 0&&(n=null);var r,o=e.arc?e.arc<=0||e.arc>1?1:e.arc:1,l=e.closed===void 0||e.closed,d=e.shape,v=e.radius||1,y=e.tessellation||64,D=e.clip||0,w=e.updatable,F=Fe.a._GetDefaultSideOrientation(e.sideOrientation),z=e.cap||Fe.a.NO_CAP,k=2*Math.PI,K=new Array,ae=e.invertUV||!1,le=0,fe=0,me=k/y*o,be=new Array;for(le=0;le<=y-D;le++){for(be=[],z!=Fe.a.CAP_START&&z!=Fe.a.CAP_ALL||(be.push(new h.e(0,d[0].y,0)),be.push(new h.e(Math.cos(le*me)*d[0].x*v,d[0].y,Math.sin(le*me)*d[0].x*v))),fe=0;fe<d.length;fe++)r=new h.e(Math.cos(le*me)*d[fe].x*v,d[fe].y,Math.sin(le*me)*d[fe].x*v),be.push(r);z!=Fe.a.CAP_END&&z!=Fe.a.CAP_ALL||(be.push(new h.e(Math.cos(le*me)*d[d.length-1].x*v,d[d.length-1].y,Math.sin(le*me)*d[d.length-1].x*v)),be.push(new h.e(0,d[d.length-1].y,0))),K.push(be)}return ml.a.CreateRibbon(t,{pathArray:K,closeArray:l,sideOrientation:F,updatable:w,invertUV:ae,frontUVs:e.frontUVs,backUVs:e.backUVs},n)},i}();Tt.a.CreateTiledPlane=function(i){var t=i.pattern||Fe.a.NO_FLIP,e=i.tileWidth||i.tileSize||1,n=i.tileHeight||i.tileSize||1,r=i.alignHorizontal||0,o=i.alignVertical||0,l=i.width||i.size||1,d=Math.floor(l/e),v=l-d*e,y=i.height||i.size||1,D=Math.floor(y/n),w=y-D*n,F=e*d/2,z=n*D/2,k=0,K=0,ae=0,le=0,fe=0,me=0;if(v>0||w>0){switch(ae=-F,le=-z,fe=F,me=z,r){case Fe.a.CENTER:ae-=v/=2,fe+=v;break;case Fe.a.LEFT:fe+=v,k=-v/2;break;case Fe.a.RIGHT:ae-=v,k=v/2}switch(o){case Fe.a.CENTER:le-=w/=2,me+=w;break;case Fe.a.BOTTOM:me+=w,K=-w/2;break;case Fe.a.TOP:le-=w,K=w/2}}var be=[],Ee=[],xe=[];xe[0]=[0,0,1,0,1,1,0,1],xe[1]=[0,0,1,0,1,1,0,1],t!==Fe.a.ROTATE_TILE&&t!==Fe.a.ROTATE_ROW||(xe[1]=[1,1,0,1,0,0,1,0]),t!==Fe.a.FLIP_TILE&&t!==Fe.a.FLIP_ROW||(xe[1]=[1,0,0,0,0,1,1,1]),t!==Fe.a.FLIP_N_ROTATE_TILE&&t!==Fe.a.FLIP_N_ROTATE_ROW||(xe[1]=[0,1,1,1,1,0,0,0]);for(var Ae=[],Ie=[],Re=[],Pe=0,Ce=0;Ce<D;Ce++)for(var Ue=0;Ue<d;Ue++)be.push(Ue*e-F+k,Ce*n-z+K,0),be.push((Ue+1)*e-F+k,Ce*n-z+K,0),be.push((Ue+1)*e-F+k,(Ce+1)*n-z+K,0),be.push(Ue*e-F+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Ae=t===Fe.a.FLIP_TILE||t===Fe.a.ROTATE_TILE||t===Fe.a.FLIP_N_ROTATE_TILE?Ae.concat(xe[(Ue%2+Ce%2)%2]):t===Fe.a.FLIP_ROW||t===Fe.a.ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_ROW?Ae.concat(xe[Ce%2]):Ae.concat(xe[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Pe+=4;if(v>0||w>0){var Oe,Ve,Le,ze,tt=w>0&&(o===Fe.a.CENTER||o===Fe.a.TOP),ut=w>0&&(o===Fe.a.CENTER||o===Fe.a.BOTTOM),ft=v>0&&(r===Fe.a.CENTER||r===Fe.a.RIGHT),vt=v>0&&(r===Fe.a.CENTER||r===Fe.a.LEFT),rt=[];if(tt&&ft&&(be.push(ae+k,le+K,0),be.push(-F+k,le+K,0),be.push(-F+k,le+w+K,0),be.push(ae+k,le+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=1-v/e,Ve=1-w/n,Le=1,Ve,Le,ze=1,Oe,ze],t===Fe.a.ROTATE_ROW&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),t===Fe.a.FLIP_ROW&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),t===Fe.a.FLIP_N_ROTATE_ROW&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),tt&&vt&&(be.push(F+k,le+K,0),be.push(fe+k,le+K,0),be.push(fe+k,le+w+K,0),be.push(F+k,le+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=0,Ve=1-w/n,Le=v/e,Ve,Le,ze=1,Oe,ze],(t===Fe.a.ROTATE_ROW||t===Fe.a.ROTATE_TILE&&d%2==0)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),(t===Fe.a.FLIP_ROW||t===Fe.a.FLIP_TILE&&d%2==0)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),(t===Fe.a.FLIP_N_ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_TILE&&d%2==0)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),ut&&ft&&(be.push(ae+k,z+K,0),be.push(-F+k,z+K,0),be.push(-F+k,me+K,0),be.push(ae+k,me+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=1-v/e,Ve=0,Le=1,Ve,Le,ze=w/n,Oe,ze],(t===Fe.a.ROTATE_ROW&&D%2==1||t===Fe.a.ROTATE_TILE&&D%1==0)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),(t===Fe.a.FLIP_ROW&&D%2==1||t===Fe.a.FLIP_TILE&&D%2==0)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),(t===Fe.a.FLIP_N_ROTATE_ROW&&D%2==1||t===Fe.a.FLIP_N_ROTATE_TILE&&D%2==0)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),ut&&vt&&(be.push(F+k,z+K,0),be.push(fe+k,z+K,0),be.push(fe+k,me+K,0),be.push(F+k,me+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,rt=[Oe=0,Ve=0,Le=v/e,Ve,Le,ze=w/n,Oe,ze],(t===Fe.a.ROTATE_ROW&&D%2==1||t===Fe.a.ROTATE_TILE&&(D+d)%2==1)&&(rt=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),(t===Fe.a.FLIP_ROW&&D%2==1||t===Fe.a.FLIP_TILE&&(D+d)%2==1)&&(rt=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),(t===Fe.a.FLIP_N_ROTATE_ROW&&D%2==1||t===Fe.a.FLIP_N_ROTATE_TILE&&(D+d)%2==1)&&(rt=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ae=Ae.concat(rt),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),tt){var mt=[];for(Oe=0,Ve=1-w/n,Le=1,ze=1,mt[0]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],mt[1]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],t!==Fe.a.ROTATE_TILE&&t!==Fe.a.ROTATE_ROW||(mt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),t!==Fe.a.FLIP_TILE&&t!==Fe.a.FLIP_ROW||(mt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),t!==Fe.a.FLIP_N_ROTATE_TILE&&t!==Fe.a.FLIP_N_ROTATE_ROW||(mt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ue=0;Ue<d;Ue++)be.push(Ue*e-F+k,le+K,0),be.push((Ue+1)*e-F+k,le+K,0),be.push((Ue+1)*e-F+k,le+w+K,0),be.push(Ue*e-F+k,le+w+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Fe.a.FLIP_TILE||t===Fe.a.ROTATE_TILE||t===Fe.a.FLIP_N_ROTATE_TILE?Ae.concat(mt[(Ue+1)%2]):t===Fe.a.FLIP_ROW||t===Fe.a.ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_ROW?Ae.concat(mt[1]):Ae.concat(mt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(ut){var pt=[];for(Oe=0,Ve=0,Le=1,ze=w/n,pt[0]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],pt[1]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],t!==Fe.a.ROTATE_TILE&&t!==Fe.a.ROTATE_ROW||(pt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),t!==Fe.a.FLIP_TILE&&t!==Fe.a.FLIP_ROW||(pt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),t!==Fe.a.FLIP_N_ROTATE_TILE&&t!==Fe.a.FLIP_N_ROTATE_ROW||(pt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ue=0;Ue<d;Ue++)be.push(Ue*e-F+k,me-w+K,0),be.push((Ue+1)*e-F+k,me-w+K,0),be.push((Ue+1)*e-F+k,me+K,0),be.push(Ue*e-F+k,me+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Fe.a.FLIP_TILE||t===Fe.a.ROTATE_TILE||t===Fe.a.FLIP_N_ROTATE_TILE?Ae.concat(pt[(Ue+D)%2]):t===Fe.a.FLIP_ROW||t===Fe.a.ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_ROW?Ae.concat(pt[D%2]):Ae.concat(pt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(ft){var it=[];for(Oe=1-v/e,Ve=0,Le=1,ze=1,it[0]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],it[1]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],t!==Fe.a.ROTATE_TILE&&t!==Fe.a.ROTATE_ROW||(it[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),t!==Fe.a.FLIP_TILE&&t!==Fe.a.FLIP_ROW||(it[1]=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),t!==Fe.a.FLIP_N_ROTATE_TILE&&t!==Fe.a.FLIP_N_ROTATE_ROW||(it[1]=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ce=0;Ce<D;Ce++)be.push(ae+k,Ce*n-z+K,0),be.push(ae+v+k,Ce*n-z+K,0),be.push(ae+v+k,(Ce+1)*n-z+K,0),be.push(ae+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Fe.a.FLIP_TILE||t===Fe.a.ROTATE_TILE||t===Fe.a.FLIP_N_ROTATE_TILE?Ae.concat(it[(Ce+1)%2]):t===Fe.a.FLIP_ROW||t===Fe.a.ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_ROW?Ae.concat(it[Ce%2]):Ae.concat(it[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(vt){var yt=[];for(Oe=0,Ve=0,Le=v/n,ze=1,yt[0]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],yt[1]=[Oe,Ve,Le,Ve,Le,ze,Oe,ze],t!==Fe.a.ROTATE_TILE&&t!==Fe.a.ROTATE_ROW||(yt[1]=[1-Oe,1-Ve,1-Le,1-Ve,1-Le,1-ze,1-Oe,1-ze]),t!==Fe.a.FLIP_TILE&&t!==Fe.a.FLIP_ROW||(yt[1]=[1-Oe,Ve,1-Le,Ve,1-Le,ze,1-Oe,ze]),t!==Fe.a.FLIP_N_ROTATE_TILE&&t!==Fe.a.FLIP_N_ROTATE_ROW||(yt[1]=[Oe,1-Ve,Le,1-Ve,Le,1-ze,Oe,1-ze]),Ce=0;Ce<D;Ce++)be.push(fe-v+k,Ce*n-z+K,0),be.push(fe+k,Ce*n-z+K,0),be.push(fe+k,(Ce+1)*n-z+K,0),be.push(fe-v+k,(Ce+1)*n-z+K,0),Re.push(Pe,Pe+1,Pe+3,Pe+1,Pe+2,Pe+3),Pe+=4,Ae=t===Fe.a.FLIP_TILE||t===Fe.a.ROTATE_TILE||t===Fe.a.FLIP_N_ROTATE_TILE?Ae.concat(yt[(Ce+d)%2]):t===Fe.a.FLIP_ROW||t===Fe.a.ROTATE_ROW||t===Fe.a.FLIP_N_ROTATE_ROW?Ae.concat(yt[Ce%2]):Ae.concat(yt[0]),Ie.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Ee.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var We=i.sideOrientation===0?0:i.sideOrientation||Tt.a.DEFAULTSIDE;Tt.a._ComputeSides(We,be,Re,Ee,Ae,i.frontUVs,i.backUVs);var at=new Tt.a;at.indices=Re,at.positions=be,at.normals=Ee,at.uvs=Ae;var It=We===Tt.a.DOUBLESIDE?Ie.concat(Ie):Ie;return at.colors=It,at};var HT=function(){function i(){}return i.CreateTiledPlane=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateTiledPlane(e).applyToMesh(r,e.updatable),r},i}();Fe.a.CreateTube=function(i,t,e,n,r,o,l,d,v,y){var D={path:t,radius:e,tessellation:n,radiusFunction:r,arc:1,cap:o,updatable:d,sideOrientation:v,instance:y};return Lm.CreateTube(i,D,l)};var Lm=function(){function i(){}return i.CreateTube=function(t,e,n){n===void 0&&(n=null);var r=e.path,o=e.instance,l=1;e.radius!==void 0?l=e.radius:o&&(l=o._creationDataStorage.radius);var d=e.tessellation||64,v=e.radiusFunction||null,y=e.cap||Fe.a.NO_CAP,D=e.invertUV||!1,w=e.updatable,F=Fe.a._GetDefaultSideOrientation(e.sideOrientation);e.arc=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1;var z,k,K=function(me,be,Ee,xe,Ae,Ie,Re,Pe){for(var Ce,Ue,Oe,Ve,Le=be.getTangents(),ze=be.getNormals(),tt=be.getDistances(),ut=2*Math.PI/Ae*Pe,ft=Ie||function(){return xe},vt=h.c.Matrix[0],rt=Re===Fe.a.NO_CAP||Re===Fe.a.CAP_END?0:2,mt=0;mt<me.length;mt++){Ue=ft(mt,tt[mt]),Ce=Array(),Oe=ze[mt];for(var pt=0;pt<Ae;pt++)h.a.RotationAxisToRef(Le[mt],ut*pt,vt),Ve=Ce[pt]?Ce[pt]:h.e.Zero(),h.e.TransformCoordinatesToRef(Oe,vt,Ve),Ve.scaleInPlace(Ue).addInPlace(me[mt]),Ce[pt]=Ve;Ee[rt]=Ce,rt++}var it=function(yt,We){for(var at=Array(),It=0;It<yt;It++)at.push(me[We]);return at};switch(Re){case Fe.a.NO_CAP:break;case Fe.a.CAP_START:Ee[0]=it(Ae,0),Ee[1]=Ee[2].slice(0);break;case Fe.a.CAP_END:Ee[rt]=Ee[rt-1].slice(0),Ee[rt+1]=it(Ae,me.length-1);break;case Fe.a.CAP_ALL:Ee[0]=it(Ae,0),Ee[1]=Ee[2].slice(0),Ee[rt]=Ee[rt-1].slice(0),Ee[rt+1]=it(Ae,me.length-1)}return Ee};if(o){var ae=o._creationDataStorage,le=e.arc||ae.arc;return k=K(r,z=ae.path3D.update(r),ae.pathArray,l,ae.tessellation,v,ae.cap,le),o=ml.a.CreateRibbon("",{pathArray:k,instance:o}),ae.path3D=z,ae.pathArray=k,ae.arc=le,ae.radius=l,o}k=K(r,z=new nt.g(r),new Array,l,d,v,y=y<0||y>3?0:y,e.arc);var fe=ml.a.CreateRibbon(t,{pathArray:k,closePath:!0,closeArray:!1,updatable:w,sideOrientation:F,invertUV:D,frontUVs:e.frontUVs,backUVs:e.backUVs},n);return fe._creationDataStorage.pathArray=k,fe._creationDataStorage.path3D=z,fe._creationDataStorage.tessellation=d,fe._creationDataStorage.cap=y,fe._creationDataStorage.arc=e.arc,fe._creationDataStorage.radius=l,fe},i}();Tt.a.CreateIcoSphere=function(i){var t,e=i.sideOrientation||Tt.a.DEFAULTSIDE,n=i.radius||1,r=i.flat===void 0||i.flat,o=i.subdivisions||4,l=i.radiusX||n,d=i.radiusY||n,v=i.radiusZ||n,y=(1+Math.sqrt(5))/2,D=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],w=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],F=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],K=new Array,ae=new Array,le=new Array,fe=new Array,me=0,be=new Array(3),Ee=new Array(3);for(t=0;t<3;t++)be[t]=h.e.Zero(),Ee[t]=h.d.Zero();for(var xe=0;xe<20;xe++){for(t=0;t<3;t++){var Ae=w[3*xe+t];be[t].copyFromFloats(D[3*F[Ae]],D[3*F[Ae]+1],D[3*F[Ae]+2]),be[t].normalize().scaleInPlace(n),Ee[t].copyFromFloats(z[2*Ae]*(138/1024)+60/1024+k[xe]*(-40/1024),z[2*Ae+1]*(239/1024)+26/1024+k[xe]*(20/1024))}for(var Ie=function(Ue,Oe,Ve,Le){var ze,tt=h.e.Lerp(be[0],be[2],Oe/o),ut=h.e.Lerp(be[1],be[2],Oe/o),ft=o===Oe?be[2]:h.e.Lerp(tt,ut,Ue/(o-Oe));if(ft.normalize(),r){var vt=h.e.Lerp(be[0],be[2],Le/o),rt=h.e.Lerp(be[1],be[2],Le/o);ze=h.e.Lerp(vt,rt,Ve/(o-Le))}else ze=new h.e(ft.x,ft.y,ft.z);ze.x/=l,ze.y/=d,ze.z/=v,ze.normalize();var mt=h.d.Lerp(Ee[0],Ee[2],Oe/o),pt=h.d.Lerp(Ee[1],Ee[2],Oe/o),it=o===Oe?Ee[2]:h.d.Lerp(mt,pt,Ue/(o-Oe));ae.push(ft.x*l,ft.y*d,ft.z*v),le.push(ze.x,ze.y,ze.z),fe.push(it.x,it.y),K.push(me),me++},Re=0;Re<o;Re++)for(var Pe=0;Pe+Re<o;Pe++)Ie(Pe,Re,Pe+1/3,Re+1/3),Ie(Pe+1,Re,Pe+1/3,Re+1/3),Ie(Pe,Re+1,Pe+1/3,Re+1/3),Pe+Re+1<o&&(Ie(Pe+1,Re,Pe+2/3,Re+2/3),Ie(Pe+1,Re+1,Pe+2/3,Re+2/3),Ie(Pe,Re+1,Pe+2/3,Re+2/3))}Tt.a._ComputeSides(e,ae,K,le,fe,i.frontUVs,i.backUVs);var Ce=new Tt.a;return Ce.indices=K,Ce.positions=ae,Ce.normals=le,Ce.uvs=fe,Ce},Fe.a.CreateIcoSphere=function(i,t,e){return Nm.CreateIcoSphere(i,t,e)};var Nm=function(){function i(){}return i.CreateIcoSphere=function(t,e,n){n===void 0&&(n=null);var r=new Fe.a(t,n);return e.sideOrientation=Fe.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,Tt.a.CreateIcoSphere(e).applyToMesh(r,e.updatable),r},i}();Fe.a.CreateDecal=function(i,t,e,n,r,o){var l={position:e,normal:n,size:r,angle:o};return Fm.CreateDecal(i,t,l)};var Fm=function(){function i(){}return i.CreateDecal=function(t,e,n){var r=e.getIndices(),o=e.getVerticesData(De.b.PositionKind),l=e.getVerticesData(De.b.NormalKind),d=n.position||h.e.Zero(),v=n.normal||h.e.Up(),y=n.size||h.e.One(),D=n.angle||0;if(!v){var w=new h.e(0,0,1),F=e.getScene().activeCamera,z=h.e.TransformCoordinates(w,F.getWorldMatrix());v=F.globalPosition.subtract(z)}var k=-Math.atan2(v.z,v.x)-Math.PI/2,K=Math.sqrt(v.x*v.x+v.z*v.z),ae=Math.atan2(v.y,K),le=h.a.RotationYawPitchRoll(k,ae,D).multiply(h.a.Translation(d.x,d.y,d.z)),fe=h.a.Invert(le),me=e.getWorldMatrix().multiply(fe),be=new Tt.a;be.indices=[],be.positions=[],be.normals=[],be.uvs=[];for(var Ee=0,xe=function(Oe){var Ve=new jp;if(!r||!o||!l)return Ve;var Le=r[Oe];return Ve.position=new h.e(o[3*Le],o[3*Le+1],o[3*Le+2]),Ve.position=h.e.TransformCoordinates(Ve.position,me),Ve.normal=new h.e(l[3*Le],l[3*Le+1],l[3*Le+2]),Ve.normal=h.e.TransformNormal(Ve.normal,me),Ve},Ae=function(Oe,Ve){if(Oe.length===0)return Oe;for(var Le=.5*Math.abs(h.e.Dot(y,Ve)),ze=function(We,at){var It=h.e.GetClipFactor(We.position,at.position,Ve,Le);return new jp(h.e.Lerp(We.position,at.position,It),h.e.Lerp(We.normal,at.normal,It))},tt=new Array,ut=0;ut<Oe.length;ut+=3){var ft,vt,rt,mt=null,pt=null,it=null,yt=null;switch(((ft=h.e.Dot(Oe[ut].position,Ve)-Le>0)?1:0)+((vt=h.e.Dot(Oe[ut+1].position,Ve)-Le>0)?1:0)+((rt=h.e.Dot(Oe[ut+2].position,Ve)-Le>0)?1:0)){case 0:tt.push(Oe[ut]),tt.push(Oe[ut+1]),tt.push(Oe[ut+2]);break;case 1:if(ft&&(mt=Oe[ut+1],pt=Oe[ut+2],it=ze(Oe[ut],mt),yt=ze(Oe[ut],pt)),vt){mt=Oe[ut],pt=Oe[ut+2],it=ze(Oe[ut+1],mt),yt=ze(Oe[ut+1],pt),tt.push(it),tt.push(pt.clone()),tt.push(mt.clone()),tt.push(pt.clone()),tt.push(it.clone()),tt.push(yt);break}rt&&(mt=Oe[ut],pt=Oe[ut+1],it=ze(Oe[ut+2],mt),yt=ze(Oe[ut+2],pt)),mt&&pt&&it&&yt&&(tt.push(mt.clone()),tt.push(pt.clone()),tt.push(it),tt.push(yt),tt.push(it.clone()),tt.push(pt.clone()));break;case 2:ft||(pt=ze(mt=Oe[ut].clone(),Oe[ut+1]),it=ze(mt,Oe[ut+2]),tt.push(mt),tt.push(pt),tt.push(it)),vt||(pt=ze(mt=Oe[ut+1].clone(),Oe[ut+2]),it=ze(mt,Oe[ut]),tt.push(mt),tt.push(pt),tt.push(it)),rt||(pt=ze(mt=Oe[ut+2].clone(),Oe[ut]),it=ze(mt,Oe[ut+1]),tt.push(mt),tt.push(pt),tt.push(it))}}return tt},Ie=0;Ie<r.length;Ie+=3){var Re=new Array;if(Re.push(xe(Ie)),Re.push(xe(Ie+1)),Re.push(xe(Ie+2)),Re=Ae(Re,new h.e(1,0,0)),Re=Ae(Re,new h.e(-1,0,0)),Re=Ae(Re,new h.e(0,1,0)),Re=Ae(Re,new h.e(0,-1,0)),Re=Ae(Re,new h.e(0,0,1)),(Re=Ae(Re,new h.e(0,0,-1))).length!==0)for(var Pe=0;Pe<Re.length;Pe++){var Ce=Re[Pe];be.indices.push(Ee),Ce.position.toArray(be.positions,3*Ee),Ce.normal.toArray(be.normals,3*Ee),be.uvs.push(.5+Ce.position.x/y.x),be.uvs.push(.5+Ce.position.y/y.y),Ee++}}var Ue=new Fe.a(t,e.getScene());return be.applyToMesh(Ue),Ue.position=d.clone(),Ue.rotation=new h.e(ae,k,D),Ue},i}();Tt.a.CreateCapsule=function(i){i===void 0&&(i={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var t,e,n=Math.max(i.subdivisions?i.subdivisions:2,1),r=Math.max(i.tessellation?i.tessellation:16,3),o=Math.max(i.height?i.height:1,0),l=Math.max(i.radius?i.radius:.25,0),d=Math.max(i.capSubdivisions?i.capSubdivisions:6,1),v=r,y=n,D=Math.max(i.radiusTop?i.radiusTop:l,0),w=Math.max(i.radiusBottom?i.radiusBottom:l,0),F=o-(D+w),z=2*Math.PI,k=Math.max(i.topCapSubdivisions?i.topCapSubdivisions:d,1),K=Math.max(i.bottomCapSubdivisions?i.bottomCapSubdivisions:d,1),ae=Math.acos((w-D)/o),le=[],fe=[],me=[],be=[],Ee=0,xe=[],Ae=.5*F,Ie=.5*Math.PI,Re=h.e.Zero(),Pe=h.e.Zero(),Ce=Math.cos(ae),Ue=Math.sin(ae),Oe=new h.d(D*Ue,Ae+D*Ce).subtract(new h.d(w*Ue,w*Ce-Ae)).length(),Ve=D*ae+Oe+w*(Ie-ae),Le=0;for(e=0;e<=k;e++){var ze=[],tt=Ie-ae*(e/k);Le+=D*ae/k;var ut=Math.cos(tt),ft=Math.sin(tt),vt=ut*D;for(t=0;t<=v;t++){var rt=(We=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt);Pe.x=vt*mt,Pe.y=Ae+ft*D,Pe.z=vt*pt,fe.push(Pe.x,Pe.y,Pe.z),Re.set(ut*mt,ft,ut*pt),me.push(Re.x,Re.y,Re.z),be.push(We,1-Le/Ve),ze.push(Ee),Ee++}xe.push(ze)}var it=o-D-w+Ce*D-Ce*w,yt=Ue*(w-D)/it;for(e=1;e<=y;e++){for(ze=[],Le+=Oe/y,vt=Ue*(e*(w-D)/y+D),t=0;t<=v;t++)rt=(We=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt),Pe.x=vt*mt,Pe.y=Ae+Ce*D-e*it/y,Pe.z=vt*pt,fe.push(Pe.x,Pe.y,Pe.z),Re.set(mt,yt,pt).normalize(),me.push(Re.x,Re.y,Re.z),be.push(We,1-Le/Ve),ze.push(Ee),Ee++;xe.push(ze)}for(e=1;e<=K;e++){for(ze=[],tt=Ie-ae-(Math.PI-ae)*(e/K),Le+=w*ae/K,ut=Math.cos(tt),ft=Math.sin(tt),vt=ut*w,t=0;t<=v;t++){var We;rt=(We=t/v)*z+0,mt=Math.sin(rt),pt=Math.cos(rt),Pe.x=vt*mt,Pe.y=ft*w-Ae,Pe.z=vt*pt,fe.push(Pe.x,Pe.y,Pe.z),Re.set(ut*mt,ft,ut*pt),me.push(Re.x,Re.y,Re.z),be.push(We,1-Le/Ve),ze.push(Ee),Ee++}xe.push(ze)}for(t=0;t<v;t++)for(e=0;e<k+y+K;e++){var at=xe[e][t],It=xe[e+1][t],vn=xe[e+1][t+1],Jt=xe[e][t+1];le.push(at),le.push(It),le.push(Jt),le.push(It),le.push(vn),le.push(Jt)}if(le=le.reverse(),i.orientation&&!i.orientation.equals(h.e.Up())){var Sn=new h.a;i.orientation.clone().scale(.5*Math.PI).cross(h.e.Up()).toQuaternion().toRotationMatrix(Sn);for(var Rt=h.e.Zero(),Rn=0;Rn<fe.length;Rn+=3)Rt.set(fe[Rn],fe[Rn+1],fe[Rn+2]),h.e.TransformCoordinatesToRef(Rt.clone(),Sn,Rt),fe[Rn]=Rt.x,fe[Rn+1]=Rt.y,fe[Rn+2]=Rt.z}var bn=new Tt.a;return bn.positions=fe,bn.normals=me,bn.uvs=be,bn.indices=le,bn},Fe.a.CreateCapsule=function(i,t,e){return Bm.CreateCapsule(i,t,e)};var gl,Bm=function(){function i(){}return i.CreateCapsule=function(t,e,n){e===void 0&&(e={orientation:h.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var r=new Fe.a(t,n);return Tt.a.CreateCapsule(e).applyToMesh(r),r},i}(),Nw=function(){function i(){}return i.CreateBox=function(t,e,n){return n===void 0&&(n=null),ps.a.CreateBox(t,e,n)},i.CreateTiledBox=function(t,e,n){return n===void 0&&(n=null),zT.CreateTiledBox(t,e,n)},i.CreateSphere=function(t,e,n){return n===void 0&&(n=null),jr.a.CreateSphere(t,e,n)},i.CreateDisc=function(t,e,n){return n===void 0&&(n=null),Mh.CreateDisc(t,e,n)},i.CreateIcoSphere=function(t,e,n){return n===void 0&&(n=null),Nm.CreateIcoSphere(t,e,n)},i.CreateRibbon=function(t,e,n){return n===void 0&&(n=null),ml.a.CreateRibbon(t,e,n)},i.CreateCylinder=function(t,e,n){return n===void 0&&(n=null),Vi.a.CreateCylinder(t,e,n)},i.CreateTorus=function(t,e,n){return n===void 0&&(n=null),us.CreateTorus(t,e,n)},i.CreateTorusKnot=function(t,e,n){return n===void 0&&(n=null),Im.CreateTorusKnot(t,e,n)},i.CreateLineSystem=function(t,e,n){return Jn.a.CreateLineSystem(t,e,n)},i.CreateLines=function(t,e,n){return n===void 0&&(n=null),Jn.a.CreateLines(t,e,n)},i.CreateDashedLines=function(t,e,n){return n===void 0&&(n=null),Jn.a.CreateDashedLines(t,e,n)},i.ExtrudeShape=function(t,e,n){return n===void 0&&(n=null),gh.a.ExtrudeShape(t,e,n)},i.ExtrudeShapeCustom=function(t,e,n){return n===void 0&&(n=null),gh.a.ExtrudeShapeCustom(t,e,n)},i.CreateLathe=function(t,e,n){return n===void 0&&(n=null),wm.CreateLathe(t,e,n)},i.CreateTiledPlane=function(t,e,n){return n===void 0&&(n=null),HT.CreateTiledPlane(t,e,n)},i.CreatePlane=function(t,e,n){return n===void 0&&(n=null),Up.a.CreatePlane(t,e,n)},i.CreateGround=function(t,e,n){return n===void 0&&(n=null),Vo.CreateGround(t,e,n)},i.CreateTiledGround=function(t,e,n){return n===void 0&&(n=null),Vo.CreateTiledGround(t,e,n)},i.CreateGroundFromHeightMap=function(t,e,n,r){return r===void 0&&(r=null),Vo.CreateGroundFromHeightMap(t,e,n,r)},i.CreatePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),_l.CreatePolygon(t,e,n,r)},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),_l.ExtrudePolygon(t,e,n,r)},i.CreateTube=function(t,e,n){return n===void 0&&(n=null),Lm.CreateTube(t,e,n)},i.CreatePolyhedron=function(t,e,n){return n===void 0&&(n=null),$c.CreatePolyhedron(t,e,n)},i.CreateDecal=function(t,e,n){return Fm.CreateDecal(t,e,n)},i.CreateCapsule=function(t,e,n){return e===void 0&&(e={orientation:h.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),n===void 0&&(n=null),Bm.CreateCapsule(t,e,n)},i}(),Fw=function(i,t,e){this.quality=i,this.distance=t,this.optimizeMesh=e},WT=function(){function i(){this.running=!1,this._simplificationArray=[]}return i.prototype.addTask=function(t){this._simplificationArray.push(t)},i.prototype.executeNext=function(){var t=this._simplificationArray.pop();t?(this.running=!0,this.runSimplification(t)):this.running=!1},i.prototype.runSimplification=function(t){var e=this;if(t.parallelProcessing)t.settings.forEach(function(r){e.getSimplifier(t).simplify(r,function(o){r.distance!==void 0&&t.mesh.addLODLevel(r.distance,o),o.isVisible=!0,r.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),e.executeNext()})});else{var n=this.getSimplifier(t);et.a.Run(t.settings.length,function(r){var o,l;o=t.settings[r.index],l=function(){r.executeNext()},n.simplify(o,function(d){o.distance!==void 0&&t.mesh.addLODLevel(o.distance,d),d.isVisible=!0,l()})},function(){t.successCallback&&t.successCallback(),e.executeNext()})}},i.prototype.getSimplifier=function(t){switch(t.simplificationType){case gl.QUADRATIC:default:return new YT(t.mesh)}},i}();(function(i){i[i.QUADRATIC=0]="QUADRATIC"})(gl||(gl={}));var Bw=function(i){this.vertices=i,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},Uw=function(){function i(t,e){this.position=t,this.id=e,this.isBorder=!0,this.q=new XT,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return i.prototype.updatePosition=function(t){this.position.copyFrom(t)},i}(),XT=function(){function i(t){this.data=new Array(10);for(var e=0;e<10;++e)t&&t[e]?this.data[e]=t[e]:this.data[e]=0}return i.prototype.det=function(t,e,n,r,o,l,d,v,y){return this.data[t]*this.data[o]*this.data[y]+this.data[n]*this.data[r]*this.data[v]+this.data[e]*this.data[l]*this.data[d]-this.data[n]*this.data[o]*this.data[d]-this.data[t]*this.data[l]*this.data[v]-this.data[e]*this.data[r]*this.data[y]},i.prototype.addInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t.data[e]},i.prototype.addArrayInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t[e]},i.prototype.add=function(t){for(var e=new i,n=0;n<10;++n)e.data[n]=this.data[n]+t.data[n];return e},i.FromData=function(t,e,n,r){return new i(i.DataFromNumbers(t,e,n,r))},i.DataFromNumbers=function(t,e,n,r){return[t*t,t*e,t*n,t*r,e*e,e*n,e*r,n*n,n*r,r*r]},i}(),Vw=function(i,t){this.vertexId=i,this.triangleId=t},YT=function(){function i(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=Zt.a}return i.prototype.simplify=function(t,e){var n=this;this.initDecimatedMesh(),et.a.Run(this._mesh.subMeshes.length,function(r){n.initWithMesh(r.index,function(){n.runDecimation(t,r.index,function(){r.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){e(n._reconstructedMesh)},0)})},i.prototype.runDecimation=function(t,e,n){var r=this,o=~~(this.triangles.length*t.quality),l=0,d=this.triangles.length;et.a.Run(this.decimationIterations,function(v){var y,D;d-l<=o?v.breakLoop():(y=v.index,D=function(){v.executeNext()},setTimeout(function(){y%5==0&&r.updateMesh(y===0);for(var w=0;w<r.triangles.length;++w)r.triangles[w].isDirty=!1;var F=1e-9*Math.pow(y+3,r.aggressiveness);et.a.SyncAsyncForLoop(r.triangles.length,r.syncIterations,function(z){var k=~~((r.triangles.length/2+z)%r.triangles.length),K=r.triangles[k];if(K&&!(K.error[3]>F||K.deleted||K.isDirty)){for(var ae=0;ae<3;++ae)if(K.error[ae]<F){var le=[],fe=[],me=K.vertices[ae],be=K.vertices[(ae+1)%3];if(me.isBorder||be.isBorder)continue;var Ee=h.e.Zero();r.calculateError(me,be,Ee);var xe=new Array;if(r.isFlipped(me,be,Ee,le,xe)||r.isFlipped(be,me,Ee,fe,xe)||le.indexOf(!0)<0||fe.indexOf(!0)<0)continue;var Ae=new Array;if(xe.forEach(function(Ce){Ae.indexOf(Ce)===-1&&(Ce.deletePending=!0,Ae.push(Ce))}),Ae.length%2!=0)continue;me.q=be.q.add(me.q),me.updatePosition(Ee);var Ie=r.references.length;l=r.updateTriangles(me,me,le,l),l=r.updateTriangles(me,be,fe,l);var Re=r.references.length-Ie;if(Re<=me.triangleCount){if(Re)for(var Pe=0;Pe<Re;Pe++)r.references[me.triangleStart+Pe]=r.references[Ie+Pe]}else me.triangleStart=Ie;me.triangleCount=Re;break}}},D,function(){return d-l<=o})},0))},function(){setTimeout(function(){r.reconstructMesh(e),n()},0)})},i.prototype.initWithMesh=function(t,e,n){var r=this;this.vertices=[],this.triangles=[];var o=this._mesh.getVerticesData(De.b.PositionKind),l=this._mesh.getIndices(),d=this._mesh.subMeshes[t],v=[],y=d.verticesCount;et.a.SyncAsyncForLoop(y,this.syncIterations/4>>0,function(D){if(o){var w=D+d.verticesStart,F=h.e.FromArray(o,3*w),z=function(k){if(n){for(var K=0;K<r.vertices.length;++K)if(r.vertices[K].position.equalsWithEpsilon(k,1e-4))return r.vertices[K]}return null}(F)||new Uw(F,r.vertices.length);z.originalOffsets.push(w),z.id===r.vertices.length&&r.vertices.push(z),v.push(z.id)}},function(){et.a.SyncAsyncForLoop(d.indexCount/3,r.syncIterations,function(D){if(l){var w=3*(d.indexStart/3+D),F=l[w+0],z=l[w+1],k=l[w+2],K=r.vertices[v[F-d.verticesStart]],ae=r.vertices[v[z-d.verticesStart]],le=r.vertices[v[k-d.verticesStart]],fe=new Bw([K,ae,le]);fe.originalOffset=w,r.triangles.push(fe)}},function(){r.init(e)})})},i.prototype.init=function(t){var e=this;et.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(n){var r=e.triangles[n];r.normal=h.e.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var o=0;o<3;o++)r.vertices[o].q.addArrayInPlace(XT.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-h.e.Dot(r.normal,r.vertices[0].position)))},function(){et.a.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(n){for(var r=e.triangles[n],o=0;o<3;++o)r.error[o]=e.calculateError(r.vertices[o],r.vertices[(o+1)%3]);r.error[3]=Math.min(r.error[0],r.error[1],r.error[2])},function(){t()})})},i.prototype.reconstructMesh=function(t){var e,n,r,o=[];for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0;for(e=0;e<this.triangles.length;++e)if(!this.triangles[e].deleted){for(n=this.triangles[e],r=0;r<3;++r)n.vertices[r].triangleCount=1;o.push(n)}var l=this._reconstructedMesh.getVerticesData(De.b.PositionKind)||[],d=this._reconstructedMesh.getVerticesData(De.b.NormalKind)||[],v=this._reconstructedMesh.getVerticesData(De.b.UVKind)||[],y=this._reconstructedMesh.getVerticesData(De.b.ColorKind)||[],D=this._mesh.getVerticesData(De.b.NormalKind),w=this._mesh.getVerticesData(De.b.UVKind),F=this._mesh.getVerticesData(De.b.ColorKind),z=0;for(e=0;e<this.vertices.length;++e){var k=this.vertices[e];k.id=z,k.triangleCount&&k.originalOffsets.forEach(function(Ee){l.push(k.position.x),l.push(k.position.y),l.push(k.position.z),D&&D.length&&(d.push(D[3*Ee]),d.push(D[3*Ee+1]),d.push(D[3*Ee+2])),w&&w.length&&(v.push(w[2*Ee]),v.push(w[2*Ee+1])),F&&F.length&&(y.push(F[4*Ee]),y.push(F[4*Ee+1]),y.push(F[4*Ee+2]),y.push(F[4*Ee+3])),++z})}var K=this._reconstructedMesh.getTotalIndices(),ae=this._reconstructedMesh.getTotalVertices(),le=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var fe=this._reconstructedMesh.getIndices(),me=this._mesh.getIndices();for(e=0;e<o.length;++e)n=o[e],[0,1,2].forEach(function(Ee){var xe=me[n.originalOffset+Ee],Ae=n.vertices[Ee].originalOffsets.indexOf(xe);Ae<0&&(Ae=0),fe.push(n.vertices[Ee].id+Ae+ae)});this._reconstructedMesh.setIndices(fe),this._reconstructedMesh.setVerticesData(De.b.PositionKind,l),d.length>0&&this._reconstructedMesh.setVerticesData(De.b.NormalKind,d),v.length>0&&this._reconstructedMesh.setVerticesData(De.b.UVKind,v),y.length>0&&this._reconstructedMesh.setVerticesData(De.b.ColorKind,y);var be=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],le.forEach(function(Ee){fl.a.AddToMesh(Ee.materialIndex,Ee.verticesStart,Ee.verticesCount,Ee.indexStart,Ee.indexCount,Ee.getMesh())}),fl.a.AddToMesh(be.materialIndex,ae,z,K,3*o.length,this._reconstructedMesh))},i.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new Fe.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},i.prototype.isFlipped=function(t,e,n,r,o){for(var l=0;l<t.triangleCount;++l){var d=this.triangles[this.references[t.triangleStart+l].triangleId];if(!d.deleted){var v=this.references[t.triangleStart+l].vertexId,y=d.vertices[(v+1)%3],D=d.vertices[(v+2)%3];if(y!==e&&D!==e){var w=y.position.subtract(n);w=w.normalize();var F=D.position.subtract(n);if(F=F.normalize(),Math.abs(h.e.Dot(w,F))>.999)return!0;var z=h.e.Cross(w,F).normalize();if(r[l]=!1,h.e.Dot(z,d.normal)<.2)return!0}else r[l]=!0,o.push(d)}}return!1},i.prototype.updateTriangles=function(t,e,n,r){for(var o=r,l=0;l<e.triangleCount;++l){var d=this.references[e.triangleStart+l],v=this.triangles[d.triangleId];v.deleted||(n[l]&&v.deletePending?(v.deleted=!0,o++):(v.vertices[d.vertexId]=t,v.isDirty=!0,v.error[0]=this.calculateError(v.vertices[0],v.vertices[1])+v.borderFactor/2,v.error[1]=this.calculateError(v.vertices[1],v.vertices[2])+v.borderFactor/2,v.error[2]=this.calculateError(v.vertices[2],v.vertices[0])+v.borderFactor/2,v.error[3]=Math.min(v.error[0],v.error[1],v.error[2]),this.references.push(d)))}return o},i.prototype.identifyBorder=function(){for(var t=0;t<this.vertices.length;++t){var e,n=[],r=[],o=this.vertices[t];for(e=0;e<o.triangleCount;++e)for(var l=this.triangles[this.references[o.triangleStart+e].triangleId],d=0;d<3;d++){for(var v=0,y=l.vertices[d];v<n.length&&r[v]!==y.id;)++v;v===n.length?(n.push(1),r.push(y.id)):n[v]++}for(e=0;e<n.length;++e)n[e]===1?this.vertices[r[e]].isBorder=!0:this.vertices[r[e]].isBorder=!1}},i.prototype.updateMesh=function(t){var e,n,r,o;if(t===void 0&&(t=!1),!t){var l=[];for(e=0;e<this.triangles.length;++e)this.triangles[e].deleted||l.push(this.triangles[e]);this.triangles=l}for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0,this.vertices[e].triangleStart=0;for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)(o=n.vertices[r]).triangleCount++;var d=0;for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleStart=d,d+=this.vertices[e].triangleCount,this.vertices[e].triangleCount=0;var v=new Array(3*this.triangles.length);for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)v[(o=n.vertices[r]).triangleStart+o.triangleCount]=new Vw(r,e),o.triangleCount++;this.references=v,t&&this.identifyBorder()},i.prototype.vertexError=function(t,e){var n=e.x,r=e.y,o=e.z;return t.data[0]*n*n+2*t.data[1]*n*r+2*t.data[2]*n*o+2*t.data[3]*n+t.data[4]*r*r+2*t.data[5]*r*o+2*t.data[6]*r+t.data[7]*o*o+2*t.data[8]*o+t.data[9]},i.prototype.calculateError=function(t,e,n){var r=t.q.add(e.q),o=t.isBorder&&e.isBorder,l=0,d=r.det(0,1,2,1,4,5,2,5,7);if(d===0||o){var v=t.position.add(e.position).divide(new h.e(2,2,2)),y=this.vertexError(r,t.position),D=this.vertexError(r,e.position),w=this.vertexError(r,v);(l=Math.min(y,D,w))===y?n&&n.copyFrom(t.position):l===D?n&&n.copyFrom(e.position):n&&n.copyFrom(v)}else n||(n=h.e.Zero()),n.x=-1/d*r.det(1,2,3,4,5,6,5,7,8),n.y=1/d*r.det(0,2,3,1,5,6,2,7,8),n.z=-1/d*r.det(0,1,3,1,4,6,2,5,8),l=this.vertexError(r,n);return l},i}();Object.defineProperty(ne.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new WT;var i=this._getComponent(dt.a.NAME_SIMPLIFICATIONQUEUE);i||(i=new KT(this),this._addComponent(i))}return this._simplificationQueue},set:function(i){this._simplificationQueue=i},enumerable:!0,configurable:!0}),Fe.a.prototype.simplify=function(i,t,e,n){return t===void 0&&(t=!0),e===void 0&&(e=gl.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:i,parallelProcessing:t,mesh:this,simplificationType:e,successCallback:n}),this};var KT=function(){function i(t){this.name=dt.a.NAME_SIMPLIFICATIONQUEUE,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(dt.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},i}(),kw=c(149),jw=c(88);Fe.a.prototype.thinInstanceAdd=function(i,t){t===void 0&&(t=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(i)?i.length:1);var e=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(i))for(var n=0;n<i.length;++n)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i[n],n===i.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i,t);return e},Fe.a.prototype.thinInstanceAddSelf=function(i){return i===void 0&&(i=!0),this.thinInstanceAdd(h.a.IdentityReadOnly,i)},Fe.a.prototype.thinInstanceRegisterAttribute=function(i,t){this.removeVerticesData(i),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[i]=t,this._userThinInstanceBuffersStorage.sizes[i]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[i]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[i]),this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),this._userThinInstanceBuffersStorage.data[i],i,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])},Fe.a.prototype.thinInstanceSetMatrixAt=function(i,t,e){if(e===void 0&&(e=!0),!this._thinInstanceDataStorage.matrixData||i>=this._thinInstanceDataStorage.instancesCount)return!1;var n=this._thinInstanceDataStorage.matrixData;return t.copyToArray(n,16*i),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[i]=t),e&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},Fe.a.prototype.thinInstanceSetAttributeAt=function(i,t,e,n){return n===void 0&&(n=!0),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[i]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(i,0),this._userThinInstanceBuffersStorage.data[i].set(e,t*this._userThinInstanceBuffersStorage.strides[i]),n&&this.thinInstanceBufferUpdated(i),!0)},Object.defineProperty(Fe.a.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(i){var t,e;i<=((e=(t=this._thinInstanceDataStorage.matrixData)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0)/16&&(this._thinInstanceDataStorage.instancesCount=i)},enumerable:!0,configurable:!0}),Fe.a.prototype.thinInstanceSetBuffer=function(i,t,e,n){var r,o;if(e===void 0&&(e=0),n===void 0&&(n=!1),e=e||16,i==="matrix")if((r=this._thinInstanceDataStorage.matrixBuffer)===null||r===void 0||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*e,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,t!==null){this._thinInstanceDataStorage.instancesCount=t.length/e;var l=new De.a(this.getEngine(),t,!n,e,!1,!0);this._thinInstanceDataStorage.matrixBuffer=l,this.setVerticesBuffer(l.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(l.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(l.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(l.createVertexBuffer("world3",12,4)),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)}else this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo(!0);else t===null?((o=this._userThinInstanceBuffersStorage)===null||o===void 0?void 0:o.data[i])&&(this.removeVerticesData(i),delete this._userThinInstanceBuffersStorage.data[i],delete this._userThinInstanceBuffersStorage.strides[i],delete this._userThinInstanceBuffersStorage.sizes[i],delete this._userThinInstanceBuffersStorage.vertexBuffers[i]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[i]=t,this._userThinInstanceBuffersStorage.strides[i]=e,this._userThinInstanceBuffersStorage.sizes[i]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),t,i,!n,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i]))},Fe.a.prototype.thinInstanceBufferUpdated=function(i){var t;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):((t=this._userThinInstanceBuffersStorage)===null||t===void 0?void 0:t.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(this._userThinInstanceBuffersStorage.data[i],0)},Fe.a.prototype.thinInstancePartialBufferUpdate=function(i,t,e){var n;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,e):((n=this._userThinInstanceBuffersStorage)===null||n===void 0?void 0:n.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(t,e)},Fe.a.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var i=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=h.a.FromArray(i,16*t)}return this._thinInstanceDataStorage.worldMatrices},Fe.a.prototype.thinInstanceRefreshBoundingInfo=function(i){if(i===void 0&&(i=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var t=this._thinInstanceDataStorage.boundingVectors;i&&(t.length=0,this.refreshBoundingInfo(!0));var e=this.getBoundingInfo(),n=this._thinInstanceDataStorage.matrixData;if(t.length===0)for(var r=0;r<e.boundingBox.vectors.length;++r)t.push(e.boundingBox.vectors[r].clone());h.c.Vector3[0].setAll(Number.POSITIVE_INFINITY),h.c.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var o=0;o<this._thinInstanceDataStorage.instancesCount;++o)for(h.a.FromArrayToRef(n,16*o,h.c.Matrix[0]),r=0;r<t.length;++r)h.e.TransformCoordinatesToRef(t[r],h.c.Matrix[0],h.c.Vector3[2]),h.c.Vector3[0].minimizeInPlace(h.c.Vector3[2]),h.c.Vector3[1].maximizeInPlace(h.c.Vector3[2]);e.reConstruct(h.c.Vector3[0],h.c.Vector3[1]),this._updateBoundingInfo()}},Fe.a.prototype._thinInstanceUpdateBufferSize=function(i,t){var e,n;t===void 0&&(t=1);var r=i==="matrix";if(r||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[i]){for(var o=r?16:this._userThinInstanceBuffersStorage.strides[i],l=r?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[i],d=r?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[i],v=(this._thinInstanceDataStorage.instancesCount+t)*o,y=l;y<v;)y*=2;if(!d||l!=y){if(d){var D=new Float32Array(y);D.set(d,0),d=D}else d=new Float32Array(y);if(r){(e=this._thinInstanceDataStorage.matrixBuffer)===null||e===void 0||e.dispose();var w=new De.a(this.getEngine(),d,!0,o,!1,!0);this._thinInstanceDataStorage.matrixBuffer=w,this._thinInstanceDataStorage.matrixData=d,this._thinInstanceDataStorage.matrixBufferSize=y,this.setVerticesBuffer(w.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(w.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(w.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(w.createVertexBuffer("world3",12,4))}else(n=this._userThinInstanceBuffersStorage.vertexBuffers[i])===null||n===void 0||n.dispose(),this._userThinInstanceBuffersStorage.data[i]=d,this._userThinInstanceBuffersStorage.sizes[i]=y,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new De.b(this.getEngine(),d,i,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])}}},Fe.a.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Fe.a.prototype._disposeThinInstanceSpecificData=function(){var i;((i=this._thinInstanceDataStorage)===null||i===void 0?void 0:i.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var zw=function(){function i(t){t===void 0&&(t=Recast),this.bjsRECAST={},this.name="RecastJSPlugin",this._maximumSubStepCount=10,this._timeStep=1/60,typeof t=="function"?t(this.bjsRECAST):this.bjsRECAST=t,this.isSupported()?this.setTimeStep():_.a.Error("RecastJS is not available. Please make sure you included the js file.")}return i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._timeStep=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype.setMaximumSubStepCount=function(t){t===void 0&&(t=10),this._maximumSubStepCount=t},i.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount},i.prototype.createNavMesh=function(t,e){var n,r,o,l=new this.bjsRECAST.rcConfig;l.cs=e.cs,l.ch=e.ch,l.borderSize=0,l.tileSize=0,l.walkableSlopeAngle=e.walkableSlopeAngle,l.walkableHeight=e.walkableHeight,l.walkableClimb=e.walkableClimb,l.walkableRadius=e.walkableRadius,l.maxEdgeLen=e.maxEdgeLen,l.maxSimplificationError=e.maxSimplificationError,l.minRegionArea=e.minRegionArea,l.mergeRegionArea=e.mergeRegionArea,l.maxVertsPerPoly=e.maxVertsPerPoly,l.detailSampleDist=e.detailSampleDist,l.detailSampleMaxError=e.detailSampleMaxError,this.navMesh=new this.bjsRECAST.NavMesh;var d=[],v=[],y=0;for(n=0;n<t.length;n++)if(t[n]){var D=t[n],w=D.getIndices();if(!w)continue;var F=D.getVerticesData(De.b.PositionKind,!1,!1);if(!F)continue;var z=D.computeWorldMatrix(!0);for(r=0;r<w.length;r++)d.push(w[r]+y);var k=h.e.Zero(),K=h.e.Zero();for(o=0;o<F.length;o+=3)h.e.FromArrayToRef(F,o,K),h.e.TransformCoordinatesToRef(K,z,k),v.push(k.x,k.y,k.z);y+=F.length/3}this.navMesh.build(v,y,d,d.length,l)},i.prototype.createDebugNavMesh=function(t){var e,n,r=this.navMesh.getDebugNavMesh(),o=r.getTriangleCount(),l=[],d=[];for(e=0;e<3*o;e++)l.push(e);for(e=0;e<o;e++)for(n=0;n<3;n++){var v=r.getTriangle(e).getPoint(n);d.push(v.x,v.y,v.z)}var y=new Fe.a("NavMeshDebug",t),D=new Tt.a;return D.indices=l,D.positions=d,D.applyToMesh(y,!1),y},i.prototype.getClosestPoint=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z),n=this.navMesh.getClosestPoint(e);return new h.e(n.x,n.y,n.z)},i.prototype.getClosestPointToRef=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getClosestPoint(n);e.set(r.x,r.y,r.z)},i.prototype.getRandomPointAround=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getRandomPointAround(n,e);return new h.e(r.x,r.y,r.z)},i.prototype.getRandomPointAroundToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=this.navMesh.getRandomPointAround(r,e);n.set(o.x,o.y,o.z)},i.prototype.moveAlong=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=new this.bjsRECAST.Vec3(e.x,e.y,e.z),o=this.navMesh.moveAlong(n,r);return new h.e(o.x,o.y,o.z)},i.prototype.moveAlongToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),l=this.navMesh.moveAlong(r,o);n.set(l.x,l.y,l.z)},i.prototype.computePath=function(t,e){var n,r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),l=this.navMesh.computePath(r,o),d=l.getPointCount(),v=[];for(n=0;n<d;n++){var y=l.getPoint(n);v.push(new h.e(y.x,y.y,y.z))}return v},i.prototype.createCrowd=function(t,e,n){return new QT(this,t,e,n)},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z);this.navMesh.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.navMesh.getDefaultQueryExtent();return new h.e(t.x,t.y,t.z)},i.prototype.buildFromNavmeshData=function(t){var e=t.length*t.BYTES_PER_ELEMENT,n=this.bjsRECAST._malloc(e),r=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,n,e);r.set(t);var o=new this.bjsRECAST.NavmeshData;o.dataPointer=r.byteOffset,o.size=t.length,this.navMesh=new this.bjsRECAST.NavMesh,this.navMesh.buildFromNavmeshData(o),this.bjsRECAST._free(r.byteOffset)},i.prototype.getNavmeshData=function(){var t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,t.dataPointer,t.size),n=new Uint8Array(t.size);return n.set(e),this.navMesh.freeNavmeshData(t),n},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){},i.prototype.isSupported=function(){return this.bjsRECAST!==void 0},i}(),QT=function(){function i(t,e,n,r){var o=this;this.recastCrowd={},this.transforms=new Array,this.agents=new Array,this._onBeforeAnimationsObserver=null,this.bjsRECASTPlugin=t,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(e,n,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=r,this._onBeforeAnimationsObserver=r.onBeforeAnimationsObservable.add(function(){o.update(.001*r.getEngine().getDeltaTime())})}return i.prototype.addAgent=function(t,e,n){var r=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;var o=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z),r);return this.transforms.push(n),this.agents.push(o),o},i.prototype.getAgentPosition=function(t){var e=this.recastCrowd.getAgentPosition(t);return new h.e(e.x,e.y,e.z)},i.prototype.getAgentPositionToRef=function(t,e){var n=this.recastCrowd.getAgentPosition(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentVelocity=function(t){var e=this.recastCrowd.getAgentVelocity(t);return new h.e(e.x,e.y,e.z)},i.prototype.getAgentVelocityToRef=function(t,e){var n=this.recastCrowd.getAgentVelocity(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentNextTargetPath=function(t){var e=this.recastCrowd.getAgentNextTargetPath(t);return new h.e(e.x,e.y,e.z)},i.prototype.getAgentNextTargetPathToRef=function(t,e){var n=this.recastCrowd.getAgentNextTargetPath(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentState=function(t){return this.recastCrowd.getAgentState(t)},i.prototype.overOffmeshConnection=function(t){return this.recastCrowd.overOffmeshConnection(t)},i.prototype.agentGoto=function(t,e){this.recastCrowd.agentGoto(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.agentTeleport=function(t,e){this.recastCrowd.agentTeleport(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.updateAgentParameters=function(t,e){var n=this.recastCrowd.getAgentParameters(t);e.radius!==void 0&&(n.radius=e.radius),e.height!==void 0&&(n.height=e.height),e.maxAcceleration!==void 0&&(n.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(n.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(n.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(n.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(n.separationWeight=e.separationWeight),this.recastCrowd.setAgentParameters(t,n)},i.prototype.removeAgent=function(t){this.recastCrowd.removeAgent(t);var e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1))},i.prototype.getAgents=function(){return this.agents},i.prototype.update=function(t){var e=this.bjsRECASTPlugin.getTimeStep(),n=this.bjsRECASTPlugin.getMaximumSubStepCount();if(e<=Zt.a)this.recastCrowd.update(t);else{var r=t/e;n&&r>n&&(r=n),r<1&&(r=1);for(var o=0;o<r;o++)this.recastCrowd.update(e)}for(var l=0;l<this.agents.length;l++)this.transforms[l].position=this.getAgentPosition(this.agents[l])},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z);this.recastCrowd.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.recastCrowd.getDefaultQueryExtent();return new h.e(t.x,t.y,t.z)},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.recastCrowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null},i}();He.a.OfflineProviderFactory=function(i,t,e){return e===void 0&&(e=!1),new qT(i,t,e)};var Os,qT=function(){function i(t,e,n){var r=this;n===void 0&&(n=!1),this._idbFactory=typeof window!="undefined"?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB,this._callbackManifestChecked=e,this._currentSceneUrl=i._ReturnFullUrlLocation(t),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,i.IDBStorageEnabled?n?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,et.b.SetImmediate(function(){r._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(i.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!1,configurable:!0}),i.prototype._checkManifestFile=function(){var t=this,e=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t._callbackManifestChecked(!1)},n=!1,r=this._currentSceneUrl+".manifest",o=new se.a;navigator.onLine&&(n=!0,r=r+(r.match(/\?/)==null?"?":"&")+Date.now()),o.open("GET",r),o.addEventListener("load",function(){if(o.status===200||i._ValidateXHRData(o,1))try{var l=JSON.parse(o.response);t._enableSceneOffline=l.enableSceneOffline,t._enableTexturesOffline=l.enableTexturesOffline&&i.IsUASupportingBlobStorage,l.version&&!isNaN(parseInt(l.version))&&(t._manifestVersionFound=l.version),t._callbackManifestChecked&&t._callbackManifestChecked(!0)}catch(d){e()}else e()},!1),o.addEventListener("error",function(){if(n){n=!1;var l=t._currentSceneUrl+".manifest";o.open("GET",l),o.send()}else e()},!1);try{o.send()}catch(l){_.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},i.prototype.open=function(t,e){var n=this,r=function(){n._isSupported=!1,e&&e()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)t&&t();else{this._hasReachedQuota=!1,this._isSupported=!0;var o=this._idbFactory.open("babylonjs",1);o.onerror=function(){r()},o.onblocked=function(){_.a.Error("IDB request blocked. Please reload the page."),r()},o.onsuccess=function(){n._db=o.result,t()},o.onupgradeneeded=function(l){if(n._db=l.target.result,n._db)try{n._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),n._db.createObjectStore("versions",{keyPath:"sceneUrl"}),n._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(d){_.a.Error("Error while creating object stores. Exception: "+d.message),r()}}}else this._isSupported=!1,e&&e()},i.prototype.loadImage=function(t,e){var n=this,r=i._ReturnFullUrlLocation(t),o=function(){n._hasReachedQuota||n._db===null?e.src=t:n._saveImageIntoDBAsync(r,e)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(r,e,o)},i.prototype._loadImageFromDBAsync=function(t,e,n){if(this._isSupported&&this._db!==null){var r,o=this._db.transaction(["textures"]);o.onabort=function(){e.src=t},o.oncomplete=function(){var d;if(r){var v=window.URL||window.webkitURL;d=v.createObjectURL(r.data),e.onerror=function(){_.a.Error("Error loading image from blob URL: "+d+" switching back to web url: "+t),e.src=t},e.src=d}else n()};var l=o.objectStore("textures").get(t);l.onsuccess=function(d){r=d.target.result},l.onerror=function(){_.a.Error("Error loading texture "+t+" from DB."),e.src=t}}else _.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e.src=t},i.prototype._saveImageIntoDBAsync=function(t,e){var n=this;if(this._isSupported){var r=function(){var d;if(o){var v=window.URL||window.webkitURL;try{d=v.createObjectURL(o)}catch(y){d=v.createObjectURL(o)}}d&&(e.src=d)};if(i.IsUASupportingBlobStorage){var o,l=new se.a;l.open("GET",t),l.responseType="blob",l.addEventListener("load",function(){if(l.status===200&&n._db){o=l.response;var d=n._db.transaction(["textures"],"readwrite");d.onabort=function(D){try{var w=(D.srcElement||D.target).error;w&&w.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(F){}r()},d.oncomplete=function(){r()};var v={textureUrl:t,data:o};try{var y=d.objectStore("textures").put(v);y.onsuccess=function(){},y.onerror=function(){r()}}catch(D){D.code===25&&(i.IsUASupportingBlobStorage=!1,n._enableTexturesOffline=!1),e.src=t}}else e.src=t},!1),l.addEventListener("error",function(){_.a.Error("Error in XHR request in BABYLON.Database."),e.src=t},!1),l.send()}else e.src=t}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e.src=t},i.prototype._checkVersionFromDB=function(t,e){var n=this;this._loadVersionFromDBAsync(t,e,function(){n._saveVersionIntoDBAsync(t,e)})},i.prototype._loadVersionFromDBAsync=function(t,e,n){var r,o=this;if(this._isSupported&&this._db)try{var l=this._db.transaction(["versions"]);l.oncomplete=function(){r?o._manifestVersionFound!==r.data?(o._mustUpdateRessources=!0,n()):e(r.data):(o._mustUpdateRessources=!0,n())},l.onabort=function(){e(-1)};var d=l.objectStore("versions").get(t);d.onsuccess=function(v){r=v.target.result},d.onerror=function(){_.a.Error("Error loading version for scene "+t+" from DB."),e(-1)}}catch(v){_.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+v.message),e(-1)}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e(-1)},i.prototype._saveVersionIntoDBAsync=function(t,e){var n=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var r=this._db.transaction(["versions"],"readwrite");r.onabort=function(d){try{var v=d.srcElement.error;v&&v.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(y){}e(-1)},r.oncomplete=function(){e(n._manifestVersionFound)};var o={sceneUrl:t,data:this._manifestVersionFound},l=r.objectStore("versions").put(o);l.onsuccess=function(){},l.onerror=function(){_.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(d){_.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+d.message),e(-1)}else e(-1)},i.prototype.loadFile=function(t,e,n,r,o){var l=this,d=i._ReturnFullUrlLocation(t),v=function(){l._saveFileAsync(d,e,n,o,r)};this._checkVersionFromDB(d,function(y){y!==-1?l._mustUpdateRessources?l._saveFileAsync(d,e,n,o,r):l._loadFileAsync(d,e,v):r&&r()})},i.prototype._loadFileAsync=function(t,e,n){if(this._isSupported&&this._db){var r,o;r=t.indexOf(".babylon")!==-1?"scenes":"textures";var l=this._db.transaction([r]);l.oncomplete=function(){o?e(o.data):n()},l.onabort=function(){n()};var d=l.objectStore(r).get(t);d.onsuccess=function(v){o=v.target.result},d.onerror=function(){_.a.Error("Error loading file "+t+" from DB."),n()}}else _.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e()},i.prototype._saveFileAsync=function(t,e,n,r,o){var l=this;if(this._isSupported){var d;d=t.indexOf(".babylon")!==-1?"scenes":"textures";var v,y=new se.a;y.open("GET",t+"?"+Date.now()),r&&(y.responseType="arraybuffer"),n&&(y.onprogress=n),y.addEventListener("load",function(){if(y.status===200||y.status<400&&i._ValidateXHRData(y,r?6:1))if(v=r?y.response:y.responseText,!l._hasReachedQuota&&l._db){var D,w=l._db.transaction([d],"readwrite");w.onabort=function(z){try{var k=z.srcElement.error;k&&k.name==="QuotaExceededError"&&(l._hasReachedQuota=!0)}catch(K){}e(v)},w.oncomplete=function(){e(v)},D=d==="scenes"?{sceneUrl:t,data:v,version:l._manifestVersionFound}:{textureUrl:t,data:v};try{var F=w.objectStore(d).put(D);F.onsuccess=function(){},F.onerror=function(){_.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(z){e(v)}}else e(v);else y.status>=400&&o?o(y):e()},!1),y.addEventListener("error",function(){_.a.Error("error on XHR request."),e()},!1),y.send()}else _.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e()},i._ValidateXHRData=function(t,e){e===void 0&&(e=7);try{if(1&e){if(t.responseText&&t.responseText.length>0)return!0;if(e===1)return!1}if(2&e){var n=yh.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(e===2)return!1}if(4&e){var r=new Uint8Array(t.response,0,3);return r[0]===68&&r[1]===68&&r[2]===83}}catch(o){}return!1},i.IsUASupportingBlobStorage=!0,i.IDBStorageEnabled=!1,i._ParseURL=function(t){document.createElement("a").href=t;var e=t.substring(0,t.lastIndexOf("#")),n=t.substring(e.lastIndexOf("/")+1,t.length);return t.substring(0,t.indexOf(n,0))},i._ReturnFullUrlLocation=function(t){return t.indexOf("http:/")===-1&&t.indexOf("https:/")===-1&&typeof window!="undefined"?i._ParseURL(window.location.href)+t:t},i}(),Um=function(){function i(t,e,n){this.gradient=t,this.color1=e,this.color2=n}return i.prototype.getColorToRef=function(t){this.color2?C.b.LerpToRef(this.color1,this.color2,Math.random(),t):t.copyFrom(this.color1)},i}(),ZT=function(i,t){this.gradient=i,this.color=t},Vm=function(){function i(t,e,n){this.gradient=t,this.factor1=e,this.factor2=n}return i.prototype.getFactor=function(){return this.factor2===void 0||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},i}(),Dr=function(){function i(){}return i.GetCurrentGradient=function(t,e,n){if(e[0].gradient>t)n(e[0],e[0],1);else{for(var r=0;r<e.length-1;r++){var o=e[r],l=e[r+1];if(t>=o.gradient&&t<=l.gradient)return void n(o,l,(t-o.gradient)/(l.gradient-o.gradient))}var d=e.length-1;n(e[d],e[d],1)}},i}(),$T=function(){function i(t){this.particleSystem=t,this.position=h.e.Zero(),this.direction=h.e.Zero(),this.color=new C.b(0,0,0,0),this.colorStep=new C.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new h.d(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new C.b(0,0,0,0),this._currentColor2=new C.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=i._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return i.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},i.prototype.updateCellIndex=function(){var t=this.age,e=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(this._randomCellOffset===void 0&&(this._randomCellOffset=Math.random()*this.lifeTime),e===0?(e=1,t=this._randomCellOffset):t+=this._randomCellOffset);var n=this._initialEndSpriteCellID-this._initialStartSpriteCellID,r=J.a.Clamp(t*e%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+r*n|0},i.prototype._inheritParticleInfoToSubEmitter=function(t){if(t.particleSystem.emitter.position){var e=t.particleSystem.emitter;if(e.position.copyFrom(this.position),t.inheritDirection){var n=h.c.Vector3[0];this.direction.normalizeToRef(n),e.setDirection(n,0,Math.PI/2)}}else t.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(t.inheritedVelocityAmount/2,h.c.Vector3[0]),t.particleSystem._inheritedVelocityOffset.copyFrom(h.c.Vector3[0])},i.prototype._inheritParticleInfoToSubEmitters=function(){var t=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(e){t._inheritParticleInfoToSubEmitter(e)})},i.prototype._reset=function(){this.age=0,this.id=i._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},i.prototype.copyTo=function(t){t.position.copyFrom(this.position),this._initialDirection?t._initialDirection?t._initialDirection.copyFrom(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.copyFrom(this.direction),this._localPosition&&(t._localPosition?t._localPosition.copyFrom(this._localPosition):t._localPosition=this._localPosition.clone()),t.color.copyFrom(this.color),t.colorStep.copyFrom(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.copyFrom(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.copyFrom(this._currentColor1),t._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.copyFrom(this.remapData):t.remapData=new h.f(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},i._Count=0,i}();(function(i){i[i.ATTACHED=0]="ATTACHED",i[i.END=1]="END"})(Os||(Os={}));var vl=function(){function i(t){if(this.particleSystem=t,this.type=Os.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.emitter||!t.emitter.dispose){var e=R.a.GetClass("BABYLON.AbstractMesh");t.emitter=new e("SubemitterSystemEmitter",t.getScene())}t.onDisposeObservable.add(function(){t.emitter&&t.emitter.dispose&&t.emitter.dispose()})}return i.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof h.e?t=t.clone():t.getClassName().indexOf("Mesh")!==-1&&((t=new(R.a.GetClass("BABYLON.Mesh"))("",t.getScene())).isVisible=!1):t=new h.e;var e=new i(this.particleSystem.clone("",t));return e.particleSystem.name+="Clone",e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem._disposeEmitterOnDispose=!0,e.particleSystem.disposeOnStop=!0,e},i.prototype.serialize=function(){var t={};return t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem=this.particleSystem.serialize(),t},i._ParseParticleSystem=function(t,e,n){throw dr.a.WarnImport("ParseParticle")},i.Parse=function(t,e,n){var r=t.particleSystem,o=new i(i._ParseParticleSystem(r,e,n));return o.type=t.type,o.inheritDirection=t.inheritDirection,o.inheritedVelocityAmount=t.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},i.prototype.dispose=function(){this.particleSystem.dispose()},i}(),Gw=`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`;Qe.a.ShadersStore.particlesPixelShader=Gw;var Hw=`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos;
#endif

varying vec2 vUV;
varying vec4 vColor;
varying vec3 vPositionW;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#endif
void main(void) {
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD

vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;
vPositionW=(invView*vec4(viewPos,1)).xyz;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0);
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vPositionW=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(vPositionW,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex*particlesInfos.z);
float columnOffset=cellIndex-rowOffset/particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;Qe.a.ShadersStore.particlesVertexShader=Hw;var er=function(i){function t(e,n,r,o,l,d){o===void 0&&(o=null),l===void 0&&(l=!1),d===void 0&&(d=.01);var v=i.call(this,e)||this;return v._inheritedVelocityOffset=new h.e,v.onDisposeObservable=new S.c,v.onStoppedObservable=new S.c,v._particles=new Array,v._stockParticles=new Array,v._newPartsExcess=0,v._vertexBuffers={},v._scaledColorStep=new C.b(0,0,0,0),v._colorDiff=new C.b(0,0,0,0),v._scaledDirection=h.e.Zero(),v._scaledGravity=h.e.Zero(),v._currentRenderId=-1,v._useInstancing=!1,v._started=!1,v._stopped=!1,v._actualFrame=0,v._currentEmitRate1=0,v._currentEmitRate2=0,v._currentStartSize1=0,v._currentStartSize2=0,v._rawTextureWidth=256,v._useRampGradients=!1,v._disposeEmitterOnDispose=!1,v.isLocal=!1,v._onBeforeDrawParticlesObservable=null,v.recycleParticle=function(y){var D=v._particles.pop();D!==y&&D.copyTo(y),v._stockParticles.push(D)},v._createParticle=function(){var y;if(v._stockParticles.length!==0?(y=v._stockParticles.pop())._reset():y=new $T(v),v._subEmitters&&v._subEmitters.length>0){var D=v._subEmitters[Math.floor(Math.random()*v._subEmitters.length)];y._attachedSubEmitters=[],D.forEach(function(w){if(w.type===Os.ATTACHED){var F=w.clone();y._attachedSubEmitters.push(F),F.particleSystem.start()}})}return y},v._emitFromParticle=function(y){if(v._subEmitters&&v._subEmitters.length!==0){var D=Math.floor(Math.random()*v._subEmitters.length);v._subEmitters[D].forEach(function(w){if(w.type===Os.END){var F=w.clone();y._inheritParticleInfoToSubEmitter(F),F.particleSystem._rootParticleSystem=v,v.activeSubSystems.push(F.particleSystem),F.particleSystem.start()}})}},v._capacity=n,v._epsilon=d,v._isAnimationSheetEnabled=l,r&&r.getClassName()!=="Scene"?(v._engine=r,v.defaultProjectionMatrix=h.a.PerspectiveFovLH(.8,1,.1,100)):(v._scene=r||re.a.LastCreatedScene,v._engine=v._scene.getEngine(),v.uniqueId=v._scene.getUniqueId(),v._scene.particleSystems.push(v)),v._engine.getCaps().vertexArrayObject&&(v._vertexArrayObject=null),v._attachImageProcessingConfiguration(null),v._customEffect={0:o},v._useInstancing=v._engine.getCaps().instancedArrays,v._createIndexBuffer(),v._createVertexBuffers(),v.particleEmitterType=new Cs,v.updateFunction=function(y){var D=null,w=null;v.noiseTexture&&(D=v.noiseTexture.getSize(),w=v.noiseTexture.getContent());for(var F,z=function(){F=y[k];var K=v._scaledUpdateSpeed,ae=F.age;if(F.age+=K,F.age>F.lifeTime){var le=F.age-ae;K=(F.lifeTime-ae)*K/le,F.age=F.lifeTime}var fe=F.age/F.lifeTime;v._colorGradients&&v._colorGradients.length>0?Dr.GetCurrentGradient(fe,v._colorGradients,function(Re,Pe,Ce){Re!==F._currentColorGradient&&(F._currentColor1.copyFrom(F._currentColor2),Pe.getColorToRef(F._currentColor2),F._currentColorGradient=Re),C.b.LerpToRef(F._currentColor1,F._currentColor2,Ce,F.color)}):(F.colorStep.scaleToRef(K,v._scaledColorStep),F.color.addInPlace(v._scaledColorStep),F.color.a<0&&(F.color.a=0)),v._angularSpeedGradients&&v._angularSpeedGradients.length>0&&Dr.GetCurrentGradient(fe,v._angularSpeedGradients,function(Re,Pe,Ce){Re!==F._currentAngularSpeedGradient&&(F._currentAngularSpeed1=F._currentAngularSpeed2,F._currentAngularSpeed2=Pe.getFactor(),F._currentAngularSpeedGradient=Re),F.angularSpeed=J.a.Lerp(F._currentAngularSpeed1,F._currentAngularSpeed2,Ce)}),F.angle+=F.angularSpeed*K;var me=K;if(v._velocityGradients&&v._velocityGradients.length>0&&Dr.GetCurrentGradient(fe,v._velocityGradients,function(Re,Pe,Ce){Re!==F._currentVelocityGradient&&(F._currentVelocity1=F._currentVelocity2,F._currentVelocity2=Pe.getFactor(),F._currentVelocityGradient=Re),me*=J.a.Lerp(F._currentVelocity1,F._currentVelocity2,Ce)}),F.direction.scaleToRef(me,v._scaledDirection),v._limitVelocityGradients&&v._limitVelocityGradients.length>0&&Dr.GetCurrentGradient(fe,v._limitVelocityGradients,function(Re,Pe,Ce){Re!==F._currentLimitVelocityGradient&&(F._currentLimitVelocity1=F._currentLimitVelocity2,F._currentLimitVelocity2=Pe.getFactor(),F._currentLimitVelocityGradient=Re);var Ue=J.a.Lerp(F._currentLimitVelocity1,F._currentLimitVelocity2,Ce);F.direction.length()>Ue&&F.direction.scaleInPlace(v.limitVelocityDamping)}),v._dragGradients&&v._dragGradients.length>0&&Dr.GetCurrentGradient(fe,v._dragGradients,function(Re,Pe,Ce){Re!==F._currentDragGradient&&(F._currentDrag1=F._currentDrag2,F._currentDrag2=Pe.getFactor(),F._currentDragGradient=Re);var Ue=J.a.Lerp(F._currentDrag1,F._currentDrag2,Ce);v._scaledDirection.scaleInPlace(1-Ue)}),v.isLocal&&F._localPosition?(F._localPosition.addInPlace(v._scaledDirection),h.e.TransformCoordinatesToRef(F._localPosition,v._emitterWorldMatrix,F.position)):F.position.addInPlace(v._scaledDirection),w&&D&&F._randomNoiseCoordinates1){var be=v._fetchR(F._randomNoiseCoordinates1.x,F._randomNoiseCoordinates1.y,D.width,D.height,w),Ee=v._fetchR(F._randomNoiseCoordinates1.z,F._randomNoiseCoordinates2.x,D.width,D.height,w),xe=v._fetchR(F._randomNoiseCoordinates2.y,F._randomNoiseCoordinates2.z,D.width,D.height,w),Ae=h.c.Vector3[0],Ie=h.c.Vector3[1];Ae.copyFromFloats((2*be-1)*v.noiseStrength.x,(2*Ee-1)*v.noiseStrength.y,(2*xe-1)*v.noiseStrength.z),Ae.scaleToRef(K,Ie),F.direction.addInPlace(Ie)}if(v.gravity.scaleToRef(K,v._scaledGravity),F.direction.addInPlace(v._scaledGravity),v._sizeGradients&&v._sizeGradients.length>0&&Dr.GetCurrentGradient(fe,v._sizeGradients,function(Re,Pe,Ce){Re!==F._currentSizeGradient&&(F._currentSize1=F._currentSize2,F._currentSize2=Pe.getFactor(),F._currentSizeGradient=Re),F.size=J.a.Lerp(F._currentSize1,F._currentSize2,Ce)}),v._useRampGradients&&(v._colorRemapGradients&&v._colorRemapGradients.length>0&&Dr.GetCurrentGradient(fe,v._colorRemapGradients,function(Re,Pe,Ce){var Ue=J.a.Lerp(Re.factor1,Pe.factor1,Ce),Oe=J.a.Lerp(Re.factor2,Pe.factor2,Ce);F.remapData.x=Ue,F.remapData.y=Oe-Ue}),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&Dr.GetCurrentGradient(fe,v._alphaRemapGradients,function(Re,Pe,Ce){var Ue=J.a.Lerp(Re.factor1,Pe.factor1,Ce),Oe=J.a.Lerp(Re.factor2,Pe.factor2,Ce);F.remapData.z=Ue,F.remapData.w=Oe-Ue})),v._isAnimationSheetEnabled&&F.updateCellIndex(),F._inheritParticleInfoToSubEmitters(),F.age>=F.lifeTime)return v._emitFromParticle(F),F._attachedSubEmitters&&(F._attachedSubEmitters.forEach(function(Re){Re.particleSystem.disposeOnStop=!0,Re.particleSystem.stop()}),F._attachedSubEmitters=null),v.recycleParticle(F),k--,"continue"},k=0;k<y.length;k++)z()},v}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),t.prototype.getActiveCount=function(){return this._particles.length},t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype.isStopping=function(){return this._stopped&&this.isAlive()},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),t.prototype._addFactorGradient=function(e,n,r,o){var l=new Vm(n,r,o);e.push(l),e.sort(function(d,v){return d.gradient<v.gradient?-1:d.gradient>v.gradient?1:0})},t.prototype._removeFactorGradient=function(e,n){if(e)for(var r=0,o=0,l=e;o<l.length;o++){if(l[o].gradient===n){e.splice(r,1);break}r++}},t.prototype.addLifeTimeGradient=function(e,n,r){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,n,r),this},t.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},t.prototype.addSizeGradient=function(e,n,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n,r),this},t.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},t.prototype.addColorRemapGradient=function(e,n,r){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,n,r),this},t.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,n,r),this},t.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},t.prototype.addAngularSpeedGradient=function(e,n,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n,r),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},t.prototype.addVelocityGradient=function(e,n,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n,r),this},t.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},t.prototype.addLimitVelocityGradient=function(e,n,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n,r),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},t.prototype.addDragGradient=function(e,n,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n,r),this},t.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},t.prototype.addEmitRateGradient=function(e,n,r){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,n,r),this},t.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype.addStartSizeGradient=function(e,n,r){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,n,r),this},t.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._startSizeGradients,e),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var e=new Uint8Array(4*this._rawTextureWidth),n=C.c.Color3[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;Dr.GetCurrentGradient(o,this._rampGradients,function(l,d,v){C.a.LerpToRef(l.color,d.color,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255})}this._rampGradientsTexture=xr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},t.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort(function(e,n){return e.gradient<n.gradient?-1:e.gradient>n.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},t.prototype.addRampGradient=function(e,n){this._rampGradients||(this._rampGradients=[]);var r=new ZT(e,n);return this._rampGradients.push(r),this._syncRampGradientTexture(),this},t.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Um(e,n,r);return this._colorGradients.push(o),this._colorGradients.sort(function(l,d){return l.gradient<d.gradient?-1:l.gradient>d.gradient?1:0}),this},t.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var n=0,r=0,o=this._colorGradients;r<o.length;r++){if(o[r].gradient===e){this._colorGradients.splice(n,1);break}n++}return this},t.prototype._fetchR=function(e,n,r,o,l){return l[4*(((e=.5*Math.abs(e)+.5)*r%r|0)+((n=.5*Math.abs(n)+.5)*o%o|0)*r)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._engine;this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new De.a(e,this._vertexData,!0,this._vertexBufferSize);var n=0,r=this._vertexBuffer.createVertexBuffer(De.b.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.PositionKind]=r,n+=3;var o=this._vertexBuffer.createVertexBuffer(De.b.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.ColorKind]=o,n+=4;var l=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=l,n+=1;var d,v=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,n+=2,this._isAnimationSheetEnabled){var y=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=y,n+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var D=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=D,n+=3}if(this._useRampGradients){var w=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=w,n+=4}if(this._useInstancing){var F=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new De.a(e,F,!1,2),d=this._spriteBuffer.createVertexBuffer("offset",0,2)}else d=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=d},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],n=0,r=0;r<this._capacity;r++)e.push(n),e.push(n+1),e.push(n+2),e.push(n),e.push(n+2),e.push(n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(n){n instanceof t?e._subEmitters.push([new vl(n)]):n instanceof vl?e._subEmitters.push([n]):n instanceof Array&&e._subEmitters.push(n)})},t.prototype.start=function(e){var n,r=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){r.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&this._subEmitters.length!=0&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){((n=this.emitter)===null||n===void 0?void 0:n.getClassName().indexOf("Mesh"))!==-1&&this.emitter.computeWorldMatrix(!0);var o=this.noiseTexture;if(o&&o.onGeneratedObservable)o.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var d=0;d<r.preWarmCycles;d++)r.animate(!0),o.render()})});else for(var l=0;l<this.preWarmCycles;l++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(e){e===void 0&&(e=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,e&&this._stopSubEmitters())},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(e,n,r,o){var l=e*this._vertexBufferSize;if(this._vertexData[l++]=n.position.x+this.worldOffset.x,this._vertexData[l++]=n.position.y+this.worldOffset.y,this._vertexData[l++]=n.position.z+this.worldOffset.z,this._vertexData[l++]=n.color.r,this._vertexData[l++]=n.color.g,this._vertexData[l++]=n.color.b,this._vertexData[l++]=n.color.a,this._vertexData[l++]=n.angle,this._vertexData[l++]=n.scale.x*n.size,this._vertexData[l++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[l++]=n.cellIndex),this._isBillboardBased)this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[l++]=n.direction.x,this._vertexData[l++]=n.direction.y,this._vertexData[l++]=n.direction.z);else if(n._initialDirection){var d=n._initialDirection;this.isLocal&&(h.e.TransformNormalToRef(d,this._emitterWorldMatrix,h.c.Vector3[0]),d=h.c.Vector3[0]),d.x===0&&d.z===0&&(d.x=.001),this._vertexData[l++]=d.x,this._vertexData[l++]=d.y,this._vertexData[l++]=d.z}else{var v=n.direction;this.isLocal&&(h.e.TransformNormalToRef(v,this._emitterWorldMatrix,h.c.Vector3[0]),v=h.c.Vector3[0]),v.x===0&&v.z===0&&(v.x=.001),this._vertexData[l++]=v.x,this._vertexData[l++]=v.y,this._vertexData[l++]=v.z}this._useRampGradients&&n.remapData&&(this._vertexData[l++]=n.remapData.x,this._vertexData[l++]=n.remapData.y,this._vertexData[l++]=n.remapData.z,this._vertexData[l++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),o===0?o=this._epsilon:o===1&&(o=1-this._epsilon)),this._vertexData[l++]=r,this._vertexData[l++]=o)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);e!==-1&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},t.prototype._update=function(e){var n,r=this;if(this._alive=this._particles.length>0,this.emitter.position){var o=this.emitter;this._emitterWorldMatrix=o.getWorldMatrix()}else{var l=this.emitter;this._emitterWorldMatrix=h.a.Translation(l.x,l.y,l.z)}this.updateFunction(this._particles);for(var d,v=function(){if(y._particles.length===y._capacity)return"break";if(n=y._createParticle(),y._particles.push(n),y.targetStopDuration&&y._lifeTimeGradients&&y._lifeTimeGradients.length>0){var w=J.a.Clamp(y._actualFrame/y.targetStopDuration);Dr.GetCurrentGradient(w,y._lifeTimeGradients,function(k,K){var ae=k,le=K,fe=ae.getFactor(),me=le.getFactor(),be=(w-ae.gradient)/(le.gradient-ae.gradient);n.lifeTime=J.a.Lerp(fe,me,be)})}else n.lifeTime=J.a.RandomRange(y.minLifeTime,y.maxLifeTime);var F=J.a.RandomRange(y.minEmitPower,y.maxEmitPower);if(y.startPositionFunction?y.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal):y.particleEmitterType.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal),y.isLocal&&(n._localPosition?n._localPosition.copyFrom(n.position):n._localPosition=n.position.clone(),h.e.TransformCoordinatesToRef(n._localPosition,y._emitterWorldMatrix,n.position)),y.startDirectionFunction?y.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal):y.particleEmitterType.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal),F===0?n._initialDirection?n._initialDirection.copyFrom(n.direction):n._initialDirection=n.direction.clone():n._initialDirection=null,n.direction.scaleInPlace(F),y._sizeGradients&&y._sizeGradients.length!==0?(n._currentSizeGradient=y._sizeGradients[0],n._currentSize1=n._currentSizeGradient.getFactor(),n.size=n._currentSize1,y._sizeGradients.length>1?n._currentSize2=y._sizeGradients[1].getFactor():n._currentSize2=n._currentSize1):n.size=J.a.RandomRange(y.minSize,y.maxSize),n.scale.copyFromFloats(J.a.RandomRange(y.minScaleX,y.maxScaleX),J.a.RandomRange(y.minScaleY,y.maxScaleY)),y._startSizeGradients&&y._startSizeGradients[0]&&y.targetStopDuration){var z=y._actualFrame/y.targetStopDuration;Dr.GetCurrentGradient(z,y._startSizeGradients,function(k,K,ae){k!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=K.getFactor(),r._currentStartSizeGradient=k);var le=J.a.Lerp(r._currentStartSize1,r._currentStartSize2,ae);n.scale.scaleInPlace(le)})}y._angularSpeedGradients&&y._angularSpeedGradients.length!==0?(n._currentAngularSpeedGradient=y._angularSpeedGradients[0],n.angularSpeed=n._currentAngularSpeedGradient.getFactor(),n._currentAngularSpeed1=n.angularSpeed,y._angularSpeedGradients.length>1?n._currentAngularSpeed2=y._angularSpeedGradients[1].getFactor():n._currentAngularSpeed2=n._currentAngularSpeed1):n.angularSpeed=J.a.RandomRange(y.minAngularSpeed,y.maxAngularSpeed),n.angle=J.a.RandomRange(y.minInitialRotation,y.maxInitialRotation),y._velocityGradients&&y._velocityGradients.length>0&&(n._currentVelocityGradient=y._velocityGradients[0],n._currentVelocity1=n._currentVelocityGradient.getFactor(),y._velocityGradients.length>1?n._currentVelocity2=y._velocityGradients[1].getFactor():n._currentVelocity2=n._currentVelocity1),y._limitVelocityGradients&&y._limitVelocityGradients.length>0&&(n._currentLimitVelocityGradient=y._limitVelocityGradients[0],n._currentLimitVelocity1=n._currentLimitVelocityGradient.getFactor(),y._limitVelocityGradients.length>1?n._currentLimitVelocity2=y._limitVelocityGradients[1].getFactor():n._currentLimitVelocity2=n._currentLimitVelocity1),y._dragGradients&&y._dragGradients.length>0&&(n._currentDragGradient=y._dragGradients[0],n._currentDrag1=n._currentDragGradient.getFactor(),y._dragGradients.length>1?n._currentDrag2=y._dragGradients[1].getFactor():n._currentDrag2=n._currentDrag1),y._colorGradients&&y._colorGradients.length!==0?(n._currentColorGradient=y._colorGradients[0],n._currentColorGradient.getColorToRef(n.color),n._currentColor1.copyFrom(n.color),y._colorGradients.length>1?y._colorGradients[1].getColorToRef(n._currentColor2):n._currentColor2.copyFrom(n.color)):(d=J.a.RandomRange(0,1),C.b.LerpToRef(y.color1,y.color2,d,n.color),y.colorDead.subtractToRef(n.color,y._colorDiff),y._colorDiff.scaleToRef(1/n.lifeTime,n.colorStep)),y._isAnimationSheetEnabled&&(n._initialStartSpriteCellID=y.startSpriteCellID,n._initialEndSpriteCellID=y.endSpriteCellID),n.direction.addInPlace(y._inheritedVelocityOffset),y._useRampGradients&&(n.remapData=new h.f(0,1,0,1)),y.noiseTexture&&(n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(n._randomNoiseCoordinates1=new h.e(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2=new h.e(Math.random(),Math.random(),Math.random()))),n._inheritParticleInfoToSubEmitters()},y=this,D=0;D<e&&v()!=="break";D++);},t._GetAttributeNamesOrOptions=function(e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=[De.b.PositionKind,De.b.ColorKind,"angle","offset","size"];return e&&o.push("cellIndex"),n||o.push("direction"),r&&o.push("remapData"),o},t._GetEffectCreationOptions=function(e){e===void 0&&(e=!1);var n=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return e&&n.push("particlesInfos"),n},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),n===t.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&e.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case t.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push.apply(n,t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients)),e.push.apply(e,t._GetEffectCreationOptions(this._isAnimationSheetEnabled)),r.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(fr.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),fr.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._getEffect=function(e){var n=this.getCustomEffect(e);if(n)return n;var r=[];this.fillDefines(r,e);var o=r.join(`
`);if(this._cachedDefines!==o){this._cachedDefines=o;var l=[],d=[],v=[];this.fillUniformsAttributesAndSamplerNames(d,l,v),this._effect=this._engine.createEffect("particles",l,d,v,o)}return this._effect},t.prototype.animate=function(e){var n,r=this;if(e===void 0&&(e=!1),this._started){if(!e&&this._scene){if(!this.isReady()||this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var o;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this.manualEmitCount>-1)o=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var l=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var d=this._actualFrame/this.targetStopDuration;Dr.GetCurrentGradient(d,this._emitRateGradients,function(w,F,z){w!==r._currentEmitRateGradient&&(r._currentEmitRate1=r._currentEmitRate2,r._currentEmitRate2=F.getFactor(),r._currentEmitRateGradient=w),l=J.a.Lerp(r._currentEmitRate1,r._currentEmitRate2,z)})}o=l*this._scaledUpdateSpeed>>0,this._newPartsExcess+=l*this._scaledUpdateSpeed-o}if(this._newPartsExcess>1&&(o+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?o=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(o),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){for(var v=0,y=0;y<this._particles.length;y++){var D=this._particles[y];this._appendParticleVertices(v,D),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}this.manualEmitCount===0&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(e,n){this._appendParticleVertex(e++,n,0,0),this._useInstancing||(this._appendParticleVertex(e++,n,1,0),this._appendParticleVertex(e++,n,1,1),this._appendParticleVertex(e++,n,0,1))},t.prototype.rebuild=function(){for(var e in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},t.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady()||!this._getEffect(t.BLENDMODE_ADD).isReady())return!1;return!0},t.prototype._render=function(e){var n,r,o=this._getEffect(e),l=this._engine;l.enableEffect(o);var d=(n=this.defaultViewMatrix)!==null&&n!==void 0?n:this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",d),o.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var v=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var y=this._scene.activeCamera;o.setVector3("eyePosition",y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));var D=o.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&R0.a.BindClipPlane(o,this._scene),D.indexOf("#define BILLBOARDMODE_ALL")>=0&&(d.invertToRef(h.c.Matrix[0]),o.setMatrix("invView",h.c.Matrix[0])),this._vertexArrayObject!==void 0?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):l.bindBuffers(this._vertexBuffers,this._indexBuffer,o),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),e){case t.BLENDMODE_ADD:l.setAlphaMode(g.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:l.setAlphaMode(g.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:l.setAlphaMode(g.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:l.setAlphaMode(g.a.ALPHA_MULTIPLY)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing?l.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._particles.length):l.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._engine;e.setState&&(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0));var n=0;return n=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(g.a.ALPHA_DISABLE),n},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var n=0;n<this._subEmitters.length;n++)for(var r=0,o=this._subEmitters[n];r<o.length;r++)o[r].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene&&((n=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(n,1),this._scene._activeParticleSystems.dispose()),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},t.prototype.clone=function(e,n){var r=Object(f.a)({},this._customEffect),o=null,l=this._engine;if(l.createEffectForParticles&&this.customShader!=null){var d=(o=this.customShader).shaderOptions.defines.length>0?o.shaderOptions.defines.join(`
`):"";r[0]=l.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,d)}var v=this.serialize(),y=t.Parse(v,this._scene||this._engine,"");return y.name=e,y.customShader=o,y._customEffect=r,n===void 0&&(n=this.emitter),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.emitter=n,this.preventAutoStart||y.start(),y},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};if(t._Serialize(n,this,e),n.textureMask=this.textureMask.asArray(),n.customShader=this.customShader,n.preventAutoStart=this.preventAutoStart,this.subEmitters){n.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var r=0,o=this._subEmitters;r<o.length;r++){for(var l=[],d=0,v=o[r];d<v.length;d++){var y=v[d];l.push(y.serialize())}n.subEmitters.push(l)}}return n},t._Serialize=function(e,n,r){if(e.name=n.name,e.id=n.id,e.capacity=n.getCapacity(),n.emitter.position){var o=n.emitter;e.emitterId=o.id}else{var l=n.emitter;e.emitter=l.asArray()}n.particleEmitterType&&(e.particleEmitterType=n.particleEmitterType.serialize()),n.particleTexture&&(r?e.texture=n.particleTexture.serialize():(e.textureName=n.particleTexture.name,e.invertY=!!n.particleTexture._invertY)),e.isLocal=n.isLocal,B.a.AppendSerializedAnimations(n,e),e.beginAnimationOnStart=n.beginAnimationOnStart,e.beginAnimationFrom=n.beginAnimationFrom,e.beginAnimationTo=n.beginAnimationTo,e.beginAnimationLoop=n.beginAnimationLoop,e.startDelay=n.startDelay,e.renderingGroupId=n.renderingGroupId,e.isBillboardBased=n.isBillboardBased,e.billboardMode=n.billboardMode,e.minAngularSpeed=n.minAngularSpeed,e.maxAngularSpeed=n.maxAngularSpeed,e.minSize=n.minSize,e.maxSize=n.maxSize,e.minScaleX=n.minScaleX,e.maxScaleX=n.maxScaleX,e.minScaleY=n.minScaleY,e.maxScaleY=n.maxScaleY,e.minEmitPower=n.minEmitPower,e.maxEmitPower=n.maxEmitPower,e.minLifeTime=n.minLifeTime,e.maxLifeTime=n.maxLifeTime,e.emitRate=n.emitRate,e.gravity=n.gravity.asArray(),e.noiseStrength=n.noiseStrength.asArray(),e.color1=n.color1.asArray(),e.color2=n.color2.asArray(),e.colorDead=n.colorDead.asArray(),e.updateSpeed=n.updateSpeed,e.targetStopDuration=n.targetStopDuration,e.blendMode=n.blendMode,e.preWarmCycles=n.preWarmCycles,e.preWarmStepOffset=n.preWarmStepOffset,e.minInitialRotation=n.minInitialRotation,e.maxInitialRotation=n.maxInitialRotation,e.startSpriteCellID=n.startSpriteCellID,e.endSpriteCellID=n.endSpriteCellID,e.spriteCellChangeSpeed=n.spriteCellChangeSpeed,e.spriteCellWidth=n.spriteCellWidth,e.spriteCellHeight=n.spriteCellHeight,e.spriteRandomStartCell=n.spriteRandomStartCell,e.isAnimationSheetEnabled=n.isAnimationSheetEnabled;var d=n.getColorGradients();if(d){e.colorGradients=[];for(var v=0,y=d;v<y.length;v++){var D=y[v],w={gradient:D.gradient,color1:D.color1.asArray()};D.color2?w.color2=D.color2.asArray():w.color2=D.color1.asArray(),e.colorGradients.push(w)}}var F=n.getRampGradients();if(F){e.rampGradients=[];for(var z=0,k=F;z<k.length;z++){var K=k[z];w={gradient:K.gradient,color:K.color.asArray()},e.rampGradients.push(w)}e.useRampGradients=n.useRampGradients}var ae=n.getColorRemapGradients();if(ae){e.colorRemapGradients=[];for(var le=0,fe=ae;le<fe.length;le++){var me=fe[le];w={gradient:me.gradient,factor1:me.factor1},me.factor2!==void 0?w.factor2=me.factor2:w.factor2=me.factor1,e.colorRemapGradients.push(w)}}var be=n.getAlphaRemapGradients();if(be){e.alphaRemapGradients=[];for(var Ee=0,xe=be;Ee<xe.length;Ee++){var Ae=xe[Ee];w={gradient:Ae.gradient,factor1:Ae.factor1},Ae.factor2!==void 0?w.factor2=Ae.factor2:w.factor2=Ae.factor1,e.alphaRemapGradients.push(w)}}var Ie=n.getSizeGradients();if(Ie){e.sizeGradients=[];for(var Re=0,Pe=Ie;Re<Pe.length;Re++){var Ce=Pe[Re];w={gradient:Ce.gradient,factor1:Ce.factor1},Ce.factor2!==void 0?w.factor2=Ce.factor2:w.factor2=Ce.factor1,e.sizeGradients.push(w)}}var Ue=n.getAngularSpeedGradients();if(Ue){e.angularSpeedGradients=[];for(var Oe=0,Ve=Ue;Oe<Ve.length;Oe++){var Le=Ve[Oe];w={gradient:Le.gradient,factor1:Le.factor1},Le.factor2!==void 0?w.factor2=Le.factor2:w.factor2=Le.factor1,e.angularSpeedGradients.push(w)}}var ze=n.getVelocityGradients();if(ze){e.velocityGradients=[];for(var tt=0,ut=ze;tt<ut.length;tt++){var ft=ut[tt];w={gradient:ft.gradient,factor1:ft.factor1},ft.factor2!==void 0?w.factor2=ft.factor2:w.factor2=ft.factor1,e.velocityGradients.push(w)}}var vt=n.getDragGradients();if(vt){e.dragGradients=[];for(var rt=0,mt=vt;rt<mt.length;rt++){var pt=mt[rt];w={gradient:pt.gradient,factor1:pt.factor1},pt.factor2!==void 0?w.factor2=pt.factor2:w.factor2=pt.factor1,e.dragGradients.push(w)}}var it=n.getEmitRateGradients();if(it){e.emitRateGradients=[];for(var yt=0,We=it;yt<We.length;yt++){var at=We[yt];w={gradient:at.gradient,factor1:at.factor1},at.factor2!==void 0?w.factor2=at.factor2:w.factor2=at.factor1,e.emitRateGradients.push(w)}}var It=n.getStartSizeGradients();if(It){e.startSizeGradients=[];for(var vn=0,Jt=It;vn<Jt.length;vn++){var Sn=Jt[vn];w={gradient:Sn.gradient,factor1:Sn.factor1},Sn.factor2!==void 0?w.factor2=Sn.factor2:w.factor2=Sn.factor1,e.startSizeGradients.push(w)}}var Rt=n.getLifeTimeGradients();if(Rt){e.lifeTimeGradients=[];for(var Rn=0,bn=Rt;Rn<bn.length;Rn++){var hn=bn[Rn];w={gradient:hn.gradient,factor1:hn.factor1},hn.factor2!==void 0?w.factor2=hn.factor2:w.factor2=hn.factor1,e.lifeTimeGradients.push(w)}}var yn=n.getLimitVelocityGradients();if(yn){e.limitVelocityGradients=[];for(var Lt=0,Kt=yn;Lt<Kt.length;Lt++){var In=Kt[Lt];w={gradient:In.gradient,factor1:In.factor1},In.factor2!==void 0?w.factor2=In.factor2:w.factor2=In.factor1,e.limitVelocityGradients.push(w)}e.limitVelocityDamping=n.limitVelocityDamping}n.noiseTexture&&(e.noiseTexture=n.noiseTexture.serialize())},t._Parse=function(e,n,r,o){var l;l=r instanceof en.a?null:r;var d,v=R.a.GetClass("BABYLON.Texture");if(v&&l&&(e.texture?n.particleTexture=v.Parse(e.texture,l,o):e.textureName&&(n.particleTexture=new v(o+e.textureName,l,!1,e.invertY===void 0||e.invertY),n.particleTexture.name=e.textureName)),e.emitterId||e.emitterId===0||e.emitter!==void 0?e.emitterId&&l?n.emitter=l.getLastMeshByID(e.emitterId):n.emitter=h.e.FromArray(e.emitter):n.emitter=h.e.Zero(),n.isLocal=!!e.isLocal,e.renderingGroupId!==void 0&&(n.renderingGroupId=e.renderingGroupId),e.isBillboardBased!==void 0&&(n.isBillboardBased=e.isBillboardBased),e.billboardMode!==void 0&&(n.billboardMode=e.billboardMode),e.animations){for(var y=0;y<e.animations.length;y++){var D=e.animations[y],w=R.a.GetClass("BABYLON.Animation");w&&n.animations.push(w.Parse(D))}n.beginAnimationOnStart=e.beginAnimationOnStart,n.beginAnimationFrom=e.beginAnimationFrom,n.beginAnimationTo=e.beginAnimationTo,n.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&l&&l.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n.startDelay=0|e.startDelay,n.minAngularSpeed=e.minAngularSpeed,n.maxAngularSpeed=e.maxAngularSpeed,n.minSize=e.minSize,n.maxSize=e.maxSize,e.minScaleX&&(n.minScaleX=e.minScaleX,n.maxScaleX=e.maxScaleX,n.minScaleY=e.minScaleY,n.maxScaleY=e.maxScaleY),e.preWarmCycles!==void 0&&(n.preWarmCycles=e.preWarmCycles,n.preWarmStepOffset=e.preWarmStepOffset),e.minInitialRotation!==void 0&&(n.minInitialRotation=e.minInitialRotation,n.maxInitialRotation=e.maxInitialRotation),n.minLifeTime=e.minLifeTime,n.maxLifeTime=e.maxLifeTime,n.minEmitPower=e.minEmitPower,n.maxEmitPower=e.maxEmitPower,n.emitRate=e.emitRate,n.gravity=h.e.FromArray(e.gravity),e.noiseStrength&&(n.noiseStrength=h.e.FromArray(e.noiseStrength)),n.color1=C.b.FromArray(e.color1),n.color2=C.b.FromArray(e.color2),n.colorDead=C.b.FromArray(e.colorDead),n.updateSpeed=e.updateSpeed,n.targetStopDuration=e.targetStopDuration,n.blendMode=e.blendMode,e.colorGradients)for(var F=0,z=e.colorGradients;F<z.length;F++){var k=z[F];n.addColorGradient(k.gradient,C.b.FromArray(k.color1),k.color2?C.b.FromArray(k.color2):void 0)}if(e.rampGradients){for(var K=0,ae=e.rampGradients;K<ae.length;K++){var le=ae[K];n.addRampGradient(le.gradient,C.a.FromArray(le.color))}n.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var fe=0,me=e.colorRemapGradients;fe<me.length;fe++){var be=me[fe];n.addColorRemapGradient(be.gradient,be.factor1!==void 0?be.factor1:be.factor,be.factor2)}if(e.alphaRemapGradients)for(var Ee=0,xe=e.alphaRemapGradients;Ee<xe.length;Ee++){var Ae=xe[Ee];n.addAlphaRemapGradient(Ae.gradient,Ae.factor1!==void 0?Ae.factor1:Ae.factor,Ae.factor2)}if(e.sizeGradients)for(var Ie=0,Re=e.sizeGradients;Ie<Re.length;Ie++){var Pe=Re[Ie];n.addSizeGradient(Pe.gradient,Pe.factor1!==void 0?Pe.factor1:Pe.factor,Pe.factor2)}if(e.angularSpeedGradients)for(var Ce=0,Ue=e.angularSpeedGradients;Ce<Ue.length;Ce++){var Oe=Ue[Ce];n.addAngularSpeedGradient(Oe.gradient,Oe.factor1!==void 0?Oe.factor1:Oe.factor,Oe.factor2)}if(e.velocityGradients)for(var Ve=0,Le=e.velocityGradients;Ve<Le.length;Ve++){var ze=Le[Ve];n.addVelocityGradient(ze.gradient,ze.factor1!==void 0?ze.factor1:ze.factor,ze.factor2)}if(e.dragGradients)for(var tt=0,ut=e.dragGradients;tt<ut.length;tt++){var ft=ut[tt];n.addDragGradient(ft.gradient,ft.factor1!==void 0?ft.factor1:ft.factor,ft.factor2)}if(e.emitRateGradients)for(var vt=0,rt=e.emitRateGradients;vt<rt.length;vt++){var mt=rt[vt];n.addEmitRateGradient(mt.gradient,mt.factor1!==void 0?mt.factor1:mt.factor,mt.factor2)}if(e.startSizeGradients)for(var pt=0,it=e.startSizeGradients;pt<it.length;pt++){var yt=it[pt];n.addStartSizeGradient(yt.gradient,yt.factor1!==void 0?yt.factor1:yt.factor,yt.factor2)}if(e.lifeTimeGradients)for(var We=0,at=e.lifeTimeGradients;We<at.length;We++){var It=at[We];n.addLifeTimeGradient(It.gradient,It.factor1!==void 0?It.factor1:It.factor,It.factor2)}if(e.limitVelocityGradients){for(var vn=0,Jt=e.limitVelocityGradients;vn<Jt.length;vn++){var Sn=Jt[vn];n.addLimitVelocityGradient(Sn.gradient,Sn.factor1!==void 0?Sn.factor1:Sn.factor,Sn.factor2)}n.limitVelocityDamping=e.limitVelocityDamping}if(e.noiseTexture&&l){var Rt=R.a.GetClass("BABYLON.ProceduralTexture");n.noiseTexture=Rt.Parse(e.noiseTexture,l,o)}if(e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":d=new Ah;break;case"SphereDirectedParticleEmitter":d=new vm;break;case"ConeEmitter":case"ConeParticleEmitter":d=new pm;break;case"CylinderParticleEmitter":d=new xh;break;case"CylinderDirectedParticleEmitter":d=new mm;break;case"HemisphericParticleEmitter":d=new _m;break;case"PointParticleEmitter":d=new gm;break;case"MeshParticleEmitter":d=new V0;break;case"BoxEmitter":case"BoxParticleEmitter":default:d=new Cs}d.parse(e.particleEmitterType,l)}else(d=new Cs).parse(e,l);n.particleEmitterType=d,n.startSpriteCellID=e.startSpriteCellID,n.endSpriteCellID=e.endSpriteCellID,n.spriteCellWidth=e.spriteCellWidth,n.spriteCellHeight=e.spriteCellHeight,n.spriteCellChangeSpeed=e.spriteCellChangeSpeed,n.spriteRandomStartCell=e.spriteRandomStartCell},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var l,d=e.name,v=null,y=null;if(l=n instanceof en.a?n:n.getEngine(),e.customShader&&l.createEffectForParticles){var D=(y=e.customShader).shaderOptions.defines.length>0?y.shaderOptions.defines.join(`
`):"";v=l.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,D)}var w=new t(d,e.capacity,n,v,e.isAnimationSheetEnabled);if(w.customShader=y,e.id&&(w.id=e.id),e.subEmitters){w.subEmitters=[];for(var F=0,z=e.subEmitters;F<z.length;F++){for(var k=[],K=0,ae=z[F];K<ae.length;K++){var le=ae[K];k.push(vl.Parse(le,n,r))}w.subEmitters.push(k)}}return t._Parse(e,w,n,r),e.textureMask&&(w.textureMask=C.b.FromArray(e.textureMask)),e.preventAutoStart&&(w.preventAutoStart=e.preventAutoStart),o||w.preventAutoStart||w.start(),w},t.BILLBOARDMODE_Y=g.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=g.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=g.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(hl);vl._ParseParticleSystem=er.Parse,Qe.a.ShadersStore.gpuUpdateParticlesPixelShader=`#version 300 es
void main() {
discard;
}
`;var Ww=`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
#ifndef LOCAL
uniform mat4 emitterWM;
#endif
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
#ifdef CUSTOMEMITTER
in vec3 initialPosition;
#endif
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
#ifdef CUSTOMEMITTER
out vec3 outInitialPosition;
#endif
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta;

if (newAge>=life && stopFactor != 0.) {
vec3 newPosition;
vec3 newDirection;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=newAge-life;

outSeed=seed;

#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=vec3(0,0,0);
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
newDirection=newPosition+directionRandomizer*randoms3;
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

newDirection=newPosition+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
newPosition=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
newDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));
newDirection=normalize(newDirection);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.0001;
#else
float h=randoms2.y*height.y;

h=1.-h*h;
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
newPosition=vec3(randX,randY,randZ);

if (abs(cos(coneAngle)) == 1.0) {
newDirection=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
newDirection=normalize(newPosition+directionRandomizer*randoms3);
}
#elif defined(CUSTOMEMITTER)
newPosition=initialPosition;
outInitialPosition=initialPosition;
#else

newPosition=vec3(0.,0.,0.);

newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
#ifdef LOCAL
outPosition=newPosition;
#else
outPosition=(emitterWM*vec4(newPosition,1.)).xyz;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#ifndef BILLBOARD
outInitialDirection=direction;
#endif
#else
#ifdef LOCAL
vec3 initial=newDirection;
#else
vec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;
#endif
outDirection=initial*power;
#ifndef BILLBOARD
outInitialDirection=initial;
#endif
#endif
#ifdef ANIMATESHEET
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
#if defined(CUSTOMEMITTER)
outPosition=position+(direction-position)*ageGradient;
outInitialPosition=initialPosition;
#else
outPosition=position+direction*directionScale;
#endif
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif
#ifndef BILLBOARD
outInitialDirection=initialDirection;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#else
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
#endif
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#else
float cellStartOffset=0.;
#endif
float ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`;Qe.a.ShadersStore.gpuUpdateParticlesVertexShader=Ww;var Xw=`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif
#ifdef CLIPPLANE5
in float fClipDistance5;
#endif
#ifdef CLIPPLANE6
in float fClipDistance6;
#endif`;Qe.a.IncludesShadersStore.clipPlaneFragmentDeclaration2=Xw;var Yw=`#version 300 es
uniform sampler2D diffuseSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment>
vec4 textureColor=texture(diffuseSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`;Qe.a.ShadersStore.gpuRenderParticlesPixelShader=Yw;var Kw=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
out float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
out float fClipDistance6;
#endif`;Qe.a.IncludesShadersStore.clipPlaneVertexDeclaration2=Kw;var Qw=`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
uniform vec3 worldOffset;
#ifdef LOCAL
uniform mat4 emitterWM;
#endif

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
out vec3 vPositionW;
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=(position+worldOffset)-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=(position+worldOffset)-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

#ifdef LOCAL
vec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;
#else
vec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;
#endif
vPositionW=(invView*viewPosition).xyz;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vPositionW=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(vPositionW,1.0);
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;Qe.a.ShadersStore.gpuRenderParticlesVertexShader=Qw;var Ma=function(i){function t(e,n,r,o,l){o===void 0&&(o=!1),l===void 0&&(l=null);var d=i.call(this,e)||this;d.layerMask=268435455,d._accumulatedCount=0,d._targetIndex=0,d._currentRenderId=-1,d._started=!1,d._stopped=!1,d._timeDelta=0,d._actualFrame=0,d._rawTextureWidth=256,d.onDisposeObservable=new S.c,d.onStoppedObservable=new S.c,d.forceDepthWrite=!1,d._preWarmDone=!1,d.isLocal=!1,d._onBeforeDrawParticlesObservable=null,r&&r.getClassName()!=="Scene"?(d._engine=r,d.defaultProjectionMatrix=h.a.PerspectiveFovLH(.8,1,.1,100)):(d._scene=r||re.a.LastCreatedScene,d._engine=d._scene.getEngine(),d.uniqueId=d._scene.getUniqueId(),d._scene.particleSystems.push(d)),d._customEffect={0:l},d._attachImageProcessingConfiguration(null),n.randomTextureSize||delete n.randomTextureSize;var v=Object(f.a)({capacity:5e4,randomTextureSize:d._engine.getCaps().maxTextureSize},n),y=n;isFinite(y)&&(v.capacity=y),d._capacity=v.capacity,d._activeCount=v.capacity,d._currentActiveCount=0,d._isAnimationSheetEnabled=o,d._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},d.particleEmitterType=new Cs;for(var D=Math.min(d._engine.getCaps().maxTextureSize,v.randomTextureSize),w=[],F=0;F<D;++F)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());for(d._randomTexture=new xr(new Float32Array(w),D,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),d._randomTexture.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,d._randomTexture.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,w=[],F=0;F<D;++F)w.push(Math.random()),w.push(Math.random()),w.push(Math.random()),w.push(Math.random());return d._randomTexture2=new xr(new Float32Array(w),D,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),d._randomTexture2.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,d._randomTexture2.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,d._randomTextureSize=D,d}return Object(f.d)(t,i),Object.defineProperty(t,"IsSupported",{get:function(){return!!re.a.LastCreatedEngine&&re.a.LastCreatedEngine.webGLVersion>1},enumerable:!1,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&(!this._imageProcessingConfiguration||this._imageProcessingConfiguration.isReady())&&this._getEffect().isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.isStopped=function(){return this._stopped},t.prototype.isStopping=function(){return!1},t.prototype.getActiveCount=function(){return this._currentActiveCount},t.prototype.start=function(e){var n=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout(function(){n.start(0)},e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped||(this._stopped=!0)},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new S.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),t.prototype._removeGradientAndTexture=function(e,n,r){return i.prototype._removeGradientAndTexture.call(this,e,n,r),this._releaseBuffers(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Um(e,n);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this},t.prototype._refreshColorGradient=function(e){e===void 0&&(e=!1),this._colorGradients&&(e&&this._colorGradients.sort(function(n,r){return n.gradient<r.gradient?-1:n.gradient>r.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},t.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},t.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(e,n,r){var o=new Vm(n,r);e.push(o),this._releaseBuffers()},t.prototype.addSizeGradient=function(e,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype._refreshFactorGradient=function(e,n,r){r===void 0&&(r=!1),e&&(r&&e.sort(function(o,l){return o.gradient<l.gradient?-1:o.gradient>l.gradient?1:0}),this[n]&&(this[n].dispose(),this[n]=null))},t.prototype.addAngularSpeedGradient=function(e,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(e,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(e,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(e,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(e,n,r){return this},t.prototype.removeEmitRateGradient=function(e){return this},t.prototype.addStartSizeGradient=function(e,n,r){return this},t.prototype.removeStartSizeGradient=function(e){return this},t.prototype.addColorRemapGradient=function(e,n,r){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(e,n){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.addLifeTimeGradient=function(e,n,r){return this},t.prototype.removeLifeTimeGradient=function(e){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(e){var n={};n.position=e.createVertexBuffer("position",0,3);var r=3;this.particleEmitterType instanceof Rs&&(n.initialPosition=e.createVertexBuffer("initialPosition",r,3),r+=3),n.age=e.createVertexBuffer("age",r,1),r+=1,n.life=e.createVertexBuffer("life",r,1),r+=1,n.seed=e.createVertexBuffer("seed",r,4),r+=4,n.size=e.createVertexBuffer("size",r,3),r+=3,this._colorGradientsTexture||(n.color=e.createVertexBuffer("color",r,4),r+=4),n.direction=e.createVertexBuffer("direction",r,3),r+=3,this._isBillboardBased||(n.initialDirection=e.createVertexBuffer("initialDirection",r,3),r+=3),this._angularSpeedGradientsTexture?(n.angle=e.createVertexBuffer("angle",r,1),r+=1):(n.angle=e.createVertexBuffer("angle",r,2),r+=2),this._isAnimationSheetEnabled&&(n.cellIndex=e.createVertexBuffer("cellIndex",r,1),r+=1,this.spriteRandomStartCell&&(n.cellStartOffset=e.createVertexBuffer("cellStartOffset",r,1),r+=1)),this.noiseTexture&&(n.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",r,3),r+=3,n.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",r,3),r+=3);var o=this._engine.recordVertexArrayObject(n,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o},t.prototype._createRenderVAO=function(e,n){var r={};r.position=e.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var o=3;this.particleEmitterType instanceof Rs&&(o+=3),r.age=e.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,r.life=e.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=5,r.size=e.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,this._colorGradientsTexture||(r.color=e.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this.billboardMode===er.BILLBOARDMODE_STRETCHED&&(r.direction=e.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._isBillboardBased||(r.initialDirection=e.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3),r.angle=e.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(r.cellIndex=e.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(r.cellStartOffset=e.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),this.noiseTexture&&(r.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,r.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3),r.offset=n.createVertexBuffer("offset",0,2),r.uv=n.createVertexBuffer("uv",2,2);var l=this._engine.recordVertexArrayObject(r,null,this._getEffect());return this._engine.bindArrayBuffer(null),l},t.prototype._initialize=function(e){if(e===void 0&&(e=!1),!this._buffer0||e){var n=this._engine,r=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.particleEmitterType instanceof Rs&&(this._attributesStrideSize+=3),this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var o=this.particleEmitterType instanceof Rs,l=h.c.Vector3[0],d=0;d<this._capacity;d++)r.push(0),r.push(0),r.push(0),o&&(this.particleEmitterType.particlePositionGenerator(d,null,l),r.push(l.x),r.push(l.y),r.push(l.z)),r.push(0),r.push(0),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(0),r.push(0),r.push(0),this._colorGradientsTexture||(r.push(0),r.push(0),r.push(0),r.push(0)),o?(this.particleEmitterType.particleDestinationGenerator(d,null,l),r.push(l.x),r.push(l.y),r.push(l.z)):(r.push(0),r.push(0),r.push(0)),this.isBillboardBased||(r.push(0),r.push(0),r.push(0)),r.push(0),this._angularSpeedGradientsTexture||r.push(0),this._isAnimationSheetEnabled&&(r.push(0),this.spriteRandomStartCell&&r.push(0)),this.noiseTexture&&(r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()));var v=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new De.a(n,r,!1,this._attributesStrideSize),this._buffer1=new De.a(n,r,!1,this._attributesStrideSize),this._spriteBuffer=new De.a(n,v,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(e+=`
#define BILLBOARD`),this._colorGradientsTexture&&(e+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(e+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(e+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(e+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(e+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(e+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(e+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(e+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(e+=`
#define NOISE`),this.isLocal&&(e+=`
#define LOCAL`),this._updateEffect&&this._updateEffectOptions.defines===e||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof Rs&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=e,this._updateEffect=new Qe.a("gpuUpdateParticles",this._updateEffectOptions,this._engine))},t.prototype._getEffect=function(){var e;return(e=this.getCustomEffect())!==null&&e!==void 0?e:this._renderEffect},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this.blendMode===er.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this.isLocal&&e.push("#define LOCAL"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case er.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case er.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case er.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&e.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(""+this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push("position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"),e.push("emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition"),r.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(fr.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),fr.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._recreateRenderEffect=function(){var e=this.getCustomEffect();if(e)return e;var n=[];this.fillDefines(n);var r=n.join(`
`);if(this._renderEffect&&this._renderEffect.defines===r)return this._renderEffect;var o=[],l=[],d=[];return this.fillUniformsAttributesAndSamplerNames(l,o,d),this._renderEffect=new Qe.a("gpuRenderParticles",o,l,d,this._engine,r),this._renderEffect},t.prototype.animate=function(e){var n;e===void 0&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(e,n){var r=this[n];if(e&&e.length&&!r){for(var o=new Float32Array(this._rawTextureWidth),l=0;l<this._rawTextureWidth;l++){var d=l/this._rawTextureWidth;Dr.GetCurrentGradient(d,e,function(v,y,D){o[l]=J.a.Lerp(v.factor1,y.factor1,D)})}this[n]=xr.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),n=C.c.Color4[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;Dr.GetCurrentGradient(o,this._colorGradients,function(l,d,v){C.b.LerpToRef(l.color1,d.color1,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255*n.a})}this._colorGradientsTexture=xr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.render=function(e){var n,r;if(e===void 0&&(e=!1),!this._started||(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady()))return 0;if(!e&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var o=0;o<this.preWarmCycles;o++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var l=0|this._accumulatedCount;this._accumulatedCount-=l,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+l)}if(!this._currentActiveCount)return 0;this._engine.enableEffect(this._updateEffect);var d,v=this._engine;if(!v.setState)throw new Error("GPU particles cannot work with a full Engine. ThinEngine is not supported");if(this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)d=this.emitter.getWorldMatrix();else{var y=this.emitter;d=h.a.Translation(y.x,y.y,y.z)}if(this.isLocal||this._updateEffect.setMatrix("emitterWM",d),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),v.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(g.a.MATERIAL_PointListDrawMode,0,this._currentActiveCount),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null),!e){var D=this._getEffect();this._engine.enableEffect(D);var w=((n=this._scene)===null||n===void 0?void 0:n.getViewMatrix())||h.a.IdentityReadOnly;if(D.setMatrix("view",w),D.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),D.setTexture("diffuseSampler",this.particleTexture),D.setVector2("translationPivot",this.translationPivot),D.setVector3("worldOffset",this.worldOffset),this.isLocal&&D.setMatrix("emitterWM",d),this._colorGradientsTexture?D.setTexture("colorGradientSampler",this._colorGradientsTexture):D.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var F=this.particleTexture.getBaseSize();D.setFloat3("sheetInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,F.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var z=this._scene.activeCamera;D.setVector3("eyePosition",z.globalPosition)}var k=D.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&lt.a.BindClipPlane(D,this._scene),k.indexOf("#define BILLBOARDMODE_ALL")>=0){var K=w.clone();K.invert(),D.setMatrix("invView",K)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this.blendMode){case er.BLENDMODE_ADD:this._engine.setAlphaMode(g.a.ALPHA_ADD);break;case er.BLENDMODE_ONEONE:this._engine.setAlphaMode(g.a.ALPHA_ONEONE);break;case er.BLENDMODE_STANDARD:this._engine.setAlphaMode(g.a.ALPHA_COMBINE);break;case er.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(g.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&v.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),this._engine.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(g.a.ALPHA_DISABLE)}this._targetIndex++,this._targetIndex===2&&(this._targetIndex=0);var ae=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=ae,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);for(this._updateVAO=[],e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO=[]}},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._scene){var n=this._scene.particleSystems.indexOf(this);n>-1&&this._scene.particleSystems.splice(n,1)}this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,n){var r=this.serialize(),o=t.Parse(r,this._scene||this._engine,""),l=Object(f.a)({},this._customEffect);return o.name=e,o._customEffect=l,n===void 0&&(n=this.emitter),o.emitter=n,o.noiseTexture=this.noiseTexture,o},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};return er._Serialize(n,this,e),n.activeParticleCount=this.activeParticleCount,n.randomTextureSize=this._randomTextureSize,n},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var l=new t(e.name,{capacity:e.capacity,randomTextureSize:e.randomTextureSize},n);return e.activeParticleCount&&(l.activeParticleCount=e.activeParticleCount),er._Parse(e,l,n,r),e.preventAutoStart&&(l.preventAutoStart=e.preventAutoStart),o||l.preventAutoStart||l.start(),l},t}(hl),Ih=function(){function i(){this.systems=new Array}return Object.defineProperty(i.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!1,configurable:!0}),i.prototype.setEmitterAsSphere=function(t,e,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:e};var r=jr.a.CreateSphere("emitterSphere",{diameter:t.diameter,segments:t.segments},n);r.renderingGroupId=e;var o=new rn.a("emitterSphereMaterial",n);o.emissiveColor=t.color,r.material=o;for(var l=0,d=this.systems;l<d.length;l++)d[l].emitter=r;this._emitterNode=r},i.prototype.start=function(t){for(var e=0,n=this.systems;e<n.length;e++){var r=n[e];t&&(r.emitter=t),r.start()}},i.prototype.dispose=function(){for(var t=0,e=this.systems;t<e.length;t++)e[t].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},i.prototype.serialize=function(t){t===void 0&&(t=!1);for(var e={systems:[]},n=0,r=this.systems;n<r.length;n++){var o=r[n];e.systems.push(o.serialize(t))}return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},i.Parse=function(t,e,n){n===void 0&&(n=!1);var r=new i,o=this.BaseAssetsUrl+"/textures/";e=e||re.a.LastCreatedScene;for(var l=0,d=t.systems;l<d.length;l++){var v=d[l];r.systems.push(n?Ma.Parse(v,e,o,!0):er.Parse(v,e,o,!0))}if(t.emitter){var y=t.emitter.options;switch(t.emitter.kind){case"Sphere":r.setEmitterAsSphere({diameter:y.diameter,segments:y.segments,color:C.a.FromArray(y.color)},t.emitter.renderingGroupId,e)}}return r},i.BaseAssetsUrl="https://assets.babylonjs.com/particles",i}(),qw=function(){function i(){}return i.CreateDefault=function(t,e,n,r){var o;return e===void 0&&(e=500),r===void 0&&(r=!1),(o=r?new Ma("default system",{capacity:e},n):new er("default system",e,n)).emitter=t,o.particleTexture=new ke.a("https://www.babylonjs.com/assets/Flare.png",o.getScene()),o.createConeEmitter(.1,Math.PI/4),o.color1=new C.b(1,1,1,1),o.color2=new C.b(1,1,1,1),o.colorDead=new C.b(1,1,1,0),o.minSize=.1,o.maxSize=.1,o.minEmitPower=2,o.maxEmitPower=2,o.updateSpeed=1/60,o.emitRate=30,o},i.CreateAsync=function(t,e,n){n===void 0&&(n=!1),e||(e=re.a.LastCreatedScene);var r={};return e._addPendingData(r),new Promise(function(o,l){if(n&&!Ma.IsSupported)return e._removePendingData(r),l("Particle system with GPU is not supported.");et.b.LoadFile(i.BaseAssetsUrl+"/systems/"+t+".json",function(d){e._removePendingData(r);var v=JSON.parse(d.toString());return o(Ih.Parse(v,e,n))},void 0,void 0,void 0,function(){return e._removePendingData(r),l("An error occured while the creation of your particle system. Check if your type '"+t+"' exists.")})})},i.ExportSet=function(t){for(var e=new Ih,n=0,r=t;n<r.length;n++){var o=r[n];e.systems.push(o)}return e},i.ParseFromFileAsync=function(t,e,n,r,o){return r===void 0&&(r=!1),o===void 0&&(o=""),new Promise(function(l,d){var v=new se.a;v.addEventListener("readystatechange",function(){if(v.readyState==4)if(v.status==200){var y=JSON.parse(v.responseText),D=void 0;D=r?Ma.Parse(y,n,o):er.Parse(y,n,o),t&&(D.name=t),l(D)}else d("Unable to load the particle system")}),v.open("GET",e),v.send()})},i.CreateFromSnippetAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=!1),r===void 0&&(r=""),t==="_BLANK"){var l=this.CreateDefault(null);return l.start(),Promise.resolve(l)}return new Promise(function(d,v){var y=new se.a;y.addEventListener("readystatechange",function(){if(y.readyState==4)if(y.status==200){var D=JSON.parse(JSON.parse(y.responseText).jsonPayload),w=JSON.parse(D.particleSystem),F=void 0;(F=n?Ma.Parse(w,e,r):er.Parse(w,e,r)).snippetId=t,d(F)}else v("Unable to load the snippet "+t)}),y.open("GET",o.SnippetUrl+"/"+t.replace(/#/g,"/")),y.send()})},i.BaseAssetsUrl=Ih.BaseAssetsUrl,i.SnippetUrl="https://snippet.babylonjs.com",i}();E.a.AddParser(dt.a.NAME_PARTICLESYSTEM,function(i,t,e,n){var r=E.a.GetIndividualParser(dt.a.NAME_PARTICLESYSTEM);if(r&&i.particleSystems!==void 0&&i.particleSystems!==null)for(var o=0,l=i.particleSystems.length;o<l;o++){var d=i.particleSystems[o];e.particleSystems.push(r(d,t,n))}}),E.a.AddIndividualParser(dt.a.NAME_PARTICLESYSTEM,function(i,t,e){return i.activeParticleCount?Ma.Parse(i,t,e):er.Parse(i,t,e)}),He.a.prototype.createEffectForParticles=function(i,t,e,n,r,o,l,d){var v;t===void 0&&(t=[]),e===void 0&&(e=[]),n===void 0&&(n="");var y=[],D=[],w=[];return d?d.fillUniformsAttributesAndSamplerNames(D,y,w):(y=er._GetAttributeNamesOrOptions(),D=er._GetEffectCreationOptions()),n.indexOf(" BILLBOARD")===-1&&(n+=`
#define BILLBOARD
`),e.indexOf("diffuseSampler")===-1&&e.push("diffuseSampler"),this.createEffect({vertex:(v=d==null?void 0:d.vertexShaderName)!==null&&v!==void 0?v:"particles",fragmentElement:i},y,D.concat(t),w.concat(e),n,r,o,l)},Fe.a.prototype.getEmittedParticleSystems=function(){for(var i=new Array,t=0;t<this.getScene().particleSystems.length;t++){var e=this.getScene().particleSystems[t];e.emitter===this&&i.push(e)}return i},Fe.a.prototype.getHierarchyEmittedParticleSystems=function(){var i=new Array,t=this.getDescendants();t.push(this);for(var e=0;e<this.getScene().particleSystems.length;e++){var n=this.getScene().particleSystems[e],r=n.emitter;r.position&&t.indexOf(r)!==-1&&i.push(n)}return i};var yr,km=function(){function i(t,e,n,r,o,l,d,v,y,D){y===void 0&&(y=null),D===void 0&&(D=null),this.idx=0,this.id=0,this.color=new C.b(1,1,1,1),this.position=h.e.Zero(),this.rotation=h.e.Zero(),this.scaling=h.e.One(),this.uvs=new h.f(0,0,1,1),this.velocity=h.e.Zero(),this.pivot=h.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=jt.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=h.e.Zero(),this.idx=t,this.id=e,this._pos=n,this._ind=r,this._model=o,this.shapeId=l,this.idxInShape=d,this._sps=v,y&&(this._modelBoundingInfo=y,this._boundingInfo=new ko.a(y.minimum,y.maximum)),D!==null&&(this.materialIndex=D)}return i.prototype.copyToRef=function(t){return t.position.copyFrom(this.position),t.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(t.rotationQuaternion?t.rotationQuaternion.copyFrom(this.rotationQuaternion):t.rotationQuaternion=this.rotationQuaternion.clone()),t.scaling.copyFrom(this.scaling),this.color&&(t.color?t.color.copyFrom(this.color):t.color=this.color.clone()),t.uvs.copyFrom(this.uvs),t.velocity.copyFrom(this.velocity),t.pivot.copyFrom(this.pivot),t.translateFromPivot=this.translateFromPivot,t.alive=this.alive,t.isVisible=this.isVisible,t.parentId=this.parentId,t.cullingStrategy=this.cullingStrategy,this.materialIndex!==null&&(t.materialIndex=this.materialIndex),this},Object.defineProperty(i.prototype,"scale",{get:function(){return this.scaling},set:function(t){this.scaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t){return!(!this._boundingInfo||!t._boundingInfo)&&(this._sps._bSphereOnly?Ay.a.Intersects(this._boundingInfo.boundingSphere,t._boundingInfo.boundingSphere):this._boundingInfo.intersects(t._boundingInfo,!1))},i.prototype.isInFrustum=function(t){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=h.c.Quaternion[0];var n=this.rotation;h.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),jm=function(i,t,e,n,r,o,l,d,v){this._indicesLength=0,this.shapeID=i,this._shape=t,this._indices=e,this._indicesLength=e.length,this._shapeUV=o,this._shapeColors=r,this._normals=n,this._positionFunction=l,this._vertexFunction=d,this._material=v},JT=function(i,t,e,n){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=i,this.ind=t,this.indicesLength=e,this.materialIndex=n},eE=function(){function i(){this.position=h.e.Zero(),this.color=new C.b(1,1,1,1),this.uv=h.d.Zero()}return Object.defineProperty(i.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.position.z},set:function(t){this.position.z=t},enumerable:!1,configurable:!0}),i}(),Zw=function(){function i(t,e,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new km(0,0,0,0,null,0,0,this),this._color=new C.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(r,o){return o.sqDistance-r.sqDistance},this._materialSortFunction=function(r,o){return r.materialIndex-o.materialIndex},this._autoUpdateSubMeshes=!1,this.name=t,this._scene=e||re.a.LastCreatedScene,this._camera=e.activeCamera,this._pickable=!!n&&n.isPickable,this._depthSort=!!n&&n.enableDepthSort,this._multimaterialEnabled=!!n&&n.enableMultiMaterial,this._useModelMaterial=!!n&&n.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!n&&n.expandable,this._particlesIntersect=!!n&&n.particleIntersection,this._bSphereOnly=!!n&&n.boundingSphereOnly,this._bSphereRadiusFactor=n&&n.bSphereRadiusFactor?n.bSphereRadiusFactor:1,n&&n.updatable!==void 0?this._updatable=n.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new Ra.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new eE}return i.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(this.nbParticles===0&&!this.mesh){var t=Mh.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var e=new Fe.a(this.name,this._scene);this.mesh=e}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&Tt.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var n=new Tt.a;if(n.indices=this._depthSort?this._indices:this._indices32,n.set(this._positions32,De.b.PositionKind),n.set(this._normals32,De.b.NormalKind),this._uvs32.length>0&&n.set(this._uvs32,De.b.UVKind),this._colors32.length>0&&n.set(this._colors32,De.b.ColorKind),n.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable){for(var r=0,o=0;o<this.nbParticles;o++)for(var l=this.particles[o],d=l._model._indicesLength,v=0;v<d;v++)if(v%3==0){var y={idx:l.idx,faceId:r};this.pickedParticles[r]=y,r++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},i.prototype.digest=function(t,e){var n=e&&e.facetNb||1,r=e&&e.number||0,o=e&&e.delta||0,l=t.getVerticesData(De.b.PositionKind),d=t.getIndices(),v=t.getVerticesData(De.b.UVKind),y=t.getVerticesData(De.b.ColorKind),D=t.getVerticesData(De.b.NormalKind),w=e&&e.storage?e.storage:null,F=0,z=d.length/3;r?(r=r>z?z:r,n=Math.round(z/r),o=0):n=n>z?z:n;for(var k=[],K=[],ae=[],le=[],fe=[],me=h.e.Zero(),be=n;F<z;){F>z-(n=be+Math.floor((1+o)*Math.random()))&&(n=z-F),k.length=0,K.length=0,ae.length=0,le.length=0,fe.length=0;for(var Ee=0,xe=3*F;xe<3*(F+n);xe++){ae.push(Ee);var Ae=d[xe],Ie=3*Ae;if(k.push(l[Ie],l[Ie+1],l[Ie+2]),K.push(D[Ie],D[Ie+1],D[Ie+2]),v){var Re=2*Ae;le.push(v[Re],v[Re+1])}if(y){var Pe=4*Ae;fe.push(y[Pe],y[Pe+1],y[Pe+2],y[Pe+3])}Ee++}var Ce,Ue=this.nbParticles,Oe=this._posToShape(k),Ve=this._uvsToShapeUV(le),Le=et.b.Slice(ae),ze=et.b.Slice(fe),tt=et.b.Slice(K);for(me.copyFromFloats(0,0,0),Ce=0;Ce<Oe.length;Ce++)me.addInPlace(Oe[Ce]);me.scaleInPlace(1/Oe.length);var ut,ft=new h.e(1/0,1/0,1/0),vt=new h.e(-1/0,-1/0,-1/0);for(Ce=0;Ce<Oe.length;Ce++)Oe[Ce].subtractInPlace(me),ft.minimizeInPlaceFromFloats(Oe[Ce].x,Oe[Ce].y,Oe[Ce].z),vt.maximizeInPlaceFromFloats(Oe[Ce].x,Oe[Ce].y,Oe[Ce].z);this._particlesIntersect&&(ut=new ko.a(ft,vt));var rt=null;this._useModelMaterial&&(rt=t.material?t.material:this._setDefaultMaterial());var mt=new jm(this._shapeCounter,Oe,Le,tt,ze,Ve,null,null,rt),pt=this._positions.length,it=this._indices.length;this._meshBuilder(this._index,it,Oe,this._positions,Le,this._indices,le,this._uvs,ze,this._colors,tt,this._normals,Ue,0,null,mt),this._addParticle(Ue,this._lastParticleId,pt,it,mt,this._shapeCounter,0,ut,w),this.particles[this.nbParticles].position.addInPlace(me),w||(this._index+=Oe.length,Ue++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,F+=n}return this._isNotBuilt=!0,this},i.prototype._unrotateFixedNormals=function(){for(var t=0,e=0,n=h.c.Vector3[0],r=h.c.Quaternion[0],o=h.c.Matrix[0],l=0;l<this.particles.length;l++){var d=this.particles[l],v=d._model._shape;if(d.rotationQuaternion)d.rotationQuaternion.conjugateToRef(r);else{var y=d.rotation;h.b.RotationYawPitchRollToRef(y.y,y.x,y.z,r),r.conjugateInPlace()}r.toRotationMatrix(o);for(var D=0;D<v.length;D++)e=t+3*D,h.e.TransformNormalFromFloatsToRef(this._normals32[e],this._normals32[e+1],this._normals32[e+2],o,n),n.toArray(this._fixedNormal32,e);t=e+3}},i.prototype._resetCopy=function(){var t=this._copy;t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.copyFromFloats(0,0,1,1),t.color=null,t.translateFromPivot=!1,t.shapeId=0,t.materialIndex=null},i.prototype._meshBuilder=function(t,e,n,r,o,l,d,v,y,D,w,F,z,k,K,ae){var le,fe=0,me=0,be=0;this._resetCopy();var Ee=this._copy,xe=!(!K||!K.storage);if(Ee.idx=z,Ee.idxInShape=k,Ee.shapeId=ae.shapeID,this._useModelMaterial){var Ae=ae._material.uniqueId,Ie=this._materialIndexesById;Ie.hasOwnProperty(Ae)||(Ie[Ae]=this._materials.length,this._materials.push(ae._material));var Re=Ie[Ae];Ee.materialIndex=Re}if(K&&K.positionFunction&&(K.positionFunction(Ee,z,k),this._mustUnrotateFixedNormals=!0),xe)return Ee;var Pe=h.c.Matrix[0],Ce=this._tmpVertex,Ue=Ce.position,Oe=Ce.color,Ve=Ce.uv,Le=h.c.Vector3[1],ze=h.c.Vector3[2],tt=h.c.Vector3[3];h.a.IdentityToRef(Pe),Ee.getRotationMatrix(Pe),Ee.pivot.multiplyToRef(Ee.scaling,tt),Ee.translateFromPivot?ze.setAll(0):ze.copyFrom(tt);var ut=K&&K.vertexFunction;for(le=0;le<n.length;le++){if(Ue.copyFrom(n[le]),Ee.color&&Oe.copyFrom(Ee.color),d&&Ve.copyFromFloats(d[fe],d[fe+1]),ut&&K.vertexFunction(Ee,Ce,le),Ue.multiplyInPlace(Ee.scaling).subtractInPlace(tt),h.e.TransformCoordinatesToRef(Ue,Pe,Le),Le.addInPlace(ze).addInPlace(Ee.position),r.push(Le.x,Le.y,Le.z),d){var ft=Ee.uvs;v.push((ft.z-ft.x)*Ve.x+ft.x,(ft.w-ft.y)*Ve.y+ft.y),fe+=2}if(Ee.color)this._color.copyFrom(Oe);else{var vt=this._color;y&&y[me]!==void 0?(vt.r=y[me],vt.g=y[me+1],vt.b=y[me+2],vt.a=y[me+3]):(vt.r=1,vt.g=1,vt.b=1,vt.a=1)}D.push(this._color.r,this._color.g,this._color.b,this._color.a),me+=4,!this.recomputeNormals&&w&&(h.e.TransformNormalFromFloatsToRef(w[be],w[be+1],w[be+2],Pe,Ue),F.push(Ue.x,Ue.y,Ue.z),be+=3)}for(le=0;le<o.length;le++){var rt=t+o[le];l.push(rt),rt>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var mt=Ee.materialIndex!==null?Ee.materialIndex:0;this.depthSortedParticles.push(new JT(z,e,o.length,mt))}return Ee},i.prototype._posToShape=function(t){for(var e=[],n=0;n<t.length;n+=3)e.push(h.e.FromArray(t,n));return e},i.prototype._uvsToShapeUV=function(t){var e=[];if(t)for(var n=0;n<t.length;n++)e.push(t[n]);return e},i.prototype._addParticle=function(t,e,n,r,o,l,d,v,y){v===void 0&&(v=null),y===void 0&&(y=null);var D=new km(t,e,n,r,o,l,d,this,v);return(y||this.particles).push(D),D},i.prototype.addShape=function(t,e,n){var r=t.getVerticesData(De.b.PositionKind),o=t.getIndices(),l=t.getVerticesData(De.b.UVKind),d=t.getVerticesData(De.b.ColorKind),v=t.getVerticesData(De.b.NormalKind);this.recomputeNormals=!v;var y=et.b.SliceToArray(o),D=et.b.SliceToArray(v),w=d?et.b.SliceToArray(d):[],F=n&&n.storage?n.storage:null,z=null;this._particlesIntersect&&(z=t.getBoundingInfo());var k=this._posToShape(r),K=this._uvsToShapeUV(l),ae=n?n.positionFunction:null,le=n?n.vertexFunction:null,fe=null;this._useModelMaterial&&(fe=t.material?t.material:this._setDefaultMaterial());for(var me=new jm(this._shapeCounter,k,y,D,w,K,ae,le,fe),be=0;be<e;be++)this._insertNewParticle(this.nbParticles,be,me,k,o,l,d,v,z,F,n);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},i.prototype._rebuildParticle=function(t,e){e===void 0&&(e=!1),this._resetCopy();var n=this._copy;t._model._positionFunction&&t._model._positionFunction(n,t.idx,t.idxInShape);var r=h.c.Matrix[0],o=h.c.Vector3[0],l=h.c.Vector3[1],d=h.c.Vector3[2],v=h.c.Vector3[3];n.getRotationMatrix(r),t.pivot.multiplyToRef(t.scaling,v),n.translateFromPivot?d.copyFromFloats(0,0,0):d.copyFrom(v);for(var y=t._model._shape,D=0;D<y.length;D++)o.copyFrom(y[D]),t._model._vertexFunction&&t._model._vertexFunction(n,o,D),o.multiplyInPlace(n.scaling).subtractInPlace(v),h.e.TransformCoordinatesToRef(o,r,l),l.addInPlace(d).addInPlace(n.position).toArray(this._positions32,t._pos+3*D);e&&(t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.setAll(0),t.pivot.setAll(0),t.translateFromPivot=!1,t.parentId=null)},i.prototype.rebuildMesh=function(t){t===void 0&&(t=!1);for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e],t);return this.mesh.updateVerticesData(De.b.PositionKind,this._positions32,!1,!1),this},i.prototype.removeParticles=function(t,e){var n=e-t+1;if(!this._expandable||n<=0||n>=this.nbParticles||!this._updatable)return[];var r=this.particles,o=this.nbParticles;if(e<o-1)for(var l=e+1,d=r[l]._pos-r[t]._pos,v=r[l]._ind-r[t]._ind,y=l;y<o;y++){var D=r[y];D._pos-=d,D._ind-=v}var w=r.splice(t,n);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var F=0,z=r.length,k=0;k<z;k++){var K=r[k],ae=K._model,le=ae._shape,fe=ae._indices,me=ae._normals,be=ae._shapeColors,Ee=ae._shapeUV;K.idx=k,this._idxOfId[K.id]=k,this._meshBuilder(this._index,F,le,this._positions,fe,this._indices,Ee,this._uvs,be,this._colors,me,this._normals,K.idx,K.idxInShape,null,ae),this._index+=le.length,F+=fe.length}return this.nbParticles-=n,this._isNotBuilt=!0,w},i.prototype.insertParticlesFromArray=function(t){if(!this._expandable)return this;for(var e=0,n=t[0].shapeId,r=t.length,o=0;o<r;o++){var l=t[o],d=l._model,v=d._shape,y=d._indices,D=d._shapeUV,w=d._shapeColors,F=d._normals,z=!F;this.recomputeNormals=z||this.recomputeNormals;var k=l._boundingInfo,K=this._insertNewParticle(this.nbParticles,e,d,v,y,D,w,F,k,null,null);l.copyToRef(K),e++,n!=l.shapeId&&(n=l.shapeId,e=0)}return this._isNotBuilt=!0,this},i.prototype._insertNewParticle=function(t,e,n,r,o,l,d,v,y,D,w){var F=this._positions.length,z=this._indices.length,k=this._meshBuilder(this._index,z,r,this._positions,o,this._indices,l,this._uvs,d,this._colors,v,this._normals,t,e,w,n),K=null;return this._updatable&&((K=this._addParticle(this.nbParticles,this._lastParticleId,F,z,n,this._shapeCounter,e,y,D)).position.copyFrom(k.position),K.rotation.copyFrom(k.rotation),k.rotationQuaternion&&(K.rotationQuaternion?K.rotationQuaternion.copyFrom(k.rotationQuaternion):K.rotationQuaternion=k.rotationQuaternion.clone()),k.color&&(K.color?K.color.copyFrom(k.color):K.color=k.color.clone()),K.scaling.copyFrom(k.scaling),K.uvs.copyFrom(k.uvs),k.materialIndex!==null&&(K.materialIndex=k.materialIndex),this.expandable&&(this._idxOfId[K.id]=K.idx)),D||(this._index+=r.length,this.nbParticles++,this._lastParticleId++),K},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(t,e,n);var r=h.c.Matrix[0],o=h.c.Matrix[1],l=this.mesh,d=this._colors32,v=this._positions32,y=this._normals32,D=this._uvs32,w=this._indices32,F=this._indices,z=this._fixedNormal32,k=h.c.Vector3,K=k[5].copyFromFloats(1,0,0),ae=k[6].copyFromFloats(0,1,0),le=k[7].copyFromFloats(0,0,1),fe=k[8].setAll(Number.MAX_VALUE),me=k[9].setAll(-Number.MAX_VALUE),be=k[10].setAll(0),Ee=this._tmpVertex,xe=Ee.position,Ae=Ee.color,Ie=Ee.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(o)),this.billboard){var Re=k[0];this._camera.getDirectionToRef(Te.a.Z,Re),h.e.TransformNormalToRef(Re,o,le),le.normalize();var Pe=this._camera.getViewMatrix(!0);h.e.TransformNormalFromFloatsToRef(Pe.m[1],Pe.m[5],Pe.m[9],o,ae),h.e.CrossToRef(ae,le,K),ae.normalize(),K.normalize()}this._depthSort&&h.e.TransformCoordinatesToRef(this._camera.globalPosition,o,be),h.a.IdentityToRef(r);var Ce=0,Ue=0,Oe=0,Ve=0,Le=0,ze=0,tt=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var ut=this.mesh._boundingInfo;ut&&(fe.copyFrom(ut.minimum),me.copyFrom(ut.maximum))}var ft=(Ue=this.particles[t]._pos)/3|0;Ve=4*ft,ze=2*ft;for(var vt=t;vt<=e;vt++){var rt=this.particles[vt];this.updateParticle(rt);var mt=rt._model._shape,pt=rt._model._shapeUV,it=rt._rotationMatrix,yt=rt.position,We=rt.rotation,at=rt.scaling,It=rt._globalPosition;if(this._depthSort&&this._depthSortParticles){var vn=this.depthSortedParticles[vt];vn.idx=rt.idx,vn.ind=rt._ind,vn.indicesLength=rt._model._indicesLength,vn.sqDistance=h.e.DistanceSquared(rt.position,be)}if(!rt.alive||rt._stillInvisible&&!rt.isVisible)Ue+=3*(tt=mt.length),Ve+=4*tt,ze+=2*tt;else{if(rt.isVisible){rt._stillInvisible=!1;var Jt=k[12];if(rt.pivot.multiplyToRef(at,Jt),this.billboard&&(We.x=0,We.y=0),(this._computeParticleRotation||this.billboard)&&rt.getRotationMatrix(r),rt.parentId!==null){var Sn=this.getParticleById(rt.parentId);if(Sn){var Rt=Sn._rotationMatrix,Rn=Sn._globalPosition,bn=yt.x*Rt[1]+yt.y*Rt[4]+yt.z*Rt[7],hn=yt.x*Rt[0]+yt.y*Rt[3]+yt.z*Rt[6],yn=yt.x*Rt[2]+yt.y*Rt[5]+yt.z*Rt[8];if(It.x=Rn.x+hn,It.y=Rn.y+bn,It.z=Rn.z+yn,this._computeParticleRotation||this.billboard){var Lt=r.m;it[0]=Lt[0]*Rt[0]+Lt[1]*Rt[3]+Lt[2]*Rt[6],it[1]=Lt[0]*Rt[1]+Lt[1]*Rt[4]+Lt[2]*Rt[7],it[2]=Lt[0]*Rt[2]+Lt[1]*Rt[5]+Lt[2]*Rt[8],it[3]=Lt[4]*Rt[0]+Lt[5]*Rt[3]+Lt[6]*Rt[6],it[4]=Lt[4]*Rt[1]+Lt[5]*Rt[4]+Lt[6]*Rt[7],it[5]=Lt[4]*Rt[2]+Lt[5]*Rt[5]+Lt[6]*Rt[8],it[6]=Lt[8]*Rt[0]+Lt[9]*Rt[3]+Lt[10]*Rt[6],it[7]=Lt[8]*Rt[1]+Lt[9]*Rt[4]+Lt[10]*Rt[7],it[8]=Lt[8]*Rt[2]+Lt[9]*Rt[5]+Lt[10]*Rt[8]}}else rt.parentId=null}else It.x=yt.x,It.y=yt.y,It.z=yt.z,(this._computeParticleRotation||this.billboard)&&(Lt=r.m,it[0]=Lt[0],it[1]=Lt[1],it[2]=Lt[2],it[3]=Lt[4],it[4]=Lt[5],it[5]=Lt[6],it[6]=Lt[8],it[7]=Lt[9],it[8]=Lt[10]);var Kt=k[11];for(rt.translateFromPivot?Kt.setAll(0):Kt.copyFrom(Jt),tt=0;tt<mt.length;tt++){Ce=Ue+3*tt,Oe=Ve+4*tt,Le=ze+2*tt;var In=2*tt,wr=In+1;xe.copyFrom(mt[tt]),this._computeParticleColor&&rt.color&&Ae.copyFrom(rt.color),this._computeParticleTexture&&Ie.copyFromFloats(pt[In],pt[wr]),this._computeParticleVertex&&this.updateParticleVertex(rt,Ee,tt);var Hr=xe.x*at.x-Jt.x,di=xe.y*at.y-Jt.y,Lr=xe.z*at.z-Jt.z;hn=Hr*it[0]+di*it[3]+Lr*it[6],bn=Hr*it[1]+di*it[4]+Lr*it[7],yn=Hr*it[2]+di*it[5]+Lr*it[8],hn+=Kt.x,bn+=Kt.y,yn+=Kt.z;var xn=v[Ce]=It.x+K.x*hn+ae.x*bn+le.x*yn,Ai=v[Ce+1]=It.y+K.y*hn+ae.y*bn+le.y*yn,co=v[Ce+2]=It.z+K.z*hn+ae.z*bn+le.z*yn;if(this._computeBoundingBox&&(fe.minimizeInPlaceFromFloats(xn,Ai,co),me.maximizeInPlaceFromFloats(xn,Ai,co)),!this._computeParticleVertex){var Ls=z[Ce],Ns=z[Ce+1],Pi=z[Ce+2],Wo=Ls*it[0]+Ns*it[3]+Pi*it[6],Fs=Ls*it[1]+Ns*it[4]+Pi*it[7],dn=Ls*it[2]+Ns*it[5]+Pi*it[8];y[Ce]=K.x*Wo+ae.x*Fs+le.x*dn,y[Ce+1]=K.y*Wo+ae.y*Fs+le.y*dn,y[Ce+2]=K.z*Wo+ae.z*Fs+le.z*dn}if(this._computeParticleColor&&rt.color){var Xo=this._colors32;Xo[Oe]=Ae.r,Xo[Oe+1]=Ae.g,Xo[Oe+2]=Ae.b,Xo[Oe+3]=Ae.a}if(this._computeParticleTexture){var Tr=rt.uvs;D[Le]=Ie.x*(Tr.z-Tr.x)+Tr.x,D[Le+1]=Ie.y*(Tr.w-Tr.y)+Tr.y}}}else for(rt._stillInvisible=!0,tt=0;tt<mt.length;tt++){if(Oe=Ve+4*tt,Le=ze+2*tt,v[Ce=Ue+3*tt]=v[Ce+1]=v[Ce+2]=0,y[Ce]=y[Ce+1]=y[Ce+2]=0,this._computeParticleColor&&rt.color){var wa=rt.color;d[Oe]=wa.r,d[Oe+1]=wa.g,d[Oe+2]=wa.b,d[Oe+3]=wa.a}this._computeParticleTexture&&(Tr=rt.uvs,D[Le]=pt[2*tt]*(Tr.z-Tr.x)+Tr.x,D[Le+1]=pt[2*tt+1]*(Tr.w-Tr.y)+Tr.y)}if(this._particlesIntersect){var lo=rt._boundingInfo,Qh=lo.boundingBox,qh=lo.boundingSphere,Bs=rt._modelBoundingInfo;if(!this._bSphereOnly){var Yo=Bs.boundingBox.vectors,Ko=k[1],La=k[2];Ko.setAll(Number.MAX_VALUE),La.setAll(-Number.MAX_VALUE);for(var Qo=0;Qo<8;Qo++){var Us=Yo[Qo].x*at.x,Vs=Yo[Qo].y*at.y,ks=Yo[Qo].z*at.z,qo=(hn=Us*it[0]+Vs*it[3]+ks*it[6],bn=Us*it[1]+Vs*it[4]+ks*it[7],yn=Us*it[2]+Vs*it[5]+ks*it[8],yt.x+K.x*hn+ae.x*bn+le.x*yn),Zo=yt.y+K.y*hn+ae.y*bn+le.y*yn,js=yt.z+K.z*hn+ae.z*bn+le.z*yn;Ko.minimizeInPlaceFromFloats(qo,Zo,js),La.maximizeInPlaceFromFloats(qo,Zo,js)}Qh.reConstruct(Ko,La,l._worldMatrix)}var uo=Bs.minimum.multiplyToRef(at,k[1]),Nr=Bs.maximum.multiplyToRef(at,k[2]),El=Nr.addToRef(uo,k[3]).scaleInPlace(.5).addInPlace(It),Na=Nr.subtractToRef(uo,k[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Sl=El.subtractToRef(Na,k[1]),wN=El.addToRef(Na,k[2]);qh.reConstruct(Sl,wN,l._worldMatrix)}Ue=Ce+3,Ve=Oe+4,ze=Le+2}}if(n){if(this._computeParticleColor&&l.updateVerticesData(De.b.ColorKind,d,!1,!1),this._computeParticleTexture&&l.updateVerticesData(De.b.UVKind,D,!1,!1),l.updateVerticesData(De.b.PositionKind,v,!1,!1),!l.areNormalsFrozen||l.isFacetDataEnabled){if(this._computeParticleVertex||l.isFacetDataEnabled){var LN=l.isFacetDataEnabled?l.getFacetDataParameters():null;Tt.a.ComputeNormals(v,w,y,LN);for(var ho=0;ho<y.length;ho++)z[ho]=y[ho]}l.areNormalsFrozen||l.updateVerticesData(De.b.NormalKind,y,!1,!1)}if(this._depthSort&&this._depthSortParticles){var u_=this.depthSortedParticles;u_.sort(this._depthSortFunction);for(var NN=u_.length,YE=0,h_=0,d_=0;d_<NN;d_++){var f_=u_[d_],FN=f_.indicesLength,BN=f_.ind;for(ho=0;ho<FN;ho++)if(w[YE]=F[BN+ho],YE++,this._pickable&&ho%3==0){var KE=this.pickedParticles[h_];KE.idx=f_.idx,KE.faceId=h_,h_++}}l.updateIndices(w)}}return this._computeBoundingBox&&(l._boundingInfo?l._boundingInfo.reConstruct(fe,me,l._worldMatrix):l._boundingInfo=new ko.a(fe,me,l._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},i.prototype.pickedParticle=function(t){if(t.hit){var e=t.subMeshId,n=t.faceId,r=this.pickedBySubMesh;if(r[e]&&r[e][n])return r[e][n]}return null},i.prototype.getParticleById=function(t){var e=this.particles[t];if(e&&e.id==t)return e;var n=this.particles,r=this._idxOfId[t];if(r!==void 0)return n[r];for(var o=0,l=this.nbParticles;o<l;){var d=n[o];if(d.id==t)return d;o++}return null},i.prototype.getParticlesByShapeId=function(t){var e=[];return this.getParticlesByShapeIdToRef(t,e),e},i.prototype.getParticlesByShapeIdToRef=function(t,e){e.length=0;for(var n=0;n<this.nbParticles;n++){var r=this.particles[n];r.shapeId==t&&e.push(r)}return this},i.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var t=this.depthSortedParticles;if(this.particles.length>0)for(var e=0;e<this.particles.length;e++){var n=this.particles[e];n.materialIndex||(n.materialIndex=0);var r=t[e];r.materialIndex=n.materialIndex,r.ind=n._ind,r.indicesLength=n._model._indicesLength,r.idx=n.idx}this._sortParticlesByMaterial();var o=this._indicesByMaterial,l=this._materialIndexes,d=this.mesh;d.subMeshes=[];for(var v=d.getTotalVertices(),y=0;y<l.length;y++){var D=o[y],w=o[y+1]-D,F=l[y];new fl.a(F,0,v,D,w,d)}return this},i.prototype._sortParticlesByMaterial=function(){var t=[0];this._indicesByMaterial=t;var e=[];this._materialIndexes=e;var n=this.depthSortedParticles;n.sort(this._materialSortFunction);var r=n.length,o=this._indices32,l=this._indices,d=0,v=0,y=0,D=n[0].materialIndex;e.push(D),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var w=0;w<r;w++){var F=n[w],z=F.indicesLength,k=F.ind;F.materialIndex!==D&&(D=F.materialIndex,t.push(y),e.push(D),this._pickable&&(d++,this.pickedBySubMesh[d]=[],v=0));for(var K=0,ae=0;ae<z;ae++){if(o[y]=l[k+ae],this._pickable&&ae%3==0){var le=this.pickedBySubMesh[d][v];le?(le.idx=F.idx,le.faceId=K):this.pickedBySubMesh[d][v]={idx:F.idx,faceId:K},v++,K++}y++}}return t.push(o.length),this._updatable&&this.mesh.updateIndices(o),this},i.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var t=0;t<this._materials.length;t++){var e=this._materials[t].uniqueId;this._materialIndexesById[e]=t}},i.prototype._filterUniqueMaterialId=function(t){return t.filter(function(e,n,r){return r.indexOf(e)===n})},i.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new rn.a(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new ko.a(new h.e(-e,-e,-e),new h.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(t){this._isVisibilityBoxLocked=t,this.mesh.getBoundingInfo().isLocked=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(t){this._computeParticleVertex=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(t){this._depthSortParticles=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),i.prototype.setMultiMaterial=function(t){this._materials=this._filterUniqueMaterialId(t),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new Ra.a(this.name+"MultiMaterial",this._scene);for(var e=0;e<this._materials.length;e++)this._multimaterial.subMaterials.push(this._materials[e]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(i.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(t){this._multimaterial=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(t){this._autoUpdateSubMeshes=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.updateParticleVertex=function(t,e,n){return this},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}(),tE=function(){function i(t,e,n,r,o){this.idx=0,this.color=new C.b(1,1,1,1),this.position=h.e.Zero(),this.rotation=h.e.Zero(),this.uv=new h.d(0,0),this.velocity=h.e.Zero(),this.pivot=h.e.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=h.e.Zero(),this.idx=t,this._group=e,this.groupId=n,this.idxInGroup=r,this._pcs=o}return Object.defineProperty(i.prototype,"size",{get:function(){return this.size},set:function(t){this.size=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t,e){if(!t._boundingInfo)return!1;if(e=e||!1)return t.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var n,r,o,l,d,v;n=t.getBoundingInfo().boundingBox.maximumWorld.x,r=t.getBoundingInfo().boundingBox.minimumWorld.x,o=t.getBoundingInfo().boundingBox.maximumWorld.y,l=t.getBoundingInfo().boundingBox.minimumWorld.y,d=t.getBoundingInfo().boundingBox.maximumWorld.z,v=t.getBoundingInfo().boundingBox.minimumWorld.z;var y=this.position.x+this._pcs.mesh.position.x,D=this.position.y+this._pcs.mesh.position.y,w=this.position.z+this._pcs.mesh.position.z;return r<=y&&y<=n&&l<=D&&D<=o&&v<=w&&w<=d},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=h.c.Quaternion[0];var n=this.rotation;h.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),Dh=function(i,t){this.groupID=i,this._positionFunction=t};(function(i){i[i.Color=2]="Color",i[i.UV=1]="UV",i[i.Random=0]="Random",i[i.Stated=3]="Stated"})(yr||(yr={}));var $w=function(){function i(t,e,n,r){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=t,this._size=e,this._scene=n||re.a.LastCreatedScene,r&&r.updatable!==void 0?this._updatable=r.updatable:this._updatable=!0}return i.prototype.buildMeshAsync=function(){var t=this;return Promise.all(this._promises).then(function(){return t._isReady=!0,t._buildMesh()})},i.prototype._buildMesh=function(){this.nbParticles===0&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var t=new Tt.a;t.set(this._positions32,De.b.PositionKind),this._uvs32.length>0&&t.set(this._uvs32,De.b.UVKind);var e=0;this._colors32.length>0&&(e=1,t.set(this._colors32,De.b.ColorKind));var n=new Fe.a(this.name,this._scene);t.applyToMesh(n,this._updatable),this.mesh=n,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var r=new rn.a("point cloud material",this._scene);return r.emissiveColor=new C.a(e,e,e),r.disableLighting=!0,r.pointsCloud=!0,r.pointSize=this._size,n.material=r,new Promise(function(o){return o(n)})},i.prototype._addParticle=function(t,e,n,r){var o=new tE(t,e,n,r,this);return this.particles.push(o),o},i.prototype._randomUnitVector=function(t){t.position=new h.e(Math.random(),Math.random(),Math.random()),t.color=new C.b(1,1,1,1)},i.prototype._getColorIndicesForCoord=function(t,e,n,r){var o=t._groupImageData,l=n*(4*r)+4*e,d=[l,l+1,l+2,l+3],v=d[1],y=d[2],D=d[3],w=o[d[0]],F=o[v],z=o[y],k=o[D];return new C.b(w/255,F/255,z/255,k)},i.prototype._setPointsColorOrUV=function(t,e,n,r,o,l,d){n&&t.updateFacetData();var v=2*t.getBoundingInfo().boundingSphere.radius,y=t.getVerticesData(De.b.PositionKind),D=t.getIndices(),w=t.getVerticesData(De.b.UVKind),F=t.getVerticesData(De.b.ColorKind),z=h.e.Zero();t.computeWorldMatrix();var k=t.getWorldMatrix();if(!k.isIdentity())for(var K=0;K<y.length/3;K++)h.e.TransformCoordinatesFromFloatsToRef(y[3*K],y[3*K+1],y[3*K+2],k,z),y[3*K]=z.x,y[3*K+1]=z.y,y[3*K+2]=z.z;var ae,le,fe=0,me=0,be=0,Ee=0,xe=0,Ae=0,Ie=0,Re=0,Pe=0,Ce=0,Ue=0,Oe=0,Ve=0,Le=0,ze=h.e.Zero(),tt=h.e.Zero(),ut=h.e.Zero(),ft=h.e.Zero(),vt=h.e.Zero(),rt=0,mt=0,pt=0,it=0,yt=0,We=0,at=h.d.Zero(),It=h.d.Zero(),vn=h.d.Zero(),Jt=h.d.Zero(),Sn=h.d.Zero(),Rt=0,Rn=0,bn=0,hn=0,yn=0,Lt=0,Kt=0,In=0,wr=0,Hr=0,di=0,Lr=0,xn=h.f.Zero(),Ai=h.f.Zero(),co=h.f.Zero(),Ls=h.f.Zero(),Ns=h.f.Zero(),Pi=0,Wo=0;d=d||0;var Fs,dn=new h.f(0,0,0,0),Xo=h.e.Zero(),Tr=h.e.Zero(),wa=h.e.Zero(),lo=0,Qh=h.e.Zero(),qh=0,Bs=0,Yo=new Qn.a(h.e.Zero(),new h.e(1,0,0)),Ko=h.e.Zero();for(me=0;me<D.length/3;me++){var La,Qo,Us,Vs,ks,qo,Zo,js;be=D[3*me],Ee=D[3*me+1],xe=D[3*me+2],Ae=y[3*be],Ie=y[3*be+1],Re=y[3*be+2],Pe=y[3*Ee],Ce=y[3*Ee+1],Ue=y[3*Ee+2],Oe=y[3*xe],Ve=y[3*xe+1],Le=y[3*xe+2],ze.set(Ae,Ie,Re),tt.set(Pe,Ce,Ue),ut.set(Oe,Ve,Le),tt.subtractToRef(ze,ft),ut.subtractToRef(tt,vt),w&&(rt=w[2*be],mt=w[2*be+1],pt=w[2*Ee],it=w[2*Ee+1],yt=w[2*xe],We=w[2*xe+1],at.set(rt,mt),It.set(pt,it),vn.set(yt,We),It.subtractToRef(at,Jt),vn.subtractToRef(It,Sn)),F&&r&&(Rt=F[4*be],Rn=F[4*be+1],bn=F[4*be+2],hn=F[4*be+3],yn=F[4*Ee],Lt=F[4*Ee+1],Kt=F[4*Ee+2],In=F[4*Ee+3],wr=F[4*xe],Hr=F[4*xe+1],di=F[4*xe+2],Lr=F[4*xe+3],xn.set(Rt,Rn,bn,hn),Ai.set(yn,Lt,Kt,In),co.set(wr,Hr,di,Lr),Ai.subtractToRef(xn,Ls),co.subtractToRef(Ai,Ns));for(var uo,Nr,El=new C.a(0,0,0),Na=new C.a(0,0,0),Sl=0;Sl<e._groupDensity[me];Sl++)fe=this.particles.length,this._addParticle(fe,e,this._groupCounter,me+Sl),Nr=this.particles[fe],Pi=J.a.RandomRange(0,1),Wo=J.a.RandomRange(0,1),ae=ze.add(ft.scale(Pi)).add(vt.scale(Pi*Wo)),n&&(Xo=t.getFacetNormal(me).normalize().scale(-1),Tr=ft.clone().normalize(),wa=h.e.Cross(Xo,Tr),lo=J.a.RandomRange(0,2*Math.PI),Qh=Tr.scale(Math.cos(lo)).add(wa.scale(Math.sin(lo))),lo=J.a.RandomRange(.1,Math.PI/2),Ko=Qh.scale(Math.cos(lo)).add(Xo.scale(Math.sin(lo))),Yo.origin=ae.add(Ko.scale(1e-5)),Yo.direction=Ko,Yo.length=v,(Fs=Yo.intersectsMesh(t)).hit&&(Bs=Fs.pickedPoint.subtract(ae).length(),qh=J.a.RandomRange(0,1)*Bs,ae.addInPlace(Ko.scale(qh)))),Nr.position=ae.clone(),this._positions.push(Nr.position.x,Nr.position.y,Nr.position.z),r!==void 0?w&&(le=at.add(Jt.scale(Pi)).add(Sn.scale(Pi*Wo)),r?o&&e._groupImageData!==null?(La=e._groupImgWidth,Qo=e._groupImgHeight,uo=this._getColorIndicesForCoord(e,Math.round(le.x*La),Math.round(le.y*Qo),La),Nr.color=uo,this._colors.push(uo.r,uo.g,uo.b,uo.a)):F?(dn=xn.add(Ls.scale(Pi)).add(Ns.scale(Pi*Wo)),Nr.color=new C.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w)):(dn=xn.set(Math.random(),Math.random(),Math.random(),1),Nr.color=new C.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w)):(Nr.uv=le.clone(),this._uvs.push(Nr.uv.x,Nr.uv.y))):(l?(El.set(l.r,l.g,l.b),Us=J.a.RandomRange(-d,d),Vs=J.a.RandomRange(-d,d),ks=(js=El.toHSV()).r,(qo=js.g+Us)<0&&(qo=0),qo>1&&(qo=1),(Zo=js.b+Vs)<0&&(Zo=0),Zo>1&&(Zo=1),C.a.HSVtoRGBToRef(ks,qo,Zo,Na),dn.set(Na.r,Na.g,Na.b,1)):dn=xn.set(Math.random(),Math.random(),Math.random(),1),Nr.color=new C.b(dn.x,dn.y,dn.z,dn.w),this._colors.push(dn.x,dn.y,dn.z,dn.w))}},i.prototype._colorFromTexture=function(t,e,n){var r=this;if(t.material===null)return _.a.Warn(t.name+"has no material."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var o=t.material.getActiveTextures();if(o.length===0)return _.a.Warn(t.name+"has no useable texture."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var l=t.clone();l.setEnabled(!1),this._promises.push(new Promise(function(d){Zr.a.WhenAllReady(o,function(){var v=e._textureNb;return v<0&&(v=0),v>o.length-1&&(v=o.length-1),e._groupImageData=o[v].readPixels(),e._groupImgWidth=o[v].getSize().width,e._groupImgHeight=o[v].getSize().height,r._setPointsColorOrUV(l,e,n,!0,!0),l.dispose(),d()})}))},i.prototype._calculateDensity=function(t,e,n){for(var r,o,l,d,v,y,D,w,F,z,k,K,ae,le,fe,me,be,Ee=new Array,xe=h.e.Zero(),Ae=h.e.Zero(),Ie=h.e.Zero(),Re=h.e.Zero(),Pe=h.e.Zero(),Ce=h.e.Zero(),Ue=new Array,Oe=0,Ve=n.length/3,Le=0;Le<Ve;Le++)r=n[3*Le],o=n[3*Le+1],l=n[3*Le+2],d=e[3*r],v=e[3*r+1],y=e[3*r+2],D=e[3*o],w=e[3*o+1],F=e[3*o+2],z=e[3*l],k=e[3*l+1],K=e[3*l+2],xe.set(d,v,y),Ae.set(D,w,F),Ie.set(z,k,K),Ae.subtractToRef(xe,Re),Ie.subtractToRef(Ae,Pe),Ie.subtractToRef(xe,Ce),me=((ae=Re.length())+(le=Pe.length())+(fe=Ce.length()))/2,Oe+=be=Math.sqrt(me*(me-ae)*(me-le)*(me-fe)),Ue[Le]=be;var ze=0;for(Le=0;Le<Ve;Le++)Ee[Le]=Math.floor(t*Ue[Le]/Oe),ze+=Ee[Le];var tt=t-ze,ut=Math.floor(tt/Ve),ft=tt%Ve;for(ut>0&&(Ee=Ee.map(function(vt){return vt+ut})),Le=0;Le<ft;Le++)Ee[Le]+=1;return Ee},i.prototype.addPoints=function(t,e){e===void 0&&(e=this._randomUnitVector);for(var n,r=new Dh(this._groupCounter,e),o=this.nbParticles,l=0;l<t;l++)n=this._addParticle(o,r,this._groupCounter,l),r&&r._positionFunction&&r._positionFunction(n,o,l),this._positions.push(n.position.x,n.position.y,n.position.z),n.color&&this._colors.push(n.color.r,n.color.g,n.color.b,n.color.a),n.uv&&this._uvs.push(n.uv.x,n.uv.y),o++;return this.nbParticles+=t,this._groupCounter++,this._groupCounter},i.prototype.addSurfacePoints=function(t,e,n,r,o){var l=n||yr.Random;(isNaN(l)||l<0||l>3)&&(l=yr.Random);var d=t.getVerticesData(De.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var y=new Dh(this._groupCounter,null);switch(y._groupDensity=this._calculateDensity(e,d,v),l===yr.Color?y._textureNb=r||0:r=r||new C.b(1,1,1,1),l){case yr.Color:this._colorFromTexture(t,y,!1);break;case yr.UV:this._setPointsColorOrUV(t,y,!1,!1,!1);break;case yr.Random:this._setPointsColorOrUV(t,y,!1);break;case yr.Stated:this._setPointsColorOrUV(t,y,!1,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.addVolumePoints=function(t,e,n,r,o){var l=n||yr.Random;(isNaN(l)||l<0||l>3)&&(l=yr.Random);var d=t.getVerticesData(De.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var y=new Dh(this._groupCounter,null);switch(y._groupDensity=this._calculateDensity(e,d,v),l===yr.Color?y._textureNb=r||0:r=r||new C.b(1,1,1,1),l){case yr.Color:this._colorFromTexture(t,y,!0);break;case yr.UV:this._setPointsColorOrUV(t,y,!0,!1,!1);break;case yr.Random:this._setPointsColorOrUV(t,y,!0);break;case yr.Stated:this._setPointsColorOrUV(t,y,!0,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(t,e,n);var r=h.c.Matrix[0],o=this.mesh,l=this._colors32,d=this._positions32,v=this._uvs32,y=h.c.Vector3,D=y[5].copyFromFloats(1,0,0),w=y[6].copyFromFloats(0,1,0),F=y[7].copyFromFloats(0,0,1),z=y[8].setAll(Number.MAX_VALUE),k=y[9].setAll(-Number.MAX_VALUE);h.a.IdentityToRef(r);var K=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var ae=this.mesh._boundingInfo;ae&&(z.copyFrom(ae.minimum),k.copyFrom(ae.maximum))}K=0;for(var le=0,fe=0,me=0,be=t;be<=e;be++){var Ee=this.particles[be];le=3*(K=Ee.idx),fe=4*K,me=2*K,this.updateParticle(Ee);var xe=Ee._rotationMatrix,Ae=Ee.position,Ie=Ee._globalPosition;if(this._computeParticleRotation&&Ee.getRotationMatrix(r),Ee.parentId!==null){var Re=this.particles[Ee.parentId],Pe=Re._rotationMatrix,Ce=Re._globalPosition,Ue=Ae.x*Pe[1]+Ae.y*Pe[4]+Ae.z*Pe[7],Oe=Ae.x*Pe[0]+Ae.y*Pe[3]+Ae.z*Pe[6],Ve=Ae.x*Pe[2]+Ae.y*Pe[5]+Ae.z*Pe[8];if(Ie.x=Ce.x+Oe,Ie.y=Ce.y+Ue,Ie.z=Ce.z+Ve,this._computeParticleRotation){var Le=r.m;xe[0]=Le[0]*Pe[0]+Le[1]*Pe[3]+Le[2]*Pe[6],xe[1]=Le[0]*Pe[1]+Le[1]*Pe[4]+Le[2]*Pe[7],xe[2]=Le[0]*Pe[2]+Le[1]*Pe[5]+Le[2]*Pe[8],xe[3]=Le[4]*Pe[0]+Le[5]*Pe[3]+Le[6]*Pe[6],xe[4]=Le[4]*Pe[1]+Le[5]*Pe[4]+Le[6]*Pe[7],xe[5]=Le[4]*Pe[2]+Le[5]*Pe[5]+Le[6]*Pe[8],xe[6]=Le[8]*Pe[0]+Le[9]*Pe[3]+Le[10]*Pe[6],xe[7]=Le[8]*Pe[1]+Le[9]*Pe[4]+Le[10]*Pe[7],xe[8]=Le[8]*Pe[2]+Le[9]*Pe[5]+Le[10]*Pe[8]}}else Ie.x=0,Ie.y=0,Ie.z=0,this._computeParticleRotation&&(Le=r.m,xe[0]=Le[0],xe[1]=Le[1],xe[2]=Le[2],xe[3]=Le[4],xe[4]=Le[5],xe[5]=Le[6],xe[6]=Le[8],xe[7]=Le[9],xe[8]=Le[10]);var ze=y[11];Ee.translateFromPivot?ze.setAll(0):ze.copyFrom(Ee.pivot);var tt=y[0];tt.copyFrom(Ee.position);var ut=tt.x-Ee.pivot.x,ft=tt.y-Ee.pivot.y,vt=tt.z-Ee.pivot.z,rt=ut*xe[0]+ft*xe[3]+vt*xe[6],mt=ut*xe[1]+ft*xe[4]+vt*xe[7],pt=ut*xe[2]+ft*xe[5]+vt*xe[8];rt+=ze.x,mt+=ze.y,pt+=ze.z;var it=d[le]=Ie.x+D.x*rt+w.x*mt+F.x*pt,yt=d[le+1]=Ie.y+D.y*rt+w.y*mt+F.y*pt,We=d[le+2]=Ie.z+D.z*rt+w.z*mt+F.z*pt;if(this._computeBoundingBox&&(z.minimizeInPlaceFromFloats(it,yt,We),k.maximizeInPlaceFromFloats(it,yt,We)),this._computeParticleColor&&Ee.color){var at=Ee.color,It=this._colors32;It[fe]=at.r,It[fe+1]=at.g,It[fe+2]=at.b,It[fe+3]=at.a}if(this._computeParticleTexture&&Ee.uv){var vn=Ee.uv,Jt=this._uvs32;Jt[me]=vn.x,Jt[me+1]=vn.y}}return n&&(this._computeParticleColor&&o.updateVerticesData(De.b.ColorKind,l,!1,!1),this._computeParticleTexture&&o.updateVerticesData(De.b.UVKind,v,!1,!1),o.updateVerticesData(De.b.PositionKind,d,!1,!1)),this._computeBoundingBox&&(o._boundingInfo?o._boundingInfo.reConstruct(z,k,o._worldMatrix):o._boundingInfo=new ko.a(z,k,o._worldMatrix)),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new ko.a(new h.e(-e,-e,-e),new h.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}();ne.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},ne.a.prototype.enablePhysics=function(i,t){if(i===void 0&&(i=null),this._physicsEngine)return!0;var e=this._getComponent(dt.a.NAME_PHYSICSENGINE);e||(e=new nE(this),this._addComponent(e));try{return this._physicsEngine=new xs(i,t),this._physicsTimeAccumulator=0,!0}catch(n){return _.a.Error(n.message),!1}},ne.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},ne.a.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0},ne.a.prototype.deleteCompoundImpostor=function(i){var t=i.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},ne.a.prototype._advancePhysicsEngineStep=function(i){if(this._physicsEngine){var t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=i;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(i/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(jt.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(i){var t=this;this._physicsImpostor!==i&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=i,i&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),jt.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},jt.a.prototype.applyImpulse=function(i,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(i,t),this):this},jt.a.prototype.setPhysicsLinkWith=function(i,t,e,n){return this.physicsImpostor&&i.physicsImpostor?(this.physicsImpostor.createJoint(i.physicsImpostor,Fn.e.HingeJoint,{mainPivot:t,connectedPivot:e,nativeParams:n}),this):this};var bl,Ms,nE=function(){function i(t){var e=this;this.name=dt.a.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new S.c,this.scene.onAfterPhysicsObservable=new S.c,this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1e3*e.scene._physicsEngine.getTimeStep():1e3/60}}return i.prototype.register=function(){},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},i}(),Jw=function(){function i(t){this._scene=t,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||_.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return i.prototype.applyRadialExplosionImpulse=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Is).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var l=new rE(this._scene,e),d=Array();return o.forEach(function(v){var y=l.getImpostorHitData(v,t);y&&(v.applyImpulse(y.force,y.contactPoint),d.push({impostor:v,hitData:y}))}),l.triggerAffectedImpostorsCallback(d),l.dispose(!1),l},i.prototype.applyRadialExplosionForce=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Is).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var l=new rE(this._scene,e),d=Array();return o.forEach(function(v){var y=l.getImpostorHitData(v,t);y&&(v.applyForce(y.force,y.contactPoint),d.push({impostor:v,hitData:y}))}),l.triggerAffectedImpostorsCallback(d),l.dispose(!1),l},i.prototype.gravitationalField=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Is).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var o=new eL(this,this._scene,t,e);return o.dispose(!1),o},i.prototype.updraft=function(t,e,n,r,o){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new zm).radius=e,e.strength=n||e.strength,e.height=r||e.height,e.updraftMode=o||e.updraftMode);var l=new tL(this._scene,t,e);return l.dispose(!1),l},i.prototype.vortex=function(t,e,n,r){if(!this._physicsEngine)return _.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Gm).radius=e,e.strength=n||e.strength,e.height=r||e.height);var o=new nL(this._scene,t,e);return o.dispose(!1),o},i}(),rE=function(){function i(t,e){this._scene=t,this._options=e,this._dataFetched=!1,this._options=Object(f.a)(Object(f.a)({},new Is),this._options)}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.getImpostorHitData=function(t,e){if(t.mass===0||!this._intersectsWithSphere(t,e,this._options.radius)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var n=t.getObjectCenter().subtract(e),r=new Qn.a(e,n,this._options.radius).intersectsMesh(t.object).pickedPoint;if(!r)return null;var o=h.e.Distance(e,r);if(o>this._options.radius)return null;var l=this._options.falloff===bl.Constant?this._options.strength:this._options.strength*(1-o/this._options.radius);return{force:n.multiplyByFloats(l,l,l),contactPoint:r,distanceFromOrigin:o}},i.prototype.triggerAffectedImpostorsCallback=function(t){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(t)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._prepareSphere=function(){this._sphere||(this._sphere=jr.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},i.prototype._intersectsWithSphere=function(t,e,n){var r=t.object;return this._prepareSphere(),this._sphere.position=e,this._sphere.scaling=new h.e(2*n,2*n,2*n),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(r,!0)},i}(),eL=function(){function i(t,e,n,r){this._physicsHelper=t,this._scene=e,this._origin=n,this._options=r,this._dataFetched=!1,this._options=Object(f.a)(Object(f.a)({},new Is),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var t=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);t&&(this._sphere=t.getData().sphere.clone("radialExplosionEventSphereClone"))}},i}(),tL=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=h.e.Zero(),this._originDirection=h.e.Zero(),this._cylinderPosition=h.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(f.a)(Object(f.a)({},new zm),this._options),this._origin.addToRef(new h.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new h.e(0,this._options.height,0),this._originTop),this._options.updraftMode===Ms.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),this._cylinder&&(t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0))},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t))return null;var e=t.getObjectCenter();if(this._options.updraftMode===Ms.Perpendicular)var n=this._originDirection;else n=e.subtract(this._originTop);var r=h.e.Distance(this._origin,e),o=-1*this._options.strength;return{force:n.multiplyByFloats(o,o,o),contactPoint:e,distanceFromOrigin:r}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Vi.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),nL=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=h.e.Zero(),this._cylinderPosition=h.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(f.a)(Object(f.a)({},new Gm),this._options),this._origin.addToRef(new h.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new h.e(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0)},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var e=t.getObjectCenter(),n=new h.e(this._origin.x,e.y,this._origin.z),r=e.subtract(n),o=new Qn.a(n,r,this._options.radius).intersectsMesh(t.object),l=o.pickedPoint;if(!l)return null;var d=o.distance/this._options.radius,v=l.normalize();if(d>this._options.centripetalForceThreshold&&(v=v.negate()),d>this._options.centripetalForceThreshold)var y=v.x*this._options.centripetalForceMultiplier,D=v.y*this._options.updraftForceMultiplier,w=v.z*this._options.centripetalForceMultiplier;else{var F=h.e.Cross(n,e).normalize();y=(F.x+v.x)*this._options.centrifugalForceMultiplier,D=this._originTop.y*this._options.updraftForceMultiplier,w=(F.z+v.z)*this._options.centrifugalForceMultiplier}var z=new h.e(y,D,w);return{force:z=z.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:e,distanceFromOrigin:d}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Vi.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),Is=function(){this.radius=5,this.strength=10,this.falloff=bl.Constant,this.sphere={segments:32,diameter:1}},zm=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Ms.Center},Gm=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};(function(i){i[i.Constant=0]="Constant",i[i.Linear=1]="Linear"})(bl||(bl={})),function(i){i[i.Center=0]="Center",i[i.Perpendicular=1]="Perpendicular"}(Ms||(Ms={}));var rL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void)
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11));
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`;Qe.a.ShadersStore.blackAndWhitePixelShader=rL;var iE=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,"blackAndWhite",["degree"],null,n,r,o,l,d)||this;return v.degree=1,v.onApplyObservable.add(function(y){y.setFloat("degree",v.degree)}),v}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"BlackAndWhitePostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"degree",void 0),t}(St);R.a.RegisteredTypes["BABYLON.BlackAndWhitePostProcess"]=iE;var Yt=function(){function i(t,e,n,r){this._name=e,this._singleInstance=r||!0,this._getPostProcesses=n,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._postProcesses)if(this._postProcesses.hasOwnProperty(t)){for(var e=this._postProcesses[t],n=0;n<e.length;n++)if(!e[n].isSupported)return!1}return!0},enumerable:!1,configurable:!0}),i.prototype._update=function(){},i.prototype._attachCameras=function(t){var e,n=this,r=et.b.MakeArray(t||this._cameras);if(r)for(var o=0;o<r.length;o++){var l=r[o];if(l){var d=l.name;if(e=this._singleInstance?0:d,!this._postProcesses[e]){var v=this._getPostProcesses();v&&(this._postProcesses[e]=Array.isArray(v)?v:[v])}this._indicesForCamera[d]||(this._indicesForCamera[d]=[]),this._postProcesses[e].forEach(function(y){var D=l.attachPostProcess(y);n._indicesForCamera[d].push(D)}),this._cameras[d]||(this._cameras[d]=l)}}},i.prototype._detachCameras=function(t){var e=et.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name,l=this._postProcesses[this._singleInstance?0:o];l&&l.forEach(function(d){r.detachPostProcess(d)}),this._cameras[o]&&(this._cameras[o]=null)}},i.prototype._enable=function(t){var e=this,n=et.b.MakeArray(t||this._cameras);if(n)for(var r=0;r<n.length;r++)for(var o=n[r],l=o.name,d=0;d<this._indicesForCamera[l].length;d++)o._postProcesses[this._indicesForCamera[l][d]]!==void 0&&o._postProcesses[this._indicesForCamera[l][d]]!==null||this._postProcesses[this._singleInstance?0:l].forEach(function(v){n[r].attachPostProcess(v,e._indicesForCamera[l][d])})},i.prototype._disable=function(t){var e=et.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name;this._postProcesses[this._singleInstance?0:o].forEach(function(l){r.detachPostProcess(l)})}},i.prototype.getPostProcesses=function(t){return this._singleInstance?this._postProcesses[0]:t?this._postProcesses[t.name]:null},i}(),iL=`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`;Qe.a.ShadersStore.extractHighlightsPixelShader=iL;var Hm=function(i){function t(e,n,r,o,l,d,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"extractHighlights",["threshold","exposure"],null,n,r,o,l,d,null,v,void 0,null,y)||this;return D.threshold=.9,D._exposure=1,D._inputPostProcess=null,D.onApplyObservable.add(function(w){D._inputPostProcess&&w.setTextureFromPostProcess("textureSampler",D._inputPostProcess),w.setFloat("threshold",Math.pow(D.threshold,Zt.b)),w.setFloat("exposure",D._exposure)}),D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ExtractHighlightsPostProcess"},Object(f.c)([Object(B.c)()],t.prototype,"threshold",void 0),t}(St);R.a.RegisteredTypes["BABYLON.ExtractHighlightsPostProcess"]=Hm;var oL=`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);
}
`;Qe.a.ShadersStore.bloomMergePixelShader=oL;var Wm=function(i){function t(e,n,r,o,l,d,v,y,D,w,F){w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F=!1);var z=i.call(this,e,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],l,d,v,y,D,null,w,void 0,null,!0)||this;return z.weight=1,z.weight=o,z.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("bloomBlur",r),k.setFloat("bloomWeight",z.weight)}),F||z.updateEffect(),z}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"BloomMergePostProcess"},Object(f.c)([Object(B.c)()],t.prototype,"weight",void 0),t}(St);R.a.RegisteredTypes["BABYLON.BloomMergePostProcess"]=Wm;var Xm=function(i){function t(e,n,r,o,l,d){l===void 0&&(l=0),d===void 0&&(d=!1);var v=i.call(this,e.getEngine(),"bloom",function(){return v._effects},!0)||this;return v.bloomScale=n,v._effects=[],v._downscale=new Hm("highlights",1,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,d),v._blurX=new ar("horizontal blur",new h.d(1,0),10,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,void 0,d),v._blurX.alwaysForcePOT=!0,v._blurX.autoClear=!1,v._blurY=new ar("vertical blur",new h.d(0,1),10,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,void 0,d),v._blurY.alwaysForcePOT=!0,v._blurY.autoClear=!1,v.kernel=o,v._effects=[v._downscale,v._blurX,v._blurY],v._merge=new Wm("bloomMerge",v._downscale,v._blurY,r,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,d),v._merge.autoClear=!1,v._effects.push(v._merge),v}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Yt),aL=`
uniform sampler2D textureSampler;

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`;Qe.a.ShadersStore.chromaticAberrationPixelShader=aL;var Ym=function(i){function t(e,n,r,o,l,d,v,y,D,w){D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),w===void 0&&(w=!1);var F=i.call(this,e,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],o,l,d,v,y,null,D,void 0,null,w)||this;return F.aberrationAmount=30,F.radialIntensity=0,F.direction=new h.d(.707,.707),F.centerPosition=new h.d(.5,.5),F.screenWidth=n,F.screenHeight=r,F.onApplyObservable.add(function(z){z.setFloat("chromatic_aberration",F.aberrationAmount),z.setFloat("screen_width",n),z.setFloat("screen_height",r),z.setFloat("radialIntensity",F.radialIntensity),z.setFloat2("direction",F.direction.x,F.direction.y),z.setFloat2("centerPosition",F.centerPosition.x,F.centerPosition.y)}),F}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ChromaticAberrationPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.screenWidth,e.screenHeight,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"aberrationAmount",void 0),Object(f.c)([Object(B.c)()],t.prototype,"radialIntensity",void 0),Object(f.c)([Object(B.c)()],t.prototype,"direction",void 0),Object(f.c)([Object(B.c)()],t.prototype,"centerPosition",void 0),Object(f.c)([Object(B.c)()],t.prototype,"screenWidth",void 0),Object(f.c)([Object(B.c)()],t.prototype,"screenHeight",void 0),t}(St);R.a.RegisteredTypes["BABYLON.ChromaticAberrationPostProcess"]=Ym;var sL=`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`;Qe.a.ShadersStore.circleOfConfusionPixelShader=sL;var Km=function(i){function t(e,n,r,o,l,d,v,y,D){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1);var w=i.call(this,e,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],r,o,l,d,v,null,y,void 0,null,D)||this;return w.lensSize=50,w.fStop=1.4,w.focusDistance=2e3,w.focalLength=50,w._depthTexture=null,w._depthTexture=n,w.onApplyObservable.add(function(F){if(w._depthTexture){F.setTexture("depthSampler",w._depthTexture);var z=w.lensSize/w.fStop*w.focalLength/(w.focusDistance-w.focalLength);F.setFloat("focusDistance",w.focusDistance),F.setFloat("cocPrecalculation",z),F.setFloat2("cameraMinMaxZ",w._depthTexture.activeCamera.minZ,w._depthTexture.activeCamera.maxZ)}else _.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),w}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"CircleOfConfusionPostProcess"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!1,configurable:!0}),Object(f.c)([Object(B.c)()],t.prototype,"lensSize",void 0),Object(f.c)([Object(B.c)()],t.prototype,"fStop",void 0),Object(f.c)([Object(B.c)()],t.prototype,"focusDistance",void 0),Object(f.c)([Object(B.c)()],t.prototype,"focalLength",void 0),t}(St);R.a.RegisteredTypes["BABYLON.CircleOfConfusionPostProcess"]=Km;var cL=`
uniform sampler2D textureSampler;
uniform sampler2D colorTable;

varying vec2 vUV;

const float SLICE_COUNT=16.0;

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width;
float slicePixelSize=sliceSize/width;
float sliceInnerSize=slicePixelSize*(width-1.0);
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`;Qe.a.ShadersStore.colorCorrectionPixelShader=cL;var oE=function(i){function t(e,n,r,o,l,d,v){var y=i.call(this,e,"colorCorrection",null,["colorTable"],r,o,l,d,v)||this;return y._colorTableTexture=new ke.a(n,o.getScene(),!0,!1,ke.a.TRILINEAR_SAMPLINGMODE),y._colorTableTexture.anisotropicFilteringLevel=1,y._colorTableTexture.wrapU=ke.a.CLAMP_ADDRESSMODE,y._colorTableTexture.wrapV=ke.a.CLAMP_ADDRESSMODE,y.colorTableUrl=n,y.onApply=function(D){D.setTexture("colorTable",y._colorTableTexture)},y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ColorCorrectionPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.colorTableUrl,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"colorTableUrl",void 0),t}(St);R.a.RegisteredTypes["BABYLON.ColorCorrectionPostProcess"]=oE;var lL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`;Qe.a.ShadersStore.convolutionPixelShader=lL;var aE=function(i){function t(e,n,r,o,l,d,v,y){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"convolution",["kernel","screenSize"],null,r,o,l,d,v,null,y)||this;return D.kernel=n,D.onApply=function(w){w.setFloat2("screenSize",D.width,D.height),w.setArray("kernel",D.kernel)},D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ConvolutionPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType)},e,r,o)},t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],Object(f.c)([Object(B.c)()],t.prototype,"kernel",void 0),t}(St);R.a.RegisteredTypes["BABYLON.ConvolutionPostProcess"]=aE;var wh=function(i){function t(e,n,r,o,l,d,v,y,D,w,F,z,k){y===void 0&&(y=null),D===void 0&&(D=ke.a.BILINEAR_SAMPLINGMODE),z===void 0&&(z=g.a.TEXTURETYPE_UNSIGNED_INT),k===void 0&&(k=!1);var K=i.call(this,e,r,o,l,d,D=g.a.TEXTURE_BILINEAR_SAMPLINGMODE,w,F,z=g.a.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,k)||this;return K.direction=r,K.onApplyObservable.add(function(ae){y!=null&&ae.setTextureFromPostProcess("textureSampler",y),ae.setTextureFromPostProcessOutput("circleOfConfusionSampler",v),n.activeCamera&&ae.setFloat2("cameraMinMaxZ",n.activeCamera.minZ,n.activeCamera.maxZ)}),K}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldBlurPostProcess"},Object(f.c)([Object(B.c)()],t.prototype,"direction",void 0),t}(ar);R.a.RegisteredTypes["BABYLON.DepthOfFieldBlurPostProcess"]=wh;var uL=`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`;Qe.a.ShadersStore.depthOfFieldMergePixelShader=uL;var Ia,hL=function(){},sE=function(i){function t(e,n,r,o,l,d,v,y,D,w,F){w===void 0&&(w=g.a.TEXTURETYPE_UNSIGNED_INT),F===void 0&&(F=!1);var z=i.call(this,e,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],l,d,v,y,D,null,w,void 0,null,!0)||this;return z.blurSteps=o,z.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("circleOfConfusionSampler",r),o.forEach(function(K,ae){k.setTextureFromPostProcessOutput("blurStep"+(o.length-ae-1),K)})}),F||z.updateEffect(),z}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldMergePostProcess"},t.prototype.updateEffect=function(e,n,r,o,l,d){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=null),e||(e="",e+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),i.prototype.updateEffect.call(this,e,n,r,o,l,d)},t}(St);(function(i){i[i.Low=0]="Low",i[i.Medium=1]="Medium",i[i.High=2]="High"})(Ia||(Ia={}));var Qm=function(i){function t(e,n,r,o,l){r===void 0&&(r=Ia.Low),o===void 0&&(o=0),l===void 0&&(l=!1);var d=i.call(this,e.getEngine(),"depth of field",function(){return d._effects},!0)||this;d._effects=[],d._circleOfConfusion=new Km("circleOfConfusion",n,1,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l),d._depthOfFieldBlurY=[],d._depthOfFieldBlurX=[];var v=1,y=15;switch(r){case Ia.High:v=3,y=51;break;case Ia.Medium:v=2,y=31;break;default:y=15,v=1}for(var D=y/Math.pow(2,v-1),w=1,F=0;F<v;F++){var z=new wh("verticle blur",e,new h.d(0,1),D,w,null,d._circleOfConfusion,F==0?d._circleOfConfusion:null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l);z.autoClear=!1,w=.75/Math.pow(2,F);var k=new wh("horizontal blur",e,new h.d(1,0),D,w,null,d._circleOfConfusion,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l);k.autoClear=!1,d._depthOfFieldBlurY.push(z),d._depthOfFieldBlurX.push(k)}for(d._effects=[d._circleOfConfusion],F=0;F<d._depthOfFieldBlurX.length;F++)d._effects.push(d._depthOfFieldBlurY[F]),d._effects.push(d._depthOfFieldBlurX[F]);return d._dofMerge=new sE("dofMerge",d._circleOfConfusion,d._circleOfConfusion,d._depthOfFieldBlurX,w,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l),d._dofMerge.autoClear=!1,d._effects.push(d._dofMerge),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Yt),dL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`;Qe.a.ShadersStore.displayPassPixelShader=dL;var cE=function(i){function t(e,n,r,o,l,d){return i.call(this,e,"displayPass",["passSampler"],["passSampler"],n,r,o,l,d)||this}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"DisplayPassPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);R.a.RegisteredTypes["BABYLON.DisplayPassPostProcess"]=cE;var fL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`;Qe.a.ShadersStore.filterPixelShader=fL;var lE=function(i){function t(e,n,r,o,l,d,v){var y=i.call(this,e,"filter",["kernelMatrix"],null,r,o,l,d,v)||this;return y.kernelMatrix=n,y.onApply=function(D){D.setMatrix("kernelMatrix",y.kernelMatrix)},y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FilterPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.kernelMatrix,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(f.c)([Object(B.j)()],t.prototype,"kernelMatrix",void 0),t}(St);R.a.RegisteredTypes["BABYLON.FilterPostProcess"]=lE;var pL=`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan)
{
lumaS=lumaE;
}
if (horzSpan)
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan)
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN)
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)
{
posN.x-=offNP.x*3.0;
}
if (!doneN)
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP)
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan)
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`;Qe.a.ShadersStore.fxaaPixelShader=pL;var mL=`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`;Qe.a.ShadersStore.fxaaVertexShader=mL;var yl=function(i){function t(e,n,r,o,l,d,v){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=i.call(this,e,"fxaa",["texelSize"],null,n,r,o||ke.a.BILINEAR_SAMPLINGMODE,l,d,null,v,"fxaa",void 0,!0)||this,D=y._getDefines();return y.updateEffect(D),y.onApplyObservable.add(function(w){var F=y.texelSize;w.setFloat2("texelSize",F.x,F.y)}),y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"FxaaPostProcess"},t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var n=e.getGlInfo();return n&&n.renderer&&n.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(St);R.a.RegisteredTypes["BABYLON.FxaaPostProcess"]=yl;var _L=`#include<helperFunctions>

uniform sampler2D textureSampler;

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`;Qe.a.ShadersStore.grainPixelShader=_L;var qm=function(i){function t(e,n,r,o,l,d,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"grain",["intensity","animatedSeed"],[],n,r,o,l,d,null,v,void 0,null,y)||this;return D.intensity=30,D.animated=!1,D.onApplyObservable.add(function(w){w.setFloat("intensity",D.intensity),w.setFloat("animatedSeed",D.animated?Math.random()+1:1)}),D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"GrainPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"intensity",void 0),Object(f.c)([Object(B.c)()],t.prototype,"animated",void 0),t}(St);R.a.RegisteredTypes["BABYLON.GrainPostProcess"]=qm;var gL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void)
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);
}`;Qe.a.ShadersStore.highlightsPixelShader=gL;var vL=function(i){function t(e,n,r,o,l,d,v){return v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),i.call(this,e,"highlights",null,null,n,r,o,l,d,null,v)||this}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"HighlightsPostProcess"},t}(St);Qe.a.IncludesShadersStore.mrtFragmentDeclaration=`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`;var bL=`#extension GL_EXT_draw_buffers : require
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
precision highp float;
precision highp int;
#ifdef BUMP
varying mat4 vWorldView;
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#ifdef NEED_UV
varying vec2 vUV;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef REFLECTIVITY
varying vec2 vReflectivityUV;
uniform sampler2D reflectivitySampler;
#endif
#ifdef ALPHATEST
uniform sampler2D diffuseSampler;
#endif
#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
vec3 normalOutput;
#ifdef BUMP
vec3 normalW=normalize(vNormalW);
#include<bumpFragment>
normalOutput=normalize(vec3(vWorldView*vec4(normalW,0.0)));
#else
normalOutput=normalize(vNormalV);
#endif
#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[DEPTHNORMAL_INDEX]=vec4(vViewPos.z/vViewPos.w,normalOutput);
#endif
#else
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);
gl_FragData[1]=vec4(normalOutput,1.0);
#endif
#ifdef POSITION
gl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef REFLECTIVITY
#ifdef HAS_SPECULAR

vec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);
#elif HAS_REFLECTIVITY

vec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);
#else
vec4 reflectivity=vec4(0.0,0.0,0.0,1.0);
#endif
gl_FragData[REFLECTIVITY_INDEX]=reflectivity;
#endif
}`;Qe.a.ShadersStore.geometryPixelShader=bL;var yL=`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#ifdef NEED_UV
varying vec2 vUV;
#ifdef ALPHATEST
uniform mat4 diffuseMatrix;
#endif
#ifdef BUMP
uniform mat4 bumpMatrix;
varying vec2 vBumpUV;
#endif
#ifdef REFLECTIVITY
uniform mat4 reflectivityMatrix;
varying vec2 vReflectivityUV;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
#ifdef BUMP
varying mat4 vWorldView;
#endif
#ifdef BUMP
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
#ifdef BONES_VELOCITY_ENABLED
#if NUM_BONE_INFLUENCERS>0
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));
#ifdef BUMP
vWorldView=view*finalWorld;
vNormalW=normalUpdated;
#else
vNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));
#endif
vViewPos=view*pos;
#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif
#if defined(POSITION) || defined(BUMP)
vPositionW=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#ifdef NEED_UV
#ifdef UV1
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#else
vUV=uv;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#endif
#ifdef UV2
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#else
vUV=uv2;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#endif
#include<bumpVertex>
}
`;Qe.a.ShadersStore.geometryVertexShader=yL;var xi=function(){function i(t,e){e===void 0&&(e=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this.renderTransparentMeshes=!0,this._resizeObserver=null,this._enablePosition=!1,this._enableVelocity=!1,this._enableReflectivity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._reflectivityIndex=-1,this._depthNormalIndex=-1,this._linkedWithPrePass=!1,this._scene=t,this._ratio=e,i._SceneComponentInitialization(this._scene),this._createRenderTargets()}return i.prototype._linkPrePassRenderer=function(t){this._linkedWithPrePass=!0,this._prePassRenderer=t,this._multiRenderTarget&&(this._multiRenderTarget.onClearObservable.clear(),this._multiRenderTarget.onClearObservable.add(function(e){}))},i.prototype._unlinkPrePassRenderer=function(){this._linkedWithPrePass=!1,this._createRenderTargets()},i.prototype._resetLayout=function(){this._enablePosition=!1,this._enableReflectivity=!1,this._enableVelocity=!1,this._attachments=[]},i.prototype._forceTextureType=function(t,e){t===i.POSITION_TEXTURE_TYPE?(this._positionIndex=e,this._enablePosition=!0):t===i.VELOCITY_TEXTURE_TYPE?(this._velocityIndex=e,this._enableVelocity=!0):t===i.REFLECTIVITY_TEXTURE_TYPE?(this._reflectivityIndex=e,this._enableReflectivity=!0):t===i.DEPTHNORMAL_TEXTURE_TYPE&&(this._depthNormalIndex=e)},i.prototype._setAttachments=function(t){this._attachments=t},i.prototype._linkInternalTexture=function(t){this._multiRenderTarget._texture=t},Object.defineProperty(i.prototype,"renderList",{get:function(){return this._multiRenderTarget.renderList},set:function(t){this._multiRenderTarget.renderList=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!1,configurable:!0}),i.prototype.getTextureIndex=function(t){switch(t){case i.POSITION_TEXTURE_TYPE:return this._positionIndex;case i.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case i.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;default:return-1}},Object.defineProperty(i.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(t){this._enablePosition=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(t){this._enableVelocity=t,t||(this._previousTransformationMatrices={}),this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(t){this._enableReflectivity=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._ratio},enumerable:!1,configurable:!0}),i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n&&n.disableDepthWrite)return!1;var r=[],o=[De.b.PositionKind,De.b.NormalKind],l=t.getMesh();if(n){var d=!1;n.needAlphaTesting()&&(r.push("#define ALPHATEST"),d=!0),n.bumpTexture&&rn.a.BumpTextureEnabled&&(r.push("#define BUMP"),r.push("#define BUMPDIRECTUV 0"),d=!0),this._enableReflectivity&&(n instanceof rn.a&&n.specularTexture?(r.push("#define HAS_SPECULAR"),d=!0):n instanceof nl&&n.reflectivityTexture&&(r.push("#define HAS_REFLECTIVITY"),d=!0)),d&&(r.push("#define NEED_UV"),l.isVerticesDataPresent(De.b.UVKind)&&(o.push(De.b.UVKind),r.push("#define UV1")),l.isVerticesDataPresent(De.b.UV2Kind)&&(o.push(De.b.UV2Kind),r.push("#define UV2")))}this._linkedWithPrePass&&(r.push("#define PREPASS"),this._depthNormalIndex!==-1&&(r.push("#define DEPTHNORMAL_INDEX "+this._depthNormalIndex),r.push("#define PREPASS_DEPTHNORMAL"))),this._enablePosition&&(r.push("#define POSITION"),r.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(r.push("#define VELOCITY"),r.push("#define VELOCITY_INDEX "+this._velocityIndex),this.excludedSkinnedMeshesFromVelocity.indexOf(l)===-1&&r.push("#define BONES_VELOCITY_ENABLED")),this._enableReflectivity&&(r.push("#define REFLECTIVITY"),r.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex)),l.useBones&&l.computeBonesUsingShaders?(o.push(De.b.MatricesIndicesKind),o.push(De.b.MatricesWeightsKind),l.numBoneInfluencers>4&&(o.push(De.b.MatricesIndicesExtraKind),o.push(De.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+l.numBoneInfluencers),r.push("#define BonesPerMesh "+(l.skeleton?l.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var v=l.morphTargetManager,y=0;v&&v.numInfluencers>0&&(y=v.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+y),lt.a.PrepareAttributesForMorphTargetsInfluencers(o,l,y)),e&&(r.push("#define INSTANCES"),lt.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._linkedWithPrePass?r.push("#define RENDER_TARGET_COUNT "+this._attachments.length):r.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var D=r.join(`
`);return this._cachedDefines!==D&&(this._cachedDefines=D,this._effect=this._scene.getEngine().createEffect("geometry",o,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones","morphTargetInfluences","bumpMatrix","reflectivityMatrix","vTangentSpaceParams","vBumpInfos"],["diffuseSampler","bumpSampler","reflectivitySampler"],D,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:y})),this._effect.isReady()},i.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(i.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(t){this._multiRenderTarget.samples=t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.getGBuffer().dispose()},i.prototype._assignRenderTargetIndices=function(){var t=2;return this._enablePosition&&(this._positionIndex=t,t++),this._enableVelocity&&(this._velocityIndex=t,t++),this._enableReflectivity&&(this._reflectivityIndex=t,t++),t},i.prototype._createRenderTargets=function(){var t=this,e=this._scene.getEngine(),n=this._assignRenderTargetIndices();if(this._multiRenderTarget=new am("gBuffer",{width:e.getRenderWidth()*this._ratio,height:e.getRenderHeight()*this._ratio},n,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=ke.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=ke.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(o){o.clear(new C.b(0,0,0,1),!0,!0,!0)}),this._resizeObserver=e.onResizeObservable.add(function(){t._multiRenderTarget&&t._multiRenderTarget.resize({width:e.getRenderWidth()*t._ratio,height:e.getRenderHeight()*t._ratio})});var r=function(o){var l=o.getRenderingMesh(),d=o.getEffectiveMesh(),v=t._scene,y=v.getEngine(),D=o.getMaterial();if(D){if(d._internalAbstractMeshDataInfo._isActiveIntermediate=!1,t._enableVelocity&&!t._previousTransformationMatrices[d.uniqueId]&&(t._previousTransformationMatrices[d.uniqueId]={world:h.a.Identity(),viewProjection:v.getTransformMatrix()},l.skeleton)){var w=l.skeleton.getTransformMatrices(l);t._previousBonesTransformationMatrices[l.uniqueId]=t._copyBonesTransformationMatrices(w,new Float32Array(w.length))}var F=l._getInstancesRenderList(o._id,!!o.getReplacementMesh());if(!F.mustReturn){var z=y.getCaps().instancedArrays&&(F.visibleInstances[o._id]!==null||l.hasThinInstances),k=d.getWorldMatrix();if(t.isReady(o,z)){if(y.enableEffect(t._effect),l._bind(o,t._effect,D.fillMode),t._effect.setMatrix("viewProjection",v.getTransformMatrix()),t._effect.setMatrix("view",v.getViewMatrix()),D){var K,ae=d._instanceDataStorage;if(ae.isFrozen||!D.backFaceCulling&&D.overrideMaterialSideOrientation===null)K=ae.sideOrientation;else{var le=d._getWorldMatrixDeterminant();(K=D.overrideMaterialSideOrientation)==null&&(K=D.sideOrientation),le<0&&(K=K===pn.a.ClockWiseSideOrientation?pn.a.CounterClockWiseSideOrientation:pn.a.ClockWiseSideOrientation)}if(D._preBind(t._effect,K),D.needAlphaTesting()){var fe=D.getAlphaTestTexture();fe&&(t._effect.setTexture("diffuseSampler",fe),t._effect.setMatrix("diffuseMatrix",fe.getTextureMatrix()))}D.bumpTexture&&v.getEngine().getCaps().standardDerivatives&&rn.a.BumpTextureEnabled&&(t._effect.setFloat3("vBumpInfos",D.bumpTexture.coordinatesIndex,1/D.bumpTexture.level,D.parallaxScaleBias),t._effect.setMatrix("bumpMatrix",D.bumpTexture.getTextureMatrix()),t._effect.setTexture("bumpSampler",D.bumpTexture),t._effect.setFloat2("vTangentSpaceParams",D.invertNormalMapX?-1:1,D.invertNormalMapY?-1:1)),t._enableReflectivity&&(D instanceof rn.a&&D.specularTexture?(t._effect.setMatrix("reflectivityMatrix",D.specularTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",D.specularTexture)):D instanceof nl&&D.reflectivityTexture&&(t._effect.setMatrix("reflectivityMatrix",D.reflectivityTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",D.reflectivityTexture)))}l.useBones&&l.computeBonesUsingShaders&&l.skeleton&&(t._effect.setMatrices("mBones",l.skeleton.getTransformMatrices(l)),t._enableVelocity&&t._effect.setMatrices("mPreviousBones",t._previousBonesTransformationMatrices[l.uniqueId])),lt.a.BindMorphTargetParameters(l,t._effect),t._enableVelocity&&(t._effect.setMatrix("previousWorld",t._previousTransformationMatrices[d.uniqueId].world),t._effect.setMatrix("previousViewProjection",t._previousTransformationMatrices[d.uniqueId].viewProjection)),l._processRendering(d,o,t._effect,D.fillMode,F,z,function(me,be){return t._effect.setMatrix("world",be)})}t._enableVelocity&&(t._previousTransformationMatrices[d.uniqueId].world=k.clone(),t._previousTransformationMatrices[d.uniqueId].viewProjection=t._scene.getTransformMatrix().clone(),l.skeleton&&t._copyBonesTransformationMatrices(l.skeleton.getTransformMatrices(l),t._previousBonesTransformationMatrices[d.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(o,l,d,v){var y;if(t._linkedWithPrePass){if(!t._prePassRenderer.enabled)return;t._scene.getEngine().bindAttachments(t._attachments)}if(v.length){for(e.setColorWrite(!1),y=0;y<v.length;y++)r(v.data[y]);e.setColorWrite(!0)}for(y=0;y<o.length;y++)r(o.data[y]);for(y=0;y<l.length;y++)r(l.data[y]);if(t.renderTransparentMeshes)for(y=0;y<d.length;y++)r(d.data[y])}}},i.prototype._copyBonesTransformationMatrices=function(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e},i.DEPTHNORMAL_TEXTURE_TYPE=0,i.POSITION_TEXTURE_TYPE=1,i.VELOCITY_TEXTURE_TYPE=2,i.REFLECTIVITY_TEXTURE_TYPE=3,i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("GeometryBufferRendererSceneComponent")},i}(),TL=function(){this.enabled=!1,this.name="motionBlur",this.texturesRequired=[g.a.PREPASS_VELOCITY_TEXTURE_TYPE]};Object.defineProperty(ne.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(i){i&&i.isSupported&&(this._geometryBufferRenderer=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enableGeometryBufferRenderer=function(i){return i===void 0&&(i=1),this._geometryBufferRenderer||(this._geometryBufferRenderer=new xi(this,i),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null)),this._geometryBufferRenderer},ne.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var uE=function(){function i(t){this.name=dt.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){this.scene._geometryBufferRenderer&&t.push(this.scene._geometryBufferRenderer.getGBuffer())},i}();xi._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_GEOMETRYBUFFERRENDERER);t||(t=new uE(i),i._addComponent(t))};var EL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float motionStrength;
uniform float motionScale;
uniform vec2 screenSize;
#ifdef OBJECT_BASED
uniform sampler2D velocitySampler;
#else
uniform sampler2D depthSampler;
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
#endif
void main(void)
{
#ifdef GEOMETRY_SUPPORTED
#ifdef OBJECT_BASED
vec2 texelSize=1.0/screenSize;
vec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;
vec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));
velocity*=motionScale*motionStrength;
float speed=length(velocity/texelSize);
int samplesCount=int(clamp(speed,1.0,SAMPLES));
velocity=normalize(velocity)*texelSize;
float hlim=float(-samplesCount)*0.5+0.5;
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i)
{
if (i>=samplesCount)
break;
vec2 offset=vUV+velocity*(hlim+float(i));
result+=texture2D(textureSampler,offset);
}
gl_FragColor=result/float(samplesCount);
gl_FragColor.a=1.0;
#else
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
#endif
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Qe.a.ShadersStore.motionBlurPixelShader=EL;var Zm=function(i){function t(e,n,r,o,l,d,v,y,D,w){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1),w===void 0&&(w=!0);var F=i.call(this,e,"motionBlur",["motionStrength","motionScale","screenSize","inverseViewProjection","prevViewProjection"],["velocitySampler"],r,o,l,d,v,`#define GEOMETRY_SUPPORTED
#define SAMPLES 64.0
#define OBJECT_BASED`,y,void 0,null,D)||this;return F.motionStrength=1,F._motionBlurSamples=32,F._isObjectBased=!0,F._forceGeometryBuffer=!1,F._geometryBufferRenderer=null,F._prePassRenderer=null,F._invViewProjection=null,F._previousViewProjection=null,F._forceGeometryBuffer=w,F._forceGeometryBuffer?(F._geometryBufferRenderer=n.enableGeometryBufferRenderer(),F._geometryBufferRenderer&&(F._geometryBufferRenderer.enableVelocity=!0)):(F._prePassRenderer=n.enablePrePassRenderer(),F._prePassRenderer&&(F._prePassRenderer.markAsDirty(),F._prePassEffectConfiguration=new TL)),F._applyMode(),F}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._updateEffect()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isObjectBased",{get:function(){return this._isObjectBased},set:function(e){this._isObjectBased!==e&&(this._isObjectBased=e,this._applyMode())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"MotionBlurPostProcess"},t.prototype.excludeSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}n.push(e)}},t.prototype.removeExcludedSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}var r=n.indexOf(e);r!==-1&&n.splice(r,1)}},t.prototype.dispose=function(e){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),i.prototype.dispose.call(this,e)},t.prototype._applyMode=function(){var e=this;if(!this._geometryBufferRenderer&&!this._prePassRenderer)return _.a.Warn("Multiple Render Target support needed to compute object based motion blur"),this.updateEffect();this._updateEffect(),this._invViewProjection=null,this._previousViewProjection=null,this.isObjectBased?(this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_VELOCITY_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyObjectBased(n)}):(this._invViewProjection=h.a.Identity(),this._previousViewProjection=h.a.Identity(),this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyScreenBased(n)})},t.prototype._onApplyObjectBased=function(e){if(e.setVector2("screenSize",new h.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var n=this._geometryBufferRenderer.getTextureIndex(xi.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",this._geometryBufferRenderer.getGBuffer().textures[n])}else this._prePassRenderer&&(n=this._prePassRenderer.getIndex(g.a.PREPASS_VELOCITY_TEXTURE_TYPE),e.setTexture("velocitySampler",this._prePassRenderer.prePassRT.textures[n]))},t.prototype._onApplyScreenBased=function(e){var n=this._scene.getProjectionMatrix().multiply(this._scene.getViewMatrix());if(n.invertToRef(this._invViewProjection),e.setMatrix("inverseViewProjection",this._invViewProjection),e.setMatrix("prevViewProjection",this._previousViewProjection),this._previousViewProjection=n,e.setVector2("screenSize",new h.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var r=this._geometryBufferRenderer.getTextureIndex(xi.DEPTHNORMAL_TEXTURE_TYPE);e.setTexture("depthSampler",this._geometryBufferRenderer.getGBuffer().textures[r])}else this._prePassRenderer&&(r=this._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),e.setTexture("depthSampler",this._prePassRenderer.prePassRT.textures[r]))},t.prototype._updateEffect=function(){if(this._geometryBufferRenderer||this._prePassRenderer){var e=["#define GEOMETRY_SUPPORTED","#define SAMPLES "+this._motionBlurSamples.toFixed(1),this._isObjectBased?"#define OBJECT_BASED":"#define SCREEN_BASED"];this.updateEffect(e.join(`
`))}},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"motionStrength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"motionBlurSamples",null),Object(f.c)([Object(B.c)()],t.prototype,"isObjectBased",null),t}(St);R.a.RegisteredTypes["BABYLON.MotionBlurPostProcess"]=Zm;var SL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`;Qe.a.ShadersStore.refractionPixelShader=SL;var hE=function(i){function t(e,n,r,o,l,d,v,y,D,w){var F=i.call(this,e,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],d,v,y,D,w)||this;return F._ownRefractionTexture=!0,F.color=r,F.depth=o,F.colorLevel=l,F.refractionTextureUrl=n,F.onActivateObservable.add(function(z){F._refTexture=F._refTexture||new ke.a(n,z.getScene())}),F.onApplyObservable.add(function(z){z.setColor3("baseColor",F.color),z.setFloat("depth",F.depth),z.setFloat("colorLevel",F.colorLevel),z.setTexture("refractionSampler",F._refTexture)}),F}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"RefractionPostProcess"},t.prototype.dispose=function(e){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),i.prototype.dispose.call(this,e)},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.refractionTextureUrl,e.color,e.depth,e.colorLevel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"color",void 0),Object(f.c)([Object(B.c)()],t.prototype,"depth",void 0),Object(f.c)([Object(B.c)()],t.prototype,"colorLevel",void 0),Object(f.c)([Object(B.c)()],t.prototype,"refractionTextureUrl",void 0),t}(St);R.a.RegisteredTypes["BABYLON.RefractionPostProcess"]=hE;var xL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`;Qe.a.ShadersStore.sharpenPixelShader=xL;var $m=function(i){function t(e,n,r,o,l,d,v,y){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),y===void 0&&(y=!1);var D=i.call(this,e,"sharpen",["sharpnessAmounts","screenSize"],null,n,r,o,l,d,null,v,void 0,null,y)||this;return D.colorAmount=1,D.edgeAmount=.3,D.onApply=function(w){w.setFloat2("screenSize",D.width,D.height),w.setFloat2("sharpnessAmounts",D.edgeAmount,D.colorAmount)},D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"SharpenPostProcess"},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"colorAmount",void 0),Object(f.c)([Object(B.c)()],t.prototype,"edgeAmount",void 0),t}(St);R.a.RegisteredTypes["BABYLON.SharpenPostProcess"]=$m;var Ds=function(){function i(t,e){this.engine=t,this._name=e,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameras",{get:function(){return this._cameras},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._renderEffects)if(this._renderEffects.hasOwnProperty(t)&&!this._renderEffects[t].isSupported)return!1;return!0},enumerable:!1,configurable:!0}),i.prototype.addEffect=function(t){this._renderEffects[t._name]=t},i.prototype._rebuild=function(){},i.prototype._enableEffect=function(t,e){var n=this._renderEffects[t];n&&n._enable(et.b.MakeArray(e||this._cameras))},i.prototype._disableEffect=function(t,e){var n=this._renderEffects[t];n&&n._disable(et.b.MakeArray(e||this._cameras))},i.prototype._attachCameras=function(t,e){var n=et.b.MakeArray(t||this._cameras);if(n){var r,o=[];for(r=0;r<n.length;r++){var l=n[r];if(l){var d=l.name;this._cameras.indexOf(l)===-1?this._cameras[d]=l:e&&o.push(r)}}for(r=0;r<o.length;r++)t.splice(o[r],1);for(var v in this._renderEffects)this._renderEffects.hasOwnProperty(v)&&this._renderEffects[v]._attachCameras(n)}},i.prototype._detachCameras=function(t){var e=et.b.MakeArray(t||this._cameras);if(e){for(var n in this._renderEffects)this._renderEffects.hasOwnProperty(n)&&this._renderEffects[n]._detachCameras(e);for(var r=0;r<e.length;r++)this._cameras.splice(this._cameras.indexOf(e[r]),1)}},i.prototype._update=function(){for(var t in this._renderEffects)this._renderEffects.hasOwnProperty(t)&&this._renderEffects[t]._update();for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]){var n=this._cameras[e].name;this._renderEffectsForIsolatedPass[n]&&this._renderEffectsForIsolatedPass[n]._update()}},i.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},i.prototype._enableMSAAOnFirstPostProcess=function(t){if(this.engine.webGLVersion===1)return!1;var e=Object.keys(this._renderEffects);if(e.length>0){var n=this._renderEffects[e[0]].getPostProcesses();n&&(n[0].samples=t)}return!0},i.prototype.setPrePassRenderer=function(t){return!1},i.prototype.dispose=function(){},Object(f.c)([Object(B.c)()],i.prototype,"_name",void 0),i}(),dE=function(){function i(){this._renderPipelines={}}return Object.defineProperty(i.prototype,"supportedPipelines",{get:function(){var t=[];for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var n=this._renderPipelines[e];n.isSupported&&t.push(n)}return t},enumerable:!1,configurable:!0}),i.prototype.addPipeline=function(t){this._renderPipelines[t._name]=t},i.prototype.attachCamerasToRenderPipeline=function(t,e,n){n===void 0&&(n=!1);var r=this._renderPipelines[t];r&&r._attachCameras(e,n)},i.prototype.detachCamerasFromRenderPipeline=function(t,e){var n=this._renderPipelines[t];n&&n._detachCameras(e)},i.prototype.enableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._enableEffect(e,n)},i.prototype.disableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._disableEffect(e,n)},i.prototype.update=function(){for(var t in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(t)){var e=this._renderPipelines[t];e.isSupported?e._update():(e.dispose(),delete this._renderPipelines[t])}},i.prototype._rebuild=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t]._rebuild()},i.prototype.dispose=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t].dispose()},i}();Object.defineProperty(ne.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var i=this._getComponent(dt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);i||(i=new fE(this),this._addComponent(i)),this._postProcessRenderPipelineManager=new dE}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var fE=function(){function i(t){this.name=dt.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},i.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},i.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},i}(),pE=function(i){function t(e,n,r,o,l){e===void 0&&(e=""),n===void 0&&(n=!0),r===void 0&&(r=re.a.LastCreatedScene),l===void 0&&(l=!0);var d=i.call(this,r.getEngine(),e)||this;d._camerasToBeAttached=[],d.SharpenPostProcessId="SharpenPostProcessEffect",d.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",d.FxaaPostProcessId="FxaaPostProcessEffect",d.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",d.GrainPostProcessId="GrainPostProcessEffect",d._glowLayer=null,d.animations=[],d._imageProcessingConfigurationObserver=null,d._sharpenEnabled=!1,d._bloomEnabled=!1,d._depthOfFieldEnabled=!1,d._depthOfFieldBlurLevel=Ia.Low,d._fxaaEnabled=!1,d._imageProcessingEnabled=!0,d._bloomScale=.5,d._chromaticAberrationEnabled=!1,d._grainEnabled=!1,d._buildAllowed=!0,d.onBuildObservable=new S.c,d._resizeObserver=null,d._hardwareScaleLevel=1,d._bloomKernel=64,d._bloomWeight=.15,d._bloomThreshold=.9,d._samples=1,d._hasCleared=!1,d._prevPostProcess=null,d._prevPrevPostProcess=null,d._depthOfFieldSceneObserver=null,d._cameras=o||r.cameras,d._cameras=d._cameras.slice(),d._camerasToBeAttached=d._cameras.slice(),d._buildAllowed=l,d._scene=r;var v=d._scene.getEngine().getCaps();d._hdr=n&&(v.textureHalfFloatRender||v.textureFloatRender),d._hdr?v.textureHalfFloatRender?d._defaultPipelineTextureType=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(d._defaultPipelineTextureType=g.a.TEXTURETYPE_FLOAT):d._defaultPipelineTextureType=g.a.TEXTURETYPE_UNSIGNED_INT,r.postProcessRenderPipelineManager.addPipeline(d);var y=d._scene.getEngine();return d.sharpen=new $m("sharpen",1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,d._defaultPipelineTextureType,!0),d._sharpenEffect=new Yt(y,d.SharpenPostProcessId,function(){return d.sharpen},!0),d.depthOfField=new Qm(d._scene,null,d._depthOfFieldBlurLevel,d._defaultPipelineTextureType,!0),d.bloom=new Xm(d._scene,d._bloomScale,d._bloomWeight,d.bloomKernel,d._defaultPipelineTextureType,!0),d.chromaticAberration=new Ym("ChromaticAberration",y.getRenderWidth(),y.getRenderHeight(),1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,d._defaultPipelineTextureType,!0),d._chromaticAberrationEffect=new Yt(y,d.ChromaticAberrationPostProcessId,function(){return d.chromaticAberration},!0),d.grain=new qm("Grain",1,null,ke.a.BILINEAR_SAMPLINGMODE,y,!1,d._defaultPipelineTextureType,!0),d._grainEffect=new Yt(y,d.GrainPostProcessId,function(){return d.grain},!0),d._resizeObserver=y.onResizeObservable.add(function(){d._hardwareScaleLevel=y.getHardwareScalingLevel(),d.bloomKernel=d.bloomKernel}),d._imageProcessingConfigurationObserver=d._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){d.bloom._downscale._exposure=d._scene.imageProcessingConfiguration.exposure,d.imageProcessingEnabled!==d._scene.imageProcessingConfiguration.isEnabled&&(d._imageProcessingEnabled=d._scene.imageProcessingConfiguration.isEnabled,d._buildPipeline())}),d._buildPipeline(),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new Xm(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var n=0;n<this._cameras.length;n++)e.disposeEffects(this._cameras[n])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var n=this.depthOfField;this.depthOfField=new Qm(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=n.focalLength,this.depthOfField.focusDistance=n.focusDistance,this.depthOfField.fStop=n.fStop,this.depthOfField.lensSize=n.lensSize;for(var r=0;r<this._cameras.length;r++)n.disposeEffects(this._cameras[r]);this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._scene.imageProcessingConfiguration.isEnabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return this._glowLayer!=null},set:function(e){e&&!this._glowLayer?this._glowLayer=new fh("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,n){n===void 0&&(n=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),n||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var n=this._scene.getEngine();if(this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var r=0,o=this._cameras;r<o.length;r++){var l=o[r];(d=this._scene.enableDepthRenderer(l)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(v){e._cameras.indexOf(v.activeCamera)>-1&&(e.depthOfField.depthTexture=v.enableDepthRenderer(v.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var d=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=d.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new qu("imageProcessing",1,null,ke.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new Yt(n,this.ImageProcessingPostProcessId,function(){return e.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1,this.cameras&&this.cameras.length!==0||(this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.imageProcessing.getEffect()||this.imageProcessing._updateParameters()),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new yl("fxaa",1,null,ke.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this.addEffect(new Yt(n,this.FxaaPostProcessId,function(){return e.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&_.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"),this.onBuildObservable.notifyObservers(this)}},t.prototype._disposePostProcesses=function(e){e===void 0&&(e=!1);for(var n=0;n<this._cameras.length;n++){var r=this._cameras[n];this.imageProcessing&&this.imageProcessing.dispose(r),this.fxaa&&this.fxaa.dispose(r),e&&(this.sharpen&&this.sharpen.dispose(r),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(r)),this.bloom&&this.bloom.disposeEffects(r),this.chromaticAberration&&this.chromaticAberration.dispose(r),this.grain&&this.grain.dispose(r),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var n=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(n,1),this._buildPipeline()},t.prototype.dispose=function(){this.onBuildObservable.clear(),this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e._name,e._name._hdr,n)},e,n,r)},Object(f.c)([Object(B.c)()],t.prototype,"sharpenEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"bloomKernel",null),Object(f.c)([Object(B.c)()],t.prototype,"_bloomWeight",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_bloomThreshold",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_hdr",void 0),Object(f.c)([Object(B.c)()],t.prototype,"bloomWeight",null),Object(f.c)([Object(B.c)()],t.prototype,"bloomThreshold",null),Object(f.c)([Object(B.c)()],t.prototype,"bloomScale",null),Object(f.c)([Object(B.c)()],t.prototype,"bloomEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"depthOfFieldEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"depthOfFieldBlurLevel",null),Object(f.c)([Object(B.c)()],t.prototype,"fxaaEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"samples",null),Object(f.c)([Object(B.c)()],t.prototype,"imageProcessingEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"glowLayerEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"chromaticAberrationEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"grainEnabled",null),t}(Ds);R.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=pE;var AL=`
uniform sampler2D textureSampler;

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`;Qe.a.ShadersStore.lensHighlightsPixelShader=AL;var PL=`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance;
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight;

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV);
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);
float depth=texture2D(depthSampler,distorted_coords).r;
float distance=near+(far-near)*depth;
vec4 color=texture2D(textureSampler,vUV);


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`;Qe.a.ShadersStore.depthOfFieldPixelShader=PL;var CL=function(i){function t(e,n,r,o,l){o===void 0&&(o=1);var d=i.call(this,r.getEngine(),e)||this;return d.LensChromaticAberrationEffect="LensChromaticAberrationEffect",d.HighlightsEnhancingEffect="HighlightsEnhancingEffect",d.LensDepthOfFieldEffect="LensDepthOfFieldEffect",d._pentagonBokehIsEnabled=!1,d._scene=r,d._depthTexture=r.enableDepthRenderer().getDepthMap(),n.grain_texture?d._grainTexture=n.grain_texture:d._createGrainTexture(),d._edgeBlur=n.edge_blur?n.edge_blur:0,d._grainAmount=n.grain_amount?n.grain_amount:0,d._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,d._distortion=n.distortion?n.distortion:0,d._highlightsGain=n.dof_gain!==void 0?n.dof_gain:-1,d._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,d._dofDistance=n.dof_focus_distance!==void 0?n.dof_focus_distance:-1,d._dofAperture=n.dof_aperture?n.dof_aperture:1,d._dofDarken=n.dof_darken?n.dof_darken:0,d._dofPentagon=n.dof_pentagon===void 0||n.dof_pentagon,d._blurNoise=n.blur_noise===void 0||n.blur_noise,d._createChromaticAberrationPostProcess(o),d._createHighlightsPostProcess(o),d._createDepthOfFieldPostProcess(o/4),d.addEffect(new Yt(r.getEngine(),d.LensChromaticAberrationEffect,function(){return d._chromaticAberrationPostProcess},!0)),d.addEffect(new Yt(r.getEngine(),d.HighlightsEnhancingEffect,function(){return d._highlightsPostProcess},!0)),d.addEffect(new Yt(r.getEngine(),d.LensDepthOfFieldEffect,function(){return d._depthOfFieldPostProcess},!0)),d._highlightsGain===-1&&d._disableEffect(d.HighlightsEnhancingEffect,null),r.postProcessRenderPipelineManager.addPipeline(d),l&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,l),d}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!1,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){this._highlightsGain===-1&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){e===void 0&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var n=this;this._chromaticAberrationPostProcess=new St("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(r){r.setFloat("chromatic_aberration",n._chromaticAberration),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("radialIntensity",1),r.setFloat2("direction",17,17),r.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var n=this;this._highlightsPostProcess=new St("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(r){r.setFloat("gain",n._highlightsGain),r.setFloat("threshold",n._highlightsThreshold),r.setTextureFromPostProcess("textureSampler",n._chromaticAberrationPostProcess),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var n=this;this._depthOfFieldPostProcess=new St("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(r){r.setTexture("depthSampler",n._depthTexture),r.setTexture("grainSampler",n._grainTexture),r.setTextureFromPostProcess("textureSampler",n._highlightsPostProcess),r.setTextureFromPostProcess("highlightsSampler",n._depthOfFieldPostProcess),r.setFloat("grain_amount",n._grainAmount),r.setBool("blur_noise",n._blurNoise),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("distortion",n._distortion),r.setBool("dof_enabled",n._dofDistance!==-1),r.setFloat("screen_distance",1/(.1-1/n._dofDistance)),r.setFloat("aperture",n._dofAperture),r.setFloat("darken",n._dofDarken),r.setFloat("edge_blur",n._edgeBlur),r.setBool("highlights",n._highlightsGain!==-1),n._scene.activeCamera&&(r.setFloat("near",n._scene.activeCamera.minZ),r.setFloat("far",n._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new to.a("LensNoiseTexture",512,this._scene,!1,ke.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e,n,r,o=this._grainTexture.getContext(),l=0;l<512;l++)for(var d=0;d<512;d++)e=Math.floor(255*(n=.42,r=.58,Math.random()*(r-n)+n)),o.fillStyle="rgb("+e+", "+e+", "+e+")",o.fillRect(l,d,1,1);this._grainTexture.update(!1)},t}(Ds),RL=function(){this.enabled=!1,this.name="ssao2",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE]},OL=`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
#ifndef GEOMETRYBUFFER
uniform sampler2D depthNormalSampler;
#else
uniform sampler2D depthSampler;
uniform sampler2D normalSampler;
#endif
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
#ifndef GEOMETRYBUFFER
float depth=texture2D(depthNormalSampler,vUV).r;
#else
float depth=texture2D(depthSampler,vUV).r;
#endif
float depthSign=depth/abs(depth);
depth=depth*depthSign;
#ifndef GEOMETRYBUFFER
vec3 normal=texture2D(depthNormalSampler,vUV).gba;
#else
vec3 normal=texture2D(normalSampler,vUV).rgb;
#endif
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

#ifndef GEOMETRYBUFFER
float sampleDepth=abs(texture2D(depthNormalSampler,offset.xy).r);
#else
float sampleDepth=abs(texture2D(depthSampler,offset.xy).r);
#endif

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthNormalSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthNormalSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthNormalSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthNormalSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`;Qe.a.ShadersStore.ssao2PixelShader=OL;var ML=`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`;Qe.a.ShadersStore.ssaoCombinePixelShader=ML;var mE=function(i){function t(e,n,r,o,l){l===void 0&&(l=!0);var d=i.call(this,n.getEngine(),e)||this;if(d.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",d.SSAORenderEffect="SSAORenderEffect",d.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",d.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",d.SSAOCombineRenderEffect="SSAOCombineRenderEffect",d.totalStrength=1,d.maxZ=100,d.minZAspect=.2,d._samples=8,d._textureSamples=1,d._forceGeometryBuffer=!1,d._expensiveBlur=!0,d.radius=2,d.base=0,d._bits=new Uint32Array(1),d._scene=n,d._ratio=r,d._forceGeometryBuffer=l,!d.isSupported)return _.a.Error("SSAO 2 needs WebGL 2 support."),d;var v=d._ratio.ssaoRatio||r,y=d._ratio.blurRatio||r;return d._forceGeometryBuffer?n.enableGeometryBufferRenderer():d._prePassRenderer=n.enablePrePassRenderer(),d._createRandomTexture(),d._originalColorPostProcess=new Bo("SSAOOriginalSceneColor",1,null,ke.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),d._originalColorPostProcess.samples=d.textureSamples,d._createSSAOPostProcess(1),d._createBlurPostProcess(v,y),d._createSSAOCombinePostProcess(y),d.addEffect(new Yt(n.getEngine(),d.SSAOOriginalSceneColorEffect,function(){return d._originalColorPostProcess},!0)),d.addEffect(new Yt(n.getEngine(),d.SSAORenderEffect,function(){return d._ssaoPostProcess},!0)),d.addEffect(new Yt(n.getEngine(),d.SSAOBlurHRenderEffect,function(){return d._blurHPostProcess},!0)),d.addEffect(new Yt(n.getEngine(),d.SSAOBlurVRenderEffect,function(){return d._blurVPostProcess},!0)),d.addEffect(new Yt(n.getEngine(),d.SSAOCombineRenderEffect,function(){return d._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(d),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO()),this._sampleSphere=this._generateHemisphere()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._expensiveBlur=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=re.a.LastCreatedEngine;return!!e&&e.webGLVersion>=2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,n){var r=this;this._samplerOffsets=[];for(var o=this.expensiveBlur,l=-8;l<8;l++)this._samplerOffsets.push(2*l+.5);this._blurHPostProcess=new St("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],e,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurHPostProcess.onApply=function(d){r._scene.activeCamera&&(d.setFloat("outSize",r._ssaoCombinePostProcess.width>0?r._ssaoCombinePostProcess.width:r._originalColorPostProcess.width),d.setFloat("near",r._scene.activeCamera.minZ),d.setFloat("far",r._scene.activeCamera.maxZ),d.setFloat("radius",r.radius),r._forceGeometryBuffer?d.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):d.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),d.setArray("samplerOffsets",r._samplerOffsets))},this._blurVPostProcess=new St("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],n,null,ke.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurVPostProcess.onApply=function(d){r._scene.activeCamera&&(d.setFloat("outSize",r._ssaoCombinePostProcess.height>0?r._ssaoCombinePostProcess.height:r._originalColorPostProcess.height),d.setFloat("near",r._scene.activeCamera.minZ),d.setFloat("far",r._scene.activeCamera.maxZ),d.setFloat("radius",r.radius),r._forceGeometryBuffer?d.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):d.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),d.setArray("samplerOffsets",r._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){i.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,23283064365386963e-26*this._bits[0]},t.prototype._hammersley=function(e,n){return[e/n,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,n){var r=2*n*Math.PI,o=1-(.85*e+.15),l=Math.sqrt(1-o*o);return new h.e(Math.cos(r)*l,Math.sin(r)*l,o)},t.prototype._generateHemisphere=function(){for(var e,n=this.samples,r=[],o=0;o<n;){if(n<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var l=this._hammersley(o,n);e=this._hemisphereSample_uniform(l[0],l[1])}r.push(e.x,e.y,e.z),o++}return r},t.prototype._getDefinesForSSAO=function(){var e="#define SAMPLES "+this.samples+`
#define SSAO`;return this._forceGeometryBuffer&&(e+=`
#define GEOMETRYBUFFER`),e},t.prototype._createSSAOPostProcess=function(e){var n=this;this._sampleSphere=this._generateHemisphere();var r,o=this._getDefinesForSSAO();r=this._forceGeometryBuffer?["randomSampler","depthSampler","normalSampler"]:["randomSampler","depthNormalSampler"],this._ssaoPostProcess=new St("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],r,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._ssaoPostProcess.onApply=function(l){n._scene.activeCamera&&(l.setArray3("sampleSphere",n._sampleSphere),l.setFloat("randTextureTiles",32),l.setFloat("samplesFactor",1/n.samples),l.setFloat("totalStrength",n.totalStrength),l.setFloat2("texelSize",1/n._ssaoPostProcess.width,1/n._ssaoPostProcess.height),l.setFloat("radius",n.radius),l.setFloat("maxZ",n.maxZ),l.setFloat("minZAspect",n.minZAspect),l.setFloat("base",n.base),l.setFloat("near",n._scene.activeCamera.minZ),l.setFloat("far",n._scene.activeCamera.maxZ),l.setFloat("xViewport",Math.tan(n._scene.activeCamera.fov/2)*n._scene.getEngine().getAspectRatio(n._scene.activeCamera,!0)),l.setFloat("yViewport",Math.tan(n._scene.activeCamera.fov/2)),l.setMatrix("projection",n._scene.getProjectionMatrix()),n._forceGeometryBuffer?(l.setTexture("depthSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]),l.setTexture("normalSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[1])):l.setTexture("depthNormalSampler",n._prePassRenderer.prePassRT.textures[n._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),l.setTexture("randomSampler",n._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new St("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){var o=n._scene.activeCamera.viewport;r.setVector4("viewport",h.c.Vector4[0].copyFromFloats(o.x,o.y,o.width,o.height)),r.setTextureFromPostProcessOutput("originalColor",n._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples,this._forceGeometryBuffer||(this._ssaoCombinePostProcess._prePassEffectConfiguration=new RL)},t.prototype._createRandomTexture=function(){this._randomTexture=new to.a("SSAORandomTexture",128,this._scene,!1,ke.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(d,v){return Math.random()*(v-d)+d},r=h.e.Zero(),o=0;o<128;o++)for(var l=0;l<128;l++)r.x=n(0,1),r.y=n(0,1),r.z=0,r.normalize(),r.scaleInPlace(255),r.x=Math.floor(r.x),r.y=Math.floor(r.y),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,l,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,n,r){return B.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r)},Object(f.c)([Object(B.c)()],t.prototype,"totalStrength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"maxZ",void 0),Object(f.c)([Object(B.c)()],t.prototype,"minZAspect",void 0),Object(f.c)([Object(B.c)("samples")],t.prototype,"_samples",void 0),Object(f.c)([Object(B.c)("textureSamples")],t.prototype,"_textureSamples",void 0),Object(f.c)([Object(B.c)()],t.prototype,"_ratio",void 0),Object(f.c)([Object(B.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),Object(f.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"base",void 0),t}(Ds);R.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=mE;var IL=`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`;Qe.a.ShadersStore.ssaoPixelShader=IL;var DL=function(i){function t(e,n,r,o){var l=i.call(this,n.getEngine(),e)||this;l.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",l.SSAORenderEffect="SSAORenderEffect",l.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",l.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",l.SSAOCombineRenderEffect="SSAOCombineRenderEffect",l.totalStrength=1,l.radius=1e-4,l.area=.0075,l.fallOff=1e-6,l.base=.5,l._firstUpdate=!0,l._scene=n,l._createRandomTexture(),l._depthTexture=n.enableDepthRenderer().getDepthMap();var d=r.ssaoRatio||r,v=r.combineRatio||r;return l._originalColorPostProcess=new Bo("SSAOOriginalSceneColor",v,null,ke.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),l._createSSAOPostProcess(d),l._createBlurPostProcess(d),l._createSSAOCombinePostProcess(v),l.addEffect(new Yt(n.getEngine(),l.SSAOOriginalSceneColorEffect,function(){return l._originalColorPostProcess},!0)),l.addEffect(new Yt(n.getEngine(),l.SSAORenderEffect,function(){return l._ssaoPostProcess},!0)),l.addEffect(new Yt(n.getEngine(),l.SSAOBlurHRenderEffect,function(){return l._blurHPostProcess},!0)),l.addEffect(new Yt(n.getEngine(),l.SSAOBlurVRenderEffect,function(){return l._blurVPostProcess},!0)),l.addEffect(new Yt(n.getEngine(),l.SSAOCombineRenderEffect,function(){return l._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(l),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),l}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var n=this;this._blurHPostProcess=new ar("BlurH",new h.d(1,0),16,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new ar("BlurV",new h.d(0,1),16,e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var r=n._blurHPostProcess.width/n._scene.getEngine().getRenderWidth();n._blurHPostProcess.kernel=16*r}),this._blurVPostProcess.onActivateObservable.add(function(){var r=n._blurVPostProcess.height/n._scene.getEngine().getRenderHeight();n._blurVPostProcess.kernel=16*r})},t.prototype._rebuild=function(){this._firstUpdate=!0,i.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var n=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new St("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define SAMPLES 16
#define SSAO`),this._ssaoPostProcess.onApply=function(o){n._firstUpdate&&(o.setArray3("sampleSphere",r),o.setFloat("samplesFactor",1/16),o.setFloat("randTextureTiles",4)),o.setFloat("totalStrength",n.totalStrength),o.setFloat("radius",n.radius),o.setFloat("area",n.area),o.setFloat("fallOff",n.fallOff),o.setFloat("base",n.base),o.setTexture("textureSampler",n._depthTexture),o.setTexture("randomSampler",n._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new St("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,ke.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){r.setVector4("viewport",h.c.Vector4[0].copyFromFloats(0,0,1,1)),r.setTextureFromPostProcess("originalColor",n._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new to.a("SSAORandomTexture",512,this._scene,!1,ke.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=ke.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=ke.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(d,v){return Math.random()*(v-d)+d},r=h.e.Zero(),o=0;o<512;o++)for(var l=0;l<512;l++)r.x=Math.floor(255*n(-1,1)),r.y=Math.floor(255*n(-1,1)),r.z=Math.floor(255*n(-1,1)),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,l,1,1);this._randomTexture.update(!1)},Object(f.c)([Object(B.c)()],t.prototype,"totalStrength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"radius",void 0),Object(f.c)([Object(B.c)()],t.prototype,"area",void 0),Object(f.c)([Object(B.c)()],t.prototype,"fallOff",void 0),Object(f.c)([Object(B.c)()],t.prototype,"base",void 0),t}(Ds),wL=function(){this.enabled=!1,this.name="screenSpaceReflections",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,g.a.PREPASS_POSITION_TEXTURE_TYPE]},LL=`

uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform sampler2D positionSampler;
uniform sampler2D reflectivitySampler;
uniform mat4 view;
uniform mat4 projection;
uniform float step;
uniform float strength;
uniform float threshold;
uniform float roughnessFactor;
uniform float reflectionSpecularFalloffExponent;

varying vec2 vUV;

struct ReflectionInfo {
vec3 color;
vec4 coords;
};

vec3 fresnelSchlick(float cosTheta,vec3 F0)
{
return F0+(1.0-F0)*pow(1.0-cosTheta,5.0);
}

ReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
info.color=vec3(0.0);
vec4 projectedCoord;
float sampledDepth;
for(int i=0; i<SMOOTH_STEPS; i++)
{
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
dir*=0.5;
if(depth>0.0)
hitCoord-=dir;
else
hitCoord+=dir;
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
}
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);

info.coords=vec4(projectedCoord.xy,sampledDepth,1.0);
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
info.color/=float(SMOOTH_STEPS+1);
return info;
}

ReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
vec4 projectedCoord;
float sampledDepth;
dir*=step;
for(int i=0; i<REFLECTION_SAMPLES; i++)
{
hitCoord+=dir;
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
if(((depth-dir.z)<threshold) && depth<=0.0)
{
#ifdef ENABLE_SMOOTH_REFLECTIONS
return smoothReflectionInfo(dir,hitCoord);
#else
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
#endif
}
}
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
}
vec3 hash(vec3 a)
{
a=fract(a*0.8);
a+=dot(a,a.yxz+19.19);
return fract((a.xxy+a.yxx)*a.zyx);
}
void main()
{
#ifdef SSR_SUPPORTED

vec4 albedoFull=texture2D(textureSampler,vUV);
vec3 albedo=albedoFull.rgb;
float spec=texture2D(reflectivitySampler,vUV).r;
if (spec == 0.0) {
gl_FragColor=albedoFull;
return;
}

#ifdef PREPASS_LAYOUT
vec3 normal=(texture2D(normalSampler,vUV)).gba;
#else
vec3 normal=(texture2D(normalSampler,vUV)).xyz;
#endif
vec3 position=(view*texture2D(positionSampler,vUV)).xyz;
vec3 reflected=normalize(reflect(normalize(position),normalize(normal)));
float roughness=1.0-texture2D(reflectivitySampler,vUV).a;
vec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;
ReflectionInfo info=getReflectionInfo(jitt+reflected,position);

vec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));
float screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);

vec3 F0=vec3(0.04);
F0=mix(F0,albedo,spec);
vec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);

float reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);
float albedoMultiplier=1.0-reflectionMultiplier;
vec3 SSR=info.color*fresnel;
gl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),albedoFull.a);
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;Qe.a.ShadersStore.screenSpaceReflectionPixelShader=LL;var Jm=function(i){function t(e,n,r,o,l,d,v,y,D,w){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1),w===void 0&&(w=!0);var F=i.call(this,e,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","step","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],r,o,l,d,v,`#define SSR_SUPPORTED
#define REFLECTION_SAMPLES 64
#define SMOOTH_STEPS 5
`,y,void 0,null,D)||this;if(F.threshold=1.2,F.strength=1,F.reflectionSpecularFalloffExponent=3,F.step=1,F.roughnessFactor=.2,F._forceGeometryBuffer=!1,F._enableSmoothReflections=!1,F._reflectionSamples=64,F._smoothSteps=5,F._forceGeometryBuffer=w,F._forceGeometryBuffer){var z=n.enableGeometryBufferRenderer();z&&z.isSupported&&(z.enablePosition=!0,z.enableReflectivity=!0,F._geometryBufferRenderer=z)}else F._prePassRenderer=n.enablePrePassRenderer(),F._prePassRenderer.markAsDirty(),F._prePassEffectConfiguration=new wL;return F._updateEffectDefines(),F.onApply=function(k){var K=F._geometryBufferRenderer,ae=F._prePassRenderer;if(ae||K){if(K){var le=K.getTextureIndex(xi.POSITION_TEXTURE_TYPE),fe=K.getTextureIndex(xi.REFLECTIVITY_TEXTURE_TYPE);k.setTexture("normalSampler",K.getGBuffer().textures[1]),k.setTexture("positionSampler",K.getGBuffer().textures[le]),k.setTexture("reflectivitySampler",K.getGBuffer().textures[fe])}else{le=ae.getIndex(g.a.PREPASS_POSITION_TEXTURE_TYPE),fe=ae.getIndex(g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE);var me=ae.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE);k.setTexture("normalSampler",ae.prePassRT.textures[me]),k.setTexture("positionSampler",ae.prePassRT.textures[le]),k.setTexture("reflectivitySampler",ae.prePassRT.textures[fe])}var be=n.activeCamera;if(be){var Ee=be.getViewMatrix(),xe=be.getProjectionMatrix();k.setMatrix("projection",xe),k.setMatrix("view",Ee),k.setFloat("threshold",F.threshold),k.setFloat("reflectionSpecularFalloffExponent",F.reflectionSpecularFalloffExponent),k.setFloat("strength",F.strength),k.setFloat("step",F.step),k.setFloat("roughnessFactor",F.roughnessFactor)}}},F}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceReflectionPostProcess"},Object.defineProperty(t.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(e){e!==this._enableSmoothReflections&&(this._enableSmoothReflections=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(e){e!==this._reflectionSamples&&(this._reflectionSamples=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(e){e!==this._smoothSteps&&(this._smoothSteps=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),t.prototype._updateEffectDefines=function(){var e=[];(this._geometryBufferRenderer||this._prePassRenderer)&&(e.push("#define SSR_SUPPORTED"),this._prePassRenderer&&e.push("#define PREPASS_LAYOUT")),this._enableSmoothReflections&&e.push("#define ENABLE_SMOOTH_REFLECTIONS"),e.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),e.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(e.join(`
`))},t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"threshold",void 0),Object(f.c)([Object(B.c)()],t.prototype,"strength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"reflectionSpecularFalloffExponent",void 0),Object(f.c)([Object(B.c)()],t.prototype,"step",void 0),Object(f.c)([Object(B.c)()],t.prototype,"roughnessFactor",void 0),Object(f.c)([Object(B.c)()],t.prototype,"enableSmoothReflections",null),Object(f.c)([Object(B.c)()],t.prototype,"reflectionSamples",null),Object(f.c)([Object(B.c)()],t.prototype,"smoothSteps",null),t}(St);R.a.RegisteredTypes["BABYLON.ScreenSpaceReflectionPostProcess"]=Jm;var NL=`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
#include<packingFunctions>
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
#ifndef AUTO_EXPOSURE
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
#endif
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`;Qe.a.ShadersStore.standardPixelShader=NL;var _E=function(i){function t(e,n,r,o,l){o===void 0&&(o=null);var d=i.call(this,n.getEngine(),e)||this;return d.downSampleX4PostProcess=null,d.brightPassPostProcess=null,d.blurHPostProcesses=[],d.blurVPostProcesses=[],d.textureAdderPostProcess=null,d.volumetricLightPostProcess=null,d.volumetricLightSmoothXPostProcess=null,d.volumetricLightSmoothYPostProcess=null,d.volumetricLightMergePostProces=null,d.volumetricLightFinalPostProcess=null,d.luminancePostProcess=null,d.luminanceDownSamplePostProcesses=[],d.hdrPostProcess=null,d.textureAdderFinalPostProcess=null,d.lensFlareFinalPostProcess=null,d.hdrFinalPostProcess=null,d.lensFlarePostProcess=null,d.lensFlareComposePostProcess=null,d.motionBlurPostProcess=null,d.depthOfFieldPostProcess=null,d.fxaaPostProcess=null,d.screenSpaceReflectionPostProcess=null,d.brightThreshold=1,d.blurWidth=512,d.horizontalBlur=!1,d.lensTexture=null,d.volumetricLightCoefficient=.2,d.volumetricLightPower=4,d.volumetricLightBlurScale=64,d.sourceLight=null,d.hdrMinimumLuminance=1,d.hdrDecreaseRate=.5,d.hdrIncreaseRate=.5,d.lensColorTexture=null,d.lensFlareStrength=20,d.lensFlareGhostDispersal=1.4,d.lensFlareHaloWidth=.7,d.lensFlareDistortionStrength=16,d.lensFlareBlurWidth=512,d.lensStarTexture=null,d.lensFlareDirtTexture=null,d.depthOfFieldDistance=10,d.depthOfFieldBlurWidth=64,d.animations=[],d._currentDepthOfFieldSource=null,d._fixedExposure=1,d._currentExposure=1,d._hdrAutoExposure=!1,d._hdrCurrentLuminance=1,d._motionStrength=1,d._isObjectBasedMotionBlur=!1,d._camerasToBeAttached=[],d._bloomEnabled=!1,d._depthOfFieldEnabled=!1,d._vlsEnabled=!1,d._lensFlareEnabled=!1,d._hdrEnabled=!1,d._motionBlurEnabled=!1,d._fxaaEnabled=!1,d._screenSpaceReflectionsEnabled=!1,d._motionBlurSamples=64,d._volumetricLightStepsCount=50,d._samples=1,d._cameras=l||n.cameras,d._cameras=d._cameras.slice(),d._camerasToBeAttached=d._cameras.slice(),d._scene=n,d._basePostProcess=o,d._ratio=r,d._floatTextureType=n.getEngine().getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT,n.postProcessRenderPipelineManager.addPipeline(d),d._buildPipeline(),d}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var n=["#define HDR"];e&&n.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(n.join(`
`))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(e){this._motionStrength=e,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(e){var n=this._isObjectBasedMotionBlur!==e;this._isObjectBasedMotionBlur=e,n&&this._buildPipeline()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e&&!this._scene.enableGeometryBufferRenderer())return void _.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(e){this._screenSpaceReflectionsEnabled!==e&&(this._screenSpaceReflectionsEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=e:this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+e.toFixed(1))),this._motionBlurSamples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,n=this._ratio,r=this._scene;this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new Jm("HDRPass",r,n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.screenSpaceReflectionPostProcess}),this.addEffect(new Yt(r.getEngine(),"HDRScreenSpaceReflections",function(){return e.screenSpaceReflectionPostProcess},!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new St("HDRPass","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.originalPostProcess}),this.addEffect(new Yt(r.getEngine(),"HDRPassPostProcess",function(){return e.originalPostProcess},!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(r,n/4),this._createBrightPassPostProcess(r,n/4),this._createBlurPostProcesses(r,n/4,1),this._createTextureAdderPostProcess(r,n),this.textureAdderFinalPostProcess=new St("HDRDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRBaseDepthOfFieldSource",function(){return e.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(r,n),this.volumetricLightFinalPostProcess=new St("HDRVLSFinal","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRVLSFinal",function(){return e.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(r,n),this.lensFlareFinalPostProcess=new St("HDRPostLensFlareDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return e.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(r,this._floatTextureType),this._createHdrPostProcess(r,n),this.hdrFinalPostProcess=new St("HDRPostHDReDepthOfFieldSource","standard",[],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return e.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(r,n/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(r,n)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(r,n),this._fxaaEnabled&&(this.fxaaPostProcess=new yl("fxaa",1,null,ke.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(r.getEngine(),"HDRFxaa",function(){return e.fxaaPostProcess},!0))),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&_.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,n){var r=this,o=new Array(32);this.downSampleX4PostProcess=new St("HDRDownSampleX4","standard",["dsOffsets"],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(l){for(var d=0,v=r.downSampleX4PostProcess.width,y=r.downSampleX4PostProcess.height,D=-2;D<2;D++)for(var w=-2;w<2;w++)o[d]=(D+.5)*(1/v),o[d+1]=(w+.5)*(1/y),d+=2;l.setArray2("dsOffsets",o)},this.addEffect(new Yt(e.getEngine(),"HDRDownSampleX4",function(){return r.downSampleX4PostProcess},!0))},t.prototype._createBrightPassPostProcess=function(e,n){var r=this,o=new Array(8);this.brightPassPostProcess=new St("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(l){var d=1/r.brightPassPostProcess.width,v=1/r.brightPassPostProcess.height;o[0]=-.5*d,o[1]=.5*v,o[2]=.5*d,o[3]=.5*v,o[4]=-.5*d,o[5]=-.5*v,o[6]=.5*d,o[7]=-.5*v,l.setArray2("dsOffsets",o),l.setFloat("brightThreshold",r.brightThreshold)},this.addEffect(new Yt(e.getEngine(),"HDRBrightPass",function(){return r.brightPassPostProcess},!0))},t.prototype._createBlurPostProcesses=function(e,n,r,o){var l=this;o===void 0&&(o="blurWidth");var d=e.getEngine(),v=new ar("HDRBlurH_"+r,new h.d(1,0),this[o],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType),y=new ar("HDRBlurV_"+r,new h.d(0,1),this[o],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType);v.onActivateObservable.add(function(){var D=v.width/d.getRenderWidth();v.kernel=l[o]*D}),y.onActivateObservable.add(function(){var D=y.height/d.getRenderHeight();y.kernel=l.horizontalBlur?64*D:l[o]*D}),this.addEffect(new Yt(e.getEngine(),"HDRBlurH"+r,function(){return v},!0)),this.addEffect(new Yt(e.getEngine(),"HDRBlurV"+r,function(){return y},!0)),this.blurHPostProcesses.push(v),this.blurVPostProcesses.push(y)},t.prototype._createTextureAdderPostProcess=function(e,n){var r=this;this.textureAdderPostProcess=new St("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._vlsEnabled?r._currentDepthOfFieldSource:r.originalPostProcess),o.setTexture("lensSampler",r.lensTexture),o.setFloat("exposure",r._currentExposure),r._currentDepthOfFieldSource=r.textureAdderFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDRTextureAdder",function(){return r.textureAdderPostProcess},!0))},t.prototype._createVolumetricLightPostProcess=function(e,n){var r=this,o=e.enableGeometryBufferRenderer();o.enablePosition=!0;var l=o.getGBuffer();this.volumetricLightPostProcess=new St("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],n/8,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var d=h.d.Zero();this.volumetricLightPostProcess.onApply=function(v){if(r.sourceLight&&r.sourceLight.getShadowGenerator()&&r._scene.activeCamera){var y=r.sourceLight.getShadowGenerator();v.setTexture("shadowMapSampler",y.getShadowMap()),v.setTexture("positionSampler",l.textures[2]),v.setColor3("sunColor",r.sourceLight.diffuse),v.setVector3("sunDirection",r.sourceLight.getShadowDirection()),v.setVector3("cameraPosition",r._scene.activeCamera.globalPosition),v.setMatrix("shadowViewProjection",y.getTransformMatrix()),v.setFloat("scatteringCoefficient",r.volumetricLightCoefficient),v.setFloat("scatteringPower",r.volumetricLightPower),d.x=r.sourceLight.getDepthMinZ(r._scene.activeCamera),d.y=r.sourceLight.getDepthMaxZ(r._scene.activeCamera),v.setVector2("depthValues",d)}},this.addEffect(new Yt(e.getEngine(),"HDRVLS",function(){return r.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(e,n/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new St("HDRVLSMerge","standard",[],["originalSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(v){v.setTextureFromPostProcess("originalSampler",r._bloomEnabled?r.textureAdderFinalPostProcess:r.originalPostProcess),r._currentDepthOfFieldSource=r.volumetricLightFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDRVLSMerge",function(){return r.volumetricLightMergePostProces},!0))},t.prototype._createLuminancePostProcesses=function(e,n){var r=this,o=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new St("HDRLuminance","standard",["lumOffsets"],[],{width:o,height:o},null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",n);var l=[];this.luminancePostProcess.onApply=function(w){var F=1/r.luminancePostProcess.width,z=1/r.luminancePostProcess.height;l[0]=-.5*F,l[1]=.5*z,l[2]=.5*F,l[3]=.5*z,l[4]=-.5*F,l[5]=-.5*z,l[6]=.5*F,l[7]=-.5*z,w.setArray2("lumOffsets",l)},this.addEffect(new Yt(e.getEngine(),"HDRLuminance",function(){return r.luminancePostProcess},!0));for(var d=t.LuminanceSteps-1;d>=0;d--){o=Math.pow(3,d);var v=`#define LUMINANCE_DOWN_SAMPLE
`;d===0&&(v+="#define FINAL_DOWN_SAMPLER");var y=new St("HDRLuminanceDownSample"+d,"standard",["dsOffsets","halfDestPixelSize"],[],{width:o,height:o},null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,v,n);this.luminanceDownSamplePostProcesses.push(y)}var D=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(w,F){var z=new Array(18);w.onApply=function(k){if(D){for(var K=0,ae=-1;ae<2;ae++)for(var le=-1;le<2;le++)z[K]=ae/D.width,z[K+1]=le/D.height,K+=2;k.setArray2("dsOffsets",z),k.setFloat("halfDestPixelSize",.5/D.width),D=F===r.luminanceDownSamplePostProcesses.length-1?r.luminancePostProcess:w}},F===r.luminanceDownSamplePostProcesses.length-1&&(w.onAfterRender=function(){var k=e.getEngine().readPixels(0,0,1,1),K=new h.f(1/16581375,1/65025,1/255,1);r._hdrCurrentLuminance=(k[0]*K.x+k[1]*K.y+k[2]*K.z+k[3]*K.w)/100}),r.addEffect(new Yt(e.getEngine(),"HDRLuminanceDownSample"+F,function(){return w},!0))})},t.prototype._createHdrPostProcess=function(e,n){var r=this,o=["#define HDR"];this._hdrAutoExposure&&o.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new St("HDR","standard",["averageLuminance"],["textureAdderSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o.join(`
`),g.a.TEXTURETYPE_UNSIGNED_INT);var l=1,d=0,v=0;this.hdrPostProcess.onApply=function(y){if(y.setTextureFromPostProcess("textureAdderSampler",r._currentDepthOfFieldSource),d+=e.getEngine().getDeltaTime(),l<0)l=r._hdrCurrentLuminance;else{var D=(v-d)/1e3;r._hdrCurrentLuminance<l+r.hdrDecreaseRate*D?l+=r.hdrDecreaseRate*D:r._hdrCurrentLuminance>l-r.hdrIncreaseRate*D?l-=r.hdrIncreaseRate*D:l=r._hdrCurrentLuminance}r.hdrAutoExposure?r._currentExposure=r._fixedExposure/l:(l=J.a.Clamp(l,r.hdrMinimumLuminance,1e20),y.setFloat("averageLuminance",l)),v=d,r._currentDepthOfFieldSource=r.hdrFinalPostProcess},this.addEffect(new Yt(e.getEngine(),"HDR",function(){return r.hdrPostProcess},!0))},t.prototype._createLensFlarePostProcess=function(e,n){var r=this;this.lensFlarePostProcess=new St("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],n/2,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(e.getEngine(),"HDRLensFlare",function(){return r.lensFlarePostProcess},!0)),this._createBlurPostProcesses(e,n/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new St("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Yt(e.getEngine(),"HDRLensFlareCompose",function(){return r.lensFlareComposePostProcess},!0));var o=new h.d(0,0);this.lensFlarePostProcess.onApply=function(v){v.setTextureFromPostProcess("textureSampler",r._bloomEnabled?r.blurHPostProcesses[0]:r.originalPostProcess),v.setTexture("lensColorSampler",r.lensColorTexture),v.setFloat("strength",r.lensFlareStrength),v.setFloat("ghostDispersal",r.lensFlareGhostDispersal),v.setFloat("haloWidth",r.lensFlareHaloWidth),o.x=r.lensFlarePostProcess.width,o.y=r.lensFlarePostProcess.height,v.setVector2("resolution",o),v.setFloat("distortionStrength",r.lensFlareDistortionStrength)};var l=h.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),d=h.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(v){if(r._scene.activeCamera){v.setTextureFromPostProcess("otherSampler",r.lensFlarePostProcess),v.setTexture("lensDirtSampler",r.lensFlareDirtTexture),v.setTexture("lensStarSampler",r.lensStarTexture);var y=r._scene.activeCamera.getViewMatrix().getRow(0),D=r._scene.activeCamera.getViewMatrix().getRow(2),w=h.e.Dot(y.toVector3(),new h.e(1,0,0))+h.e.Dot(D.toVector3(),new h.e(0,0,1));w*=4;var F=h.a.FromValues(.5*Math.cos(w),-Math.sin(w),0,0,Math.sin(w),.5*Math.cos(w),0,0,0,0,1,0,0,0,0,1),z=d.multiply(F).multiply(l);v.setMatrix("lensStarMatrix",z),r._currentDepthOfFieldSource=r.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,n){var r=this;this.depthOfFieldPostProcess=new St("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",g.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),o.setTexture("depthSampler",r._getDepthTexture()),o.setFloat("distance",r.depthOfFieldDistance)},this.addEffect(new Yt(e.getEngine(),"HDRDepthOfField",function(){return r.depthOfFieldPostProcess},!0))},t.prototype._createMotionBlurPostProcess=function(e,n){var r=this;if(this._isObjectBasedMotionBlur){var o=new Zm("HDRMotionBlur",e,n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT);o.motionStrength=this.motionStrength,o.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=o}else{this.motionBlurPostProcess=new St("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],n,null,ke.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),g.a.TEXTURETYPE_UNSIGNED_INT);var l=0,d=h.a.Identity(),v=h.a.Identity(),y=h.a.Identity(),D=h.d.Zero();this.motionBlurPostProcess.onApply=function(w){(y=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(v),w.setMatrix("inverseViewProjection",v),w.setMatrix("prevViewProjection",d),d=y,D.x=r.motionBlurPostProcess.width,D.y=r.motionBlurPostProcess.height,w.setVector2("screenSize",D),l=e.getEngine().getFps()/60,w.setFloat("motionScale",l),w.setFloat("motionStrength",r.motionStrength),w.setTexture("depthSampler",r._getDepthTexture())}}this.addEffect(new Yt(e.getEngine(),"HDRMotionBlur",function(){return r.motionBlurPostProcess},!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(n),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(n),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(n),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(n),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(n),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(n),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(n),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(n),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(n),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(n),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(n),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(n);for(var r=0;r<this.luminanceDownSamplePostProcesses.length;r++)this.luminanceDownSamplePostProcesses[r].dispose(n);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(n),this.hdrPostProcess&&this.hdrPostProcess.dispose(n),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(n),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(n),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(n),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(n),r=0;r<this.blurHPostProcesses.length;r++)this.blurHPostProcesses[r].dispose(n);for(r=0;r<this.blurVPostProcesses.length;r++)this.blurVPostProcesses[r].dispose(n)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=B.a.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(e.screenSpaceReflectionPostProcess=B.a.Serialize(this.screenSpaceReflectionPostProcess)),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,n,r){var o=B.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r);return e.sourceLightId&&(o.sourceLight=n.getLightByID(e.sourceLightId)),e.screenSpaceReflectionPostProcess&&B.a.Parse(function(){return o.screenSpaceReflectionPostProcess},e.screenSpaceReflectionPostProcess,n,r),o},t.LuminanceSteps=6,Object(f.c)([Object(B.c)()],t.prototype,"brightThreshold",void 0),Object(f.c)([Object(B.c)()],t.prototype,"blurWidth",void 0),Object(f.c)([Object(B.c)()],t.prototype,"horizontalBlur",void 0),Object(f.c)([Object(B.c)()],t.prototype,"exposure",null),Object(f.c)([Object(B.m)("lensTexture")],t.prototype,"lensTexture",void 0),Object(f.c)([Object(B.c)()],t.prototype,"volumetricLightCoefficient",void 0),Object(f.c)([Object(B.c)()],t.prototype,"volumetricLightPower",void 0),Object(f.c)([Object(B.c)()],t.prototype,"volumetricLightBlurScale",void 0),Object(f.c)([Object(B.c)()],t.prototype,"hdrMinimumLuminance",void 0),Object(f.c)([Object(B.c)()],t.prototype,"hdrDecreaseRate",void 0),Object(f.c)([Object(B.c)()],t.prototype,"hdrIncreaseRate",void 0),Object(f.c)([Object(B.c)()],t.prototype,"hdrAutoExposure",null),Object(f.c)([Object(B.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lensFlareStrength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lensFlareGhostDispersal",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lensFlareHaloWidth",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lensFlareDistortionStrength",void 0),Object(f.c)([Object(B.c)()],t.prototype,"lensFlareBlurWidth",void 0),Object(f.c)([Object(B.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),Object(f.c)([Object(B.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),Object(f.c)([Object(B.c)()],t.prototype,"depthOfFieldDistance",void 0),Object(f.c)([Object(B.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),Object(f.c)([Object(B.c)()],t.prototype,"motionStrength",null),Object(f.c)([Object(B.c)()],t.prototype,"objectBasedMotionBlur",null),Object(f.c)([Object(B.c)()],t.prototype,"_ratio",void 0),Object(f.c)([Object(B.c)()],t.prototype,"BloomEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"DepthOfFieldEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"LensFlareEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"HDREnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"VLSEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"MotionBlurEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"fxaaEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"screenSpaceReflectionsEnabled",null),Object(f.c)([Object(B.c)()],t.prototype,"volumetricLightStepsCount",null),Object(f.c)([Object(B.c)()],t.prototype,"motionBlurSamples",null),Object(f.c)([Object(B.c)()],t.prototype,"samples",null),t}(Ds);R.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=_E;var FL=`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamA;
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
useCamA=!useCamB;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
#ifdef IS_STEREOSCOPIC_INTERLACED
float rowNum=floor(vUV.y/stepSize.y);
useCamA=mod(rowNum,2.0) == 1.0;
useCamB=mod(rowNum,2.0) == 0.0;
texCoord1=vec2(vUV.x,vUV.y);
texCoord2=vec2(vUV.x,vUV.y);
#else
useCamB=vUV.y>0.5;
useCamA=!useCamB;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else if (useCamA){
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}else {
discard;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}
`;Qe.a.ShadersStore.stereoscopicInterlacePixelShader=FL;var BL=function(i){function t(e,n,r,o,l,d,v){var y=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],l,d,v,o?"#define IS_STEREOSCOPIC_INTERLACED 1":r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return y._passedProcess=n[0]._rigPostProcess,y._stepSize=new h.d(1/y.width,1/y.height),y.onSizeChangedObservable.add(function(){y._stepSize=new h.d(1/y.width,1/y.height)}),y.onApplyObservable.add(function(D){D.setTextureFromPostProcess("camASampler",y._passedProcess),D.setFloat2("stepSize",y._stepSize.x,y._stepSize.y)}),y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcessI"},t}(St),UL=function(i){function t(e,n,r,o,l,d){var v=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],o,l,d,r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return v._passedProcess=n[0]._rigPostProcess,v._stepSize=new h.d(1/v.width,1/v.height),v.onSizeChangedObservable.add(function(){v._stepSize=new h.d(1/v.width,1/v.height)}),v.onApplyObservable.add(function(y){y.setTextureFromPostProcess("camASampler",v._passedProcess),y.setFloat2("stepSize",v._stepSize.x,v._stepSize.y)}),v}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcess"},t}(St),VL=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb);
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm);
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`;Qe.a.ShadersStore.tonemapPixelShader=VL;var Da;(function(i){i[i.Hable=0]="Hable",i[i.Reinhard=1]="Reinhard",i[i.HejiDawson=2]="HejiDawson",i[i.Photographic=3]="Photographic"})(Da||(Da={}));var kL=function(i){function t(e,n,r,o,l,d,v){l===void 0&&(l=g.a.TEXTURE_BILINEAR_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var y=i.call(this,e,"tonemap",["_ExposureAdjustment"],null,1,o,l,d,!0,null,v)||this;y._operator=n,y.exposureAdjustment=r;var D="#define ";return y._operator===Da.Hable?D+="HABLE_TONEMAPPING":y._operator===Da.Reinhard?D+="REINHARD_TONEMAPPING":y._operator===Da.HejiDawson?D+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":y._operator===Da.Photographic&&(D+="PHOTOGRAPHIC_TONEMAPPING"),y.updateEffect(D),y.onApply=function(w){w.setFloat("_ExposureAdjustment",y.exposureAdjustment)},y}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"TonemapPostProcess"},t}(St),jL=`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`;Qe.a.ShadersStore.volumetricLightScatteringPixelShader=jL;var zL=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;Qe.a.ShadersStore.volumetricLightScatteringPassVertexShader=zL;var GL=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`;Qe.a.ShadersStore.volumetricLightScatteringPassPixelShader=GL;var gE=function(i){function t(e,n,r,o,l,d,v,y,D){l===void 0&&(l=100),d===void 0&&(d=ke.a.BILINEAR_SAMPLINGMODE);var w=i.call(this,e,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],n.postProcessRatio||n,r,d,v,y,"#define NUM_SAMPLES "+l)||this;return w._screenCoordinates=h.d.Zero(),w.customMeshPosition=h.e.Zero(),w.useCustomMeshPosition=!1,w.invert=!0,w.excludedMeshes=new Array,w.exposure=.3,w.decay=.96815,w.weight=.58767,w.density=.926,v=(D=r===null?D:r.getScene()).getEngine(),w._viewPort=new si.a(0,0,1,1).toGlobal(v.getRenderWidth(),v.getRenderHeight()),w.mesh=o!==null?o:t.CreateDefaultMesh("VolumetricLightScatteringMesh",D),w._createPass(D,n.passRatio||n),w.onActivate=function(F){w.isSupported||w.dispose(F),w.onActivate=null},w.onApplyObservable.add(function(F){w._updateMeshScreenCoordinates(D),F.setTexture("lightScatteringSampler",w._volumetricLightScatteringRTT),F.setFloat("exposure",w.exposure),F.setFloat("decay",w.decay),F.setFloat("weight",w.weight),F.setFloat("density",w.density),F.setVector2("meshPositionOnScreen",w._screenCoordinates)}),w}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return _.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){_.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,n){var r=e.getMesh();if(r===this.mesh&&r.material)return r.material.isReady(r);var o=[],l=[De.b.PositionKind],d=e.getMaterial();d&&(d.needAlphaTesting()&&o.push("#define ALPHATEST"),r.isVerticesDataPresent(De.b.UVKind)&&(l.push(De.b.UVKind),o.push("#define UV1")),r.isVerticesDataPresent(De.b.UV2Kind)&&(l.push(De.b.UV2Kind),o.push("#define UV2"))),r.useBones&&r.computeBonesUsingShaders?(l.push(De.b.MatricesIndicesKind),l.push(De.b.MatricesWeightsKind),o.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),o.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):o.push("#define NUM_BONE_INFLUENCERS 0"),n&&(o.push("#define INSTANCES"),lt.a.PushAttributesForInstances(l),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES"));var v=o.join(`
`);return this._cachedDefines!==v&&(this._cachedDefines=v,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect("volumetricLightScatteringPass",l,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],v,void 0,void 0,void 0,{maxSimultaneousMorphTargets:r.numBoneInfluencers})),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(e){var n=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);n!==-1&&e.getScene().customRenderTargets.splice(n,1),this._volumetricLightScatteringRTT.dispose(),i.prototype.dispose.call(this,e)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1},t.prototype._createPass=function(e,n){var r=this,o=e.getEngine();this._volumetricLightScatteringRTT=new qn("volumetricLightScatteringMap",{width:o.getRenderWidth()*n,height:o.getRenderHeight()*n},e,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=ke.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=ke.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var l=this.getCamera();l?l.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var d,v=function(D){var w=D.getRenderingMesh(),F=D.getEffectiveMesh();if(!r._meshExcluded(w)){F._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var z=D.getMaterial();if(z){var k=w.getScene(),K=k.getEngine();K.setState(z.backFaceCulling);var ae=w._getInstancesRenderList(D._id,!!D.getReplacementMesh());if(!ae.mustReturn){var le=K.getCaps().instancedArrays&&(ae.visibleInstances[D._id]!==null||w.hasThinInstances);if(r._isReady(D,le)){var fe=r._volumetricLightScatteringPass;if(w===r.mesh&&(fe=D.effect?D.effect:z.getEffect()),K.enableEffect(fe),w._bind(D,fe,z.fillMode),w===r.mesh)z.bind(F.getWorldMatrix(),w);else{if(r._volumetricLightScatteringPass.setMatrix("viewProjection",k.getTransformMatrix()),z&&z.needAlphaTesting()){var me=z.getAlphaTestTexture();r._volumetricLightScatteringPass.setTexture("diffuseSampler",me),me&&r._volumetricLightScatteringPass.setMatrix("diffuseMatrix",me.getTextureMatrix())}w.useBones&&w.computeBonesUsingShaders&&w.skeleton&&r._volumetricLightScatteringPass.setMatrices("mBones",w.skeleton.getTransformMatrices(w))}w._processRendering(F,D,r._volumetricLightScatteringPass,pn.a.TriangleFillMode,ae,le,function(be,Ee){return fe.setMatrix("world",Ee)})}}}}},y=new C.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){d=e.clearColor,e.clearColor=y}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){e.clearColor=d}),this._volumetricLightScatteringRTT.customRenderFunction=function(D,w,F,z){var k,K=e.getEngine();if(z.length){for(K.setColorWrite(!1),k=0;k<z.length;k++)v(z.data[k]);K.setColorWrite(!0)}for(k=0;k<D.length;k++)v(D.data[k]);for(k=0;k<w.length;k++)v(w.data[k]);if(F.length){for(k=0;k<F.length;k++){var ae=F.data[k],le=ae.getBoundingInfo();le&&e.activeCamera&&(ae._alphaIndex=ae.getMesh().alphaIndex,ae._distanceToCamera=le.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var fe=F.data.slice(0,F.length);for(fe.sort(function(me,be){return me._alphaIndex>be._alphaIndex?1:me._alphaIndex<be._alphaIndex?-1:me._distanceToCamera<be._distanceToCamera?1:me._distanceToCamera>be._distanceToCamera?-1:0}),K.setAlphaMode(g.a.ALPHA_COMBINE),k=0;k<fe.length;k++)v(fe[k]);K.setAlphaMode(g.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(e){var n,r=e.getTransformMatrix();n=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var o=h.e.Project(n,h.a.Identity(),r,this._viewPort);this._screenCoordinates.x=o.x/this._viewPort.width,this._screenCoordinates.y=o.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,n){var r=Fe.a.CreatePlane(e,1,n);r.billboardMode=jt.a.BILLBOARDMODE_ALL;var o=new rn.a(e+"Material",n);return o.emissiveColor=new C.a(1,1,1),r.material=o,r},Object(f.c)([Object(B.o)()],t.prototype,"customMeshPosition",void 0),Object(f.c)([Object(B.c)()],t.prototype,"useCustomMeshPosition",void 0),Object(f.c)([Object(B.c)()],t.prototype,"invert",void 0),Object(f.c)([Object(B.k)()],t.prototype,"mesh",void 0),Object(f.c)([Object(B.c)()],t.prototype,"excludedMeshes",void 0),Object(f.c)([Object(B.c)()],t.prototype,"exposure",void 0),Object(f.c)([Object(B.c)()],t.prototype,"decay",void 0),Object(f.c)([Object(B.c)()],t.prototype,"weight",void 0),Object(f.c)([Object(B.c)()],t.prototype,"density",void 0),t}(St);R.a.RegisteredTypes["BABYLON.VolumetricLightScatteringPostProcess"]=gE;var HL=`

precision highp float;

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform float curvature_ridge;
uniform float curvature_valley;
#ifndef CURVATURE_OFFSET
#define CURVATURE_OFFSET 1
#endif
float curvature_soft_clamp(float curvature,float control)
{
if (curvature<0.5/control)
return curvature*(1.0-curvature*control);
return 0.25/control;
}
float calculate_curvature(ivec2 texel,float ridge,float valley)
{
vec2 normal_up=texelFetchOffset(normalSampler,texel,0,ivec2(0,CURVATURE_OFFSET)).rb;
vec2 normal_down=texelFetchOffset(normalSampler,texel,0,ivec2(0,-CURVATURE_OFFSET)).rb;
vec2 normal_left=texelFetchOffset(normalSampler,texel,0,ivec2(-CURVATURE_OFFSET,0)).rb;
vec2 normal_right=texelFetchOffset(normalSampler,texel,0,ivec2( CURVATURE_OFFSET,0)).rb;
float normal_diff=((normal_up.g-normal_down.g)+(normal_right.r-normal_left.r));
if (normal_diff<0.0)
return -2.0*curvature_soft_clamp(-normal_diff,valley);
return 2.0*curvature_soft_clamp(normal_diff,ridge);
}
void main(void)
{
ivec2 texel=ivec2(gl_FragCoord.xy);
vec4 baseColor=texture2D(textureSampler,vUV);
float curvature=calculate_curvature(texel,curvature_ridge,curvature_valley);
baseColor.rgb*=curvature+1.0;
gl_FragColor=baseColor;
}`;Qe.a.ShadersStore.screenSpaceCurvaturePixelShader=HL;var vE=function(i){function t(e,n,r,o,l,d,v,y,D){y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1);var w=i.call(this,e,"screenSpaceCurvature",["curvature_ridge","curvature_valley"],["textureSampler","normalSampler"],r,o,l,d,v,void 0,y,void 0,null,D)||this;return w.ridge=1,w.valley=1,w._geometryBufferRenderer=n.enableGeometryBufferRenderer(),w._geometryBufferRenderer?w.onApply=function(F){F.setFloat("curvature_ridge",.5/Math.max(w.ridge*w.ridge,1e-4)),F.setFloat("curvature_valley",.7/Math.max(w.valley*w.valley,1e-4));var z=w._geometryBufferRenderer.getGBuffer().textures[1];F.setTexture("normalSampler",z)}:_.a.Error("Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first."),w}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceCurvaturePostProcess"},Object.defineProperty(t,"IsSupported",{get:function(){var e=re.a.LastCreatedEngine;return!!e&&(e.webGLVersion>1||e.getCaps().drawBuffersExtension)},enumerable:!1,configurable:!0}),t._Parse=function(e,n,r,o){return B.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(f.c)([Object(B.c)()],t.prototype,"ridge",void 0),Object(f.c)([Object(B.c)()],t.prototype,"valley",void 0),t}(St);R.a.RegisteredTypes["BABYLON.ScreenSpaceCurvaturePostProcess"]=vE,c(166),c(167),Object.defineProperty(ne.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(i){this._forceShowBoundingBoxes=i,i&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),ne.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new bE(this)),this._boundingBoxRenderer},Object.defineProperty(jt.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(i){this._showBoundingBox=i,i&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var bE=function(){function i(t){this.name=dt.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new C.a(1,1,1),this.backColor=new C.a(.1,.1,.1),this.showBackLines=!0,this.onBeforeBoxRenderingObservable=new S.c,this.onAfterBoxRenderingObservable=new S.c,this.onResourcesReadyObservable=new S.c,this.enabled=!0,this.renderList=new Gn.a(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=t,t._addComponent(this)}return i.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(dt.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._preActiveMeshStage.registerStep(dt.a.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh),this.scene._evaluateSubMeshStage.registerStep(dt.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(dt.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},i.prototype._evaluateSubMesh=function(t,e){if(t.showSubMeshesBoundingBox){var n=e.getBoundingInfo();n!=null&&(n.boundingBox._tag=t.renderingGroupId,this.renderList.push(n.boundingBox))}},i.prototype._preActiveMesh=function(t){if(t.showBoundingBox||this.scene.forceShowBoundingBoxes){var e=t.getBoundingInfo();e.boundingBox._tag=t.renderingGroupId,this.renderList.push(e.boundingBox)}},i.prototype._prepareResources=function(){if(!this._colorShader){this._colorShader=new bh.a("colorShader",this.scene,"color",{attributes:[De.b.PositionKind],uniforms:["world","viewProjection","color"]}),this._colorShader.reservedDataStore={hidden:!0};var t=this.scene.getEngine(),e=Tt.a.CreateBox({size:1});this._vertexBuffers[De.b.PositionKind]=new De.b(t,e.positions,De.b.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=e.indices,this.onResourcesReadyObservable.notifyObservers(this)}},i.prototype._createIndexBuffer=function(){var t=this.scene.getEngine();this._indexBuffer=t.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},i.prototype.rebuild=function(){var t=this._vertexBuffers[De.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.reset=function(){this.renderList.reset()},i.prototype.render=function(t){if(this.renderList.length!==0&&this.enabled&&(this._prepareResources(),this._colorShader.isReady())){var e=this.scene.getEngine();e.setDepthWrite(!1),this._colorShader._preBind();for(var n=0;n<this.renderList.length;n++){var r=this.renderList.data[n];if(r._tag===t){this.onBeforeBoxRenderingObservable.notifyObservers(r);var o=r.minimum,l=r.maximum.subtract(o),d=o.add(l.scale(.5)),v=h.a.Scaling(l.x,l.y,l.z).multiply(h.a.Translation(d.x,d.y,d.z)).multiply(r.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(pn.a.LineListDrawMode,0,24)),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(pn.a.LineListDrawMode,0,24),this.onAfterBoxRenderingObservable.notifyObservers(r)}}this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0)}},i.prototype.renderOcclusionBoundingBox=function(t){if(this._prepareResources(),this._colorShader.isReady()&&t._boundingInfo){var e=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=e.createIndexBuffer(this._fillIndexData)),e.setDepthWrite(!1),e.setColorWrite(!1),this._colorShader._preBind();var n=t._boundingInfo.boundingBox,r=n.minimum,o=n.maximum.subtract(r),l=r.add(o.scale(.5)),d=h.a.Scaling(o.x,o.y,o.z).multiply(h.a.Translation(l.x,l.y,l.z)).multiply(n.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect()),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(d),e.drawElementsType(pn.a.TriangleFillMode,0,36),this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0),e.setColorWrite(!0)}},i.prototype.dispose=function(){if(this._colorShader){this.onBeforeBoxRenderingObservable.clear(),this.onAfterBoxRenderingObservable.clear(),this.onResourcesReadyObservable.clear(),this.renderList.dispose(),this._colorShader.dispose();var t=this._vertexBuffers[De.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[De.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}},i}();ne.a.prototype.enableDepthRenderer=function(i,t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!1),!(i=i||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[i.id]){var n=!!this.getEngine().getCaps().textureFloatRender,r=0;r=!this.getEngine().getCaps().textureHalfFloatRender||e&&n?n?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_BYTE:g.a.TEXTURETYPE_HALF_FLOAT,this._depthRenderer[i.id]=new ph(this,r,i,t)}return this._depthRenderer[i.id]},ne.a.prototype.disableDepthRenderer=function(i){(i=i||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[i.id]&&(this._depthRenderer[i.id].dispose(),delete this._depthRenderer[i.id])};var yE=function(){function i(t){this.name=dt.a.NAME_DEPTHRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(dt.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(dt.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){for(var t in this.scene._depthRenderer)this.scene._depthRenderer[t].dispose()},i.prototype._gatherRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&!n.useOnlyInActiveCamera&&t.push(n.getDepthMap())}},i.prototype._gatherActiveCameraRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&n.useOnlyInActiveCamera&&this.scene.activeCamera.id===e&&t.push(n.getDepthMap())}},i}();ph._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_DEPTHRENDERER);t||(t=new yE(i),i._addComponent(t))},Qe.a.ShadersStore.linePixelShader=`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`;var WL=`#include<instancesDeclaration>

attribute vec3 position;
attribute vec4 normal;

uniform mat4 viewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
#include<instancesVertex>
mat4 worldViewProjection=viewProjection*finalWorld;
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`;Qe.a.ShadersStore.lineVertexShader=WL,jt.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},jt.a.prototype.enableEdgesRendering=function(i,t,e){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new e_(this,i,t,!0,e),this},Object.defineProperty(jt.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),pl.b.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new TE(this,i,t),this},pl.a.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),pl.b.prototype.enableEdgesRendering.apply(this,arguments),this};var XL=function(){this.edges=new Array,this.edgesConnectedCount=0},e_=function(){function i(t,e,n,r,o){var l,d=this;e===void 0&&(e=.95),n===void 0&&(n=!1),r===void 0&&(r=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._buffersForInstances={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this.customInstances=new Gn.a(32),this._source=t,this._checkVerticesInsteadOfIndices=n,this._options=o??null,this._epsilon=e,this._prepareRessources(),r&&((l=o==null?void 0:o.useAlternateEdgeFinder)===null||l===void 0||l?this._generateEdgesLinesAlternate():this._generateEdgesLines()),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){d._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){d.dispose()})}return Object.defineProperty(i.prototype,"linesPositions",{get:function(){return this._linesPositions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesNormals",{get:function(){return this._linesNormals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesIndices",{get:function(){return this._linesIndices},enumerable:!1,configurable:!0}),i.GetShader=function(t){if(!t._edgeRenderLineShader){var e=new bh.a("lineShader",t,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"]});e.disableDepthWrite=!0,e.backFaceCulling=!1,t._edgeRenderLineShader=e}return t._edgeRenderLineShader},i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=i.GetShader(this._source.getScene()))},i.prototype._rebuild=function(){var t=this._buffers[De.b.PositionKind];t&&t._rebuild(),(t=this._buffers[De.b.NormalKind])&&t._rebuild();var e=this._source.getScene().getEngine();this._ib=e.createIndexBuffer(this._linesIndices)},i.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var t=this._buffers[De.b.PositionKind];t&&(t.dispose(),this._buffers[De.b.PositionKind]=null),(t=this._buffers[De.b.NormalKind])&&(t.dispose(),this._buffers[De.b.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(t,e,n,r,o){return t===n&&e===r||t===r&&e===n?0:t===r&&e===o||t===o&&e===r?1:t===o&&e===n||t===n&&e===o?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(t,e,n,r,o){var l=1e-10;return t.equalsWithEpsilon(n,l)&&e.equalsWithEpsilon(r,l)||t.equalsWithEpsilon(r,l)&&e.equalsWithEpsilon(n,l)?0:t.equalsWithEpsilon(r,l)&&e.equalsWithEpsilon(o,l)||t.equalsWithEpsilon(o,l)&&e.equalsWithEpsilon(r,l)?1:t.equalsWithEpsilon(o,l)&&e.equalsWithEpsilon(n,l)||t.equalsWithEpsilon(n,l)&&e.equalsWithEpsilon(o,l)?2:-1},i.prototype._checkEdge=function(t,e,n,r,o){var l;e===void 0?l=!0:l=h.e.Dot(n[t],n[e])<this._epsilon,l&&this.createLine(r,o,this._linesPositions.length/3)},i.prototype.createLine=function(t,e,n){this._linesPositions.push(t.x,t.y,t.z,t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z),this._linesNormals.push(e.x,e.y,e.z,-1,e.x,e.y,e.z,1,t.x,t.y,t.z,-1,t.x,t.y,t.z,1),this._linesIndices.push(n,n+1,n+2,n,n+2,n+3)},i.prototype._tessellateTriangle=function(t,e,n,r){var o=function(Re,Pe,Ce){Ce>=0&&Pe.push(Ce);for(var Ue=0;Ue<Re.length;++Ue)Pe.push(Re[Ue][0])},l=0;t[1].length>=t[0].length&&t[1].length>=t[2].length?l=1:t[2].length>=t[0].length&&t[2].length>=t[1].length&&(l=2);for(var d=0;d<3;++d)d===l?t[d].sort(function(Re,Pe){return Re[1]<Pe[1]?-1:Re[1]>Pe[1]?1:0}):t[d].sort(function(Re,Pe){return Re[1]>Pe[1]?-1:Re[1]<Pe[1]?1:0});var v=[],y=[];o(t[l],v,-1);for(var D=v.length,w=l+2;w>=l+1;--w)o(t[w%3],y,w!==l+2?r[n[e+(w+1)%3]]:-1);var F=y.length;n.push(r[n[e+l]],v[0],y[0]),n.push(r[n[e+(l+1)%3]],y[F-1],v[D-1]);for(var z=D<=F,k=z?D:F,K=z?F:D,ae=z?D-1:F-1,le=z?0:1,fe=D+F-2,me=0,be=0,Ee=z?v:y,xe=z?y:v,Ae=0;fe-- >0;){le?n.push(Ee[me],xe[be]):n.push(xe[be],Ee[me]);var Ie=void 0;(Ae+=k)>=K&&me<ae?(Ie=Ee[++me],Ae-=K):Ie=xe[++be],n.push(Ie)}n[e+0]=n[n.length-3],n[e+1]=n[n.length-2],n[e+2]=n[n.length-1],n.length=n.length-3},i.prototype._generateEdgesLinesAlternate=function(){var t,e,n,r,o,l,d,v,y,D=this._source.getVerticesData(De.b.PositionKind),w=this._source.getIndices();if(w&&D){Array.isArray(w)||(w=et.b.SliceToArray(w));var F=(e=(t=this._options)===null||t===void 0?void 0:t.useFastVertexMerger)===null||e===void 0||e,z=F?Math.round(-Math.log((r=(n=this._options)===null||n===void 0?void 0:n.epsilonVertexMerge)!==null&&r!==void 0?r:1e-6)/Math.log(10)):(l=(o=this._options)===null||o===void 0?void 0:o.epsilonVertexMerge)!==null&&l!==void 0?l:1e-6,k=[],K=[];if(F)for(var ae={},le=0;le<D.length;le+=3){var fe=D[le+0],me=D[le+1],be=D[le+2];if(ae[Kt=fe.toFixed(z)+"|"+me.toFixed(z)+"|"+be.toFixed(z)]!==void 0)k.push(ae[Kt]);else{var Ee=le/3;ae[Kt]=Ee,k.push(Ee),K.push(Ee)}}else for(le=0;le<D.length;le+=3){fe=D[le+0],me=D[le+1],be=D[le+2];for(var xe=!1,Ae=0;Ae<le&&!xe;Ae+=3){var Ie=D[Ae+0],Re=D[Ae+1],Pe=D[Ae+2];if(Math.abs(fe-Ie)<z&&Math.abs(me-Re)<z&&Math.abs(be-Pe)<z){k.push(Ae/3),xe=!0;break}}xe||(k.push(le/3),K.push(le/3))}if((d=this._options)===null||d===void 0?void 0:d.applyTessellation){for(var Ce=(y=(v=this._options)===null||v===void 0?void 0:v.epsilonVertexAligned)!==null&&y!==void 0?y:1e-6,Ue=[],Oe=0;Oe<w.length;Oe+=3)for(var Ve=void 0,Le=0;Le<3;++Le){var ze=k[w[Oe+Le]],tt=k[w[Oe+(Le+1)%3]],ut=k[w[Oe+(Le+2)%3]];if(ze!==tt)for(var ft=D[3*ze+0],vt=D[3*ze+1],rt=D[3*ze+2],mt=D[3*tt+0],pt=D[3*tt+1],it=D[3*tt+2],yt=Math.sqrt((mt-ft)*(mt-ft)+(pt-vt)*(pt-vt)+(it-rt)*(it-rt)),We=0;We<K.length-1;We++){var at=K[We];if(at!==ze&&at!==tt&&at!==ut){var It=D[3*at+0],vn=D[3*at+1],Jt=D[3*at+2],Sn=Math.sqrt((It-ft)*(It-ft)+(vn-vt)*(vn-vt)+(Jt-rt)*(Jt-rt)),Rt=Math.sqrt((It-mt)*(It-mt)+(vn-pt)*(vn-pt)+(Jt-it)*(Jt-it));Math.abs(Sn+Rt-yt)<Ce&&(Ve||(Ve={index:Oe,edgesPoints:[[],[],[]]},Ue.push(Ve)),Ve.edgesPoints[Le].push([at,Sn]))}}}for(var Rn=0;Rn<Ue.length;++Rn){var bn=Ue[Rn];this._tessellateTriangle(bn.edgesPoints,bn.index,w,k)}Ue=null}var hn={};for(Oe=0;Oe<w.length;Oe+=3){var yn=void 0;for(Le=0;Le<3;++Le)if(ze=k[w[Oe+Le]],tt=k[w[Oe+(Le+1)%3]],ut=k[w[Oe+(Le+2)%3]],ze!==tt){if(h.c.Vector3[0].copyFromFloats(D[3*ze+0],D[3*ze+1],D[3*ze+2]),h.c.Vector3[1].copyFromFloats(D[3*tt+0],D[3*tt+1],D[3*tt+2]),h.c.Vector3[2].copyFromFloats(D[3*ut+0],D[3*ut+1],D[3*ut+2]),yn||(h.c.Vector3[1].subtractToRef(h.c.Vector3[0],h.c.Vector3[3]),h.c.Vector3[2].subtractToRef(h.c.Vector3[1],h.c.Vector3[4]),(yn=h.e.Cross(h.c.Vector3[3],h.c.Vector3[4])).normalize()),ze>tt){var Lt=ze;ze=tt,tt=Lt}(In=hn[Kt=ze+"_"+tt])?In.done||(h.e.Dot(yn,In.normal)<this._epsilon&&this.createLine(h.c.Vector3[0],h.c.Vector3[1],this._linesPositions.length/3),In.done=!0):hn[Kt]={normal:yn,done:!1,index:Oe,i:Le}}}for(var Kt in hn){var In;(In=hn[Kt]).done||(ze=k[w[In.index+In.i]],tt=k[w[In.index+(In.i+1)%3]],h.c.Vector3[0].copyFromFloats(D[3*ze+0],D[3*ze+1],D[3*ze+2]),h.c.Vector3[1].copyFromFloats(D[3*tt+0],D[3*tt+1],D[3*tt+2]),this.createLine(h.c.Vector3[0],h.c.Vector3[1],this._linesPositions.length/3))}var wr=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(wr,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(wr,this._linesNormals,De.b.NormalKind,!1,!1,4),this._buffersForInstances[De.b.PositionKind]=this._buffers[De.b.PositionKind],this._buffersForInstances[De.b.NormalKind]=this._buffers[De.b.NormalKind],this._ib=wr.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype._generateEdgesLines=function(){var t=this._source.getVerticesData(De.b.PositionKind),e=this._source.getIndices();if(e&&t){var n,r,o=new Array,l=new Array;for(n=0;n<e.length;n+=3){r=new XL;var d=e[n],v=e[n+1],y=e[n+2];r.p0=new h.e(t[3*d],t[3*d+1],t[3*d+2]),r.p1=new h.e(t[3*v],t[3*v+1],t[3*v+2]),r.p2=new h.e(t[3*y],t[3*y+1],t[3*y+2]);var D=h.e.Cross(r.p1.subtract(r.p0),r.p2.subtract(r.p1));D.normalize(),l.push(D),o.push(r)}for(n=0;n<o.length;n++){r=o[n];for(var w=n+1;w<o.length;w++){var F=o[w];if(r.edgesConnectedCount===3)break;if(F.edgesConnectedCount!==3)for(var z=e[3*w],k=e[3*w+1],K=e[3*w+2],ae=0;ae<3;ae++){var le=0;if(r.edges[ae]===void 0){switch(ae){case 0:le=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p0,r.p1,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n],e[3*n+1],z,k,K);break;case 1:le=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p1,r.p2,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n+1],e[3*n+2],z,k,K);break;case 2:le=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p2,r.p0,F.p0,F.p1,F.p2):this._processEdgeForAdjacencies(e[3*n+2],e[3*n],z,k,K)}if(le!==-1&&(r.edges[ae]=w,F.edges[le]=n,r.edgesConnectedCount++,F.edgesConnectedCount++,r.edgesConnectedCount===3))break}}}}for(n=0;n<o.length;n++){var fe=o[n];this._checkEdge(n,fe.edges[0],l,fe.p0,fe.p1),this._checkEdge(n,fe.edges[1],l,fe.p1,fe.p2),this._checkEdge(n,fe.edges[2],l,fe.p2,fe.p0)}var me=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(me,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(me,this._linesNormals,De.b.NormalKind,!1,!1,4),this._buffersForInstances[De.b.PositionKind]=this._buffers[De.b.PositionKind],this._buffersForInstances[De.b.NormalKind]=this._buffers[De.b.NormalKind],this._ib=me.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype.isReady=function(){return this._lineShader.isReady(this._source,this._source.hasInstances&&this.customInstances.length>0||this._source.hasThinInstances)},i.prototype.render=function(){var t=this._source.getScene();if(this.isReady()&&t.activeCamera){var e=t.getEngine();this._lineShader._preBind(),this._source.edgesColor.a!==1?e.setAlphaMode(g.a.ALPHA_COMBINE):e.setAlphaMode(g.a.ALPHA_DISABLE);var n=this._source.hasInstances&&this.customInstances.length>0,r=n||this._source.hasThinInstances,o=0;if(r)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),n){var l=this._source._instanceDataStorage;if(o=this.customInstances.length,!l.isFrozen){for(var d=0,v=0;v<o;++v)this.customInstances.data[v].copyToArray(l.instancesData,d),d+=16;l.instancesBuffer.updateDirectly(l.instancesData,0,o)}}else o=this._source.thinInstanceCount;e.bindBuffers(r?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===Pt.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",e.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),e.drawElementsType(pn.a.TriangleFillMode,0,this._indicesCount,o),this._lineShader.unbind(),r&&e.unbindInstanceAttributes(),this._source.getScene()._activeMeshesFrozen||this.customInstances.reset()}},i}(),TE=function(i){function t(e,n,r){n===void 0&&(n=.95),r===void 0&&(r=!1);var o=i.call(this,e,n,r,!1)||this;return o._generateEdgesLines(),o}return Object(f.d)(t,i),t.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(De.b.PositionKind),n=this._source.getIndices();if(n&&e){for(var r=h.c.Vector3[0],o=h.c.Vector3[1],l=n.length-1,d=0,v=0;d<l;d+=2,v+=4)h.e.FromArrayToRef(e,3*n[d],r),h.e.FromArrayToRef(e,3*n[d+1],o),this.createLine(r,o,v);var y=this._source.getScene().getEngine();this._buffers[De.b.PositionKind]=new De.b(y,this._linesPositions,De.b.PositionKind,!1),this._buffers[De.b.NormalKind]=new De.b(y,this._linesNormals,De.b.NormalKind,!1,!1,4),this._ib=y.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(e_),t_=function(){function i(t){this._textureFormats=[{type:g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_POSITION_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT},{type:g.a.PREPASS_COLOR_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_ALBEDO_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT}],this.excludedSkinnedMesh=[],this.excludedMaterials=[],this._textureIndices=[],this._isDirty=!1,this.mrtCount=0,this._postProcesses=[],this._clearColor=new C.b(0,0,0,0),this._effectConfigurations=[],this._mrtFormats=[],this._enabled=!1,this._useGeometryBufferFallback=!1,this.disableGammaTransform=!1,this._scene=t,this._engine=t.getEngine(),i._SceneComponentInitialization(this._scene),this._resetLayout()}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"samples",{get:function(){return this.prePassRT.samples},set:function(t){this.imageProcessingPostProcess||this._createCompositionEffect(),this.prePassRT.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useGeometryBufferFallback",{get:function(){return this._useGeometryBufferFallback},set:function(t){if(this._useGeometryBufferFallback=t,t){if(this._geometryBuffer=this._scene.enableGeometryBufferRenderer(),!this._geometryBuffer)return void(this._useGeometryBufferFallback=!1);this._geometryBuffer.renderList=[],this._geometryBuffer._linkPrePassRenderer(this),this._updateGeometryBufferLayout()}else this._geometryBuffer&&this._geometryBuffer._unlinkPrePassRenderer(),this._geometryBuffer=null,this._scene.disableGeometryBufferRenderer()},enumerable:!1,configurable:!0}),i.prototype._initializeAttachments=function(){for(var t=[],e=[!1],n=[!0],r=0;r<this.mrtCount;r++)t.push(!0),r>0&&(e.push(!0),n.push(!1));this._multiRenderAttachments=this._engine.buildTextureLayout(t),this._clearAttachments=this._engine.buildTextureLayout(e),this._defaultAttachments=this._engine.buildTextureLayout(n)},i.prototype._createCompositionEffect=function(){this.prePassRT=new am("sceneprePassRT",{width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight()},this.mrtCount,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_UNSIGNED_INT,types:this._mrtFormats}),this.prePassRT.samples=1,this._initializeAttachments(),this._useGeometryBufferFallback&&!this._geometryBuffer&&(this.useGeometryBufferFallback=!0),this.imageProcessingPostProcess=new qu("sceneCompositionPass",1,null,void 0,this._engine),this.imageProcessingPostProcess.autoClear=!1},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._scene.getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),i.prototype.bindAttachmentsForEffect=function(t,e){if(this.enabled){if(t._multiTarget)this._engine.bindAttachments(this._multiRenderAttachments);else if(this._engine.bindAttachments(this._defaultAttachments),this._geometryBuffer){var n=e.getMaterial();n&&this.excludedMaterials.indexOf(n)===-1&&this._geometryBuffer.renderList.push(e.getRenderingMesh())}}},i.prototype.restoreAttachments=function(){this.enabled&&this._defaultAttachments&&this._engine.bindAttachments(this._defaultAttachments)},i.prototype._beforeCameraDraw=function(){this._isDirty&&this._update(),this._geometryBuffer&&(this._geometryBuffer.renderList.length=0),this._bindFrameBuffer()},i.prototype._afterCameraDraw=function(){if(this._enabled){var t=this._scene.activeCamera&&this._scene.activeCamera._getFirstPostProcess();t&&this._postProcesses.length&&this._scene.postProcessManager._prepareFrame(),this._scene.postProcessManager.directRender(this._postProcesses,t?t.inputTexture:null)}},i.prototype._checkRTSize=function(){var t=this._engine.getRenderWidth(!0),e=this._engine.getRenderHeight(!0),n=this.prePassRT.getRenderWidth(),r=this.prePassRT.getRenderHeight();n===t&&r===e||(this.prePassRT.resize({width:t,height:e}),this._updateGeometryBufferLayout(),this._bindPostProcessChain())},i.prototype._bindFrameBuffer=function(){if(this._enabled){this._checkRTSize();var t=this.prePassRT.getInternalTexture();t&&this._engine.bindFramebuffer(t)}},i.prototype.clear=function(){this._enabled&&(this._bindFrameBuffer(),this._engine.clear(this._scene.clearColor,this._scene.autoClear||this._scene.forceWireframe||this._scene.forcePointsCloud,this._scene.autoClearDepthAndStencil,this._scene.autoClearDepthAndStencil),this._engine.bindAttachments(this._clearAttachments),this._engine.clear(this._clearColor,!0,!1,!1),this._engine.bindAttachments(this._defaultAttachments))},i.prototype._setState=function(t){this._enabled=t,this._scene.prePass=t,this.imageProcessingPostProcess&&(this.imageProcessingPostProcess.imageProcessingConfiguration.applyByPostProcess=t)},i.prototype._updateGeometryBufferLayout=function(){if(this._geometryBuffer){this._geometryBuffer._resetLayout();for(var t=[],e=0;e<this._mrtLayout.length;e++)t.push(!1);this._geometryBuffer._linkInternalTexture(this.prePassRT.getInternalTexture());var n=[{prePassConstant:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,geometryBufferConstant:xi.DEPTHNORMAL_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_POSITION_TEXTURE_TYPE,geometryBufferConstant:xi.POSITION_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,geometryBufferConstant:xi.REFLECTIVITY_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,geometryBufferConstant:xi.VELOCITY_TEXTURE_TYPE}];for(e=0;e<n.length;e++){var r=this._mrtLayout.indexOf(n[e].prePassConstant);r!==-1&&(this._geometryBuffer._forceTextureType(n[e].geometryBufferConstant,r),t[r]=!0)}this._geometryBuffer._setAttachments(this._engine.buildTextureLayout(t))}},i.prototype.addEffectConfiguration=function(t){for(var e=0;e<this._effectConfigurations.length;e++)if(this._effectConfigurations[e].name===t.name)return this._effectConfigurations[e];return this._effectConfigurations.push(t),t},i.prototype.getIndex=function(t){return this._textureIndices[t]},i.prototype._enable=function(){for(var t,e,n=this.mrtCount,r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&this._enableTextures(this._effectConfigurations[r].texturesRequired);for(this.prePassRT&&this.mrtCount!==n&&this.prePassRT.updateCount(this.mrtCount,{types:this._mrtFormats}),this._updateGeometryBufferLayout(),this._resetPostProcessChain(),r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&(!this._effectConfigurations[r].postProcess&&this._effectConfigurations[r].createPostProcess&&this._effectConfigurations[r].createPostProcess(),this._effectConfigurations[r].postProcess&&this._postProcesses.push(this._effectConfigurations[r].postProcess));this._initializeAttachments(),this.imageProcessingPostProcess||this._createCompositionEffect();var o=!1;if((t=this._scene.activeCamera)===null||t===void 0?void 0:t._postProcesses)for(r=0;r<this._scene.activeCamera._postProcesses.length;r++)((e=this._scene.activeCamera._postProcesses[r])===null||e===void 0?void 0:e.getClassName())==="ImageProcessingPostProcess"&&(o=!0);o||this.disableGammaTransform||this._postProcesses.push(this.imageProcessingPostProcess),this._bindPostProcessChain(),this._setState(!0)},i.prototype._disable=function(){this._setState(!1),this._resetLayout();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].enabled=!1},i.prototype._resetLayout=function(){for(var t=0;t<this._textureFormats.length;t++)this._textureIndices[this._textureFormats[t].type]=-1;this._textureIndices[g.a.PREPASS_COLOR_TEXTURE_TYPE]=0,this._mrtLayout=[g.a.PREPASS_COLOR_TEXTURE_TYPE],this._mrtFormats=[g.a.TEXTURETYPE_HALF_FLOAT],this.mrtCount=1},i.prototype._resetPostProcessChain=function(){this._postProcesses=[],this.imageProcessingPostProcess&&this.imageProcessingPostProcess.restoreDefaultInputTexture();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].postProcess&&this._effectConfigurations[t].postProcess.restoreDefaultInputTexture()},i.prototype._bindPostProcessChain=function(){var t;if(this._postProcesses.length)this._postProcesses[0].inputTexture=this.prePassRT.getInternalTexture();else{var e=(t=this._scene.activeCamera)===null||t===void 0?void 0:t._getFirstPostProcess();e&&(e.inputTexture=this.prePassRT.getInternalTexture())}},i.prototype.markAsDirty=function(){this._isDirty=!0},i.prototype._enableTextures=function(t){for(var e=0;e<t.length;e++){var n=t[e];this._textureIndices[n]===-1&&(this._textureIndices[n]=this._mrtLayout.length,this._mrtLayout.push(n),this._mrtFormats.push(this._textureFormats[n].format),this.mrtCount++)}},i.prototype._update=function(){this._disable();for(var t=!1,e=0;e<this._scene.materials.length;e++)this._scene.materials[e].setPrePassRenderer(this)&&(t=!0);var n=this._scene.activeCamera;if(n){var r=n._postProcesses.filter(function(o){return o!=null});if(r)for(e=0;e<r.length;e++)r[e].setPrePassRenderer(this)&&(t=!0);this._markAllMaterialsAsPrePassDirty(),this._isDirty=!1,t&&this._enable(),this.enabled||(this._engine.restoreDefaultFramebuffer(),this._engine.restoreSingleAttachment())}},i.prototype._markAllMaterialsAsPrePassDirty=function(){for(var t=this._scene.materials,e=0;e<t.length;e++)t[e].markAsDirty(pn.a.PrePassDirtyFlag)},i.prototype.dispose=function(){for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].dispose&&this._effectConfigurations[t].dispose();this.imageProcessingPostProcess.dispose(),this.prePassRT.dispose()},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("PrePassRendererSceneComponent")},i}();Object.defineProperty(ne.a.prototype,"prePassRenderer",{get:function(){return this._prePassRenderer},set:function(i){i&&i.isSupported&&(this._prePassRenderer=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enablePrePassRenderer=function(){return this._prePassRenderer||(this._prePassRenderer=new t_(this),this._prePassRenderer.isSupported||(this._prePassRenderer=null,_.a.Error(`PrePassRenderer needs WebGL 2 support.
Maybe you tried to use the following features that need the PrePassRenderer :
 + Subsurface Scattering`))),this._prePassRenderer},ne.a.prototype.disablePrePassRenderer=function(){this._prePassRenderer&&(this._prePassRenderer.dispose(),this._prePassRenderer=null)};var EE=function(){function i(t){this.name=dt.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(dt.a.STEP_BEFORECAMERADRAW_PREPASS,this,this._beforeCameraDraw),this.scene._afterCameraDrawStage.registerStep(dt.a.STEP_AFTERCAMERADRAW_PREPASS,this,this._afterCameraDraw),this.scene._beforeClearStage.registerStep(dt.a.STEP_BEFORECLEARSTAGE_PREPASS,this,this._beforeClearStage),this.scene._beforeRenderingMeshStage.registerStep(dt.a.STEP_BEFORERENDERINGMESH_PREPASS,this,this._beforeRenderingMeshStage),this.scene._afterRenderingMeshStage.registerStep(dt.a.STEP_AFTERRENDERINGMESH_PREPASS,this,this._afterRenderingMeshStage)},i.prototype._beforeCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._beforeCameraDraw()},i.prototype._afterCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._afterCameraDraw()},i.prototype._beforeClearStage=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer.clear()},i.prototype._beforeRenderingMeshStage=function(t,e,n,r){if(r){var o=t.getScene();o.prePassRenderer&&o.prePassRenderer.bindAttachmentsForEffect(r,e)}},i.prototype._afterRenderingMeshStage=function(t){var e=t.getScene();e.prePassRenderer&&e.prePassRenderer.restoreAttachments()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();t_._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_PREPASSRENDERER);t||(t=new EE(i),i._addComponent(t))};var YL=`#define rcp(x) 1./x
#define GOLDEN_RATIO 1.618033988749895
#define TWO_PI 6.2831855


vec2 Golden2dSeq(int i,float n)
{


return vec2(float(i)/n+(0.5/n),fract(float(i)*rcp(GOLDEN_RATIO)));
}
vec2 SampleDiskGolden(int i,int sampleCount)
{
vec2 f=Golden2dSeq(i,float(sampleCount));
return vec2(sqrt(f.x),TWO_PI*f.y);
}`;Qe.a.IncludesShadersStore.fibonacci=YL;var KL=`uniform vec3 diffusionS[5];
uniform float diffusionD[5];
uniform float filterRadii[5];`;Qe.a.IncludesShadersStore.diffusionProfile=KL;var QL=`
#include<fibonacci>
#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<diffusionProfile>
varying vec2 vUV;
uniform vec2 texelSize;
uniform sampler2D textureSampler;
uniform sampler2D irradianceSampler;
uniform sampler2D depthSampler;
uniform sampler2D albedoSampler;
uniform vec2 viewportSize;
uniform float metersPerUnit;
const float LOG2_E=1.4426950408889634;
const float SSS_PIXELS_PER_SAMPLE=4.;
const int _SssSampleBudget=40;
#define rcp(x) 1./x
#define Sq(x) x*x
#define SSS_BILATERAL_FILTER true


vec3 EvalBurleyDiffusionProfile(float r,vec3 S)
{
vec3 exp_13=exp2(((LOG2_E*(-1.0/3.0))*r)*S);
vec3 expSum=exp_13*(1.+exp_13*exp_13);
return (S*rcp(8.*PI))*expSum;
}






vec2 SampleBurleyDiffusionProfile(float u,float rcpS)
{
u=1.-u;
float g=1.+(4.*u)*(2.*u+sqrt(1.+(4.*u)*u));
float n=exp2(log2(g)*(-1.0/3.0));
float p=(g*n)*n;
float c=1.+p+n;
float d=(3./LOG2_E*2.)+(3./LOG2_E)*log2(u);
float x=(3./LOG2_E)*log2(c)-d;






float rcpExp=((c*c)*c)*rcp((4.*u)*((c*c)+(4.*u)*(4.*u)));
float r=x*rcpS;
float rcpPdf=(8.*PI*rcpS)*rcpExp;
return vec2(r,rcpPdf);
}


vec3 ComputeBilateralWeight(float xy2,float z,float mmPerUnit,vec3 S,float rcpPdf)
{
#ifndef SSS_BILATERAL_FILTER
z=0.;
#endif



float r=sqrt(xy2+(z*mmPerUnit)*(z*mmPerUnit));
float area=rcpPdf;
#if SSS_CLAMP_ARTIFACT
return clamp(EvalBurleyDiffusionProfile(r,S)*area,0.0,1.0);
#else
return EvalBurleyDiffusionProfile(r,S)*area;
#endif
}
void EvaluateSample(int i,int n,vec3 S,float d,vec3 centerPosVS,float mmPerUnit,float pixelsPerMm,
float phase,inout vec3 totalIrradiance,inout vec3 totalWeight)
{

float scale=rcp(float(n));
float offset=rcp(float(n))*0.5;

float sinPhase,cosPhase;
sinPhase=sin(phase);
cosPhase=cos(phase);
vec2 bdp=SampleBurleyDiffusionProfile(float(i)*scale+offset,d);
float r=bdp.x;
float rcpPdf=bdp.y;
float phi=SampleDiskGolden(i,n).y;
float sinPhi,cosPhi;
sinPhi=sin(phi);
cosPhi=cos(phi);
float sinPsi=cosPhase*sinPhi+sinPhase*cosPhi;
float cosPsi=cosPhase*cosPhi-sinPhase*sinPhi;
vec2 vec=r*vec2(cosPsi,sinPsi);

vec2 position;
float xy2;
position=vUV+round((pixelsPerMm*r)*vec2(cosPsi,sinPsi))*texelSize;
xy2=r*r;
vec4 textureSample=texture2D(irradianceSampler,position);
float viewZ=texture2D(depthSampler,position).r;
vec3 irradiance=textureSample.rgb;
if (testLightingForSSS(textureSample.a))
{

float relZ=viewZ-centerPosVS.z;
vec3 weight=ComputeBilateralWeight(xy2,relZ,mmPerUnit,S,rcpPdf);
totalIrradiance+=weight*irradiance;
totalWeight+=weight;
}
else
{






}
}
void main(void)
{
vec4 irradianceAndDiffusionProfile=texture2D(irradianceSampler,vUV);
vec3 centerIrradiance=irradianceAndDiffusionProfile.rgb;
int diffusionProfileIndex=int(round(irradianceAndDiffusionProfile.a*255.));
float centerDepth=0.;
vec4 inputColor=texture2D(textureSampler,vUV);
bool passedStencilTest=testLightingForSSS(irradianceAndDiffusionProfile.a);
if (passedStencilTest)
{
centerDepth=texture2D(depthSampler,vUV).r;
}
if (!passedStencilTest) {
gl_FragColor=inputColor;
return;
}
float distScale=1.;
vec3 S=diffusionS[diffusionProfileIndex];
float d=diffusionD[diffusionProfileIndex];
float filterRadius=filterRadii[diffusionProfileIndex];

vec2 centerPosNDC=vUV;
vec2 cornerPosNDC=vUV+0.5*texelSize;
vec3 centerPosVS=vec3(centerPosNDC*viewportSize,1.0)*centerDepth;
vec3 cornerPosVS=vec3(cornerPosNDC*viewportSize,1.0)*centerDepth;

float mmPerUnit=1000.*(metersPerUnit*rcp(distScale));
float unitsPerMm=rcp(mmPerUnit);


float unitsPerPixel=2.*abs(cornerPosVS.x-centerPosVS.x);
float pixelsPerMm=rcp(unitsPerPixel)*unitsPerMm;

float filterArea=PI*Sq(filterRadius*pixelsPerMm);
int sampleCount=int(filterArea*rcp(SSS_PIXELS_PER_SAMPLE));
int sampleBudget=_SssSampleBudget;
int texturingMode=0;
vec3 albedo=texture2D(albedoSampler,vUV).rgb;
if (distScale == 0. || sampleCount<1)
{
#ifdef DEBUG_SSS_SAMPLES
vec3 green=vec3(0.,1.,0.);
gl_FragColor=vec4(green,1.0);
return;
#endif
gl_FragColor=vec4(inputColor.rgb+albedo*centerIrradiance,1.0);
return;
}
#ifdef DEBUG_SSS_SAMPLES
vec3 red=vec3(1.,0.,0.);
vec3 blue=vec3(0.,0.,1.);
gl_FragColor=vec4(mix(blue,red,clamp(float(sampleCount)/float(sampleBudget),0.0,1.0)),1.0);
return;
#endif

float phase=0.;
int n=min(sampleCount,sampleBudget);

vec3 centerWeight=vec3(0.);
vec3 totalIrradiance=vec3(0.);
vec3 totalWeight=vec3(0.);
for (int i=0; i<n; i++)
{

EvaluateSample(i,n,S,d,centerPosVS,mmPerUnit,pixelsPerMm,
phase,totalIrradiance,totalWeight);
}

totalWeight=max(totalWeight,HALF_MIN);
gl_FragColor=vec4(inputColor.rgb+albedo*max(totalIrradiance/totalWeight,vec3(0.0)),1.);
}`;Qe.a.ShadersStore.subSurfaceScatteringPixelShader=QL;var qL=function(i){function t(e,n,r,o,l,d,v,y){o===void 0&&(o=null),y===void 0&&(y=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,e,"subSurfaceScattering",["texelSize","viewportSize","metersPerUnit"],["diffusionS","diffusionD","filterRadii","irradianceSampler","depthSampler","albedoSampler"],r,o,l||ke.a.BILINEAR_SAMPLINGMODE,d,v,null,y,"postprocess",void 0,!0)||this;return D._scene=n,D.updateEffect(),D.onApplyObservable.add(function(w){if(n.prePassRenderer&&n.subSurfaceConfiguration){var F=D.texelSize;w.setFloat("metersPerUnit",n.subSurfaceConfiguration.metersPerUnit),w.setFloat2("texelSize",F.x,F.y),w.setTexture("irradianceSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE)]),w.setTexture("depthSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),w.setTexture("albedoSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_ALBEDO_TEXTURE_TYPE)]),w.setFloat2("viewportSize",Math.tan(n.activeCamera.fov/2)*n.getEngine().getAspectRatio(n.activeCamera,!0),Math.tan(n.activeCamera.fov/2)),w.setArray3("diffusionS",n.subSurfaceConfiguration.ssDiffusionS),w.setArray("diffusionD",n.subSurfaceConfiguration.ssDiffusionD),w.setArray("filterRadii",n.subSurfaceConfiguration.ssFilterRadii)}else _.a.Error("PrePass and subsurface configuration needs to be enabled for subsurface scattering.")}),D}return Object(f.d)(t,i),t.prototype.getClassName=function(){return"SubSurfaceScatteringPostProcess"},t}(St),SE=function(){function i(t){this._ssDiffusionS=[],this._ssFilterRadii=[],this._ssDiffusionD=[],this.enabled=!1,this.name=dt.a.NAME_SUBSURFACE,this.ssDiffusionProfileColors=[],this.metersPerUnit=1,this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_ALBEDO_TEXTURE_TYPE,g.a.PREPASS_COLOR_TEXTURE_TYPE,g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE],this.addDiffusionProfile(new C.a(1,1,1)),this._scene=t,i._SceneComponentInitialization(this._scene)}return Object.defineProperty(i.prototype,"ssDiffusionS",{get:function(){return this._ssDiffusionS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssDiffusionD",{get:function(){return this._ssDiffusionD},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssFilterRadii",{get:function(){return this._ssFilterRadii},enumerable:!1,configurable:!0}),i.prototype.addDiffusionProfile=function(t){if(this.ssDiffusionD.length>=5)return _.a.Error("You already reached the maximum number of diffusion profiles."),0;for(var e=0;e<this._ssDiffusionS.length/3;e++)if(this._ssDiffusionS[3*e]===t.r&&this._ssDiffusionS[3*e+1]===t.g&&this._ssDiffusionS[3*e+2]===t.b)return e;return this._ssDiffusionS.push(t.r,t.b,t.g),this._ssDiffusionD.push(Math.max(Math.max(t.r,t.b),t.g)),this._ssFilterRadii.push(this.getDiffusionProfileParameters(t)),this.ssDiffusionProfileColors.push(t),this._ssDiffusionD.length-1},i.prototype.createPostProcess=function(){return this.postProcess=new qL("subSurfaceScattering",this._scene,1,null,void 0,this._scene.getEngine()),this.postProcess.autoClear=!1,this.postProcess},i.prototype.clearAllDiffusionProfiles=function(){this._ssDiffusionD=[],this._ssDiffusionS=[],this._ssFilterRadii=[],this.ssDiffusionProfileColors=[]},i.prototype.dispose=function(){this.clearAllDiffusionProfiles(),this.postProcess.dispose()},i.prototype.getDiffusionProfileParameters=function(t){var e=Math.max(t.r,t.g,t.b);return this._sampleBurleyDiffusionProfile(.997,e)},i.prototype._sampleBurleyDiffusionProfile=function(t,e){var n=1+4*(t=1-t)*(2*t+Math.sqrt(1+4*t*t)),r=Math.pow(n,-1/3),o=1+n*r*r+r;return 3*Math.log(o/(4*t))*e},i._SceneComponentInitialization=function(t){throw dr.a.WarnImport("PrePassRendererSceneComponent")},i}();E.a.AddParser(dt.a.NAME_SUBSURFACE,function(i,t){if(i.ssDiffusionProfileColors!==void 0&&i.ssDiffusionProfileColors!==null&&(t.enableSubSurfaceForPrePass(),t.subSurfaceConfiguration))for(var e=0,n=i.ssDiffusionProfileColors.length;e<n;e++){var r=i.ssDiffusionProfileColors[e];t.subSurfaceConfiguration.addDiffusionProfile(new C.a(r.r,r.g,r.b))}}),Object.defineProperty(ne.a.prototype,"subSurfaceConfiguration",{get:function(){return this._subSurfaceConfiguration},set:function(i){i&&this.enablePrePassRenderer()&&(this._subSurfaceConfiguration=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enableSubSurfaceForPrePass=function(){if(this._subSurfaceConfiguration)return this._subSurfaceConfiguration;var i=this.enablePrePassRenderer();return i?(this._subSurfaceConfiguration=new SE(this),i.addEffectConfiguration(this._subSurfaceConfiguration),this._subSurfaceConfiguration):null},ne.a.prototype.disableSubSurfaceForPrePass=function(){this._subSurfaceConfiguration&&(this._subSurfaceConfiguration.dispose(),this._subSurfaceConfiguration=null)};var xE=function(){function i(t){this.name=dt.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){},i.prototype.serialize=function(t){if(this.scene.subSurfaceConfiguration){var e=this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;t.ssDiffusionProfileColors=[];for(var n=0;n<e.length;n++)t.ssDiffusionProfileColors.push({r:e[n].r,g:e[n].g,b:e[n].b})}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){this.scene.prePassRenderer&&this.scene.subSurfaceConfiguration&&this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();SE._SceneComponentInitialization=function(i){var t=i._getComponent(dt.a.NAME_SUBSURFACE);t||(t=new xE(i),i._addComponent(t))};var ZL=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`;Qe.a.ShadersStore.outlinePixelShader=ZL;var $L=`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
vec3 offsetPosition=positionUpdated+(normalUpdated*offset);
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`;Qe.a.ShadersStore.outlineVertexShader=$L,ne.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new AE(this)),this._outlineRenderer},Object.defineProperty(Fe.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOutline=i},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOverlay=i},enumerable:!0,configurable:!0});var AE=function(){function i(t){this.name=dt.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=t,this._engine=t.getEngine(),this.scene._addComponent(this)}return i.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(dt.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(dt.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype.render=function(t,e,n){var r=this;n===void 0&&(n=!1);var o=this.scene,l=o.getEngine(),d=l.getCaps().instancedArrays&&(e.visibleInstances[t._id]!==null&&e.visibleInstances[t._id]!==void 0||t.getRenderingMesh().hasThinInstances);if(this.isReady(t,d)){var v=t.getMesh(),y=v._internalAbstractMeshDataInfo._actAsRegularMesh?v:null,D=t.getRenderingMesh(),w=y||D,F=t.getMaterial();if(F&&o.activeCamera){if(l.enableEffect(this._effect),F.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(o.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",n?0:D.outlineWidth),this._effect.setColor4("color",n?D.overlayColor:D.outlineColor,n?D.overlayAlpha:F.alpha),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),this._effect.setMatrix("world",w.getWorldMatrix()),D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&this._effect.setMatrices("mBones",D.skeleton.getTransformMatrices(D)),lt.a.BindMorphTargetParameters(D,this._effect),D._bind(t,this._effect,F.fillMode),F&&F.needAlphaTesting()){var z=F.getAlphaTestTexture();z&&(this._effect.setTexture("diffuseSampler",z),this._effect.setMatrix("diffuseMatrix",z.getTextureMatrix()))}l.setZOffset(-this.zOffset),D._processRendering(w,t,this._effect,F.fillMode,e,d,function(k,K){r._effect.setMatrix("world",K)}),l.setZOffset(0)}}},i.prototype.isReady=function(t,e){var n=[],r=[De.b.PositionKind,De.b.NormalKind],o=t.getMesh(),l=t.getMaterial();l&&(l.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(De.b.UVKind)&&(r.push(De.b.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(De.b.UV2Kind)&&(r.push(De.b.UV2Kind),n.push("#define UV2"))),l.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH")),o.useBones&&o.computeBonesUsingShaders?(r.push(De.b.MatricesIndicesKind),r.push(De.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(De.b.MatricesIndicesExtraKind),r.push(De.b.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0");var d=o.morphTargetManager,v=0;d&&d.numInfluencers>0&&(v=d.numInfluencers,n.push("#define MORPHTARGETS"),n.push("#define NUM_MORPH_INFLUENCERS "+v),lt.a.PrepareAttributesForMorphTargetsInfluencers(r,o,v)),e&&(n.push("#define INSTANCES"),lt.a.PushAttributesForInstances(r),t.getRenderingMesh().hasThinInstances&&n.push("#define THIN_INSTANCES"));var y=n.join(`
`);return this._cachedDefines!==y&&(this._cachedDefines=y,this._effect=this.scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences"],["diffuseSampler"],y,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype._beforeRenderingMesh=function(t,e,n){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){var r=e.getMaterial();r&&r.needAlphaBlendingForMesh(t)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(g.a.REPLACE),this._engine.setStencilFunction(g.a.ALWAYS),this._engine.setStencilMask(i._StencilReference),this._engine.setStencilFunctionReference(i._StencilReference),this.render(e,n,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(g.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(e,n),this._engine.setDepthWrite(this._savedDepthWrite),r&&r.needAlphaBlendingForMesh(t)&&this._engine.restoreStencilState()}},i.prototype._afterRenderingMesh=function(t,e,n){if(t.renderOverlay){var r=this._engine.getAlphaMode(),o=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(g.a.ALPHA_COMBINE),this.render(e,n,!0),this._engine.setAlphaMode(r),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=o}t.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(e,n),this._engine.setColorWrite(!0))},i._StencilReference=4,i}(),JL=c(148),PE=function(i){function t(e,n){var r=i.call(this)||this;return r.name=e,r.animations=new Array,r.isPickable=!1,r.useAlphaForPicking=!1,r.onDisposeObservable=new S.c,r._onAnimationEnd=null,r._endAnimation=function(){r._onAnimationEnd&&r._onAnimationEnd(),r.disposeWhenFinishedAnimating&&r.dispose()},r.color=new C.b(1,1,1,1),r.position=h.e.Zero(),r._manager=n,r._manager.sprites.push(r),r.uniqueId=r._manager.scene.getUniqueId(),r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return this._manager},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Sprite"},Object.defineProperty(t.prototype,"fromIndex",{get:function(){return this._fromIndex},set:function(e){this.playAnimation(e,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toIndex",{get:function(){return this._toIndex},set:function(e){this.playAnimation(this._fromIndex,e,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,e,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"delay",{get:function(){return Math.max(this._delay,1)},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,e,this._onAnimationEnd)},enumerable:!1,configurable:!0}),t.prototype.playAnimation=function(e,n,r,o,l){l===void 0&&(l=null),this._onAnimationEnd=l,i.prototype.playAnimation.call(this,e,n,r,o,this._endAnimation)},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.serialize=function(){var e={};return e.name=this.name,e.position=this.position.asArray(),e.color=this.color.asArray(),e.width=this.width,e.height=this.height,e.angle=this.angle,e.cellIndex=this.cellIndex,e.cellRef=this.cellRef,e.invertU=this.invertU,e.invertV=this.invertV,e.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,e.isPickable=this.isPickable,e.isVisible=this.isVisible,e.useAlphaForPicking=this.useAlphaForPicking,e.animationStarted=this.animationStarted,e.fromIndex=this.fromIndex,e.toIndex=this.toIndex,e.loopAnimation=this.loopAnimation,e.delay=this.delay,e},t.Parse=function(e,n){var r=new t(e.name,n);return r.position=h.e.FromArray(e.position),r.color=C.b.FromArray(e.color),r.width=e.width,r.height=e.height,r.angle=e.angle,r.cellIndex=e.cellIndex,r.cellRef=e.cellRef,r.invertU=e.invertU,r.invertV=e.invertV,r.disposeWhenFinishedAnimating=e.disposeWhenFinishedAnimating,r.isPickable=e.isPickable,r.isVisible=e.isVisible,r.useAlphaForPicking=e.useAlphaForPicking,r.fromIndex=e.fromIndex,r.toIndex=e.toIndex,r.loopAnimation=e.loopAnimation,r.delay=e.delay,e.animationStarted&&r.playAnimation(r.fromIndex,r.toIndex,r.loopAnimation,r.delay),r},t}(function(){function i(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}return Object.defineProperty(i.prototype,"animationStarted",{get:function(){return this._animationStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fromIndex",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"toIndex",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"delay",{get:function(){return Math.max(this._delay,1)},enumerable:!1,configurable:!0}),i.prototype.playAnimation=function(t,e,n,r,o){this._fromIndex=t,this._toIndex=e,this._loopAnimation=n,this._delay=r||1,this._animationStarted=!0,this._onBaseAnimationEnd=o,t<e?this._direction=1:(this._direction=-1,this._toIndex=t,this._fromIndex=e),this.cellIndex=t,this._time=0},i.prototype.stopAnimation=function(){this._animationStarted=!1},i.prototype._animate=function(t){this._animationStarted&&(this._time+=t,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))},i}());ne.a.prototype._internalPickSprites=function(i,t,e,n){if(!Pa.a)return null;var r=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var l=this.spriteManagers[o];if(l.isPickable){var d=l.intersects(i,n,t,e);if(d&&d.hit&&(e||r==null||!(d.distance>=r.distance))&&(r=d,e))break}}return r||new Pa.a},ne.a.prototype._internalMultiPickSprites=function(i,t,e){if(!Pa.a)return null;var n=new Array;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}if(this.spriteManagers.length>0)for(var r=0;r<this.spriteManagers.length;r++){var o=this.spriteManagers[r];if(o.isPickable){var l=o.multiIntersects(i,e,t);l!==null&&(n=n.concat(l))}}return n},ne.a.prototype.pickSprite=function(i,t,e,n,r){return this._tempSpritePickingRay?(this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,r),this._internalPickSprites(this._tempSpritePickingRay,e,n,r)):null},ne.a.prototype.pickSpriteWithRay=function(i,t,e,n){if(!this._tempSpritePickingRay)return null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}return Qn.a.TransformToRef(i,n.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,t,e,n)},ne.a.prototype.multiPickSprite=function(i,t,e,n){return this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,n),this._internalMultiPickSprites(this._tempSpritePickingRay,e,n)},ne.a.prototype.multiPickSpriteWithRay=function(i,t,e){if(!this._tempSpritePickingRay)return null;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}return Qn.a.TransformToRef(i,e.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,t,e)},ne.a.prototype.setPointerOverSprite=function(i){this._pointerOverSprite!==i&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOutTrigger,b.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=i,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOverTrigger,b.a.CreateNewFromSprite(this._pointerOverSprite,this)))},ne.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var CE=function(){function i(t){this.name=dt.a.NAME_SPRITE,this.scene=t,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=Qn.a?Qn.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new S.c,this.scene.onAfterSpritesRenderingObservable=new S.c,this._spritePredicate=function(e){return!!e.actionManager&&e.isPickable&&e.actionManager.hasPointerTriggers}}return i.prototype.register=function(){this.scene._pointerMoveStage.registerStep(dt.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(dt.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(dt.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var t=this.scene.spriteManagers;t.length;)t[0].dispose()},i.prototype._pickSpriteButKeepRay=function(t,e,n,r,o){var l=this.scene.pickSprite(e,n,this._spritePredicate,r,o);return l&&(l.ray=t?t.ray:null),l},i.prototype._pointerMove=function(t,e,n,r,o){var l=this.scene;return r?l.setPointerOverSprite(null):(n=this._pickSpriteButKeepRay(n,t,e,!1,l.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite?(l.setPointerOverSprite(n.pickedSprite),l.doNotHandleCursors||(l._pointerOverSprite&&l._pointerOverSprite.actionManager&&l._pointerOverSprite.actionManager.hoverCursor?o.style.cursor=l._pointerOverSprite.actionManager.hoverCursor:o.style.cursor=l.hoverCursor)):l.setPointerOverSprite(null),n},i.prototype._pointerDown=function(t,e,n,r){var o=this.scene;if(o._pickedDownSprite=null,o.spriteManagers.length>0&&(n=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(o._pickedDownSprite=n.pickedSprite,r.button){case 0:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnLeftPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 1:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnCenterPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 2:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnRightPickTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickDownTrigger,b.a.CreateNewFromSprite(n.pickedSprite,o,r))}return n},i.prototype._pointerUp=function(t,e,n,r){var o=this.scene;if(o.spriteManagers.length>0){var l=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0);l&&(l.hit&&l.pickedSprite&&l.pickedSprite.actionManager&&(l.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickUpTrigger,b.a.CreateNewFromSprite(l.pickedSprite,o,r)),l.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||l.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickTrigger,b.a.CreateNewFromSprite(l.pickedSprite,o,r)))),o._pickedDownSprite&&o._pickedDownSprite.actionManager&&o._pickedDownSprite!==l.pickedSprite&&o._pickedDownSprite.actionManager.processTrigger(g.a.ACTION_OnPickOutTrigger,b.a.CreateNewFromSprite(o._pickedDownSprite,o,r)))}return n},i}();Qe.a.IncludesShadersStore.imageProcessingCompatibility=`#ifdef IMAGEPROCESSINGPOSTPROCESS
gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));
#endif`;var eN=`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest)
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
}`;Qe.a.ShadersStore.spritesPixelShader=eN;var tN=`
attribute vec4 position;
attribute vec2 options;
attribute vec2 offsets;
attribute vec2 inverts;
attribute vec4 cellInfo;
attribute vec4 color;

uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) {
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=offsets.xy;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0);

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));
vec2 uvPlace=cellInfo.xy;
vec2 uvSize=cellInfo.zw;
vUV.x=uvPlace.x+uvSize.x*uvOffset.x;
vUV.y=uvPlace.y+uvSize.y*uvOffset.y;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`;Qe.a.ShadersStore.spritesVertexShader=tN;var nN=function(){function i(t,e,n,r){if(n===void 0&&(n=.01),r===void 0&&(r=null),this.blendMode=g.a.ALPHA_COMBINE,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this.fogEnabled=!0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._capacity=e,this._epsilon=n,this._engine=t,this._useInstancing=t.getCaps().instancedArrays,this._useVAO=t.getCaps().vertexArrayObject&&!t.disableVertexArrayObjects,this._scene=r,!this._useInstancing){for(var o=[],l=0,d=0;d<e;d++)o.push(l),o.push(l+1),o.push(l+2),o.push(l),o.push(l+2),o.push(l+3),l+=4;this._indexBuffer=t.createIndexBuffer(o)}this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(e*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new De.a(t,this._vertexData,!0,this._vertexBufferSize);var v,y=this._buffer.createVertexBuffer(De.b.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),D=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing),w=6;if(this._useInstancing){var F=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new De.a(t,F,!1,2),v=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else v=this._buffer.createVertexBuffer("offsets",w,2,this._vertexBufferSize,this._useInstancing),w+=2;var z=this._buffer.createVertexBuffer("inverts",w,2,this._vertexBufferSize,this._useInstancing),k=this._buffer.createVertexBuffer("cellInfo",w+2,4,this._vertexBufferSize,this._useInstancing),K=this._buffer.createVertexBuffer(De.b.ColorKind,w+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[De.b.PositionKind]=y,this._vertexBuffers.options=D,this._vertexBuffers.offsets=v,this._vertexBuffers.inverts=z,this._vertexBuffers.cellInfo=k,this._vertexBuffers[De.b.ColorKind]=K,this._effectBase=this._engine.createEffect("sprites",[De.b.PositionKind,"options","offsets","inverts","cellInfo",De.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._scene&&(this._effectFog=this._scene.getEngine().createEffect("sprites",[De.b.PositionKind,"options","offsets","inverts","cellInfo",De.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG"))}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),i.prototype.render=function(t,e,n,r,o){if(o===void 0&&(o=null),this.texture&&this.texture.isReady()&&t.length){var l=this._effectBase,d=!1;if(this.fogEnabled&&this._scene&&this._scene.fogEnabled&&this._scene.fogMode!==0&&(l=this._effectFog,d=!0),l.isReady()){for(var v=this._engine,y=!(!this._scene||!this._scene.useRightHandedSystem),D=this.texture.getBaseSize(),w=Math.min(this._capacity,t.length),F=0,z=!0,k=0;k<w;k++){var K=t[k];K&&K.isVisible&&(z=!1,K._animate(e),this._appendSpriteVertex(F++,K,0,0,D,y,o),this._useInstancing||(this._appendSpriteVertex(F++,K,1,0,D,y,o),this._appendSpriteVertex(F++,K,1,1,D,y,o),this._appendSpriteVertex(F++,K,0,1,D,y,o)))}if(!z){this._buffer.update(this._vertexData);var ae=v.depthCullingState.cull||!0,le=v.depthCullingState.zOffset;if(y&&this._scene.getEngine().setState(ae,le,!1,!1),v.enableEffect(l),l.setTexture("diffuseSampler",this.texture),l.setMatrix("view",n),l.setMatrix("projection",r),d){var fe=this._scene;l.setFloat4("vFogInfos",fe.fogMode,fe.fogStart,fe.fogEnd,fe.fogDensity),l.setColor3("vFogColor",fe.fogColor)}this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=v.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,l)),v.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):v.bindBuffers(this._vertexBuffers,this._indexBuffer,l),v.depthCullingState.depthFunc=g.a.LEQUAL,this.disableDepthWrite||(l.setBool("alphaTest",!0),v.setColorWrite(!1),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,F):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,F/4*6),v.setColorWrite(!0),l.setBool("alphaTest",!1)),v.setAlphaMode(this.blendMode),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,F):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,F/4*6),this.autoResetAlpha&&v.setAlphaMode(g.a.ALPHA_DISABLE),y&&this._scene.getEngine().setState(ae,le,!1,!0),v.unbindInstanceAttributes()}}}},i.prototype._appendSpriteVertex=function(t,e,n,r,o,l,d){var v=t*this._vertexBufferSize;if(n===0?n=this._epsilon:n===1&&(n=1-this._epsilon),r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),d)d(e,o);else{e.cellIndex||(e.cellIndex=0);var y=o.width/this.cellWidth,D=e.cellIndex/y>>0;e._xOffset=(e.cellIndex-D*y)*this.cellWidth/o.width,e._yOffset=D*this.cellHeight/o.height,e._xSize=this.cellWidth,e._ySize=this.cellHeight}this._vertexData[v]=e.position.x,this._vertexData[v+1]=e.position.y,this._vertexData[v+2]=e.position.z,this._vertexData[v+3]=e.angle,this._vertexData[v+4]=e.width,this._vertexData[v+5]=e.height,this._useInstancing?v-=2:(this._vertexData[v+6]=n,this._vertexData[v+7]=r),this._vertexData[v+8]=l?e.invertU?0:1:e.invertU?1:0,this._vertexData[v+9]=e.invertV?1:0,this._vertexData[v+10]=e._xOffset,this._vertexData[v+11]=e._yOffset,this._vertexData[v+12]=e._xSize/o.width,this._vertexData[v+13]=e._ySize/o.height,this._vertexData[v+14]=e.color.r,this._vertexData[v+15]=e.color.g,this._vertexData[v+16]=e.color.b,this._vertexData[v+17]=e.color.a},i.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null)},i}(),RE=function(){function i(t,e,n,r,o,l,d,v,y){var D=this;l===void 0&&(l=.01),d===void 0&&(d=ke.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v=!1),y===void 0&&(y=null),this.name=t,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.isPickable=!1,this.onDisposeObservable=new S.c,this.disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=function(F,z){F.cellRef||(F.cellIndex=0);var k=F.cellIndex;typeof k=="number"&&isFinite(k)&&Math.floor(k)===k&&(F.cellRef=D._spriteMap[F.cellIndex]),F._xOffset=D._cellData[F.cellRef].frame.x/z.width,F._yOffset=D._cellData[F.cellRef].frame.y/z.height,F._xSize=D._cellData[F.cellRef].frame.w,F._ySize=D._cellData[F.cellRef].frame.h},o||(o=He.a.LastCreatedScene),o._getComponent(dt.a.NAME_SPRITE)||o._addComponent(new CE(o)),this._fromPacked=v,this._scene=o;var w=this._scene.getEngine();if(this._spriteRenderer=new nN(w,n,l,o),r.width&&r.height)this.cellWidth=r.width,this.cellHeight=r.height;else{if(r===void 0)return void(this._spriteRenderer=null);this.cellWidth=r,this.cellHeight=r}this._scene.spriteManagers.push(this),this.uniqueId=this.scene.getUniqueId(),e&&(this.texture=new ke.a(e,o,!0,!1,d)),this._fromPacked&&this._makePacked(e,y)}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this.sprites},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capacity",{get:function(){return this._spriteRenderer.capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._spriteRenderer.texture},set:function(t){t.wrapU=ke.a.CLAMP_ADDRESSMODE,t.wrapV=ke.a.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=t,this._textureContent=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellWidth",{get:function(){return this._spriteRenderer.cellWidth},set:function(t){this._spriteRenderer.cellWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellHeight",{get:function(){return this._spriteRenderer.cellHeight},set:function(t){this._spriteRenderer.cellHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this._spriteRenderer.fogEnabled},set:function(t){this._spriteRenderer.fogEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._spriteRenderer.blendMode},set:function(t){this._spriteRenderer.blendMode=t},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"SpriteManager"},i.prototype._makePacked=function(t,e){var n=this;if(e!==null)try{var r=void 0;if((r=typeof e=="string"?JSON.parse(e):e).frames.length){for(var o={},l=0;l<r.frames.length;l++){var d=r.frames[l];if(typeof Object.keys(d)[0]!="string")throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");o[d[Object.keys(d)[0]]]=d}r.frames=o}var v=Reflect.ownKeys(r.frames);this._spriteMap=v,this._packedAndReady=!0,this._cellData=r.frames}catch(z){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{var y=/\./g,D=void 0;do D=y.lastIndex,y.test(t);while(y.lastIndex>0);var w=t.substring(0,D-1)+".json",F=new XMLHttpRequest;F.open("GET",w,!0),F.onerror=function(){_.a.Error("JSON ERROR: Unable to load JSON file."),n._fromPacked=!1,n._packedAndReady=!1},F.onload=function(){try{var z=JSON.parse(F.response),k=Reflect.ownKeys(z.frames);n._spriteMap=k,n._packedAndReady=!0,n._cellData=z.frames}catch(K){throw n._fromPacked=!1,n._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}},F.send()}},i.prototype._checkTextureAlpha=function(t,e,n,r,o){if(!t.useAlphaForPicking||!this.texture)return!0;var l=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(l.width*l.height*4),this.texture.readPixels(0,0,this._textureContent));var d=h.c.Vector3[0];d.copyFrom(e.direction),d.normalize(),d.scaleInPlace(n),d.addInPlace(e.origin);var v=(d.x-r.x)/(o.x-r.x)-.5,y=1-(d.y-r.y)/(o.y-r.y)-.5,D=t.angle,w=v*Math.cos(D)-y*Math.sin(D)+.5,F=v*Math.sin(D)+y*Math.cos(D)+.5,z=t._xOffset*l.width+w*t._xSize|0,k=t._yOffset*l.height+F*t._ySize|0;return this._textureContent[4*(z+k*l.width)+3]>.5},i.prototype.intersects=function(t,e,n,r){for(var o=Math.min(this.capacity,this.sprites.length),l=h.e.Zero(),d=h.e.Zero(),v=Number.MAX_VALUE,y=null,D=h.c.Vector3[0],w=h.c.Vector3[1],F=e.getViewMatrix(),z=0;z<o;z++){var k=this.sprites[z];if(k){if(n){if(!n(k))continue}else if(!k.isPickable)continue;if(h.e.TransformCoordinatesToRef(k.position,F,w),l.copyFromFloats(w.x-k.width/2,w.y-k.height/2,w.z),d.copyFromFloats(w.x+k.width/2,w.y+k.height/2,w.z),t.intersectsBoxMinMax(l,d)){var K=h.e.Distance(w,t.origin);if(v>K){if(!this._checkTextureAlpha(k,t,K,l,d))continue;if(v=K,y=k,r)break}}}}if(y){var ae=new Pa.a;F.invertToRef(h.c.Matrix[0]),ae.hit=!0,ae.pickedSprite=y,ae.distance=v;var le=h.c.Vector3[2];return le.copyFrom(t.direction),le.normalize(),le.scaleInPlace(v),t.origin.addToRef(le,D),ae.pickedPoint=h.e.TransformCoordinates(D,h.c.Matrix[0]),ae}return null},i.prototype.multiIntersects=function(t,e,n){for(var r,o=Math.min(this.capacity,this.sprites.length),l=h.e.Zero(),d=h.e.Zero(),v=[],y=h.c.Vector3[0].copyFromFloats(0,0,0),D=h.c.Vector3[1].copyFromFloats(0,0,0),w=e.getViewMatrix(),F=0;F<o;F++){var z=this.sprites[F];if(z){if(n){if(!n(z))continue}else if(!z.isPickable)continue;if(h.e.TransformCoordinatesToRef(z.position,w,D),l.copyFromFloats(D.x-z.width/2,D.y-z.height/2,D.z),d.copyFromFloats(D.x+z.width/2,D.y+z.height/2,D.z),t.intersectsBoxMinMax(l,d)){if(r=h.e.Distance(D,t.origin),!this._checkTextureAlpha(z,t,r,l,d))continue;var k=new Pa.a;v.push(k),w.invertToRef(h.c.Matrix[0]),k.hit=!0,k.pickedSprite=z,k.distance=r;var K=h.c.Vector3[2];K.copyFrom(t.direction),K.normalize(),K.scaleInPlace(r),t.origin.addToRef(K,y),k.pickedPoint=h.e.TransformCoordinates(y,h.c.Matrix[0])}}}return v},i.prototype.render=function(){if(!this._fromPacked||this._packedAndReady&&this._spriteMap&&this._cellData){var t=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}},i.prototype.dispose=function(){this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null;var t=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.serialize=function(t){t===void 0&&(t=!1);var e={};e.name=this.name,e.capacity=this.capacity,e.cellWidth=this.cellWidth,e.cellHeight=this.cellHeight,this.texture&&(t?e.texture=this.texture.serialize():(e.textureUrl=this.texture.name,e.invertY=this.texture._invertY)),e.sprites=[];for(var n=0,r=this.sprites;n<r.length;n++){var o=r[n];e.sprites.push(o.serialize())}return e},i.Parse=function(t,e,n){var r=new i(t.name,"",t.capacity,{width:t.cellWidth,height:t.cellHeight},e);t.texture?r.texture=ke.a.Parse(t.texture,e,n):t.textureName&&(r.texture=new ke.a(n+t.textureUrl,e,!1,t.invertY===void 0||t.invertY));for(var o=0,l=t.sprites;o<l.length;o++){var d=l[o];PE.Parse(d,r)}return r},i.ParseFromFileAsync=function(t,e,n,r){return r===void 0&&(r=""),new Promise(function(o,l){var d=new se.a;d.addEventListener("readystatechange",function(){if(d.readyState==4)if(d.status==200){var v=JSON.parse(d.responseText),y=i.Parse(v,n||He.a.LastCreatedScene,r);t&&(y.name=t),o(y)}else l("Unable to load the sprite manager")}),d.open("GET",e),d.send()})},i.CreateFromSnippetAsync=function(t,e,n){var r=this;return n===void 0&&(n=""),t==="_BLANK"?Promise.resolve(new i("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,e)):new Promise(function(o,l){var d=new se.a;d.addEventListener("readystatechange",function(){if(d.readyState==4)if(d.status==200){var v=JSON.parse(JSON.parse(d.responseText).jsonPayload),y=JSON.parse(v.spriteManager),D=i.Parse(y,e||He.a.LastCreatedScene,n);D.snippetId=t,o(D)}else l("Unable to load the snippet "+t)}),d.open("GET",r.SnippetUrl+"/"+t.replace(/#/g,"/")),d.send()})},i.SnippetUrl="https://snippet.babylonjs.com",i}(),rN=`precision highp float;
varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
uniform float time;
uniform float spriteCount;
uniform sampler2D spriteSheet;
uniform vec2 spriteMapSize;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform sampler2D frameMap;
uniform sampler2D tileMaps[LAYERS];
uniform sampler2D animationMap;
uniform vec3 colorMul;
float mt;
const float fdStep=1./4.;
const float aFrameSteps=1./MAX_ANIMATION_FRAMES;
mat4 getFrameData(float frameID){
float fX=frameID/spriteCount;
return mat4(
texture2D(frameMap,vec2(fX,0.),0.),
texture2D(frameMap,vec2(fX,fdStep*1.),0.),
texture2D(frameMap,vec2(fX,fdStep*2.),0.),
vec4(0.)
);
}
void main(){
vec4 color=vec4(0.);
vec2 tileUV=fract(tUV);
#ifdef FLIPU
tileUV.y=1.0-tileUV.y;
#endif
vec2 tileID=floor(tUV);
vec2 sheetUnits=1./spriteMapSize;
float spriteUnits=1./spriteCount;
vec2 stageUnits=1./stageSize;
for(int i=0; i<LAYERS; i++) {
float frameID;
#define LAYER_ID_SWITCH
vec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);
if(animationData.y>0.) {
mt=mod(time*animationData.z,1.0);
for(float f=0.; f<MAX_ANIMATION_FRAMES; f++){
if(animationData.y>mt){
frameID=animationData.x;
break;
}
animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);
}
}

mat4 frameData=getFrameData(frameID+0.5);
vec2 frameSize=(frameData[0].wz)/spriteMapSize;
vec2 offset=frameData[0].xy*sheetUnits;
vec2 ratio=frameData[2].xy/frameData[0].wz;

if (frameData[2].z == 1.){
tileUV.xy=tileUV.yx;
}
if (i == 0){
color=texture2D(spriteSheet,tileUV*frameSize+offset);
} else {
vec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);
float alpha=min(color.a+nc.a,1.0);
vec3 mixed=mix(color.xyz,nc.xyz,nc.a);
color=vec4(mixed,alpha);
}
}
color.xyz*=colorMul;
gl_FragColor=color;
}`;Qe.a.ShadersStore.spriteMapPixelShader=rN;var iN=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;

varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
varying vec2 stageUnits;
varying vec2 levelUnits;
varying vec2 tileID;

uniform float time;
uniform mat4 worldViewProjection;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform vec2 spriteMapSize;
uniform float stageScale;
void main() {
vec4 p=vec4( position,1. );
vPosition=p.xyz;
vUV=uv;
tUV=uv*stageSize;
gl_Position=worldViewProjection*p;
}`;Qe.a.ShadersStore.spriteMapVertexShader=iN;var ji,oN=function(){function i(t,e,n,r,o){var l=this;this.name=t,this.sprites=[],this.atlasJSON=e,this.sprites=this.atlasJSON.frames,this.spriteSheet=n,this.options=r,r.stageSize=r.stageSize||new h.d(1,1),r.outputSize=r.outputSize||r.stageSize,r.outputPosition=r.outputPosition||h.e.Zero(),r.outputRotation=r.outputRotation||h.e.Zero(),r.layerCount=r.layerCount||1,r.maxAnimationFrames=r.maxAnimationFrames||0,r.baseTile=r.baseTile||0,r.flipU=r.flipU||!1,r.colorMultiply=r.colorMultiply||new h.e(1,1,1),this._scene=o,this._frameMap=this._createFrameBuffer(),this._tileMaps=new Array;for(var d=0;d<r.layerCount;d++)this._tileMaps.push(this._createTileBuffer(null,d));this._animationMap=this._createTileAnimationBuffer(null);var v=[];v.push("#define LAYERS "+r.layerCount),r.flipU&&v.push("#define FLIPU"),v.push("#define MAX_ANIMATION_FRAMES "+r.maxAnimationFrames+".0");var y,D=Qe.a.ShadersStore.spriteMapPixelShader;if(this._scene.getEngine().webGLVersion===1)for(y="",d=0;d<r.layerCount;d++)y+="if ("+d+" == i) { frameID = texture2D(tileMaps["+d+"], (tileID + 0.5) / stageSize, 0.).x; }";else{for(y="switch(i) {",d=0;d<r.layerCount;d++)y+="case "+d+" : frameID = texture(tileMaps["+d+"], (tileID + 0.5) / stageSize, 0.).x;",y+="break;";y+="}"}Qe.a.ShadersStore["spriteMap"+this.name+"PixelShader"]=D.replace("#define LAYER_ID_SWITCH",y),this._material=new bh.a("spriteMap:"+this.name,this._scene,{vertex:"spriteMap",fragment:"spriteMap"+this.name},{defines:v,attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","stageSize","outputSize","spriteMapSize","spriteCount","time","colorMul","mousePosition","curTile","flipU"],samplers:["spriteSheet","frameMap","tileMaps","animationMap"],needAlphaBlending:!0}),this._time=0,this._material.setFloat("spriteCount",this.spriteCount),this._material.setVector2("stageSize",r.stageSize),this._material.setVector2("outputSize",r.outputSize),this._material.setTexture("spriteSheet",this.spriteSheet),this._material.setVector2("spriteMapSize",new h.d(1,1)),this._material.setVector3("colorMul",r.colorMultiply);var w=0,F=function(){l.spriteSheet&&l.spriteSheet.isReady()&&l.spriteSheet._texture?l._material.setVector2("spriteMapSize",new h.d(l.spriteSheet._texture.baseWidth||1,l.spriteSheet._texture.baseHeight||1)):w<100&&setTimeout(function(){w++,F()},100)};F(),this._material.setVector3("colorMul",r.colorMultiply),this._material.setTexture("frameMap",this._frameMap),this._material.setTextureArray("tileMaps",this._tileMaps),this._material.setTexture("animationMap",this._animationMap),this._material.setFloat("time",this._time),this._output=Fe.a.CreatePlane(t+":output",1,o,!0),this._output.scaling.x=r.outputSize.x,this._output.scaling.y=r.outputSize.y,this.position=r.outputPosition,this.rotation=r.outputRotation,this._scene.onBeforeRenderObservable.add(function(){l._time+=l._scene.getEngine().getDeltaTime(),l._material.setFloat("time",l._time)}),this._output.material=this._material}return Object.defineProperty(i.prototype,"spriteCount",{get:function(){return this.sprites.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._output.position},set:function(t){this._output.position=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._output.rotation},set:function(t){this._output.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationMap",{get:function(){return this._animationMap},set:function(t){var e=t._texture._bufferView,n=this._createTileAnimationBuffer(e);this._animationMap.dispose(),this._animationMap=n,this._material.setTexture("animationMap",this._animationMap)},enumerable:!1,configurable:!0}),i.prototype.getTileID=function(){var t=this.getMousePosition();return t.multiplyInPlace(this.options.stageSize||h.d.Zero()),t.x=Math.floor(t.x),t.y=Math.floor(t.y),t},i.prototype.getMousePosition=function(){var t=this._output,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(r){return r===t});if(!e||!e.hit||!e.getTextureCoordinates)return new h.d(-1,-1);var n=e.getTextureCoordinates();return n||new h.d(-1,-1)},i.prototype._createFrameBuffer=function(){for(var t=new Array,e=0;e<this.spriteCount;e++)t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0);for(e=0;e<this.spriteCount;e++){var n=this.sprites[e].frame,r=this.sprites[e].spriteSourceSize,o=this.sprites[e].sourceSize,l=this.sprites[e].rotated?1:0,d=this.sprites[e].trimmed?1:0;t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.w,t[4*e+3]=n.h,t[4*e+4*this.spriteCount]=r.x,t[4*e+1+4*this.spriteCount]=r.y,t[4*e+3+4*this.spriteCount]=r.h,t[4*e+8*this.spriteCount]=o.w,t[4*e+1+8*this.spriteCount]=o.h,t[4*e+2+8*this.spriteCount]=l,t[4*e+3+8*this.spriteCount]=d}var v=new Float32Array(t);return xr.CreateRGBATexture(v,this.spriteCount,4,this._scene,!1,!1,ke.a.NEAREST_NEAREST,He.a.TEXTURETYPE_FLOAT)},i.prototype._createTileBuffer=function(t,e){e===void 0&&(e=0);var n=new Array,r=this.options.stageSize.y||0,o=this.options.stageSize.x||0;if(t)n=t;else{var l=this.options.baseTile;e!=0&&(l=0);for(var d=0;d<r;d++)for(var v=0;v<4*o;v+=4)n.push(l,0,0,0)}var y=new Float32Array(n);return xr.CreateRGBATexture(y,o,r,this._scene,!1,!1,ke.a.NEAREST_NEAREST,He.a.TEXTURETYPE_FLOAT)},i.prototype.changeTiles=function(t,e,n){var r;if(t===void 0&&(t=0),n===void 0&&(n=0),(r=this._tileMaps[t]._texture._bufferView)!==null){var o=new Array;e instanceof h.d?o.push(e):o=e;for(var l=this.options.stageSize.x||0,d=0;d<o.length;d++){var v=o[d];v.x=Math.floor(v.x),v.y=Math.floor(v.y),r[4*v.x+v.y*(4*l)]=n}var y=this._createTileBuffer(r);this._tileMaps[t].dispose(),this._tileMaps[t]=y,this._material.setTextureArray("tileMap",this._tileMaps)}},i.prototype._createTileAnimationBuffer=function(t){var e,n=new Array;if(t)e=t;else{for(var r=0;r<this.spriteCount;r++){n.push(0,0,0,0);for(var o=1;o<(this.options.maxAnimationFrames||4);)n.push(0,0,0,0),o++}e=new Float32Array(n)}return xr.CreateRGBATexture(e,this.spriteCount,this.options.maxAnimationFrames||4,this._scene,!1,!1,ke.a.NEAREST_NEAREST,He.a.TEXTURETYPE_FLOAT)},i.prototype.addAnimationToTile=function(t,e,n,r,o){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=0),o===void 0&&(o=1);var l=this._animationMap._texture._bufferView,d=4*t+4*this.spriteCount*e;if(l){l[d]=n,l[d+1]=r,l[d+2]=o;var v=this._createTileAnimationBuffer(l);this._animationMap.dispose(),this._animationMap=v,this._material.setTexture("animationMap",this._animationMap)}},i.prototype.saveTileMaps=function(){for(var t="",e=0;e<this._tileMaps.length;e++)e>0&&(t+=`
\r`),t+=this._tileMaps[e]._texture._bufferView.toString();var n=document.createElement("a");n.href="data:octet/stream;charset=utf-8,"+encodeURI(t),n.target="_blank",n.download=this.name+".tilemaps",n.click(),n.remove()},i.prototype.loadTileMaps=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t);var r=this.options.layerCount||0;n.onload=function(){for(var o=n.response.split(`
\r`),l=0;l<r;l++){var d=o[l].split(",").map(Number),v=e._createTileBuffer(d);e._tileMaps[l].dispose(),e._tileMaps[l]=v}e._material.setTextureArray("tileMap",e._tileMaps)},n.send()},i.prototype.dispose=function(){this._output.dispose(),this._material.dispose(),this._animationMap.dispose(),this._tileMaps.forEach(function(t){t.dispose()}),this._frameMap.dispose()},i}(),aN=function(i){function t(e,n,r,o,l,d,v){l===void 0&&(l=null),d===void 0&&(d=.01),v===void 0&&(v=ke.a.TRILINEAR_SAMPLINGMODE);var y=i.call(this,e,n,r,64,o,d,v,!0,l)||this;return y.name=e,y}return Object(f.d)(t,i),t}(RE),sN=c(143),cN=c(141),lN=c(142),uN=c(139);(function(i){i[i.INIT=0]="INIT",i[i.RUNNING=1]="RUNNING",i[i.DONE=2]="DONE",i[i.ERROR=3]="ERROR"})(ji||(ji={}));var n_,zi=function(){function i(t){this.name=t,this._isCompleted=!1,this._taskState=ji.INIT}return Object.defineProperty(i.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"taskState",{get:function(){return this._taskState},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),i.prototype._setErrorObject=function(t,e){this._errorObject||(this._errorObject={message:t,exception:e})},i.prototype.run=function(t,e,n){var r=this;this._taskState=ji.RUNNING,this.runTask(t,function(){r.onDoneCallback(e,n)},function(o,l){r.onErrorCallback(n,o,l)})},i.prototype.runTask=function(t,e,n){throw new Error("runTask is not implemented")},i.prototype.reset=function(){this._taskState=ji.INIT},i.prototype.onErrorCallback=function(t,e,n){this._taskState=ji.ERROR,this._errorObject={message:e,exception:n},this.onError&&this.onError(this,e,n),t()},i.prototype.onDoneCallback=function(t,e){try{this._taskState=ji.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),t()}catch(n){this.onErrorCallback(e,"Task is done, error executing success callback(s)",n)}},i}(),OE=function(i,t,e){this.remainingCount=i,this.totalCount=t,this.task=e},ME=function(i){function t(e,n,r,o){var l=i.call(this,e)||this;return l.name=e,l.meshesNames=n,l.rootUrl=r,l.sceneFilename=o,l}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;an.LoadAssetContainer(this.rootUrl,this.sceneFilename,e,function(l){o.loadedContainer=l,o.loadedMeshes=l.meshes,o.loadedParticleSystems=l.particleSystems,o.loadedSkeletons=l.skeletons,o.loadedAnimationGroups=l.animationGroups,n()},null,function(l,d,v){r(d,v)})},t}(zi),IE=function(i){function t(e,n,r,o){var l=i.call(this,e)||this;return l.name=e,l.meshesNames=n,l.rootUrl=r,l.sceneFilename=o,l}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;an.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(l,d,v,y){o.loadedMeshes=l,o.loadedParticleSystems=d,o.loadedSkeletons=v,o.loadedAnimationGroups=y,n()},null,function(l,d,v){r(d,v)})},t}(zi),DE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(l){o.text=l,n()},void 0,!1,!1,function(l,d){l&&r(l.status+" "+l.statusText,d)})},t}(zi),wE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(l){o.data=l,n()},void 0,!0,!0,function(l,d){l&&r(l.status+" "+l.statusText,d)})},t}(zi),LE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this,l=new Image;et.b.SetCorsBehavior(this.url,l),l.onload=function(){o.image=l,n()},l.onerror=function(d){r("Error loading image",d)},l.src=this.url},t}(zi),NE=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=ke.a.TRILINEAR_SAMPLINGMODE);var d=i.call(this,e)||this;return d.name=e,d.url=n,d.noMipmap=r,d.invertY=o,d.samplingMode=l,d}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new ke.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){n()},function(o,l){r(o,l)})},t}(zi),FE=function(i){function t(e,n,r,o,l){var d=i.call(this,e)||this;return d.name=e,d.url=n,d.extensions=r,d.noMipmap=o,d.files=l,d}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new yi(this.url,e,this.extensions,this.noMipmap,this.files,function(){n()},function(o,l){r(o,l)})},t}(zi),BE=function(i){function t(e,n,r,o,l,d,v){o===void 0&&(o=!1),l===void 0&&(l=!0),d===void 0&&(d=!1),v===void 0&&(v=!1);var y=i.call(this,e)||this;return y.name=e,y.url=n,y.size=r,y.noMipmap=o,y.generateHarmonics=l,y.gammaSpace=d,y.reserved=v,y}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new mh(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){n()},function(o,l){r(o,l)})},t}(zi),UE=function(i){function t(e,n,r,o,l){o===void 0&&(o=!1),l===void 0&&(l=!0);var d=i.call(this,e)||this;return d.name=e,d.url=n,d.size=r,d.noMipmap=o,d.gammaSpace=l,d}return Object(f.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new D0(this.url,e,this.size,this.noMipmap,this.gammaSpace,function(){n()},function(o,l){r(o,l)})},t}(zi),hN=function(){function i(t){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new S.c,this.onTaskErrorObservable=new S.c,this.onTasksDoneObservable=new S.c,this.onProgressObservable=new S.c,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=t}return i.prototype.addContainerTask=function(t,e,n,r){var o=new ME(t,e,n,r);return this._tasks.push(o),o},i.prototype.addMeshTask=function(t,e,n,r){var o=new IE(t,e,n,r);return this._tasks.push(o),o},i.prototype.addTextFileTask=function(t,e){var n=new DE(t,e);return this._tasks.push(n),n},i.prototype.addBinaryFileTask=function(t,e){var n=new wE(t,e);return this._tasks.push(n),n},i.prototype.addImageTask=function(t,e){var n=new LE(t,e);return this._tasks.push(n),n},i.prototype.addTextureTask=function(t,e,n,r,o){o===void 0&&(o=ke.a.TRILINEAR_SAMPLINGMODE);var l=new NE(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.addCubeTextureTask=function(t,e,n,r,o){var l=new FE(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.addHDRCubeTextureTask=function(t,e,n,r,o,l,d){r===void 0&&(r=!1),o===void 0&&(o=!0),l===void 0&&(l=!1),d===void 0&&(d=!1);var v=new BE(t,e,n,r,o,l,d);return this._tasks.push(v),v},i.prototype.addEquiRectangularCubeTextureAssetTask=function(t,e,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0);var l=new UE(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.removeTask=function(t){var e=this._tasks.indexOf(t);e>-1&&this._tasks.splice(e,1)},i.prototype._decreaseWaitingTasksCount=function(t){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,t),this.onProgressObservable.notifyObservers(new OE(this._waitingTasksCount,this._totalTasksCount,t))}catch(l){_.a.Error("Error running progress callbacks."),console.log(l)}if(this._waitingTasksCount===0){try{var e=this._tasks.slice();this.onFinish&&this.onFinish(e);for(var n=0,r=e;n<r.length;n++)if((t=r[n]).taskState===ji.DONE){var o=this._tasks.indexOf(t);o>-1&&this._tasks.splice(o,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(l){_.a.Error("Error running tasks-done callbacks."),console.log(l)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}},i.prototype._runTask=function(t){var e=this,n=function(r,o){t._setErrorObject(r,o),e.onTaskError&&e.onTaskError(t),e.onTaskErrorObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)};t.run(this._scene,function(){try{e.onTaskSuccess&&e.onTaskSuccess(t),e.onTaskSuccessObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)}catch(r){n("Error executing task success callbacks",r)}},n)},i.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},i.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,this._waitingTasksCount===0)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var t=0;t<this._tasks.length;t++){var e=this._tasks[t];e.taskState===ji.INIT&&this._runTask(e)}return this},i.prototype.loadAsync=function(){var t=this;return new Promise(function(e,n){t._isLoading?e():(t.onTasksDoneObservable.addOnce(function(r){r&&r.length?n(r):e()}),t.load())})},i}(),dN=function(){function i(){var t=this;this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return Object.defineProperty(i.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),i}(),fN=function(){function i(t,e){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=h.e.Zero(),this._newPosition=h.e.Zero(),this._centerPosition=h.e.Zero(),this._meshes=t.slice(),e?this._centerMesh=e:this._setCenterMesh();var n=this._meshes.indexOf(this._centerMesh);n>=0&&this._meshes.splice(n,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var r=0;r<this._meshes.length;r++)if(this._meshes[r]){var o=this._meshes[r];this._meshesOrigins[r]=o.getAbsolutePosition().clone(),this._toCenterVectors[r]=h.e.Zero(),o._boundingInfo&&this._centerMesh._boundingInfo&&o._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[r])}}return i.prototype._setCenterMesh=function(){for(var t=h.e.Zero(),e=h.e.Zero(),n=Number.MAX_VALUE,r=0;r<this._meshes.length;r++)this._meshes[r]&&(l=(o=this._meshes[r]).getBoundingInfo())&&e.addInPlace(l.boundingBox.centerWorld);for(t=e.scale(1/this._meshes.length),r=0;r<this._meshes.length;r++){var o,l;if(this._meshes[r]&&(l=(o=this._meshes[r]).getBoundingInfo())){var d=l.boundingBox.centerWorld.subtract(t).lengthSquared();d<n&&(this._centerMesh=o,n=d)}}},i.prototype.getClassName=function(){return"MeshExploder"},i.prototype.getMeshes=function(){var t=this._meshes.slice();return t.unshift(this._centerMesh),t},i.prototype.explode=function(t){t===void 0&&(t=1);for(var e=0;e<this._meshes.length;e++)this._meshes[e]&&this._meshesOrigins[e]&&this._toCenterVectors[e]&&(this._toCenterVectors[e].scaleToRef(t,this._scaledDirection),this._meshesOrigins[e].addToRef(this._scaledDirection,this._newPosition),this._meshes[e].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},i}(),pN=function(){function i(t,e,n,r,o,l,d,v,y){this.onProcessFileCallback=function(){return!0},this._engine=t,this._currentScene=e,this._sceneLoadedCallback=n,this._progressCallback=r,this._additionalRenderLoopLogicCallback=o,this._textureLoadingCallback=l,this._startingProcessingFilesCallback=d,this._onReloadCallback=v,this._errorCallback=y}return Object.defineProperty(i,"FilesToLoad",{get:function(){return Lp.a.FilesToLoad},enumerable:!1,configurable:!0}),i.prototype.monitorElementForDragNDrop=function(t){var e=this;t&&(this._elementToMonitor=t,this._dragEnterHandler=function(n){e.drag(n)},this._dragOverHandler=function(n){e.drag(n)},this._dropHandler=function(n){e.drop(n)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},Object.defineProperty(i.prototype,"filesToLoad",{get:function(){return this._filesToLoad},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},i.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var t=this._currentScene.getWaitingItemsCount();t>0&&this._textureLoadingCallback(t)}this._currentScene.render()}},i.prototype.drag=function(t){t.stopPropagation(),t.preventDefault()},i.prototype.drop=function(t){t.stopPropagation(),t.preventDefault(),this.loadFiles(t)},i.prototype._traverseFolder=function(t,e,n,r){var o=this,l=t.createReader(),d=t.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");l.readEntries(function(v){n.count+=v.length;for(var y=0,D=v;y<D.length;y++){var w=D[y];w.isFile?w.file(function(F){F.correctName=d+F.name,e.push(F),--n.count==0&&r()}):w.isDirectory&&o._traverseFolder(w,e,n,r)}--n.count==0&&r()})},i.prototype._processFiles=function(t){for(var e=0;e<t.length;e++){var n=t[e].correctName.toLowerCase(),r=n.split(".").pop();this.onProcessFileCallback(t[e],n,r)&&(an.IsPluginForExtensionAvailable("."+r)&&(this._sceneFileToLoad=t[e]),i.FilesToLoad[n]=t[e])}},i.prototype.loadFiles=function(t){var e=this;if(t&&t.dataTransfer&&t.dataTransfer.files&&(this._filesToLoad=t.dataTransfer.files),t&&t.target&&t.target.files&&(this._filesToLoad=t.target.files),this._filesToLoad&&this._filesToLoad.length!==0&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var n=new Array,r=[],o=t.dataTransfer?t.dataTransfer.items:null,l=0;l<this._filesToLoad.length;l++){var d=this._filesToLoad[l],v=d.name.toLowerCase(),y=void 0;if(d.correctName=v,o){var D=o[l];D.getAsEntry?y=D.getAsEntry():D.webkitGetAsEntry&&(y=D.webkitGetAsEntry())}y&&y.isDirectory?r.push(y):n.push(d)}if(r.length===0)this._processFiles(n),this._processReload();else for(var w={count:r.length},F=0,z=r;F<z.length;F++){var k=z[F];this._traverseFolder(k,n,w,function(){e._processFiles(n),w.count===0&&e._processReload()})}}},i.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},i.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(_.a.errorsCount>0&&_.a.ClearLogCache(),this._engine.stopRenderLoop()),an.ShowLoadingScreen=!1,this._engine.displayLoadingUI(),an.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(e){t._progressCallback&&t._progressCallback(e)}).then(function(e){t._currentScene&&t._currentScene.dispose(),t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady(function(){t._engine.hideLoadingUI(),t._engine.runRenderLoop(function(){t.renderFunction()})})}).catch(function(e){t._engine.hideLoadingUI(),t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,e.message)})):_.a.Error("Please provide a valid .babylon file.")},i}(),VE=c(146),mN=c(145),Gi=function(){function i(t){t===void 0&&(t=0),this.priority=t}return i.prototype.getDescription=function(){return""},i.prototype.apply=function(t,e){return!0},i}(),Lh=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=1024),r===void 0&&(r=.5);var o=i.call(this,e)||this;return o.priority=e,o.maximumSize=n,o.step=r,o}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,n){for(var r=!0,o=0;o<e.textures.length;o++){var l=e.textures[o];if(l.canRescale&&!l.getContext){var d=l.getSize();Math.max(d.width,d.height)>this.maximumSize&&(l.scale(this.step),r=!1)}}return r},t}(Gi),r_=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=2),r===void 0&&(r=.25);var o=i.call(this,e)||this;return o.priority=e,o.maximumScale=n,o.step=r,o._currentScale=-1,o._directionOffset=1,o}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,n){return this._currentScale===-1&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),this._directionOffset===1?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(Gi),Nh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,n){return e.shadowsEnabled=n.isInImprovementMode,!0},t}(Gi),Fh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,n){return e.postProcessesEnabled=n.isInImprovementMode,!0},t}(Gi),Bh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,n){return e.lensFlaresEnabled=n.isInImprovementMode,!0},t}(Gi),kE=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,n){return!this.onApply||this.onApply(e,n)},t}(Gi),Uh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,n){return e.particlesEnabled=n.isInImprovementMode,!0},t}(Gi),i_=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(f.d)(t,i),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,n){return e.renderTargetsEnabled=n.isInImprovementMode,!0},t}(Gi),Vh=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._canBeMerged=function(n){if(!(n instanceof Fe.a))return!1;var r=n;return!r.isDisposed()&&!(!r.isVisible||!r.isEnabled())&&!(r.instances.length>0)&&!r.skeleton&&!r.hasLODLevels},e}return Object(f.d)(t,i),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(e){t._UpdateSelectionTree=e},enumerable:!1,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(e,n,r){for(var o=e.meshes.slice(0),l=o.length,d=0;d<l;d++){var v=new Array,y=o[d];if(this._canBeMerged(y)){v.push(y);for(var D=d+1;D<l;D++){var w=o[D];this._canBeMerged(w)&&w.material===y.material&&w.checkCollisions===y.checkCollisions&&(v.push(w),l--,o.splice(D,1),D--)}v.length<2||Fe.a.MergeMeshes(v,void 0,!0)}}var F=e;return F.createOrUpdateSelectionOctree&&(r!=null?r&&F.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&F.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(Gi),o_=function(){function i(t,e){t===void 0&&(t=60),e===void 0&&(e=2e3),this.targetFrameRate=t,this.trackerDuration=e,this.optimizations=new Array}return i.prototype.addOptimization=function(t){return this.optimizations.push(t),this},i.prototype.addCustomOptimization=function(t,e,n){n===void 0&&(n=0);var r=new kE(n);return r.onApply=t,r.onGetDescription=e,this.optimizations.push(r),this},i.LowDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Vh(n)),e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new Fh(n)),e.addOptimization(new Uh(n)),n++,e.addOptimization(new Lh(n,1024)),e},i.ModerateDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Vh(n)),e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new Fh(n)),e.addOptimization(new Uh(n)),n++,e.addOptimization(new Lh(n,512)),n++,e.addOptimization(new i_(n)),n++,e.addOptimization(new r_(n,2)),e},i.HighDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Vh(n)),e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new Fh(n)),e.addOptimization(new Uh(n)),n++,e.addOptimization(new Lh(n,256)),n++,e.addOptimization(new i_(n)),n++,e.addOptimization(new r_(n,4)),e},i}(),_N=function(){function i(t,e,n,r){var o=this;if(n===void 0&&(n=!0),r===void 0&&(r=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new S.c,this.onNewOptimizationAppliedObservable=new S.c,this.onFailureObservable=new S.c,this._options=e||new o_,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),n)for(var l=0,d=0,v=this._options.optimizations;d<v.length;d++)v[d].priority=l++;this._improvementMode=r,this._scene=t||re.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){o._sceneDisposeObserver=null,o.dispose()})}return Object.defineProperty(i.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(t){this._targetFrameRate=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(t){this._trackerDuration=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!1,configurable:!0}),i.prototype.stop=function(){this._isRunning=!1},i.prototype.reset=function(){this._currentPriorityLevel=0},i.prototype.start=function(){var t=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)}))},i.prototype._checkCurrentState=function(){var t=this;if(this._isRunning){var e=this._scene,n=this._options;if(this._currentFrameRate=Math.round(e.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var r=!0,o=!0,l=0;l<n.optimizations.length;l++){var d=n.optimizations[l];d.priority===this._currentPriorityLevel&&(o=!1,r=r&&d.apply(e,this),this.onNewOptimizationAppliedObservable.notifyObservers(d))}if(o)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);r&&this._currentPriorityLevel++,e.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)})}},i.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},i.OptimizeAsync=function(t,e,n,r){var o=new i(t,e||o_.ModerateDegradationAllowed(),!1);return n&&o.onSuccessObservable.add(function(){n()}),r&&o.onFailureObservable.add(function(){r()}),o.start(),o},i}(),kh=[],a_=function(i,t){kh[i.id]||i.doNotSerialize||(t.vertexData.push(i.serializeVerticeData()),kh[i.id]=!0)},jE=function(i,t){var e={},n=i._geometry;return n&&(i.getScene().getGeometryByID(n.id)||a_(n,t.geometries)),i.serialize&&i.serialize(e),e},s_=function(){function i(){}return i.ClearCache=function(){kh=[]},i.Serialize=function(t){var e,n,r,o={};if(i.ClearCache(),o.useDelayedTextureLoading=t.useDelayedTextureLoading,o.autoClear=t.autoClear,o.clearColor=t.clearColor.asArray(),o.ambientColor=t.ambientColor.asArray(),o.gravity=t.gravity.asArray(),o.collisionsEnabled=t.collisionsEnabled,t.fogMode&&t.fogMode!==0&&(o.fogMode=t.fogMode,o.fogColor=t.fogColor.asArray(),o.fogStart=t.fogStart,o.fogEnd=t.fogEnd,o.fogDensity=t.fogDensity),t.isPhysicsEnabled()){var l=t.getPhysicsEngine();l&&(o.physicsEnabled=!0,o.physicsGravity=l.gravity.asArray(),o.physicsEngine=l.getPhysicsPluginName())}t.metadata&&(o.metadata=t.metadata),o.morphTargetManagers=[];for(var d=0,v=t.meshes;d<v.length;d++){var y=(fe=v[d]).morphTargetManager;y&&o.morphTargetManagers.push(y.serialize())}for(o.lights=[],e=0;e<t.lights.length;e++)(n=t.lights[e]).doNotSerialize||o.lights.push(n.serialize());for(o.cameras=[],e=0;e<t.cameras.length;e++){var D=t.cameras[e];D.doNotSerialize||o.cameras.push(D.serialize())}if(t.activeCamera&&(o.activeCameraID=t.activeCamera.id),B.a.AppendSerializedAnimations(t,o),t.animationGroups&&t.animationGroups.length>0){o.animationGroups=[];for(var w=0;w<t.animationGroups.length;w++){var F=t.animationGroups[w];o.animationGroups.push(F.serialize())}}if(t.reflectionProbes&&t.reflectionProbes.length>0)for(o.reflectionProbes=[],e=0;e<t.reflectionProbes.length;e++){var z=t.reflectionProbes[e];o.reflectionProbes.push(z.serialize())}for(o.materials=[],o.multiMaterials=[],e=0;e<t.materials.length;e++)(r=t.materials[e]).doNotSerialize||o.materials.push(r.serialize());for(o.multiMaterials=[],e=0;e<t.multiMaterials.length;e++){var k=t.multiMaterials[e];o.multiMaterials.push(k.serialize())}for(t.environmentTexture&&(o.environmentTexture=t.environmentTexture.name),o.environmentIntensity=t.environmentIntensity,o.skeletons=[],e=0;e<t.skeletons.length;e++){var K=t.skeletons[e];K.doNotSerialize||o.skeletons.push(K.serialize())}for(o.transformNodes=[],e=0;e<t.transformNodes.length;e++)t.transformNodes[e].doNotSerialize||o.transformNodes.push(t.transformNodes[e].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],kh=[];var ae=t.getGeometries();for(e=0;e<ae.length;e++){var le=ae[e];le.isReady()&&a_(le,o.geometries)}for(o.meshes=[],e=0;e<t.meshes.length;e++){var fe;if((fe=t.meshes[e])instanceof Fe.a){var me=fe;me.doNotSerialize||me.delayLoadState!==g.a.DELAYLOADSTATE_LOADED&&me.delayLoadState!==g.a.DELAYLOADSTATE_NONE||o.meshes.push(jE(me,o))}}for(o.particleSystems=[],e=0;e<t.particleSystems.length;e++)o.particleSystems.push(t.particleSystems[e].serialize(!1));for(o.postProcesses=[],e=0;e<t.postProcesses.length;e++)o.postProcesses.push(t.postProcesses[e].serialize());t.actionManager&&(o.actions=t.actionManager.serialize("scene"));for(var be=0,Ee=t._serializableComponents;be<Ee.length;be++)Ee[be].serialize(o);return o},i.SerializeMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r={};if(i.ClearCache(),t=t instanceof Array?t:[t],e||n)for(var o=0;o<t.length;++o)n&&t[o].getDescendants().forEach(function(l){l instanceof Fe.a&&t.indexOf(l)<0&&!l.doNotSerialize&&t.push(l)}),e&&t[o].parent&&t.indexOf(t[o].parent)<0&&!t[o].parent.doNotSerialize&&t.push(t[o].parent);return t.forEach(function(l){(function(d,v){if(d.delayLoadState===g.a.DELAYLOADSTATE_LOADED||d.delayLoadState===g.a.DELAYLOADSTATE_NONE){if(d.material&&!d.material.doNotSerialize)if(d.material instanceof Ra.a){if(v.multiMaterials=v.multiMaterials||[],v.materials=v.materials||[],!v.multiMaterials.some(function(z){return z.id===d.material.id})){v.multiMaterials.push(d.material.serialize());for(var y=function(z){z&&(v.materials.some(function(k){return k.id===z.id})||v.materials.push(z.serialize()))},D=0,w=d.material.subMaterials;D<w.length;D++)y(w[D])}}else v.materials=v.materials||[],v.materials.some(function(z){return z.id===d.material.id})||v.materials.push(d.material.serialize());var F=d._geometry;F&&(v.geometries||(v.geometries={},v.geometries.boxes=[],v.geometries.spheres=[],v.geometries.cylinders=[],v.geometries.toruses=[],v.geometries.grounds=[],v.geometries.planes=[],v.geometries.torusKnots=[],v.geometries.vertexData=[]),a_(F,v.geometries)),d.skeleton&&!d.skeleton.doNotSerialize&&(v.skeletons=v.skeletons||[],v.skeletons.push(d.skeleton.serialize())),v.meshes=v.meshes||[],v.meshes.push(jE(d,v))}})(l,r)}),r},i}(),gN=c(37),vN=function(){function i(){}return i.CreateResizedCopy=function(t,e,n,r){r===void 0&&(r=!0);var o=t.getScene(),l=o.getEngine(),d=new qn("resized"+t.name,{width:e,height:n},o,!t.noMipmap,!0,t._texture.type,!1,t.samplingMode,!1);d.wrapU=t.wrapU,d.wrapV=t.wrapV,d.uOffset=t.uOffset,d.vOffset=t.vOffset,d.uScale=t.uScale,d.vScale=t.vScale,d.uAng=t.uAng,d.vAng=t.vAng,d.wAng=t.wAng,d.coordinatesIndex=t.coordinatesIndex,d.level=t.level,d.anisotropicFilteringLevel=t.anisotropicFilteringLevel,d._texture.isReady=!1,t.wrapU=ke.a.CLAMP_ADDRESSMODE,t.wrapV=ke.a.CLAMP_ADDRESSMODE;var v=new Bo("pass",1,null,r?ke.a.BILINEAR_SAMPLINGMODE:ke.a.NEAREST_SAMPLINGMODE,l,!1,g.a.TEXTURETYPE_UNSIGNED_INT);return v.getEffect().executeWhenCompiled(function(){v.onApply=function(D){D.setTexture("textureSampler",t)};var y=d.getInternalTexture();y&&(o.postProcessManager.directRender([v],y),l.unBindFramebuffer(y),d.disposeFramebufferObjects(),v.dispose(),y.isReady=!0)}),d},i}(),bN=function(){function i(t,e){if(e===void 0&&(e=null),!i.IsSupported(t))throw"Your browser does not support recording so far.";var n=t.getRenderingCanvas();if(!n)throw"The babylon engine must have a canvas to be recorded";this._canvas=n,this._canvas.isRecording=!1,this._options=Object(f.a)(Object(f.a)({},i._defaultOptions),e);var r=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var o=0,l=this._options.audioTracks;o<l.length;o++){var d=l[o];r.addTrack(d)}this._mediaRecorder=new MediaRecorder(r,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return i.IsSupported=function(t){var e=t.getRenderingCanvas();return!!e&&typeof e.captureStream=="function"},Object.defineProperty(i.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!1,configurable:!0}),i.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},i.prototype.startRecording=function(t,e){var n=this;if(t===void 0&&(t="babylonjs.webm"),e===void 0&&(e=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return e>0&&setTimeout(function(){n.stopRecording()},1e3*e),this._fileName=t,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(r,o){n._resolve=r,n._reject=o})},i.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},i.prototype._handleDataAvailable=function(t){t.data.size>0&&this._recordedChunks.push(t.data)},i.prototype._handleError=function(t){if(this.stopRecording(),!this._reject)throw new t.error;this._reject(t.error)},i.prototype._handleStop=function(){this.stopRecording();var t=new Blob(this._recordedChunks);this._resolve&&this._resolve(t),window.URL.createObjectURL(t),this._fileName&&et.b.Download(t,this._fileName)},i._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},i}(),Tl=function(){function i(){}return i.CreateScreenshot=function(t,e,n,r,o){o===void 0&&(o="image/png");var l=i._getScreenshotSize(t,e,n),d=l.height,v=l.width;if(d&&v){et.b._ScreenshotCanvas||(et.b._ScreenshotCanvas=document.createElement("canvas")),et.b._ScreenshotCanvas.width=v,et.b._ScreenshotCanvas.height=d;var y=et.b._ScreenshotCanvas.getContext("2d"),D=t.getRenderWidth()/t.getRenderHeight(),w=v,F=w/D;F>d&&(w=(F=d)*D);var z=Math.max(0,v-w)/2,k=Math.max(0,d-F)/2,K=t.getRenderingCanvas();y&&K&&y.drawImage(K,z,k,w,F),et.b.EncodeScreenshotCanvasData(r,o)}else _.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotAsync=function(t,e,n,r){return r===void 0&&(r="image/png"),new Promise(function(o,l){i.CreateScreenshot(t,e,n,function(d){d!==void 0?o(d):l(new Error("Data is undefined"))},r)})},i.CreateScreenshotUsingRenderTarget=function(t,e,n,r,o,l,d,v,y,D){o===void 0&&(o="image/png"),l===void 0&&(l=1),d===void 0&&(d=!1),y===void 0&&(y=!1),D===void 0&&(D=!1);var w=i._getScreenshotSize(t,e,n),F=w.height,z=w.width,k={width:z,height:F};if(F&&z){var K=t.getRenderingCanvas();if(K){var ae={width:K.width,height:K.height};t.setSize(z,F);var le=e.getScene(),fe=null,me=le.activeCameras;(le.activeCamera!==e||le.activeCameras&&le.activeCameras.length)&&(fe=le.activeCamera,le.activeCamera=e),le.render();var be=new qn("screenShot",k,le,!1,!1,g.a.TEXTURETYPE_UNSIGNED_INT,!1,ke.a.NEAREST_SAMPLINGMODE,void 0,D);be.renderList=null,be.samples=l,be.renderSprites=y,be.onAfterRenderObservable.add(function(){et.b.DumpFramebuffer(z,F,t,r,o,v)});var Ee=function(){le.incrementRenderId(),le.resetCachedMaterial(),be.render(!0),be.dispose(),fe&&(le.activeCamera=fe),le.activeCameras=me,t.setSize(ae.width,ae.height),e.getProjectionMatrix(!0)};if(d){var xe=new yl("antialiasing",1,le.activeCamera);be.addPostProcess(xe),xe.getEffect().isReady()?Ee():xe.getEffect().onCompiled=function(){Ee()}}else Ee()}else _.a.Error("No rendering canvas found !")}else _.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotUsingRenderTargetAsync=function(t,e,n,r,o,l,d,v){return r===void 0&&(r="image/png"),o===void 0&&(o=1),l===void 0&&(l=!1),v===void 0&&(v=!1),new Promise(function(y,D){i.CreateScreenshotUsingRenderTarget(t,e,n,function(w){w!==void 0?y(w):D(new Error("Data is undefined"))},r,o,l,d,v)})},i._getScreenshotSize=function(t,e,n){var r=0,o=0;if(typeof n=="object"){var l=n.precision?Math.abs(n.precision):1;n.width&&n.height?(r=n.height*l,o=n.width*l):n.width&&!n.height?(o=n.width*l,r=Math.round(o/t.getAspectRatio(e))):n.height&&!n.width?(r=n.height*l,o=Math.round(r*t.getAspectRatio(e))):(o=Math.round(t.getRenderWidth()*l),r=Math.round(o/t.getAspectRatio(e)))}else isNaN(n)||(r=n,o=n);return o&&(o=Math.floor(o)),r&&(r=Math.floor(r)),{height:0|r,width:0|o}},i}();et.b.CreateScreenshot=Tl.CreateScreenshot,et.b.CreateScreenshotAsync=Tl.CreateScreenshotAsync,et.b.CreateScreenshotUsingRenderTarget=Tl.CreateScreenshotUsingRenderTarget,et.b.CreateScreenshotUsingRenderTargetAsync=Tl.CreateScreenshotUsingRenderTargetAsync,function(i){i[i.Checkbox=0]="Checkbox",i[i.Slider=1]="Slider",i[i.Vector3=2]="Vector3",i[i.Quaternion=3]="Quaternion",i[i.Color3=4]="Color3",i[i.String=5]="String"}(n_||(n_={}));var ws,yN=c(140),TN=function(){function i(t){this.byteOffset=0,this.buffer=t}return i.prototype.loadAsync=function(t){var e=this;return this.buffer.readAsync(this.byteOffset,t).then(function(n){e._dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),e._dataByteOffset=0})},i.prototype.readUint32=function(){var t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t},i.prototype.readUint8Array=function(t){var e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,e},i.prototype.readString=function(t){return ci.a.Decode(this.readUint8Array(t))},i.prototype.skipBytes=function(t){this._dataByteOffset+=t,this.byteOffset+=t},i}(),EN=function(){function i(){}return i._GetStorage=function(){try{return localStorage.setItem("test",""),localStorage.removeItem("test"),localStorage}catch(e){var t={};return{getItem:function(n){var r=t[n];return r===void 0?null:r},setItem:function(n,r){t[n]=r}}}},i.ReadString=function(t,e){var n=this._Storage.getItem(t);return n!==null?n:e},i.WriteString=function(t,e){this._Storage.setItem(t,e)},i.ReadBoolean=function(t,e){var n=this._Storage.getItem(t);return n!==null?n==="true":e},i.WriteBoolean=function(t,e){this._Storage.setItem(t,e?"true":"false")},i.ReadNumber=function(t,e){var n=this._Storage.getItem(t);return n!==null?parseFloat(n):e},i.WriteNumber=function(t,e){this._Storage.setItem(t,e.toString())},i._Storage=i._GetStorage(),i}(),SN=function(){function i(){this._trackedScene=null}return i.prototype.track=function(t){this._trackedScene=t,this._savedJSON=s_.Serialize(t)},i.prototype.getDelta=function(){if(!this._trackedScene)return null;var t=s_.Serialize(this._trackedScene),e={};for(var n in t)this._compareCollections(n,this._savedJSON[n],t[n],e);return e},i.prototype._compareArray=function(t,e,n,r){if(e.length===0&&n.length===0)return!0;if(e.length&&!isNaN(e[0])||n.length&&!isNaN(n[0])){if(e.length!==n.length)return!1;if(e.length===0)return!0;for(var o=0;o<e.length;o++)if(e[o]!==n[o])return r[t]=n,!1;return!0}var l=[],d=function(){var w=e[o],F=w.uniqueId;l.push(F);var z=n.filter(function(ae){return ae.uniqueId===F});if(z.length){var k=z[0],K={};v._compareObjects(w,k,K)||(r[t]||(r[t]=[]),K.__state={id:k.id||k.name},r[t].push(K))}else K={__state:{deleteId:w.id||w.name}},r[t].push(K)},v=this;for(o=0;o<e.length;o++)d();for(o=0;o<n.length;o++){var y=n[o],D=y.uniqueId;l.indexOf(D)===-1&&(r[t]||(r[t]=[]),r[t].push(y))}return!0},i.prototype._compareObjects=function(t,e,n){var r=!1;for(var o in t)if(t.hasOwnProperty(o)){var l=t[o],d=e[o],v=!1;Array.isArray(l)?v=JSON.stringify(l)!==JSON.stringify(d):isNaN(l)&&Object.prototype.toString.call(l)!="[object String]"||(v=l!==d),v&&(r=!0,n[o]=d)}return!r},i.prototype._compareCollections=function(t,e,n,r){if(e!==n&&e&&n){if(Array.isArray(e)&&Array.isArray(n)){if(this._compareArray(t,e,n,r))return}else if(typeof e=="object"&&typeof n=="object"){var o={};return void(this._compareObjects(e,n,o)||(r[t]=o))}}},i.GetShadowGeneratorById=function(t,e){for(var n=0,r=t.lights.map(function(l){return l.getShadowGenerator()});n<r.length;n++){var o=r[n];if(o&&o.id===e)return o}return null},i.ApplyDelta=function(t,e){var n=this;typeof t=="string"&&(t=JSON.parse(t));var r=e;for(var o in t){var l=t[o],d=r[o];if(Array.isArray(d)||o==="shadowGenerators")switch(o){case"cameras":this._ApplyDeltaForEntity(l,e,e.getCameraByID.bind(e),function(v){return Pt.a.Parse(v,e)});break;case"lights":this._ApplyDeltaForEntity(l,e,e.getLightByID.bind(e),function(v){return so.a.Parse(v,e)});break;case"shadowGenerators":this._ApplyDeltaForEntity(l,e,function(v){return n.GetShadowGeneratorById(e,v)},function(v){return Gr.Parse(v,e)});break;case"meshes":this._ApplyDeltaForEntity(l,e,e.getMeshByID.bind(e),function(v){return Fe.a.Parse(v,e,"")});break;case"skeletons":this._ApplyDeltaForEntity(l,e,e.getSkeletonById.bind(e),function(v){return ba.Parse(v,e)});break;case"materials":this._ApplyDeltaForEntity(l,e,e.getMaterialByID.bind(e),function(v){return pn.a.Parse(v,e,"")});break;case"multiMaterials":this._ApplyDeltaForEntity(l,e,e.getMaterialByID.bind(e),function(v){return Ra.a.Parse(v,e,"")});break;case"transformNodes":this._ApplyDeltaForEntity(l,e,e.getTransformNodeByID.bind(e),function(v){return ms.a.Parse(v,e,"")});break;case"particleSystems":this._ApplyDeltaForEntity(l,e,e.getParticleSystemByID.bind(e),function(v){return er.Parse(v,e,"")});break;case"morphTargetManagers":this._ApplyDeltaForEntity(l,e,e.getMorphTargetById.bind(e),function(v){return _h.Parse(v,e)});break;case"postProcesses":this._ApplyDeltaForEntity(l,e,e.getPostProcessByName.bind(e),function(v){return St.Parse(v,e,"")})}else isNaN(d)?d.fromArray&&d.fromArray(l):r[o]=l}},i._ApplyPropertiesToEntity=function(t,e){for(var n in t){var r=t[n],o=e[n];o!==void 0&&(!isNaN(o)||Array.isArray(o)?e[n]=r:o.fromArray&&o.fromArray(r))}},i._ApplyDeltaForEntity=function(t,e,n,r){for(var o=0,l=t;o<l.length;o++){var d=l[o];if(d.__state&&d.__state.id!==void 0){var v=n(d.__state.id);v&&this._ApplyPropertiesToEntity(d,v)}else if(d.__state&&d.__state.deleteId!==void 0){var y=n(d.__state.deleteId);y==null||y.dispose()}else r(d)}},i}();(function(i){var t=function(){function n(r,o,l,d){var v;o===void 0&&(o=null),l===void 0&&(l=null),d===void 0&&(d=null),o=o??function(){return 1},l=l??function(){return 1},d=d??function(w,F){return w===F?0:1},this._characterToIdx=new Map,this._insertionCosts=new Array(r.length),this._deletionCosts=new Array(r.length),this._substitutionCosts=new Array(r.length);for(var y=0;y<r.length;++y){v=r[y],this._characterToIdx.set(v,y),this._insertionCosts[y]=o(v),this._deletionCosts[y]=l(v),this._substitutionCosts[y]=new Array(r.length);for(var D=y;D<r.length;++D)this._substitutionCosts[y][D]=d(v,r[D])}}return n.prototype.serialize=function(){var r={},o=new Array(this._characterToIdx.size);return this._characterToIdx.forEach(function(l,d){o[l]=d}),r.characters=o,r.insertionCosts=this._insertionCosts,r.deletionCosts=this._deletionCosts,r.substitutionCosts=this._substitutionCosts,JSON.stringify(r)},n.Deserialize=function(r){var o=JSON.parse(r),l=new n(o.characters);return l._insertionCosts=o.insertionCosts,l._deletionCosts=o.deletionCosts,l._substitutionCosts=o.substitutionCosts,l},n.prototype.getCharacterIdx=function(r){return this._characterToIdx.get(r)},n.prototype.getInsertionCost=function(r){return this._insertionCosts[r]},n.prototype.getDeletionCost=function(r){return this._deletionCosts[r]},n.prototype.getSubstitutionCost=function(r,o){var l=Math.min(r,o),d=Math.max(r,o);return this._substitutionCosts[l][d]},n}();i.Alphabet=t;var e=function(){function n(r,o){var l=this;if(r.length>n.MAX_SEQUENCE_LENGTH)throw new Error("Sequences longer than "+n.MAX_SEQUENCE_LENGTH+" not supported.");this._alphabet=o,this._characters=r.map(function(d){return l._alphabet.getCharacterIdx(d)})}return n.prototype.serialize=function(){return JSON.stringify(this._characters)},n.Deserialize=function(r,o){var l=new n([],o);return l._characters=JSON.parse(r),l},n.prototype.distance=function(r){return n._distance(this,r)},n._distance=function(r,o){var l=r._alphabet;if(l!==o._alphabet)throw new Error("Cannot Levenshtein compare Sequences built from different alphabets.");var d=r._characters,v=o._characters,y=d.length,D=v.length,w=n._costMatrix;w[0][0]=0;for(var F=0;F<y;++F)w[F+1][0]=w[F][0]+l.getInsertionCost(d[F]);for(F=0;F<D;++F)w[0][F+1]=w[0][F]+l.getInsertionCost(v[F]);for(var z=0;z<y;++z)for(var k=0;k<D;++k)n._insertionCost=w[z+1][k]+l.getInsertionCost(v[k]),n._deletionCost=w[z][k+1]+l.getDeletionCost(d[z]),n._substitutionCost=w[z][k]+l.getSubstitutionCost(d[z],v[k]),w[z+1][k+1]=Math.min(n._insertionCost,n._deletionCost,n._substitutionCost);return w[y][D]},n.MAX_SEQUENCE_LENGTH=256,n._costMatrix=Object(f.f)(Array(n.MAX_SEQUENCE_LENGTH+1)).map(function(r){return new Array(n.MAX_SEQUENCE_LENGTH+1)}),n}();i.Sequence=e})(ws||(ws={}));var xN=function(){function i(t){t===void 0&&(t=.01),this._points=[],this._segmentLength=t}return i.prototype.serialize=function(){return JSON.stringify(this)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i(e._segmentLength);return n._points=e._points.map(function(r){return new h.e(r._x,r._y,r._z)}),n},i.prototype.getLength=function(){return this._points.length*this._segmentLength},i.prototype.add=function(t){var e=this,n=this._points.length;if(n===0)this._points.push(t.clone());else for(var r=function(){return e._segmentLength/h.e.Distance(e._points[n-1],t)},o=r();o<=1;o=r()){var l=this._points[n-1].scale(1-o);t.scaleAndAddToRef(o,l),this._points.push(l),++n}},i.prototype.resampleAtTargetResolution=function(t){var e=new i(this.getLength()/t);return this._points.forEach(function(n){e.add(n)}),e},i.prototype.tokenize=function(t){for(var e=[],n=new h.e,r=2;r<this._points.length;++r)i._transformSegmentDirToRef(this._points[r-2],this._points[r-1],this._points[r],n)&&e.push(i._tokenizeSegment(n,t));return e},i._transformSegmentDirToRef=function(t,e,n,r){return e.subtractToRef(t,i._forwardDir),i._forwardDir.normalize(),e.scaleToRef(-1,i._inverseFromVec),i._inverseFromVec.normalize(),!(Math.abs(h.e.Dot(i._forwardDir,i._inverseFromVec))>.98)&&(h.e.CrossToRef(i._forwardDir,i._inverseFromVec,i._upDir),i._upDir.normalize(),h.a.LookAtLHToRef(t,e,i._upDir,i._lookMatrix),n.subtractToRef(e,i._fromToVec),i._fromToVec.normalize(),h.e.TransformNormalToRef(i._fromToVec,i._lookMatrix,r),!0)},i._tokenizeSegment=function(t,e){i._bestMatch=0,i._score=h.e.Dot(t,e[0]),i._bestScore=i._score;for(var n=1;n<e.length;++n)i._score=h.e.Dot(t,e[n]),i._score>i._bestScore&&(i._bestMatch=n,i._bestScore=i._score);return i._bestMatch},i._forwardDir=new h.e,i._inverseFromVec=new h.e,i._upDir=new h.e,i._fromToVec=new h.e,i._lookMatrix=new h.a,i}(),zE=function(){function i(t){this.chars=new Array(t)}return i.Generate=function(t,e,n,r,o){t===void 0&&(t=64),e===void 0&&(e=256),n===void 0&&(n=.1),r===void 0&&(r=.001),o===void 0&&(o=[]);for(var l,d,v=new i(t),y=0;y<t;++y)v.chars[y]=new h.e(Math.random()-.5,Math.random()-.5,Math.random()-.5),v.chars[y].normalize();for(y=0;y<o.length;++y)v.chars[y].copyFrom(o[y]);for(var D,w=new h.e,F=new h.e,z=0;z<e;++z){l=(1-(D=z/(e-1)))*n+D*r;var k=function(K){w.copyFromFloats(0,0,0),v.chars.forEach(function(ae){v.chars[K].subtractToRef(ae,F),(d=F.lengthSquared())>1e-6&&F.scaleAndAddToRef(1/(F.lengthSquared()*d),w)}),w.scaleInPlace(l),v.chars[K].addInPlace(w),v.chars[K].normalize()};for(y=o.length;y<v.chars.length;++y)k(y)}return v},i.prototype.serialize=function(){return JSON.stringify(this.chars)},i.Deserialize=function(t){for(var e=JSON.parse(t),n=new i(e.length),r=0;r<e.length;++r)n.chars[r]=new h.e(e[r]._x,e[r]._y,e[r]._z);return n},i}(),c_=function(){function i(){this._sequences=[]}return i.prototype.serialize=function(){return JSON.stringify(this._sequences.map(function(t){return t.serialize()}))},i.Deserialize=function(t,e){var n=new i;return n._sequences=JSON.parse(t).map(function(r){return ws.Sequence.Deserialize(r,e)}),n},i.CreateFromTrajectory=function(t,e,n){return i.CreateFromTokenizationPyramid(i._getTokenizationPyramid(t,e),n)},i.CreateFromTokenizationPyramid=function(t,e){var n=new i;return n._sequences=t.map(function(r){return new ws.Sequence(r,e)}),n},i._getTokenizationPyramid=function(t,e,n){n===void 0&&(n=i.FINEST_DESCRIPTOR_RESOLUTION);for(var r=[],o=n;o>4;o=Math.floor(o/2))r.push(t.resampleAtTargetResolution(o).tokenize(e.chars));return r},i.prototype.distance=function(t){for(var e=0,n=0;n<this._sequences.length;++n)e+=Math.pow(2,n)*this._sequences[n].distance(t._sequences[n]);return e},i.FINEST_DESCRIPTOR_RESOLUTION=32,i}(),GE=function(){function i(t){t===void 0&&(t=[]),this._descriptors=t,this._centroidIdx=-1,this._averageDistance=0,this._refreshDescription()}return i.prototype.serialize=function(){var t={};return t.descriptors=this._descriptors.map(function(e){return e.serialize()}),t.centroidIdx=this._centroidIdx,t.averageDistance=this._averageDistance,JSON.stringify(t)},i.Deserialize=function(t,e){var n=JSON.parse(t),r=new i;return r._descriptors=n.descriptors.map(function(o){return c_.Deserialize(o,e)}),r._centroidIdx=n.centroidIdx,r._averageDistance=n.averageDistance,r},i.prototype.add=function(t){this._descriptors.push(t),this._refreshDescription()},i.prototype.getMatchCost=function(t){return t.distance(this._descriptors[this._centroidIdx])/this._averageDistance},i.prototype.getMatchMinimumDistance=function(t){return Math.min.apply(Math,this._descriptors.map(function(e){return e.distance(t)}))},i.prototype._refreshDescription=function(){var t,e=this;this._centroidIdx=-1;for(var n=this._descriptors.map(function(o){return t=0,e._descriptors.forEach(function(l){t+=o.distance(l)}),t}),r=0;r<n.length;++r)(this._centroidIdx<0||n[r]<n[this._centroidIdx])&&(this._centroidIdx=r);this._averageDistance=0,this._descriptors.forEach(function(o){e._averageDistance+=o.distance(e._descriptors[e._centroidIdx])}),this._descriptors.length>0&&(this._averageDistance=Math.max(this._averageDistance/this._descriptors.length,i.MIN_AVERAGE_DISTANCE))},i.MIN_AVERAGE_DISTANCE=1,i}(),AN=function(){function i(){this._maximumAllowableMatchCost=4,this._nameToDescribedTrajectory=new Map}return i.prototype.serialize=function(){var t={};return t.maximumAllowableMatchCost=this._maximumAllowableMatchCost,t.vector3Alphabet=this._vector3Alphabet.serialize(),t.levenshteinAlphabet=this._levenshteinAlphabet.serialize(),t.nameToDescribedTrajectory=[],this._nameToDescribedTrajectory.forEach(function(e,n){t.nameToDescribedTrajectory.push(n),t.nameToDescribedTrajectory.push(e.serialize())}),JSON.stringify(t)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i;n._maximumAllowableMatchCost=e.maximumAllowableMatchCost,n._vector3Alphabet=zE.Deserialize(e.vector3Alphabet),n._levenshteinAlphabet=ws.Alphabet.Deserialize(e.levenshteinAlphabet);for(var r=0;r<e.nameToDescribedTrajectory.length;r+=2)n._nameToDescribedTrajectory.set(e.nameToDescribedTrajectory[r],GE.Deserialize(e.nameToDescribedTrajectory[r+1],n._levenshteinAlphabet));return n},i.Generate=function(){for(var t=zE.Generate(64,256,.1,.001,[h.e.Forward()]),e=new Array(t.chars.length),n=0;n<e.length;++n)e[n]=n;var r=new ws.Alphabet(e,function(l){return l===0?0:1},function(l){return l===0?0:1},function(l,d){return Math.min(1-h.e.Dot(t.chars[l],t.chars[d]),1)}),o=new i;return o._vector3Alphabet=t,o._levenshteinAlphabet=r,o},i.prototype.addTrajectoryToClassification=function(t,e){this._nameToDescribedTrajectory.has(e)||this._nameToDescribedTrajectory.set(e,new GE),this._nameToDescribedTrajectory.get(e).add(c_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet))},i.prototype.deleteClassification=function(t){return this._nameToDescribedTrajectory.delete(t)},i.prototype.classifyTrajectory=function(t){var e=this,n=c_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet),r=[];if(this._nameToDescribedTrajectory.forEach(function(y,D){y.getMatchCost(n)<e._maximumAllowableMatchCost&&r.push(D)}),r.length===0)return null;for(var o,l=0,d=this._nameToDescribedTrajectory.get(r[l]).getMatchMinimumDistance(n),v=0;v<r.length;++v)(o=this._nameToDescribedTrajectory.get(r[v]).getMatchMinimumDistance(n))<d&&(d=o,l=v);return r[l]},i}(),PN=c(150),jh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._direction=new h.e(0,0,-1),r._mat=new h.a,r._onSelectEnabled=!1,r._origin=new h.e(0,0,0),r.lastNativeXRHitResults=[],r.onHitTestResultObservable=new S.c,r._onHitTestResults=function(o){var l=o.map(function(d){var v=h.a.FromArray(d.hitMatrix);return r._xrSessionManager.scene.useRightHandedSystem||v.toggleModelMatrixHandInPlace(),r.options.worldParentNode&&v.multiplyToRef(r.options.worldParentNode.getWorldMatrix(),v),{xrHitResult:d,transformationMatrix:v}});r.lastNativeXRHitResults=o,r.onHitTestResultObservable.notifyObservers(l)},r._onSelect=function(o){r._onSelectEnabled&&t.XRHitTestWithSelectEvent(o,r._xrSessionManager.referenceSpace)},r.xrNativeFeatureName="hit-test",et.b.Warn("A newer version of this plugin is available"),r}return Object(f.d)(t,i),t.XRHitTestWithRay=function(e,n,r,o){return e.requestHitTest(n,r).then(function(l){var d=o||function(v){return!!v.hitMatrix};return l.filter(d)})},t.XRHitTestWithSelectEvent=function(e,n){var r=e.frame.getPose(e.inputSource.targetRaySpace,n);if(!r)return Promise.resolve([]);var o=new XRRay(r.transform);return this.XRHitTestWithRay(e.frame.session,o,n)},t.prototype.attach=function(){return!!i.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&!this.options.testOnPointerDownOnly){var n=e.getViewerPose(this._xrSessionManager.referenceSpace);if(n){h.a.FromArrayToRef(n.transform.matrix,0,this._mat),h.e.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),h.e.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var r=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});t.XRHitTestWithRay(this._xrSessionManager.session,r,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},t.Name=Ti.HIT_TEST,t.Version=1,t}(Ei);li.AddWebXRFeature(jh.Name,function(i,t){return function(){return new jh(i,t)}},jh.Version,!1);var CN=0,zh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._lastFrameDetected=new Set,r._trackedAnchors=[],r._futureAnchors=[],r.onAnchorAddedObservable=new S.c,r.onAnchorRemovedObservable=new S.c,r.onAnchorUpdatedObservable=new S.c,r._tmpVector=new h.e,r._tmpQuaternion=new h.b,r.xrNativeFeatureName="anchors",r}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"referenceSpaceForFrameAnchors",{set:function(e){this._referenceSpaceForFrameAnchors=e},enumerable:!1,configurable:!0}),t.prototype._populateTmpTransformation=function(e,n){return this._tmpVector.copyFrom(e),this._tmpQuaternion.copyFrom(n),this._xrSessionManager.scene.useRightHandedSystem||(this._tmpVector.z*=-1,this._tmpQuaternion.z*=-1,this._tmpQuaternion.w*=-1),{position:this._tmpVector,rotationQuaternion:this._tmpQuaternion}},t.prototype.addAnchorPointUsingHitTestResultAsync=function(e,n,r){return n===void 0&&(n=new h.e),r===void 0&&(r=new h.b),Object(f.b)(this,void 0,void 0,function(){var o,l,d,v=this;return Object(f.e)(this,function(y){switch(y.label){case 0:if(this._populateTmpTransformation(n,r),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),e.xrHitResult.createAnchor)return[3,1];throw this.detach(),new Error("Anchors not enabled in this environment/browser");case 1:return y.trys.push([1,3,,4]),[4,e.xrHitResult.createAnchor(o)];case 2:return l=y.sent(),[2,new Promise(function(D,w){v._futureAnchors.push({nativeAnchor:l,resolved:!1,submitted:!0,xrTransformation:o,resolve:D,reject:w})})];case 3:throw d=y.sent(),new Error(d);case 4:return[2]}})})},t.prototype.addAnchorAtPositionAndRotationAsync=function(e,n,r){return n===void 0&&(n=new h.b),r===void 0&&(r=!1),Object(f.b)(this,void 0,void 0,function(){var o,l,d,v=this;return Object(f.e)(this,function(y){switch(y.label){case 0:return this._populateTmpTransformation(e,n),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),r&&this.attached&&this._xrSessionManager.currentFrame?[4,this._createAnchorAtTransformation(o,this._xrSessionManager.currentFrame)]:[3,2];case 1:return d=y.sent(),[3,3];case 2:d=void 0,y.label=3;case 3:return l=d,[2,new Promise(function(D,w){v._futureAnchors.push({nativeAnchor:l,resolved:!1,submitted:!1,xrTransformation:o,resolve:D,reject:w})})]}})})},Object.defineProperty(t.prototype,"anchors",{get:function(){return this._trackedAnchors},enumerable:!1,configurable:!0}),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemoveAnchorsOnSessionEnded)for(;this._trackedAnchors.length;){var e=this._trackedAnchors.pop();if(e){try{e.remove()}catch(n){}this.onAnchorRemovedObservable.notifyObservers(e)}}return!0},t.prototype.dispose=function(){this._futureAnchors.length=0,i.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&e){var r=e.trackedAnchors;if(r){var o=this._trackedAnchors.filter(function(d){return!r.has(d.xrAnchor)}).map(function(d){return n._trackedAnchors.indexOf(d)}),l=0;o.forEach(function(d){var v=n._trackedAnchors.splice(d-l,1)[0];n.onAnchorRemovedObservable.notifyObservers(v),l++}),r.forEach(function(d){if(n._lastFrameDetected.has(d)){var v=n._findIndexInAnchorArray(d);D=n._trackedAnchors[v];try{n._updateAnchorWithXRFrame(d,D,e),D.attachedNode&&(D.attachedNode.rotationQuaternion=D.attachedNode.rotationQuaternion||new h.b,D.transformationMatrix.decompose(D.attachedNode.scaling,D.attachedNode.rotationQuaternion,D.attachedNode.position)),n.onAnchorUpdatedObservable.notifyObservers(D)}catch(F){et.b.Warn("Anchor could not be updated")}}else{var y={id:CN++,xrAnchor:d,remove:d.delete},D=n._updateAnchorWithXRFrame(d,y,e);n._trackedAnchors.push(D),n.onAnchorAddedObservable.notifyObservers(D);var w=n._futureAnchors.filter(function(F){return F.nativeAnchor===d})[0];w&&(w.resolve(D),w.resolved=!0)}}),this._lastFrameDetected=r}this._futureAnchors.forEach(function(d){d.resolved||d.submitted||(n._createAnchorAtTransformation(d.xrTransformation,e).then(function(v){d.nativeAnchor=v},function(v){d.resolved=!0,d.reject(v)}),d.submitted=!0)})}},t.prototype._findIndexInAnchorArray=function(e){for(var n=0;n<this._trackedAnchors.length;++n)if(this._trackedAnchors[n].xrAnchor===e)return n;return-1},t.prototype._updateAnchorWithXRFrame=function(e,n,r){var o=r.getPose(e.anchorSpace,this._xrSessionManager.referenceSpace);if(o){var l=n.transformationMatrix||new h.a;h.a.FromArrayToRef(o.transform.matrix,0,l),this._xrSessionManager.scene.useRightHandedSystem||l.toggleModelMatrixHandInPlace(),n.transformationMatrix=l,this._options.worldParentNode&&l.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),l)}return n},t.prototype._createAnchorAtTransformation=function(e,n){var r;return Object(f.b)(this,void 0,void 0,function(){return Object(f.e)(this,function(o){if(!n.createAnchor)throw this.detach(),new Error("Anchors are not enabled in your browser");try{return[2,n.createAnchor(e,(r=this._referenceSpaceForFrameAnchors)!==null&&r!==void 0?r:this._xrSessionManager.referenceSpace)]}catch(l){throw new Error(l)}return[2]})})},t.Name=Ti.ANCHOR_SYSTEM,t.Version=1,t}(Ei);li.AddWebXRFeature(zh.Name,function(i,t){return function(){return new zh(i,t)}},zh.Version);var RN=0,Gh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._detectedPlanes=[],r._enabled=!1,r._lastFrameDetected=new Set,r.onPlaneAddedObservable=new S.c,r.onPlaneRemovedObservable=new S.c,r.onPlaneUpdatedObservable=new S.c,r.xrNativeFeatureName="plane-detection",r._xrSessionManager.session?r._init():r._xrSessionManager.onXRSessionInit.addOnce(function(){r._init()}),r}return Object(f.d)(t,i),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemovePlanesOnSessionEnded)for(;this._detectedPlanes.length;){var e=this._detectedPlanes.pop();e&&this.onPlaneRemovedObservable.notifyObservers(e)}return!0},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},t.prototype.isCompatible=function(){return typeof XRPlane!="undefined"},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&this._enabled&&e){var r=e.worldInformation.detectedPlanes;if(r){var o=this._detectedPlanes.filter(function(d){return!r.has(d.xrPlane)}).map(function(d){return n._detectedPlanes.indexOf(d)}),l=0;o.forEach(function(d){var v=n._detectedPlanes.splice(d-l,1)[0];n.onPlaneRemovedObservable.notifyObservers(v),l++}),r.forEach(function(d){if(n._lastFrameDetected.has(d)){if(d.lastChangedTime===n._xrSessionManager.currentTimestamp){var v=n.findIndexInPlaneArray(d);D=n._detectedPlanes[v],n._updatePlaneWithXRPlane(d,D,e),n.onPlaneUpdatedObservable.notifyObservers(D)}}else{var y={id:RN++,xrPlane:d,polygonDefinition:[]},D=n._updatePlaneWithXRPlane(d,y,e);n._detectedPlanes.push(D),n.onPlaneAddedObservable.notifyObservers(D)}}),this._lastFrameDetected=r}}},t.prototype._init=function(){var e,n,r=this,o=function(){r._enabled=!0,r._detectedPlanes.length&&(r._detectedPlanes.length=0)};this._xrSessionManager.session.updateWorldTrackingState?(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),o()):((n=(e=this._xrSessionManager.session.worldTrackingState)===null||e===void 0?void 0:e.planeDetectionState)===null||n===void 0?void 0:n.enabled)&&o()},t.prototype._updatePlaneWithXRPlane=function(e,n,r){var o=this;n.polygonDefinition=e.polygon.map(function(v){var y=o._xrSessionManager.scene.useRightHandedSystem?1:-1;return new h.e(v.x,v.y,v.z*y)});var l=r.getPose(e.planeSpace,this._xrSessionManager.referenceSpace);if(l){var d=n.transformationMatrix||new h.a;h.a.FromArrayToRef(l.transform.matrix,0,d),this._xrSessionManager.scene.useRightHandedSystem||d.toggleModelMatrixHandInPlace(),n.transformationMatrix=d,this._options.worldParentNode&&d.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),d)}return n},t.prototype.findIndexInPlaneArray=function(e){for(var n=0;n<this._detectedPlanes.length;++n)if(this._detectedPlanes[n].xrPlane===e)return n;return-1},t.Name=Ti.PLANE_DETECTION,t.Version=1,t}(Ei);li.AddWebXRFeature(Gh.Name,function(i,t){return function(){return new Gh(i,t)}},Gh.Version);var Hh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r.onBackgroundStateChangedObservable=new S.c,r}return Object(f.d)(t,i),t.prototype.attach=function(){return this._setBackgroundState(!1),i.prototype.attach.call(this)},t.prototype.detach=function(){return this._setBackgroundState(!0),i.prototype.detach.call(this)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},t.prototype._onXRFrame=function(e){},t.prototype._setBackgroundState=function(e){var n=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var r=n.getMeshByName("BackgroundSkybox");r&&r.setEnabled(e)}if(this.options.environmentHelperRemovalFlags.ground){var o=n.getMeshByName("BackgroundPlane");o&&o.setEnabled(e)}}else{var l=n.getMeshByName("BackgroundHelper");l&&l.setEnabled(e)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach(function(d){return d.setEnabled(e)}),this.onBackgroundStateChangedObservable.notifyObservers(e)},t.Name=Ti.BACKGROUND_REMOVER,t.Version=1,t}(Ei);li.AddWebXRFeature(Hh.Name,function(i,t){return function(){return new Hh(i,t)}},Hh.Version,!0);var ON=function(){},Wh=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId])if(r._xrSessionManager.scene.isPhysicsEnabled()||_.a.Warn("physics engine not enabled, skipped. Please add this controller manually."),r._options.physicsProperties.useControllerMesh&&o.inputSource.gamepad)o.onMotionControllerInitObservable.addOnce(function(w){w.onModelLoadedObservable.addOnce(function(){var F=new Ut.a(w.rootMesh,Ut.a.MeshImpostor,Object(f.a)({mass:0},r._options.physicsProperties)),z=o.grip||o.pointer;r._controllers[o.uniqueId]={xrController:o,impostor:F,oldPos:z.position.clone(),oldRotation:z.rotationQuaternion.clone()}})});else{var l=r._options.physicsProperties.impostorType||Ut.a.SphereImpostor,d=r._options.physicsProperties.impostorSize||.1,v=jr.a.CreateSphere("impostor-mesh-"+o.uniqueId,{diameterX:typeof d=="number"?d:d.width,diameterY:typeof d=="number"?d:d.height,diameterZ:typeof d=="number"?d:d.depth});v.isVisible=r._debugMode,v.isPickable=!1,v.rotationQuaternion=new h.b;var y=o.grip||o.pointer;v.position.copyFrom(y.position),v.rotationQuaternion.copyFrom(y.rotationQuaternion);var D=new Ut.a(v,l,Object(f.a)({mass:0},r._options.physicsProperties));r._controllers[o.uniqueId]={xrController:o,impostor:D,impostorMesh:v}}},r._controllers={},r._debugMode=!1,r._delta=0,r._lastTimestamp=0,r._tmpQuaternion=new h.b,r._tmpVector=new h.e,r._options.physicsProperties||(r._options.physicsProperties={}),r}return Object(f.d)(t,i),t.prototype._enablePhysicsDebug=function(){var e=this;this._debugMode=!0,Object.keys(this._controllers).forEach(function(n){var r=e._controllers[n];r.impostorMesh&&(r.impostorMesh.isVisible=!0)})},t.prototype.addController=function(e){this._attachController(e)},t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(o){e._detachController(o.uniqueId)}),this._options.enableHeadsetImpostor){var n=this._options.headsetImpostorParams||{impostorType:Ut.a.SphereImpostor,restitution:.8,impostorSize:.3},r=n.impostorSize||.3;this._headsetMesh=jr.a.CreateSphere("headset-mesh",{diameterX:typeof r=="number"?r:r.width,diameterY:typeof r=="number"?r:r.height,diameterZ:typeof r=="number"?r:r.depth}),this._headsetMesh.rotationQuaternion=new h.b,this._headsetMesh.isVisible=!1,this._headsetImpostor=new Ut.a(this._headsetMesh,n.impostorType,Object(f.a)({mass:0},n))}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._headsetMesh&&this._headsetMesh.dispose(),!0)},t.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},t.prototype.getImpostorForController=function(e){var n=typeof e=="string"?e:e.uniqueId;return this._controllers[n]?this._controllers[n].impostor:null},t.prototype.setPhysicsProperties=function(e){this._options.physicsProperties=Object(f.a)(Object(f.a)({},this._options.physicsProperties),e)},t.prototype._onXRFrame=function(e){var n=this;this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.position),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion)),Object.keys(this._controllers).forEach(function(r){var o=n._controllers[r],l=o.xrController.grip||o.xrController.pointer,d=o.oldPos||o.impostorMesh.position,v=o.oldRotation||o.impostorMesh.rotationQuaternion;if(l.position.subtractToRef(d,n._tmpVector),n._tmpVector.scaleInPlace(1e3/n._delta),o.impostor.setLinearVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,"linear"),!v.equalsWithEpsilon(l.rotationQuaternion)){v.conjugateInPlace().multiplyToRef(l.rotationQuaternion,n._tmpQuaternion);var y=Math.sqrt(n._tmpQuaternion.x*n._tmpQuaternion.x+n._tmpQuaternion.y*n._tmpQuaternion.y+n._tmpQuaternion.z*n._tmpQuaternion.z);if(n._tmpVector.set(n._tmpQuaternion.x,n._tmpQuaternion.y,n._tmpQuaternion.z),y<.001)n._tmpVector.scaleInPlace(2);else{var D=2*Math.atan2(y,n._tmpQuaternion.w);n._tmpVector.scaleInPlace(D/(y*(n._delta/1e3)))}o.impostor.setAngularVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,n._tmpQuaternion,"angular")}d.copyFrom(l.position),v.copyFrom(l.rotationQuaternion)})},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.impostorMesh&&n.impostorMesh.dispose(),delete this._controllers[e])},t.Name=Ti.PHYSICS_CONTROLLERS,t.Version=1,t}(Ei);li.AddWebXRFeature(Wh.Name,function(i,t){return function(){return new Wh(i,t)}},Wh.Version,!0);var Xh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._tmpMat=new h.a,r._tmpPos=new h.e,r._tmpQuat=new h.b,r.initHitTestSource=function(o){if(o){var l=new XRRay(r.options.offsetRay||{}),d={space:r.options.useReferenceSpace?o:r._xrSessionManager.viewerReferenceSpace,offsetRay:l};r.options.entityTypes&&(d.entityTypes=r.options.entityTypes),d.space?r._xrSessionManager.session.requestHitTestSource(d).then(function(v){r._xrHitTestSource&&r._xrHitTestSource.cancel(),r._xrHitTestSource=v}):et.b.Warn("waiting for viewer reference space to initialize")}},r.autoCloneTransformation=!1,r.onHitTestResultObservable=new S.c,r.paused=!1,r.xrNativeFeatureName="hit-test",et.b.Warn("Hit test is an experimental and unstable feature."),r}return Object(f.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this)||!this._xrSessionManager.session.requestHitTestSource)return!1;if(this.options.disablePermanentHitTest||(this._xrSessionManager.referenceSpace&&this.initHitTestSource(this._xrSessionManager.referenceSpace),this._xrSessionManager.onXRReferenceSpaceChanged.add(this.initHitTestSource)),this.options.enableTransientHitTest){var n=new XRRay(this.options.transientOffsetRay||{});this._xrSessionManager.session.requestHitTestSourceForTransientInput({profile:"generic-touchscreen",offsetRay:n,entityTypes:this.options.entityTypes}).then(function(r){e._transientXrHitTestSource=r})}return!0},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._xrHitTestSource&&(this._xrHitTestSource.cancel(),this._xrHitTestSource=null),this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(this.initHitTestSource),this._transientXrHitTestSource&&(this._transientXrHitTestSource.cancel(),this._transientXrHitTestSource=null),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&!this.paused){if(this._xrHitTestSource){var r=e.getHitTestResults(this._xrHitTestSource);this._processWebXRHitTestResult(r)}this._transientXrHitTestSource&&e.getHitTestResultsForTransientInput(this._transientXrHitTestSource).forEach(function(o){n._processWebXRHitTestResult(o.results,o.inputSource)})}},t.prototype._processWebXRHitTestResult=function(e,n){var r=this,o=[];e.forEach(function(l){var d=l.getPose(r._xrSessionManager.referenceSpace);if(d){var v=d.transform.position,y=d.transform.orientation;r._tmpPos.set(v.x,v.y,v.z),r._tmpQuat.set(y.x,y.y,y.z,y.w),h.a.FromFloat32ArrayToRefScaled(d.transform.matrix,0,1,r._tmpMat),r._xrSessionManager.scene.useRightHandedSystem||(r._tmpPos.z*=-1,r._tmpQuat.z*=-1,r._tmpQuat.w*=-1,r._tmpMat.toggleModelMatrixHandInPlace());var D={position:r.autoCloneTransformation?r._tmpPos.clone():r._tmpPos,rotationQuaternion:r.autoCloneTransformation?r._tmpQuat.clone():r._tmpQuat,transformationMatrix:r.autoCloneTransformation?r._tmpMat.clone():r._tmpMat,inputSource:n,isTransient:!!n,xrHitResult:l};o.push(D)}}),this.onHitTestResultObservable.notifyObservers(o)},t.Name=Ti.HIT_TEST,t.Version=2,t}(Ei);li.AddWebXRFeature(Xh.Name,function(i,t){return function(){return new Xh(i,t)}},Xh.Version,!1);var Yh=function(i){function t(e){var n=i.call(this,e)||this;return n._enabled=!1,n._featurePointCloud=[],n.onFeaturePointsAddedObservable=new S.c,n.onFeaturePointsUpdatedObservable=new S.c,n.xrNativeFeatureName="bjsfeature-points",n._xrSessionManager.session?n._init():n._xrSessionManager.onXRSessionInit.addOnce(function(){n._init()}),n}return Object(f.d)(t,i),Object.defineProperty(t.prototype,"featurePointCloud",{get:function(){return this._featurePointCloud},enumerable:!1,configurable:!0}),t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this.featurePointCloud.length=0,!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._featurePointCloud.length=0,this.onFeaturePointsUpdatedObservable.clear(),this.onFeaturePointsAddedObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&this._enabled&&e){var n=e.featurePointCloud;if(n&&n.length!==0){if(n.length%5!=0)throw new Error("Received malformed feature point cloud of length: "+n.length);for(var r=n.length/5,o=new Array,l=new Array,d=0;d<r;d++){var v=5*d,y=n[v+4];this._featurePointCloud[y]?o.push(y):(this._featurePointCloud[y]={position:new h.e,confidenceValue:0},l.push(y)),this._featurePointCloud[y].position.x=n[v],this._featurePointCloud[y].position.y=n[v+1],this._featurePointCloud[y].position.z=n[v+2],this._featurePointCloud[y].confidenceValue=n[v+3]}l.length>0&&this.onFeaturePointsAddedObservable.notifyObservers(l),o.length>0&&this.onFeaturePointsUpdatedObservable.notifyObservers(o)}}},t.prototype._init=function(){this._xrSessionManager.session.trySetFeaturePointCloudEnabled&&this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0)&&(this._enabled=!0)},t.Name=Ti.FEATURE_POINTS,t.Version=1,t}(Ei);li.AddWebXRFeature(Yh.Name,function(i){return function(){return new Yh(i)}},Yh.Version);var HE=function(){function i(t,e,n,r,o){this.xrController=t,this.trackedMeshes=e,this._handMesh=n,this._rigMapping=r,this._defaultHandMesh=!1,this._transformNodeMapping=[],this.handPartsDefinition=this.generateHandPartsDefinition(t.inputSource.hand),this._scene=e[0].getScene(),this._handMesh&&this._rigMapping?this._defaultHandMesh=!1:o||this._generateDefaultHandMesh(),this.xrController.motionController&&(this.xrController.motionController.rootMesh?this.xrController.motionController.rootMesh.setEnabled(!1):this.xrController.motionController.onModelLoadedObservable.add(function(l){l.rootMesh&&l.rootMesh.setEnabled(!1)})),this.xrController.onMotionControllerInitObservable.add(function(l){l.onModelLoadedObservable.add(function(d){d.rootMesh&&d.rootMesh.setEnabled(!1)}),l.rootMesh&&l.rootMesh.setEnabled(!1)})}return i.prototype.generateHandPartsDefinition=function(t){var e;return(e={}).wrist=[t.WRIST],e.thumb=[t.THUMB_METACARPAL,t.THUMB_PHALANX_PROXIMAL,t.THUMB_PHALANX_DISTAL,t.THUMB_PHALANX_TIP],e.index=[t.INDEX_METACARPAL,t.INDEX_PHALANX_PROXIMAL,t.INDEX_PHALANX_INTERMEDIATE,t.INDEX_PHALANX_DISTAL,t.INDEX_PHALANX_TIP],e.middle=[t.MIDDLE_METACARPAL,t.MIDDLE_PHALANX_PROXIMAL,t.MIDDLE_PHALANX_INTERMEDIATE,t.MIDDLE_PHALANX_DISTAL,t.MIDDLE_PHALANX_TIP],e.ring=[t.RING_METACARPAL,t.RING_PHALANX_PROXIMAL,t.RING_PHALANX_INTERMEDIATE,t.RING_PHALANX_DISTAL,t.RING_PHALANX_TIP],e.little=[t.LITTLE_METACARPAL,t.LITTLE_PHALANX_PROXIMAL,t.LITTLE_PHALANX_INTERMEDIATE,t.LITTLE_PHALANX_DISTAL,t.LITTLE_PHALANX_TIP],e},i.prototype.updateFromXRFrame=function(t,e,n){var r=this;n===void 0&&(n=2);var o=this.xrController.inputSource.hand;o&&this.trackedMeshes.forEach(function(l,d){var v=o[d];if(v){var y=t.getJointPose(v,e);if(!y||!y.transform)return;var D=y.transform.position,w=y.transform.orientation;l.position.set(D.x,D.y,D.z),l.rotationQuaternion.set(w.x,w.y,w.z,w.w);var F=(y.radius||.008)*n;l.scaling.set(F,F,F),r._handMesh&&r._rigMapping&&r._rigMapping[d]&&(r._transformNodeMapping[d]=r._transformNodeMapping[d]||r._scene.getTransformNodeByName(r._rigMapping[d]),r._transformNodeMapping[d]&&(r._transformNodeMapping[d].position.copyFrom(l.position),r._transformNodeMapping[d].rotationQuaternion.copyFrom(l.rotationQuaternion),l.isVisible=!1)),l.getScene().useRightHandedSystem||(l.position.z*=-1,l.rotationQuaternion.z*=-1,l.rotationQuaternion.w*=-1)}})},i.prototype.getHandPartMeshes=function(t){var e=this;return this.handPartsDefinition[t].map(function(n){return e.trackedMeshes[n]})},i.prototype.dispose=function(){this.trackedMeshes.forEach(function(t){return t.dispose()}),this._defaultHandMesh&&this._handMesh&&this._handMesh.dispose()},i.prototype._generateDefaultHandMesh=function(){return Object(f.b)(this,void 0,void 0,function(){var t,e,n,r,o,l,d,v;return Object(f.e)(this,function(y){switch(y.label){case 0:return y.trys.push([0,3,,4]),t=this.xrController.inputSource.handedness==="right"?"right":"left",e=(t==="right"?"r":"l")+"_hand_"+(this._scene.useRightHandedSystem?"r":"l")+"hs.glb",[4,an.ImportMeshAsync("","https://assets.babylonjs.com/meshes/HandMeshes/",e,this._scene)];case 1:return n=y.sent(),r={base:C.a.FromInts(116,63,203),fresnel:C.a.FromInts(149,102,229),fingerColor:C.a.FromInts(177,130,255),tipFresnel:C.a.FromInts(220,200,255)},[4,(o=new Ph("leftHandShader",this._scene,{emitComments:!1})).loadAsync("https://patrickryanms.github.io/BabylonJStextures/Demos/xrHandMesh/handsShader.json")];case 2:if(y.sent(),o.build(!1),o.needDepthPrePass=!0,o.transparencyMode=pn.a.MATERIAL_ALPHABLEND,o.alphaMode=He.a.ALPHA_COMBINE,(l={base:o.getBlockByName("baseColor"),fresnel:o.getBlockByName("fresnelColor"),fingerColor:o.getBlockByName("fingerColor"),tipFresnel:o.getBlockByName("tipFresnelColor")}).base.value=r.base,l.fresnel.value=r.fresnel,l.fingerColor.value=r.fingerColor,l.tipFresnel.value=r.tipFresnel,n.meshes[1].material=o,this._defaultHandMesh=!0,this._handMesh=n.meshes[0],this._rigMapping=["wrist_","thumb_metacarpal_","thumb_proxPhalanx_","thumb_distPhalanx_","thumb_tip_","index_metacarpal_","index_proxPhalanx_","index_intPhalanx_","index_distPhalanx_","index_tip_","middle_metacarpal_","middle_proxPhalanx_","middle_intPhalanx_","middle_distPhalanx_","middle_tip_","ring_metacarpal_","ring_proxPhalanx_","ring_intPhalanx_","ring_distPhalanx_","ring_tip_","little_metacarpal_","little_proxPhalanx_","little_intPhalanx_","little_distPhalanx_","little_tip_"].map(function(D){return D+(t==="right"?"R":"L")}),!(d=this._scene.getTransformNodeByName(this._rigMapping[0])))throw new Error("could not find the wrist node");return d.parent&&d.parent.rotate(Te.a.Y,Math.PI),[3,4];case 3:return v=y.sent(),et.b.Error("error loading hand mesh"),console.log(v),[3,4];case 4:return[2]}})})},i}(),Kh=function(i){function t(e,n){var r=i.call(this,e)||this;return r.options=n,r.onHandAddedObservable=new S.c,r.onHandRemovedObservable=new S.c,r._hands={},r._attachHand=function(o){var l,d,v,y,D,w,F,z,k,K;if(o.inputSource.hand&&!r._hands[o.uniqueId]){var ae=o.inputSource.hand,le=[],fe=((l=r.options.jointMeshes)===null||l===void 0?void 0:l.sourceMesh)||jr.a.CreateSphere("jointParent",{diameter:1});fe.isVisible=!!((d=r.options.jointMeshes)===null||d===void 0?void 0:d.keepOriginalVisible);for(var me=0;me<ae.length;++me){var be=fe.createInstance(o.uniqueId+"-handJoint-"+me);if((v=r.options.jointMeshes)===null||v===void 0?void 0:v.onHandJointMeshGenerated){var Ee=r.options.jointMeshes.onHandJointMeshGenerated(be,me,o.uniqueId);Ee&&Ee!==be&&(be.dispose(),be=Ee)}if(be.isPickable=!1,(y=r.options.jointMeshes)===null||y===void 0?void 0:y.enablePhysics){var xe=r.options.jointMeshes.physicsProps||{},Ae=xe.impostorType!==void 0?xe.impostorType:Ut.a.SphereImpostor;be.physicsImpostor=new Ut.a(be,Ae,Object(f.a)({mass:0},xe))}be.rotationQuaternion=new h.b,((D=r.options.jointMeshes)===null||D===void 0?void 0:D.invisible)&&(be.isVisible=!1),le.push(be)}var Ie=o.inputSource.handedness==="right"?"right":"left",Re=((w=r.options.jointMeshes)===null||w===void 0?void 0:w.handMeshes)&&((F=r.options.jointMeshes)===null||F===void 0?void 0:F.handMeshes[Ie]),Pe=((z=r.options.jointMeshes)===null||z===void 0?void 0:z.rigMapping)&&((k=r.options.jointMeshes)===null||k===void 0?void 0:k.rigMapping[Ie]),Ce=new HE(o,le,Re,Pe,(K=r.options.jointMeshes)===null||K===void 0?void 0:K.disableDefaultHandMesh);r._hands[o.uniqueId]={handObject:Ce,id:t._idCounter++},r.onHandAddedObservable.notifyObservers(Ce)}},r.xrNativeFeatureName="hand-tracking",r}return Object(f.d)(t,i),t.prototype.isCompatible=function(){return typeof XRHand!="undefined"},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,function(n){e._detachHand(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._hands).forEach(function(n){e._detachHand(n)}),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHandAddedObservable.clear()},t.prototype.getHandByControllerId=function(e){var n;return((n=this._hands[e])===null||n===void 0?void 0:n.handObject)||null},t.prototype.getHandByHandedness=function(e){var n=this,r=Object.keys(this._hands).map(function(o){return n._hands[o].handObject.xrController.inputSource.handedness}).indexOf(e);return r!==-1?this._hands[r].handObject:null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._hands).forEach(function(r){var o;n._hands[r].handObject.updateFromXRFrame(e,n._xrSessionManager.referenceSpace,(o=n.options.jointMeshes)===null||o===void 0?void 0:o.scaleFactor)})},t.prototype._detachHand=function(e){this._hands[e]&&(this.onHandRemovedObservable.notifyObservers(this._hands[e].handObject),this._hands[e].handObject.dispose())},t._idCounter=0,t.Name=Ti.HAND_TRACKING,t.Version=1,t}(Ei);li.AddWebXRFeature(Kh.Name,function(i,t){return function(){return new Kh(i,t)}},Kh.Version,!1);var WE=function(i){function t(e,n,r){var o=i.call(this,e,MN["left-right"],n,r)||this;return o._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},o.profileId="microsoft-mixed-reality",o}return Object(f.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:t.MODEL_BASE_URL+"default/"}},t.prototype._getModelLoadingConstraints=function(){var e=an.IsPluginForExtensionAvailable(".glb");return e||_.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.rootMesh&&(this.getComponentIds().forEach(function(r,o){if(!n.disableAnimation&&r&&n.rootMesh){var l=n._mapping.buttons[r],d=l.rootNodeName;if(!d)return void _.a.Log("Skipping unknown button at index: "+o+" with mapped name: "+r);var v=n._getChildByName(n.rootMesh,d);if(!v)return void _.a.Warn("Missing button mesh with name: "+d);if(l.valueMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.valueNodeName),l.pressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.pressedNodeName),l.unpressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.unpressedNodeName),l.valueMesh&&l.pressedMesh&&l.unpressedMesh){var y=n.getComponent(r);y&&y.onButtonStateChangedObservable.add(function(D){n._lerpTransform(l,D.value)},void 0,!0)}else _.a.Warn("Missing button submesh under mesh with name: "+d)}}),this.getComponentIds().forEach(function(r,o){var l=n.getComponent(r);l.isAxes()&&["x-axis","y-axis"].forEach(function(d){if(n.rootMesh){var v=n._mapping.axes[r][d],y=n._getChildByName(n.rootMesh,v.rootNodeName);y?(v.valueMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.valueNodeName),v.minMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.minNodeName),v.maxMesh=n._getImmediateChildByName(y,n._mapping.defaultAxis.maxNodeName),v.valueMesh&&v.minMesh&&v.maxMesh?l&&l.onAxisValueChangedObservable.add(function(D){var w=d==="x-axis"?D.x:D.y;n._lerpTransform(v,w,!0)},void 0,!0):_.a.Warn("Missing axis submesh under mesh with name: "+v.rootNodeName)):_.a.Warn("Missing axis mesh with name: "+v.rootNodeName)}})}))},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Fe.a(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t}(Ts);zr.RegisterController("windows-mixed-reality",function(i,t){return new WE(t,i.gamepad,i.handedness)});var MN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},l_=function(i){function t(e,n,r,o,l){l===void 0&&(l=!1);var d=i.call(this,e,IN[r],n,r)||this;return d._forceLegacyControllers=l,d.profileId="oculus-touch",d}return Object(f.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:this._isQuest()?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this,r=this._isQuest(),o=this.handedness==="right"?-1:1;this.getComponentIds().forEach(function(l){var d=l&&n.getComponent(l);d&&d.onButtonStateChangedObservable.add(function(v){if(n.rootMesh&&!n.disableAnimation)switch(l){case"xr-standard-trigger":return void(r||(n._modelRootNode.getChildren()[3].rotation.x=.2*-v.value,n._modelRootNode.getChildren()[3].position.y=.005*-v.value,n._modelRootNode.getChildren()[3].position.z=.005*-v.value));case"xr-standard-squeeze":return void(r||(n._modelRootNode.getChildren()[4].position.x=o*v.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[1].position.y=-.001:n._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[2].position.y=-.001:n._modelRootNode.getChildren()[2].position.y=0))}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Fe.a(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h.b.FromEulerAngles(0,Math.PI,0)),e.forEach(function(n){n.isPickable=!1}),this._isQuest()?this._modelRootNode=e[0]:(this._modelRootNode=e[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},t.prototype._updateModel=function(){},t.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t}(Ts);zr.RegisterController("oculus-touch",function(i,t){return new l_(t,i.gamepad,i.handedness)}),zr.RegisterController("oculus-touch-legacy",function(i,t){return new l_(t,i.gamepad,i.handedness,!0)});var IN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},XE=function(i){function t(e,n,r){var o=i.call(this,e,DN[r],n,r)||this;return o.profileId="htc-vive",o}return Object(f.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:t.MODEL_FILENAME,path:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=r&&n.getComponent(r);o&&o.onButtonStateChangedObservable.add(function(l){if(n.rootMesh&&!n.disableAnimation)switch(r){case"xr-standard-trigger":return void(n._modelRootNode.getChildren()[6].rotation.x=.15*-l.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Fe.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(n){n.isPickable=!1}),this._modelRootNode=e[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=h.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(Ts);zr.RegisterController("htc-vive",function(i,t){return new XE(t,i.gamepad,i.handedness)});var DN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}}},function(p,s,c){c.d(s,"a",function(){return g});var E=c(34),m=function(){function M(){this.children=[]}return M.prototype.isValid=function(O){return!0},M.prototype.process=function(O,N){var V="";if(this.line){var U=this.line,L=N.processor;L&&(L.lineProcessor&&(U=L.lineProcessor(U,N.isFragment)),L.attributeProcessor&&E.a.StartsWith(this.line,"attribute")?U=L.attributeProcessor(this.line):L.varyingProcessor&&E.a.StartsWith(this.line,"varying")?U=L.varyingProcessor(this.line,N.isFragment):(L.uniformProcessor||L.uniformBufferProcessor)&&E.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?L.uniformProcessor&&(U=L.uniformProcessor(this.line,N.isFragment)):L.uniformBufferProcessor&&(U=L.uniformBufferProcessor(this.line,N.isFragment),N.lookForClosingBracketForUniformBuffer=!0)),L.endOfUniformBufferProcessor&&N.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(N.lookForClosingBracketForUniformBuffer=!1,U=L.endOfUniformBufferProcessor(this.line,N.isFragment))),V+=U+`\r
`}return this.children.forEach(function(j){V+=j.process(O,N)}),this.additionalDefineKey&&(O[this.additionalDefineKey]=this.additionalDefineValue||"true"),V},M}(),S=function(){function M(){}return Object.defineProperty(M.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"lines",{set:function(O){this._lines=[];for(var N=0,V=O;N<V.length;N++){var U=V[N];if(U[0]!=="#")for(var L=U.split(";"),j=0;j<L.length;j++){var Y=L[j];(Y=Y.trim())&&this._lines.push(Y+(j!==L.length-1?";":""))}else this._lines.push(U)}},enumerable:!1,configurable:!0}),M}(),h=c(1),C=function(M){function O(){return M!==null&&M.apply(this,arguments)||this}return Object(h.d)(O,M),O.prototype.process=function(N,V){for(var U=0;U<this.children.length;U++){var L=this.children[U];if(L.isValid(N))return L.process(N,V)}return""},O}(m),R=function(M){function O(){return M!==null&&M.apply(this,arguments)||this}return Object(h.d)(O,M),O.prototype.isValid=function(N){return this.testExpression.isTrue(N)},O}(m),I=function(){function M(){}return M.prototype.isTrue=function(O){return!0},M.postfixToInfix=function(O){for(var N=[],V=0,U=O;V<U.length;V++){var L=U[V];if(M._OperatorPriority[L]===void 0)N.push(L);else{var j=N[N.length-1],Y=N[N.length-2];N.length-=2,N.push("("+Y+L+j+")")}}return N[N.length-1]},M.infixToPostfix=function(O){for(var N=[],V=-1,U=function(){(ie=ie.trim())!==""&&(N.push(ie),ie="")},L=function(ve){V<M._Stack.length-1&&(M._Stack[++V]=ve)},j=function(){return M._Stack[V]},Y=function(){return V===-1?"!!INVALID EXPRESSION!!":M._Stack[V--]},W=0,ie="";W<O.length;){var re=O.charAt(W),ye=W<O.length-1?O.substr(W,2):"";if(re==="(")ie="",L(re);else if(re===")"){for(U();V!==-1&&j()!=="(";)N.push(Y());Y()}else if(M._OperatorPriority[ye]>1){for(U();V!==-1&&M._OperatorPriority[j()]>=M._OperatorPriority[ye];)N.push(Y());L(ye),W++}else ie+=re;W++}for(U();V!==-1;)j()==="("?Y():N.push(Y());return N},M._OperatorPriority={")":0,"(":1,"||":2,"&&":3},M._Stack=["","","","","","","","","","","","","","","","","","","",""],M}(),b=function(M){function O(N,V){V===void 0&&(V=!1);var U=M.call(this)||this;return U.define=N,U.not=V,U}return Object(h.d)(O,M),O.prototype.isTrue=function(N){var V=N[this.define]!==void 0;return this.not&&(V=!V),V},O}(I),f=function(M){function O(){return M!==null&&M.apply(this,arguments)||this}return Object(h.d)(O,M),O.prototype.isTrue=function(N){return this.leftOperand.isTrue(N)||this.rightOperand.isTrue(N)},O}(I),x=function(M){function O(){return M!==null&&M.apply(this,arguments)||this}return Object(h.d)(O,M),O.prototype.isTrue=function(N){return this.leftOperand.isTrue(N)&&this.rightOperand.isTrue(N)},O}(I),P=function(M){function O(N,V,U){var L=M.call(this)||this;return L.define=N,L.operand=V,L.testValue=U,L}return Object(h.d)(O,M),O.prototype.isTrue=function(N){var V=N[this.define];V===void 0&&(V=this.define);var U=!1,L=parseInt(V),j=parseInt(this.testValue);switch(this.operand){case">":U=L>j;break;case"<":U=L<j;break;case"<=":U=L<=j;break;case">=":U=L>=j;break;case"==":U=L===j}return U},O}(I),A=c(21),T=/defined\s*?\((.+?)\)/g,_=/defined\s*?\[(.+?)\]/g,g=function(){function M(){}return M.Process=function(O,N,V,U){var L=this;this._ProcessIncludes(O,N,function(j){var Y=L._ProcessShaderConversion(j,N,U);V(Y)})},M._ProcessPrecision=function(O,N){var V=N.shouldUseHighPrecisionShader;return O.indexOf("precision highp float")===-1?O=V?`precision highp float;
`+O:`precision mediump float;
`+O:V||(O=O.replace("precision highp float","precision mediump float")),O},M._ExtractOperation=function(O){var N=/defined\((.+)\)/.exec(O);if(N&&N.length)return new b(N[1].trim(),O[0]==="!");for(var V="",U=0,L=0,j=["==",">=","<=","<",">"];L<j.length&&(V=j[L],!((U=O.indexOf(V))>-1));L++);if(U===-1)return new b(O);var Y=O.substring(0,U).trim(),W=O.substring(U+V.length).trim();return new P(Y,V,W)},M._BuildSubExpression=function(O){O=O.replace(T,"defined[$1]");for(var N=[],V=0,U=I.infixToPostfix(O);V<U.length;V++){var L=U[V];if(L!=="||"&&L!=="&&")N.push(L);else if(N.length>=2){var j=N[N.length-1],Y=N[N.length-2];N.length-=2;var W=L=="&&"?new x:new f;typeof j=="string"&&(j=j.replace(_,"defined($1)")),typeof Y=="string"&&(Y=Y.replace(_,"defined($1)")),W.leftOperand=typeof Y=="string"?this._ExtractOperation(Y):Y,W.rightOperand=typeof j=="string"?this._ExtractOperation(j):j,N.push(W)}}var ie=N[N.length-1];return typeof ie=="string"&&(ie=ie.replace(_,"defined($1)")),typeof ie=="string"?this._ExtractOperation(ie):ie},M._BuildExpression=function(O,N){var V=new R,U=O.substring(0,N),L=O.substring(N);return L=L.substring(0,(L.indexOf("//")+1||L.length+1)-1).trim(),V.testExpression=U==="#ifdef"?new b(L):U==="#ifndef"?new b(L,!0):this._BuildSubExpression(L),V},M._MoveCursorWithinIf=function(O,N,V){for(var U=O.currentLine;this._MoveCursor(O,V);){var L=(U=O.currentLine).substring(0,5).toLowerCase();if(L==="#else"){var j=new m;return N.children.push(j),void this._MoveCursor(O,j)}if(L==="#elif"){var Y=this._BuildExpression(U,5);N.children.push(Y),V=Y}}},M._MoveCursor=function(O,N){for(;O.canRead;){O.lineIndex++;var V=O.currentLine,U=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(V);if(U&&U.length)switch(U[0]){case"#ifdef":var L=new C;N.children.push(L);var j=this._BuildExpression(V,6);L.children.push(j),this._MoveCursorWithinIf(O,L,j);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":L=new C,N.children.push(L),j=this._BuildExpression(V,7),L.children.push(j),this._MoveCursorWithinIf(O,L,j);break;case"#if":L=new C,j=this._BuildExpression(V,3),N.children.push(L),L.children.push(j),this._MoveCursorWithinIf(O,L,j)}else{var Y=new m;if(Y.line=V,N.children.push(Y),V[0]==="#"&&V[1]==="d"){var W=V.replace(";","").split(" ");Y.additionalDefineKey=W[1],W.length===3&&(Y.additionalDefineValue=W[2])}}}return!1},M._EvaluatePreProcessors=function(O,N,V){var U=new m,L=new S;return L.lineIndex=-1,L.lines=O.split(`
`),this._MoveCursor(L,U),U.process(N,V)},M._PreparePreProcessors=function(O){for(var N={},V=0,U=O.defines;V<U.length;V++){var L=U[V].replace("#define","").replace(";","").trim().split(" ");N[L[0]]=L.length>1?L[1]:""}return N.GL_ES="true",N.__VERSION__=O.version,N[O.platformName]="true",N},M._ProcessShaderConversion=function(O,N,V){var U=this._ProcessPrecision(O,N);if(!N.processor)return U;if(U.indexOf("#version 3")!==-1)return U.replace("#version 300 es","");var L=N.defines,j=this._PreparePreProcessors(N);return N.processor.preProcessor&&(U=N.processor.preProcessor(U,L,N.isFragment)),U=this._EvaluatePreProcessors(U,j,N),N.processor.postProcessor&&(U=N.processor.postProcessor(U,L,N.isFragment,V)),U},M._ProcessIncludes=function(O,N,V){for(var U=this,L=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,j=L.exec(O),Y=new String(O),W=!1;j!=null;){var ie=j[1];if(ie.indexOf("__decl__")!==-1&&(ie=ie.replace(/__decl__/,""),N.supportsUniformBuffers&&(ie=(ie=ie.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),ie+="Declaration"),!N.includesShadersStore[ie]){var re=N.shadersRepository+"ShadersInclude/"+ie+".fx";return void M._FileToolsLoadFile(re,function(q){N.includesShadersStore[ie]=q,U._ProcessIncludes(Y,N,V)})}var ye=N.includesShadersStore[ie];if(j[2])for(var ve=j[3].split(","),ue=0;ue<ve.length;ue+=2){var oe=new RegExp(ve[ue],"g"),Z=ve[ue+1];ye=ye.replace(oe,Z)}if(j[4]){var J=j[5];if(J.indexOf("..")!==-1){var B=J.split(".."),G=parseInt(B[0]),$=parseInt(B[1]),he=ye.slice(0);ye="",isNaN($)&&($=N.indexParameters[B[1]]);for(var se=G;se<$;se++)N.supportsUniformBuffers||(he=he.replace(/light\{X\}.(\w*)/g,function(q,H){return H+"{X}"})),ye+=he.replace(/\{X\}/g,se.toString())+`
`}else N.supportsUniformBuffers||(ye=ye.replace(/light\{X\}.(\w*)/g,function(q,H){return H+"{X}"})),ye=ye.replace(/\{X\}/g,J)}Y=Y.replace(j[0],ye),W=W||ye.indexOf("#include<")>=0,j=L.exec(O)}W?this._ProcessIncludes(Y.toString(),N,V):V(Y)},M._FileToolsLoadFile=function(O,N,V,U,L,j){throw A.a.WarnImport("FileTools")},M}()},function(p,s,c){c(26).a.prototype._readTexturePixels=function(E,m,S,h,C,R){h===void 0&&(h=-1),C===void 0&&(C=0),R===void 0&&(R=null);var I=this._gl;if(!I)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var b=I.createFramebuffer();if(!b)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=b}I.bindFramebuffer(I.FRAMEBUFFER,this._dummyFramebuffer),h>-1?I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+h,E._webGLTexture,C):I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,E._webGLTexture,C);var f=E.type!==void 0?this._getWebGLTextureType(E.type):I.UNSIGNED_BYTE;switch(f){case I.UNSIGNED_BYTE:R||(R=new Uint8Array(4*m*S)),f=I.UNSIGNED_BYTE;break;default:R||(R=new Float32Array(4*m*S)),f=I.FLOAT}return I.readPixels(0,0,m,S,I.RGBA,f,R),I.bindFramebuffer(I.FRAMEBUFFER,this._currentFramebuffer),R}},function(p,s,c){var E="shadowsFragmentFunctions",m=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
#define inline
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;
}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
#define inline
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
#define inline
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#ifdef WEBGL2
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#ifdef WEBGL2
#define GREATEST_LESS_THAN_ONE 0.99999994

#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}





#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="reflectionFunction",m=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,1.));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="bumpFragmentMainFunctions",m=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="bumpFragmentFunctions",m=`#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(DETAIL)
#if DETAILDIRECTUV == 1
#define vDetailUV vMainUV1
#elif DETAILDIRECTUV == 2
#define vDetailUV vMainUV2
#else
varying vec2 vDetailUV;
#endif
uniform sampler2D detailSampler;
#endif
#if defined(BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vDetailUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);
vec2 detailNormalRG=detailColor.wy*2.0-1.0;
float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));
vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;

#if DETAIL_NORMALBLENDMETHOD == 0
detailNormal.xy*=vDetailInfos.z;
vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD == 1
detailNormal.xy*=vDetailInfos.z;
bumpNormal+=vec3(0.0,0.0,1.0);
detailNormal*=vec3(-1.0,-1.0,1.0);
vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;
normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif`;c(5).a.IncludesShadersStore.bumpFragment=E},function(p,s,c){var E="lightFragment",m=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;c(5).a.IncludesShadersStore.fogFragment=E},function(p,s,c){var E="fogVertexDeclaration",m=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="shadowsVertex",m=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.Eval=function(S,h){return(S=S.match(/\([^\(\)]*\)/g)?S.replace(/\([^\(\)]*\)/g,function(C){return C=C.slice(1,C.length-1),m._HandleParenthesisContent(C,h)}):m._HandleParenthesisContent(S,h))==="true"||S!=="false"&&m.Eval(S,h)},m._HandleParenthesisContent=function(S,h){var C;h=h||function(A){return A==="true"};var R=S.split("||");for(var I in R)if(R.hasOwnProperty(I)){var b=m._SimplifyNegation(R[I].trim()),f=b.split("&&");if(f.length>1)for(var x=0;x<f.length;++x){var P=m._SimplifyNegation(f[x].trim());if(!(C=P!=="true"&&P!=="false"?P[0]==="!"?!h(P.substring(1)):h(P):P==="true")){b="false";break}}if(C||b==="true"){C=!0;break}C=b!=="true"&&b!=="false"?b[0]==="!"?!h(b.substring(1)):h(b):b==="true"}return C?"true":"false"},m._SimplifyNegation=function(S){return(S=(S=S.replace(/^[\s!]+/,function(h){return(h=h.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())==="!true"?S="false":S==="!false"&&(S="true"),S},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.ExponentialBackoff=function(S,h){return S===void 0&&(S=3),h===void 0&&(h=500),function(C,R,I){return R.status!==0||I>=S||C.indexOf("file:")!==-1?-1:Math.pow(2,I)*h}},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"zOffset",{get:function(){return this._zOffset},set:function(S){this._zOffset!==S&&(this._zOffset=S,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cullFace",{get:function(){return this._cullFace},set:function(S){this._cullFace!==S&&(this._cullFace=S,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cull",{get:function(){return this._cull},set:function(S){this._cull!==S&&(this._cull=S,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(S){this._depthFunc!==S&&(this._depthFunc=S,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthMask",{get:function(){return this._depthMask},set:function(S){this._depthMask!==S&&(this._depthMask=S,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthTest",{get:function(){return this._depthTest},set:function(S){this._depthTest!==S&&(this._depthTest=S,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"frontFace",{get:function(){return this._frontFace},set:function(S){this._frontFace!==S&&(this._frontFace=S,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},m.prototype.apply=function(S){this.isDirty&&(this._isCullDirty&&(this.cull?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(S.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(S.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(S.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(S.enable(S.POLYGON_OFFSET_FILL),S.polygonOffset(this.zOffset,0)):S.disable(S.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(S.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},m}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(2),m=function(){function S(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(S.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(h){this._stencilFunc!==h&&(this._stencilFunc=h,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(h){this._stencilFuncRef!==h&&(this._stencilFuncRef=h,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(h){this._stencilFuncMask!==h&&(this._stencilFuncMask=h,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(h){this._stencilOpStencilFail!==h&&(this._stencilOpStencilFail=h,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(h){this._stencilOpDepthFail!==h&&(this._stencilOpDepthFail=h,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(h){this._stencilOpStencilDepthPass!==h&&(this._stencilOpStencilDepthPass=h,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(h){this._stencilMask!==h&&(this._stencilMask=h,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(h){this._stencilTest!==h&&(this._stencilTest=h,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),S.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=S.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=S.KEEP,this._stencilOpDepthFail=S.KEEP,this._stencilOpStencilDepthPass=S.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},S.prototype.apply=function(h){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(h.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(h.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(h.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},S.ALWAYS=E.a.ALWAYS,S.KEEP=E.a.KEEP,S.REPLACE=E.a.REPLACE,S}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(S){this._alphaBlend!==S&&(this._alphaBlend=S,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.setAlphaBlendConstants=function(S,h,C,R){this._blendConstants[0]===S&&this._blendConstants[1]===h&&this._blendConstants[2]===C&&this._blendConstants[3]===R||(this._blendConstants[0]=S,this._blendConstants[1]=h,this._blendConstants[2]=C,this._blendConstants[3]=R,this._isBlendConstantsDirty=!0)},m.prototype.setAlphaBlendFunctionParameters=function(S,h,C,R){this._blendFunctionParameters[0]===S&&this._blendFunctionParameters[1]===h&&this._blendFunctionParameters[2]===C&&this._blendFunctionParameters[3]===R||(this._blendFunctionParameters[0]=S,this._blendFunctionParameters[1]=h,this._blendFunctionParameters[2]=C,this._blendFunctionParameters[3]=R,this._isBlendFunctionParametersDirty=!0)},m.prototype.setAlphaEquationParameters=function(S,h){this._blendEquationParameters[0]===S&&this._blendEquationParameters[1]===h||(this._blendEquationParameters[0]=S,this._blendEquationParameters[1]=h,this._isBlendEquationParametersDirty=!0)},m.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},m.prototype.apply=function(S){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?S.enable(S.BLEND):S.disable(S.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(S.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(S.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(S.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},m}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(m.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),m.prototype._handlesSpectorRebuildCallback=function(S){S&&this.program&&S(this.program)},m.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},m.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},m}()},function(p,s,c){var E;c.d(s,"a",function(){return h}),function(C){C[C.Pending=0]="Pending",C[C.Fulfilled=1]="Fulfilled",C[C.Rejected=2]="Rejected"}(E||(E={}));var m=function(){this.count=0,this.target=0,this.results=[]},S=function(){function C(R){var I=this;if(this._state=E.Pending,this._children=new Array,this._rejectWasConsumed=!1,R)try{R(function(b){I._resolve(b)},function(b){I._reject(b)})}catch(b){this._reject(b)}}return Object.defineProperty(C.prototype,"_result",{get:function(){return this._resultValue},set:function(R){this._resultValue=R,this._parent&&this._parent._result===void 0&&(this._parent._result=R)},enumerable:!1,configurable:!0}),C.prototype.catch=function(R){return this.then(void 0,R)},C.prototype.then=function(R,I){var b=this,f=new C;return f._onFulfilled=R,f._onRejected=I,this._children.push(f),f._parent=this,this._state!==E.Pending&&setTimeout(function(){if(b._state===E.Fulfilled||b._rejectWasConsumed){var x=f._resolve(b._result);if(x!=null)if(x._state!==void 0){var P=x;f._children.push(P),P._parent=f,f=P}else f._result=x}else f._reject(b._reason)}),f},C.prototype._moveChildren=function(R){var I,b=this;if((I=this._children).push.apply(I,R.splice(0,R.length)),this._children.forEach(function(T){T._parent=b}),this._state===E.Fulfilled)for(var f=0,x=this._children;f<x.length;f++)x[f]._resolve(this._result);else if(this._state===E.Rejected)for(var P=0,A=this._children;P<A.length;P++)A[P]._reject(this._reason)},C.prototype._resolve=function(R){try{this._state=E.Fulfilled;var I=null;if(this._onFulfilled&&(I=this._onFulfilled(R)),I!=null)if(I._state!==void 0){var b=I;b._parent=this,b._moveChildren(this._children),R=b._result}else R=I;this._result=R;for(var f=0,x=this._children;f<x.length;f++)x[f]._resolve(R);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(P){this._reject(P,!0)}},C.prototype._reject=function(R,I){if(I===void 0&&(I=!1),this._state=E.Rejected,this._reason=R,this._onRejected&&!I)try{this._onRejected(R),this._rejectWasConsumed=!0}catch(P){R=P}for(var b=0,f=this._children;b<f.length;b++){var x=f[b];this._rejectWasConsumed?x._resolve(null):x._reject(R)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},C.resolve=function(R){var I=new C;return I._resolve(R),I},C._RegisterForFulfillment=function(R,I,b){R.then(function(f){return I.results[b]=f,I.count++,I.count===I.target&&I.rootPromise._resolve(I.results),null},function(f){I.rootPromise._state!==E.Rejected&&I.rootPromise._reject(f)})},C.all=function(R){var I=new C,b=new m;if(b.target=R.length,b.rootPromise=I,R.length)for(var f=0;f<R.length;f++)C._RegisterForFulfillment(R[f],b,f);else I._resolve([]);return I},C.race=function(R){var I=new C;if(R.length)for(var b=0,f=R;b<f.length;b++)f[b].then(function(x){return I&&(I._resolve(x),I=null),null},function(x){I&&(I._reject(x),I=null)});return I},C}(),h=function(){function C(){}return C.Apply=function(R){R===void 0&&(R=!1),(R||typeof Promise=="undefined")&&(window.Promise=S)},C}()},function(p,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return S});var E=c(57),m=function(){function h(C){C===void 0&&(C=30),this._enabled=!0,this._rollingFrameTime=new S(C)}return h.prototype.sampleFrame=function(C){if(C===void 0&&(C=E.a.Now),this._enabled){if(this._lastFrameTimeMs!=null){var R=C-this._lastFrameTimeMs;this._rollingFrameTime.add(R)}this._lastFrameTimeMs=C}},Object.defineProperty(h.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"instantaneousFPS",{get:function(){var C=this._rollingFrameTime.history(0);return C===0?0:1e3/C},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),h.prototype.enable=function(){this._enabled=!0},h.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(h.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),h.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},h}(),S=function(){function h(C){this._samples=new Array(C),this.reset()}return h.prototype.add=function(C){var R;if(this.isSaturated()){var I=this._samples[this._pos];R=I-this.average,this.average-=R/(this._sampleCount-1),this._m2-=R*(I-this.average)}else this._sampleCount++;R=C-this.average,this.average+=R/this._sampleCount,this._m2+=R*(C-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=C,this._pos++,this._pos%=this._samples.length},h.prototype.history=function(C){if(C>=this._sampleCount||C>=this._samples.length)return 0;var R=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(R-C)]},h.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},h.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},h.prototype._wrapPosition=function(C){var R=this._samples.length;return(C%R+R)%R},h}()},function(p,s,c){c.d(s,"a",function(){return m});var E=c(0),m=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new E.e(0,0,0),this._diffPositionForCollisions=new E.e(0,0,0),this._collisionResponse=!0}},function(p,s,c){c.d(s,"a",function(){return h});var E=c(33),m=c(0),S=c(2),h=function(){function C(R,I,b,f,x){b===void 0&&(b=null),f===void 0&&(f=null),x===void 0&&(x=null),this.index=R,this._opaqueSubMeshes=new E.a(256),this._transparentSubMeshes=new E.a(256),this._alphaTestSubMeshes=new E.a(256),this._depthOnlySubMeshes=new E.a(256),this._particleSystems=new E.a(256),this._spriteManagers=new E.a(256),this._edgesRenderers=new E.b(16),this._scene=I,this.opaqueSortCompareFn=b,this.alphaTestSortCompareFn=f,this.transparentSortCompareFn=x}return Object.defineProperty(C.prototype,"opaqueSortCompareFn",{set:function(R){this._opaqueSortCompareFn=R,this._renderOpaque=R?this.renderOpaqueSorted:C.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"alphaTestSortCompareFn",{set:function(R){this._alphaTestSortCompareFn=R,this._renderAlphaTest=R?this.renderAlphaTestSorted:C.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"transparentSortCompareFn",{set:function(R){this._transparentSortCompareFn=R||C.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),C.prototype.render=function(R,I,b,f){if(R)R(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var x=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(x.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),x.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var P=x.getStencilBuffer();if(x.setStencilBuffer(!1),I&&this._renderSprites(),b&&this._renderParticles(f),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(x.setStencilBuffer(P),this._renderTransparent(this._transparentSubMeshes),x.setAlphaMode(S.a.ALPHA_DISABLE)),x.setStencilBuffer(!1),this._edgesRenderers.length){for(var A=0;A<this._edgesRenderers.length;A++)this._edgesRenderers.data[A].render();x.setAlphaMode(S.a.ALPHA_DISABLE)}x.setStencilBuffer(P)}},C.prototype.renderOpaqueSorted=function(R){return C.renderSorted(R,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},C.prototype.renderAlphaTestSorted=function(R){return C.renderSorted(R,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},C.prototype.renderTransparentSorted=function(R){return C.renderSorted(R,this._transparentSortCompareFn,this._scene.activeCamera,!0)},C.renderSorted=function(R,I,b,f){for(var x,P=0,A=b?b.globalPosition:C._zeroVector;P<R.length;P++)(x=R.data[P])._alphaIndex=x.getMesh().alphaIndex,x._distanceToCamera=m.e.Distance(x.getBoundingInfo().boundingSphere.centerWorld,A);var T=R.data.slice(0,R.length);for(I&&T.sort(I),P=0;P<T.length;P++){if(x=T[P],f){var _=x.getMaterial();if(_&&_.needDepthPrePass){var g=_.getScene().getEngine();g.setColorWrite(!1),g.setAlphaMode(S.a.ALPHA_DISABLE),x.render(!1),g.setColorWrite(!0)}}x.render(f)}},C.renderUnsorted=function(R){for(var I=0;I<R.length;I++)R.data[I].render(!1)},C.defaultTransparentSortCompare=function(R,I){return R._alphaIndex>I._alphaIndex?1:R._alphaIndex<I._alphaIndex?-1:C.backToFrontSortCompare(R,I)},C.backToFrontSortCompare=function(R,I){return R._distanceToCamera<I._distanceToCamera?1:R._distanceToCamera>I._distanceToCamera?-1:0},C.frontToBackSortCompare=function(R,I){return R._distanceToCamera<I._distanceToCamera?-1:R._distanceToCamera>I._distanceToCamera?1:0},C.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},C.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},C.prototype.dispatch=function(R,I,b){I===void 0&&(I=R.getMesh()),b===void 0&&(b=R.getMaterial()),b!=null&&(b.needAlphaBlendingForMesh(I)?this._transparentSubMeshes.push(R):b.needAlphaTesting()?(b.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._alphaTestSubMeshes.push(R)):(b.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._opaqueSubMeshes.push(R)),I._renderingGroup=this,I._edgesRenderer&&I._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(I._edgesRenderer))},C.prototype.dispatchSprites=function(R){this._spriteManagers.push(R)},C.prototype.dispatchParticles=function(R){this._particleSystems.push(R)},C.prototype._renderParticles=function(R){if(this._particleSystems.length!==0){var I=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var b=0;b<this._particleSystems.length;b++){var f=this._particleSystems.data[b];if((I&&I.layerMask&f.layerMask)!==0){var x=f.emitter;x.position&&R&&R.indexOf(x)===-1||this._scene._activeParticles.addCount(f.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},C.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&this._spriteManagers.length!==0){var R=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var I=0;I<this._spriteManagers.length;I++){var b=this._spriteManagers.data[I];(R&&R.layerMask&b.layerMask)!==0&&b.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},C._zeroVector=m.e.Zero(),C}()},function(p,s,c){c.d(s,"a",function(){return E});var E=function(m,S){this.distance=m,this.mesh=S}},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return m.GenerateBase64StringFromTexture=function(S,h,C){h===void 0&&(h=0),C===void 0&&(C=0);var R=S.getInternalTexture();if(!R)return null;var I=S.readPixels(h,C);if(!I)return null;var b=S.getSize(),f=b.width,x=b.height;if(I instanceof Float32Array){for(var P=I.byteLength/I.BYTES_PER_ELEMENT,A=new Uint8Array(P);--P>=0;){var T=I[P];T<0?T=0:T>1&&(T=1),A[P]=255*T}I=A}var _=document.createElement("canvas");_.width=f,_.height=x;var g=_.getContext("2d");if(!g)return null;var M=g.createImageData(f,x);if(M.data.set(I),g.putImageData(M,0,0),R.invertY){var O=document.createElement("canvas");O.width=f,O.height=x;var N=O.getContext("2d");return N?(N.translate(0,x),N.scale(1,-1),N.drawImage(_,0,0),O.toDataURL("image/png")):null}return _.toDataURL("image/png")},m}()},function(p,s,c){c.d(s,"a",function(){return P});var E=c(1),m=c(0),S=c(8),h=c(31),C=c(7),R=c(41),I=c(46),b=c(4),f=c(43),x=c(12);C.a._instancedMeshFactory=function(A,T){var _=new P(A,T);if(T.instancedBuffers)for(var g in _.instancedBuffers={},T.instancedBuffers)_.instancedBuffers[g]=T.instancedBuffers[g];return _};var P=function(A){function T(_,g){var M=A.call(this,_,g.getScene())||this;M._indexInSourceMeshInstanceArray=-1,g.addInstance(M),M._sourceMesh=g,M._unIndexed=g._unIndexed,M.position.copyFrom(g.position),M.rotation.copyFrom(g.rotation),M.scaling.copyFrom(g.scaling),g.rotationQuaternion&&(M.rotationQuaternion=g.rotationQuaternion.clone()),M.animations=x.b.Slice(g.animations);for(var O=0,N=g.getAnimationRanges();O<N.length;O++){var V=N[O];V!=null&&M.createAnimationRange(V.name,V.from,V.to)}return M.infiniteDistance=g.infiniteDistance,M.setPivotMatrix(g.getPivotMatrix()),M.refreshBoundingInfo(),M._syncSubMeshes(),M}return Object(E.d)(T,A),T.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(T.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),T.prototype._resyncLightSources=function(){},T.prototype._resyncLightSource=function(_){},T.prototype._removeLightSource=function(_,g){},Object.defineProperty(T.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(_){this._sourceMesh&&_!==this._sourceMesh.renderingGroupId&&S.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),T.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},T.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(T.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),T.prototype.createInstance=function(_){return this._sourceMesh.createInstance(_)},T.prototype.isReady=function(_){return _===void 0&&(_=!1),this._sourceMesh.isReady(_,!0)},T.prototype.getVerticesData=function(_,g){return this._sourceMesh.getVerticesData(_,g)},T.prototype.setVerticesData=function(_,g,M,O){return this.sourceMesh&&this.sourceMesh.setVerticesData(_,g,M,O),this.sourceMesh},T.prototype.updateVerticesData=function(_,g,M,O){return this.sourceMesh&&this.sourceMesh.updateVerticesData(_,g,M,O),this.sourceMesh},T.prototype.setIndices=function(_,g){return g===void 0&&(g=null),this.sourceMesh&&this.sourceMesh.setIndices(_,g),this.sourceMesh},T.prototype.isVerticesDataPresent=function(_){return this._sourceMesh.isVerticesDataPresent(_)},T.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(T.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),T.prototype.refreshBoundingInfo=function(_){if(_===void 0&&(_=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var g=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(_),g),this},T.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},T.prototype._activate=function(_,g){if(this._sourceMesh.subMeshes||S.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,_),g){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},T.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},T.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==I.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var _=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,m.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),m.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(m.c.Vector3[7]),this._currentLOD._masterMesh=_,m.c.Matrix[0]}return A.prototype.getWorldMatrix.call(this)},Object.defineProperty(T.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),T.prototype.getLOD=function(_){if(!_)return this;var g=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(_,g.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},T.prototype._preActivateForIntermediateRendering=function(_){return this.sourceMesh._preActivateForIntermediateRendering(_)},T.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var _=0;_<this._sourceMesh.subMeshes.length;_++)this._sourceMesh.subMeshes[_].clone(this,this._sourceMesh);return this},T.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},T.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new f.a(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},T.prototype.clone=function(_,g,M){g===void 0&&(g=null);var O=this._sourceMesh.createInstance(_);if(R.a.DeepCopy(this,O,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances"],[]),this.refreshBoundingInfo(),g&&(O.parent=g),!M)for(var N=0;N<this.getScene().meshes.length;N++){var V=this.getScene().meshes[N];V.parent===this&&V.clone(V.name,O)}return O.computeWorldMatrix(!0),O},T.prototype.dispose=function(_,g){g===void 0&&(g=!1),this._sourceMesh.removeInstance(this),A.prototype.dispose.call(this,_,g)},T}(h.a);C.a.prototype.edgesShareWithInstances=!1,C.a.prototype.registerInstancedBuffer=function(A,T){if(this.removeVerticesData(A),!this.instancedBuffers){this.instancedBuffers={};for(var _=0,g=this.instances;_<g.length;_++)g[_].instancedBuffers={};this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[A]=null,this._userInstancedBuffersStorage.strides[A]=T,this._userInstancedBuffersStorage.sizes[A]=32*T,this._userInstancedBuffersStorage.data[A]=new Float32Array(this._userInstancedBuffersStorage.sizes[A]),this._userInstancedBuffersStorage.vertexBuffers[A]=new b.b(this.getEngine(),this._userInstancedBuffersStorage.data[A],A,!0,!1,T,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[A]);for(var M=0,O=this.instances;M<O.length;M++)O[M].instancedBuffers[A]=null},C.a.prototype._processInstancedBuffers=function(A,T){var _=A.length;for(var g in this.instancedBuffers){for(var M=this._userInstancedBuffersStorage.sizes[g],O=this._userInstancedBuffersStorage.strides[g],N=(_+1)*O;M<N;)M*=2;this._userInstancedBuffersStorage.data[g].length!=M&&(this._userInstancedBuffersStorage.data[g]=new Float32Array(M),this._userInstancedBuffersStorage.sizes[g]=M,this._userInstancedBuffersStorage.vertexBuffers[g]&&(this._userInstancedBuffersStorage.vertexBuffers[g].dispose(),this._userInstancedBuffersStorage.vertexBuffers[g]=null));var V=this._userInstancedBuffersStorage.data[g],U=0;T&&((j=this.instancedBuffers[g]).toArray?j.toArray(V,U):j.copyToArray(V,U),U+=O);for(var L=0;L<_;L++){var j;(j=A[L].instancedBuffers[g]).toArray?j.toArray(V,U):j.copyToArray(V,U),U+=O}this._userInstancedBuffersStorage.vertexBuffers[g]?this._userInstancedBuffersStorage.vertexBuffers[g].updateDirectly(V,0):(this._userInstancedBuffersStorage.vertexBuffers[g]=new b.b(this.getEngine(),this._userInstancedBuffersStorage.data[g],g,!0,!1,O,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[g]))}},C.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var A in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[A]&&this._userInstancedBuffersStorage.vertexBuffers[A].dispose();this.instancedBuffers={}}},function(p,s,c){c.d(s,"a",function(){return E});var E=function(){function m(){}return Object.defineProperty(m,"UniqueId",{get:function(){var S=this._UniqueIdCounter;return this._UniqueIdCounter++,S},enumerable:!1,configurable:!0}),m._UniqueIdCounter=0,m}()},function(p,s,c){var E=c(26),m=c(88);E.a.prototype.createUniformBuffer=function(S){var h=this._gl.createBuffer();if(!h)throw new Error("Unable to create uniform buffer");var C=new m.a(h);return this.bindUniformBuffer(C),S instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,S,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(S),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),C.references=1,C},E.a.prototype.createDynamicUniformBuffer=function(S){var h=this._gl.createBuffer();if(!h)throw new Error("Unable to create dynamic uniform buffer");var C=new m.a(h);return this.bindUniformBuffer(C),S instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,S,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(S),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),C.references=1,C},E.a.prototype.updateUniformBuffer=function(S,h,C,R){this.bindUniformBuffer(S),C===void 0&&(C=0),R===void 0?h instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,C,h):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,C,new Float32Array(h)):h instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,h.subarray(C,C+R)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(h).subarray(C,C+R)),this.bindUniformBuffer(null)},E.a.prototype.bindUniformBuffer=function(S){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,S?S.underlyingResource:null)},E.a.prototype.bindUniformBufferBase=function(S,h){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,h,S?S.underlyingResource:null)},E.a.prototype.bindUniformBlock=function(S,h,C){var R=S.program,I=this._gl.getUniformBlockIndex(R,h);this._gl.uniformBlockBinding(R,I,C)}},function(p,s,c){var E="lightsFragmentFunctions",m=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="logDepthFragment",m=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;c(5).a.IncludesShadersStore.bumpVertex=E},function(p,s,c){var E=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;c(5).a.IncludesShadersStore.fogVertex=E},function(p,s,c){var E="logDepthVertex",m=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s){var c;c=function(){return this}();try{c=c||new Function("return this")()}catch(E){typeof window=="object"&&(c=window)}p.exports=c},function(p,s,c){var E="prePassDeclaration",m=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
#ifdef WEBGL2
layout(location=0) out highp vec4 glFragData[{X}];
highp vec4 gl_FragColor;
#endif
#ifdef PREPASS_DEPTHNORMAL
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;
varying highp vec4 vPreviousPosition;
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="fresnelFunction",m=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;c(5).a.IncludesShadersStore.depthPrePass=E},function(p,s,c){var E="prePassVertexDeclaration",m=`#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="bumpVertexDeclaration",m=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E="prePassVertex",m=`#ifdef PREPASS_DEPTHNORMAL
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif`;c(5).a.IncludesShadersStore[E]=m},function(p,s,c){var E=c(5),m=(c(115),c(110),"colorPixelShader"),S=`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`;E.a.ShadersStore[m]=S},function(p,s,c){var E=c(5),m=(c(78),c(117),c(79),c(80),c(81),c(111),"colorVertexShader"),S=`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<clipPlaneVertexDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`;E.a.ShadersStore[m]=S},function(p,s,c){(function(E){c.d(s,"b",function(){return x}),c.d(s,"a",function(){return P});var m=c(1),S=c(8),h=c(13),C=c(102),R=c(27),I=c(2),b=c(89),f=c(74),x=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},P=function(A){function T(_){_===void 0&&(_=new x);var g=A.call(this,null)||this;h.a.Instances.push(g),_.deterministicLockstep===void 0&&(_.deterministicLockstep=!1),_.lockstepMaxSteps===void 0&&(_.lockstepMaxSteps=4),g._options=_,f.a.SetMatrixPrecision(!!_.useHighPrecisionMatrix),g._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1},S.a.Log("Babylon.js v"+h.a.Version+" - Null engine");var M=typeof self!="undefined"?self:E!==void 0?E:window;return typeof URL=="undefined"&&(M.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(M.Blob=function(){}),g}return Object(m.d)(T,A),T.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},T.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},T.prototype.getHardwareScalingLevel=function(){return 1},T.prototype.createVertexBuffer=function(_){var g=new b.a;return g.references=1,g},T.prototype.createIndexBuffer=function(_){var g=new b.a;return g.references=1,g},T.prototype.clear=function(_,g,M,O){},T.prototype.getRenderWidth=function(_){return _===void 0&&(_=!1),!_&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},T.prototype.getRenderHeight=function(_){return _===void 0&&(_=!1),!_&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},T.prototype.setViewport=function(_,g,M){this._cachedViewport=_},T.prototype.createShaderProgram=function(_,g,M,O,N){return{__SPECTOR_rebuildProgram:null}},T.prototype.getUniforms=function(_,g){return[]},T.prototype.getAttributes=function(_,g){return[]},T.prototype.bindSamplers=function(_){this._currentEffect=null},T.prototype.enableEffect=function(_){this._currentEffect=_,_.onBind&&_.onBind(_),_._onBindObservable&&_._onBindObservable.notifyObservers(_)},T.prototype.setState=function(_,g,M,O){},T.prototype.setIntArray=function(_,g){return!0},T.prototype.setIntArray2=function(_,g){return!0},T.prototype.setIntArray3=function(_,g){return!0},T.prototype.setIntArray4=function(_,g){return!0},T.prototype.setFloatArray=function(_,g){return!0},T.prototype.setFloatArray2=function(_,g){return!0},T.prototype.setFloatArray3=function(_,g){return!0},T.prototype.setFloatArray4=function(_,g){return!0},T.prototype.setArray=function(_,g){return!0},T.prototype.setArray2=function(_,g){return!0},T.prototype.setArray3=function(_,g){return!0},T.prototype.setArray4=function(_,g){return!0},T.prototype.setMatrices=function(_,g){return!0},T.prototype.setMatrix3x3=function(_,g){return!0},T.prototype.setMatrix2x2=function(_,g){return!0},T.prototype.setFloat=function(_,g){return!0},T.prototype.setFloat2=function(_,g,M){return!0},T.prototype.setFloat3=function(_,g,M,O){return!0},T.prototype.setBool=function(_,g){return!0},T.prototype.setFloat4=function(_,g,M,O,N){return!0},T.prototype.setAlphaMode=function(_,g){g===void 0&&(g=!1),this._alphaMode!==_&&(this.alphaState.alphaBlend=_!==I.a.ALPHA_DISABLE,g||this.setDepthWrite(_===I.a.ALPHA_DISABLE),this._alphaMode=_)},T.prototype.bindBuffers=function(_,g,M){},T.prototype.wipeCaches=function(_){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,_&&(this._currentProgram=null,this.stencilState.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},T.prototype.draw=function(_,g,M,O){},T.prototype.drawElementsType=function(_,g,M,O){},T.prototype.drawArraysType=function(_,g,M,O){},T.prototype._createTexture=function(){return{}},T.prototype._releaseTexture=function(_){},T.prototype.createTexture=function(_,g,M,O,N,V,U,L,j,Y,W,ie){N===void 0&&(N=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE),V===void 0&&(V=null),Y===void 0&&(Y=null);var re=new R.a(this,R.b.Url),ye=String(_);return re.url=ye,re.generateMipMaps=!g,re.samplingMode=N,re.invertY=M,re.baseWidth=this._options.textureSize,re.baseHeight=this._options.textureSize,re.width=this._options.textureSize,re.height=this._options.textureSize,Y&&(re.format=Y),re.isReady=!0,V&&V(),this._internalTexturesCache.push(re),re},T.prototype.createRenderTargetTexture=function(_,g){var M=new C.a;g!==void 0&&typeof g=="object"?(M.generateMipMaps=g.generateMipMaps,M.generateDepthBuffer=g.generateDepthBuffer===void 0||g.generateDepthBuffer,M.generateStencilBuffer=M.generateDepthBuffer&&g.generateStencilBuffer,M.type=g.type===void 0?I.a.TEXTURETYPE_UNSIGNED_INT:g.type,M.samplingMode=g.samplingMode===void 0?I.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.samplingMode):(M.generateMipMaps=g,M.generateDepthBuffer=!0,M.generateStencilBuffer=!1,M.type=I.a.TEXTURETYPE_UNSIGNED_INT,M.samplingMode=I.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var O=new R.a(this,R.b.RenderTarget),N=_.width||_,V=_.height||_;return O._depthStencilBuffer={},O._framebuffer={},O.baseWidth=N,O.baseHeight=V,O.width=N,O.height=V,O.isReady=!0,O.samples=1,O.generateMipMaps=!!M.generateMipMaps,O.samplingMode=M.samplingMode,O.type=M.type,O._generateDepthBuffer=M.generateDepthBuffer,O._generateStencilBuffer=!!M.generateStencilBuffer,this._internalTexturesCache.push(O),O},T.prototype.updateTextureSamplingMode=function(_,g){g.samplingMode=_},T.prototype.bindFramebuffer=function(_,g,M,O,N){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=_,this._currentFramebuffer=_._MSAAFramebuffer?_._MSAAFramebuffer:_._framebuffer,this._cachedViewport&&!N&&this.setViewport(this._cachedViewport,M,O)},T.prototype.unBindFramebuffer=function(_,g,M){this._currentRenderTarget=null,M&&(_._MSAAFramebuffer&&(this._currentFramebuffer=_._framebuffer),M()),this._currentFramebuffer=null},T.prototype.createDynamicVertexBuffer=function(_){var g=new b.a;return g.references=1,g.capacity=1,g},T.prototype.updateDynamicTexture=function(_,g,M,O,N){},T.prototype.areAllEffectsReady=function(){return!0},T.prototype.getError=function(){return 0},T.prototype._getUnpackAlignement=function(){return 1},T.prototype._unpackFlipY=function(_){},T.prototype.updateDynamicIndexBuffer=function(_,g,M){},T.prototype.updateDynamicVertexBuffer=function(_,g,M,O){},T.prototype._bindTextureDirectly=function(_,g){return this._boundTexturesCache[this._activeChannel]!==g&&(this._boundTexturesCache[this._activeChannel]=g,!0)},T.prototype._bindTexture=function(_,g){_<0||this._bindTextureDirectly(0,g)},T.prototype._deleteBuffer=function(_){},T.prototype.releaseEffects=function(){},T.prototype.displayLoadingUI=function(){},T.prototype.hideLoadingUI=function(){},T.prototype._uploadCompressedDataToTextureDirectly=function(_,g,M,O,N,V,U){},T.prototype._uploadDataToTextureDirectly=function(_,g,M,O){},T.prototype._uploadArrayBufferViewToTexture=function(_,g,M,O){},T.prototype._uploadImageToTexture=function(_,g,M,O){},T}(h.a)}).call(this,c(159))},function(p,s,c){c.r(s),function(E){c.d(s,"Debug",function(){return b});var m=c(127),S=c(99);c.d(s,"AbstractScene",function(){return m.AbstractScene}),c.d(s,"AbstractActionManager",function(){return m.AbstractActionManager}),c.d(s,"Action",function(){return m.Action}),c.d(s,"ActionEvent",function(){return m.ActionEvent}),c.d(s,"ActionManager",function(){return m.ActionManager}),c.d(s,"Condition",function(){return m.Condition}),c.d(s,"ValueCondition",function(){return m.ValueCondition}),c.d(s,"PredicateCondition",function(){return m.PredicateCondition}),c.d(s,"StateCondition",function(){return m.StateCondition}),c.d(s,"SwitchBooleanAction",function(){return m.SwitchBooleanAction}),c.d(s,"SetStateAction",function(){return m.SetStateAction}),c.d(s,"SetValueAction",function(){return m.SetValueAction}),c.d(s,"IncrementValueAction",function(){return m.IncrementValueAction}),c.d(s,"PlayAnimationAction",function(){return m.PlayAnimationAction}),c.d(s,"StopAnimationAction",function(){return m.StopAnimationAction}),c.d(s,"DoNothingAction",function(){return m.DoNothingAction}),c.d(s,"CombineAction",function(){return m.CombineAction}),c.d(s,"ExecuteCodeAction",function(){return m.ExecuteCodeAction}),c.d(s,"SetParentAction",function(){return m.SetParentAction}),c.d(s,"PlaySoundAction",function(){return m.PlaySoundAction}),c.d(s,"StopSoundAction",function(){return m.StopSoundAction}),c.d(s,"InterpolateValueAction",function(){return m.InterpolateValueAction}),c.d(s,"Animatable",function(){return m.Animatable}),c.d(s,"_IAnimationState",function(){return m._IAnimationState}),c.d(s,"Animation",function(){return m.Animation}),c.d(s,"TargetedAnimation",function(){return m.TargetedAnimation}),c.d(s,"AnimationGroup",function(){return m.AnimationGroup}),c.d(s,"AnimationPropertiesOverride",function(){return m.AnimationPropertiesOverride}),c.d(s,"EasingFunction",function(){return m.EasingFunction}),c.d(s,"CircleEase",function(){return m.CircleEase}),c.d(s,"BackEase",function(){return m.BackEase}),c.d(s,"BounceEase",function(){return m.BounceEase}),c.d(s,"CubicEase",function(){return m.CubicEase}),c.d(s,"ElasticEase",function(){return m.ElasticEase}),c.d(s,"ExponentialEase",function(){return m.ExponentialEase}),c.d(s,"PowerEase",function(){return m.PowerEase}),c.d(s,"QuadraticEase",function(){return m.QuadraticEase}),c.d(s,"QuarticEase",function(){return m.QuarticEase}),c.d(s,"QuinticEase",function(){return m.QuinticEase}),c.d(s,"SineEase",function(){return m.SineEase}),c.d(s,"BezierCurveEase",function(){return m.BezierCurveEase}),c.d(s,"RuntimeAnimation",function(){return m.RuntimeAnimation}),c.d(s,"AnimationEvent",function(){return m.AnimationEvent}),c.d(s,"AnimationKeyInterpolation",function(){return m.AnimationKeyInterpolation}),c.d(s,"AnimationRange",function(){return m.AnimationRange}),c.d(s,"KeepAssets",function(){return m.KeepAssets}),c.d(s,"InstantiatedEntries",function(){return m.InstantiatedEntries}),c.d(s,"AssetContainer",function(){return m.AssetContainer}),c.d(s,"Analyser",function(){return m.Analyser}),c.d(s,"AudioEngine",function(){return m.AudioEngine}),c.d(s,"AudioSceneComponent",function(){return m.AudioSceneComponent}),c.d(s,"Sound",function(){return m.Sound}),c.d(s,"SoundTrack",function(){return m.SoundTrack}),c.d(s,"WeightedSound",function(){return m.WeightedSound}),c.d(s,"AutoRotationBehavior",function(){return m.AutoRotationBehavior}),c.d(s,"BouncingBehavior",function(){return m.BouncingBehavior}),c.d(s,"FramingBehavior",function(){return m.FramingBehavior}),c.d(s,"AttachToBoxBehavior",function(){return m.AttachToBoxBehavior}),c.d(s,"FadeInOutBehavior",function(){return m.FadeInOutBehavior}),c.d(s,"MultiPointerScaleBehavior",function(){return m.MultiPointerScaleBehavior}),c.d(s,"PointerDragBehavior",function(){return m.PointerDragBehavior}),c.d(s,"SixDofDragBehavior",function(){return m.SixDofDragBehavior}),c.d(s,"Bone",function(){return m.Bone}),c.d(s,"BoneIKController",function(){return m.BoneIKController}),c.d(s,"BoneLookController",function(){return m.BoneLookController}),c.d(s,"Skeleton",function(){return m.Skeleton}),c.d(s,"ArcRotateCameraGamepadInput",function(){return m.ArcRotateCameraGamepadInput}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return m.ArcRotateCameraKeyboardMoveInput}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return m.ArcRotateCameraMouseWheelInput}),c.d(s,"ArcRotateCameraPointersInput",function(){return m.ArcRotateCameraPointersInput}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return m.ArcRotateCameraVRDeviceOrientationInput}),c.d(s,"FlyCameraKeyboardInput",function(){return m.FlyCameraKeyboardInput}),c.d(s,"FlyCameraMouseInput",function(){return m.FlyCameraMouseInput}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return m.FollowCameraKeyboardMoveInput}),c.d(s,"FollowCameraMouseWheelInput",function(){return m.FollowCameraMouseWheelInput}),c.d(s,"FollowCameraPointersInput",function(){return m.FollowCameraPointersInput}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return m.FreeCameraDeviceOrientationInput}),c.d(s,"FreeCameraGamepadInput",function(){return m.FreeCameraGamepadInput}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return m.FreeCameraKeyboardMoveInput}),c.d(s,"FreeCameraMouseInput",function(){return m.FreeCameraMouseInput}),c.d(s,"FreeCameraMouseWheelInput",function(){return m.FreeCameraMouseWheelInput}),c.d(s,"FreeCameraTouchInput",function(){return m.FreeCameraTouchInput}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return m.FreeCameraVirtualJoystickInput}),c.d(s,"CameraInputTypes",function(){return m.CameraInputTypes}),c.d(s,"CameraInputsManager",function(){return m.CameraInputsManager}),c.d(s,"Camera",function(){return m.Camera}),c.d(s,"TargetCamera",function(){return m.TargetCamera}),c.d(s,"FreeCamera",function(){return m.FreeCamera}),c.d(s,"FreeCameraInputsManager",function(){return m.FreeCameraInputsManager}),c.d(s,"TouchCamera",function(){return m.TouchCamera}),c.d(s,"ArcRotateCamera",function(){return m.ArcRotateCamera}),c.d(s,"ArcRotateCameraInputsManager",function(){return m.ArcRotateCameraInputsManager}),c.d(s,"DeviceOrientationCamera",function(){return m.DeviceOrientationCamera}),c.d(s,"FlyCamera",function(){return m.FlyCamera}),c.d(s,"FlyCameraInputsManager",function(){return m.FlyCameraInputsManager}),c.d(s,"FollowCamera",function(){return m.FollowCamera}),c.d(s,"ArcFollowCamera",function(){return m.ArcFollowCamera}),c.d(s,"FollowCameraInputsManager",function(){return m.FollowCameraInputsManager}),c.d(s,"GamepadCamera",function(){return m.GamepadCamera}),c.d(s,"AnaglyphArcRotateCamera",function(){return m.AnaglyphArcRotateCamera}),c.d(s,"AnaglyphFreeCamera",function(){return m.AnaglyphFreeCamera}),c.d(s,"AnaglyphGamepadCamera",function(){return m.AnaglyphGamepadCamera}),c.d(s,"AnaglyphUniversalCamera",function(){return m.AnaglyphUniversalCamera}),c.d(s,"StereoscopicArcRotateCamera",function(){return m.StereoscopicArcRotateCamera}),c.d(s,"StereoscopicFreeCamera",function(){return m.StereoscopicFreeCamera}),c.d(s,"StereoscopicGamepadCamera",function(){return m.StereoscopicGamepadCamera}),c.d(s,"StereoscopicUniversalCamera",function(){return m.StereoscopicUniversalCamera}),c.d(s,"UniversalCamera",function(){return m.UniversalCamera}),c.d(s,"VirtualJoysticksCamera",function(){return m.VirtualJoysticksCamera}),c.d(s,"VRCameraMetrics",function(){return m.VRCameraMetrics}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return m.VRDeviceOrientationArcRotateCamera}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return m.VRDeviceOrientationFreeCamera}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return m.VRDeviceOrientationGamepadCamera}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return m.OnAfterEnteringVRObservableEvent}),c.d(s,"VRExperienceHelper",function(){return m.VRExperienceHelper}),c.d(s,"WebVRFreeCamera",function(){return m.WebVRFreeCamera}),c.d(s,"Collider",function(){return m.Collider}),c.d(s,"DefaultCollisionCoordinator",function(){return m.DefaultCollisionCoordinator}),c.d(s,"PickingInfo",function(){return m.PickingInfo}),c.d(s,"IntersectionInfo",function(){return m.IntersectionInfo}),c.d(s,"_MeshCollisionData",function(){return m._MeshCollisionData}),c.d(s,"BoundingBox",function(){return m.BoundingBox}),c.d(s,"BoundingInfo",function(){return m.BoundingInfo}),c.d(s,"BoundingSphere",function(){return m.BoundingSphere}),c.d(s,"Octree",function(){return m.Octree}),c.d(s,"OctreeBlock",function(){return m.OctreeBlock}),c.d(s,"OctreeSceneComponent",function(){return m.OctreeSceneComponent}),c.d(s,"Ray",function(){return m.Ray}),c.d(s,"AxesViewer",function(){return m.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return m.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return m.DebugLayerTab}),c.d(s,"DebugLayer",function(){return m.DebugLayer}),c.d(s,"PhysicsViewer",function(){return m.PhysicsViewer}),c.d(s,"RayHelper",function(){return m.RayHelper}),c.d(s,"SkeletonViewer",function(){return m.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return m.DeviceInputSystem}),c.d(s,"DeviceType",function(){return m.DeviceType}),c.d(s,"PointerInput",function(){return m.PointerInput}),c.d(s,"DualShockInput",function(){return m.DualShockInput}),c.d(s,"XboxInput",function(){return m.XboxInput}),c.d(s,"SwitchInput",function(){return m.SwitchInput}),c.d(s,"DeviceSource",function(){return m.DeviceSource}),c.d(s,"DeviceSourceManager",function(){return m.DeviceSourceManager}),c.d(s,"Constants",function(){return m.Constants}),c.d(s,"ThinEngine",function(){return m.ThinEngine}),c.d(s,"Engine",function(){return m.Engine}),c.d(s,"EngineStore",function(){return m.EngineStore}),c.d(s,"NullEngineOptions",function(){return m.NullEngineOptions}),c.d(s,"NullEngine",function(){return m.NullEngine}),c.d(s,"_OcclusionDataStorage",function(){return m._OcclusionDataStorage}),c.d(s,"_forceTransformFeedbackToBundle",function(){return m._forceTransformFeedbackToBundle}),c.d(s,"EngineView",function(){return m.EngineView}),c.d(s,"WebGLPipelineContext",function(){return m.WebGLPipelineContext}),c.d(s,"WebGL2ShaderProcessor",function(){return m.WebGL2ShaderProcessor}),c.d(s,"NativeEngine",function(){return m.NativeEngine}),c.d(s,"ShaderCodeInliner",function(){return m.ShaderCodeInliner}),c.d(s,"PerformanceConfigurator",function(){return m.PerformanceConfigurator}),c.d(s,"KeyboardEventTypes",function(){return m.KeyboardEventTypes}),c.d(s,"KeyboardInfo",function(){return m.KeyboardInfo}),c.d(s,"KeyboardInfoPre",function(){return m.KeyboardInfoPre}),c.d(s,"PointerEventTypes",function(){return m.PointerEventTypes}),c.d(s,"PointerInfoBase",function(){return m.PointerInfoBase}),c.d(s,"PointerInfoPre",function(){return m.PointerInfoPre}),c.d(s,"PointerInfo",function(){return m.PointerInfo}),c.d(s,"ClipboardEventTypes",function(){return m.ClipboardEventTypes}),c.d(s,"ClipboardInfo",function(){return m.ClipboardInfo}),c.d(s,"DaydreamController",function(){return m.DaydreamController}),c.d(s,"GearVRController",function(){return m.GearVRController}),c.d(s,"GenericController",function(){return m.GenericController}),c.d(s,"OculusTouchController",function(){return m.OculusTouchController}),c.d(s,"PoseEnabledControllerType",function(){return m.PoseEnabledControllerType}),c.d(s,"PoseEnabledControllerHelper",function(){return m.PoseEnabledControllerHelper}),c.d(s,"PoseEnabledController",function(){return m.PoseEnabledController}),c.d(s,"ViveController",function(){return m.ViveController}),c.d(s,"WebVRController",function(){return m.WebVRController}),c.d(s,"WindowsMotionController",function(){return m.WindowsMotionController}),c.d(s,"XRWindowsMotionController",function(){return m.XRWindowsMotionController}),c.d(s,"StickValues",function(){return m.StickValues}),c.d(s,"Gamepad",function(){return m.Gamepad}),c.d(s,"GenericPad",function(){return m.GenericPad}),c.d(s,"GamepadManager",function(){return m.GamepadManager}),c.d(s,"GamepadSystemSceneComponent",function(){return m.GamepadSystemSceneComponent}),c.d(s,"Xbox360Button",function(){return m.Xbox360Button}),c.d(s,"Xbox360Dpad",function(){return m.Xbox360Dpad}),c.d(s,"Xbox360Pad",function(){return m.Xbox360Pad}),c.d(s,"DualShockButton",function(){return m.DualShockButton}),c.d(s,"DualShockDpad",function(){return m.DualShockDpad}),c.d(s,"DualShockPad",function(){return m.DualShockPad}),c.d(s,"AxisDragGizmo",function(){return m.AxisDragGizmo}),c.d(s,"AxisScaleGizmo",function(){return m.AxisScaleGizmo}),c.d(s,"BoundingBoxGizmo",function(){return m.BoundingBoxGizmo}),c.d(s,"Gizmo",function(){return m.Gizmo}),c.d(s,"GizmoManager",function(){return m.GizmoManager}),c.d(s,"PlaneRotationGizmo",function(){return m.PlaneRotationGizmo}),c.d(s,"PositionGizmo",function(){return m.PositionGizmo}),c.d(s,"RotationGizmo",function(){return m.RotationGizmo}),c.d(s,"ScaleGizmo",function(){return m.ScaleGizmo}),c.d(s,"LightGizmo",function(){return m.LightGizmo}),c.d(s,"CameraGizmo",function(){return m.CameraGizmo}),c.d(s,"PlaneDragGizmo",function(){return m.PlaneDragGizmo}),c.d(s,"EnvironmentHelper",function(){return m.EnvironmentHelper}),c.d(s,"PhotoDome",function(){return m.PhotoDome}),c.d(s,"_forceSceneHelpersToBundle",function(){return m._forceSceneHelpersToBundle}),c.d(s,"VideoDome",function(){return m.VideoDome}),c.d(s,"EngineInstrumentation",function(){return m.EngineInstrumentation}),c.d(s,"SceneInstrumentation",function(){return m.SceneInstrumentation}),c.d(s,"_TimeToken",function(){return m._TimeToken}),c.d(s,"EffectLayer",function(){return m.EffectLayer}),c.d(s,"EffectLayerSceneComponent",function(){return m.EffectLayerSceneComponent}),c.d(s,"GlowLayer",function(){return m.GlowLayer}),c.d(s,"HighlightLayer",function(){return m.HighlightLayer}),c.d(s,"Layer",function(){return m.Layer}),c.d(s,"LayerSceneComponent",function(){return m.LayerSceneComponent}),c.d(s,"LensFlare",function(){return m.LensFlare}),c.d(s,"LensFlareSystem",function(){return m.LensFlareSystem}),c.d(s,"LensFlareSystemSceneComponent",function(){return m.LensFlareSystemSceneComponent}),c.d(s,"Light",function(){return m.Light}),c.d(s,"ShadowLight",function(){return m.ShadowLight}),c.d(s,"ShadowGenerator",function(){return m.ShadowGenerator}),c.d(s,"CascadedShadowGenerator",function(){return m.CascadedShadowGenerator}),c.d(s,"ShadowGeneratorSceneComponent",function(){return m.ShadowGeneratorSceneComponent}),c.d(s,"DirectionalLight",function(){return m.DirectionalLight}),c.d(s,"HemisphericLight",function(){return m.HemisphericLight}),c.d(s,"PointLight",function(){return m.PointLight}),c.d(s,"SpotLight",function(){return m.SpotLight}),c.d(s,"DefaultLoadingScreen",function(){return m.DefaultLoadingScreen}),c.d(s,"_BabylonLoaderRegistered",function(){return m._BabylonLoaderRegistered}),c.d(s,"BabylonFileLoaderConfiguration",function(){return m.BabylonFileLoaderConfiguration}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return m.SceneLoaderAnimationGroupLoadingMode}),c.d(s,"SceneLoader",function(){return m.SceneLoader}),c.d(s,"SceneLoaderFlags",function(){return m.SceneLoaderFlags}),c.d(s,"BackgroundMaterial",function(){return m.BackgroundMaterial}),c.d(s,"ColorCurves",function(){return m.ColorCurves}),c.d(s,"EffectFallbacks",function(){return m.EffectFallbacks}),c.d(s,"Effect",function(){return m.Effect}),c.d(s,"FresnelParameters",function(){return m.FresnelParameters}),c.d(s,"ImageProcessingConfigurationDefines",function(){return m.ImageProcessingConfigurationDefines}),c.d(s,"ImageProcessingConfiguration",function(){return m.ImageProcessingConfiguration}),c.d(s,"Material",function(){return m.Material}),c.d(s,"MaterialDefines",function(){return m.MaterialDefines}),c.d(s,"ThinMaterialHelper",function(){return m.ThinMaterialHelper}),c.d(s,"MaterialHelper",function(){return m.MaterialHelper}),c.d(s,"MultiMaterial",function(){return m.MultiMaterial}),c.d(s,"PBRMaterialDefines",function(){return m.PBRMaterialDefines}),c.d(s,"PBRBaseMaterial",function(){return m.PBRBaseMaterial}),c.d(s,"PBRBaseSimpleMaterial",function(){return m.PBRBaseSimpleMaterial}),c.d(s,"PBRMaterial",function(){return m.PBRMaterial}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return m.PBRMetallicRoughnessMaterial}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return m.PBRSpecularGlossinessMaterial}),c.d(s,"PushMaterial",function(){return m.PushMaterial}),c.d(s,"ShaderMaterial",function(){return m.ShaderMaterial}),c.d(s,"StandardMaterialDefines",function(){return m.StandardMaterialDefines}),c.d(s,"StandardMaterial",function(){return m.StandardMaterial}),c.d(s,"BaseTexture",function(){return m.BaseTexture}),c.d(s,"ColorGradingTexture",function(){return m.ColorGradingTexture}),c.d(s,"CubeTexture",function(){return m.CubeTexture}),c.d(s,"DynamicTexture",function(){return m.DynamicTexture}),c.d(s,"EquiRectangularCubeTexture",function(){return m.EquiRectangularCubeTexture}),c.d(s,"HDRFiltering",function(){return m.HDRFiltering}),c.d(s,"HDRCubeTexture",function(){return m.HDRCubeTexture}),c.d(s,"HtmlElementTexture",function(){return m.HtmlElementTexture}),c.d(s,"InternalTextureSource",function(){return m.InternalTextureSource}),c.d(s,"InternalTexture",function(){return m.InternalTexture}),c.d(s,"_DDSTextureLoader",function(){return m._DDSTextureLoader}),c.d(s,"_ENVTextureLoader",function(){return m._ENVTextureLoader}),c.d(s,"_KTXTextureLoader",function(){return m._KTXTextureLoader}),c.d(s,"_TGATextureLoader",function(){return m._TGATextureLoader}),c.d(s,"_BasisTextureLoader",function(){return m._BasisTextureLoader}),c.d(s,"MirrorTexture",function(){return m.MirrorTexture}),c.d(s,"MultiRenderTarget",function(){return m.MultiRenderTarget}),c.d(s,"TexturePacker",function(){return m.TexturePacker}),c.d(s,"TexturePackerFrame",function(){return m.TexturePackerFrame}),c.d(s,"CustomProceduralTexture",function(){return m.CustomProceduralTexture}),c.d(s,"NoiseProceduralTexture",function(){return m.NoiseProceduralTexture}),c.d(s,"ProceduralTexture",function(){return m.ProceduralTexture}),c.d(s,"ProceduralTextureSceneComponent",function(){return m.ProceduralTextureSceneComponent}),c.d(s,"RawCubeTexture",function(){return m.RawCubeTexture}),c.d(s,"RawTexture",function(){return m.RawTexture}),c.d(s,"RawTexture2DArray",function(){return m.RawTexture2DArray}),c.d(s,"RawTexture3D",function(){return m.RawTexture3D}),c.d(s,"RefractionTexture",function(){return m.RefractionTexture}),c.d(s,"RenderTargetTexture",function(){return m.RenderTargetTexture}),c.d(s,"Texture",function(){return m.Texture}),c.d(s,"VideoTexture",function(){return m.VideoTexture}),c.d(s,"UniformBuffer",function(){return m.UniformBuffer}),c.d(s,"MaterialFlags",function(){return m.MaterialFlags}),c.d(s,"NodeMaterialBlockTargets",function(){return m.NodeMaterialBlockTargets}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return m.NodeMaterialBlockConnectionPointTypes}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return m.NodeMaterialBlockConnectionPointMode}),c.d(s,"NodeMaterialSystemValues",function(){return m.NodeMaterialSystemValues}),c.d(s,"NodeMaterialModes",function(){return m.NodeMaterialModes}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return m.NodeMaterialConnectionPointCompatibilityStates}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return m.NodeMaterialConnectionPointDirection}),c.d(s,"NodeMaterialConnectionPoint",function(){return m.NodeMaterialConnectionPoint}),c.d(s,"NodeMaterialBlock",function(){return m.NodeMaterialBlock}),c.d(s,"NodeMaterialDefines",function(){return m.NodeMaterialDefines}),c.d(s,"NodeMaterial",function(){return m.NodeMaterial}),c.d(s,"VertexOutputBlock",function(){return m.VertexOutputBlock}),c.d(s,"BonesBlock",function(){return m.BonesBlock}),c.d(s,"InstancesBlock",function(){return m.InstancesBlock}),c.d(s,"MorphTargetsBlock",function(){return m.MorphTargetsBlock}),c.d(s,"LightInformationBlock",function(){return m.LightInformationBlock}),c.d(s,"FragmentOutputBlock",function(){return m.FragmentOutputBlock}),c.d(s,"ImageProcessingBlock",function(){return m.ImageProcessingBlock}),c.d(s,"PerturbNormalBlock",function(){return m.PerturbNormalBlock}),c.d(s,"DiscardBlock",function(){return m.DiscardBlock}),c.d(s,"FrontFacingBlock",function(){return m.FrontFacingBlock}),c.d(s,"DerivativeBlock",function(){return m.DerivativeBlock}),c.d(s,"FragCoordBlock",function(){return m.FragCoordBlock}),c.d(s,"ScreenSizeBlock",function(){return m.ScreenSizeBlock}),c.d(s,"FogBlock",function(){return m.FogBlock}),c.d(s,"LightBlock",function(){return m.LightBlock}),c.d(s,"TextureBlock",function(){return m.TextureBlock}),c.d(s,"ReflectionTextureBlock",function(){return m.ReflectionTextureBlock}),c.d(s,"CurrentScreenBlock",function(){return m.CurrentScreenBlock}),c.d(s,"InputBlock",function(){return m.InputBlock}),c.d(s,"AnimatedInputBlockTypes",function(){return m.AnimatedInputBlockTypes}),c.d(s,"MultiplyBlock",function(){return m.MultiplyBlock}),c.d(s,"AddBlock",function(){return m.AddBlock}),c.d(s,"ScaleBlock",function(){return m.ScaleBlock}),c.d(s,"ClampBlock",function(){return m.ClampBlock}),c.d(s,"CrossBlock",function(){return m.CrossBlock}),c.d(s,"DotBlock",function(){return m.DotBlock}),c.d(s,"TransformBlock",function(){return m.TransformBlock}),c.d(s,"RemapBlock",function(){return m.RemapBlock}),c.d(s,"NormalizeBlock",function(){return m.NormalizeBlock}),c.d(s,"TrigonometryBlockOperations",function(){return m.TrigonometryBlockOperations}),c.d(s,"TrigonometryBlock",function(){return m.TrigonometryBlock}),c.d(s,"ColorMergerBlock",function(){return m.ColorMergerBlock}),c.d(s,"VectorMergerBlock",function(){return m.VectorMergerBlock}),c.d(s,"ColorSplitterBlock",function(){return m.ColorSplitterBlock}),c.d(s,"VectorSplitterBlock",function(){return m.VectorSplitterBlock}),c.d(s,"LerpBlock",function(){return m.LerpBlock}),c.d(s,"DivideBlock",function(){return m.DivideBlock}),c.d(s,"SubtractBlock",function(){return m.SubtractBlock}),c.d(s,"StepBlock",function(){return m.StepBlock}),c.d(s,"OneMinusBlock",function(){return m.OneMinusBlock}),c.d(s,"ViewDirectionBlock",function(){return m.ViewDirectionBlock}),c.d(s,"FresnelBlock",function(){return m.FresnelBlock}),c.d(s,"MaxBlock",function(){return m.MaxBlock}),c.d(s,"MinBlock",function(){return m.MinBlock}),c.d(s,"DistanceBlock",function(){return m.DistanceBlock}),c.d(s,"LengthBlock",function(){return m.LengthBlock}),c.d(s,"NegateBlock",function(){return m.NegateBlock}),c.d(s,"PowBlock",function(){return m.PowBlock}),c.d(s,"RandomNumberBlock",function(){return m.RandomNumberBlock}),c.d(s,"ArcTan2Block",function(){return m.ArcTan2Block}),c.d(s,"SmoothStepBlock",function(){return m.SmoothStepBlock}),c.d(s,"ReciprocalBlock",function(){return m.ReciprocalBlock}),c.d(s,"ReplaceColorBlock",function(){return m.ReplaceColorBlock}),c.d(s,"PosterizeBlock",function(){return m.PosterizeBlock}),c.d(s,"WaveBlockKind",function(){return m.WaveBlockKind}),c.d(s,"WaveBlock",function(){return m.WaveBlock}),c.d(s,"GradientBlockColorStep",function(){return m.GradientBlockColorStep}),c.d(s,"GradientBlock",function(){return m.GradientBlock}),c.d(s,"NLerpBlock",function(){return m.NLerpBlock}),c.d(s,"WorleyNoise3DBlock",function(){return m.WorleyNoise3DBlock}),c.d(s,"SimplexPerlin3DBlock",function(){return m.SimplexPerlin3DBlock}),c.d(s,"NormalBlendBlock",function(){return m.NormalBlendBlock}),c.d(s,"Rotate2dBlock",function(){return m.Rotate2dBlock}),c.d(s,"ReflectBlock",function(){return m.ReflectBlock}),c.d(s,"RefractBlock",function(){return m.RefractBlock}),c.d(s,"DesaturateBlock",function(){return m.DesaturateBlock}),c.d(s,"PBRMetallicRoughnessBlock",function(){return m.PBRMetallicRoughnessBlock}),c.d(s,"SheenBlock",function(){return m.SheenBlock}),c.d(s,"AnisotropyBlock",function(){return m.AnisotropyBlock}),c.d(s,"ReflectionBlock",function(){return m.ReflectionBlock}),c.d(s,"ClearCoatBlock",function(){return m.ClearCoatBlock}),c.d(s,"RefractionBlock",function(){return m.RefractionBlock}),c.d(s,"SubSurfaceBlock",function(){return m.SubSurfaceBlock}),c.d(s,"ParticleTextureBlock",function(){return m.ParticleTextureBlock}),c.d(s,"ParticleRampGradientBlock",function(){return m.ParticleRampGradientBlock}),c.d(s,"ParticleBlendMultiplyBlock",function(){return m.ParticleBlendMultiplyBlock}),c.d(s,"ModBlock",function(){return m.ModBlock}),c.d(s,"NodeMaterialOptimizer",function(){return m.NodeMaterialOptimizer}),c.d(s,"PropertyTypeForEdition",function(){return m.PropertyTypeForEdition}),c.d(s,"editableInPropertyPage",function(){return m.editableInPropertyPage}),c.d(s,"EffectRenderer",function(){return m.EffectRenderer}),c.d(s,"EffectWrapper",function(){return m.EffectWrapper}),c.d(s,"ShadowDepthWrapper",function(){return m.ShadowDepthWrapper}),c.d(s,"Scalar",function(){return m.Scalar}),c.d(s,"extractMinAndMaxIndexed",function(){return m.extractMinAndMaxIndexed}),c.d(s,"extractMinAndMax",function(){return m.extractMinAndMax}),c.d(s,"Space",function(){return m.Space}),c.d(s,"Axis",function(){return m.Axis}),c.d(s,"Coordinate",function(){return m.Coordinate}),c.d(s,"Color3",function(){return m.Color3}),c.d(s,"Color4",function(){return m.Color4}),c.d(s,"TmpColors",function(){return m.TmpColors}),c.d(s,"ToGammaSpace",function(){return m.ToGammaSpace}),c.d(s,"ToLinearSpace",function(){return m.ToLinearSpace}),c.d(s,"Epsilon",function(){return m.Epsilon}),c.d(s,"Frustum",function(){return m.Frustum}),c.d(s,"Orientation",function(){return m.Orientation}),c.d(s,"BezierCurve",function(){return m.BezierCurve}),c.d(s,"Angle",function(){return m.Angle}),c.d(s,"Arc2",function(){return m.Arc2}),c.d(s,"Path2",function(){return m.Path2}),c.d(s,"Path3D",function(){return m.Path3D}),c.d(s,"Curve3",function(){return m.Curve3}),c.d(s,"Plane",function(){return m.Plane}),c.d(s,"Size",function(){return m.Size}),c.d(s,"Vector2",function(){return m.Vector2}),c.d(s,"Vector3",function(){return m.Vector3}),c.d(s,"Vector4",function(){return m.Vector4}),c.d(s,"Quaternion",function(){return m.Quaternion}),c.d(s,"Matrix",function(){return m.Matrix}),c.d(s,"TmpVectors",function(){return m.TmpVectors}),c.d(s,"PositionNormalVertex",function(){return m.PositionNormalVertex}),c.d(s,"PositionNormalTextureVertex",function(){return m.PositionNormalTextureVertex}),c.d(s,"Viewport",function(){return m.Viewport}),c.d(s,"SphericalHarmonics",function(){return m.SphericalHarmonics}),c.d(s,"SphericalPolynomial",function(){return m.SphericalPolynomial}),c.d(s,"AbstractMesh",function(){return m.AbstractMesh}),c.d(s,"Buffer",function(){return m.Buffer}),c.d(s,"VertexBuffer",function(){return m.VertexBuffer}),c.d(s,"DracoCompression",function(){return m.DracoCompression}),c.d(s,"CSG",function(){return m.CSG}),c.d(s,"Geometry",function(){return m.Geometry}),c.d(s,"GroundMesh",function(){return m.GroundMesh}),c.d(s,"TrailMesh",function(){return m.TrailMesh}),c.d(s,"InstancedMesh",function(){return m.InstancedMesh}),c.d(s,"LinesMesh",function(){return m.LinesMesh}),c.d(s,"InstancedLinesMesh",function(){return m.InstancedLinesMesh}),c.d(s,"_CreationDataStorage",function(){return m._CreationDataStorage}),c.d(s,"_InstancesBatch",function(){return m._InstancesBatch}),c.d(s,"Mesh",function(){return m.Mesh}),c.d(s,"VertexData",function(){return m.VertexData}),c.d(s,"MeshBuilder",function(){return m.MeshBuilder}),c.d(s,"SimplificationSettings",function(){return m.SimplificationSettings}),c.d(s,"SimplificationQueue",function(){return m.SimplificationQueue}),c.d(s,"SimplificationType",function(){return m.SimplificationType}),c.d(s,"QuadraticErrorSimplification",function(){return m.QuadraticErrorSimplification}),c.d(s,"SimplicationQueueSceneComponent",function(){return m.SimplicationQueueSceneComponent}),c.d(s,"Polygon",function(){return m.Polygon}),c.d(s,"PolygonMeshBuilder",function(){return m.PolygonMeshBuilder}),c.d(s,"SubMesh",function(){return m.SubMesh}),c.d(s,"MeshLODLevel",function(){return m.MeshLODLevel}),c.d(s,"TransformNode",function(){return m.TransformNode}),c.d(s,"BoxBuilder",function(){return m.BoxBuilder}),c.d(s,"TiledBoxBuilder",function(){return m.TiledBoxBuilder}),c.d(s,"DiscBuilder",function(){return m.DiscBuilder}),c.d(s,"RibbonBuilder",function(){return m.RibbonBuilder}),c.d(s,"SphereBuilder",function(){return m.SphereBuilder}),c.d(s,"HemisphereBuilder",function(){return m.HemisphereBuilder}),c.d(s,"CylinderBuilder",function(){return m.CylinderBuilder}),c.d(s,"TorusBuilder",function(){return m.TorusBuilder}),c.d(s,"TorusKnotBuilder",function(){return m.TorusKnotBuilder}),c.d(s,"LinesBuilder",function(){return m.LinesBuilder}),c.d(s,"PolygonBuilder",function(){return m.PolygonBuilder}),c.d(s,"ShapeBuilder",function(){return m.ShapeBuilder}),c.d(s,"LatheBuilder",function(){return m.LatheBuilder}),c.d(s,"PlaneBuilder",function(){return m.PlaneBuilder}),c.d(s,"TiledPlaneBuilder",function(){return m.TiledPlaneBuilder}),c.d(s,"GroundBuilder",function(){return m.GroundBuilder}),c.d(s,"TubeBuilder",function(){return m.TubeBuilder}),c.d(s,"PolyhedronBuilder",function(){return m.PolyhedronBuilder}),c.d(s,"IcoSphereBuilder",function(){return m.IcoSphereBuilder}),c.d(s,"DecalBuilder",function(){return m.DecalBuilder}),c.d(s,"CapsuleBuilder",function(){return m.CapsuleBuilder}),c.d(s,"DataBuffer",function(){return m.DataBuffer}),c.d(s,"WebGLDataBuffer",function(){return m.WebGLDataBuffer}),c.d(s,"MorphTarget",function(){return m.MorphTarget}),c.d(s,"MorphTargetManager",function(){return m.MorphTargetManager}),c.d(s,"RecastJSPlugin",function(){return m.RecastJSPlugin}),c.d(s,"RecastJSCrowd",function(){return m.RecastJSCrowd}),c.d(s,"Node",function(){return m.Node}),c.d(s,"Database",function(){return m.Database}),c.d(s,"BaseParticleSystem",function(){return m.BaseParticleSystem}),c.d(s,"BoxParticleEmitter",function(){return m.BoxParticleEmitter}),c.d(s,"ConeParticleEmitter",function(){return m.ConeParticleEmitter}),c.d(s,"CylinderParticleEmitter",function(){return m.CylinderParticleEmitter}),c.d(s,"CylinderDirectedParticleEmitter",function(){return m.CylinderDirectedParticleEmitter}),c.d(s,"HemisphericParticleEmitter",function(){return m.HemisphericParticleEmitter}),c.d(s,"PointParticleEmitter",function(){return m.PointParticleEmitter}),c.d(s,"SphereParticleEmitter",function(){return m.SphereParticleEmitter}),c.d(s,"SphereDirectedParticleEmitter",function(){return m.SphereDirectedParticleEmitter}),c.d(s,"CustomParticleEmitter",function(){return m.CustomParticleEmitter}),c.d(s,"MeshParticleEmitter",function(){return m.MeshParticleEmitter}),c.d(s,"GPUParticleSystem",function(){return m.GPUParticleSystem}),c.d(s,"Particle",function(){return m.Particle}),c.d(s,"ParticleHelper",function(){return m.ParticleHelper}),c.d(s,"ParticleSystem",function(){return m.ParticleSystem}),c.d(s,"ParticleSystemSet",function(){return m.ParticleSystemSet}),c.d(s,"SolidParticle",function(){return m.SolidParticle}),c.d(s,"ModelShape",function(){return m.ModelShape}),c.d(s,"DepthSortedParticle",function(){return m.DepthSortedParticle}),c.d(s,"SolidParticleVertex",function(){return m.SolidParticleVertex}),c.d(s,"SolidParticleSystem",function(){return m.SolidParticleSystem}),c.d(s,"CloudPoint",function(){return m.CloudPoint}),c.d(s,"PointsGroup",function(){return m.PointsGroup}),c.d(s,"PointColor",function(){return m.PointColor}),c.d(s,"PointsCloudSystem",function(){return m.PointsCloudSystem}),c.d(s,"SubEmitterType",function(){return m.SubEmitterType}),c.d(s,"SubEmitter",function(){return m.SubEmitter}),c.d(s,"PhysicsEngine",function(){return m.PhysicsEngine}),c.d(s,"PhysicsEngineSceneComponent",function(){return m.PhysicsEngineSceneComponent}),c.d(s,"PhysicsHelper",function(){return m.PhysicsHelper}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return m.PhysicsRadialExplosionEventOptions}),c.d(s,"PhysicsUpdraftEventOptions",function(){return m.PhysicsUpdraftEventOptions}),c.d(s,"PhysicsVortexEventOptions",function(){return m.PhysicsVortexEventOptions}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return m.PhysicsRadialImpulseFalloff}),c.d(s,"PhysicsUpdraftMode",function(){return m.PhysicsUpdraftMode}),c.d(s,"PhysicsImpostor",function(){return m.PhysicsImpostor}),c.d(s,"PhysicsJoint",function(){return m.PhysicsJoint}),c.d(s,"DistanceJoint",function(){return m.DistanceJoint}),c.d(s,"MotorEnabledJoint",function(){return m.MotorEnabledJoint}),c.d(s,"HingeJoint",function(){return m.HingeJoint}),c.d(s,"Hinge2Joint",function(){return m.Hinge2Joint}),c.d(s,"CannonJSPlugin",function(){return m.CannonJSPlugin}),c.d(s,"AmmoJSPlugin",function(){return m.AmmoJSPlugin}),c.d(s,"OimoJSPlugin",function(){return m.OimoJSPlugin}),c.d(s,"AnaglyphPostProcess",function(){return m.AnaglyphPostProcess}),c.d(s,"BlackAndWhitePostProcess",function(){return m.BlackAndWhitePostProcess}),c.d(s,"BloomEffect",function(){return m.BloomEffect}),c.d(s,"BloomMergePostProcess",function(){return m.BloomMergePostProcess}),c.d(s,"BlurPostProcess",function(){return m.BlurPostProcess}),c.d(s,"ChromaticAberrationPostProcess",function(){return m.ChromaticAberrationPostProcess}),c.d(s,"CircleOfConfusionPostProcess",function(){return m.CircleOfConfusionPostProcess}),c.d(s,"ColorCorrectionPostProcess",function(){return m.ColorCorrectionPostProcess}),c.d(s,"ConvolutionPostProcess",function(){return m.ConvolutionPostProcess}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return m.DepthOfFieldBlurPostProcess}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return m.DepthOfFieldEffectBlurLevel}),c.d(s,"DepthOfFieldEffect",function(){return m.DepthOfFieldEffect}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return m.DepthOfFieldMergePostProcessOptions}),c.d(s,"DepthOfFieldMergePostProcess",function(){return m.DepthOfFieldMergePostProcess}),c.d(s,"DisplayPassPostProcess",function(){return m.DisplayPassPostProcess}),c.d(s,"ExtractHighlightsPostProcess",function(){return m.ExtractHighlightsPostProcess}),c.d(s,"FilterPostProcess",function(){return m.FilterPostProcess}),c.d(s,"FxaaPostProcess",function(){return m.FxaaPostProcess}),c.d(s,"GrainPostProcess",function(){return m.GrainPostProcess}),c.d(s,"HighlightsPostProcess",function(){return m.HighlightsPostProcess}),c.d(s,"ImageProcessingPostProcess",function(){return m.ImageProcessingPostProcess}),c.d(s,"MotionBlurPostProcess",function(){return m.MotionBlurPostProcess}),c.d(s,"PassPostProcess",function(){return m.PassPostProcess}),c.d(s,"PassCubePostProcess",function(){return m.PassCubePostProcess}),c.d(s,"PostProcess",function(){return m.PostProcess}),c.d(s,"PostProcessManager",function(){return m.PostProcessManager}),c.d(s,"RefractionPostProcess",function(){return m.RefractionPostProcess}),c.d(s,"DefaultRenderingPipeline",function(){return m.DefaultRenderingPipeline}),c.d(s,"LensRenderingPipeline",function(){return m.LensRenderingPipeline}),c.d(s,"SSAO2RenderingPipeline",function(){return m.SSAO2RenderingPipeline}),c.d(s,"SSAORenderingPipeline",function(){return m.SSAORenderingPipeline}),c.d(s,"StandardRenderingPipeline",function(){return m.StandardRenderingPipeline}),c.d(s,"PostProcessRenderEffect",function(){return m.PostProcessRenderEffect}),c.d(s,"PostProcessRenderPipeline",function(){return m.PostProcessRenderPipeline}),c.d(s,"PostProcessRenderPipelineManager",function(){return m.PostProcessRenderPipelineManager}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return m.PostProcessRenderPipelineManagerSceneComponent}),c.d(s,"SharpenPostProcess",function(){return m.SharpenPostProcess}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return m.StereoscopicInterlacePostProcessI}),c.d(s,"StereoscopicInterlacePostProcess",function(){return m.StereoscopicInterlacePostProcess}),c.d(s,"TonemappingOperator",function(){return m.TonemappingOperator}),c.d(s,"TonemapPostProcess",function(){return m.TonemapPostProcess}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return m.VolumetricLightScatteringPostProcess}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return m.VRDistortionCorrectionPostProcess}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return m.VRMultiviewToSingleviewPostProcess}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return m.ScreenSpaceReflectionPostProcess}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return m.ScreenSpaceCurvaturePostProcess}),c.d(s,"ReflectionProbe",function(){return m.ReflectionProbe}),c.d(s,"BoundingBoxRenderer",function(){return m.BoundingBoxRenderer}),c.d(s,"DepthRenderer",function(){return m.DepthRenderer}),c.d(s,"DepthRendererSceneComponent",function(){return m.DepthRendererSceneComponent}),c.d(s,"EdgesRenderer",function(){return m.EdgesRenderer}),c.d(s,"LineEdgesRenderer",function(){return m.LineEdgesRenderer}),c.d(s,"GeometryBufferRenderer",function(){return m.GeometryBufferRenderer}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return m.GeometryBufferRendererSceneComponent}),c.d(s,"PrePassRenderer",function(){return m.PrePassRenderer}),c.d(s,"PrePassRendererSceneComponent",function(){return m.PrePassRendererSceneComponent}),c.d(s,"SubSurfaceSceneComponent",function(){return m.SubSurfaceSceneComponent}),c.d(s,"OutlineRenderer",function(){return m.OutlineRenderer}),c.d(s,"RenderingGroup",function(){return m.RenderingGroup}),c.d(s,"RenderingGroupInfo",function(){return m.RenderingGroupInfo}),c.d(s,"RenderingManager",function(){return m.RenderingManager}),c.d(s,"UtilityLayerRenderer",function(){return m.UtilityLayerRenderer}),c.d(s,"Scene",function(){return m.Scene}),c.d(s,"SceneComponentConstants",function(){return m.SceneComponentConstants}),c.d(s,"Stage",function(){return m.Stage}),c.d(s,"Sprite",function(){return m.Sprite}),c.d(s,"SpriteManager",function(){return m.SpriteManager}),c.d(s,"SpriteMap",function(){return m.SpriteMap}),c.d(s,"SpritePackedManager",function(){return m.SpritePackedManager}),c.d(s,"SpriteSceneComponent",function(){return m.SpriteSceneComponent}),c.d(s,"AlphaState",function(){return m.AlphaState}),c.d(s,"DepthCullingState",function(){return m.DepthCullingState}),c.d(s,"StencilState",function(){return m.StencilState}),c.d(s,"AndOrNotEvaluator",function(){return m.AndOrNotEvaluator}),c.d(s,"AssetTaskState",function(){return m.AssetTaskState}),c.d(s,"AbstractAssetTask",function(){return m.AbstractAssetTask}),c.d(s,"AssetsProgressEvent",function(){return m.AssetsProgressEvent}),c.d(s,"ContainerAssetTask",function(){return m.ContainerAssetTask}),c.d(s,"MeshAssetTask",function(){return m.MeshAssetTask}),c.d(s,"TextFileAssetTask",function(){return m.TextFileAssetTask}),c.d(s,"BinaryFileAssetTask",function(){return m.BinaryFileAssetTask}),c.d(s,"ImageAssetTask",function(){return m.ImageAssetTask}),c.d(s,"TextureAssetTask",function(){return m.TextureAssetTask}),c.d(s,"CubeTextureAssetTask",function(){return m.CubeTextureAssetTask}),c.d(s,"HDRCubeTextureAssetTask",function(){return m.HDRCubeTextureAssetTask}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return m.EquiRectangularCubeTextureAssetTask}),c.d(s,"AssetsManager",function(){return m.AssetsManager}),c.d(s,"BasisTranscodeConfiguration",function(){return m.BasisTranscodeConfiguration}),c.d(s,"BasisTools",function(){return m.BasisTools}),c.d(s,"DDSTools",function(){return m.DDSTools}),c.d(s,"expandToProperty",function(){return m.expandToProperty}),c.d(s,"serialize",function(){return m.serialize}),c.d(s,"serializeAsTexture",function(){return m.serializeAsTexture}),c.d(s,"serializeAsColor3",function(){return m.serializeAsColor3}),c.d(s,"serializeAsFresnelParameters",function(){return m.serializeAsFresnelParameters}),c.d(s,"serializeAsVector2",function(){return m.serializeAsVector2}),c.d(s,"serializeAsVector3",function(){return m.serializeAsVector3}),c.d(s,"serializeAsMeshReference",function(){return m.serializeAsMeshReference}),c.d(s,"serializeAsColorCurves",function(){return m.serializeAsColorCurves}),c.d(s,"serializeAsColor4",function(){return m.serializeAsColor4}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return m.serializeAsImageProcessingConfiguration}),c.d(s,"serializeAsQuaternion",function(){return m.serializeAsQuaternion}),c.d(s,"serializeAsMatrix",function(){return m.serializeAsMatrix}),c.d(s,"serializeAsCameraReference",function(){return m.serializeAsCameraReference}),c.d(s,"SerializationHelper",function(){return m.SerializationHelper}),c.d(s,"Deferred",function(){return m.Deferred}),c.d(s,"EnvironmentTextureTools",function(){return m.EnvironmentTextureTools}),c.d(s,"MeshExploder",function(){return m.MeshExploder}),c.d(s,"FilesInput",function(){return m.FilesInput}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return m.CubeMapToSphericalPolynomialTools}),c.d(s,"HDRTools",function(){return m.HDRTools}),c.d(s,"PanoramaToCubeMapTools",function(){return m.PanoramaToCubeMapTools}),c.d(s,"KhronosTextureContainer",function(){return m.KhronosTextureContainer}),c.d(s,"EventState",function(){return m.EventState}),c.d(s,"Observer",function(){return m.Observer}),c.d(s,"MultiObserver",function(){return m.MultiObserver}),c.d(s,"Observable",function(){return m.Observable}),c.d(s,"PerformanceMonitor",function(){return m.PerformanceMonitor}),c.d(s,"RollingAverage",function(){return m.RollingAverage}),c.d(s,"PromisePolyfill",function(){return m.PromisePolyfill}),c.d(s,"SceneOptimization",function(){return m.SceneOptimization}),c.d(s,"TextureOptimization",function(){return m.TextureOptimization}),c.d(s,"HardwareScalingOptimization",function(){return m.HardwareScalingOptimization}),c.d(s,"ShadowsOptimization",function(){return m.ShadowsOptimization}),c.d(s,"PostProcessesOptimization",function(){return m.PostProcessesOptimization}),c.d(s,"LensFlaresOptimization",function(){return m.LensFlaresOptimization}),c.d(s,"CustomOptimization",function(){return m.CustomOptimization}),c.d(s,"ParticlesOptimization",function(){return m.ParticlesOptimization}),c.d(s,"RenderTargetsOptimization",function(){return m.RenderTargetsOptimization}),c.d(s,"MergeMeshesOptimization",function(){return m.MergeMeshesOptimization}),c.d(s,"SceneOptimizerOptions",function(){return m.SceneOptimizerOptions}),c.d(s,"SceneOptimizer",function(){return m.SceneOptimizer}),c.d(s,"SceneSerializer",function(){return m.SceneSerializer}),c.d(s,"SmartArray",function(){return m.SmartArray}),c.d(s,"SmartArrayNoDuplicate",function(){return m.SmartArrayNoDuplicate}),c.d(s,"StringDictionary",function(){return m.StringDictionary}),c.d(s,"Tags",function(){return m.Tags}),c.d(s,"TextureTools",function(){return m.TextureTools}),c.d(s,"TGATools",function(){return m.TGATools}),c.d(s,"Tools",function(){return m.Tools}),c.d(s,"className",function(){return m.className}),c.d(s,"AsyncLoop",function(){return m.AsyncLoop}),c.d(s,"VideoRecorder",function(){return m.VideoRecorder}),c.d(s,"JoystickAxis",function(){return m.JoystickAxis}),c.d(s,"VirtualJoystick",function(){return m.VirtualJoystick}),c.d(s,"WorkerPool",function(){return m.WorkerPool}),c.d(s,"Logger",function(){return m.Logger}),c.d(s,"_TypeStore",function(){return m._TypeStore}),c.d(s,"FilesInputStore",function(){return m.FilesInputStore}),c.d(s,"DeepCopier",function(){return m.DeepCopier}),c.d(s,"PivotTools",function(){return m.PivotTools}),c.d(s,"PrecisionDate",function(){return m.PrecisionDate}),c.d(s,"ScreenshotTools",function(){return m.ScreenshotTools}),c.d(s,"WebRequest",function(){return m.WebRequest}),c.d(s,"InspectableType",function(){return m.InspectableType}),c.d(s,"BRDFTextureTools",function(){return m.BRDFTextureTools}),c.d(s,"RGBDTextureTools",function(){return m.RGBDTextureTools}),c.d(s,"ColorGradient",function(){return m.ColorGradient}),c.d(s,"Color3Gradient",function(){return m.Color3Gradient}),c.d(s,"FactorGradient",function(){return m.FactorGradient}),c.d(s,"GradientHelper",function(){return m.GradientHelper}),c.d(s,"PerfCounter",function(){return m.PerfCounter}),c.d(s,"RetryStrategy",function(){return m.RetryStrategy}),c.d(s,"CanvasGenerator",function(){return m.CanvasGenerator}),c.d(s,"LoadFileError",function(){return m.LoadFileError}),c.d(s,"RequestFileError",function(){return m.RequestFileError}),c.d(s,"ReadFileError",function(){return m.ReadFileError}),c.d(s,"FileTools",function(){return m.FileTools}),c.d(s,"StringTools",function(){return m.StringTools}),c.d(s,"DataReader",function(){return m.DataReader}),c.d(s,"MinMaxReducer",function(){return m.MinMaxReducer}),c.d(s,"DepthReducer",function(){return m.DepthReducer}),c.d(s,"DataStorage",function(){return m.DataStorage}),c.d(s,"SceneRecorder",function(){return m.SceneRecorder}),c.d(s,"KhronosTextureContainer2",function(){return m.KhronosTextureContainer2}),c.d(s,"Trajectory",function(){return m.Trajectory}),c.d(s,"TrajectoryClassifier",function(){return m.TrajectoryClassifier}),c.d(s,"TimerState",function(){return m.TimerState}),c.d(s,"setAndStartTimer",function(){return m.setAndStartTimer}),c.d(s,"AdvancedTimer",function(){return m.AdvancedTimer}),c.d(s,"CopyTools",function(){return m.CopyTools}),c.d(s,"WebXRCamera",function(){return m.WebXRCamera}),c.d(s,"WebXREnterExitUIButton",function(){return m.WebXREnterExitUIButton}),c.d(s,"WebXREnterExitUIOptions",function(){return m.WebXREnterExitUIOptions}),c.d(s,"WebXREnterExitUI",function(){return m.WebXREnterExitUI}),c.d(s,"WebXRExperienceHelper",function(){return m.WebXRExperienceHelper}),c.d(s,"WebXRInput",function(){return m.WebXRInput}),c.d(s,"WebXRInputSource",function(){return m.WebXRInputSource}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return m.WebXRManagedOutputCanvasOptions}),c.d(s,"WebXRManagedOutputCanvas",function(){return m.WebXRManagedOutputCanvas}),c.d(s,"WebXRState",function(){return m.WebXRState}),c.d(s,"WebXRTrackingState",function(){return m.WebXRTrackingState}),c.d(s,"WebXRSessionManager",function(){return m.WebXRSessionManager}),c.d(s,"WebXRDefaultExperienceOptions",function(){return m.WebXRDefaultExperienceOptions}),c.d(s,"WebXRDefaultExperience",function(){return m.WebXRDefaultExperience}),c.d(s,"WebXRFeatureName",function(){return m.WebXRFeatureName}),c.d(s,"WebXRFeaturesManager",function(){return m.WebXRFeaturesManager}),c.d(s,"WebXRAbstractFeature",function(){return m.WebXRAbstractFeature}),c.d(s,"WebXRHitTestLegacy",function(){return m.WebXRHitTestLegacy}),c.d(s,"WebXRAnchorSystem",function(){return m.WebXRAnchorSystem}),c.d(s,"WebXRPlaneDetector",function(){return m.WebXRPlaneDetector}),c.d(s,"WebXRBackgroundRemover",function(){return m.WebXRBackgroundRemover}),c.d(s,"WebXRMotionControllerTeleportation",function(){return m.WebXRMotionControllerTeleportation}),c.d(s,"WebXRControllerPointerSelection",function(){return m.WebXRControllerPointerSelection}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return m.IWebXRControllerPhysicsOptions}),c.d(s,"WebXRControllerPhysics",function(){return m.WebXRControllerPhysics}),c.d(s,"WebXRHitTest",function(){return m.WebXRHitTest}),c.d(s,"WebXRFeaturePointSystem",function(){return m.WebXRFeaturePointSystem}),c.d(s,"WebXRHand",function(){return m.WebXRHand}),c.d(s,"WebXRHandTracking",function(){return m.WebXRHandTracking}),c.d(s,"WebXRAbstractMotionController",function(){return m.WebXRAbstractMotionController}),c.d(s,"WebXRControllerComponent",function(){return m.WebXRControllerComponent}),c.d(s,"WebXRGenericTriggerMotionController",function(){return m.WebXRGenericTriggerMotionController}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return m.WebXRMicrosoftMixedRealityController}),c.d(s,"WebXRMotionControllerManager",function(){return m.WebXRMotionControllerManager}),c.d(s,"WebXROculusTouchMotionController",function(){return m.WebXROculusTouchMotionController}),c.d(s,"WebXRHTCViveMotionController",function(){return m.WebXRHTCViveMotionController}),c.d(s,"WebXRProfiledMotionController",function(){return m.WebXRProfiledMotionController});var h=E!==void 0?E:typeof window!="undefined"?window:void 0;if(h!==void 0){h.BABYLON=C,h.BABYLON=h.BABYLON||{};var C=h.BABYLON;C.Debug=C.Debug||{};var R=[];for(var I in S)C.Debug[I]=S[I],R.push(I);for(var I in m)C[I]=m[I]}var b={AxesViewer:S.AxesViewer,BoneAxesViewer:S.BoneAxesViewer,PhysicsViewer:S.PhysicsViewer,SkeletonViewer:S.SkeletonViewer}}.call(this,c(159))}])})})(up);var VQ=rF(up.exports),kQ=Object.freeze(Object.assign(Object.create(null),up.exports,{[Symbol.toStringTag]:"Module",default:VQ})),jQ={exports:{}};(function(a,u){(function(p,s){a.exports=s(up.exports)})(typeof self!="undefined"?self:(typeof Be!="undefined",Be),function(p){return function(s){var c={};function E(m){if(c[m])return c[m].exports;var S=c[m]={i:m,l:!1,exports:{}};return s[m].call(S.exports,S,S.exports,E),S.l=!0,S.exports}return E.m=s,E.c=c,E.d=function(m,S,h){E.o(m,S)||Object.defineProperty(m,S,{enumerable:!0,get:h})},E.r=function(m){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},E.t=function(m,S){if(1&S&&(m=E(m)),8&S||4&S&&typeof m=="object"&&m&&m.__esModule)return m;var h=Object.create(null);if(E.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:m}),2&S&&typeof m!="string")for(var C in m)E.d(h,C,function(R){return m[R]}.bind(null,C));return h},E.n=function(m){var S=m&&m.__esModule?function(){return m.default}:function(){return m};return E.d(S,"a",S),S},E.o=function(m,S){return Object.prototype.hasOwnProperty.call(m,S)},E.p="",E(E.s=20)}([function(s,c){s.exports=p},function(s,c,E){E.d(c,"a",function(){return h}),E.d(c,"b",function(){return C});var m=E(0),S=E(2),h=function(){function R(){}return R.Get=function(I,b,f){if(!b||f==null||!b[f])throw new Error(I+": Failed to find index ("+f+")");return b[f]},R.Assign=function(I){if(I)for(var b=0;b<I.length;b++)I[b].index=b},R}(),C=function(){function R(I){this._completePromises=new Array,this._forAssetContainer=!1,this._babylonLights=[],this._disableInstancedMesh=0,this._disposed=!1,this._state=null,this._extensions=new Array,this._defaultBabylonMaterialData={},this._parent=I}return R.RegisterExtension=function(I,b){R.UnregisterExtension(I)&&m.Logger.Warn("Extension with the name '"+I+"' already exists"),R._RegisteredExtensions[I]={factory:b}},R.UnregisterExtension=function(I){return!!R._RegisteredExtensions[I]&&(delete R._RegisteredExtensions[I],!0)},Object.defineProperty(R.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"gltf",{get:function(){return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),R.prototype.dispose=function(){if(!this._disposed){for(var I in this._disposed=!0,this._completePromises.length=0,this._extensions){var b=this._extensions[I];b.dispose&&b.dispose(),delete this._extensions[I]}this._gltf=null,this._babylonScene=null,this._rootBabylonMesh=null,this._parent.dispose()}},R.prototype.importMeshAsync=function(I,b,f,x,P,A,T){var _=this;return Promise.resolve().then(function(){_._babylonScene=b,_._rootUrl=P,_._fileName=T||"scene",_._forAssetContainer=f,_._loadData(x);var g=null;if(I){var M={};if(_._gltf.nodes)for(var O=0,N=_._gltf.nodes;O<N.length;O++){var V=N[O];V.name&&(M[V.name]=V.index)}g=(I instanceof Array?I:[I]).map(function(U){var L=M[U];if(L===void 0)throw new Error("Failed to find node '"+U+"'");return L})}return _._loadAsync(g,function(){return{meshes:_._getMeshes(),particleSystems:[],skeletons:_._getSkeletons(),animationGroups:_._getAnimationGroups(),lights:_._babylonLights,transformNodes:_._getTransformNodes(),geometries:_._getGeometries()}})})},R.prototype.loadAsync=function(I,b,f,x,P){var A=this;return Promise.resolve().then(function(){return A._babylonScene=I,A._rootUrl=f,A._fileName=P||"scene",A._loadData(b),A._loadAsync(null,function(){})})},R.prototype._loadAsync=function(I,b){var f=this;return Promise.resolve().then(function(){f._uniqueRootUrl=f._rootUrl.indexOf("file:")===-1&&f._fileName?f._rootUrl:""+f._rootUrl+Date.now()+"/",f._loadExtensions(),f._checkExtensions();var x=S.GLTFLoaderState[S.GLTFLoaderState.LOADING]+" => "+S.GLTFLoaderState[S.GLTFLoaderState.READY],P=S.GLTFLoaderState[S.GLTFLoaderState.LOADING]+" => "+S.GLTFLoaderState[S.GLTFLoaderState.COMPLETE];f._parent._startPerformanceCounter(x),f._parent._startPerformanceCounter(P),f._setState(S.GLTFLoaderState.LOADING),f._extensionsOnLoading();var A=new Array,T=f._babylonScene.blockMaterialDirtyMechanism;if(f._babylonScene.blockMaterialDirtyMechanism=!0,I)A.push(f.loadSceneAsync("/nodes",{nodes:I,index:-1}));else if(f._gltf.scene!=null||f._gltf.scenes&&f._gltf.scenes[0]){var _=h.Get("/scene",f._gltf.scenes,f._gltf.scene||0);A.push(f.loadSceneAsync("/scenes/"+_.index,_))}if(f.parent.loadAllMaterials&&f._gltf.materials)for(var g=0;g<f._gltf.materials.length;++g){var M=f._gltf.materials[g],O="/materials/"+g,N=m.Material.TriangleFillMode;A.push(f._loadMaterialAsync(O,M,null,N,function(U){}))}f._babylonScene.blockMaterialDirtyMechanism=T,f._parent.compileMaterials&&A.push(f._compileMaterialsAsync()),f._parent.compileShadowGenerators&&A.push(f._compileShadowGeneratorsAsync());var V=Promise.all(A).then(function(){return f._rootBabylonMesh&&f._rootBabylonMesh.setEnabled(!0),f._extensionsOnReady(),f._setState(S.GLTFLoaderState.READY),f._startAnimations(),b()});return V.then(function(){f._parent._endPerformanceCounter(x),m.Tools.SetImmediate(function(){f._disposed||Promise.all(f._completePromises).then(function(){f._parent._endPerformanceCounter(P),f._setState(S.GLTFLoaderState.COMPLETE),f._parent.onCompleteObservable.notifyObservers(void 0),f._parent.onCompleteObservable.clear(),f.dispose()},function(U){f._parent.onErrorObservable.notifyObservers(U),f._parent.onErrorObservable.clear(),f.dispose()})})}),V}).catch(function(x){throw f._disposed||(f._parent.onErrorObservable.notifyObservers(x),f._parent.onErrorObservable.clear(),f.dispose()),x})},R.prototype._loadData=function(I){if(this._gltf=I.json,this._setupData(),I.bin){var b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){var f=b[0];(f.byteLength<I.bin.byteLength-3||f.byteLength>I.bin.byteLength)&&m.Logger.Warn("Binary buffer length ("+f.byteLength+") from JSON does not match chunk length ("+I.bin.byteLength+")"),this._bin=I.bin}else m.Logger.Warn("Unexpected BIN chunk")}},R.prototype._setupData=function(){if(h.Assign(this._gltf.accessors),h.Assign(this._gltf.animations),h.Assign(this._gltf.buffers),h.Assign(this._gltf.bufferViews),h.Assign(this._gltf.cameras),h.Assign(this._gltf.images),h.Assign(this._gltf.materials),h.Assign(this._gltf.meshes),h.Assign(this._gltf.nodes),h.Assign(this._gltf.samplers),h.Assign(this._gltf.scenes),h.Assign(this._gltf.skins),h.Assign(this._gltf.textures),this._gltf.nodes){for(var I={},b=0,f=this._gltf.nodes;b<f.length;b++)if((g=f[b]).children)for(var x=0,P=g.children;x<P.length;x++)I[P[x]]=g.index;for(var A=this._createRootNode(),T=0,_=this._gltf.nodes;T<_.length;T++){var g,M=I[(g=_[T]).index];g.parent=M===void 0?A:this._gltf.nodes[M]}}},R.prototype._loadExtensions=function(){for(var I in R._RegisteredExtensions){var b=R._RegisteredExtensions[I].factory(this);b.name!==I&&m.Logger.Warn("The name of the glTF loader extension instance does not match the registered name: "+b.name+" !== "+I),this._extensions.push(b),this._parent.onExtensionLoadedObservable.notifyObservers(b)}this._extensions.sort(function(f,x){return(f.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear()},R.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var I=function(P){if(!b._extensions.some(function(A){return A.name===P&&A.enabled}))throw new Error("Require extension "+P+" is not available")},b=this,f=0,x=this._gltf.extensionsRequired;f<x.length;f++)I(x[f])},R.prototype._setState=function(I){this._state=I,this.log(S.GLTFLoaderState[this._state])},R.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer,this._rootBabylonMesh=new m.Mesh("__root__",this._babylonScene),this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case S.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],R._LoadTransform(I,this._rootBabylonMesh));break;case S.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),I},R.prototype.loadSceneAsync=function(I,b){var f=this,x=this._extensionsLoadSceneAsync(I,b);if(x)return x;var P=new Array;if(this.logOpen(I+" "+(b.name||"")),b.nodes)for(var A=0,T=b.nodes;A<T.length;A++){var _=T[A],g=h.Get(I+"/nodes/"+_,this._gltf.nodes,_);P.push(this.loadNodeAsync("/nodes/"+g.index,g,function(U){U.parent=f._rootBabylonMesh}))}if(this._gltf.nodes){for(var M=0,O=this._gltf.nodes;M<O.length;M++)if((g=O[M])._babylonTransformNode&&g._babylonBones)for(var N=0,V=g._babylonBones;N<V.length;N++)V[N].linkTransformNode(g._babylonTransformNode)}return P.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(P).then(function(){})},R.prototype._forEachPrimitive=function(I,b){if(I._primitiveBabylonMeshes)for(var f=0,x=I._primitiveBabylonMeshes;f<x.length;f++)b(x[f])},R.prototype._getGeometries=function(){var I=new Array,b=this._gltf.nodes;if(b)for(var f=0,x=b;f<x.length;f++){var P=x[f];this._forEachPrimitive(P,function(A){var T=A.geometry;T&&I.indexOf(T)===-1&&I.push(T)})}return I},R.prototype._getMeshes=function(){var I=new Array;I.push(this._rootBabylonMesh);var b=this._gltf.nodes;if(b)for(var f=0,x=b;f<x.length;f++){var P=x[f];this._forEachPrimitive(P,function(A){I.push(A)})}return I},R.prototype._getTransformNodes=function(){var I=new Array,b=this._gltf.nodes;if(b)for(var f=0,x=b;f<x.length;f++){var P=x[f];P._babylonTransformNode&&P._babylonTransformNode.getClassName()==="TransformNode"&&I.push(P._babylonTransformNode)}return I},R.prototype._getSkeletons=function(){var I=new Array,b=this._gltf.skins;if(b)for(var f=0,x=b;f<x.length;f++){var P=x[f];P._data&&I.push(P._data.babylonSkeleton)}return I},R.prototype._getAnimationGroups=function(){var I=new Array,b=this._gltf.animations;if(b)for(var f=0,x=b;f<x.length;f++){var P=x[f];P._babylonAnimationGroup&&I.push(P._babylonAnimationGroup)}return I},R.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case S.GLTFLoaderAnimationStartMode.NONE:break;case S.GLTFLoaderAnimationStartMode.FIRST:(I=this._getAnimationGroups()).length!==0&&I[0].start(!0);break;case S.GLTFLoaderAnimationStartMode.ALL:for(var I,b=0,f=I=this._getAnimationGroups();b<f.length;b++)f[b].start(!0);break;default:return void m.Logger.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},R.prototype.loadNodeAsync=function(I,b,f){var x=this;f===void 0&&(f=function(){});var P=this._extensionsLoadNodeAsync(I,b,f);if(P)return P;if(b._babylonTransformNode)throw new Error(I+": Invalid recursive node hierarchy");var A=new Array;this.logOpen(I+" "+(b.name||""));var T=function(M){if(R.AddPointerMetadata(M,I),R._LoadTransform(b,M),b.camera!=null){var O=h.Get(I+"/camera",x._gltf.cameras,b.camera);A.push(x.loadCameraAsync("/cameras/"+O.index,O,function(j){j.parent=M}))}if(b.children)for(var N=0,V=b.children;N<V.length;N++){var U=V[N],L=h.Get(I+"/children/"+U,x._gltf.nodes,U);A.push(x.loadNodeAsync("/nodes/"+L.index,L,function(j){j.parent=M}))}f(M)};if(b.mesh==null){var _=b.name||"node"+b.index;this._babylonScene._blockEntityCollection=this._forAssetContainer,b._babylonTransformNode=new m.TransformNode(_,this._babylonScene),this._babylonScene._blockEntityCollection=!1,T(b._babylonTransformNode)}else{var g=h.Get(I+"/mesh",this._gltf.meshes,b.mesh);A.push(this._loadMeshAsync("/meshes/"+g.index,b,g,T))}return this.logClose(),Promise.all(A).then(function(){return x._forEachPrimitive(b,function(M){M.geometry&&M.geometry.useBoundingInfoFromGeometry?M._updateBoundingInfo():M.refreshBoundingInfo(!0)}),b._babylonTransformNode})},R.prototype._loadMeshAsync=function(I,b,f,x){var P=f.primitives;if(!P||!P.length)throw new Error(I+": Primitives are missing");P[0].index==null&&h.Assign(P);var A=new Array;this.logOpen(I+" "+(f.name||""));var T=b.name||"node"+b.index;if(P.length===1){var _=f.primitives[0];A.push(this._loadMeshPrimitiveAsync(I+"/primitives/"+_.index,T,b,f,_,function(N){b._babylonTransformNode=N,b._primitiveBabylonMeshes=[N]}))}else{this._babylonScene._blockEntityCollection=this._forAssetContainer,b._babylonTransformNode=new m.TransformNode(T,this._babylonScene),this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(var g=0,M=P;g<M.length;g++)_=M[g],A.push(this._loadMeshPrimitiveAsync(I+"/primitives/"+_.index,T+"_primitive"+_.index,b,f,_,function(N){N.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(N)}))}if(b.skin!=null){var O=h.Get(I+"/skin",this._gltf.skins,b.skin);A.push(this._loadSkinAsync("/skins/"+O.index,b,O))}return x(b._babylonTransformNode),this.logClose(),Promise.all(A).then(function(){return b._babylonTransformNode})},R.prototype._loadMeshPrimitiveAsync=function(I,b,f,x,P,A){var T=this,_=this._extensionsLoadMeshPrimitiveAsync(I,b,f,x,P,A);if(_)return _;this.logOpen(""+I);var g,M,O=this._disableInstancedMesh===0&&this._parent.createInstances&&f.skin==null&&!x.primitives[0].targets;if(O&&P._instanceData)g=P._instanceData.babylonSourceMesh.createInstance(b),M=P._instanceData.promise;else{var N=new Array;this._babylonScene._blockEntityCollection=this._forAssetContainer;var V=new m.Mesh(b,this._babylonScene);this._babylonScene._blockEntityCollection=!1,V.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?m.Material.CounterClockWiseSideOrientation:m.Material.ClockWiseSideOrientation,this._createMorphTargets(I,f,x,P,V),N.push(this._loadVertexDataAsync(I,P,V).then(function(Y){return T._loadMorphTargetsAsync(I,P,V,Y).then(function(){T._babylonScene._blockEntityCollection=T._forAssetContainer,Y.applyToMesh(V),T._babylonScene._blockEntityCollection=!1})}));var U=R._GetDrawMode(I,P.mode);if(P.material==null){var L=this._defaultBabylonMaterialData[U];L||(L=this._createDefaultMaterial("__GLTFLoader._default",U),this._parent.onMaterialLoadedObservable.notifyObservers(L),this._defaultBabylonMaterialData[U]=L),V.material=L}else{var j=h.Get(I+"/material",this._gltf.materials,P.material);N.push(this._loadMaterialAsync("/materials/"+j.index,j,V,U,function(Y){V.material=Y}))}M=Promise.all(N),O&&(P._instanceData={babylonSourceMesh:V,promise:M}),g=V}return R.AddPointerMetadata(g,I),this._parent.onMeshLoadedObservable.notifyObservers(g),A(g),this.logClose(),M.then(function(){return g})},R.prototype._loadVertexDataAsync=function(I,b,f){var x=this,P=this._extensionsLoadVertexDataAsync(I,b,f);if(P)return P;var A=b.attributes;if(!A)throw new Error(I+": Attributes are missing");var T=new Array,_=new m.Geometry(f.name,this._babylonScene);if(b.indices==null)f.isUnIndexed=!0;else{var g=h.Get(I+"/indices",this._gltf.accessors,b.indices);T.push(this._loadIndicesAccessorAsync("/accessors/"+g.index,g).then(function(O){_.setIndices(O)}))}var M=function(O,N,V){if(A[O]!=null){f._delayInfo=f._delayInfo||[],f._delayInfo.indexOf(N)===-1&&f._delayInfo.push(N);var U=h.Get(I+"/attributes/"+O,x._gltf.accessors,A[O]);T.push(x._loadVertexAccessorAsync("/accessors/"+U.index,U,N).then(function(L){if(L.getKind()===m.VertexBuffer.PositionKind&&!x.parent.alwaysComputeBoundingBox&&!f.skeleton){var j=U.min,Y=U.max;if(j!==void 0&&Y!==void 0){var W=m.TmpVectors.Vector3[0],ie=m.TmpVectors.Vector3[1];W.copyFromFloats.apply(W,j),ie.copyFromFloats.apply(ie,Y),_._boundingInfo=new m.BoundingInfo(W,ie),_.useBoundingInfoFromGeometry=!0}}_.setVerticesBuffer(L,U.count)})),N==m.VertexBuffer.MatricesIndicesExtraKind&&(f.numBoneInfluencers=8),V&&V(U)}};return M("POSITION",m.VertexBuffer.PositionKind),M("NORMAL",m.VertexBuffer.NormalKind),M("TANGENT",m.VertexBuffer.TangentKind),M("TEXCOORD_0",m.VertexBuffer.UVKind),M("TEXCOORD_1",m.VertexBuffer.UV2Kind),M("JOINTS_0",m.VertexBuffer.MatricesIndicesKind),M("WEIGHTS_0",m.VertexBuffer.MatricesWeightsKind),M("JOINTS_1",m.VertexBuffer.MatricesIndicesExtraKind),M("WEIGHTS_1",m.VertexBuffer.MatricesWeightsExtraKind),M("COLOR_0",m.VertexBuffer.ColorKind,function(O){O.type==="VEC4"&&(f.hasVertexAlpha=!0)}),Promise.all(T).then(function(){return _})},R.prototype._createMorphTargets=function(I,b,f,x,P){if(x.targets){if(b._numMorphTargets==null)b._numMorphTargets=x.targets.length;else if(x.targets.length!==b._numMorphTargets)throw new Error(I+": Primitives do not have the same number of targets");var A=f.extras?f.extras.targetNames:null;P.morphTargetManager=new m.MorphTargetManager(P.getScene());for(var T=0;T<x.targets.length;T++){var _=b.weights?b.weights[T]:f.weights?f.weights[T]:0,g=A?A[T]:"morphTarget"+T;P.morphTargetManager.addTarget(new m.MorphTarget(g,_,P.getScene()))}}},R.prototype._loadMorphTargetsAsync=function(I,b,f,x){if(!b.targets)return Promise.resolve();for(var P=new Array,A=f.morphTargetManager,T=0;T<A.numTargets;T++){var _=A.getTarget(T);P.push(this._loadMorphTargetVertexDataAsync(I+"/targets/"+T,x,b.targets[T],_))}return Promise.all(P).then(function(){})},R.prototype._loadMorphTargetVertexDataAsync=function(I,b,f,x){var P=this,A=new Array,T=function(_,g,M){if(f[_]!=null){var O=b.getVertexBuffer(g);if(O){var N=h.Get(I+"/"+_,P._gltf.accessors,f[_]);A.push(P._loadFloatAccessorAsync("/accessors/"+N.index,N).then(function(V){M(O,V)}))}}};return T("POSITION",m.VertexBuffer.PositionKind,function(_,g){var M=new Float32Array(g.length);_.forEach(g.length,function(O,N){M[N]=g[N]+O}),x.setPositions(M)}),T("NORMAL",m.VertexBuffer.NormalKind,function(_,g){var M=new Float32Array(g.length);_.forEach(M.length,function(O,N){M[N]=g[N]+O}),x.setNormals(M)}),T("TANGENT",m.VertexBuffer.TangentKind,function(_,g){var M=new Float32Array(g.length/3*4),O=0;_.forEach(g.length/3*4,function(N,V){(V+1)%4!=0&&(M[O]=g[O]+N,O++)}),x.setTangents(M)}),Promise.all(A).then(function(){})},R._LoadTransform=function(I,b){if(I.skin==null){var f=m.Vector3.Zero(),x=m.Quaternion.Identity(),P=m.Vector3.One();I.matrix?m.Matrix.FromArray(I.matrix).decompose(P,x,f):(I.translation&&(f=m.Vector3.FromArray(I.translation)),I.rotation&&(x=m.Quaternion.FromArray(I.rotation)),I.scale&&(P=m.Vector3.FromArray(I.scale))),b.position=f,b.rotationQuaternion=x,b.scaling=P}},R.prototype._loadSkinAsync=function(I,b,f){var x=this,P=this._extensionsLoadSkinAsync(I,b,f);if(P)return P;var A=function(M){x._forEachPrimitive(b,function(O){O.skeleton=M})};if(f._data)return A(f._data.babylonSkeleton),f._data.promise;var T="skeleton"+f.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var _=new m.Skeleton(f.name||T,T,this._babylonScene);this._babylonScene._blockEntityCollection=!1,_.overrideMesh=this._rootBabylonMesh,this._loadBones(I,f,_),A(_);var g=this._loadSkinInverseBindMatricesDataAsync(I,f).then(function(M){x._updateBoneMatrices(_,M)});return f._data={babylonSkeleton:_,promise:g},g},R.prototype._loadBones=function(I,b,f){for(var x={},P=0,A=b.joints;P<A.length;P++){var T=A[P],_=h.Get(I+"/joints/"+T,this._gltf.nodes,T);this._loadBone(_,b,f,x)}},R.prototype._loadBone=function(I,b,f,x){var P=x[I.index];if(P)return P;var A=null;I.parent&&I.parent._babylonTransformNode!==this._rootBabylonMesh&&(A=this._loadBone(I.parent,b,f,x));var T=b.joints.indexOf(I.index);return P=new m.Bone(I.name||"joint"+I.index,f,A,this._getNodeMatrix(I),null,null,T),x[I.index]=P,I._babylonBones=I._babylonBones||[],I._babylonBones.push(P),P},R.prototype._loadSkinInverseBindMatricesDataAsync=function(I,b){if(b.inverseBindMatrices==null)return Promise.resolve(null);var f=h.Get(I+"/inverseBindMatrices",this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+f.index,f)},R.prototype._updateBoneMatrices=function(I,b){for(var f=0,x=I.bones;f<x.length;f++){var P=x[f],A=m.Matrix.Identity(),T=P._index;b&&T!==-1&&(m.Matrix.FromArrayToRef(b,16*T,A),A.invertToRef(A));var _=P.getParent();_&&A.multiplyToRef(_.getInvertedAbsoluteTransform(),A),P.setBindPose(A),P.updateMatrix(A,!1,!1),P._updateDifferenceMatrix(void 0,!1)}},R.prototype._getNodeMatrix=function(I){return I.matrix?m.Matrix.FromArray(I.matrix):m.Matrix.Compose(I.scale?m.Vector3.FromArray(I.scale):m.Vector3.One(),I.rotation?m.Quaternion.FromArray(I.rotation):m.Quaternion.Identity(),I.translation?m.Vector3.FromArray(I.translation):m.Vector3.Zero())},R.prototype.loadCameraAsync=function(I,b,f){f===void 0&&(f=function(){});var x=this._extensionsLoadCameraAsync(I,b,f);if(x)return x;var P=new Array;this.logOpen(I+" "+(b.name||"")),this._babylonScene._blockEntityCollection=this._forAssetContainer;var A=new m.FreeCamera(b.name||"camera"+b.index,m.Vector3.Zero(),this._babylonScene,!1);switch(this._babylonScene._blockEntityCollection=!1,A.ignoreParentScaling=!0,A.rotation=new m.Vector3(0,Math.PI,0),b.type){case"perspective":var T=b.perspective;if(!T)throw new Error(I+": Camera perspective properties are missing");A.fov=T.yfov,A.minZ=T.znear,A.maxZ=T.zfar||Number.MAX_VALUE;break;case"orthographic":if(!b.orthographic)throw new Error(I+": Camera orthographic properties are missing");A.mode=m.Camera.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-b.orthographic.xmag,A.orthoRight=b.orthographic.xmag,A.orthoBottom=-b.orthographic.ymag,A.orthoTop=b.orthographic.ymag,A.minZ=b.orthographic.znear,A.maxZ=b.orthographic.zfar;break;default:throw new Error(I+": Invalid camera type ("+b.type+")")}return R.AddPointerMetadata(A,I),this._parent.onCameraLoadedObservable.notifyObservers(A),f(A),this.logClose(),Promise.all(P).then(function(){return A})},R.prototype._loadAnimationsAsync=function(){var I=this._gltf.animations;if(!I)return Promise.resolve();for(var b=new Array,f=0;f<I.length;f++){var x=I[f];b.push(this.loadAnimationAsync("/animations/"+x.index,x))}return Promise.all(b).then(function(){})},R.prototype.loadAnimationAsync=function(I,b){var f=this._extensionsLoadAnimationAsync(I,b);if(f)return f;this._babylonScene._blockEntityCollection=this._forAssetContainer;var x=new m.AnimationGroup(b.name||"animation"+b.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=x;var P=new Array;h.Assign(b.channels),h.Assign(b.samplers);for(var A=0,T=b.channels;A<T.length;A++){var _=T[A];P.push(this._loadAnimationChannelAsync(I+"/channels/"+_.index,I,b,_,x))}return Promise.all(P).then(function(){return x.normalize(0),x})},R.prototype._loadAnimationChannelAsync=function(I,b,f,x,P,A){var T=this;if(A===void 0&&(A=null),x.target.node==null)return Promise.resolve();var _=h.Get(I+"/target/node",this._gltf.nodes,x.target.node);if(x.target.path==="weights"&&!_._numMorphTargets||x.target.path!=="weights"&&!_._babylonTransformNode)return Promise.resolve();var g=h.Get(I+"/sampler",f.samplers,x.sampler);return this._loadAnimationSamplerAsync(b+"/samplers/"+x.sampler,g).then(function(M){var O,N;switch(x.target.path){case"translation":O="position",N=m.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":O="rotationQuaternion",N=m.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":O="scaling",N=m.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":O="influence",N=m.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(I+"/target/path: Invalid value ("+x.target.path+")")}var V,U,L=0;switch(O){case"position":V=function(){var ve=m.Vector3.FromArray(M.output,L);return L+=3,ve};break;case"rotationQuaternion":V=function(){var ve=m.Quaternion.FromArray(M.output,L);return L+=4,ve};break;case"scaling":V=function(){var ve=m.Vector3.FromArray(M.output,L);return L+=3,ve};break;case"influence":V=function(){for(var ve=new Array(_._numMorphTargets),ue=0;ue<_._numMorphTargets;ue++)ve[ue]=M.output[L++];return ve}}switch(M.interpolation){case"STEP":U=function(ve){return{frame:M.input[ve],value:V(),interpolation:m.AnimationKeyInterpolation.STEP}};break;case"LINEAR":U=function(ve){return{frame:M.input[ve],value:V()}};break;case"CUBICSPLINE":U=function(ve){return{frame:M.input[ve],inTangent:V(),value:V(),outTangent:V()}}}for(var j=new Array(M.input.length),Y=0;Y<M.input.length;Y++)j[Y]=U(Y);if(O==="influence")for(var W=function(ve){var ue=P.name+"_channel"+P.targetedAnimations.length,oe=new m.Animation(ue,O,1,N);oe.setKeys(j.map(function(Z){return{frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[ve]:void 0,value:Z.value[ve],outTangent:Z.outTangent?Z.outTangent[ve]:void 0}})),T._forEachPrimitive(_,function(Z){var J=Z.morphTargetManager.getTarget(ve),B=oe.clone();J.animations.push(B),P.addTargetedAnimation(B,J)})},ie=0;ie<_._numMorphTargets;ie++)W(ie);else{var re=P.name+"_channel"+P.targetedAnimations.length,ye=new m.Animation(re,O,1,N);ye.setKeys(j),A!=null&&A.animations!=null?(A.animations.push(ye),P.addTargetedAnimation(ye,A)):(_._babylonTransformNode.animations.push(ye),P.addTargetedAnimation(ye,_._babylonTransformNode))}})},R.prototype._loadAnimationSamplerAsync=function(I,b){if(b._data)return b._data;var f=b.interpolation||"LINEAR";switch(f){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(I+"/interpolation: Invalid value ("+b.interpolation+")")}var x=h.Get(I+"/input",this._gltf.accessors,b.input),P=h.Get(I+"/output",this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+x.index,x),this._loadFloatAccessorAsync("/accessors/"+P.index,P)]).then(function(A){var T=A[0],_=A[1];return{input:T,interpolation:f,output:_}}),b._data},R.prototype._loadBufferAsync=function(I,b,f,x){var P=this._extensionsLoadBufferAsync(I,b,f,x);if(P)return P;if(!b._data)if(b.uri)b._data=this.loadUriAsync(I+"/uri",b,b.uri);else{if(!this._bin)throw new Error(I+": Uri is missing or the binary glTF is missing its binary chunk");b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then(function(A){try{return new Uint8Array(A.buffer,A.byteOffset+f,x)}catch(T){throw new Error(I+": "+T.message)}})},R.prototype.loadBufferViewAsync=function(I,b){var f=this._extensionsLoadBufferViewAsync(I,b);if(f)return f;if(b._data)return b._data;var x=h.Get(I+"/buffer",this._gltf.buffers,b.buffer);return b._data=this._loadBufferAsync("/buffers/"+x.index,x,b.byteOffset||0,b.byteLength),b._data},R.prototype._loadAccessorAsync=function(I,b,f){var x=this;if(b._data)return b._data;var P=R._GetNumComponents(I,b.type),A=P*m.VertexBuffer.GetTypeByteLength(b.componentType),T=P*b.count;if(b.bufferView==null)b._data=Promise.resolve(new f(T));else{var _=h.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+_.index,_).then(function(M){if(b.componentType!==5126||b.normalized||_.byteStride&&_.byteStride!==A){var O=new f(T);return m.VertexBuffer.ForEach(M,b.byteOffset||0,_.byteStride||A,P,b.componentType,O.length,b.normalized||!1,function(N,V){O[V]=N}),O}return R._GetTypedArray(I,b.componentType,M,b.byteOffset,T)})}if(b.sparse){var g=b.sparse;b._data=b._data.then(function(M){var O=M,N=h.Get(I+"/sparse/indices/bufferView",x._gltf.bufferViews,g.indices.bufferView),V=h.Get(I+"/sparse/values/bufferView",x._gltf.bufferViews,g.values.bufferView);return Promise.all([x.loadBufferViewAsync("/bufferViews/"+N.index,N),x.loadBufferViewAsync("/bufferViews/"+V.index,V)]).then(function(U){var L,j=U[0],Y=U[1],W=R._GetTypedArray(I+"/sparse/indices",g.indices.componentType,j,g.indices.byteOffset,g.count),ie=P*g.count;if(b.componentType!==5126||b.normalized){var re=R._GetTypedArray(I+"/sparse/values",b.componentType,Y,g.values.byteOffset,ie);L=new f(ie),m.VertexBuffer.ForEach(re,0,A,P,b.componentType,L.length,b.normalized||!1,function(Z,J){L[J]=Z})}else L=R._GetTypedArray(I+"/sparse/values",b.componentType,Y,g.values.byteOffset,ie);for(var ye=0,ve=0;ve<W.length;ve++)for(var ue=W[ve]*P,oe=0;oe<P;oe++)O[ue++]=L[ye++];return O})})}return b._data},R.prototype._loadFloatAccessorAsync=function(I,b){return this._loadAccessorAsync(I,b,Float32Array)},R.prototype._loadIndicesAccessorAsync=function(I,b){if(b.type!=="SCALAR")throw new Error(I+"/type: Invalid value "+b.type);if(b.componentType!==5121&&b.componentType!==5123&&b.componentType!==5125)throw new Error(I+"/componentType: Invalid value "+b.componentType);if(b._data)return b._data;if(b.sparse){var f=R._GetTypedArrayConstructor(I+"/componentType",b.componentType);b._data=this._loadAccessorAsync(I,b,f)}else{var x=h.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+x.index,x).then(function(P){return R._GetTypedArray(I,b.componentType,P,b.byteOffset,b.count)})}return b._data},R.prototype._loadVertexBufferViewAsync=function(I,b){var f=this;return I._babylonBuffer||(I._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+I.index,I).then(function(x){return new m.Buffer(f._babylonScene.getEngine(),x,!1)})),I._babylonBuffer},R.prototype._loadVertexAccessorAsync=function(I,b,f){var x=this;if(b._babylonVertexBuffer)return b._babylonVertexBuffer;if(b.sparse)b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,f,!1)});else if(b.byteOffset&&b.byteOffset%m.VertexBuffer.GetTypeByteLength(b.componentType)!=0)m.Logger.Warn("Accessor byte offset is not a multiple of component type byte length"),b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,f,!1)});else if(f===m.VertexBuffer.MatricesIndicesKind||f===m.VertexBuffer.MatricesIndicesExtraKind)b._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+b.index,b).then(function(A){return new m.VertexBuffer(x._babylonScene.getEngine(),A,f,!1)});else{var P=h.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer=this._loadVertexBufferViewAsync(P,f).then(function(A){var T=R._GetNumComponents(I,b.type);return new m.VertexBuffer(x._babylonScene.getEngine(),A,f,!1,!1,P.byteStride,!1,b.byteOffset,T,b.componentType,b.normalized,!0,1,!0)})}return b._babylonVertexBuffer},R.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(I,b,f){if(!(f instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");var x=new Array;return b&&(b.baseColorFactor?(f.albedoColor=m.Color3.FromArray(b.baseColorFactor),f.alpha=b.baseColorFactor[3]):f.albedoColor=m.Color3.White(),f.metallic=b.metallicFactor==null?1:b.metallicFactor,f.roughness=b.roughnessFactor==null?1:b.roughnessFactor,b.baseColorTexture&&x.push(this.loadTextureInfoAsync(I+"/baseColorTexture",b.baseColorTexture,function(P){P.name=f.name+" (Base Color)",f.albedoTexture=P})),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/metallicRoughnessTexture",b.metallicRoughnessTexture,function(P){P.name=f.name+" (Metallic Roughness)",f.metallicTexture=P})),f.useMetallnessFromMetallicTextureBlue=!0,f.useRoughnessFromMetallicTextureGreen=!0,f.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(x).then(function(){})},R.prototype._loadMaterialAsync=function(I,b,f,x,P){P===void 0&&(P=function(){});var A=this._extensionsLoadMaterialAsync(I,b,f,x,P);if(A)return A;b._data=b._data||{};var T=b._data[x];if(!T){this.logOpen(I+" "+(b.name||""));var _=this.createMaterial(I,b,x);T={babylonMaterial:_,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,b,_)},b._data[x]=T,R.AddPointerMetadata(_,I),this._parent.onMaterialLoadedObservable.notifyObservers(_),this.logClose()}return f&&(T.babylonMeshes.push(f),f.onDisposeObservable.addOnce(function(){var g=T.babylonMeshes.indexOf(f);g!==-1&&T.babylonMeshes.splice(g,1)})),P(T.babylonMaterial),T.promise.then(function(){return T.babylonMaterial})},R.prototype._createDefaultMaterial=function(I,b){this._babylonScene._blockEntityCollection=this._forAssetContainer;var f=new m.PBRMaterial(I,this._babylonScene);return this._babylonScene._blockEntityCollection=!1,f.fillMode=b,f.enableSpecularAntiAliasing=!0,f.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,f.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,f.transparencyMode=m.PBRMaterial.PBRMATERIAL_OPAQUE,f.metallic=1,f.roughness=1,f},R.prototype.createMaterial=function(I,b,f){var x=this._extensionsCreateMaterial(I,b,f);if(x)return x;var P=b.name||"material"+b.index;return this._createDefaultMaterial(P,f)},R.prototype.loadMaterialPropertiesAsync=function(I,b,f){var x=this._extensionsLoadMaterialPropertiesAsync(I,b,f);if(x)return x;var P=new Array;return P.push(this.loadMaterialBasePropertiesAsync(I,b,f)),b.pbrMetallicRoughness&&P.push(this._loadMaterialMetallicRoughnessPropertiesAsync(I+"/pbrMetallicRoughness",b.pbrMetallicRoughness,f)),this.loadMaterialAlphaProperties(I,b,f),Promise.all(P).then(function(){})},R.prototype.loadMaterialBasePropertiesAsync=function(I,b,f){if(!(f instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");var x=new Array;return f.emissiveColor=b.emissiveFactor?m.Color3.FromArray(b.emissiveFactor):new m.Color3(0,0,0),b.doubleSided&&(f.backFaceCulling=!1,f.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/normalTexture",b.normalTexture,function(P){P.name=f.name+" (Normal)",f.bumpTexture=P})),f.invertNormalMapX=!this._babylonScene.useRightHandedSystem,f.invertNormalMapY=this._babylonScene.useRightHandedSystem,b.normalTexture.scale!=null&&(f.bumpTexture.level=b.normalTexture.scale),f.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,x.push(this.loadTextureInfoAsync(I+"/occlusionTexture",b.occlusionTexture,function(P){P.name=f.name+" (Occlusion)",f.ambientTexture=P})),f.useAmbientInGrayScale=!0,b.occlusionTexture.strength!=null&&(f.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&x.push(this.loadTextureInfoAsync(I+"/emissiveTexture",b.emissiveTexture,function(P){P.name=f.name+" (Emissive)",f.emissiveTexture=P})),Promise.all(x).then(function(){})},R.prototype.loadMaterialAlphaProperties=function(I,b,f){if(!(f instanceof m.PBRMaterial))throw new Error(I+": Material type not supported");switch(b.alphaMode||"OPAQUE"){case"OPAQUE":f.transparencyMode=m.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":f.transparencyMode=m.PBRMaterial.PBRMATERIAL_ALPHATEST,f.alphaCutOff=b.alphaCutoff==null?.5:b.alphaCutoff,f.albedoTexture&&(f.albedoTexture.hasAlpha=!0);break;case"BLEND":f.transparencyMode=m.PBRMaterial.PBRMATERIAL_ALPHABLEND,f.albedoTexture&&(f.albedoTexture.hasAlpha=!0,f.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(I+"/alphaMode: Invalid value ("+b.alphaMode+")")}},R.prototype.loadTextureInfoAsync=function(I,b,f){var x=this;f===void 0&&(f=function(){});var P=this._extensionsLoadTextureInfoAsync(I,b,f);if(P)return P;if(this.logOpen(""+I),b.texCoord>=2)throw new Error(I+"/texCoord: Invalid value ("+b.texCoord+")");var A=h.Get(I+"/index",this._gltf.textures,b.index);A._textureInfo=b;var T=this._loadTextureAsync("/textures/"+b.index,A,function(_){_.coordinatesIndex=b.texCoord||0,R.AddPointerMetadata(_,I),x._parent.onTextureLoadedObservable.notifyObservers(_),f(_)});return this.logClose(),T},R.prototype._loadTextureAsync=function(I,b,f){f===void 0&&(f=function(){});var x=this._extensionsLoadTextureAsync(I,b,f);if(x)return x;this.logOpen(I+" "+(b.name||""));var P=b.sampler==null?R.DefaultSampler:h.Get(I+"/sampler",this._gltf.samplers,b.sampler),A=h.Get(I+"/source",this._gltf.images,b.source),T=this._createTextureAsync(I,P,A,f);return this.logClose(),T},R.prototype._createTextureAsync=function(I,b,f,x,P){var A=this;x===void 0&&(x=function(){});var T=this._loadSampler("/samplers/"+b.index,b),_=new Array,g=new m.Deferred;this._babylonScene._blockEntityCollection=this._forAssetContainer;var M=new m.Texture(null,this._babylonScene,T.noMipMaps,!1,T.samplingMode,function(){A._disposed||g.resolve()},function(O,N){A._disposed||g.reject(new Error(I+": "+(N&&N.message?N.message:O||"Failed to load texture")))},void 0,void 0,void 0,f.mimeType,P);return this._babylonScene._blockEntityCollection=!1,_.push(g.promise),_.push(this.loadImageAsync("/images/"+f.index,f).then(function(O){var N=f.uri||A._fileName+"#image"+f.index,V="data:"+A._uniqueRootUrl+N;M.updateURL(V,O)})),M.wrapU=T.wrapU,M.wrapV=T.wrapV,x(M),Promise.all(_).then(function(){return M})},R.prototype._loadSampler=function(I,b){return b._data||(b._data={noMipMaps:b.minFilter===9728||b.minFilter===9729,samplingMode:R._GetTextureSamplingMode(I,b),wrapU:R._GetTextureWrapMode(I+"/wrapS",b.wrapS),wrapV:R._GetTextureWrapMode(I+"/wrapT",b.wrapT)}),b._data},R.prototype.loadImageAsync=function(I,b){if(!b._data){if(this.logOpen(I+" "+(b.name||"")),b.uri)b._data=this.loadUriAsync(I+"/uri",b,b.uri);else{var f=h.Get(I+"/bufferView",this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync("/bufferViews/"+f.index,f)}this.logClose()}return b._data},R.prototype.loadUriAsync=function(I,b,f){var x=this,P=this._extensionsLoadUriAsync(I,b,f);if(P)return P;if(!R._ValidateUri(f))throw new Error(I+": '"+f+"' is invalid");if(m.Tools.IsBase64(f)){var A=new Uint8Array(m.Tools.DecodeBase64(f));return this.log("Decoded "+f.substr(0,64)+"... ("+A.length+" bytes)"),Promise.resolve(A)}return this.log("Loading "+f),this._parent.preprocessUrlAsync(this._rootUrl+f).then(function(T){return new Promise(function(_,g){x._parent._loadFile(T,x._babylonScene,function(M){x._disposed||(x.log("Loaded "+f+" ("+M.byteLength+" bytes)"),_(new Uint8Array(M)))},!0,function(M){g(new m.LoadFileError(I+": Failed to load '"+f+"'"+(M?": "+M.status+" "+M.statusText:""),M))})})})},R.AddPointerMetadata=function(I,b){var f=I.metadata=I.metadata||{},x=f.gltf=f.gltf||{};(x.pointers=x.pointers||[]).push(b)},R._GetTextureWrapMode=function(I,b){switch(b=b??10497){case 33071:return m.Texture.CLAMP_ADDRESSMODE;case 33648:return m.Texture.MIRROR_ADDRESSMODE;case 10497:return m.Texture.WRAP_ADDRESSMODE;default:return m.Logger.Warn(I+": Invalid value ("+b+")"),m.Texture.WRAP_ADDRESSMODE}},R._GetTextureSamplingMode=function(I,b){var f=b.magFilter==null?9729:b.magFilter,x=b.minFilter==null?9987:b.minFilter;if(f===9729)switch(x){case 9728:return m.Texture.LINEAR_NEAREST;case 9729:return m.Texture.LINEAR_LINEAR;case 9984:return m.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return m.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return m.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return m.Texture.LINEAR_LINEAR_MIPLINEAR;default:return m.Logger.Warn(I+"/minFilter: Invalid value ("+x+")"),m.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(f!==9728&&m.Logger.Warn(I+"/magFilter: Invalid value ("+f+")"),x){case 9728:return m.Texture.NEAREST_NEAREST;case 9729:return m.Texture.NEAREST_LINEAR;case 9984:return m.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return m.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return m.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return m.Texture.NEAREST_LINEAR_MIPLINEAR;default:return m.Logger.Warn(I+"/minFilter: Invalid value ("+x+")"),m.Texture.NEAREST_NEAREST_MIPNEAREST}},R._GetTypedArrayConstructor=function(I,b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(I+": Invalid component type "+b)}},R._GetTypedArray=function(I,b,f,x,P){var A=f.buffer;x=f.byteOffset+(x||0);var T=R._GetTypedArrayConstructor(I+"/componentType",b);try{return new T(A,x,P)}catch(_){throw new Error(I+": "+_)}},R._GetNumComponents=function(I,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(I+": Invalid type ("+b+")")},R._ValidateUri=function(I){return m.Tools.IsBase64(I)||I.indexOf("..")===-1},R._GetDrawMode=function(I,b){switch(b==null&&(b=4),b){case 0:return m.Material.PointListDrawMode;case 1:return m.Material.LineListDrawMode;case 2:return m.Material.LineLoopDrawMode;case 3:return m.Material.LineStripDrawMode;case 4:return m.Material.TriangleFillMode;case 5:return m.Material.TriangleStripDrawMode;case 6:return m.Material.TriangleFanDrawMode}throw new Error(I+": Invalid mesh primitive mode ("+b+")")},R.prototype._compileMaterialsAsync=function(){var I=this;this._parent._startPerformanceCounter("Compile materials");var b=new Array;if(this._gltf.materials)for(var f=0,x=this._gltf.materials;f<x.length;f++){var P=x[f];if(P._data)for(var A in P._data)for(var T=P._data[A],_=0,g=T.babylonMeshes;_<g.length;_++){var M=g[_];M.computeWorldMatrix(!0);var O=T.babylonMaterial;b.push(O.forceCompilationAsync(M)),b.push(O.forceCompilationAsync(M,{useInstances:!0})),this._parent.useClipPlane&&(b.push(O.forceCompilationAsync(M,{clipPlane:!0})),b.push(O.forceCompilationAsync(M,{clipPlane:!0,useInstances:!0})))}}return Promise.all(b).then(function(){I._parent._endPerformanceCounter("Compile materials")})},R.prototype._compileShadowGeneratorsAsync=function(){var I=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var b=new Array,f=0,x=this._babylonScene.lights;f<x.length;f++){var P=x[f].getShadowGenerator();P&&b.push(P.forceCompilationAsync())}return Promise.all(b).then(function(){I._parent._endPerformanceCounter("Compile shadow generators")})},R.prototype._forEachExtensions=function(I){for(var b=0,f=this._extensions;b<f.length;b++){var x=f[b];x.enabled&&I(x)}},R.prototype._applyExtensions=function(I,b,f){for(var x=0,P=this._extensions;x<P.length;x++){var A=P[x];if(A.enabled){var T=A.name+"."+b,_=I;_._activeLoaderExtensionFunctions=_._activeLoaderExtensionFunctions||{};var g=_._activeLoaderExtensionFunctions;if(!g[T]){g[T]=!0;try{var M=f(A);if(M)return M}finally{delete g[T]}}}}return null},R.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(I){return I.onLoading&&I.onLoading()})},R.prototype._extensionsOnReady=function(){this._forEachExtensions(function(I){return I.onReady&&I.onReady()})},R.prototype._extensionsLoadSceneAsync=function(I,b){return this._applyExtensions(b,"loadScene",function(f){return f.loadSceneAsync&&f.loadSceneAsync(I,b)})},R.prototype._extensionsLoadNodeAsync=function(I,b,f){return this._applyExtensions(b,"loadNode",function(x){return x.loadNodeAsync&&x.loadNodeAsync(I,b,f)})},R.prototype._extensionsLoadCameraAsync=function(I,b,f){return this._applyExtensions(b,"loadCamera",function(x){return x.loadCameraAsync&&x.loadCameraAsync(I,b,f)})},R.prototype._extensionsLoadVertexDataAsync=function(I,b,f){return this._applyExtensions(b,"loadVertexData",function(x){return x._loadVertexDataAsync&&x._loadVertexDataAsync(I,b,f)})},R.prototype._extensionsLoadMeshPrimitiveAsync=function(I,b,f,x,P,A){return this._applyExtensions(P,"loadMeshPrimitive",function(T){return T._loadMeshPrimitiveAsync&&T._loadMeshPrimitiveAsync(I,b,f,x,P,A)})},R.prototype._extensionsLoadMaterialAsync=function(I,b,f,x,P){return this._applyExtensions(b,"loadMaterial",function(A){return A._loadMaterialAsync&&A._loadMaterialAsync(I,b,f,x,P)})},R.prototype._extensionsCreateMaterial=function(I,b,f){return this._applyExtensions(b,"createMaterial",function(x){return x.createMaterial&&x.createMaterial(I,b,f)})},R.prototype._extensionsLoadMaterialPropertiesAsync=function(I,b,f){return this._applyExtensions(b,"loadMaterialProperties",function(x){return x.loadMaterialPropertiesAsync&&x.loadMaterialPropertiesAsync(I,b,f)})},R.prototype._extensionsLoadTextureInfoAsync=function(I,b,f){return this._applyExtensions(b,"loadTextureInfo",function(x){return x.loadTextureInfoAsync&&x.loadTextureInfoAsync(I,b,f)})},R.prototype._extensionsLoadTextureAsync=function(I,b,f){return this._applyExtensions(b,"loadTexture",function(x){return x._loadTextureAsync&&x._loadTextureAsync(I,b,f)})},R.prototype._extensionsLoadAnimationAsync=function(I,b){return this._applyExtensions(b,"loadAnimation",function(f){return f.loadAnimationAsync&&f.loadAnimationAsync(I,b)})},R.prototype._extensionsLoadSkinAsync=function(I,b,f){return this._applyExtensions(f,"loadSkin",function(x){return x._loadSkinAsync&&x._loadSkinAsync(I,b,f)})},R.prototype._extensionsLoadUriAsync=function(I,b,f){return this._applyExtensions(b,"loadUri",function(x){return x._loadUriAsync&&x._loadUriAsync(I,b,f)})},R.prototype._extensionsLoadBufferViewAsync=function(I,b){return this._applyExtensions(b,"loadBufferView",function(f){return f.loadBufferViewAsync&&f.loadBufferViewAsync(I,b)})},R.prototype._extensionsLoadBufferAsync=function(I,b,f,x){return this._applyExtensions(b,"loadBuffer",function(P){return P.loadBufferAsync&&P.loadBufferAsync(I,b,f,x)})},R.LoadExtensionAsync=function(I,b,f,x){if(!b.extensions)return null;var P=b.extensions[f];return P?x(I+"/extensions/"+f,P):null},R.LoadExtraAsync=function(I,b,f,x){if(!b.extras)return null;var P=b.extras[f];return P?x(I+"/extras/"+f,P):null},R.prototype.isExtensionUsed=function(I){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(I)!==-1},R.prototype.logOpen=function(I){this._parent._logOpen(I)},R.prototype.logClose=function(){this._parent._logClose()},R.prototype.log=function(I){this._parent._log(I)},R.prototype.startPerformanceCounter=function(I){this._parent._startPerformanceCounter(I)},R.prototype.endPerformanceCounter=function(I){this._parent._endPerformanceCounter(I)},R._RegisteredExtensions={},R.DefaultSampler={index:-1},R}();S.GLTFFileLoader._CreateGLTF2Loader=function(R){return new C(R)}},function(s,c,E){E.r(c),E.d(c,"GLTFLoaderCoordinateSystemMode",function(){return m}),E.d(c,"GLTFLoaderAnimationStartMode",function(){return S}),E.d(c,"GLTFLoaderState",function(){return h}),E.d(c,"GLTFFileLoader",function(){return I});var m,S,h,C=E(0),R=E(3);(function(b){b[b.AUTO=0]="AUTO",b[b.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(m||(m={})),function(b){b[b.NONE=0]="NONE",b[b.FIRST=1]="FIRST",b[b.ALL=2]="ALL"}(S||(S={})),function(b){b[b.LOADING=0]="LOADING",b[b.READY=1]="READY",b[b.COMPLETE=2]="COMPLETE"}(h||(h={}));var I=function(){function b(){this.onParsedObservable=new C.Observable,this.coordinateSystemMode=m.AUTO,this.animationStartMode=S.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.preprocessUrlAsync=function(f){return Promise.resolve(f)},this.onMeshLoadedObservable=new C.Observable,this.onTextureLoadedObservable=new C.Observable,this.onMaterialLoadedObservable=new C.Observable,this.onCameraLoadedObservable=new C.Observable,this.onCompleteObservable=new C.Observable,this.onErrorObservable=new C.Observable,this.onDisposeObservable=new C.Observable,this.onExtensionLoadedObservable=new C.Observable,this.validate=!1,this.onValidatedObservable=new C.Observable,this._loader=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(b.prototype,"onParsed",{set:function(f){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onMeshLoaded",{set:function(f){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onTextureLoaded",{set:function(f){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onMaterialLoaded",{set:function(f){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onCameraLoaded",{set:function(f){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onComplete",{set:function(f){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onError",{set:function(f){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onDispose",{set:function(f){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onExtensionLoaded",{set:function(f){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(f)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(f){this._loggingEnabled!==f&&(this._loggingEnabled=f,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(f){this._capturePerformanceCounters!==f&&(this._capturePerformanceCounters=f,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onValidated",{set:function(f){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(f)},enumerable:!1,configurable:!0}),b.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var f=0,x=this._requests;f<x.length;f++)x[f].abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(P){return Promise.resolve(P)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},b.prototype.requestFile=function(f,x,P,A,T,_){var g=this;if(this._progressCallback=A,T){if(this.useRangeRequests){this.validate&&C.Logger.Warn("glTF validation is not supported when range requests are enabled");var M={abort:function(){},onCompleteObservable:new C.Observable},O={readAsync:function(N,V){return new Promise(function(U,L){g._requestFile(x,f,function(j){U(new Uint8Array(j))},!0,function(j){L(j)},function(j){j.setRequestHeader("Range","bytes="+N+"-"+(N+V-1))})})},byteLength:0};return this._unpackBinaryAsync(new C.DataReader(O)).then(function(N){M.onCompleteObservable.notifyObservers(M),P(N)},_),M}return this._requestFile(x,f,function(N,V){var U=N;g._unpackBinaryAsync(new C.DataReader({readAsync:function(L,j){return Promise.resolve(new Uint8Array(U,L,j))},byteLength:U.byteLength})).then(function(L){P(L,V)},_)},!0,_)}return this._requestFile(x,f,function(N,V){g._validate(f,N,C.Tools.GetFolderPath(x),C.Tools.GetFilename(x)),P({json:g._parseJson(N)},V)},T,_)},b.prototype.readFile=function(f,x,P,A,T,_){var g=this;return f._readFile(x,function(M){if(g._validate(f,M,"file:",x.name),T){var O=M;g._unpackBinaryAsync(new C.DataReader({readAsync:function(N,V){return Promise.resolve(new Uint8Array(O,N,V))},byteLength:O.byteLength})).then(P,_)}else P({json:g._parseJson(M)})},A,T,_)},b.prototype.importMeshAsync=function(f,x,P,A,T,_){var g=this;return Promise.resolve().then(function(){return g.onParsedObservable.notifyObservers(P),g.onParsedObservable.clear(),g._log("Loading "+(_||"")),g._loader=g._getLoader(P),g._loader.importMeshAsync(f,x,!1,P,A,T,_)})},b.prototype.loadAsync=function(f,x,P,A,T){var _=this;return Promise.resolve().then(function(){return _.onParsedObservable.notifyObservers(x),_.onParsedObservable.clear(),_._log("Loading "+(T||"")),_._loader=_._getLoader(x),_._loader.loadAsync(f,x,P,A,T)})},b.prototype.loadAssetContainerAsync=function(f,x,P,A,T){var _=this;return Promise.resolve().then(function(){_.onParsedObservable.notifyObservers(x),_.onParsedObservable.clear(),_._log("Loading "+(T||"")),_._loader=_._getLoader(x);var g=new C.AssetContainer(f),M=[];_.onMaterialLoadedObservable.add(function(V){M.push(V),V.onDisposeObservable.addOnce(function(){var U=g.materials.indexOf(V);U>-1&&g.materials.splice(U,1),(U=M.indexOf(V))>-1&&M.splice(U,1)})});var O=[];_.onTextureLoadedObservable.add(function(V){O.push(V),V.onDisposeObservable.addOnce(function(){var U=g.textures.indexOf(V);U>-1&&g.textures.splice(U,1),(U=O.indexOf(V))>-1&&O.splice(U,1)})});var N=[];return _.onCameraLoadedObservable.add(function(V){N.push(V)}),_._loader.importMeshAsync(null,f,!0,x,P,A,T).then(function(V){return Array.prototype.push.apply(g.geometries,V.geometries),Array.prototype.push.apply(g.meshes,V.meshes),Array.prototype.push.apply(g.particleSystems,V.particleSystems),Array.prototype.push.apply(g.skeletons,V.skeletons),Array.prototype.push.apply(g.animationGroups,V.animationGroups),Array.prototype.push.apply(g.materials,M),Array.prototype.push.apply(g.textures,O),Array.prototype.push.apply(g.lights,V.lights),Array.prototype.push.apply(g.transformNodes,V.transformNodes),Array.prototype.push.apply(g.cameras,N),g})})},b.prototype.canDirectLoad=function(f){return f.indexOf("asset")!==-1&&f.indexOf("version")!==-1||C.StringTools.StartsWith(f,"data:base64,"+b.magicBase64Encoded)||C.StringTools.StartsWith(f,"data:application/octet-stream;base64,"+b.magicBase64Encoded)||C.StringTools.StartsWith(f,"data:model/gltf-binary;base64,"+b.magicBase64Encoded)},b.prototype.directLoad=function(f,x){if(C.StringTools.StartsWith(x,"base64,"+b.magicBase64Encoded)||C.StringTools.StartsWith(x,"application/octet-stream;base64,"+b.magicBase64Encoded)||C.StringTools.StartsWith(x,"model/gltf-binary;base64,"+b.magicBase64Encoded)){var P=C.Tools.DecodeBase64(x);return this._validate(f,P),this._unpackBinaryAsync(new C.DataReader({readAsync:function(A,T){return Promise.resolve(new Uint8Array(P,A,T))},byteLength:P.byteLength}))}return this._validate(f,x),Promise.resolve({json:this._parseJson(x)})},b.prototype.createPlugin=function(){return new b},Object.defineProperty(b.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!1,configurable:!0}),b.prototype.whenCompleteAsync=function(){var f=this;return new Promise(function(x,P){f.onCompleteObservable.addOnce(function(){x()}),f.onErrorObservable.addOnce(function(A){P(A)})})},b.prototype._loadFile=function(f,x,P,A,T){var _=this,g=x._loadFile(f,P,function(M){_._onProgress(M,g)},void 0,A,T);return g.onCompleteObservable.add(function(M){_._requests.splice(_._requests.indexOf(M),1)}),this._requests.push(g),g},b.prototype._requestFile=function(f,x,P,A,T,_){var g=this,M=x._requestFile(f,P,function(O){g._onProgress(O,M)},void 0,A,T,_);return M.onCompleteObservable.add(function(O){g._requests.splice(g._requests.indexOf(O),1)}),this._requests.push(M),M},b.prototype._onProgress=function(f,x){if(this._progressCallback){x._lengthComputable=f.lengthComputable,x._loaded=f.loaded,x._total=f.total;for(var P=!0,A=0,T=0,_=0,g=this._requests;_<g.length;_++){var M=g[_];if(M._lengthComputable===void 0||M._loaded===void 0||M._total===void 0)return;P=P&&M._lengthComputable,A+=M._loaded,T+=M._total}this._progressCallback({lengthComputable:P,loaded:A,total:P?T:0})}},b.prototype._validate=function(f,x,P,A){var T=this;P===void 0&&(P=""),A===void 0&&(A=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),R.GLTFValidation.ValidateAsync(x,P,A,function(_){return T.preprocessUrlAsync(P+_).then(function(g){return f._loadFileAsync(g,void 0,!0,!0)})}).then(function(_){T._endPerformanceCounter("Validate JSON"),T.onValidatedObservable.notifyObservers(_),T.onValidatedObservable.clear()},function(_){T._endPerformanceCounter("Validate JSON"),C.Tools.Warn("Failed to validate: "+_.message),T.onValidatedObservable.clear()}))},b.prototype._getLoader=function(f){var x=f.json.asset||{};this._log("Asset version: "+x.version),x.minVersion&&this._log("Asset minimum version: "+x.minVersion),x.generator&&this._log("Asset generator: "+x.generator);var P=b._parseVersion(x.version);if(!P)throw new Error("Invalid version: "+x.version);if(x.minVersion!==void 0){var A=b._parseVersion(x.minVersion);if(!A)throw new Error("Invalid minimum version: "+x.minVersion);if(b._compareVersion(A,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}var T={1:b._CreateGLTF1Loader,2:b._CreateGLTF2Loader}[P.major];if(!T)throw new Error("Unsupported version: "+x.version);return T(this)},b.prototype._parseJson=function(f){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: "+f.length);var x=JSON.parse(f);return this._endPerformanceCounter("Parse JSON"),x},b.prototype._unpackBinaryAsync=function(f){var x=this;return this._startPerformanceCounter("Unpack Binary"),f.loadAsync(20).then(function(){var P=f.readUint32();if(P!==1179937895)throw new Error("Unexpected magic: "+P);var A=f.readUint32();x.loggingEnabled&&x._log("Binary version: "+A);var T,_=f.readUint32();if(f.buffer.byteLength!==0&&_!==f.buffer.byteLength)throw new Error("Length in header does not match actual data length: "+_+" != "+f.buffer.byteLength);switch(A){case 1:T=x._unpackBinaryV1Async(f,_);break;case 2:T=x._unpackBinaryV2Async(f,_);break;default:throw new Error("Unsupported version: "+A)}return x._endPerformanceCounter("Unpack Binary"),T})},b.prototype._unpackBinaryV1Async=function(f,x){var P=f.readUint32(),A=f.readUint32();if(A!==0)throw new Error("Unexpected content format: "+A);var T=x-f.byteOffset,_={json:this._parseJson(f.readString(P)),bin:null};if(T!==0){var g=f.byteOffset;_.bin={readAsync:function(M,O){return f.buffer.readAsync(g+M,O)},byteLength:T}}return Promise.resolve(_)},b.prototype._unpackBinaryV2Async=function(f,x){var P=this,A=1313821514,T=5130562,_=f.readUint32();if(f.readUint32()!==A)throw new Error("First chunk format is not JSON");return f.byteOffset+_===x?f.loadAsync(_).then(function(){return{json:P._parseJson(f.readString(_)),bin:null}}):f.loadAsync(_+8).then(function(){var g={json:P._parseJson(f.readString(_)),bin:null},M=function(){var O=f.readUint32();switch(f.readUint32()){case A:throw new Error("Unexpected JSON chunk");case T:var N=f.byteOffset;g.bin={readAsync:function(V,U){return f.buffer.readAsync(N+V,U)},byteLength:O},f.skipBytes(O);break;default:f.skipBytes(O)}return f.byteOffset!==x?f.loadAsync(8).then(M):Promise.resolve(g)};return M()})},b._parseVersion=function(f){if(f==="1.0"||f==="1.0.1")return{major:1,minor:0};var x=(f+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null},b._compareVersion=function(f,x){return f.major>x.major?1:f.major<x.major?-1:f.minor>x.minor?1:f.minor<x.minor?-1:0},b.prototype._logOpen=function(f){this._log(f),this._logIndentLevel++},b.prototype._logClose=function(){--this._logIndentLevel},b.prototype._logEnabled=function(f){var x=b._logSpaces.substr(0,2*this._logIndentLevel);C.Logger.Log(""+x+f)},b.prototype._logDisabled=function(f){},b.prototype._startPerformanceCounterEnabled=function(f){C.Tools.StartPerformanceCounter(f)},b.prototype._startPerformanceCounterDisabled=function(f){},b.prototype._endPerformanceCounterEnabled=function(f){C.Tools.EndPerformanceCounter(f)},b.prototype._endPerformanceCounterDisabled=function(f){},b.IncrementalLoading=!0,b.HomogeneousCoordinates=!1,b.magicBase64Encoded="Z2xURg",b._logSpaces="                                ",b}();C.SceneLoader&&C.SceneLoader.RegisterPlugin(new I)},function(s,c,E){E.r(c),E.d(c,"GLTFValidation",function(){return C});var m=E(0);function S(R,I,b,f){var x={externalResourceFunction:function(P){return f(P).then(function(A){return new Uint8Array(A)})}};return b&&(x.uri=I==="file:"?b:I+b),R instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(R),x):GLTFValidator.validateString(R,x)}function h(){var R=[];onmessage=function(I){var b=I.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":S(b.data,b.rootUrl,b.fileName,function(f){return new Promise(function(x,P){var A=R.length;R.push({resolve:x,reject:P}),postMessage({id:"getExternalResource",index:A,uri:f})})}).then(function(f){postMessage({id:"validate.resolve",value:f})},function(f){postMessage({id:"validate.reject",reason:f})});break;case"getExternalResource.resolve":R[b.index].resolve(b.value);break;case"getExternalResource.reject":R[b.index].reject(b.reason)}}}var C=function(){function R(){}return R.ValidateAsync=function(I,b,f,x){var P=this;return typeof Worker=="function"?new Promise(function(A,T){var _=S+"("+h+")()",g=URL.createObjectURL(new Blob([_],{type:"application/javascript"})),M=new Worker(g),O=function(V){M.removeEventListener("error",O),M.removeEventListener("message",N),T(V)},N=function(V){var U=V.data;switch(U.id){case"getExternalResource":x(U.uri).then(function(L){M.postMessage({id:"getExternalResource.resolve",index:U.index,value:L},[L])},function(L){M.postMessage({id:"getExternalResource.reject",index:U.index,reason:L})});break;case"validate.resolve":M.removeEventListener("error",O),M.removeEventListener("message",N),A(U.value);break;case"validate.reject":M.removeEventListener("error",O),M.removeEventListener("message",N),T(U.reason)}};M.addEventListener("error",O),M.addEventListener("message",N),M.postMessage({id:"init",url:m.Tools.GetAbsoluteUrl(P.Configuration.url)}),M.postMessage({id:"validate",data:I,rootUrl:b,fileName:f})}):(this._LoadScriptPromise||(this._LoadScriptPromise=m.Tools.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return S(I,b,f,x)}))},R.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},R}()},function(s,c,E){E.d(c,"b",function(){return S}),E.d(c,"a",function(){return h});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var m=function(C,R){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,b){I.__proto__=b}||function(I,b){for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(I[f]=b[f])})(C,R)};function S(C,R){function I(){this.constructor=C}m(C,R),C.prototype=R===null?Object.create(R):(I.prototype=R.prototype,new I)}var h=function(){return(h=Object.assign||function(C){for(var R,I=1,b=arguments.length;I<b;I++)for(var f in R=arguments[I])Object.prototype.hasOwnProperty.call(R,f)&&(C[f]=R[f]);return C}).apply(this,arguments)}},function(s,c){var E;E=function(){return this}();try{E=E||new Function("return this")()}catch(m){typeof window=="object"&&(E=window)}s.exports=E},function(s,c,E){E.r(c)},function(s,c,E){E.r(c),E.d(c,"EXT_lights_image_based",function(){return C}),E.d(c,"EXT_mesh_gpu_instancing",function(){return R}),E.d(c,"EXT_texture_webp",function(){return I}),E.d(c,"KHR_draco_mesh_compression",function(){return b}),E.d(c,"KHR_lights",function(){return f}),E.d(c,"KHR_materials_pbrSpecularGlossiness",function(){return x}),E.d(c,"KHR_materials_unlit",function(){return P}),E.d(c,"KHR_materials_clearcoat",function(){return A}),E.d(c,"KHR_materials_sheen",function(){return T}),E.d(c,"KHR_materials_specular",function(){return _}),E.d(c,"KHR_materials_ior",function(){return g}),E.d(c,"KHR_materials_variants",function(){return M}),E.d(c,"KHR_materials_transmission",function(){return V}),E.d(c,"KHR_materials_translucency",function(){return U}),E.d(c,"KHR_mesh_quantization",function(){return L}),E.d(c,"KHR_texture_basisu",function(){return j}),E.d(c,"KHR_texture_transform",function(){return Y}),E.d(c,"MSFT_audio_emitter",function(){return W}),E.d(c,"MSFT_lod",function(){return ie}),E.d(c,"MSFT_minecraftMesh",function(){return re}),E.d(c,"MSFT_sRGBFactors",function(){return ye}),E.d(c,"ExtrasAsMetadata",function(){return ve});var m=E(0),S=E(1),h="EXT_lights_image_based",C=function(){function ue(oe){this.name=h,this._loader=oe,this.enabled=this._loader.isExtensionUsed(h)}return ue.prototype.dispose=function(){this._loader=null,delete this._lights},ue.prototype.onLoading=function(){var oe=this._loader.gltf.extensions;if(oe&&oe[this.name]){var Z=oe[this.name];this._lights=Z.lights}},ue.prototype.loadSceneAsync=function(oe,Z){var J=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(B,G){var $=new Array;$.push(J._loader.loadSceneAsync(oe,Z)),J._loader.logOpen(""+B);var he=S.a.Get(B+"/light",J._lights,G.light);return $.push(J._loadLightAsync("/extensions/"+J.name+"/lights/"+G.light,he).then(function(se){J._loader.babylonScene.environmentTexture=se})),J._loader.logClose(),Promise.all($).then(function(){})})},ue.prototype._loadLightAsync=function(oe,Z){var J=this;if(!Z._loaded){var B=new Array;this._loader.logOpen(""+oe);for(var G=new Array(Z.specularImages.length),$=function(q){var H=Z.specularImages[q];G[q]=new Array(H.length);for(var X=function(Q){var te=oe+"/specularImages/"+q+"/"+Q;he._loader.logOpen(""+te);var ge=H[Q],ce=S.a.Get(te,he._loader.gltf.images,ge);B.push(he._loader.loadImageAsync("/images/"+ge,ce).then(function(de){G[q][Q]=de})),he._loader.logClose()},ee=0;ee<H.length;ee++)X(ee)},he=this,se=0;se<Z.specularImages.length;se++)$(se);this._loader.logClose(),Z._loaded=Promise.all(B).then(function(){var q=new m.RawCubeTexture(J._loader.babylonScene,null,Z.specularImageSize);if(q.name=Z.name||"environment",Z._babylonTexture=q,Z.intensity!=null&&(q.level=Z.intensity),Z.rotation){var H=m.Quaternion.FromArray(Z.rotation);J._loader.babylonScene.useRightHandedSystem||(H=m.Quaternion.Inverse(H)),m.Matrix.FromQuaternionToRef(H,q.getReflectionTextureMatrix())}var X=m.SphericalHarmonics.FromArray(Z.irradianceCoefficients);X.scaleInPlace(Z.intensity),X.convertIrradianceToLambertianRadiance();var ee=m.SphericalPolynomial.FromHarmonics(X),Q=(G.length-1)/m.Scalar.Log2(Z.specularImageSize);return q.updateRGBDAsync(G,ee,Q)})}return Z._loaded.then(function(){return Z._babylonTexture})},ue}();S.b.RegisterExtension(h,function(ue){return new C(ue)});var R=function(){function ue(oe){this.name="EXT_mesh_gpu_instancing",this._loader=oe,this.enabled=this._loader.isExtensionUsed("EXT_mesh_gpu_instancing")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadNodeAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){B._loader._disableInstancedMesh++;var he=B._loader.loadNodeAsync("/nodes/"+Z.index,Z,J);if(B._loader._disableInstancedMesh--,!Z._primitiveBabylonMeshes)return he;var se=new Array,q=0,H=function(X){if($.attributes[X]!=null){var ee=S.a.Get(G+"/attributes/"+X,B._loader.gltf.accessors,$.attributes[X]);if(se.push(B._loader._loadFloatAccessorAsync("/accessors/"+ee.bufferView,ee)),q===0)q=ee.count;else if(q!==ee.count)throw new Error(G+"/attributes: Instance buffer accessors do not have the same count.")}else se.push(Promise.resolve(null))};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),he.then(function(X){return Promise.all(se).then(function(ee){var Q=ee[0],te=ee[1],ge=ee[2],ce=new Float32Array(16*q);m.TmpVectors.Vector3[0].copyFromFloats(0,0,0),m.TmpVectors.Quaternion[0].copyFromFloats(0,0,0,1),m.TmpVectors.Vector3[1].copyFromFloats(1,1,1);for(var de=0;de<q;++de)Q&&m.Vector3.FromArrayToRef(Q,3*de,m.TmpVectors.Vector3[0]),te&&m.Quaternion.FromArrayToRef(te,4*de,m.TmpVectors.Quaternion[0]),ge&&m.Vector3.FromArrayToRef(ge,3*de,m.TmpVectors.Vector3[1]),m.Matrix.ComposeToRef(m.TmpVectors.Vector3[1],m.TmpVectors.Quaternion[0],m.TmpVectors.Vector3[0],m.TmpVectors.Matrix[0]),m.TmpVectors.Matrix[0].copyToArray(ce,16*de);for(var ne=0,pe=Z._primitiveBabylonMeshes;ne<pe.length;ne++)pe[ne].thinInstanceSetBuffer("matrix",ce,16,!0);return X})})})},ue}();S.b.RegisterExtension("EXT_mesh_gpu_instancing",function(ue){return new R(ue)});var I=function(){function ue(oe){this.name="EXT_texture_webp",this._loader=oe,this.enabled=oe.isExtensionUsed("EXT_texture_webp")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype._loadTextureAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=Z.sampler==null?S.b.DefaultSampler:S.a.Get(oe+"/sampler",B._loader.gltf.samplers,Z.sampler),se=S.a.Get(G+"/source",B._loader.gltf.images,$.source);return B._loader._createTextureAsync(oe,he,se,function(q){J(q)})})},ue}();S.b.RegisterExtension("EXT_texture_webp",function(ue){return new I(ue)});var b=function(){function ue(oe){this.name="KHR_draco_mesh_compression",this._loader=oe,this.enabled=m.DracoCompression.DecoderAvailable&&this._loader.isExtensionUsed("KHR_draco_mesh_compression")}return ue.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},ue.prototype._loadVertexDataAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){if(Z.mode!=null){if(Z.mode!==5&&Z.mode!==4)throw new Error(oe+": Unsupported mode "+Z.mode);if(Z.mode===5)throw new Error(oe+": Mode "+Z.mode+" is not currently supported")}var he={},se=function(H,X){var ee=$.attributes[H];ee!=null&&(J._delayInfo=J._delayInfo||[],J._delayInfo.indexOf(X)===-1&&J._delayInfo.push(X),he[X]=ee)};se("POSITION",m.VertexBuffer.PositionKind),se("NORMAL",m.VertexBuffer.NormalKind),se("TANGENT",m.VertexBuffer.TangentKind),se("TEXCOORD_0",m.VertexBuffer.UVKind),se("TEXCOORD_1",m.VertexBuffer.UV2Kind),se("JOINTS_0",m.VertexBuffer.MatricesIndicesKind),se("WEIGHTS_0",m.VertexBuffer.MatricesWeightsKind),se("COLOR_0",m.VertexBuffer.ColorKind);var q=S.a.Get(G,B._loader.gltf.bufferViews,$.bufferView);return q._dracoBabylonGeometry||(q._dracoBabylonGeometry=B._loader.loadBufferViewAsync("/bufferViews/"+q.index,q).then(function(H){return(B.dracoCompression||m.DracoCompression.Default).decodeMeshAsync(H,he).then(function(X){var ee=new m.Geometry(J.name,B._loader.babylonScene);return X.applyToGeometry(ee),ee}).catch(function(X){throw new Error(oe+": "+X.message)})})),q._dracoBabylonGeometry})},ue}();S.b.RegisterExtension("KHR_draco_mesh_compression",function(ue){return new b(ue)});var f=function(){function ue(oe){this.name="KHR_lights_punctual",this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_lights_punctual")}return ue.prototype.dispose=function(){this._loader=null,delete this._lights},ue.prototype.onLoading=function(){var oe=this._loader.gltf.extensions;if(oe&&oe[this.name]){var Z=oe[this.name];this._lights=Z.lights}},ue.prototype.loadNodeAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){return B._loader.loadNodeAsync(oe,Z,function(he){var se,q=S.a.Get(G,B._lights,$.light),H=q.name||he.name;switch(B._loader.babylonScene._blockEntityCollection=B._loader._forAssetContainer,q.type){case"directional":se=new m.DirectionalLight(H,m.Vector3.Backward(),B._loader.babylonScene);break;case"point":se=new m.PointLight(H,m.Vector3.Zero(),B._loader.babylonScene);break;case"spot":var X=new m.SpotLight(H,m.Vector3.Zero(),m.Vector3.Backward(),0,1,B._loader.babylonScene);X.angle=2*(q.spot&&q.spot.outerConeAngle||Math.PI/4),X.innerAngle=2*(q.spot&&q.spot.innerConeAngle||0),se=X;break;default:throw B._loader.babylonScene._blockEntityCollection=!1,new Error(G+": Invalid light type ("+q.type+")")}B._loader.babylonScene._blockEntityCollection=!1,se.falloffType=m.Light.FALLOFF_GLTF,se.diffuse=q.color?m.Color3.FromArray(q.color):m.Color3.White(),se.intensity=q.intensity==null?1:q.intensity,se.range=q.range==null?Number.MAX_VALUE:q.range,se.parent=he,B._loader._babylonLights.push(se),S.b.AddPointerMetadata(se,G),J(he)})})},ue}();S.b.RegisterExtension("KHR_lights_punctual",function(ue){return new f(ue)});var x=function(){function ue(oe){this.name="KHR_materials_pbrSpecularGlossiness",this.order=200,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_pbrSpecularGlossiness")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialBasePropertiesAsync(oe,Z,J)),he.push(B._loadSpecularGlossinessPropertiesAsync(G,Z,$,J)),B._loader.loadMaterialAlphaProperties(oe,Z,J),Promise.all(he).then(function(){})})},ue.prototype._loadSpecularGlossinessPropertiesAsync=function(oe,Z,J,B){if(!(B instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var G=new Array;return B.metallic=null,B.roughness=null,J.diffuseFactor?(B.albedoColor=m.Color3.FromArray(J.diffuseFactor),B.alpha=J.diffuseFactor[3]):B.albedoColor=m.Color3.White(),B.reflectivityColor=J.specularFactor?m.Color3.FromArray(J.specularFactor):m.Color3.White(),B.microSurface=J.glossinessFactor==null?1:J.glossinessFactor,J.diffuseTexture&&G.push(this._loader.loadTextureInfoAsync(oe+"/diffuseTexture",J.diffuseTexture,function($){$.name=B.name+" (Diffuse)",B.albedoTexture=$})),J.specularGlossinessTexture&&(J.specularGlossinessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(oe+"/specularGlossinessTexture",J.specularGlossinessTexture,function($){$.name=B.name+" (Specular Glossiness)",B.reflectivityTexture=$})),B.reflectivityTexture.hasAlpha=!0,B.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(G).then(function(){})},ue}();S.b.RegisterExtension("KHR_materials_pbrSpecularGlossiness",function(ue){return new x(ue)});var P=function(){function ue(oe){this.name="KHR_materials_unlit",this.order=210,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_unlit")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(){return B._loadUnlitPropertiesAsync(oe,Z,J)})},ue.prototype._loadUnlitPropertiesAsync=function(oe,Z,J){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var B=new Array;J.unlit=!0;var G=Z.pbrMetallicRoughness;return G&&(G.baseColorFactor?(J.albedoColor=m.Color3.FromArray(G.baseColorFactor),J.alpha=G.baseColorFactor[3]):J.albedoColor=m.Color3.White(),G.baseColorTexture&&B.push(this._loader.loadTextureInfoAsync(oe+"/baseColorTexture",G.baseColorTexture,function($){$.name=J.name+" (Base Color)",J.albedoTexture=$}))),Z.doubleSided&&(J.backFaceCulling=!1,J.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(oe,Z,J),Promise.all(B).then(function(){})},ue}();S.b.RegisterExtension("KHR_materials_unlit",function(ue){return new P(ue)});var A=function(){function ue(oe){this.name="KHR_materials_clearcoat",this.order=190,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_clearcoat")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadClearCoatPropertiesAsync(G,$,J)),Promise.all(he).then(function(){})})},ue.prototype._loadClearCoatPropertiesAsync=function(oe,Z,J){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var B=new Array;return J.clearCoat.isEnabled=!0,J.clearCoat.useRoughnessFromMainTexture=!1,J.clearCoat.remapF0OnInterfaceChange=!1,Z.clearcoatFactor!=null?J.clearCoat.intensity=Z.clearcoatFactor:J.clearCoat.intensity=0,Z.clearcoatTexture&&B.push(this._loader.loadTextureInfoAsync(oe+"/clearcoatTexture",Z.clearcoatTexture,function(G){G.name=J.name+" (ClearCoat Intensity)",J.clearCoat.texture=G})),Z.clearcoatRoughnessFactor!=null?J.clearCoat.roughness=Z.clearcoatRoughnessFactor:J.clearCoat.roughness=0,Z.clearcoatRoughnessTexture&&(Z.clearcoatRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(oe+"/clearcoatRoughnessTexture",Z.clearcoatRoughnessTexture,function(G){G.name=J.name+" (ClearCoat Roughness)",J.clearCoat.textureRoughness=G}))),Z.clearcoatNormalTexture&&(Z.clearcoatNormalTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(oe+"/clearcoatNormalTexture",Z.clearcoatNormalTexture,function(G){G.name=J.name+" (ClearCoat Normal)",J.clearCoat.bumpTexture=G})),J.invertNormalMapX=!J.getScene().useRightHandedSystem,J.invertNormalMapY=J.getScene().useRightHandedSystem,Z.clearcoatNormalTexture.scale!=null&&(J.clearCoat.bumpTexture.level=Z.clearcoatNormalTexture.scale)),Promise.all(B).then(function(){})},ue}();S.b.RegisterExtension("KHR_materials_clearcoat",function(ue){return new A(ue)});var T=function(){function ue(oe){this.name="KHR_materials_sheen",this.order=190,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_sheen")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadSheenPropertiesAsync(G,$,J)),Promise.all(he).then(function(){})})},ue.prototype._loadSheenPropertiesAsync=function(oe,Z,J){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var B=new Array;return J.sheen.isEnabled=!0,J.sheen.intensity=1,Z.sheenColorFactor!=null?J.sheen.color=m.Color3.FromArray(Z.sheenColorFactor):J.sheen.color=m.Color3.Black(),Z.sheenColorTexture&&B.push(this._loader.loadTextureInfoAsync(oe+"/sheenColorTexture",Z.sheenColorTexture,function(G){G.name=J.name+" (Sheen Color)",J.sheen.texture=G})),Z.sheenRoughnessFactor!==void 0?J.sheen.roughness=Z.sheenRoughnessFactor:J.sheen.roughness=0,Z.sheenRoughnessTexture&&(Z.sheenRoughnessTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(oe+"/sheenRoughnessTexture",Z.sheenRoughnessTexture,function(G){G.name=J.name+" (Sheen Roughness)",J.sheen.textureRoughness=G}))),J.sheen.albedoScaling=!0,J.sheen.useRoughnessFromMainTexture=!1,Promise.all(B).then(function(){})},ue}();S.b.RegisterExtension("KHR_materials_sheen",function(ue){return new T(ue)});var _=function(){function ue(oe){this.name="KHR_materials_specular",this.order=190,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_specular")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadSpecularPropertiesAsync(G,$,J)),Promise.all(he).then(function(){})})},ue.prototype._loadSpecularPropertiesAsync=function(oe,Z,J){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var B=new Array;return Z.specularFactor!==void 0&&(J.metallicF0Factor=Z.specularFactor),Z.specularColorFactor!==void 0&&(J.metallicReflectanceColor=m.Color3.FromArray(Z.specularColorFactor)),Z.specularTexture&&(Z.specularTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(oe+"/specularTexture",Z.specularTexture,function(G){G.name=J.name+" (Specular F0 Color)",J.metallicReflectanceTexture=G}))),Promise.all(B).then(function(){})},ue}();S.b.RegisterExtension("KHR_materials_specular",function(ue){return new _(ue)});var g=function(){function ue(oe){this.name="KHR_materials_ior",this.order=180,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_ior")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadIorPropertiesAsync(G,$,J)),Promise.all(he).then(function(){})})},ue.prototype._loadIorPropertiesAsync=function(oe,Z,J){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");return Z.ior!==void 0?J.indexOfRefraction=Z.ior:J.indexOfRefraction=ue._DEFAULT_IOR,Promise.resolve()},ue._DEFAULT_IOR=1.5,ue}();S.b.RegisterExtension("KHR_materials_ior",function(ue){return new g(ue)});var M=function(){function ue(oe){this.name="KHR_materials_variants",this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_variants")}return ue.prototype.dispose=function(){this._loader=null},ue.GetAvailableVariants=function(oe){var Z=this._GetExtensionMetadata(oe);return Z?Object.keys(Z.variants):[]},ue.prototype.getAvailableVariants=function(oe){return ue.GetAvailableVariants(oe)},ue.SelectVariant=function(oe,Z){var J=this._GetExtensionMetadata(oe);if(!J)throw new Error("Cannot select variant on a glTF mesh that does not have the KHR_materials_variants extension");var B=function(he){var se=J.variants[he];if(se)for(var q=0,H=se;q<H.length;q++){var X=H[q];X.mesh.material=X.material}};if(Z instanceof Array)for(var G=0,$=Z;G<$.length;G++)B($[G]);else B(Z);J.lastSelected=Z},ue.prototype.selectVariant=function(oe,Z){return ue.SelectVariant(oe,Z)},ue.Reset=function(oe){var Z=this._GetExtensionMetadata(oe);if(!Z)throw new Error("Cannot reset on a glTF mesh that does not have the KHR_materials_variants extension");for(var J=0,B=Z.original;J<B.length;J++){var G=B[J];G.mesh.material=G.material}Z.lastSelected=null},ue.prototype.reset=function(oe){return ue.Reset(oe)},ue.GetLastSelectedVariant=function(oe){var Z=this._GetExtensionMetadata(oe);if(!Z)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the KHR_materials_variants extension");return Z.lastSelected},ue.prototype.getLastSelectedVariant=function(oe){return ue.GetLastSelectedVariant(oe)},ue._GetExtensionMetadata=function(oe){var Z,J;return((J=(Z=oe==null?void 0:oe.metadata)===null||Z===void 0?void 0:Z.gltf)===null||J===void 0?void 0:J.KHR_materials_variants)||null},ue.prototype.onLoading=function(){var oe=this._loader.gltf.extensions;if(oe&&oe[this.name]){var Z=oe[this.name];this._variants=Z.variants}},ue.prototype._loadMeshPrimitiveAsync=function(oe,Z,J,B,G,$){var he=this;return S.b.LoadExtensionAsync(oe,G,this.name,function(se,q){var H=new Array;return H.push(he._loader._loadMeshPrimitiveAsync(oe,Z,J,B,G,function(X){if($(X),X instanceof m.Mesh){var ee=S.b._GetDrawMode(oe,G.mode),Q=he._loader.rootBabylonMesh,te=Q.metadata=Q.metadata||{},ge=te.gltf=te.gltf||{},ce=ge.KHR_materials_variants=ge.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};ce.original.push({mesh:X,material:X.material});for(var de=ce.variants,ne=0,pe=q.mappings;ne<pe.length;ne++)for(var Se=pe[ne],Te=function(Xe){var Ye=S.a.Get(se+"/mapping/"+Xe,he._variants,Xe),Ke=S.a.Get("#/materials/",he._loader.gltf.materials,Se.material);H.push(he._loader._loadMaterialAsync("#/materials/"+Se.material,Ke,X,ee,function(nt){de[Ye.name]=de[Ye.name]||[],de[Ye.name].push({mesh:X,material:nt})}))},Ne=0,je=Se.variants;Ne<je.length;Ne++)Te(je[Ne])}})),Promise.all(H).then(function(X){return X[0]})})},ue}();S.b.RegisterExtension("KHR_materials_variants",function(ue){return new M(ue)});var O=E(4),N=function(){function ue(oe,Z){var J=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._options=Object(O.a)(Object(O.a)({},ue._getDefaultOptions()),oe),this._scene=Z,this._scene._transmissionHelper=this,this.onErrorObservable=new m.Observable,this._scene.onDisposeObservable.addOnce(function(B){J.dispose()}),this._parseScene(),this._setupRenderTargets()}return ue._getDefaultOptions=function(){return{renderSize:512}},ue.prototype.updateOptions=function(oe){var Z=this;if(Object.keys(oe).filter(function(G){return Z._options[G]!==oe[G]}).length){var J=Object(O.a)(Object(O.a)({},this._options),oe),B=this._options;this._options=J,J.renderSize!==B.renderSize&&this._setupRenderTargets()}},ue.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},ue.prototype.shouldRenderAsTransmission=function(oe){return!!oe&&!!(oe instanceof m.PBRMaterial&&oe.subSurface.isRefractionEnabled)},ue.prototype._addMesh=function(oe){oe instanceof m.Mesh&&(oe.onMaterialChangedObservable.add(this.onMeshMaterialChanged.bind(this)),this.shouldRenderAsTransmission(oe.material)?this._transparentMeshesCache.push(oe):this._opaqueMeshesCache.push(oe))},ue.prototype._removeMesh=function(oe){if(oe instanceof m.Mesh){oe.onMaterialChangedObservable.remove(this.onMeshMaterialChanged.bind(this));var Z=this._transparentMeshesCache.indexOf(oe);Z!==-1&&this._transparentMeshesCache.splice(Z,1),(Z=this._opaqueMeshesCache.indexOf(oe))!==-1&&this._opaqueMeshesCache.splice(Z,1)}},ue.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},ue.prototype.onMeshMaterialChanged=function(oe){if(oe instanceof m.Mesh){var Z=this._transparentMeshesCache.indexOf(oe),J=this._opaqueMeshesCache.indexOf(oe);this.shouldRenderAsTransmission(oe.material)?(oe.material instanceof m.PBRMaterial&&(oe.material.subSurface.refractionTexture=this._opaqueRenderTarget),J!==-1?(this._opaqueMeshesCache.splice(J,1),this._transparentMeshesCache.push(oe)):Z===-1&&this._transparentMeshesCache.push(oe)):Z!==-1?(this._transparentMeshesCache.splice(Z,1),this._opaqueMeshesCache.push(oe)):J===-1&&this._opaqueMeshesCache.push(oe)}},ue.prototype._setupRenderTargets=function(){var oe=this,Z=-1;if(this._scene.layers&&this._opaqueRenderTarget)for(var J=0,B=this._scene.layers;J<B.length;J++){var G=(se=B[J]).renderTargetTextures.indexOf(this._opaqueRenderTarget);G>=0&&se.renderTargetTextures.splice(G,1)}if(this._opaqueRenderTarget&&(Z=this._scene.customRenderTargets.indexOf(this._opaqueRenderTarget),this._opaqueRenderTarget.dispose()),this._opaqueRenderTarget=new m.RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,!0),this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.gammaSpace=!0,this._opaqueRenderTarget.lodGenerationScale=1,this._opaqueRenderTarget.lodGenerationOffset=-4,Z>=0?this._scene.customRenderTargets.splice(Z,0,this._opaqueRenderTarget):(Z=this._scene.customRenderTargets.length,this._scene.customRenderTargets.push(this._opaqueRenderTarget)),this._scene.layers&&this._opaqueRenderTarget)for(var $=0,he=this._scene.layers;$<he.length;$++){var se;(se=he[$]).renderTargetTextures.push(this._opaqueRenderTarget)}this._transparentMeshesCache.forEach(function(q){oe.shouldRenderAsTransmission(q.material)&&q.material instanceof m.PBRMaterial&&(q.material.refractionTexture=oe._opaqueRenderTarget)})},ue.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},ue}(),V=function(){function ue(oe){this.name="KHR_materials_transmission",this.order=175,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_transmission"),this.enabled&&(oe.parent.transparencyAsCoverage=!0)}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialBasePropertiesAsync(oe,Z,J)),he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadTransparentPropertiesAsync(G,Z,J,$)),Promise.all(he).then(function(){})})},ue.prototype._loadTransparentPropertiesAsync=function(oe,Z,J,B){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var G=J;if(G.subSurface.isRefractionEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.useAlbedoToTintRefraction=!0,B.transmissionFactor===void 0)return G.subSurface.refractionIntensity=0,G.subSurface.isRefractionEnabled=!1,Promise.resolve();G.subSurface.refractionIntensity=B.transmissionFactor;var $=G.getScene();return G.subSurface.refractionIntensity&&!$._transmissionHelper&&new N({},G.getScene()),B.transmissionTexture?(B.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(oe+"/transmissionTexture",B.transmissionTexture,void 0).then(function(he){G.subSurface.thicknessTexture=he,G.subSurface.useMaskFromThicknessTextureGltf=!0})):Promise.resolve()},ue}();S.b.RegisterExtension("KHR_materials_transmission",function(ue){return new V(ue)});var U=function(){function ue(oe){this.name="KHR_materials_translucency",this.order=175,this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_materials_translucency"),this.enabled&&(oe.parent.transparencyAsCoverage=!0)}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return he.push(B._loader.loadMaterialBasePropertiesAsync(oe,Z,J)),he.push(B._loader.loadMaterialPropertiesAsync(oe,Z,J)),he.push(B._loadTranslucentPropertiesAsync(G,Z,J,$)),Promise.all(he).then(function(){})})},ue.prototype._loadTranslucentPropertiesAsync=function(oe,Z,J,B){if(!(J instanceof m.PBRMaterial))throw new Error(oe+": Material type not supported");var G=J;return G.subSurface.isTranslucencyEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,G.subSurface.useAlbedoToTintRefraction=!0,B.translucencyFactor===void 0?(G.subSurface.translucencyIntensity=0,G.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(G.subSurface.translucencyIntensity=B.translucencyFactor,B.translucencyTexture?this._loader.loadTextureInfoAsync(oe+"/translucencyTexture",B.translucencyTexture).then(function($){G.subSurface.thicknessTexture=$,G.subSurface.useMaskFromThicknessTextureGltf=!0}):Promise.resolve())},ue}();S.b.RegisterExtension("KHR_materials_translucency",function(ue){return new U(ue)});var L=function(){function ue(oe){this.name="KHR_mesh_quantization",this.enabled=oe.isExtensionUsed("KHR_mesh_quantization")}return ue.prototype.dispose=function(){},ue}();S.b.RegisterExtension("KHR_mesh_quantization",function(ue){return new L(ue)});var j=function(){function ue(oe){this.name="KHR_texture_basisu",this._loader=oe,this.enabled=oe.isExtensionUsed("KHR_texture_basisu")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype._loadTextureAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=Z.sampler==null?S.b.DefaultSampler:S.a.Get(oe+"/sampler",B._loader.gltf.samplers,Z.sampler),se=S.a.Get(G+"/source",B._loader.gltf.images,$.source);return B._loader._createTextureAsync(oe,he,se,function(q){J(q)},Z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0)})},ue}();S.b.RegisterExtension("KHR_texture_basisu",function(ue){return new j(ue)});var Y=function(){function ue(oe){this.name="KHR_texture_transform",this._loader=oe,this.enabled=this._loader.isExtensionUsed("KHR_texture_transform")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadTextureInfoAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){return B._loader.loadTextureInfoAsync(oe,Z,function(he){if(!(he instanceof m.Texture))throw new Error(G+": Texture type not supported");$.offset&&(he.uOffset=$.offset[0],he.vOffset=$.offset[1]),he.uRotationCenter=0,he.vRotationCenter=0,$.rotation&&(he.wAng=-$.rotation),$.scale&&(he.uScale=$.scale[0],he.vScale=$.scale[1]),$.texCoord!=null&&(he.coordinatesIndex=$.texCoord),J(he)})})},ue}();S.b.RegisterExtension("KHR_texture_transform",function(ue){return new Y(ue)});var W=function(){function ue(oe){this.name="MSFT_audio_emitter",this._loader=oe,this.enabled=this._loader.isExtensionUsed("MSFT_audio_emitter")}return ue.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},ue.prototype.onLoading=function(){var oe=this._loader.gltf.extensions;if(oe&&oe[this.name]){var Z=oe[this.name];this._clips=Z.clips,this._emitters=Z.emitters,S.a.Assign(this._clips),S.a.Assign(this._emitters)}},ue.prototype.loadSceneAsync=function(oe,Z){var J=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(B,G){var $=new Array;$.push(J._loader.loadSceneAsync(oe,Z));for(var he=0,se=G.emitters;he<se.length;he++){var q=se[he],H=S.a.Get(B+"/emitters",J._emitters,q);if(H.refDistance!=null||H.maxDistance!=null||H.rolloffFactor!=null||H.distanceModel!=null||H.innerAngle!=null||H.outerAngle!=null)throw new Error(B+": Direction or Distance properties are not allowed on emitters attached to a scene");$.push(J._loadEmitterAsync(B+"/emitters/"+H.index,H))}return Promise.all($).then(function(){})})},ue.prototype.loadNodeAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he=new Array;return B._loader.loadNodeAsync(G,Z,function(se){for(var q=function(ee){var Q=S.a.Get(G+"/emitters",B._emitters,ee);he.push(B._loadEmitterAsync(G+"/emitters/"+Q.index,Q).then(function(){for(var te=0,ge=Q._babylonSounds;te<ge.length;te++){var ce=ge[te];ce.attachToMesh(se),Q.innerAngle==null&&Q.outerAngle==null||(ce.setLocalDirectionToMesh(m.Vector3.Forward()),ce.setDirectionalCone(2*m.Tools.ToDegrees(Q.innerAngle==null?Math.PI:Q.innerAngle),2*m.Tools.ToDegrees(Q.outerAngle==null?Math.PI:Q.outerAngle),0))}}))},H=0,X=$.emitters;H<X.length;H++)q(X[H]);J(se)}).then(function(se){return Promise.all(he).then(function(){return se})})})},ue.prototype.loadAnimationAsync=function(oe,Z){var J=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(B,G){return J._loader.loadAnimationAsync(oe,Z).then(function($){var he=new Array;S.a.Assign(G.events);for(var se=0,q=G.events;se<q.length;se++){var H=q[se];he.push(J._loadAnimationEventAsync(B+"/events/"+H.index,oe,Z,H,$))}return Promise.all(he).then(function(){return $})})})},ue.prototype._loadClipAsync=function(oe,Z){if(Z._objectURL)return Z._objectURL;var J;if(Z.uri)J=this._loader.loadUriAsync(oe,Z,Z.uri);else{var B=S.a.Get(oe+"/bufferView",this._loader.gltf.bufferViews,Z.bufferView);J=this._loader.loadBufferViewAsync("/bufferViews/"+B.index,B)}return Z._objectURL=J.then(function(G){return URL.createObjectURL(new Blob([G],{type:Z.mimeType}))}),Z._objectURL},ue.prototype._loadEmitterAsync=function(oe,Z){var J=this;if(Z._babylonSounds=Z._babylonSounds||[],!Z._babylonData){for(var B=new Array,G=Z.name||"emitter"+Z.index,$={loop:!1,autoplay:!1,volume:Z.volume==null?1:Z.volume},he=function(X){var ee="/extensions/"+se.name+"/clips",Q=S.a.Get(ee,se._clips,Z.clips[X].clip);B.push(se._loadClipAsync(ee+"/"+Z.clips[X].clip,Q).then(function(te){var ge=Z._babylonSounds[X]=new m.Sound(G,te,J._loader.babylonScene,null,$);ge.refDistance=Z.refDistance||1,ge.maxDistance=Z.maxDistance||256,ge.rolloffFactor=Z.rolloffFactor||1,ge.distanceModel=Z.distanceModel||"exponential",ge._positionInEmitterSpace=!0}))},se=this,q=0;q<Z.clips.length;q++)he(q);var H=Promise.all(B).then(function(){var X=Z.clips.map(function(Q){return Q.weight||1}),ee=new m.WeightedSound(Z.loop||!1,Z._babylonSounds,X);Z.innerAngle&&(ee.directionalConeInnerAngle=2*m.Tools.ToDegrees(Z.innerAngle)),Z.outerAngle&&(ee.directionalConeOuterAngle=2*m.Tools.ToDegrees(Z.outerAngle)),Z.volume&&(ee.volume=Z.volume),Z._babylonData.sound=ee});Z._babylonData={loaded:H}}return Z._babylonData.loaded},ue.prototype._getEventAction=function(oe,Z,J,B,G){switch(J){case"play":return function($){var he=(G||0)+($-B);Z.play(he)};case"stop":return function($){Z.stop()};case"pause":return function($){Z.pause()};default:throw new Error(oe+": Unsupported action "+J)}},ue.prototype._loadAnimationEventAsync=function(oe,Z,J,B,G){var $=this;if(G.targetedAnimations.length==0)return Promise.resolve();var he=G.targetedAnimations[0],se=B.emitter,q=S.a.Get("/extensions/"+this.name+"/emitters",this._emitters,se);return this._loadEmitterAsync(oe,q).then(function(){var H=q._babylonData.sound;if(H){var X=new m.AnimationEvent(B.time,$._getEventAction(oe,H,B.action,B.time,B.startOffset));he.animation.addEvent(X),G.onAnimationGroupEndObservable.add(function(){H.stop()}),G.onAnimationGroupPauseObservable.add(function(){H.pause()})}})},ue}();S.b.RegisterExtension("MSFT_audio_emitter",function(ue){return new W(ue)});var ie=function(){function ue(oe){this.name="MSFT_lod",this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new m.Observable,this.onMaterialLODsLoadedObservable=new m.Observable,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=oe,this.enabled=this._loader.isExtensionUsed("MSFT_lod")}return ue.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},ue.prototype.onReady=function(){for(var oe=this,Z=function(he){var se=Promise.all(J._nodePromiseLODs[he]).then(function(){he!==0&&(oe._loader.endPerformanceCounter("Node LOD "+he),oe._loader.log("Loaded node LOD "+he)),oe.onNodeLODsLoadedObservable.notifyObservers(he),he!==oe._nodePromiseLODs.length-1&&(oe._loader.startPerformanceCounter("Node LOD "+(he+1)),oe._loadBufferLOD(oe._nodeBufferLODs,he+1),oe._nodeSignalLODs[he]&&oe._nodeSignalLODs[he].resolve())});J._loader._completePromises.push(se)},J=this,B=0;B<this._nodePromiseLODs.length;B++)Z(B);var G=function(he){var se=Promise.all($._materialPromiseLODs[he]).then(function(){he!==0&&(oe._loader.endPerformanceCounter("Material LOD "+he),oe._loader.log("Loaded material LOD "+he)),oe.onMaterialLODsLoadedObservable.notifyObservers(he),he!==oe._materialPromiseLODs.length-1&&(oe._loader.startPerformanceCounter("Material LOD "+(he+1)),oe._loadBufferLOD(oe._materialBufferLODs,he+1),oe._materialSignalLODs[he]&&oe._materialSignalLODs[he].resolve())});$._loader._completePromises.push(se)},$=this;for(B=0;B<this._materialPromiseLODs.length;B++)G(B)},ue.prototype.loadSceneAsync=function(oe,Z){var J=this._loader.loadSceneAsync(oe,Z);return this._loadBufferLOD(this._bufferLODs,0),J},ue.prototype.loadNodeAsync=function(oe,Z,J){var B=this;return S.b.LoadExtensionAsync(oe,Z,this.name,function(G,$){var he,se=B._getLODs(G,Z,B._loader.gltf.nodes,$.ids);B._loader.logOpen(""+G);for(var q=function(X){var ee=se[X];X!==0&&(B._nodeIndexLOD=X,B._nodeSignalLODs[X]=B._nodeSignalLODs[X]||new m.Deferred);var Q=B._loader.loadNodeAsync("/nodes/"+ee.index,ee,function(te){te.setEnabled(!1)}).then(function(te){if(X!==0){var ge=se[X-1];ge._babylonTransformNode&&(B._disposeTransformNode(ge._babylonTransformNode),delete ge._babylonTransformNode)}return te.setEnabled(!0),te});B._nodePromiseLODs[X]=B._nodePromiseLODs[X]||[],X===0?he=Q:(B._nodeIndexLOD=null,B._nodePromiseLODs[X].push(Q))},H=0;H<se.length;H++)q(H);return B._loader.logClose(),he})},ue.prototype._loadMaterialAsync=function(oe,Z,J,B,G){var $=this;return this._nodeIndexLOD?null:S.b.LoadExtensionAsync(oe,Z,this.name,function(he,se){var q,H=$._getLODs(he,Z,$._loader.gltf.materials,se.ids);$._loader.logOpen(""+he);for(var X=function(Q){var te=H[Q];Q!==0&&($._materialIndexLOD=Q);var ge=$._loader._loadMaterialAsync("/materials/"+te.index,te,J,B,function(ce){Q===0&&G(ce)}).then(function(ce){if(Q!==0){G(ce);var de=H[Q-1]._data;de[B]&&($._disposeMaterials([de[B].babylonMaterial]),delete de[B])}return ce});$._materialPromiseLODs[Q]=$._materialPromiseLODs[Q]||[],Q===0?q=ge:($._materialIndexLOD=null,$._materialPromiseLODs[Q].push(ge))},ee=0;ee<H.length;ee++)X(ee);return $._loader.logClose(),q})},ue.prototype._loadUriAsync=function(oe,Z,J){var B=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var G=this._nodeIndexLOD-1;return this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new m.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return B._loader.loadUriAsync(oe,Z,J)})}return this._materialIndexLOD!==null?(this._loader.log("deferred"),G=this._materialIndexLOD-1,this._materialSignalLODs[G]=this._materialSignalLODs[G]||new m.Deferred,this._materialSignalLODs[G].promise.then(function(){return B._loader.loadUriAsync(oe,Z,J)})):null},ue.prototype.loadBufferAsync=function(oe,Z,J,B){if(this._loader.parent.useRangeRequests&&!Z.uri){if(!this._loader.bin)throw new Error(oe+": Uri is missing or the binary glTF is missing its binary chunk");var G=function($,he){var se=J,q=se+B-1,H=$[he];return H?(H.start=Math.min(H.start,se),H.end=Math.max(H.end,q)):(H={start:se,end:q,loaded:new m.Deferred},$[he]=H),H.loaded.promise.then(function(X){return new Uint8Array(X.buffer,X.byteOffset+J-H.start,B)})};return this._loader.log("deferred"),this._nodeIndexLOD!==null?G(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?G(this._materialBufferLODs,this._materialIndexLOD):G(this._bufferLODs,0)}return null},ue.prototype._loadBufferLOD=function(oe,Z){var J=oe[Z];J&&(this._loader.log("Loading buffer range ["+J.start+"-"+J.end+"]"),this._loader.bin.readAsync(J.start,J.end-J.start+1).then(function(B){J.loaded.resolve(B)},function(B){J.loaded.reject(B)}))},ue.prototype._getLODs=function(oe,Z,J,B){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var G=new Array,$=B.length-1;$>=0;$--)if(G.push(S.a.Get(oe+"/ids/"+B[$],J,B[$])),G.length===this.maxLODsToLoad)return G;return G.push(Z),G},ue.prototype._disposeTransformNode=function(oe){var Z=this,J=new Array,B=oe.material;B&&J.push(B);for(var G=0,$=oe.getChildMeshes();G<$.length;G++){var he=$[G];he.material&&J.push(he.material)}oe.dispose();var se=J.filter(function(q){return Z._loader.babylonScene.meshes.every(function(H){return H.material!=q})});this._disposeMaterials(se)},ue.prototype._disposeMaterials=function(oe){for(var Z={},J=0,B=oe;J<B.length;J++){for(var G=0,$=(X=B[J]).getActiveTextures();G<$.length;G++){var he=$[G];Z[he.uniqueId]=he}X.dispose()}for(var se in Z)for(var q=0,H=this._loader.babylonScene.materials;q<H.length;q++){var X;(X=H[q]).hasTexture(Z[se])&&delete Z[se]}for(var se in Z)Z[se].dispose()},ue}();S.b.RegisterExtension("MSFT_lod",function(ue){return new ie(ue)});var re=function(){function ue(oe){this.name="MSFT_minecraftMesh",this._loader=oe,this.enabled=this._loader.isExtensionUsed("MSFT_minecraftMesh")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtraAsync(oe,Z,this.name,function(G,$){if($){if(!(J instanceof m.PBRMaterial))throw new Error(G+": Material type not supported");var he=B._loader.loadMaterialPropertiesAsync(oe,Z,J);return J.needAlphaBlending()&&(J.forceDepthWrite=!0,J.separateCullingPass=!0),J.backFaceCulling=J.forceDepthWrite,J.twoSidedLighting=!0,he}return null})},ue}();S.b.RegisterExtension("MSFT_minecraftMesh",function(ue){return new re(ue)});var ye=function(){function ue(oe){this.name="MSFT_sRGBFactors",this._loader=oe,this.enabled=this._loader.isExtensionUsed("MSFT_sRGBFactors")}return ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadMaterialPropertiesAsync=function(oe,Z,J){var B=this;return S.b.LoadExtraAsync(oe,Z,this.name,function(G,$){if($){if(!(J instanceof m.PBRMaterial))throw new Error(G+": Material type not supported");var he=B._loader.loadMaterialPropertiesAsync(oe,Z,J);return J.albedoTexture||J.albedoColor.toLinearSpaceToRef(J.albedoColor),J.reflectivityTexture||J.reflectivityColor.toLinearSpaceToRef(J.reflectivityColor),he}return null})},ue}();S.b.RegisterExtension("MSFT_sRGBFactors",function(ue){return new ye(ue)});var ve=function(){function ue(oe){this.name="ExtrasAsMetadata",this.enabled=!0,this._loader=oe}return ue.prototype._assignExtras=function(oe,Z){if(Z.extras&&Object.keys(Z.extras).length>0){var J=oe.metadata=oe.metadata||{};(J.gltf=J.gltf||{}).extras=Z.extras}},ue.prototype.dispose=function(){this._loader=null},ue.prototype.loadNodeAsync=function(oe,Z,J){var B=this;return this._loader.loadNodeAsync(oe,Z,function(G){B._assignExtras(G,Z),J(G)})},ue.prototype.loadCameraAsync=function(oe,Z,J){var B=this;return this._loader.loadCameraAsync(oe,Z,function(G){B._assignExtras(G,Z),J(G)})},ue.prototype.createMaterial=function(oe,Z,J){var B=this._loader.createMaterial(oe,Z,J);return this._assignExtras(B,Z),B},ue}();S.b.RegisterExtension("ExtrasAsMetadata",function(ue){return new ve(ue)})},function(s,c,E){E.r(c),E.d(c,"GLTFBinaryExtension",function(){return X}),E.d(c,"GLTFLoaderBase",function(){return se}),E.d(c,"GLTFLoader",function(){return q}),E.d(c,"GLTFLoaderExtension",function(){return H}),E.d(c,"EComponentType",function(){return m}),E.d(c,"EShaderType",function(){return S}),E.d(c,"EParameterType",function(){return h}),E.d(c,"ETextureWrapMode",function(){return C}),E.d(c,"ETextureFilterType",function(){return R}),E.d(c,"ETextureFormat",function(){return I}),E.d(c,"ECullingType",function(){return b}),E.d(c,"EBlendingFunction",function(){return f}),E.d(c,"GLTFUtils",function(){return T}),E.d(c,"GLTFMaterialsCommonExtension",function(){return ee});var m,S,h,C,R,I,b,f,x=E(4);(function(Q){Q[Q.BYTE=5120]="BYTE",Q[Q.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Q[Q.SHORT=5122]="SHORT",Q[Q.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Q[Q.FLOAT=5126]="FLOAT"})(m||(m={})),function(Q){Q[Q.FRAGMENT=35632]="FRAGMENT",Q[Q.VERTEX=35633]="VERTEX"}(S||(S={})),function(Q){Q[Q.BYTE=5120]="BYTE",Q[Q.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",Q[Q.SHORT=5122]="SHORT",Q[Q.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",Q[Q.INT=5124]="INT",Q[Q.UNSIGNED_INT=5125]="UNSIGNED_INT",Q[Q.FLOAT=5126]="FLOAT",Q[Q.FLOAT_VEC2=35664]="FLOAT_VEC2",Q[Q.FLOAT_VEC3=35665]="FLOAT_VEC3",Q[Q.FLOAT_VEC4=35666]="FLOAT_VEC4",Q[Q.INT_VEC2=35667]="INT_VEC2",Q[Q.INT_VEC3=35668]="INT_VEC3",Q[Q.INT_VEC4=35669]="INT_VEC4",Q[Q.BOOL=35670]="BOOL",Q[Q.BOOL_VEC2=35671]="BOOL_VEC2",Q[Q.BOOL_VEC3=35672]="BOOL_VEC3",Q[Q.BOOL_VEC4=35673]="BOOL_VEC4",Q[Q.FLOAT_MAT2=35674]="FLOAT_MAT2",Q[Q.FLOAT_MAT3=35675]="FLOAT_MAT3",Q[Q.FLOAT_MAT4=35676]="FLOAT_MAT4",Q[Q.SAMPLER_2D=35678]="SAMPLER_2D"}(h||(h={})),function(Q){Q[Q.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",Q[Q.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",Q[Q.REPEAT=10497]="REPEAT"}(C||(C={})),function(Q){Q[Q.NEAREST=9728]="NEAREST",Q[Q.LINEAR=9728]="LINEAR",Q[Q.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",Q[Q.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",Q[Q.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",Q[Q.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(R||(R={})),function(Q){Q[Q.ALPHA=6406]="ALPHA",Q[Q.RGB=6407]="RGB",Q[Q.RGBA=6408]="RGBA",Q[Q.LUMINANCE=6409]="LUMINANCE",Q[Q.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(I||(I={})),function(Q){Q[Q.FRONT=1028]="FRONT",Q[Q.BACK=1029]="BACK",Q[Q.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(b||(b={})),function(Q){Q[Q.ZERO=0]="ZERO",Q[Q.ONE=1]="ONE",Q[Q.SRC_COLOR=768]="SRC_COLOR",Q[Q.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",Q[Q.DST_COLOR=774]="DST_COLOR",Q[Q.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",Q[Q.SRC_ALPHA=770]="SRC_ALPHA",Q[Q.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",Q[Q.DST_ALPHA=772]="DST_ALPHA",Q[Q.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",Q[Q.CONSTANT_COLOR=32769]="CONSTANT_COLOR",Q[Q.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",Q[Q.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",Q[Q.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",Q[Q.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(f||(f={}));var P,A=E(0),T=function(){function Q(){}return Q.SetMatrix=function(te,ge,ce,de,ne){var pe=null;if(ce.semantic==="MODEL"?pe=ge.getWorldMatrix():ce.semantic==="PROJECTION"?pe=te.getProjectionMatrix():ce.semantic==="VIEW"?pe=te.getViewMatrix():ce.semantic==="MODELVIEWINVERSETRANSPOSE"?pe=A.Matrix.Transpose(ge.getWorldMatrix().multiply(te.getViewMatrix()).invert()):ce.semantic==="MODELVIEW"?pe=ge.getWorldMatrix().multiply(te.getViewMatrix()):ce.semantic==="MODELVIEWPROJECTION"?pe=ge.getWorldMatrix().multiply(te.getTransformMatrix()):ce.semantic==="MODELINVERSE"?pe=ge.getWorldMatrix().invert():ce.semantic==="VIEWINVERSE"?pe=te.getViewMatrix().invert():ce.semantic==="PROJECTIONINVERSE"?pe=te.getProjectionMatrix().invert():ce.semantic==="MODELVIEWINVERSE"?pe=ge.getWorldMatrix().multiply(te.getViewMatrix()).invert():ce.semantic==="MODELVIEWPROJECTIONINVERSE"?pe=ge.getWorldMatrix().multiply(te.getTransformMatrix()).invert():ce.semantic==="MODELINVERSETRANSPOSE"&&(pe=A.Matrix.Transpose(ge.getWorldMatrix().invert())),pe)switch(ce.type){case h.FLOAT_MAT2:ne.setMatrix2x2(de,A.Matrix.GetAsMatrix2x2(pe));break;case h.FLOAT_MAT3:ne.setMatrix3x3(de,A.Matrix.GetAsMatrix3x3(pe));break;case h.FLOAT_MAT4:ne.setMatrix(de,pe)}},Q.SetUniform=function(te,ge,ce,de){switch(de){case h.FLOAT:return te.setFloat(ge,ce),!0;case h.FLOAT_VEC2:return te.setVector2(ge,A.Vector2.FromArray(ce)),!0;case h.FLOAT_VEC3:return te.setVector3(ge,A.Vector3.FromArray(ce)),!0;case h.FLOAT_VEC4:return te.setVector4(ge,A.Vector4.FromArray(ce)),!0;default:return!1}},Q.GetWrapMode=function(te){switch(te){case C.CLAMP_TO_EDGE:return A.Texture.CLAMP_ADDRESSMODE;case C.MIRRORED_REPEAT:return A.Texture.MIRROR_ADDRESSMODE;case C.REPEAT:default:return A.Texture.WRAP_ADDRESSMODE}},Q.GetByteStrideFromType=function(te){switch(te.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},Q.GetTextureFilterMode=function(te){switch(te){case R.LINEAR:case R.LINEAR_MIPMAP_NEAREST:case R.LINEAR_MIPMAP_LINEAR:return A.Texture.TRILINEAR_SAMPLINGMODE;case R.NEAREST:case R.NEAREST_MIPMAP_NEAREST:return A.Texture.NEAREST_SAMPLINGMODE;default:return A.Texture.BILINEAR_SAMPLINGMODE}},Q.GetBufferFromBufferView=function(te,ge,ce,de,ne){ce=ge.byteOffset+ce;var pe=te.loadedBufferViews[ge.buffer];if(ce+de>pe.byteLength)throw new Error("Buffer access is out of range");var Se=pe.buffer;switch(ce+=pe.byteOffset,ne){case m.BYTE:return new Int8Array(Se,ce,de);case m.UNSIGNED_BYTE:return new Uint8Array(Se,ce,de);case m.SHORT:return new Int16Array(Se,ce,de);case m.UNSIGNED_SHORT:return new Uint16Array(Se,ce,de);default:return new Float32Array(Se,ce,de)}},Q.GetBufferFromAccessor=function(te,ge){var ce=te.bufferViews[ge.bufferView],de=ge.count*Q.GetByteStrideFromType(ge);return Q.GetBufferFromBufferView(te,ce,ge.byteOffset,de,ge.componentType)},Q.DecodeBufferToText=function(te){for(var ge="",ce=te.byteLength,de=0;de<ce;++de)ge+=String.fromCharCode(te[de]);return ge},Q.GetDefaultMaterial=function(te){if(!Q._DefaultMaterial){A.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),A.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var ge={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};Q._DefaultMaterial=new A.ShaderMaterial("GLTFDefaultMaterial",te,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},ge),Q._DefaultMaterial.setColor4("u_emission",new A.Color4(.5,.5,.5,1))}return Q._DefaultMaterial},Q._DefaultMaterial=null,Q}(),_=E(2);(function(Q){Q[Q.IDENTIFIER=1]="IDENTIFIER",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.END_OF_INPUT=3]="END_OF_INPUT"})(P||(P={}));var g=function(){function Q(te){this._pos=0,this.currentToken=P.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=te,this._maxPos=te.length}return Q.prototype.getNextToken=function(){if(this.isEnd())return P.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=P.UNKNOWN,this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=P.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_");)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},Q.prototype.peek=function(){return this._toParse[this._pos]},Q.prototype.read=function(){return this._toParse[this._pos++]},Q.prototype.forward=function(){this._pos++},Q.prototype.isEnd=function(){return this._pos>=this._maxPos},Q}(),M=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],O=["world","view","projection","worldView","worldViewProjection","mBones"],N=["translation","rotation","scale"],V=["position","rotationQuaternion","scaling"],U=function(Q,te,ge){for(var ce in Q){var de=Q[ce];ge[te][ce]=de}},L=function(Q){if(Q)for(var te=0;te<Q.length/2;te++)Q[2*te+1]=1-Q[2*te+1]},j=function(Q){if(Q.semantic==="NORMAL")return"normal";if(Q.semantic==="POSITION")return"position";if(Q.semantic==="JOINT")return"matricesIndices";if(Q.semantic==="WEIGHT")return"matricesWeights";if(Q.semantic==="COLOR")return"color";if(Q.semantic&&Q.semantic.indexOf("TEXCOORD_")!==-1){var te=Number(Q.semantic.split("_")[1]);return"uv"+(te===0?"":te+1)}return null},Y=function(Q){var te=null;if(Q.translation||Q.rotation||Q.scale){var ge=A.Vector3.FromArray(Q.scale||[1,1,1]),ce=A.Quaternion.FromArray(Q.rotation||[0,0,0,1]),de=A.Vector3.FromArray(Q.translation||[0,0,0]);te=A.Matrix.Compose(ge,ce,de)}else te=A.Matrix.FromArray(Q.matrix);return te},W=function(Q,te,ge,ce){for(var de=0;de<ce.bones.length;de++)if(ce.bones[de].name===ge)return ce.bones[de];var ne=Q.nodes;for(var pe in ne){var Se=ne[pe];if(Se.jointName){var Te=Se.children;for(de=0;de<Te.length;de++){var Ne=Q.nodes[Te[de]];if(Ne.jointName&&Ne.jointName===ge){var je=Y(Se),Xe=new A.Bone(Se.name||"",ce,W(Q,te,Se.jointName,ce),je);return Xe.id=pe,Xe}}}}return null},ie=function(Q,te){for(var ge=0;ge<Q.length;ge++)for(var ce=Q[ge],de=0;de<ce.node.children.length;de++)if(ce.node.children[de]===te)return ce.bone;return null},re=function(Q,te){var ge=Q.nodes,ce=ge[te];if(ce)return{node:ce,id:te};for(var de in ge)if((ce=ge[de]).jointName===te)return{node:ce,id:de};return null},ye=function(Q,te){for(var ge=0;ge<Q.jointNames.length;ge++)if(Q.jointNames[ge]===te)return!0;return!1},ve=function(Q,te,ge,ce,de){if(ce||(ce=new A.Skeleton(te.name||"","",Q.scene)),!te.babylonSkeleton)return ce;var ne=[],pe=[];(function(At,wt,Qt,Wt){for(var Ft in At.nodes){var Ht=At.nodes[Ft],fn=Ft;if(Ht.jointName&&!ye(Qt,Ht.jointName)){var un=Y(Ht),wn=new A.Bone(Ht.name||"",wt,null,un);wn.id=fn,Wt.push({bone:wn,node:Ht,id:fn})}}for(var Fe=0;Fe<Wt.length;Fe++)for(var gr=Wt[Fe],On=gr.node.children,$n=0;$n<On.length;$n++){for(var He=null,jn=0;jn<Wt.length;jn++)if(Wt[jn].id===On[$n]){He=Wt[jn];break}He&&(He.bone._parent=gr.bone,gr.bone.children.push(He.bone))}})(Q,ce,te,ne),ce.bones=[];for(var Se=0;Se<te.jointNames.length;Se++)if(gt=re(Q,te.jointNames[Se])){var Te=gt.node;if(Te){de=gt.id;var Ne=Q.scene.getBoneByID(de);if(Ne)ce.bones.push(Ne);else{for(var je=!1,Xe=null,Ye=0;Ye<Se;Ye++){var Ke=re(Q,te.jointNames[Ye]);if(Ke){var nt=Ke.node;if(nt){var qe=nt.children;if(qe){je=!1;for(var ct=0;ct<qe.length;ct++)if(qe[ct]===de){Xe=W(Q,te,te.jointNames[Ye],ce),je=!0;break}if(je)break}}else A.Tools.Warn("Joint named "+te.jointNames[Ye]+" does not exist when looking for parent")}}var ot=Y(Te);!Xe&&ne.length>0&&(Xe=ie(ne,de))&&pe.indexOf(Xe)===-1&&pe.push(Xe),new A.Bone(Te.jointName||"",ce,Xe,ot).id=de}}else A.Tools.Warn("Joint named "+te.jointNames[Se]+" does not exist")}var _t=ce.bones;for(ce.bones=[],Se=0;Se<te.jointNames.length;Se++){var gt;if(gt=re(Q,te.jointNames[Se])){for(Ye=0;Ye<_t.length;Ye++)if(_t[Ye].id===gt.id){ce.bones.push(_t[Ye]);break}}}for(ce.prepare(),Se=0;Se<pe.length;Se++)ce.bones.push(pe[Se]);return ce},ue=function(Q,te,ge,ce,de){if(de||(Q.scene._blockEntityCollection=Q.forAssetContainer,de=new A.Mesh(te.name||"",Q.scene),Q.scene._blockEntityCollection=!1,de.id=ce),!te.babylonNode)return de;for(var ne,pe=[],Se=null,Te=new Array,Ne=new Array,je=new Array,Xe=new Array,Ye=0;Ye<ge.length;Ye++){var Ke=ge[Ye];if(wn=Q.meshes[Ke])for(var nt=0;nt<wn.primitives.length;nt++){var qe=new A.VertexData,ct=wn.primitives[nt];ct.mode;var ot=ct.attributes,_t=null,gt=null;for(var At in ot)if(_t=Q.accessors[ot[At]],gt=T.GetBufferFromAccessor(Q,_t),At==="NORMAL")qe.normals=new Float32Array(gt.length),qe.normals.set(gt);else if(At==="POSITION"){if(_.GLTFFileLoader.HomogeneousCoordinates){qe.positions=new Float32Array(gt.length-gt.length/4);for(var wt=0;wt<gt.length;wt+=4)qe.positions[wt]=gt[wt],qe.positions[wt+1]=gt[wt+1],qe.positions[wt+2]=gt[wt+2]}else qe.positions=new Float32Array(gt.length),qe.positions.set(gt);Ne.push(qe.positions.length)}else if(At.indexOf("TEXCOORD_")!==-1){var Qt=Number(At.split("_")[1]),Wt=A.VertexBuffer.UVKind+(Qt===0?"":Qt+1),Ft=new Float32Array(gt.length);Ft.set(gt),L(Ft),qe.set(Ft,Wt)}else At==="JOINT"?(qe.matricesIndices=new Float32Array(gt.length),qe.matricesIndices.set(gt)):At==="WEIGHT"?(qe.matricesWeights=new Float32Array(gt.length),qe.matricesWeights.set(gt)):At==="COLOR"&&(qe.colors=new Float32Array(gt.length),qe.colors.set(gt));if(_t=Q.accessors[ct.indices])gt=T.GetBufferFromAccessor(Q,_t),qe.indices=new Int32Array(gt.length),qe.indices.set(gt),Xe.push(qe.indices.length);else{var Ht=[];for(wt=0;wt<qe.positions.length/3;wt++)Ht.push(wt);qe.indices=new Int32Array(Ht),Xe.push(qe.indices.length)}Se?Se.merge(qe):Se=qe;var fn=Q.scene.getMaterialByID(ct.material);pe.push(fn===null?T.GetDefaultMaterial(Q.scene):fn),Te.push(Te.length===0?0:Te[Te.length-1]+Ne[Ne.length-2]),je.push(je.length===0?0:je[je.length-1]+Xe[Xe.length-2])}}Q.scene._blockEntityCollection=Q.forAssetContainer,pe.length>1?(ne=new A.MultiMaterial("multimat"+ce,Q.scene)).subMaterials=pe:ne=new A.StandardMaterial("multimat"+ce,Q.scene),pe.length===1&&(ne=pe[0]),de.material||(de.material=ne),new A.Geometry(ce,Q.scene,Se,!1,de),de.computeWorldMatrix(!0),Q.scene._blockEntityCollection=!1,de.subMeshes=[];var un=0;for(Ye=0;Ye<ge.length;Ye++){var wn;if(Ke=ge[Ye],wn=Q.meshes[Ke])for(nt=0;nt<wn.primitives.length;nt++)wn.primitives[nt].mode,A.SubMesh.AddToMesh(un,Te[un],Ne[un],je[un],Xe[un],de,de,!0),un++}return de},oe=function(Q,te,ge,ce){Q.position&&(Q.position=te),(Q.rotationQuaternion||Q.rotation)&&(Q.rotationQuaternion=ge),Q.scaling&&(Q.scaling=ce)},Z=function(Q,te,ge,ce){var de=null;if(Q.importOnlyMeshes&&(te.skin||te.meshes)&&Q.importMeshesNames&&Q.importMeshesNames.length>0&&Q.importMeshesNames.indexOf(te.name||"")===-1)return null;if(te.skin){if(te.meshes){var ne=Q.skins[te.skin];(pe=ue(Q,te,te.meshes,ge,te.babylonNode)).skeleton=Q.scene.getLastSkeletonByID(te.skin),pe.skeleton===null&&(pe.skeleton=ve(Q,ne,0,ne.babylonSkeleton,te.skin),ne.babylonSkeleton||(ne.babylonSkeleton=pe.skeleton)),de=pe}}else if(te.meshes){var pe;de=pe=ue(Q,te,te.mesh?[te.mesh]:te.meshes,ge,te.babylonNode)}else if(!te.light||te.babylonNode||Q.importOnlyMeshes){if(te.camera&&!te.babylonNode&&!Q.importOnlyMeshes){var Se=Q.cameras[te.camera];if(Se){if(Q.scene._blockEntityCollection=Q.forAssetContainer,Se.type==="orthographic"){var Te=new A.FreeCamera(te.camera,A.Vector3.Zero(),Q.scene,!1);Te.name=te.name||"",Te.mode=A.Camera.ORTHOGRAPHIC_CAMERA,Te.attachControl(),de=Te}else if(Se.type==="perspective"){var Ne=Se[Se.type],je=new A.FreeCamera(te.camera,A.Vector3.Zero(),Q.scene,!1);je.name=te.name||"",je.attachControl(),Ne.aspectRatio||(Ne.aspectRatio=Q.scene.getEngine().getRenderWidth()/Q.scene.getEngine().getRenderHeight()),Ne.znear&&Ne.zfar&&(je.maxZ=Ne.zfar,je.minZ=Ne.znear),de=je}Q.scene._blockEntityCollection=!1}}}else{var Xe=Q.lights[te.light];if(Xe){if(Xe.type==="ambient"){var Ye=Xe[Xe.type],Ke=new A.HemisphericLight(te.light,A.Vector3.Zero(),Q.scene);Ke.name=te.name||"",Ye.color&&(Ke.diffuse=A.Color3.FromArray(Ye.color)),de=Ke}else if(Xe.type==="directional"){var nt=Xe[Xe.type],qe=new A.DirectionalLight(te.light,A.Vector3.Zero(),Q.scene);qe.name=te.name||"",nt.color&&(qe.diffuse=A.Color3.FromArray(nt.color)),de=qe}else if(Xe.type==="point"){var ct=Xe[Xe.type],ot=new A.PointLight(te.light,A.Vector3.Zero(),Q.scene);ot.name=te.name||"",ct.color&&(ot.diffuse=A.Color3.FromArray(ct.color)),de=ot}else if(Xe.type==="spot"){var _t=Xe[Xe.type],gt=new A.SpotLight(te.light,A.Vector3.Zero(),A.Vector3.Zero(),0,0,Q.scene);gt.name=te.name||"",_t.color&&(gt.diffuse=A.Color3.FromArray(_t.color)),_t.fallOfAngle&&(gt.angle=_t.fallOfAngle),_t.fallOffExponent&&(gt.exponent=_t.fallOffExponent),de=gt}}}if(!te.jointName){if(te.babylonNode)return te.babylonNode;if(de===null){Q.scene._blockEntityCollection=Q.forAssetContainer;var At=new A.Mesh(te.name||"",Q.scene);Q.scene._blockEntityCollection=!1,te.babylonNode=At,de=At}}if(de!==null){if(te.matrix&&de instanceof A.Mesh)(function(Ft,Ht,fn){if(Ht.matrix){var un=new A.Vector3(0,0,0),wn=new A.Quaternion,Fe=new A.Vector3(0,0,0);A.Matrix.FromArray(Ht.matrix).decompose(Fe,wn,un),oe(Ft,un,wn,Fe)}else Ht.translation&&Ht.rotation&&Ht.scale&&oe(Ft,A.Vector3.FromArray(Ht.translation),A.Quaternion.FromArray(Ht.rotation),A.Vector3.FromArray(Ht.scale));Ft.computeWorldMatrix(!0)})(de,te);else{var wt=te.translation||[0,0,0],Qt=te.rotation||[0,0,0,1],Wt=te.scale||[1,1,1];oe(de,A.Vector3.FromArray(wt),A.Quaternion.FromArray(Qt),A.Vector3.FromArray(Wt))}de.updateCache(!0),te.babylonNode=de}return de},J=function(Q,te,ge,ce){ce===void 0&&(ce=!1);var de=Q.nodes[te],ne=null;if(ce=!(Q.importOnlyMeshes&&!ce&&Q.importMeshesNames)||Q.importMeshesNames.indexOf(de.name||"")!==-1||Q.importMeshesNames.length===0,!de.jointName&&ce&&(ne=Z(Q,de,te))!==null&&(ne.id=te,ne.parent=ge),de.children)for(var pe=0;pe<de.children.length;pe++)J(Q,de.children[pe],ne,ce)},B=function(Q){var te=Q.currentScene;if(te)for(var ge=0;ge<te.nodes.length;ge++)J(Q,te.nodes[ge],null);else for(var ce in Q.scenes)for(te=Q.scenes[ce],ge=0;ge<te.nodes.length;ge++)J(Q,te.nodes[ge],null);for(function(ne){for(var pe in ne.animations){var Se=ne.animations[pe];if(Se.channels&&Se.samplers)for(var Te=null,Ne=0;Ne<Se.channels.length;Ne++){var je=Se.channels[Ne],Xe=Se.samplers[je.sampler];if(Xe){var Ye=null,Ke=null;Se.parameters?(Ye=Se.parameters[Xe.input],Ke=Se.parameters[Xe.output]):(Ye=Xe.input,Ke=Xe.output);var nt=T.GetBufferFromAccessor(ne,ne.accessors[Ye]),qe=T.GetBufferFromAccessor(ne,ne.accessors[Ke]),ct=je.target.id,ot=ne.scene.getNodeByID(ct);if(ot===null&&(ot=ne.scene.getNodeByName(ct)),ot!==null){var _t=ot instanceof A.Bone,gt=je.target.path,At=N.indexOf(gt);At!==-1&&(gt=V[At]);var wt=A.Animation.ANIMATIONTYPE_MATRIX;_t||(gt==="rotationQuaternion"?(wt=A.Animation.ANIMATIONTYPE_QUATERNION,ot.rotationQuaternion=new A.Quaternion):wt=A.Animation.ANIMATIONTYPE_VECTOR3);var Qt=null,Wt=[],Ft=0,Ht=!1;_t&&Te&&Te.getKeys().length===nt.length&&(Qt=Te,Ht=!0),Ht||(ne.scene._blockEntityCollection=ne.forAssetContainer,Qt=new A.Animation(pe,_t?"_matrix":gt,1,wt,A.Animation.ANIMATIONLOOPMODE_CYCLE),ne.scene._blockEntityCollection=!1);for(var fn=0;fn<nt.length;fn++){var un=null;if(gt==="rotationQuaternion"?(un=A.Quaternion.FromArray([qe[Ft],qe[Ft+1],qe[Ft+2],qe[Ft+3]]),Ft+=4):(un=A.Vector3.FromArray([qe[Ft],qe[Ft+1],qe[Ft+2]]),Ft+=3),_t){var wn=ot,Fe=A.Vector3.Zero(),gr=new A.Quaternion,On=A.Vector3.Zero(),$n=wn.getBaseMatrix();Ht&&Te&&($n=Te.getKeys()[fn].value),$n.decompose(On,gr,Fe),gt==="position"?Fe=un:gt==="rotationQuaternion"?gr=un:On=un,un=A.Matrix.Compose(On,gr,Fe)}Ht?Te&&(Te.getKeys()[fn].value=un):Wt.push({frame:nt[fn],value:un})}!Ht&&Qt&&(Qt.setKeys(Wt),ot.animations.push(Qt)),Te=Qt,ne.scene.stopAnimation(ot),ne.scene.beginAnimation(ot,0,nt[nt.length-1],!0,1)}else A.Tools.Warn("Creating animation named "+pe+". But cannot find node named "+ct+" to attach to")}}}}(Q),ge=0;ge<Q.scene.skeletons.length;ge++){var de=Q.scene.skeletons[ge];Q.scene.beginAnimation(de,0,Number.MAX_VALUE,!0,1)}},G=function(Q,te,ge,ce,de,ne){return function(pe){(function(Se,Te,Ne,je,Xe){var Ye=je.values||Ne.parameters,Ke=Ne.uniforms;for(var nt in Xe){var qe=Xe[nt],ct=qe.type,ot=Ye[Ke[nt]];if(ot===void 0&&(ot=qe.value),ot){var _t=function(gt){return function(At){qe.value&&gt&&(Te.setTexture(gt,At),delete Xe[gt])}};ct===h.SAMPLER_2D?H.LoadTextureAsync(Se,je.values?ot:qe.value,_t(nt),function(){return _t(null)}):qe.value&&T.SetUniform(Te,nt,je.values?ot:qe.value,ct)&&delete Xe[nt]}}})(Q,te,ge,ce,de),te.onBind=function(Se){(function(Te,Ne,je,Xe,Ye,Ke,nt){var qe=Ke.values||Ye.parameters;for(var ct in je){var ot=je[ct],_t=ot.type;if(_t===h.FLOAT_MAT2||_t===h.FLOAT_MAT3||_t===h.FLOAT_MAT4)if(!ot.semantic||ot.source||ot.node){if(ot.semantic&&(ot.source||ot.node)){var gt=Ne.scene.getNodeByName(ot.source||ot.node||"");if(gt===null&&(gt=Ne.scene.getNodeByID(ot.source||ot.node||"")),gt===null)continue;T.SetMatrix(Ne.scene,gt,ot,ct,Xe.getEffect())}}else T.SetMatrix(Ne.scene,Te,ot,ct,Xe.getEffect());else{var At=qe[Ye.uniforms[ct]];if(!At)continue;if(_t===h.SAMPLER_2D){var wt=Ne.textures[Ke.values?At:ot.value].babylonTexture;if(wt==null)continue;Xe.getEffect().setTexture(ct,wt)}else T.SetUniform(Xe.getEffect(),ct,At,_t)}}nt(Xe)})(Se,Q,de,te,ge,ce,ne)}}},$=function(Q,te,ge){for(var ce in te.uniforms){var de=te.uniforms[ce],ne=te.parameters[de];if(Q.currentIdentifier===ce&&ne.semantic&&!ne.source&&!ne.node){var pe=M.indexOf(ne.semantic);if(pe!==-1)return delete ge[ce],O[pe]}}return Q.currentIdentifier},he=function(Q){for(var te in Q.materials)H.LoadMaterialAsync(Q,te,function(ge){},function(){})},se=function(){function Q(){}return Q.CreateRuntime=function(te,ge,ce){var de={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:ge,rootUrl:ce,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],forAssetContainer:!1};return te.extensions&&U(te.extensions,"extensions",de),te.extensionsUsed&&U(te.extensionsUsed,"extensionsUsed",de),te.buffers&&function(ne,pe){for(var Se in ne){var Te=ne[Se];pe.buffers[Se]=Te,pe.buffersCount++}}(te.buffers,de),te.bufferViews&&U(te.bufferViews,"bufferViews",de),te.accessors&&U(te.accessors,"accessors",de),te.meshes&&U(te.meshes,"meshes",de),te.lights&&U(te.lights,"lights",de),te.cameras&&U(te.cameras,"cameras",de),te.nodes&&U(te.nodes,"nodes",de),te.images&&U(te.images,"images",de),te.textures&&U(te.textures,"textures",de),te.shaders&&function(ne,pe){for(var Se in ne){var Te=ne[Se];pe.shaders[Se]=Te,pe.shaderscount++}}(te.shaders,de),te.programs&&U(te.programs,"programs",de),te.samplers&&U(te.samplers,"samplers",de),te.techniques&&U(te.techniques,"techniques",de),te.materials&&U(te.materials,"materials",de),te.animations&&U(te.animations,"animations",de),te.skins&&U(te.skins,"skins",de),te.scenes&&(de.scenes=te.scenes),te.scene&&te.scenes&&(de.currentScene=te.scenes[te.scene]),de},Q.LoadBufferAsync=function(te,ge,ce,de,ne){var pe=te.buffers[ge];A.Tools.IsBase64(pe.uri)?setTimeout(function(){return ce(new Uint8Array(A.Tools.DecodeBase64(pe.uri)))}):A.Tools.LoadFile(te.rootUrl+pe.uri,function(Se){return ce(new Uint8Array(Se))},ne,void 0,!0,function(Se){Se&&de(Se.status+" "+Se.statusText)})},Q.LoadTextureBufferAsync=function(te,ge,ce,de){var ne=te.textures[ge];if(ne&&ne.source)if(ne.babylonTexture)ce(null);else{var pe=te.images[ne.source];A.Tools.IsBase64(pe.uri)?setTimeout(function(){return ce(new Uint8Array(A.Tools.DecodeBase64(pe.uri)))}):A.Tools.LoadFile(te.rootUrl+pe.uri,function(Se){return ce(new Uint8Array(Se))},void 0,void 0,!0,function(Se){Se&&de(Se.status+" "+Se.statusText)})}else de("")},Q.CreateTextureAsync=function(te,ge,ce,de,ne){var pe=te.textures[ge];if(pe.babylonTexture)de(pe.babylonTexture);else{var Se=te.samplers[pe.sampler],Te=Se.minFilter===R.NEAREST_MIPMAP_NEAREST||Se.minFilter===R.NEAREST_MIPMAP_LINEAR||Se.minFilter===R.LINEAR_MIPMAP_NEAREST||Se.minFilter===R.LINEAR_MIPMAP_LINEAR,Ne=A.Texture.BILINEAR_SAMPLINGMODE,je=ce==null?new Blob:new Blob([ce]),Xe=URL.createObjectURL(je),Ye=function(){return URL.revokeObjectURL(Xe)},Ke=new A.Texture(Xe,te.scene,!Te,!0,Ne,Ye,Ye);Se.wrapS!==void 0&&(Ke.wrapU=T.GetWrapMode(Se.wrapS)),Se.wrapT!==void 0&&(Ke.wrapV=T.GetWrapMode(Se.wrapT)),Ke.name=ge,pe.babylonTexture=Ke,de(Ke)}},Q.LoadShaderStringAsync=function(te,ge,ce,de){var ne=te.shaders[ge];if(A.Tools.IsBase64(ne.uri)){var pe=atob(ne.uri.split(",")[1]);ce&&ce(pe)}else A.Tools.LoadFile(te.rootUrl+ne.uri,ce,void 0,void 0,!1,function(Se){Se&&de&&de(Se.status+" "+Se.statusText)})},Q.LoadMaterialAsync=function(te,ge,ce,de){var ne=te.materials[ge];if(ne.technique){var pe=te.techniques[ne.technique];if(!pe){te.scene._blockEntityCollection=te.forAssetContainer;var Se=new A.StandardMaterial(ge,te.scene);return te.scene._blockEntityCollection=!1,Se.diffuseColor=new A.Color3(.5,.5,.5),Se.sideOrientation=A.Material.CounterClockWiseSideOrientation,void ce(Se)}var Te=te.programs[pe.program],Ne=pe.states,je=A.Effect.ShadersStore[Te.vertexShader+"VertexShader"],Xe=A.Effect.ShadersStore[Te.fragmentShader+"PixelShader"],Ye="",Ke="",nt=new g(je),qe=new g(Xe),ct={},ot=[],_t=[],gt=[];for(var At in pe.uniforms){var wt=pe.uniforms[At],Qt=pe.parameters[wt];if(ct[At]=Qt,!Qt.semantic||Qt.node||Qt.source)Qt.type===h.SAMPLER_2D?gt.push(At):ot.push(At);else{var Wt=M.indexOf(Qt.semantic);Wt!==-1?(ot.push(O[Wt]),delete ct[At]):ot.push(At)}}for(var Ft in pe.attributes){var Ht=pe.attributes[Ft];if((wn=pe.parameters[Ht]).semantic){var fn=j(wn);fn&&_t.push(fn)}}for(;!nt.isEnd()&&nt.getNextToken();)if(nt.currentToken===P.IDENTIFIER){var un=!1;for(var Ft in pe.attributes){Ht=pe.attributes[Ft];var wn=pe.parameters[Ht];if(nt.currentIdentifier===Ft&&wn.semantic){Ye+=j(wn),un=!0;break}}un||(Ye+=$(nt,pe,ct))}else Ye+=nt.currentString;for(;!qe.isEnd()&&qe.getNextToken();)qe.currentToken===P.IDENTIFIER?Ke+=$(qe,pe,ct):Ke+=qe.currentString;var Fe={vertex:Te.vertexShader+ge,fragment:Te.fragmentShader+ge},gr={attributes:_t,uniforms:ot,samplers:gt,needAlphaBlending:Ne&&Ne.enable&&Ne.enable.indexOf(3042)!==-1};A.Effect.ShadersStore[Te.vertexShader+ge+"VertexShader"]=Ye,A.Effect.ShadersStore[Te.fragmentShader+ge+"PixelShader"]=Ke;var On=new A.ShaderMaterial(ge,te.scene,Fe,gr);if(On.onError=function(jn,Io,et){return function(dr,Kr){Io.dispose(!0),et("Cannot compile program named "+jn.name+". Error: "+Kr+". Default material will be applied")}}(Te,On,de),On.onCompiled=G(te,On,pe,ne,ct,ce),On.sideOrientation=A.Material.CounterClockWiseSideOrientation,Ne&&Ne.functions){var $n=Ne.functions;$n.cullFace&&$n.cullFace[0]!==b.BACK&&(On.backFaceCulling=!1);var He=$n.blendFuncSeparate;He&&(He[0]===f.SRC_ALPHA&&He[1]===f.ONE_MINUS_SRC_ALPHA&&He[2]===f.ONE&&He[3]===f.ONE?On.alphaMode=A.Constants.ALPHA_COMBINE:He[0]===f.ONE&&He[1]===f.ONE&&He[2]===f.ZERO&&He[3]===f.ONE?On.alphaMode=A.Constants.ALPHA_ONEONE:He[0]===f.SRC_ALPHA&&He[1]===f.ONE&&He[2]===f.ZERO&&He[3]===f.ONE?On.alphaMode=A.Constants.ALPHA_ADD:He[0]===f.ZERO&&He[1]===f.ONE_MINUS_SRC_COLOR&&He[2]===f.ONE&&He[3]===f.ONE?On.alphaMode=A.Constants.ALPHA_SUBTRACT:He[0]===f.DST_COLOR&&He[1]===f.ZERO&&He[2]===f.ONE&&He[3]===f.ONE?On.alphaMode=A.Constants.ALPHA_MULTIPLY:He[0]===f.SRC_ALPHA&&He[1]===f.ONE_MINUS_SRC_COLOR&&He[2]===f.ONE&&He[3]===f.ONE&&(On.alphaMode=A.Constants.ALPHA_MAXIMIZED))}}else de&&de("No technique found.")},Q}(),q=function(){function Q(){this.state=null}return Q.RegisterExtension=function(te){Q.Extensions[te.name]?A.Tools.Error('Tool with the same name "'+te.name+'" already exists'):Q.Extensions[te.name]=te},Q.prototype.dispose=function(){},Q.prototype._importMeshAsync=function(te,ge,ce,de,ne,pe,Se,Te){var Ne=this;return ge.useRightHandedSystem=!0,H.LoadRuntimeAsync(ge,ce,de,function(je){je.forAssetContainer=ne,je.importOnlyMeshes=!0,te===""?je.importMeshesNames=[]:typeof te=="string"?je.importMeshesNames=[te]:!te||te instanceof Array?(je.importMeshesNames=[],A.Tools.Warn("Argument meshesNames must be of type string or string[]")):je.importMeshesNames=[te],Ne._createNodes(je);var Xe=new Array,Ye=new Array;for(var Ke in je.nodes){var nt=je.nodes[Ke];nt.babylonNode instanceof A.AbstractMesh&&Xe.push(nt.babylonNode)}for(var qe in je.skins){var ct=je.skins[qe];ct.babylonSkeleton instanceof A.Skeleton&&Ye.push(ct.babylonSkeleton)}Ne._loadBuffersAsync(je,function(){Ne._loadShadersAsync(je,function(){he(je),B(je),!_.GLTFFileLoader.IncrementalLoading&&pe&&pe(Xe,Ye)})},Se),_.GLTFFileLoader.IncrementalLoading&&pe&&pe(Xe,Ye)},Te),!0},Q.prototype.importMeshAsync=function(te,ge,ce,de,ne,pe){var Se=this;return new Promise(function(Te,Ne){Se._importMeshAsync(te,ge,de,ne,ce,function(je,Xe){Te({meshes:je,particleSystems:[],skeletons:Xe,animationGroups:[],lights:[],transformNodes:[],geometries:[]})},pe,function(je){Ne(new Error(je))})})},Q.prototype._loadAsync=function(te,ge,ce,de,ne,pe,Se){var Te=this;te.useRightHandedSystem=!0,H.LoadRuntimeAsync(te,ge,ce,function(Ne){H.LoadRuntimeExtensionsAsync(Ne,function(){Te._createNodes(Ne),Te._loadBuffersAsync(Ne,function(){Te._loadShadersAsync(Ne,function(){he(Ne),B(Ne),_.GLTFFileLoader.IncrementalLoading||ne()})}),_.GLTFFileLoader.IncrementalLoading&&ne()},Se)},Se)},Q.prototype.loadAsync=function(te,ge,ce,de){var ne=this;return new Promise(function(pe,Se){ne._loadAsync(te,ge,ce,!1,function(){pe()},de,function(Te){Se(new Error(Te))})})},Q.prototype._loadShadersAsync=function(te,ge){var ce=!1,de=function(Se,Te){H.LoadShaderStringAsync(te,Se,function(Ne){Ne instanceof ArrayBuffer||(te.loadedShaderCount++,Ne&&(A.Effect.ShadersStore[Se+(Te.type===S.VERTEX?"VertexShader":"PixelShader")]=Ne),te.loadedShaderCount===te.shaderscount&&ge())},function(){A.Tools.Error("Error when loading shader program named "+Se+" located at "+Te.uri)})};for(var ne in te.shaders){ce=!0;var pe=te.shaders[ne];pe?de.bind(this,ne,pe)():A.Tools.Error("No shader named: "+ne)}ce||ge()},Q.prototype._loadBuffersAsync=function(te,ge,ce){var de=!1,ne=function(Te,Ne){H.LoadBufferAsync(te,Te,function(je){te.loadedBufferCount++,je&&(je.byteLength!=te.buffers[Te].byteLength&&A.Tools.Error("Buffer named "+Te+" is length "+je.byteLength+". Expected: "+Ne.byteLength),te.loadedBufferViews[Te]=je),te.loadedBufferCount===te.buffersCount&&ge()},function(){A.Tools.Error("Error when loading buffer named "+Te+" located at "+Ne.uri)})};for(var pe in te.buffers){de=!0;var Se=te.buffers[pe];Se?ne.bind(this,pe,Se)():A.Tools.Error("No buffer named: "+pe)}de||ge()},Q.prototype._createNodes=function(te){var ge=te.currentScene;if(ge)for(var ce=0;ce<ge.nodes.length;ce++)J(te,ge.nodes[ce],null);else for(var de in te.scenes)for(ge=te.scenes[de],ce=0;ce<ge.nodes.length;ce++)J(te,ge.nodes[ce],null)},Q.Extensions={},Q}(),H=function(){function Q(te){this._name=te}return Object.defineProperty(Q.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Q.prototype.loadRuntimeAsync=function(te,ge,ce,de,ne){return!1},Q.prototype.loadRuntimeExtensionsAsync=function(te,ge,ce){return!1},Q.prototype.loadBufferAsync=function(te,ge,ce,de,ne){return!1},Q.prototype.loadTextureBufferAsync=function(te,ge,ce,de){return!1},Q.prototype.createTextureAsync=function(te,ge,ce,de,ne){return!1},Q.prototype.loadShaderStringAsync=function(te,ge,ce,de){return!1},Q.prototype.loadMaterialAsync=function(te,ge,ce,de){return!1},Q.LoadRuntimeAsync=function(te,ge,ce,de,ne){Q.ApplyExtensions(function(pe){return pe.loadRuntimeAsync(te,ge,ce,de,ne)},function(){setTimeout(function(){de&&de(se.CreateRuntime(ge.json,te,ce))})})},Q.LoadRuntimeExtensionsAsync=function(te,ge,ce){Q.ApplyExtensions(function(de){return de.loadRuntimeExtensionsAsync(te,ge,ce)},function(){setTimeout(function(){ge()})})},Q.LoadBufferAsync=function(te,ge,ce,de,ne){Q.ApplyExtensions(function(pe){return pe.loadBufferAsync(te,ge,ce,de,ne)},function(){se.LoadBufferAsync(te,ge,ce,de,ne)})},Q.LoadTextureAsync=function(te,ge,ce,de){Q.LoadTextureBufferAsync(te,ge,function(ne){ne&&Q.CreateTextureAsync(te,ge,ne,ce,de)},de)},Q.LoadShaderStringAsync=function(te,ge,ce,de){Q.ApplyExtensions(function(ne){return ne.loadShaderStringAsync(te,ge,ce,de)},function(){se.LoadShaderStringAsync(te,ge,ce,de)})},Q.LoadMaterialAsync=function(te,ge,ce,de){Q.ApplyExtensions(function(ne){return ne.loadMaterialAsync(te,ge,ce,de)},function(){se.LoadMaterialAsync(te,ge,ce,de)})},Q.LoadTextureBufferAsync=function(te,ge,ce,de){Q.ApplyExtensions(function(ne){return ne.loadTextureBufferAsync(te,ge,ce,de)},function(){se.LoadTextureBufferAsync(te,ge,ce,de)})},Q.CreateTextureAsync=function(te,ge,ce,de,ne){Q.ApplyExtensions(function(pe){return pe.createTextureAsync(te,ge,ce,de,ne)},function(){se.CreateTextureAsync(te,ge,ce,de,ne)})},Q.ApplyExtensions=function(te,ge){for(var ce in q.Extensions)if(te(q.Extensions[ce]))return;ge()},Q}();_.GLTFFileLoader._CreateGLTF1Loader=function(){return new q};var X=function(Q){function te(){return Q.call(this,"KHR_binary_glTF")||this}return Object(x.b)(te,Q),te.prototype.loadRuntimeAsync=function(ge,ce,de,ne,pe){var Se=ce.json.extensionsUsed;return!(!Se||Se.indexOf(this.name)===-1||!ce.bin)&&(this._bin=ce.bin,ne(se.CreateRuntime(ce.json,ge,de)),!0)},te.prototype.loadBufferAsync=function(ge,ce,de,ne){return ge.extensionsUsed.indexOf(this.name)!==-1&&ce==="binary_glTF"&&(this._bin.readAsync(0,this._bin.byteLength).then(de,function(pe){return ne(pe.message)}),!0)},te.prototype.loadTextureBufferAsync=function(ge,ce,de,ne){var pe=ge.textures[ce],Se=ge.images[pe.source];if(!Se.extensions||!(this.name in Se.extensions))return!1;var Te=Se.extensions[this.name],Ne=ge.bufferViews[Te.bufferView];return de(T.GetBufferFromBufferView(ge,Ne,0,Ne.byteLength,m.UNSIGNED_BYTE)),!0},te.prototype.loadShaderStringAsync=function(ge,ce,de,ne){var pe=ge.shaders[ce];if(!pe.extensions||!(this.name in pe.extensions))return!1;var Se=pe.extensions[this.name],Te=ge.bufferViews[Se.bufferView],Ne=T.GetBufferFromBufferView(ge,Te,0,Te.byteLength,m.UNSIGNED_BYTE);return setTimeout(function(){var je=T.DecodeBufferToText(Ne);de(je)}),!0},te}(H);q.RegisterExtension(new X);var ee=function(Q){function te(){return Q.call(this,"KHR_materials_common")||this}return Object(x.b)(te,Q),te.prototype.loadRuntimeExtensionsAsync=function(ge,ce,de){if(!ge.extensions)return!1;var ne=ge.extensions[this.name];if(!ne)return!1;var pe=ne.lights;if(pe)for(var Se in pe){var Te=pe[Se];switch(Te.type){case"ambient":var Ne=new A.HemisphericLight(Te.name,new A.Vector3(0,1,0),ge.scene),je=Te.ambient;je&&(Ne.diffuse=A.Color3.FromArray(je.color||[1,1,1]));break;case"point":var Xe=new A.PointLight(Te.name,new A.Vector3(10,10,10),ge.scene),Ye=Te.point;Ye&&(Xe.diffuse=A.Color3.FromArray(Ye.color||[1,1,1]));break;case"directional":var Ke=new A.DirectionalLight(Te.name,new A.Vector3(0,-1,0),ge.scene),nt=Te.directional;nt&&(Ke.diffuse=A.Color3.FromArray(nt.color||[1,1,1]));break;case"spot":var qe=Te.spot;qe&&(new A.SpotLight(Te.name,new A.Vector3(0,10,0),new A.Vector3(0,-1,0),qe.fallOffAngle||Math.PI,qe.fallOffExponent||0,ge.scene).diffuse=A.Color3.FromArray(qe.color||[1,1,1]));break;default:A.Tools.Warn('GLTF Material Common extension: light type "'+Te.type+"\u201D not supported")}}return!1},te.prototype.loadMaterialAsync=function(ge,ce,de,ne){var pe=ge.materials[ce];if(!pe||!pe.extensions)return!1;var Se=pe.extensions[this.name];if(!Se)return!1;var Te=new A.StandardMaterial(ce,ge.scene);return Te.sideOrientation=A.Material.CounterClockWiseSideOrientation,Se.technique==="CONSTANT"&&(Te.disableLighting=!0),Te.backFaceCulling=Se.doubleSided!==void 0&&!Se.doubleSided,Te.alpha=Se.values.transparency===void 0?1:Se.values.transparency,Te.specularPower=Se.values.shininess===void 0?0:Se.values.shininess,typeof Se.values.ambient=="string"?this._loadTexture(ge,Se.values.ambient,Te,"ambientTexture",ne):Te.ambientColor=A.Color3.FromArray(Se.values.ambient||[0,0,0]),typeof Se.values.diffuse=="string"?this._loadTexture(ge,Se.values.diffuse,Te,"diffuseTexture",ne):Te.diffuseColor=A.Color3.FromArray(Se.values.diffuse||[0,0,0]),typeof Se.values.emission=="string"?this._loadTexture(ge,Se.values.emission,Te,"emissiveTexture",ne):Te.emissiveColor=A.Color3.FromArray(Se.values.emission||[0,0,0]),typeof Se.values.specular=="string"?this._loadTexture(ge,Se.values.specular,Te,"specularTexture",ne):Te.specularColor=A.Color3.FromArray(Se.values.specular||[0,0,0]),!0},te.prototype._loadTexture=function(ge,ce,de,ne,pe){se.LoadTextureBufferAsync(ge,ce,function(Se){se.CreateTextureAsync(ge,ce,Se,function(Te){return de[ne]=Te},pe)},pe)},te}(H);q.RegisterExtension(new ee)},function(s,c,E){E.r(c),E.d(c,"ArrayItem",function(){return m.a}),E.d(c,"GLTFLoader",function(){return m.b}),E.d(c,"EXT_lights_image_based",function(){return S.EXT_lights_image_based}),E.d(c,"EXT_mesh_gpu_instancing",function(){return S.EXT_mesh_gpu_instancing}),E.d(c,"EXT_texture_webp",function(){return S.EXT_texture_webp}),E.d(c,"KHR_draco_mesh_compression",function(){return S.KHR_draco_mesh_compression}),E.d(c,"KHR_lights",function(){return S.KHR_lights}),E.d(c,"KHR_materials_pbrSpecularGlossiness",function(){return S.KHR_materials_pbrSpecularGlossiness}),E.d(c,"KHR_materials_unlit",function(){return S.KHR_materials_unlit}),E.d(c,"KHR_materials_clearcoat",function(){return S.KHR_materials_clearcoat}),E.d(c,"KHR_materials_sheen",function(){return S.KHR_materials_sheen}),E.d(c,"KHR_materials_specular",function(){return S.KHR_materials_specular}),E.d(c,"KHR_materials_ior",function(){return S.KHR_materials_ior}),E.d(c,"KHR_materials_variants",function(){return S.KHR_materials_variants}),E.d(c,"KHR_materials_transmission",function(){return S.KHR_materials_transmission}),E.d(c,"KHR_materials_translucency",function(){return S.KHR_materials_translucency}),E.d(c,"KHR_mesh_quantization",function(){return S.KHR_mesh_quantization}),E.d(c,"KHR_texture_basisu",function(){return S.KHR_texture_basisu}),E.d(c,"KHR_texture_transform",function(){return S.KHR_texture_transform}),E.d(c,"MSFT_audio_emitter",function(){return S.MSFT_audio_emitter}),E.d(c,"MSFT_lod",function(){return S.MSFT_lod}),E.d(c,"MSFT_minecraftMesh",function(){return S.MSFT_minecraftMesh}),E.d(c,"MSFT_sRGBFactors",function(){return S.MSFT_sRGBFactors}),E.d(c,"ExtrasAsMetadata",function(){return S.ExtrasAsMetadata});var m=E(1),S=(E(6),E(7))},function(s,c,E){E.r(c),E.d(c,"MTLFileLoader",function(){return S}),E.d(c,"OBJFileLoader",function(){return h});var m=E(0),S=function(){function C(){this.materials=[]}return C.prototype.parseMTL=function(R,I,b,f){if(!(I instanceof ArrayBuffer)){for(var x,P=I.split(`
`),A=/\s+/,T=null,_=0;_<P.length;_++){var g=P[_].trim();if(g.length!==0&&g.charAt(0)!=="#"){var M=g.indexOf(" "),O=M>=0?g.substring(0,M):g;O=O.toLowerCase();var N=M>=0?g.substring(M+1).trim():"";O==="newmtl"?(T&&this.materials.push(T),R._blockEntityCollection=f,T=new m.StandardMaterial(N,R),R._blockEntityCollection=!1):O==="kd"&&T?(x=N.split(A,3).map(parseFloat),T.diffuseColor=m.Color3.FromArray(x)):O==="ka"&&T?(x=N.split(A,3).map(parseFloat),T.ambientColor=m.Color3.FromArray(x)):O==="ks"&&T?(x=N.split(A,3).map(parseFloat),T.specularColor=m.Color3.FromArray(x)):O==="ke"&&T?(x=N.split(A,3).map(parseFloat),T.emissiveColor=m.Color3.FromArray(x)):O==="ns"&&T?T.specularPower=parseFloat(N):O==="d"&&T?T.alpha=parseFloat(N):O==="map_ka"&&T?T.ambientTexture=C._getTexture(b,N,R):O==="map_kd"&&T?T.diffuseTexture=C._getTexture(b,N,R):O==="map_ks"&&T?T.specularTexture=C._getTexture(b,N,R):O==="map_ns"||(O==="map_bump"&&T?T.bumpTexture=C._getTexture(b,N,R):O==="map_d"&&T&&(T.opacityTexture=C._getTexture(b,N,R)))}}T&&this.materials.push(T)}},C._getTexture=function(R,I,b){if(!I)return null;var f=R;if(R==="file:"){var x=I.lastIndexOf("\\");x===-1&&(x=I.lastIndexOf("/")),f+=x>-1?I.substr(x+1):I}else f+=I;return new m.Texture(f,b,!1,C.INVERT_TEXTURE_Y)},C.INVERT_TEXTURE_Y=!0,C}(),h=function(){function C(R){this.name="obj",this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v(\s+[\d|\.|\+|\-|e|E]+){3,7}/,this.normalPattern=/vn(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt(\s+[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,this.facePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,this._forAssetContainer=!1,this._meshLoadOptions=R||C.currentMeshLoadOptions}return Object.defineProperty(C,"INVERT_TEXTURE_Y",{get:function(){return S.INVERT_TEXTURE_Y},set:function(R){S.INVERT_TEXTURE_Y=R},enumerable:!1,configurable:!0}),Object.defineProperty(C,"currentMeshLoadOptions",{get:function(){return{ComputeNormals:C.COMPUTE_NORMALS,ImportVertexColors:C.IMPORT_VERTEX_COLORS,InvertY:C.INVERT_Y,InvertTextureY:C.INVERT_TEXTURE_Y,UVScaling:C.UV_SCALING,MaterialLoadingFailsSilently:C.MATERIAL_LOADING_FAILS_SILENTLY,OptimizeWithUV:C.OPTIMIZE_WITH_UV,SkipMaterials:C.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),C.prototype._loadMTL=function(R,I,b,f){var x=m.Tools.BaseUrl+I+R;m.Tools.LoadFile(x,b,void 0,void 0,!1,function(P,A){f(x,A)})},C.prototype.createPlugin=function(){return new C(C.currentMeshLoadOptions)},C.prototype.canDirectLoad=function(R){return!1},C.prototype.importMeshAsync=function(R,I,b,f,x,P){return this._parseSolid(R,I,b,f).then(function(A){return{meshes:A,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}})},C.prototype.loadAsync=function(R,I,b,f,x){return this.importMeshAsync(null,R,I,b,f).then(function(){})},C.prototype.loadAssetContainerAsync=function(R,I,b,f,x){var P=this;return this._forAssetContainer=!0,this.importMeshAsync(null,R,I,b).then(function(A){var T=new m.AssetContainer(R);return A.meshes.forEach(function(_){return T.meshes.push(_)}),A.meshes.forEach(function(_){var g=_.material;g&&T.materials.indexOf(g)==-1&&(T.materials.push(g),g.getActiveTextures().forEach(function(M){T.textures.indexOf(M)==-1&&T.textures.push(M)}))}),P._forAssetContainer=!1,T}).catch(function(A){throw P._forAssetContainer=!1,A})},C.prototype._parseSolid=function(R,I,b,f){for(var x,P=this,A=[],T=[],_=[],g=[],M=[],O=[],N=[],V=[],U=[],L=[],j=[],Y=0,W=!1,ie=[],re=[],ye=[],ve=[],ue=[],oe="",Z="",J=new S,B=1,G=!0,$=new m.Color4(.5,.5,.5,1),he=function(qe,ct,ot,_t,gt,At,wt){var Qt;(Qt=P._meshLoadOptions.OptimizeWithUV?function(Wt,Ft){Wt[Ft[0]]||(Wt[Ft[0]]={normals:[],idx:[],uv:[]});var Ht=Wt[Ft[0]].normals.indexOf(Ft[1]);return Ht!=1&&Ft[2]===Wt[Ft[0]].uv[Ht]?Wt[Ft[0]].idx[Ht]:-1}(j,[qe,ot,ct]):function(Wt,Ft){Wt[Ft[0]]||(Wt[Ft[0]]={normals:[],idx:[]});var Ht=Wt[Ft[0]].normals.indexOf(Ft[1]);return Ht===-1?-1:Wt[Ft[0]].idx[Ht]}(j,[qe,ot]))===-1?(O.push(N.length),N.push(_t),V.push(gt),L.push(At),wt!==void 0&&U.push(wt),j[qe].normals.push(ot),j[qe].idx.push(Y++),P._meshLoadOptions.OptimizeWithUV&&j[qe].uv.push(ct)):O.push(Qt)},se=function(){for(var qe=0;qe<N.length;qe++)ie.push(N[qe].x,N[qe].y,N[qe].z),ye.push(L[qe].x,L[qe].y,L[qe].z),ve.push(V[qe].x,V[qe].y),P._meshLoadOptions.ImportVertexColors===!0&&re.push(U[qe].r,U[qe].g,U[qe].b,U[qe].a);N=[],L=[],V=[],U=[],j=[],Y=0},q=function(qe,ct){for(var ot=ct;ot<qe.length-1;ot++)ue.push(qe[0],qe[ot],qe[ot+1])},H=function(qe,ct){q(qe,ct);for(var ot=0;ot<ue.length;ot++){var _t=parseInt(ue[ot])-1;he(_t,0,0,A[_t],m.Vector2.Zero(),m.Vector3.Up(),P._meshLoadOptions.ImportVertexColors===!0?g[_t]:void 0)}ue=[]},X=function(qe,ct){q(qe,ct);for(var ot=0;ot<ue.length;ot++){var _t=ue[ot].split("/"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1;he(gt,At,0,A[gt],_[At],m.Vector3.Up(),P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ue=[]},ee=function(qe,ct){q(qe,ct);for(var ot=0;ot<ue.length;ot++){var _t=ue[ot].split("/"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1,wt=parseInt(_t[2])-1;he(gt,At,wt,A[gt],_[At],T[wt])}ue=[]},Q=function(qe,ct){q(qe,ct);for(var ot=0;ot<ue.length;ot++){var _t=ue[ot].split("//"),gt=parseInt(_t[0])-1,At=parseInt(_t[1])-1;he(gt,1,At,A[gt],m.Vector2.Zero(),T[At],P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ue=[]},te=function(qe,ct){q(qe,ct);for(var ot=0;ot<ue.length;ot++){var _t=ue[ot].split("/"),gt=A.length+parseInt(_t[0]),At=_.length+parseInt(_t[1]),wt=T.length+parseInt(_t[2]);he(gt,At,wt,A[gt],_[At],T[wt],P._meshLoadOptions.ImportVertexColors===!0?g[gt]:void 0)}ue=[]},ge=function(){M.length>0&&(x=M[M.length-1],se(),O.reverse(),x.indices=O.slice(),x.positions=ie.slice(),x.normals=ye.slice(),x.uvs=ve.slice(),P._meshLoadOptions.ImportVertexColors===!0&&(x.colors=re.slice()),O=[],ie=[],re=[],ye=[],ve=[])},ce=b.split(`
`),de=0;de<ce.length;de++){var ne,pe=ce[de].trim().replace(/\s\s/g," ");if(pe.length!==0&&pe.charAt(0)!=="#")if(this.vertexPattern.test(pe))ne=pe.match(/[^ ]+/g),A.push(new m.Vector3(parseFloat(ne[1]),parseFloat(ne[2]),parseFloat(ne[3]))),this._meshLoadOptions.ImportVertexColors===!0&&(ne.length>=7?g.push(new m.Color4(parseFloat(ne[4]),parseFloat(ne[5]),parseFloat(ne[6]),ne.length===7||ne[7]===void 0?1:parseFloat(ne[7]))):g.push($));else if((ne=this.normalPattern.exec(pe))!==null)T.push(new m.Vector3(parseFloat(ne[1]),parseFloat(ne[2]),parseFloat(ne[3])));else if((ne=this.uvPattern.exec(pe))!==null)_.push(new m.Vector2(parseFloat(ne[1])*C.UV_SCALING.x,parseFloat(ne[2])*C.UV_SCALING.y));else if((ne=this.facePattern3.exec(pe))!==null)ee(ne[1].trim().split(" "),1);else if((ne=this.facePattern4.exec(pe))!==null)Q(ne[1].trim().split(" "),1);else if((ne=this.facePattern5.exec(pe))!==null)te(ne[1].trim().split(" "),1);else if((ne=this.facePattern2.exec(pe))!==null)X(ne[1].trim().split(" "),1);else if((ne=this.facePattern1.exec(pe))!==null)H(ne[1].trim().split(" "),1);else if(this.group.test(pe)||this.obj.test(pe)){var Se={name:pe.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:""};ge(),M.push(Se),W=!0,G=!0,B=1}else this.usemtl.test(pe)?(oe=pe.substring(7).trim(),(!G||!W)&&(ge(),Se={name:"mesh_mm"+B.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:oe},B++,M.push(Se),W=!0),W&&G&&(M[M.length-1].materialName=oe,G=!1)):this.mtllib.test(pe)?Z=pe.substring(7).trim():this.smooth.test(pe)||console.log("Unhandled expression at line : "+pe)}W&&(x=M[M.length-1],O.reverse(),se(),x.indices=O,x.positions=ie,x.normals=ye,x.uvs=ve,this._meshLoadOptions.ImportVertexColors===!0&&(x.colors=re)),W||(O.reverse(),se(),M.push({name:m.Geometry.RandomId(),indices:O,positions:ie,colors:re,normals:ye,uvs:ve,materialName:oe}));for(var Te=[],Ne=new Array,je=0;je<M.length;je++){if(R&&M[je].name){if(R instanceof Array){if(R.indexOf(M[je].name)===-1)continue}else if(M[je].name!==R)continue}x=M[je],I._blockEntityCollection=this._forAssetContainer;var Xe=new m.Mesh(M[je].name,I);I._blockEntityCollection=!1,Ne.push(M[je].materialName);var Ye=new m.VertexData;if(Ye.uvs=x.uvs,Ye.indices=x.indices,Ye.positions=x.positions,this._meshLoadOptions.ComputeNormals===!0){var Ke=new Array;m.VertexData.ComputeNormals(x.positions,x.indices,Ke),Ye.normals=Ke}else Ye.normals=x.normals;this._meshLoadOptions.ImportVertexColors===!0&&(Ye.colors=x.colors),Ye.applyToMesh(Xe),this._meshLoadOptions.InvertY&&(Xe.scaling.y*=-1),Te.push(Xe)}var nt=[];return Z!==""&&this._meshLoadOptions.SkipMaterials===!1&&nt.push(new Promise(function(qe,ct){P._loadMTL(Z,f,function(ot){try{J.parseMTL(I,ot,f,P._forAssetContainer);for(var _t=0;_t<J.materials.length;_t++){for(var gt,At=0,wt=[];(gt=Ne.indexOf(J.materials[_t].name,At))>-1;)wt.push(gt),At=gt+1;if(gt===-1&&wt.length===0)J.materials[_t].dispose();else for(var Qt=0;Qt<wt.length;Qt++)Te[wt[Qt]].material=J.materials[_t]}qe()}catch(Wt){m.Tools.Warn("Error processing MTL file: '"+Z+"'"),P._meshLoadOptions.MaterialLoadingFailsSilently?qe():ct(Wt)}},function(ot,_t){m.Tools.Warn("Error downloading MTL file: '"+Z+"'"),P._meshLoadOptions.MaterialLoadingFailsSilently?qe():ct(_t)})})),Promise.all(nt).then(function(){return Te})},C.OPTIMIZE_WITH_UV=!0,C.INVERT_Y=!1,C.IMPORT_VERTEX_COLORS=!1,C.COMPUTE_NORMALS=!1,C.UV_SCALING=new m.Vector2(1,1),C.SKIP_MATERIALS=!1,C.MATERIAL_LOADING_FAILS_SILENTLY=!0,C}();m.SceneLoader&&m.SceneLoader.RegisterPlugin(new h)},function(s,c,E){E.r(c),E.d(c,"STLFileLoader",function(){return S});var m=E(0),S=function(){function h(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return h.prototype.importMesh=function(C,R,I,b,f,x,P){var A;if(typeof I!="string"){if(this._isBinary(I)){var T=new m.Mesh("stlmesh",R);return this._parseBinary(T,I),f&&f.push(T),!0}for(var _=new Uint8Array(I),g="",M=0;M<I.byteLength;M++)g+=String.fromCharCode(_[M]);I=g}for(;A=this.solidPattern.exec(I);){var O=A[1];if(O!=A[3])return m.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(C&&O){if(C instanceof Array){if(!C.indexOf(O))continue}else if(O!==C)continue}O=O||"stlmesh",T=new m.Mesh(O,R),this._parseASCII(T,A[2]),f&&f.push(T)}return!0},h.prototype.load=function(C,R,I){return this.importMesh(null,C,R,I,null,null,null)},h.prototype.loadAssetContainer=function(C,R,I,b){var f=new m.AssetContainer(C);return C._blockEntityCollection=!0,this.importMesh(null,C,R,I,f.meshes,null,null),C._blockEntityCollection=!1,f},h.prototype._isBinary=function(C){var R;if(84+50*(R=new DataView(C)).getUint32(80,!0)===R.byteLength)return!0;for(var I=R.byteLength,b=0;b<I;b++)if(R.getUint8(b)>127)return!0;return!1},h.prototype._parseBinary=function(C,R){for(var I=new DataView(R),b=I.getUint32(80,!0),f=0,x=new Float32Array(3*b*3),P=new Float32Array(3*b*3),A=new Uint32Array(3*b),T=0,_=0;_<b;_++){for(var g=84+50*_,M=I.getFloat32(g,!0),O=I.getFloat32(g+4,!0),N=I.getFloat32(g+8,!0),V=1;V<=3;V++){var U=g+12*V;x[f]=I.getFloat32(U,!0),x[f+2]=I.getFloat32(U+4,!0),x[f+1]=I.getFloat32(U+8,!0),P[f]=M,P[f+2]=O,P[f+1]=N,f+=3}A[T]=T++,A[T]=T++,A[T]=T++}C.setVerticesData(m.VertexBuffer.PositionKind,x),C.setVerticesData(m.VertexBuffer.NormalKind,P),C.setIndices(A),C.computeWorldMatrix(!0)},h.prototype._parseASCII=function(C,R){for(var I,b=[],f=[],x=[],P=0;I=this.facetsPattern.exec(R);){var A=I[1],T=this.normalPattern.exec(A);if(this.normalPattern.lastIndex=0,T){for(var _,g=[Number(T[1]),Number(T[5]),Number(T[3])];_=this.vertexPattern.exec(A);)b.push(Number(_[1]),Number(_[5]),Number(_[3])),f.push(g[0],g[1],g[2]);x.push(P++,P++,P++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,C.setVerticesData(m.VertexBuffer.PositionKind,b),C.setVerticesData(m.VertexBuffer.NormalKind,f),C.setIndices(x),C.computeWorldMatrix(!0)},h}();m.SceneLoader&&m.SceneLoader.RegisterPlugin(new S)},function(s,c,E){(function(m){var S=E(2),h=E(3);E.d(c,"a",function(){return S.GLTFFileLoader}),E.d(c,"b",function(){return S.GLTFLoaderAnimationStartMode}),E.d(c,"c",function(){return S.GLTFLoaderCoordinateSystemMode}),E.d(c,"d",function(){return S.GLTFLoaderState}),E.d(c,"e",function(){return h.GLTFValidation});var C=m!==void 0?m:typeof window!="undefined"?window:void 0;if(C!==void 0){for(var R in C.BABYLON=C.BABYLON||{},S)C.BABYLON[R]=S[R];for(var R in h)C.BABYLON[R]=h[R]}}).call(this,E(5))},function(s,c,E){(function(m){var S=E(8);E.d(c,"a",function(){return S});var h=m!==void 0?m:typeof window!="undefined"?window:void 0;if(h!==void 0)for(var C in h.BABYLON=h.BABYLON||{},h.BABYLON.GLTF1=h.BABYLON.GLTF1||{},S)h.BABYLON.GLTF1[C]=S[C]}).call(this,E(5))},function(s,c,E){(function(m){var S=E(7),h=E(6),C=E(9);E.d(c,"a",function(){return C});var R=m!==void 0?m:typeof window!="undefined"?window:void 0;if(R!==void 0){R.BABYLON=R.BABYLON||{};var I=R.BABYLON;I.GLTF2=I.GLTF2||{},I.GLTF2.Loader=I.GLTF2.Loader||{},I.GLTF2.Loader.Extensions=I.GLTF2.Loader.Extensions||{};var b=[];for(var f in S)I.GLTF2.Loader.Extensions[f]=S[f],b.push(f);for(var f in h)I.GLTF2.Loader[f]=h[f],b.push(f);for(var f in C)b.indexOf(f)>-1||(I.GLTF2[f]=C[f])}}).call(this,E(5))},function(s,c,E){E.r(c),function(m){var S=E(10);E.d(c,"MTLFileLoader",function(){return S.MTLFileLoader}),E.d(c,"OBJFileLoader",function(){return S.OBJFileLoader});var h=m!==void 0?m:typeof window!="undefined"?window:void 0;if(h!==void 0)for(var C in S)h.BABYLON[C]=S[C]}.call(this,E(5))},function(s,c,E){E.r(c),function(m){var S=E(11);E.d(c,"STLFileLoader",function(){return S.STLFileLoader});var h=m!==void 0?m:typeof window!="undefined"?window:void 0;if(h!==void 0)for(var C in S)h.BABYLON[C]=S[C]}.call(this,E(5))},,,,function(s,c,E){E.r(c),E.d(c,"GLTFLoaderCoordinateSystemMode",function(){return m.c}),E.d(c,"GLTFLoaderAnimationStartMode",function(){return m.b}),E.d(c,"GLTFLoaderState",function(){return m.d}),E.d(c,"GLTFFileLoader",function(){return m.a}),E.d(c,"GLTFValidation",function(){return m.e}),E.d(c,"GLTF1",function(){return S.a}),E.d(c,"GLTF2",function(){return h.a}),E.d(c,"MTLFileLoader",function(){return C.MTLFileLoader}),E.d(c,"OBJFileLoader",function(){return C.OBJFileLoader}),E.d(c,"STLFileLoader",function(){return R.STLFileLoader}),E(2),E(3),E(8),E(9),E(10),E(11);var m=E(12),S=E(13),h=E(14),C=E(15),R=E(16)}])})})(jQ);export{Gt as A,Kv as B,RK as C,S8 as D,CK as E,Gs as F,S6 as G,QR as H,p6 as I,yx as J,oP as K,m8 as M,OK as Q,PK as S,I6 as T,qR as V,vx as _,_8 as a,g8 as b,x6 as c,lr as d,A6 as e,MK as f,T8 as g,HR as h,AK as i,M8 as j,A8 as k,ln as l,wK as m,JX as n,n6 as o,t6 as p,e6 as q,$O as r,bx as s,kQ as t,oB as u,$e as v,Ba as w,_x as x,Vt as y,v8 as z};
//# sourceMappingURL=vendor.027897e7.js.map
