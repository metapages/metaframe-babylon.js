var Sl,Ct,GE,xl,WE,HE,XE,qh={},YE=[],ON=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function co(a,u){for(var f in u)a[f]=u[f];return a}function KE(a){var u=a.parentNode;u&&u.removeChild(a)}function Ye(a,u,f){var s,c,T,m={};for(T in u)T=="key"?s=u[T]:T=="ref"?c=u[T]:m[T]=u[T];if(arguments.length>2&&(m.children=arguments.length>3?Sl.call(arguments,2):f),typeof a=="function"&&a.defaultProps!=null)for(T in a.defaultProps)m[T]===void 0&&(m[T]=a.defaultProps[T]);return Pl(a,m,s,c,null)}function Pl(a,u,f,s,c){var T={type:a,props:u,key:f,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:c??++GE};return Ct.vnode!=null&&Ct.vnode(T),T}function QE(){return{current:null}}function qn(a){return a.children}function ii(a,u){this.props=a,this.context=u}function js(a,u){if(u==null)return a.__?js(a.__,a.__.__k.indexOf(a)+1):null;for(var f;u<a.__k.length;u++)if((f=a.__k[u])!=null&&f.__e!=null)return f.__e;return typeof a.type=="function"?js(a):null}function qE(a){var u,f;if((a=a.__)!=null&&a.__c!=null){for(a.__e=a.__c.base=null,u=0;u<a.__k.length;u++)if((f=a.__k[u])!=null&&f.__e!=null){a.__e=a.__c.base=f.__e;break}return qE(a)}}function h_(a){(!a.__d&&(a.__d=!0)&&xl.push(a)&&!Zh.__r++||HE!==Ct.debounceRendering)&&((HE=Ct.debounceRendering)||WE)(Zh)}function Zh(){for(var a;Zh.__r=xl.length;)a=xl.sort(function(u,f){return u.__v.__b-f.__v.__b}),xl=[],a.some(function(u){var f,s,c,T,m,E;u.__d&&(m=(T=(f=u).__v).__e,(E=f.__P)&&(s=[],(c=co({},T)).__v=T.__v+1,d_(E,T,c,f.__n,E.ownerSVGElement!==void 0,T.__h!=null?[m]:null,s,m??js(T),T.__h),rS(s,T),T.__e!=m&&qE(T)))})}function ZE(a,u,f,s,c,T,m,E,d,x){var M,w,S,_,O,R,I,y=s&&s.__k||YE,p=y.length;for(f.__k=[],M=0;M<u.length;M++)if((_=f.__k[M]=(_=u[M])==null||typeof _=="boolean"?null:typeof _=="string"||typeof _=="number"||typeof _=="bigint"?Pl(null,_,null,null,_):Array.isArray(_)?Pl(qn,{children:_},null,null,null):_.__b>0?Pl(_.type,_.props,_.key,null,_.__v):_)!=null){if(_.__=f,_.__b=f.__b+1,(S=y[M])===null||S&&_.key==S.key&&_.type===S.type)y[M]=void 0;else for(w=0;w<p;w++){if((S=y[w])&&_.key==S.key&&_.type===S.type){y[w]=void 0;break}S=null}d_(a,_,S=S||qh,c,T,m,E,d,x),O=_.__e,(w=_.ref)&&S.ref!=w&&(I||(I=[]),S.ref&&I.push(S.ref,null,_),I.push(w,_.__c||O,_)),O!=null?(R==null&&(R=O),typeof _.type=="function"&&_.__k!=null&&_.__k===S.__k?_.__d=d=$E(_,d,a):d=JE(a,_,S,y,O,d),x||f.type!=="option"?typeof f.type=="function"&&(f.__d=d):a.value=""):d&&S.__e==d&&d.parentNode!=a&&(d=js(S))}for(f.__e=R,M=p;M--;)y[M]!=null&&(typeof f.type=="function"&&y[M].__e!=null&&y[M].__e==f.__d&&(f.__d=js(s,M+1)),oS(y[M],y[M]));if(I)for(M=0;M<I.length;M++)iS(I[M],I[++M],I[++M])}function $E(a,u,f){var s,c;for(s=0;s<a.__k.length;s++)(c=a.__k[s])&&(c.__=a,u=typeof c.type=="function"?$E(c,u,f):JE(f,c,c,a.__k,c.__e,u));return u}function lo(a,u){return u=u||[],a==null||typeof a=="boolean"||(Array.isArray(a)?a.some(function(f){lo(f,u)}):u.push(a)),u}function JE(a,u,f,s,c,T){var m,E,d;if(u.__d!==void 0)m=u.__d,u.__d=void 0;else if(f==null||c!=T||c.parentNode==null)e:if(T==null||T.parentNode!==a)a.appendChild(c),m=null;else{for(E=T,d=0;(E=E.nextSibling)&&d<s.length;d+=2)if(E==c)break e;a.insertBefore(c,T),m=T}return m!==void 0?m:c.nextSibling}function MN(a,u,f,s,c){var T;for(T in f)T==="children"||T==="key"||T in u||$h(a,T,null,f[T],s);for(T in u)c&&typeof u[T]!="function"||T==="children"||T==="key"||T==="value"||T==="checked"||f[T]===u[T]||$h(a,T,u[T],f[T],s)}function eS(a,u,f){u[0]==="-"?a.setProperty(u,f):a[u]=f==null?"":typeof f!="number"||ON.test(u)?f:f+"px"}function $h(a,u,f,s,c){var T;e:if(u==="style")if(typeof f=="string")a.style.cssText=f;else{if(typeof s=="string"&&(a.style.cssText=s=""),s)for(u in s)f&&u in f||eS(a.style,u,"");if(f)for(u in f)s&&f[u]===s[u]||eS(a.style,u,f[u])}else if(u[0]==="o"&&u[1]==="n")T=u!==(u=u.replace(/Capture$/,"")),u=u.toLowerCase()in a?u.toLowerCase().slice(2):u.slice(2),a.l||(a.l={}),a.l[u+T]=f,f?s||a.addEventListener(u,T?nS:tS,T):a.removeEventListener(u,T?nS:tS,T);else if(u!=="dangerouslySetInnerHTML"){if(c)u=u.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(u!=="href"&&u!=="list"&&u!=="form"&&u!=="tabIndex"&&u!=="download"&&u in a)try{a[u]=f??"";break e}catch(m){}typeof f=="function"||(f!=null&&(f!==!1||u[0]==="a"&&u[1]==="r")?a.setAttribute(u,f):a.removeAttribute(u))}}function tS(a){this.l[a.type+!1](Ct.event?Ct.event(a):a)}function nS(a){this.l[a.type+!0](Ct.event?Ct.event(a):a)}function d_(a,u,f,s,c,T,m,E,d){var x,M,w,S,_,O,R,I,y,p,g,C=u.type;if(u.constructor!==void 0)return null;f.__h!=null&&(d=f.__h,E=u.__e=f.__e,u.__h=null,T=[E]),(x=Ct.__b)&&x(u);try{e:if(typeof C=="function"){if(I=u.props,y=(x=C.contextType)&&s[x.__c],p=x?y?y.props.value:x.__:s,f.__c?R=(M=u.__c=f.__c).__=M.__E:("prototype"in C&&C.prototype.render?u.__c=M=new C(I,p):(u.__c=M=new ii(I,p),M.constructor=C,M.render=DN),y&&y.sub(M),M.props=I,M.state||(M.state={}),M.context=p,M.__n=s,w=M.__d=!0,M.__h=[]),M.__s==null&&(M.__s=M.state),C.getDerivedStateFromProps!=null&&(M.__s==M.state&&(M.__s=co({},M.__s)),co(M.__s,C.getDerivedStateFromProps(I,M.__s))),S=M.props,_=M.state,w)C.getDerivedStateFromProps==null&&M.componentWillMount!=null&&M.componentWillMount(),M.componentDidMount!=null&&M.__h.push(M.componentDidMount);else{if(C.getDerivedStateFromProps==null&&I!==S&&M.componentWillReceiveProps!=null&&M.componentWillReceiveProps(I,p),!M.__e&&M.shouldComponentUpdate!=null&&M.shouldComponentUpdate(I,M.__s,p)===!1||u.__v===f.__v){M.props=I,M.state=M.__s,u.__v!==f.__v&&(M.__d=!1),M.__v=u,u.__e=f.__e,u.__k=f.__k,u.__k.forEach(function(P){P&&(P.__=u)}),M.__h.length&&m.push(M);break e}M.componentWillUpdate!=null&&M.componentWillUpdate(I,M.__s,p),M.componentDidUpdate!=null&&M.__h.push(function(){M.componentDidUpdate(S,_,O)})}M.context=p,M.props=I,M.state=M.__s,(x=Ct.__r)&&x(u),M.__d=!1,M.__v=u,M.__P=a,x=M.render(M.props,M.state,M.context),M.state=M.__s,M.getChildContext!=null&&(s=co(co({},s),M.getChildContext())),w||M.getSnapshotBeforeUpdate==null||(O=M.getSnapshotBeforeUpdate(S,_)),g=x!=null&&x.type===qn&&x.key==null?x.props.children:x,ZE(a,Array.isArray(g)?g:[g],u,f,s,c,T,m,E,d),M.base=u.__e,u.__h=null,M.__h.length&&m.push(M),R&&(M.__E=M.__=null),M.__e=!1}else T==null&&u.__v===f.__v?(u.__k=f.__k,u.__e=f.__e):u.__e=IN(f.__e,u,f,s,c,T,m,d);(x=Ct.diffed)&&x(u)}catch(P){u.__v=null,(d||T!=null)&&(u.__e=E,u.__h=!!d,T[T.indexOf(E)]=null),Ct.__e(P,u,f)}}function rS(a,u){Ct.__c&&Ct.__c(u,a),a.some(function(f){try{a=f.__h,f.__h=[],a.some(function(s){s.call(f)})}catch(s){Ct.__e(s,f.__v)}})}function IN(a,u,f,s,c,T,m,E){var d,x,M,w=f.props,S=u.props,_=u.type,O=0;if(_==="svg"&&(c=!0),T!=null){for(;O<T.length;O++)if((d=T[O])&&(d===a||(_?d.localName==_:d.nodeType==3))){a=d,T[O]=null;break}}if(a==null){if(_===null)return document.createTextNode(S);a=c?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,S.is&&S),T=null,E=!1}if(_===null)w===S||E&&a.data===S||(a.data=S);else{if(T=T&&Sl.call(a.childNodes),x=(w=f.props||qh).dangerouslySetInnerHTML,M=S.dangerouslySetInnerHTML,!E){if(T!=null)for(w={},O=0;O<a.attributes.length;O++)w[a.attributes[O].name]=a.attributes[O].value;(M||x)&&(M&&(x&&M.__html==x.__html||M.__html===a.innerHTML)||(a.innerHTML=M&&M.__html||""))}if(MN(a,S,w,c,E),M)u.__k=[];else if(O=u.props.children,ZE(a,Array.isArray(O)?O:[O],u,f,s,c&&_!=="foreignObject",T,m,T?T[0]:f.__k&&js(f,0),E),T!=null)for(O=T.length;O--;)T[O]!=null&&KE(T[O]);E||("value"in S&&(O=S.value)!==void 0&&(O!==a.value||_==="progress"&&!O)&&$h(a,"value",O,w.value,!1),"checked"in S&&(O=S.checked)!==void 0&&O!==a.checked&&$h(a,"checked",O,w.checked,!1))}return a}function iS(a,u,f){try{typeof a=="function"?a(u):a.current=u}catch(s){Ct.__e(s,f)}}function oS(a,u,f){var s,c;if(Ct.unmount&&Ct.unmount(a),(s=a.ref)&&(s.current&&s.current!==a.__e||iS(s,null,u)),(s=a.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(T){Ct.__e(T,u)}s.base=s.__P=null}if(s=a.__k)for(c=0;c<s.length;c++)s[c]&&oS(s[c],u,typeof a.type!="function");f||a.__e==null||KE(a.__e),a.__e=a.__d=void 0}function DN(a,u,f){return this.constructor(a,f)}function zs(a,u,f){var s,c,T;Ct.__&&Ct.__(a,u),c=(s=typeof f=="function")?null:f&&f.__k||u.__k,T=[],d_(u,a=(!s&&f||u).__k=Ye(qn,null,[a]),c||qh,qh,u.ownerSVGElement!==void 0,!s&&f?[f]:c?null:u.firstChild?Sl.call(u.childNodes):null,T,!s&&f?f:c?c.__e:u.firstChild,s),rS(T,a)}function aS(a,u){zs(a,u,aS)}function wN(a,u,f){var s,c,T,m=co({},a.props);for(T in u)T=="key"?s=u[T]:T=="ref"?c=u[T]:m[T]=u[T];return arguments.length>2&&(m.children=arguments.length>3?Sl.call(arguments,2):f),Pl(a.type,m,s||a.key,c||a.ref,null)}function fr(a,u){var f={__c:u="__cC"+XE++,__:a,Consumer:function(s,c){return s.children(c)},Provider:function(s){var c,T;return this.getChildContext||(c=[],(T={})[u]=this,this.getChildContext=function(){return T},this.shouldComponentUpdate=function(m){this.props.value!==m.value&&c.some(h_)},this.sub=function(m){c.push(m);var E=m.componentWillUnmount;m.componentWillUnmount=function(){c.splice(c.indexOf(m),1),E&&E.call(m)}}),s.children}};return f.Provider.__=f.Consumer.contextType=f}Sl=YE.slice,Ct={__e:function(a,u){for(var f,s,c;u=u.__;)if((f=u.__c)&&!f.__)try{if((s=f.constructor)&&s.getDerivedStateFromError!=null&&(f.setState(s.getDerivedStateFromError(a)),c=f.__d),f.componentDidCatch!=null&&(f.componentDidCatch(a),c=f.__d),c)return f.__E=f}catch(T){a=T}throw a}},GE=0,ii.prototype.setState=function(a,u){var f;f=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=co({},this.state),typeof a=="function"&&(a=a(co({},f),this.props)),a&&co(f,a),a!=null&&this.__v&&(u&&this.__h.push(u),h_(this))},ii.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),h_(this))},ii.prototype.render=qn,xl=[],WE=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Zh.__r=0,XE=0;var La,cr,sS,Gs=0,f_=[],cS=Ct.__b,lS=Ct.__r,uS=Ct.diffed,hS=Ct.__c,dS=Ct.unmount;function Ws(a,u){Ct.__h&&Ct.__h(cr,a,Gs||u),Gs=0;var f=cr.__H||(cr.__H={__:[],__h:[]});return a>=f.__.length&&f.__.push({}),f.__[a]}function mn(a){return Gs=1,Jh(_S,a)}function Jh(a,u,f){var s=Ws(La++,2);return s.t=a,s.__c||(s.__=[f?f(u):_S(void 0,u),function(c){var T=s.t(s.__[0],c);s.__[0]!==T&&(s.__=[T,s.__[1]],s.__c.setState({}))}],s.__c=cr),s.__}function Ut(a,u){var f=Ws(La++,3);!Ct.__s&&m_(f.__H,u)&&(f.__=a,f.__H=u,cr.__H.__h.push(f))}function Ko(a,u){var f=Ws(La++,4);!Ct.__s&&m_(f.__H,u)&&(f.__=a,f.__H=u,cr.__h.push(f))}function Nt(a){return Gs=5,Dn(function(){return{current:a}},[])}function fS(a,u,f){Gs=6,Ko(function(){typeof a=="function"?a(u()):a&&(a.current=u())},f==null?f:f.concat(a))}function Dn(a,u){var f=Ws(La++,7);return m_(f.__H,u)&&(f.__=a(),f.__H=u,f.__h=a),f.__}function Vt(a,u){return Gs=8,Dn(function(){return a},u)}function Jt(a){var u=cr.context[a.__c],f=Ws(La++,9);return f.c=a,u?(f.__==null&&(f.__=!0,u.sub(cr)),u.props.value):a.__}function pS(a,u){Ct.useDebugValue&&Ct.useDebugValue(u?u(a):a)}function LN(a){var u=Ws(La++,10),f=mn();return u.__=a,cr.componentDidCatch||(cr.componentDidCatch=function(s){u.__&&u.__(s),f[1](s)}),[f[0],function(){f[1](void 0)}]}function NN(){f_.forEach(function(a){if(a.__P)try{a.__H.__h.forEach(ed),a.__H.__h.forEach(p_),a.__H.__h=[]}catch(u){a.__H.__h=[],Ct.__e(u,a.__v)}}),f_=[]}Ct.__b=function(a){cr=null,cS&&cS(a)},Ct.__r=function(a){lS&&lS(a),La=0;var u=(cr=a.__c).__H;u&&(u.__h.forEach(ed),u.__h.forEach(p_),u.__h=[])},Ct.diffed=function(a){uS&&uS(a);var u=a.__c;u&&u.__H&&u.__H.__h.length&&(f_.push(u)!==1&&sS===Ct.requestAnimationFrame||((sS=Ct.requestAnimationFrame)||function(f){var s,c=function(){clearTimeout(T),mS&&cancelAnimationFrame(s),setTimeout(f)},T=setTimeout(c,100);mS&&(s=requestAnimationFrame(c))})(NN)),cr=void 0},Ct.__c=function(a,u){u.some(function(f){try{f.__h.forEach(ed),f.__h=f.__h.filter(function(s){return!s.__||p_(s)})}catch(s){u.some(function(c){c.__h&&(c.__h=[])}),u=[],Ct.__e(s,f.__v)}}),hS&&hS(a,u)},Ct.unmount=function(a){dS&&dS(a);var u=a.__c;if(u&&u.__H)try{u.__H.__.forEach(ed)}catch(f){Ct.__e(f,u.__v)}};var mS=typeof requestAnimationFrame=="function";function ed(a){var u=cr;typeof a.__c=="function"&&a.__c(),cr=u}function p_(a){var u=cr;a.__c=a.__(),cr=u}function m_(a,u){return!a||a.length!==u.length||u.some(function(f,s){return f!==a[s]})}function _S(a,u){return typeof u=="function"?u(a):u}function gS(a,u){for(var f in u)a[f]=u[f];return a}function __(a,u){for(var f in a)if(f!=="__source"&&!(f in u))return!0;for(var s in u)if(s!=="__source"&&a[s]!==u[s])return!0;return!1}function Al(a){this.props=a}function Cl(a,u){function f(c){var T=this.props.ref,m=T==c.ref;return!m&&T&&(T.call?T(null):T.current=null),u?!u(this.props,c)||!m:__(this.props,c)}function s(c){return this.shouldComponentUpdate=f,Ye(a,c)}return s.displayName="Memo("+(a.displayName||a.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s}(Al.prototype=new ii).isPureReactComponent=!0,Al.prototype.shouldComponentUpdate=function(a,u){return __(this.props,a)||__(this.state,u)};var vS=Ct.__b;Ct.__b=function(a){a.type&&a.type.__f&&a.ref&&(a.props.ref=a.ref,a.ref=null),vS&&vS(a)};var FN=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function bi(a){function u(f,s){var c=gS({},f);return delete c.ref,a(c,(s=f.ref||s)&&(typeof s!="object"||"current"in s)?s:null)}return u.$$typeof=FN,u.render=u,u.prototype.isReactComponent=u.__f=!0,u.displayName="ForwardRef("+(a.displayName||a.name)+")",u}var bS=function(a,u){return a==null?null:lo(lo(a).map(u))},Rl={map:bS,forEach:bS,count:function(a){return a?lo(a).length:0},only:function(a){var u=lo(a);if(u.length!==1)throw"Children.only";return u[0]},toArray:lo},BN=Ct.__e;Ct.__e=function(a,u,f){if(a.then){for(var s,c=u;c=c.__;)if((s=c.__c)&&s.__c)return u.__e==null&&(u.__e=f.__e,u.__k=f.__k),s.__c(a,u)}BN(a,u,f)};var yS=Ct.unmount;function Ol(){this.__u=0,this.t=null,this.__b=null}function TS(a){var u=a.__.__c;return u&&u.__e&&u.__e(a)}function ES(a){var u,f,s;function c(T){if(u||(u=a()).then(function(m){f=m.default||m},function(m){s=m}),s)throw s;if(!f)throw u;return Ye(f,T)}return c.displayName="Lazy",c.__f=!0,c}function Hs(){this.u=null,this.o=null}Ct.unmount=function(a){var u=a.__c;u&&u.__R&&u.__R(),u&&a.__h===!0&&(a.type=null),yS&&yS(a)},(Ol.prototype=new ii).__c=function(a,u){var f=u.__c,s=this;s.t==null&&(s.t=[]),s.t.push(f);var c=TS(s.__v),T=!1,m=function(){T||(T=!0,f.__R=null,c?c(E):E())};f.__R=m;var E=function(){if(!--s.__u){if(s.state.__e){var x=s.state.__e;s.__v.__k[0]=function w(S,_,O){return S&&(S.__v=null,S.__k=S.__k&&S.__k.map(function(R){return w(R,_,O)}),S.__c&&S.__c.__P===_&&(S.__e&&O.insertBefore(S.__e,S.__d),S.__c.__e=!0,S.__c.__P=O)),S}(x,x.__c.__P,x.__c.__O)}var M;for(s.setState({__e:s.__b=null});M=s.t.pop();)M.forceUpdate()}},d=u.__h===!0;s.__u++||d||s.setState({__e:s.__b=s.__v.__k[0]}),a.then(m,m)},Ol.prototype.componentWillUnmount=function(){this.t=[]},Ol.prototype.render=function(a,u){if(this.__b){if(this.__v.__k){var f=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=function T(m,E,d){return m&&(m.__c&&m.__c.__H&&(m.__c.__H.__.forEach(function(x){typeof x.__c=="function"&&x.__c()}),m.__c.__H=null),(m=gS({},m)).__c!=null&&(m.__c.__P===d&&(m.__c.__P=E),m.__c=null),m.__k=m.__k&&m.__k.map(function(x){return T(x,E,d)})),m}(this.__b,f,s.__O=s.__P)}this.__b=null}var c=u.__e&&Ye(qn,null,a.fallback);return c&&(c.__h=null),[Ye(qn,null,u.__e?null:a.children),c]};var SS=function(a,u,f){if(++f[1]===f[0]&&a.o.delete(u),a.props.revealOrder&&(a.props.revealOrder[0]!=="t"||!a.o.size))for(f=a.u;f;){for(;f.length>3;)f.pop()();if(f[1]<f[0])break;a.u=f=f[2]}};function UN(a){return this.getChildContext=function(){return a.context},a.children}function VN(a){var u=this,f=a.i;u.componentWillUnmount=function(){zs(null,u.l),u.l=null,u.i=null},u.i&&u.i!==f&&u.componentWillUnmount(),a.__v?(u.l||(u.i=f,u.l={nodeType:1,parentNode:f,childNodes:[],appendChild:function(s){this.childNodes.push(s),u.i.appendChild(s)},insertBefore:function(s,c){this.childNodes.push(s),u.i.appendChild(s)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),u.i.removeChild(s)}}),zs(Ye(UN,{context:u.context},a.__v),u.l)):u.l&&u.componentWillUnmount()}function td(a,u){return Ye(VN,{__v:a,i:u})}(Hs.prototype=new ii).__e=function(a){var u=this,f=TS(u.__v),s=u.o.get(a);return s[0]++,function(c){var T=function(){u.props.revealOrder?(s.push(c),SS(u,a,s)):c()};f?f(T):T()}},Hs.prototype.render=function(a){this.u=null,this.o=new Map;var u=lo(a.children);a.revealOrder&&a.revealOrder[0]==="b"&&u.reverse();for(var f=u.length;f--;)this.o.set(u[f],this.u=[1,0,this.u]);return a.children},Hs.prototype.componentDidUpdate=Hs.prototype.componentDidMount=function(){var a=this;this.o.forEach(function(u,f){SS(a,f,u)})};var xS=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,kN=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,jN=function(a){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(a)};function PS(a,u,f){return u.__k==null&&(u.textContent=""),zs(a,u),typeof f=="function"&&f(),a?a.__c:null}function AS(a,u,f){return aS(a,u),typeof f=="function"&&f(),a?a.__c:null}ii.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(a){Object.defineProperty(ii.prototype,a,{configurable:!0,get:function(){return this["UNSAFE_"+a]},set:function(u){Object.defineProperty(this,a,{configurable:!0,writable:!0,value:u})}})});var CS=Ct.event;function zN(){}function GN(){return this.cancelBubble}function WN(){return this.defaultPrevented}Ct.event=function(a){return CS&&(a=CS(a)),a.persist=zN,a.isPropagationStopped=GN,a.isDefaultPrevented=WN,a.nativeEvent=a};var RS,OS={configurable:!0,get:function(){return this.class}},MS=Ct.vnode;Ct.vnode=function(a){var u=a.type,f=a.props,s=f;if(typeof u=="string"){for(var c in s={},f){var T=f[c];c==="value"&&"defaultValue"in f&&T==null||(c==="defaultValue"&&"value"in f&&f.value==null?c="value":c==="download"&&T===!0?T="":/ondoubleclick/i.test(c)?c="ondblclick":/^onchange(textarea|input)/i.test(c+u)&&!jN(f.type)?c="oninput":/^on(Ani|Tra|Tou|BeforeInp)/.test(c)?c=c.toLowerCase():kN.test(c)?c=c.replace(/[A-Z0-9]/,"-$&").toLowerCase():T===null&&(T=void 0),s[c]=T)}u=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=lo(f.children).forEach(function(m){m.props.selected=s.value.indexOf(m.props.value)!=-1})),u=="select"&&s.defaultValue!=null&&(s.value=lo(f.children).forEach(function(m){m.props.selected=s.multiple?s.defaultValue.indexOf(m.props.value)!=-1:s.defaultValue==m.props.value})),a.props=s}u&&f.class!=f.className&&(OS.enumerable="className"in f,f.className!=null&&(s.class=f.className),Object.defineProperty(s,"className",OS)),a.$$typeof=xS,MS&&MS(a)};var IS=Ct.__r;Ct.__r=function(a){IS&&IS(a),RS=a.__c};var DS={ReactCurrentDispatcher:{current:{readContext:function(a){return RS.__n[a.__c].props.value}}}},HN="17.0.2";function wS(a){return Ye.bind(null,a)}function Qo(a){return!!a&&a.$$typeof===xS}function qo(a){return Qo(a)?wN.apply(null,arguments):a}function LS(a){return!!a.__k&&(zs(null,a),!0)}function NS(a){return a&&(a.base||a.nodeType===1&&a)||null}var FS=function(a,u){return a(u)},BS=function(a,u){return a(u)},XN=qn,oi={useState:mn,useReducer:Jh,useEffect:Ut,useLayoutEffect:Ko,useRef:Nt,useImperativeHandle:fS,useMemo:Dn,useCallback:Vt,useContext:Jt,useDebugValue:pS,version:"17.0.2",Children:Rl,render:PS,hydrate:AS,unmountComponentAtNode:LS,createPortal:td,createElement:Ye,createContext:fr,createFactory:wS,cloneElement:qo,createRef:QE,Fragment:qn,isValidElement:Qo,findDOMNode:NS,Component:ii,PureComponent:Al,memo:Cl,forwardRef:bi,flushSync:BS,unstable_batchedUpdates:FS,StrictMode:qn,Suspense:Ol,SuspenseList:Hs,lazy:ES,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:DS},YN=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:oi,version:HN,Children:Rl,render:PS,hydrate:AS,unmountComponentAtNode:LS,createPortal:td,createFactory:wS,cloneElement:qo,isValidElement:Qo,findDOMNode:NS,PureComponent:Al,memo:Cl,forwardRef:bi,flushSync:BS,unstable_batchedUpdates:FS,StrictMode:XN,Suspense:Ol,SuspenseList:Hs,lazy:ES,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:DS,createElement:Ye,createContext:fr,createRef:QE,Fragment:qn,Component:ii,useState:mn,useReducer:Jh,useEffect:Ut,useLayoutEffect:Ko,useRef:Nt,useImperativeHandle:fS,useMemo:Dn,useCallback:Vt,useContext:Jt,useDebugValue:pS,useErrorBoundary:LN});const g_=(a,u)=>{const[f,s]=mn(v_()[1][a]||u);Ut(()=>{const T=m=>{const E=v_()[1];s(E[a])};return window.addEventListener("hashchange",T),()=>window.removeEventListener("hashchange",T)},[]);const c=Vt((T,m)=>{const E=v_()[1];let d=!1;if(E.hasOwnProperty(a)&&T===null||T===void 0?(delete E[a],d=!0):E[a]!==T&&(E[a]=T,d=!0),!d)return[];const x=Object.keys(E);x.sort();const M=x.map((R,I)=>`${R}=${encodeURI(E[R])}`).join("&");let w=window.location.hash.substr(1);const S=w.indexOf("?");let _="";S>-1&&(_=w.substr(0,S));const O=new URL(window.location.href);O.hash=`${_}?${M}`,(m==null?void 0:m.modifyHistory)?window.location.hash=`${_}?${M}`:(window.history.replaceState(null,document.title,`${O.pathname}${O.search}${O.hash}`),window.dispatchEvent(new HashChangeEvent("hashchange")))},[]);return[f,c]},v_=()=>{let a=window.location.hash.substr(1);const u=a.indexOf("?");if(u===-1)return[a,{}];const f=a.substr(0,u);a=a.substr(u+1);const s=Object.fromEntries(a.split("&").filter(c=>c.length>0).map(c=>c.split("=")));return Object.keys(s).forEach(c=>s[c]=decodeURI(s[c])),[f,s]},KN=(a,u)=>{const[f,s]=g_(a,u?US(u):void 0),[c,T]=mn(u);Ut(()=>{T(QN(f))},[a,f,T]);const m=Vt((E,d)=>{if(E==null)s(void 0,d);else{const x=US(E);s(x,d)}},[s]);return[c,m]},US=a=>btoa(a),QN=a=>{if(a&&a.length>0)return atob(a)},qN=(a,u)=>{const[f,s]=g_(a,u?VS(u):void 0),[c,T]=mn(kS(f));Ut(()=>{T(kS(f))},[a,f,T]);const m=Vt((E,d)=>{if(E==null)s(void 0,d);else{const x=VS(E);s(x,d)}},[s]);return[c,m]},VS=a=>btoa(JSON.stringify(a)),kS=a=>{if(a&&a.length>0)try{return JSON.parse(atob(a))}catch(u){console.error(u)}};var Fe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ZN(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function b_(a){if(a.__esModule)return a;var u=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(a).forEach(function(f){var s=Object.getOwnPropertyDescriptor(a,f);Object.defineProperty(u,f,s.get?s:{enumerable:!0,get:function(){return a[f]}})}),u}var $N={},JN=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:$N}),eF=b_(JN),tF=function(a,u){for(var f=[],s=0;s<a.length;s++){var c=u(a[s],s);nF(c)?f.push.apply(f,c):f.push(c)}return f},nF=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},rF=jS;function jS(a,u,f){a instanceof RegExp&&(a=zS(a,f)),u instanceof RegExp&&(u=zS(u,f));var s=GS(a,u,f);return s&&{start:s[0],end:s[1],pre:f.slice(0,s[0]),body:f.slice(s[0]+a.length,s[1]),post:f.slice(s[1]+u.length)}}function zS(a,u){var f=u.match(a);return f?f[0]:null}jS.range=GS;function GS(a,u,f){var s,c,T,m,E,d=f.indexOf(a),x=f.indexOf(u,d+1),M=d;if(d>=0&&x>0){if(a===u)return[d,x];for(s=[],T=f.length;M>=0&&!E;)M==d?(s.push(M),d=f.indexOf(a,M+1)):s.length==1?E=[s.pop(),x]:(c=s.pop(),c<T&&(T=c,m=x),x=f.indexOf(u,M+1)),M=d<x&&d>=0?d:x;s.length&&(E=[T,m])}return E}var iF=tF,WS=rF,oF=cF,HS="\0SLASH"+Math.random()+"\0",XS="\0OPEN"+Math.random()+"\0",y_="\0CLOSE"+Math.random()+"\0",YS="\0COMMA"+Math.random()+"\0",KS="\0PERIOD"+Math.random()+"\0";function T_(a){return parseInt(a,10)==a?parseInt(a,10):a.charCodeAt(0)}function aF(a){return a.split("\\\\").join(HS).split("\\{").join(XS).split("\\}").join(y_).split("\\,").join(YS).split("\\.").join(KS)}function sF(a){return a.split(HS).join("\\").split(XS).join("{").split(y_).join("}").split(YS).join(",").split(KS).join(".")}function QS(a){if(!a)return[""];var u=[],f=WS("{","}",a);if(!f)return a.split(",");var s=f.pre,c=f.body,T=f.post,m=s.split(",");m[m.length-1]+="{"+c+"}";var E=QS(T);return T.length&&(m[m.length-1]+=E.shift(),m.push.apply(m,E)),u.push.apply(u,m),u}function cF(a){return a?(a.substr(0,2)==="{}"&&(a="\\{\\}"+a.substr(2)),Xs(aF(a),!0).map(sF)):[]}function lF(a){return"{"+a+"}"}function uF(a){return/^-?0\d/.test(a)}function hF(a,u){return a<=u}function dF(a,u){return a>=u}function Xs(a,u){var f=[],s=WS("{","}",a);if(!s||/\$$/.test(s.pre))return[a];var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),T=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),m=c||T,E=s.body.indexOf(",")>=0;if(!m&&!E)return s.post.match(/,.*\}/)?(a=s.pre+"{"+s.body+y_+s.post,Xs(a)):[a];var d;if(m)d=s.body.split(/\.\./);else if(d=QS(s.body),d.length===1&&(d=Xs(d[0],!1).map(lF),d.length===1)){var M=s.post.length?Xs(s.post,!1):[""];return M.map(function(X){return s.pre+d[0]+X})}var x=s.pre,M=s.post.length?Xs(s.post,!1):[""],w;if(m){var S=T_(d[0]),_=T_(d[1]),O=Math.max(d[0].length,d[1].length),R=d.length==3?Math.abs(T_(d[2])):1,I=hF,y=_<S;y&&(R*=-1,I=dF);var p=d.some(uF);w=[];for(var g=S;I(g,_);g+=R){var C;if(T)C=String.fromCharCode(g),C==="\\"&&(C="");else if(C=String(g),p){var P=O-C.length;if(P>0){var F=new Array(P+1).join("0");g<0?C="-"+F+C.slice(1):C=F+C}}w.push(C)}}else w=iF(d,function(z){return Xs(z,!1)});for(var U=0;U<w.length;U++)for(var B=0;B<M.length;B++){var L=x+w[U]+M[B];(!u||m||L)&&f.push(L)}return f}var fF=ai;ai.Minimatch=er;var Ml={sep:"/"};try{Ml=eF}catch(a){}var E_=ai.GLOBSTAR=er.GLOBSTAR={},pF=oF,qS={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},S_="[^/]",x_=S_+"*?",mF="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",_F="(?:(?!(?:\\/|^)\\.).)*?",ZS=gF("().*{}+?[]^$\\!");function gF(a){return a.split("").reduce(function(u,f){return u[f]=!0,u},{})}var $S=/\/+/;ai.filter=vF;function vF(a,u){return u=u||{},function(f,s,c){return ai(f,a,u)}}function JS(a,u){a=a||{},u=u||{};var f={};return Object.keys(u).forEach(function(s){f[s]=u[s]}),Object.keys(a).forEach(function(s){f[s]=a[s]}),f}ai.defaults=function(a){if(!a||!Object.keys(a).length)return ai;var u=ai,f=function(c,T,m){return u.minimatch(c,T,JS(a,m))};return f.Minimatch=function(c,T){return new u.Minimatch(c,JS(a,T))},f},er.defaults=function(a){return!a||!Object.keys(a).length?er:ai.defaults(a).Minimatch};function ai(a,u,f){if(typeof u!="string")throw new TypeError("glob pattern string required");return f||(f={}),!f.nocomment&&u.charAt(0)==="#"?!1:u.trim()===""?a==="":new er(u,f).match(a)}function er(a,u){if(!(this instanceof er))return new er(a,u);if(typeof a!="string")throw new TypeError("glob pattern string required");u||(u={}),a=a.trim(),Ml.sep!=="/"&&(a=a.split(Ml.sep).join("/")),this.options=u,this.set=[],this.pattern=a,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}er.prototype.debug=function(){},er.prototype.make=bF;function bF(){if(!this._made){var a=this.pattern,u=this.options;if(!u.nocomment&&a.charAt(0)==="#"){this.comment=!0;return}if(!a){this.empty=!0;return}this.parseNegate();var f=this.globSet=this.braceExpand();u.debug&&(this.debug=console.error),this.debug(this.pattern,f),f=this.globParts=f.map(function(s){return s.split($S)}),this.debug(this.pattern,f),f=f.map(function(s,c,T){return s.map(this.parse,this)},this),this.debug(this.pattern,f),f=f.filter(function(s){return s.indexOf(!1)===-1}),this.debug(this.pattern,f),this.set=f}}er.prototype.parseNegate=yF;function yF(){var a=this.pattern,u=!1,f=this.options,s=0;if(!f.nonegate){for(var c=0,T=a.length;c<T&&a.charAt(c)==="!";c++)u=!u,s++;s&&(this.pattern=a.substr(s)),this.negate=u}}ai.braceExpand=function(a,u){return ex(a,u)},er.prototype.braceExpand=ex;function ex(a,u){if(u||(this instanceof er?u=this.options:u={}),a=typeof a=="undefined"?this.pattern:a,typeof a=="undefined")throw new TypeError("undefined pattern");return u.nobrace||!a.match(/\{.*\}/)?[a]:pF(a)}er.prototype.parse=TF;var nd={};function TF(a,u){if(a.length>1024*64)throw new TypeError("pattern is too long");var f=this.options;if(!f.noglobstar&&a==="**")return E_;if(a==="")return"";var s="",c=!!f.nocase,T=!1,m=[],E=[],d,x=!1,M=-1,w=-1,S=a.charAt(0)==="."?"":f.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",_=this;function O(){if(d){switch(d){case"*":s+=x_,c=!0;break;case"?":s+=S_,c=!0;break;default:s+="\\"+d;break}_.debug("clearStateChar %j %j",d,s),d=!1}}for(var R=0,I=a.length,y;R<I&&(y=a.charAt(R));R++){if(this.debug("%s	%s %s %j",a,R,s,y),T&&ZS[y]){s+="\\"+y,T=!1;continue}switch(y){case"/":return!1;case"\\":O(),T=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",a,R,s,y),x){this.debug("  in class"),y==="!"&&R===w+1&&(y="^"),s+=y;continue}_.debug("call clearStateChar %j",d),O(),d=y,f.noext&&O();continue;case"(":if(x){s+="(";continue}if(!d){s+="\\(";continue}m.push({type:d,start:R-1,reStart:s.length,open:qS[d].open,close:qS[d].close}),s+=d==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",d,s),d=!1;continue;case")":if(x||!m.length){s+="\\)";continue}O(),c=!0;var p=m.pop();s+=p.close,p.type==="!"&&E.push(p),p.reEnd=s.length;continue;case"|":if(x||!m.length||T){s+="\\|",T=!1;continue}O(),s+="|";continue;case"[":if(O(),x){s+="\\"+y;continue}x=!0,w=R,M=s.length,s+=y;continue;case"]":if(R===w+1||!x){s+="\\"+y,T=!1;continue}if(x){var g=a.substring(w+1,R);try{RegExp("["+g+"]")}catch(se){var C=this.parse(g,nd);s=s.substr(0,M)+"\\["+C[0]+"\\]",c=c||C[1],x=!1;continue}}c=!0,x=!1,s+=y;continue;default:O(),T?T=!1:ZS[y]&&!(y==="^"&&x)&&(s+="\\"),s+=y}}for(x&&(g=a.substr(w+1),C=this.parse(g,nd),s=s.substr(0,M)+"\\["+C[0],c=c||C[1]),p=m.pop();p;p=m.pop()){var P=s.slice(p.reStart+p.open.length);this.debug("setting tail",s,p),P=P.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(se,V,K){return K||(K="\\"),V+V+K+"|"}),this.debug(`tail=%j
   %s`,P,P,p,s);var F=p.type==="*"?x_:p.type==="?"?S_:"\\"+p.type;c=!0,s=s.slice(0,p.reStart)+F+"\\("+P}O(),T&&(s+="\\\\");var U=!1;switch(s.charAt(0)){case".":case"[":case"(":U=!0}for(var B=E.length-1;B>-1;B--){var L=E[B],z=s.slice(0,L.reStart),X=s.slice(L.reStart,L.reEnd-8),G=s.slice(L.reEnd-8,L.reEnd),ee=s.slice(L.reEnd);G+=ee;var $=z.split("(").length-1,fe=ee;for(R=0;R<$;R++)fe=fe.replace(/\)[+*?]?/,"");ee=fe;var me="";ee===""&&u!==nd&&(me="$");var ve=z+X+ee+me+G;s=ve}if(s!==""&&c&&(s="(?=.)"+s),U&&(s=S+s),u===nd)return[s,c];if(!c)return xF(a);var be=f.nocase?"i":"";try{var ie=new RegExp("^"+s+"$",be)}catch(se){return new RegExp("$.")}return ie._glob=a,ie._src=s,ie}ai.makeRe=function(a,u){return new er(a,u||{}).makeRe()},er.prototype.makeRe=EF;function EF(){if(this.regexp||this.regexp===!1)return this.regexp;var a=this.set;if(!a.length)return this.regexp=!1,this.regexp;var u=this.options,f=u.noglobstar?x_:u.dot?mF:_F,s=u.nocase?"i":"",c=a.map(function(T){return T.map(function(m){return m===E_?f:typeof m=="string"?PF(m):m._src}).join("\\/")}).join("|");c="^(?:"+c+")$",this.negate&&(c="^(?!"+c+").*$");try{this.regexp=new RegExp(c,s)}catch(T){this.regexp=!1}return this.regexp}ai.match=function(a,u,f){f=f||{};var s=new er(u,f);return a=a.filter(function(c){return s.match(c)}),s.options.nonull&&!a.length&&a.push(u),a},er.prototype.match=SF;function SF(a,u){if(this.debug("match",a,this.pattern),this.comment)return!1;if(this.empty)return a==="";if(a==="/"&&u)return!0;var f=this.options;Ml.sep!=="/"&&(a=a.split(Ml.sep).join("/")),a=a.split($S),this.debug(this.pattern,"split",a);var s=this.set;this.debug(this.pattern,"set",s);var c,T;for(T=a.length-1;T>=0&&(c=a[T],!c);T--);for(T=0;T<s.length;T++){var m=s[T],E=a;f.matchBase&&m.length===1&&(E=[c]);var d=this.matchOne(E,m,u);if(d)return f.flipNegate?!0:!this.negate}return f.flipNegate?!1:this.negate}er.prototype.matchOne=function(a,u,f){var s=this.options;this.debug("matchOne",{this:this,file:a,pattern:u}),this.debug("matchOne",a.length,u.length);for(var c=0,T=0,m=a.length,E=u.length;c<m&&T<E;c++,T++){this.debug("matchOne loop");var d=u[T],x=a[c];if(this.debug(u,d,x),d===!1)return!1;if(d===E_){this.debug("GLOBSTAR",[u,d,x]);var M=c,w=T+1;if(w===E){for(this.debug("** at the end");c<m;c++)if(a[c]==="."||a[c]===".."||!s.dot&&a[c].charAt(0)===".")return!1;return!0}for(;M<m;){var S=a[M];if(this.debug(`
globstar while`,a,M,u,w,S),this.matchOne(a.slice(M),u.slice(w),f))return this.debug("globstar found match!",M,m,S),!0;if(S==="."||S===".."||!s.dot&&S.charAt(0)==="."){this.debug("dot detected!",a,M,u,w);break}this.debug("globstar swallow a segment, and continue"),M++}return!!(f&&(this.debug(`
>>> no match, partial?`,a,M,u,w),M===m))}var _;if(typeof d=="string"?(s.nocase?_=x.toLowerCase()===d.toLowerCase():_=x===d,this.debug("string match",d,x,_)):(_=x.match(d),this.debug("pattern match",d,x,_)),!_)return!1}if(c===m&&T===E)return!0;if(c===m)return f;if(T===E){var O=c===m-1&&a[c]==="";return O}throw new Error("wtf?")};function xF(a){return a.replace(/\\(.)/g,"$1")}function PF(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var rd;(function(a){a.V0_3="0.3",a.V0_4="0.4"})(rd||(rd={}));var yi;(function(a){a.V0_2="0.2",a.V0_3="0.3"})(yi||(yi={}));const tx=Object.keys(rd);rd.V0_4;const nx=Object.keys(yi),id=yi.V0_3;var jt;(function(a){a.Inputs="inputs",a.Outputs="outputs",a.State="state",a.Definition="definition",a.DefinitionUpdateRequest="definitionupdaterequest",a.Error="error",a.UrlHashUpdate="urlhashupdate",a.Message="Message"})(jt||(jt={}));var Pr;(function(a){a.InputsUpdate="InputsUpdate",a.OutputsUpdate="OutputsUpdate",a.SetupIframeClientRequest="SetupIframeClientRequest",a.SetupIframeServerResponseAck="SetupIframeServerResponseAck",a.PluginRequest="SetupIframeServerPluginRequestResponseAck",a.HashParamsUpdate="HashParamsUpdate"})(Pr||(Pr={}));var uo;(function(a){a.InputsUpdate="InputsUpdate",a.MessageAck="MessageAck",a.SetupIframeServerResponse="SetupIframeServerResponse"})(uo||(uo={}));var P_;(function(a){a.State="metapage/state"})(P_||(P_={}));const Ui="metapage/definition",Zo="metapage/state",rx=nx[nx.length-1],AF=tx[tx.length-1];var Il={exports:{}};(function(a,u){(function(f,s){a.exports=s()})(Fe,function(){var f=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function s(w,S){return w.indexOf(S)===-1?w.length:w.indexOf(S)}function c(w){var S=w.replace(/^v/,"").replace(/\+.*$/,""),_=s(S,"-"),O=S.substring(0,_).split(".");return O.push(S.substring(_+1)),O}function T(w){return isNaN(Number(w))?w:Number(w)}function m(w){if(typeof w!="string")throw new TypeError("Invalid argument expected string");if(!f.test(w))throw new Error("Invalid argument not valid semver ('"+w+"' received)")}function E(w,S){[w,S].forEach(m);for(var _=c(w),O=c(S),R=0;R<Math.max(_.length-1,O.length-1);R++){var I=parseInt(_[R]||0,10),y=parseInt(O[R]||0,10);if(I>y)return 1;if(y>I)return-1}var p=_[_.length-1],g=O[O.length-1];if(p&&g){var C=p.split(".").map(T),P=g.split(".").map(T);for(R=0;R<Math.max(C.length,P.length);R++){if(C[R]===void 0||typeof P[R]=="string"&&typeof C[R]=="number")return-1;if(P[R]===void 0||typeof C[R]=="string"&&typeof P[R]=="number"||C[R]>P[R])return 1;if(P[R]>C[R])return-1}}else if(p||g)return p?-1:1;return 0}var d=[">",">=","=","<","<="],x={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function M(w){if(typeof w!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof w);if(d.indexOf(w)===-1)throw new TypeError("Invalid operator, expected one of "+d.join("|"))}return E.validate=function(w){return typeof w=="string"&&f.test(w)},E.compare=function(w,S,_){M(_);var O=E(w,S);return x[_].indexOf(O)>-1},E})})(Il);var od={exports:{}};(function(a){var u=Object.prototype.hasOwnProperty,f="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(f=!1));function c(d,x,M){this.fn=d,this.context=x,this.once=M||!1}function T(d,x,M,w,S){if(typeof M!="function")throw new TypeError("The listener must be a function");var _=new c(M,w||d,S),O=f?f+x:x;return d._events[O]?d._events[O].fn?d._events[O]=[d._events[O],_]:d._events[O].push(_):(d._events[O]=_,d._eventsCount++),d}function m(d,x){--d._eventsCount==0?d._events=new s:delete d._events[x]}function E(){this._events=new s,this._eventsCount=0}E.prototype.eventNames=function(){var x=[],M,w;if(this._eventsCount===0)return x;for(w in M=this._events)u.call(M,w)&&x.push(f?w.slice(1):w);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(M)):x},E.prototype.listeners=function(x){var M=f?f+x:x,w=this._events[M];if(!w)return[];if(w.fn)return[w.fn];for(var S=0,_=w.length,O=new Array(_);S<_;S++)O[S]=w[S].fn;return O},E.prototype.listenerCount=function(x){var M=f?f+x:x,w=this._events[M];return w?w.fn?1:w.length:0},E.prototype.emit=function(x,M,w,S,_,O){var R=f?f+x:x;if(!this._events[R])return!1;var I=this._events[R],y=arguments.length,p,g;if(I.fn){switch(I.once&&this.removeListener(x,I.fn,void 0,!0),y){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,M),!0;case 3:return I.fn.call(I.context,M,w),!0;case 4:return I.fn.call(I.context,M,w,S),!0;case 5:return I.fn.call(I.context,M,w,S,_),!0;case 6:return I.fn.call(I.context,M,w,S,_,O),!0}for(g=1,p=new Array(y-1);g<y;g++)p[g-1]=arguments[g];I.fn.apply(I.context,p)}else{var C=I.length,P;for(g=0;g<C;g++)switch(I[g].once&&this.removeListener(x,I[g].fn,void 0,!0),y){case 1:I[g].fn.call(I[g].context);break;case 2:I[g].fn.call(I[g].context,M);break;case 3:I[g].fn.call(I[g].context,M,w);break;case 4:I[g].fn.call(I[g].context,M,w,S);break;default:if(!p)for(P=1,p=new Array(y-1);P<y;P++)p[P-1]=arguments[P];I[g].fn.apply(I[g].context,p)}}return!0},E.prototype.on=function(x,M,w){return T(this,x,M,w,!1)},E.prototype.once=function(x,M,w){return T(this,x,M,w,!0)},E.prototype.removeListener=function(x,M,w,S){var _=f?f+x:x;if(!this._events[_])return this;if(!M)return m(this,_),this;var O=this._events[_];if(O.fn)O.fn===M&&(!S||O.once)&&(!w||O.context===w)&&m(this,_);else{for(var R=0,I=[],y=O.length;R<y;R++)(O[R].fn!==M||S&&!O[R].once||w&&O[R].context!==w)&&I.push(O[R]);I.length?this._events[_]=I.length===1?I[0]:I:m(this,_)}return this},E.prototype.removeAllListeners=function(x){var M;return x?(M=f?f+x:x,this._events[M]&&m(this,M)):(this._events=new s,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=f,E.EventEmitter=E,a.exports=E})(od);var ad;(function(a){a.mp_debug="mp_debug"})(ad||(ad={}));const CF=()=>{try{return window!==window.top}catch(a){return!1}};class RF extends od.exports.EventEmitter{constructor(){super();this._definition={version:yi.V0_3,metaframes:{}},this.getDefinition=this.getDefinition.bind(this)}error(u){throw"Subclass should implement"}getDefinition(){return this._definition}}var OF=function(a,u,f,s){function c(T){return T instanceof f?T:new f(function(m){m(T)})}return new(f||(f=Promise))(function(T,m){function E(M){try{x(s.next(M))}catch(w){m(w)}}function d(M){try{x(s.throw(M))}catch(w){m(w)}}function x(M){M.done?T(M.value):c(M.value).then(E,d)}x((s=s.apply(a,u||[])).next())})};const ix=a=>{if(a===null)throw"Metapage definition cannot be null";if(typeof a=="string")try{a=JSON.parse(a)}catch(f){throw`Cannot parse into JSON:
${a}`}let u;switch(IF(a.version)){case yi.V0_2:{u=ix(MF(a));break}case yi.V0_3:{u=a;break}default:console.warn(`Metapage definition version=${a.version} but we only know up to version ${id}. Assuming the definition is compatible, but it's the future!`),u=a;break}return u},MF=a=>(a.version=yi.V0_3,a),sd=(a,u)=>{if(!u)return!1;let f=!1;return Object.keys(u).forEach(s=>{f=!0,u[s]===void 0?delete a[s]:a[s]=u[s]}),f},IF=a=>{if(a=="latest")return id;if(Il.exports.compare(a,"0.2","<"))throw`Unknown version: ${a}`;return Il.exports.compare(a,"0.2",">=")&&Il.exports.compare(a,yi.V0_3,"<")?yi.V0_2:Il.exports.compare(a,"0.3",">=")?yi.V0_3:(console.log(`Could not match version=${a} to any known version, assuming ${id}`),id)},A_=()=>{const a=new URLSearchParams(window.location.search).get(ad.mp_debug);return a==="true"||a==="1"},DF=a=>a.filter(f=>new URLSearchParams(window.location.search).has(f)).length>0,wF=(a=8)=>LF(a),ox="abcdefghijklmnopqrstuvwxyz0123456789",LF=(a=8)=>{for(var u="",f=ox.length,s=0;s<a;s++)u+=ox.charAt(Math.floor(Math.random()*f));return u},C_=(a,u,f)=>{u=u||"000",u&&u.trim()==""&&(u=void 0);let s;if(typeof a=="string"?s=a:typeof a=="number"?s=a+"":s=JSON.stringify(a,null,"  "),u&&u.trim()!=""){var c=`color: #${u}`;f&&(c=`${c}; background: #${f}`),s=`%c${s}`,window.console.log(s,c)}else window.console.log(s)},ax=a=>FF(NF(a)),NF=a=>{var u=0;for(let f=0;f<a.length;f++)u=a.charCodeAt(f)+((u<<5)-u);return u},FF=a=>{var u=(a&16777215).toString(16).toUpperCase();return"00000".substring(0,6-u.length)+u},R_=()=>document.readyState=="complete"||document.readyState=="interactive",O_=()=>OF(void 0,void 0,void 0,function*(){return R_()?Promise.resolve():new Promise(a=>{if(R_()){a();return}let u=!1;window.addEventListener("load",()=>{u||(u=!0,a())}),setTimeout(()=>{!u&&R_()&&(u=!0,a())},200)})});var sx=function(a,u,f,s){function c(T){return T instanceof f?T:new f(function(m){m(T)})}return new(f||(f=Promise))(function(T,m){function E(M){try{x(s.next(M))}catch(w){m(w)}}function d(M){try{x(s.throw(M))}catch(w){m(w)}}function x(M){M.done?T(M.value):c(M.value).then(E,d)}x((s=s.apply(a,u||[])).next())})};class cx extends od.exports.EventEmitter{constructor(u,f,s,c,T,m=!1){super();if(this.inputs={},this.outputs={},this._disposables=[],this._rpcListeners=[],this._loaded=!1,this._onLoaded=[],this._sendInputsAfterRegistration=!1,this._plugin=!1,this._cachedEventInputsUpdate={iframeId:void 0,inputs:void 0},this._cachedEventOutputsUpdate={iframeId:null,inputs:null},!f.startsWith("http")){for(;f.startsWith("/");)f=f.substr(1);f=window.location.protocol+"//"+window.location.hostname+(window.location.port&&window.location.port!=""?":"+window.location.port:"")+"/"+f}this.url=f,this._metapage=u;var E=new URL(this.url);m&&E.searchParams.set(ad.mp_debug,"true"),this.url=E.href,this.id=s,this._debug=m,this._parentId=c,this._color=ax(this.id),this._consoleBackgroundColor=T,this._iframe=document.createElement("iframe"),this._iframe.name=this.id;const d=this;this.iframe=new Promise(x=>{O_().then(()=>sx(this,void 0,void 0,function*(){if(d._iframe){const M=yield d.getDefinition();if(!d._iframe)return;(M==null?void 0:M.allow)&&(d._iframe.allow=M.allow),d._iframe.src=this.url,x(d._iframe)}}))}),this.ack=this.ack.bind(this),this.dispose=this.dispose.bind(this),this.getDefinition=this.getDefinition.bind(this),this.getDefinitionUrl=this.getDefinitionUrl.bind(this),this.setPlugin=this.setPlugin.bind(this),this.hasPermissionsDefinition=this.hasPermissionsDefinition.bind(this),this.hasPermissionsState=this.hasPermissionsState.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onOutput=this.onOutput.bind(this),this.onOutputs=this.onOutputs.bind(this),this.register=this.register.bind(this),this.registered=this.registered.bind(this),this.sendInputs=this.sendInputs.bind(this),this.sendOrBufferPostMessage=this.sendOrBufferPostMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.sendRpcInternal=this.sendRpcInternal.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setMetapage=this.setMetapage.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.setPlugin=this.setPlugin.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.isDisposed=this.isDisposed.bind(this)}addListenerReturnDisposer(u,f){return super.addListener(u,f),()=>{super.removeListener(u,f)}}setPlugin(){if(this._loaded)throw"Cannot setPlugin after MetapageIFrameRpcClient already loaded";return this._plugin=!0,this}setMetapage(u){return this._metapage=u,this}hasPermissionsState(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[Zo]!==void 0}hasPermissionsDefinition(){return this._definition!==void 0&&this._definition.inputs!==void 0&&this._definition.inputs[Ui]!==void 0}getDefinitionUrl(){var u=new URL(this.url);return u.pathname=u.pathname+(u.pathname.endsWith("/")?"metaframe.json":"/metaframe.json"),u.href}getDefinition(){return sx(this,void 0,void 0,function*(){if(this._definition)return this._definition;var u=this.getDefinitionUrl();try{const f=yield window.fetch(u);if(f.ok){const s=yield f.json();return this._definition=s,this._definition}else this.emit(jt.Error,`Failed to fetch: ${u}
Status: ${f.status}
Status text: ${f.statusText}`)}catch(f){this.emit(jt.Error,`Failed to fetch: ${u}
Error: ${f}`)}})}setInput(u,f){console.assert(!!u);var s={};s[u]=f,this.setInputs(s)}setInputs(u){if(this.log({m:"MetapageIFrameRpcClient",inputs:u}),!sd(this.inputs,u))return this;if(this._loaded||(this._sendInputsAfterRegistration=!0),this._iframe.parentNode&&this._loaded&&this.sendInputs(u),this.emit(jt.Inputs,this.inputs),this._metapage.listenerCount(jt.Inputs)>0){var f={};f[this.id]=u,this._metapage.emit(jt.Inputs,f)}return this}setOutput(u,f){console.assert(!!u);var s={};s[u]=f,this.setOutputs(s)}setOutputs(u){if(!!sd(this.outputs,u)&&(this.emit(jt.Outputs,u),this._metapage.listenerCount(jt.Outputs)>0)){var f={};f[this.id]=this.outputs,this._metapage.emit(jt.Outputs,f)}}onInputs(u){return this.addListenerReturnDisposer(jt.Inputs,u)}onInput(u,f){var s=function(c){c.hasOwnProperty(u)&&f(c[u])};return this.addListenerReturnDisposer(jt.Inputs,s)}onOutputs(u){return this.addListenerReturnDisposer(jt.Outputs,u)}onOutput(u,f){var s=function(c){c.hasOwnProperty(u)&&f(c[u])};return this.addListenerReturnDisposer(jt.Outputs,s)}isDisposed(){return this.inputs===void 0}dispose(){for(super.removeAllListeners();this._disposables&&this._disposables.length>0;){const u=this._disposables.pop();u&&u()}this._rpcListeners=void 0,this.inputs=void 0,this.outputs=void 0,this._iframe&&this._iframe.parentNode&&this._iframe.parentNode.removeChild(this._iframe),this._iframe=void 0,this._bufferMessages=void 0,this._bufferTimeout&&(window.clearInterval(this._bufferTimeout),this._bufferTimeout=void 0),this._metapage=void 0}register(){var u={iframeId:this.id,parentId:this._parentId,plugin:this._plugin,state:{inputs:this.inputs},version:rx};this.sendRpcInternal(uo.SetupIframeServerResponse,u)}registered(u){if(this.log({m:"MetapageIFrameRpcClient.registered",inputs:this.inputs}),!this._loaded){if(!u)throw"Cannot register without a version";for(this.version=u,this._loaded=!0;this._onLoaded&&this._onLoaded.length>0;)this._onLoaded.pop()();this._sendInputsAfterRegistration&&this.sendInputs(this.inputs)}}sendInputs(u){this.sendRpc(uo.InputsUpdate,{inputs:u,parentId:this._parentId})}sendRpc(u,f){if(this._iframe.parentNode&&this._loaded)this.sendRpcInternal(u,f);else{this._metapage.error("sending rpc later");const s=this;this._onLoaded.push(()=>{s.sendRpcInternal(u,f)})}}ack(u){if(this.log("\u2692 \u2692 \u2692 calling ack"),this._debug){this.log("\u2692 \u2692 \u2692 sending ack from client to frame");var f={message:u};this.sendRpc(uo.MessageAck,f)}else this.log("\u2692 \u2692 \u2692 NOT sending ack from client to frame since not debug mode")}log(u){!this._debug||this.logInternal(u)}logInternal(u){let f;typeof u=="string"?f=u:typeof u=="string"?f=u+"":f=JSON.stringify(u),C_(`Metapage[${this._parentId}] Metaframe[${this.id}] ${f}`,this._color,this._consoleBackgroundColor)}sendRpcInternal(u,f){const s={id:"_",iframeId:this.id,jsonrpc:"2.0",method:u,params:f,parentId:this._parentId};this._iframe?this.sendOrBufferPostMessage(s):this._metapage.error(`Cannot send to child iframe messageJSON=${JSON.stringify(s).substr(0,200)}`)}sendOrBufferPostMessage(u){if(this._iframe&&this._iframe.contentWindow)this._iframe.contentWindow.postMessage(u,this.url);else if(this._bufferMessages)this._bufferMessages.push(u);else{this._bufferMessages=[u];const f=this;this._bufferTimeout=window.setInterval(function(){f._iframe&&f._iframe.contentWindow&&(f._bufferMessages.forEach(s=>f._iframe.contentWindow.postMessage(s,f.url)),window.clearInterval(f._bufferTimeout),f._bufferTimeout=void 0,f._bufferMessages=void 0)},0)}}}var BF=function(a,u,f,s){function c(T){return T instanceof f?T:new f(function(m){m(T)})}return new(f||(f=Promise))(function(T,m){function E(M){try{x(s.next(M))}catch(w){m(w)}}function d(M){try{x(s.throw(M))}catch(w){m(w)}}function x(M){M.done?T(M.value):c(M.value).then(E,d)}x((s=s.apply(a,u||[])).next())})},lx;(function(a){a.all="all",a.delta="delta"})(lx||(lx={}));const ux=()=>({metaframes:{inputs:{},outputs:{}},plugins:{inputs:{},outputs:{}}}),UF="bcbcbc";class Ti extends RF{constructor(u){super();this._state=ux(),this._metaframes={},this._plugins={},this._pluginOrder=[],this.debug=A_(),this._internalReceivedMessageCounter=0,this._cachedInputLookupMap={},this._inputMap={},this._id=u&&u.id?u.id:wF(),this._consoleBackgroundColor=u&&u.color?u.color:UF,this.addPipe=this.addPipe.bind(this),this.dispose=this.dispose.bind(this),this.addMetaframe=this.addMetaframe.bind(this),this.addPlugin=this.addPlugin.bind(this),this.getInputsFromOutput=this.getInputsFromOutput.bind(this),this.getMetaframe=this.getMetaframe.bind(this),this.getMetaframeIds=this.getMetaframeIds.bind(this),this.getMetaframeOrPlugin=this.getMetaframeOrPlugin.bind(this),this.getMetaframes=this.getMetaframes.bind(this),this.getPlugin=this.getPlugin.bind(this),this.getPluginIds=this.getPluginIds.bind(this),this.getState=this.getState.bind(this),this.getStateMetaframes=this.getStateMetaframes.bind(this),this.isValidJSONRpcMessage=this.isValidJSONRpcMessage.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.metaframeIds=this.metaframeIds.bind(this),this.metaframes=this.metaframes.bind(this),this.onMessage=this.onMessage.bind(this),this.pluginIds=this.pluginIds.bind(this),this.plugins=this.plugins.bind(this),this.removeAll=this.removeAll.bind(this),this.removeMetaframe=this.removeMetaframe.bind(this),this.removePlugin=this.removePlugin.bind(this),this.setDebugFromUrlParams=this.setDebugFromUrlParams.bind(this),this.setDefinition=this.setDefinition.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInputStateOnly=this.setInputStateOnly.bind(this),this.setMetaframeClientInputAndSentClientEvent=this.setMetaframeClientInputAndSentClientEvent.bind(this),this.setOutputStateOnly=this.setOutputStateOnly.bind(this),this.setState=this.setState.bind(this),this.updatePluginsWithDefinition=this.updatePluginsWithDefinition.bind(this),this._emitDefinitionEvent=this._emitDefinitionEvent.bind(this),O_().then(()=>{window.addEventListener("message",this.onMessage),this.log("Initialized")})}static from(u,f){if(u==null)throw"Metapage definition cannot be null";if(typeof u=="string")try{u=JSON.parse(u)}catch(c){throw"Cannot parse into JSON:\n${metaPageDef}"}var s=new Ti;return s.setDefinition(u)}addListenerReturnDisposer(u,f){return super.addListener(u,f),()=>{super.removeListener(u,f)}}setDebugFromUrlParams(){return this.debug=DF(["MP_DEBUG","DEBUG","debug","mp_debug"]),this}getState(){return this._state}setState(u){this._state=u,this.getMetaframeIds().forEach(f=>{this.getMetaframe(f).setInputs(this._state.metaframes.inputs[f]),this.getMetaframe(f).setOutputs(this._state.metaframes.outputs[f])}),this.getPluginIds().forEach(f=>{this.getPlugin(f).setInputs(this._state.plugins.inputs[f]),this.getPlugin(f).setOutputs(this._state.plugins.outputs[f])}),this.emit(jt.State,this._state)}getStateMetaframes(){return this._state.metaframes}getDefinition(){return this._definition}setDefinition(u,f){const s=ix(u);return s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(s.plugins&&s.plugins.includes(c))throw this.emitErrorMessage(`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`),`Plugin with url=${c} matches metaframe. Metaframe ids and plugin urls are not allowed to collide`;var T=s.metaframes[c];if(typeof T!="object")throw this.emitErrorMessage(`Metaframe "${c}" is not an object`),`Metaframe "${c}" is not an object`;if(!T.url)throw this.emitErrorMessage(`Metaframe "${c}" missing field: url`),`Metaframe "${c}" missing field: url`}),this._definition=s,Object.keys(this._metaframes).forEach(c=>{(!s.metaframes||!s.metaframes[c])&&this.removeMetaframe(c)}),Object.keys(this._plugins).forEach(c=>{s.plugins&&!s.plugins.includes(c)&&this.removePlugin(c)}),this._pluginOrder=s.plugins?s.plugins:[],f&&(this._state=f),s.metaframes&&Object.keys(s.metaframes).forEach(c=>{if(!this._metaframes.hasOwnProperty(c)){const T=s.metaframes[c];this.addMetaframe(c,T)}}),s.plugins&&s.plugins.forEach(c=>{this._plugins.hasOwnProperty(c)||this.addPlugin(c)}),window.setTimeout(()=>{this._emitDefinitionEvent(),f&&this.emit(jt.State,this._state)},0),this}_emitDefinitionEvent(){const u={definition:this._definition,metaframes:this._metaframes,plugins:this._plugins};this.emit(jt.Definition,u)}addPipe(u,f){this._inputMap[u]||(this._inputMap[u]=[]),this._inputMap[u].push(f)}removeMetaframe(u){!this._metaframes[u]||(this._metaframes[u].dispose(),delete this._metaframes[u],delete this._state.metaframes.inputs[u],delete this._state.metaframes.outputs[u],delete this._inputMap[u],Object.keys(this._inputMap).forEach(f=>{var s;const c=this._inputMap[f];let T=0;for(;T<=c.length;)((s=c[T])===null||s===void 0?void 0:s.metaframe)===u?c.splice(T,1):T++}),this._cachedInputLookupMap={})}removePlugin(u){!this._plugins[u]||(this._plugins[u].dispose(),delete this._plugins[u],delete this._state.plugins.inputs[u],delete this._state.plugins.outputs[u])}removeAll(){Object.keys(this._metaframes).forEach(u=>this._metaframes[u].dispose()),Object.keys(this._plugins).forEach(u=>this._plugins[u].dispose()),this._metaframes={},this._plugins={},this._state=ux(),this._inputMap={},this._cachedInputLookupMap={}}metaframes(){return this.getMetaframes()}metaframeIds(){return this.getMetaframeIds()}getMetaframeIds(){return Object.keys(this._metaframes)}getMetaframes(){return Object.assign({},this._metaframes)}plugins(){return Object.assign({},this._plugins)}pluginIds(){return this.getPluginIds()}getPluginIds(){return this._pluginOrder.slice(0)}getMetaframe(u){return this._metaframes[u]}getPlugin(u){return this._plugins[u]}addMetaframe(u,f){if(!u)throw"addMetaframe missing metaframeId";if(!f)throw"addMetaframe missing definition";if(this._metaframes[u])throw this.emitErrorMessage(`Existing metaframe for id=${u}`),`Existing metaframe for id=${u}`;if(!f.url)throw this.emitErrorMessage(`Metaframe definition missing url id=${u}`),`Metaframe definition missing url id=${u}`;var s=new cx(this,f.url,u,this._id,this._consoleBackgroundColor,this.debug).setMetapage(this);return this._metaframes[u]=s,s.addListener(jt.Error,c=>{this.emit(jt.Error,{metaframeId:s.id,metaframeUrl:s.url,error:c})}),f.inputs&&f.inputs.forEach(c=>this.addPipe(u,c)),s.setInputs(this._state.metaframes.inputs[u]),s}addPlugin(u){if(!u)throw"Plugin missing url";const f=new cx(this,u,u,this._id,this._consoleBackgroundColor,this.debug).setInputs(this._state.plugins.inputs[u]).setMetapage(this).setPlugin();return VF(this,f),this._plugins[u]=f,f}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this._metaframes&&Object.keys(this._metaframes).forEach(u=>this._metaframes[u].dispose()),this._plugins&&Object.keys(this._plugins).forEach(u=>this._plugins[u].dispose()),this._id=void 0,this._metaframes=void 0,this._plugins=void 0,this._state=void 0,this._cachedInputLookupMap=void 0,this._inputMap=void 0}log(u,f,s){!this.debug||this.logInternal(u,f,s)}error(u){this.logInternal(u,"f00",this._consoleBackgroundColor),this.emitErrorMessage(`${u}`)}emitErrorMessage(u){this.emit(jt.Error,u)}getInputsFromOutput(u,f){if(this._cachedInputLookupMap[u]||(this._cachedInputLookupMap[u]={}),!this._cachedInputLookupMap[u][f]){var s=[];this._cachedInputLookupMap[u][f]=s,Object.keys(this._inputMap).forEach(c=>{c!==u&&this._inputMap[c].forEach(T=>{if(T.metaframe==u&&fF(f,T.source)){var m=T.target;(!T.target||T.target.startsWith("*")||T.target==="")&&(m=f),s.push({metaframe:c,pipe:m})}})})}return this._cachedInputLookupMap[u][f]}isValidJSONRpcMessage(u){if(u.jsonrpc!=="2.0")return!1;switch(u.method){case Pr.SetupIframeClientRequest:return!0;default:var s=u.iframeId;return!(s&&!(u.parentId===this._id&&(this._metaframes[s]||this._plugins[s])))}}setInput(u,f,s){this.setInputStateOnly(u,f,s),this.setMetaframeClientInputAndSentClientEvent(u,f,s),this.emit(jt.State,this._state),this.emit(jt.Inputs,this._state)}setMetaframeClientInputAndSentClientEvent(u,f,s){if(typeof u=="object"){if(f||s)throw"bad arguments, see API docs";const c=u;Object.keys(c).forEach(T=>{var m=T,E=c[m];if(typeof E!="object")throw"bad arguments, see API docs";var d=this._metaframes[m];d?d.setInputs(E):this.error("No iframe id=$metaframeId")})}else if(typeof u=="string"){const c=this._metaframes[u];if(c==null&&this.error(`No iframe id=${u}`),typeof f=="string")c.setInput(f,s);else if(typeof f=="object")c.setInputs(f);else throw"bad arguments, see API docs"}else throw"bad arguments, see API docs"}setInputs(u,f,s){this.setInput(u,f,s)}setOutputStateOnly(u,f,s){this._setStateOnly(!1,u,f,s)}setInputStateOnly(u,f,s){this._setStateOnly(!0,u,f,s)}_setStateOnly(u,f,s,c){if(typeof f=="object"){if(s||c)throw"If first argument is an object, subsequent args should be undefined";const T=f;Object.keys(T).forEach(m=>{var E=T[m];if(typeof E!="object")throw"Object values must be objects";const d=this._metaframes.hasOwnProperty(m);if(!d&&!this._plugins.hasOwnProperty(m))throw"No metaframe or plugin: ${metaframeId}";const x=d?u?this._state.metaframes.inputs:this._state.metaframes.outputs:u?this._state.plugins.inputs:this._state.plugins.outputs;x[m]=x[m]?x[m]:{},Object.keys(E).forEach(M=>{E[M]===void 0?delete x[m][M]:x[m][M]=E[M]})})}else if(typeof f=="string"){const T=f,m=this._metaframes.hasOwnProperty(T);if(!m&&!this._plugins.hasOwnProperty(T))throw`No metaframe or plugin: ${T}`;const E=m?u?this._state.metaframes.inputs:this._state.metaframes.outputs:u?this._state.plugins.inputs:this._state.plugins.outputs;if(typeof s=="string"){E[T]=E[T]?E[T]:{};const d=s;c===void 0?delete E[T][d]:E[T][d]=c}else if(typeof s=="object"){E[T]=E[T]?E[T]:{};const d=s;Object.keys(d).forEach(x=>{d[x]===void 0?delete E[T][x]:E[T][x]=d[x]})}else throw"Second argument must be a string or an object"}else throw"First argument must be a string or an object"}getMetaframeOrPlugin(u){var f=this._metaframes[u];return f||(f=this._plugins[u]),f}onMessage(u){if(typeof u.data=="object"){const m=u.data;if(!this.isValidJSONRpcMessage(m))return;var f=m.method;const E=m.iframeId;if(!E)return;const d=this.getMetaframeOrPlugin(E),x=this._plugins[E];switch(m._messageCount=++this._internalReceivedMessageCounter,this.debug&&this.log(`processing ${JSON.stringify(m,null,"  ").substr(0,500)}`),f){case Pr.SetupIframeClientRequest:d&&d.register();break;case Pr.SetupIframeServerResponseAck:if(d){const w=m.params;d.registered(w.version)}break;case Pr.OutputsUpdate:const M=m.params;if(this._metaframes[E]){var s=this._metaframes[E];this.setOutputStateOnly(E,M),s.setOutputs(M),this.emit(jt.State,this._state);var c=!1;const w=Object.keys(M),S={};w.forEach((_,O)=>{const R=this.getInputsFromOutput(E,_);R.length>0&&R.forEach(I=>{S[I.metaframe]||(S[I.metaframe]={}),S[I.metaframe][I.pipe]=M[_],this.setInputStateOnly(I.metaframe,I.pipe,M[_]),c=!0})}),Object.keys(S).forEach(_=>{this._metaframes[_].setInputs(S[_])}),c&&this.emit(jt.State,this._state),this.debug&&s.ack({jsonrpc:m,state:this._state})}else if(this._plugins[E]){const w=!M[Zo]&&!M[Ui];w&&this.setOutputStateOnly(E,M),this._plugins[E].setOutputs(M),w&&this.emit(jt.State,this._state),this.debug&&this._plugins[E].ack({jsonrpc:m,state:this._state})}else this.error("missing metaframe/plugin=$metaframeId");break;case Pr.InputsUpdate:var T=m.params;if(this.debug&&this.log(`inputs ${JSON.stringify(T)} from ${E}`),this._metaframes[E])this.setInputStateOnly(E,T),this._metaframes[E].setInputs(T),this.emit(jt.State,this._state),this.debug&&this._metaframes[E].ack({jsonrpc:m,state:this._state});else if(this._plugins[E]){const w=!T[Zo]&&!T[Ui];w&&this.setInputStateOnly(E,T),this._plugins[E].setInputs(T),w&&this.emit(jt.State,this._state),this.debug&&this._plugins[E].ack({jsonrpc:m,state:this._state})}else console.error(`InputsUpdate failed no metaframe or plugin id: "${E}"`),this.error(`InputsUpdate failed no metaframe or plugin id: "${E}"`);break;case Pr.PluginRequest:x&&d&&d.hasPermissionsState()&&(d.setInput(Zo,this._state),this.debug&&d.ack({jsonrpc:m,state:this._state}));break;case Pr.HashParamsUpdate:if(!x&&d){const w=m.params,S=new URL(d.url);S.hash=w.hash,d.url=S.href,this._definition.metaframes[w.metaframe].url=S.href,this.emit(jt.UrlHashUpdate,m.params),this._emitDefinitionEvent()}break;default:this.debug&&this.log(`Unknown RPC method: "${f}"`)}this.emit(jt.Message,m)}}updatePluginsWithDefinition(){this.getDefinition(),Object.values(this._plugins).forEach(u=>{u.hasPermissionsDefinition()&&kF(u)})}logInternal(u,f,s){s=s||this._consoleBackgroundColor;let c;typeof u=="string"?c=u:typeof u=="number"?c=u+"":c=JSON.stringify(u),c=this._id?`Metapage[${this._id}] ${c}`:c,C_(c,f,s)}}Ti.version=rx,Ti.DEFINITION=jt.Definition,Ti.DEFINITION_UPDATE_REQUEST=jt.DefinitionUpdateRequest,Ti.ERROR=jt.Error,Ti.INPUTS=jt.Inputs,Ti.MESSAGE=jt.Message,Ti.OUTPUTS=jt.Outputs,Ti.STATE=jt.State,Ti.URL_HASH_UPDATE=jt.UrlHashUpdate;const VF=(a,u)=>BF(void 0,void 0,void 0,function*(){try{const c=yield u.getDefinition();if(!c)throw`${u.url}`;if(u.isDisposed())return;if(u.hasPermissionsDefinition()){var f=a.addListenerReturnDisposer(jt.Definition,T=>{u.setInput(Ui,T.definition)});u._disposables.push(f);var s=a.getDefinition();if(s&&(u.setInput(Ui,s),c.outputs)){var f=u.onOutput(Ui,m=>{a.emit(jt.DefinitionUpdateRequest,m)});u._disposables.push(f)}}if(u.hasPermissionsState()&&c.outputs){var f=u.onOutput(Zo,m=>{a.setState(m)});u._disposables.push(f)}}catch(c){console.error(c),a.emit(jt.Error,`Failed to get plugin definition from "${u.getDefinitionUrl()}", error=${c}`)}}),kF=a=>{const u=a._metapage.getDefinition();a.setInput(Ui,u)};var jF=function(a,u,f,s){function c(T){return T instanceof f?T:new f(function(m){m(T)})}return new(f||(f=Promise))(function(T,m){function E(M){try{x(s.next(M))}catch(w){m(w)}}function d(M){try{x(s.throw(M))}catch(w){m(w)}}function x(M){M.done?T(M.value):c(M.value).then(E,d)}x((s=s.apply(a,u||[])).next())})},$o;(function(a){a.WaitingForPageLoad="WaitingForPageLoad",a.SentSetupIframeClientRequest="SentSetupIframeClientRequest",a.Ready="Ready"})($o||($o={}));var tr;(function(a){a.Connected="connected",a.Error="error",a.Input="input",a.Inputs="inputs",a.Message="message"})(tr||(tr={}));class Ei extends od.exports.EventEmitter{constructor(u){super();if(this._inputPipeValues={},this._outputPipeValues={},this._state=$o.WaitingForPageLoad,this._messageSendCount=0,this.debug=A_(),this.id=window.name,this.debug=A_(),this._isIframe=CF(),this.addListener=this.addListener.bind(this),this.dispose=this.dispose.bind(this),this.error=this.error.bind(this),this.getInput=this.getInput.bind(this),this.getInputs=this.getInputs.bind(this),this.getOutput=this.getOutput.bind(this),this.getOutputs=this.getOutputs.bind(this),this.log=this.log.bind(this),this.logInternal=this.logInternal.bind(this),this.onInput=this.onInput.bind(this),this.onInputs=this.onInputs.bind(this),this.onMessage=this.onMessage.bind(this),this.sendRpc=this.sendRpc.bind(this),this.setInput=this.setInput.bind(this),this.setInputs=this.setInputs.bind(this),this.setInternalInputsAndNotify=this.setInternalInputsAndNotify.bind(this),this.setOutput=this.setOutput.bind(this),this.setOutputs=this.setOutputs.bind(this),this.warn=this.warn.bind(this),this._resolveSetupIframeServerResponse=this._resolveSetupIframeServerResponse.bind(this),this.addListenerReturnDisposer=this.addListenerReturnDisposer.bind(this),this.connected=this.connected.bind(this),this.disableNotifyOnHashUrlChange=this.disableNotifyOnHashUrlChange.bind(this),this._onHashUrlChange=this._onHashUrlChange.bind(this),!this._isIframe){this.log("Not an iframe, metaframe code disabled");return}const f=this;O_().then(()=>{this.log("pageLoaded"),window.addEventListener("message",this.onMessage),f.sendRpc(Pr.SetupIframeClientRequest,{version:Ei.version}),f._state=$o.SentSetupIframeClientRequest}),(u==null?void 0:u.disableHashChangeEvent)||window.addEventListener("hashchange",this._onHashUrlChange)}_resolveSetupIframeServerResponse(u){if(this._state===$o.WaitingForPageLoad)throw"Got message but page has not finished loading, we should never get in this state";this._parentId?this.log("Got JsonRpcMethods.SetupIframeServerResponse but already resolved"):(this._parentVersion=u.version,this.color=ax(this.id),this._parentId=u.parentId,this.log(`metapage[${this._parentId}](v${this._parentVersion?this._parentVersion:"unknown"}) registered`),this._inputPipeValues=u.state&&u.state.inputs?u.state.inputs:this._inputPipeValues,this._state=$o.Ready,this.sendRpc(Pr.SetupIframeServerResponseAck,{version:Ei.version}),this._inputPipeValues&&Object.keys(this._inputPipeValues).length>0&&(this.emit(tr.Inputs,this._inputPipeValues),Object.keys(this._inputPipeValues).forEach(f=>this.emit(tr.Input,f,this._inputPipeValues[f]))),this.emit(tr.Inputs,this._inputPipeValues),u.plugin&&(this.plugin=new zF(this)),this.emit(tr.Connected))}connected(){return jF(this,void 0,void 0,function*(){if(this._state!==$o.Ready)return new Promise((u,f)=>{let s;s=this.addListenerReturnDisposer(tr.Connected,()=>{u(),s()})})})}addListenerReturnDisposer(u,f){return super.addListener(u,f),()=>{super.removeListener(u,f)}}log(u,f,s){!this.debug||this.logInternal(u,f||this.color)}warn(u){!this.debug||this.logInternal(u,"000",this.color)}error(u){this.logInternal(u,this.color,"f00")}logInternal(u,f,s){let c;typeof u=="string"?c=u:typeof u=="number"?c=u+"":c=JSON.stringify(u),f=f&&f+"",c=(this.id?`Metaframe[${this.id}] `:"")+`${c}`,C_(c,f,s)}dispose(){super.removeAllListeners(),window.removeEventListener("message",this.onMessage),this.disableNotifyOnHashUrlChange(),this._inputPipeValues=void 0,this._outputPipeValues=void 0}addListener(u,f){return super.addListener(u,f),u===tr.Inputs&&window.setTimeout(()=>{this._inputPipeValues&&f(this._inputPipeValues)},0),this}onInput(u,f){return this.addListenerReturnDisposer(tr.Input,(s,c)=>{u===s&&f(c)})}onInputs(u){return this.addListenerReturnDisposer(tr.Inputs,u)}setInput(u,f){var s={};s[u]=f,this.setInputs(s)}setInputs(u){this.sendRpc(Pr.InputsUpdate,u)}setInternalInputsAndNotify(u){!sd(this._inputPipeValues,u)||(Object.keys(u).forEach(f=>this.emit(tr.Input,f,u[f])),this.emit(tr.Inputs,u))}getInput(u){return console.assert(u),this._inputPipeValues[u]}getInputs(){return this._inputPipeValues}getOutput(u){return console.assert(u),this._outputPipeValues[u]}setOutput(u,f){console.assert(u),console.assert(f);var s={};s[u]=f,this.setOutputs(s)}setOutputs(u){!sd(this._outputPipeValues,u)||this.sendRpc(Pr.OutputsUpdate,u)}getOutputs(){return this._outputPipeValues}disableNotifyOnHashUrlChange(){window.removeEventListener("hashchange",this._onHashUrlChange)}_onHashUrlChange(u){const f={hash:window.location.hash,metaframe:this.id};this.sendRpc(Pr.HashParamsUpdate,f)}sendRpc(u,f){if(this._isIframe){const s={jsonrpc:"2.0",id:++this._messageSendCount,method:u,params:f,iframeId:this.id,parentId:this._parentId};window.parent.postMessage(s,"*")}else this.log("Cannot send JSON-RPC window message: there is no window.parent which means we are not an iframe")}onMessage(u){if(typeof u.data=="object"){let s=u.data;if(s.jsonrpc==="2.0"){var f=s.method;if(!(f==uo.SetupIframeServerResponse||s.parentId==this._parentId&&s.iframeId==this.id)){this.error(`window.message: received message but jsonrpc.parentId=${s.parentId} _parentId=${this._parentId} jsonrpc.iframeId=${s.iframeId} id=${this.id}`);return}switch(f){case uo.SetupIframeServerResponse:this._resolveSetupIframeServerResponse(s.params);break;case uo.InputsUpdate:if(this._state!==$o.Ready)throw"Got InputsUpdate but metaframe is not MetaframeLoadingState.Ready";this.setInternalInputsAndNotify(s.params.inputs);break;case uo.MessageAck:this.debug&&this.log(`ACK: ${JSON.stringify(s)}`);break;default:this.debug&&this.log(`window.message: unknown JSON-RPC method: ${JSON.stringify(s)}`);break}this.emit(tr.Message,s)}}}}Ei.version=AF,Ei.ERROR=tr.Error,Ei.CONNECTED=tr.Connected,Ei.INPUT=tr.Input,Ei.INPUTS=tr.Inputs,Ei.MESSAGE=tr.Message;class zF{constructor(u){this._metaframe=u,this.requestState=this.requestState.bind(this),this.onState=this.onState.bind(this),this.getState=this.getState.bind(this),this.setState=this.setState.bind(this),this.onDefinition=this.onDefinition.bind(this),this.getDefinition=this.getDefinition.bind(this),this.setDefinition=this.setDefinition.bind(this)}requestState(){var u={method:P_.State};this._metaframe.sendRpc(Pr.PluginRequest,u)}onState(u){const f=this._metaframe.onInput(Zo,u);return this.getState()&&u(this.getState()),f}getState(){return this._metaframe.getInput(Zo)}setState(u){this._metaframe.setOutput(Zo,u)}onDefinition(u){var f=this._metaframe.onInput(Ui,u);return this.getDefinition()&&u(this.getDefinition()),f}setDefinition(u){this._metaframe.setOutput(Ui,u)}getDefinition(){return this._metaframe.getInput(Ui)}}const GF={inputs:{}},hx=fr(GF),WF=()=>Jt(hx),HF=a=>{const[u,f]=mn({inputs:{}}),[s,c]=mn(void 0),[T,m]=mn(u.inputs);return Ut(()=>{const E=new Ei,d=x=>{m(x)};return E.onInputs(d),c(E),()=>{E.removeListener(Ei.INPUTS,d),E.dispose()}},[c,m]),Ut(()=>{T&&s&&f({metaframe:s,inputs:T,setOutputs:s.setOutputs})},[T,s]),oi.createElement(hx.Provider,{value:u},a.children)};function XF(a){if(a.sheet)return a.sheet;for(var u=0;u<document.styleSheets.length;u++)if(document.styleSheets[u].ownerNode===a)return document.styleSheets[u]}function YF(a){var u=document.createElement("style");return u.setAttribute("data-emotion",a.key),a.nonce!==void 0&&u.setAttribute("nonce",a.nonce),u.appendChild(document.createTextNode("")),u.setAttribute("data-s",""),u}var dx=function(){function a(f){var s=this;this._insertTag=function(c){var T;s.tags.length===0?T=s.prepend?s.container.firstChild:s.before:T=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,T),s.tags.push(c)},this.isSpeedy=f.speedy===void 0?!0:f.speedy,this.tags=[],this.ctr=0,this.nonce=f.nonce,this.key=f.key,this.container=f.container,this.prepend=f.prepend,this.before=null}var u=a.prototype;return u.hydrate=function(s){s.forEach(this._insertTag)},u.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(YF(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var T=XF(c);try{T.insertRule(s,T.cssRules.length)}catch(m){}}else c.appendChild(document.createTextNode(s));this.ctr++},u.flush=function(){this.tags.forEach(function(s){return s.parentNode.removeChild(s)}),this.tags=[],this.ctr=0},a}(),pr="-ms-",cd="-moz-",rn="-webkit-",fx="comm",M_="rule",I_="decl",KF="@import",QF="@keyframes",qF=Math.abs,ld=String.fromCharCode;function ZF(a,u){return(((u<<2^Lr(a,0))<<2^Lr(a,1))<<2^Lr(a,2))<<2^Lr(a,3)}function px(a){return a.trim()}function $F(a,u){return(a=u.exec(a))?a[0]:a}function _n(a,u,f){return a.replace(u,f)}function mx(a,u){return a.indexOf(u)}function Lr(a,u){return a.charCodeAt(u)|0}function Dl(a,u,f){return a.slice(u,f)}function Vi(a){return a.length}function D_(a){return a.length}function ud(a,u){return u.push(a),a}function JF(a,u){return a.map(u).join("")}var hd=1,Ys=1,_x=0,Gr=0,Wn=0,Ks="";function dd(a,u,f,s,c,T,m){return{value:a,root:u,parent:f,type:s,props:c,children:T,line:hd,column:Ys,length:m,return:""}}function wl(a,u,f){return dd(a,u.root,u.parent,f,u.props,u.children,0)}function eB(){return Wn}function tB(){return Wn=Gr>0?Lr(Ks,--Gr):0,Ys--,Wn===10&&(Ys=1,hd--),Wn}function si(){return Wn=Gr<_x?Lr(Ks,Gr++):0,Ys++,Wn===10&&(Ys=1,hd++),Wn}function ho(){return Lr(Ks,Gr)}function fd(){return Gr}function pd(a,u){return Dl(Ks,a,u)}function md(a){switch(a){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gx(a){return hd=Ys=1,_x=Vi(Ks=a),Gr=0,[]}function vx(a){return Ks="",a}function w_(a){return px(pd(Gr-1,L_(a===91?a+2:a===40?a+1:a)))}function nB(a){for(;(Wn=ho())&&Wn<33;)si();return md(a)>2||md(Wn)>3?"":" "}function rB(a,u){for(;--u&&si()&&!(Wn<48||Wn>102||Wn>57&&Wn<65||Wn>70&&Wn<97););return pd(a,fd()+(u<6&&ho()==32&&si()==32))}function L_(a){for(;si();)switch(Wn){case a:return Gr;case 34:case 39:return L_(a===34||a===39?a:Wn);case 40:a===41&&L_(a);break;case 92:si();break}return Gr}function iB(a,u){for(;si()&&a+Wn!==47+10;)if(a+Wn===42+42&&ho()===47)break;return"/*"+pd(u,Gr-1)+"*"+ld(a===47?a:si())}function bx(a){for(;!md(ho());)si();return pd(a,Gr)}function oB(a){return vx(_d("",null,null,null,[""],a=gx(a),0,[0],a))}function _d(a,u,f,s,c,T,m,E,d){for(var x=0,M=0,w=m,S=0,_=0,O=0,R=1,I=1,y=1,p=0,g="",C=c,P=T,F=s,U=g;I;)switch(O=p,p=si()){case 34:case 39:case 91:case 40:U+=w_(p);break;case 9:case 10:case 13:case 32:U+=nB(O);break;case 92:U+=rB(fd()-1,7);continue;case 47:switch(ho()){case 42:case 47:ud(aB(iB(si(),fd()),u,f),d);break;default:U+="/"}break;case 123*R:E[x++]=Vi(U)*y;case 125*R:case 59:case 0:switch(p){case 0:case 125:I=0;case 59+M:_>0&&Vi(U)-w&&ud(_>32?Tx(U+";",s,f,w-1):Tx(_n(U," ","")+";",s,f,w-2),d);break;case 59:U+=";";default:if(ud(F=yx(U,u,f,x,M,c,E,g,C=[],P=[],w),T),p===123)if(M===0)_d(U,u,F,F,C,T,w,E,P);else switch(S){case 100:case 109:case 115:_d(a,F,F,s&&ud(yx(a,F,F,0,0,c,E,g,c,C=[],w),P),c,P,w,E,s?C:P);break;default:_d(U,F,F,F,[""],P,w,E,P)}}x=M=_=0,R=y=1,g=U="",w=m;break;case 58:w=1+Vi(U),_=O;default:if(R<1){if(p==123)--R;else if(p==125&&R++==0&&tB()==125)continue}switch(U+=ld(p),p*R){case 38:y=M>0?1:(U+="\f",-1);break;case 44:E[x++]=(Vi(U)-1)*y,y=1;break;case 64:ho()===45&&(U+=w_(si())),S=ho(),M=Vi(g=U+=bx(fd())),p++;break;case 45:O===45&&Vi(U)==2&&(R=0)}}return T}function yx(a,u,f,s,c,T,m,E,d,x,M){for(var w=c-1,S=c===0?T:[""],_=D_(S),O=0,R=0,I=0;O<s;++O)for(var y=0,p=Dl(a,w+1,w=qF(R=m[O])),g=a;y<_;++y)(g=px(R>0?S[y]+" "+p:_n(p,/&\f/g,S[y])))&&(d[I++]=g);return dd(a,u,f,c===0?M_:E,d,x,M)}function aB(a,u,f){return dd(a,u,f,fx,ld(eB()),Dl(a,2,-2),0)}function Tx(a,u,f,s){return dd(a,u,f,I_,Dl(a,0,s),Dl(a,s+1,-1),s)}function Ex(a,u){switch(ZF(a,u)){case 5103:return rn+"print-"+a+a;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return rn+a+a;case 5349:case 4246:case 4810:case 6968:case 2756:return rn+a+cd+a+pr+a+a;case 6828:case 4268:return rn+a+pr+a+a;case 6165:return rn+a+pr+"flex-"+a+a;case 5187:return rn+a+_n(a,/(\w+).+(:[^]+)/,rn+"box-$1$2"+pr+"flex-$1$2")+a;case 5443:return rn+a+pr+"flex-item-"+_n(a,/flex-|-self/,"")+a;case 4675:return rn+a+pr+"flex-line-pack"+_n(a,/align-content|flex-|-self/,"")+a;case 5548:return rn+a+pr+_n(a,"shrink","negative")+a;case 5292:return rn+a+pr+_n(a,"basis","preferred-size")+a;case 6060:return rn+"box-"+_n(a,"-grow","")+rn+a+pr+_n(a,"grow","positive")+a;case 4554:return rn+_n(a,/([^-])(transform)/g,"$1"+rn+"$2")+a;case 6187:return _n(_n(_n(a,/(zoom-|grab)/,rn+"$1"),/(image-set)/,rn+"$1"),a,"")+a;case 5495:case 3959:return _n(a,/(image-set\([^]*)/,rn+"$1$`$1");case 4968:return _n(_n(a,/(.+:)(flex-)?(.*)/,rn+"box-pack:$3"+pr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+rn+a+a;case 4095:case 3583:case 4068:case 2532:return _n(a,/(.+)-inline(.+)/,rn+"$1$2")+a;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Vi(a)-1-u>6)switch(Lr(a,u+1)){case 109:if(Lr(a,u+4)!==45)break;case 102:return _n(a,/(.+:)(.+)-([^]+)/,"$1"+rn+"$2-$3$1"+cd+(Lr(a,u+3)==108?"$3":"$2-$3"))+a;case 115:return~mx(a,"stretch")?Ex(_n(a,"stretch","fill-available"),u)+a:a}break;case 4949:if(Lr(a,u+1)!==115)break;case 6444:switch(Lr(a,Vi(a)-3-(~mx(a,"!important")&&10))){case 107:return _n(a,":",":"+rn)+a;case 101:return _n(a,/(.+:)([^;!]+)(;|!.+)?/,"$1"+rn+(Lr(a,14)===45?"inline-":"")+"box$3$1"+rn+"$2$3$1"+pr+"$2box$3")+a}break;case 5936:switch(Lr(a,u+11)){case 114:return rn+a+pr+_n(a,/[svh]\w+-[tblr]{2}/,"tb")+a;case 108:return rn+a+pr+_n(a,/[svh]\w+-[tblr]{2}/,"tb-rl")+a;case 45:return rn+a+pr+_n(a,/[svh]\w+-[tblr]{2}/,"lr")+a}return rn+a+pr+a+a}return a}function Ll(a,u){for(var f="",s=D_(a),c=0;c<s;c++)f+=u(a[c],c,a,u)||"";return f}function sB(a,u,f,s){switch(a.type){case KF:case I_:return a.return=a.return||a.value;case fx:return"";case M_:a.value=a.props.join(",")}return Vi(f=Ll(a.children,s))?a.return=a.value+"{"+f+"}":""}function cB(a){var u=D_(a);return function(f,s,c,T){for(var m="",E=0;E<u;E++)m+=a[E](f,s,c,T)||"";return m}}function lB(a){return function(u){u.root||(u=u.return)&&a(u)}}function uB(a,u,f,s){if(!a.return)switch(a.type){case I_:a.return=Ex(a.value,a.length);break;case QF:return Ll([wl(_n(a.value,"@","@"+rn),a,"")],s);case M_:if(a.length)return JF(a.props,function(c){switch($F(c,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Ll([wl(_n(c,/:(read-\w+)/,":"+cd+"$1"),a,"")],s);case"::placeholder":return Ll([wl(_n(c,/:(plac\w+)/,":"+rn+"input-$1"),a,""),wl(_n(c,/:(plac\w+)/,":"+cd+"$1"),a,""),wl(_n(c,/:(plac\w+)/,pr+"input-$1"),a,"")],s)}return""})}}var Sx=function(u){var f=new WeakMap;return function(s){if(f.has(s))return f.get(s);var c=u(s);return f.set(s,c),c}};function xx(a){var u=Object.create(null);return function(f){return u[f]===void 0&&(u[f]=a(f)),u[f]}}var hB=function(u,f){var s=-1,c=44;do switch(md(c)){case 0:c===38&&ho()===12&&(f[s]=1),u[s]+=bx(Gr-1);break;case 2:u[s]+=w_(c);break;case 4:if(c===44){u[++s]=ho()===58?"&\f":"",f[s]=u[s].length;break}default:u[s]+=ld(c)}while(c=si());return u},dB=function(u,f){return vx(hB(gx(u),f))},Px=new WeakMap,fB=function(u){if(!(u.type!=="rule"||!u.parent||!u.length)){for(var f=u.value,s=u.parent,c=u.column===s.column&&u.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(u.props.length===1&&f.charCodeAt(0)!==58&&!Px.get(s))&&!c){Px.set(u,!0);for(var T=[],m=dB(f,T),E=s.props,d=0,x=0;d<m.length;d++)for(var M=0;M<E.length;M++,x++)u.props[x]=T[d]?m[d].replace(/&\f/g,E[M]):E[M]+" "+m[d]}}},pB=function(u){if(u.type==="decl"){var f=u.value;f.charCodeAt(0)===108&&f.charCodeAt(2)===98&&(u.return="",u.value="")}},mB=[uB],_B=function(u){var f=u.key;if(f==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(R){var I=R.getAttribute("data-emotion");I.indexOf(" ")!==-1&&(document.head.appendChild(R),R.setAttribute("data-s",""))})}var c=u.stylisPlugins||mB,T={},m,E=[];m=u.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+f+' "]'),function(R){for(var I=R.getAttribute("data-emotion").split(" "),y=1;y<I.length;y++)T[I[y]]=!0;E.push(R)});var d,x=[fB,pB];{var M,w=[sB,lB(function(R){M.insert(R)})],S=cB(x.concat(c,w)),_=function(I){return Ll(oB(I),S)};d=function(I,y,p,g){M=p,_(I?I+"{"+y.styles+"}":y.styles),g&&(O.inserted[y.name]=!0)}}var O={key:f,sheet:new dx({key:f,container:m,nonce:u.nonce,speedy:u.speedy,prepend:u.prepend}),nonce:u.nonce,inserted:T,registered:{},insert:d};return O.sheet.hydrate(E),O};function Jo(){return Jo=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Jo.apply(this,arguments)}var Ax={exports:{}},gn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nr=typeof Symbol=="function"&&Symbol.for,N_=nr?Symbol.for("react.element"):60103,F_=nr?Symbol.for("react.portal"):60106,gd=nr?Symbol.for("react.fragment"):60107,vd=nr?Symbol.for("react.strict_mode"):60108,bd=nr?Symbol.for("react.profiler"):60114,yd=nr?Symbol.for("react.provider"):60109,Td=nr?Symbol.for("react.context"):60110,B_=nr?Symbol.for("react.async_mode"):60111,Ed=nr?Symbol.for("react.concurrent_mode"):60111,Sd=nr?Symbol.for("react.forward_ref"):60112,xd=nr?Symbol.for("react.suspense"):60113,gB=nr?Symbol.for("react.suspense_list"):60120,Pd=nr?Symbol.for("react.memo"):60115,Ad=nr?Symbol.for("react.lazy"):60116,vB=nr?Symbol.for("react.block"):60121,bB=nr?Symbol.for("react.fundamental"):60117,yB=nr?Symbol.for("react.responder"):60118,TB=nr?Symbol.for("react.scope"):60119;function Wr(a){if(typeof a=="object"&&a!==null){var u=a.$$typeof;switch(u){case N_:switch(a=a.type,a){case B_:case Ed:case gd:case bd:case vd:case xd:return a;default:switch(a=a&&a.$$typeof,a){case Td:case Sd:case Ad:case Pd:case yd:return a;default:return u}}case F_:return u}}}function Cx(a){return Wr(a)===Ed}gn.AsyncMode=B_,gn.ConcurrentMode=Ed,gn.ContextConsumer=Td,gn.ContextProvider=yd,gn.Element=N_,gn.ForwardRef=Sd,gn.Fragment=gd,gn.Lazy=Ad,gn.Memo=Pd,gn.Portal=F_,gn.Profiler=bd,gn.StrictMode=vd,gn.Suspense=xd,gn.isAsyncMode=function(a){return Cx(a)||Wr(a)===B_},gn.isConcurrentMode=Cx,gn.isContextConsumer=function(a){return Wr(a)===Td},gn.isContextProvider=function(a){return Wr(a)===yd},gn.isElement=function(a){return typeof a=="object"&&a!==null&&a.$$typeof===N_},gn.isForwardRef=function(a){return Wr(a)===Sd},gn.isFragment=function(a){return Wr(a)===gd},gn.isLazy=function(a){return Wr(a)===Ad},gn.isMemo=function(a){return Wr(a)===Pd},gn.isPortal=function(a){return Wr(a)===F_},gn.isProfiler=function(a){return Wr(a)===bd},gn.isStrictMode=function(a){return Wr(a)===vd},gn.isSuspense=function(a){return Wr(a)===xd},gn.isValidElementType=function(a){return typeof a=="string"||typeof a=="function"||a===gd||a===Ed||a===bd||a===vd||a===xd||a===gB||typeof a=="object"&&a!==null&&(a.$$typeof===Ad||a.$$typeof===Pd||a.$$typeof===yd||a.$$typeof===Td||a.$$typeof===Sd||a.$$typeof===bB||a.$$typeof===yB||a.$$typeof===TB||a.$$typeof===vB)},gn.typeOf=Wr,Ax.exports=gn;var U_=Ax.exports,EB={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},SB={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},xB={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Rx={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},V_={};V_[U_.ForwardRef]=xB,V_[U_.Memo]=Rx;function Ox(a){return U_.isMemo(a)?Rx:V_[a.$$typeof]||EB}var PB=Object.defineProperty,AB=Object.getOwnPropertyNames,Mx=Object.getOwnPropertySymbols,CB=Object.getOwnPropertyDescriptor,RB=Object.getPrototypeOf,Ix=Object.prototype;function Dx(a,u,f){if(typeof u!="string"){if(Ix){var s=RB(u);s&&s!==Ix&&Dx(a,s,f)}var c=AB(u);Mx&&(c=c.concat(Mx(u)));for(var T=Ox(a),m=Ox(u),E=0;E<c.length;++E){var d=c[E];if(!SB[d]&&!(f&&f[d])&&!(m&&m[d])&&!(T&&T[d])){var x=CB(u,d);try{PB(a,d,x)}catch(M){}}}}return a}var OB=Dx,MB=function(a,u){return OB(a,u)},IB=MB,DB=!0;function k_(a,u,f){var s="";return f.split(" ").forEach(function(c){a[c]!==void 0?u.push(a[c]+";"):s+=c+" "}),s}var Cd=function(u,f,s){var c=u.key+"-"+f.name;if((s===!1||DB===!1)&&u.registered[c]===void 0&&(u.registered[c]=f.styles),u.inserted[f.name]===void 0){var T=f;do u.insert(f===T?"."+c:"",T,u.sheet,!0),T=T.next;while(T!==void 0)}};function wB(a){for(var u=0,f,s=0,c=a.length;c>=4;++s,c-=4)f=a.charCodeAt(s)&255|(a.charCodeAt(++s)&255)<<8|(a.charCodeAt(++s)&255)<<16|(a.charCodeAt(++s)&255)<<24,f=(f&65535)*1540483477+((f>>>16)*59797<<16),f^=f>>>24,u=(f&65535)*1540483477+((f>>>16)*59797<<16)^(u&65535)*1540483477+((u>>>16)*59797<<16);switch(c){case 3:u^=(a.charCodeAt(s+2)&255)<<16;case 2:u^=(a.charCodeAt(s+1)&255)<<8;case 1:u^=a.charCodeAt(s)&255,u=(u&65535)*1540483477+((u>>>16)*59797<<16)}return u^=u>>>13,u=(u&65535)*1540483477+((u>>>16)*59797<<16),((u^u>>>15)>>>0).toString(36)}var LB={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},NB=/[A-Z]|^ms/g,FB=/_EMO_([^_]+?)_([^]*?)_EMO_/g,wx=function(u){return u.charCodeAt(1)===45},Lx=function(u){return u!=null&&typeof u!="boolean"},j_=xx(function(a){return wx(a)?a:a.replace(NB,"-$&").toLowerCase()}),Nx=function(u,f){switch(u){case"animation":case"animationName":if(typeof f=="string")return f.replace(FB,function(s,c,T){return ki={name:c,styles:T,next:ki},c})}return LB[u]!==1&&!wx(u)&&typeof f=="number"&&f!==0?f+"px":f};function Nl(a,u,f){if(f==null)return"";if(f.__emotion_styles!==void 0)return f;switch(typeof f){case"boolean":return"";case"object":{if(f.anim===1)return ki={name:f.name,styles:f.styles,next:ki},f.name;if(f.styles!==void 0){var s=f.next;if(s!==void 0)for(;s!==void 0;)ki={name:s.name,styles:s.styles,next:ki},s=s.next;var c=f.styles+";";return c}return BB(a,u,f)}case"function":{if(a!==void 0){var T=ki,m=f(a);return ki=T,Nl(a,u,m)}break}}if(u==null)return f;var E=u[f];return E!==void 0?E:f}function BB(a,u,f){var s="";if(Array.isArray(f))for(var c=0;c<f.length;c++)s+=Nl(a,u,f[c])+";";else for(var T in f){var m=f[T];if(typeof m!="object")u!=null&&u[m]!==void 0?s+=T+"{"+u[m]+"}":Lx(m)&&(s+=j_(T)+":"+Nx(T,m)+";");else if(Array.isArray(m)&&typeof m[0]=="string"&&(u==null||u[m[0]]===void 0))for(var E=0;E<m.length;E++)Lx(m[E])&&(s+=j_(T)+":"+Nx(T,m[E])+";");else{var d=Nl(a,u,m);switch(T){case"animation":case"animationName":{s+=j_(T)+":"+d+";";break}default:s+=T+"{"+d+"}"}}}return s}var Fx=/label:\s*([^\s;\n{]+)\s*(;|$)/g,ki,Fl=function(u,f,s){if(u.length===1&&typeof u[0]=="object"&&u[0]!==null&&u[0].styles!==void 0)return u[0];var c=!0,T="";ki=void 0;var m=u[0];m==null||m.raw===void 0?(c=!1,T+=Nl(s,f,m)):T+=m[0];for(var E=1;E<u.length;E++)T+=Nl(s,f,u[E]),c&&(T+=m[E]);Fx.lastIndex=0;for(var d="",x;(x=Fx.exec(T))!==null;)d+="-"+x[1];var M=wB(T)+d;return{name:M,styles:T,next:ki}},z_=Object.prototype.hasOwnProperty,G_=fr(typeof HTMLElement!="undefined"?_B({key:"css"}):null),UB=G_.Provider,VB=function(){return Jt(G_)},Bl=function(u){return bi(function(f,s){var c=Jt(G_);return u(f,c,s)})},ji=fr({}),kB=function(){return Jt(ji)},jB=function(u,f){if(typeof f=="function"){var s=f(u);return s}return Jo({},u,f)},zB=Sx(function(a){return Sx(function(u){return jB(a,u)})}),Bx=function(u){var f=Jt(ji);return u.theme!==f&&(f=zB(f)(u.theme)),Ye(ji.Provider,{value:f},u.children)};function GB(a){var u=a.displayName||a.name||"Component",f=function(T,m){var E=Jt(ji);return Ye(a,Jo({theme:E,ref:m},T))},s=bi(f);return s.displayName="WithTheme("+u+")",IB(s,a)}var W_="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",WB=function(u,f){var s={};for(var c in f)z_.call(f,c)&&(s[c]=f[c]);return s[W_]=u,s},HB=Bl(function(a,u,f){var s=a.css;typeof s=="string"&&u.registered[s]!==void 0&&(s=u.registered[s]);var c=a[W_],T=[s],m="";typeof a.className=="string"?m=k_(u.registered,T,a.className):a.className!=null&&(m=a.className+" ");var E=Fl(T,void 0,Jt(ji));Cd(u,E,typeof c=="string"),m+=u.key+"-"+E.name;var d={};for(var x in a)z_.call(a,x)&&x!=="css"&&x!==W_&&(d[x]=a[x]);d.ref=f,d.className=m;var M=Ye(c,d);return M}),Ux=function(u,f){var s=arguments;if(f==null||!z_.call(f,"css"))return Ye.apply(void 0,s);var c=s.length,T=new Array(c);T[0]=HB,T[1]=WB(u,f);for(var m=2;m<c;m++)T[m]=s[m];return Ye.apply(null,T)},Rd=Bl(function(a,u){var f=a.styles,s=Fl([f],void 0,Jt(ji)),c=Nt();return Ko(function(){var T=u.key+"-global",m=new dx({key:T,nonce:u.sheet.nonce,container:u.sheet.container,speedy:u.sheet.isSpeedy}),E=!1,d=document.querySelector('style[data-emotion="'+T+" "+s.name+'"]');return u.sheet.tags.length&&(m.before=u.sheet.tags[0]),d!==null&&(E=!0,d.setAttribute("data-emotion",T),m.hydrate([d])),c.current=[m,E],function(){m.flush()}},[u]),Ko(function(){var T=c.current,m=T[0],E=T[1];if(E){T[1]=!1;return}if(s.next!==void 0&&Cd(u,s.next,!0),m.tags.length){var d=m.tags[m.tags.length-1].nextElementSibling;m.before=d,m.flush()}u.insert("",s,m,!1)},[u,s.name]),null});function Vx(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return Fl(u)}var H_=function(){var u=Vx.apply(void 0,arguments),f="animation-"+u.name;return{name:f,styles:"@keyframes "+f+"{"+u.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},XB=function a(u){for(var f=u.length,s=0,c="";s<f;s++){var T=u[s];if(T!=null){var m=void 0;switch(typeof T){case"boolean":break;case"object":{if(Array.isArray(T))m=a(T);else{m="";for(var E in T)T[E]&&E&&(m&&(m+=" "),m+=E)}break}default:m=T}m&&(c&&(c+=" "),c+=m)}}return c};function YB(a,u,f){var s=[],c=k_(a,s,f);return s.length<2?f:c+u(s)}var KB=Bl(function(a,u){var f=!1,s=function(){for(var d=arguments.length,x=new Array(d),M=0;M<d;M++)x[M]=arguments[M];var w=Fl(x,u.registered);return Cd(u,w,!1),u.key+"-"+w.name},c=function(){for(var d=arguments.length,x=new Array(d),M=0;M<d;M++)x[M]=arguments[M];return YB(u.registered,s,XB(x))},T={css:s,cx:c,theme:Jt(ji)},m=a.children(T);return f=!0,m}),QB=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",ClassNames:KB,Global:Rd,createElement:Ux,css:Vx,jsx:Ux,keyframes:H_,CacheProvider:UB,ThemeContext:ji,ThemeProvider:Bx,__unsafe_useEmotionCache:VB,useTheme:kB,withEmotionCache:Bl,withTheme:GB}),qB=()=>Ye(Rd,{styles:`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;      
        -moz-osx-font-smoothing: grayscale; 
        touch-action: manipulation; 
      }

      body {
        position: relative;
        min-height: 100%;
        font-feature-settings: 'kern';
      }

      *,
      *::before,
      *::after {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
      }

      main {
        display: block;
      }

      hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      pre,
      code,
      kbd,
      samp {
        font-family: SFMono-Regular,  Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      b,
      strong {
        font-weight: bold;
      }

      small {
        font-size: 80%;
      }

      sub,
      sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      sub {
        bottom: -0.25em;
      }

      sup {
        top: -0.5em;
      }

      img {
        border-style: none;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      button,
      input {
        overflow: visible;
      }

      button,
      select {
        text-transform: none;
      }

      button::-moz-focus-inner,
      [type="button"]::-moz-focus-inner,
      [type="reset"]::-moz-focus-inner,
      [type="submit"]::-moz-focus-inner {
        border-style: none;
        padding: 0;
      }

      fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      progress {
        vertical-align: baseline;
      }

      textarea {
        overflow: auto;
      }

      [type="checkbox"],
      [type="radio"] {
        box-sizing: border-box;
        padding: 0;
      }

      [type="number"]::-webkit-inner-spin-button,
      [type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      [type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      [type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      details {
        display: block;
      }

      summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      body,
      blockquote,
      dl,
      dd,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      hr,
      figure,
      p,
      pre {
        margin: 0;
      }

      button {
        background: transparent;
        padding: 0;
      }

      fieldset {
        margin: 0;
        padding: 0;
      }

      ol,
      ul {
        margin: 0;
        padding: 0;
      }

      textarea {
        resize: vertical;
      }

      button,
      [role="button"] {
        cursor: pointer;
      }

      button::-moz-focus-inner {
        border: 0 !important;
      }

      table {
        border-collapse: collapse;
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-size: inherit;
        font-weight: inherit;
      }

      button,
      input,
      optgroup,
      select,
      textarea {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      img,
      svg,
      video,
      canvas,
      audio,
      iframe,
      embed,
      object {
        display: block;
        vertical-align: middle;
      }

      img,
      video {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible] :focus:not([data-focus-visible-added]) {
        outline: none;
        box-shadow: none;
      }

      select::-ms-expand {
        display: none;
      }
    `}),ZB=qB;function $B(a){var u=a==null?0:a.length;return u?a[u-1]:void 0}function Na(a){return typeof a=="number"}function X_(a){return Array.isArray(a)}function kx(a){return typeof a=="function"}function Si(a){var u=typeof a;return a!=null&&(u==="object"||u==="function")&&!X_(a)}function JB(a){return Si(a)&&Object.keys(a).length===0}function Y_(a){return Object.prototype.toString.call(a)==="[object String]"}function jx(a){return/^var\(--.+\)$/.test(a)}var zi=!1,K_={exports:{}};(function(a,u){var f=200,s="__lodash_hash_undefined__",c=800,T=16,m=9007199254740991,E="[object Arguments]",d="[object Array]",x="[object AsyncFunction]",M="[object Boolean]",w="[object Date]",S="[object Error]",_="[object Function]",O="[object GeneratorFunction]",R="[object Map]",I="[object Number]",y="[object Null]",p="[object Object]",g="[object Proxy]",C="[object RegExp]",P="[object Set]",F="[object String]",U="[object Undefined]",B="[object WeakMap]",L="[object ArrayBuffer]",z="[object DataView]",X="[object Float32Array]",G="[object Float64Array]",ee="[object Int8Array]",$="[object Int16Array]",fe="[object Int32Array]",me="[object Uint8Array]",ve="[object Uint8ClampedArray]",be="[object Uint16Array]",ie="[object Uint32Array]",se=/[\\^$.*+?()[\]{}|]/g,V=/^\[object .+?Constructor\]$/,K=/^(?:0|[1-9]\d*)$/,Z={};Z[X]=Z[G]=Z[ee]=Z[$]=Z[fe]=Z[me]=Z[ve]=Z[be]=Z[ie]=!0,Z[E]=Z[d]=Z[L]=Z[M]=Z[z]=Z[w]=Z[S]=Z[_]=Z[R]=Z[I]=Z[p]=Z[C]=Z[P]=Z[F]=Z[B]=!1;var le=typeof Fe=="object"&&Fe&&Fe.Object===Object&&Fe,re=typeof self=="object"&&self&&self.Object===Object&&self,Q=le||re||Function("return this")(),W=u&&!u.nodeType&&u,Y=W&&!0&&a&&!a.nodeType&&a,q=Y&&Y.exports===W,ae=q&&le.process,pe=function(){try{var Ie=Y&&Y.require&&Y.require("util").types;return Ie||ae&&ae.binding&&ae.binding("util")}catch(je){}}(),De=pe&&pe.isTypedArray;function de(Ie,je,Ke){switch(Ke.length){case 0:return Ie.call(je);case 1:return Ie.call(je,Ke[0]);case 2:return Ie.call(je,Ke[0],Ke[1]);case 3:return Ie.call(je,Ke[0],Ke[1],Ke[2])}return Ie.apply(je,Ke)}function ge(Ie,je){for(var Ke=-1,yt=Array(Ie);++Ke<Ie;)yt[Ke]=je(Ke);return yt}function ne(Ie){return function(je){return Ie(je)}}function Te(Ie,je){return Ie==null?void 0:Ie[je]}function we(Ie,je){return function(Ke){return Ie(je(Ke))}}var Se=Array.prototype,Ge=Function.prototype,$e=Object.prototype,nt=Q["__core-js_shared__"],et=Ge.toString,Ze=$e.hasOwnProperty,ht=function(){var Ie=/[^.]+$/.exec(nt&&nt.keys&&nt.keys.IE_PROTO||"");return Ie?"Symbol(src)_1."+Ie:""}(),gt=$e.toString,Rt=et.call(Object),zt=RegExp("^"+et.call(Ze).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),un=q?Q.Buffer:void 0,Br=Q.Symbol,lr=Q.Uint8Array,Ur=un?un.allocUnsafe:void 0,Qr=we(Object.getPrototypeOf,Object),qr=Object.create,Xi=$e.propertyIsEnumerable,Co=Se.splice,gr=Br?Br.toStringTag:void 0,Yi=function(){try{var Ie=ba(Object,"defineProperty");return Ie({},"",{}),Ie}catch(je){}}(),Ja=un?un.isBuffer:void 0,Ne=Math.max,pa=Date.now,ma=ba(Q,"Map"),Oi=ba(Object,"create"),Xe=function(){function Ie(){}return function(je){if(!qi(je))return{};if(qr)return qr(je);Ie.prototype=je;var Ke=new Ie;return Ie.prototype=void 0,Ke}}();function ur(Ie){var je=-1,Ke=Ie==null?0:Ie.length;for(this.clear();++je<Ke;){var yt=Ie[je];this.set(yt[0],yt[1])}}function es(){this.__data__=Oi?Oi(null):{},this.size=0}function Qe(Ie){var je=this.has(Ie)&&delete this.__data__[Ie];return this.size-=je?1:0,je}function rr(Ie){var je=this.__data__;if(Oi){var Ke=je[Ie];return Ke===s?void 0:Ke}return Ze.call(je,Ie)?je[Ie]:void 0}function li(Ie){var je=this.__data__;return Oi?je[Ie]!==void 0:Ze.call(je,Ie)}function ts(Ie,je){var Ke=this.__data__;return this.size+=this.has(Ie)?0:1,Ke[Ie]=Oi&&je===void 0?s:je,this}ur.prototype.clear=es,ur.prototype.delete=Qe,ur.prototype.get=rr,ur.prototype.has=li,ur.prototype.set=ts;function ct(Ie){var je=-1,Ke=Ie==null?0:Ie.length;for(this.clear();++je<Ke;){var yt=Ie[je];this.set(yt[0],yt[1])}}function Vr(){this.__data__=[],this.size=0}function cp(Ie){var je=this.__data__,Ke=_a(je,Ie);if(Ke<0)return!1;var yt=je.length-1;return Ke==yt?je.pop():Co.call(je,Ke,1),--this.size,!0}function xt(Ie){var je=this.__data__,Ke=_a(je,Ie);return Ke<0?void 0:je[Ke][1]}function Bu(Ie){return _a(this.__data__,Ie)>-1}function Uu(Ie,je){var Ke=this.__data__,yt=_a(Ke,Ie);return yt<0?(++this.size,Ke.push([Ie,je])):Ke[yt][1]=je,this}ct.prototype.clear=Vr,ct.prototype.delete=cp,ct.prototype.get=xt,ct.prototype.has=Bu,ct.prototype.set=Uu;function Ki(Ie){var je=-1,Ke=Ie==null?0:Ie.length;for(this.clear();++je<Ke;){var yt=Ie[je];this.set(yt[0],yt[1])}}function Ro(){this.size=0,this.__data__={hash:new ur,map:new(ma||ct),string:new ur}}function lp(Ie){var je=Oo(this,Ie).delete(Ie);return this.size-=je?1:0,je}function up(Ie){return Oo(this,Ie).get(Ie)}function ui(Ie){return Oo(this,Ie).has(Ie)}function hp(Ie,je){var Ke=Oo(this,Ie),yt=Ke.size;return Ke.set(Ie,je),this.size+=Ke.size==yt?0:1,this}Ki.prototype.clear=Ro,Ki.prototype.delete=lp,Ki.prototype.get=up,Ki.prototype.has=ui,Ki.prototype.set=hp;function Lt(Ie){var je=this.__data__=new ct(Ie);this.size=je.size}function Tt(){this.__data__=new ct,this.size=0}function vr(Ie){var je=this.__data__,Ke=je.delete(Ie);return this.size=je.size,Ke}function Vu(Ie){return this.__data__.get(Ie)}function dp(Ie){return this.__data__.has(Ie)}function fp(Ie,je){var Ke=this.__data__;if(Ke instanceof ct){var yt=Ke.__data__;if(!ma||yt.length<f-1)return yt.push([Ie,je]),this.size=++Ke.size,this;Ke=this.__data__=new Ki(yt)}return Ke.set(Ie,je),this.size=Ke.size,this}Lt.prototype.clear=Tt,Lt.prototype.delete=vr,Lt.prototype.get=Vu,Lt.prototype.has=dp,Lt.prototype.set=fp;function Ve(Ie,je){var Ke=Zr(Ie),yt=!Ke&&Gt(Ie),Yt=!Ke&&!yt&&Mi(Ie),an=!Ke&&!yt&&!Yt&&Hc(Ie),yn=Ke||yt||Yt||an,Ft=yn?ge(Ie.length,String):[],hn=Ft.length;for(var In in Ie)(je||Ze.call(Ie,In))&&!(yn&&(In=="length"||Yt&&(In=="offset"||In=="parent")||an&&(In=="buffer"||In=="byteLength"||In=="byteOffset")||is(In,hn)))&&Ft.push(In);return Ft}function Mt(Ie,je,Ke){(Ke!==void 0&&!Mo(Ie[je],Ke)||Ke===void 0&&!(je in Ie))&&ns(Ie,je,Ke)}function Xt(Ie,je,Ke){var yt=Ie[je];(!(Ze.call(Ie,je)&&Mo(yt,Ke))||Ke===void 0&&!(je in Ie))&&ns(Ie,je,Ke)}function _a(Ie,je){for(var Ke=Ie.length;Ke--;)if(Mo(Ie[Ke][0],je))return Ke;return-1}function ns(Ie,je,Ke){je=="__proto__"&&Yi?Yi(Ie,je,{configurable:!0,enumerable:!0,value:Ke,writable:!0}):Ie[je]=Ke}var ku=Fc();function hr(Ie){return Ie==null?Ie===void 0?U:y:gr&&gr in Object(Ie)?Bc(Ie):ya(Ie)}function ga(Ie){return Do(Ie)&&hr(Ie)==E}function Fn(Ie){if(!qi(Ie)||mp(Ie))return!1;var je=Io(Ie)?zt:V;return je.test(zc(Ie))}function va(Ie){return Do(Ie)&&Wc(Ie.length)&&!!Z[hr(Ie)]}function pp(Ie){if(!qi(Ie))return kc(Ie);var je=os(Ie),Ke=[];for(var yt in Ie)yt=="constructor"&&(je||!Ze.call(Ie,yt))||Ke.push(yt);return Ke}function Mn(Ie,je,Ke,yt,Yt){Ie!==je&&ku(je,function(an,yn){if(Yt||(Yt=new Lt),qi(an))ju(Ie,je,yn,Ke,Mn,yt,Yt);else{var Ft=yt?yt(Ta(Ie,yn),an,yn+"",Ie,je,Yt):void 0;Ft===void 0&&(Ft=an),Mt(Ie,yn,Ft)}},as)}function ju(Ie,je,Ke,yt,Yt,an,yn){var Ft=Ta(Ie,Ke),hn=Ta(je,Ke),In=yn.get(hn);if(In){Mt(Ie,Ke,In);return}var We=an?an(Ft,hn,Ke+"",Ie,je,yn):void 0,Ea=We===void 0;if(Ea){var ss=Zr(hn),bt=!ss&&Mi(hn),Hu=!ss&&!bt&&Hc(hn);We=hn,ss||bt||Hu?Zr(Ft)?We=Ft:Gc(Ft)?We=Lc(Ft):bt?(Ea=!1,We=Dc(hn,!0)):Hu?(Ea=!1,We=zu(hn,!0)):We=[]:kr(hn)||Gt(hn)?(We=Ft,Gt(Ft)?We=Wu(Ft):(!qi(Ft)||Io(Ft))&&(We=Uc(hn))):Ea=!1}Ea&&(yn.set(hn,We),Yt(We,hn,yt,an,yn),yn.delete(hn)),Mt(Ie,Ke,We)}function Ic(Ie,je){return xn(jc(Ie,je,Ii),Ie+"")}var Qi=Yi?function(Ie,je){return Yi(Ie,"toString",{configurable:!0,enumerable:!1,value:ir(je),writable:!0})}:Ii;function Dc(Ie,je){if(je)return Ie.slice();var Ke=Ie.length,yt=Ur?Ur(Ke):new Ie.constructor(Ke);return Ie.copy(yt),yt}function wc(Ie){var je=new Ie.constructor(Ie.byteLength);return new lr(je).set(new lr(Ie)),je}function zu(Ie,je){var Ke=je?wc(Ie.buffer):Ie.buffer;return new Ie.constructor(Ke,Ie.byteOffset,Ie.length)}function Lc(Ie,je){var Ke=-1,yt=Ie.length;for(je||(je=Array(yt));++Ke<yt;)je[Ke]=Ie[Ke];return je}function rs(Ie,je,Ke,yt){var Yt=!Ke;Ke||(Ke={});for(var an=-1,yn=je.length;++an<yn;){var Ft=je[an],hn=yt?yt(Ke[Ft],Ie[Ft],Ft,Ke,Ie):void 0;hn===void 0&&(hn=Ie[Ft]),Yt?ns(Ke,Ft,hn):Xt(Ke,Ft,hn)}return Ke}function Nc(Ie){return Ic(function(je,Ke){var yt=-1,Yt=Ke.length,an=Yt>1?Ke[Yt-1]:void 0,yn=Yt>2?Ke[2]:void 0;for(an=Ie.length>3&&typeof an=="function"?(Yt--,an):void 0,yn&&Vc(Ke[0],Ke[1],yn)&&(an=Yt<3?void 0:an,Yt=1),je=Object(je);++yt<Yt;){var Ft=Ke[yt];Ft&&Ie(je,Ft,yt,an)}return je})}function Fc(Ie){return function(je,Ke,yt){for(var Yt=-1,an=Object(je),yn=yt(je),Ft=yn.length;Ft--;){var hn=yn[Ie?Ft:++Yt];if(Ke(an[hn],hn,an)===!1)break}return je}}function Oo(Ie,je){var Ke=Ie.__data__;return Kt(je)?Ke[typeof je=="string"?"string":"hash"]:Ke.map}function ba(Ie,je){var Ke=Te(Ie,je);return Fn(Ke)?Ke:void 0}function Bc(Ie){var je=Ze.call(Ie,gr),Ke=Ie[gr];try{Ie[gr]=void 0;var yt=!0}catch(an){}var Yt=gt.call(Ie);return yt&&(je?Ie[gr]=Ke:delete Ie[gr]),Yt}function Uc(Ie){return typeof Ie.constructor=="function"&&!os(Ie)?Xe(Qr(Ie)):{}}function is(Ie,je){var Ke=typeof Ie;return je=je??m,!!je&&(Ke=="number"||Ke!="symbol"&&K.test(Ie))&&Ie>-1&&Ie%1==0&&Ie<je}function Vc(Ie,je,Ke){if(!qi(Ke))return!1;var yt=typeof je;return(yt=="number"?dr(Ke)&&is(je,Ke.length):yt=="string"&&je in Ke)?Mo(Ke[je],Ie):!1}function Kt(Ie){var je=typeof Ie;return je=="string"||je=="number"||je=="symbol"||je=="boolean"?Ie!=="__proto__":Ie===null}function mp(Ie){return!!ht&&ht in Ie}function os(Ie){var je=Ie&&Ie.constructor,Ke=typeof je=="function"&&je.prototype||$e;return Ie===Ke}function kc(Ie){var je=[];if(Ie!=null)for(var Ke in Object(Ie))je.push(Ke);return je}function ya(Ie){return gt.call(Ie)}function jc(Ie,je,Ke){return je=Ne(je===void 0?Ie.length-1:je,0),function(){for(var yt=arguments,Yt=-1,an=Ne(yt.length-je,0),yn=Array(an);++Yt<an;)yn[Yt]=yt[je+Yt];Yt=-1;for(var Ft=Array(je+1);++Yt<je;)Ft[Yt]=yt[Yt];return Ft[je]=Ke(yn),de(Ie,this,Ft)}}function Ta(Ie,je){if(!(je==="constructor"&&typeof Ie[je]=="function")&&je!="__proto__")return Ie[je]}var xn=Gu(Qi);function Gu(Ie){var je=0,Ke=0;return function(){var yt=pa(),Yt=T-(yt-Ke);if(Ke=yt,Yt>0){if(++je>=c)return arguments[0]}else je=0;return Ie.apply(void 0,arguments)}}function zc(Ie){if(Ie!=null){try{return et.call(Ie)}catch(je){}try{return Ie+""}catch(je){}}return""}function Mo(Ie,je){return Ie===je||Ie!==Ie&&je!==je}var Gt=ga(function(){return arguments}())?ga:function(Ie){return Do(Ie)&&Ze.call(Ie,"callee")&&!Xi.call(Ie,"callee")},Zr=Array.isArray;function dr(Ie){return Ie!=null&&Wc(Ie.length)&&!Io(Ie)}function Gc(Ie){return Do(Ie)&&dr(Ie)}var Mi=Ja||Di;function Io(Ie){if(!qi(Ie))return!1;var je=hr(Ie);return je==_||je==O||je==x||je==g}function Wc(Ie){return typeof Ie=="number"&&Ie>-1&&Ie%1==0&&Ie<=m}function qi(Ie){var je=typeof Ie;return Ie!=null&&(je=="object"||je=="function")}function Do(Ie){return Ie!=null&&typeof Ie=="object"}function kr(Ie){if(!Do(Ie)||hr(Ie)!=p)return!1;var je=Qr(Ie);if(je===null)return!0;var Ke=Ze.call(je,"constructor")&&je.constructor;return typeof Ke=="function"&&Ke instanceof Ke&&et.call(Ke)==Rt}var Hc=De?ne(De):va;function Wu(Ie){return rs(Ie,as(Ie))}function as(Ie){return dr(Ie)?Ve(Ie,!0):pp(Ie)}var Bn=Nc(function(Ie,je,Ke,yt){Mn(Ie,je,Ke,yt)});function ir(Ie){return function(){return Ie}}function Ii(Ie){return Ie}function Di(){return!1}a.exports=Bn})(K_,K_.exports);var fo=K_.exports;function zx(a,u){var f={};return Object.keys(a).forEach(s=>{u.includes(s)||(f[s]=a[s])}),f}function e2(a,u){var f={};return u.forEach(s=>{s in a&&(f[s]=a[s])}),f}function t2(a,u){var f={},s={};return Object.keys(a).forEach(c=>{u.includes(c)?f[c]=a[c]:s[c]=a[c]}),[f,s]}function n2(a,u,f,s){var c=typeof u=="string"?u.split("."):[u];for(s=0;s<c.length&&a;s+=1)a=a[c[s]];return a===void 0?f:a}var r2=a=>{var u=new WeakMap,f=(s,c,T,m)=>{if(typeof s=="undefined")return a(s,c,T);u.has(s)||u.set(s,new Map);var E=u.get(s);if(E.has(c))return E.get(c);var d=a(s,c,T,m);return E.set(c,d),d};return f},Od=r2(n2);function Gx(a,u){var f={};return Object.keys(a).forEach(s=>{var c=a[s],T=u(c,s,a);T&&(f[s]=c)}),f}var Md=a=>Gx(a,u=>u!=null),Id=a=>Object.keys(a),i2=a=>a.reduce((u,f)=>{var[s,c]=f;return u[s]=c,u},{});function o2(a){var u=parseFloat(a.toString()),f=a.toString().replace(String(u),"");return{unitless:!f,value:u,unit:f}}function Q_(a){if(a==null)return a;var{unitless:u}=o2(a);return u||Na(a)?a+"px":a}var Wx=(a,u)=>parseInt(a[1],10)>parseInt(u[1],10)?1:-1,q_=a=>i2(Object.entries(a).sort(Wx));function Hx(a){var u=q_(a);return Object.assign(Object.values(u),u)}function a2(a){var u=Object.keys(q_(a));return new Set(u)}function s2(a){var u;if(!a)return a;a=(u=Q_(a))!=null?u:a;var f=a.endsWith("px")?-1:-.0635;return Na(a)?""+(a+f):a.replace(/([0-9]+\.?[0-9]*)/,s=>""+(parseFloat(s)+f))}function Dd(a,u){var f=[];return a&&f.push("@media screen and (min-width: "+Q_(a)+")"),f.length>0&&u&&f.push("and"),u&&f.push("@media screen and (max-width: "+Q_(u)+")"),f.join(" ")}function c2(a){var u;if(!a)return null;a.base=(u=a.base)!=null?u:"0px";var f=Hx(a),s=Object.entries(a).sort(Wx).map((m,E,d)=>{var x,[M,w]=m,[,S]=(x=d[E+1])!=null?x:[];return S=parseFloat(S)>0?s2(S):void 0,{breakpoint:M,minW:w,maxW:S,maxWQuery:Dd(null,S),minWQuery:Dd(w),minMaxQuery:Dd(w,S)}}),c=a2(a),T=Array.from(c.values());return{keys:c,normalized:f,isResponsive(m){var E=Object.keys(m);return E.length>0&&E.every(d=>c.has(d))},asObject:q_(a),asArray:Hx(a),details:s,media:[null,...f.map(m=>Dd(m)).slice(1)],toArrayValue(m){if(!Si(m))throw new Error("toArrayValue: value must be an object");for(var E=T.map(d=>{var x;return(x=m[d])!=null?x:null});$B(E)===null;)E.pop();return E},toObjectValue(m){if(!Array.isArray(m))throw new Error("toObjectValue: value must be an array");return m.reduce((E,d,x)=>{var M=T[x];return M!=null&&d!=null&&(E[M]=d),E},{})}}}function Xx(a){return a!=null&&typeof a=="object"&&"nodeType"in a&&a.nodeType===Node.ELEMENT_NODE}function Z_(a){var u;if(!Xx(a))return!1;var f=(u=a.ownerDocument.defaultView)!=null?u:window;return a instanceof f.HTMLElement}function Yx(a){var u;return Xx(a)&&(u=a.ownerDocument)!=null?u:document}function l2(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var Qs=l2(),mr=a=>a?"":void 0,$_=a=>a?!0:void 0,Hn=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return f.filter(Boolean).join(" ")},u2=a=>a.hasAttribute("tabindex");function h2(a){return Boolean(a.getAttribute("disabled"))===!0||Boolean(a.getAttribute("aria-disabled"))===!0}function d2(a){return Z_(a)&&a.tagName.toLowerCase()==="input"&&"select"in a}function f2(a){var u=Z_(a)?Yx(a):document;return u.activeElement===a}function Kx(a){return a.parentElement&&Kx(a.parentElement)?!0:a.hidden}function p2(a){var u=a.getAttribute("contenteditable");return u!=="false"&&u!=null}function m2(a){if(!Z_(a)||Kx(a)||h2(a))return!1;var{localName:u}=a,f=["input","select","textarea","button"];if(f.indexOf(u)>=0)return!0;var s={a:()=>a.hasAttribute("href"),audio:()=>a.hasAttribute("controls"),video:()=>a.hasAttribute("controls")};return u in s?s[u]():p2(a)?!0:u2(a)}var _2=["input:not([disabled])","select:not([disabled])","textarea:not([disabled])","embed","iframe","object","a[href]","area[href]","button:not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],g2=_2.join();function v2(a){var u=Array.from(a.querySelectorAll(g2));return u.unshift(a),u.filter(m2).filter(f=>window.getComputedStyle(f).display!=="none")}function Gi(a){for(var u=arguments.length,f=new Array(u>1?u-1:0),s=1;s<u;s++)f[s-1]=arguments[s];return kx(a)?a(...f):a}function Zn(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return function(c){u.some(T=>(T==null||T(c),c==null?void 0:c.defaultPrevented))}}function b2(a){var u;return function(){if(a){for(var s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];u=a.apply(this,c),a=null}return u}}var Ul=()=>{},J_=b2(a=>()=>{var{condition:u,message:f}=a;u&&zi&&console.warn(f)});function Qx(a,u){u===void 0&&(u={});var{isActive:f=f2,nextTick:s,preventScroll:c=!0,selectTextIfInput:T=!0}=u;if(!a||f(a))return-1;function m(){if(!a){J_({condition:!0,message:"[chakra-ui]: can't call focus() on `null` or `undefined` element"});return}if(y2())a.focus({preventScroll:c});else if(a.focus(),c){var E=T2(a);E2(E)}d2(a)&&T&&a.select()}return s?requestAnimationFrame(m):(m(),-1)}var wd=null;function y2(){if(wd==null){wd=!1;try{var a=document.createElement("div");a.focus({get preventScroll(){return wd=!0,!0}})}catch(u){}}return wd}function T2(a){for(var u,f=Yx(a),s=(u=f.defaultView)!=null?u:window,c=a.parentNode,T=[],m=f.scrollingElement||f.documentElement;c instanceof s.HTMLElement&&c!==m;)(c.offsetHeight<c.scrollHeight||c.offsetWidth<c.scrollWidth)&&T.push({element:c,scrollTop:c.scrollTop,scrollLeft:c.scrollLeft}),c=c.parentNode;return m instanceof s.HTMLElement&&T.push({element:m,scrollTop:m.scrollTop,scrollLeft:m.scrollLeft}),T}function E2(a){for(var{element:u,scrollTop:f,scrollLeft:s}of a)u.scrollTop=f,u.scrollLeft=s}var qx=1/60*1e3,S2=typeof performance!="undefined"?function(){return performance.now()}:function(){return Date.now()},Zx=typeof window!="undefined"?function(a){return window.requestAnimationFrame(a)}:function(a){return setTimeout(function(){return a(S2())},qx)};function x2(a){var u=[],f=[],s=0,c=!1,T=new WeakSet,m={schedule:function(E,d,x){d===void 0&&(d=!1),x===void 0&&(x=!1);var M=x&&c,w=M?u:f;return d&&T.add(E),w.indexOf(E)===-1&&(w.push(E),M&&c&&(s=u.length)),E},cancel:function(E){var d=f.indexOf(E);d!==-1&&f.splice(d,1),T.delete(E)},process:function(E){var d;if(c=!0,d=[f,u],u=d[0],f=d[1],f.length=0,s=u.length,s)for(var x=0;x<s;x++){var M=u[x];M(E),T.has(M)&&(m.schedule(M),a())}c=!1}};return m}var P2=40,eg=!0,Vl=!1,tg=!1,qs={delta:0,timestamp:0},kl=["read","update","preRender","render","postRender"],Ld=kl.reduce(function(a,u){return a[u]=x2(function(){return Vl=!0}),a},{}),Wi=kl.reduce(function(a,u){var f=Ld[u];return a[u]=function(s,c,T){return c===void 0&&(c=!1),T===void 0&&(T=!1),Vl||C2(),f.schedule(s,c,T)},a},{}),jl=kl.reduce(function(a,u){return a[u]=Ld[u].cancel,a},{}),Zs=kl.reduce(function(a,u){return a[u]=function(){return Ld[u].process(qs)},a},{}),A2=function(a){return Ld[a].process(qs)},$x=function(a){Vl=!1,qs.delta=eg?qx:Math.max(Math.min(a-qs.timestamp,P2),1),qs.timestamp=a,tg=!0,kl.forEach(A2),tg=!1,Vl&&(eg=!1,Zx($x))},C2=function(){Vl=!0,eg=!0,tg||Zx($x)},Nd=function(){return qs};Object.freeze(["base","sm","md","lg","xl","2xl"]);function ng(a,u){return X_(a)?a.map(f=>f===null?null:u(f)):Si(a)?Id(a).reduce((f,s)=>(f[s]=u(a[s]),f),{}):a!=null?u(a):null}function R2(a,u){function f(s,c){return c===void 0&&(c=[]),X_(s)?s.map((T,m)=>f(T,[...c,String(m)])):Si(s)?Object.fromEntries(Object.entries(s).map(T=>{var[m,E]=T;return[m,f(E,[...c,m])]})):u(s,c)}return f(a)}function O2(a,u){if(a!=null){if(kx(a)){a(u);return}try{a.current=u}catch(f){throw new Error("Cannot assign value '"+u+"' to ref '"+a+"'")}}}function zl(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return s=>{u.forEach(c=>O2(c,s))}}function ea(a){a===void 0&&(a={});var{strict:u=!0,errorMessage:f="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:s}=a,c=fr(void 0);c.displayName=s;function T(){var m=Jt(c);if(!m&&u){var E=new Error(f);throw E.name="ContextError",Error.captureStackTrace==null||Error.captureStackTrace(E,T),E}return m}return[c.Provider,T,c]}function M2(a){return Rl.toArray(a).filter(u=>Qo(u))}var[I2,D2]=ea({strict:!1,name:"PortalManagerContext"});function Jx(a){var{children:u,zIndex:f}=a;return Ye(I2,{value:{zIndex:f}},u)}zi&&(Jx.displayName="PortalManager");function rg(a){a===void 0&&(a=!1);var[u,f]=mn(a),s=Vt(()=>{f(!0)},[]),c=Vt(()=>{f(!1)},[]),T=Vt(()=>{f(m=>!m)},[]);return[u,{on:s,off:c,toggle:T}]}var $s=Qs?Ko:Ut;function ig(a,u){u===void 0&&(u=[]);var f=Nt(a);return $s(()=>{f.current=a}),Vt(function(){for(var s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];return f.current==null?void 0:f.current(...c)},u)}function w2(a,u){var f=a!==void 0,s=f&&typeof a!="undefined"?a:u;return[f,s]}var eP={prefix:Math.round(Math.random()*1e10),current:0},og=fr(eP),L2=Cl(a=>{var{children:u}=a,f=Jt(og),s=f===eP,c=Dn(()=>({prefix:s?0:++f.prefix,current:0}),[s,f]);return Ye(og.Provider,{value:c},u)});function N2(a,u){var f=Jt(og);return Dn(()=>a||[u,f.prefix,++f.current].filter(Boolean).join("-"),[a,u])}function F2(a){for(var u=arguments.length,f=new Array(u>1?u-1:0),s=1;s<u;s++)f[s-1]=arguments[s];var c=N2(a);return Dn(()=>f.map(T=>T+"-"+c),[c,f])}function B2(a,u){return u===void 0&&(u=[]),Ut(()=>()=>a(),u)}function tP(){var a=Nt(!1),[u,f]=mn(0);return B2(()=>{a.current=!0}),Vt(()=>{a.current||f(u+1)},[u])}function ag(){return ag=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},ag.apply(this,arguments)}function U2(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var[nP,V2]=ea({strict:!1,name:"PortalContext"}),sg="chakra-portal",k2=".chakra-portal",j2=a=>Ye("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:a.zIndex,top:0,left:0,right:0}},a.children),z2=a=>{var{appendToParentPortal:u,children:f}=a,s=Nt(null),c=Nt(null),T=tP(),m=V2(),E=D2();$s(()=>{if(!!s.current){var x=s.current.ownerDocument,M=u?m??x.body:x.body;if(!!M){c.current=x.createElement("div"),c.current.className=sg,M.appendChild(c.current),T();var w=c.current;return()=>{M.contains(w)&&M.removeChild(w)}}}},[]);var d=E!=null&&E.zIndex?Ye(j2,{zIndex:E==null?void 0:E.zIndex},f):f;return c.current?td(Ye(nP,{value:c.current},d),c.current):Ye("span",{ref:s})},G2=a=>{var{children:u,containerRef:f,appendToParentPortal:s}=a,c=f.current,T=c??(Qs?document.body:void 0),m=Dn(()=>{var d=c==null?void 0:c.ownerDocument.createElement("div");return d&&(d.className=sg),d},[c]),E=tP();return $s(()=>{E()},[]),$s(()=>{if(!(!m||!T))return T.appendChild(m),()=>{T.removeChild(m)}},[m,T]),T&&m?td(Ye(nP,{value:s?m:null},u),m):null};function Fd(a){var{containerRef:u}=a,f=U2(a,["containerRef"]);return u?Ye(G2,ag({containerRef:u},f)):Ye(z2,f)}Fd.defaultProps={appendToParentPortal:!0},Fd.className=sg,Fd.selector=k2;var Bd={light:"chakra-ui-light",dark:"chakra-ui-dark"},W2={classList:{add:Ul,remove:Ul}},H2=()=>Qs?document.body:W2;function X2(a){var u=H2();u.classList.add(a?Bd.dark:Bd.light),u.classList.remove(a?Bd.light:Bd.dark)}function Y2(a){var u=window.matchMedia==null?void 0:window.matchMedia(a);if(!!u)return!!u.media===u.matches}var rP={light:"(prefers-color-scheme: light)",dark:"(prefers-color-scheme: dark)"};function K2(a){var u,f=(u=Y2(rP.dark))!=null?u:a==="dark";return f?"dark":"light"}function Q2(a){if(!("matchMedia"in window))return Ul;var u=window.matchMedia(rP.dark),f=()=>{a(u.matches?"dark":"light")};return f(),u.addListener(f),()=>{u.removeListener(f)}}var iP={get:()=>document.documentElement.style.getPropertyValue("--chakra-ui-color-mode"),set:a=>{Qs&&document.documentElement.style.setProperty("--chakra-ui-color-mode",a)}},oP=()=>typeof Storage!="undefined",aP="chakra-ui-color-mode",q2={get(a){if(!oP())return a;try{var u=localStorage.getItem(aP);return u??a}catch(f){return a}},set(a){if(!!oP())try{localStorage.setItem(aP,a)}catch(u){}},type:"localStorage"},cg=fr({});zi&&(cg.displayName="ColorModeContext");var sP=()=>{var a=Jt(cg);if(a===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return a};function cP(a){var{value:u,children:f,options:{useSystemColorMode:s,initialColorMode:c},colorModeManager:T=q2}=a,[m,E]=mn(T.type==="cookie"?T.get(c):c);Ut(()=>{if(Qs&&T.type==="localStorage"){var w=s?K2(c):iP.get()||T.get();w&&E(w)}},[T,s,c]),Ut(()=>{var w=m==="dark";X2(w),iP.set(w?"dark":"light")},[m]);var d=Vt(w=>{T.set(w),E(w)},[T]),x=Vt(()=>{d(m==="light"?"dark":"light")},[m,d]);Ut(()=>{var w;return s&&(w=Q2(d)),()=>{w&&s&&w()}},[d,s]);var M=Dn(()=>({colorMode:u??m,toggleColorMode:u?Ul:x,setColorMode:u?Ul:d}),[m,d,x,u]);return Ye(cg.Provider,{value:M},f)}zi&&(cP.displayName="ColorModeProvider");var Z2=(a,u)=>f=>{var s=String(u),c=a?a+"."+s:s;return Si(f.__cssMap)&&c in f.__cssMap?f.__cssMap[c].varRef:u};function Gl(a){var{scale:u,transform:f,compose:s}=a,c=(T,m)=>{var E,d=Z2(u,T)(m),x=(E=f==null?void 0:f(d,m))!=null?E:d;return s&&(x=s(x,m)),x};return c}function xi(a,u){return f=>{var s={property:f,scale:a};return s.transform=Gl({scale:a,transform:u}),s}}var $2=a=>{var{rtl:u,ltr:f}=a;return s=>s.direction==="rtl"?u:f};function J2(a){var{property:u,scale:f,transform:s}=a;return{scale:f,property:$2(u),transform:f?Gl({scale:f,compose:s}):s}}var lP=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function eU(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...lP].join(" ")}function tU(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...lP].join(" ")}var nU={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},rU={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function iU(a){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":a,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}var oU={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},uP="& > :not(style) ~ :not(style)",aU={[uP]:{marginInlineStart:"calc(var(--chakra-space-x) * calc(1 - var(--chakra-space-x-reverse)))",marginInlineEnd:"calc(var(--chakra-space-x) * var(--chakra-space-x-reverse))"}},sU={[uP]:{marginTop:"calc(var(--chakra-space-y) * calc(1 - var(--chakra-space-y-reverse)))",marginBottom:"calc(var(--chakra-space-y) * var(--chakra-space-y-reverse))"}};function lg(a,u){lg=function(d,x){return new T(d,void 0,x)};var f=ug(RegExp),s=RegExp.prototype,c=new WeakMap;function T(E,d,x){var M=f.call(this,E,d);return c.set(M,x||c.get(E)),M}cU(T,f),T.prototype.exec=function(E){var d=s.exec.call(this,E);return d&&(d.groups=m(d,this)),d},T.prototype[Symbol.replace]=function(E,d){if(typeof d=="string"){var x=c.get(this);return s[Symbol.replace].call(this,E,d.replace(/\$<([^>]+)>/g,function(w,S){return"$"+x[S]}))}else if(typeof d=="function"){var M=this;return s[Symbol.replace].call(this,E,function(){var w=[];return w.push.apply(w,arguments),typeof w[w.length-1]!="object"&&w.push(m(w,M)),d.apply(this,w)})}else return s[Symbol.replace].call(this,E,d)};function m(E,d){var x=c.get(d);return Object.keys(x).reduce(function(M,w){return M[w]=E[x[w]],M},Object.create(null))}return lg.apply(this,arguments)}function cU(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(u&&u.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),u&&Wl(a,u)}function ug(a){var u=typeof Map=="function"?new Map:void 0;return ug=function(s){if(s===null||!uU(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u!="undefined"){if(u.has(s))return u.get(s);u.set(s,c)}function c(){return Ud(s,arguments,hg(this).constructor)}return c.prototype=Object.create(s.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),Wl(c,s)},ug(a)}function Ud(a,u,f){return lU()?Ud=Reflect.construct:Ud=function(c,T,m){var E=[null];E.push.apply(E,T);var d=Function.bind.apply(c,E),x=new d;return m&&Wl(x,m.prototype),x},Ud.apply(null,arguments)}function lU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function uU(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function Wl(a,u){return Wl=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},Wl(a,u)}function hg(a){return hg=Object.setPrototypeOf?Object.getPrototypeOf:function(f){return f.__proto__||Object.getPrototypeOf(f)},hg(a)}var dg={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},hU=new Set(Object.values(dg)),hP=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),dU=a=>a.trim();function fU(a,u){var f,s;if(a==null||hP.has(a))return a;var c=lg(/(^[\x2DA-Za-z]+)\(((.*))\)/g,{type:1,values:2}),{type:T,values:m}=(f=(s=c.exec(a))==null?void 0:s.groups)!=null?f:{};if(!T||!m)return a;var E=T.includes("-gradient")?T:T+"-gradient",[d,...x]=m.split(",").map(dU).filter(Boolean);if((x==null?void 0:x.length)===0)return a;var M=d in dg?dg[d]:d;x.unshift(M);var w=x.map(S=>{if(hU.has(S))return S;var _=S.indexOf(" "),[O,R]=_!==-1?[S.substr(0,_),S.substr(_+1)]:[S],I=dP(R)?R:R&&R.split(" "),y="colors."+O,p=y in u.__cssMap?u.__cssMap[y].varRef:O;return I?[p,I].join(" "):p});return E+"("+w.join(", ")+")"}var dP=a=>Y_(a)&&a.includes("(")&&a.includes(")"),pU=(a,u)=>fU(a,u??{}),mU=a=>{var u=parseFloat(a.toString()),f=a.toString().replace(String(u),"");return{unitless:!f,value:u,unit:f}},Hi=a=>u=>a+"("+u+")",vn={filter(a){return a!=="auto"?a:nU},backdropFilter(a){return a!=="auto"?a:rU},ring(a){return iU(vn.px(a))},bgClip(a){return a==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:a}},transform(a){return a==="auto"?eU():a==="auto-gpu"?tU():a},px(a){if(a==null)return a;var{unitless:u}=mU(a);return u||Na(a)?a+"px":a},fraction(a){return!Na(a)||a>1?a:a*100+"%"},float(a,u){var f={left:"right",right:"left"};return u.direction==="rtl"?f[a]:a},degree(a){if(jx(a)||a==null)return a;var u=Y_(a)&&!a.endsWith("deg");return Na(a)||u?a+"deg":a},gradient:pU,blur:Hi("blur"),opacity:Hi("opacity"),brightness:Hi("brightness"),contrast:Hi("contrast"),dropShadow:Hi("drop-shadow"),grayscale:Hi("grayscale"),hueRotate:Hi("hue-rotate"),invert:Hi("invert"),saturate:Hi("saturate"),sepia:Hi("sepia"),bgImage(a){if(a==null)return a;var u=dP(a)||hP.has(a);return u?a:"url("+a+")"},outline(a){var u=String(a)==="0"||String(a)==="none";return a!==null&&u?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:a}},flexDirection(a){var u,{space:f,divide:s}=(u=oU[a])!=null?u:{},c={flexDirection:a};return f&&(c[f]=1),s&&(c[s]=1),c}};function fg(){return fg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},fg.apply(this,arguments)}var He={borderWidths:xi("borderWidths"),borderStyles:xi("borderStyles"),colors:xi("colors"),borders:xi("borders"),radii:xi("radii",vn.px),space:xi("space",vn.px),spaceT:xi("space",vn.px),degreeT(a){return{property:a,transform:vn.degree}},prop(a,u,f){return fg({property:a,scale:u},u&&{transform:Gl({scale:u,transform:f})})},propT(a,u){return{property:a,transform:u}},sizes:xi("sizes",vn.px),sizesT:xi("sizes",vn.fraction),shadows:xi("shadows"),logical:J2,blur:xi("blur",vn.blur)},Vd={background:He.colors("background"),backgroundColor:He.colors("backgroundColor"),backgroundImage:He.propT("backgroundImage",vn.bgImage),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:vn.bgClip},bgSize:He.prop("backgroundSize"),bgPosition:He.prop("backgroundPosition"),bg:He.colors("background"),bgColor:He.colors("backgroundColor"),bgPos:He.prop("backgroundPosition"),bgRepeat:He.prop("backgroundRepeat"),bgAttachment:He.prop("backgroundAttachment"),bgGradient:He.propT("backgroundImage",vn.gradient),bgClip:{transform:vn.bgClip}};Object.assign(Vd,{bgImage:Vd.backgroundImage,bgImg:Vd.backgroundImage});var on={border:He.borders("border"),borderWidth:He.borderWidths("borderWidth"),borderStyle:He.borderStyles("borderStyle"),borderColor:He.colors("borderColor"),borderRadius:He.radii("borderRadius"),borderTop:He.borders("borderTop"),borderBlockStart:He.borders("borderBlockStart"),borderTopLeftRadius:He.radii("borderTopLeftRadius"),borderStartStartRadius:He.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:He.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:He.radii("borderTopRightRadius"),borderStartEndRadius:He.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:He.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:He.borders("borderRight"),borderInlineEnd:He.borders("borderInlineEnd"),borderBottom:He.borders("borderBottom"),borderBlockEnd:He.borders("borderBlockEnd"),borderBottomLeftRadius:He.radii("borderBottomLeftRadius"),borderBottomRightRadius:He.radii("borderBottomRightRadius"),borderLeft:He.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:He.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:He.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:He.borders(["borderLeft","borderRight"]),borderInline:He.borders("borderInline"),borderY:He.borders(["borderTop","borderBottom"]),borderBlock:He.borders("borderBlock"),borderTopWidth:He.borderWidths("borderTopWidth"),borderBlockStartWidth:He.borderWidths("borderBlockStartWidth"),borderTopColor:He.colors("borderTopColor"),borderBlockStartColor:He.colors("borderBlockStartColor"),borderTopStyle:He.borderStyles("borderTopStyle"),borderBlockStartStyle:He.borderStyles("borderBlockStartStyle"),borderBottomWidth:He.borderWidths("borderBottomWidth"),borderBlockEndWidth:He.borderWidths("borderBlockEndWidth"),borderBottomColor:He.colors("borderBottomColor"),borderBlockEndColor:He.colors("borderBlockEndColor"),borderBottomStyle:He.borderStyles("borderBottomStyle"),borderBlockEndStyle:He.borderStyles("borderBlockEndStyle"),borderLeftWidth:He.borderWidths("borderLeftWidth"),borderInlineStartWidth:He.borderWidths("borderInlineStartWidth"),borderLeftColor:He.colors("borderLeftColor"),borderInlineStartColor:He.colors("borderInlineStartColor"),borderLeftStyle:He.borderStyles("borderLeftStyle"),borderInlineStartStyle:He.borderStyles("borderInlineStartStyle"),borderRightWidth:He.borderWidths("borderRightWidth"),borderInlineEndWidth:He.borderWidths("borderInlineEndWidth"),borderRightColor:He.colors("borderRightColor"),borderInlineEndColor:He.colors("borderInlineEndColor"),borderRightStyle:He.borderStyles("borderRightStyle"),borderInlineEndStyle:He.borderStyles("borderInlineEndStyle"),borderTopRadius:He.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:He.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:He.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:He.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(on,{rounded:on.borderRadius,roundedTop:on.borderTopRadius,roundedTopLeft:on.borderTopLeftRadius,roundedTopRight:on.borderTopRightRadius,roundedTopStart:on.borderStartStartRadius,roundedTopEnd:on.borderStartEndRadius,roundedBottom:on.borderBottomRadius,roundedBottomLeft:on.borderBottomLeftRadius,roundedBottomRight:on.borderBottomRightRadius,roundedBottomStart:on.borderEndStartRadius,roundedBottomEnd:on.borderEndEndRadius,roundedLeft:on.borderLeftRadius,roundedRight:on.borderRightRadius,roundedStart:on.borderInlineStartRadius,roundedEnd:on.borderInlineEndRadius,borderStart:on.borderInlineStart,borderEnd:on.borderInlineEnd,borderTopStartRadius:on.borderStartStartRadius,borderTopEndRadius:on.borderStartEndRadius,borderBottomStartRadius:on.borderEndStartRadius,borderBottomEndRadius:on.borderEndEndRadius,borderStartRadius:on.borderInlineStartRadius,borderEndRadius:on.borderInlineEndRadius,borderStartWidth:on.borderInlineStartWidth,borderEndWidth:on.borderInlineEndWidth,borderStartColor:on.borderInlineStartColor,borderEndColor:on.borderInlineEndColor,borderStartStyle:on.borderInlineStartStyle,borderEndStyle:on.borderInlineEndStyle});var _U={color:He.colors("color"),textColor:He.colors("color"),fill:He.colors("fill"),stroke:He.colors("stroke")},pg={boxShadow:He.shadows("boxShadow"),mixBlendMode:!0,blendMode:He.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:He.prop("backgroundBlendMode"),opacity:!0};Object.assign(pg,{shadow:pg.boxShadow});var gU={filter:{transform:vn.filter},blur:He.blur("--chakra-blur"),brightness:He.propT("--chakra-brightness",vn.brightness),contrast:He.propT("--chakra-contrast",vn.contrast),hueRotate:He.degreeT("--chakra-hue-rotate"),invert:He.propT("--chakra-invert",vn.invert),saturate:He.propT("--chakra-saturate",vn.saturate),dropShadow:He.propT("--chakra-drop-shadow",vn.dropShadow),backdropFilter:{transform:vn.backdropFilter},backdropBlur:He.blur("--chakra-backdrop-blur"),backdropBrightness:He.propT("--chakra-backdrop-brightness",vn.brightness),backdropContrast:He.propT("--chakra-backdrop-contrast",vn.contrast),backdropHueRotate:He.degreeT("--chakra-backdrop-hue-rotate"),backdropInvert:He.propT("--chakra-backdrop-invert",vn.invert),backdropSaturate:He.propT("--chakra-backdrop-saturate",vn.saturate)},kd={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:vn.flexDirection},experimental_spaceX:{static:aU,transform:Gl({scale:"space",transform:a=>a!==null?{"--chakra-space-x":a}:null})},experimental_spaceY:{static:sU,transform:Gl({scale:"space",transform:a=>a!=null?{"--chakra-space-y":a}:null})},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:He.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0};Object.assign(kd,{flexDir:kd.flexDirection});var fP={gridGap:He.space("gridGap"),gridColumnGap:He.space("gridColumnGap"),gridRowGap:He.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0},vU={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:vn.outline},outlineOffset:!0,outlineColor:He.colors("outlineColor")},ci={width:He.sizesT("width"),inlineSize:He.sizesT("inlineSize"),height:He.sizes("height"),blockSize:He.sizes("blockSize"),boxSize:He.sizes(["width","height"]),minWidth:He.sizes("minWidth"),minInlineSize:He.sizes("minInlineSize"),minHeight:He.sizes("minHeight"),minBlockSize:He.sizes("minBlockSize"),maxWidth:He.sizes("maxWidth"),maxInlineSize:He.sizes("maxInlineSize"),maxHeight:He.sizes("maxHeight"),maxBlockSize:He.sizes("maxBlockSize"),d:He.prop("display"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:He.propT("float",vn.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ci,{w:ci.width,h:ci.height,minW:ci.minWidth,maxW:ci.maxWidth,minH:ci.minHeight,maxH:ci.maxHeight,overscroll:ci.overscrollBehavior,overscrollX:ci.overscrollBehaviorX,overscrollY:ci.overscrollBehaviorY});var bU={listStyleType:!0,listStylePosition:!0,listStylePos:He.prop("listStylePosition"),listStyleImage:!0,listStyleImg:He.prop("listStyleImage")},yU={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},TU={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},mg=(a,u,f)=>{var s={},c=Od(a,u,{});for(var T in c){var m=T in f&&f[T]!=null;m||(s[T]=c[T])}return s},EU={srOnly:{transform(a){return a===!0?yU:a==="focusable"?TU:{}}},layerStyle:{processResult:!0,transform:(a,u,f)=>mg(u,"layerStyles."+a,f)},textStyle:{processResult:!0,transform:(a,u,f)=>mg(u,"textStyles."+a,f)},apply:{processResult:!0,transform:(a,u,f)=>mg(u,a,f)}},Hl={position:!0,pos:He.prop("position"),zIndex:He.prop("zIndex","zIndices"),inset:He.spaceT(["top","right","bottom","left"]),insetX:He.spaceT(["left","right"]),insetInline:He.spaceT("insetInline"),insetY:He.spaceT(["top","bottom"]),insetBlock:He.spaceT("insetBlock"),top:He.spaceT("top"),insetBlockStart:He.spaceT("insetBlockStart"),bottom:He.spaceT("bottom"),insetBlockEnd:He.spaceT("insetBlockEnd"),left:He.spaceT("left"),insetInlineStart:He.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:He.spaceT("right"),insetInlineEnd:He.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Hl,{insetStart:Hl.insetInlineStart,insetEnd:Hl.insetInlineEnd});var SU={ring:{transform:vn.ring},ringColor:He.colors("--chakra-ring-color"),ringOffset:He.prop("--chakra-ring-offset-width"),ringOffsetColor:He.colors("--chakra-ring-offset-color"),ringInset:He.prop("--chakra-ring-inset")},An={margin:He.spaceT("margin"),marginTop:He.spaceT("marginTop"),marginBlockStart:He.spaceT("marginBlockStart"),marginRight:He.spaceT("marginRight"),marginInlineEnd:He.spaceT("marginInlineEnd"),marginBottom:He.spaceT("marginBottom"),marginBlockEnd:He.spaceT("marginBlockEnd"),marginLeft:He.spaceT("marginLeft"),marginInlineStart:He.spaceT("marginInlineStart"),marginX:He.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:He.spaceT("marginInline"),marginY:He.spaceT(["marginTop","marginBottom"]),marginBlock:He.spaceT("marginBlock"),padding:He.space("padding"),paddingTop:He.space("paddingTop"),paddingBlockStart:He.space("paddingBlockStart"),paddingRight:He.space("paddingRight"),paddingBottom:He.space("paddingBottom"),paddingBlockEnd:He.space("paddingBlockEnd"),paddingLeft:He.space("paddingLeft"),paddingInlineStart:He.space("paddingInlineStart"),paddingInlineEnd:He.space("paddingInlineEnd"),paddingX:He.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:He.space("paddingInline"),paddingY:He.space(["paddingTop","paddingBottom"]),paddingBlock:He.space("paddingBlock")};Object.assign(An,{m:An.margin,mt:An.marginTop,mr:An.marginRight,me:An.marginInlineEnd,marginEnd:An.marginInlineEnd,mb:An.marginBottom,ml:An.marginLeft,ms:An.marginInlineStart,marginStart:An.marginInlineStart,mx:An.marginX,my:An.marginY,p:An.padding,pt:An.paddingTop,py:An.paddingY,px:An.paddingX,pb:An.paddingBottom,pl:An.paddingLeft,ps:An.paddingInlineStart,paddingStart:An.paddingInlineStart,pr:An.paddingRight,pe:An.paddingInlineEnd,paddingEnd:An.paddingInlineEnd});var xU={textDecorationColor:He.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:He.shadows("textShadow")},PU={clipPath:!0,transform:He.propT("transform",vn.transform),transformOrigin:!0,translateX:He.spaceT("--chakra-translate-x"),translateY:He.spaceT("--chakra-translate-y"),skewX:He.degreeT("--chakra-skew-x"),skewY:He.degreeT("--chakra-skew-y"),scaleX:He.prop("--chakra-scale-x"),scaleY:He.prop("--chakra-scale-y"),scale:He.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:He.degreeT("--chakra-rotate")},AU={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:He.prop("transitionDuration","transition.duration"),transitionProperty:He.prop("transitionProperty","transition.property"),transitionTimingFunction:He.prop("transitionTimingFunction","transition.easing")},CU={fontFamily:He.prop("fontFamily","fonts"),fontSize:He.prop("fontSize","fontSizes",vn.px),fontWeight:He.prop("fontWeight","fontWeights"),lineHeight:He.prop("lineHeight","lineHeights"),letterSpacing:He.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"},isTruncated:{transform(a){if(a===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}}},Js={hover:a=>a+":hover &, "+a+"[data-hover] &",focus:a=>a+":focus &, "+a+"[data-focus] &",active:a=>a+":active &, "+a+"[data-active] &",disabled:a=>a+":disabled &, "+a+"[data-disabled] &",invalid:a=>a+":invalid &, "+a+"[data-invalid] &",checked:a=>a+":checked &, "+a+"[data-checked] &",indeterminate:a=>a+":indeterminate &, "+a+"[aria-checked=mixed] &, "+a+"[data-indeterminate] &",readOnly:a=>a+":read-only &, "+a+"[readonly] &, "+a+"[data-read-only] &",expanded:a=>a+":read-only &, "+a+"[aria-expanded=true] &, "+a+"[data-expanded] &"},ec=a=>RU(a,"[role=group]","[data-group]",".group"),RU=function(u){for(var f=arguments.length,s=new Array(f>1?f-1:0),c=1;c<f;c++)s[c-1]=arguments[c];return s.map(u).join(", ")},_g={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within",_focusVisible:"&:focus-visible",_disabled:"&[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty",_expanded:"&[aria-expanded=true], &[data-expanded]",_checked:"&[aria-checked=true], &[data-checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate]",_groupHover:ec(Js.hover),_groupFocus:ec(Js.focus),_groupActive:ec(Js.active),_groupDisabled:ec(Js.disabled),_groupInvalid:ec(Js.invalid),_groupChecked:ec(Js.checked),_placeholder:"&::placeholder",_fullScreen:"&:fullscreen",_selection:"&::selection",_rtl:"[dir=rtl] &",_mediaDark:"@media (prefers-color-scheme: dark)",_dark:".chakra-ui-dark &, [data-theme=dark] &, &[data-theme=dark]",_light:".chakra-ui-light &, [data-theme=light] &, &[data-theme=light]"},OU=Id(_g);function gg(){return gg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},gg.apply(this,arguments)}var vg=fo({},Vd,on,_U,kd,ci,gU,SU,vU,fP,EU,Hl,pg,An,CU,xU,PU,bU,AU),MU=Object.assign({},An,ci,kd,fP,Hl),IU=Id(MU),DU=[...Id(vg),...OU],wU=gg({},vg,_g),LU=a=>a in wU,NU=a=>u=>{if(!u.__breakpoints)return a;var{isResponsive:f,toArrayValue:s,media:c}=u.__breakpoints,T={};for(var m in a){var E=Gi(a[m],u);if(E!=null){if(E=Si(E)&&f(E)?s(E):E,!Array.isArray(E)){T[m]=E;continue}for(var d=E.slice(0,c.length).length,x=0;x<d;x+=1){var M=c==null?void 0:c[x];if(!M){T[m]=E[x];continue}T[M]=T[M]||{},E[x]!=null&&(T[M][m]=E[x])}}}return T},FU=(a,u)=>a.startsWith("--")&&Y_(u)&&!jx(u),BU=(a,u)=>{var f,s;if(u==null)return u;var c=x=>{var M,w;return(M=a.__cssMap)==null||(w=M[x])==null?void 0:w.varRef},T=x=>{var M;return(M=c(x))!=null?M:x},m=u.split(",").map(x=>x.trim()),[E,d]=m;return u=(f=(s=c(E))!=null?s:T(d))!=null?f:T(u),u};function UU(a){var{configs:u={},pseudos:f={},theme:s}=a,c=function T(m,E){E===void 0&&(E=!1);var d=Gi(m,s),x=NU(d)(s),M={};for(var w in x){var S,_,O,R,I,y=x[w],p=Gi(y,s);w in f&&(w=f[w]),FU(w,p)&&(p=BU(s,p));var g=u[w];if(g===!0&&(g={property:w}),Si(p)){var C;M[w]=(C=M[w])!=null?C:{},M[w]=fo({},M[w],T(p,!0));continue}var P=(S=(_=g)==null||_.transform==null?void 0:_.transform(p,s,d))!=null?S:p;P=(O=g)!=null&&O.processResult?T(P,!0):P;var F=Gi((R=g)==null?void 0:R.property,s);if(!E&&(I=g)!=null&&I.static){var U=Gi(g.static,s);M=fo({},M,U)}if(F&&Array.isArray(F)){for(var B of F)M[B]=P;continue}if(F){F==="&"&&Si(P)?M=fo({},M,P):M[F]=P;continue}if(Si(P)){M=fo({},M,P);continue}M[w]=P}return M};return c}var pP=a=>u=>{var f=UU({theme:u,pseudos:_g,configs:vg});return f(a)};function mP(a){return Si(a)&&a.reference?a.reference:String(a)}var jd=function(u){for(var f=arguments.length,s=new Array(f>1?f-1:0),c=1;c<f;c++)s[c-1]=arguments[c];return s.map(mP).join(" "+u+" ").replace(/calc/g,"")},_P=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+jd("+",...f)+")"},gP=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+jd("-",...f)+")"},bg=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+jd("*",...f)+")"},vP=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+jd("/",...f)+")"},bP=a=>{var u=mP(a);return u!=null&&!Number.isNaN(parseFloat(u))?String(u).startsWith("-")?String(u).slice(1):"-"+u:bg(u,-1)},Fa=Object.assign(a=>({add:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return Fa(_P(a,...s))},subtract:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return Fa(gP(a,...s))},multiply:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return Fa(bg(a,...s))},divide:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return Fa(vP(a,...s))},negate:()=>Fa(bP(a)),toString:()=>a.toString()}),{add:_P,subtract:gP,multiply:bg,divide:vP,negate:bP});function VU(a,u){return u===void 0&&(u="-"),a.replace(/\s+/g,u)}function yP(a){var u=VU(a.toString());if(u.includes("\\."))return a;var f=!Number.isInteger(parseFloat(a.toString()));return f?u.replace(".","\\."):a}function kU(a,u){return u===void 0&&(u=""),[u,yP(a)].filter(Boolean).join("-")}function jU(a,u){return"var("+yP(a)+(u?", "+u:"")+")"}function zU(a,u){return u===void 0&&(u=""),"--"+kU(a,u)}function TP(a,u,f){var s=zU(a,f);return{variable:s,reference:jU(s,u)}}function yg(){return yg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},yg.apply(this,arguments)}function GU(a,u){var f={cssMap:{},cssVars:{}};return R2(a,(s,c)=>{var T,[m]=c,E=(T=Tg[m])!=null?T:Tg.defaultHandler,{cssVars:d,cssMap:x}=E(c,s,u);Object.assign(f.cssVars,d),Object.assign(f.cssMap,x)}),f}var Tg={space:(a,u,f)=>{var s=Tg.defaultHandler(a,u,f),[c,...T]=a,m=c+".-"+T.join("."),E=a.join("-"),{variable:d,reference:x}=TP(E,void 0,f.cssVarPrefix),M=Fa.negate(u),w=Fa.negate(x);return{cssVars:s.cssVars,cssMap:yg({},s.cssMap,{[m]:{value:""+M,var:""+d,varRef:w}})}},defaultHandler:(a,u,f)=>{var s=a.join("."),c=a.join("-"),{variable:T,reference:m}=TP(c,void 0,f.cssVarPrefix);return{cssVars:{[T]:u},cssMap:{[s]:{value:u,var:T,varRef:m}}}}};function WU(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var HU=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur"];function XU(a){var u=HU;return e2(a,u)}function YU(a){var u=WU(a,["__cssMap","__cssVars","__breakpoints"]);return u}function Eg(){return Eg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Eg.apply(this,arguments)}function KU(a){var u,f=YU(a),s=XU(f),c=(u=f.config)==null?void 0:u.cssVarPrefix,{cssMap:T,cssVars:m}=GU(s,{cssVarPrefix:c}),E={"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"};return Object.assign(f,{__cssVars:Eg({},E,m),__cssMap:T,__breakpoints:c2(f.breakpoints)}),f}var QU=typeof Element!="undefined",qU=typeof Map=="function",ZU=typeof Set=="function",$U=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function zd(a,u){if(a===u)return!0;if(a&&u&&typeof a=="object"&&typeof u=="object"){if(a.constructor!==u.constructor)return!1;var f,s,c;if(Array.isArray(a)){if(f=a.length,f!=u.length)return!1;for(s=f;s--!=0;)if(!zd(a[s],u[s]))return!1;return!0}var T;if(qU&&a instanceof Map&&u instanceof Map){if(a.size!==u.size)return!1;for(T=a.entries();!(s=T.next()).done;)if(!u.has(s.value[0]))return!1;for(T=a.entries();!(s=T.next()).done;)if(!zd(s.value[1],u.get(s.value[0])))return!1;return!0}if(ZU&&a instanceof Set&&u instanceof Set){if(a.size!==u.size)return!1;for(T=a.entries();!(s=T.next()).done;)if(!u.has(s.value[0]))return!1;return!0}if($U&&ArrayBuffer.isView(a)&&ArrayBuffer.isView(u)){if(f=a.length,f!=u.length)return!1;for(s=f;s--!=0;)if(a[s]!==u[s])return!1;return!0}if(a.constructor===RegExp)return a.source===u.source&&a.flags===u.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===u.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===u.toString();if(c=Object.keys(a),f=c.length,f!==Object.keys(u).length)return!1;for(s=f;s--!=0;)if(!Object.prototype.hasOwnProperty.call(u,c[s]))return!1;if(QU&&a instanceof Element)return!1;for(s=f;s--!=0;)if(!((c[s]==="_owner"||c[s]==="__v"||c[s]==="__o")&&a.$$typeof)&&!zd(a[c[s]],u[c[s]]))return!1;return!0}return a!==a&&u!==u}var JU=function(u,f){try{return zd(u,f)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}},eV=a=>{var{cssVarsRoot:u=":host, :root",theme:f,children:s}=a,c=Dn(()=>KU(f),[f]);return Ye(Bx,{theme:c},Ye(Rd,{styles:T=>({[u]:T.__cssVars})}),s)};function EP(){var a=Jt(ji);if(!a)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return a}var[SP,ta]=ea({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "}),tV=()=>{var{colorMode:a}=sP();return Ye(Rd,{styles:u=>{var f=Od(u,"styles.global"),s=Gi(f,{theme:u,colorMode:a});if(!!s){var c=pP(s)(u);return c}}})},nV=["a","b","article","aside","blockquote","button","caption","cite","circle","code","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","img","input","kbd","label","li","main","mark","nav","ol","p","path","pre","q","rect","s","svg","section","select","strong","small","span","sub","sup","table","tbody","td","textarea","tfoot","th","thead","tr","ul"];function na(a){return zx(a,["styleConfig","size","variant","colorScheme"])}function Sg(){return Sg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Sg.apply(this,arguments)}function rV(){var a=sP(),u=EP();return Sg({},a,{theme:u})}var iV=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,oV=xx(function(a){return iV.test(a)||a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)<91}),aV=oV,sV=function(u){return u!=="theme"},xP=function(u){return typeof u=="string"&&u.charCodeAt(0)>96?aV:sV},PP=function(u,f,s){var c;if(f){var T=f.shouldForwardProp;c=u.__emotion_forwardProp&&T?function(m){return u.__emotion_forwardProp(m)&&T(m)}:T}return typeof c!="function"&&s&&(c=u.__emotion_forwardProp),c},cV=function a(u,f){var s=u.__emotion_real===u,c=s&&u.__emotion_base||u,T,m;f!==void 0&&(T=f.label,m=f.target);var E=PP(u,f,s),d=E||xP(c),x=!d("as");return function(){var M=arguments,w=s&&u.__emotion_styles!==void 0?u.__emotion_styles.slice(0):[];if(T!==void 0&&w.push("label:"+T+";"),M[0]==null||M[0].raw===void 0)w.push.apply(w,M);else{w.push(M[0][0]);for(var S=M.length,_=1;_<S;_++)w.push(M[_],M[0][_])}var O=Bl(function(R,I,y){var p=x&&R.as||c,g="",C=[],P=R;if(R.theme==null){P={};for(var F in R)P[F]=R[F];P.theme=Jt(ji)}typeof R.className=="string"?g=k_(I.registered,C,R.className):R.className!=null&&(g=R.className+" ");var U=Fl(w.concat(C),I.registered,P);Cd(I,U,typeof p=="string"),g+=I.key+"-"+U.name,m!==void 0&&(g+=" "+m);var B=x&&E===void 0?xP(p):d,L={};for(var z in R)x&&z==="as"||B(z)&&(L[z]=R[z]);L.className=g,L.ref=y;var X=Ye(p,L);return X});return O.displayName=T!==void 0?T:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",O.defaultProps=u.defaultProps,O.__emotion_real=O,O.__emotion_base=c,O.__emotion_styles=w,O.__emotion_forwardProp=E,Object.defineProperty(O,"toString",{value:function(){return"."+m}}),O.withComponent=function(R,I){return a(R,Jo({},f,I,{shouldForwardProp:PP(O,I,!0)})).apply(void 0,w)},O}},lV=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],xg=cV.bind();lV.forEach(function(a){xg[a]=xg(a)});var uV=new Set([...DU,"textStyle","layerStyle","apply","isTruncated","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),hV=new Set(["htmlWidth","htmlHeight","htmlSize"]),dV=a=>hV.has(a)||!uV.has(a);function AP(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var fV=a=>{var{baseStyle:u}=a;return f=>{var{css:s,__css:c,sx:T}=f,m=AP(f,["theme","css","__css","sx"]),E=Gx(m,(w,S)=>LU(S)),d=Gi(u,f),x=Object.assign({},c,d,Md(E),T),M=pP(x)(f.theme);return s?[M,s]:M}};function pV(a,u){var f=u??{},{baseStyle:s}=f,c=AP(f,["baseStyle"]);c.shouldForwardProp||(c.shouldForwardProp=dV);var T=fV({baseStyle:s});return xg(a,c)(T)}var qt=pV;nV.forEach(a=>{qt[a]=qt(a)});function Sn(a){return bi(a)}function mV(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function Xl(a,u,f){var s;u===void 0&&(u={}),f===void 0&&(f={});var{styleConfig:c}=u,T=mV(u,["styleConfig"]),{theme:m,colorMode:E}=rV(),d=Od(m,"components."+a),x=c||d,M=fo({theme:m,colorMode:E},(s=x==null?void 0:x.defaultProps)!=null?s:{},Md(zx(T,["children"]))),w=Nt({});if(x){var S,_,O,R,I,y,p=Gi((S=x.baseStyle)!=null?S:{},M),g=Gi((_=(O=x.variants)==null?void 0:O[M.variant])!=null?_:{},M),C=Gi((R=(I=x.sizes)==null?void 0:I[M.size])!=null?R:{},M),P=fo({},p,C,g);(y=f)!=null&&y.isMultiPart&&x.parts&&x.parts.forEach(U=>{var B;P[U]=(B=P[U])!=null?B:{}});var F=JU(w.current,P);F||(w.current=P)}return w.current}function Yl(a,u){return Xl(a,u,{isMultiPart:!0})}var _V={body:{classList:{add(){},remove(){}}},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}}},CP=_V,tc=()=>{},gV={document:CP,navigator:{userAgent:""},CustomEvent:function(){return this},addEventListener:tc,removeEventListener:tc,getComputedStyle(){return{getPropertyValue(){return""}}},matchMedia(){return{matches:!1,addListener:tc,removeListener:tc}},requestAnimationFrame(a){return typeof setTimeout=="undefined"?(a(),null):setTimeout(a,0)},cancelAnimationFrame(a){typeof setTimeout!="undefined"&&clearTimeout(a)},setTimeout:()=>0,clearTimeout:tc,setInterval:()=>0,clearInterval:tc},vV=gV,bV={window:vV,document:CP},RP=Qs?{window,document}:bV,yV=fr(RP);function TV(a){var{children:u,environment:f}=a,[s,c]=mn(null),T=Dn(()=>{var E,d=s==null?void 0:s.ownerDocument,x=s==null?void 0:s.ownerDocument.defaultView,M=d?{document:d,window:x}:void 0,w=(E=f??M)!=null?E:RP;return w},[s,f]),m=!s&&!f;return oi.createElement(yV.Provider,{value:T},u,m&&oi.createElement("span",{ref:E=>{E&&c(E)}}))}var EV=a=>{var{children:u,colorModeManager:f,portalZIndex:s,resetCSS:c=!0,theme:T={},environment:m,cssVarsRoot:E}=a,d=Ye(TV,{environment:m},u);return Ye(L2,null,Ye(eV,{theme:T,cssVarsRoot:E},Ye(cP,{colorModeManager:f,options:T.config},c&&Ye(ZB,null),Ye(tV,null),s?Ye(Jx,{zIndex:s},d):d)))},OP={exports:{}};(function(a){(function(u){var f=/^\s+/,s=/\s+$/,c=0,T=u.round,m=u.min,E=u.max,d=u.random;function x(de,ge){if(de=de||"",ge=ge||{},de instanceof x)return de;if(!(this instanceof x))return new x(de,ge);var ne=M(de);this._originalInput=de,this._r=ne.r,this._g=ne.g,this._b=ne.b,this._a=ne.a,this._roundA=T(100*this._a)/100,this._format=ge.format||ne.format,this._gradientType=ge.gradientType,this._r<1&&(this._r=T(this._r)),this._g<1&&(this._g=T(this._g)),this._b<1&&(this._b=T(this._b)),this._ok=ne.ok,this._tc_id=c++}x.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var de=this.toRgb();return(de.r*299+de.g*587+de.b*114)/1e3},getLuminance:function(){var de=this.toRgb(),ge,ne,Te,we,Se,Ge;return ge=de.r/255,ne=de.g/255,Te=de.b/255,ge<=.03928?we=ge/12.92:we=u.pow((ge+.055)/1.055,2.4),ne<=.03928?Se=ne/12.92:Se=u.pow((ne+.055)/1.055,2.4),Te<=.03928?Ge=Te/12.92:Ge=u.pow((Te+.055)/1.055,2.4),.2126*we+.7152*Se+.0722*Ge},setAlpha:function(de){return this._a=ie(de),this._roundA=T(100*this._a)/100,this},toHsv:function(){var de=O(this._r,this._g,this._b);return{h:de.h*360,s:de.s,v:de.v,a:this._a}},toHsvString:function(){var de=O(this._r,this._g,this._b),ge=T(de.h*360),ne=T(de.s*100),Te=T(de.v*100);return this._a==1?"hsv("+ge+", "+ne+"%, "+Te+"%)":"hsva("+ge+", "+ne+"%, "+Te+"%, "+this._roundA+")"},toHsl:function(){var de=S(this._r,this._g,this._b);return{h:de.h*360,s:de.s,l:de.l,a:this._a}},toHslString:function(){var de=S(this._r,this._g,this._b),ge=T(de.h*360),ne=T(de.s*100),Te=T(de.l*100);return this._a==1?"hsl("+ge+", "+ne+"%, "+Te+"%)":"hsla("+ge+", "+ne+"%, "+Te+"%, "+this._roundA+")"},toHex:function(de){return I(this._r,this._g,this._b,de)},toHexString:function(de){return"#"+this.toHex(de)},toHex8:function(de){return y(this._r,this._g,this._b,this._a,de)},toHex8String:function(de){return"#"+this.toHex8(de)},toRgb:function(){return{r:T(this._r),g:T(this._g),b:T(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+T(this._r)+", "+T(this._g)+", "+T(this._b)+")":"rgba("+T(this._r)+", "+T(this._g)+", "+T(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:T(se(this._r,255)*100)+"%",g:T(se(this._g,255)*100)+"%",b:T(se(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+T(se(this._r,255)*100)+"%, "+T(se(this._g,255)*100)+"%, "+T(se(this._b,255)*100)+"%)":"rgba("+T(se(this._r,255)*100)+"%, "+T(se(this._g,255)*100)+"%, "+T(se(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:ve[I(this._r,this._g,this._b,!0)]||!1},toFilter:function(de){var ge="#"+p(this._r,this._g,this._b,this._a),ne=ge,Te=this._gradientType?"GradientType = 1, ":"";if(de){var we=x(de);ne="#"+p(we._r,we._g,we._b,we._a)}return"progid:DXImageTransform.Microsoft.gradient("+Te+"startColorstr="+ge+",endColorstr="+ne+")"},toString:function(de){var ge=!!de;de=de||this._format;var ne=!1,Te=this._a<1&&this._a>=0,we=!ge&&Te&&(de==="hex"||de==="hex6"||de==="hex3"||de==="hex4"||de==="hex8"||de==="name");return we?de==="name"&&this._a===0?this.toName():this.toRgbString():(de==="rgb"&&(ne=this.toRgbString()),de==="prgb"&&(ne=this.toPercentageRgbString()),(de==="hex"||de==="hex6")&&(ne=this.toHexString()),de==="hex3"&&(ne=this.toHexString(!0)),de==="hex4"&&(ne=this.toHex8String(!0)),de==="hex8"&&(ne=this.toHex8String()),de==="name"&&(ne=this.toName()),de==="hsl"&&(ne=this.toHslString()),de==="hsv"&&(ne=this.toHsvString()),ne||this.toHexString())},clone:function(){return x(this.toString())},_applyModification:function(de,ge){var ne=de.apply(null,[this].concat([].slice.call(ge)));return this._r=ne._r,this._g=ne._g,this._b=ne._b,this.setAlpha(ne._a),this},lighten:function(){return this._applyModification(F,arguments)},brighten:function(){return this._applyModification(U,arguments)},darken:function(){return this._applyModification(B,arguments)},desaturate:function(){return this._applyModification(g,arguments)},saturate:function(){return this._applyModification(C,arguments)},greyscale:function(){return this._applyModification(P,arguments)},spin:function(){return this._applyModification(L,arguments)},_applyCombination:function(de,ge){return de.apply(null,[this].concat([].slice.call(ge)))},analogous:function(){return this._applyCombination($,arguments)},complement:function(){return this._applyCombination(z,arguments)},monochromatic:function(){return this._applyCombination(fe,arguments)},splitcomplement:function(){return this._applyCombination(ee,arguments)},triad:function(){return this._applyCombination(X,arguments)},tetrad:function(){return this._applyCombination(G,arguments)}},x.fromRatio=function(de,ge){if(typeof de=="object"){var ne={};for(var Te in de)de.hasOwnProperty(Te)&&(Te==="a"?ne[Te]=de[Te]:ne[Te]=Q(de[Te]));de=ne}return x(de,ge)};function M(de){var ge={r:0,g:0,b:0},ne=1,Te=null,we=null,Se=null,Ge=!1,$e=!1;return typeof de=="string"&&(de=pe(de)),typeof de=="object"&&(ae(de.r)&&ae(de.g)&&ae(de.b)?(ge=w(de.r,de.g,de.b),Ge=!0,$e=String(de.r).substr(-1)==="%"?"prgb":"rgb"):ae(de.h)&&ae(de.s)&&ae(de.v)?(Te=Q(de.s),we=Q(de.v),ge=R(de.h,Te,we),Ge=!0,$e="hsv"):ae(de.h)&&ae(de.s)&&ae(de.l)&&(Te=Q(de.s),Se=Q(de.l),ge=_(de.h,Te,Se),Ge=!0,$e="hsl"),de.hasOwnProperty("a")&&(ne=de.a)),ne=ie(ne),{ok:Ge,format:de.format||$e,r:m(255,E(ge.r,0)),g:m(255,E(ge.g,0)),b:m(255,E(ge.b,0)),a:ne}}function w(de,ge,ne){return{r:se(de,255)*255,g:se(ge,255)*255,b:se(ne,255)*255}}function S(de,ge,ne){de=se(de,255),ge=se(ge,255),ne=se(ne,255);var Te=E(de,ge,ne),we=m(de,ge,ne),Se,Ge,$e=(Te+we)/2;if(Te==we)Se=Ge=0;else{var nt=Te-we;switch(Ge=$e>.5?nt/(2-Te-we):nt/(Te+we),Te){case de:Se=(ge-ne)/nt+(ge<ne?6:0);break;case ge:Se=(ne-de)/nt+2;break;case ne:Se=(de-ge)/nt+4;break}Se/=6}return{h:Se,s:Ge,l:$e}}function _(de,ge,ne){var Te,we,Se;de=se(de,360),ge=se(ge,100),ne=se(ne,100);function Ge(et,Ze,ht){return ht<0&&(ht+=1),ht>1&&(ht-=1),ht<1/6?et+(Ze-et)*6*ht:ht<1/2?Ze:ht<2/3?et+(Ze-et)*(2/3-ht)*6:et}if(ge===0)Te=we=Se=ne;else{var $e=ne<.5?ne*(1+ge):ne+ge-ne*ge,nt=2*ne-$e;Te=Ge(nt,$e,de+1/3),we=Ge(nt,$e,de),Se=Ge(nt,$e,de-1/3)}return{r:Te*255,g:we*255,b:Se*255}}function O(de,ge,ne){de=se(de,255),ge=se(ge,255),ne=se(ne,255);var Te=E(de,ge,ne),we=m(de,ge,ne),Se,Ge,$e=Te,nt=Te-we;if(Ge=Te===0?0:nt/Te,Te==we)Se=0;else{switch(Te){case de:Se=(ge-ne)/nt+(ge<ne?6:0);break;case ge:Se=(ne-de)/nt+2;break;case ne:Se=(de-ge)/nt+4;break}Se/=6}return{h:Se,s:Ge,v:$e}}function R(de,ge,ne){de=se(de,360)*6,ge=se(ge,100),ne=se(ne,100);var Te=u.floor(de),we=de-Te,Se=ne*(1-ge),Ge=ne*(1-we*ge),$e=ne*(1-(1-we)*ge),nt=Te%6,et=[ne,Ge,Se,Se,$e,ne][nt],Ze=[$e,ne,ne,Ge,Se,Se][nt],ht=[Se,Se,$e,ne,ne,Ge][nt];return{r:et*255,g:Ze*255,b:ht*255}}function I(de,ge,ne,Te){var we=[re(T(de).toString(16)),re(T(ge).toString(16)),re(T(ne).toString(16))];return Te&&we[0].charAt(0)==we[0].charAt(1)&&we[1].charAt(0)==we[1].charAt(1)&&we[2].charAt(0)==we[2].charAt(1)?we[0].charAt(0)+we[1].charAt(0)+we[2].charAt(0):we.join("")}function y(de,ge,ne,Te,we){var Se=[re(T(de).toString(16)),re(T(ge).toString(16)),re(T(ne).toString(16)),re(W(Te))];return we&&Se[0].charAt(0)==Se[0].charAt(1)&&Se[1].charAt(0)==Se[1].charAt(1)&&Se[2].charAt(0)==Se[2].charAt(1)&&Se[3].charAt(0)==Se[3].charAt(1)?Se[0].charAt(0)+Se[1].charAt(0)+Se[2].charAt(0)+Se[3].charAt(0):Se.join("")}function p(de,ge,ne,Te){var we=[re(W(Te)),re(T(de).toString(16)),re(T(ge).toString(16)),re(T(ne).toString(16))];return we.join("")}x.equals=function(de,ge){return!de||!ge?!1:x(de).toRgbString()==x(ge).toRgbString()},x.random=function(){return x.fromRatio({r:d(),g:d(),b:d()})};function g(de,ge){ge=ge===0?0:ge||10;var ne=x(de).toHsl();return ne.s-=ge/100,ne.s=V(ne.s),x(ne)}function C(de,ge){ge=ge===0?0:ge||10;var ne=x(de).toHsl();return ne.s+=ge/100,ne.s=V(ne.s),x(ne)}function P(de){return x(de).desaturate(100)}function F(de,ge){ge=ge===0?0:ge||10;var ne=x(de).toHsl();return ne.l+=ge/100,ne.l=V(ne.l),x(ne)}function U(de,ge){ge=ge===0?0:ge||10;var ne=x(de).toRgb();return ne.r=E(0,m(255,ne.r-T(255*-(ge/100)))),ne.g=E(0,m(255,ne.g-T(255*-(ge/100)))),ne.b=E(0,m(255,ne.b-T(255*-(ge/100)))),x(ne)}function B(de,ge){ge=ge===0?0:ge||10;var ne=x(de).toHsl();return ne.l-=ge/100,ne.l=V(ne.l),x(ne)}function L(de,ge){var ne=x(de).toHsl(),Te=(ne.h+ge)%360;return ne.h=Te<0?360+Te:Te,x(ne)}function z(de){var ge=x(de).toHsl();return ge.h=(ge.h+180)%360,x(ge)}function X(de){var ge=x(de).toHsl(),ne=ge.h;return[x(de),x({h:(ne+120)%360,s:ge.s,l:ge.l}),x({h:(ne+240)%360,s:ge.s,l:ge.l})]}function G(de){var ge=x(de).toHsl(),ne=ge.h;return[x(de),x({h:(ne+90)%360,s:ge.s,l:ge.l}),x({h:(ne+180)%360,s:ge.s,l:ge.l}),x({h:(ne+270)%360,s:ge.s,l:ge.l})]}function ee(de){var ge=x(de).toHsl(),ne=ge.h;return[x(de),x({h:(ne+72)%360,s:ge.s,l:ge.l}),x({h:(ne+216)%360,s:ge.s,l:ge.l})]}function $(de,ge,ne){ge=ge||6,ne=ne||30;var Te=x(de).toHsl(),we=360/ne,Se=[x(de)];for(Te.h=(Te.h-(we*ge>>1)+720)%360;--ge;)Te.h=(Te.h+we)%360,Se.push(x(Te));return Se}function fe(de,ge){ge=ge||6;for(var ne=x(de).toHsv(),Te=ne.h,we=ne.s,Se=ne.v,Ge=[],$e=1/ge;ge--;)Ge.push(x({h:Te,s:we,v:Se})),Se=(Se+$e)%1;return Ge}x.mix=function(de,ge,ne){ne=ne===0?0:ne||50;var Te=x(de).toRgb(),we=x(ge).toRgb(),Se=ne/100,Ge={r:(we.r-Te.r)*Se+Te.r,g:(we.g-Te.g)*Se+Te.g,b:(we.b-Te.b)*Se+Te.b,a:(we.a-Te.a)*Se+Te.a};return x(Ge)},x.readability=function(de,ge){var ne=x(de),Te=x(ge);return(u.max(ne.getLuminance(),Te.getLuminance())+.05)/(u.min(ne.getLuminance(),Te.getLuminance())+.05)},x.isReadable=function(de,ge,ne){var Te=x.readability(de,ge),we,Se;switch(Se=!1,we=De(ne),we.level+we.size){case"AAsmall":case"AAAlarge":Se=Te>=4.5;break;case"AAlarge":Se=Te>=3;break;case"AAAsmall":Se=Te>=7;break}return Se},x.mostReadable=function(de,ge,ne){var Te=null,we=0,Se,Ge,$e,nt;ne=ne||{},Ge=ne.includeFallbackColors,$e=ne.level,nt=ne.size;for(var et=0;et<ge.length;et++)Se=x.readability(de,ge[et]),Se>we&&(we=Se,Te=x(ge[et]));return x.isReadable(de,Te,{level:$e,size:nt})||!Ge?Te:(ne.includeFallbackColors=!1,x.mostReadable(de,["#fff","#000"],ne))};var me=x.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},ve=x.hexNames=be(me);function be(de){var ge={};for(var ne in de)de.hasOwnProperty(ne)&&(ge[de[ne]]=ne);return ge}function ie(de){return de=parseFloat(de),(isNaN(de)||de<0||de>1)&&(de=1),de}function se(de,ge){Z(de)&&(de="100%");var ne=le(de);return de=m(ge,E(0,parseFloat(de))),ne&&(de=parseInt(de*ge,10)/100),u.abs(de-ge)<1e-6?1:de%ge/parseFloat(ge)}function V(de){return m(1,E(0,de))}function K(de){return parseInt(de,16)}function Z(de){return typeof de=="string"&&de.indexOf(".")!=-1&&parseFloat(de)===1}function le(de){return typeof de=="string"&&de.indexOf("%")!=-1}function re(de){return de.length==1?"0"+de:""+de}function Q(de){return de<=1&&(de=de*100+"%"),de}function W(de){return u.round(parseFloat(de)*255).toString(16)}function Y(de){return K(de)/255}var q=function(){var de="[-\\+]?\\d+%?",ge="[-\\+]?\\d*\\.\\d+%?",ne="(?:"+ge+")|(?:"+de+")",Te="[\\s|\\(]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")\\s*\\)?",we="[\\s|\\(]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")[,|\\s]+("+ne+")\\s*\\)?";return{CSS_UNIT:new RegExp(ne),rgb:new RegExp("rgb"+Te),rgba:new RegExp("rgba"+we),hsl:new RegExp("hsl"+Te),hsla:new RegExp("hsla"+we),hsv:new RegExp("hsv"+Te),hsva:new RegExp("hsva"+we),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function ae(de){return!!q.CSS_UNIT.exec(de)}function pe(de){de=de.replace(f,"").replace(s,"").toLowerCase();var ge=!1;if(me[de])de=me[de],ge=!0;else if(de=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var ne;return(ne=q.rgb.exec(de))?{r:ne[1],g:ne[2],b:ne[3]}:(ne=q.rgba.exec(de))?{r:ne[1],g:ne[2],b:ne[3],a:ne[4]}:(ne=q.hsl.exec(de))?{h:ne[1],s:ne[2],l:ne[3]}:(ne=q.hsla.exec(de))?{h:ne[1],s:ne[2],l:ne[3],a:ne[4]}:(ne=q.hsv.exec(de))?{h:ne[1],s:ne[2],v:ne[3]}:(ne=q.hsva.exec(de))?{h:ne[1],s:ne[2],v:ne[3],a:ne[4]}:(ne=q.hex8.exec(de))?{r:K(ne[1]),g:K(ne[2]),b:K(ne[3]),a:Y(ne[4]),format:ge?"name":"hex8"}:(ne=q.hex6.exec(de))?{r:K(ne[1]),g:K(ne[2]),b:K(ne[3]),format:ge?"name":"hex"}:(ne=q.hex4.exec(de))?{r:K(ne[1]+""+ne[1]),g:K(ne[2]+""+ne[2]),b:K(ne[3]+""+ne[3]),a:Y(ne[4]+""+ne[4]),format:ge?"name":"hex8"}:(ne=q.hex3.exec(de))?{r:K(ne[1]+""+ne[1]),g:K(ne[2]+""+ne[2]),b:K(ne[3]+""+ne[3]),format:ge?"name":"hex"}:!1}function De(de){var ge,ne;return de=de||{level:"AA",size:"small"},ge=(de.level||"AA").toUpperCase(),ne=(de.size||"small").toLowerCase(),ge!=="AA"&&ge!=="AAA"&&(ge="AA"),ne!=="small"&&ne!=="large"&&(ne="small"),{level:ge,size:ne}}a.exports?a.exports=x:window.tinycolor=x})(Math)})(OP);var Gd=OP.exports,$n=(a,u,f)=>{var s=Od(a,"colors."+u,u),c=Gd(s).isValid();return c?s:f},SV=a=>u=>{var f=$n(u,a),s=Gd(f).isDark();return s?"dark":"light"},xV=a=>u=>SV(a)(u)==="dark",nc=(a,u)=>f=>{var s=$n(f,a);return Gd(s).setAlpha(u).toRgbString()};function MP(a,u){return a===void 0&&(a="1rem"),u===void 0&&(u="rgba(255, 255, 255, 0.15)"),{backgroundImage:`linear-gradient(
    45deg,
    `+u+` 25%,
    transparent 25%,
    transparent 50%,
    `+u+` 50%,
    `+u+` 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:a+" "+a}}function PV(a){var u=Gd.random().toHexString();return!a||JB(a)?u:a.string&&a.colors?CV(a.string,a.colors):a.string&&!a.colors?AV(a.string):a.colors&&!a.string?RV(a.colors):u}function AV(a){var u=0;if(a.length===0)return u.toString();for(var f=0;f<a.length;f+=1)u=a.charCodeAt(f)+((u<<5)-u),u=u&u;for(var s="#",c=0;c<3;c+=1){var T=u>>c*8&255;s+=("00"+T.toString(16)).substr(-2)}return s}function CV(a,u){var f=0;if(a.length===0)return u[0];for(var s=0;s<a.length;s+=1)f=a.charCodeAt(s)+((f<<5)-f),f=f&f;return f=(f%u.length+u.length)%u.length,u[f]}function RV(a){return a[Math.floor(Math.random()*a.length)]}function it(a,u){return f=>f.colorMode==="dark"?u:a}function Kl(a){var{orientation:u,vertical:f,horizontal:s}=a;return u?u==="vertical"?f:s:{}}function Pg(){return Pg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Pg.apply(this,arguments)}var OV=a=>(J_({condition:!0,message:["[chakra-ui]: createBreakpoints(...) will be deprecated pretty soon","simply pass the breakpoints as an object. Remove the createBreakpoint(..) call"].join("")}),Pg({base:"0em"},a));function Ba(a,u,f){return u in a?Object.defineProperty(a,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[u]=f,a}class MV{constructor(u){var f=this;this.name=u,Ba(this,"map",{}),Ba(this,"called",!1),Ba(this,"assert",()=>{if(!this.called){this.called=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}),Ba(this,"parts",function(){f.assert();for(var s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];for(var m of c)f.map[m]=f.toPart(m);return f}),Ba(this,"extend",function(){for(var s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];for(var m of c)m in f.map||(f.map[m]=f.toPart(m));return f}),Ba(this,"toPart",s=>{var c=["container","root"].includes(s??"")?[this.name]:[this.name,s],T=c.filter(Boolean).join("__"),m="chakra-"+T,E={className:m,selector:"."+m,toString:()=>s};return E}),Ba(this,"__type",{})}get selectors(){var u=Object.fromEntries(Object.entries(this.map).map(f=>{var[s,c]=f;return[s,c.selector]}));return u}get classNames(){var u=Object.fromEntries(Object.entries(this.map).map(f=>{var[s,c]=f;return[s,c.className]}));return u}get keys(){return Object.keys(this.map)}}function En(a){return new MV(a)}function IP(a){return Si(a)&&a.reference?a.reference:String(a)}var Wd=function(u){for(var f=arguments.length,s=new Array(f>1?f-1:0),c=1;c<f;c++)s[c-1]=arguments[c];return s.map(IP).join(" "+u+" ").replace(/calc/g,"")},DP=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+Wd("+",...f)+")"},wP=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+Wd("-",...f)+")"},Ag=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+Wd("*",...f)+")"},LP=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return"calc("+Wd("/",...f)+")"},NP=a=>{var u=IP(a);return u!=null&&!Number.isNaN(parseFloat(u))?String(u).startsWith("-")?String(u).slice(1):"-"+u:Ag(u,-1)},po=Object.assign(a=>({add:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return po(DP(a,...s))},subtract:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return po(wP(a,...s))},multiply:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return po(Ag(a,...s))},divide:function(){for(var f=arguments.length,s=new Array(f),c=0;c<f;c++)s[c]=arguments[c];return po(LP(a,...s))},negate:()=>po(NP(a)),toString:()=>a.toString()}),{add:DP,subtract:wP,multiply:Ag,divide:LP,negate:NP});function IV(a){return!Number.isInteger(parseFloat(a.toString()))}function DV(a,u){return u===void 0&&(u="-"),a.replace(/\s+/g,u)}function FP(a){var u=DV(a.toString());return u.includes("\\.")?a:IV(a)?u.replace(".","\\."):a}function wV(a,u){return u===void 0&&(u=""),[u,FP(a)].filter(Boolean).join("-")}function LV(a,u){return"var("+FP(a)+(u?", "+u:"")+")"}function NV(a,u){return u===void 0&&(u=""),"--"+wV(a,u)}function Hr(a,u){var f=NV(a,u==null?void 0:u.prefix);return{variable:f,reference:LV(f,FV(u==null?void 0:u.fallback))}}function FV(a){return typeof a=="string"?a:a==null?void 0:a.reference}var BV=En("accordion").parts("container","item","button","panel").extend("icon"),UV=En("alert").parts("title","description","container").extend("icon"),VV=En("avatar").parts("label","badge","container").extend("excessLabel","group"),kV=En("breadcrumb").parts("link","item").extend("separator");En("button").parts();var jV=En("checkbox").parts("control","icon").extend("label");En("progress").parts("track","filledTrack").extend("label");var zV=En("drawer").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),GV=En("editable").parts("preview","input"),WV=En("form").parts("container","requiredIndicator","helperText"),HV=En("formError").parts("text","icon"),XV=En("input").parts("addon","field","element"),YV=En("list").parts("container","item","icon"),KV=En("menu").parts("button","list","item").extend("groupTitle","command","divider"),QV=En("modal").parts("overlay","dialogContainer","dialog").extend("header","closeButton","body","footer"),qV=En("numberinput").parts("root","field","stepperGroup","stepper");En("pininput").parts("field");var ZV=En("popover").parts("content","header","body","footer").extend("popper","arrow"),$V=En("progress").parts("label","filledTrack","track"),JV=En("radio").parts("container","control","label"),ek=En("select").parts("field","icon"),tk=En("slider").parts("container","track","thumb","filledTrack"),nk=En("stat").parts("container","label","helpText","number","icon"),rk=En("switch").parts("container","track","thumb"),ik=En("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),ok=En("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),ak=En("tag").parts("container","label","closeButton"),sk={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},ck={transitionProperty:"common",transitionDuration:"normal",fontSize:"1rem",_focus:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:4,py:2},lk={pt:2,px:4,pb:5},uk={fontSize:"1.25em"},hk={container:sk,button:ck,panel:lk,icon:uk},dk={parts:BV.keys,baseStyle:hk},fk={container:{px:4,py:3},title:{fontWeight:"bold",lineHeight:6,marginEnd:2},description:{lineHeight:6},icon:{flexShrink:0,marginEnd:3,w:5,h:6}};function Cg(a){var{theme:u,colorScheme:f}=a,s=$n(u,f+".100",f),c=nc(f+".200",.16)(u);return it(s,c)(a)}var pk=a=>{var{colorScheme:u}=a;return{container:{bg:Cg(a)},icon:{color:it(u+".500",u+".200")(a)}}},mk=a=>{var{colorScheme:u}=a;return{container:{paddingStart:3,borderStartWidth:"4px",borderStartColor:it(u+".500",u+".200")(a),bg:Cg(a)},icon:{color:it(u+".500",u+".200")(a)}}},_k=a=>{var{colorScheme:u}=a;return{container:{pt:2,borderTopWidth:"4px",borderTopColor:it(u+".500",u+".200")(a),bg:Cg(a)},icon:{color:it(u+".500",u+".200")(a)}}},gk=a=>{var{colorScheme:u}=a;return{container:{bg:it(u+".500",u+".200")(a),color:it("white","gray.900")(a)}}},vk={subtle:pk,"left-accent":mk,"top-accent":_k,solid:gk},bk={variant:"subtle",colorScheme:"blue"},yk={parts:UV.keys,baseStyle:fk,variants:vk,defaultProps:bk},BP={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"};function Rg(){return Rg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Rg.apply(this,arguments)}var Tk={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem"},Ek={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Sk=Rg({},BP,Tk,{container:Ek}),UP=Sk,xk=a=>({transform:"translate(25%, 25%)",borderRadius:"full",border:"0.2em solid",borderColor:it("white","gray.800")(a)}),Pk=a=>({bg:it("gray.200","whiteAlpha.400")(a)}),Ak=a=>{var{name:u,theme:f}=a,s=u?PV({string:u}):"gray.400",c=xV(s)(f),T="white";c||(T="gray.800");var m=it("white","gray.800")(a);return{bg:s,color:T,borderColor:m,verticalAlign:"top"}},Ck=a=>({badge:xk(a),excessLabel:Pk(a),container:Ak(a)});function ra(a){var u=UP[a];return{container:{width:a,height:a,fontSize:"calc("+(u??a)+" / 2.5)"},excessLabel:{width:a,height:a},label:{fontSize:"calc("+(u??a)+" / 2.5)",lineHeight:a!=="100%"?u??a:void 0}}}var Rk={"2xs":ra("4"),xs:ra("6"),sm:ra("8"),md:ra("12"),lg:ra("16"),xl:ra("24"),"2xl":ra("32"),full:ra("100%")},Ok={size:"md"},Mk={parts:VV.keys,baseStyle:Ck,sizes:Rk,defaultProps:Ok},Ik={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold"},Dk=a=>{var{colorScheme:u,theme:f}=a,s=nc(u+".500",.6)(f);return{bg:it(u+".500",s)(a),color:it("white","whiteAlpha.800")(a)}},wk=a=>{var{colorScheme:u,theme:f}=a,s=nc(u+".200",.16)(f);return{bg:it(u+".100",s)(a),color:it(u+".800",u+".200")(a)}},Lk=a=>{var{colorScheme:u,theme:f}=a,s=nc(u+".200",.8)(f),c=$n(f,u+".500"),T=it(c,s)(a);return{color:T,boxShadow:"inset 0 0 0px 1px "+T}},Nk={solid:Dk,subtle:wk,outline:Lk},Fk={variant:"subtle",colorScheme:"gray"},Ql={baseStyle:Ik,variants:Nk,defaultProps:Fk},Bk={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},Uk={link:Bk},Vk={parts:kV.keys,baseStyle:Uk};function Og(){return Og=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Og.apply(this,arguments)}var kk={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},VP=a=>{var{colorScheme:u,theme:f}=a;if(u==="gray")return{color:it("inherit","whiteAlpha.900")(a),_hover:{bg:it("gray.100","whiteAlpha.200")(a)},_active:{bg:it("gray.200","whiteAlpha.300")(a)}};var s=nc(u+".200",.12)(f),c=nc(u+".200",.24)(f);return{color:it(u+".600",u+".200")(a),bg:"transparent",_hover:{bg:it(u+".50",s)(a)},_active:{bg:it(u+".100",c)(a)}}},jk=a=>{var{colorScheme:u}=a,f=it("gray.200","whiteAlpha.300")(a);return Og({border:"1px solid",borderColor:u==="gray"?f:"currentColor"},VP(a))},zk={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Gk=a=>{var u,{colorScheme:f}=a;if(f==="gray"){var s=it("gray.100","whiteAlpha.200")(a);return{bg:s,_hover:{bg:it("gray.200","whiteAlpha.300")(a),_disabled:{bg:s}},_active:{bg:it("gray.300","whiteAlpha.400")(a)}}}var{bg:c=f+".500",color:T="white",hoverBg:m=f+".600",activeBg:E=f+".700"}=(u=zk[f])!=null?u:{},d=it(c,f+".200")(a);return{bg:d,color:it(T,"gray.800")(a),_hover:{bg:it(m,f+".300")(a),_disabled:{bg:d}},_active:{bg:it(E,f+".400")(a)}}},Wk=a=>{var{colorScheme:u}=a;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:it(u+".500",u+".200")(a),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:it(u+".700",u+".500")(a)}}},Hk={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:0,p:0},Xk={ghost:VP,outline:jk,solid:Gk,link:Wk,unstyled:Hk},Yk={lg:{h:12,minW:12,fontSize:"lg",px:6},md:{h:10,minW:10,fontSize:"md",px:4},sm:{h:8,minW:8,fontSize:"sm",px:3},xs:{h:6,minW:6,fontSize:"xs",px:2}},Kk={variant:"solid",size:"md",colorScheme:"gray"},Qk={baseStyle:kk,variants:Xk,sizes:Yk,defaultProps:Kk},qk=a=>{var{colorScheme:u}=a;return{w:"100%",transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:it(u+".500",u+".200")(a),borderColor:it(u+".500",u+".200")(a),color:it("white","gray.900")(a),_hover:{bg:it(u+".600",u+".300")(a),borderColor:it(u+".600",u+".300")(a)},_disabled:{borderColor:it("gray.200","transparent")(a),bg:it("gray.200","whiteAlpha.300")(a),color:it("gray.500","whiteAlpha.500")(a)}},_indeterminate:{bg:it(u+".500",u+".200")(a),borderColor:it(u+".500",u+".200")(a),color:it("white","gray.900")(a)},_disabled:{bg:it("gray.100","whiteAlpha.100")(a),borderColor:it("gray.100","transparent")(a)},_focus:{boxShadow:"outline"},_invalid:{borderColor:it("red.500","red.300")(a)}}},Zk={userSelect:"none",_disabled:{opacity:.4}},$k={transitionProperty:"transform",transitionDuration:"normal"},Jk=a=>({icon:$k,control:qk(a),label:Zk}),e3={sm:{control:{h:3,w:3},label:{fontSize:"sm"},icon:{fontSize:"0.45rem"}},md:{control:{w:4,h:4},label:{fontSize:"md"},icon:{fontSize:"0.625rem"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"},icon:{fontSize:"0.625rem"}}},t3={size:"md",colorScheme:"blue"},Mg={parts:jV.keys,baseStyle:Jk,sizes:e3,defaultProps:t3},ql=Hr("close-button-size"),n3=a=>{var u=it("blackAlpha.100","whiteAlpha.100")(a),f=it("blackAlpha.200","whiteAlpha.200")(a);return{w:[ql.reference],h:[ql.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{bg:u},_active:{bg:f},_focus:{boxShadow:"outline"}}},r3={lg:{[ql.variable]:"40px",fontSize:"16px"},md:{[ql.variable]:"32px",fontSize:"12px"},sm:{[ql.variable]:"24px",fontSize:"10px"}},i3={size:"md"},o3={baseStyle:n3,sizes:r3,defaultProps:i3},{variants:a3,defaultProps:s3}=Ql,c3={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm"},l3={baseStyle:c3,variants:a3,defaultProps:s3},u3={w:"100%",mx:"auto",maxW:"60ch",px:"1rem"},h3={baseStyle:u3},d3={opacity:.6,borderColor:"inherit"},f3={borderStyle:"solid"},p3={borderStyle:"dashed"},m3={solid:f3,dashed:p3},_3={variant:"solid"},g3={baseStyle:d3,variants:m3,defaultProps:_3};function Ig(){return Ig=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Ig.apply(this,arguments)}function rc(a){return a==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:a}}}var v3={bg:"blackAlpha.600",zIndex:"overlay"},b3={display:"flex",zIndex:"modal",justifyContent:"center"},y3=a=>{var{isFullHeight:u}=a;return Ig({},u&&{height:"100vh"},{zIndex:"modal",maxH:"100vh",bg:it("white","gray.700")(a),color:"inherit",boxShadow:it("lg","dark-lg")(a)})},T3={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},E3={position:"absolute",top:2,insetEnd:3},S3={px:6,py:2,flex:1,overflow:"auto"},x3={px:6,py:4},P3=a=>({overlay:v3,dialogContainer:b3,dialog:y3(a),header:T3,closeButton:E3,body:S3,footer:x3}),A3={xs:rc("xs"),sm:rc("md"),md:rc("lg"),lg:rc("2xl"),xl:rc("4xl"),full:rc("full")},C3={size:"xs"},R3={parts:zV.keys,baseStyle:P3,sizes:A3,defaultProps:C3},O3={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal"},M3={borderRadius:"md",py:"3px",transitionProperty:"common",transitionDuration:"normal",width:"full",_focus:{boxShadow:"outline"},_placeholder:{opacity:.6}},I3={preview:O3,input:M3},D3={parts:GV.keys,baseStyle:I3},w3=a=>({marginStart:1,color:it("red.500","red.300")(a)}),L3=a=>({mt:2,color:it("gray.500","whiteAlpha.600")(a),lineHeight:"normal",fontSize:"sm"}),N3=a=>({container:{width:"100%",position:"relative"},requiredIndicator:w3(a),helperText:L3(a)}),F3={parts:WV.keys,baseStyle:N3},B3={fontSize:"md",marginEnd:3,mb:2,fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},U3={baseStyle:B3},V3={fontFamily:"heading",fontWeight:"bold"},k3={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},j3={size:"xl"},z3={baseStyle:V3,sizes:k3,defaultProps:j3},G3={field:{width:"100%",minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal"}},ia={lg:{fontSize:"lg",px:4,h:12,borderRadius:"md"},md:{fontSize:"md",px:4,h:10,borderRadius:"md"},sm:{fontSize:"sm",px:3,h:8,borderRadius:"sm"},xs:{fontSize:"xs",px:2,h:6,borderRadius:"sm"}},W3={lg:{field:ia.lg,addon:ia.lg},md:{field:ia.md,addon:ia.md},sm:{field:ia.sm,addon:ia.sm},xs:{field:ia.xs,addon:ia.xs}};function Dg(a){var{focusBorderColor:u,errorBorderColor:f}=a;return{focusBorderColor:u||it("blue.500","blue.300")(a),errorBorderColor:f||it("red.500","red.300")(a)}}var H3=a=>{var{theme:u}=a,{focusBorderColor:f,errorBorderColor:s}=Dg(a);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:it("gray.300","whiteAlpha.400")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:$n(u,s),boxShadow:"0 0 0 1px "+$n(u,s)},_focus:{zIndex:1,borderColor:$n(u,f),boxShadow:"0 0 0 1px "+$n(u,f)}},addon:{border:"1px solid",borderColor:it("inherit","whiteAlpha.50")(a),bg:it("gray.100","whiteAlpha.300")(a)}}},X3=a=>{var{theme:u}=a,{focusBorderColor:f,errorBorderColor:s}=Dg(a);return{field:{border:"2px solid",borderColor:"transparent",bg:it("gray.100","whiteAlpha.50")(a),_hover:{bg:it("gray.200","whiteAlpha.100")(a)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_disabled:{opacity:.4,cursor:"not-allowed"},_invalid:{borderColor:$n(u,s)},_focus:{bg:"transparent",borderColor:$n(u,f)}},addon:{border:"2px solid",borderColor:"transparent",bg:it("gray.100","whiteAlpha.50")(a)}}},Y3=a=>{var{theme:u}=a,{focusBorderColor:f,errorBorderColor:s}=Dg(a);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:$n(u,s),boxShadow:"0px 1px 0px 0px "+$n(u,s)},_focus:{borderColor:$n(u,f),boxShadow:"0px 1px 0px 0px "+$n(u,f)}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:0,px:0,bg:"transparent"}}},K3={field:{bg:"transparent",px:0,height:"auto"},addon:{bg:"transparent",px:0,height:"auto"}},Q3={outline:H3,filled:X3,flushed:Y3,unstyled:K3},q3={size:"md",variant:"outline"},Rn={parts:XV.keys,baseStyle:G3,sizes:W3,variants:Q3,defaultProps:q3},Z3=a=>({bg:it("gray.100","whiteAlpha")(a),borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"}),$3={baseStyle:Z3},J3={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focus:{boxShadow:"outline"}},ej={baseStyle:J3},tj={marginEnd:"0.5rem",display:"inline",verticalAlign:"text-bottom"},nj={container:{},item:{},icon:tj},rj={parts:YV.keys,baseStyle:nj},ij=a=>({bg:it("#fff","gray.700")(a),boxShadow:it("sm","dark-lg")(a),color:"inherit",minW:"3xs",py:"2",zIndex:1,borderRadius:"md",borderWidth:"1px"}),oj=a=>({py:"0.4rem",px:"0.8rem",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{bg:it("gray.100","whiteAlpha.100")(a)},_active:{bg:it("gray.200","whiteAlpha.200")(a)},_expanded:{bg:it("gray.100","whiteAlpha.100")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),aj={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},sj={opacity:.6},cj={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"0.5rem",opacity:.6},lj={transitionProperty:"common",transitionDuration:"normal"},uj=a=>({button:lj,list:ij(a),item:oj(a),groupTitle:aj,command:sj,divider:cj}),hj={parts:KV.keys,baseStyle:uj},dj={bg:"blackAlpha.600",zIndex:"modal"},fj=a=>{var{isCentered:u,scrollBehavior:f}=a;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:u?"center":"flex-start",overflow:f==="inside"?"hidden":"auto"}},pj=a=>{var{scrollBehavior:u}=a;return{borderRadius:"md",bg:it("white","gray.700")(a),color:"inherit",my:"3.75rem",zIndex:"modal",maxH:u==="inside"?"calc(100% - 7.5rem)":void 0,boxShadow:it("lg","dark-lg")(a)}},mj={px:6,py:4,fontSize:"xl",fontWeight:"semibold"},_j={position:"absolute",top:2,insetEnd:3},gj=a=>{var{scrollBehavior:u}=a;return{px:6,py:2,flex:1,overflow:u==="inside"?"auto":void 0}},vj={px:6,py:4},bj=a=>({overlay:dj,dialogContainer:fj(a),dialog:pj(a),header:mj,closeButton:_j,body:gj(a),footer:vj});function Pi(a){return a==="full"?{dialog:{maxW:"100vw",minH:"100vh",my:0}}:{dialog:{maxW:a}}}var yj={xs:Pi("xs"),sm:Pi("sm"),md:Pi("md"),lg:Pi("lg"),xl:Pi("xl"),"2xl":Pi("2xl"),"3xl":Pi("3xl"),"4xl":Pi("4xl"),"5xl":Pi("5xl"),"6xl":Pi("6xl"),full:Pi("full")},Tj={size:"md"},Ej={parts:QV.keys,baseStyle:bj,sizes:yj,defaultProps:Tj},Sj={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2","3":".75rem","4":"1rem","5":"1.25rem","6":"1.5rem","7":"1.75rem","8":"2rem","9":"2.25rem","10":"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},kP=Sj,jP,zP;function wg(){return wg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},wg.apply(this,arguments)}var{variants:xj,defaultProps:Pj}=Rn,Lg=Hr("number-input-stepper-width"),GP=Hr("number-input-input-padding"),Aj=po(Lg).add("0.5rem").toString(),Cj={[Lg.variable]:"24px",[GP.variable]:Aj},Rj=(jP=(zP=Rn.baseStyle)==null?void 0:zP.field)!=null?jP:{},Oj={width:[Lg.reference]},Mj=a=>({borderStart:"1px solid",borderStartColor:it("inherit","whiteAlpha.300")(a),color:it("inherit","whiteAlpha.800")(a),_active:{bg:it("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}),Ij=a=>({root:Cj,field:Rj,stepperGroup:Oj,stepper:Mj(a)});function Hd(a){var u,f,s=Rn.sizes[a],c={lg:"md",md:"md",sm:"sm",xs:"sm"},T=(u=(f=s.field)==null?void 0:f.fontSize)!=null?u:"md",m=kP.fontSizes[T.toString()];return{field:wg({},s.field,{paddingInlineEnd:GP.reference,verticalAlign:"top"}),stepper:{fontSize:po(m).multiply(.75).toString(),_first:{borderTopEndRadius:c[a]},_last:{borderBottomEndRadius:c[a],mt:"-1px",borderTopWidth:1}}}}var Dj={xs:Hd("xs"),sm:Hd("sm"),md:Hd("md"),lg:Hd("lg")},wj={parts:qV.keys,baseStyle:Ij,sizes:Dj,variants:xj,defaultProps:Pj},WP;function Ng(){return Ng=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Ng.apply(this,arguments)}var Lj=Ng({},Rn.baseStyle.field,{textAlign:"center"}),Nj={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}},Fj={outline:a=>{var u;return(u=Rn.variants.outline(a).field)!=null?u:{}},flushed:a=>{var u;return(u=Rn.variants.flushed(a).field)!=null?u:{}},filled:a=>{var u;return(u=Rn.variants.filled(a).field)!=null?u:{}},unstyled:(WP=Rn.variants.unstyled.field)!=null?WP:{}},Bj=Rn.defaultProps,Uj={baseStyle:Lj,sizes:Nj,variants:Fj,defaultProps:Bj},Fg=Hr("popper-bg"),Vj=Hr("popper-arrow-bg"),kj=Hr("popper-arrow-shadow-color"),jj={zIndex:10},zj=a=>{var u=it("white","gray.700")(a),f=it("gray.200","whiteAlpha.300")(a);return{[Fg.variable]:"colors."+u,bg:Fg.reference,[Vj.variable]:Fg.reference,[kj.variable]:"colors."+f,width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focus:{outline:0,boxShadow:"outline"}}},Gj={px:3,py:2,borderBottomWidth:"1px"},Wj={px:3,py:2},Hj={px:3,py:2,borderTopWidth:"1px"},Xj=a=>({popper:jj,content:zj(a),header:Gj,body:Wj,footer:Hj,arrow:{}}),Yj={parts:ZV.keys,baseStyle:Xj};function Xd(){return Xd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Xd.apply(this,arguments)}function Kj(a){var{colorScheme:u,theme:f,isIndeterminate:s,hasStripe:c}=a,T=it(MP(),MP("1rem","rgba(0,0,0,0.1)"))(a),m=it(u+".500",u+".200")(a),E=`linear-gradient(
    to right,
    transparent 0%,
    `+$n(f,m)+` 50%,
    transparent 100%
  )`,d=!s&&c;return Xd({},d&&T,s?{bgImage:E}:{bgColor:m})}var Qj={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},qj=a=>({bg:it("gray.100","whiteAlpha.300")(a)}),Zj=a=>Xd({transitionProperty:"common",transitionDuration:"slow"},Kj(a)),$j=a=>({label:Qj,filledTrack:Zj(a),track:qj(a)}),Jj={xs:{track:{h:"0.25rem"}},sm:{track:{h:"0.5rem"}},md:{track:{h:"0.75rem"}},lg:{track:{h:"1rem"}}},ez={size:"md",colorScheme:"blue"},tz={parts:$V.keys,sizes:Jj,baseStyle:$j,defaultProps:ez};function Yd(){return Yd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Yd.apply(this,arguments)}var nz=a=>{var{control:u={}}=Mg.baseStyle(a);return Yd({},u,{borderRadius:"full",_checked:Yd({},u._checked,{_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}})})},rz=a=>({label:Mg.baseStyle(a).label,control:nz(a)}),iz={md:{control:{w:4,h:4},label:{fontSize:"md"}},lg:{control:{w:5,h:5},label:{fontSize:"lg"}},sm:{control:{width:3,height:3},label:{fontSize:"sm"}}},oz={size:"md",colorScheme:"blue"},az={parts:JV.keys,baseStyle:rz,sizes:iz,defaultProps:oz};function Zl(){return Zl=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Zl.apply(this,arguments)}var sz=a=>Zl({},Rn.baseStyle.field,{bg:it("white","gray.700")(a),appearance:"none",paddingBottom:"1px",lineHeight:"normal","> option, > optgroup":{bg:it("white","gray.700")(a)}}),cz={width:"1.5rem",height:"100%",insetEnd:"0.5rem",position:"relative",color:"currentColor",fontSize:"1.25rem",_disabled:{opacity:.5}},lz=a=>({field:sz(a),icon:cz}),uz=Zl({},Rn.sizes,{xs:Zl({},Rn.sizes.xs,{icon:{insetEnd:"0.25rem"}})}),hz={parts:ek.keys,baseStyle:lz,sizes:uz,variants:Rn.variants,defaultProps:Rn.defaultProps},dz=(a,u)=>H_({from:{borderColor:a,background:a},to:{borderColor:u,background:u}}),fz=a=>{var u=it("gray.100","gray.800")(a),f=it("gray.400","gray.600")(a),{startColor:s=u,endColor:c=f,speed:T,theme:m}=a,E=$n(m,s),d=$n(m,c);return{opacity:.7,borderRadius:"2px",borderColor:E,background:d,animation:T+"s linear infinite alternate "+dz(E,d)}},pz={baseStyle:fz},mz=a=>({borderRadius:"md",fontWeight:"semibold",_focus:{boxShadow:"outline",padding:"1rem",position:"fixed",top:"1.5rem",insetStart:"1.5rem",bg:it("white","gray.700")(a)}}),_z={baseStyle:mz};function Kd(){return Kd=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Kd.apply(this,arguments)}function gz(a){return Kl({orientation:a.orientation,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}})}var vz=a=>{var{orientation:u}=a;return Kd({_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"}},Kl({orientation:u,vertical:{h:"100%"},horizontal:{w:"100%"}}))},bz=a=>({borderRadius:"sm",bg:it("gray.200","whiteAlpha.200")(a),_disabled:{bg:it("gray.300","whiteAlpha.300")(a)}}),yz=a=>Kd({zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focus:{boxShadow:"outline"},_disabled:{bg:"gray.300"}},gz(a)),Tz=a=>{var{colorScheme:u}=a;return{bg:it(u+".500",u+".200")(a)}},Ez=a=>({container:vz(a),track:bz(a),thumb:yz(a),filledTrack:Tz(a)}),Sz=a=>({thumb:{w:"16px",h:"16px"},track:Kl({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),xz=a=>({thumb:{w:"14px",h:"14px"},track:Kl({orientation:a.orientation,horizontal:{h:"4px"},vertical:{w:"4px"}})}),Pz=a=>({thumb:{w:"10px",h:"10px"},track:Kl({orientation:a.orientation,horizontal:{h:"2px"},vertical:{w:"2px"}})}),Az={lg:Sz,md:xz,sm:Pz},Cz={size:"md",colorScheme:"blue"},Rz={parts:tk.keys,sizes:Az,baseStyle:Ez,defaultProps:Cz},Ua=Hr("spinner-size"),Oz={width:[Ua.reference],height:[Ua.reference]},Mz={xs:{[Ua.variable]:"0.75rem"},sm:{[Ua.variable]:"1rem"},md:{[Ua.variable]:"1.5rem"},lg:{[Ua.variable]:"2rem"},xl:{[Ua.variable]:"3rem"}},Iz={size:"md"},Dz={baseStyle:Oz,sizes:Mz,defaultProps:Iz},wz={fontWeight:"medium"},Lz={opacity:.8,marginBottom:2},Nz={verticalAlign:"baseline",fontWeight:"semibold"},Fz={marginEnd:1,w:"14px",h:"14px",verticalAlign:"middle"},Bz={container:{},label:wz,helpText:Lz,number:Nz,icon:Fz},Uz={md:{label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}}},Vz={size:"md"},kz={parts:nk.keys,baseStyle:Bz,sizes:Uz,defaultProps:Vz},$l=Hr("switch-track-width"),Va=Hr("switch-track-height"),Bg=Hr("switch-track-diff"),jz=po.subtract($l,Va),Ug=Hr("switch-thumb-x"),zz=a=>{var{colorScheme:u}=a;return{borderRadius:"full",p:"2px",width:[$l.reference],height:[Va.reference],transitionProperty:"common",transitionDuration:"fast",bg:it("gray.300","whiteAlpha.400")(a),_focus:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{bg:it(u+".500",u+".200")(a)}}},Gz={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Va.reference],height:[Va.reference],_checked:{transform:"translateX("+Ug.reference+")"}},Wz=a=>({container:{[Bg.variable]:jz,[Ug.variable]:Bg.reference,_rtl:{[Ug.variable]:po(Bg).negate().toString()}},track:zz(a),thumb:Gz}),Hz={sm:{container:{[$l.variable]:"1.375rem",[Va.variable]:"0.75rem"}},md:{container:{[$l.variable]:"1.875rem",[Va.variable]:"1rem"}},lg:{container:{[$l.variable]:"2.875rem",[Va.variable]:"1.5rem"}}},Xz={size:"md",colorScheme:"blue"},Yz={parts:rk.keys,baseStyle:Wz,sizes:Hz,defaultProps:Xz};function ic(){return ic=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},ic.apply(this,arguments)}var Kz={table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}},Qd={"&[data-is-numeric=true]":{textAlign:"end"}},Qz=a=>{var{colorScheme:u}=a;return{th:ic({color:it("gray.600","gray.400")(a),borderBottom:"1px",borderColor:it(u+".100",u+".700")(a)},Qd),td:ic({borderBottom:"1px",borderColor:it(u+".100",u+".700")(a)},Qd),caption:{color:it("gray.600","gray.100")(a)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},qz=a=>{var{colorScheme:u}=a;return{th:ic({color:it("gray.600","gray.400")(a),borderBottom:"1px",borderColor:it(u+".100",u+".700")(a)},Qd),td:ic({borderBottom:"1px",borderColor:it(u+".100",u+".700")(a)},Qd),caption:{color:it("gray.600","gray.100")(a)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:it(u+".100",u+".700")(a)},td:{background:it(u+".100",u+".700")(a)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}},Zz={simple:Qz,striped:qz,unstyled:{}},$z={sm:{th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}},md:{th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}},lg:{th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}}},Jz={variant:"simple",size:"md",colorScheme:"gray"},eG={parts:ik.keys,baseStyle:Kz,variants:Zz,sizes:$z,defaultProps:Jz},tG=a=>{var{orientation:u}=a;return{display:u==="vertical"?"flex":"block"}},nG=a=>{var{isFitted:u}=a;return{flex:u?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focus:{zIndex:1,boxShadow:"outline"}}},rG=a=>{var{align:u="start",orientation:f}=a,s={end:"flex-end",center:"center",start:"flex-start"};return{justifyContent:s[u],flexDirection:f==="vertical"?"column":"row"}},iG={p:4},oG=a=>({root:tG(a),tab:nG(a),tablist:rG(a),tabpanel:iG}),aG={sm:{tab:{py:1,px:4,fontSize:"sm"}},md:{tab:{fontSize:"md",py:2,px:4}},lg:{tab:{fontSize:"lg",py:3,px:4}}},sG=a=>{var{colorScheme:u,orientation:f}=a,s=f==="vertical",c=f==="vertical"?"borderStart":"borderBottom",T=s?"marginStart":"marginBottom";return{tablist:{[c]:"2px solid",borderColor:"inherit"},tab:{[c]:"2px solid",borderColor:"transparent",[T]:"-2px",_selected:{color:it(u+".600",u+".300")(a),borderColor:"currentColor"},_active:{bg:it("gray.200","whiteAlpha.300")(a)},_disabled:{opacity:.4,cursor:"not-allowed"}}}},cG=a=>{var{colorScheme:u}=a;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",_selected:{color:it(u+".600",u+".300")(a),borderColor:"inherit",borderBottomColor:it("white","gray.800")(a)}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},lG=a=>{var{colorScheme:u}=a;return{tab:{border:"1px solid",borderColor:"inherit",bg:it("gray.50","whiteAlpha.50")(a),mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{bg:it("#fff","gray.800")(a),color:it(u+".600",u+".300")(a),borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"}},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}},uG=a=>{var{colorScheme:u,theme:f}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:$n(f,u+".700"),bg:$n(f,u+".100")}}}},hG=a=>{var{colorScheme:u}=a;return{tab:{borderRadius:"full",fontWeight:"semibold",color:it("gray.600","inherit")(a),_selected:{color:it("#fff","gray.800")(a),bg:it(u+".600",u+".300")(a)}}}},dG={},fG={line:sG,enclosed:cG,"enclosed-colored":lG,"soft-rounded":uG,"solid-rounded":hG,unstyled:dG},pG={size:"md",variant:"line",colorScheme:"blue"},mG={parts:ok.keys,baseStyle:oG,sizes:aG,variants:fG,defaultProps:pG},_G={fontWeight:"medium",lineHeight:1.2,outline:0,_focus:{boxShadow:"outline"}},gG={lineHeight:1.2,overflow:"visible"},vG={fontSize:"18px",w:"1.25rem",h:"1.25rem",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"0.375rem",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focus:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},bG={container:_G,label:gG,closeButton:vG},yG={sm:{container:{minH:"1.25rem",minW:"1.25rem",fontSize:"xs",px:2,borderRadius:"md"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}},md:{container:{minH:"1.5rem",minW:"1.5rem",fontSize:"sm",borderRadius:"md",px:2}},lg:{container:{minH:8,minW:8,fontSize:"md",borderRadius:"md",px:3}}},TG={subtle:a=>({container:Ql.variants.subtle(a)}),solid:a=>({container:Ql.variants.solid(a)}),outline:a=>({container:Ql.variants.outline(a)})},EG={size:"md",variant:"subtle",colorScheme:"gray"},SG={parts:ak.keys,variants:TG,baseStyle:bG,sizes:yG,defaultProps:EG},HP,XP,YP,KP,QP;function Vg(){return Vg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Vg.apply(this,arguments)}var xG=Vg({},Rn.baseStyle.field,{paddingY:"8px",minHeight:"80px",lineHeight:"short",verticalAlign:"top"}),PG={outline:a=>{var u;return(u=Rn.variants.outline(a).field)!=null?u:{}},flushed:a=>{var u;return(u=Rn.variants.flushed(a).field)!=null?u:{}},filled:a=>{var u;return(u=Rn.variants.filled(a).field)!=null?u:{}},unstyled:(HP=Rn.variants.unstyled.field)!=null?HP:{}},AG={xs:(XP=Rn.sizes.xs.field)!=null?XP:{},sm:(YP=Rn.sizes.sm.field)!=null?YP:{},md:(KP=Rn.sizes.md.field)!=null?KP:{},lg:(QP=Rn.sizes.lg.field)!=null?QP:{}},CG={size:"md",variant:"outline"},RG={baseStyle:xG,sizes:AG,variants:PG,defaultProps:CG},kg=Hr("tooltip-bg"),OG=Hr("popper-arrow-bg"),MG=a=>{var u=it("gray.700","gray.300")(a);return{[kg.variable]:"colors."+u,px:"8px",py:"2px",bg:[kg.reference],[OG.variable]:[kg.reference],color:it("whiteAlpha.900","gray.900")(a),borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"320px",zIndex:"tooltip"}},IG={baseStyle:MG},DG=a=>({color:it("red.500","red.300")(a),mt:2,fontSize:"sm"}),wG=a=>({marginEnd:"0.5em",color:it("red.500","red.300")(a)}),LG=a=>({text:DG(a),icon:wG(a)}),NG={parts:HV.keys,baseStyle:LG},FG={Accordion:dk,Alert:yk,Avatar:Mk,Badge:Ql,Breadcrumb:Vk,Button:Qk,Checkbox:Mg,CloseButton:o3,Code:l3,Container:h3,Divider:g3,Drawer:R3,Editable:D3,Form:F3,FormLabel:U3,Heading:z3,Input:Rn,Kbd:$3,Link:ej,List:rj,Menu:hj,Modal:Ej,NumberInput:wj,PinInput:Uj,Popover:Yj,Progress:tz,Radio:az,Select:hz,Skeleton:pz,SkipLink:_z,Slider:Rz,Spinner:Dz,Stat:kz,Switch:Yz,Table:eG,Tabs:mG,Tag:SG,Textarea:RG,Tooltip:IG,FormError:NG},BG={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},UG=BG,VG=OV({sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"}),kG=VG,jG={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"},linkedin:{50:"#E8F4F9",100:"#CFEDFB",200:"#9BDAF3",300:"#68C7EC",400:"#34B3E4",500:"#00A0DC",600:"#008CC9",700:"#0077B5",800:"#005E93",900:"#004471"},facebook:{50:"#E8F4F9",100:"#D9DEE9",200:"#B7C2DA",300:"#6482C0",400:"#4267B2",500:"#385898",600:"#314E89",700:"#29487D",800:"#223B67",900:"#1E355B"},messenger:{50:"#D0E6FF",100:"#B9DAFF",200:"#A2CDFF",300:"#7AB8FF",400:"#2E90FF",500:"#0078FF",600:"#0063D1",700:"#0052AC",800:"#003C7E",900:"#002C5C"},whatsapp:{50:"#dffeec",100:"#b9f5d0",200:"#90edb3",300:"#65e495",400:"#3cdd78",500:"#22c35e",600:"#179848",700:"#0c6c33",800:"#01421c",900:"#001803"},twitter:{50:"#E5F4FD",100:"#C8E9FB",200:"#A8DCFA",300:"#83CDF7",400:"#57BBF5",500:"#1DA1F2",600:"#1A94DA",700:"#1681BF",800:"#136B9E",900:"#0D4D71"},telegram:{50:"#E3F2F9",100:"#C5E4F3",200:"#A2D4EC",300:"#7AC1E4",400:"#47A9DA",500:"#0088CC",600:"#007AB8",700:"#006BA1",800:"#005885",900:"#003F5E"}},zG=jG,GG={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},WG=GG,HG={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},XG=HG,YG={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},KG={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},QG={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},qG={property:YG,easing:KG,duration:QG},ZG=qG,$G={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},JG=$G,e4={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},t4=e4;function jg(){return jg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},jg.apply(this,arguments)}var n4=jg({breakpoints:kG,zIndices:JG,radii:WG,blur:t4,colors:zG},kP,{sizes:UP,shadows:XG,space:BP,borders:UG,transition:ZG}),r4=n4,i4={global:a=>({body:{fontFamily:"body",color:it("gray.800","whiteAlpha.900")(a),bg:it("white","gray.800")(a),transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:it("gray.400","whiteAlpha.400")(a)},"*, *::before, &::after":{borderColor:it("gray.200","whiteAlpha.300")(a),wordWrap:"break-word"}})},o4=i4;function zg(){return zg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},zg.apply(this,arguments)}var a4="ltr",s4={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},c4=zg({direction:a4},r4,{components:FG,styles:o4,config:s4}),l4=c4,qP=EV;qP.defaultProps={theme:l4};function Jl(){return Jl=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Jl.apply(this,arguments)}function u4(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var ZP={path:Ye("g",{stroke:"currentColor",strokeWidth:"1.5"},Ye("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),Ye("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),Ye("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})),viewBox:"0 0 24 24"},eu=Sn((a,u)=>{var{as:f,viewBox:s,color:c="currentColor",focusable:T=!1,children:m,className:E,__css:d}=a,x=u4(a,["as","viewBox","color","focusable","children","className","__css"]),M=Hn("chakra-icon",E),w=Jl({w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:c},d),S={ref:u,focusable:T,className:M,__css:w},_=s??ZP.viewBox;if(f&&typeof f!="string")return Ye(qt.svg,Jl({as:f},S,x));var O=m??ZP.path;return Ye(qt.svg,Jl({verticalAlign:"middle",viewBox:_},S,x),O)});function Gg(){return Gg=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Gg.apply(this,arguments)}function tu(a){var{viewBox:u="0 0 24 24",d:f,path:s,displayName:c,defaultProps:T={}}=a,m=Sn((E,d)=>Ye(eu,Gg({ref:d,viewBox:u},T,E),s??Ye("path",{fill:"currentColor",d:f})));return m}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Wg=function(a,u){return Wg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,s){f.__proto__=s}||function(f,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(f[c]=s[c])},Wg(a,u)};function $P(a,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");Wg(a,u);function f(){this.constructor=a}a.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)}var st=function(){return st=Object.assign||function(u){for(var f,s=1,c=arguments.length;s<c;s++){f=arguments[s];for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(u[T]=f[T])}return u},st.apply(this,arguments)};function Xr(a,u){var f={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(f[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(f[s[c]]=a[s[c]]);return f}function wn(a,u){var f=typeof Symbol=="function"&&a[Symbol.iterator];if(!f)return a;var s=f.call(a),c,T=[],m;try{for(;(u===void 0||u-- >0)&&!(c=s.next()).done;)T.push(c.value)}catch(E){m={error:E}}finally{try{c&&!c.done&&(f=s.return)&&f.call(s)}finally{if(m)throw m.error}}return T}function Ar(a,u,f){if(f||arguments.length===2)for(var s=0,c=u.length,T;s<c;s++)(T||!(s in u))&&(T||(T=Array.prototype.slice.call(u,0,s)),T[s]=u[s]);return a.concat(T||Array.prototype.slice.call(u))}var mo=function(a){return{isEnabled:function(u){return a.some(function(f){return!!u[f]})}}},Hg={measureLayout:mo(["layout","layoutId","drag","_layoutResetTransform"]),animation:mo(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag"]),exit:mo(["exit"]),drag:mo(["drag","dragControls"]),focus:mo(["whileFocus"]),hover:mo(["whileHover","onHoverStart","onHoverEnd"]),tap:mo(["whileTap","onTap","onTapStart","onTapCancel"]),pan:mo(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),layoutAnimation:mo(["layout","layoutId"])};function h4(a){for(var u in a){var f=a[u];f!==null&&(Hg[u].Component=f)}}var nu=function(){},JP=fr({strict:!1}),eA=Object.keys(Hg),d4=eA.length;function f4(a,u,f){var s=[];if(Jt(JP),!u)return null;for(var c=0;c<d4;c++){var T=eA[c],m=Hg[T],E=m.isEnabled,d=m.Component;E(a)&&d&&s.push(Ye(d,st({key:T},a,{visualElement:u})))}return s}var qd=fr({transformPagePoint:function(a){return a},isStatic:!1}),Zd=fr({});function p4(){return Jt(Zd).visualElement}var ru=fr(null);function iu(a){var u=Nt(null);return u.current===null&&(u.current=a()),u.current}function Xg(){var a=Jt(ru);if(a===null)return[!0,null];var u=a.isPresent,f=a.onExitComplete,s=a.register,c=v4();Ut(function(){return s(c)},[]);var T=function(){return f==null?void 0:f(c)};return!u&&f?[!1,T]:[!0]}function m4(a){return a===null?!0:a.isPresent}var _4=0,g4=function(){return _4++},v4=function(){return iu(g4)},b4=fr(null),ou=typeof window!="undefined",tA=ou?Ko:Ut;function y4(a){var u=a.layoutId,f=Jt(b4);return f&&u!==void 0?f+"-"+u:u}function T4(a,u,f,s){var c=Jt(qd),T=Jt(JP),m=p4(),E=Jt(ru),d=y4(f),x=Nt(void 0);s||(s=T.renderer),!x.current&&s&&(x.current=s(a,{visualState:u,parent:m,props:st(st({},f),{layoutId:d}),presenceId:E==null?void 0:E.id,blockInitialAnimation:(E==null?void 0:E.initial)===!1}));var M=x.current;return tA(function(){!M||(M.setProps(st(st(st({},c),f),{layoutId:d})),M.isPresent=m4(E),M.isPresenceRoot=!m||m.presenceId!==(E==null?void 0:E.id),M.syncRender())}),Ut(function(){var w;!M||(w=M.animationState)===null||w===void 0||w.animateChanges()}),tA(function(){return function(){return M==null?void 0:M.notifyUnmount()}},[]),M}function Yg(a){return typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"current")}function E4(a,u,f){return Vt(function(s){var c;s&&((c=a.mount)===null||c===void 0||c.call(a,s)),u&&(s?u.mount(s):u.unmount()),f&&(typeof f=="function"?f(s):Yg(f)&&(f.current=s))},[u])}function nA(a){return Array.isArray(a)}function Ai(a){return typeof a=="string"||nA(a)}function S4(a){var u={};return a.forEachValue(function(f,s){return u[s]=f.get()}),u}function x4(a){var u={};return a.forEachValue(function(f,s){return u[s]=f.getVelocity()}),u}function rA(a,u,f,s,c){var T;return s===void 0&&(s={}),c===void 0&&(c={}),typeof u=="string"&&(u=(T=a.variants)===null||T===void 0?void 0:T[u]),typeof u=="function"?u(f??a.custom,s,c):u}function $d(a,u,f){var s=a.getProps();return rA(s,u,f??s.custom,S4(a),x4(a))}function Jd(a){var u;return typeof((u=a.animate)===null||u===void 0?void 0:u.start)=="function"||Ai(a.initial)||Ai(a.animate)||Ai(a.whileHover)||Ai(a.whileDrag)||Ai(a.whileTap)||Ai(a.whileFocus)||Ai(a.exit)}function iA(a){return Boolean(Jd(a)||a.variants)}function P4(a,u){if(Jd(a)){var f=a.initial,s=a.animate;return{initial:f===!1||Ai(f)?f:void 0,animate:Ai(s)?s:void 0}}return a.inherit!==!1?u:{}}function A4(a,u){var f=P4(a,Jt(Zd)),s=f.initial,c=f.animate;return Dn(function(){return{initial:s,animate:c}},u?[oA(s),oA(c)]:[])}function oA(a){return Array.isArray(a)?a.join(" "):a}function C4(a){var u=a.preloadedFeatures,f=a.createVisualElement,s=a.useRender,c=a.useVisualState,T=a.Component;u&&h4(u);function m(E,d){var x=Jt(qd).isStatic,M=null,w=A4(E,x),S=c(E,x);return!x&&ou&&(w.visualElement=T4(T,S,E,f),M=f4(E,w.visualElement)),Ye(qn,null,Ye(Zd.Provider,{value:w},s(T,E,E4(S,w.visualElement,d),S,x)),M)}return bi(m)}function R4(a){function u(s,c){return c===void 0&&(c={}),C4(a(s,c))}var f=new Map;return new Proxy(u,{get:function(s,c){return f.has(c)||f.set(c,u(c)),f.get(c)}})}var O4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","svg","switch","symbol","text","tspan","use","view"];function Kg(a){return typeof a!="string"||a.includes("-")?!1:!!(O4.indexOf(a)>-1||/[A-Z]/.test(a))}var au={};function M4(a){for(var u in a)au[u]=a[u]}var I4=["","X","Y","Z"],D4=["translate","scale","rotate","skew"],su=["transformPerspective","x","y","z"];D4.forEach(function(a){return I4.forEach(function(u){return su.push(a+u)})});function w4(a,u){return su.indexOf(a)-su.indexOf(u)}var L4=new Set(su);function ef(a){return L4.has(a)}var N4=new Set(["originX","originY","originZ"]);function aA(a){return N4.has(a)}function sA(a,u){var f=u.layout,s=u.layoutId;return ef(a)||aA(a)||(f||s!==void 0)&&(!!au[a]||a==="opacity")}var oa=function(a){return a!==null&&typeof a=="object"&&a.getVelocity},F4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"};function B4(a,u,f,s){var c=a.transform,T=a.transformKeys,m=u.enableHardwareAcceleration,E=m===void 0?!0:m,d=u.allowTransformNone,x=d===void 0?!0:d,M="";T.sort(w4);for(var w=!1,S=T.length,_=0;_<S;_++){var O=T[_];M+=(F4[O]||O)+"("+c[O]+") ",O==="z"&&(w=!0)}return!w&&E?M+="translateZ(0)":M=M.trim(),s?M=s(c,f?"":M):x&&f&&(M="none"),M}function U4(a){var u=a.originX,f=u===void 0?"50%":u,s=a.originY,c=s===void 0?"50%":s,T=a.originZ,m=T===void 0?0:T;return f+" "+c+" "+m}function cA(a){return a.startsWith("--")}var V4=function(a,u){return u&&typeof a=="number"?u.transform(a):a},lA=function(a,u){return function(f){return Math.max(Math.min(f,u),a)}},cu=function(a){return a%1?Number(a.toFixed(5)):a},lu=/(-)?([\d]*\.?[\d])+/g,Qg=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,k4=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function uu(a){return typeof a=="string"}var ka={test:function(a){return typeof a=="number"},parse:parseFloat,transform:function(a){return a}},hu=st(st({},ka),{transform:lA(0,1)}),tf=st(st({},ka),{default:1}),du=function(a){return{test:function(u){return uu(u)&&u.endsWith(a)&&u.split(" ").length===1},parse:parseFloat,transform:function(u){return""+u+a}}},aa=du("deg"),oc=du("%"),wt=du("px"),j4=du("vh"),z4=du("vw"),uA=st(st({},oc),{parse:function(a){return oc.parse(a)/100},transform:function(a){return oc.transform(a*100)}}),qg=function(a,u){return function(f){return Boolean(uu(f)&&k4.test(f)&&f.startsWith(a)||u&&Object.prototype.hasOwnProperty.call(f,u))}},hA=function(a,u,f){return function(s){var c;if(!uu(s))return s;var T=s.match(lu),m=T[0],E=T[1],d=T[2],x=T[3];return c={},c[a]=parseFloat(m),c[u]=parseFloat(E),c[f]=parseFloat(d),c.alpha=x!==void 0?parseFloat(x):1,c}},ac={test:qg("hsl","hue"),parse:hA("hue","saturation","lightness"),transform:function(a){var u=a.hue,f=a.saturation,s=a.lightness,c=a.alpha,T=c===void 0?1:c;return"hsla("+Math.round(u)+", "+oc.transform(cu(f))+", "+oc.transform(cu(s))+", "+cu(hu.transform(T))+")"}},G4=lA(0,255),Zg=st(st({},ka),{transform:function(a){return Math.round(G4(a))}}),sc={test:qg("rgb","red"),parse:hA("red","green","blue"),transform:function(a){var u=a.red,f=a.green,s=a.blue,c=a.alpha,T=c===void 0?1:c;return"rgba("+Zg.transform(u)+", "+Zg.transform(f)+", "+Zg.transform(s)+", "+cu(hu.transform(T))+")"}};function W4(a){var u="",f="",s="",c="";return a.length>5?(u=a.substr(1,2),f=a.substr(3,2),s=a.substr(5,2),c=a.substr(7,2)):(u=a.substr(1,1),f=a.substr(2,1),s=a.substr(3,1),c=a.substr(4,1),u+=u,f+=f,s+=s,c+=c),{red:parseInt(u,16),green:parseInt(f,16),blue:parseInt(s,16),alpha:c?parseInt(c,16)/255:1}}var $g={test:qg("#"),parse:W4,transform:sc.transform},Cr={test:function(a){return sc.test(a)||$g.test(a)||ac.test(a)},parse:function(a){return sc.test(a)?sc.parse(a):ac.test(a)?ac.parse(a):$g.parse(a)},transform:function(a){return uu(a)?a:a.hasOwnProperty("red")?sc.transform(a):ac.transform(a)}},dA="${c}",fA="${n}";function H4(a){var u,f,s,c;return isNaN(a)&&uu(a)&&((f=(u=a.match(lu))===null||u===void 0?void 0:u.length)!==null&&f!==void 0?f:0)+((c=(s=a.match(Qg))===null||s===void 0?void 0:s.length)!==null&&c!==void 0?c:0)>0}function pA(a){var u=[],f=0,s=a.match(Qg);s&&(f=s.length,a=a.replace(Qg,dA),u.push.apply(u,s.map(Cr.parse)));var c=a.match(lu);return c&&(a=a.replace(lu,fA),u.push.apply(u,c.map(ka.parse))),{values:u,numColors:f,tokenised:a}}function mA(a){return pA(a).values}function _A(a){var u=pA(a),f=u.values,s=u.numColors,c=u.tokenised,T=f.length;return function(m){for(var E=c,d=0;d<T;d++)E=E.replace(d<s?dA:fA,d<s?Cr.transform(m[d]):cu(m[d]));return E}}var X4=function(a){return typeof a=="number"?0:a};function Y4(a){var u=mA(a),f=_A(a);return f(u.map(X4))}var _o={test:H4,parse:mA,createTransformer:_A,getAnimatableNone:Y4},K4=new Set(["brightness","contrast","saturate","opacity"]);function Q4(a){var u=a.slice(0,-1).split("("),f=u[0],s=u[1];if(f==="drop-shadow")return a;var c=(s.match(lu)||[])[0];if(!c)return a;var T=s.replace(c,""),m=K4.has(f)?1:0;return c!==s&&(m*=100),f+"("+m+T+")"}var q4=/([a-z-]*)\(.*?\)/g,Jg=st(st({},_o),{getAnimatableNone:function(a){var u=a.match(q4);return u?u.map(Q4).join(" "):a}}),gA=st(st({},ka),{transform:Math.round}),vA={borderWidth:wt,borderTopWidth:wt,borderRightWidth:wt,borderBottomWidth:wt,borderLeftWidth:wt,borderRadius:wt,radius:wt,borderTopLeftRadius:wt,borderTopRightRadius:wt,borderBottomRightRadius:wt,borderBottomLeftRadius:wt,width:wt,maxWidth:wt,height:wt,maxHeight:wt,size:wt,top:wt,right:wt,bottom:wt,left:wt,padding:wt,paddingTop:wt,paddingRight:wt,paddingBottom:wt,paddingLeft:wt,margin:wt,marginTop:wt,marginRight:wt,marginBottom:wt,marginLeft:wt,rotate:aa,rotateX:aa,rotateY:aa,rotateZ:aa,scale:tf,scaleX:tf,scaleY:tf,scaleZ:tf,skew:aa,skewX:aa,skewY:aa,distance:wt,translateX:wt,translateY:wt,translateZ:wt,x:wt,y:wt,z:wt,perspective:wt,transformPerspective:wt,opacity:hu,originX:uA,originY:uA,originZ:wt,zIndex:gA,fillOpacity:hu,strokeOpacity:hu,numOctaves:gA};function ev(a,u,f,s,c,T,m,E){var d,x=a.style,M=a.vars,w=a.transform,S=a.transformKeys,_=a.transformOrigin;S.length=0;var O=!1,R=!1,I=!0;for(var y in u){var p=u[y];if(cA(y)){M[y]=p;continue}var g=vA[y],C=V4(p,g);if(ef(y)){if(O=!0,w[y]=C,S.push(y),!I)continue;p!==((d=g.default)!==null&&d!==void 0?d:0)&&(I=!1)}else if(aA(y))_[y]=C,R=!0;else if((f==null?void 0:f.isHydrated)&&(s==null?void 0:s.isHydrated)&&au[y]){var P=au[y].process(p,s,f),F=au[y].applyTo;if(F)for(var U=F.length,B=0;B<U;B++)x[F[B]]=P;else x[y]=P}else x[y]=C}s&&f&&m&&E?(x.transform=m(s.deltaFinal,s.treeScale,O?w:void 0),T&&(x.transform=T(w,x.transform)),x.transformOrigin=E(s)):(O&&(x.transform=B4(a,c,I,T)),R&&(x.transformOrigin=U4(_)))}var tv=function(){return{style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}}};function bA(a,u,f){for(var s in u)!oa(u[s])&&!sA(s,f)&&(a[s]=u[s])}function Z4(a,u,f){var s=a.transformTemplate;return Dn(function(){var c=tv();ev(c,u,void 0,void 0,{enableHardwareAcceleration:!f},s);var T=c.vars,m=c.style;return st(st({},T),m)},[u])}function $4(a,u,f){var s=a.style||{},c={};return bA(c,s,a),Object.assign(c,Z4(a,u,f)),a.transformValues&&(c=a.transformValues(c)),c}function J4(a,u,f){var s={},c=$4(a,u,f);return Boolean(a.drag)&&(s.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=a.drag===!0?"none":"pan-"+(a.drag==="x"?"y":"x")),s.style=c,s}var eW=new Set(["initial","animate","exit","style","variants","transition","transformTemplate","transformValues","custom","inherit","layout","layoutId","_layoutResetTransform","onLayoutAnimationComplete","onViewportBoxUpdate","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","drag","dragControls","dragListener","dragConstraints","dragDirectionLock","_dragX","_dragY","dragElastic","dragMomentum","dragPropagation","dragTransition","whileDrag","onPan","onPanStart","onPanEnd","onPanSessionStart","onTap","onTapStart","onTapCancel","onHoverStart","onHoverEnd","whileFocus","whileTap","whileHover"]);function nf(a){return eW.has(a)}var yA=function(a){return!nf(a)};try{var tW=require("@emotion/is-prop-valid").default;yA=function(a){return a.startsWith("on")?!nf(a):tW(a)}}catch(a){}function nW(a,u,f){var s={};for(var c in a)(yA(c)||f===!0&&nf(c)||!u&&!nf(c))&&(s[c]=a[c]);return s}function TA(a,u,f){return typeof a=="string"?a:wt.transform(u+f*a)}function rW(a,u,f){var s=TA(u,a.x,a.width),c=TA(f,a.y,a.height);return s+" "+c}var nv=function(a,u){return wt.transform(a*u)},iW={offset:"stroke-dashoffset",array:"stroke-dasharray"},oW={offset:"strokeDashoffset",array:"strokeDasharray"};function aW(a,u,f,s,c,T){s===void 0&&(s=1),c===void 0&&(c=0),T===void 0&&(T=!0);var m=T?iW:oW;a[m.offset]=nv(-c,u);var E=nv(f,u),d=nv(s,u);a[m.array]=E+" "+d}function rv(a,u,f,s,c,T,m,E){var d=u.attrX,x=u.attrY,M=u.originX,w=u.originY,S=u.pathLength,_=u.pathSpacing,O=_===void 0?1:_,R=u.pathOffset,I=R===void 0?0:R,y=Xr(u,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]);ev(a,y,f,s,c,T,m,E),a.attrs=a.style,a.style={};var p=a.attrs,g=a.style,C=a.dimensions,P=a.totalPathLength;p.transform&&(C&&(g.transform=p.transform),delete p.transform),C&&(M!==void 0||w!==void 0||g.transform)&&(g.transformOrigin=rW(C,M!==void 0?M:.5,w!==void 0?w:.5)),d!==void 0&&(p.x=d),x!==void 0&&(p.y=x),P!==void 0&&S!==void 0&&aW(p,P,S,O,I,!1)}var EA=function(){return st(st({},tv()),{attrs:{}})};function sW(a,u){var f=Dn(function(){var c=EA();return rv(c,u,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),st(st({},c.attrs),{style:st({},c.style)})},[u]);if(a.style){var s={};bA(s,a.style,a),f.style=st(st({},s),f.style)}return f}function cW(a){a===void 0&&(a=!1);var u=function(f,s,c,T,m){var E=T.latestValues,d=Kg(f)?sW:J4,x=d(s,E,m),M=nW(s,typeof f=="string",a),w=st(st(st({},M),x),{ref:c});return Ye(f,w)};return u}var lW=/([a-z])([A-Z])/g,uW="$1-$2",SA=function(a){return a.replace(lW,uW).toLowerCase()};function xA(a,u){var f=u.style,s=u.vars;Object.assign(a.style,f);for(var c in s)a.style.setProperty(c,s[c])}var PA=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform"]);function AA(a,u){xA(a,u);for(var f in u.attrs)a.setAttribute(PA.has(f)?f:SA(f),u.attrs[f])}function iv(a){var u=a.style,f={};for(var s in u)(oa(u[s])||sA(s,a))&&(f[s]=u[s]);return f}function CA(a){var u=iv(a);for(var f in a)if(oa(a[f])){var s=f==="x"||f==="y"?"attr"+f.toUpperCase():f;u[s]=a[f]}return u}function ov(a){return typeof a=="object"&&typeof a.start=="function"}var fu=function(a){return Array.isArray(a)},hW=function(a){return Boolean(a&&typeof a=="object"&&a.mix&&a.toValue)},dW=function(a){return fu(a)?a[a.length-1]||0:a};function fW(a){var u=oa(a)?a.get():a;return hW(u)?u.toValue():u}function RA(a,u,f,s){var c=a.scrapeMotionValuesFromProps,T=a.createRenderState,m=a.onMount,E={latestValues:pW(u,f,s,c),renderState:T()};return m&&(E.mount=function(d){return m(u,d,E)}),E}var OA=function(a){return function(u,f){var s=Jt(Zd),c=Jt(ru);return f?RA(a,u,s,c):iu(function(){return RA(a,u,s,c)})}};function pW(a,u,f,s){var c={},T=(f==null?void 0:f.initial)===!1,m=s(a);for(var E in m)c[E]=fW(m[E]);var d=a.initial,x=a.animate,M=Jd(a),w=iA(a);u&&w&&!M&&a.inherit!==!1&&(d??(d=u.initial),x??(x=u.animate));var S=T||d===!1?x:d;if(S&&typeof S!="boolean"&&!ov(S)){var _=Array.isArray(S)?S:[S];_.forEach(function(O){var R=rA(a,O);if(!!R){var I=R.transitionEnd;R.transition;var y=Xr(R,["transitionEnd","transition"]);for(var p in y)c[p]=y[p];for(var p in I)c[p]=I[p]}})}return c}var mW={useVisualState:OA({scrapeMotionValuesFromProps:CA,createRenderState:EA,onMount:function(a,u,f){var s=f.renderState,c=f.latestValues;try{s.dimensions=typeof u.getBBox=="function"?u.getBBox():u.getBoundingClientRect()}catch(T){s.dimensions={x:0,y:0,width:0,height:0}}_W(u)&&(s.totalPathLength=u.getTotalLength()),rv(s,c,void 0,void 0,{enableHardwareAcceleration:!1},a.transformTemplate),AA(u,s)}})};function _W(a){return a.tagName==="path"}var gW={useVisualState:OA({scrapeMotionValuesFromProps:iv,createRenderState:tv})};function vW(a,u,f,s){var c=u.forwardMotionProps,T=c===void 0?!1:c,m=Kg(a)?mW:gW;return st(st({},m),{preloadedFeatures:f,useRender:cW(T),createVisualElement:s,Component:a})}var Vn;(function(a){a.Animate="animate",a.Hover="whileHover",a.Tap="whileTap",a.Drag="whileDrag",a.Focus="whileFocus",a.Exit="exit"})(Vn||(Vn={}));function av(a,u,f,s){return a.addEventListener(u,f,s),function(){return a.removeEventListener(u,f,s)}}function sv(a,u,f,s){Ut(function(){var c=a.current;if(f&&c)return av(c,u,f,s)},[a,u,f,s])}function bW(a){var u=a.whileFocus,f=a.visualElement,s=function(){var T;(T=f.animationState)===null||T===void 0||T.setActive(Vn.Focus,!0)},c=function(){var T;(T=f.animationState)===null||T===void 0||T.setActive(Vn.Focus,!1)};sv(f,"focus",u?s:void 0),sv(f,"blur",u?c:void 0)}function MA(a){return typeof PointerEvent!="undefined"&&a instanceof PointerEvent?a.pointerType==="mouse":a instanceof MouseEvent}function IA(a){var u=!!a.touches;return u}function yW(a){return function(u){var f=u instanceof MouseEvent,s=!f||f&&u.button===0;s&&a(u)}}var TW={pageX:0,pageY:0};function EW(a,u){u===void 0&&(u="page");var f=a.touches[0]||a.changedTouches[0],s=f||TW;return{x:s[u+"X"],y:s[u+"Y"]}}function SW(a,u){return u===void 0&&(u="page"),{x:a[u+"X"],y:a[u+"Y"]}}function cv(a,u){return u===void 0&&(u="page"),{point:IA(a)?EW(a,u):SW(a,u)}}function xW(a){return cv(a,"client")}var DA=function(a,u){u===void 0&&(u=!1);var f=function(s){return a(s,cv(s))};return u?yW(f):f},PW=function(){return ou&&window.onpointerdown===null},AW=function(){return ou&&window.ontouchstart===null},CW=function(){return ou&&window.onmousedown===null},RW={pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mousecancel",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"},OW={pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"};function wA(a){return PW()?a:AW()?OW[a]:CW()?RW[a]:a}function cc(a,u,f,s){return av(a,wA(u),DA(f,u==="pointerdown"),s)}function rf(a,u,f,s){return sv(a,wA(u),f&&DA(f,u==="pointerdown"),s)}function LA(a){var u=null;return function(){var f=function(){u=null};return u===null?(u=a,f):!1}}var NA=LA("dragHorizontal"),FA=LA("dragVertical");function BA(a){var u=!1;if(a==="y")u=FA();else if(a==="x")u=NA();else{var f=NA(),s=FA();f&&s?u=function(){f(),s()}:(f&&f(),s&&s())}return u}function UA(){var a=BA(!0);return a?(a(),!1):!0}function VA(a,u,f){return function(s,c){var T;!MA(s)||UA()||(f==null||f(s,c),(T=a.animationState)===null||T===void 0||T.setActive(Vn.Hover,u))}}function MW(a){var u=a.onHoverStart,f=a.onHoverEnd,s=a.whileHover,c=a.visualElement;rf(c,"pointerenter",u||s?VA(c,!0,u):void 0),rf(c,"pointerleave",f||s?VA(c,!1,f):void 0)}var kA=function(a,u){return u?a===u?!0:kA(a,u.parentElement):!1};function lv(a){return Ut(function(){return function(){return a()}},[])}var of=function(a,u,f){return Math.min(Math.max(f,a),u)},uv=.001,IW=.01,DW=10,wW=.05,LW=1;function NW(a){var u=a.duration,f=u===void 0?800:u,s=a.bounce,c=s===void 0?.25:s,T=a.velocity,m=T===void 0?0:T,E=a.mass,d=E===void 0?1:E,x,M,w=1-c;w=of(wW,LW,w),f=of(IW,DW,f/1e3),w<1?(x=function(R){var I=R*w,y=I*f,p=I-m,g=hv(R,w),C=Math.exp(-y);return uv-p/g*C},M=function(R){var I=R*w,y=I*f,p=y*m+m,g=Math.pow(w,2)*Math.pow(R,2)*f,C=Math.exp(-y),P=hv(Math.pow(R,2),w),F=-x(R)+uv>0?-1:1;return F*((p-g)*C)/P}):(x=function(R){var I=Math.exp(-R*f),y=(R-m)*f+1;return-uv+I*y},M=function(R){var I=Math.exp(-R*f),y=(m-R)*(f*f);return I*y});var S=5/f,_=BW(x,M,S);if(f=f*1e3,isNaN(_))return{stiffness:100,damping:10,duration:f};var O=Math.pow(_,2)*d;return{stiffness:O,damping:w*2*Math.sqrt(d*O),duration:f}}var FW=12;function BW(a,u,f){for(var s=f,c=1;c<FW;c++)s=s-a(s)/u(s);return s}function hv(a,u){return a*Math.sqrt(1-u*u)}var UW=["duration","bounce"],VW=["stiffness","damping","mass"];function jA(a,u){return u.some(function(f){return a[f]!==void 0})}function kW(a){var u=st({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},a);if(!jA(a,VW)&&jA(a,UW)){var f=NW(a);u=st(st(st({},u),f),{velocity:0,mass:1}),u.isResolvedFromDuration=!0}return u}function dv(a){var u=a.from,f=u===void 0?0:u,s=a.to,c=s===void 0?1:s,T=a.restSpeed,m=T===void 0?2:T,E=a.restDelta,d=Xr(a,["from","to","restSpeed","restDelta"]),x={done:!1,value:f},M=kW(d),w=M.stiffness,S=M.damping,_=M.mass,O=M.velocity,R=M.duration,I=M.isResolvedFromDuration,y=zA,p=zA;function g(){var C=O?-(O/1e3):0,P=c-f,F=S/(2*Math.sqrt(w*_)),U=Math.sqrt(w/_)/1e3;if(E??(E=Math.abs(c-f)<=1?.01:.4),F<1){var B=hv(U,F);y=function(z){var X=Math.exp(-F*U*z);return c-X*((C+F*U*P)/B*Math.sin(B*z)+P*Math.cos(B*z))},p=function(z){var X=Math.exp(-F*U*z);return F*U*X*(Math.sin(B*z)*(C+F*U*P)/B+P*Math.cos(B*z))-X*(Math.cos(B*z)*(C+F*U*P)-B*P*Math.sin(B*z))}}else if(F===1)y=function(z){return c-Math.exp(-U*z)*(P+(C+U*P)*z)};else{var L=U*Math.sqrt(F*F-1);y=function(z){var X=Math.exp(-F*U*z),G=Math.min(L*z,300);return c-X*((C+F*U*P)*Math.sinh(G)+L*P*Math.cosh(G))/L}}}return g(),{next:function(C){var P=y(C);if(I)x.done=C>=R;else{var F=p(C)*1e3,U=Math.abs(F)<=m,B=Math.abs(c-P)<=E;x.done=U&&B}return x.value=x.done?c:P,x},flipTarget:function(){var C;O=-O,C=[c,f],f=C[0],c=C[1],g()}}}dv.needsInterpolation=function(a,u){return typeof a=="string"||typeof u=="string"};var zA=function(a){return 0},pu=function(a,u,f){var s=u-a;return s===0?1:(f-a)/s},Nr=function(a,u,f){return-f*a+f*u+a},jW=function(a,u,f){var s=a*a,c=u*u;return Math.sqrt(Math.max(0,f*(c-s)+s))},zW=[$g,sc,ac],GA=function(a){return zW.find(function(u){return u.test(a)})},WA=function(a,u){var f=GA(a),s=GA(u);nu(f.transform===s.transform);var c=f.parse(a),T=s.parse(u),m=st({},c),E=f===ac?Nr:jW;return function(d){for(var x in m)x!=="alpha"&&(m[x]=E(c[x],T[x],d));return m.alpha=Nr(c.alpha,T.alpha,d),f.transform(m)}},fv=function(a){return typeof a=="number"},GW=function(a,u){return function(f){return u(a(f))}},mu=function(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return a.reduce(GW)};function HA(a,u){return fv(a)?function(f){return Nr(a,u,f)}:Cr.test(a)?WA(a,u):KA(a,u)}var XA=function(a,u){var f=Ar([],a),s=f.length,c=a.map(function(T,m){return HA(T,u[m])});return function(T){for(var m=0;m<s;m++)f[m]=c[m](T);return f}},WW=function(a,u){var f=st(st({},a),u),s={};for(var c in f)a[c]!==void 0&&u[c]!==void 0&&(s[c]=HA(a[c],u[c]));return function(T){for(var m in s)f[m]=s[m](T);return f}};function YA(a){for(var u=_o.parse(a),f=u.length,s=0,c=0,T=0,m=0;m<f;m++)s||typeof u[m]=="number"?s++:u[m].hue!==void 0?T++:c++;return{parsed:u,numNumbers:s,numRGB:c,numHSL:T}}var KA=function(a,u){var f=_o.createTransformer(u),s=YA(a),c=YA(u);return mu(XA(s.parsed,c.parsed),f)},HW=function(a,u){return function(f){return Nr(a,u,f)}};function XW(a){if(typeof a=="number")return HW;if(typeof a=="string")return Cr.test(a)?WA:KA;if(Array.isArray(a))return XA;if(typeof a=="object")return WW}function YW(a,u,f){for(var s=[],c=f||XW(a[0]),T=a.length-1,m=0;m<T;m++){var E=c(a[m],a[m+1]);if(u){var d=Array.isArray(u)?u[m]:u;E=mu(d,E)}s.push(E)}return s}function KW(a,u){var f=a[0],s=a[1],c=u[0];return function(T){return c(pu(f,s,T))}}function QW(a,u){var f=a.length,s=f-1;return function(c){var T=0,m=!1;if(c<=a[0]?m=!0:c>=a[s]&&(T=s-1,m=!0),!m){for(var E=1;E<f&&!(a[E]>c||E===s);E++);T=E-1}var d=pu(a[T],a[T+1],c);return u[T](d)}}function QA(a,u,f){var s=f===void 0?{}:f,c=s.clamp,T=c===void 0?!0:c,m=s.ease,E=s.mixer,d=a.length;nu(d===u.length),nu(!m||!Array.isArray(m)||m.length===d-1),a[0]>a[d-1]&&(a=[].concat(a),u=[].concat(u),a.reverse(),u.reverse());var x=YW(u,m,E),M=d===2?KW(a,x):QW(a,x);return T?function(w){return M(of(a[0],a[d-1],w))}:M}var af=function(a){return function(u){return 1-a(1-u)}},pv=function(a){return function(u){return u<=.5?a(2*u)/2:(2-a(2*(1-u)))/2}},qW=function(a){return function(u){return Math.pow(u,a)}},qA=function(a){return function(u){return u*u*((a+1)*u-a)}},ZW=function(a){var u=qA(a);return function(f){return(f*=2)<1?.5*u(f):.5*(2-Math.pow(2,-10*(f-1)))}},ZA=1.525,$W=4/11,JW=8/11,eH=9/10,$A=function(a){return a},mv=qW(2),tH=af(mv),JA=pv(mv),eC=function(a){return 1-Math.sin(Math.acos(a))},tC=af(eC),nH=pv(tC),_v=qA(ZA),rH=af(_v),iH=pv(_v),oH=ZW(ZA),aH=4356/361,sH=35442/1805,cH=16061/1805,sf=function(a){if(a===1||a===0)return a;var u=a*a;return a<$W?7.5625*u:a<JW?9.075*u-9.9*a+3.4:a<eH?aH*u-sH*a+cH:10.8*a*a-20.52*a+10.72},lH=af(sf),uH=function(a){return a<.5?.5*(1-sf(1-a*2)):.5*sf(a*2-1)+.5};function hH(a,u){return a.map(function(){return u||JA}).splice(0,a.length-1)}function dH(a){var u=a.length;return a.map(function(f,s){return s!==0?s/(u-1):0})}function fH(a,u){return a.map(function(f){return f*u})}function cf(a){var u=a.from,f=u===void 0?0:u,s=a.to,c=s===void 0?1:s,T=a.ease,m=a.offset,E=a.duration,d=E===void 0?300:E,x={done:!1,value:f},M=Array.isArray(c)?c:[f,c],w=fH(m&&m.length===M.length?m:dH(M),d);function S(){return QA(w,M,{ease:Array.isArray(T)?T:hH(M,T)})}var _=S();return{next:function(O){return x.value=_(O),x.done=O>=d,x},flipTarget:function(){M.reverse(),_=S()}}}function pH(a){var u=a.velocity,f=u===void 0?0:u,s=a.from,c=s===void 0?0:s,T=a.power,m=T===void 0?.8:T,E=a.timeConstant,d=E===void 0?350:E,x=a.restDelta,M=x===void 0?.5:x,w=a.modifyTarget,S={done:!1,value:c},_=m*f,O=c+_,R=w===void 0?O:w(O);return R!==O&&(_=R-c),{next:function(I){var y=-_*Math.exp(-I/d);return S.done=!(y>M||y<-M),S.value=S.done?R:R+y,S},flipTarget:function(){}}}var nC={keyframes:cf,spring:dv,decay:pH};function mH(a){if(Array.isArray(a.to))return cf;if(nC[a.type])return nC[a.type];var u=new Set(Object.keys(a));return u.has("ease")||u.has("duration")&&!u.has("dampingRatio")?cf:u.has("dampingRatio")||u.has("stiffness")||u.has("mass")||u.has("damping")||u.has("restSpeed")||u.has("restDelta")?dv:cf}function rC(a,u,f){return f===void 0&&(f=0),a-u-f}function _H(a,u,f,s){return f===void 0&&(f=0),s===void 0&&(s=!0),s?rC(u+-a,u,f):u-(a-u)+f}function gH(a,u,f,s){return s?a>=u+f:a<=-f}var vH=function(a){var u=function(f){var s=f.delta;return a(s)};return{start:function(){return Wi.update(u,!0)},stop:function(){return jl.update(u)}}};function iC(a){var u,f,s=a.from,c=a.autoplay,T=c===void 0?!0:c,m=a.driver,E=m===void 0?vH:m,d=a.elapsed,x=d===void 0?0:d,M=a.repeat,w=M===void 0?0:M,S=a.repeatType,_=S===void 0?"loop":S,O=a.repeatDelay,R=O===void 0?0:O,I=a.onPlay,y=a.onStop,p=a.onComplete,g=a.onRepeat,C=a.onUpdate,P=Xr(a,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),F=P.to,U,B=0,L=P.duration,z,X=!1,G=!0,ee,$=mH(P);((f=(u=$).needsInterpolation)===null||f===void 0?void 0:f.call(u,s,F))&&(ee=QA([0,100],[s,F],{clamp:!1}),s=0,F=100);var fe=$(st(st({},P),{from:s,to:F}));function me(){B++,_==="reverse"?(G=B%2==0,x=_H(x,L,R,G)):(x=rC(x,L,R),_==="mirror"&&fe.flipTarget()),X=!1,g&&g()}function ve(){U.stop(),p&&p()}function be(se){if(G||(se=-se),x+=se,!X){var V=fe.next(Math.max(0,x));z=V.value,ee&&(z=ee(z)),X=G?V.done:x<=0}C==null||C(z),X&&(B===0&&(L??(L=x)),B<w?gH(x,L,R,G)&&me():ve())}function ie(){I==null||I(),U=E(be),U.start()}return T&&ie(),{stop:function(){y==null||y(),U.stop()}}}function oC(a,u){return u?a*(1e3/u):0}function bH(a){var u=a.from,f=u===void 0?0:u,s=a.velocity,c=s===void 0?0:s,T=a.min,m=a.max,E=a.power,d=E===void 0?.8:E,x=a.timeConstant,M=x===void 0?750:x,w=a.bounceStiffness,S=w===void 0?500:w,_=a.bounceDamping,O=_===void 0?10:_,R=a.restDelta,I=R===void 0?1:R,y=a.modifyTarget,p=a.driver,g=a.onUpdate,C=a.onComplete,P;function F(me){return T!==void 0&&me<T||m!==void 0&&me>m}function U(me){return T===void 0?m:m===void 0||Math.abs(T-me)<Math.abs(m-me)?T:m}function B(me){P==null||P.stop(),P=iC(st(st({},me),{driver:p,onUpdate:function(ve){var be;g==null||g(ve),(be=me.onUpdate)===null||be===void 0||be.call(me,ve)},onComplete:C}))}function L(me){B(st({type:"spring",stiffness:S,damping:O,restDelta:I},me))}if(F(f))L({from:f,velocity:c,to:U(f)});else{var z=d*c+f;typeof y!="undefined"&&(z=y(z));var X=U(z),G=X===T?-1:1,ee,$,fe=function(me){ee=$,$=me,c=oC(me-ee,Nd().delta),(G===1&&me>X||G===-1&&me<X)&&L({from:me,to:X,velocity:c})};B({type:"decay",from:f,velocity:c,timeConstant:M,power:d,restDelta:I,modifyTarget:y,onUpdate:F(z)?fe:void 0})}return{stop:function(){return P==null?void 0:P.stop()}}}var gv=function(a){return a.hasOwnProperty("x")&&a.hasOwnProperty("y")},aC=function(a){return gv(a)&&a.hasOwnProperty("z")},lf=function(a,u){return Math.abs(a-u)};function sC(a,u){if(fv(a)&&fv(u))return lf(a,u);if(gv(a)&&gv(u)){var f=lf(a.x,u.x),s=lf(a.y,u.y),c=aC(a)&&aC(u)?lf(a.z,u.z):0;return Math.sqrt(Math.pow(f,2)+Math.pow(s,2)+Math.pow(c,2))}}var cC=function(a,u){return 1-3*u+3*a},lC=function(a,u){return 3*u-6*a},uC=function(a){return 3*a},uf=function(a,u,f){return((cC(u,f)*a+lC(u,f))*a+uC(u))*a},hC=function(a,u,f){return 3*cC(u,f)*a*a+2*lC(u,f)*a+uC(u)},yH=1e-7,TH=10;function EH(a,u,f,s,c){var T,m,E=0;do m=u+(f-u)/2,T=uf(m,s,c)-a,T>0?f=m:u=m;while(Math.abs(T)>yH&&++E<TH);return m}var SH=8,xH=.001;function PH(a,u,f,s){for(var c=0;c<SH;++c){var T=hC(u,f,s);if(T===0)return u;var m=uf(u,f,s)-a;u-=m/T}return u}var hf=11,df=1/(hf-1);function AH(a,u,f,s){if(a===u&&f===s)return $A;for(var c=new Float32Array(hf),T=0;T<hf;++T)c[T]=uf(T*df,a,f);function m(E){for(var d=0,x=1,M=hf-1;x!==M&&c[x]<=E;++x)d+=df;--x;var w=(E-c[x])/(c[x+1]-c[x]),S=d+w*df,_=hC(S,a,f);return _>=xH?PH(E,S,a,f):_===0?S:EH(E,d,d+df,a,f)}return function(E){return E===0||E===1?E:uf(m(E),u,s)}}function CH(a){var u=a.onTap,f=a.onTapStart,s=a.onTapCancel,c=a.whileTap,T=a.visualElement,m=u||f||s||c,E=Nt(!1),d=Nt(null);function x(){var O;(O=d.current)===null||O===void 0||O.call(d),d.current=null}function M(){var O;return x(),E.current=!1,(O=T.animationState)===null||O===void 0||O.setActive(Vn.Tap,!1),!UA()}function w(O,R){!M()||(kA(T.getInstance(),O.target)?u==null||u(O,R):s==null||s(O,R))}function S(O,R){!M()||s==null||s(O,R)}function _(O,R){var I;x(),!E.current&&(E.current=!0,d.current=mu(cc(window,"pointerup",w),cc(window,"pointercancel",S)),f==null||f(O,R),(I=T.animationState)===null||I===void 0||I.setActive(Vn.Tap,!0))}rf(T,"pointerdown",m?_:void 0),lv(x)}var ja=function(a){return function(u){return a(u),null}},RH={tap:ja(CH),focus:ja(bW),hover:ja(MW)};function dC(a,u){if(!Array.isArray(u))return!1;var f=u.length;if(f!==a.length)return!1;for(var s=0;s<f;s++)if(u[s]!==a[s])return!1;return!0}var ff=function(a){return a*1e3},OH={linear:$A,easeIn:mv,easeInOut:JA,easeOut:tH,circIn:eC,circInOut:nH,circOut:tC,backIn:_v,backInOut:iH,backOut:rH,anticipate:oH,bounceIn:lH,bounceInOut:uH,bounceOut:sf},fC=function(a){if(Array.isArray(a)){nu(a.length===4);var u=wn(a,4),f=u[0],s=u[1],c=u[2],T=u[3];return AH(f,s,c,T)}else if(typeof a=="string")return OH[a];return a},MH=function(a){return Array.isArray(a)&&typeof a[0]!="number"},pC=function(a,u){return a==="zIndex"?!1:!!(typeof u=="number"||Array.isArray(u)||typeof u=="string"&&_o.test(u)&&!u.startsWith("url("))},za=function(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}},pf=function(a){return{type:"spring",stiffness:550,damping:a===0?2*Math.sqrt(550):30,restDelta:.01,restSpeed:10}},vv=function(){return{type:"keyframes",ease:"linear",duration:.3}},IH=function(a){return{type:"keyframes",duration:.8,values:a}},mC={x:za,y:za,z:za,rotate:za,rotateX:za,rotateY:za,rotateZ:za,scaleX:pf,scaleY:pf,scale:pf,opacity:vv,backgroundColor:vv,color:vv,default:pf},DH=function(a,u){var f;return fu(u)?f=IH:f=mC[a]||mC.default,st({to:u},f(u))},wH=st(st({},vA),{color:Cr,backgroundColor:Cr,outlineColor:Cr,fill:Cr,stroke:Cr,borderColor:Cr,borderTopColor:Cr,borderRightColor:Cr,borderBottomColor:Cr,borderLeftColor:Cr,filter:Jg,WebkitFilter:Jg}),bv=function(a){return wH[a]};function yv(a,u){var f,s=bv(a);return s!==Jg&&(s=_o),(f=s.getAnimatableNone)===null||f===void 0?void 0:f.call(s,u)}function LH(a){a.when,a.delay,a.delayChildren,a.staggerChildren,a.staggerDirection,a.repeat,a.repeatType,a.repeatDelay,a.from;var u=Xr(a,["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from"]);return!!Object.keys(u).length}function NH(a){var u=a.ease,f=a.times,s=a.yoyo,c=a.flip,T=a.loop,m=Xr(a,["ease","times","yoyo","flip","loop"]),E=st({},m);return f&&(E.offset=f),m.duration&&(E.duration=ff(m.duration)),m.repeatDelay&&(E.repeatDelay=ff(m.repeatDelay)),u&&(E.ease=MH(u)?u.map(fC):fC(u)),m.type==="tween"&&(E.type="keyframes"),(s||T||c)&&(s?E.repeatType="reverse":T?E.repeatType="loop":c&&(E.repeatType="mirror"),E.repeat=T||s||c||m.repeat),m.type!=="spring"&&(E.type="keyframes"),E}function FH(a,u){var f,s=Tv(a,u)||{};return(f=s.delay)!==null&&f!==void 0?f:0}function BH(a){return Array.isArray(a.to)&&a.to[0]===null&&(a.to=Ar([],wn(a.to)),a.to[0]=a.from),a}function UH(a,u,f){var s;return Array.isArray(u.to)&&((s=a.duration)!==null&&s!==void 0||(a.duration=.8)),BH(u),LH(a)||(a=st(st({},a),DH(f,u.to))),st(st({},u),NH(a))}function VH(a,u,f,s,c){var T,m=Tv(s,a),E=(T=m.from)!==null&&T!==void 0?T:u.get(),d=pC(a,f);E==="none"&&d&&typeof f=="string"?E=yv(a,f):_C(E)&&typeof f=="string"?E=gC(f):!Array.isArray(f)&&_C(f)&&typeof E=="string"&&(f=gC(E));var x=pC(a,E);function M(){var S={from:E,to:f,velocity:u.getVelocity(),onComplete:c,onUpdate:function(_){return u.set(_)}};return m.type==="inertia"||m.type==="decay"?bH(st(st({},S),m)):iC(st(st({},UH(m,S,a)),{onUpdate:function(_){var O;S.onUpdate(_),(O=m.onUpdate)===null||O===void 0||O.call(m,_)},onComplete:function(){var _;S.onComplete(),(_=m.onComplete)===null||_===void 0||_.call(m)}}))}function w(){var S;return u.set(f),c(),(S=m==null?void 0:m.onComplete)===null||S===void 0||S.call(m),{stop:function(){}}}return!x||!d||m.type===!1?w:M}function _C(a){return a===0||typeof a=="string"&&parseFloat(a)===0&&a.indexOf(" ")===-1}function gC(a){return typeof a=="number"?0:yv("",a)}function Tv(a,u){return a[u]||a.default||a}function mf(a,u,f,s){return s===void 0&&(s={}),u.start(function(c){var T,m,E=VH(a,u,f,s,c),d=FH(s,a),x=function(){return m=E()};return d?T=setTimeout(x,ff(d)):x(),function(){clearTimeout(T),m==null||m.stop()}})}var kH=function(a){return/^\-?\d*\.?\d+$/.test(a)};function vC(a,u){a.indexOf(u)===-1&&a.push(u)}function bC(a,u){var f=a.indexOf(u);f>-1&&a.splice(f,1)}var _f=function(){function a(){this.subscriptions=[]}return a.prototype.add=function(u){var f=this;return vC(this.subscriptions,u),function(){return bC(f.subscriptions,u)}},a.prototype.notify=function(u,f,s){var c=this.subscriptions.length;if(!!c)if(c===1)this.subscriptions[0](u,f,s);else for(var T=0;T<c;T++){var m=this.subscriptions[T];m&&m(u,f,s)}},a.prototype.getSize=function(){return this.subscriptions.length},a.prototype.clear=function(){this.subscriptions.length=0},a}(),jH=function(a){return!isNaN(parseFloat(a))},zH=function(){function a(u){var f=this;this.timeDelta=0,this.lastUpdated=0,this.updateSubscribers=new _f,this.velocityUpdateSubscribers=new _f,this.renderSubscribers=new _f,this.canTrackVelocity=!1,this.updateAndNotify=function(s,c){c===void 0&&(c=!0),f.prev=f.current,f.current=s;var T=Nd(),m=T.delta,E=T.timestamp;f.lastUpdated!==E&&(f.timeDelta=m,f.lastUpdated=E,Wi.postRender(f.scheduleVelocityCheck)),f.prev!==f.current&&f.updateSubscribers.notify(f.current),f.velocityUpdateSubscribers.getSize()&&f.velocityUpdateSubscribers.notify(f.getVelocity()),c&&f.renderSubscribers.notify(f.current)},this.scheduleVelocityCheck=function(){return Wi.postRender(f.velocityCheck)},this.velocityCheck=function(s){var c=s.timestamp;c!==f.lastUpdated&&(f.prev=f.current,f.velocityUpdateSubscribers.notify(f.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=u,this.canTrackVelocity=jH(this.current)}return a.prototype.onChange=function(u){return this.updateSubscribers.add(u)},a.prototype.clearListeners=function(){this.updateSubscribers.clear()},a.prototype.onRenderRequest=function(u){return u(this.get()),this.renderSubscribers.add(u)},a.prototype.attach=function(u){this.passiveEffect=u},a.prototype.set=function(u,f){f===void 0&&(f=!0),!f||!this.passiveEffect?this.updateAndNotify(u,f):this.passiveEffect(u,this.updateAndNotify)},a.prototype.get=function(){return this.current},a.prototype.getPrevious=function(){return this.prev},a.prototype.getVelocity=function(){return this.canTrackVelocity?oC(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0},a.prototype.start=function(u){var f=this;return this.stop(),new Promise(function(s){f.hasAnimated=!0,f.stopAnimation=u(s)}).then(function(){return f.clearAnimation()})},a.prototype.stop=function(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()},a.prototype.isAnimating=function(){return!!this.stopAnimation},a.prototype.clearAnimation=function(){this.stopAnimation=null},a.prototype.destroy=function(){this.updateSubscribers.clear(),this.renderSubscribers.clear(),this.stop()},a}();function Ga(a){return new zH(a)}var yC=function(a){return function(u){return u.test(a)}},GH={test:function(a){return a==="auto"},parse:function(a){return a}},TC=[ka,wt,oc,aa,z4,j4,GH],gf=function(a){return TC.find(yC(a))},WH=Ar(Ar([],wn(TC)),[Cr,_o]),HH=function(a){return WH.find(yC(a))};function XH(a,u,f){a.hasValue(u)?a.getValue(u).set(f):a.addValue(u,Ga(f))}function YH(a,u){var f=$d(a,u),s=f?a.makeTargetAnimatable(f,!1):{},c=s.transitionEnd,T=c===void 0?{}:c;s.transition;var m=Xr(s,["transitionEnd","transition"]);m=st(st({},m),T);for(var E in m){var d=dW(m[E]);XH(a,E,d)}}function KH(a,u,f){var s,c,T,m,E=Object.keys(u).filter(function(_){return!a.hasValue(_)}),d=E.length;if(!!d)for(var x=0;x<d;x++){var M=E[x],w=u[M],S=null;Array.isArray(w)&&(S=w[0]),S===null&&(S=(c=(s=f[M])!==null&&s!==void 0?s:a.readValue(M))!==null&&c!==void 0?c:u[M]),S!=null&&(typeof S=="string"&&kH(S)?S=parseFloat(S):!HH(S)&&_o.test(w)&&(S=yv(M,w)),a.addValue(M,Ga(S)),(T=(m=f)[M])!==null&&T!==void 0||(m[M]=S),a.setBaseTarget(M,S))}}function QH(a,u){if(!!u){var f=u[a]||u.default||u;return f.from}}function qH(a,u,f){var s,c,T={};for(var m in a)T[m]=(s=QH(m,u))!==null&&s!==void 0?s:(c=f.getValue(m))===null||c===void 0?void 0:c.get();return T}function ZH(a,u,f){f===void 0&&(f={}),a.notifyAnimationStart();var s;if(Array.isArray(u)){var c=u.map(function(m){return Ev(a,m,f)});s=Promise.all(c)}else if(typeof u=="string")s=Ev(a,u,f);else{var T=typeof u=="function"?$d(a,u,f.custom):u;s=EC(a,T,f)}return s.then(function(){return a.notifyAnimationComplete(u)})}function Ev(a,u,f){var s;f===void 0&&(f={});var c=$d(a,u,f.custom),T=(c||{}).transition,m=T===void 0?a.getDefaultTransition()||{}:T;f.transitionOverride&&(m=f.transitionOverride);var E=c?function(){return EC(a,c,f)}:function(){return Promise.resolve()},d=((s=a.variantChildren)===null||s===void 0?void 0:s.size)?function(_){_===void 0&&(_=0);var O=m.delayChildren,R=O===void 0?0:O,I=m.staggerChildren,y=m.staggerDirection;return $H(a,u,R+_,I,y,f)}:function(){return Promise.resolve()},x=m.when;if(x){var M=wn(x==="beforeChildren"?[E,d]:[d,E],2),w=M[0],S=M[1];return w().then(S)}else return Promise.all([E(),d(f.delay)])}function EC(a,u,f){var s,c=f===void 0?{}:f,T=c.delay,m=T===void 0?0:T,E=c.transitionOverride,d=c.type,x=a.makeTargetAnimatable(u),M=x.transition,w=M===void 0?a.getDefaultTransition():M,S=x.transitionEnd,_=Xr(x,["transition","transitionEnd"]);E&&(w=E);var O=[],R=d&&((s=a.animationState)===null||s===void 0?void 0:s.getState()[d]);for(var I in _){var y=a.getValue(I),p=_[I];if(!(!y||p===void 0||R&&e5(R,I))){var g=mf(I,y,p,st({delay:m},w));O.push(g)}}return Promise.all(O).then(function(){S&&YH(a,S)})}function $H(a,u,f,s,c,T){f===void 0&&(f=0),s===void 0&&(s=0),c===void 0&&(c=1);var m=[],E=(a.variantChildren.size-1)*s,d=c===1?function(x){return x===void 0&&(x=0),x*s}:function(x){return x===void 0&&(x=0),E-x*s};return Array.from(a.variantChildren).sort(JH).forEach(function(x,M){m.push(Ev(x,u,st(st({},T),{delay:f+d(M)})).then(function(){return x.notifyAnimationComplete(u)}))}),Promise.all(m)}function JH(a,u){return a.sortNodePosition(u)}function e5(a,u){var f=a.protectedKeys,s=a.needsAnimating,c=f.hasOwnProperty(u)&&s[u]!==!0;return s[u]=!1,c}var Sv=[Vn.Animate,Vn.Hover,Vn.Tap,Vn.Drag,Vn.Focus,Vn.Exit],t5=Ar([],wn(Sv)).reverse(),n5=Sv.length;function r5(a){return function(u){return Promise.all(u.map(function(f){var s=f.animation,c=f.options;return ZH(a,s,c)}))}}function i5(a){var u=r5(a),f=a5(),s={},c=!0,T=function(M,w){var S=$d(a,w);if(S){S.transition;var _=S.transitionEnd,O=Xr(S,["transition","transitionEnd"]);M=st(st(st({},M),O),_)}return M};function m(M){return s[M]!==void 0}function E(M){u=M(a)}function d(M,w){for(var S,_=a.getProps(),O=a.getVariantContext(!0)||{},R=[],I=new Set,y={},p=1/0,g=function(U){var B=t5[U],L=f[B],z=(S=_[B])!==null&&S!==void 0?S:O[B],X=Ai(z),G=B===w?L.isActive:null;G===!1&&(p=U);var ee=z===O[B]&&z!==_[B]&&X;if(ee&&c&&a.manuallyAnimateOnMount&&(ee=!1),L.protectedKeys=st({},y),!L.isActive&&G===null||!z&&!L.prevProp||ov(z)||typeof z=="boolean")return"continue";var $=o5(L.prevProp,z)||B===w&&L.isActive&&!ee&&X||U>p&&X,fe=Array.isArray(z)?z:[z],me=fe.reduce(T,{});G===!1&&(me={});var ve=L.prevResolvedValues,be=ve===void 0?{}:ve,ie=st(st({},be),me),se=function(le){$=!0,I.delete(le),L.needsAnimating[le]=!0};for(var V in ie){var K=me[V],Z=be[V];y.hasOwnProperty(V)||(K!==Z?fu(K)&&fu(Z)?dC(K,Z)?L.protectedKeys[V]=!0:se(V):K!==void 0?se(V):I.add(V):K!==void 0&&I.has(V)?se(V):L.protectedKeys[V]=!0)}L.prevProp=z,L.prevResolvedValues=me,L.isActive&&(y=st(st({},y),me)),c&&a.blockInitialAnimation&&($=!1),$&&!ee&&R.push.apply(R,Ar([],wn(fe.map(function(le){return{animation:le,options:st({type:B},M)}}))))},C=0;C<n5;C++)g(C);if(s=st({},y),I.size){var P={};I.forEach(function(U){var B=a.getBaseTarget(U);B!==void 0&&(P[U]=B)}),R.push({animation:P})}var F=Boolean(R.length);return c&&_.initial===!1&&!a.manuallyAnimateOnMount&&(F=!1),c=!1,F?u(R):Promise.resolve()}function x(M,w,S){var _;return f[M].isActive===w?Promise.resolve():((_=a.variantChildren)===null||_===void 0||_.forEach(function(O){var R;return(R=O.animationState)===null||R===void 0?void 0:R.setActive(M,w)}),f[M].isActive=w,d(S,M))}return{isAnimated:m,animateChanges:d,setActive:x,setAnimateFunction:E,getState:function(){return f}}}function o5(a,u){return typeof u=="string"?u!==a:nA(u)?!dC(u,a):!1}function lc(a){return a===void 0&&(a=!1),{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function a5(){var a;return a={},a[Vn.Animate]=lc(!0),a[Vn.Hover]=lc(),a[Vn.Tap]=lc(),a[Vn.Drag]=lc(),a[Vn.Focus]=lc(),a[Vn.Exit]=lc(),a}var s5={animation:ja(function(a){var u=a.visualElement,f=a.animate;u.animationState||(u.animationState=i5(u)),ov(f)&&Ut(function(){return f.subscribe(u)},[f])}),exit:ja(function(a){var u=a.custom,f=a.visualElement,s=wn(Xg(),2),c=s[0],T=s[1],m=Jt(ru);Ut(function(){var E,d,x=(E=f.animationState)===null||E===void 0?void 0:E.setActive(Vn.Exit,!c,{custom:(d=m==null?void 0:m.custom)!==null&&d!==void 0?d:u});!c&&(x==null||x.then(T))},[c])})},SC=function(){function a(u,f,s){var c=this,T=s===void 0?{}:s,m=T.transformPagePoint;if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=function(){if(!!(c.lastMoveEvent&&c.lastMoveEventInfo)){var S=Pv(c.lastMoveEventInfo,c.history),_=c.startEvent!==null,O=sC(S.offset,{x:0,y:0})>=3;if(!(!_&&!O)){var R=S.point,I=Nd().timestamp;c.history.push(st(st({},R),{timestamp:I}));var y=c.handlers,p=y.onStart,g=y.onMove;_||(p&&p(c.lastMoveEvent,S),c.startEvent=c.lastMoveEvent),g&&g(c.lastMoveEvent,S)}}},this.handlePointerMove=function(S,_){if(c.lastMoveEvent=S,c.lastMoveEventInfo=xv(_,c.transformPagePoint),MA(S)&&S.buttons===0){c.handlePointerUp(S,_);return}Wi.update(c.updatePoint,!0)},this.handlePointerUp=function(S,_){c.end();var O=c.handlers,R=O.onEnd,I=O.onSessionEnd,y=Pv(xv(_,c.transformPagePoint),c.history);c.startEvent&&R&&R(S,y),I&&I(S,y)},!(IA(u)&&u.touches.length>1)){this.handlers=f,this.transformPagePoint=m;var E=cv(u),d=xv(E,this.transformPagePoint),x=d.point,M=Nd().timestamp;this.history=[st(st({},x),{timestamp:M})];var w=f.onSessionStart;w&&w(u,Pv(d,this.history)),this.removeListeners=mu(cc(window,"pointermove",this.handlePointerMove),cc(window,"pointerup",this.handlePointerUp),cc(window,"pointercancel",this.handlePointerUp))}}return a.prototype.updateHandlers=function(u){this.handlers=u},a.prototype.end=function(){this.removeListeners&&this.removeListeners(),jl.update(this.updatePoint)},a}();function xv(a,u){return u?{point:u(a.point)}:a}function xC(a,u){return{x:a.x-u.x,y:a.y-u.y}}function Pv(a,u){var f=a.point;return{point:f,delta:xC(f,PC(u)),offset:xC(f,c5(u)),velocity:l5(u,.1)}}function c5(a){return a[0]}function PC(a){return a[a.length-1]}function l5(a,u){if(a.length<2)return{x:0,y:0};for(var f=a.length-1,s=null,c=PC(a);f>=0&&(s=a[f],!(c.timestamp-s.timestamp>ff(u)));)f--;if(!s)return{x:0,y:0};var T=(c.timestamp-s.timestamp)/1e3;if(T===0)return{x:0,y:0};var m={x:(c.x-s.x)/T,y:(c.y-s.y)/T};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function u5(a){return a}function AC(a){var u=a.top,f=a.left,s=a.right,c=a.bottom;return{x:{min:f,max:s},y:{min:u,max:c}}}function h5(a){var u=a.x,f=a.y;return{top:f.min,bottom:f.max,left:u.min,right:u.max}}function d5(a,u){var f=a.top,s=a.left,c=a.bottom,T=a.right;u===void 0&&(u=u5);var m=u({x:s,y:f}),E=u({x:T,y:c});return{top:m.y,left:m.x,bottom:E.y,right:E.x}}function sa(){return{x:{min:0,max:1},y:{min:0,max:1}}}function f5(a){return{x:st({},a.x),y:st({},a.y)}}var CC={translate:0,scale:1,origin:0,originPoint:0};function RC(){return{x:st({},CC),y:st({},CC)}}function Fr(a){return[a("x"),a("y")]}function OC(a,u,f){var s=u.min,c=u.max;return s!==void 0&&a<s?a=f?Nr(s,a,f.min):Math.max(a,s):c!==void 0&&a>c&&(a=f?Nr(c,a,f.max):Math.min(a,c)),a}function p5(a,u,f,s,c){var T=a-u*f;return s?OC(T,s,c):T}function MC(a,u,f){return{min:u!==void 0?a.min+u:void 0,max:f!==void 0?a.max+f-(a.max-a.min):void 0}}function m5(a,u){var f=u.top,s=u.left,c=u.bottom,T=u.right;return{x:MC(a.x,s,T),y:MC(a.y,f,c)}}function IC(a,u){var f,s=u.min-a.min,c=u.max-a.max;return u.max-u.min<a.max-a.min&&(f=wn([c,s],2),s=f[0],c=f[1]),{min:a.min+s,max:a.min+c}}function _5(a,u){return{x:IC(a.x,u.x),y:IC(a.y,u.y)}}function g5(a,u,f){var s=a.max-a.min,c=Nr(u.min,u.max-s,f);return{min:c,max:c+s}}function v5(a,u){var f={};return u.min!==void 0&&(f.min=u.min-a.min),u.max!==void 0&&(f.max=u.max-a.min),f}var DC=.35;function b5(a){return a===!1?a=0:a===!0&&(a=DC),{x:wC(a,"left","right"),y:wC(a,"top","bottom")}}function wC(a,u,f){return{min:LC(a,u),max:LC(a,f)}}function LC(a,u){var f;return typeof a=="number"?a:(f=a[u])!==null&&f!==void 0?f:0}function NC(a,u){var f=a.getBoundingClientRect();return AC(d5(f,u))}var y5=function(a){return of(0,1,a)};function FC(a,u,f){return u===void 0&&(u=0),f===void 0&&(f=.01),sC(a,u)<f}function _u(a){return a.max-a.min}function T5(a,u){var f=.5,s=_u(a),c=_u(u);return c>s?f=pu(u.min,u.max-s,a.min):s>c&&(f=pu(a.min,a.max-c,u.min)),y5(f)}function BC(a,u,f,s){s===void 0&&(s=.5),a.origin=s,a.originPoint=Nr(u.min,u.max,a.origin),a.scale=_u(f)/_u(u),FC(a.scale,1,1e-4)&&(a.scale=1),a.translate=Nr(f.min,f.max,a.origin)-a.originPoint,FC(a.translate)&&(a.translate=0)}function UC(a,u,f,s){BC(a.x,u.x,f.x,VC(s.originX)),BC(a.y,u.y,f.y,VC(s.originY))}function VC(a){return typeof a=="number"?a:.5}function kC(a,u,f){a.min=f.min+u.min,a.max=a.min+_u(u)}function E5(a,u){kC(a.target.x,a.relativeTarget.x,u.target.x),kC(a.target.y,a.relativeTarget.y,u.target.y)}var Av=function(a,u){return a.depth-u.depth};function jC(a){var u=a.projection.isEnabled;return u||a.shouldResetTransform()}function vf(a,u){u===void 0&&(u=[]);var f=a.parent;return f&&vf(f,u),jC(a)&&u.push(a),u}function S5(a){var u=[],f=function(s){jC(s)&&u.push(s),s.children.forEach(f)};return a.children.forEach(f),u.sort(Av)}function bf(a){if(!a.shouldResetTransform()){var u=a.getLayoutState();a.notifyBeforeLayoutMeasure(u.layout),u.isHydrated=!0,u.layout=a.measureViewportBox(),u.layoutCorrected=f5(u.layout),a.notifyLayoutMeasure(u.layout,a.prevViewportBox||u.layout),Wi.update(function(){return a.rebaseProjectionTarget()})}}function x5(a){a.shouldResetTransform()||(a.prevViewportBox=a.measureViewportBox(!1),a.rebaseProjectionTarget(!1,a.prevViewportBox))}function P5(a,u,f,s){a.min=Nr(u.min,f.min,s),a.max=Nr(u.max,f.max,s)}function zC(a,u){return{min:u.min-a.min,max:u.max-a.min}}function uc(a,u){return{x:zC(a.x,u.x),y:zC(a.y,u.y)}}function A5(a,u){var f=a.getLayoutId(),s=u.getLayoutId();return f!==s||s===void 0&&a!==u}function GC(a){var u=a.getProps(),f=u.drag,s=u._dragX;return f&&!s}function WC(a,u){a.min=u.min,a.max=u.max}function C5(a,u){WC(a.x,u.x),WC(a.y,u.y)}function yf(a,u,f){var s=a-f,c=u*s;return f+c}function HC(a,u,f,s,c){return c!==void 0&&(a=yf(a,c,s)),yf(a,f,s)+u}function Cv(a,u,f,s,c){u===void 0&&(u=0),f===void 0&&(f=1),a.min=HC(a.min,u,f,s,c),a.max=HC(a.max,u,f,s,c)}function R5(a,u){var f=u.x,s=u.y;Cv(a.x,f.translate,f.scale,f.originPoint),Cv(a.y,s.translate,s.scale,s.originPoint)}function XC(a,u,f,s){var c=wn(s,3),T=c[0],m=c[1],E=c[2];a.min=u.min,a.max=u.max;var d=f[E]!==void 0?f[E]:.5,x=Nr(u.min,u.max,d);Cv(a,f[T],f[m],x,f.scale)}var YC=["x","scaleX","originX"],KC=["y","scaleY","originY"];function Rv(a,u,f){XC(a.x,u.x,f,YC),XC(a.y,u.y,f,KC)}function QC(a,u,f,s,c){return a-=u,a=yf(a,1/f,s),c!==void 0&&(a=yf(a,1/c,s)),a}function O5(a,u,f,s,c){u===void 0&&(u=0),f===void 0&&(f=1),s===void 0&&(s=.5);var T=Nr(a.min,a.max,s)-u;a.min=QC(a.min,u,f,T,c),a.max=QC(a.max,u,f,T,c)}function qC(a,u,f){var s=wn(f,3),c=s[0],T=s[1],m=s[2];O5(a,u[c],u[T],u[m],u.scale)}function ZC(a,u){qC(a.x,u,YC),qC(a.y,u,KC)}function M5(a,u,f){var s=f.length;if(!!s){u.x=u.y=1;for(var c,T,m=0;m<s;m++)c=f[m],T=c.getLayoutState().delta,u.x*=T.x.scale,u.y*=T.y.scale,R5(a,T),GC(c)&&Rv(a,a,c.getLatestValues())}}function I5(a,u){u===void 0&&(u=!0);var f=a.getProjectionParent();if(!f)return!1;var s;return u?(s=uc(f.projection.target,a.projection.target),ZC(s,f.getLatestValues())):s=uc(f.getLayoutState().layout,a.getLayoutState().layout),Fr(function(c){return a.setProjectionTargetAxis(c,s[c].min,s[c].max,!0)}),!0}var gu=new Set;function $C(a,u,f){a[f]||(a[f]=[]),a[f].push(u)}function Ov(a){return gu.add(a),function(){return gu.delete(a)}}function Mv(){if(!!gu.size){var a=0,u=[[]],f=[],s=function(E){return $C(u,E,a)},c=function(E){$C(f,E,a),a++};gu.forEach(function(E){E(s,c),a=0}),gu.clear();for(var T=f.length,m=0;m<=T;m++)u[m]&&u[m].forEach(JC),f[m]&&f[m].forEach(JC)}}var JC=function(a){return a()},D5=new WeakMap,eR,w5=function(){function a(u){var f=u.visualElement;this.isDragging=!1,this.currentDirection=null,this.constraints=!1,this.elastic=sa(),this.props={},this.hasMutatedConstraints=!1,this.cursorProgress={x:.5,y:.5},this.originPoint={},this.openGlobalLock=null,this.panSession=null,this.visualElement=f,this.visualElement.enableLayoutProjection(),D5.set(f,this)}return a.prototype.start=function(u,f){var s=this,c=f===void 0?{}:f,T=c.snapToCursor,m=T===void 0?!1:T,E=c.cursorProgress,d=function(_){var O;s.stopMotion();var R=xW(_).point;(O=s.cancelLayout)===null||O===void 0||O.call(s),s.cancelLayout=Ov(function(I,y){var p=vf(s.visualElement),g=S5(s.visualElement),C=Ar(Ar([],wn(p)),wn(g)),P=!1;s.isLayoutDrag()&&s.visualElement.lockProjectionTarget(),y(function(){C.forEach(function(F){return F.resetTransform()})}),I(function(){bf(s.visualElement),g.forEach(bf)}),y(function(){C.forEach(function(F){return F.restoreTransform()}),m&&(P=s.snapToCursor(R))}),I(function(){var F=Boolean(s.getAxisMotionValue("x")&&!s.isExternalDrag());F||s.visualElement.rebaseProjectionTarget(!0,s.visualElement.measureViewportBox(!1)),s.visualElement.scheduleUpdateLayoutProjection();var U=s.visualElement.projection;Fr(function(B){if(!P){var L=U.target[B],z=L.min,X=L.max;s.cursorProgress[B]=E?E[B]:pu(z,X,R[B])}var G=s.getAxisMotionValue(B);G&&(s.originPoint[B]=G.get())})}),y(function(){Zs.update(),Zs.preRender(),Zs.render(),Zs.postRender()}),I(function(){return s.resolveDragConstraints()})})},x=function(_,O){var R,I,y,p=s.props,g=p.drag,C=p.dragPropagation;g&&!C&&(s.openGlobalLock&&s.openGlobalLock(),s.openGlobalLock=BA(g),!s.openGlobalLock)||(Mv(),s.isDragging=!0,s.currentDirection=null,(I=(R=s.props).onDragStart)===null||I===void 0||I.call(R,_,O),(y=s.visualElement.animationState)===null||y===void 0||y.setActive(Vn.Drag,!0))},M=function(_,O){var R,I,y,p,g=s.props,C=g.dragPropagation,P=g.dragDirectionLock;if(!(!C&&!s.openGlobalLock)){var F=O.offset;if(P&&s.currentDirection===null){s.currentDirection=L5(F),s.currentDirection!==null&&((I=(R=s.props).onDirectionLock)===null||I===void 0||I.call(R,s.currentDirection));return}s.updateAxis("x",O.point,F),s.updateAxis("y",O.point,F),(p=(y=s.props).onDrag)===null||p===void 0||p.call(y,_,O),eR=_}},w=function(_,O){return s.stop(_,O)},S=this.props.transformPagePoint;this.panSession=new SC(u,{onSessionStart:d,onStart:x,onMove:M,onSessionEnd:w},{transformPagePoint:S})},a.prototype.resolveDragConstraints=function(){var u=this,f=this.props,s=f.dragConstraints,c=f.dragElastic,T=this.visualElement.getLayoutState().layoutCorrected;s?this.constraints=Yg(s)?this.resolveRefConstraints(T,s):m5(T,s):this.constraints=!1,this.elastic=b5(c),this.constraints&&!this.hasMutatedConstraints&&Fr(function(m){u.getAxisMotionValue(m)&&(u.constraints[m]=v5(T[m],u.constraints[m]))})},a.prototype.resolveRefConstraints=function(u,f){var s=this.props,c=s.onMeasureDragConstraints,T=s.transformPagePoint,m=f.current;this.constraintsBox=NC(m,T);var E=_5(u,this.constraintsBox);if(c){var d=c(h5(E));this.hasMutatedConstraints=!!d,d&&(E=AC(d))}return E},a.prototype.cancelDrag=function(){var u,f;this.visualElement.unlockProjectionTarget(),(u=this.cancelLayout)===null||u===void 0||u.call(this),this.isDragging=!1,this.panSession&&this.panSession.end(),this.panSession=null,!this.props.dragPropagation&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(f=this.visualElement.animationState)===null||f===void 0||f.setActive(Vn.Drag,!1)},a.prototype.stop=function(u,f){var s,c,T;(s=this.panSession)===null||s===void 0||s.end(),this.panSession=null;var m=this.isDragging;if(this.cancelDrag(),!!m){var E=f.velocity;this.animateDragEnd(E),(T=(c=this.props).onDragEnd)===null||T===void 0||T.call(c,u,f)}},a.prototype.snapToCursor=function(u){var f=this;return Fr(function(s){var c=f.props.drag;if(!!Tf(s,c,f.currentDirection)){var T=f.getAxisMotionValue(s);if(T){var m=f.visualElement.getLayoutState().layout,E=m[s].max-m[s].min,d=m[s].min+E/2,x=u[s]-d;f.originPoint[s]=u[s],T.set(x)}else return f.cursorProgress[s]=.5,!0}}).includes(!0)},a.prototype.updateAxis=function(u,f,s){var c=this.props.drag;if(!!Tf(u,c,this.currentDirection))return this.getAxisMotionValue(u)?this.updateAxisMotionValue(u,s):this.updateVisualElementAxis(u,f)},a.prototype.updateAxisMotionValue=function(u,f){var s=this.getAxisMotionValue(u);if(!(!f||!s)){var c=this.originPoint[u]+f[u],T=this.constraints?OC(c,this.constraints[u],this.elastic[u]):c;s.set(T)}},a.prototype.updateVisualElementAxis=function(u,f){var s,c=this.visualElement.getLayoutState().layout[u],T=c.max-c.min,m=this.cursorProgress[u],E=p5(f[u],T,m,(s=this.constraints)===null||s===void 0?void 0:s[u],this.elastic[u]);this.visualElement.setProjectionTargetAxis(u,E,E+T)},a.prototype.setProps=function(u){var f=u.drag,s=f===void 0?!1:f,c=u.dragDirectionLock,T=c===void 0?!1:c,m=u.dragPropagation,E=m===void 0?!1:m,d=u.dragConstraints,x=d===void 0?!1:d,M=u.dragElastic,w=M===void 0?DC:M,S=u.dragMomentum,_=S===void 0?!0:S,O=Xr(u,["drag","dragDirectionLock","dragPropagation","dragConstraints","dragElastic","dragMomentum"]);this.props=st({drag:s,dragDirectionLock:T,dragPropagation:E,dragConstraints:x,dragElastic:w,dragMomentum:_},O)},a.prototype.getAxisMotionValue=function(u){var f=this.props,s=f.layout,c=f.layoutId,T="_drag"+u.toUpperCase();if(this.props[T])return this.props[T];if(!s&&c===void 0)return this.visualElement.getValue(u,0)},a.prototype.isLayoutDrag=function(){return!this.getAxisMotionValue("x")},a.prototype.isExternalDrag=function(){var u=this.props,f=u._dragX,s=u._dragY;return f||s},a.prototype.animateDragEnd=function(u){var f=this,s=this.props,c=s.drag,T=s.dragMomentum,m=s.dragElastic,E=s.dragTransition,d=I5(this.visualElement,this.isLayoutDrag()&&!this.isExternalDrag()),x=this.constraints||{};if(d&&Object.keys(x).length&&this.isLayoutDrag()){var M=this.visualElement.getProjectionParent();if(M){var w=uc(M.projection.targetFinal,x);Fr(function(_){var O=w[_],R=O.min,I=O.max;x[_]={min:isNaN(R)?void 0:R,max:isNaN(I)?void 0:I}})}}var S=Fr(function(_){var O;if(!!Tf(_,c,f.currentDirection)){var R=(O=x==null?void 0:x[_])!==null&&O!==void 0?O:{},I=m?200:1e6,y=m?40:1e7,p=st(st({type:"inertia",velocity:T?u[_]:0,bounceStiffness:I,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10},E),R);return f.getAxisMotionValue(_)?f.startAxisValueAnimation(_,p):f.visualElement.startLayoutAnimation(_,p,d)}});return Promise.all(S).then(function(){var _,O;(O=(_=f.props).onDragTransitionEnd)===null||O===void 0||O.call(_)})},a.prototype.stopMotion=function(){var u=this;Fr(function(f){var s=u.getAxisMotionValue(f);s?s.stop():u.visualElement.stopLayoutAnimation()})},a.prototype.startAxisValueAnimation=function(u,f){var s=this.getAxisMotionValue(u);if(!!s){var c=s.get();return s.set(c),s.set(c),mf(u,s,0,f)}},a.prototype.scalePoint=function(){var u=this,f=this.props,s=f.drag,c=f.dragConstraints;if(!(!Yg(c)||!this.constraintsBox)){this.stopMotion();var T={x:0,y:0};Fr(function(m){T[m]=T5(u.visualElement.projection.target[m],u.constraintsBox[m])}),this.updateConstraints(function(){Fr(function(m){if(!!Tf(m,s,null)){var E=g5(u.visualElement.projection.target[m],u.constraintsBox[m],T[m]),d=E.min,x=E.max;u.visualElement.setProjectionTargetAxis(m,d,x)}})}),setTimeout(Mv,1)}},a.prototype.updateConstraints=function(u){var f=this;this.cancelLayout=Ov(function(s,c){var T=vf(f.visualElement);c(function(){return T.forEach(function(m){return m.resetTransform()})}),s(function(){return bf(f.visualElement)}),c(function(){return T.forEach(function(m){return m.restoreTransform()})}),s(function(){f.resolveDragConstraints()}),u&&c(u)})},a.prototype.mount=function(u){var f=this,s=u.getInstance(),c=cc(s,"pointerdown",function(d){var x=f.props,M=x.drag,w=x.dragListener,S=w===void 0?!0:w;M&&S&&f.start(d)}),T=av(window,"resize",function(){f.scalePoint()}),m=u.onLayoutUpdate(function(){f.isDragging&&f.resolveDragConstraints()}),E=u.prevDragCursor;return E&&this.start(eR,{cursorProgress:E}),function(){c==null||c(),T==null||T(),m==null||m(),f.cancelDrag()}},a}();function Tf(a,u,f){return(u===!0||u===a)&&(f===null||f===a)}function L5(a,u){u===void 0&&(u=10);var f=null;return Math.abs(a.y)>u?f="y":Math.abs(a.x)>u&&(f="x"),f}function N5(a){var u=a.dragControls,f=a.visualElement,s=Jt(qd).transformPagePoint,c=iu(function(){return new w5({visualElement:f})});c.setProps(st(st({},a),{transformPagePoint:s})),Ut(function(){return u&&u.subscribe(c)},[c]),Ut(function(){return c.mount(f)},[])}function F5(a){var u=a.onPan,f=a.onPanStart,s=a.onPanEnd,c=a.onPanSessionStart,T=a.visualElement,m=u||f||s||c,E=Nt(null),d=Jt(qd).transformPagePoint,x={onSessionStart:c,onStart:f,onMove:u,onEnd:function(w,S){E.current=null,s&&s(w,S)}};Ut(function(){E.current!==null&&E.current.updateHandlers(x)});function M(w){E.current=new SC(w,x,{transformPagePoint:d})}rf(T,"pointerdown",m&&M),lv(function(){return E.current&&E.current.end()})}var B5={pan:ja(F5),drag:ja(N5)},vu;(function(a){a[a.Entering=0]="Entering",a[a.Present=1]="Present",a[a.Exiting=2]="Exiting"})(vu||(vu={}));var Iv;(function(a){a[a.Hide=0]="Hide",a[a.Show=1]="Show"})(Iv||(Iv={}));function Dv(a){return typeof a=="string"&&a.startsWith("var(--")}var tR=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function U5(a){var u=tR.exec(a);if(!u)return[,];var f=wn(u,3),s=f[1],c=f[2];return[s,c]}function wv(a,u,f){var s=wn(U5(a),2),c=s[0],T=s[1];if(!!c){var m=window.getComputedStyle(u).getPropertyValue(c);return m?m.trim():Dv(T)?wv(T,u):T}}function V5(a,u,f){var s,c=Xr(u,[]),T=a.getInstance();if(!(T instanceof HTMLElement))return{target:c,transitionEnd:f};f&&(f=st({},f)),a.forEachValue(function(x){var M=x.get();if(!!Dv(M)){var w=wv(M,T);w&&x.set(w)}});for(var m in c){var E=c[m];if(!!Dv(E)){var d=wv(E,T);!d||(c[m]=d,f&&((s=f[m])!==null&&s!==void 0||(f[m]=E)))}}return{target:c,transitionEnd:f}}function nR(a,u){return a/(u.max-u.min)*100}function k5(a,u,f){var s=f.target;if(typeof a=="string")if(wt.test(a))a=parseFloat(a);else return a;var c=nR(a,s.x),T=nR(a,s.y);return c+"% "+T+"%"}var rR="_$css";function j5(a,u){var f=u.delta,s=u.treeScale,c=a,T=a.includes("var("),m=[];T&&(a=a.replace(tR,function(R){return m.push(R),rR}));var E=_o.parse(a);if(E.length>5)return c;var d=_o.createTransformer(a),x=typeof E[0]!="number"?1:0,M=f.x.scale*s.x,w=f.y.scale*s.y;E[0+x]/=M,E[1+x]/=w;var S=Nr(M,w,.5);typeof E[2+x]=="number"&&(E[2+x]/=S),typeof E[3+x]=="number"&&(E[3+x]/=S);var _=d(E);if(T){var O=0;_=_.replace(rR,function(){var R=m[O];return O++,R})}return _}var bu={process:k5},z5={borderRadius:st(st({},bu),{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:bu,borderTopRightRadius:bu,borderBottomLeftRadius:bu,borderBottomRightRadius:bu,boxShadow:{process:j5}},iR=1e3,G5=function(a){$P(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.frameTarget=sa(),f.currentAnimationTarget=sa(),f.isAnimating={x:!1,y:!1},f.stopAxisAnimation={x:void 0,y:void 0},f.isAnimatingTree=!1,f.animate=function(s,c,T){T===void 0&&(T={});var m=T.originBox,E=T.targetBox,d=T.visibilityAction,x=T.shouldStackAnimate,M=T.onComplete,w=T.prevParent,S=Xr(T,["originBox","targetBox","visibilityAction","shouldStackAnimate","onComplete","prevParent"]),_=f.props,O=_.visualElement,R=_.layout;if(x===!1)return f.isAnimatingTree=!1,f.safeToRemove();if(!(f.isAnimatingTree&&x!==!0)){x&&(f.isAnimatingTree=!0),c=m||c,s=E||s;var I=!1,y=O.getProjectionParent();if(y){var p=y.prevViewportBox,g=y.getLayoutState().layout;w&&(E&&(g=w.getLayoutState().layout),m&&!A5(w,y)&&w.prevViewportBox&&(p=w.prevViewportBox)),p&&Y5(w,m,E)&&(I=!0,c=uc(p,c),s=uc(g,s))}var C=H5(c,s),P=Fr(function(F){var U,B;if(R==="position"){var L=s[F].max-s[F].min;c[F].max=c[F].min+L}if(!O.projection.isTargetLocked)if(d!==void 0)O.setVisibility(d===Iv.Show);else return C?f.animateAxis(F,s[F],c[F],st(st({},S),{isRelative:I})):((B=(U=f.stopAxisAnimation)[F])===null||B===void 0||B.call(U),O.setProjectionTargetAxis(F,s[F].min,s[F].max,I))});return O.syncRender(),Promise.all(P).then(function(){f.isAnimatingTree=!1,M&&M(),O.notifyLayoutAnimationComplete()})}},f}return u.prototype.componentDidMount=function(){var f=this,s=this.props.visualElement;s.animateMotionValue=mf,s.enableLayoutProjection(),this.unsubLayoutReady=s.onLayoutUpdate(this.animate),s.layoutSafeToRemove=function(){return f.safeToRemove()},M4(z5)},u.prototype.componentWillUnmount=function(){var f=this;this.unsubLayoutReady(),Fr(function(s){var c,T;return(T=(c=f.stopAxisAnimation)[s])===null||T===void 0?void 0:T.call(c)})},u.prototype.animateAxis=function(f,s,c,T){var m=this,E,d,x=T===void 0?{}:T,M=x.transition,w=x.isRelative;if(!(this.isAnimating[f]&&yu(s,this.currentAnimationTarget[f]))){(d=(E=this.stopAxisAnimation)[f])===null||d===void 0||d.call(E),this.isAnimating[f]=!0;var S=this.props.visualElement,_=this.frameTarget[f],O=S.getProjectionAnimationProgress()[f];O.clearListeners(),O.set(0),O.set(0);var R=function(){var g=O.get()/iR;P5(_,c,s,g),S.setProjectionTargetAxis(f,_.min,_.max,w)};R();var I=O.onChange(R);this.stopAxisAnimation[f]=function(){m.isAnimating[f]=!1,O.stop(),I()},this.currentAnimationTarget[f]=s;var y=M||S.getDefaultTransition()||X5,p=mf(f==="x"?"layoutX":"layoutY",O,iR,y&&Tv(y,"layout")).then(this.stopAxisAnimation[f]);return p}},u.prototype.safeToRemove=function(){var f,s;(s=(f=this.props).safeToRemove)===null||s===void 0||s.call(f)},u.prototype.render=function(){return null},u}(ii);function W5(a){var u=wn(Xg(),2),f=u[1];return Ye(G5,st({},a,{safeToRemove:f}))}function H5(a,u){return!aR(a)&&!aR(u)&&(!yu(a.x,u.x)||!yu(a.y,u.y))}var oR={min:0,max:0};function aR(a){return yu(a.x,oR)&&yu(a.y,oR)}function yu(a,u){return a.min===u.min&&a.max===u.max}var X5={duration:.45,ease:[.4,0,.1,1]};function Y5(a,u,f){return a||!a&&!(u||f)}var K5={layoutReady:function(a){return a.notifyLayoutReady()}};function sR(){var a=new Set;return{add:function(u){return a.add(u)},flush:function(u){var f=u===void 0?K5:u,s=f.layoutReady,c=f.parent;Ov(function(T,m){var E=Array.from(a).sort(Av),d=c?vf(c):[];m(function(){var x=Ar(Ar([],wn(d)),wn(E));x.forEach(function(M){return M.resetTransform()})}),T(function(){E.forEach(bf)}),m(function(){d.forEach(function(x){return x.restoreTransform()}),E.forEach(s)}),T(function(){E.forEach(function(x){x.isPresent&&(x.presence=vu.Present)})}),m(function(){Zs.preRender(),Zs.render()}),T(function(){Wi.postRender(function(){return E.forEach(Q5)}),a.clear()})}),Mv()}}}function Q5(a){a.prevViewportBox=a.projection.target}var cR=fr(sR()),q5=fr(sR());function Wa(a){return!!a.forceUpdate}var Z5=function(a){$P(u,a);function u(){return a!==null&&a.apply(this,arguments)||this}return u.prototype.componentDidMount=function(){var f=this.props,s=f.syncLayout,c=f.framerSyncLayout,T=f.visualElement;Wa(s)&&s.register(T),Wa(c)&&c.register(T),T.onUnmount(function(){Wa(s)&&s.remove(T),Wa(c)&&c.remove(T)})},u.prototype.getSnapshotBeforeUpdate=function(){var f=this.props,s=f.syncLayout,c=f.visualElement;return Wa(s)?s.syncUpdate():(x5(c),s.add(c)),null},u.prototype.componentDidUpdate=function(){var f=this.props.syncLayout;Wa(f)||f.flush()},u.prototype.render=function(){return null},u}(oi.Component);function $5(a){var u=Jt(cR),f=Jt(q5);return oi.createElement(Z5,st({},a,{syncLayout:u,framerSyncLayout:f}))}var J5={measureLayout:$5,layoutAnimation:W5},eX=function(){return{isEnabled:!1,isHydrated:!1,isTargetLocked:!1,target:sa(),targetFinal:sa()}};function lR(){return{isHydrated:!1,layout:sa(),layoutCorrected:sa(),treeScale:{x:1,y:1},delta:RC(),deltaFinal:RC(),deltaTransform:""}}var uR=lR();function Ef(a,u,f){var s=a.x,c=a.y,T=s.translate/u.x,m=c.translate/u.y,E="translate3d("+T+"px, "+m+"px, 0) ";if(f){var d=f.rotate,x=f.rotateX,M=f.rotateY;d&&(E+="rotate("+d+") "),x&&(E+="rotateX("+x+") "),M&&(E+="rotateY("+M+") ")}return E+="scale("+s.scale+", "+c.scale+")",!f&&E===tX?"":E}function hR(a){var u=a.deltaFinal;return u.x.origin*100+"% "+u.y.origin*100+"% 0"}var tX=Ef(uR.delta,uR.treeScale,{x:1,y:1}),Sf=["LayoutMeasure","BeforeLayoutMeasure","LayoutUpdate","ViewportBoxUpdate","Update","Render","AnimationComplete","LayoutAnimationComplete","AnimationStart","SetAxisTarget","Unmount"];function nX(){var a=Sf.map(function(){return new _f}),u={},f={clearAllListeners:function(){return a.forEach(function(s){return s.clear()})},updatePropListeners:function(s){return Sf.forEach(function(c){var T;(T=u[c])===null||T===void 0||T.call(u);var m="on"+c,E=s[m];E&&(u[c]=f[m](E))})}};return a.forEach(function(s,c){f["on"+Sf[c]]=function(T){return s.add(T)},f["notify"+Sf[c]]=function(){for(var T=[],m=0;m<arguments.length;m++)T[m]=arguments[m];return s.notify.apply(s,Ar([],wn(T)))}}),f}function rX(a,u,f){var s;for(var c in u){var T=u[c],m=f[c];if(oa(T))a.addValue(c,T);else if(oa(m))a.addValue(c,Ga(T));else if(m!==T)if(a.hasValue(c)){var E=a.getValue(c);!E.hasAnimated&&E.set(T)}else a.addValue(c,Ga((s=a.getStaticValue(c))!==null&&s!==void 0?s:T))}for(var c in f)u[c]===void 0&&a.removeValue(c);return u}function iX(a,u,f,s){var c=a.delta,T=a.layout,m=a.layoutCorrected,E=a.treeScale,d=u.target;C5(m,T),M5(m,E,f),UC(c,m,d,s)}var oX=function(){function a(){this.children=[],this.isDirty=!1}return a.prototype.add=function(u){vC(this.children,u),this.isDirty=!0},a.prototype.remove=function(u){bC(this.children,u),this.isDirty=!0},a.prototype.forEach=function(u){this.isDirty&&this.children.sort(Av),this.isDirty=!1,this.children.forEach(u)},a}();function aX(a){var u=a.getProjectionParent();if(!u){a.rebaseProjectionTarget();return}var f=uc(u.getLayoutState().layout,a.getLayoutState().layout);Fr(function(s){a.setProjectionTargetAxis(s,f[s].min,f[s].max,!0)})}var dR=function(a){var u=a.treeType,f=u===void 0?"":u,s=a.build,c=a.getBaseTarget,T=a.makeTargetAnimatable,m=a.measureViewportBox,E=a.render,d=a.readValueFromInstance,x=a.resetTransform,M=a.restoreTransform,w=a.removeValueFromRenderState,S=a.sortNodePosition,_=a.scrapeMotionValuesFromProps;return function(O,R){var I=O.parent,y=O.props,p=O.presenceId,g=O.blockInitialAnimation,C=O.visualState;R===void 0&&(R={});var P=C.latestValues,F=C.renderState,U,B=nX(),L=eX(),z,X=L,G=P,ee,$=lR(),fe,me=!1,ve=new Map,be=new Map,ie={},se,V=st({},P),K;function Z(){!U||(ge.isProjectionReady()&&(Rv(X.targetFinal,X.target,G),UC($.deltaFinal,$.layoutCorrected,X.targetFinal,P)),le(),E(U,F))}function le(){var ne=P;if(fe&&fe.isActive()){var Te=fe.getCrossfadeState(ge);Te&&(ne=Te)}s(ge,F,ne,X,$,R,y)}function re(){B.notifyUpdate(P)}function Q(){if(!!ge.isProjectionReady()){var ne=$.delta,Te=$.treeScale,we=Te.x,Se=Te.y,Ge=$.deltaTransform;iX($,X,ge.path,P),me&&ge.notifyViewportBoxUpdate(X.target,ne),me=!1;var $e=Ef(ne,Te);($e!==Ge||we!==Te.x||Se!==Te.y)&&ge.scheduleRender(),$.deltaTransform=$e}}function W(){ge.layoutTree.forEach(cX)}function Y(ne,Te){var we=Te.onChange(function(Ge){P[ne]=Ge,y.onUpdate&&Wi.update(re,!1,!0)}),Se=Te.onRenderRequest(ge.scheduleRender);be.set(ne,function(){we(),Se()})}var q=_(y);for(var ae in q){var pe=q[ae];P[ae]!==void 0&&oa(pe)&&pe.set(P[ae],!1)}var De=Jd(y),de=iA(y),ge=st(st({treeType:f,current:null,depth:I?I.depth+1:0,parent:I,children:new Set,path:I?Ar(Ar([],wn(I.path)),[I]):[],layoutTree:I?I.layoutTree:new oX,presenceId:p,projection:L,variantChildren:de?new Set:void 0,isVisible:void 0,manuallyAnimateOnMount:Boolean(I==null?void 0:I.isMounted()),blockInitialAnimation:g,isMounted:function(){return Boolean(U)},mount:function(ne){U=ge.current=ne,ge.pointTo(ge),de&&I&&!De&&(K=I==null?void 0:I.addVariantChild(ge)),I==null||I.children.add(ge)},unmount:function(){jl.update(re),jl.render(Z),jl.preRender(ge.updateLayoutProjection),be.forEach(function(ne){return ne()}),ge.stopLayoutAnimation(),ge.layoutTree.remove(ge),K==null||K(),I==null||I.children.delete(ge),ee==null||ee(),B.clearAllListeners()},addVariantChild:function(ne){var Te,we=ge.getClosestVariantNode();if(we)return(Te=we.variantChildren)===null||Te===void 0||Te.add(ne),function(){return we.variantChildren.delete(ne)}},sortNodePosition:function(ne){return!S||f!==ne.treeType?0:S(ge.getInstance(),ne.getInstance())},getClosestVariantNode:function(){return de?ge:I==null?void 0:I.getClosestVariantNode()},scheduleUpdateLayoutProjection:I?I.scheduleUpdateLayoutProjection:function(){return Wi.preRender(ge.updateTreeLayoutProjection,!1,!0)},getLayoutId:function(){return y.layoutId},getInstance:function(){return U},getStaticValue:function(ne){return P[ne]},setStaticValue:function(ne,Te){return P[ne]=Te},getLatestValues:function(){return P},setVisibility:function(ne){ge.isVisible!==ne&&(ge.isVisible=ne,ge.scheduleRender())},makeTargetAnimatable:function(ne,Te){return Te===void 0&&(Te=!0),T(ge,ne,y,Te)},addValue:function(ne,Te){ge.hasValue(ne)&&ge.removeValue(ne),ve.set(ne,Te),P[ne]=Te.get(),Y(ne,Te)},removeValue:function(ne){var Te;ve.delete(ne),(Te=be.get(ne))===null||Te===void 0||Te(),be.delete(ne),delete P[ne],w(ne,F)},hasValue:function(ne){return ve.has(ne)},getValue:function(ne,Te){var we=ve.get(ne);return we===void 0&&Te!==void 0&&(we=Ga(Te),ge.addValue(ne,we)),we},forEachValue:function(ne){return ve.forEach(ne)},readValue:function(ne){var Te;return(Te=P[ne])!==null&&Te!==void 0?Te:d(U,ne,R)},setBaseTarget:function(ne,Te){V[ne]=Te},getBaseTarget:function(ne){if(c){var Te=c(y,ne);if(Te!==void 0&&!oa(Te))return Te}return V[ne]}},B),{build:function(){return le(),F},scheduleRender:function(){Wi.render(Z,!1,!0)},syncRender:Z,setProps:function(ne){y=ne,B.updatePropListeners(ne),ie=rX(ge,_(y),ie)},getProps:function(){return y},getVariant:function(ne){var Te;return(Te=y.variants)===null||Te===void 0?void 0:Te[ne]},getDefaultTransition:function(){return y.transition},getVariantContext:function(ne){if(ne===void 0&&(ne=!1),ne)return I==null?void 0:I.getVariantContext();if(!De){var Te=(I==null?void 0:I.getVariantContext())||{};return y.initial!==void 0&&(Te.initial=y.initial),Te}for(var we={},Se=0;Se<lX;Se++){var Ge=fR[Se],$e=y[Ge];(Ai($e)||$e===!1)&&(we[Ge]=$e)}return we},enableLayoutProjection:function(){L.isEnabled=!0,ge.layoutTree.add(ge)},lockProjectionTarget:function(){L.isTargetLocked=!0},unlockProjectionTarget:function(){ge.stopLayoutAnimation(),L.isTargetLocked=!1},getLayoutState:function(){return $},setCrossfader:function(ne){fe=ne},isProjectionReady:function(){return L.isEnabled&&L.isHydrated&&$.isHydrated},startLayoutAnimation:function(ne,Te,we){we===void 0&&(we=!1);var Se=ge.getProjectionAnimationProgress()[ne],Ge=we?L.relativeTarget[ne]:L.target[ne],$e=Ge.min,nt=Ge.max,et=nt-$e;return Se.clearListeners(),Se.set($e),Se.set($e),Se.onChange(function(Ze){ge.setProjectionTargetAxis(ne,Ze,Ze+et,we)}),ge.animateMotionValue(ne,Se,0,Te)},stopLayoutAnimation:function(){Fr(function(ne){return ge.getProjectionAnimationProgress()[ne].stop()})},measureViewportBox:function(ne){ne===void 0&&(ne=!0);var Te=m(U,R);return ne||ZC(Te,P),Te},getProjectionAnimationProgress:function(){return se||(se={x:Ga(0),y:Ga(0)}),se},setProjectionTargetAxis:function(ne,Te,we,Se){Se===void 0&&(Se=!1);var Ge;Se?(L.relativeTarget||(L.relativeTarget=sa()),Ge=L.relativeTarget[ne]):(L.relativeTarget=void 0,Ge=L.target[ne]),L.isHydrated=!0,Ge.min=Te,Ge.max=we,me=!0,B.notifySetAxisTarget()},rebaseProjectionTarget:function(ne,Te){Te===void 0&&(Te=$.layout);var we=ge.getProjectionAnimationProgress(),Se=we.x,Ge=we.y,$e=!L.relativeTarget&&!L.isTargetLocked&&!Se.isAnimating()&&!Ge.isAnimating();(ne||$e)&&Fr(function(nt){var et=Te[nt],Ze=et.min,ht=et.max;ge.setProjectionTargetAxis(nt,Ze,ht)})},notifyLayoutReady:function(ne){aX(ge),ge.notifyLayoutUpdate($.layout,ge.prevViewportBox||$.layout,ne)},resetTransform:function(){return x(ge,U,y)},restoreTransform:function(){return M(U,F)},updateLayoutProjection:Q,updateTreeLayoutProjection:function(){ge.layoutTree.forEach(sX),Wi.preRender(W,!1,!0)},getProjectionParent:function(){if(z===void 0){for(var ne=!1,Te=ge.path.length-1;Te>=0;Te--){var we=ge.path[Te];if(we.projection.isEnabled){ne=we;break}}z=ne}return z},resolveRelativeTargetBox:function(){var ne=ge.getProjectionParent();if(!(!L.relativeTarget||!ne)&&(E5(L,ne.projection),GC(ne))){var Te=L.target;Rv(Te,Te,ne.getLatestValues())}},shouldResetTransform:function(){return Boolean(y._layoutResetTransform)},pointTo:function(ne){X=ne.projection,G=ne.getLatestValues(),ee==null||ee(),ee=mu(ne.onSetAxisTarget(ge.scheduleUpdateLayoutProjection),ne.onLayoutAnimationComplete(function(){var Te;ge.isPresent?ge.presence=vu.Present:(Te=ge.layoutSafeToRemove)===null||Te===void 0||Te.call(ge)}))},isPresent:!0,presence:vu.Entering});return ge}};function sX(a){a.resolveRelativeTargetBox()}function cX(a){a.updateLayoutProjection()}var fR=Ar(["initial"],wn(Sv)),lX=fR.length,uX=new Set(["width","height","top","left","right","bottom","x","y"]),pR=function(a){return uX.has(a)},hX=function(a){return Object.keys(a).some(pR)},mR=function(a,u){a.set(u,!1),a.set(u)},_R=function(a){return a===ka||a===wt},gR;(function(a){a.width="width",a.height="height",a.left="left",a.right="right",a.top="top",a.bottom="bottom"})(gR||(gR={}));var vR=function(a,u){return parseFloat(a.split(", ")[u])},bR=function(a,u){return function(f,s){var c=s.transform;if(c==="none"||!c)return 0;var T=c.match(/^matrix3d\((.+)\)$/);if(T)return vR(T[1],u);var m=c.match(/^matrix\((.+)\)$/);return m?vR(m[1],a):0}},dX=new Set(["x","y","z"]),fX=su.filter(function(a){return!dX.has(a)});function pX(a){var u=[];return fX.forEach(function(f){var s=a.getValue(f);s!==void 0&&(u.push([f,s.get()]),s.set(f.startsWith("scale")?1:0))}),u.length&&a.syncRender(),u}var yR={width:function(a){var u=a.x;return u.max-u.min},height:function(a){var u=a.y;return u.max-u.min},top:function(a,u){var f=u.top;return parseFloat(f)},left:function(a,u){var f=u.left;return parseFloat(f)},bottom:function(a,u){var f=a.y,s=u.top;return parseFloat(s)+(f.max-f.min)},right:function(a,u){var f=a.x,s=u.left;return parseFloat(s)+(f.max-f.min)},x:bR(4,13),y:bR(5,14)},mX=function(a,u,f){var s=u.measureViewportBox(),c=u.getInstance(),T=getComputedStyle(c),m=T.display,E=T.top,d=T.left,x=T.bottom,M=T.right,w=T.transform,S={top:E,left:d,bottom:x,right:M,transform:w};m==="none"&&u.setStaticValue("display",a.display||"block"),u.syncRender();var _=u.measureViewportBox();return f.forEach(function(O){var R=u.getValue(O);mR(R,yR[O](s,S)),a[O]=yR[O](_,T)}),a},_X=function(a,u,f,s){f===void 0&&(f={}),s===void 0&&(s={}),u=st({},u),s=st({},s);var c=Object.keys(u).filter(pR),T=[],m=!1,E=[];if(c.forEach(function(x){var M=a.getValue(x);if(!!a.hasValue(x)){var w=f[x],S=u[x],_=gf(w),O;if(fu(S))for(var R=S.length,I=S[0]===null?1:0;I<R;I++)O?nu(gf(S[I])===O):O=gf(S[I]);else O=gf(S);if(_!==O)if(_R(_)&&_R(O)){var y=M.get();typeof y=="string"&&M.set(parseFloat(y)),typeof S=="string"?u[x]=parseFloat(S):Array.isArray(S)&&O===wt&&(u[x]=S.map(parseFloat))}else(_==null?void 0:_.transform)&&(O==null?void 0:O.transform)&&(w===0||S===0)?w===0?M.set(O.transform(w)):u[x]=_.transform(S):(m||(T=pX(a),m=!0),E.push(x),s[x]=s[x]!==void 0?s[x]:u[x],mR(M,S))}}),E.length){var d=mX(u,a,E);return T.length&&T.forEach(function(x){var M=wn(x,2),w=M[0],S=M[1];a.getValue(w).set(S)}),a.syncRender(),{target:d,transitionEnd:s}}else return{target:u,transitionEnd:s}};function gX(a,u,f,s){return hX(u)?_X(a,u,f,s):{target:u,transitionEnd:s}}var vX=function(a,u,f,s){var c=V5(a,u,s);return u=c.target,s=c.transitionEnd,gX(a,u,f,s)};function bX(a){return window.getComputedStyle(a)}var TR={treeType:"dom",readValueFromInstance:function(a,u){if(ef(u)){var f=bv(u);return f&&f.default||0}else{var s=bX(a);return(cA(u)?s.getPropertyValue(u):s[u])||0}},sortNodePosition:function(a,u){return a.compareDocumentPosition(u)&2?1:-1},getBaseTarget:function(a,u){var f;return(f=a.style)===null||f===void 0?void 0:f[u]},measureViewportBox:function(a,u){var f=u.transformPagePoint;return NC(a,f)},resetTransform:function(a,u,f){var s=f.transformTemplate;u.style.transform=s?s({},""):"none",a.scheduleRender()},restoreTransform:function(a,u){a.style.transform=u.style.transform},removeValueFromRenderState:function(a,u){var f=u.vars,s=u.style;delete f[a],delete s[a]},makeTargetAnimatable:function(a,u,f,s){var c=f.transformValues;s===void 0&&(s=!0);var T=u.transition,m=u.transitionEnd,E=Xr(u,["transition","transitionEnd"]),d=qH(E,T||{},a);if(c&&(m&&(m=c(m)),E&&(E=c(E)),d&&(d=c(d))),s){KH(a,E,d);var x=vX(a,E,d,m);m=x.transitionEnd,E=x.target}return st({transition:T,transitionEnd:m},E)},scrapeMotionValuesFromProps:iv,build:function(a,u,f,s,c,T,m){a.isVisible!==void 0&&(u.style.visibility=a.isVisible?"visible":"hidden");var E=s.isEnabled&&c.isHydrated;ev(u,f,s,c,T,m.transformTemplate,E?Ef:void 0,E?hR:void 0)},render:xA},yX=dR(TR),TX=dR(st(st({},TR),{getBaseTarget:function(a,u){return a[u]},readValueFromInstance:function(a,u){var f;return ef(u)?((f=bv(u))===null||f===void 0?void 0:f.default)||0:(u=PA.has(u)?u:SA(u),a.getAttribute(u))},scrapeMotionValuesFromProps:CA,build:function(a,u,f,s,c,T,m){var E=s.isEnabled&&c.isHydrated;rv(u,f,s,c,T,m.transformTemplate,E?Ef:void 0,E?hR:void 0)},render:AA})),EX=function(a,u){return Kg(a)?TX(u,{enableHardwareAcceleration:!1}):yX(u,{enableHardwareAcceleration:!0})},SX=st(st(st(st({},s5),RH),B5),J5),ER=R4(function(a,u){return vW(a,u,SX,EX)});function xX(){var a=Nt(!1),u=wn(mn(0),2),f=u[0],s=u[1];return lv(function(){return a.current=!0}),Vt(function(){!a.current&&s(f+1)},[f])}var SR=0;function PX(){var a=SR;return SR++,a}var Lv=function(a){var u=a.children,f=a.initial,s=a.isPresent,c=a.onExitComplete,T=a.custom,m=a.presenceAffectsLayout,E=iu(AX),d=iu(PX),x=Dn(function(){return{id:d,initial:f,isPresent:s,custom:T,onExitComplete:function(M){E.set(M,!0);var w=!0;E.forEach(function(S){S||(w=!1)}),w&&(c==null||c())},register:function(M){return E.set(M,!1),function(){return E.delete(M)}}}},m?void 0:[s]);return Dn(function(){E.forEach(function(M,w){return E.set(w,!1)})},[s]),Ut(function(){!s&&!E.size&&(c==null||c())},[s]),Ye(ru.Provider,{value:x},u)};function AX(){return new Map}function hc(a){return a.key||""}function CX(a,u){a.forEach(function(f){var s=hc(f);u.set(s,f)})}function RX(a){var u=[];return Rl.forEach(a,function(f){Qo(f)&&u.push(f)}),u}var xR=function(a){var u=a.children,f=a.custom,s=a.initial,c=s===void 0?!0:s,T=a.onExitComplete,m=a.exitBeforeEnter,E=a.presenceAffectsLayout,d=E===void 0?!0:E,x=xX(),M=Jt(cR);Wa(M)&&(x=M.forceUpdate);var w=Nt(!0),S=RX(u),_=Nt(S),O=Nt(new Map).current,R=Nt(new Set).current;if(CX(S,O),w.current)return w.current=!1,Ye(qn,null,S.map(function(F){return Ye(Lv,{key:hc(F),isPresent:!0,initial:c?void 0:!1,presenceAffectsLayout:d},F)}));for(var I=Ar([],wn(S)),y=_.current.map(hc),p=S.map(hc),g=y.length,C=0;C<g;C++){var P=y[C];p.indexOf(P)===-1?R.add(P):R.delete(P)}return m&&R.size&&(I=[]),R.forEach(function(F){if(p.indexOf(F)===-1){var U=O.get(F);if(!!U){var B=y.indexOf(F),L=function(){O.delete(F),R.delete(F);var z=_.current.findIndex(function(X){return X.key===F});_.current.splice(z,1),R.size||(_.current=S,x(),T&&T())};I.splice(B,0,Ye(Lv,{key:hc(U),isPresent:!1,onExitComplete:L,custom:f,presenceAffectsLayout:d},U))}}}),I=I.map(function(F){var U=F.key;return R.has(U)?F:Ye(Lv,{key:hc(F),isPresent:!0,presenceAffectsLayout:d},F)}),_.current=I,Ye(qn,null,R.size?I:I.map(function(F){return qo(F)}))};function xf(){return xf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},xf.apply(this,arguments)}var Nv={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1],easeInOut:[.4,0,.2,1]},Tu={scale:{enter:{scale:1},exit:{scale:.95}},fade:{enter:{opacity:1},exit:{opacity:0}},pushLeft:{enter:{x:"100%"},exit:{x:"-30%"}},pushRight:{enter:{x:"-100%"},exit:{x:"30%"}},pushUp:{enter:{y:"100%"},exit:{y:"-30%"}},pushDown:{enter:{y:"-100%"},exit:{y:"30%"}},slideLeft:{position:{left:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"-100%"}},slideRight:{position:{right:0,top:0,bottom:0,width:"100%"},enter:{x:0},exit:{x:"100%"}},slideUp:{position:{top:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"-100%"}},slideDown:{position:{bottom:0,left:0,right:0,maxWidth:"100vw"},enter:{y:0},exit:{y:"100%"}}};function Fv(a){var u,f=(u=a==null?void 0:a.direction)!=null?u:"right";switch(f){case"right":return Tu.slideRight;case"left":return Tu.slideLeft;case"bottom":return Tu.slideDown;case"top":return Tu.slideUp;default:return Tu.slideRight}}var PR={enter:{duration:.2,ease:Nv.easeOut},exit:{duration:.1,ease:Nv.easeIn}},Pf={enter:(a,u)=>xf({},a,{delay:Na(u)?u:u==null?void 0:u.enter}),exit:(a,u)=>xf({},a,{delay:Na(u)?u:u==null?void 0:u.exit})},OX={enter:function(u){var f,{transition:s,transitionEnd:c,delay:T}=u===void 0?{}:u;return{opacity:1,transition:(f=s==null?void 0:s.enter)!=null?f:Pf.enter(PR.enter,T),transitionEnd:c==null?void 0:c.enter}},exit:function(u){var f,{transition:s,transitionEnd:c,delay:T}=u===void 0?{}:u;return{opacity:0,transition:(f=s==null?void 0:s.exit)!=null?f:Pf.exit(PR.exit,T),transitionEnd:c==null?void 0:c.exit}}},MX={initial:"exit",animate:"enter",exit:"exit",variants:OX};function IX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function Eu(){return Eu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Eu.apply(this,arguments)}var AR={exit:{duration:.15,ease:Nv.easeInOut},enter:{type:"spring",damping:25,stiffness:180}},DX={exit:a=>{var u,{direction:f,transition:s,transitionEnd:c,delay:T}=a,{exit:m}=Fv({direction:f});return Eu({},m,{transition:(u=s==null?void 0:s.exit)!=null?u:Pf.exit(AR.exit,T),transitionEnd:c==null?void 0:c.exit})},enter:a=>{var u,{direction:f,transitionEnd:s,transition:c,delay:T}=a,{enter:m}=Fv({direction:f});return Eu({},m,{transition:(u=c==null?void 0:c.enter)!=null?u:Pf.enter(AR.enter,T),transitionEnd:s==null?void 0:s.enter})}},wX=bi((a,u)=>{var{direction:f="right",style:s,unmountOnExit:c,in:T,className:m,transition:E,transitionEnd:d,delay:x}=a,M=IX(a,["direction","style","unmountOnExit","in","className","transition","transitionEnd","delay"]),w=Fv({direction:f}),S=Object.assign({position:"fixed"},w.position,s),_=c?T&&c:!0,O=T||c?"enter":"exit",R={transitionEnd:d,transition:E,direction:f,delay:x};return Ye(xR,{custom:R},_&&Ye(ER.div,Eu({ref:u,initial:"exit",className:Hn("chakra-slide",m),animate:O,exit:"exit",custom:R,variants:DX,style:S},M)))});function Su(){return Su=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Su.apply(this,arguments)}var LX=a=>Ye(eu,Su({viewBox:"0 0 24 24"},a),Ye("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})),NX=a=>Ye(eu,Su({viewBox:"0 0 24 24"},a),Ye("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})),CR=a=>Ye(eu,Su({viewBox:"0 0 24 24"},a),Ye("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"}));function go(){return go=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},go.apply(this,arguments)}function FX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var RR={info:{icon:NX,colorScheme:"blue"},warning:{icon:CR,colorScheme:"orange"},success:{icon:LX,colorScheme:"green"},error:{icon:CR,colorScheme:"red"}},[BX,UX]=ea({name:"AlertContext",errorMessage:"useAlertContext: `context` is undefined. Seems you forgot to wrap alert components in `<Alert />`"}),VX=Sn((a,u)=>{var f,s=na(a),{status:c="info"}=s,T=FX(s,["status"]),m=(f=a.colorScheme)!=null?f:RR[c].colorScheme,E=Yl("Alert",go({},a,{colorScheme:m})),d=go({width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden"},E.container);return Ye(BX,{value:{status:c}},Ye(SP,{value:E},Ye(qt.div,go({role:"alert",ref:u},T,{className:Hn("chakra-alert",a.className),__css:d}))))}),kX=Sn((a,u)=>{var f=ta();return Ye(qt.div,go({ref:u},a,{className:Hn("chakra-alert__title",a.className),__css:f.title}))}),jX=Sn((a,u)=>{var f=ta(),s=go({display:"inline"},f.description);return Ye(qt.div,go({ref:u},a,{className:Hn("chakra-alert__desc",a.className),__css:s}))}),zX=a=>{var{status:u}=UX(),{icon:f}=RR[u],s=ta();return Ye(qt.span,go({display:"inherit"},a,{className:Hn("chakra-alert__icon",a.className),__css:s.icon}),Ye(f,{w:"100%",h:"100%"}))},[CQ,GX]=ea({strict:!1,name:"ButtonGroupContext"}),Bv={border:"0px",clip:"rect(0px, 0px, 0px, 0px)",height:"1px",width:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},WX=qt("span",{baseStyle:Bv});qt("input",{baseStyle:Bv});function Af(){return Af=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Af.apply(this,arguments)}function HX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var XX=H_({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),YX=Sn((a,u)=>{var f=Xl("Spinner",a),s=na(a),{label:c="Loading...",thickness:T="2px",speed:m="0.45s",emptyColor:E="transparent",className:d}=s,x=HX(s,["label","thickness","speed","emptyColor","className"]),M=Hn("chakra-spinner",d),w=Af({display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:T,borderBottomColor:E,borderLeftColor:E,animation:XX+" "+m+" linear infinite"},f);return Ye(qt.div,Af({ref:u,__css:w,className:M},x),c&&Ye(WX,null,c))});function Cf(){return Cf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Cf.apply(this,arguments)}function KX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var OR=a=>{var{label:u,placement:f,children:s=Ye(YX,{color:"currentColor",width:"1em",height:"1em"}),className:c,__css:T}=a,m=KX(a,["label","placement","spacing","children","className","__css"]),E=Hn("chakra-button__spinner",c),d=f==="start"?"marginEnd":"marginStart",x=Dn(()=>Cf({display:"flex",alignItems:"center",position:u?"relative":"absolute",[d]:u?"0.5rem":0,fontSize:"1em",lineHeight:"normal"},T),[T,u,d]);return Ye(qt.div,Cf({className:E},m,{__css:x}),s)};function Uv(){return Uv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Uv.apply(this,arguments)}function QX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var MR=a=>{var{children:u,className:f}=a,s=QX(a,["children","className"]),c=Qo(u)?qo(u,{"aria-hidden":!0,focusable:!1}):u,T=Hn("chakra-button__icon",f);return Ye(qt.span,Uv({display:"inline-flex",alignSelf:"center",flexShrink:0},s,{className:T}),c)};function qX(a){var[u,f]=mn(!a),s=Vt(T=>{!T||f(T.tagName==="BUTTON")},[]),c=u?"button":void 0;return{ref:s,type:c}}function ZX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function xu(){return xu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},xu.apply(this,arguments)}var $X=Sn((a,u)=>{var f=GX(),s=Xl("Button",xu({},f,a)),c=na(a),{isDisabled:T=f==null?void 0:f.isDisabled,isLoading:m,isActive:E,isFullWidth:d,children:x,leftIcon:M,rightIcon:w,loadingText:S,iconSpacing:_="0.5rem",type:O,spinner:R,spinnerPlacement:I="start",className:y,as:p}=c,g=ZX(c,["isDisabled","isLoading","isActive","isFullWidth","children","leftIcon","rightIcon","loadingText","iconSpacing","type","spinner","spinnerPlacement","className","as"]),C=Dn(()=>{var B,L=fo({},(B=s==null?void 0:s._focus)!=null?B:{},{zIndex:1});return xu({display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",width:d?"100%":"auto"},s,!!f&&{_focus:L})},[s,f,d]),{ref:P,type:F}=qX(p),U={rightIcon:w,leftIcon:M,iconSpacing:_,children:x};return Ye(qt.button,xu({disabled:T||m,ref:zl(u,P),as:p,type:O??F,"data-active":mr(E),"data-loading":mr(m),__css:C,className:Hn("chakra-button",y)},g),m&&I==="start"&&Ye(OR,{className:"chakra-button__spinner--start",label:S,placement:"start"},R),m?S||Ye(qt.span,{opacity:0},Ye(IR,U)):Ye(IR,U),m&&I==="end"&&Ye(OR,{className:"chakra-button__spinner--end",label:S,placement:"end"},R))});function IR(a){var{leftIcon:u,rightIcon:f,children:s,iconSpacing:c}=a;return Ye(qn,null,u&&Ye(MR,{marginEnd:c},u),s,f&&Ye(MR,{marginStart:c},f))}function Vv(){return Vv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Vv.apply(this,arguments)}function JX(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var e6=Sn((a,u)=>{var{icon:f,children:s,isRound:c,"aria-label":T}=a,m=JX(a,["icon","children","isRound","aria-label"]),E=f||s,d=Qo(E)?qo(E,{"aria-hidden":!0,focusable:!1}):null;return Ye($X,Vv({padding:"0",borderRadius:c?"full":void 0,ref:u,"aria-label":T},m),d)});function dc(){return dc=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},dc.apply(this,arguments)}function t6(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function n6(a){a===void 0&&(a={});var{defaultIsChecked:u,defaultChecked:f=u,isChecked:s,isFocusable:c,isDisabled:T,isReadOnly:m,isRequired:E,onChange:d,isIndeterminate:x,isInvalid:M,name:w,value:S,id:_,onBlur:O,onFocus:R,"aria-label":I,"aria-labelledby":y,"aria-invalid":p,"aria-describedby":g}=a,C=t6(a,["defaultIsChecked","defaultChecked","isChecked","isFocusable","isDisabled","isReadOnly","isRequired","onChange","isIndeterminate","isInvalid","name","value","id","onBlur","onFocus","aria-label","aria-labelledby","aria-invalid","aria-describedby"]),P=ig(d),F=ig(O),U=ig(R),[B,L]=rg(),[z,X]=rg(),[G,ee]=rg(),$=Nt(null),[fe,me]=mn(!0),[ve,be]=mn(!!f),[ie,se]=w2(s,ve);J_({condition:!!u,message:'The "defaultIsChecked" prop has been deprecated and will be removed in a future version. Please use the "defaultChecked" prop instead, which mirrors default React checkbox behavior.'});var V=Vt(q=>{if(m||T){q.preventDefault();return}ie||be(se?q.target.checked:x?!0:q.target.checked),P==null||P(q)},[m,T,se,ie,x,P]);$s(()=>{$.current&&($.current.indeterminate=Boolean(x))},[x]);var K=T&&!c,Z=Vt(q=>{q.key===" "&&ee.on()},[ee]),le=Vt(q=>{q.key===" "&&ee.off()},[ee]);$s(()=>{if(!!$.current){var q=$.current.checked!==se;q&&be($.current.checked)}},[$.current]);var re=Vt(function(q,ae){q===void 0&&(q={}),ae===void 0&&(ae=null);var pe=De=>{De.preventDefault(),ee.on()};return dc({},q,{ref:ae,"data-active":mr(G),"data-hover":mr(z),"data-checked":mr(se),"data-focus":mr(B),"data-indeterminate":mr(x),"data-disabled":mr(T),"data-invalid":mr(M),"data-readonly":mr(m),"aria-hidden":!0,onMouseDown:Zn(q.onMouseDown,pe),onMouseUp:Zn(q.onMouseUp,ee.off),onMouseEnter:Zn(q.onMouseEnter,X.on),onMouseLeave:Zn(q.onMouseLeave,X.off)})},[G,se,T,B,z,x,M,m,ee,X.off,X.on]),Q=Vt(function(q,ae){return q===void 0&&(q={}),ae===void 0&&(ae=null),dc({},C,q,{ref:zl(ae,pe=>{!pe||me(pe.tagName==="LABEL")}),onClick:Zn(q.onClick,()=>{if(!fe){var pe;(pe=$.current)==null||pe.click(),Qx($.current,{nextTick:!0})}}),"data-disabled":mr(T)})},[C,T,fe]),W=Vt(function(q,ae){return q===void 0&&(q={}),ae===void 0&&(ae=null),dc({},q,{ref:zl($,ae),type:"checkbox",name:w,value:S,id:_,onChange:Zn(q.onChange,V),onBlur:Zn(q.onBlur,F,L.off),onFocus:Zn(q.onFocus,U,L.on),onKeyDown:Zn(q.onKeyDown,Z),onKeyUp:Zn(q.onKeyUp,le),required:E,checked:se,disabled:K,readOnly:m,"aria-label":I,"aria-labelledby":y,"aria-invalid":p?Boolean(p):M,"aria-describedby":g,"aria-disabled":T,style:Bv})},[w,S,_,V,L.off,L.on,F,U,Z,le,E,se,K,m,I,y,p,M,g,T]),Y=Vt(function(q,ae){return q===void 0&&(q={}),ae===void 0&&(ae=null),dc({},q,{ref:ae,onMouseDown:Zn(q.onMouseDown,DR),onTouchStart:Zn(q.onTouchStart,DR),"data-disabled":mr(T),"data-checked":mr(se),"data-invalid":mr(M)})},[se,T,M]);return{state:{isInvalid:M,isFocused:B,isChecked:se,isActive:G,isHovered:z,isIndeterminate:x,isDisabled:T,isReadOnly:m,isRequired:E},getRootProps:Q,getCheckboxProps:re,getInputProps:W,getLabelProps:Y,htmlProps:C}}function DR(a){a.preventDefault(),a.stopPropagation()}function r6(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function Pu(){return Pu=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Pu.apply(this,arguments)}var i6=a=>Ye(eu,Pu({focusable:"false","aria-hidden":!0},a),Ye("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})),o6=Sn((a,u)=>{var f=Xl("CloseButton",a),s=na(a),{children:c,isDisabled:T,__css:m}=s,E=r6(s,["children","isDisabled","__css"]),d={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return Ye(qt.button,Pu({type:"button","aria-label":"Close",ref:u,disabled:T,__css:Pu({},d,f,m)},E),c||Ye(i6,{width:"1em",height:"1em"}))}),[RQ,a6]=ea({strict:!1,name:"FormControlContext"});function Rf(){return Rf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Rf.apply(this,arguments)}function wR(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function LR(a){var u=s6(a),{isDisabled:f,isInvalid:s,isReadOnly:c,isRequired:T}=u,m=wR(u,["isDisabled","isInvalid","isReadOnly","isRequired"]);return Rf({},m,{disabled:f,readOnly:c,required:T,"aria-invalid":$_(s),"aria-required":$_(T),"aria-readonly":$_(c)})}function s6(a){var u,f,s,c=a6(),{id:T,disabled:m,readOnly:E,required:d,isRequired:x,isInvalid:M,isReadOnly:w,isDisabled:S,onFocus:_,onBlur:O}=a,R=wR(a,["id","disabled","readOnly","required","isRequired","isInvalid","isReadOnly","isDisabled","onFocus","onBlur"]),I=a["aria-describedby"]?[a["aria-describedby"]]:[];return c!=null&&c.hasFeedbackText&&c!=null&&c.isInvalid&&I.push(c.feedbackId),c!=null&&c.hasHelpText&&I.push(c.helpTextId),Rf({},R,{"aria-describedby":I.join(" ")||void 0,id:T??(c==null?void 0:c.id),isDisabled:(u=m??S)!=null?u:c==null?void 0:c.isDisabled,isReadOnly:(f=E??w)!=null?f:c==null?void 0:c.isReadOnly,isRequired:(s=d??x)!=null?s:c==null?void 0:c.isRequired,isInvalid:M??(c==null?void 0:c.isInvalid),onFocus:Zn(c==null?void 0:c.onFocus,_),onBlur:Zn(c==null?void 0:c.onBlur,O)})}function kv(){return kv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},kv.apply(this,arguments)}var NR=Sn((a,u)=>{var f=Yl("Input",a),s=na(a),c=LR(s),T=Hn("chakra-input",a.className);return Ye(qt.input,kv({},c,{__css:f.field,ref:u,className:T}))});NR.id="Input";function Au(){return Au=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Au.apply(this,arguments)}function FR(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var jv=qt("div");zi&&(jv.displayName="Box");var BR=Sn((a,u)=>{var{size:f,centerContent:s=!0}=a,c=FR(a,["size","centerContent"]),T=s?{display:"flex",alignItems:"center",justifyContent:"center"}:{};return Ye(jv,Au({ref:u,boxSize:f,__css:Au({},T,{flexShrink:0,flexGrow:0})},c))});zi&&(BR.displayName="Square");var c6=Sn((a,u)=>{var{size:f}=a,s=FR(a,["size"]);return Ye(BR,Au({size:f,ref:u,borderRadius:"9999px"},s))});zi&&(c6.displayName="Circle");function Of(){return Of=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Of.apply(this,arguments)}function UR(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var l6=Sn((a,u)=>{var{area:f,templateAreas:s,gap:c,rowGap:T,columnGap:m,column:E,row:d,autoFlow:x,autoRows:M,templateRows:w,autoColumns:S,templateColumns:_}=a,O=UR(a,["area","templateAreas","gap","rowGap","columnGap","column","row","autoFlow","autoRows","templateRows","autoColumns","templateColumns"]),R={display:"grid",gridArea:f,gridTemplateAreas:s,gridGap:c,gridRowGap:T,gridColumnGap:m,gridAutoColumns:S,gridColumn:E,gridRow:d,gridAutoFlow:x,gridAutoRows:M,gridTemplateRows:w,gridTemplateColumns:_};return Ye(qt.div,Of({ref:u,__css:R},O))});function VR(a){return ng(a,u=>u==="auto"?"auto":"span "+u+"/span "+u)}var u6=Sn((a,u)=>{var{colSpan:f,colStart:s,colEnd:c,rowEnd:T,rowSpan:m,rowStart:E}=a,d=UR(a,["colSpan","colStart","colEnd","rowEnd","rowSpan","rowStart"]),x=Md({gridColumn:VR(f),gridRow:VR(m),gridColumnStart:s,gridColumnEnd:c,gridRowStart:E,gridRowEnd:T});return Ye(qt.div,Of({ref:u,__css:x},d))}),h6=qt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}}),zv="& > *:not(style) ~ *:not(style)";function d6(a){var{spacing:u,direction:f}=a,s={column:{marginTop:u,marginEnd:0,marginBottom:0,marginStart:0},row:{marginTop:0,marginEnd:0,marginBottom:0,marginStart:u},"column-reverse":{marginTop:0,marginEnd:0,marginBottom:u,marginStart:0},"row-reverse":{marginTop:0,marginEnd:u,marginBottom:0,marginStart:0}};return{flexDirection:f,[zv]:ng(f,c=>s[c])}}function f6(a){var{spacing:u,direction:f}=a,s={column:{my:u,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:u,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:u,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:u,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":ng(f,c=>s[c])}}function p6(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function Ha(){return Ha=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Ha.apply(this,arguments)}var m6=a=>Ye(qt.div,Ha({className:"chakra-stack__item"},a,{__css:Ha({display:"inline-block",flex:"0 0 auto",minWidth:0},a.__css)})),Gv=Sn((a,u)=>{var{isInline:f,direction:s,align:c,justify:T,spacing:m="0.5rem",wrap:E,children:d,divider:x,className:M,shouldWrapChildren:w}=a,S=p6(a,["isInline","direction","align","justify","spacing","wrap","children","divider","className","shouldWrapChildren"]),_=f?"row":s??"column",O=Dn(()=>d6({direction:_,spacing:m}),[_,m]),R=Dn(()=>f6({spacing:m,direction:_}),[m,_]),I=!!x,y=!w&&!I,p=M2(d),g=y?p:p.map((P,F)=>{var U=typeof P.key!="undefined"?P.key:F,B=F+1===p.length,L=Ye(m6,{key:U},P),z=w?L:P;if(!I)return z;var X=qo(x,{__css:R}),G=B?null:X;return Ye(qn,{key:U},z,G)}),C=Hn("chakra-stack",M);return Ye(qt.div,Ha({ref:u,display:"flex",alignItems:c,justifyContent:T,flexDirection:O.flexDirection,flexWrap:E,className:C,__css:I?{}:{[zv]:O[zv]}},S),g)});zi&&(Gv.displayName="Stack");var kR=Sn((a,u)=>Ye(Gv,Ha({align:"center"},a,{direction:"row",ref:u})));zi&&(kR.displayName="HStack");var jR=Sn((a,u)=>Ye(Gv,Ha({align:"center"},a,{direction:"column",ref:u})));zi&&(jR.displayName="VStack");function Wv(){return Wv=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Wv.apply(this,arguments)}function _6(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var g6=Sn((a,u)=>{var f=Xl("Text",a),s=na(a),c=_6(s,["className","align","decoration","casing"]),T=Md({textAlign:a.align,textDecoration:a.decoration,textTransform:a.casing});return Ye(qt.p,Wv({ref:u,className:Hn("chakra-text",a.className)},T,c,{__css:f}))});function v6(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var zR={exports:{}},b6="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",y6=b6,T6=y6;function GR(){}function WR(){}WR.resetWarningCache=GR;var E6=function(){function a(s,c,T,m,E,d){if(d!==T6){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function u(){return a}var f={array:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:u,element:a,elementType:a,instanceOf:u,node:a,objectOf:u,oneOf:u,oneOfType:u,shape:u,exact:u,checkPropTypes:WR,resetWarningCache:GR};return f.PropTypes=f,f};zR.exports=E6();var Et=zR.exports,Hv="data-focus-lock",HR="data-focus-lock-disabled",S6="data-no-focus-lock",x6="data-autofocus-inside";function P6(a,u){return typeof a=="function"?a(u):a&&(a.current=u),a}function A6(a,u){var f=mn(function(){return{value:a,callback:u,facade:{get current(){return f.value},set current(s){var c=f.value;c!==s&&(f.value=s,f.callback(s,c))}}}})[0];return f.callback=u,f.facade}function XR(a,u){return A6(u,function(f){return a.forEach(function(s){return P6(s,f)})})}var Xv={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mf=function(){return Mf=Object.assign||function(u){for(var f,s=1,c=arguments.length;s<c;s++){f=arguments[s];for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(u[T]=f[T])}return u},Mf.apply(this,arguments)};function C6(a,u){var f={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(f[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(f[s[c]]=a[s[c]]);return f}function YR(a){return a}function KR(a,u){u===void 0&&(u=YR);var f=[],s=!1,c={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return f.length?f[f.length-1]:a},useMedium:function(T){var m=u(T,s);return f.push(m),function(){f=f.filter(function(E){return E!==m})}},assignSyncMedium:function(T){for(s=!0;f.length;){var m=f;f=[],m.forEach(T)}f={push:function(E){return T(E)},filter:function(){return f}}},assignMedium:function(T){s=!0;var m=[];if(f.length){var E=f;f=[],E.forEach(T),m=f}var d=function(){var M=m;m=[],M.forEach(T)},x=function(){return Promise.resolve().then(d)};x(),f={push:function(M){m.push(M),x()},filter:function(M){return m=m.filter(M),f}}}};return c}function Yv(a,u){return u===void 0&&(u=YR),KR(a,u)}function QR(a){a===void 0&&(a={});var u=KR(null);return u.options=Mf({async:!0,ssr:!1},a),u}var qR=function(a){var u=a.sideCar,f=C6(a,["sideCar"]);if(!u)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=u.read();if(!s)throw new Error("Sidecar medium not found");return Ye(s,Mf({},f))};qR.isSideCarExport=!0;function R6(a,u){return a.useMedium(u),qR}var ZR=Yv({},function(a){var u=a.target,f=a.currentTarget;return{target:u,currentTarget:f}}),$R=Yv(),O6=Yv(),M6=QR({async:!0}),I6=[],Kv=bi(function(u,f){var s,c=mn(),T=c[0],m=c[1],E=Nt(),d=Nt(!1),x=Nt(null),M=u.children,w=u.disabled,S=u.noFocusGuards,_=u.persistentFocus,O=u.crossFrame,R=u.autoFocus;u.allowTextSelection;var I=u.group,y=u.className,p=u.whiteList,g=u.shards,C=g===void 0?I6:g,P=u.as,F=P===void 0?"div":P,U=u.lockProps,B=U===void 0?{}:U,L=u.sideCar,z=u.returnFocus,X=u.onActivation,G=u.onDeactivation,ee=mn({}),$=ee[0],fe=Vt(function(){x.current=x.current||document&&document.activeElement,E.current&&X&&X(E.current),d.current=!0},[X]),me=Vt(function(){d.current=!1,G&&G(E.current)},[G]),ve=Vt(function(re){var Q=x.current;if(Boolean(z)&&Q&&Q.focus){var W=typeof z=="object"?z:void 0;x.current=null,re?Promise.resolve().then(function(){return Q.focus(W)}):Q.focus(W)}},[z]),be=Vt(function(re){d.current&&ZR.useMedium(re)},[]),ie=$R.useMedium,se=Vt(function(re){E.current!==re&&(E.current=re,m(re))},[]),V=Jo((s={},s[HR]=w&&"disabled",s[Hv]=I,s),B),K=S!==!0,Z=K&&S!=="tail",le=XR([f,se]);return Ye(qn,null,K&&[Ye("div",{key:"guard-first","data-focus-guard":!0,tabIndex:w?-1:0,style:Xv}),Ye("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:w?-1:1,style:Xv})],!w&&Ye(L,{id:$,sideCar:M6,observed:T,disabled:w,persistentFocus:_,crossFrame:O,autoFocus:R,whiteList:p,shards:C,onActivation:fe,onDeactivation:me,returnFocus:ve}),Ye(F,Jo({ref:le},V,{className:y,onBlur:ie,onFocus:be}),M),Z&&Ye("div",{"data-focus-guard":!0,tabIndex:w?-1:0,style:Xv}))});Kv.propTypes={},Kv.defaultProps={children:void 0,disabled:!1,returnFocus:!1,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};var JR=Kv;function Qv(a,u){return Qv=Object.setPrototypeOf||function(s,c){return s.__proto__=c,s},Qv(a,u)}function D6(a,u){a.prototype=Object.create(u.prototype),a.prototype.constructor=a,Qv(a,u)}function w6(a,u,f){return u in a?Object.defineProperty(a,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[u]=f,a}function L6(a,u){function f(s){return s.displayName||s.name||"Component"}return function(c){var T=[],m;function E(){m=a(T.map(function(x){return x.props})),u(m)}var d=function(x){D6(M,x);function M(){return x.apply(this,arguments)||this}M.peek=function(){return m};var w=M.prototype;return w.componentDidMount=function(){T.push(this),E()},w.componentDidUpdate=function(){E()},w.componentWillUnmount=function(){var _=T.indexOf(this);T.splice(_,1),E()},w.render=function(){return oi.createElement(c,this.props)},M}(Al);return w6(d,"displayName","SideEffect("+f(c)+")"),d}}var ca=function(a){for(var u=Array(a.length),f=0;f<a.length;++f)u[f]=a[f];return u},qv=function(a){return Array.isArray(a)?a:[a]},N6=function(a){for(var u=new Set,f=a.length,s=0;s<f;s+=1)for(var c=s+1;c<f;c+=1){var T=a[s].compareDocumentPosition(a[c]);(T&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&u.add(c),(T&Node.DOCUMENT_POSITION_CONTAINS)>0&&u.add(s)}return a.filter(function(m,E){return!u.has(E)})},eO=function(a){return a.parentNode?eO(a.parentNode):a},Zv=function(a){var u=qv(a);return u.filter(Boolean).reduce(function(f,s){var c=s.getAttribute(Hv);return f.push.apply(f,c?N6(ca(eO(s).querySelectorAll("["+Hv+'="'+c+'"]:not(['+HR+'="disabled"])'))):[s]),f},[])},F6=function(a){return!a||!a.getPropertyValue?!1:a.getPropertyValue("display")==="none"||a.getPropertyValue("visibility")==="hidden"},tO=function(a){return!a||a===document||a&&a.nodeType===Node.DOCUMENT_NODE||!F6(window.getComputedStyle(a,null))&&tO(a.parentNode&&a.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?a.parentNode.host:a.parentNode)},B6=function(a){return!((a.tagName==="INPUT"||a.tagName==="BUTTON")&&(a.type==="hidden"||a.disabled))},$v=function(a){return Boolean(a&&a.dataset&&a.dataset.focusGuard)},If=function(a){return!$v(a)},U6=function(a){return Boolean(a)},V6=function(a,u){var f=a.tabIndex-u.tabIndex,s=a.index-u.index;if(f){if(!a.tabIndex)return 1;if(!u.tabIndex)return-1}return f||s},nO=function(a,u,f){return ca(a).map(function(s,c){return{node:s,index:c,tabIndex:f&&s.tabIndex===-1?(s.dataset||{}).focusGuard?0:-1:s.tabIndex}}).filter(function(s){return!u||s.tabIndex>=0}).sort(V6)},k6=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],Jv=k6.join(","),j6=Jv+", [data-focus-guard]",eb=function(a,u){return a.reduce(function(f,s){return f.concat(ca(s.querySelectorAll(u?j6:Jv)),s.parentNode?ca(s.parentNode.querySelectorAll(Jv)).filter(function(c){return c===s}):[])},[])},z6=function(a){var u=a.querySelectorAll("["+x6+"]");return ca(u).map(function(f){return eb([f])}).reduce(function(f,s){return f.concat(s)},[])},tb=function(a){return ca(a).filter(function(u){return tO(u)}).filter(function(u){return B6(u)})},nb=function(a,u){return nO(tb(eb(a,u)),!0,u)},rO=function(a){return nO(tb(eb(a)),!1)},G6=function(a){return tb(z6(a))},rb=function(a,u){return u===void 0&&(u=[]),u.push(a),a.parentNode&&rb(a.parentNode,u),u},ib=function(a,u){for(var f=rb(a),s=rb(u),c=0;c<f.length;c+=1){var T=f[c];if(s.indexOf(T)>=0)return T}return!1},iO=function(a,u,f){var s=qv(a),c=qv(u),T=s[0],m=!1;return c.filter(Boolean).forEach(function(E){m=ib(m||E,E)||m,f.filter(Boolean).forEach(function(d){var x=ib(T,d);x&&(!m||x.contains(m)?m=x:m=ib(x,m))})}),m},W6=function(a){return a.reduce(function(u,f){return u.concat(G6(f))},[])},H6=function(a){var u=Zv(a).filter(If),f=iO(a,a,u),s=nb([f],!0),c=nb(u).filter(function(T){var m=T.node;return If(m)}).map(function(T){var m=T.node;return m});return s.map(function(T){var m=T.node,E=T.index;return{node:m,index:E,lockItem:c.indexOf(m)>=0,guard:$v(m)}})},X6=function(a){return a===document.activeElement},Y6=function(a){return Boolean(ca(a.querySelectorAll("iframe")).some(function(u){return X6(u)}))},oO=function(a){var u=document&&document.activeElement;return!u||u.dataset&&u.dataset.focusGuard?!1:Zv(a).reduce(function(f,s){return f||s.contains(u)||Y6(s)},!1)},K6=function(){return document&&ca(document.querySelectorAll("["+S6+"]")).some(function(a){return a.contains(document.activeElement)})},aO=function(a){return a.tagName==="INPUT"&&a.type==="radio"},Q6=function(a,u){return u.filter(aO).filter(function(f){return f.name===a.name}).filter(function(f){return f.checked})[0]||a},ob=function(a,u){return aO(a)&&a.name?Q6(a,u):a},q6=function(a){var u=new Set;return a.forEach(function(f){return u.add(ob(f,a))}),a.filter(function(f){return u.has(f)})},sO=function(a){return a[0]&&a.length>1?ob(a[0],a):a[0]},cO=function(a,u){return a.length>1?a.indexOf(ob(a[u],a)):u},lO="NEW_FOCUS",Z6=function(a,u,f,s){var c=a.length,T=a[0],m=a[c-1],E=$v(f);if(!(a.indexOf(f)>=0)){var d=u.indexOf(f),x=s?u.indexOf(s):d,M=s?a.indexOf(s):-1,w=d-x,S=u.indexOf(T),_=u.indexOf(m),O=q6(u),R=O.indexOf(f)-(s?O.indexOf(s):d),I=cO(a,0),y=cO(a,c-1);if(d===-1||M===-1)return lO;if(!w&&M>=0)return M;if(d<=S&&E&&Math.abs(w)>1)return y;if(d>=_&&E&&Math.abs(w)>1)return I;if(w&&Math.abs(R)>1)return M;if(d<=S)return y;if(d>_)return I;if(w)return Math.abs(w)>1?M:(c+M+w)%c}},$6=function(a){return function(u){return u.autofocus||u.dataset&&!!u.dataset.autofocus||a.indexOf(u)>=0}},J6=function(a,u){var f=new Map;return u.forEach(function(s){return f.set(s.node,s)}),a.map(function(s){return f.get(s)}).filter(U6)},eY=function(a,u){var f=document&&document.activeElement,s=Zv(a).filter(If),c=iO(f||a,a,s),T=rO(s),m=nb(s).filter(function(S){var _=S.node;return If(_)});if(!(!m[0]&&(m=T,!m[0]))){var E=rO([c]).map(function(S){var _=S.node;return _}),d=J6(E,m),x=d.map(function(S){var _=S.node;return _}),M=Z6(x,E,f,u);if(M===lO){var w=T.map(function(S){var _=S.node;return _}).filter($6(W6(s)));return{node:w&&w.length?sO(w):sO(x)}}return M===void 0?M:d[M]}},tY=function(a){a.focus(),"contentWindow"in a&&a.contentWindow&&a.contentWindow.focus()},ab=0,sb=!1,nY=function(a,u){var f=eY(a,u);if(!sb&&f){if(ab>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),sb=!0,setTimeout(function(){sb=!1},1);return}ab++,tY(f.node),ab--}},uO=nY;function hO(a){var u=window,f=u.setImmediate;typeof f!="undefined"?f(a):setTimeout(a,1)}var rY=function(){return document&&document.activeElement===document.body},iY=function(){return rY()||K6()},fc=null,pc=null,mc=null,Cu=!1,oY=function(){return!0},aY=function(u){return(fc.whiteList||oY)(u)},sY=function(u,f){mc={observerNode:u,portaledElement:f}},cY=function(u){return mc&&mc.portaledElement===u};function dO(a,u,f,s){var c=null,T=a;do{var m=s[T];if(m.guard)m.node.dataset.focusAutoGuard&&(c=m);else if(m.lockItem){if(T!==a)return;c=null}else break}while((T+=f)!==u);c&&(c.node.tabIndex=0)}var lY=function(u){return u&&"current"in u?u.current:u},uY=function(u){return u?Boolean(Cu):Cu==="meanwhile"},Df=function(){var u=!1;if(fc){var f=fc,s=f.observed,c=f.persistentFocus,T=f.autoFocus,m=f.shards,E=f.crossFrame,d=s||mc&&mc.portaledElement,x=document&&document.activeElement;if(d){var M=[d].concat(m.map(lY).filter(Boolean));if((!x||aY(x))&&(c||uY(E)||!iY()||!pc&&T)&&(d&&!(oO(M)||cY(x))&&(document&&!pc&&x&&!T?(x.blur&&x.blur(),document.body.focus()):(u=uO(M,pc),mc={})),Cu=!1,pc=document&&document.activeElement),document){var w=document&&document.activeElement,S=H6(M),_=S.map(function(O){var R=O.node;return R}).indexOf(w);_>-1&&(S.filter(function(O){var R=O.guard,I=O.node;return R&&I.dataset.focusAutoGuard}).forEach(function(O){var R=O.node;return R.removeAttribute("tabIndex")}),dO(_,S.length,1,S),dO(_,-1,-1,S))}}}return u},fO=function(u){Df()&&u&&(u.stopPropagation(),u.preventDefault())},cb=function(){return hO(Df)},hY=function(u){var f=u.target,s=u.currentTarget;s.contains(f)||sY(s,f)},dY=function(){return null},pO=function(){Cu="just",setTimeout(function(){Cu="meanwhile"},0)},fY=function(){document.addEventListener("focusin",fO,!0),document.addEventListener("focusout",cb),window.addEventListener("blur",pO)},pY=function(){document.removeEventListener("focusin",fO,!0),document.removeEventListener("focusout",cb),window.removeEventListener("blur",pO)};function mY(a){return a.filter(function(u){var f=u.disabled;return!f})}function _Y(a){var u=a.slice(-1)[0];u&&!fc&&fY();var f=fc,s=f&&u&&u.id===f.id;fc=u,f&&!s&&(f.onDeactivation(),a.filter(function(c){var T=c.id;return T===f.id}).length||f.returnFocus(!u)),u?(pc=null,(!s||f.observed!==u.observed)&&u.onActivation(),Df(),hO(Df)):(pY(),pc=null)}ZR.assignSyncMedium(hY),$R.assignMedium(cb),O6.assignMedium(function(a){return a({moveFocusInside:uO,focusInside:oO})});var gY=L6(mY,_Y)(dY),mO=bi(function(u,f){return Ye(JR,Jo({sideCar:gY,ref:f},u))}),_O=JR.propTypes||{};_O.sideCar,v6(_O,["sideCar"]),mO.propTypes={};var vY=mO,bY=a=>{var{initialFocusRef:u,finalFocusRef:f,contentRef:s,restoreFocus:c,children:T,isDisabled:m,autoFocus:E,persistentFocus:d,lockFocusAcrossFrames:x}=a,M=Vt(()=>{if(u!=null&&u.current)u.current.focus();else if(s!=null&&s.current){var _=v2(s.current);_.length===0&&Qx(s.current,{nextTick:!0})}},[u,s]),w=Vt(()=>{var _;f==null||(_=f.current)==null||_.focus()},[f]),S=c&&!f;return Ye(vY,{crossFrame:x,persistentFocus:d,autoFocus:E,disabled:m,onActivation:M,onDeactivation:w,returnFocus:S},T)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _c=function(){return _c=Object.assign||function(u){for(var f,s=1,c=arguments.length;s<c;s++){f=arguments[s];for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(u[T]=f[T])}return u},_c.apply(this,arguments)};function yY(a,u){var f={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&u.indexOf(s)<0&&(f[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(a);c<s.length;c++)u.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(a,s[c])&&(f[s[c]]=a[s[c]]);return f}var wf="right-scroll-bar-position",Lf="width-before-scroll-bar",TY="with-scroll-bars-hidden",EY="--removed-body-scroll-bar-size",gO=QR(),lb=function(){},Nf=bi(function(a,u){var f=Nt(null),s=mn({onScrollCapture:lb,onWheelCapture:lb,onTouchMoveCapture:lb}),c=s[0],T=s[1],m=a.forwardProps,E=a.children,d=a.className,x=a.removeScrollBar,M=a.enabled,w=a.shards,S=a.sideCar,_=a.noIsolation,O=a.inert,R=a.allowPinchZoom,I=a.as,y=I===void 0?"div":I,p=yY(a,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),g=S,C=XR([f,u]),P=_c({},p,c);return Ye(qn,null,M&&Ye(g,{sideCar:gO,removeScrollBar:x,shards:w,noIsolation:_,inert:O,setCallbacks:T,allowPinchZoom:!!R,lockRef:f}),m?qo(Rl.only(E),_c({},P,{ref:C})):Ye(y,_c({},P,{className:d,ref:C}),E))});Nf.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Nf.classNames={fullWidth:Lf,zeroRight:wf};var SY=function(){if(typeof __webpack_nonce__!="undefined")return __webpack_nonce__};function xY(){if(!document)return null;var a=document.createElement("style");a.type="text/css";var u=SY();return u&&a.setAttribute("nonce",u),a}function PY(a,u){a.styleSheet?a.styleSheet.cssText=u:a.appendChild(document.createTextNode(u))}function AY(a){var u=document.head||document.getElementsByTagName("head")[0];u.appendChild(a)}var CY=function(){var a=0,u=null;return{add:function(f){a==0&&(u=xY())&&(PY(u,f),AY(u)),a++},remove:function(){a--,!a&&u&&(u.parentNode&&u.parentNode.removeChild(u),u=null)}}},RY=function(){var a=CY();return function(u){Ut(function(){return a.add(u),function(){a.remove()}},[])}},vO=function(){var a=RY(),u=function(f){var s=f.styles;return a(s),null};return u},OY={left:0,top:0,right:0,gap:0},ub=function(a){return parseInt(a||"",10)||0},MY=function(a){var u=window.getComputedStyle(document.body),f=u[a==="padding"?"paddingLeft":"marginLeft"],s=u[a==="padding"?"paddingTop":"marginTop"],c=u[a==="padding"?"paddingRight":"marginRight"];return[ub(f),ub(s),ub(c)]},bO=function(a){if(a===void 0&&(a="margin"),typeof window=="undefined")return OY;var u=MY(a),f=document.documentElement.clientWidth,s=window.innerWidth;return{left:u[0],top:u[1],right:u[2],gap:Math.max(0,s-f+u[2]-u[0])}},IY=vO(),DY=function(a,u,f,s){var c=a.left,T=a.top,m=a.right,E=a.gap;return f===void 0&&(f="margin"),`
  .`+TY+` {
   overflow: hidden `+s+`;
   padding-right: `+E+"px "+s+`;
  }
  body {
    overflow: hidden `+s+`;
    `+[u&&"position: relative "+s+";",f==="margin"&&`
    padding-left: `+c+`px;
    padding-top: `+T+`px;
    padding-right: `+m+`px;
    margin-left:0;
    margin-top:0;
    margin-right: `+E+"px "+s+`;
    `,f==="padding"&&"padding-right: "+E+"px "+s+";"].filter(Boolean).join("")+`
  }
  
  .`+wf+` {
    right: `+E+"px "+s+`;
  }
  
  .`+Lf+` {
    margin-right: `+E+"px "+s+`;
  }
  
  .`+wf+" ."+wf+` {
    right: 0 `+s+`;
  }
  
  .`+Lf+" ."+Lf+` {
    margin-right: 0 `+s+`;
  }
  
  body {
    `+EY+": "+E+`px;
  }
`},wY=function(a){var u=mn(bO(a.gapMode)),f=u[0],s=u[1];Ut(function(){s(bO(a.gapMode))},[a.gapMode]);var c=a.noRelative,T=a.noImportant,m=a.gapMode,E=m===void 0?"margin":m;return Ye(IY,{styles:DY(f,!c,E,T?"":"!important")})},LY=function(a){var u=window.getComputedStyle(a);return u.overflowY!=="hidden"&&!(u.overflowY===u.overflowX&&u.overflowY==="visible")},NY=function(a){var u=window.getComputedStyle(a);return u.overflowX!=="hidden"&&!(u.overflowY===u.overflowX&&u.overflowX==="visible")},yO=function(a,u){var f=u;do{var s=TO(a,f);if(s){var c=EO(a,f),T=c[1],m=c[2];if(T>m)return!0}f=f.parentNode}while(f&&f!==document.body);return!1},FY=function(a){var u=a.scrollTop,f=a.scrollHeight,s=a.clientHeight;return[u,f,s]},BY=function(a){var u=a.scrollLeft,f=a.scrollWidth,s=a.clientWidth;return[u,f,s]},TO=function(a,u){return a==="v"?LY(u):NY(u)},EO=function(a,u){return a==="v"?FY(u):BY(u)},UY=function(a,u,f,s,c){var T=s,m=f.target,E=u.contains(m),d=!1,x=T>0,M=0,w=0;do{var S=EO(a,m),_=S[0],O=S[1],R=S[2],I=O-R-_;(_||I)&&TO(a,m)&&(M+=I,w+=_),m=m.parentNode}while(!E&&m!==document.body||E&&(u.contains(m)||u===m));return(x&&(c&&M===0||!c&&T>M)||!x&&(c&&w===0||!c&&-T>w))&&(d=!0),d},hb=!1;if(typeof window!="undefined")try{var Ff=Object.defineProperty({},"passive",{get:function(){return hb=!0,!0}});window.addEventListener("test",Ff,Ff),window.removeEventListener("test",Ff,Ff)}catch(a){hb=!1}var gc=hb?{passive:!1}:!1,Bf=function(a){return"changedTouches"in a?[a.changedTouches[0].clientX,a.changedTouches[0].clientY]:[0,0]},SO=function(a){return[a.deltaX,a.deltaY]},xO=function(a){return a&&"current"in a?a.current:a},VY=function(a,u){return a[0]===u[0]&&a[1]===u[1]},kY=function(a){return`
  .block-interactivity-`+a+` {pointer-events: none;}
  .allow-interactivity-`+a+` {pointer-events: all;}
`},jY=0,vc=[];function zY(a){var u=Nt([]),f=Nt([0,0]),s=Nt(),c=mn(jY++)[0],T=mn(function(){return vO()})[0],m=Nt(a);Ut(function(){m.current=a},[a]),Ut(function(){if(a.inert){document.body.classList.add("block-interactivity-"+c);var R=[a.lockRef.current].concat((a.shards||[]).map(xO)).filter(Boolean);return R.forEach(function(I){return I.classList.add("allow-interactivity-"+c)}),function(){document.body.classList.remove("block-interactivity-"+c),R.forEach(function(I){return I.classList.remove("allow-interactivity-"+c)})}}},[a.inert,a.lockRef.current,a.shards]);var E=Vt(function(R,I){if("touches"in R&&R.touches.length===2)return!m.current.allowPinchZoom;var y=Bf(R),p=f.current,g="deltaX"in R?R.deltaX:p[0]-y[0],C="deltaY"in R?R.deltaY:p[1]-y[1],P,F=R.target,U=Math.abs(g)>Math.abs(C)?"h":"v",B=yO(U,F);if(!B)return!0;if(B?P=U:(P=U==="v"?"h":"v",B=yO(U,F)),!B)return!1;if(!s.current&&"changedTouches"in R&&(g||C)&&(s.current=P),!P)return!0;var L=s.current||P;return UY(L,I,R,L==="h"?g:C,!0)},[]),d=Vt(function(R){var I=R;if(!(!vc.length||vc[vc.length-1]!==T)){var y="deltaY"in I?SO(I):Bf(I),p=u.current.filter(function(P){return P.name===I.type&&P.target===I.target&&VY(P.delta,y)})[0];if(p&&p.should){I.preventDefault();return}if(!p){var g=(m.current.shards||[]).map(xO).filter(Boolean).filter(function(P){return P.contains(I.target)}),C=g.length>0?E(I,g[0]):!m.current.noIsolation;C&&I.preventDefault()}}},[]),x=Vt(function(R,I,y,p){var g={name:R,delta:I,target:y,should:p};u.current.push(g),setTimeout(function(){u.current=u.current.filter(function(C){return C!==g})},1)},[]),M=Vt(function(R){f.current=Bf(R),s.current=void 0},[]),w=Vt(function(R){x(R.type,SO(R),R.target,E(R,a.lockRef.current))},[]),S=Vt(function(R){x(R.type,Bf(R),R.target,E(R,a.lockRef.current))},[]);Ut(function(){return vc.push(T),a.setCallbacks({onScrollCapture:w,onWheelCapture:w,onTouchMoveCapture:S}),document.addEventListener("wheel",d,gc),document.addEventListener("touchmove",d,gc),document.addEventListener("touchstart",M,gc),function(){vc=vc.filter(function(R){return R!==T}),document.removeEventListener("wheel",d,gc),document.removeEventListener("touchmove",d,gc),document.removeEventListener("touchstart",M,gc)}},[]);var _=a.removeScrollBar,O=a.inert;return Ye(qn,null,O?Ye(T,{styles:kY(c)}):null,_?Ye(wY,{gapMode:"margin"}):null)}var GY=R6(gO,zY),PO=bi(function(a,u){return Ye(Nf,_c({},a,{ref:u,sideCar:GY}))});PO.classNames=Nf.classNames;var WY=PO,HY=function(a){if(typeof document=="undefined")return null;var u=Array.isArray(a)?a[0]:a;return u.ownerDocument.body},bc=new WeakMap,Uf=new WeakMap,Vf={},db=0,XY=function(a,u,f){u===void 0&&(u=HY(a)),f===void 0&&(f="data-aria-hidden");var s=Array.isArray(a)?a:[a];Vf[f]||(Vf[f]=new WeakMap);var c=Vf[f],T=[],m=new Set,E=function(x){!x||m.has(x)||(m.add(x),E(x.parentNode))};s.forEach(E);var d=function(x){!x||s.indexOf(x)>=0||Array.prototype.forEach.call(x.children,function(M){if(m.has(M))d(M);else{var w=M.getAttribute("aria-hidden"),S=w!==null&&w!=="false",_=(bc.get(M)||0)+1,O=(c.get(M)||0)+1;bc.set(M,_),c.set(M,O),T.push(M),_===1&&S&&Uf.set(M,!0),O===1&&M.setAttribute(f,"true"),S||M.setAttribute("aria-hidden","true")}})};return d(u),m.clear(),db++,function(){T.forEach(function(x){var M=bc.get(x)-1,w=c.get(x)-1;bc.set(x,M),c.set(x,w),M||(Uf.has(x)||x.removeAttribute("aria-hidden"),Uf.delete(x)),w||x.removeAttribute(f)}),db--,db||(bc=new WeakMap,bc=new WeakMap,Uf=new WeakMap,Vf={})}};function YY(a,u,f){return u in a?Object.defineProperty(a,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[u]=f,a}class KY{constructor(){YY(this,"modals",void 0),this.modals=[]}add(u){this.modals.push(u)}remove(u){this.modals=this.modals.filter(f=>f!==u)}isTopModal(u){var f=this.modals[this.modals.length-1];return f===u}}var fb=new KY;function QY(a,u){Ut(()=>(u&&fb.add(a),()=>{fb.remove(a)}),[u,a])}function kf(){return kf=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},kf.apply(this,arguments)}function qY(a){var{isOpen:u,onClose:f,id:s,closeOnOverlayClick:c=!0,closeOnEsc:T=!0,useInert:m=!0,onOverlayClick:E,onEsc:d}=a,x=Nt(null),M=Nt(null),[w,S,_]=F2(s,"chakra-modal","chakra-modal--header","chakra-modal--body");ZY(x,u&&m),QY(x,u);var O=Nt(null),R=Vt(B=>{O.current=B.target},[]),I=Vt(B=>{B.key==="Escape"&&(B.stopPropagation(),T&&(f==null||f()),d==null||d())},[T,f,d]),[y,p]=mn(!1),[g,C]=mn(!1),P=Vt(function(B,L){return B===void 0&&(B={}),L===void 0&&(L=null),kf({role:"dialog"},B,{ref:zl(L,x),id:w,tabIndex:-1,"aria-modal":!0,"aria-labelledby":y?S:void 0,"aria-describedby":g?_:void 0,onClick:Zn(B.onClick,z=>z.stopPropagation())})},[_,g,w,S,y]),F=Vt(B=>{B.stopPropagation(),O.current===B.target&&(!fb.isTopModal(x)||(c&&(f==null||f()),E==null||E()))},[f,c,E]),U=Vt(function(B,L){return B===void 0&&(B={}),L===void 0&&(L=null),kf({},B,{ref:zl(L,M),onClick:Zn(B.onClick,F),onKeyDown:Zn(B.onKeyDown,I),onMouseDown:Zn(B.onMouseDown,R)})},[I,R,F]);return{isOpen:u,onClose:f,headerId:S,bodyId:_,setBodyMounted:C,setHeaderMounted:p,dialogRef:x,overlayRef:M,getDialogProps:P,getDialogContainerProps:U}}function ZY(a,u){Ut(()=>{if(!!a.current){var f=null;return u&&a.current&&(f=XY(a.current)),()=>{u&&(f==null||f())}}},[u,a])}function jf(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}function vo(){return vo=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},vo.apply(this,arguments)}var[$Y,yc]=ea({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),AO=a=>{var{portalProps:u,children:f,autoFocus:s,trapFocus:c,initialFocusRef:T,finalFocusRef:m,returnFocusOnClose:E,blockScrollOnMount:d,allowPinchZoom:x,preserveScrollBarGap:M,motionPreset:w,lockFocusAcrossFrames:S}=a,_=Yl("Modal",a),O=qY(a),R=vo({},O,{autoFocus:s,trapFocus:c,initialFocusRef:T,finalFocusRef:m,returnFocusOnClose:E,blockScrollOnMount:d,allowPinchZoom:x,preserveScrollBarGap:M,motionPreset:w,lockFocusAcrossFrames:S});return Ye($Y,{value:R},Ye(SP,{value:_},Ye(xR,null,R.isOpen&&Ye(Fd,u,f))))};AO.defaultProps={lockFocusAcrossFrames:!0,returnFocusOnClose:!0,scrollBehavior:"outside",trapFocus:!0,autoFocus:!0,blockScrollOnMount:!0,allowPinchZoom:!1,motionPreset:"scale"};var JY=qt(ER.div);function e8(a){var{autoFocus:u,trapFocus:f,dialogRef:s,initialFocusRef:c,blockScrollOnMount:T,allowPinchZoom:m,finalFocusRef:E,returnFocusOnClose:d,preserveScrollBarGap:x,lockFocusAcrossFrames:M}=yc(),[w,S]=Xg();return Ut(()=>{!w&&S&&setTimeout(S)},[w,S]),Ye(bY,{autoFocus:u,isDisabled:!f,initialFocusRef:c,finalFocusRef:E,restoreFocus:d,contentRef:s,lockFocusAcrossFrames:M},Ye(WY,{removeScrollBar:!x,allowPinchZoom:m,enabled:T,forwardProps:!0},a.children))}var t8=Sn((a,u)=>{var{className:f}=a,s=jf(a,["className","transition"]),c=Hn("chakra-modal__overlay",f),T=ta(),m=vo({pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh"},T.overlay),{motionPreset:E}=yc(),d=E==="none"?{}:MX;return Ye(JY,vo({},d,{__css:m,ref:u,className:c},s))}),n8=Sn((a,u)=>{var{className:f}=a,s=jf(a,["className"]),{headerId:c,setHeaderMounted:T}=yc();Ut(()=>(T(!0),()=>T(!1)),[T]);var m=Hn("chakra-modal__header",f),E=ta(),d=vo({flex:0},E.header);return Ye(qt.header,vo({ref:u,className:m,id:c},s,{__css:d}))}),r8=Sn((a,u)=>{var{className:f}=a,s=jf(a,["className"]),{bodyId:c,setBodyMounted:T}=yc();Ut(()=>(T(!0),()=>T(!1)),[T]);var m=Hn("chakra-modal__body",f),E=ta();return Ye(qt.div,vo({ref:u,className:m,id:c},s,{__css:E.body}))}),i8=Sn((a,u)=>{var{onClick:f,className:s}=a,c=jf(a,["onClick","className"]),{onClose:T}=yc(),m=Hn("chakra-modal__close-btn",s),E=ta();return Ye(o6,vo({ref:u,__css:E.closeButton,className:m,onClick:Zn(f,d=>{d.stopPropagation(),T()})},c))});function Xa(){return Xa=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},Xa.apply(this,arguments)}function CO(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var[o8,a8]=ea();function s8(a){var u,{isOpen:f,onClose:s,placement:c="right",children:T}=a,m=CO(a,["isOpen","onClose","placement","children"]),E=EP(),d=(u=E.components)==null?void 0:u.Drawer;return Ye(o8,{value:{placement:c}},Ye(AO,Xa({isOpen:f,onClose:s,styleConfig:d},m),T))}var c8=qt(wX),l8=Sn((a,u)=>{var{className:f,children:s}=a,c=CO(a,["className","children"]),{getDialogProps:T,getDialogContainerProps:m,isOpen:E}=yc(),d=T(c,u),x=m(),M=Hn("chakra-modal__content",f),w=ta(),S=Xa({display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0},w.dialog),_=Xa({display:"flex",width:"100vw",height:"100vh",position:"fixed",left:0,top:0},w.dialogContainer),{placement:O}=a8();return Ye(qt.div,Xa({},x,{className:"chakra-modal__content-container",__css:_}),Ye(e8,null,Ye(c8,Xa({direction:O,in:E,className:M},d,{__css:S}),s)))});function la(){return la=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},la.apply(this,arguments)}function pb(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var u8=Sn((a,u)=>{var{children:f,placeholder:s,className:c}=a,T=pb(a,["children","placeholder","className"]),m=LR(T);return Ye(qt.select,la({},m,{ref:u,className:Hn("chakra-select",c)}),s&&Ye("option",{value:""},s),f)}),h8=Sn((a,u)=>{var f=Yl("Select",a),s=na(a),{rootProps:c,placeholder:T,icon:m,color:E,height:d,h:x,minH:M,minHeight:w,iconColor:S,iconSize:_}=s,O=pb(s,["rootProps","placeholder","icon","color","height","h","minH","minHeight","iconColor","iconSize","isFullWidth"]),[R,I]=t2(O,IU),y={width:"100%",height:"fit-content",position:"relative",color:E},p=fo({},f.field,{paddingEnd:"2rem",_focus:{zIndex:"unset"}});return Ye(qt.div,la({className:"chakra-select__wrapper",__css:y},R,c),Ye(u8,la({ref:u,height:x??d,minH:M??w,placeholder:T},I,{__css:p}),a.children),Ye(p8,la({"data-disabled":a.isDisabled},(S||E)&&{color:S||E},{__css:f.icon},_&&{fontSize:_}),m))}),d8=a=>Ye("svg",la({viewBox:"0 0 24 24"},a),Ye("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})),f8=qt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),p8=a=>{var{children:u=Ye(d8,null)}=a,f=pb(a,["children"]),s=qo(u,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return Ye(f8,la({},f,{className:"chakra-select__icon-wrapper"}),Qo(u)?s:null)};function bo(){return bo=Object.assign||function(a){for(var u=1;u<arguments.length;u++){var f=arguments[u];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(a[s]=f[s])}return a},bo.apply(this,arguments)}function m8(a,u){if(a==null)return{};var f={},s=Object.keys(a),c,T;for(T=0;T<s.length;T++)c=s[T],!(u.indexOf(c)>=0)&&(f[c]=a[c]);return f}var _8=Sn((a,u)=>{var f=Yl("Switch",a),s=na(a),{spacing:c="0.5rem",children:T}=s,m=m8(s,["spacing","children"]),{state:E,getInputProps:d,getCheckboxProps:x,getRootProps:M,getLabelProps:w}=n6(m),S=Dn(()=>bo({display:"inline-block",verticalAlign:"middle",lineHeight:"normal"},f.container),[f.container]),_=Dn(()=>bo({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer"},f.track),[f.track]),O=Dn(()=>bo({userSelect:"none",marginStart:c},f.label),[c,f.label]);return Ye(qt.label,bo({},M(),{className:Hn("chakra-switch",a.className),__css:S}),Ye("input",bo({className:"chakra-switch__input"},d({},u))),Ye(qt.span,bo({},x(),{className:"chakra-switch__track",__css:_}),Ye(qt.span,{__css:f.thumb,className:"chakra-switch__thumb","data-checked":mr(E.isChecked),"data-hover":mr(E.isHovered)})),T&&Ye(qt.span,bo({className:"chakra-switch__label"},w(),{__css:O}),T))});function g8(a,u,f){return u in a?Object.defineProperty(a,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[u]=f,a}function RO(a,u){var f=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);u&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),f.push.apply(f,s)}return f}function OO(a){for(var u=1;u<arguments.length;u++){var f=arguments[u]!=null?arguments[u]:{};u%2?RO(Object(f),!0).forEach(function(s){g8(a,s,f[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(f)):RO(Object(f)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(f,s))})}return a}function v8(a,u){return b8(a)||y8(a,u)||T8(a,u)||E8()}function b8(a){if(Array.isArray(a))return a}function y8(a,u){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(a)))){var f=[],s=!0,c=!1,T=void 0;try{for(var m=a[Symbol.iterator](),E;!(s=(E=m.next()).done)&&(f.push(E.value),!(u&&f.length===u));s=!0);}catch(d){c=!0,T=d}finally{try{!s&&m.return!=null&&m.return()}finally{if(c)throw T}}return f}}function T8(a,u){if(!!a){if(typeof a=="string")return MO(a,u);var f=Object.prototype.toString.call(a).slice(8,-1);if(f==="Object"&&a.constructor&&(f=a.constructor.name),f==="Map"||f==="Set")return Array.from(a);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return MO(a,u)}}function MO(a,u){(u==null||u>a.length)&&(u=a.length);for(var f=0,s=new Array(u);f<u;f++)s[f]=a[f];return s}function E8(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S8(a,u,f){return u in a?Object.defineProperty(a,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[u]=f,a}function IO(a,u){var f=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);u&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),f.push.apply(f,s)}return f}function DO(a){for(var u=1;u<arguments.length;u++){var f=arguments[u]!=null?arguments[u]:{};u%2?IO(Object(f),!0).forEach(function(s){S8(a,s,f[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(f)):IO(Object(f)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(f,s))})}return a}function x8(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return function(s){return u.reduceRight(function(c,T){return T(c)},s)}}function Ru(a){return function u(){for(var f=this,s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,E=new Array(m),d=0;d<m;d++)E[d]=arguments[d];return u.apply(f,[].concat(c,E))}}}function zf(a){return{}.toString.call(a).includes("Object")}function P8(a){return!Object.keys(a).length}function Ou(a){return typeof a=="function"}function A8(a,u){return Object.prototype.hasOwnProperty.call(a,u)}function C8(a,u){return zf(u)||ua("changeType"),Object.keys(u).some(function(f){return!A8(a,f)})&&ua("changeField"),u}function R8(a){Ou(a)||ua("selectorType")}function O8(a){Ou(a)||zf(a)||ua("handlerType"),zf(a)&&Object.values(a).some(function(u){return!Ou(u)})&&ua("handlersType")}function M8(a){a||ua("initialIsRequired"),zf(a)||ua("initialType"),P8(a)&&ua("initialContent")}function I8(a,u){throw new Error(a[u]||a.default)}var D8={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ua=Ru(I8)(D8),Gf={changes:C8,selector:R8,handler:O8,initial:M8};function w8(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Gf.initial(a),Gf.handler(u);var f={current:a},s=Ru(F8)(f,u),c=Ru(N8)(f),T=Ru(Gf.changes)(a),m=Ru(L8)(f);function E(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(M){return M};return Gf.selector(x),x(f.current)}function d(x){x8(s,c,T,m)(x)}return[E,d]}function L8(a,u){return Ou(u)?u(a.current):u}function N8(a,u){return a.current=DO(DO({},a.current),u),u}function F8(a,u,f){return Ou(u)?u(a.current):Object.keys(f).forEach(function(s){var c;return(c=u[s])===null||c===void 0?void 0:c.call(u,a.current[s])}),f}var B8={create:w8},U8={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.25.2/min/vs"}};function V8(a){return function u(){for(var f=this,s=arguments.length,c=new Array(s),T=0;T<s;T++)c[T]=arguments[T];return c.length>=a.length?a.apply(this,c):function(){for(var m=arguments.length,E=new Array(m),d=0;d<m;d++)E[d]=arguments[d];return u.apply(f,[].concat(c,E))}}}function k8(a){return{}.toString.call(a).includes("Object")}function j8(a){return a||LO("configIsRequired"),k8(a)||LO("configType"),a.urls?(z8(),{paths:{vs:a.urls.monacoBase}}):a}function z8(){console.warn(wO.deprecation)}function G8(a,u){throw new Error(a[u]||a.default)}var wO={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},LO=V8(G8)(wO),W8={config:j8},H8=function(){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++)f[s]=arguments[s];return function(c){return f.reduceRight(function(T,m){return m(T)},c)}};function NO(a,u){return Object.keys(u).forEach(function(f){u[f]instanceof Object&&a[f]&&Object.assign(u[f],NO(a[f],u[f]))}),OO(OO({},a),u)}var X8={type:"cancelation",msg:"operation is manually canceled"};function FO(a){var u=!1,f=new Promise(function(s,c){a.then(function(T){return u?c(X8):s(T)}),a.catch(c)});return f.cancel=function(){return u=!0},f}var Y8=B8.create({config:U8,isInitialized:!1,resolve:null,reject:null,monaco:null}),BO=v8(Y8,2),Mu=BO[0],Wf=BO[1];function K8(a){Wf(function(u){return{config:NO(u.config,W8.config(a))}})}function Q8(){var a=Mu(function(u){var f=u.isInitialized;return{isInitialized:f}});if(!a.isInitialized){if(window.monaco&&window.monaco.editor)return UO(window.monaco),FO(Promise.resolve(window.monaco));H8(q8,$8)(J8),Wf({isInitialized:!0})}return FO(tK)}function q8(a){return document.body.appendChild(a)}function Z8(a){var u=document.createElement("script");return a&&(u.src=a),u}function $8(a){var u=Mu(function(s){var c=s.config,T=s.reject;return{config:c,reject:T}}),f=Z8("".concat(u.config.paths.vs,"/loader.js"));return f.onload=function(){return a()},f.onerror=u.reject,f}function J8(){var a=Mu(function(f){var s=f.config,c=f.resolve,T=f.reject;return{config:s,resolve:c,reject:T}}),u=window.require;u.config(a.config),u(["vs/editor/editor.main"],function(f){UO(f),a.resolve(f)},function(f){a.reject(f)})}function UO(a){Mu().monaco||Wf({monaco:a})}function eK(){return Mu(function(a){var u=a.monaco;return u})}var tK=new Promise(function(a,u){return Wf({resolve:a,reject:u})}),nK={config:K8,init:Q8,__getMonacoInstance:eK};const rK={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function iK({content:a}){return oi.createElement("div",{style:rK},a)}const mb={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function VO({width:a,height:u,isEditorReady:f,loading:s,_ref:c,className:T,wrapperClassName:m}){return oi.createElement("section",{style:{...mb.wrapper,width:a,height:u},className:m},!f&&oi.createElement(iK,{content:s}),oi.createElement("div",{ref:c,style:{...mb.fullWidth,...!f&&mb.hide},className:T}))}VO.propTypes={width:Et.oneOfType([Et.number,Et.string]).isRequired,height:Et.oneOfType([Et.number,Et.string]).isRequired,loading:Et.oneOfType([Et.element,Et.string]).isRequired,isEditorReady:Et.bool.isRequired,className:Et.string,wrapperClassName:Et.string};var oK=Cl(VO);function aK(a){Ut(a,[])}function Tc(a,u,f=!0){const s=Nt(!0);Ut(s.current||!f?()=>{s.current=!1}:a,u)}function _b(){}function kO(a,u,f,s){return sK(a,s)||cK(a,u,f,s)}function sK(a,u){return a.editor.getModel(jO(a,u))}function cK(a,u,f,s){return a.editor.createModel(u,f,s&&jO(a,s))}function jO(a,u){return a.Uri.parse(u)}function lK(a){return a===void 0}Et.string,Et.string,Et.string,Et.string,Et.string,Et.string,Et.string,Et.bool,Et.bool,Et.string,Et.oneOfType([Et.element,Et.string]),Et.object,Et.oneOfType([Et.number,Et.string]),Et.oneOfType([Et.number,Et.string]),Et.string,Et.string,Et.func,Et.func;function uK(a){const u=Nt();return Ut(()=>{u.current=a},[a]),u.current}const Hf=new Map;function gb({defaultValue:a,defaultLanguage:u,defaultPath:f,value:s,language:c,path:T,theme:m,line:E,loading:d,options:x,overrideServices:M,saveViewState:w,keepCurrentModel:S,width:_,height:O,className:R,wrapperClassName:I,beforeMount:y,onMount:p,onChange:g,onValidate:C}){const[P,F]=mn(!1),[U,B]=mn(!0),L=Nt(null),z=Nt(null),X=Nt(null),G=Nt(p),ee=Nt(y),$=Nt(null),fe=Nt(s),me=uK(T);aK(()=>{const ie=nK.init();return ie.then(se=>(L.current=se)&&B(!1)).catch(se=>(se==null?void 0:se.type)!=="cancelation"&&console.error("Monaco initialization: error:",se)),()=>z.current?be():ie.cancel()}),Tc(()=>{const ie=kO(L.current,a||s,u||c,T);ie!==z.current.getModel()&&(w&&Hf.set(me,z.current.saveViewState()),z.current.setModel(ie),w&&z.current.restoreViewState(Hf.get(T)))},[T],P),Tc(()=>{z.current.updateOptions(x)},[x],P),Tc(()=>{z.current.getOption(L.current.editor.EditorOption.readOnly)?z.current.setValue(s):s!==z.current.getValue()&&(z.current.executeEdits("",[{range:z.current.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),z.current.pushUndoStop())},[s],P),Tc(()=>{L.current.editor.setModelLanguage(z.current.getModel(),c)},[c],P),Tc(()=>{lK(E)||z.current.revealLine(E)},[E],P),Tc(()=>{L.current.editor.setTheme(m)},[m],P);const ve=Vt(()=>{ee.current(L.current);const ie=T||f,se=kO(L.current,s||a,u||c,ie);z.current=L.current.editor.create(X.current,{model:se,automaticLayout:!0,...x},M),w&&z.current.restoreViewState(Hf.get(ie)),L.current.editor.setTheme(m),F(!0)},[a,u,f,s,c,T,x,M,w,m]);Ut(()=>{P&&G.current(z.current,L.current)},[P]),Ut(()=>{!U&&!P&&ve()},[U,P,ve]),fe.current=s,Ut(()=>{if(P&&g){var ie,se;(ie=$.current)===null||ie===void 0||ie.dispose(),$.current=(se=z.current)===null||se===void 0?void 0:se.onDidChangeModelContent(V=>{const K=z.current.getValue();fe.current!==K&&g(K,V)})}},[P,g]),Ut(()=>{if(P){const ie=L.current.editor.onDidChangeMarkers(se=>{var V;const K=(V=z.current.getModel())===null||V===void 0?void 0:V.uri;if(K&&se.find(le=>le.path===K.path)){const le=L.current.editor.getModelMarkers({resource:K});C==null||C(le)}});return()=>{ie==null||ie.dispose()}}},[P,C]);function be(){var ie;if((ie=$.current)===null||ie===void 0||ie.dispose(),S)w&&Hf.set(T,z.current.saveViewState());else{var se;(se=z.current.getModel())===null||se===void 0||se.dispose()}z.current.dispose()}return oi.createElement(oK,{width:_,height:O,isEditorReady:P,loading:d,_ref:X,className:R,wrapperClassName:I})}gb.propTypes={defaultValue:Et.string,defaultPath:Et.string,defaultLanguage:Et.string,value:Et.string,language:Et.string,path:Et.string,theme:Et.string,line:Et.number,loading:Et.oneOfType([Et.element,Et.string]),options:Et.object,overrideServices:Et.object,saveViewState:Et.bool,keepCurrentModel:Et.bool,width:Et.oneOfType([Et.number,Et.string]),height:Et.oneOfType([Et.number,Et.string]),className:Et.string,wrapperClassName:Et.string,beforeMount:Et.func,onMount:Et.func,onChange:Et.func,onValidate:Et.func},gb.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",beforeMount:_b,onMount:_b,onValidate:_b};var hK=Cl(gb),dK=tu({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),fK=tu({displayName:"EditIcon",path:Ye("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2"},Ye("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),Ye("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}))}),pK=tu({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),mK=tu({d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,19a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,12,19Zm1.6-6.08a1,1,0,0,0-.6.917,1,1,0,1,1-2,0,3,3,0,0,1,1.8-2.75A2,2,0,1,0,10,9.255a1,1,0,1,1-2,0,4,4,0,1,1,5.6,3.666Z",displayName:"QuestionIcon"}),_K=tu({viewBox:"0 0 14 14",path:Ye("g",{fill:"currentColor"},Ye("polygon",{points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"}))});function gK(a){let u;const f=new Set,s=(x,M)=>{const w=typeof x=="function"?x(u):x;if(w!==u){const S=u;u=M?w:Object.assign({},u,w),f.forEach(_=>_(u,S))}},c=()=>u,T=(x,M=c,w=Object.is)=>{let S=M(u);function _(){const O=M(u);if(!w(S,O)){const R=S;x(S=O,R)}}return f.add(_),()=>f.delete(_)},d={setState:s,getState:c,subscribe:(x,M,w)=>M||w?T(x,M,w):(f.add(x),()=>f.delete(x)),destroy:()=>f.clear()};return u=a(s,c,d),d}const vK=typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),zO=vK?Ut:Ko;function bK(a){const u=typeof a=="function"?gK(a):a,f=(s=u.getState,c=Object.is)=>{const[,T]=Jh(R=>R+1,0),m=u.getState(),E=Nt(m),d=Nt(s),x=Nt(c),M=Nt(!1),w=Nt();w.current===void 0&&(w.current=s(m));let S,_=!1;(E.current!==m||d.current!==s||x.current!==c||M.current)&&(S=s(m),_=!c(w.current,S)),zO(()=>{_&&(w.current=S),E.current=m,d.current=s,x.current=c,M.current=!1});const O=Nt(m);return zO(()=>{const R=()=>{try{const y=u.getState(),p=d.current(y);x.current(w.current,p)||(E.current=y,w.current=p,T())}catch(y){M.current=!0,T()}},I=u.subscribe(R);return u.getState()!==O.current&&R(),I},[]),_?S:w.current};return Object.assign(f,u),f[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const s=[f,u];return{next(){const c=s.length<=0;return{value:s.shift(),done:c}}}},f}var GO={},vb={},Ln=b_(YN),Nn=b_(QB),On={},Ci={};Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.heightWidthRadiusDefaults=Ci.heightWidthDefaults=Ci.sizeMarginDefaults=Ci.sizeDefaults=void 0;var WO={loading:!0,color:"#000000",css:"",speedMultiplier:1};function HO(a){return Object.assign({},WO,{size:a})}Ci.sizeDefaults=HO;function yK(a){return Object.assign({},HO(a),{margin:2})}Ci.sizeMarginDefaults=yK;function XO(a,u){return Object.assign({},WO,{height:a,width:u})}Ci.heightWidthDefaults=XO;function TK(a,u,f){return f===void 0&&(f=2),Object.assign({},XO(a,u),{radius:f,margin:2})}Ci.heightWidthRadiusDefaults=TK;var Xf={};Object.defineProperty(Xf,"__esModule",{value:!0}),Xf.calculateRgba=void 0;var Yf;(function(a){a.maroon="#800000",a.red="#FF0000",a.orange="#FFA500",a.yellow="#FFFF00",a.olive="#808000",a.green="#008000",a.purple="#800080",a.fuchsia="#FF00FF",a.lime="#00FF00",a.teal="#008080",a.aqua="#00FFFF",a.blue="#0000FF",a.navy="#000080",a.black="#000000",a.gray="#808080",a.silver="#C0C0C0",a.white="#FFFFFF"})(Yf||(Yf={}));var EK=function(a,u){if(Object.keys(Yf).includes(a)&&(a=Yf[a]),a[0]==="#"&&(a=a.slice(1)),a.length===3){var f="";a.split("").forEach(function(c){f+=c,f+=c}),a=f}var s=(a.match(/.{2}/g)||[]).map(function(c){return parseInt(c,16)}).join(", ");return"rgba("+s+", "+u+")"};Xf.calculateRgba=EK;var Ec={};Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.cssValue=Ec.parseLengthAndUnit=void 0;var SK={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function YO(a){if(typeof a=="number")return{value:a,unit:"px"};var u,f=(a.match(/^[0-9.]*/)||"").toString();f.includes(".")?u=parseFloat(f):u=parseInt(f,10);var s=(a.match(/[^0-9]*$/)||"").toString();return SK[s]?{value:u,unit:s}:(console.warn("React Spinners: "+a+" is not a valid css value. Defaulting to "+u+"px."),{value:u,unit:"px"})}Ec.parseLengthAndUnit=YO;function xK(a){var u=YO(a);return""+u.value+u.unit}Ec.cssValue=xK,function(a){var u=Fe&&Fe.__createBinding||(Object.create?function(s,c,T,m){m===void 0&&(m=T),Object.defineProperty(s,m,{enumerable:!0,get:function(){return c[T]}})}:function(s,c,T,m){m===void 0&&(m=T),s[m]=c[T]}),f=Fe&&Fe.__exportStar||function(s,c){for(var T in s)T!=="default"&&!Object.prototype.hasOwnProperty.call(c,T)&&u(c,s,T)};Object.defineProperty(a,"__esModule",{value:!0}),f(Ci,a),f(Xf,a),f(Ec,a)}(On);var Kf=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},PK=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),AK=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),CK=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),RK=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&AK(u,a,f);return CK(u,a),u};Object.defineProperty(vb,"__esModule",{value:!0});var OK=RK(Ln),Ya=Nn,Iu=On,MK=Ya.keyframes(KO||(KO=Kf([`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`],[`
  0% {left: -35%;right: 100%}
  60% {left: 100%;right: -90%}
  100% {left: 100%;right: -90%}
`]))),IK=Ya.keyframes(QO||(QO=Kf([`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`],[`
  0% {left: -200%;right: 100%}
  60% {left: 107%;right: -8%}
  100% {left: 107%;right: -8%}
`]))),DK=function(a){PK(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.height,m=c.color,E=c.speedMultiplier;return Ya.css(qO||(qO=Kf([`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `],[`
      position: absolute;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
      display: block;
      border-radius: 2px;
      will-change: left, right;
      animation-fill-mode: forwards;
      animation: `," ",`s
        `,`
        `,`
        infinite;
    `])),Iu.cssValue(T),m,s===1?MK:IK,2.1/E,s===2?1.15/E+"s":"",s===1?"cubic-bezier(0.65, 0.815, 0.735, 0.395)":"cubic-bezier(0.165, 0.84, 0.44, 1)")},f.wrapper=function(){var s=f.props,c=s.width,T=s.height,m=s.color;return Ya.css(ZO||(ZO=Kf([`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      overflow: hidden;
      background-color: `,`;
      background-clip: padding-box;
    `])),Iu.cssValue(c),Iu.cssValue(T),Iu.calculateRgba(m,.2))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Ya.jsx("span",{css:[this.wrapper(),c]},Ya.jsx("span",{css:this.style(1)}),Ya.jsx("span",{css:this.style(2)})):null},u.defaultProps=Iu.heightWidthDefaults(4,100),u}(OK.PureComponent);vb.default=DK;var KO,QO,qO,ZO,bb={},$O=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},wK=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),LK=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),NK=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),FK=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&LK(u,a,f);return NK(u,a),u};Object.defineProperty(bb,"__esModule",{value:!0});var BK=FK(Ln),Sc=Nn,Qf=On,UK=Sc.keyframes(JO||(JO=$O([`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`],[`
  50% {transform: scale(0.75);opacity: 0.2}
  100% {transform: scale(1);opacity: 1}
`]))),VK=function(a){wK(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.margin,d=c.speedMultiplier;return Sc.css(eM||(eM=$O([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation: `," ","s ",`
        infinite linear;
      animation-fill-mode: both;
    `])),T,Qf.cssValue(m),Qf.cssValue(m),Qf.cssValue(E),UK,.7/d,s%2?"0s":.35/d+"s")},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Sc.jsx("span",{css:[c]},Sc.jsx("span",{css:this.style(1)}),Sc.jsx("span",{css:this.style(2)}),Sc.jsx("span",{css:this.style(3)})):null},u.defaultProps=Qf.sizeMarginDefaults(15),u}(BK.PureComponent);bb.default=VK;var JO,eM,yb={},Tb=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},kK=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),jK=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),zK=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),GK=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&jK(u,a,f);return zK(u,a),u};Object.defineProperty(yb,"__esModule",{value:!0});var WK=GK(Ln),xc=Nn,Du=On,HK=xc.keyframes(tM||(tM=Tb([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),XK=function(a){kK(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.speedMultiplier;return xc.css(nM||(nM=Tb([`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      opacity: 0.6;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `," ","s ",`
        infinite ease-in-out;
    `])),Du.cssValue(m),Du.cssValue(m),T,HK,2.1/E,s===1?1/E+"s":"0s")},f.wrapper=function(){var s=f.props.size;return xc.css(rM||(rM=Tb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),Du.cssValue(s),Du.cssValue(s))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?xc.jsx("span",{css:[this.wrapper(),c]},xc.jsx("span",{css:this.style(1)}),xc.jsx("span",{css:this.style(2)})):null},u.defaultProps=Du.sizeDefaults(60),u}(WK.PureComponent);yb.default=XK;var tM,nM,rM,Eb={},Sb=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},YK=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),KK=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),QK=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),qK=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&KK(u,a,f);return QK(u,a),u};Object.defineProperty(Eb,"__esModule",{value:!0});var ZK=qK(Ln),yo=Nn,qf=On,$K=yo.keyframes(iM||(iM=Sb([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),JK=function(a){YK(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.size,m=c.color,E=c.speedMultiplier,d=qf.parseLengthAndUnit(T),x=d.value,M=d.unit;return yo.css(oM||(oM=Sb([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: 1px solid `,`;
      border-radius: 100%;
      transition: 2s;
      border-bottom: none;
      border-right: none;
      top: `,`%;
      left: `,`%;
      animation-fill-mode: "";
      animation: `," ","s ",`s infinite linear;
    `])),""+x*(1-s/10)+M,""+x*(1-s/10)+M,m,s*.7*2.5,s*.35*2.5,$K,1/E,s*.2/E)},f.wrapper=function(){var s=f.props.size;return yo.css(aM||(aM=Sb([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),qf.cssValue(s),qf.cssValue(s))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?yo.jsx("span",{css:[this.wrapper(),c]},yo.jsx("span",{css:this.style(0)}),yo.jsx("span",{css:this.style(1)}),yo.jsx("span",{css:this.style(2)}),yo.jsx("span",{css:this.style(3)}),yo.jsx("span",{css:this.style(4)})):null},u.defaultProps=qf.sizeDefaults(50),u}(ZK.PureComponent);Eb.default=JK;var iM,oM,aM,xb={},wu=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},e7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),t7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),n7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),r7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&t7(u,a,f);return n7(u,a),u};Object.defineProperty(xb,"__esModule",{value:!0});var i7=r7(Ln),To=Nn,sM=On,o7=To.keyframes(cM||(cM=wu([`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`],[`
  0% {transform:translate(0, -1em) rotate(-45deg)}
  5% {transform:translate(0, -1em) rotate(-50deg)}
  20% {transform:translate(1em, -2em) rotate(47deg)}
  25% {transform:translate(1em, -2em) rotate(45deg)}
  30% {transform:translate(1em, -2em) rotate(40deg)}
  45% {transform:translate(2em, -3em) rotate(137deg)}
  50% {transform:translate(2em, -3em) rotate(135deg)}
  55% {transform:translate(2em, -3em) rotate(130deg)}
  70% {transform:translate(3em, -4em) rotate(217deg)}
  75% {transform:translate(3em, -4em) rotate(220deg)}
  100% {transform:translate(0, -1em) rotate(-225deg)}
`]))),a7=function(a){e7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(){var s=f.props,c=s.color,T=s.speedMultiplier;return To.css(lM||(lM=wu([`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `],[`
      position: absolute;
      left: 0;
      bottom: -0.1em;
      height: 1em;
      width: 1em;
      background-color: transparent;
      border-radius: 15%;
      border: 0.25em solid `,`;
      transform: translate(0, -1em) rotate(-45deg);
      animation-fill-mode: both;
      animation: `," ",`s infinite cubic-bezier(0.79, 0, 0.47, 0.97);
    `])),c,o7,2.5/T)},f.wrapper=function(){var s=f.props.size;return To.css(uM||(uM=wu([`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `],[`
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -2.7em;
      margin-left: -2.7em;
      width: 5.4em;
      height: 5.4em;
      font-size: `,`;
    `])),sM.cssValue(s))},f.hill=function(){var s=f.props.color;return To.css(hM||(hM=wu([`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `],[`
      position: absolute;
      width: 7.1em;
      height: 7.1em;
      top: 1.7em;
      left: 1.7em;
      border-left: 0.25em solid `,`;
      transform: rotate(45deg);
    `])),s)},f.container=function(){return To.css(dM||(dM=wu([`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `],[`
      position: relative;
      width: 7.1em;
      height: 7.1em;
    `])))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?To.jsx("span",{css:[this.container(),c]},To.jsx("span",{css:this.wrapper()},To.jsx("span",{css:this.style()}),To.jsx("span",{css:this.hill()}))):null},u.defaultProps=sM.sizeDefaults(15),u}(i7.PureComponent);xb.default=a7;var cM,lM,uM,hM,dM,Pb={},fM=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},s7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),c7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),l7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),u7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&c7(u,a,f);return l7(u,a),u};Object.defineProperty(Pb,"__esModule",{value:!0});var h7=u7(Ln),Ab=Nn,Cb=On,d7=Ab.keyframes(pM||(pM=fM([`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`],[`
  0% {transform: rotate(0deg) scale(1)}
  50% {transform: rotate(180deg) scale(0.8)}
  100% {transform: rotate(360deg) scale(1)}
`]))),f7=function(a){s7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(){var s=f.props,c=s.size,T=s.color,m=s.speedMultiplier;return Ab.css(mM||(mM=fM([`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `],[`
      background: transparent !important;
      width: `,`;
      height: `,`;
      border-radius: 100%;
      border: 2px solid;
      border-color: `,`;
      border-bottom-color: transparent;
      display: inline-block;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: both;
    `])),Cb.cssValue(c),Cb.cssValue(c),T,d7,.75/m)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Ab.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=Cb.sizeDefaults(35),u}(h7.PureComponent);Pb.default=f7;var pM,mM,Rb={},_M=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},p7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),m7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),_7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),g7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&m7(u,a,f);return _7(u,a),u};Object.defineProperty(Rb,"__esModule",{value:!0});var v7=g7(Ln),Ob=Nn,gM=On,vM=Ob.keyframes(bM||(bM=_M([`
  100% { transform: rotate(360deg) }
`],[`
  100% { transform: rotate(360deg) }
`]))),b7=function(a){p7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.wrapper=function(){var s=f.props,c=s.size,T=s.color,m=s.speedMultiplier,E=gM.parseLengthAndUnit(c),d=E.value,x=E.unit;return Ob.css(yM||(yM=_M([`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      background-color: transparent;
      box-shadow: inset 0px 0px 0px 2px `,`;
      border-radius: 50%;

      &:after,
      &:before {
        position: absolute;
        content: "";
        background-color: `,`;
      }

      &:after {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }

      &:before {
        width: `,`px;
        height: 2px;
        top: `,`px;
        left: `,`px;
        transform-origin: 1px 1px;
        animation: `," ",`s linear infinite;
      }
    `])),""+d+x,""+d+x,T,T,d/2.4,d/2-1,d/2-1,vM,2/m,d/3,d/2-1,d/2-1,vM,8/m)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Ob.jsx("span",{css:[this.wrapper(),c]}):null},u.defaultProps=gM.sizeDefaults(50),u}(v7.PureComponent);Rb.default=b7;var bM,yM,Mb={},Zf=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},y7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),T7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),E7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),S7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&T7(u,a,f);return E7(u,a),u};Object.defineProperty(Mb,"__esModule",{value:!0});var x7=S7(Ln),Ka=Nn,$f=On,P7=Ka.keyframes(TM||(TM=Zf([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),A7=Ka.keyframes(EM||(EM=Zf([`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`],[`
  0%, 100% {transform: scale(0)}
  50% {transform: scale(1.0)}
`]))),C7=function(a){y7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.size,m=c.color,E=c.speedMultiplier,d=$f.parseLengthAndUnit(T),x=d.value,M=d.unit;return Ka.css(SM||(SM=Zf([`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `],[`
      position: absolute;
      top: `,`;
      bottom: `,`;
      height: `,`;
      width: `,`;
      background-color: `,`;
      border-radius: 100%;
      animation-fill-mode: forwards;
      animation: `," ","s ",` infinite linear;
    `])),s%2?"0":"auto",s%2?"auto":"0",""+x/2+M,""+x/2+M,m,A7,2/E,s===2?"-1s":"0s")},f.wrapper=function(){var s=f.props,c=s.size,T=s.speedMultiplier;return Ka.css(xM||(xM=Zf([`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation-fill-mode: forwards;
      animation: `," ",`s 0s infinite linear;
    `])),$f.cssValue(c),$f.cssValue(c),P7,2/T)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Ka.jsx("span",{css:[this.wrapper(),c]},Ka.jsx("span",{css:this.style(1)}),Ka.jsx("span",{css:this.style(2)})):null},u.defaultProps=$f.sizeDefaults(60),u}(x7.PureComponent);Mb.default=C7;var TM,EM,SM,xM,Ib={},Ri=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},R7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),O7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),M7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),I7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&O7(u,a,f);return M7(u,a),u};Object.defineProperty(Ib,"__esModule",{value:!0});var D7=I7(Ln),Xn=Nn,Pc=On,w7=Xn.keyframes(PM||(PM=Ri([`
  50% {opacity: 0.3}
  100% {opacity: 1}
`],[`
  50% {opacity: 0.3}
  100% {opacity: 1}
`]))),L7=function(a){R7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.radius=function(){var s=f.props.margin,c=Pc.parseLengthAndUnit(s).value;return c+18},f.quarter=function(){return f.radius()/2+f.radius()/5.5},f.style=function(s){var c=f.props,T=c.height,m=c.width,E=c.margin,d=c.color,x=c.radius,M=c.speedMultiplier;return Xn.css(AM||(AM=Ri([`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `],[`
      position: absolute;
      width: `,`;
      height: `,`;
      margin: `,`;
      background-color: `,`;
      border-radius: `,`;
      transition: 2s;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease-in-out;
    `])),Pc.cssValue(m),Pc.cssValue(T),Pc.cssValue(E),d,Pc.cssValue(x),w7,1.2/M,s*.12)},f.wrapper=function(){return Xn.css(CM||(CM=Ri([`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `],[`
      position: relative;
      font-size: 0;
      top: `,`px;
      left: `,`px;
      width: `,`px;
      height: `,`px;
    `])),f.radius(),f.radius(),f.radius()*3,f.radius()*3)},f.a=function(){return Xn.css(RM||(RM=Ri([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),f.style(1),f.radius())},f.b=function(){return Xn.css(OM||(OM=Ri([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),f.style(2),f.quarter(),f.quarter())},f.c=function(){return Xn.css(MM||(MM=Ri([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),f.style(3),f.radius())},f.d=function(){return Xn.css(IM||(IM=Ri([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),f.style(4),-f.quarter(),f.quarter())},f.e=function(){return Xn.css(DM||(DM=Ri([`
    `,`;
    top: `,`px;
    left: 0;
  `],[`
    `,`;
    top: `,`px;
    left: 0;
  `])),f.style(5),-f.radius())},f.f=function(){return Xn.css(wM||(wM=Ri([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(-45deg);
  `])),f.style(6),-f.quarter(),-f.quarter())},f.g=function(){return Xn.css(LM||(LM=Ri([`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `],[`
    `,`;
    top: 0;
    left: `,`px;
    transform: rotate(90deg);
  `])),f.style(7),-f.radius())},f.h=function(){return Xn.css(NM||(NM=Ri([`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `],[`
    `,`;
    top: `,`px;
    left: `,`px;
    transform: rotate(45deg);
  `])),f.style(8),f.quarter(),-f.quarter())},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Xn.jsx("span",{css:[this.wrapper(),c]},Xn.jsx("span",{css:this.a()}),Xn.jsx("span",{css:this.b()}),Xn.jsx("span",{css:this.c()}),Xn.jsx("span",{css:this.d()}),Xn.jsx("span",{css:this.e()}),Xn.jsx("span",{css:this.f()}),Xn.jsx("span",{css:this.g()}),Xn.jsx("span",{css:this.h()})):null},u.defaultProps=Pc.heightWidthRadiusDefaults(15,5,2),u}(D7.PureComponent);Ib.default=L7;var PM,AM,CM,RM,OM,MM,IM,DM,wM,LM,NM,Db={},wb=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},N7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),F7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),B7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),U7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&F7(u,a,f);return B7(u,a),u};Object.defineProperty(Db,"__esModule",{value:!0});var V7=U7(Ln),Yr=Nn,Ac=On,k7=Yr.keyframes(FM||(FM=wb([`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1)}
  50% {transform: scale(0.5); opacity: 0.7}
  100% {transform: scale(1);opacity: 1}
`]))),Eo=function(a){return Math.random()*a},j7=function(a){N7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.margin,d=c.speedMultiplier;return Yr.css(BM||(BM=wb([`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `],[`
      display: inline-block;
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      animation-fill-mode: "both";
      animation: `," ","s ",`s infinite ease;
    `])),T,Ac.cssValue(m),Ac.cssValue(m),Ac.cssValue(E),k7,(s/100+.6)/d,s/100-.2)},f.wrapper=function(){var s=f.props,c=s.size,T=s.margin,m=Ac.parseLengthAndUnit(c),E=Ac.parseLengthAndUnit(T),d=""+(parseFloat(m.value.toString())*3+parseFloat(E.value.toString())*6)+m.unit;return Yr.css(UM||(UM=wb([`
      width: `,`;
      font-size: 0;
    `],[`
      width: `,`;
      font-size: 0;
    `])),d)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Yr.jsx("span",{css:[this.wrapper(),c]},Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))}),Yr.jsx("span",{css:this.style(Eo(100))})):null},u.defaultProps=Ac.sizeMarginDefaults(15),u}(V7.PureComponent);Db.default=j7;var FM,BM,UM,Lb={},z7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),Jf=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},G7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),W7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),H7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&G7(u,a,f);return W7(u,a),u};Object.defineProperty(Lb,"__esModule",{value:!0});var X7=H7(Ln),Qa=Nn,So=On,Y7=function(a){z7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.thickness=function(){var s=f.props.size,c=So.parseLengthAndUnit(s).value;return c/5},f.lat=function(){var s=f.props.size,c=So.parseLengthAndUnit(s).value;return(c-f.thickness())/2},f.offset=function(){return f.lat()-f.thickness()},f.color=function(){var s=f.props.color;return So.calculateRgba(s,.75)},f.before=function(){var s=f.props.size,c=f.color(),T=f.lat(),m=f.thickness(),E=f.offset();return Qa.keyframes(VM||(VM=Jf([`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {width: `,";box-shadow: 0 ","px ",", 0 ","px ",`}
      70% {width: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,T,-E,c,-T,E,c,So.cssValue(s),-E,c,E,c,m,-T,-E,c,T,E,c,T,-E,c,-T,E,c)},f.after=function(){var s=f.props.size,c=f.color(),T=f.lat(),m=f.thickness(),E=f.offset();return Qa.keyframes(kM||(kM=Jf([`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `],[`
      0% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      35% {height: `,";box-shadow: ","px 0 ",", ","px 0 ",`}
      70% {height: `,"px;box-shadow: ","px ","px ",", ","px ","px ",`}
      100% {box-shadow: `,"px ","px ",", ","px ","px ",`}
    `])),m,E,T,c,-E,-T,c,So.cssValue(s),E,c,-E,c,m,E,-T,c,-E,T,c,E,T,c,-E,-T,c)},f.style=function(s){var c=f.props,T=c.size,m=c.speedMultiplier,E=So.parseLengthAndUnit(T),d=E.value,x=E.unit;return Qa.css(jM||(jM=Jf([`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `],[`
      position: absolute;
      content: "";
      top: 50%;
      left: 50%;
      display: block;
      width: `,`;
      height: `,`;
      border-radius: `,`;
      transform: translate(-50%, -50%);
      animation-fill-mode: none;
      animation: `," ",`s infinite;
    `])),""+d/5+x,""+d/5+x,""+d/10+x,s===1?f.before():f.after(),2/m)},f.wrapper=function(){var s=f.props.size;return Qa.css(zM||(zM=Jf([`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      transform: rotate(165deg);
    `])),So.cssValue(s),So.cssValue(s))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Qa.jsx("span",{css:[this.wrapper(),c]},Qa.jsx("span",{css:this.style(1)}),Qa.jsx("span",{css:this.style(2)})):null},u.defaultProps=So.sizeDefaults(50),u}(X7.PureComponent);Lb.default=Y7;var VM,kM,jM,zM,Nb={},Lu=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},K7=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),Q7=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),q7=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),Z7=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&Q7(u,a,f);return q7(u,a),u};Object.defineProperty(Nb,"__esModule",{value:!0});var $7=Z7(Ln),ha=Nn,qa=On,GM=ha.keyframes(WM||(WM=Lu([`
  100% {transform: rotate(360deg)}
`],[`
  100% {transform: rotate(360deg)}
`]))),J7=function(a){K7(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.moonSize=function(){var s=f.props.size,c=qa.parseLengthAndUnit(s).value;return c/7},f.ballStyle=function(s){return ha.css(HM||(HM=Lu([`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),qa.cssValue(s),qa.cssValue(s))},f.wrapper=function(){var s=f.props,c=s.size,T=s.speedMultiplier,m=qa.parseLengthAndUnit(c),E=m.value,d=m.unit;return ha.css(XM||(XM=Lu([`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),""+(E+f.moonSize()*2)+d,""+(E+f.moonSize()*2)+d,GM,.6/T)},f.ball=function(){var s=f.props,c=s.color,T=s.size,m=s.speedMultiplier,E=qa.parseLengthAndUnit(T),d=E.value,x=E.unit;return ha.css(YM||(YM=Lu([`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `],[`
      `,`;
      background-color: `,`;
      opacity: 0.8;
      position: absolute;
      top: `,`;
      animation: `," ",`s 0s infinite linear;
      animation-fill-mode: forwards;
    `])),f.ballStyle(f.moonSize()),c,""+(d/2-f.moonSize()/2)+x,GM,.6/m)},f.circle=function(){var s=f.props,c=s.size,T=s.color,m=qa.parseLengthAndUnit(c).value;return ha.css(KM||(KM=Lu([`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `],[`
      `,`;
      border: `,"px solid ",`;
      opacity: 0.1;
      box-sizing: content-box;
      position: absolute;
    `])),f.ballStyle(m),f.moonSize(),T)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?ha.jsx("span",{css:[this.wrapper(),c]},ha.jsx("span",{css:this.ball()}),ha.jsx("span",{css:this.circle()})):null},u.defaultProps=qa.sizeDefaults(60),u}($7.PureComponent);Nb.default=J7;var WM,HM,XM,YM,KM,Fb={},Cc=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},e9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),t9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),n9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),r9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&t9(u,a,f);return n9(u,a),u};Object.defineProperty(Fb,"__esModule",{value:!0});var i9=r9(Ln),Kr=Nn,xo=On,o9=[Kr.keyframes(QM||(QM=Cc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(-44deg)}
  `]))),Kr.keyframes(qM||(qM=Cc([`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `],[`
    0% {transform: rotate(0deg)}
    50% {transform: rotate(44deg)}
  `])))],a9=function(a){e9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.ball=function(){var s=f.props.size,c=xo.parseLengthAndUnit(s),T=c.value,m=c.unit;return Kr.keyframes(ZM||(ZM=Cc([`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `],[`
      75% {opacity: 0.7}
      100% {transform: translate(`,", ",`)}
    `])),""+-4*T+m,""+-T/4+m)},f.ballStyle=function(s){var c=f.props,T=c.color,m=c.margin,E=c.size,d=c.speedMultiplier,x=xo.parseLengthAndUnit(E),M=x.value,w=x.unit;return Kr.css($M||($M=Cc([`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `],[`
      width: `,`;
      height: `,`;
      background-color: `,`;
      margin: `,`;
      border-radius: 100%;
      transform: translate(0, `,`);
      position: absolute;
      top: `,`;
      left: `,`;
      animation: `," ","s ",`s infinite linear;
      animation-fill-mode: both;
    `])),""+M/3+w,""+M/3+w,T,xo.cssValue(m),""+-M/4+w,""+M+w,""+M*4+w,f.ball(),1/d,s*.25)},f.s1=function(){return xo.cssValue(f.props.size)+" solid transparent"},f.s2=function(){var s=f.props.color;return xo.cssValue(f.props.size)+" solid "+s},f.pacmanStyle=function(s){var c=f.props,T=c.size,m=c.speedMultiplier,E=f.s1(),d=f.s2();return Kr.css(JM||(JM=Cc([`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-right: `,`;
      border-top: `,`;
      border-left: `,`;
      border-bottom: `,`;
      border-radius: `,`;
      position: absolute;
      animation: `," ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),E,s===0?E:d,d,s===0?d:E,xo.cssValue(T),o9[s],.8/m)},f.wrapper=function(){return Kr.css(e1||(e1=Cc([`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `],[`
      position: relative;
      font-size: 0;
      height: `,`;
      width: `,`;
    `])),xo.cssValue(f.props.size),xo.cssValue(f.props.size))},f.pac=function(){return f.pacmanStyle(0)},f.man=function(){return f.pacmanStyle(1)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Kr.jsx("span",{css:[this.wrapper(),c]},Kr.jsx("span",{css:this.pac()}),Kr.jsx("span",{css:this.man()}),Kr.jsx("span",{css:this.ballStyle(2)}),Kr.jsx("span",{css:this.ballStyle(3)}),Kr.jsx("span",{css:this.ballStyle(4)}),Kr.jsx("span",{css:this.ballStyle(5)})):null},u.defaultProps=xo.sizeMarginDefaults(25),u}(i9.PureComponent);Fb.default=a9;var QM,qM,ZM,$M,JM,e1,Bb={},da=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},s9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),c9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),l9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),u9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&c9(u,a,f);return l9(u,a),u};Object.defineProperty(Bb,"__esModule",{value:!0});var h9=u9(Ln),Rr=Nn,t1=On,_r=[1,3,5],d9=[Rr.keyframes(n1||(n1=da([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[1],_r[2]),Rr.keyframes(r1||(r1=da([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      50% {transform: translateX(-`,`rem) scale(0.6)}
      75% {transform: translateX(-`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[1],_r[1]),Rr.keyframes(i1||(i1=da([`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(-`,`rem) scale(0.75)}
      75% {transform: translateX(-`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[0]),Rr.keyframes(o1||(o1=da([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      75% {transform: translateX(`,`rem) scale(0.75)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[0]),Rr.keyframes(a1||(a1=da([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.6)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[1],_r[1]),Rr.keyframes(s1||(s1=da([`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `],[`
      25% {transform: translateX(`,`rem) scale(0.75)}
      50% {transform: translateX(`,`rem) scale(0.6)}
      75% {transform: translateX(`,`rem) scale(0.5)}
      95% {transform: translateX(0rem) scale(1)}
    `])),_r[0],_r[1],_r[2])],f9=function(a){s9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.size,m=c.color,E=c.speedMultiplier,d=t1.parseLengthAndUnit(T),x=d.value,M=d.unit;return Rr.css(c1||(c1=da([`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `],[`
      position: absolute;
      font-size: `,`;
      width: `,`;
      height: `,`;
      background: `,`;
      border-radius: 50%;
      animation: `," ",`s infinite;
      animation-fill-mode: forwards;
    `])),""+x/3+M,""+x+M,""+x+M,m,d9[s],1.5/E)},f.wrapper=function(){return Rr.css(l1||(l1=da([`
      position: relative;
    `],[`
      position: relative;
    `])))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Rr.jsx("span",{css:[this.wrapper(),c]},Rr.jsx("span",{css:this.style(0)}),Rr.jsx("span",{css:this.style(1)}),Rr.jsx("span",{css:this.style(2)}),Rr.jsx("span",{css:this.style(3)}),Rr.jsx("span",{css:this.style(4)}),Rr.jsx("span",{css:this.style(5)})):null},u.defaultProps=t1.sizeDefaults(15),u}(h9.PureComponent);Bb.default=f9;var n1,r1,i1,o1,a1,s1,c1,l1,Ub={},u1=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},p9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),m9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),_9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),g9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&m9(u,a,f);return _9(u,a),u};Object.defineProperty(Ub,"__esModule",{value:!0});var v9=g9(Ln),Rc=Nn,ep=On,b9=Rc.keyframes(h1||(h1=u1([`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`],[`
  0% {transform: scale(1);opacity: 1}
  45% {transform: scale(0.1);opacity: 0.7}
  80% {transform: scale(1);opacity: 1}
`]))),y9=function(a){p9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.margin,d=c.speedMultiplier;return Rc.css(d1||(d1=u1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite
        cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),T,ep.cssValue(m),ep.cssValue(m),ep.cssValue(E),b9,.75/d,s*.12/d)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Rc.jsx("span",{css:[c]},Rc.jsx("span",{css:this.style(1)}),Rc.jsx("span",{css:this.style(2)}),Rc.jsx("span",{css:this.style(3)})):null},u.defaultProps=ep.sizeMarginDefaults(15),u}(v9.PureComponent);Ub.default=y9;var h1,d1,Vb={},tp=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},T9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),E9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),S9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),x9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&E9(u,a,f);return S9(u,a),u};Object.defineProperty(Vb,"__esModule",{value:!0});var P9=x9(Ln),Za=Nn,Nu=On,f1=[Za.keyframes(p1||(p1=tp([`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`],[`
  0%  {transform: scale(0)}
  100% {transform: scale(1.0)}
`]))),Za.keyframes(m1||(m1=tp([`
  0%  {opacity: 1}
  100% {opacity: 0}
`],[`
  0%  {opacity: 1}
  100% {opacity: 0}
`])))],A9=function(a){T9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.getSize=function(){return f.props.size},f.style=function(s){var c=f.props,T=c.color,m=c.speedMultiplier;return Za.css(_1||(_1=tp([`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `],[`
      position: absolute;
      height: `,`;
      width: `,`;
      border: thick solid `,`;
      border-radius: 50%;
      opacity: 1;
      top: 0;
      left: 0;
      animation-fill-mode: both;
      animation: `,", ",`;
      animation-duration: `,`s;
      animation-iteration-count: infinite;
      animation-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1), cubic-bezier(0.3, 0.61, 0.355, 1);
      animation-delay: `,`;
    `])),Nu.cssValue(f.getSize()),Nu.cssValue(f.getSize()),T,f1[0],f1[1],2/m,s===1?"-1s":"0s")},f.wrapper=function(){return Za.css(g1||(g1=tp([`
      position: relative;
      width: `,`;
      height: `,`;
    `],[`
      position: relative;
      width: `,`;
      height: `,`;
    `])),Nu.cssValue(f.getSize()),Nu.cssValue(f.getSize()))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Za.jsx("span",{css:[this.wrapper(),c]},Za.jsx("span",{css:this.style(1)}),Za.jsx("span",{css:this.style(2)})):null},u.defaultProps=Nu.sizeDefaults(60),u}(P9.PureComponent);Vb.default=A9;var p1,m1,_1,g1,kb={},np=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},C9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),R9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),O9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),M9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&R9(u,a,f);return O9(u,a),u};Object.defineProperty(kb,"__esModule",{value:!0});var I9=M9(Ln),$a=Nn,rp=On,D9=$a.keyframes(v1||(v1=np([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}
`]))),w9=$a.keyframes(b1||(b1=np([`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`],[`
  0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)}
  100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}
`]))),L9=function(a){C9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.getSize=function(){return f.props.size},f.style=function(s){var c=f.props,T=c.color,m=c.speedMultiplier,E=rp.parseLengthAndUnit(f.getSize()),d=E.value,x=E.unit;return $a.css(y1||(y1=np([`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `],[`
      position: absolute;
      top: 0;
      left: 0;
      width: `,`;
      height: `,`;
      border: `," solid ",`;
      opacity: 0.4;
      border-radius: 100%;
      animation-fill-mode: forwards;
      perspective: 800px;
      animation: `," ",`s 0s infinite linear;
    `])),""+d+x,""+d+x,""+d/10+x,T,s===1?D9:w9,2/m)},f.wrapper=function(){return $a.css(T1||(T1=np([`
      width: `,`;
      height: `,`;
      position: relative;
    `],[`
      width: `,`;
      height: `,`;
      position: relative;
    `])),rp.cssValue(f.getSize()),rp.cssValue(f.getSize()))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?$a.jsx("span",{css:[this.wrapper(),c]},$a.jsx("span",{css:this.style(1)}),$a.jsx("span",{css:this.style(2)})):null},u.defaultProps=rp.sizeDefaults(60),u}(I9.PureComponent);kb.default=L9;var v1,b1,y1,T1,jb={},zb=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},N9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),F9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),B9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),U9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&F9(u,a,f);return B9(u,a),u};Object.defineProperty(jb,"__esModule",{value:!0});var V9=U9(Ln),Po=Nn,ip=On,op=30,k9=Po.keyframes(E1||(E1=zb([`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`],[`
  0% {transform: scale(1.1)}
  25% {transform: translateY(-`,`px)}
  50% {transform: scale(0.4)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(1.0)}
`])),op,op),j9=Po.keyframes(S1||(S1=zb([`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`],[`
  0% {transform: scale(0.4)}
  25% {transform: translateY(`,`px)}
  50% {transform: scale(1.1)}
  75% {transform: translateY(`,`px)}
  100% {transform: translateY(0) scale(0.75)}
`])),op,-op),z9=function(a){N9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.margin,d=c.speedMultiplier;return Po.css(x1||(x1=zb([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.15, 0.46, 0.9, 0.6);
      animation-fill-mode: both;
    `])),T,ip.cssValue(m),ip.cssValue(m),ip.cssValue(E),s%2==0?k9:j9,1/d)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Po.jsx("span",{css:[c]},Po.jsx("span",{css:this.style(1)}),Po.jsx("span",{css:this.style(2)}),Po.jsx("span",{css:this.style(3)}),Po.jsx("span",{css:this.style(4)}),Po.jsx("span",{css:this.style(5)})):null},u.defaultProps=ip.sizeMarginDefaults(15),u}(V9.PureComponent);jb.default=z9;var E1,S1,x1,Gb={},Oc=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},G9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),W9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),H9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),X9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&W9(u,a,f);return H9(u,a),u};Object.defineProperty(Gb,"__esModule",{value:!0});var Y9=X9(Ln),Ao=Nn,ap=On,K9=Ao.keyframes(P1||(P1=Oc([`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`],[`
  0% {transform: rotate(0deg)}
  50% {transform: rotate(180deg)}
  100% {transform: rotate(360deg)}
`]))),Q9=function(a){G9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props.margin,T=ap.parseLengthAndUnit(c),m=T.value,E=T.unit,d=(s%2?-1:1)*(26+m);return Ao.css(A1||(A1=Oc([`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `],[`
      opacity: 0.8;
      position: absolute;
      top: 0;
      left: `,"",`;
    `])),d,E)},f.ball=function(){var s=f.props,c=s.color,T=s.size;return Ao.css(C1||(C1=Oc([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      border-radius: 100%;
    `])),c,ap.cssValue(T),ap.cssValue(T))},f.wrapper=function(){var s=f.props.speedMultiplier;return Ao.css(R1||(R1=Oc([`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `],[`
      `,`;
      display: inline-block;
      position: relative;
      animation-fill-mode: both;
      animation: `," ",`s 0s infinite cubic-bezier(0.7, -0.13, 0.22, 0.86);
    `])),f.ball(),K9,1/s)},f.long=function(){return Ao.css(O1||(O1=Oc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),f.ball(),f.style(1))},f.short=function(){return Ao.css(M1||(M1=Oc([`
    `,`;
    `,`;
  `],[`
    `,`;
    `,`;
  `])),f.ball(),f.style(2))},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Ao.jsx("span",{css:[this.wrapper(),c]},Ao.jsx("span",{css:this.long()}),Ao.jsx("span",{css:this.short()})):null},u.defaultProps=ap.sizeMarginDefaults(15),u}(Y9.PureComponent);Gb.default=Q9;var P1,A1,C1,R1,O1,M1,Wb={},I1=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},q9=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),Z9=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),$9=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),J9=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&Z9(u,a,f);return $9(u,a),u};Object.defineProperty(Wb,"__esModule",{value:!0});var eQ=J9(Ln),fa=Nn,Fu=On,tQ=fa.keyframes(D1||(D1=I1([`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`],[`
  0% {transform: scaley(1.0)}
  50% {transform: scaley(0.4)}
  100% {transform: scaley(1.0)}
`]))),nQ=function(a){q9(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.width,E=c.height,d=c.margin,x=c.radius,M=c.speedMultiplier;return fa.css(w1||(w1=I1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: `,`;
      display: inline-block;
      animation: `," ","s ",`s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08);
      animation-fill-mode: both;
    `])),T,Fu.cssValue(m),Fu.cssValue(E),Fu.cssValue(d),Fu.cssValue(x),tQ,1/M,s*.1)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?fa.jsx("span",{css:[c]},fa.jsx("span",{css:this.style(1)}),fa.jsx("span",{css:this.style(2)}),fa.jsx("span",{css:this.style(3)}),fa.jsx("span",{css:this.style(4)}),fa.jsx("span",{css:this.style(5)})):null},u.defaultProps=Fu.heightWidthRadiusDefaults(35,4,2),u}(eQ.PureComponent);Wb.default=nQ;var D1,w1,Hb={},L1=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},rQ=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),iQ=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),oQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),aQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&iQ(u,a,f);return oQ(u,a),u};Object.defineProperty(Hb,"__esModule",{value:!0});var sQ=aQ(Ln),Xb=Nn,sp=On,cQ=Xb.keyframes(N1||(N1=L1([`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`],[`
  25% {transform: perspective(100px) rotateX(180deg) rotateY(0)}
  50% {transform: perspective(100px) rotateX(180deg) rotateY(180deg)}
  75% {transform: perspective(100px) rotateX(0) rotateY(180deg)}
  100% {transform: perspective(100px) rotateX(0) rotateY(0)}
`]))),lQ=function(a){rQ(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(){var s=f.props,c=s.color,T=s.speedMultiplier,m=s.size;return Xb.css(F1||(F1=L1([`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      width: 0;
      height: 0;
      border-left: `,` solid transparent;
      border-right: `,` solid transparent;
      border-bottom: `," solid ",`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),sp.cssValue(m),sp.cssValue(m),sp.cssValue(m),c,cQ,3/T)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Xb.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=sp.sizeDefaults(20),u}(sQ.PureComponent);Hb.default=lQ;var N1,F1,Yb={},B1=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},uQ=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),hQ=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),dQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),fQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&hQ(u,a,f);return dQ(u,a),u};Object.defineProperty(Yb,"__esModule",{value:!0});var pQ=fQ(Ln),Kb=Nn,Qb=On,mQ=Kb.keyframes(U1||(U1=B1([`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`],[`
  25% {transform: rotateX(180deg) rotateY(0)}
  50% {transform: rotateX(180deg) rotateY(180deg)}
  75% {transform: rotateX(0) rotateY(180deg)}
  100% {transform: rotateX(0) rotateY(0)}
`]))),_Q=function(a){uQ(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(){var s=f.props,c=s.color,T=s.size,m=s.speedMultiplier;return Kb.css(V1||(V1=B1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      display: inline-block;
      animation: `," ",`s 0s infinite cubic-bezier(0.09, 0.57, 0.49, 0.9);
      animation-fill-mode: both;
    `])),c,Qb.cssValue(T),Qb.cssValue(T),mQ,3/m)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Kb.jsx("span",{css:[this.style(),c]}):null},u.defaultProps=Qb.sizeDefaults(50),u}(pQ.PureComponent);Yb.default=_Q;var U1,V1,qb={},k1=Fe&&Fe.__makeTemplateObject||function(a,u){return Object.defineProperty?Object.defineProperty(a,"raw",{value:u}):a.raw=u,a},gQ=Fe&&Fe.__extends||function(){var a=function(u,f){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var T in c)Object.prototype.hasOwnProperty.call(c,T)&&(s[T]=c[T])},a(u,f)};return function(u,f){a(u,f);function s(){this.constructor=u}u.prototype=f===null?Object.create(f):(s.prototype=f.prototype,new s)}}(),vQ=Fe&&Fe.__createBinding||(Object.create?function(a,u,f,s){s===void 0&&(s=f),Object.defineProperty(a,s,{enumerable:!0,get:function(){return u[f]}})}:function(a,u,f,s){s===void 0&&(s=f),a[s]=u[f]}),bQ=Fe&&Fe.__setModuleDefault||(Object.create?function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}:function(a,u){a.default=u}),yQ=Fe&&Fe.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&vQ(u,a,f);return bQ(u,a),u};Object.defineProperty(qb,"__esModule",{value:!0});var TQ=yQ(Ln),Mc=Nn,EQ=Ci,Zb=On,SQ=Mc.keyframes(j1||(j1=k1([`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`],[`
  33% {transform: translateY(10px)}
  66% {transform: translateY(-10px)}
  100% {transform: translateY(0)}
`]))),xQ=function(a){gQ(u,a);function u(){var f=a!==null&&a.apply(this,arguments)||this;return f.style=function(s){var c=f.props,T=c.color,m=c.size,E=c.margin,d=c.speedMultiplier;return Mc.css(z1||(z1=k1([`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `],[`
      background-color: `,`;
      width: `,`;
      height: `,`;
      margin: `,`;
      border-radius: 100%;
      display: inline-block;
      animation: `," ","s ",`s infinite ease-in-out;
      animation-fill-mode: both;
    `])),T,Zb.cssValue(m),Zb.cssValue(m),Zb.cssValue(E),SQ,.6/d,s*.07)},f}return u.prototype.render=function(){var f=this.props,s=f.loading,c=f.css;return s?Mc.jsx("span",{css:[c]},Mc.jsx("span",{css:this.style(1)}),Mc.jsx("span",{css:this.style(2)}),Mc.jsx("span",{css:this.style(3)})):null},u.defaultProps=EQ.sizeMarginDefaults(15),u}(TQ.PureComponent);qb.default=xQ;var j1,z1;(function(a){var u=Fe&&Fe.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(a,"__esModule",{value:!0}),a.SyncLoader=a.SquareLoader=a.SkewLoader=a.ScaleLoader=a.RotateLoader=a.RiseLoader=a.RingLoader=a.PuffLoader=a.PulseLoader=a.PropagateLoader=a.PacmanLoader=a.MoonLoader=a.HashLoader=a.GridLoader=a.FadeLoader=a.DotLoader=a.ClockLoader=a.ClipLoader=a.ClimbingBoxLoader=a.CircleLoader=a.BounceLoader=a.BeatLoader=a.BarLoader=void 0;var f=vb;Object.defineProperty(a,"BarLoader",{enumerable:!0,get:function(){return u(f).default}});var s=bb;Object.defineProperty(a,"BeatLoader",{enumerable:!0,get:function(){return u(s).default}});var c=yb;Object.defineProperty(a,"BounceLoader",{enumerable:!0,get:function(){return u(c).default}});var T=Eb;Object.defineProperty(a,"CircleLoader",{enumerable:!0,get:function(){return u(T).default}});var m=xb;Object.defineProperty(a,"ClimbingBoxLoader",{enumerable:!0,get:function(){return u(m).default}});var E=Pb;Object.defineProperty(a,"ClipLoader",{enumerable:!0,get:function(){return u(E).default}});var d=Rb;Object.defineProperty(a,"ClockLoader",{enumerable:!0,get:function(){return u(d).default}});var x=Mb;Object.defineProperty(a,"DotLoader",{enumerable:!0,get:function(){return u(x).default}});var M=Ib;Object.defineProperty(a,"FadeLoader",{enumerable:!0,get:function(){return u(M).default}});var w=Db;Object.defineProperty(a,"GridLoader",{enumerable:!0,get:function(){return u(w).default}});var S=Lb;Object.defineProperty(a,"HashLoader",{enumerable:!0,get:function(){return u(S).default}});var _=Nb;Object.defineProperty(a,"MoonLoader",{enumerable:!0,get:function(){return u(_).default}});var O=Fb;Object.defineProperty(a,"PacmanLoader",{enumerable:!0,get:function(){return u(O).default}});var R=Bb;Object.defineProperty(a,"PropagateLoader",{enumerable:!0,get:function(){return u(R).default}});var I=Ub;Object.defineProperty(a,"PulseLoader",{enumerable:!0,get:function(){return u(I).default}});var y=Vb;Object.defineProperty(a,"PuffLoader",{enumerable:!0,get:function(){return u(y).default}});var p=kb;Object.defineProperty(a,"RingLoader",{enumerable:!0,get:function(){return u(p).default}});var g=jb;Object.defineProperty(a,"RiseLoader",{enumerable:!0,get:function(){return u(g).default}});var C=Gb;Object.defineProperty(a,"RotateLoader",{enumerable:!0,get:function(){return u(C).default}});var P=Wb;Object.defineProperty(a,"ScaleLoader",{enumerable:!0,get:function(){return u(P).default}});var F=Hb;Object.defineProperty(a,"SkewLoader",{enumerable:!0,get:function(){return u(F).default}});var U=Yb;Object.defineProperty(a,"SquareLoader",{enumerable:!0,get:function(){return u(U).default}});var B=qb;Object.defineProperty(a,"SyncLoader",{enumerable:!0,get:function(){return u(B).default}})})(GO);var $b={exports:{}};(function(a,u){(function(f,s){a.exports=s()})(typeof self!="undefined"?self:(typeof Fe!="undefined",Fe),function(){return function(f){var s={};function c(T){if(s[T])return s[T].exports;var m=s[T]={i:T,l:!1,exports:{}};return f[T].call(m.exports,m,m.exports,c),m.l=!0,m.exports}return c.m=f,c.c=s,c.d=function(T,m,E){c.o(T,m)||Object.defineProperty(T,m,{enumerable:!0,get:E})},c.r=function(T){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})},c.t=function(T,m){if(1&m&&(T=c(T)),8&m||4&m&&typeof T=="object"&&T&&T.__esModule)return T;var E=Object.create(null);if(c.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:T}),2&m&&typeof T!="string")for(var d in T)c.d(E,d,function(x){return T[x]}.bind(null,d));return E},c.n=function(T){var m=T&&T.__esModule?function(){return T.default}:function(){return T};return c.d(m,"a",m),m},c.o=function(T,m){return Object.prototype.hasOwnProperty.call(T,m)},c.p="",c(c.s=169)}([function(f,s,c){c.d(s,"d",function(){return M}),c.d(s,"e",function(){return w}),c.d(s,"f",function(){return S}),c.d(s,"b",function(){return _}),c.d(s,"a",function(){return O}),c.d(s,"c",function(){return I});var T=c(14),m=c(28),E=c(44),d=c(11),x=c(74),M=function(){function y(p,g){p===void 0&&(p=0),g===void 0&&(g=0),this.x=p,this.y=g}return y.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},y.prototype.getClassName=function(){return"Vector2"},y.prototype.getHashCode=function(){var p=0|this.x;return p=397*p^(0|this.y)},y.prototype.toArray=function(p,g){return g===void 0&&(g=0),p[g]=this.x,p[g+1]=this.y,this},y.prototype.fromArray=function(p,g){return g===void 0&&(g=0),y.FromArrayToRef(p,g,this),this},y.prototype.asArray=function(){var p=new Array;return this.toArray(p,0),p},y.prototype.copyFrom=function(p){return this.x=p.x,this.y=p.y,this},y.prototype.copyFromFloats=function(p,g){return this.x=p,this.y=g,this},y.prototype.set=function(p,g){return this.copyFromFloats(p,g)},y.prototype.add=function(p){return new y(this.x+p.x,this.y+p.y)},y.prototype.addToRef=function(p,g){return g.x=this.x+p.x,g.y=this.y+p.y,this},y.prototype.addInPlace=function(p){return this.x+=p.x,this.y+=p.y,this},y.prototype.addVector3=function(p){return new y(this.x+p.x,this.y+p.y)},y.prototype.subtract=function(p){return new y(this.x-p.x,this.y-p.y)},y.prototype.subtractToRef=function(p,g){return g.x=this.x-p.x,g.y=this.y-p.y,this},y.prototype.subtractInPlace=function(p){return this.x-=p.x,this.y-=p.y,this},y.prototype.multiplyInPlace=function(p){return this.x*=p.x,this.y*=p.y,this},y.prototype.multiply=function(p){return new y(this.x*p.x,this.y*p.y)},y.prototype.multiplyToRef=function(p,g){return g.x=this.x*p.x,g.y=this.y*p.y,this},y.prototype.multiplyByFloats=function(p,g){return new y(this.x*p,this.y*g)},y.prototype.divide=function(p){return new y(this.x/p.x,this.y/p.y)},y.prototype.divideToRef=function(p,g){return g.x=this.x/p.x,g.y=this.y/p.y,this},y.prototype.divideInPlace=function(p){return this.divideToRef(p,this)},y.prototype.negate=function(){return new y(-this.x,-this.y)},y.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},y.prototype.negateToRef=function(p){return p.copyFromFloats(-1*this.x,-1*this.y)},y.prototype.scaleInPlace=function(p){return this.x*=p,this.y*=p,this},y.prototype.scale=function(p){var g=new y(0,0);return this.scaleToRef(p,g),g},y.prototype.scaleToRef=function(p,g){return g.x=this.x*p,g.y=this.y*p,this},y.prototype.scaleAndAddToRef=function(p,g){return g.x+=this.x*p,g.y+=this.y*p,this},y.prototype.equals=function(p){return p&&this.x===p.x&&this.y===p.y},y.prototype.equalsWithEpsilon=function(p,g){return g===void 0&&(g=m.a),p&&T.a.WithinEpsilon(this.x,p.x,g)&&T.a.WithinEpsilon(this.y,p.y,g)},y.prototype.floor=function(){return new y(Math.floor(this.x),Math.floor(this.y))},y.prototype.fract=function(){return new y(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},y.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},y.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},y.prototype.normalize=function(){var p=this.length();return p===0||(this.x/=p,this.y/=p),this},y.prototype.clone=function(){return new y(this.x,this.y)},y.Zero=function(){return new y(0,0)},y.One=function(){return new y(1,1)},y.FromArray=function(p,g){return g===void 0&&(g=0),new y(p[g],p[g+1])},y.FromArrayToRef=function(p,g,C){C.x=p[g],C.y=p[g+1]},y.CatmullRom=function(p,g,C,P,F){var U=F*F,B=F*U;return new y(.5*(2*g.x+(-p.x+C.x)*F+(2*p.x-5*g.x+4*C.x-P.x)*U+(-p.x+3*g.x-3*C.x+P.x)*B),.5*(2*g.y+(-p.y+C.y)*F+(2*p.y-5*g.y+4*C.y-P.y)*U+(-p.y+3*g.y-3*C.y+P.y)*B))},y.Clamp=function(p,g,C){var P=p.x;P=(P=P>C.x?C.x:P)<g.x?g.x:P;var F=p.y;return new y(P,F=(F=F>C.y?C.y:F)<g.y?g.y:F)},y.Hermite=function(p,g,C,P,F){var U=F*F,B=F*U,L=2*B-3*U+1,z=-2*B+3*U,X=B-2*U+F,G=B-U;return new y(p.x*L+C.x*z+g.x*X+P.x*G,p.y*L+C.y*z+g.y*X+P.y*G)},y.Lerp=function(p,g,C){return new y(p.x+(g.x-p.x)*C,p.y+(g.y-p.y)*C)},y.Dot=function(p,g){return p.x*g.x+p.y*g.y},y.Normalize=function(p){var g=p.clone();return g.normalize(),g},y.Minimize=function(p,g){return new y(p.x<g.x?p.x:g.x,p.y<g.y?p.y:g.y)},y.Maximize=function(p,g){return new y(p.x>g.x?p.x:g.x,p.y>g.y?p.y:g.y)},y.Transform=function(p,g){var C=y.Zero();return y.TransformToRef(p,g,C),C},y.TransformToRef=function(p,g,C){var P=g.m,F=p.x*P[0]+p.y*P[4]+P[12],U=p.x*P[1]+p.y*P[5]+P[13];C.x=F,C.y=U},y.PointInTriangle=function(p,g,C,P){var F=.5*(-C.y*P.x+g.y*(-C.x+P.x)+g.x*(C.y-P.y)+C.x*P.y),U=F<0?-1:1,B=(g.y*P.x-g.x*P.y+(P.y-g.y)*p.x+(g.x-P.x)*p.y)*U,L=(g.x*C.y-g.y*C.x+(g.y-C.y)*p.x+(C.x-g.x)*p.y)*U;return B>0&&L>0&&B+L<2*F*U},y.Distance=function(p,g){return Math.sqrt(y.DistanceSquared(p,g))},y.DistanceSquared=function(p,g){var C=p.x-g.x,P=p.y-g.y;return C*C+P*P},y.Center=function(p,g){var C=p.add(g);return C.scaleInPlace(.5),C},y.DistanceOfPointFromSegment=function(p,g,C){var P=y.DistanceSquared(g,C);if(P===0)return y.Distance(p,g);var F=C.subtract(g),U=Math.max(0,Math.min(1,y.Dot(p.subtract(g),F)/P)),B=g.add(F.multiplyByFloats(U,U));return y.Distance(p,B)},y}(),w=function(){function y(p,g,C){p===void 0&&(p=0),g===void 0&&(g=0),C===void 0&&(C=0),this._isDirty=!0,this._x=p,this._y=g,this._z=C}return Object.defineProperty(y.prototype,"x",{get:function(){return this._x},set:function(p){this._x=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"y",{get:function(){return this._y},set:function(p){this._y=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"z",{get:function(){return this._z},set:function(p){this._z=p,this._isDirty=!0},enumerable:!1,configurable:!0}),y.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},y.prototype.getClassName=function(){return"Vector3"},y.prototype.getHashCode=function(){var p=0|this._x;return p=397*(p=397*p^(0|this._y))^(0|this._z)},y.prototype.asArray=function(){var p=[];return this.toArray(p,0),p},y.prototype.toArray=function(p,g){return g===void 0&&(g=0),p[g]=this._x,p[g+1]=this._y,p[g+2]=this._z,this},y.prototype.fromArray=function(p,g){return g===void 0&&(g=0),y.FromArrayToRef(p,g,this),this},y.prototype.toQuaternion=function(){return _.RotationYawPitchRoll(this._y,this._x,this._z)},y.prototype.addInPlace=function(p){return this.addInPlaceFromFloats(p._x,p._y,p._z)},y.prototype.addInPlaceFromFloats=function(p,g,C){return this.x+=p,this.y+=g,this.z+=C,this},y.prototype.add=function(p){return new y(this._x+p._x,this._y+p._y,this._z+p._z)},y.prototype.addToRef=function(p,g){return g.copyFromFloats(this._x+p._x,this._y+p._y,this._z+p._z)},y.prototype.subtractInPlace=function(p){return this.x-=p._x,this.y-=p._y,this.z-=p._z,this},y.prototype.subtract=function(p){return new y(this._x-p._x,this._y-p._y,this._z-p._z)},y.prototype.subtractToRef=function(p,g){return this.subtractFromFloatsToRef(p._x,p._y,p._z,g)},y.prototype.subtractFromFloats=function(p,g,C){return new y(this._x-p,this._y-g,this._z-C)},y.prototype.subtractFromFloatsToRef=function(p,g,C,P){return P.copyFromFloats(this._x-p,this._y-g,this._z-C)},y.prototype.negate=function(){return new y(-this._x,-this._y,-this._z)},y.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},y.prototype.negateToRef=function(p){return p.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},y.prototype.scaleInPlace=function(p){return this.x*=p,this.y*=p,this.z*=p,this},y.prototype.scale=function(p){return new y(this._x*p,this._y*p,this._z*p)},y.prototype.scaleToRef=function(p,g){return g.copyFromFloats(this._x*p,this._y*p,this._z*p)},y.prototype.scaleAndAddToRef=function(p,g){return g.addInPlaceFromFloats(this._x*p,this._y*p,this._z*p)},y.prototype.projectOnPlane=function(p,g){var C=y.Zero();return this.projectOnPlaneToRef(p,g,C),C},y.prototype.projectOnPlaneToRef=function(p,g,C){var P=p.normal,F=p.d,U=R.Vector3[0];this.subtractToRef(g,U),U.normalize();var B=y.Dot(U,P),L=-(y.Dot(g,P)+F)/B,z=U.scaleInPlace(L);g.addToRef(z,C)},y.prototype.equals=function(p){return p&&this._x===p._x&&this._y===p._y&&this._z===p._z},y.prototype.equalsWithEpsilon=function(p,g){return g===void 0&&(g=m.a),p&&T.a.WithinEpsilon(this._x,p._x,g)&&T.a.WithinEpsilon(this._y,p._y,g)&&T.a.WithinEpsilon(this._z,p._z,g)},y.prototype.equalsToFloats=function(p,g,C){return this._x===p&&this._y===g&&this._z===C},y.prototype.multiplyInPlace=function(p){return this.x*=p._x,this.y*=p._y,this.z*=p._z,this},y.prototype.multiply=function(p){return this.multiplyByFloats(p._x,p._y,p._z)},y.prototype.multiplyToRef=function(p,g){return g.copyFromFloats(this._x*p._x,this._y*p._y,this._z*p._z)},y.prototype.multiplyByFloats=function(p,g,C){return new y(this._x*p,this._y*g,this._z*C)},y.prototype.divide=function(p){return new y(this._x/p._x,this._y/p._y,this._z/p._z)},y.prototype.divideToRef=function(p,g){return g.copyFromFloats(this._x/p._x,this._y/p._y,this._z/p._z)},y.prototype.divideInPlace=function(p){return this.divideToRef(p,this)},y.prototype.minimizeInPlace=function(p){return this.minimizeInPlaceFromFloats(p._x,p._y,p._z)},y.prototype.maximizeInPlace=function(p){return this.maximizeInPlaceFromFloats(p._x,p._y,p._z)},y.prototype.minimizeInPlaceFromFloats=function(p,g,C){return p<this._x&&(this.x=p),g<this._y&&(this.y=g),C<this._z&&(this.z=C),this},y.prototype.maximizeInPlaceFromFloats=function(p,g,C){return p>this._x&&(this.x=p),g>this._y&&(this.y=g),C>this._z&&(this.z=C),this},y.prototype.isNonUniformWithinEpsilon=function(p){var g=Math.abs(this._x),C=Math.abs(this._y);if(!T.a.WithinEpsilon(g,C,p))return!0;var P=Math.abs(this._z);return!T.a.WithinEpsilon(g,P,p)||!T.a.WithinEpsilon(C,P,p)},Object.defineProperty(y.prototype,"isNonUniform",{get:function(){var p=Math.abs(this._x);return p!==Math.abs(this._y)||p!==Math.abs(this._z)},enumerable:!1,configurable:!0}),y.prototype.floor=function(){return new y(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},y.prototype.fract=function(){return new y(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},y.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},y.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},y.prototype.normalize=function(){return this.normalizeFromLength(this.length())},y.prototype.reorderInPlace=function(p){var g=this;return(p=p.toLowerCase())==="xyz"||(R.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(C,P){g[C]=R.Vector3[0][p[P]]})),this},y.prototype.rotateByQuaternionToRef=function(p,g){return p.toRotationMatrix(R.Matrix[0]),y.TransformCoordinatesToRef(this,R.Matrix[0],g),g},y.prototype.rotateByQuaternionAroundPointToRef=function(p,g,C){return this.subtractToRef(g,R.Vector3[0]),R.Vector3[0].rotateByQuaternionToRef(p,R.Vector3[0]),g.addToRef(R.Vector3[0],C),C},y.prototype.cross=function(p){return y.Cross(this,p)},y.prototype.normalizeFromLength=function(p){return p===0||p===1?this:this.scaleInPlace(1/p)},y.prototype.normalizeToNew=function(){var p=new y(0,0,0);return this.normalizeToRef(p),p},y.prototype.normalizeToRef=function(p){var g=this.length();return g===0||g===1?p.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/g,p)},y.prototype.clone=function(){return new y(this._x,this._y,this._z)},y.prototype.copyFrom=function(p){return this.copyFromFloats(p._x,p._y,p._z)},y.prototype.copyFromFloats=function(p,g,C){return this.x=p,this.y=g,this.z=C,this},y.prototype.set=function(p,g,C){return this.copyFromFloats(p,g,C)},y.prototype.setAll=function(p){return this.x=this.y=this.z=p,this},y.GetClipFactor=function(p,g,C,P){var F=y.Dot(p,C)-P;return F/(F-(y.Dot(g,C)-P))},y.GetAngleBetweenVectors=function(p,g,C){var P=p.normalizeToRef(R.Vector3[1]),F=g.normalizeToRef(R.Vector3[2]),U=y.Dot(P,F),B=R.Vector3[3];return y.CrossToRef(P,F,B),y.Dot(B,C)>0?Math.acos(U):-Math.acos(U)},y.FromArray=function(p,g){return g===void 0&&(g=0),new y(p[g],p[g+1],p[g+2])},y.FromFloatArray=function(p,g){return y.FromArray(p,g)},y.FromArrayToRef=function(p,g,C){C.x=p[g],C.y=p[g+1],C.z=p[g+2]},y.FromFloatArrayToRef=function(p,g,C){return y.FromArrayToRef(p,g,C)},y.FromFloatsToRef=function(p,g,C,P){P.copyFromFloats(p,g,C)},y.Zero=function(){return new y(0,0,0)},y.One=function(){return new y(1,1,1)},y.Up=function(){return new y(0,1,0)},Object.defineProperty(y,"UpReadOnly",{get:function(){return y._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(y,"ZeroReadOnly",{get:function(){return y._ZeroReadOnly},enumerable:!1,configurable:!0}),y.Down=function(){return new y(0,-1,0)},y.Forward=function(p){return p===void 0&&(p=!1),new y(0,0,p?-1:1)},y.Backward=function(p){return p===void 0&&(p=!1),new y(0,0,p?1:-1)},y.Right=function(){return new y(1,0,0)},y.Left=function(){return new y(-1,0,0)},y.TransformCoordinates=function(p,g){var C=y.Zero();return y.TransformCoordinatesToRef(p,g,C),C},y.TransformCoordinatesToRef=function(p,g,C){y.TransformCoordinatesFromFloatsToRef(p._x,p._y,p._z,g,C)},y.TransformCoordinatesFromFloatsToRef=function(p,g,C,P,F){var U=P.m,B=p*U[0]+g*U[4]+C*U[8]+U[12],L=p*U[1]+g*U[5]+C*U[9]+U[13],z=p*U[2]+g*U[6]+C*U[10]+U[14],X=1/(p*U[3]+g*U[7]+C*U[11]+U[15]);F.x=B*X,F.y=L*X,F.z=z*X},y.TransformNormal=function(p,g){var C=y.Zero();return y.TransformNormalToRef(p,g,C),C},y.TransformNormalToRef=function(p,g,C){this.TransformNormalFromFloatsToRef(p._x,p._y,p._z,g,C)},y.TransformNormalFromFloatsToRef=function(p,g,C,P,F){var U=P.m;F.x=p*U[0]+g*U[4]+C*U[8],F.y=p*U[1]+g*U[5]+C*U[9],F.z=p*U[2]+g*U[6]+C*U[10]},y.CatmullRom=function(p,g,C,P,F){var U=F*F,B=F*U;return new y(.5*(2*g._x+(-p._x+C._x)*F+(2*p._x-5*g._x+4*C._x-P._x)*U+(-p._x+3*g._x-3*C._x+P._x)*B),.5*(2*g._y+(-p._y+C._y)*F+(2*p._y-5*g._y+4*C._y-P._y)*U+(-p._y+3*g._y-3*C._y+P._y)*B),.5*(2*g._z+(-p._z+C._z)*F+(2*p._z-5*g._z+4*C._z-P._z)*U+(-p._z+3*g._z-3*C._z+P._z)*B))},y.Clamp=function(p,g,C){var P=new y;return y.ClampToRef(p,g,C,P),P},y.ClampToRef=function(p,g,C,P){var F=p._x;F=(F=F>C._x?C._x:F)<g._x?g._x:F;var U=p._y;U=(U=U>C._y?C._y:U)<g._y?g._y:U;var B=p._z;B=(B=B>C._z?C._z:B)<g._z?g._z:B,P.copyFromFloats(F,U,B)},y.CheckExtends=function(p,g,C){g.minimizeInPlace(p),C.maximizeInPlace(p)},y.Hermite=function(p,g,C,P,F){var U=F*F,B=F*U,L=2*B-3*U+1,z=-2*B+3*U,X=B-2*U+F,G=B-U;return new y(p._x*L+C._x*z+g._x*X+P._x*G,p._y*L+C._y*z+g._y*X+P._y*G,p._z*L+C._z*z+g._z*X+P._z*G)},y.Lerp=function(p,g,C){var P=new y(0,0,0);return y.LerpToRef(p,g,C,P),P},y.LerpToRef=function(p,g,C,P){P.x=p._x+(g._x-p._x)*C,P.y=p._y+(g._y-p._y)*C,P.z=p._z+(g._z-p._z)*C},y.Dot=function(p,g){return p._x*g._x+p._y*g._y+p._z*g._z},y.Cross=function(p,g){var C=y.Zero();return y.CrossToRef(p,g,C),C},y.CrossToRef=function(p,g,C){var P=p._y*g._z-p._z*g._y,F=p._z*g._x-p._x*g._z,U=p._x*g._y-p._y*g._x;C.copyFromFloats(P,F,U)},y.Normalize=function(p){var g=y.Zero();return y.NormalizeToRef(p,g),g},y.NormalizeToRef=function(p,g){p.normalizeToRef(g)},y.Project=function(p,g,C,P){var F=new y;return y.ProjectToRef(p,g,C,P,F),F},y.ProjectToRef=function(p,g,C,P,F){var U=P.width,B=P.height,L=P.x,z=P.y,X=R.Matrix[1];O.FromValuesToRef(U/2,0,0,0,0,-B/2,0,0,0,0,.5,0,L+U/2,B/2+z,.5,1,X);var G=R.Matrix[0];return g.multiplyToRef(C,G),G.multiplyToRef(X,G),y.TransformCoordinatesToRef(p,G,F),F},y._UnprojectFromInvertedMatrixToRef=function(p,g,C){y.TransformCoordinatesToRef(p,g,C);var P=g.m,F=p._x*P[3]+p._y*P[7]+p._z*P[11]+P[15];T.a.WithinEpsilon(F,1)&&C.scaleInPlace(1/F)},y.UnprojectFromTransform=function(p,g,C,P,F){var U=R.Matrix[0];P.multiplyToRef(F,U),U.invert(),p.x=p._x/g*2-1,p.y=-(p._y/C*2-1);var B=new y;return y._UnprojectFromInvertedMatrixToRef(p,U,B),B},y.Unproject=function(p,g,C,P,F,U){var B=y.Zero();return y.UnprojectToRef(p,g,C,P,F,U,B),B},y.UnprojectToRef=function(p,g,C,P,F,U,B){y.UnprojectFloatsToRef(p._x,p._y,p._z,g,C,P,F,U,B)},y.UnprojectFloatsToRef=function(p,g,C,P,F,U,B,L,z){var X=R.Matrix[0];U.multiplyToRef(B,X),X.multiplyToRef(L,X),X.invert();var G=R.Vector3[0];G.x=p/P*2-1,G.y=-(g/F*2-1),G.z=2*C-1,y._UnprojectFromInvertedMatrixToRef(G,X,z)},y.Minimize=function(p,g){var C=p.clone();return C.minimizeInPlace(g),C},y.Maximize=function(p,g){var C=p.clone();return C.maximizeInPlace(g),C},y.Distance=function(p,g){return Math.sqrt(y.DistanceSquared(p,g))},y.DistanceSquared=function(p,g){var C=p._x-g._x,P=p._y-g._y,F=p._z-g._z;return C*C+P*P+F*F},y.Center=function(p,g){var C=p.add(g);return C.scaleInPlace(.5),C},y.RotationFromAxis=function(p,g,C){var P=y.Zero();return y.RotationFromAxisToRef(p,g,C,P),P},y.RotationFromAxisToRef=function(p,g,C,P){var F=R.Quaternion[0];_.RotationQuaternionFromAxisToRef(p,g,C,F),F.toEulerAnglesToRef(P)},y._UpReadOnly=y.Up(),y._ZeroReadOnly=y.Zero(),y}(),S=function(){function y(p,g,C,P){this.x=p,this.y=g,this.z=C,this.w=P}return y.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},y.prototype.getClassName=function(){return"Vector4"},y.prototype.getHashCode=function(){var p=0|this.x;return p=397*(p=397*(p=397*p^(0|this.y))^(0|this.z))^(0|this.w)},y.prototype.asArray=function(){var p=new Array;return this.toArray(p,0),p},y.prototype.toArray=function(p,g){return g===void 0&&(g=0),p[g]=this.x,p[g+1]=this.y,p[g+2]=this.z,p[g+3]=this.w,this},y.prototype.fromArray=function(p,g){return g===void 0&&(g=0),y.FromArrayToRef(p,g,this),this},y.prototype.addInPlace=function(p){return this.x+=p.x,this.y+=p.y,this.z+=p.z,this.w+=p.w,this},y.prototype.add=function(p){return new y(this.x+p.x,this.y+p.y,this.z+p.z,this.w+p.w)},y.prototype.addToRef=function(p,g){return g.x=this.x+p.x,g.y=this.y+p.y,g.z=this.z+p.z,g.w=this.w+p.w,this},y.prototype.subtractInPlace=function(p){return this.x-=p.x,this.y-=p.y,this.z-=p.z,this.w-=p.w,this},y.prototype.subtract=function(p){return new y(this.x-p.x,this.y-p.y,this.z-p.z,this.w-p.w)},y.prototype.subtractToRef=function(p,g){return g.x=this.x-p.x,g.y=this.y-p.y,g.z=this.z-p.z,g.w=this.w-p.w,this},y.prototype.subtractFromFloats=function(p,g,C,P){return new y(this.x-p,this.y-g,this.z-C,this.w-P)},y.prototype.subtractFromFloatsToRef=function(p,g,C,P,F){return F.x=this.x-p,F.y=this.y-g,F.z=this.z-C,F.w=this.w-P,this},y.prototype.negate=function(){return new y(-this.x,-this.y,-this.z,-this.w)},y.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},y.prototype.negateToRef=function(p){return p.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},y.prototype.scaleInPlace=function(p){return this.x*=p,this.y*=p,this.z*=p,this.w*=p,this},y.prototype.scale=function(p){return new y(this.x*p,this.y*p,this.z*p,this.w*p)},y.prototype.scaleToRef=function(p,g){return g.x=this.x*p,g.y=this.y*p,g.z=this.z*p,g.w=this.w*p,this},y.prototype.scaleAndAddToRef=function(p,g){return g.x+=this.x*p,g.y+=this.y*p,g.z+=this.z*p,g.w+=this.w*p,this},y.prototype.equals=function(p){return p&&this.x===p.x&&this.y===p.y&&this.z===p.z&&this.w===p.w},y.prototype.equalsWithEpsilon=function(p,g){return g===void 0&&(g=m.a),p&&T.a.WithinEpsilon(this.x,p.x,g)&&T.a.WithinEpsilon(this.y,p.y,g)&&T.a.WithinEpsilon(this.z,p.z,g)&&T.a.WithinEpsilon(this.w,p.w,g)},y.prototype.equalsToFloats=function(p,g,C,P){return this.x===p&&this.y===g&&this.z===C&&this.w===P},y.prototype.multiplyInPlace=function(p){return this.x*=p.x,this.y*=p.y,this.z*=p.z,this.w*=p.w,this},y.prototype.multiply=function(p){return new y(this.x*p.x,this.y*p.y,this.z*p.z,this.w*p.w)},y.prototype.multiplyToRef=function(p,g){return g.x=this.x*p.x,g.y=this.y*p.y,g.z=this.z*p.z,g.w=this.w*p.w,this},y.prototype.multiplyByFloats=function(p,g,C,P){return new y(this.x*p,this.y*g,this.z*C,this.w*P)},y.prototype.divide=function(p){return new y(this.x/p.x,this.y/p.y,this.z/p.z,this.w/p.w)},y.prototype.divideToRef=function(p,g){return g.x=this.x/p.x,g.y=this.y/p.y,g.z=this.z/p.z,g.w=this.w/p.w,this},y.prototype.divideInPlace=function(p){return this.divideToRef(p,this)},y.prototype.minimizeInPlace=function(p){return p.x<this.x&&(this.x=p.x),p.y<this.y&&(this.y=p.y),p.z<this.z&&(this.z=p.z),p.w<this.w&&(this.w=p.w),this},y.prototype.maximizeInPlace=function(p){return p.x>this.x&&(this.x=p.x),p.y>this.y&&(this.y=p.y),p.z>this.z&&(this.z=p.z),p.w>this.w&&(this.w=p.w),this},y.prototype.floor=function(){return new y(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},y.prototype.fract=function(){return new y(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},y.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},y.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},y.prototype.normalize=function(){var p=this.length();return p===0?this:this.scaleInPlace(1/p)},y.prototype.toVector3=function(){return new w(this.x,this.y,this.z)},y.prototype.clone=function(){return new y(this.x,this.y,this.z,this.w)},y.prototype.copyFrom=function(p){return this.x=p.x,this.y=p.y,this.z=p.z,this.w=p.w,this},y.prototype.copyFromFloats=function(p,g,C,P){return this.x=p,this.y=g,this.z=C,this.w=P,this},y.prototype.set=function(p,g,C,P){return this.copyFromFloats(p,g,C,P)},y.prototype.setAll=function(p){return this.x=this.y=this.z=this.w=p,this},y.FromArray=function(p,g){return g||(g=0),new y(p[g],p[g+1],p[g+2],p[g+3])},y.FromArrayToRef=function(p,g,C){C.x=p[g],C.y=p[g+1],C.z=p[g+2],C.w=p[g+3]},y.FromFloatArrayToRef=function(p,g,C){y.FromArrayToRef(p,g,C)},y.FromFloatsToRef=function(p,g,C,P,F){F.x=p,F.y=g,F.z=C,F.w=P},y.Zero=function(){return new y(0,0,0,0)},y.One=function(){return new y(1,1,1,1)},y.Normalize=function(p){var g=y.Zero();return y.NormalizeToRef(p,g),g},y.NormalizeToRef=function(p,g){g.copyFrom(p),g.normalize()},y.Minimize=function(p,g){var C=p.clone();return C.minimizeInPlace(g),C},y.Maximize=function(p,g){var C=p.clone();return C.maximizeInPlace(g),C},y.Distance=function(p,g){return Math.sqrt(y.DistanceSquared(p,g))},y.DistanceSquared=function(p,g){var C=p.x-g.x,P=p.y-g.y,F=p.z-g.z,U=p.w-g.w;return C*C+P*P+F*F+U*U},y.Center=function(p,g){var C=p.add(g);return C.scaleInPlace(.5),C},y.TransformNormal=function(p,g){var C=y.Zero();return y.TransformNormalToRef(p,g,C),C},y.TransformNormalToRef=function(p,g,C){var P=g.m,F=p.x*P[0]+p.y*P[4]+p.z*P[8],U=p.x*P[1]+p.y*P[5]+p.z*P[9],B=p.x*P[2]+p.y*P[6]+p.z*P[10];C.x=F,C.y=U,C.z=B,C.w=p.w},y.TransformNormalFromFloatsToRef=function(p,g,C,P,F,U){var B=F.m;U.x=p*B[0]+g*B[4]+C*B[8],U.y=p*B[1]+g*B[5]+C*B[9],U.z=p*B[2]+g*B[6]+C*B[10],U.w=P},y.FromVector3=function(p,g){return g===void 0&&(g=0),new y(p._x,p._y,p._z,g)},y}(),_=function(){function y(p,g,C,P){p===void 0&&(p=0),g===void 0&&(g=0),C===void 0&&(C=0),P===void 0&&(P=1),this._isDirty=!0,this._x=p,this._y=g,this._z=C,this._w=P}return Object.defineProperty(y.prototype,"x",{get:function(){return this._x},set:function(p){this._x=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"y",{get:function(){return this._y},set:function(p){this._y=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"z",{get:function(){return this._z},set:function(p){this._z=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"w",{get:function(){return this._w},set:function(p){this._w=p,this._isDirty=!0},enumerable:!1,configurable:!0}),y.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},y.prototype.getClassName=function(){return"Quaternion"},y.prototype.getHashCode=function(){var p=0|this._x;return p=397*(p=397*(p=397*p^(0|this._y))^(0|this._z))^(0|this._w)},y.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},y.prototype.equals=function(p){return p&&this._x===p._x&&this._y===p._y&&this._z===p._z&&this._w===p._w},y.prototype.equalsWithEpsilon=function(p,g){return g===void 0&&(g=m.a),p&&T.a.WithinEpsilon(this._x,p._x,g)&&T.a.WithinEpsilon(this._y,p._y,g)&&T.a.WithinEpsilon(this._z,p._z,g)&&T.a.WithinEpsilon(this._w,p._w,g)},y.prototype.clone=function(){return new y(this._x,this._y,this._z,this._w)},y.prototype.copyFrom=function(p){return this.x=p._x,this.y=p._y,this.z=p._z,this.w=p._w,this},y.prototype.copyFromFloats=function(p,g,C,P){return this.x=p,this.y=g,this.z=C,this.w=P,this},y.prototype.set=function(p,g,C,P){return this.copyFromFloats(p,g,C,P)},y.prototype.add=function(p){return new y(this._x+p._x,this._y+p._y,this._z+p._z,this._w+p._w)},y.prototype.addInPlace=function(p){return this._x+=p._x,this._y+=p._y,this._z+=p._z,this._w+=p._w,this},y.prototype.subtract=function(p){return new y(this._x-p._x,this._y-p._y,this._z-p._z,this._w-p._w)},y.prototype.scale=function(p){return new y(this._x*p,this._y*p,this._z*p,this._w*p)},y.prototype.scaleToRef=function(p,g){return g.x=this._x*p,g.y=this._y*p,g.z=this._z*p,g.w=this._w*p,this},y.prototype.scaleInPlace=function(p){return this.x*=p,this.y*=p,this.z*=p,this.w*=p,this},y.prototype.scaleAndAddToRef=function(p,g){return g.x+=this._x*p,g.y+=this._y*p,g.z+=this._z*p,g.w+=this._w*p,this},y.prototype.multiply=function(p){var g=new y(0,0,0,1);return this.multiplyToRef(p,g),g},y.prototype.multiplyToRef=function(p,g){var C=this._x*p._w+this._y*p._z-this._z*p._y+this._w*p._x,P=-this._x*p._z+this._y*p._w+this._z*p._x+this._w*p._y,F=this._x*p._y-this._y*p._x+this._z*p._w+this._w*p._z,U=-this._x*p._x-this._y*p._y-this._z*p._z+this._w*p._w;return g.copyFromFloats(C,P,F,U),this},y.prototype.multiplyInPlace=function(p){return this.multiplyToRef(p,this),this},y.prototype.conjugateToRef=function(p){return p.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},y.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},y.prototype.conjugate=function(){return new y(-this._x,-this._y,-this._z,this._w)},y.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},y.prototype.normalize=function(){var p=this.length();if(p===0)return this;var g=1/p;return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},y.prototype.toEulerAngles=function(p){var g=w.Zero();return this.toEulerAnglesToRef(g),g},y.prototype.toEulerAnglesToRef=function(p){var g=this._z,C=this._x,P=this._y,F=this._w,U=F*F,B=g*g,L=C*C,z=P*P,X=P*g-C*F;return X<-.4999999?(p.y=2*Math.atan2(P,F),p.x=Math.PI/2,p.z=0):X>.4999999?(p.y=2*Math.atan2(P,F),p.x=-Math.PI/2,p.z=0):(p.z=Math.atan2(2*(C*P+g*F),-B-L+z+U),p.x=Math.asin(-2*(g*P-C*F)),p.y=Math.atan2(2*(g*C+P*F),B-L-z+U)),this},y.prototype.toRotationMatrix=function(p){return O.FromQuaternionToRef(this,p),this},y.prototype.fromRotationMatrix=function(p){return y.FromRotationMatrixToRef(p,this),this},y.FromRotationMatrix=function(p){var g=new y;return y.FromRotationMatrixToRef(p,g),g},y.FromRotationMatrixToRef=function(p,g){var C,P=p.m,F=P[0],U=P[4],B=P[8],L=P[1],z=P[5],X=P[9],G=P[2],ee=P[6],$=P[10],fe=F+z+$;fe>0?(C=.5/Math.sqrt(fe+1),g.w=.25/C,g.x=(ee-X)*C,g.y=(B-G)*C,g.z=(L-U)*C):F>z&&F>$?(C=2*Math.sqrt(1+F-z-$),g.w=(ee-X)/C,g.x=.25*C,g.y=(U+L)/C,g.z=(B+G)/C):z>$?(C=2*Math.sqrt(1+z-F-$),g.w=(B-G)/C,g.x=(U+L)/C,g.y=.25*C,g.z=(X+ee)/C):(C=2*Math.sqrt(1+$-F-z),g.w=(L-U)/C,g.x=(B+G)/C,g.y=(X+ee)/C,g.z=.25*C)},y.Dot=function(p,g){return p._x*g._x+p._y*g._y+p._z*g._z+p._w*g._w},y.AreClose=function(p,g){return y.Dot(p,g)>=0},y.Zero=function(){return new y(0,0,0,0)},y.Inverse=function(p){return new y(-p._x,-p._y,-p._z,p._w)},y.InverseToRef=function(p,g){return g.set(-p._x,-p._y,-p._z,p._w),g},y.Identity=function(){return new y(0,0,0,1)},y.IsIdentity=function(p){return p&&p._x===0&&p._y===0&&p._z===0&&p._w===1},y.RotationAxis=function(p,g){return y.RotationAxisToRef(p,g,new y)},y.RotationAxisToRef=function(p,g,C){var P=Math.sin(g/2);return p.normalize(),C.w=Math.cos(g/2),C.x=p._x*P,C.y=p._y*P,C.z=p._z*P,C},y.FromArray=function(p,g){return g||(g=0),new y(p[g],p[g+1],p[g+2],p[g+3])},y.FromArrayToRef=function(p,g,C){C.x=p[g],C.y=p[g+1],C.z=p[g+2],C.w=p[g+3]},y.FromEulerAngles=function(p,g,C){var P=new y;return y.RotationYawPitchRollToRef(g,p,C,P),P},y.FromEulerAnglesToRef=function(p,g,C,P){return y.RotationYawPitchRollToRef(g,p,C,P),P},y.FromEulerVector=function(p){var g=new y;return y.RotationYawPitchRollToRef(p._y,p._x,p._z,g),g},y.FromEulerVectorToRef=function(p,g){return y.RotationYawPitchRollToRef(p._y,p._x,p._z,g),g},y.RotationYawPitchRoll=function(p,g,C){var P=new y;return y.RotationYawPitchRollToRef(p,g,C,P),P},y.RotationYawPitchRollToRef=function(p,g,C,P){var F=.5*C,U=.5*g,B=.5*p,L=Math.sin(F),z=Math.cos(F),X=Math.sin(U),G=Math.cos(U),ee=Math.sin(B),$=Math.cos(B);P.x=$*X*z+ee*G*L,P.y=ee*G*z-$*X*L,P.z=$*G*L-ee*X*z,P.w=$*G*z+ee*X*L},y.RotationAlphaBetaGamma=function(p,g,C){var P=new y;return y.RotationAlphaBetaGammaToRef(p,g,C,P),P},y.RotationAlphaBetaGammaToRef=function(p,g,C,P){var F=.5*(C+p),U=.5*(C-p),B=.5*g;P.x=Math.cos(U)*Math.sin(B),P.y=Math.sin(U)*Math.sin(B),P.z=Math.sin(F)*Math.cos(B),P.w=Math.cos(F)*Math.cos(B)},y.RotationQuaternionFromAxis=function(p,g,C){var P=new y(0,0,0,0);return y.RotationQuaternionFromAxisToRef(p,g,C,P),P},y.RotationQuaternionFromAxisToRef=function(p,g,C,P){var F=R.Matrix[0];O.FromXYZAxesToRef(p.normalize(),g.normalize(),C.normalize(),F),y.FromRotationMatrixToRef(F,P)},y.Slerp=function(p,g,C){var P=y.Identity();return y.SlerpToRef(p,g,C,P),P},y.SlerpToRef=function(p,g,C,P){var F,U,B=p._x*g._x+p._y*g._y+p._z*g._z+p._w*g._w,L=!1;if(B<0&&(L=!0,B=-B),B>.999999)U=1-C,F=L?-C:C;else{var z=Math.acos(B),X=1/Math.sin(z);U=Math.sin((1-C)*z)*X,F=L?-Math.sin(C*z)*X:Math.sin(C*z)*X}P.x=U*p._x+F*g._x,P.y=U*p._y+F*g._y,P.z=U*p._z+F*g._z,P.w=U*p._w+F*g._w},y.Hermite=function(p,g,C,P,F){var U=F*F,B=F*U,L=2*B-3*U+1,z=-2*B+3*U,X=B-2*U+F,G=B-U;return new y(p._x*L+C._x*z+g._x*X+P._x*G,p._y*L+C._y*z+g._y*X+P._y*G,p._z*L+C._z*z+g._z*X+P._z*G,p._w*L+C._w*z+g._w*X+P._w*G)},y}(),O=function(){function y(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,x.a.MatrixTrackPrecisionChange&&x.a.MatrixTrackedMatrices.push(this),this._m=new x.a.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(y,"Use64Bits",{get:function(){return x.a.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),y.prototype._markAsUpdated=function(){this.updateFlag=y._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},y.prototype._updateIdentityStatus=function(p,g,C,P){g===void 0&&(g=!1),C===void 0&&(C=!1),P===void 0&&(P=!0),this.updateFlag=y._updateFlagSeed++,this._isIdentity=p,this._isIdentity3x2=p||C,this._isIdentityDirty=!this._isIdentity&&g,this._isIdentity3x2Dirty=!this._isIdentity3x2&&P},y.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var p=this._m;this._isIdentity=p[0]===1&&p[1]===0&&p[2]===0&&p[3]===0&&p[4]===0&&p[5]===1&&p[6]===0&&p[7]===0&&p[8]===0&&p[9]===0&&p[10]===1&&p[11]===0&&p[12]===0&&p[13]===0&&p[14]===0&&p[15]===1}return this._isIdentity},y.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1||this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},y.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var p=this._m,g=p[0],C=p[1],P=p[2],F=p[3],U=p[4],B=p[5],L=p[6],z=p[7],X=p[8],G=p[9],ee=p[10],$=p[11],fe=p[12],me=p[13],ve=p[14],be=p[15],ie=ee*be-ve*$,se=G*be-me*$,V=G*ve-me*ee,K=X*be-fe*$,Z=X*ve-ee*fe,le=X*me-fe*G;return g*+(B*ie-L*se+z*V)+C*-(U*ie-L*K+z*Z)+P*+(U*se-B*K+z*le)+F*-(U*V-B*Z+L*le)},y.prototype.toArray=function(){return this._m},y.prototype.asArray=function(){return this._m},y.prototype.invert=function(){return this.invertToRef(this),this},y.prototype.reset=function(){return y.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},y.prototype.add=function(p){var g=new y;return this.addToRef(p,g),g},y.prototype.addToRef=function(p,g){for(var C=this._m,P=g._m,F=p.m,U=0;U<16;U++)P[U]=C[U]+F[U];return g._markAsUpdated(),this},y.prototype.addToSelf=function(p){for(var g=this._m,C=p.m,P=0;P<16;P++)g[P]+=C[P];return this._markAsUpdated(),this},y.prototype.invertToRef=function(p){if(this._isIdentity===!0)return y.IdentityToRef(p),this;var g=this._m,C=g[0],P=g[1],F=g[2],U=g[3],B=g[4],L=g[5],z=g[6],X=g[7],G=g[8],ee=g[9],$=g[10],fe=g[11],me=g[12],ve=g[13],be=g[14],ie=g[15],se=$*ie-be*fe,V=ee*ie-ve*fe,K=ee*be-ve*$,Z=G*ie-me*fe,le=G*be-$*me,re=G*ve-me*ee,Q=+(L*se-z*V+X*K),W=-(B*se-z*Z+X*le),Y=+(B*V-L*Z+X*re),q=-(B*K-L*le+z*re),ae=C*Q+P*W+F*Y+U*q;if(ae===0)return p.copyFrom(this),this;var pe=1/ae,De=z*ie-be*X,de=L*ie-ve*X,ge=L*be-ve*z,ne=B*ie-me*X,Te=B*be-me*z,we=B*ve-me*L,Se=z*fe-$*X,Ge=L*fe-ee*X,$e=L*$-ee*z,nt=B*fe-G*X,et=B*$-G*z,Ze=B*ee-G*L,ht=-(P*se-F*V+U*K),gt=+(C*se-F*Z+U*le),Rt=-(C*V-P*Z+U*re),zt=+(C*K-P*le+F*re),un=+(P*De-F*de+U*ge),Br=-(C*De-F*ne+U*Te),lr=+(C*de-P*ne+U*we),Ur=-(C*ge-P*Te+F*we),Qr=-(P*Se-F*Ge+U*$e),qr=+(C*Se-F*nt+U*et),Xi=-(C*Ge-P*nt+U*Ze),Co=+(C*$e-P*et+F*Ze);return y.FromValuesToRef(Q*pe,ht*pe,un*pe,Qr*pe,W*pe,gt*pe,Br*pe,qr*pe,Y*pe,Rt*pe,lr*pe,Xi*pe,q*pe,zt*pe,Ur*pe,Co*pe,p),this},y.prototype.addAtIndex=function(p,g){return this._m[p]+=g,this._markAsUpdated(),this},y.prototype.multiplyAtIndex=function(p,g){return this._m[p]*=g,this._markAsUpdated(),this},y.prototype.setTranslationFromFloats=function(p,g,C){return this._m[12]=p,this._m[13]=g,this._m[14]=C,this._markAsUpdated(),this},y.prototype.addTranslationFromFloats=function(p,g,C){return this._m[12]+=p,this._m[13]+=g,this._m[14]+=C,this._markAsUpdated(),this},y.prototype.setTranslation=function(p){return this.setTranslationFromFloats(p._x,p._y,p._z)},y.prototype.getTranslation=function(){return new w(this._m[12],this._m[13],this._m[14])},y.prototype.getTranslationToRef=function(p){return p.x=this._m[12],p.y=this._m[13],p.z=this._m[14],this},y.prototype.removeRotationAndScaling=function(){var p=this.m;return y.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,p[12],p[13],p[14],p[15],this),this._updateIdentityStatus(p[12]===0&&p[13]===0&&p[14]===0&&p[15]===1),this},y.prototype.multiply=function(p){var g=new y;return this.multiplyToRef(p,g),g},y.prototype.copyFrom=function(p){p.copyToArray(this._m);var g=p;return this._updateIdentityStatus(g._isIdentity,g._isIdentityDirty,g._isIdentity3x2,g._isIdentity3x2Dirty),this},y.prototype.copyToArray=function(p,g){g===void 0&&(g=0);var C=this._m;return p[g]=C[0],p[g+1]=C[1],p[g+2]=C[2],p[g+3]=C[3],p[g+4]=C[4],p[g+5]=C[5],p[g+6]=C[6],p[g+7]=C[7],p[g+8]=C[8],p[g+9]=C[9],p[g+10]=C[10],p[g+11]=C[11],p[g+12]=C[12],p[g+13]=C[13],p[g+14]=C[14],p[g+15]=C[15],this},y.prototype.multiplyToRef=function(p,g){return this._isIdentity?(g.copyFrom(p),this):p._isIdentity?(g.copyFrom(this),this):(this.multiplyToArray(p,g._m,0),g._markAsUpdated(),this)},y.prototype.multiplyToArray=function(p,g,C){var P=this._m,F=p.m,U=P[0],B=P[1],L=P[2],z=P[3],X=P[4],G=P[5],ee=P[6],$=P[7],fe=P[8],me=P[9],ve=P[10],be=P[11],ie=P[12],se=P[13],V=P[14],K=P[15],Z=F[0],le=F[1],re=F[2],Q=F[3],W=F[4],Y=F[5],q=F[6],ae=F[7],pe=F[8],De=F[9],de=F[10],ge=F[11],ne=F[12],Te=F[13],we=F[14],Se=F[15];return g[C]=U*Z+B*W+L*pe+z*ne,g[C+1]=U*le+B*Y+L*De+z*Te,g[C+2]=U*re+B*q+L*de+z*we,g[C+3]=U*Q+B*ae+L*ge+z*Se,g[C+4]=X*Z+G*W+ee*pe+$*ne,g[C+5]=X*le+G*Y+ee*De+$*Te,g[C+6]=X*re+G*q+ee*de+$*we,g[C+7]=X*Q+G*ae+ee*ge+$*Se,g[C+8]=fe*Z+me*W+ve*pe+be*ne,g[C+9]=fe*le+me*Y+ve*De+be*Te,g[C+10]=fe*re+me*q+ve*de+be*we,g[C+11]=fe*Q+me*ae+ve*ge+be*Se,g[C+12]=ie*Z+se*W+V*pe+K*ne,g[C+13]=ie*le+se*Y+V*De+K*Te,g[C+14]=ie*re+se*q+V*de+K*we,g[C+15]=ie*Q+se*ae+V*ge+K*Se,this},y.prototype.equals=function(p){var g=p;if(!g)return!1;if((this._isIdentity||g._isIdentity)&&!this._isIdentityDirty&&!g._isIdentityDirty)return this._isIdentity&&g._isIdentity;var C=this.m,P=g.m;return C[0]===P[0]&&C[1]===P[1]&&C[2]===P[2]&&C[3]===P[3]&&C[4]===P[4]&&C[5]===P[5]&&C[6]===P[6]&&C[7]===P[7]&&C[8]===P[8]&&C[9]===P[9]&&C[10]===P[10]&&C[11]===P[11]&&C[12]===P[12]&&C[13]===P[13]&&C[14]===P[14]&&C[15]===P[15]},y.prototype.clone=function(){var p=new y;return p.copyFrom(this),p},y.prototype.getClassName=function(){return"Matrix"},y.prototype.getHashCode=function(){for(var p=0|this._m[0],g=1;g<16;g++)p=397*p^(0|this._m[g]);return p},y.prototype.decompose=function(p,g,C){if(this._isIdentity)return C&&C.setAll(0),p&&p.setAll(1),g&&g.copyFromFloats(0,0,0,1),!0;var P=this._m;if(C&&C.copyFromFloats(P[12],P[13],P[14]),(p=p||R.Vector3[0]).x=Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2]),p.y=Math.sqrt(P[4]*P[4]+P[5]*P[5]+P[6]*P[6]),p.z=Math.sqrt(P[8]*P[8]+P[9]*P[9]+P[10]*P[10]),this.determinant()<=0&&(p.y*=-1),p._x===0||p._y===0||p._z===0)return g&&g.copyFromFloats(0,0,0,1),!1;if(g){var F=1/p._x,U=1/p._y,B=1/p._z;y.FromValuesToRef(P[0]*F,P[1]*F,P[2]*F,0,P[4]*U,P[5]*U,P[6]*U,0,P[8]*B,P[9]*B,P[10]*B,0,0,0,0,1,R.Matrix[0]),_.FromRotationMatrixToRef(R.Matrix[0],g)}return!0},y.prototype.getRow=function(p){if(p<0||p>3)return null;var g=4*p;return new S(this._m[g+0],this._m[g+1],this._m[g+2],this._m[g+3])},y.prototype.setRow=function(p,g){return this.setRowFromFloats(p,g.x,g.y,g.z,g.w)},y.prototype.transpose=function(){return y.Transpose(this)},y.prototype.transposeToRef=function(p){return y.TransposeToRef(this,p),this},y.prototype.setRowFromFloats=function(p,g,C,P,F){if(p<0||p>3)return this;var U=4*p;return this._m[U+0]=g,this._m[U+1]=C,this._m[U+2]=P,this._m[U+3]=F,this._markAsUpdated(),this},y.prototype.scale=function(p){var g=new y;return this.scaleToRef(p,g),g},y.prototype.scaleToRef=function(p,g){for(var C=0;C<16;C++)g._m[C]=this._m[C]*p;return g._markAsUpdated(),this},y.prototype.scaleAndAddToRef=function(p,g){for(var C=0;C<16;C++)g._m[C]+=this._m[C]*p;return g._markAsUpdated(),this},y.prototype.toNormalMatrix=function(p){var g=R.Matrix[0];this.invertToRef(g),g.transposeToRef(p);var C=p._m;y.FromValuesToRef(C[0],C[1],C[2],0,C[4],C[5],C[6],0,C[8],C[9],C[10],0,0,0,0,1,p)},y.prototype.getRotationMatrix=function(){var p=new y;return this.getRotationMatrixToRef(p),p},y.prototype.getRotationMatrixToRef=function(p){var g=R.Vector3[0];if(!this.decompose(g))return y.IdentityToRef(p),this;var C=this._m,P=1/g._x,F=1/g._y,U=1/g._z;return y.FromValuesToRef(C[0]*P,C[1]*P,C[2]*P,0,C[4]*F,C[5]*F,C[6]*F,0,C[8]*U,C[9]*U,C[10]*U,0,0,0,0,1,p),this},y.prototype.toggleModelMatrixHandInPlace=function(){var p=this._m;p[2]*=-1,p[6]*=-1,p[8]*=-1,p[9]*=-1,p[14]*=-1,this._markAsUpdated()},y.prototype.toggleProjectionMatrixHandInPlace=function(){var p=this._m;p[8]*=-1,p[9]*=-1,p[10]*=-1,p[11]*=-1,this._markAsUpdated()},y.FromArray=function(p,g){g===void 0&&(g=0);var C=new y;return y.FromArrayToRef(p,g,C),C},y.FromArrayToRef=function(p,g,C){for(var P=0;P<16;P++)C._m[P]=p[P+g];C._markAsUpdated()},y.FromFloat32ArrayToRefScaled=function(p,g,C,P){for(var F=0;F<16;F++)P._m[F]=p[F+g]*C;P._markAsUpdated()},Object.defineProperty(y,"IdentityReadOnly",{get:function(){return y._identityReadOnly},enumerable:!1,configurable:!0}),y.FromValuesToRef=function(p,g,C,P,F,U,B,L,z,X,G,ee,$,fe,me,ve,be){var ie=be._m;ie[0]=p,ie[1]=g,ie[2]=C,ie[3]=P,ie[4]=F,ie[5]=U,ie[6]=B,ie[7]=L,ie[8]=z,ie[9]=X,ie[10]=G,ie[11]=ee,ie[12]=$,ie[13]=fe,ie[14]=me,ie[15]=ve,be._markAsUpdated()},y.FromValues=function(p,g,C,P,F,U,B,L,z,X,G,ee,$,fe,me,ve){var be=new y,ie=be._m;return ie[0]=p,ie[1]=g,ie[2]=C,ie[3]=P,ie[4]=F,ie[5]=U,ie[6]=B,ie[7]=L,ie[8]=z,ie[9]=X,ie[10]=G,ie[11]=ee,ie[12]=$,ie[13]=fe,ie[14]=me,ie[15]=ve,be._markAsUpdated(),be},y.Compose=function(p,g,C){var P=new y;return y.ComposeToRef(p,g,C,P),P},y.ComposeToRef=function(p,g,C,P){var F=P._m,U=g._x,B=g._y,L=g._z,z=g._w,X=U+U,G=B+B,ee=L+L,$=U*X,fe=U*G,me=U*ee,ve=B*G,be=B*ee,ie=L*ee,se=z*X,V=z*G,K=z*ee,Z=p._x,le=p._y,re=p._z;F[0]=(1-(ve+ie))*Z,F[1]=(fe+K)*Z,F[2]=(me-V)*Z,F[3]=0,F[4]=(fe-K)*le,F[5]=(1-($+ie))*le,F[6]=(be+se)*le,F[7]=0,F[8]=(me+V)*re,F[9]=(be-se)*re,F[10]=(1-($+ve))*re,F[11]=0,F[12]=C._x,F[13]=C._y,F[14]=C._z,F[15]=1,P._markAsUpdated()},y.Identity=function(){var p=y.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return p._updateIdentityStatus(!0),p},y.IdentityToRef=function(p){y.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,p),p._updateIdentityStatus(!0)},y.Zero=function(){var p=y.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return p._updateIdentityStatus(!1),p},y.RotationX=function(p){var g=new y;return y.RotationXToRef(p,g),g},y.Invert=function(p){var g=new y;return p.invertToRef(g),g},y.RotationXToRef=function(p,g){var C=Math.sin(p),P=Math.cos(p);y.FromValuesToRef(1,0,0,0,0,P,C,0,0,-C,P,0,0,0,0,1,g),g._updateIdentityStatus(P===1&&C===0)},y.RotationY=function(p){var g=new y;return y.RotationYToRef(p,g),g},y.RotationYToRef=function(p,g){var C=Math.sin(p),P=Math.cos(p);y.FromValuesToRef(P,0,-C,0,0,1,0,0,C,0,P,0,0,0,0,1,g),g._updateIdentityStatus(P===1&&C===0)},y.RotationZ=function(p){var g=new y;return y.RotationZToRef(p,g),g},y.RotationZToRef=function(p,g){var C=Math.sin(p),P=Math.cos(p);y.FromValuesToRef(P,C,0,0,-C,P,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(P===1&&C===0)},y.RotationAxis=function(p,g){var C=new y;return y.RotationAxisToRef(p,g,C),C},y.RotationAxisToRef=function(p,g,C){var P=Math.sin(-g),F=Math.cos(-g),U=1-F;p.normalize();var B=C._m;B[0]=p._x*p._x*U+F,B[1]=p._x*p._y*U-p._z*P,B[2]=p._x*p._z*U+p._y*P,B[3]=0,B[4]=p._y*p._x*U+p._z*P,B[5]=p._y*p._y*U+F,B[6]=p._y*p._z*U-p._x*P,B[7]=0,B[8]=p._z*p._x*U-p._y*P,B[9]=p._z*p._y*U+p._x*P,B[10]=p._z*p._z*U+F,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,C._markAsUpdated()},y.RotationAlignToRef=function(p,g,C){var P=w.Cross(g,p),F=w.Dot(g,p),U=1/(1+F),B=C._m;B[0]=P._x*P._x*U+F,B[1]=P._y*P._x*U-P._z,B[2]=P._z*P._x*U+P._y,B[3]=0,B[4]=P._x*P._y*U+P._z,B[5]=P._y*P._y*U+F,B[6]=P._z*P._y*U-P._x,B[7]=0,B[8]=P._x*P._z*U-P._y,B[9]=P._y*P._z*U+P._x,B[10]=P._z*P._z*U+F,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,C._markAsUpdated()},y.RotationYawPitchRoll=function(p,g,C){var P=new y;return y.RotationYawPitchRollToRef(p,g,C,P),P},y.RotationYawPitchRollToRef=function(p,g,C,P){_.RotationYawPitchRollToRef(p,g,C,R.Quaternion[0]),R.Quaternion[0].toRotationMatrix(P)},y.Scaling=function(p,g,C){var P=new y;return y.ScalingToRef(p,g,C,P),P},y.ScalingToRef=function(p,g,C,P){y.FromValuesToRef(p,0,0,0,0,g,0,0,0,0,C,0,0,0,0,1,P),P._updateIdentityStatus(p===1&&g===1&&C===1)},y.Translation=function(p,g,C){var P=new y;return y.TranslationToRef(p,g,C,P),P},y.TranslationToRef=function(p,g,C,P){y.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,p,g,C,1,P),P._updateIdentityStatus(p===0&&g===0&&C===0)},y.Lerp=function(p,g,C){var P=new y;return y.LerpToRef(p,g,C,P),P},y.LerpToRef=function(p,g,C,P){for(var F=P._m,U=p.m,B=g.m,L=0;L<16;L++)F[L]=U[L]*(1-C)+B[L]*C;P._markAsUpdated()},y.DecomposeLerp=function(p,g,C){var P=new y;return y.DecomposeLerpToRef(p,g,C,P),P},y.DecomposeLerpToRef=function(p,g,C,P){var F=R.Vector3[0],U=R.Quaternion[0],B=R.Vector3[1];p.decompose(F,U,B);var L=R.Vector3[2],z=R.Quaternion[1],X=R.Vector3[3];g.decompose(L,z,X);var G=R.Vector3[4];w.LerpToRef(F,L,C,G);var ee=R.Quaternion[2];_.SlerpToRef(U,z,C,ee);var $=R.Vector3[5];w.LerpToRef(B,X,C,$),y.ComposeToRef(G,ee,$,P)},y.LookAtLH=function(p,g,C){var P=new y;return y.LookAtLHToRef(p,g,C,P),P},y.LookAtLHToRef=function(p,g,C,P){var F=R.Vector3[0],U=R.Vector3[1],B=R.Vector3[2];g.subtractToRef(p,B),B.normalize(),w.CrossToRef(C,B,F);var L=F.lengthSquared();L===0?F.x=1:F.normalizeFromLength(Math.sqrt(L)),w.CrossToRef(B,F,U),U.normalize();var z=-w.Dot(F,p),X=-w.Dot(U,p),G=-w.Dot(B,p);y.FromValuesToRef(F._x,U._x,B._x,0,F._y,U._y,B._y,0,F._z,U._z,B._z,0,z,X,G,1,P)},y.LookAtRH=function(p,g,C){var P=new y;return y.LookAtRHToRef(p,g,C,P),P},y.LookAtRHToRef=function(p,g,C,P){var F=R.Vector3[0],U=R.Vector3[1],B=R.Vector3[2];p.subtractToRef(g,B),B.normalize(),w.CrossToRef(C,B,F);var L=F.lengthSquared();L===0?F.x=1:F.normalizeFromLength(Math.sqrt(L)),w.CrossToRef(B,F,U),U.normalize();var z=-w.Dot(F,p),X=-w.Dot(U,p),G=-w.Dot(B,p);y.FromValuesToRef(F._x,U._x,B._x,0,F._y,U._y,B._y,0,F._z,U._z,B._z,0,z,X,G,1,P)},y.OrthoLH=function(p,g,C,P){var F=new y;return y.OrthoLHToRef(p,g,C,P,F),F},y.OrthoLHToRef=function(p,g,C,P,F){var U=2/p,B=2/g,L=2/(P-C),z=-(P+C)/(P-C);y.FromValuesToRef(U,0,0,0,0,B,0,0,0,0,L,0,0,0,z,1,F),F._updateIdentityStatus(U===1&&B===1&&L===1&&z===0)},y.OrthoOffCenterLH=function(p,g,C,P,F,U){var B=new y;return y.OrthoOffCenterLHToRef(p,g,C,P,F,U,B),B},y.OrthoOffCenterLHToRef=function(p,g,C,P,F,U,B){var L=2/(g-p),z=2/(P-C),X=2/(U-F),G=-(U+F)/(U-F),ee=(p+g)/(p-g),$=(P+C)/(C-P);y.FromValuesToRef(L,0,0,0,0,z,0,0,0,0,X,0,ee,$,G,1,B),B._markAsUpdated()},y.OrthoOffCenterRH=function(p,g,C,P,F,U){var B=new y;return y.OrthoOffCenterRHToRef(p,g,C,P,F,U,B),B},y.OrthoOffCenterRHToRef=function(p,g,C,P,F,U,B){y.OrthoOffCenterLHToRef(p,g,C,P,F,U,B),B._m[10]*=-1},y.PerspectiveLH=function(p,g,C,P){var F=new y,U=2*C/p,B=2*C/g,L=(P+C)/(P-C),z=-2*P*C/(P-C);return y.FromValuesToRef(U,0,0,0,0,B,0,0,0,0,L,1,0,0,z,0,F),F._updateIdentityStatus(!1),F},y.PerspectiveFovLH=function(p,g,C,P){var F=new y;return y.PerspectiveFovLHToRef(p,g,C,P,F),F},y.PerspectiveFovLHToRef=function(p,g,C,P,F,U){U===void 0&&(U=!0);var B=C,L=P,z=1/Math.tan(.5*p),X=U?z/g:z,G=U?z:z*g,ee=(L+B)/(L-B),$=-2*L*B/(L-B);y.FromValuesToRef(X,0,0,0,0,G,0,0,0,0,ee,1,0,0,$,0,F),F._updateIdentityStatus(!1)},y.PerspectiveFovReverseLHToRef=function(p,g,C,P,F,U){U===void 0&&(U=!0);var B=1/Math.tan(.5*p),L=U?B/g:B,z=U?B:B*g;y.FromValuesToRef(L,0,0,0,0,z,0,0,0,0,-C,1,0,0,1,0,F),F._updateIdentityStatus(!1)},y.PerspectiveFovRH=function(p,g,C,P){var F=new y;return y.PerspectiveFovRHToRef(p,g,C,P,F),F},y.PerspectiveFovRHToRef=function(p,g,C,P,F,U){U===void 0&&(U=!0);var B=C,L=P,z=1/Math.tan(.5*p),X=U?z/g:z,G=U?z:z*g,ee=-(L+B)/(L-B),$=-2*L*B/(L-B);y.FromValuesToRef(X,0,0,0,0,G,0,0,0,0,ee,-1,0,0,$,0,F),F._updateIdentityStatus(!1)},y.PerspectiveFovReverseRHToRef=function(p,g,C,P,F,U){U===void 0&&(U=!0);var B=1/Math.tan(.5*p),L=U?B/g:B,z=U?B:B*g;y.FromValuesToRef(L,0,0,0,0,z,0,0,0,0,-C,-1,0,0,-1,0,F),F._updateIdentityStatus(!1)},y.PerspectiveFovWebVRToRef=function(p,g,C,P,F){F===void 0&&(F=!1);var U=F?-1:1,B=Math.tan(p.upDegrees*Math.PI/180),L=Math.tan(p.downDegrees*Math.PI/180),z=Math.tan(p.leftDegrees*Math.PI/180),X=Math.tan(p.rightDegrees*Math.PI/180),G=2/(z+X),ee=2/(B+L),$=P._m;$[0]=G,$[1]=$[2]=$[3]=$[4]=0,$[5]=ee,$[6]=$[7]=0,$[8]=(z-X)*G*.5,$[9]=-(B-L)*ee*.5,$[10]=-C/(g-C),$[11]=1*U,$[12]=$[13]=$[15]=0,$[14]=-2*C*g/(C-g),P._markAsUpdated()},y.GetFinalMatrix=function(p,g,C,P,F,U){var B=p.width,L=p.height,z=p.x,X=p.y,G=y.FromValues(B/2,0,0,0,0,-L/2,0,0,0,0,U-F,0,z+B/2,L/2+X,F,1),ee=R.Matrix[0];return g.multiplyToRef(C,ee),ee.multiplyToRef(P,ee),ee.multiply(G)},y.GetAsMatrix2x2=function(p){var g=p.m,C=[g[0],g[1],g[4],g[5]];return x.a.MatrixUse64Bits?C:new Float32Array(C)},y.GetAsMatrix3x3=function(p){var g=p.m,C=[g[0],g[1],g[2],g[4],g[5],g[6],g[8],g[9],g[10]];return x.a.MatrixUse64Bits?C:new Float32Array(C)},y.Transpose=function(p){var g=new y;return y.TransposeToRef(p,g),g},y.TransposeToRef=function(p,g){var C=g._m,P=p.m;C[0]=P[0],C[1]=P[4],C[2]=P[8],C[3]=P[12],C[4]=P[1],C[5]=P[5],C[6]=P[9],C[7]=P[13],C[8]=P[2],C[9]=P[6],C[10]=P[10],C[11]=P[14],C[12]=P[3],C[13]=P[7],C[14]=P[11],C[15]=P[15],g._updateIdentityStatus(p._isIdentity,p._isIdentityDirty)},y.Reflection=function(p){var g=new y;return y.ReflectionToRef(p,g),g},y.ReflectionToRef=function(p,g){p.normalize();var C=p.normal.x,P=p.normal.y,F=p.normal.z,U=-2*C,B=-2*P,L=-2*F;y.FromValuesToRef(U*C+1,B*C,L*C,0,U*P,B*P+1,L*P,0,U*F,B*F,L*F+1,0,U*p.d,B*p.d,L*p.d,1,g)},y.FromXYZAxesToRef=function(p,g,C,P){y.FromValuesToRef(p._x,p._y,p._z,0,g._x,g._y,g._z,0,C._x,C._y,C._z,0,0,0,0,1,P)},y.FromQuaternionToRef=function(p,g){var C=p._x*p._x,P=p._y*p._y,F=p._z*p._z,U=p._x*p._y,B=p._z*p._w,L=p._z*p._x,z=p._y*p._w,X=p._y*p._z,G=p._x*p._w;g._m[0]=1-2*(P+F),g._m[1]=2*(U+B),g._m[2]=2*(L-z),g._m[3]=0,g._m[4]=2*(U-B),g._m[5]=1-2*(F+C),g._m[6]=2*(X+G),g._m[7]=0,g._m[8]=2*(L+z),g._m[9]=2*(X-G),g._m[10]=1-2*(P+C),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,g._markAsUpdated()},y._updateFlagSeed=0,y._identityReadOnly=y.Identity(),y}(),R=function(){function y(){}return y.Vector3=E.a.BuildArray(6,w.Zero),y.Matrix=E.a.BuildArray(2,O.Identity),y.Quaternion=E.a.BuildArray(3,_.Zero),y}(),I=function(){function y(){}return y.Vector2=E.a.BuildArray(3,M.Zero),y.Vector3=E.a.BuildArray(13,w.Zero),y.Vector4=E.a.BuildArray(3,S.Zero),y.Quaternion=E.a.BuildArray(2,_.Zero),y.Matrix=E.a.BuildArray(8,O.Identity),y}();d.a.RegisteredTypes["BABYLON.Vector2"]=M,d.a.RegisteredTypes["BABYLON.Vector3"]=w,d.a.RegisteredTypes["BABYLON.Vector4"]=S,d.a.RegisteredTypes["BABYLON.Matrix"]=O},function(f,s,c){c.d(s,"d",function(){return m}),c.d(s,"a",function(){return E}),c.d(s,"c",function(){return d}),c.d(s,"b",function(){return x}),c.d(s,"e",function(){return M}),c.d(s,"f",function(){return w});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var T=function(S,_){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,R){O.__proto__=R}||function(O,R){for(var I in R)Object.prototype.hasOwnProperty.call(R,I)&&(O[I]=R[I])})(S,_)};function m(S,_){function O(){this.constructor=S}T(S,_),S.prototype=_===null?Object.create(_):(O.prototype=_.prototype,new O)}var E=function(){return(E=Object.assign||function(S){for(var _,O=1,R=arguments.length;O<R;O++)for(var I in _=arguments[O])Object.prototype.hasOwnProperty.call(_,I)&&(S[I]=_[I]);return S}).apply(this,arguments)};function d(S,_,O,R){var I,y=arguments.length,p=y<3?_:R===null?R=Object.getOwnPropertyDescriptor(_,O):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(S,_,O,R);else for(var g=S.length-1;g>=0;g--)(I=S[g])&&(p=(y<3?I(p):y>3?I(_,O,p):I(_,O))||p);return y>3&&p&&Object.defineProperty(_,O,p),p}function x(S,_,O,R){return new(O||(O=Promise))(function(I,y){function p(P){try{C(R.next(P))}catch(F){y(F)}}function g(P){try{C(R.throw(P))}catch(F){y(F)}}function C(P){var F;P.done?I(P.value):(F=P.value,F instanceof O?F:new O(function(U){U(F)})).then(p,g)}C((R=R.apply(S,_||[])).next())})}function M(S,_){var O,R,I,y,p={label:0,sent:function(){if(1&I[0])throw I[1];return I[1]},trys:[],ops:[]};return y={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function g(C){return function(P){return function(F){if(O)throw new TypeError("Generator is already executing.");for(;p;)try{if(O=1,R&&(I=2&F[0]?R.return:F[0]?R.throw||((I=R.return)&&I.call(R),0):R.next)&&!(I=I.call(R,F[1])).done)return I;switch(R=0,I&&(F=[2&F[0],I.value]),F[0]){case 0:case 1:I=F;break;case 4:return p.label++,{value:F[1],done:!1};case 5:p.label++,R=F[1],F=[0];continue;case 7:F=p.ops.pop(),p.trys.pop();continue;default:if(I=p.trys,!((I=I.length>0&&I[I.length-1])||F[0]!==6&&F[0]!==2)){p=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){p.label=F[1];break}if(F[0]===6&&p.label<I[1]){p.label=I[1],I=F;break}if(I&&p.label<I[2]){p.label=I[2],p.ops.push(F);break}I[2]&&p.ops.pop(),p.trys.pop();continue}F=_.call(S,p)}catch(U){F=[6,U],R=0}finally{O=I=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([C,P])}}}function w(){for(var S=0,_=0,O=arguments.length;_<O;_++)S+=arguments[_].length;var R=Array(S),I=0;for(_=0;_<O;_++)for(var y=arguments[_],p=0,g=y.length;p<g;p++,I++)R[I]=y[p];return R}},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.ALPHA_DISABLE=0,m.ALPHA_ADD=1,m.ALPHA_COMBINE=2,m.ALPHA_SUBTRACT=3,m.ALPHA_MULTIPLY=4,m.ALPHA_MAXIMIZED=5,m.ALPHA_ONEONE=6,m.ALPHA_PREMULTIPLIED=7,m.ALPHA_PREMULTIPLIED_PORTERDUFF=8,m.ALPHA_INTERPOLATE=9,m.ALPHA_SCREENMODE=10,m.ALPHA_ONEONE_ONEONE=11,m.ALPHA_ALPHATOCOLOR=12,m.ALPHA_REVERSEONEMINUS=13,m.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,m.ALPHA_ONEONE_ONEZERO=15,m.ALPHA_EXCLUSION=16,m.ALPHA_EQUATION_ADD=0,m.ALPHA_EQUATION_SUBSTRACT=1,m.ALPHA_EQUATION_REVERSE_SUBTRACT=2,m.ALPHA_EQUATION_MAX=3,m.ALPHA_EQUATION_MIN=4,m.ALPHA_EQUATION_DARKEN=5,m.DELAYLOADSTATE_NONE=0,m.DELAYLOADSTATE_LOADED=1,m.DELAYLOADSTATE_LOADING=2,m.DELAYLOADSTATE_NOTLOADED=4,m.NEVER=512,m.ALWAYS=519,m.LESS=513,m.EQUAL=514,m.LEQUAL=515,m.GREATER=516,m.GEQUAL=518,m.NOTEQUAL=517,m.KEEP=7680,m.REPLACE=7681,m.INCR=7682,m.DECR=7683,m.INVERT=5386,m.INCR_WRAP=34055,m.DECR_WRAP=34056,m.TEXTURE_CLAMP_ADDRESSMODE=0,m.TEXTURE_WRAP_ADDRESSMODE=1,m.TEXTURE_MIRROR_ADDRESSMODE=2,m.TEXTUREFORMAT_ALPHA=0,m.TEXTUREFORMAT_LUMINANCE=1,m.TEXTUREFORMAT_LUMINANCE_ALPHA=2,m.TEXTUREFORMAT_RGB=4,m.TEXTUREFORMAT_RGBA=5,m.TEXTUREFORMAT_RED=6,m.TEXTUREFORMAT_R=6,m.TEXTUREFORMAT_RG=7,m.TEXTUREFORMAT_RED_INTEGER=8,m.TEXTUREFORMAT_R_INTEGER=8,m.TEXTUREFORMAT_RG_INTEGER=9,m.TEXTUREFORMAT_RGB_INTEGER=10,m.TEXTUREFORMAT_RGBA_INTEGER=11,m.TEXTURETYPE_UNSIGNED_BYTE=0,m.TEXTURETYPE_UNSIGNED_INT=0,m.TEXTURETYPE_FLOAT=1,m.TEXTURETYPE_HALF_FLOAT=2,m.TEXTURETYPE_BYTE=3,m.TEXTURETYPE_SHORT=4,m.TEXTURETYPE_UNSIGNED_SHORT=5,m.TEXTURETYPE_INT=6,m.TEXTURETYPE_UNSIGNED_INTEGER=7,m.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,m.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,m.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,m.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,m.TEXTURETYPE_UNSIGNED_INT_24_8=12,m.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,m.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,m.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,m.TEXTURE_NEAREST_SAMPLINGMODE=1,m.TEXTURE_NEAREST_NEAREST=1,m.TEXTURE_BILINEAR_SAMPLINGMODE=2,m.TEXTURE_LINEAR_LINEAR=2,m.TEXTURE_TRILINEAR_SAMPLINGMODE=3,m.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,m.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,m.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,m.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,m.TEXTURE_NEAREST_LINEAR=7,m.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,m.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,m.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,m.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,m.TEXTURE_LINEAR_NEAREST=12,m.TEXTURE_EXPLICIT_MODE=0,m.TEXTURE_SPHERICAL_MODE=1,m.TEXTURE_PLANAR_MODE=2,m.TEXTURE_CUBIC_MODE=3,m.TEXTURE_PROJECTION_MODE=4,m.TEXTURE_SKYBOX_MODE=5,m.TEXTURE_INVCUBIC_MODE=6,m.TEXTURE_EQUIRECTANGULAR_MODE=7,m.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,m.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,m.TEXTURE_FILTERING_QUALITY_HIGH=64,m.TEXTURE_FILTERING_QUALITY_MEDIUM=16,m.TEXTURE_FILTERING_QUALITY_LOW=8,m.SCALEMODE_FLOOR=1,m.SCALEMODE_NEAREST=2,m.SCALEMODE_CEILING=3,m.MATERIAL_TextureDirtyFlag=1,m.MATERIAL_LightDirtyFlag=2,m.MATERIAL_FresnelDirtyFlag=4,m.MATERIAL_AttributesDirtyFlag=8,m.MATERIAL_MiscDirtyFlag=16,m.MATERIAL_PrePassDirtyFlag=32,m.MATERIAL_AllDirtyFlag=63,m.MATERIAL_TriangleFillMode=0,m.MATERIAL_WireFrameFillMode=1,m.MATERIAL_PointFillMode=2,m.MATERIAL_PointListDrawMode=3,m.MATERIAL_LineListDrawMode=4,m.MATERIAL_LineLoopDrawMode=5,m.MATERIAL_LineStripDrawMode=6,m.MATERIAL_TriangleStripDrawMode=7,m.MATERIAL_TriangleFanDrawMode=8,m.MATERIAL_ClockWiseSideOrientation=0,m.MATERIAL_CounterClockWiseSideOrientation=1,m.ACTION_NothingTrigger=0,m.ACTION_OnPickTrigger=1,m.ACTION_OnLeftPickTrigger=2,m.ACTION_OnRightPickTrigger=3,m.ACTION_OnCenterPickTrigger=4,m.ACTION_OnPickDownTrigger=5,m.ACTION_OnDoublePickTrigger=6,m.ACTION_OnPickUpTrigger=7,m.ACTION_OnPickOutTrigger=16,m.ACTION_OnLongPressTrigger=8,m.ACTION_OnPointerOverTrigger=9,m.ACTION_OnPointerOutTrigger=10,m.ACTION_OnEveryFrameTrigger=11,m.ACTION_OnIntersectionEnterTrigger=12,m.ACTION_OnIntersectionExitTrigger=13,m.ACTION_OnKeyDownTrigger=14,m.ACTION_OnKeyUpTrigger=15,m.PARTICLES_BILLBOARDMODE_Y=2,m.PARTICLES_BILLBOARDMODE_ALL=7,m.PARTICLES_BILLBOARDMODE_STRETCHED=8,m.MESHES_CULLINGSTRATEGY_STANDARD=0,m.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,m.SCENELOADER_NO_LOGGING=0,m.SCENELOADER_MINIMAL_LOGGING=1,m.SCENELOADER_SUMMARY_LOGGING=2,m.SCENELOADER_DETAILED_LOGGING=3,m.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,m.PREPASS_POSITION_TEXTURE_TYPE=1,m.PREPASS_VELOCITY_TEXTURE_TYPE=2,m.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,m.PREPASS_COLOR_TEXTURE_TYPE=4,m.PREPASS_DEPTHNORMAL_TEXTURE_TYPE=5,m.PREPASS_ALBEDO_TEXTURE_TYPE=6,m}()},function(f,s,c){c.d(s,"b",function(){return O}),c.d(s,"c",function(){return R}),c.d(s,"m",function(){return I}),c.d(s,"e",function(){return y}),c.d(s,"h",function(){return p}),c.d(s,"n",function(){return g}),c.d(s,"o",function(){return C}),c.d(s,"k",function(){return P}),c.d(s,"g",function(){return F}),c.d(s,"f",function(){return U}),c.d(s,"i",function(){return B}),c.d(s,"l",function(){return L}),c.d(s,"j",function(){return z}),c.d(s,"d",function(){return X}),c.d(s,"a",function(){return G});var T=c(37),m=c(0),E=c(21),d=c(9),x={},M={},w=function(ee,$,fe){var me=ee();T.a&&T.a.AddTagsTo(me,$.tags);var ve=S(me);for(var be in ve){var ie=ve[be],se=$[be],V=ie.type;if(se!=null&&be!=="uniqueId")switch(V){case 0:case 6:case 11:me[be]=se;break;case 1:me[be]=fe||se.isRenderTarget?se:se.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:me[be]=fe?se:se.clone()}}return me};function S(ee){var $=ee.getClassName();if(M[$])return M[$];M[$]={};for(var fe=M[$],me=ee,ve=$;ve;){var be=x[ve];for(var ie in be)fe[ie]=be[ie];var se=void 0,V=!1;do{if(!(se=Object.getPrototypeOf(me)).getClassName){V=!0;break}if(se.getClassName()!==ve)break;me=se}while(se);if(V)break;ve=se.getClassName(),me=se}return fe}function _(ee,$){return function(fe,me){var ve=function(be){var ie=be.getClassName();return x[ie]||(x[ie]={}),x[ie]}(fe);ve[me]||(ve[me]={type:ee,sourceName:$})}}function O(ee,$){return $===void 0&&($=null),function(fe,me){return me===void 0&&(me=null),function(ve,be){var ie=me||"_"+be;Object.defineProperty(ve,be,{get:function(){return this[ie]},set:function(se){this[ie]!==se&&(this[ie]=se,ve[fe].apply(this))},enumerable:!0,configurable:!0})}}(ee,$)}function R(ee){return _(0,ee)}function I(ee){return _(1,ee)}function y(ee){return _(2,ee)}function p(ee){return _(3,ee)}function g(ee){return _(4,ee)}function C(ee){return _(5,ee)}function P(ee){return _(6,ee)}function F(ee){return _(7,ee)}function U(ee){return _(8,ee)}function B(ee){return _(9,ee)}function L(ee){return _(10,ee)}function z(ee){return _(12,ee)}function X(ee){return _(11,ee)}var G=function(){function ee(){}return ee.AppendSerializedAnimations=function($,fe){if($.animations){fe.animations=[];for(var me=0;me<$.animations.length;me++){var ve=$.animations[me];fe.animations.push(ve.serialize())}}},ee.Serialize=function($,fe){fe||(fe={}),T.a&&(fe.tags=T.a.GetTags($));var me=S($);for(var ve in me){var be=me[ve],ie=be.sourceName||ve,se=be.type,V=$[ve];if(V!=null&&ve!=="uniqueId")switch(se){case 0:fe[ie]=V;break;case 1:fe[ie]=V.serialize();break;case 2:fe[ie]=V.asArray();break;case 3:fe[ie]=V.serialize();break;case 4:case 5:fe[ie]=V.asArray();break;case 6:fe[ie]=V.id;break;case 7:fe[ie]=V.serialize();break;case 8:fe[ie]=V.asArray();break;case 9:fe[ie]=V.serialize();break;case 10:fe[ie]=V.asArray();break;case 11:fe[ie]=V.id;case 12:fe[ie]=V.asArray()}}return fe},ee.Parse=function($,fe,me,ve){ve===void 0&&(ve=null);var be=$();ve||(ve=""),T.a&&T.a.AddTagsTo(be,fe.tags);var ie=S(be);for(var se in ie){var V=ie[se],K=fe[V.sourceName||se],Z=V.type;if(K!=null&&se!=="uniqueId"){var le=be;switch(Z){case 0:le[se]=K;break;case 1:me&&(le[se]=ee._TextureParser(K,me,ve));break;case 2:le[se]=d.a.FromArray(K);break;case 3:le[se]=ee._FresnelParametersParser(K);break;case 4:le[se]=m.d.FromArray(K);break;case 5:le[se]=m.e.FromArray(K);break;case 6:me&&(le[se]=me.getLastMeshByID(K));break;case 7:le[se]=ee._ColorCurvesParser(K);break;case 8:le[se]=d.b.FromArray(K);break;case 9:le[se]=ee._ImageProcessingConfigurationParser(K);break;case 10:le[se]=m.b.FromArray(K);break;case 11:me&&(le[se]=me.getCameraByID(K));case 12:le[se]=m.a.FromArray(K)}}}return be},ee.Clone=function($,fe){return w($,fe,!1)},ee.Instanciate=function($,fe){return w($,fe,!0)},ee._ImageProcessingConfigurationParser=function($){throw E.a.WarnImport("ImageProcessingConfiguration")},ee._FresnelParametersParser=function($){throw E.a.WarnImport("FresnelParameters")},ee._ColorCurvesParser=function($){throw E.a.WarnImport("ColorCurves")},ee._TextureParser=function($,fe,me){throw E.a.WarnImport("Texture")},ee}()},function(f,s,c){c.d(s,"a",function(){return T}),c.d(s,"b",function(){return m});var T=function(){function E(d,x,M,w,S,_,O,R){w===void 0&&(w=0),S===void 0&&(S=!1),_===void 0&&(_=!1),O===void 0&&(O=!1),this._isAlreadyOwned=!1,d.getScene?this._engine=d.getScene().getEngine():this._engine=d,this._updatable=M,this._instanced=_,this._divisor=R||1,this._data=x,this.byteStride=O?w:w*Float32Array.BYTES_PER_ELEMENT,S||this.create()}return E.prototype.createVertexBuffer=function(d,x,M,w,S,_,O){_===void 0&&(_=!1);var R=_?x:x*Float32Array.BYTES_PER_ELEMENT,I=w?_?w:w*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,d,this._updatable,!0,I,S===void 0?this._instanced:S,R,M,void 0,void 0,!0,this._divisor||O)},E.prototype.isUpdatable=function(){return this._updatable},E.prototype.getData=function(){return this._data},E.prototype.getBuffer=function(){return this._buffer},E.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},E.prototype.create=function(d){d===void 0&&(d=null),!d&&this._buffer||(d=d||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d),this._data=d):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(d),this._data=d):this._buffer=this._engine.createVertexBuffer(d))},E.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},E.prototype.update=function(d){this.create(d)},E.prototype.updateDirectly=function(d,x,M,w){w===void 0&&(w=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d,w?x:x*Float32Array.BYTES_PER_ELEMENT,M?M*this.byteStride:void 0),this._data=null)},E.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},E.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},E}(),m=function(){function E(d,x,M,w,S,_,O,R,I,y,p,g,C,P){if(p===void 0&&(p=!1),g===void 0&&(g=!1),C===void 0&&(C=1),P===void 0&&(P=!1),x instanceof T?(this._buffer=x,this._ownsBuffer=P,P&&this._buffer._increaseReferences()):(this._buffer=new T(d,x,w,_,S,O,g),this._ownsBuffer=!0),this._kind=M,y==null){var F=this.getData();this.type=E.FLOAT,F instanceof Int8Array?this.type=E.BYTE:F instanceof Uint8Array?this.type=E.UNSIGNED_BYTE:F instanceof Int16Array?this.type=E.SHORT:F instanceof Uint16Array?this.type=E.UNSIGNED_SHORT:F instanceof Int32Array?this.type=E.INT:F instanceof Uint32Array&&(this.type=E.UNSIGNED_INT)}else this.type=y;var U=E.GetTypeByteLength(this.type);g?(this._size=I||(_?_/U:E.DeduceStride(M)),this.byteStride=_||this._buffer.byteStride||this._size*U,this.byteOffset=R||0):(this._size=I||_||E.DeduceStride(M),this.byteStride=_?_*U:this._buffer.byteStride||this._size*U,this.byteOffset=(R||0)*U),this.normalized=p,this._instanced=O!==void 0&&O,this._instanceDivisor=O?C:0}return Object.defineProperty(E.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(d){this._instanceDivisor=d,this._instanced=d!=0},enumerable:!1,configurable:!0}),E.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},E.prototype.getKind=function(){return this._kind},E.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},E.prototype.getData=function(){return this._buffer.getData()},E.prototype.getBuffer=function(){return this._buffer.getBuffer()},E.prototype.getStrideSize=function(){return this.byteStride/E.GetTypeByteLength(this.type)},E.prototype.getOffset=function(){return this.byteOffset/E.GetTypeByteLength(this.type)},E.prototype.getSize=function(){return this._size},E.prototype.getIsInstanced=function(){return this._instanced},E.prototype.getInstanceDivisor=function(){return this._instanceDivisor},E.prototype.create=function(d){this._buffer.create(d)},E.prototype.update=function(d){this._buffer.update(d)},E.prototype.updateDirectly=function(d,x,M){M===void 0&&(M=!1),this._buffer.updateDirectly(d,x,void 0,M)},E.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},E.prototype.forEach=function(d,x){E.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,d,this.normalized,x)},E.DeduceStride=function(d){switch(d){case E.UVKind:case E.UV2Kind:case E.UV3Kind:case E.UV4Kind:case E.UV5Kind:case E.UV6Kind:return 2;case E.NormalKind:case E.PositionKind:return 3;case E.ColorKind:case E.MatricesIndicesKind:case E.MatricesIndicesExtraKind:case E.MatricesWeightsKind:case E.MatricesWeightsExtraKind:case E.TangentKind:return 4;default:throw new Error("Invalid kind '"+d+"'")}},E.GetTypeByteLength=function(d){switch(d){case E.BYTE:case E.UNSIGNED_BYTE:return 1;case E.SHORT:case E.UNSIGNED_SHORT:return 2;case E.INT:case E.UNSIGNED_INT:case E.FLOAT:return 4;default:throw new Error("Invalid type '"+d+"'")}},E.ForEach=function(d,x,M,w,S,_,O,R){if(d instanceof Array)for(var I=x/4,y=M/4,p=0;p<_;p+=w){for(var g=0;g<w;g++)R(d[I+g],p+g);I+=y}else{var C=d instanceof ArrayBuffer?new DataView(d):new DataView(d.buffer,d.byteOffset,d.byteLength),P=E.GetTypeByteLength(S);for(p=0;p<_;p+=w){var F=x;for(g=0;g<w;g++)R(E._GetFloatValue(C,S,F,O),p+g),F+=P;x+=M}}},E._GetFloatValue=function(d,x,M,w){switch(x){case E.BYTE:var S=d.getInt8(M);return w&&(S=Math.max(S/127,-1)),S;case E.UNSIGNED_BYTE:return S=d.getUint8(M),w&&(S/=255),S;case E.SHORT:return S=d.getInt16(M,!0),w&&(S=Math.max(S/32767,-1)),S;case E.UNSIGNED_SHORT:return S=d.getUint16(M,!0),w&&(S/=65535),S;case E.INT:return d.getInt32(M,!0);case E.UNSIGNED_INT:return d.getUint32(M,!0);case E.FLOAT:return d.getFloat32(M,!0);default:throw new Error("Invalid component type "+x)}},E.BYTE=5120,E.UNSIGNED_BYTE=5121,E.SHORT=5122,E.UNSIGNED_SHORT=5123,E.INT=5124,E.UNSIGNED_INT=5125,E.FLOAT=5126,E.PositionKind="position",E.NormalKind="normal",E.TangentKind="tangent",E.UVKind="uv",E.UV2Kind="uv2",E.UV3Kind="uv3",E.UV4Kind="uv4",E.UV5Kind="uv5",E.UV6Kind="uv6",E.ColorKind="color",E.MatricesIndicesKind="matricesIndices",E.MatricesWeightsKind="matricesWeights",E.MatricesIndicesExtraKind="matricesIndicesExtra",E.MatricesWeightsExtraKind="matricesWeightsExtra",E}()},function(f,s,c){c.d(s,"a",function(){return M});var T=c(6),m=c(2),E=c(38),d=c(8),x=c(128),M=function(){function w(S,_,O,R,I,y,p,g,C,P){var F,U=this;R===void 0&&(R=null),y===void 0&&(y=null),p===void 0&&(p=null),g===void 0&&(g=null),C===void 0&&(C=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new T.c,this.onErrorObservable=new T.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=S;var B,L,z=null;if(_.attributes){var X=_;if(this._engine=O,this._attributesNames=X.attributes,this._uniformsNames=X.uniformsNames.concat(X.samplers),this._samplerList=X.samplers.slice(),this.defines=X.defines,this.onError=X.onError,this.onCompiled=X.onCompiled,this._fallbacks=X.fallbacks,this._indexParameters=X.indexParameters,this._transformFeedbackVaryings=X.transformFeedbackVaryings||null,this._multiTarget=!!X.multiTarget,X.uniformBuffersNames){this._uniformBuffersNamesList=X.uniformBuffersNames.slice();for(var G=0;G<X.uniformBuffersNames.length;G++)this._uniformBuffersNames[X.uniformBuffersNames[G]]=G}z=(F=X.processFinalCode)!==null&&F!==void 0?F:null}else this._engine=I,this.defines=y??"",this._uniformsNames=O.concat(R),this._samplerList=R?R.slice():[],this._attributesNames=_,this._uniformBuffersNamesList=[],this.onError=C,this.onCompiled=g,this._indexParameters=P,this._fallbacks=p;this._attributeLocationByName={},this.uniqueId=w._uniqueIdSeed++;var ee=E.a.IsWindowObjectExist()?this._engine.getHostDocument():null;S.vertexSource?B="source:"+S.vertexSource:S.vertexElement?(B=ee?ee.getElementById(S.vertexElement):null)||(B=S.vertexElement):B=S.vertex||S,S.fragmentSource?L="source:"+S.fragmentSource:S.fragmentElement?(L=ee?ee.getElementById(S.fragmentElement):null)||(L=S.fragmentElement):L=S.fragment||S;var $={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:w.ShadersRepository,includesShadersStore:w.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(B,"Vertex","",function(fe){U._rawVertexSourceCode=fe,U._loadShader(L,"Fragment","Pixel",function(me){U._rawFragmentSourceCode=me,x.a.Process(fe,$,function(ve){z&&(ve=z("vertex",ve)),$.isFragment=!0,x.a.Process(me,$,function(be){z&&(be=z("fragment",be)),U._useFinalCode(ve,be,S)},U._engine)},U._engine)})})}return Object.defineProperty(w.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new T.c),this._onBindObservable},enumerable:!1,configurable:!0}),w.prototype._useFinalCode=function(S,_,O){if(O){var R=O.vertexElement||O.vertex||O.spectorName||O,I=O.fragmentElement||O.fragment||O.spectorName||O;this._vertexSourceCode="#define SHADER_NAME vertex:"+R+`
`+S,this._fragmentSourceCode="#define SHADER_NAME fragment:"+I+`
`+_}else this._vertexSourceCode=S,this._fragmentSourceCode=_;this._prepareEffect()},Object.defineProperty(w.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),w.prototype.isReady=function(){try{return this._isReadyInternal()}catch(S){return!1}},w.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},w.prototype.getEngine=function(){return this._engine},w.prototype.getPipelineContext=function(){return this._pipelineContext},w.prototype.getAttributesNames=function(){return this._attributesNames},w.prototype.getAttributeLocation=function(S){return this._attributes[S]},w.prototype.getAttributeLocationByName=function(S){return this._attributeLocationByName[S]},w.prototype.getAttributesCount=function(){return this._attributes.length},w.prototype.getUniformIndex=function(S){return this._uniformsNames.indexOf(S)},w.prototype.getUniform=function(S){return this._uniforms[S]},w.prototype.getSamplers=function(){return this._samplerList},w.prototype.getUniformNames=function(){return this._uniformsNames},w.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},w.prototype.getIndexParameters=function(){return this._indexParameters},w.prototype.getCompilationError=function(){return this._compilationError},w.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},w.prototype.executeWhenCompiled=function(S){var _=this;this.isReady()?S(this):(this.onCompileObservable.add(function(O){S(O)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){_._checkIsReady(null)},16))},w.prototype._checkIsReady=function(S){var _=this;try{if(this._isReadyInternal())return}catch(O){return void this._processCompilationErrors(O,S)}setTimeout(function(){_._checkIsReady(S)},16)},w.prototype._loadShader=function(S,_,O,R){var I;if(typeof HTMLElement!="undefined"&&S instanceof HTMLElement)return void R(E.a.GetDOMTextContent(S));S.substr(0,7)!=="source:"?S.substr(0,7)!=="base64:"?w.ShadersStore[S+_+"Shader"]?R(w.ShadersStore[S+_+"Shader"]):O&&w.ShadersStore[S+O+"Shader"]?R(w.ShadersStore[S+O+"Shader"]):(I=S[0]==="."||S[0]==="/"||S.indexOf("http")>-1?S:w.ShadersRepository+S,this._engine._loadFile(I+"."+_.toLowerCase()+".fx",R)):R(window.atob(S.substr(7))):R(S.substr(7))},Object.defineProperty(w.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),w.prototype._rebuildProgram=function(S,_,O,R){var I=this;this._isReady=!1,this._vertexSourceCodeOverride=S,this._fragmentSourceCodeOverride=_,this.onError=function(y,p){R&&R(p)},this.onCompiled=function(){var y=I.getEngine().scenes;if(y)for(var p=0;p<y.length;p++)y[p].markAllMaterialsAsDirty(m.a.MATERIAL_AllDirtyFlag);I._pipelineContext._handlesSpectorRebuildCallback(O)},this._fallbacks=null,this._prepareEffect()},w.prototype._prepareEffect=function(){var S=this,_=this._attributesNames,O=this.defines;this._valueCache={};var R=this._pipelineContext;try{var I=this._engine;this._pipelineContext=I.createPipelineContext();var y=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?I._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,y,null,this._transformFeedbackVaryings):I._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,y,O,this._transformFeedbackVaryings),I._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(I.supportsUniformBuffers)for(var p in S._uniformBuffersNames)S.bindUniformBlock(p,S._uniformBuffersNames[p]);var g;if(I.getUniforms(S._pipelineContext,S._uniformsNames).forEach(function(F,U){S._uniforms[S._uniformsNames[U]]=F}),S._attributes=I.getAttributes(S._pipelineContext,_),_)for(var C=0;C<_.length;C++){var P=_[C];S._attributeLocationByName[P]=S._attributes[C]}for(g=0;g<S._samplerList.length;g++)S.getUniform(S._samplerList[g])==null&&(S._samplerList.splice(g,1),g--);S._samplerList.forEach(function(F,U){S._samplers[F]=U}),I.bindSamplers(S),S._compilationError="",S._isReady=!0,S.onCompiled&&S.onCompiled(S),S.onCompileObservable.notifyObservers(S),S.onCompileObservable.clear(),S._fallbacks&&S._fallbacks.unBindMesh(),R&&S.getEngine()._deletePipelineContext(R)}),this._pipelineContext.isAsync&&this._checkIsReady(R)}catch(p){this._processCompilationErrors(p,R)}},w.prototype._getShaderCodeAndErrorLine=function(S,_,O){var R=O?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,I=null;if(_&&S){var y=_.match(R);if(y&&y.length===2){var p=parseInt(y[1]),g=S.split(`
`,-1);g.length>=p&&(I="Offending line ["+p+"] in "+(O?"fragment":"vertex")+" code: "+g[p-1])}}return[S,I]},w.prototype._processCompilationErrors=function(S,_){var O,R,I,y,p;_===void 0&&(_=null),this._compilationError=S.message;var g=this._attributesNames,C=this._fallbacks;if(d.a.Error("Unable to compile effect:"),d.a.Error("Uniforms: "+this._uniformsNames.map(function(B){return" "+B})),d.a.Error("Attributes: "+g.map(function(B){return" "+B})),d.a.Error(`Defines:\r
`+this.defines),w.LogShaderCodeOnCompilationError){var P=null,F=null,U=null;((I=this._pipelineContext)===null||I===void 0?void 0:I._getVertexShaderCode())&&(U=(O=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],P=O[1],U&&(d.a.Error("Vertex code:"),d.a.Error(U))),((y=this._pipelineContext)===null||y===void 0?void 0:y._getFragmentShaderCode())&&(U=(R=this._getShaderCodeAndErrorLine((p=this._pipelineContext)===null||p===void 0?void 0:p._getFragmentShaderCode(),this._compilationError,!0))[0],F=R[1],U&&(d.a.Error("Fragment code:"),d.a.Error(U))),P&&d.a.Error(P),F&&d.a.Error(F)}d.a.Error("Error: "+this._compilationError),_&&(this._pipelineContext=_,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),C?(this._pipelineContext=null,C.hasMoreFallbacks?(this._allFallbacksProcessed=!1,d.a.Error("Trying next fallback."),this.defines=C.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(w.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),w.prototype._bindTexture=function(S,_){this._engine._bindTexture(this._samplers[S],_)},w.prototype.setTexture=function(S,_){this._engine.setTexture(this._samplers[S],this._uniforms[S],_)},w.prototype.setDepthStencilTexture=function(S,_){this._engine.setDepthStencilTexture(this._samplers[S],this._uniforms[S],_)},w.prototype.setTextureArray=function(S,_){var O=S+"Ex";if(this._samplerList.indexOf(O+"0")===-1){for(var R=this._samplerList.indexOf(S),I=1;I<_.length;I++){var y=O+(I-1).toString();this._samplerList.splice(R+I,0,y)}for(var p=0,g=0,C=this._samplerList;g<C.length;g++){var P=C[g];this._samplers[P]=p,p+=1}}this._engine.setTextureArray(this._samplers[S],this._uniforms[S],_)},w.prototype.setTextureFromPostProcess=function(S,_){this._engine.setTextureFromPostProcess(this._samplers[S],_)},w.prototype.setTextureFromPostProcessOutput=function(S,_){this._engine.setTextureFromPostProcessOutput(this._samplers[S],_)},w.prototype._cacheMatrix=function(S,_){var O=this._valueCache[S],R=_.updateFlag;return(O===void 0||O!==R)&&(this._valueCache[S]=R,!0)},w.prototype._cacheFloat2=function(S,_,O){var R=this._valueCache[S];if(!R||R.length!==2)return R=[_,O],this._valueCache[S]=R,!0;var I=!1;return R[0]!==_&&(R[0]=_,I=!0),R[1]!==O&&(R[1]=O,I=!0),I},w.prototype._cacheFloat3=function(S,_,O,R){var I=this._valueCache[S];if(!I||I.length!==3)return I=[_,O,R],this._valueCache[S]=I,!0;var y=!1;return I[0]!==_&&(I[0]=_,y=!0),I[1]!==O&&(I[1]=O,y=!0),I[2]!==R&&(I[2]=R,y=!0),y},w.prototype._cacheFloat4=function(S,_,O,R,I){var y=this._valueCache[S];if(!y||y.length!==4)return y=[_,O,R,I],this._valueCache[S]=y,!0;var p=!1;return y[0]!==_&&(y[0]=_,p=!0),y[1]!==O&&(y[1]=O,p=!0),y[2]!==R&&(y[2]=R,p=!0),y[3]!==I&&(y[3]=I,p=!0),p},w.prototype.bindUniformBuffer=function(S,_){var O=this._uniformBuffersNames[_];O!==void 0&&w._baseCache[O]!==S&&(w._baseCache[O]=S,this._engine.bindUniformBufferBase(S,O))},w.prototype.bindUniformBlock=function(S,_){this._engine.bindUniformBlock(this._pipelineContext,S,_)},w.prototype.setInt=function(S,_){var O=this._valueCache[S];return O!==void 0&&O===_||this._engine.setInt(this._uniforms[S],_)&&(this._valueCache[S]=_),this},w.prototype.setIntArray=function(S,_){return this._valueCache[S]=null,this._engine.setIntArray(this._uniforms[S],_),this},w.prototype.setIntArray2=function(S,_){return this._valueCache[S]=null,this._engine.setIntArray2(this._uniforms[S],_),this},w.prototype.setIntArray3=function(S,_){return this._valueCache[S]=null,this._engine.setIntArray3(this._uniforms[S],_),this},w.prototype.setIntArray4=function(S,_){return this._valueCache[S]=null,this._engine.setIntArray4(this._uniforms[S],_),this},w.prototype.setFloatArray=function(S,_){return this._valueCache[S]=null,this._engine.setArray(this._uniforms[S],_),this},w.prototype.setFloatArray2=function(S,_){return this._valueCache[S]=null,this._engine.setArray2(this._uniforms[S],_),this},w.prototype.setFloatArray3=function(S,_){return this._valueCache[S]=null,this._engine.setArray3(this._uniforms[S],_),this},w.prototype.setFloatArray4=function(S,_){return this._valueCache[S]=null,this._engine.setArray4(this._uniforms[S],_),this},w.prototype.setArray=function(S,_){return this._valueCache[S]=null,this._engine.setArray(this._uniforms[S],_),this},w.prototype.setArray2=function(S,_){return this._valueCache[S]=null,this._engine.setArray2(this._uniforms[S],_),this},w.prototype.setArray3=function(S,_){return this._valueCache[S]=null,this._engine.setArray3(this._uniforms[S],_),this},w.prototype.setArray4=function(S,_){return this._valueCache[S]=null,this._engine.setArray4(this._uniforms[S],_),this},w.prototype.setMatrices=function(S,_){return _?(this._valueCache[S]=null,this._engine.setMatrices(this._uniforms[S],_),this):this},w.prototype.setMatrix=function(S,_){return this._cacheMatrix(S,_)&&(this._engine.setMatrices(this._uniforms[S],_.toArray())||(this._valueCache[S]=null)),this},w.prototype.setMatrix3x3=function(S,_){return this._valueCache[S]=null,this._engine.setMatrix3x3(this._uniforms[S],_),this},w.prototype.setMatrix2x2=function(S,_){return this._valueCache[S]=null,this._engine.setMatrix2x2(this._uniforms[S],_),this},w.prototype.setFloat=function(S,_){var O=this._valueCache[S];return O!==void 0&&O===_||this._engine.setFloat(this._uniforms[S],_)&&(this._valueCache[S]=_),this},w.prototype.setBool=function(S,_){var O=this._valueCache[S];return O!==void 0&&O===_||this._engine.setInt(this._uniforms[S],_?1:0)&&(this._valueCache[S]=_),this},w.prototype.setVector2=function(S,_){return this._cacheFloat2(S,_.x,_.y)&&(this._engine.setFloat2(this._uniforms[S],_.x,_.y)||(this._valueCache[S]=null)),this},w.prototype.setFloat2=function(S,_,O){return this._cacheFloat2(S,_,O)&&(this._engine.setFloat2(this._uniforms[S],_,O)||(this._valueCache[S]=null)),this},w.prototype.setVector3=function(S,_){return this._cacheFloat3(S,_.x,_.y,_.z)&&(this._engine.setFloat3(this._uniforms[S],_.x,_.y,_.z)||(this._valueCache[S]=null)),this},w.prototype.setFloat3=function(S,_,O,R){return this._cacheFloat3(S,_,O,R)&&(this._engine.setFloat3(this._uniforms[S],_,O,R)||(this._valueCache[S]=null)),this},w.prototype.setVector4=function(S,_){return this._cacheFloat4(S,_.x,_.y,_.z,_.w)&&(this._engine.setFloat4(this._uniforms[S],_.x,_.y,_.z,_.w)||(this._valueCache[S]=null)),this},w.prototype.setFloat4=function(S,_,O,R,I){return this._cacheFloat4(S,_,O,R,I)&&(this._engine.setFloat4(this._uniforms[S],_,O,R,I)||(this._valueCache[S]=null)),this},w.prototype.setColor3=function(S,_){return this._cacheFloat3(S,_.r,_.g,_.b)&&(this._engine.setFloat3(this._uniforms[S],_.r,_.g,_.b)||(this._valueCache[S]=null)),this},w.prototype.setColor4=function(S,_,O){return this._cacheFloat4(S,_.r,_.g,_.b,O)&&(this._engine.setFloat4(this._uniforms[S],_.r,_.g,_.b,O)||(this._valueCache[S]=null)),this},w.prototype.setDirectColor4=function(S,_){return this._cacheFloat4(S,_.r,_.g,_.b,_.a)&&(this._engine.setFloat4(this._uniforms[S],_.r,_.g,_.b,_.a)||(this._valueCache[S]=null)),this},w.prototype.dispose=function(){this._engine._releaseEffect(this)},w.RegisterShader=function(S,_,O){_&&(w.ShadersStore[S+"PixelShader"]=_),O&&(w.ShadersStore[S+"VertexShader"]=O)},w.ResetCache=function(){w._baseCache={}},w.ShadersRepository="src/Shaders/",w.LogShaderCodeOnCompilationError=!0,w._uniqueIdSeed=0,w._baseCache={},w.ShadersStore={},w.IncludesShadersStore={},w}()},function(f,s,c){c.d(s,"a",function(){return T}),c.d(s,"d",function(){return m}),c.d(s,"b",function(){return E}),c.d(s,"c",function(){return d});var T=function(){function x(M,w,S,_){w===void 0&&(w=!1),this.initalize(M,w,S,_)}return x.prototype.initalize=function(M,w,S,_){return w===void 0&&(w=!1),this.mask=M,this.skipNextObservers=w,this.target=S,this.currentTarget=_,this},x}(),m=function(x,M,w){w===void 0&&(w=null),this.callback=x,this.mask=M,this.scope=w,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},E=function(){function x(){}return x.prototype.dispose=function(){if(this._observers&&this._observables)for(var M=0;M<this._observers.length;M++)this._observables[M].remove(this._observers[M]);this._observers=null,this._observables=null},x.Watch=function(M,w,S,_){S===void 0&&(S=-1),_===void 0&&(_=null);var O=new x;O._observers=new Array,O._observables=M;for(var R=0,I=M;R<I.length;R++){var y=I[R].add(w,S,!1,_);y&&O._observers.push(y)}return O},x}(),d=function(){function x(M){this._observers=new Array,this._eventState=new T(0),M&&(this._onObserverAdded=M)}return Object.defineProperty(x.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),x.prototype.add=function(M,w,S,_,O){if(w===void 0&&(w=-1),S===void 0&&(S=!1),_===void 0&&(_=null),O===void 0&&(O=!1),!M)return null;var R=new m(M,w,_);return R.unregisterOnNextCall=O,S?this._observers.unshift(R):this._observers.push(R),this._onObserverAdded&&this._onObserverAdded(R),R},x.prototype.addOnce=function(M){return this.add(M,void 0,void 0,void 0,!0)},x.prototype.remove=function(M){return!!M&&this._observers.indexOf(M)!==-1&&(this._deferUnregister(M),!0)},x.prototype.removeCallback=function(M,w){for(var S=0;S<this._observers.length;S++){var _=this._observers[S];if(!_._willBeUnregistered&&_.callback===M&&(!w||w===_.scope))return this._deferUnregister(_),!0}return!1},x.prototype._deferUnregister=function(M){var w=this;M.unregisterOnNextCall=!1,M._willBeUnregistered=!0,setTimeout(function(){w._remove(M)},0)},x.prototype._remove=function(M){if(!M)return!1;var w=this._observers.indexOf(M);return w!==-1&&(this._observers.splice(w,1),!0)},x.prototype.makeObserverTopPriority=function(M){this._remove(M),this._observers.unshift(M)},x.prototype.makeObserverBottomPriority=function(M){this._remove(M),this._observers.push(M)},x.prototype.notifyObservers=function(M,w,S,_,O){if(w===void 0&&(w=-1),!this._observers.length)return!0;var R=this._eventState;R.mask=w,R.target=S,R.currentTarget=_,R.skipNextObservers=!1,R.lastReturnValue=M,R.userInfo=O;for(var I=0,y=this._observers;I<y.length;I++){var p=y[I];if(!p._willBeUnregistered&&(p.mask&w&&(p.scope?R.lastReturnValue=p.callback.apply(p.scope,[M,R]):R.lastReturnValue=p.callback(M,R),p.unregisterOnNextCall&&this._deferUnregister(p)),R.skipNextObservers))return!1}return!0},x.prototype.notifyObserversWithPromise=function(M,w,S,_,O){var R=this;w===void 0&&(w=-1);var I=Promise.resolve(M);if(!this._observers.length)return I;var y=this._eventState;return y.mask=w,y.target=S,y.currentTarget=_,y.skipNextObservers=!1,y.userInfo=O,this._observers.forEach(function(p){y.skipNextObservers||p._willBeUnregistered||p.mask&w&&(I=p.scope?I.then(function(g){return y.lastReturnValue=g,p.callback.apply(p.scope,[M,y])}):I.then(function(g){return y.lastReturnValue=g,p.callback(M,y)}),p.unregisterOnNextCall&&R._deferUnregister(p))}),I.then(function(){return M})},x.prototype.notifyObserver=function(M,w,S){S===void 0&&(S=-1);var _=this._eventState;_.mask=S,_.skipNextObservers=!1,M.callback(w,_)},x.prototype.hasObservers=function(){return this._observers.length>0},x.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},x.prototype.clone=function(){var M=new x;return M._observers=this._observers.slice(0),M},x.prototype.hasSpecificMask=function(M){M===void 0&&(M=-1);for(var w=0,S=this._observers;w<S.length;w++){var _=S[w];if(_.mask&M||_.mask===M)return!0}return!1},x}()},function(f,s,c){c.d(s,"b",function(){return $}),c.d(s,"c",function(){return me}),c.d(s,"a",function(){return ie});var T=c(1),m=c(6),E=c(12),d=c(41),x=c(37),M=c(0),w=c(9),S=c(29),_=c(4),O=c(16),R=c(71),I=c(31),y=c(61),p=c(43),g=c(25),C=c(68),P=c(69),F=c(2),U=c(3),B=c(8),L=c(11),z=c(21),X=c(17),G=c(149),ee=c(70),$=function(){},fe=function(){this.visibleInstances={},this.batchCache=new me,this.instancesBufferSize=2048},me=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},ve=function(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=512,this.boundingVectors=[],this.worldMatrices=null},be=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},ie=function(se){function V(K,Z,le,re,Q,W){Z===void 0&&(Z=null),le===void 0&&(le=null),re===void 0&&(re=null),W===void 0&&(W=!0);var Y=se.call(this,K,Z)||this;if(Y._internalMeshDataInfo=new be,Y.delayLoadState=F.a.DELAYLOADSTATE_NONE,Y.instances=new Array,Y._creationDataStorage=null,Y._geometry=null,Y._instanceDataStorage=new fe,Y._thinInstanceDataStorage=new ve,Y._effectiveMaterial=null,Y._shouldGenerateFlatShading=!1,Y._originalBuilderSideOrientation=V.DEFAULTSIDE,Y.overrideMaterialSideOrientation=null,Z=Y.getScene(),re){if(re._geometry&&re._geometry.applyToMesh(Y),d.a.DeepCopy(re,Y,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),Y._internalMeshDataInfo._source=re,Z.useClonedMeshMap&&(re._internalMeshDataInfo.meshMap||(re._internalMeshDataInfo.meshMap={}),re._internalMeshDataInfo.meshMap[Y.uniqueId]=Y),Y._originalBuilderSideOrientation=re._originalBuilderSideOrientation,Y._creationDataStorage=re._creationDataStorage,re._ranges){var q=re._ranges;for(var K in q)q.hasOwnProperty(K)&&q[K]&&Y.createAnimationRange(K,q[K].from,q[K].to)}var ae;if(re.metadata&&re.metadata.clone?Y.metadata=re.metadata.clone():Y.metadata=re.metadata,x.a&&x.a.HasTags(re)&&x.a.AddTagsTo(Y,x.a.GetTags(re,!0)),Y.setEnabled(re.isEnabled()),Y.parent=re.parent,Y.setPivotMatrix(re.getPivotMatrix()),Y.id=K+"."+re.id,Y.material=re.material,!Q)for(var pe=re.getDescendants(!0),De=0;De<pe.length;De++){var de=pe[De];de.clone&&de.clone(K+"."+de.name,Y)}if(re.morphTargetManager&&(Y.morphTargetManager=re.morphTargetManager),Z.getPhysicsEngine){var ge=Z.getPhysicsEngine();if(W&&ge){var ne=ge.getImpostorForPhysicsObject(re);ne&&(Y.physicsImpostor=ne.clone(Y))}}for(ae=0;ae<Z.particleSystems.length;ae++){var Te=Z.particleSystems[ae];Te.emitter===re&&Te.clone(Te.name,Y)}Y.refreshBoundingInfo(),Y.computeWorldMatrix(!0)}return le!==null&&(Y.parent=le),Y._instanceDataStorage.hardwareInstancedRendering=Y.getEngine().getCaps().instancedArrays,Y}return Object(T.d)(V,se),V._GetDefaultSideOrientation=function(K){return K||V.FRONTSIDE},Object.defineProperty(V.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(K){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==K&&(K&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(_.b.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(_.b.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=K,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new m.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new m.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new m.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new m.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"onBeforeDraw",{set:function(K){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(K)},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"hasThinInstances",{get:function(){var K;return((K=this._thinInstanceDataStorage.instancesCount)!==null&&K!==void 0?K:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(K){this._internalMeshDataInfo._morphTargetManager!==K&&(this._internalMeshDataInfo._morphTargetManager=K,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(K){this._unIndexed!==K&&(this._unIndexed=K,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(K){this._instanceDataStorage.manualUpdate=K},enumerable:!1,configurable:!0}),V.prototype.instantiateHierarchy=function(K,Z,le){K===void 0&&(K=null);var re=!(this.getTotalVertices()>0)||Z&&Z.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),K||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));re&&(re.parent=K||this.parent,re.position=this.position.clone(),re.scaling=this.scaling.clone(),this.rotationQuaternion?re.rotationQuaternion=this.rotationQuaternion.clone():re.rotation=this.rotation.clone(),le&&le(this,re));for(var Q=0,W=this.getChildTransformNodes(!0);Q<W.length;Q++)W[Q].instantiateHierarchy(re,Z,le);return re},V.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(V.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),V.prototype.toString=function(K){var Z=se.prototype.toString.call(this,K);if(Z+=", n vertices: "+this.getTotalVertices(),Z+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var le=0;le<this.animations.length;le++)Z+=", animation[0]: "+this.animations[le].toString(K);if(K)if(this._geometry){var re=this.getIndices(),Q=this.getVerticesData(_.b.PositionKind);Q&&re&&(Z+=", flat shading: "+(Q.length/3===re.length?"YES":"NO"))}else Z+=", flat shading: UNKNOWN";return Z},V.prototype._unBindEffect=function(){se.prototype._unBindEffect.call(this);for(var K=0,Z=this.instances;K<Z.length;K++)Z[K]._unBindEffect()},Object.defineProperty(V.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),V.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},V.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(K,Z){return K.distance<Z.distance?1:K.distance>Z.distance?-1:0})},V.prototype.addLODLevel=function(K,Z){if(Z&&Z._masterMesh)return B.a.Warn("You cannot use a mesh as LOD level twice"),this;var le=new G.a(K,Z);return this._internalMeshDataInfo._LODLevels.push(le),Z&&(Z._masterMesh=this),this._sortLODLevels(),this},V.prototype.getLODLevelAtDistance=function(K){for(var Z=this._internalMeshDataInfo,le=0;le<Z._LODLevels.length;le++){var re=Z._LODLevels[le];if(re.distance===K)return re.mesh}return null},V.prototype.removeLODLevel=function(K){for(var Z=this._internalMeshDataInfo,le=0;le<Z._LODLevels.length;le++)Z._LODLevels[le].mesh===K&&(Z._LODLevels.splice(le,1),K&&(K._masterMesh=null));return this._sortLODLevels(),this},V.prototype.getLOD=function(K,Z){var le,re=this._internalMeshDataInfo;if(!re._LODLevels||re._LODLevels.length===0)return this;Z?le=Z:le=this.getBoundingInfo().boundingSphere;var Q=le.centerWorld.subtract(K.globalPosition).length();if(re._LODLevels[re._LODLevels.length-1].distance>Q)return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,this),this;for(var W=0;W<re._LODLevels.length;W++){var Y=re._LODLevels[W];if(Y.distance<Q){if(Y.mesh){if(Y.mesh.delayLoadState===F.a.DELAYLOADSTATE_NOTLOADED)return Y.mesh._checkDelayState(),this;if(Y.mesh.delayLoadState===F.a.DELAYLOADSTATE_LOADING)return this;Y.mesh._preActivate(),Y.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,Y.mesh),Y.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(Q,this,this),this},Object.defineProperty(V.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),V.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},V.prototype.getVerticesData=function(K,Z,le){return this._geometry?this._geometry.getVerticesData(K,Z,le):null},V.prototype.getVertexBuffer=function(K){return this._geometry?this._geometry.getVertexBuffer(K):null},V.prototype.isVerticesDataPresent=function(K){return this._geometry?this._geometry.isVerticesDataPresent(K):!!this._delayInfo&&this._delayInfo.indexOf(K)!==-1},V.prototype.isVertexBufferUpdatable=function(K){return this._geometry?this._geometry.isVertexBufferUpdatable(K):!!this._delayInfo&&this._delayInfo.indexOf(K)!==-1},V.prototype.getVerticesDataKinds=function(){if(!this._geometry){var K=new Array;return this._delayInfo&&this._delayInfo.forEach(function(Z){K.push(Z)}),K}return this._geometry.getVerticesDataKinds()},V.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},V.prototype.getIndices=function(K,Z){return this._geometry?this._geometry.getIndices(K,Z):[]},Object.defineProperty(V.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),V.prototype.isReady=function(K,Z){var le,re,Q,W,Y,q;if(K===void 0&&(K=!1),Z===void 0&&(Z=!1),this.delayLoadState===F.a.DELAYLOADSTATE_LOADING||!se.prototype.isReady.call(this,K))return!1;if(!this.subMeshes||this.subMeshes.length===0||!K)return!0;var ae=this.getEngine(),pe=this.getScene(),De=Z||ae.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var de=this.material||pe.defaultMaterial;if(de){if(de._storeEffectOnSubMeshes)for(var ge=0,ne=this.subMeshes;ge<ne.length;ge++){var Te=(et=ne[ge]).getMaterial();if(Te){if(Te._storeEffectOnSubMeshes){if(!Te.isReadyForSubMesh(this,et,De))return!1}else if(!Te.isReady(this,De))return!1}}else if(!de.isReady(this,De))return!1}for(var we=0,Se=this.lightSources;we<Se.length;we++){var Ge=Se[we].getShadowGenerator();if(Ge&&(!((le=Ge.getShadowMap())===null||le===void 0?void 0:le.renderList)||((re=Ge.getShadowMap())===null||re===void 0?void 0:re.renderList)&&((W=(Q=Ge.getShadowMap())===null||Q===void 0?void 0:Q.renderList)===null||W===void 0?void 0:W.indexOf(this))!==-1))for(var $e=0,nt=this.subMeshes;$e<nt.length;$e++){var et=nt[$e];if(!Ge.isReady(et,De,(q=(Y=et.getMaterial())===null||Y===void 0?void 0:Y.needAlphaBlendingForMesh(this))!==null&&q!==void 0&&q))return!1}}for(var Ze=0,ht=this._internalMeshDataInfo._LODLevels;Ze<ht.length;Ze++){var gt=ht[Ze];if(gt.mesh&&!gt.mesh.isReady(De))return!1}return!0},Object.defineProperty(V.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),V.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},V.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(V.prototype,"overridenInstanceCount",{set:function(K){this._instanceDataStorage.overridenInstanceCount=K},enumerable:!1,configurable:!0}),V.prototype._preActivate=function(){var K=this._internalMeshDataInfo,Z=this.getScene().getRenderId();return K._preActivateId===Z||(K._preActivateId=Z,this._instanceDataStorage.visibleInstances=null),this},V.prototype._preActivateForIntermediateRendering=function(K){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=K),this},V.prototype._registerInstanceForRenderId=function(K,Z){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:Z,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[Z]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=Z,this._instanceDataStorage.visibleInstances[Z]=new Array),this._instanceDataStorage.visibleInstances[Z].push(K),this},V.prototype._afterComputeWorldMatrix=function(){se.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},V.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},V.prototype.refreshBoundingInfo=function(K){if(K===void 0&&(K=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var Z=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(K),Z),this},V.prototype._createGlobalSubMesh=function(K){var Z=this.getTotalVertices();if(!Z||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var le=this.getIndices();if(!le)return null;var re=le.length,Q=!1;if(K)Q=!0;else for(var W=0,Y=this.subMeshes;W<Y.length;W++){var q=Y[W];if(q.indexStart+q.indexCount>re){Q=!0;break}if(q.verticesStart+q.verticesCount>Z){Q=!0;break}}if(!Q)return this.subMeshes[0]}return this.releaseSubMeshes(),new y.a(0,0,Z,0,this.getTotalIndices(),this)},V.prototype.subdivide=function(K){if(!(K<1)){for(var Z=this.getTotalIndices(),le=Z/K|0,re=0;le%3!=0;)le++;this.releaseSubMeshes();for(var Q=0;Q<K&&!(re>=Z);Q++)y.a.CreateFromIndices(0,re,Q===K-1?Z-re:le,this),re+=le;this.synchronizeInstances()}},V.prototype.setVerticesData=function(K,Z,le,re){if(le===void 0&&(le=!1),this._geometry)this._geometry.setVerticesData(K,Z,le,re);else{var Q=new O.a;Q.set(Z,K);var W=this.getScene();new R.a(R.a.RandomId(),W,Q,le,this)}return this},V.prototype.removeVerticesData=function(K){this._geometry&&this._geometry.removeVerticesData(K)},V.prototype.markVerticesDataAsUpdatable=function(K,Z){Z===void 0&&(Z=!0);var le=this.getVertexBuffer(K);le&&le.isUpdatable()!==Z&&this.setVerticesData(K,this.getVerticesData(K),Z)},V.prototype.setVerticesBuffer=function(K){return this._geometry||(this._geometry=R.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(K),this},V.prototype.updateVerticesData=function(K,Z,le,re){return this._geometry?(re?(this.makeGeometryUnique(),this.updateVerticesData(K,Z,le,!1)):this._geometry.updateVerticesData(K,Z,le),this):this},V.prototype.updateMeshPositions=function(K,Z){Z===void 0&&(Z=!0);var le=this.getVerticesData(_.b.PositionKind);if(!le)return this;if(K(le),this.updateVerticesData(_.b.PositionKind,le,!1,!1),Z){var re=this.getIndices(),Q=this.getVerticesData(_.b.NormalKind);if(!Q)return this;O.a.ComputeNormals(le,re,Q),this.updateVerticesData(_.b.NormalKind,Q,!1,!1)}return this},V.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var K=this._geometry,Z=this._geometry.copy(R.a.RandomId());return K.releaseForMesh(this,!0),Z.applyToMesh(this),this},V.prototype.setIndices=function(K,Z,le){if(Z===void 0&&(Z=null),le===void 0&&(le=!1),this._geometry)this._geometry.setIndices(K,Z,le);else{var re=new O.a;re.indices=K;var Q=this.getScene();new R.a(R.a.RandomId(),Q,re,le,this)}return this},V.prototype.updateIndices=function(K,Z,le){return le===void 0&&(le=!1),this._geometry?(this._geometry.updateIndices(K,Z,le),this):this},V.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},V.prototype._bind=function(K,Z,le){if(!this._geometry)return this;var re,Q=this.getScene().getEngine();if(this._unIndexed)re=null;else switch(le){case g.a.PointFillMode:re=null;break;case g.a.WireFrameFillMode:re=K._getLinesIndexBuffer(this.getIndices(),Q);break;default:case g.a.TriangleFillMode:re=this._geometry.getIndexBuffer()}return this._geometry._bind(Z,re),this},V.prototype._draw=function(K,Z,le){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var re=this.getScene().getEngine();return this._unIndexed||Z==g.a.PointFillMode?re.drawArraysType(Z,K.verticesStart,K.verticesCount,le):Z==g.a.WireFrameFillMode?re.drawElementsType(Z,0,K._linesIndexCount,le):re.drawElementsType(Z,K.indexStart,K.indexCount,le),this},V.prototype.registerBeforeRender=function(K){return this.onBeforeRenderObservable.add(K),this},V.prototype.unregisterBeforeRender=function(K){return this.onBeforeRenderObservable.removeCallback(K),this},V.prototype.registerAfterRender=function(K){return this.onAfterRenderObservable.add(K),this},V.prototype.unregisterAfterRender=function(K){return this.onAfterRenderObservable.removeCallback(K),this},V.prototype._getInstancesRenderList=function(K,Z){if(Z===void 0&&(Z=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var le=this.getScene(),re=le._isInIntermediateRendering(),Q=re?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,W=this._instanceDataStorage.batchCache;if(W.mustReturn=!1,W.renderSelf[K]=Z||!Q&&this.isEnabled()&&this.isVisible,W.visibleInstances[K]=null,this._instanceDataStorage.visibleInstances&&!Z){var Y=this._instanceDataStorage.visibleInstances,q=le.getRenderId(),ae=re?Y.intermediateDefaultRenderId:Y.defaultRenderId;W.visibleInstances[K]=Y[q],!W.visibleInstances[K]&&ae&&(W.visibleInstances[K]=Y[ae])}return W.hardwareInstancedRendering[K]=!Z&&this._instanceDataStorage.hardwareInstancedRendering&&W.visibleInstances[K]!==null&&W.visibleInstances[K]!==void 0,this._instanceDataStorage.previousBatch=W,W},V.prototype._renderWithInstances=function(K,Z,le,re,Q){var W=le.visibleInstances[K._id];if(!W)return this;for(var Y=this._instanceDataStorage,q=Y.instancesBufferSize,ae=Y.instancesBuffer,pe=16*(W.length+1)*4;Y.instancesBufferSize<pe;)Y.instancesBufferSize*=2;Y.instancesData&&q==Y.instancesBufferSize||(Y.instancesData=new Float32Array(Y.instancesBufferSize/4));var De=0,de=0,ge=le.renderSelf[K._id],ne=!ae||q!==Y.instancesBufferSize;if(this._instanceDataStorage.manualUpdate||Y.isFrozen&&!ne)de=(ge?1:0)+W.length;else{var Te=this._effectiveMesh.getWorldMatrix();if(ge&&(Te.copyToArray(Y.instancesData,De),De+=16,de++),W)for(var we=0;we<W.length;we++)W[we].getWorldMatrix().copyToArray(Y.instancesData,De),De+=16,de++}return ne?(ae&&ae.dispose(),ae=new _.a(Q,Y.instancesData,!0,16,!1,!0),Y.instancesBuffer=ae,this.setVerticesBuffer(ae.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(ae.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(ae.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(ae.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||ae.updateDirectly(Y.instancesData,0,de),this._processInstancedBuffers(W,ge),this.getScene()._activeIndices.addCount(K.indexCount*de,!1),this._bind(K,re,Z),this._draw(K,Z,de),Q.unbindInstanceAttributes(),this},V.prototype._renderWithThinInstances=function(K,Z,le,re){var Q,W,Y=(W=(Q=this._thinInstanceDataStorage)===null||Q===void 0?void 0:Q.instancesCount)!==null&&W!==void 0?W:0;this.getScene()._activeIndices.addCount(K.indexCount*Y,!1),this._bind(K,le,Z),this._draw(K,Z,Y),re.unbindInstanceAttributes()},V.prototype._processInstancedBuffers=function(K,Z){},V.prototype._processRendering=function(K,Z,le,re,Q,W,Y,q){var ae=this.getScene(),pe=ae.getEngine();if(W&&Z.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(Z,re,le,pe),this;if(W)this._renderWithInstances(Z,re,Q,le,pe);else{var De=0;Q.renderSelf[Z._id]&&(Y&&Y(!1,K._effectiveMesh.getWorldMatrix(),q),De++,this._draw(Z,re,this._instanceDataStorage.overridenInstanceCount));var de=Q.visibleInstances[Z._id];if(de){var ge=de.length;De+=ge;for(var ne=0;ne<ge;ne++){var Te=de[ne].getWorldMatrix();Y&&Y(!0,Te,q),this._draw(Z,re)}}ae._activeIndices.addCount(Z.indexCount*De,!1)}return this},V.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),se.prototype._rebuild.call(this)},V.prototype._freeze=function(){if(this.subMeshes){for(var K=0;K<this.subMeshes.length;K++)this._getInstancesRenderList(K);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},V.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},V.prototype.render=function(K,Z,le){var re=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var Q=this._getInstancesRenderList(K._id,!!le);if(Q.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var W,Y=re.getEngine(),q=Q.hardwareInstancedRendering[K._id]||K.getRenderingMesh().hasThinInstances,ae=this._instanceDataStorage,pe=K.getMaterial();if(!pe)return this;if(!ae.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==pe){if(pe._storeEffectOnSubMeshes){if(!pe.isReadyForSubMesh(this,K,q))return this}else if(!pe.isReady(this,q))return this;this._effectiveMaterial=pe}Z&&Y.setAlphaMode(this._effectiveMaterial.alphaMode),W=this._effectiveMaterial._storeEffectOnSubMeshes?K.effect:this._effectiveMaterial.getEffect();for(var De=0,de=re._beforeRenderingMeshStage;De<de.length;De++)de[De].action(this,K,Q,W);if(!W)return this;var ge,ne=le||this._effectiveMesh;if(ae.isFrozen||!this._effectiveMaterial.backFaceCulling&&this.overrideMaterialSideOrientation===null)ge=ae.sideOrientation;else{var Te=ne._getWorldMatrixDeterminant();(ge=this.overrideMaterialSideOrientation)==null&&(ge=this._effectiveMaterial.sideOrientation),Te<0&&(ge=ge===g.a.ClockWiseSideOrientation?g.a.CounterClockWiseSideOrientation:g.a.ClockWiseSideOrientation),ae.sideOrientation=ge}var we=this._effectiveMaterial._preBind(W,ge);this._effectiveMaterial.forceDepthWrite&&Y.setDepthWrite(!0);var Se=re.forcePointsCloud?g.a.PointFillMode:re.forceWireframe?g.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),q||this._bind(K,W,Se);var Ge=ne.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(Ge,this,K):this._effectiveMaterial.bind(Ge,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(Y.setState(!0,this._effectiveMaterial.zOffset,!1,!we),this._processRendering(this,K,W,Se,Q,q,this._onBeforeDraw,this._effectiveMaterial),Y.setState(!0,this._effectiveMaterial.zOffset,!1,we)),this._processRendering(this,K,W,Se,Q,q,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var $e=0,nt=re._afterRenderingMeshStage;$e<nt.length;$e++)nt[$e].action(this,K,Q,W);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},V.prototype._onBeforeDraw=function(K,Z,le){K&&le&&le.bindOnlyWorldMatrix(Z)},V.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(_.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(_.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},V.prototype.normalizeSkinFourWeights=function(){for(var K=this.getVerticesData(_.b.MatricesWeightsKind),Z=K.length,le=0;le<Z;le+=4){var re=K[le]+K[le+1]+K[le+2]+K[le+3];if(re===0)K[le]=1;else{var Q=1/re;K[le]*=Q,K[le+1]*=Q,K[le+2]*=Q,K[le+3]*=Q}}this.setVerticesData(_.b.MatricesWeightsKind,K)},V.prototype.normalizeSkinWeightsAndExtra=function(){for(var K=this.getVerticesData(_.b.MatricesWeightsExtraKind),Z=this.getVerticesData(_.b.MatricesWeightsKind),le=Z.length,re=0;re<le;re+=4){var Q=Z[re]+Z[re+1]+Z[re+2]+Z[re+3];if((Q+=K[re]+K[re+1]+K[re+2]+K[re+3])===0)Z[re]=1;else{var W=1/Q;Z[re]*=W,Z[re+1]*=W,Z[re+2]*=W,Z[re+3]*=W,K[re]*=W,K[re+1]*=W,K[re+2]*=W,K[re+3]*=W}}this.setVerticesData(_.b.MatricesWeightsKind,Z),this.setVerticesData(_.b.MatricesWeightsKind,K)},V.prototype.validateSkinning=function(){var K=this.getVerticesData(_.b.MatricesWeightsExtraKind),Z=this.getVerticesData(_.b.MatricesWeightsKind);if(Z===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var le=Z.length,re=0,Q=0,W=0,Y=0,q=K===null?4:8,ae=new Array,pe=0;pe<=q;pe++)ae[pe]=0;for(pe=0;pe<le;pe+=4){for(var De=Z[pe],de=De,ge=de===0?0:1,ne=1;ne<q;ne++){var Te=ne<4?Z[pe+ne]:K[pe+ne-4];Te>De&&re++,Te!==0&&ge++,de+=Te,De=Te}if(ae[ge]++,ge>W&&(W=ge),de===0)Q++;else{var we=1/de,Se=0;for(ne=0;ne<q;ne++)Se+=ne<4?Math.abs(Z[pe+ne]-Z[pe+ne]*we):Math.abs(K[pe+ne-4]-K[pe+ne-4]*we);Se>.001&&Y++}}var Ge=this.skeleton.bones.length,$e=this.getVerticesData(_.b.MatricesIndicesKind),nt=this.getVerticesData(_.b.MatricesIndicesExtraKind),et=0;for(pe=0;pe<le;pe+=4)for(ne=0;ne<q;ne++){var Ze=ne<4?$e[pe+ne]:nt[pe+ne-4];(Ze>=Ge||Ze<0)&&et++}return{skinned:!0,valid:Q===0&&Y===0&&et===0,report:"Number of Weights = "+le/4+`
Maximum influences = `+W+`
Missing Weights = `+Q+`
Not Sorted = `+re+`
Not Normalized = `+Y+`
WeightCounts = [`+ae+`]
Number of bones = `+Ge+`
Bad Bone Indices = `+et}},V.prototype._checkDelayState=function(){var K=this.getScene();return this._geometry?this._geometry.load(K):this.delayLoadState===F.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=F.a.DELAYLOADSTATE_LOADING,this._queueLoad(K)),this},V.prototype._queueLoad=function(K){var Z=this;K._addPendingData(this);var le=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return E.b.LoadFile(this.delayLoadingFile,function(re){re instanceof ArrayBuffer?Z._delayLoadingFunction(re,Z):Z._delayLoadingFunction(JSON.parse(re),Z),Z.instances.forEach(function(Q){Q.refreshBoundingInfo(),Q._syncSubMeshes()}),Z.delayLoadState=F.a.DELAYLOADSTATE_LOADED,K._removePendingData(Z)},function(){},K.offlineProvider,le),this},V.prototype.isInFrustum=function(K){return this.delayLoadState!==F.a.DELAYLOADSTATE_LOADING&&!!se.prototype.isInFrustum.call(this,K)&&(this._checkDelayState(),!0)},V.prototype.setMaterialByID=function(K){var Z,le=this.getScene().materials;for(Z=le.length-1;Z>-1;Z--)if(le[Z].id===K)return this.material=le[Z],this;var re=this.getScene().multiMaterials;for(Z=re.length-1;Z>-1;Z--)if(re[Z].id===K)return this.material=re[Z],this;return this},V.prototype.getAnimatables=function(){var K=new Array;return this.material&&K.push(this.material),this.skeleton&&K.push(this.skeleton),K},V.prototype.bakeTransformIntoVertices=function(K){if(!this.isVerticesDataPresent(_.b.PositionKind))return this;var Z=this.subMeshes.splice(0);this._resetPointsArrayCache();var le,re=this.getVerticesData(_.b.PositionKind),Q=new Array;for(le=0;le<re.length;le+=3)M.e.TransformCoordinates(M.e.FromArray(re,le),K).toArray(Q,le);if(this.setVerticesData(_.b.PositionKind,Q,this.getVertexBuffer(_.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(_.b.NormalKind)){for(re=this.getVerticesData(_.b.NormalKind),Q=[],le=0;le<re.length;le+=3)M.e.TransformNormal(M.e.FromArray(re,le),K).normalize().toArray(Q,le);this.setVerticesData(_.b.NormalKind,Q,this.getVertexBuffer(_.b.NormalKind).isUpdatable())}return K.m[0]*K.m[5]*K.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=Z,this},V.prototype.bakeCurrentTransformIntoVertices=function(K){return K===void 0&&(K=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(K),this},Object.defineProperty(V.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),V.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},V.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},V.prototype.clone=function(K,Z,le,re){return K===void 0&&(K=""),Z===void 0&&(Z=null),re===void 0&&(re=!0),new V(K,this.getScene(),Z,this,le,re)},V.prototype.dispose=function(K,Z){Z===void 0&&(Z=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var le=this._internalMeshDataInfo;if(le._onBeforeDrawObservable&&le._onBeforeDrawObservable.clear(),le._onBeforeBindObservable&&le._onBeforeBindObservable.clear(),le._onBeforeRenderObservable&&le._onBeforeRenderObservable.clear(),le._onAfterRenderObservable&&le._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(le.meshMap)for(var re in le.meshMap)(Y=le.meshMap[re])&&(Y._internalMeshDataInfo._source=null,le.meshMap[re]=void 0);le._source&&le._source._internalMeshDataInfo.meshMap&&(le._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var Q=0,W=this.getScene().meshes;Q<W.length;Q++){var Y;(Y=W[Q])._internalMeshDataInfo&&Y._internalMeshDataInfo._source&&Y._internalMeshDataInfo._source===this&&(Y._internalMeshDataInfo._source=null)}le._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),se.prototype.dispose.call(this,K,Z)},V.prototype._disposeInstanceSpecificData=function(){},V.prototype._disposeThinInstanceSpecificData=function(){},V.prototype.applyDisplacementMap=function(K,Z,le,re,Q,W,Y){var q=this;Y===void 0&&(Y=!1);var ae=this.getScene();return E.b.LoadImage(K,function(pe){var De=pe.width,de=pe.height,ge=ee.a.CreateCanvas(De,de).getContext("2d");ge.drawImage(pe,0,0);var ne=ge.getImageData(0,0,De,de).data;q.applyDisplacementMapFromBuffer(ne,De,de,Z,le,Q,W,Y),re&&re(q)},function(){},ae.offlineProvider),this},V.prototype.applyDisplacementMapFromBuffer=function(K,Z,le,re,Q,W,Y,q){if(q===void 0&&(q=!1),!this.isVerticesDataPresent(_.b.PositionKind)||!this.isVerticesDataPresent(_.b.NormalKind)||!this.isVerticesDataPresent(_.b.UVKind))return B.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var ae=this.getVerticesData(_.b.PositionKind,!0,!0),pe=this.getVerticesData(_.b.NormalKind),De=this.getVerticesData(_.b.UVKind),de=M.e.Zero(),ge=M.e.Zero(),ne=M.d.Zero();W=W||M.d.Zero(),Y=Y||new M.d(1,1);for(var Te=0;Te<ae.length;Te+=3){M.e.FromArrayToRef(ae,Te,de),M.e.FromArrayToRef(pe,Te,ge),M.d.FromArrayToRef(De,Te/3*2,ne);var we=4*((Math.abs(ne.x*Y.x+W.x%1)*(Z-1)%Z|0)+(Math.abs(ne.y*Y.y+W.y%1)*(le-1)%le|0)*Z),Se=.3*(K[we]/255)+.59*(K[we+1]/255)+.11*(K[we+2]/255);ge.normalize(),ge.scaleInPlace(re+(Q-re)*Se),(de=de.add(ge)).toArray(ae,Te)}return O.a.ComputeNormals(ae,this.getIndices(),pe),q?(this.setVerticesData(_.b.PositionKind,ae),this.setVerticesData(_.b.NormalKind,pe)):(this.updateVerticesData(_.b.PositionKind,ae),this.updateVerticesData(_.b.NormalKind,pe)),this},V.prototype.convertToFlatShadedMesh=function(){var K,Z,le=this.getVerticesDataKinds(),re={},Q={},W={},Y=!1;for(K=0;K<le.length;K++){Z=le[K];var q=this.getVertexBuffer(Z);Z!==_.b.NormalKind?(re[Z]=q,Q[Z]=re[Z].getData(),W[Z]=[]):(Y=q.isUpdatable(),le.splice(K,1),K--)}var ae,pe=this.subMeshes.slice(0),De=this.getIndices(),de=this.getTotalIndices();for(ae=0;ae<de;ae++){var ge=De[ae];for(K=0;K<le.length;K++)for(var ne=re[Z=le[K]].getStrideSize(),Te=0;Te<ne;Te++)W[Z].push(Q[Z][ge*ne+Te])}var we=[],Se=W[_.b.PositionKind];for(ae=0;ae<de;ae+=3){De[ae]=ae,De[ae+1]=ae+1,De[ae+2]=ae+2;for(var Ge=M.e.FromArray(Se,3*ae),$e=M.e.FromArray(Se,3*(ae+1)),nt=M.e.FromArray(Se,3*(ae+2)),et=Ge.subtract($e),Ze=nt.subtract($e),ht=M.e.Normalize(M.e.Cross(et,Ze)),gt=0;gt<3;gt++)we.push(ht.x),we.push(ht.y),we.push(ht.z)}for(this.setIndices(De),this.setVerticesData(_.b.NormalKind,we,Y),K=0;K<le.length;K++)Z=le[K],this.setVerticesData(Z,W[Z],re[Z].isUpdatable());this.releaseSubMeshes();for(var Rt=0;Rt<pe.length;Rt++){var zt=pe[Rt];y.a.AddToMesh(zt.materialIndex,zt.indexStart,zt.indexCount,zt.indexStart,zt.indexCount,this)}return this.synchronizeInstances(),this},V.prototype.convertToUnIndexedMesh=function(){var K,Z,le=this.getVerticesDataKinds(),re={},Q={},W={};for(K=0;K<le.length;K++){Z=le[K];var Y=this.getVertexBuffer(Z);re[Z]=Y,Q[Z]=re[Z].getData(),W[Z]=[]}var q,ae=this.subMeshes.slice(0),pe=this.getIndices(),De=this.getTotalIndices();for(q=0;q<De;q++){var de=pe[q];for(K=0;K<le.length;K++)for(var ge=re[Z=le[K]].getStrideSize(),ne=0;ne<ge;ne++)W[Z].push(Q[Z][de*ge+ne])}for(q=0;q<De;q+=3)pe[q]=q,pe[q+1]=q+1,pe[q+2]=q+2;for(this.setIndices(pe),K=0;K<le.length;K++)Z=le[K],this.setVerticesData(Z,W[Z],re[Z].isUpdatable());this.releaseSubMeshes();for(var Te=0;Te<ae.length;Te++){var we=ae[Te];y.a.AddToMesh(we.materialIndex,we.indexStart,we.indexCount,we.indexStart,we.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},V.prototype.flipFaces=function(K){K===void 0&&(K=!1);var Z,le,re=O.a.ExtractFromMesh(this);if(K&&this.isVerticesDataPresent(_.b.NormalKind)&&re.normals)for(Z=0;Z<re.normals.length;Z++)re.normals[Z]*=-1;if(re.indices)for(Z=0;Z<re.indices.length;Z+=3)le=re.indices[Z+1],re.indices[Z+1]=re.indices[Z+2],re.indices[Z+2]=le;return re.applyToMesh(this,this.isVertexBufferUpdatable(_.b.PositionKind)),this},V.prototype.increaseVertices=function(K){var Z=O.a.ExtractFromMesh(this),le=Z.uvs,re=Z.indices,Q=Z.positions,W=Z.normals;if(re&&Q&&W&&le){for(var Y,q,ae=K+1,pe=new Array,De=0;De<ae+1;De++)pe[De]=new Array;var de,ge=new M.e(0,0,0),ne=new M.e(0,0,0),Te=new M.d(0,0),we=new Array,Se=new Array,Ge=new Array,$e=Q.length,nt=le.length;for(De=0;De<re.length;De+=3){Se[0]=re[De],Se[1]=re[De+1],Se[2]=re[De+2];for(var et=0;et<3;et++)if(Y=Se[et],q=Se[(et+1)%3],Ge[Y]===void 0&&Ge[q]===void 0?(Ge[Y]=new Array,Ge[q]=new Array):(Ge[Y]===void 0&&(Ge[Y]=new Array),Ge[q]===void 0&&(Ge[q]=new Array)),Ge[Y][q]===void 0&&Ge[q][Y]===void 0){Ge[Y][q]=[],ge.x=(Q[3*q]-Q[3*Y])/ae,ge.y=(Q[3*q+1]-Q[3*Y+1])/ae,ge.z=(Q[3*q+2]-Q[3*Y+2])/ae,ne.x=(W[3*q]-W[3*Y])/ae,ne.y=(W[3*q+1]-W[3*Y+1])/ae,ne.z=(W[3*q+2]-W[3*Y+2])/ae,Te.x=(le[2*q]-le[2*Y])/ae,Te.y=(le[2*q+1]-le[2*Y+1])/ae,Ge[Y][q].push(Y);for(var Ze=1;Ze<ae;Ze++)Ge[Y][q].push(Q.length/3),Q[$e]=Q[3*Y]+Ze*ge.x,W[$e++]=W[3*Y]+Ze*ne.x,Q[$e]=Q[3*Y+1]+Ze*ge.y,W[$e++]=W[3*Y+1]+Ze*ne.y,Q[$e]=Q[3*Y+2]+Ze*ge.z,W[$e++]=W[3*Y+2]+Ze*ne.z,le[nt++]=le[2*Y]+Ze*Te.x,le[nt++]=le[2*Y+1]+Ze*Te.y;Ge[Y][q].push(q),Ge[q][Y]=new Array,de=Ge[Y][q].length;for(var ht=0;ht<de;ht++)Ge[q][Y][ht]=Ge[Y][q][de-1-ht]}for(pe[0][0]=re[De],pe[1][0]=Ge[re[De]][re[De+1]][1],pe[1][1]=Ge[re[De]][re[De+2]][1],Ze=2;Ze<ae;Ze++)for(pe[Ze][0]=Ge[re[De]][re[De+1]][Ze],pe[Ze][Ze]=Ge[re[De]][re[De+2]][Ze],ge.x=(Q[3*pe[Ze][Ze]]-Q[3*pe[Ze][0]])/Ze,ge.y=(Q[3*pe[Ze][Ze]+1]-Q[3*pe[Ze][0]+1])/Ze,ge.z=(Q[3*pe[Ze][Ze]+2]-Q[3*pe[Ze][0]+2])/Ze,ne.x=(W[3*pe[Ze][Ze]]-W[3*pe[Ze][0]])/Ze,ne.y=(W[3*pe[Ze][Ze]+1]-W[3*pe[Ze][0]+1])/Ze,ne.z=(W[3*pe[Ze][Ze]+2]-W[3*pe[Ze][0]+2])/Ze,Te.x=(le[2*pe[Ze][Ze]]-le[2*pe[Ze][0]])/Ze,Te.y=(le[2*pe[Ze][Ze]+1]-le[2*pe[Ze][0]+1])/Ze,et=1;et<Ze;et++)pe[Ze][et]=Q.length/3,Q[$e]=Q[3*pe[Ze][0]]+et*ge.x,W[$e++]=W[3*pe[Ze][0]]+et*ne.x,Q[$e]=Q[3*pe[Ze][0]+1]+et*ge.y,W[$e++]=W[3*pe[Ze][0]+1]+et*ne.y,Q[$e]=Q[3*pe[Ze][0]+2]+et*ge.z,W[$e++]=W[3*pe[Ze][0]+2]+et*ne.z,le[nt++]=le[2*pe[Ze][0]]+et*Te.x,le[nt++]=le[2*pe[Ze][0]+1]+et*Te.y;for(pe[ae]=Ge[re[De+1]][re[De+2]],we.push(pe[0][0],pe[1][0],pe[1][1]),Ze=1;Ze<ae;Ze++){for(et=0;et<Ze;et++)we.push(pe[Ze][et],pe[Ze+1][et],pe[Ze+1][et+1]),we.push(pe[Ze][et],pe[Ze+1][et+1],pe[Ze][et+1]);we.push(pe[Ze][et],pe[Ze+1][et],pe[Ze+1][et+1])}}Z.indices=we,Z.applyToMesh(this,this.isVertexBufferUpdatable(_.b.PositionKind))}else B.a.Warn("VertexData contains null entries")},V.prototype.forceSharedVertices=function(){var K=O.a.ExtractFromMesh(this),Z=K.uvs,le=K.indices,re=K.positions,Q=K.colors;if(le===void 0||re===void 0||le===null||re===null)B.a.Warn("VertexData contains empty entries");else{for(var W,Y,q=new Array,ae=new Array,pe=new Array,De=new Array,de=new Array,ge=0,ne={},Te=0;Te<le.length;Te+=3){Y=[le[Te],le[Te+1],le[Te+2]],de=new Array;for(var we=0;we<3;we++){de[we]="";for(var Se=0;Se<3;Se++)Math.abs(re[3*Y[we]+Se])<1e-8&&(re[3*Y[we]+Se]=0),de[we]+=re[3*Y[we]+Se]+"|"}if(de[0]!=de[1]&&de[0]!=de[2]&&de[1]!=de[2])for(we=0;we<3;we++){if((W=ne[de[we]])===void 0){for(ne[de[we]]=ge,W=ge++,Se=0;Se<3;Se++)q.push(re[3*Y[we]+Se]);if(Q!=null)for(Se=0;Se<4;Se++)De.push(Q[4*Y[we]+Se]);if(Z!=null)for(Se=0;Se<2;Se++)pe.push(Z[2*Y[we]+Se])}ae.push(W)}}var Ge=new Array;O.a.ComputeNormals(q,ae,Ge),K.positions=q,K.indices=ae,K.normals=Ge,Z!=null&&(K.uvs=pe),Q!=null&&(K.colors=De),K.applyToMesh(this,this.isVertexBufferUpdatable(_.b.PositionKind))}},V._instancedMeshFactory=function(K,Z){throw z.a.WarnImport("InstancedMesh")},V._PhysicsImpostorParser=function(K,Z,le){throw z.a.WarnImport("PhysicsImpostor")},V.prototype.createInstance=function(K){var Z=this.geometry;if(Z&&Z.meshes.length>1)for(var le=0,re=Z.meshes.slice(0);le<re.length;le++){var Q=re[le];Q!==this&&Q.makeGeometryUnique()}return V._instancedMeshFactory(K,this)},V.prototype.synchronizeInstances=function(){this._geometry&&this._geometry.meshes.length!==1&&this.instances.length&&this.makeGeometryUnique();for(var K=0;K<this.instances.length;K++)this.instances[K]._syncSubMeshes();return this},V.prototype.optimizeIndices=function(K){var Z=this,le=this.getIndices(),re=this.getVerticesData(_.b.PositionKind);if(!re||!le)return this;for(var Q=new Array,W=0;W<re.length;W+=3)Q.push(M.e.FromArray(re,W));var Y=new Array;return E.a.SyncAsyncForLoop(Q.length,40,function(q){for(var ae=Q.length-1-q,pe=Q[ae],De=0;De<ae;++De){var de=Q[De];if(pe.equals(de)){Y[ae]=De;break}}},function(){for(var q=0;q<le.length;++q)le[q]=Y[le[q]]||le[q];var ae=Z.subMeshes.slice(0);Z.setIndices(le),Z.subMeshes=ae,K&&K(Z)}),this},V.prototype.serialize=function(K){K.name=this.name,K.id=this.id,K.uniqueId=this.uniqueId,K.type=this.getClassName(),x.a&&x.a.HasTags(this)&&(K.tags=x.a.GetTags(this)),K.position=this.position.asArray(),this.rotationQuaternion?K.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(K.rotation=this.rotation.asArray()),K.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?K.pivotMatrix=this.getPivotMatrix().asArray():K.localMatrix=this.getPivotMatrix().asArray(),K.isEnabled=this.isEnabled(!1),K.isVisible=this.isVisible,K.infiniteDistance=this.infiniteDistance,K.pickable=this.isPickable,K.receiveShadows=this.receiveShadows,K.billboardMode=this.billboardMode,K.visibility=this.visibility,K.checkCollisions=this.checkCollisions,K.isBlocker=this.isBlocker,K.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(K.parentId=this.parent.id),K.isUnIndexed=this.isUnIndexed;var Z=this._geometry;if(Z){var le=Z.id;K.geometryId=le,K.subMeshes=[];for(var re=0;re<this.subMeshes.length;re++){var Q=this.subMeshes[re];K.subMeshes.push({materialIndex:Q.materialIndex,verticesStart:Q.verticesStart,verticesCount:Q.verticesCount,indexStart:Q.indexStart,indexCount:Q.indexCount})}}this.material?this.material.doNotSerialize||(K.materialId=this.material.id):this.material=null,this.morphTargetManager&&(K.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(K.skeletonId=this.skeleton.id,K.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(X.a.NAME_PHYSICSENGINE)&&(q=this.getPhysicsImpostor())&&(K.physicsMass=q.getParam("mass"),K.physicsFriction=q.getParam("friction"),K.physicsRestitution=q.getParam("mass"),K.physicsImpostor=q.type),this.metadata&&(K.metadata=this.metadata),K.instances=[];for(var W=0;W<this.instances.length;W++){var Y=this.instances[W];if(!Y.doNotSerialize){var q,ae={name:Y.name,id:Y.id,isEnabled:Y.isEnabled(!1),isVisible:Y.isVisible,isPickable:Y.isPickable,checkCollisions:Y.checkCollisions,position:Y.position.asArray(),scaling:Y.scaling.asArray()};Y.parent&&(ae.parentId=Y.parent.id),Y.rotationQuaternion?ae.rotationQuaternion=Y.rotationQuaternion.asArray():Y.rotation&&(ae.rotation=Y.rotation.asArray()),this.getScene()._getComponent(X.a.NAME_PHYSICSENGINE)&&(q=Y.getPhysicsImpostor())&&(ae.physicsMass=q.getParam("mass"),ae.physicsFriction=q.getParam("friction"),ae.physicsRestitution=q.getParam("mass"),ae.physicsImpostor=q.type),Y.metadata&&(ae.metadata=Y.metadata),K.instances.push(ae),U.a.AppendSerializedAnimations(Y,ae),ae.ranges=Y.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(K.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:E.b.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var pe={data:{},sizes:{},strides:{}};for(var De in this._userThinInstanceBuffersStorage.data)pe.data[De]=E.b.SliceToArray(this._userThinInstanceBuffersStorage.data[De]),pe.sizes[De]=this._userThinInstanceBuffersStorage.sizes[De],pe.strides[De]=this._userThinInstanceBuffersStorage.strides[De];K.thinInstances.userThinInstance=pe}U.a.AppendSerializedAnimations(this,K),K.ranges=this.serializeAnimationRanges(),K.layerMask=this.layerMask,K.alphaIndex=this.alphaIndex,K.hasVertexAlpha=this.hasVertexAlpha,K.overlayAlpha=this.overlayAlpha,K.overlayColor=this.overlayColor.asArray(),K.renderOverlay=this.renderOverlay,K.applyFog=this.applyFog,this.actionManager&&(K.actions=this.actionManager.serialize(this.name))},V.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var K=this._internalMeshDataInfo._morphTargetManager;if(K&&K.vertexCount){if(K.vertexCount!==this.getTotalVertices())return B.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var Z=0;Z<K.numInfluencers;Z++){var le=K.getActiveTarget(Z),re=le.getPositions();if(!re)return void B.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(_.b.PositionKind+Z,re,!1,3);var Q=le.getNormals();Q&&this.geometry.setVerticesData(_.b.NormalKind+Z,Q,!1,3);var W=le.getTangents();W&&this.geometry.setVerticesData(_.b.TangentKind+Z,W,!1,3);var Y=le.getUVs();Y&&this.geometry.setVerticesData(_.b.UVKind+"_"+Z,Y,!1,2)}}else for(Z=0;this.geometry.isVerticesDataPresent(_.b.PositionKind+Z);)this.geometry.removeVerticesData(_.b.PositionKind+Z),this.geometry.isVerticesDataPresent(_.b.NormalKind+Z)&&this.geometry.removeVerticesData(_.b.NormalKind+Z),this.geometry.isVerticesDataPresent(_.b.TangentKind+Z)&&this.geometry.removeVerticesData(_.b.TangentKind+Z),this.geometry.isVerticesDataPresent(_.b.UVKind+Z)&&this.geometry.removeVerticesData(_.b.UVKind+"_"+Z),Z++}},V.Parse=function(K,Z,le){var re;if((re=K.type&&K.type==="GroundMesh"?V._GroundMeshParser(K,Z):new V(K.name,Z)).id=K.id,x.a&&x.a.AddTagsTo(re,K.tags),re.position=M.e.FromArray(K.position),K.metadata!==void 0&&(re.metadata=K.metadata),K.rotationQuaternion?re.rotationQuaternion=M.b.FromArray(K.rotationQuaternion):K.rotation&&(re.rotation=M.e.FromArray(K.rotation)),re.scaling=M.e.FromArray(K.scaling),K.localMatrix?re.setPreTransformMatrix(M.a.FromArray(K.localMatrix)):K.pivotMatrix&&re.setPivotMatrix(M.a.FromArray(K.pivotMatrix)),re.setEnabled(K.isEnabled),re.isVisible=K.isVisible,re.infiniteDistance=K.infiniteDistance,re.showBoundingBox=K.showBoundingBox,re.showSubMeshesBoundingBox=K.showSubMeshesBoundingBox,K.applyFog!==void 0&&(re.applyFog=K.applyFog),K.pickable!==void 0&&(re.isPickable=K.pickable),K.alphaIndex!==void 0&&(re.alphaIndex=K.alphaIndex),re.receiveShadows=K.receiveShadows,re.billboardMode=K.billboardMode,K.visibility!==void 0&&(re.visibility=K.visibility),re.checkCollisions=K.checkCollisions,re.overrideMaterialSideOrientation=K.overrideMaterialSideOrientation,K.isBlocker!==void 0&&(re.isBlocker=K.isBlocker),re._shouldGenerateFlatShading=K.useFlatShading,K.freezeWorldMatrix&&(re._waitingData.freezeWorldMatrix=K.freezeWorldMatrix),K.parentId&&(re._waitingParentId=K.parentId),K.actions!==void 0&&(re._waitingData.actions=K.actions),K.overlayAlpha!==void 0&&(re.overlayAlpha=K.overlayAlpha),K.overlayColor!==void 0&&(re.overlayColor=w.a.FromArray(K.overlayColor)),K.renderOverlay!==void 0&&(re.renderOverlay=K.renderOverlay),re.isUnIndexed=!!K.isUnIndexed,re.hasVertexAlpha=K.hasVertexAlpha,K.delayLoadingFile?(re.delayLoadState=F.a.DELAYLOADSTATE_NOTLOADED,re.delayLoadingFile=le+K.delayLoadingFile,re._boundingInfo=new p.a(M.e.FromArray(K.boundingBoxMinimum),M.e.FromArray(K.boundingBoxMaximum)),K._binaryInfo&&(re._binaryInfo=K._binaryInfo),re._delayInfo=[],K.hasUVs&&re._delayInfo.push(_.b.UVKind),K.hasUVs2&&re._delayInfo.push(_.b.UV2Kind),K.hasUVs3&&re._delayInfo.push(_.b.UV3Kind),K.hasUVs4&&re._delayInfo.push(_.b.UV4Kind),K.hasUVs5&&re._delayInfo.push(_.b.UV5Kind),K.hasUVs6&&re._delayInfo.push(_.b.UV6Kind),K.hasColors&&re._delayInfo.push(_.b.ColorKind),K.hasMatricesIndices&&re._delayInfo.push(_.b.MatricesIndicesKind),K.hasMatricesWeights&&re._delayInfo.push(_.b.MatricesWeightsKind),re._delayLoadingFunction=R.a._ImportGeometry,P.a.ForceFullSceneLoadingForIncremental&&re._checkDelayState()):R.a._ImportGeometry(K,re),K.materialId?re.setMaterialByID(K.materialId):re.material=null,K.morphTargetManagerId>-1&&(re.morphTargetManager=Z.getMorphTargetManagerById(K.morphTargetManagerId)),K.skeletonId!==void 0&&K.skeletonId!==null&&(re.skeleton=Z.getLastSkeletonByID(K.skeletonId),K.numBoneInfluencers&&(re.numBoneInfluencers=K.numBoneInfluencers)),K.animations){for(var Q=0;Q<K.animations.length;Q++){var W=K.animations[Q];(pe=L.a.GetClass("BABYLON.Animation"))&&re.animations.push(pe.Parse(W))}S.a.ParseAnimationRanges(re,K,Z)}if(K.autoAnimate&&Z.beginAnimation(re,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),K.layerMask&&!isNaN(K.layerMask)?re.layerMask=Math.abs(parseInt(K.layerMask)):re.layerMask=268435455,K.physicsImpostor&&V._PhysicsImpostorParser(Z,re,K),K.lodMeshIds&&(re._waitingData.lods={ids:K.lodMeshIds,distances:K.lodDistances?K.lodDistances:null,coverages:K.lodCoverages?K.lodCoverages:null}),K.instances)for(var Y=0;Y<K.instances.length;Y++){var q=K.instances[Y],ae=re.createInstance(q.name);if(q.id&&(ae.id=q.id),x.a&&(q.tags?x.a.AddTagsTo(ae,q.tags):x.a.AddTagsTo(ae,K.tags)),ae.position=M.e.FromArray(q.position),q.metadata!==void 0&&(ae.metadata=q.metadata),q.parentId&&(ae._waitingParentId=q.parentId),q.isEnabled!==void 0&&q.isEnabled!==null&&ae.setEnabled(q.isEnabled),q.isVisible!==void 0&&q.isVisible!==null&&(ae.isVisible=q.isVisible),q.isPickable!==void 0&&q.isPickable!==null&&(ae.isPickable=q.isPickable),q.rotationQuaternion?ae.rotationQuaternion=M.b.FromArray(q.rotationQuaternion):q.rotation&&(ae.rotation=M.e.FromArray(q.rotation)),ae.scaling=M.e.FromArray(q.scaling),q.checkCollisions!=null&&q.checkCollisions!=null&&(ae.checkCollisions=q.checkCollisions),q.pickable!=null&&q.pickable!=null&&(ae.isPickable=q.pickable),q.showBoundingBox!=null&&q.showBoundingBox!=null&&(ae.showBoundingBox=q.showBoundingBox),q.showSubMeshesBoundingBox!=null&&q.showSubMeshesBoundingBox!=null&&(ae.showSubMeshesBoundingBox=q.showSubMeshesBoundingBox),q.alphaIndex!=null&&q.showSubMeshesBoundingBox!=null&&(ae.alphaIndex=q.alphaIndex),q.physicsImpostor&&V._PhysicsImpostorParser(Z,ae,q),q.animations){for(Q=0;Q<q.animations.length;Q++){var pe;W=q.animations[Q],(pe=L.a.GetClass("BABYLON.Animation"))&&ae.animations.push(pe.Parse(W))}S.a.ParseAnimationRanges(ae,q,Z),q.autoAnimate&&Z.beginAnimation(ae,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1)}}if(K.thinInstances){var De=K.thinInstances;if(De.matrixData?(re.thinInstanceSetBuffer("matrix",new Float32Array(De.matrixData),16,!1),re._thinInstanceDataStorage.matrixBufferSize=De.matrixBufferSize,re._thinInstanceDataStorage.instancesCount=De.instancesCount):re._thinInstanceDataStorage.matrixBufferSize=De.matrixBufferSize,K.thinInstances.userThinInstance){var de=K.thinInstances.userThinInstance;for(var ge in de.data)re.thinInstanceSetBuffer(ge,new Float32Array(de.data[ge]),de.strides[ge],!1),re._userThinInstanceBuffersStorage.sizes[ge]=de.sizes[ge]}}return re},V.CreateRibbon=function(K,Z,le,re,Q,W,Y,q,ae){throw z.a.WarnImport("MeshBuilder")},V.CreateDisc=function(K,Z,le,re,Q,W){throw z.a.WarnImport("MeshBuilder")},V.CreateBox=function(K,Z,le,re,Q){throw z.a.WarnImport("MeshBuilder")},V.CreateSphere=function(K,Z,le,re,Q,W){throw z.a.WarnImport("MeshBuilder")},V.CreateHemisphere=function(K,Z,le,re){throw z.a.WarnImport("MeshBuilder")},V.CreateCylinder=function(K,Z,le,re,Q,W,Y,q,ae){throw z.a.WarnImport("MeshBuilder")},V.CreateTorus=function(K,Z,le,re,Q,W,Y){throw z.a.WarnImport("MeshBuilder")},V.CreateTorusKnot=function(K,Z,le,re,Q,W,Y,q,ae,pe){throw z.a.WarnImport("MeshBuilder")},V.CreateLines=function(K,Z,le,re,Q){throw z.a.WarnImport("MeshBuilder")},V.CreateDashedLines=function(K,Z,le,re,Q,W,Y,q){throw z.a.WarnImport("MeshBuilder")},V.CreatePolygon=function(K,Z,le,re,Q,W,Y){throw Y===void 0&&(Y=earcut),z.a.WarnImport("MeshBuilder")},V.ExtrudePolygon=function(K,Z,le,re,Q,W,Y,q){throw q===void 0&&(q=earcut),z.a.WarnImport("MeshBuilder")},V.ExtrudeShape=function(K,Z,le,re,Q,W,Y,q,ae,pe){throw z.a.WarnImport("MeshBuilder")},V.ExtrudeShapeCustom=function(K,Z,le,re,Q,W,Y,q,ae,pe,De,de){throw z.a.WarnImport("MeshBuilder")},V.CreateLathe=function(K,Z,le,re,Q,W,Y){throw z.a.WarnImport("MeshBuilder")},V.CreatePlane=function(K,Z,le,re,Q){throw z.a.WarnImport("MeshBuilder")},V.CreateGround=function(K,Z,le,re,Q,W){throw z.a.WarnImport("MeshBuilder")},V.CreateTiledGround=function(K,Z,le,re,Q,W,Y,q,ae){throw z.a.WarnImport("MeshBuilder")},V.CreateGroundFromHeightMap=function(K,Z,le,re,Q,W,Y,q,ae,pe,De){throw z.a.WarnImport("MeshBuilder")},V.CreateTube=function(K,Z,le,re,Q,W,Y,q,ae,pe){throw z.a.WarnImport("MeshBuilder")},V.CreatePolyhedron=function(K,Z,le){throw z.a.WarnImport("MeshBuilder")},V.CreateIcoSphere=function(K,Z,le){throw z.a.WarnImport("MeshBuilder")},V.CreateDecal=function(K,Z,le,re,Q,W){throw z.a.WarnImport("MeshBuilder")},V.CreateCapsule=function(K,Z,le){throw z.a.WarnImport("MeshBuilder")},V.prototype.setPositionsForCPUSkinning=function(){var K=this._internalMeshDataInfo;if(!K._sourcePositions){var Z=this.getVerticesData(_.b.PositionKind);if(!Z)return K._sourcePositions;K._sourcePositions=new Float32Array(Z),this.isVertexBufferUpdatable(_.b.PositionKind)||this.setVerticesData(_.b.PositionKind,Z,!0)}return K._sourcePositions},V.prototype.setNormalsForCPUSkinning=function(){var K=this._internalMeshDataInfo;if(!K._sourceNormals){var Z=this.getVerticesData(_.b.NormalKind);if(!Z)return K._sourceNormals;K._sourceNormals=new Float32Array(Z),this.isVertexBufferUpdatable(_.b.NormalKind)||this.setVerticesData(_.b.NormalKind,Z,!0)}return K._sourceNormals},V.prototype.applySkeleton=function(K){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(_.b.PositionKind))return this;if(!this.isVerticesDataPresent(_.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(_.b.MatricesWeightsKind))return this;var Z=this.isVerticesDataPresent(_.b.NormalKind),le=this._internalMeshDataInfo;if(!le._sourcePositions){var re=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=re}Z&&!le._sourceNormals&&this.setNormalsForCPUSkinning();var Q=this.getVerticesData(_.b.PositionKind);if(!Q)return this;Q instanceof Float32Array||(Q=new Float32Array(Q));var W=this.getVerticesData(_.b.NormalKind);if(Z){if(!W)return this;W instanceof Float32Array||(W=new Float32Array(W))}var Y=this.getVerticesData(_.b.MatricesIndicesKind),q=this.getVerticesData(_.b.MatricesWeightsKind);if(!q||!Y)return this;for(var ae,pe=this.numBoneInfluencers>4,De=pe?this.getVerticesData(_.b.MatricesIndicesExtraKind):null,de=pe?this.getVerticesData(_.b.MatricesWeightsExtraKind):null,ge=K.getTransformMatrices(this),ne=M.e.Zero(),Te=new M.a,we=new M.a,Se=0,Ge=0;Ge<Q.length;Ge+=3,Se+=4){var $e;for(ae=0;ae<4;ae++)($e=q[Se+ae])>0&&(M.a.FromFloat32ArrayToRefScaled(ge,Math.floor(16*Y[Se+ae]),$e,we),Te.addToSelf(we));if(pe)for(ae=0;ae<4;ae++)($e=de[Se+ae])>0&&(M.a.FromFloat32ArrayToRefScaled(ge,Math.floor(16*De[Se+ae]),$e,we),Te.addToSelf(we));M.e.TransformCoordinatesFromFloatsToRef(le._sourcePositions[Ge],le._sourcePositions[Ge+1],le._sourcePositions[Ge+2],Te,ne),ne.toArray(Q,Ge),Z&&(M.e.TransformNormalFromFloatsToRef(le._sourceNormals[Ge],le._sourceNormals[Ge+1],le._sourceNormals[Ge+2],Te,ne),ne.toArray(W,Ge)),Te.reset()}return this.updateVerticesData(_.b.PositionKind,Q),Z&&this.updateVerticesData(_.b.NormalKind,W),this},V.MinMax=function(K){var Z=null,le=null;return K.forEach(function(re){var Q=re.getBoundingInfo().boundingBox;Z&&le?(Z.minimizeInPlace(Q.minimumWorld),le.maximizeInPlace(Q.maximumWorld)):(Z=Q.minimumWorld,le=Q.maximumWorld)}),Z&&le?{min:Z,max:le}:{min:M.e.Zero(),max:M.e.Zero()}},V.Center=function(K){var Z=K instanceof Array?V.MinMax(K):K;return M.e.Center(Z.min,Z.max)},V.MergeMeshes=function(K,Z,le,re,Q,W){var Y;if(Z===void 0&&(Z=!0),!le){var q=0;for(Y=0;Y<K.length;Y++)if(K[Y]&&(q+=K[Y].getTotalVertices())>=65536)return B.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(W){var ae,pe,De=null;Q=!1}var de,ge=new Array,ne=new Array,Te=null,we=new Array,Se=null;for(Y=0;Y<K.length;Y++)if(K[Y]){var Ge=K[Y];if(Ge.isAnInstance)return B.a.Warn("Cannot merge instance meshes."),null;var $e=Ge.computeWorldMatrix(!0);if((de=O.a.ExtractFromMesh(Ge,!0,!0)).transform($e),Te?Te.merge(de,le):(Te=de,Se=Ge),Q&&we.push(Ge.getTotalIndices()),W)if(Ge.material){var nt=Ge.material;if(nt instanceof C.a){for(pe=0;pe<nt.subMaterials.length;pe++)ge.indexOf(nt.subMaterials[pe])<0&&ge.push(nt.subMaterials[pe]);for(ae=0;ae<Ge.subMeshes.length;ae++)ne.push(ge.indexOf(nt.subMaterials[Ge.subMeshes[ae].materialIndex])),we.push(Ge.subMeshes[ae].indexCount)}else for(ge.indexOf(nt)<0&&ge.push(nt),ae=0;ae<Ge.subMeshes.length;ae++)ne.push(ge.indexOf(nt)),we.push(Ge.subMeshes[ae].indexCount)}else for(ae=0;ae<Ge.subMeshes.length;ae++)ne.push(0),we.push(Ge.subMeshes[ae].indexCount)}if(Se=Se,re||(re=new V(Se.name+"_merged",Se.getScene())),Te.applyToMesh(re),re.checkCollisions=Se.checkCollisions,re.overrideMaterialSideOrientation=Se.overrideMaterialSideOrientation,Z)for(Y=0;Y<K.length;Y++)K[Y]&&K[Y].dispose();if(Q||W){re.releaseSubMeshes(),Y=0;for(var et=0;Y<we.length;)y.a.CreateFromIndices(0,et,we[Y],re),et+=we[Y],Y++}if(W){for((De=new C.a(Se.name+"_merged",Se.getScene())).subMaterials=ge,ae=0;ae<re.subMeshes.length;ae++)re.subMeshes[ae].materialIndex=ne[ae];re.material=De}else re.material=Se.material;return re},V.prototype.addInstance=function(K){K._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(K)},V.prototype.removeInstance=function(K){var Z=K._indexInSourceMeshInstanceArray;if(Z!=-1){if(Z!==this.instances.length-1){var le=this.instances[this.instances.length-1];this.instances[Z]=le,le._indexInSourceMeshInstanceArray=Z}K._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},V.FRONTSIDE=O.a.FRONTSIDE,V.BACKSIDE=O.a.BACKSIDE,V.DOUBLESIDE=O.a.DOUBLESIDE,V.DEFAULTSIDE=O.a.DEFAULTSIDE,V.NO_CAP=0,V.CAP_START=1,V.CAP_END=2,V.CAP_ALL=3,V.NO_FLIP=0,V.FLIP_TILE=1,V.ROTATE_TILE=2,V.FLIP_ROW=3,V.ROTATE_ROW=4,V.FLIP_N_ROTATE_TILE=5,V.FLIP_N_ROTATE_ROW=6,V.CENTER=0,V.LEFT=1,V.RIGHT=2,V.TOP=3,V.BOTTOM=4,V._GroundMeshParser=function(K,Z){throw z.a.WarnImport("GroundMesh")},V}(I.a);L.a.RegisteredTypes["BABYLON.Mesh"]=ie},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m._AddLogEntry=function(E){m._LogCache=E+m._LogCache,m.OnNewCacheEntry&&m.OnNewCacheEntry(E)},m._FormatMessage=function(E){var d=function(M){return M<10?"0"+M:""+M},x=new Date;return"["+d(x.getHours())+":"+d(x.getMinutes())+":"+d(x.getSeconds())+"]: "+E},m._LogDisabled=function(E){},m._LogEnabled=function(E){var d=m._FormatMessage(E);console.log("BJS - "+d);var x="<div style='color:white'>"+d+"</div><br>";m._AddLogEntry(x)},m._WarnDisabled=function(E){},m._WarnEnabled=function(E){var d=m._FormatMessage(E);console.warn("BJS - "+d);var x="<div style='color:orange'>"+d+"</div><br>";m._AddLogEntry(x)},m._ErrorDisabled=function(E){},m._ErrorEnabled=function(E){m.errorsCount++;var d=m._FormatMessage(E);console.error("BJS - "+d);var x="<div style='color:red'>"+d+"</div><br>";m._AddLogEntry(x)},Object.defineProperty(m,"LogCache",{get:function(){return m._LogCache},enumerable:!1,configurable:!0}),m.ClearLogCache=function(){m._LogCache="",m.errorsCount=0},Object.defineProperty(m,"LogLevels",{set:function(E){(E&m.MessageLogLevel)===m.MessageLogLevel?m.Log=m._LogEnabled:m.Log=m._LogDisabled,(E&m.WarningLogLevel)===m.WarningLogLevel?m.Warn=m._WarnEnabled:m.Warn=m._WarnDisabled,(E&m.ErrorLogLevel)===m.ErrorLogLevel?m.Error=m._ErrorEnabled:m.Error=m._ErrorDisabled},enumerable:!1,configurable:!0}),m.NoneLogLevel=0,m.MessageLogLevel=1,m.WarningLogLevel=2,m.ErrorLogLevel=4,m.AllLogLevel=7,m._LogCache="",m.errorsCount=0,m.Log=m._LogEnabled,m.Warn=m._WarnEnabled,m.Error=m._ErrorEnabled,m}()},function(f,s,c){c.d(s,"a",function(){return x}),c.d(s,"b",function(){return M}),c.d(s,"c",function(){return w});var T=c(14),m=c(28),E=c(44),d=c(11),x=function(){function S(_,O,R){_===void 0&&(_=0),O===void 0&&(O=0),R===void 0&&(R=0),this.r=_,this.g=O,this.b=R}return S.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},S.prototype.getClassName=function(){return"Color3"},S.prototype.getHashCode=function(){var _=255*this.r|0;return _=397*(_=397*_^(255*this.g|0))^(255*this.b|0)},S.prototype.toArray=function(_,O){return O===void 0&&(O=0),_[O]=this.r,_[O+1]=this.g,_[O+2]=this.b,this},S.prototype.fromArray=function(_,O){return O===void 0&&(O=0),S.FromArrayToRef(_,O,this),this},S.prototype.toColor4=function(_){return _===void 0&&(_=1),new M(this.r,this.g,this.b,_)},S.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},S.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},S.prototype.multiply=function(_){return new S(this.r*_.r,this.g*_.g,this.b*_.b)},S.prototype.multiplyToRef=function(_,O){return O.r=this.r*_.r,O.g=this.g*_.g,O.b=this.b*_.b,this},S.prototype.equals=function(_){return _&&this.r===_.r&&this.g===_.g&&this.b===_.b},S.prototype.equalsFloats=function(_,O,R){return this.r===_&&this.g===O&&this.b===R},S.prototype.scale=function(_){return new S(this.r*_,this.g*_,this.b*_)},S.prototype.scaleToRef=function(_,O){return O.r=this.r*_,O.g=this.g*_,O.b=this.b*_,this},S.prototype.scaleAndAddToRef=function(_,O){return O.r+=this.r*_,O.g+=this.g*_,O.b+=this.b*_,this},S.prototype.clampToRef=function(_,O,R){return _===void 0&&(_=0),O===void 0&&(O=1),R.r=T.a.Clamp(this.r,_,O),R.g=T.a.Clamp(this.g,_,O),R.b=T.a.Clamp(this.b,_,O),this},S.prototype.add=function(_){return new S(this.r+_.r,this.g+_.g,this.b+_.b)},S.prototype.addToRef=function(_,O){return O.r=this.r+_.r,O.g=this.g+_.g,O.b=this.b+_.b,this},S.prototype.subtract=function(_){return new S(this.r-_.r,this.g-_.g,this.b-_.b)},S.prototype.subtractToRef=function(_,O){return O.r=this.r-_.r,O.g=this.g-_.g,O.b=this.b-_.b,this},S.prototype.clone=function(){return new S(this.r,this.g,this.b)},S.prototype.copyFrom=function(_){return this.r=_.r,this.g=_.g,this.b=_.b,this},S.prototype.copyFromFloats=function(_,O,R){return this.r=_,this.g=O,this.b=R,this},S.prototype.set=function(_,O,R){return this.copyFromFloats(_,O,R)},S.prototype.toHexString=function(){var _=255*this.r|0,O=255*this.g|0,R=255*this.b|0;return"#"+T.a.ToHex(_)+T.a.ToHex(O)+T.a.ToHex(R)},S.prototype.toLinearSpace=function(){var _=new S;return this.toLinearSpaceToRef(_),_},S.prototype.toHSV=function(){var _=new S;return this.toHSVToRef(_),_},S.prototype.toHSVToRef=function(_){var O=this.r,R=this.g,I=this.b,y=Math.max(O,R,I),p=Math.min(O,R,I),g=0,C=0,P=y,F=y-p;y!==0&&(C=F/y),y!=p&&(y==O?(g=(R-I)/F,R<I&&(g+=6)):y==R?g=(I-O)/F+2:y==I&&(g=(O-R)/F+4),g*=60),_.r=g,_.g=C,_.b=P},S.prototype.toLinearSpaceToRef=function(_){return _.r=Math.pow(this.r,m.c),_.g=Math.pow(this.g,m.c),_.b=Math.pow(this.b,m.c),this},S.prototype.toGammaSpace=function(){var _=new S;return this.toGammaSpaceToRef(_),_},S.prototype.toGammaSpaceToRef=function(_){return _.r=Math.pow(this.r,m.b),_.g=Math.pow(this.g,m.b),_.b=Math.pow(this.b,m.b),this},S.HSVtoRGBToRef=function(_,O,R,I){var y=R*O,p=_/60,g=y*(1-Math.abs(p%2-1)),C=0,P=0,F=0;p>=0&&p<=1?(C=y,P=g):p>=1&&p<=2?(C=g,P=y):p>=2&&p<=3?(P=y,F=g):p>=3&&p<=4?(P=g,F=y):p>=4&&p<=5?(C=g,F=y):p>=5&&p<=6&&(C=y,F=g);var U=R-y;I.set(C+U,P+U,F+U)},S.FromHexString=function(_){if(_.substring(0,1)!=="#"||_.length!==7)return new S(0,0,0);var O=parseInt(_.substring(1,3),16),R=parseInt(_.substring(3,5),16),I=parseInt(_.substring(5,7),16);return S.FromInts(O,R,I)},S.FromArray=function(_,O){return O===void 0&&(O=0),new S(_[O],_[O+1],_[O+2])},S.FromArrayToRef=function(_,O,R){O===void 0&&(O=0),R.r=_[O],R.g=_[O+1],R.b=_[O+2]},S.FromInts=function(_,O,R){return new S(_/255,O/255,R/255)},S.Lerp=function(_,O,R){var I=new S(0,0,0);return S.LerpToRef(_,O,R,I),I},S.LerpToRef=function(_,O,R,I){I.r=_.r+(O.r-_.r)*R,I.g=_.g+(O.g-_.g)*R,I.b=_.b+(O.b-_.b)*R},S.Red=function(){return new S(1,0,0)},S.Green=function(){return new S(0,1,0)},S.Blue=function(){return new S(0,0,1)},S.Black=function(){return new S(0,0,0)},Object.defineProperty(S,"BlackReadOnly",{get:function(){return S._BlackReadOnly},enumerable:!1,configurable:!0}),S.White=function(){return new S(1,1,1)},S.Purple=function(){return new S(.5,0,.5)},S.Magenta=function(){return new S(1,0,1)},S.Yellow=function(){return new S(1,1,0)},S.Gray=function(){return new S(.5,.5,.5)},S.Teal=function(){return new S(0,1,1)},S.Random=function(){return new S(Math.random(),Math.random(),Math.random())},S._BlackReadOnly=S.Black(),S}(),M=function(){function S(_,O,R,I){_===void 0&&(_=0),O===void 0&&(O=0),R===void 0&&(R=0),I===void 0&&(I=1),this.r=_,this.g=O,this.b=R,this.a=I}return S.prototype.addInPlace=function(_){return this.r+=_.r,this.g+=_.g,this.b+=_.b,this.a+=_.a,this},S.prototype.asArray=function(){var _=new Array;return this.toArray(_,0),_},S.prototype.toArray=function(_,O){return O===void 0&&(O=0),_[O]=this.r,_[O+1]=this.g,_[O+2]=this.b,_[O+3]=this.a,this},S.prototype.fromArray=function(_,O){return O===void 0&&(O=0),S.FromArrayToRef(_,O,this),this},S.prototype.equals=function(_){return _&&this.r===_.r&&this.g===_.g&&this.b===_.b&&this.a===_.a},S.prototype.add=function(_){return new S(this.r+_.r,this.g+_.g,this.b+_.b,this.a+_.a)},S.prototype.subtract=function(_){return new S(this.r-_.r,this.g-_.g,this.b-_.b,this.a-_.a)},S.prototype.subtractToRef=function(_,O){return O.r=this.r-_.r,O.g=this.g-_.g,O.b=this.b-_.b,O.a=this.a-_.a,this},S.prototype.scale=function(_){return new S(this.r*_,this.g*_,this.b*_,this.a*_)},S.prototype.scaleToRef=function(_,O){return O.r=this.r*_,O.g=this.g*_,O.b=this.b*_,O.a=this.a*_,this},S.prototype.scaleAndAddToRef=function(_,O){return O.r+=this.r*_,O.g+=this.g*_,O.b+=this.b*_,O.a+=this.a*_,this},S.prototype.clampToRef=function(_,O,R){return _===void 0&&(_=0),O===void 0&&(O=1),R.r=T.a.Clamp(this.r,_,O),R.g=T.a.Clamp(this.g,_,O),R.b=T.a.Clamp(this.b,_,O),R.a=T.a.Clamp(this.a,_,O),this},S.prototype.multiply=function(_){return new S(this.r*_.r,this.g*_.g,this.b*_.b,this.a*_.a)},S.prototype.multiplyToRef=function(_,O){return O.r=this.r*_.r,O.g=this.g*_.g,O.b=this.b*_.b,O.a=this.a*_.a,O},S.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},S.prototype.getClassName=function(){return"Color4"},S.prototype.getHashCode=function(){var _=255*this.r|0;return _=397*(_=397*(_=397*_^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},S.prototype.clone=function(){return new S(this.r,this.g,this.b,this.a)},S.prototype.copyFrom=function(_){return this.r=_.r,this.g=_.g,this.b=_.b,this.a=_.a,this},S.prototype.copyFromFloats=function(_,O,R,I){return this.r=_,this.g=O,this.b=R,this.a=I,this},S.prototype.set=function(_,O,R,I){return this.copyFromFloats(_,O,R,I)},S.prototype.toHexString=function(_){_===void 0&&(_=!1);var O=255*this.r|0,R=255*this.g|0,I=255*this.b|0;if(_)return"#"+T.a.ToHex(O)+T.a.ToHex(R)+T.a.ToHex(I);var y=255*this.a|0;return"#"+T.a.ToHex(O)+T.a.ToHex(R)+T.a.ToHex(I)+T.a.ToHex(y)},S.prototype.toLinearSpace=function(){var _=new S;return this.toLinearSpaceToRef(_),_},S.prototype.toLinearSpaceToRef=function(_){return _.r=Math.pow(this.r,m.c),_.g=Math.pow(this.g,m.c),_.b=Math.pow(this.b,m.c),_.a=this.a,this},S.prototype.toGammaSpace=function(){var _=new S;return this.toGammaSpaceToRef(_),_},S.prototype.toGammaSpaceToRef=function(_){return _.r=Math.pow(this.r,m.b),_.g=Math.pow(this.g,m.b),_.b=Math.pow(this.b,m.b),_.a=this.a,this},S.FromHexString=function(_){if(_.substring(0,1)!=="#"||_.length!==9)return new S(0,0,0,0);var O=parseInt(_.substring(1,3),16),R=parseInt(_.substring(3,5),16),I=parseInt(_.substring(5,7),16),y=parseInt(_.substring(7,9),16);return S.FromInts(O,R,I,y)},S.Lerp=function(_,O,R){var I=new S(0,0,0,0);return S.LerpToRef(_,O,R,I),I},S.LerpToRef=function(_,O,R,I){I.r=_.r+(O.r-_.r)*R,I.g=_.g+(O.g-_.g)*R,I.b=_.b+(O.b-_.b)*R,I.a=_.a+(O.a-_.a)*R},S.FromColor3=function(_,O){return O===void 0&&(O=1),new S(_.r,_.g,_.b,O)},S.FromArray=function(_,O){return O===void 0&&(O=0),new S(_[O],_[O+1],_[O+2],_[O+3])},S.FromArrayToRef=function(_,O,R){O===void 0&&(O=0),R.r=_[O],R.g=_[O+1],R.b=_[O+2],R.a=_[O+3]},S.FromInts=function(_,O,R,I){return new S(_/255,O/255,R/255,I/255)},S.CheckColors4=function(_,O){if(_.length===3*O){for(var R=[],I=0;I<_.length;I+=3){var y=I/3*4;R[y]=_[I],R[y+1]=_[I+1],R[y+2]=_[I+2],R[y+3]=1}return R}return _},S}(),w=function(){function S(){}return S.Color3=E.a.BuildArray(3,x.Black),S.Color4=E.a.BuildArray(3,function(){return new M(0,0,0,0)}),S}();d.a.RegisteredTypes["BABYLON.Color3"]=x,d.a.RegisteredTypes["BABYLON.Color4"]=M},function(f,s,c){c.d(s,"a",function(){return p});var T=c(1),m=c(3),E=c(6),d=c(0),x=c(52),M=c(2),w=c(11),S=c(21),_=c(104),O=c(122),R=c(64),I=c(34),y=c(150),p=function(g){function C(P,F,U,B,L,z,X,G,ee,$,fe,me){U===void 0&&(U=!1),B===void 0&&(B=!0),L===void 0&&(L=C.TRILINEAR_SAMPLINGMODE),z===void 0&&(z=null),X===void 0&&(X=null),G===void 0&&(G=null),ee===void 0&&(ee=!1);var ve=g.call(this,F)||this;ve.url=null,ve.uOffset=0,ve.vOffset=0,ve.uScale=1,ve.vScale=1,ve.uAng=0,ve.vAng=0,ve.wAng=0,ve.uRotationCenter=.5,ve.vRotationCenter=.5,ve.wRotationCenter=.5,ve.homogeneousRotationInUVTransform=!1,ve.inspectableCustomProperties=null,ve._noMipmap=!1,ve._invertY=!1,ve._rowGenerationMatrix=null,ve._cachedTextureMatrix=null,ve._projectionModeMatrix=null,ve._t0=null,ve._t1=null,ve._t2=null,ve._cachedUOffset=-1,ve._cachedVOffset=-1,ve._cachedUScale=0,ve._cachedVScale=0,ve._cachedUAng=-1,ve._cachedVAng=-1,ve._cachedWAng=-1,ve._cachedProjectionMatrixId=-1,ve._cachedURotationCenter=-1,ve._cachedVRotationCenter=-1,ve._cachedWRotationCenter=-1,ve._cachedHomogeneousRotationInUVTransform=!1,ve._cachedCoordinatesMode=-1,ve._initialSamplingMode=C.BILINEAR_SAMPLINGMODE,ve._buffer=null,ve._deleteBuffer=!1,ve._format=null,ve._delayedOnLoad=null,ve._delayedOnError=null,ve.onLoadObservable=new E.c,ve._isBlocking=!0,ve.name=P||"",ve.url=P,ve._noMipmap=U,ve._invertY=B,ve._initialSamplingMode=L,ve._buffer=G,ve._deleteBuffer=ee,ve._mimeType=fe,ve._loaderOptions=me,$&&(ve._format=$);var be=ve.getScene(),ie=ve._getEngine();if(!ie)return ve;ie.onBeforeTextureInitObservable.notifyObservers(ve);var se=function(){ve._texture&&(ve._texture._invertVScale&&(ve.vScale*=-1,ve.vOffset+=1),ve._texture._cachedWrapU!==null&&(ve.wrapU=ve._texture._cachedWrapU,ve._texture._cachedWrapU=null),ve._texture._cachedWrapV!==null&&(ve.wrapV=ve._texture._cachedWrapV,ve._texture._cachedWrapV=null),ve._texture._cachedWrapR!==null&&(ve.wrapR=ve._texture._cachedWrapR,ve._texture._cachedWrapR=null)),ve.onLoadObservable.hasObservers()&&ve.onLoadObservable.notifyObservers(ve),z&&z(),!ve.isBlocking&&be&&be.resetCachedMaterial()};return ve.url?(ve._texture=ve._getFromCache(ve.url,U,L,B),ve._texture?ve._texture.isReady?_.a.SetImmediate(function(){return se()}):ve._texture.onLoadedObservable.add(se):be&&be.useDelayedTextureLoading?(ve.delayLoadState=M.a.DELAYLOADSTATE_NOTLOADED,ve._delayedOnLoad=se,ve._delayedOnError=X):(ve._texture=ie.createTexture(ve.url,U,B,be,L,se,X,ve._buffer,void 0,ve._format,null,fe,me),ee&&(ve._buffer=null)),ve):(ve._delayedOnLoad=se,ve._delayedOnError=X,ve)}return Object(T.d)(C,g),Object.defineProperty(C.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(P){this._isBlocking=P},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),C.prototype.updateURL=function(P,F,U){F===void 0&&(F=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag)),this.name&&!I.a.StartsWith(this.name,"data:")||(this.name=P),this.url=P,this._buffer=F,this.delayLoadState=M.a.DELAYLOADSTATE_NOTLOADED,U&&(this._delayedOnLoad=U),this.delayLoad()},C.prototype.delayLoad=function(){if(this.delayLoadState===M.a.DELAYLOADSTATE_NOTLOADED){var P=this.getScene();P&&(this.delayLoadState=M.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?_.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=P.getEngine().createTexture(this.url,this._noMipmap,this._invertY,P,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},C.prototype._prepareRowForTextureGeneration=function(P,F,U,B){P*=this._cachedUScale,F*=this._cachedVScale,P-=this.uRotationCenter*this._cachedUScale,F-=this.vRotationCenter*this._cachedVScale,U-=this.wRotationCenter,d.e.TransformCoordinatesFromFloatsToRef(P,F,U,this._rowGenerationMatrix,B),B.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,B.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,B.z+=this.wRotationCenter},C.prototype.checkTransformsAreIdentical=function(P){return P!==null&&this.uOffset===P.uOffset&&this.vOffset===P.vOffset&&this.uScale===P.uScale&&this.vScale===P.vScale&&this.uAng===P.uAng&&this.vAng===P.vAng&&this.wAng===P.wAng},C.prototype.getTextureMatrix=function(P){var F=this;if(P===void 0&&(P=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*P===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*P,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=d.a.Zero(),this._rowGenerationMatrix=new d.a,this._t0=d.e.Zero(),this._t1=d.e.Zero(),this._t2=d.e.Zero()),d.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(d.a.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,d.c.Matrix[0]),d.a.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,d.c.Matrix[1]),d.a.ScalingToRef(this._cachedUScale,this._cachedVScale,0,d.c.Matrix[2]),d.a.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,d.c.Matrix[3]),d.c.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(d.c.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),d.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var U=this.getScene();return U?(U.markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag,function(B){return B.hasTexture(F)}),this._cachedTextureMatrix):this._cachedTextureMatrix},C.prototype.getReflectionTextureMatrix=function(){var P=this,F=this.getScene();if(!F)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==C.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===F.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=d.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=d.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case C.PLANAR_MODE:d.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case C.PROJECTION_MODE:d.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var U=F.getProjectionMatrix();this._cachedProjectionMatrixId=U.updateFlag,U.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:d.a.IdentityToRef(this._cachedTextureMatrix)}return F.markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag,function(B){return B.getActiveTextures().indexOf(P)!==-1}),this._cachedTextureMatrix},C.prototype.clone=function(){var P=this;return m.a.Clone(function(){return new C(P._texture?P._texture.url:null,P.getScene(),P._noMipmap,P._invertY,P.samplingMode,void 0,void 0,P._texture?P._texture._buffer:void 0)},this)},C.prototype.serialize=function(){var P=this.name;C.SerializeBuffers||I.a.StartsWith(this.name,"data:")&&(this.name=""),I.a.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var F=g.prototype.serialize.call(this);return F?((C.SerializeBuffers||C.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(F.base64String=this._buffer,F.name=F.name.replace("data:","")):this.url&&I.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?F.base64String="data:image/png;base64,"+I.a.EncodeArrayBufferToBase64(this._buffer):C.ForceSerializeBuffers&&(F.base64String=y.a.GenerateBase64StringFromTexture(this))),F.invertY=this._invertY,F.samplingMode=this.samplingMode,this.name=P,F):null},C.prototype.getClassName=function(){return"Texture"},C.prototype.dispose=function(){g.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},C.Parse=function(P,F,U){if(P.customType){var B=O.a.Instantiate(P.customType).Parse(P,F,U);return P.samplingMode&&B.updateSamplingMode&&B._samplingMode&&B._samplingMode!==P.samplingMode&&B.updateSamplingMode(P.samplingMode),B}if(P.isCube&&!P.isRenderTarget)return C._CubeTextureParser(P,F,U);if(!P.name&&!P.isRenderTarget)return null;var L=function(){if(z&&z._texture&&(z._texture._cachedWrapU=null,z._texture._cachedWrapV=null,z._texture._cachedWrapR=null),P.samplingMode){var X=P.samplingMode;z&&z.samplingMode!==X&&z.updateSamplingMode(X)}if(z&&P.animations)for(var G=0;G<P.animations.length;G++){var ee=P.animations[G],$=w.a.GetClass("BABYLON.Animation");$&&z.animations.push($.Parse(ee))}},z=m.a.Parse(function(){var X,G=!0;if(P.noMipmap&&(G=!1),P.mirrorPlane){var ee=C._CreateMirror(P.name,P.renderTargetSize,F,G);return ee._waitingRenderList=P.renderList,ee.mirrorPlane=R.a.FromArray(P.mirrorPlane),L(),ee}if(P.isRenderTarget){var $=null;if(P.isCube){if(F.reflectionProbes)for(var fe=0;fe<F.reflectionProbes.length;fe++){var me=F.reflectionProbes[fe];if(me.name===P.name)return me.cubeTexture}}else($=C._CreateRenderTargetTexture(P.name,P.renderTargetSize,F,G))._waitingRenderList=P.renderList;return L(),$}if(P.base64String)X=C.CreateFromBase64String(P.base64String,P.name,F,!G,P.invertY,void 0,L);else{var ve=void 0;ve=P.name&&P.name.indexOf("://")>0?P.name:U+P.name,(I.a.StartsWith(P.url,"data:")||C.UseSerializedUrlIfAny&&P.url)&&(ve=P.url),X=new C(ve,F,!G,P.invertY,void 0,L)}return X},P,F);return z},C.CreateFromBase64String=function(P,F,U,B,L,z,X,G,ee){return z===void 0&&(z=C.TRILINEAR_SAMPLINGMODE),X===void 0&&(X=null),G===void 0&&(G=null),ee===void 0&&(ee=M.a.TEXTUREFORMAT_RGBA),new C("data:"+F,U,B,L,z,X,G,P,!1,ee)},C.LoadFromDataString=function(P,F,U,B,L,z,X,G,ee,$){return B===void 0&&(B=!1),L===void 0&&(L=!1),z===void 0&&(z=!0),X===void 0&&(X=C.TRILINEAR_SAMPLINGMODE),G===void 0&&(G=null),ee===void 0&&(ee=null),$===void 0&&($=M.a.TEXTUREFORMAT_RGBA),P.substr(0,5)!=="data:"&&(P="data:"+P),new C(P,U,L,z,X,G,ee,F,B,$)},C.SerializeBuffers=!0,C.ForceSerializeBuffers=!1,C._CubeTextureParser=function(P,F,U){throw S.a.WarnImport("CubeTexture")},C._CreateMirror=function(P,F,U,B){throw S.a.WarnImport("MirrorTexture")},C._CreateRenderTargetTexture=function(P,F,U,B){throw S.a.WarnImport("RenderTargetTexture")},C.NEAREST_SAMPLINGMODE=M.a.TEXTURE_NEAREST_SAMPLINGMODE,C.NEAREST_NEAREST_MIPLINEAR=M.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,C.BILINEAR_SAMPLINGMODE=M.a.TEXTURE_BILINEAR_SAMPLINGMODE,C.LINEAR_LINEAR_MIPNEAREST=M.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,C.TRILINEAR_SAMPLINGMODE=M.a.TEXTURE_TRILINEAR_SAMPLINGMODE,C.LINEAR_LINEAR_MIPLINEAR=M.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,C.NEAREST_NEAREST_MIPNEAREST=M.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,C.NEAREST_LINEAR_MIPNEAREST=M.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,C.NEAREST_LINEAR_MIPLINEAR=M.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,C.NEAREST_LINEAR=M.a.TEXTURE_NEAREST_LINEAR,C.NEAREST_NEAREST=M.a.TEXTURE_NEAREST_NEAREST,C.LINEAR_NEAREST_MIPNEAREST=M.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,C.LINEAR_NEAREST_MIPLINEAR=M.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,C.LINEAR_LINEAR=M.a.TEXTURE_LINEAR_LINEAR,C.LINEAR_NEAREST=M.a.TEXTURE_LINEAR_NEAREST,C.EXPLICIT_MODE=M.a.TEXTURE_EXPLICIT_MODE,C.SPHERICAL_MODE=M.a.TEXTURE_SPHERICAL_MODE,C.PLANAR_MODE=M.a.TEXTURE_PLANAR_MODE,C.CUBIC_MODE=M.a.TEXTURE_CUBIC_MODE,C.PROJECTION_MODE=M.a.TEXTURE_PROJECTION_MODE,C.SKYBOX_MODE=M.a.TEXTURE_SKYBOX_MODE,C.INVCUBIC_MODE=M.a.TEXTURE_INVCUBIC_MODE,C.EQUIRECTANGULAR_MODE=M.a.TEXTURE_EQUIRECTANGULAR_MODE,C.FIXED_EQUIRECTANGULAR_MODE=M.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,C.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=M.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,C.CLAMP_ADDRESSMODE=M.a.TEXTURE_CLAMP_ADDRESSMODE,C.WRAP_ADDRESSMODE=M.a.TEXTURE_WRAP_ADDRESSMODE,C.MIRROR_ADDRESSMODE=M.a.TEXTURE_MIRROR_ADDRESSMODE,C.UseSerializedUrlIfAny=!1,Object(T.c)([Object(m.c)()],C.prototype,"url",void 0),Object(T.c)([Object(m.c)()],C.prototype,"uOffset",void 0),Object(T.c)([Object(m.c)()],C.prototype,"vOffset",void 0),Object(T.c)([Object(m.c)()],C.prototype,"uScale",void 0),Object(T.c)([Object(m.c)()],C.prototype,"vScale",void 0),Object(T.c)([Object(m.c)()],C.prototype,"uAng",void 0),Object(T.c)([Object(m.c)()],C.prototype,"vAng",void 0),Object(T.c)([Object(m.c)()],C.prototype,"wAng",void 0),Object(T.c)([Object(m.c)()],C.prototype,"uRotationCenter",void 0),Object(T.c)([Object(m.c)()],C.prototype,"vRotationCenter",void 0),Object(T.c)([Object(m.c)()],C.prototype,"wRotationCenter",void 0),Object(T.c)([Object(m.c)()],C.prototype,"homogeneousRotationInUVTransform",void 0),Object(T.c)([Object(m.c)()],C.prototype,"isBlocking",null),C}(x.a);w.a.RegisteredTypes["BABYLON.Texture"]=p,m.a._TextureParser=p.Parse},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.GetClass=function(E){return this.RegisteredTypes&&this.RegisteredTypes[E]?this.RegisteredTypes[E]:null},m.RegisteredTypes={},m}()},function(f,s,c){c.d(s,"b",function(){return p}),c.d(s,"c",function(){return g}),c.d(s,"a",function(){return C});var T=c(6),m=c(38),E=c(8),d=c(41),x=c(57),M=c(21),w=c(49),S=c(22),_=c(56),O=c(145),R=c(104),I=c(122),y=c(120),p=function(){function P(){}return Object.defineProperty(P,"BaseUrl",{get:function(){return _.a.BaseUrl},set:function(F){_.a.BaseUrl=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"DefaultRetryStrategy",{get:function(){return _.a.DefaultRetryStrategy},set:function(F){_.a.DefaultRetryStrategy=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"CorsBehavior",{get:function(){return _.a.CorsBehavior},set:function(F){_.a.CorsBehavior=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"UseFallbackTexture",{get:function(){return S.a.UseFallbackTexture},set:function(F){S.a.UseFallbackTexture=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"RegisteredExternalClasses",{get:function(){return I.a.RegisteredExternalClasses},set:function(F){I.a.RegisteredExternalClasses=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"fallbackTexture",{get:function(){return S.a.FallbackTexture},set:function(F){S.a.FallbackTexture=F},enumerable:!1,configurable:!0}),P.FetchToRef=function(F,U,B,L,z,X){var G=4*((Math.abs(F)*B%B|0)+(Math.abs(U)*L%L|0)*B);X.r=z[G]/255,X.g=z[G+1]/255,X.b=z[G+2]/255,X.a=z[G+3]/255},P.Mix=function(F,U,B){return F*(1-B)+U*B},P.Instantiate=function(F){return I.a.Instantiate(F)},P.Slice=function(F,U,B){return F.slice?F.slice(U,B):Array.prototype.slice.call(F,U,B)},P.SliceToArray=function(F,U,B){return Array.isArray(F)?F.slice(U,B):Array.prototype.slice.call(F,U,B)},P.SetImmediate=function(F){R.a.SetImmediate(F)},P.IsExponentOfTwo=function(F){var U=1;do U*=2;while(U<F);return U===F},P.FloatRound=function(F){return Math.fround?Math.fround(F):P._tmpFloatArray[0]=F},P.GetFilename=function(F){var U=F.lastIndexOf("/");return U<0?F:F.substring(U+1)},P.GetFolderPath=function(F,U){U===void 0&&(U=!1);var B=F.lastIndexOf("/");return B<0?U?F:"":F.substring(0,B+1)},P.ToDegrees=function(F){return 180*F/Math.PI},P.ToRadians=function(F){return F*Math.PI/180},P.MakeArray=function(F,U){return U===!0||F!==void 0&&F!=null?Array.isArray(F)?F:[F]:null},P.GetPointerPrefix=function(F){var U="pointer";return m.a.IsWindowObjectExist()&&!window.PointerEvent&&m.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(U="mouse"),!F._badDesktopOS||F._badOS||document&&"ontouchend"in document||(U="mouse"),U},P.SetCorsBehavior=function(F,U){_.a.SetCorsBehavior(F,U)},P.CleanUrl=function(F){return F=F.replace(/#/gm,"%23")},Object.defineProperty(P,"PreprocessUrl",{get:function(){return _.a.PreprocessUrl},set:function(F){_.a.PreprocessUrl=F},enumerable:!1,configurable:!0}),P.LoadImage=function(F,U,B,L,z){return _.a.LoadImage(F,U,B,L,z)},P.LoadFile=function(F,U,B,L,z,X){return _.a.LoadFile(F,U,B,L,z,X)},P.LoadFileAsync=function(F,U){return U===void 0&&(U=!0),new Promise(function(B,L){_.a.LoadFile(F,function(z){B(z)},void 0,void 0,U,function(z,X){L(X)})})},P.LoadScript=function(F,U,B,L){if(m.a.IsWindowObjectExist()){var z=document.getElementsByTagName("head")[0],X=document.createElement("script");X.setAttribute("type","text/javascript"),X.setAttribute("src",F),L&&(X.id=L),X.onload=function(){U&&U()},X.onerror=function(G){B&&B("Unable to load script '"+F+"'",G)},z.appendChild(X)}},P.LoadScriptAsync=function(F,U){var B=this;return new Promise(function(L,z){B.LoadScript(F,function(){L()},function(X,G){z(G)})})},P.ReadFileAsDataURL=function(F,U,B){var L=new FileReader,z={onCompleteObservable:new T.c,abort:function(){return L.abort()}};return L.onloadend=function(X){z.onCompleteObservable.notifyObservers(z)},L.onload=function(X){U(X.target.result)},L.onprogress=B,L.readAsDataURL(F),z},P.ReadFile=function(F,U,B,L,z){return _.a.ReadFile(F,U,B,L,z)},P.FileAsURL=function(F){var U=new Blob([F]);return(window.URL||window.webkitURL).createObjectURL(U)},P.Format=function(F,U){return U===void 0&&(U=2),F.toFixed(U)},P.DeepCopy=function(F,U,B,L){d.a.DeepCopy(F,U,B,L)},P.IsEmpty=function(F){for(var U in F)if(F.hasOwnProperty(U))return!1;return!0},P.RegisterTopRootEvents=function(F,U){for(var B=0;B<U.length;B++){var L=U[B];F.addEventListener(L.name,L.handler,!1);try{window.parent&&window.parent.addEventListener(L.name,L.handler,!1)}catch(z){}}},P.UnregisterTopRootEvents=function(F,U){for(var B=0;B<U.length;B++){var L=U[B];F.removeEventListener(L.name,L.handler);try{F.parent&&F.parent.removeEventListener(L.name,L.handler)}catch(z){}}},P.DumpFramebuffer=function(F,U,B,L,z,X){z===void 0&&(z="image/png");for(var G=4*F,ee=U/2,$=B.readPixels(0,0,F,U),fe=0;fe<ee;fe++)for(var me=0;me<G;me++){var ve=me+fe*G,be=me+(U-fe-1)*G,ie=$[ve];$[ve]=$[be],$[be]=ie}P._ScreenshotCanvas||(P._ScreenshotCanvas=document.createElement("canvas")),P._ScreenshotCanvas.width=F,P._ScreenshotCanvas.height=U;var se=P._ScreenshotCanvas.getContext("2d");if(se){var V=se.createImageData(F,U);V.data.set($),se.putImageData(V,0,0),P.EncodeScreenshotCanvasData(L,z,X)}},P.ToBlob=function(F,U,B){B===void 0&&(B="image/png"),F.toBlob||(F.toBlob=function(L,z,X){var G=this;setTimeout(function(){for(var ee=atob(G.toDataURL(z,X).split(",")[1]),$=ee.length,fe=new Uint8Array($),me=0;me<$;me++)fe[me]=ee.charCodeAt(me);L(new Blob([fe]))})}),F.toBlob(function(L){U(L)},B)},P.EncodeScreenshotCanvasData=function(F,U,B){U===void 0&&(U="image/png"),F?F(P._ScreenshotCanvas.toDataURL(U)):this.ToBlob(P._ScreenshotCanvas,function(L){if("download"in document.createElement("a")){if(!B){var z=new Date,X=(z.getFullYear()+"-"+(z.getMonth()+1)).slice(2)+"-"+z.getDate()+"_"+z.getHours()+"-"+("0"+z.getMinutes()).slice(-2);B="screenshot_"+X+".png"}P.Download(L,B)}else{var G=URL.createObjectURL(L),ee=window.open("");if(!ee)return;var $=ee.document.createElement("img");$.onload=function(){URL.revokeObjectURL(G)},$.src=G,ee.document.body.appendChild($)}},U)},P.Download=function(F,U){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(F,U);else{var B=window.URL.createObjectURL(F),L=document.createElement("a");document.body.appendChild(L),L.style.display="none",L.href=B,L.download=U,L.addEventListener("click",function(){L.parentElement&&L.parentElement.removeChild(L)}),L.click(),window.URL.revokeObjectURL(B)}},P.BackCompatCameraNoPreventDefault=function(F){return typeof F[0]=="boolean"?F[0]:typeof F[1]=="boolean"&&F[1]},P.CreateScreenshot=function(F,U,B,L,z){throw M.a.WarnImport("ScreenshotTools")},P.CreateScreenshotAsync=function(F,U,B,L){throw M.a.WarnImport("ScreenshotTools")},P.CreateScreenshotUsingRenderTarget=function(F,U,B,L,z,X,G,ee){throw M.a.WarnImport("ScreenshotTools")},P.CreateScreenshotUsingRenderTargetAsync=function(F,U,B,L,z,X,G){throw M.a.WarnImport("ScreenshotTools")},P.RandomId=function(){return y.a.RandomId()},P.IsBase64=function(F){return!(F.length<5)&&F.substr(0,5)==="data:"},P.DecodeBase64=function(F){for(var U=atob(F.split(",")[1]),B=U.length,L=new Uint8Array(new ArrayBuffer(B)),z=0;z<B;z++)L[z]=U.charCodeAt(z);return L.buffer},P.GetAbsoluteUrl=function(F){var U=document.createElement("a");return U.href=F,U.href},Object.defineProperty(P,"errorsCount",{get:function(){return E.a.errorsCount},enumerable:!1,configurable:!0}),P.Log=function(F){E.a.Log(F)},P.Warn=function(F){E.a.Warn(F)},P.Error=function(F){E.a.Error(F)},Object.defineProperty(P,"LogCache",{get:function(){return E.a.LogCache},enumerable:!1,configurable:!0}),P.ClearLogCache=function(){E.a.ClearLogCache()},Object.defineProperty(P,"LogLevels",{set:function(F){E.a.LogLevels=F},enumerable:!1,configurable:!0}),Object.defineProperty(P,"PerformanceLogLevel",{set:function(F){return(F&P.PerformanceUserMarkLogLevel)===P.PerformanceUserMarkLogLevel?(P.StartPerformanceCounter=P._StartUserMark,void(P.EndPerformanceCounter=P._EndUserMark)):(F&P.PerformanceConsoleLogLevel)===P.PerformanceConsoleLogLevel?(P.StartPerformanceCounter=P._StartPerformanceConsole,void(P.EndPerformanceCounter=P._EndPerformanceConsole)):(P.StartPerformanceCounter=P._StartPerformanceCounterDisabled,void(P.EndPerformanceCounter=P._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),P._StartPerformanceCounterDisabled=function(F,U){},P._EndPerformanceCounterDisabled=function(F,U){},P._StartUserMark=function(F,U){if(U===void 0&&(U=!0),!P._performance){if(!m.a.IsWindowObjectExist())return;P._performance=window.performance}U&&P._performance.mark&&P._performance.mark(F+"-Begin")},P._EndUserMark=function(F,U){U===void 0&&(U=!0),U&&P._performance.mark&&(P._performance.mark(F+"-End"),P._performance.measure(F,F+"-Begin",F+"-End"))},P._StartPerformanceConsole=function(F,U){U===void 0&&(U=!0),U&&(P._StartUserMark(F,U),console.time&&console.time(F))},P._EndPerformanceConsole=function(F,U){U===void 0&&(U=!0),U&&(P._EndUserMark(F,U),console.timeEnd(F))},Object.defineProperty(P,"Now",{get:function(){return x.a.Now},enumerable:!1,configurable:!0}),P.GetClassName=function(F,U){U===void 0&&(U=!1);var B=null;return!U&&F.getClassName?B=F.getClassName():(F instanceof Object&&(B=(U?F:Object.getPrototypeOf(F)).constructor.__bjsclassName__),B||(B=typeof F)),B},P.First=function(F,U){for(var B=0,L=F;B<L.length;B++){var z=L[B];if(U(z))return z}return null},P.getFullClassName=function(F,U){U===void 0&&(U=!1);var B=null,L=null;if(!U&&F.getClassName)B=F.getClassName();else{if(F instanceof Object){var z=U?F:Object.getPrototypeOf(F);B=z.constructor.__bjsclassName__,L=z.constructor.__bjsmoduleName__}B||(B=typeof F)}return B?(L!=null?L+".":"")+B:null},P.DelayAsync=function(F){return new Promise(function(U){setTimeout(function(){U()},F)})},P.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},P.UseCustomRequestHeaders=!1,P.CustomRequestHeaders=w.a.CustomRequestHeaders,P._tmpFloatArray=new Float32Array(1),P.GetDOMTextContent=m.a.GetDOMTextContent,P.NoneLogLevel=E.a.NoneLogLevel,P.MessageLogLevel=E.a.MessageLogLevel,P.WarningLogLevel=E.a.WarningLogLevel,P.ErrorLogLevel=E.a.ErrorLogLevel,P.AllLogLevel=E.a.AllLogLevel,P.IsWindowObjectExist=m.a.IsWindowObjectExist,P.PerformanceNoneLogLevel=0,P.PerformanceUserMarkLogLevel=1,P.PerformanceConsoleLogLevel=2,P.StartPerformanceCounter=P._StartPerformanceCounterDisabled,P.EndPerformanceCounter=P._EndPerformanceCounterDisabled,P}();function g(P,F){return function(U){U.__bjsclassName__=P,U.__bjsmoduleName__=F??null}}var C=function(){function P(F,U,B,L){L===void 0&&(L=0),this.iterations=F,this.index=L-1,this._done=!1,this._fn=U,this._successCallback=B}return P.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},P.prototype.breakLoop=function(){this._done=!0,this._successCallback()},P.Run=function(F,U,B,L){L===void 0&&(L=0);var z=new P(F,U,B,L);return z.executeNext(),z},P.SyncAsyncForLoop=function(F,U,B,L,z,X){return X===void 0&&(X=0),P.Run(Math.ceil(F/U),function(G){z&&z()?G.breakLoop():setTimeout(function(){for(var ee=0;ee<U;++ee){var $=G.index*U+ee;if($>=F)break;if(B($),z&&z()){G.breakLoop();break}}G.executeNext()},X)},L)},P}();S.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",O.a.Apply()},function(f,s,c){c.d(s,"a",function(){return I});var T=c(1),m=c(6),E=c(38),d=c(22),x=c(21),M=c(26),w=c(2),S=c(146),_=c(55),O=c(88),R=c(8),I=(c(123),c(129),c(124),function(y){function p(g,C,P,F){F===void 0&&(F=!1);var U=y.call(this,g,C,P,F)||this;if(U.enableOfflineSupport=!1,U.disableManifestCheck=!1,U.scenes=new Array,U.onNewSceneAddedObservable=new m.c,U.postProcesses=new Array,U.isPointerLock=!1,U.onResizeObservable=new m.c,U.onCanvasBlurObservable=new m.c,U.onCanvasFocusObservable=new m.c,U.onCanvasPointerOutObservable=new m.c,U.onBeginFrameObservable=new m.c,U.customAnimationFrameRequester=null,U.onEndFrameObservable=new m.c,U.onBeforeShaderCompilationObservable=new m.c,U.onAfterShaderCompilationObservable=new m.c,U._deterministicLockstep=!1,U._lockstepMaxSteps=4,U._timeStep=1/60,U._fps=60,U._deltaTime=0,U._drawCalls=new _.a,U.canvasTabIndex=1,U.disablePerformanceMonitorInBackground=!1,U._performanceMonitor=new S.a,p.Instances.push(U),!g)return U;if(P=U._creationOptions,g.getContext){var B=g;if(U._onCanvasFocus=function(){U.onCanvasFocusObservable.notifyObservers(U)},U._onCanvasBlur=function(){U.onCanvasBlurObservable.notifyObservers(U)},B.addEventListener("focus",U._onCanvasFocus),B.addEventListener("blur",U._onCanvasBlur),U._onBlur=function(){U.disablePerformanceMonitorInBackground&&U._performanceMonitor.disable(),U._windowIsBackground=!0},U._onFocus=function(){U.disablePerformanceMonitorInBackground&&U._performanceMonitor.enable(),U._windowIsBackground=!1},U._onCanvasPointerOut=function(X){U.onCanvasPointerOutObservable.notifyObservers(X)},B.addEventListener("pointerout",U._onCanvasPointerOut),E.a.IsWindowObjectExist()){var L=U.getHostWindow();L.addEventListener("blur",U._onBlur),L.addEventListener("focus",U._onFocus);var z=document;U._onFullscreenChange=function(){z.fullscreen!==void 0?U.isFullscreen=z.fullscreen:z.mozFullScreen!==void 0?U.isFullscreen=z.mozFullScreen:z.webkitIsFullScreen!==void 0?U.isFullscreen=z.webkitIsFullScreen:z.msIsFullScreen!==void 0&&(U.isFullscreen=z.msIsFullScreen),U.isFullscreen&&U._pointerLockRequested&&B&&p._RequestPointerlock(B)},document.addEventListener("fullscreenchange",U._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",U._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",U._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",U._onFullscreenChange,!1),U._onPointerLockChange=function(){U.isPointerLock=z.mozPointerLockElement===B||z.webkitPointerLockElement===B||z.msPointerLockElement===B||z.pointerLockElement===B},document.addEventListener("pointerlockchange",U._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",U._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",U._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",U._onPointerLockChange,!1),!p.audioEngine&&P.audioEngine&&p.AudioEngineFactory&&(p.audioEngine=p.AudioEngineFactory(U.getRenderingCanvas()))}U._connectVREvents(),U.enableOfflineSupport=p.OfflineProviderFactory!==void 0,P.doNotHandleTouchAction||U._disableTouchAction(),U._deterministicLockstep=!!P.deterministicLockstep,U._lockstepMaxSteps=P.lockstepMaxSteps||0,U._timeStep=P.timeStep||1/60}return U._prepareVRComponent(),P.autoEnableWebVR&&U.initWebVR(),U}return Object(T.d)(p,y),Object.defineProperty(p,"NpmPackage",{get:function(){return M.a.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(p,"Version",{get:function(){return M.a.Version},enumerable:!1,configurable:!0}),Object.defineProperty(p,"Instances",{get:function(){return d.a.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(p,"LastCreatedEngine",{get:function(){return d.a.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(p,"LastCreatedScene",{get:function(){return d.a.LastCreatedScene},enumerable:!1,configurable:!0}),p.MarkAllMaterialsAsDirty=function(g,C){for(var P=0;P<p.Instances.length;P++)for(var F=p.Instances[P],U=0;U<F.scenes.length;U++)F.scenes[U].markAllMaterialsAsDirty(g,C)},p.DefaultLoadingScreenFactory=function(g){throw x.a.WarnImport("LoadingScreen")},Object.defineProperty(p.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!p._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),p.prototype.getInputElement=function(){return this._renderingCanvas},p.prototype.getAspectRatio=function(g,C){C===void 0&&(C=!1);var P=g.viewport;return this.getRenderWidth(C)*P.width/(this.getRenderHeight(C)*P.height)},p.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},p.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},p.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},p.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},p.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},p.prototype.getTimeStep=function(){return 1e3*this._timeStep},p.prototype.generateMipMapsForCubemap=function(g,C){if(C===void 0&&(C=!0),g.generateMipMaps){var P=this._gl;this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,g,!0),P.generateMipmap(P.TEXTURE_CUBE_MAP),C&&this._bindTextureDirectly(P.TEXTURE_CUBE_MAP,null)}},p.prototype.setState=function(g,C,P,F){C===void 0&&(C=0),F===void 0&&(F=!1),(this._depthCullingState.cull!==g||P)&&(this._depthCullingState.cull=g);var U=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==U||P)&&(this._depthCullingState.cullFace=U),this.setZOffset(C);var B=F?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==B||P)&&(this._depthCullingState.frontFace=B)},p.prototype.setZOffset=function(g){this._depthCullingState.zOffset=g},p.prototype.getZOffset=function(){return this._depthCullingState.zOffset},p.prototype.setDepthBuffer=function(g){this._depthCullingState.depthTest=g},p.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},p.prototype.setDepthWrite=function(g){this._depthCullingState.depthMask=g},p.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},p.prototype.setStencilBuffer=function(g){this._stencilState.stencilTest=g},p.prototype.getStencilMask=function(){return this._stencilState.stencilMask},p.prototype.setStencilMask=function(g){this._stencilState.stencilMask=g},p.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},p.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},p.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},p.prototype.setStencilFunction=function(g){this._stencilState.stencilFunc=g},p.prototype.setStencilFunctionReference=function(g){this._stencilState.stencilFuncRef=g},p.prototype.setStencilFunctionMask=function(g){this._stencilState.stencilFuncMask=g},p.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},p.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},p.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},p.prototype.setStencilOperationFail=function(g){this._stencilState.stencilOpStencilFail=g},p.prototype.setStencilOperationDepthFail=function(g){this._stencilState.stencilOpDepthFail=g},p.prototype.setStencilOperationPass=function(g){this._stencilState.stencilOpStencilDepthPass=g},p.prototype.setDitheringState=function(g){g?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},p.prototype.setRasterizerState=function(g){g?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},p.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},p.prototype.setDepthFunction=function(g){this._depthCullingState.depthFunc=g},p.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},p.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},p.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},p.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},p.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},p.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},p.prototype.setDirectViewport=function(g,C,P,F){var U=this._cachedViewport;return this._cachedViewport=null,this._viewport(g,C,P,F),U},p.prototype.scissorClear=function(g,C,P,F,U){this.enableScissor(g,C,P,F),this.clear(U,!0,!0,!0),this.disableScissor()},p.prototype.enableScissor=function(g,C,P,F){var U=this._gl;U.enable(U.SCISSOR_TEST),U.scissor(g,C,P,F)},p.prototype.disableScissor=function(){var g=this._gl;g.disable(g.SCISSOR_TEST)},p.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},p.prototype.initWebVR=function(){throw x.a.WarnImport("WebVRCamera")},p.prototype._prepareVRComponent=function(){},p.prototype._connectVREvents=function(g,C){},p.prototype._submitVRFrame=function(){},p.prototype.disableVR=function(){},p.prototype.isVRPresenting=function(){return!1},p.prototype._requestVRFrame=function(){},p.prototype._loadFileAsync=function(g,C,P){var F=this;return new Promise(function(U,B){F._loadFile(g,function(L){U(L)},void 0,C,P,function(L,z){B(z)})})},p.prototype.getVertexShaderSource=function(g){var C=this._gl.getAttachedShaders(g);return C?this._gl.getShaderSource(C[0]):null},p.prototype.getFragmentShaderSource=function(g){var C=this._gl.getAttachedShaders(g);return C?this._gl.getShaderSource(C[1]):null},p.prototype.setDepthStencilTexture=function(g,C,P){g!==void 0&&(C&&(this._boundUniforms[g]=C),P&&P.depthStencilTexture?this._setTexture(g,P,!1,!0):this._setTexture(g,null))},p.prototype.setTextureFromPostProcess=function(g,C){this._bindTexture(g,C?C._textures.data[C._currentRenderTextureInd]:null)},p.prototype.setTextureFromPostProcessOutput=function(g,C){this._bindTexture(g,C?C._outputTexture:null)},p.prototype._rebuildBuffers=function(){for(var g=0,C=this.scenes;g<C.length;g++){var P=C[g];P.resetCachedMaterial(),P._rebuildGeometries(),P._rebuildTextures()}y.prototype._rebuildBuffers.call(this)},p.prototype._renderFrame=function(){for(var g=0;g<this._activeRenderLoops.length;g++)(0,this._activeRenderLoops[g])()},p.prototype._renderLoop=function(){if(!this._contextWasLost){var g=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(g=!1),g&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},p.prototype._renderViews=function(){return!1},p.prototype.switchFullscreen=function(g){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(g)},p.prototype.enterFullscreen=function(g){this.isFullscreen||(this._pointerLockRequested=g,this._renderingCanvas&&p._RequestFullscreen(this._renderingCanvas))},p.prototype.exitFullscreen=function(){this.isFullscreen&&p._ExitFullscreen()},p.prototype.enterPointerlock=function(){this._renderingCanvas&&p._RequestPointerlock(this._renderingCanvas)},p.prototype.exitPointerlock=function(){p._ExitPointerlock()},p.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),y.prototype.beginFrame.call(this)},p.prototype.endFrame=function(){y.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},p.prototype.resize=function(){this.isVRPresenting()||y.prototype.resize.call(this)},p.prototype.setSize=function(g,C){if(!this._renderingCanvas||!y.prototype.setSize.call(this,g,C))return!1;if(this.scenes){for(var P=0;P<this.scenes.length;P++)for(var F=this.scenes[P],U=0;U<F.cameras.length;U++)F.cameras[U]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},p.prototype._deletePipelineContext=function(g){var C=g;C&&C.program&&C.transformFeedback&&(this.deleteTransformFeedback(C.transformFeedback),C.transformFeedback=null),y.prototype._deletePipelineContext.call(this,g)},p.prototype.createShaderProgram=function(g,C,P,F,U,B){B===void 0&&(B=null),U=U||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var L=y.prototype.createShaderProgram.call(this,g,C,P,F,U,B);return this.onAfterShaderCompilationObservable.notifyObservers(this),L},p.prototype._createShaderProgram=function(g,C,P,F,U){U===void 0&&(U=null);var B=F.createProgram();if(g.program=B,!B)throw new Error("Unable to create program");if(F.attachShader(B,C),F.attachShader(B,P),this.webGLVersion>1&&U){var L=this.createTransformFeedback();this.bindTransformFeedback(L),this.setTranformFeedbackVaryings(B,U),g.transformFeedback=L}return F.linkProgram(B),this.webGLVersion>1&&U&&this.bindTransformFeedback(null),g.context=F,g.vertexShader=C,g.fragmentShader=P,g.isParallelCompiled||this._finalizePipelineContext(g),B},p.prototype._releaseTexture=function(g){y.prototype._releaseTexture.call(this,g),this.scenes.forEach(function(C){C.postProcesses.forEach(function(P){P._outputTexture==g&&(P._outputTexture=null)}),C.cameras.forEach(function(P){P._postProcesses.forEach(function(F){F&&F._outputTexture==g&&(F._outputTexture=null)})})})},p.prototype._rescaleTexture=function(g,C,P,F,U){var B=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var L=this.createRenderTargetTexture({width:C.width,height:C.height},{generateMipMaps:!1,type:w.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:w.a.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&p._RescalePostProcessFactory&&(this._rescalePostProcess=p._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){B._rescalePostProcess.onApply=function(X){X._bindTexture("textureSampler",g)};var z=P;z||(z=B.scenes[B.scenes.length-1]),z.postProcessManager.directRender([B._rescalePostProcess],L,!0),B._bindTextureDirectly(B._gl.TEXTURE_2D,C,!0),B._gl.copyTexImage2D(B._gl.TEXTURE_2D,0,F,0,0,C.width,C.height,0),B.unBindFramebuffer(L),B._releaseTexture(L),U&&U()})},p.prototype.getFps=function(){return this._fps},p.prototype.getDeltaTime=function(){return this._deltaTime},p.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},p.prototype._uploadImageToTexture=function(g,C,P,F){P===void 0&&(P=0),F===void 0&&(F=0);var U=this._gl,B=this._getWebGLTextureType(g.type),L=this._getInternalFormat(g.format),z=this._getRGBABufferInternalSizedFormat(g.type,L),X=g.isCube?U.TEXTURE_CUBE_MAP:U.TEXTURE_2D;this._bindTextureDirectly(X,g,!0),this._unpackFlipY(g.invertY);var G=U.TEXTURE_2D;g.isCube&&(G=U.TEXTURE_CUBE_MAP_POSITIVE_X+P),U.texImage2D(G,F,z,L,B,C),this._bindTextureDirectly(X,null,!0)},p.prototype.updateRenderTargetTextureSampleCount=function(g,C){if(this.webGLVersion<2||!g)return 1;if(g.samples===C)return C;var P=this._gl;if(C=Math.min(C,this.getCaps().maxMSAASamples),g._depthStencilBuffer&&(P.deleteRenderbuffer(g._depthStencilBuffer),g._depthStencilBuffer=null),g._MSAAFramebuffer&&(P.deleteFramebuffer(g._MSAAFramebuffer),g._MSAAFramebuffer=null),g._MSAARenderBuffer&&(P.deleteRenderbuffer(g._MSAARenderBuffer),g._MSAARenderBuffer=null),C>1&&P.renderbufferStorageMultisample){var F=P.createFramebuffer();if(!F)throw new Error("Unable to create multi sampled framebuffer");g._MSAAFramebuffer=F,this._bindUnboundFramebuffer(g._MSAAFramebuffer);var U=P.createRenderbuffer();if(!U)throw new Error("Unable to create multi sampled framebuffer");P.bindRenderbuffer(P.RENDERBUFFER,U),P.renderbufferStorageMultisample(P.RENDERBUFFER,C,this._getRGBAMultiSampleBufferFormat(g.type),g.width,g.height),P.framebufferRenderbuffer(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.RENDERBUFFER,U),g._MSAARenderBuffer=U}else this._bindUnboundFramebuffer(g._framebuffer);return g.samples=C,g._depthStencilBuffer=this._setupFramebufferDepthAttachments(g._generateStencilBuffer,g._generateDepthBuffer,g.width,g.height,C),this._bindUnboundFramebuffer(null),C},p.prototype.updateTextureComparisonFunction=function(g,C){if(this.webGLVersion!==1){var P=this._gl;g.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,g,!0),C===0?(P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_COMPARE_FUNC,w.a.LEQUAL),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_COMPARE_MODE,P.NONE)):(P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_COMPARE_FUNC,C),P.texParameteri(P.TEXTURE_CUBE_MAP,P.TEXTURE_COMPARE_MODE,P.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,g,!0),C===0?(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_COMPARE_FUNC,w.a.LEQUAL),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_COMPARE_MODE,P.NONE)):(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_COMPARE_FUNC,C),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_COMPARE_MODE,P.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),g._comparisonFunction=C}else R.a.Error("WebGL 1 does not support texture comparison.")},p.prototype.createInstancesBuffer=function(g){var C=this._gl.createBuffer();if(!C)throw new Error("Unable to create instance buffer");var P=new O.a(C);return P.capacity=g,this.bindArrayBuffer(P),this._gl.bufferData(this._gl.ARRAY_BUFFER,g,this._gl.DYNAMIC_DRAW),P},p.prototype.deleteInstancesBuffer=function(g){this._gl.deleteBuffer(g)},p.prototype._clientWaitAsync=function(g,C,P){C===void 0&&(C=0),P===void 0&&(P=10);var F=this._gl;return new Promise(function(U,B){var L=function(){var z=F.clientWaitSync(g,C,0);z!=F.WAIT_FAILED?z!=F.TIMEOUT_EXPIRED?U():setTimeout(L,P):B()};L()})},p.prototype._readPixelsAsync=function(g,C,P,F,U,B,L){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var z=this._gl,X=z.createBuffer();z.bindBuffer(z.PIXEL_PACK_BUFFER,X),z.bufferData(z.PIXEL_PACK_BUFFER,L.byteLength,z.STREAM_READ),z.readPixels(g,C,P,F,U,B,0),z.bindBuffer(z.PIXEL_PACK_BUFFER,null);var G=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);return G?(z.flush(),this._clientWaitAsync(G,0,10).then(function(){return z.deleteSync(G),z.bindBuffer(z.PIXEL_PACK_BUFFER,X),z.getBufferSubData(z.PIXEL_PACK_BUFFER,0,L),z.bindBuffer(z.PIXEL_PACK_BUFFER,null),z.deleteBuffer(X),L})):null},p.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();p.Instances.length===1&&p.audioEngine&&p.audioEngine.dispose(),this.disableVR(),E.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),E.a.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),y.prototype.dispose.call(this);var g=p.Instances.indexOf(this);g>=0&&p.Instances.splice(g,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},p.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},p.prototype.displayLoadingUI=function(){if(E.a.IsWindowObjectExist()){var g=this.loadingScreen;g&&g.displayLoadingUI()}},p.prototype.hideLoadingUI=function(){if(E.a.IsWindowObjectExist()){var g=this._loadingScreen;g&&g.hideLoadingUI()}},Object.defineProperty(p.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=p.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(g){this._loadingScreen=g},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"loadingUIText",{set:function(g){this.loadingScreen.loadingUIText=g},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"loadingUIBackgroundColor",{set:function(g){this.loadingScreen.loadingUIBackgroundColor=g},enumerable:!1,configurable:!0}),p._RequestPointerlock=function(g){g.requestPointerLock=g.requestPointerLock||g.msRequestPointerLock||g.mozRequestPointerLock||g.webkitRequestPointerLock,g.requestPointerLock&&g.requestPointerLock()},p._ExitPointerlock=function(){var g=document;document.exitPointerLock=document.exitPointerLock||g.msExitPointerLock||g.mozExitPointerLock||g.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},p._RequestFullscreen=function(g){var C=g.requestFullscreen||g.msRequestFullscreen||g.webkitRequestFullscreen||g.mozRequestFullScreen;C&&C.call(g)},p._ExitFullscreen=function(){var g=document;document.exitFullscreen?document.exitFullscreen():g.mozCancelFullScreen?g.mozCancelFullScreen():g.webkitCancelFullScreen?g.webkitCancelFullScreen():g.msCancelFullScreen&&g.msCancelFullScreen()},p.ALPHA_DISABLE=w.a.ALPHA_DISABLE,p.ALPHA_ADD=w.a.ALPHA_ADD,p.ALPHA_COMBINE=w.a.ALPHA_COMBINE,p.ALPHA_SUBTRACT=w.a.ALPHA_SUBTRACT,p.ALPHA_MULTIPLY=w.a.ALPHA_MULTIPLY,p.ALPHA_MAXIMIZED=w.a.ALPHA_MAXIMIZED,p.ALPHA_ONEONE=w.a.ALPHA_ONEONE,p.ALPHA_PREMULTIPLIED=w.a.ALPHA_PREMULTIPLIED,p.ALPHA_PREMULTIPLIED_PORTERDUFF=w.a.ALPHA_PREMULTIPLIED_PORTERDUFF,p.ALPHA_INTERPOLATE=w.a.ALPHA_INTERPOLATE,p.ALPHA_SCREENMODE=w.a.ALPHA_SCREENMODE,p.DELAYLOADSTATE_NONE=w.a.DELAYLOADSTATE_NONE,p.DELAYLOADSTATE_LOADED=w.a.DELAYLOADSTATE_LOADED,p.DELAYLOADSTATE_LOADING=w.a.DELAYLOADSTATE_LOADING,p.DELAYLOADSTATE_NOTLOADED=w.a.DELAYLOADSTATE_NOTLOADED,p.NEVER=w.a.NEVER,p.ALWAYS=w.a.ALWAYS,p.LESS=w.a.LESS,p.EQUAL=w.a.EQUAL,p.LEQUAL=w.a.LEQUAL,p.GREATER=w.a.GREATER,p.GEQUAL=w.a.GEQUAL,p.NOTEQUAL=w.a.NOTEQUAL,p.KEEP=w.a.KEEP,p.REPLACE=w.a.REPLACE,p.INCR=w.a.INCR,p.DECR=w.a.DECR,p.INVERT=w.a.INVERT,p.INCR_WRAP=w.a.INCR_WRAP,p.DECR_WRAP=w.a.DECR_WRAP,p.TEXTURE_CLAMP_ADDRESSMODE=w.a.TEXTURE_CLAMP_ADDRESSMODE,p.TEXTURE_WRAP_ADDRESSMODE=w.a.TEXTURE_WRAP_ADDRESSMODE,p.TEXTURE_MIRROR_ADDRESSMODE=w.a.TEXTURE_MIRROR_ADDRESSMODE,p.TEXTUREFORMAT_ALPHA=w.a.TEXTUREFORMAT_ALPHA,p.TEXTUREFORMAT_LUMINANCE=w.a.TEXTUREFORMAT_LUMINANCE,p.TEXTUREFORMAT_LUMINANCE_ALPHA=w.a.TEXTUREFORMAT_LUMINANCE_ALPHA,p.TEXTUREFORMAT_RGB=w.a.TEXTUREFORMAT_RGB,p.TEXTUREFORMAT_RGBA=w.a.TEXTUREFORMAT_RGBA,p.TEXTUREFORMAT_RED=w.a.TEXTUREFORMAT_RED,p.TEXTUREFORMAT_R=w.a.TEXTUREFORMAT_R,p.TEXTUREFORMAT_RG=w.a.TEXTUREFORMAT_RG,p.TEXTUREFORMAT_RED_INTEGER=w.a.TEXTUREFORMAT_RED_INTEGER,p.TEXTUREFORMAT_R_INTEGER=w.a.TEXTUREFORMAT_R_INTEGER,p.TEXTUREFORMAT_RG_INTEGER=w.a.TEXTUREFORMAT_RG_INTEGER,p.TEXTUREFORMAT_RGB_INTEGER=w.a.TEXTUREFORMAT_RGB_INTEGER,p.TEXTUREFORMAT_RGBA_INTEGER=w.a.TEXTUREFORMAT_RGBA_INTEGER,p.TEXTURETYPE_UNSIGNED_BYTE=w.a.TEXTURETYPE_UNSIGNED_BYTE,p.TEXTURETYPE_UNSIGNED_INT=w.a.TEXTURETYPE_UNSIGNED_INT,p.TEXTURETYPE_FLOAT=w.a.TEXTURETYPE_FLOAT,p.TEXTURETYPE_HALF_FLOAT=w.a.TEXTURETYPE_HALF_FLOAT,p.TEXTURETYPE_BYTE=w.a.TEXTURETYPE_BYTE,p.TEXTURETYPE_SHORT=w.a.TEXTURETYPE_SHORT,p.TEXTURETYPE_UNSIGNED_SHORT=w.a.TEXTURETYPE_UNSIGNED_SHORT,p.TEXTURETYPE_INT=w.a.TEXTURETYPE_INT,p.TEXTURETYPE_UNSIGNED_INTEGER=w.a.TEXTURETYPE_UNSIGNED_INTEGER,p.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=w.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,p.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=w.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,p.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=w.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,p.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=w.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,p.TEXTURETYPE_UNSIGNED_INT_24_8=w.a.TEXTURETYPE_UNSIGNED_INT_24_8,p.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=w.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,p.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=w.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,p.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=w.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,p.TEXTURE_NEAREST_SAMPLINGMODE=w.a.TEXTURE_NEAREST_SAMPLINGMODE,p.TEXTURE_BILINEAR_SAMPLINGMODE=w.a.TEXTURE_BILINEAR_SAMPLINGMODE,p.TEXTURE_TRILINEAR_SAMPLINGMODE=w.a.TEXTURE_TRILINEAR_SAMPLINGMODE,p.TEXTURE_NEAREST_NEAREST_MIPLINEAR=w.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,p.TEXTURE_LINEAR_LINEAR_MIPNEAREST=w.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,p.TEXTURE_LINEAR_LINEAR_MIPLINEAR=w.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,p.TEXTURE_NEAREST_NEAREST_MIPNEAREST=w.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,p.TEXTURE_NEAREST_LINEAR_MIPNEAREST=w.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,p.TEXTURE_NEAREST_LINEAR_MIPLINEAR=w.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,p.TEXTURE_NEAREST_LINEAR=w.a.TEXTURE_NEAREST_LINEAR,p.TEXTURE_NEAREST_NEAREST=w.a.TEXTURE_NEAREST_NEAREST,p.TEXTURE_LINEAR_NEAREST_MIPNEAREST=w.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,p.TEXTURE_LINEAR_NEAREST_MIPLINEAR=w.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,p.TEXTURE_LINEAR_LINEAR=w.a.TEXTURE_LINEAR_LINEAR,p.TEXTURE_LINEAR_NEAREST=w.a.TEXTURE_LINEAR_NEAREST,p.TEXTURE_EXPLICIT_MODE=w.a.TEXTURE_EXPLICIT_MODE,p.TEXTURE_SPHERICAL_MODE=w.a.TEXTURE_SPHERICAL_MODE,p.TEXTURE_PLANAR_MODE=w.a.TEXTURE_PLANAR_MODE,p.TEXTURE_CUBIC_MODE=w.a.TEXTURE_CUBIC_MODE,p.TEXTURE_PROJECTION_MODE=w.a.TEXTURE_PROJECTION_MODE,p.TEXTURE_SKYBOX_MODE=w.a.TEXTURE_SKYBOX_MODE,p.TEXTURE_INVCUBIC_MODE=w.a.TEXTURE_INVCUBIC_MODE,p.TEXTURE_EQUIRECTANGULAR_MODE=w.a.TEXTURE_EQUIRECTANGULAR_MODE,p.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=w.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,p.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=w.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,p.SCALEMODE_FLOOR=w.a.SCALEMODE_FLOOR,p.SCALEMODE_NEAREST=w.a.SCALEMODE_NEAREST,p.SCALEMODE_CEILING=w.a.SCALEMODE_CEILING,p._RescalePostProcessFactory=null,p}(M.a))},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.WithinEpsilon=function(E,d,x){x===void 0&&(x=1401298e-51);var M=E-d;return-x<=M&&M<=x},m.ToHex=function(E){var d=E.toString(16);return E<=15?("0"+d).toUpperCase():d.toUpperCase()},m.Sign=function(E){return(E=+E)==0||isNaN(E)?E:E>0?1:-1},m.Clamp=function(E,d,x){return d===void 0&&(d=0),x===void 0&&(x=1),Math.min(x,Math.max(d,E))},m.Log2=function(E){return Math.log(E)*Math.LOG2E},m.Repeat=function(E,d){return E-Math.floor(E/d)*d},m.Normalize=function(E,d,x){return(E-d)/(x-d)},m.Denormalize=function(E,d,x){return E*(x-d)+d},m.DeltaAngle=function(E,d){var x=m.Repeat(d-E,360);return x>180&&(x-=360),x},m.PingPong=function(E,d){var x=m.Repeat(E,2*d);return d-Math.abs(x-d)},m.SmoothStep=function(E,d,x){var M=m.Clamp(x);return d*(M=-2*M*M*M+3*M*M)+E*(1-M)},m.MoveTowards=function(E,d,x){return Math.abs(d-E)<=x?d:E+m.Sign(d-E)*x},m.MoveTowardsAngle=function(E,d,x){var M=m.DeltaAngle(E,d),w=0;return-x<M&&M<x?w=d:(d=E+M,w=m.MoveTowards(E,d,x)),w},m.Lerp=function(E,d,x){return E+(d-E)*x},m.LerpAngle=function(E,d,x){var M=m.Repeat(d-E,360);return M>180&&(M-=360),E+M*m.Clamp(x)},m.InverseLerp=function(E,d,x){return E!=d?m.Clamp((x-E)/(d-E)):0},m.Hermite=function(E,d,x,M,w){var S=w*w,_=w*S;return E*(2*_-3*S+1)+x*(-2*_+3*S)+d*(_-2*S+w)+M*(_-S)},m.RandomRange=function(E,d){return E===d?E:Math.random()*(d-E)+E},m.RangeToPercent=function(E,d,x){return(E-d)/(x-d)},m.PercentToRange=function(E,d,x){return(x-d)*E+d},m.NormalizeRadians=function(E){return E-=m.TwoPi*Math.floor((E+Math.PI)/m.TwoPi)},m.TwoPi=2*Math.PI,m}()},function(f,s,c){c.d(s,"a",function(){return _});var T=c(8),m=c(20),E=c(22),d=c(4),x=c(48),M=c(2),w=c(9),S=c(119),_=function(){function O(){}return O.BindEyePosition=function(R,I,y){if(y===void 0&&(y="vEyePosition"),I._forcedViewPosition)R.setVector3(y,I._forcedViewPosition);else{var p=I.activeCamera.globalPosition;p||(p=I.activeCamera.devicePosition),R.setVector3(y,I._mirroredCameraPosition?I._mirroredCameraPosition:p)}},O.PrepareDefinesForMergedUV=function(R,I,y){I._needUVs=!0,I[y]=!0,R.getTextureMatrix().isIdentityAs3x2()?(I[y+"DIRECTUV"]=R.coordinatesIndex+1,R.coordinatesIndex===0?I.MAINUV1=!0:I.MAINUV2=!0):I[y+"DIRECTUV"]=0},O.BindTextureMatrix=function(R,I,y){var p=R.getTextureMatrix();I.updateMatrix(y+"Matrix",p)},O.GetFogState=function(R,I){return I.fogEnabled&&R.applyFog&&I.fogMode!==m.a.FOGMODE_NONE},O.PrepareDefinesForMisc=function(R,I,y,p,g,C,P){P._areMiscDirty&&(P.LOGARITHMICDEPTH=y,P.POINTSIZE=p,P.FOG=g&&this.GetFogState(R,I),P.NONUNIFORMSCALING=R.nonUniformScaling,P.ALPHATEST=C)},O.PrepareDefinesForFrameBoundValues=function(R,I,y,p,g,C){g===void 0&&(g=null),C===void 0&&(C=!1);var P,F,U,B,L,z,X=!1;P=g??(R.clipPlane!==void 0&&R.clipPlane!==null),F=g??(R.clipPlane2!==void 0&&R.clipPlane2!==null),U=g??(R.clipPlane3!==void 0&&R.clipPlane3!==null),B=g??(R.clipPlane4!==void 0&&R.clipPlane4!==null),L=g??(R.clipPlane5!==void 0&&R.clipPlane5!==null),z=g??(R.clipPlane6!==void 0&&R.clipPlane6!==null),y.CLIPPLANE!==P&&(y.CLIPPLANE=P,X=!0),y.CLIPPLANE2!==F&&(y.CLIPPLANE2=F,X=!0),y.CLIPPLANE3!==U&&(y.CLIPPLANE3=U,X=!0),y.CLIPPLANE4!==B&&(y.CLIPPLANE4=B,X=!0),y.CLIPPLANE5!==L&&(y.CLIPPLANE5=L,X=!0),y.CLIPPLANE6!==z&&(y.CLIPPLANE6=z,X=!0),y.DEPTHPREPASS!==!I.getColorWrite()&&(y.DEPTHPREPASS=!y.DEPTHPREPASS,X=!0),y.INSTANCES!==p&&(y.INSTANCES=p,X=!0),y.THIN_INSTANCES!==C&&(y.THIN_INSTANCES=C,X=!0),X&&y.markAsUnprocessed()},O.PrepareDefinesForBones=function(R,I){if(R.useBones&&R.computeBonesUsingShaders&&R.skeleton){I.NUM_BONE_INFLUENCERS=R.numBoneInfluencers;var y=I.BONETEXTURE!==void 0;if(R.skeleton.isUsingTextureForMatrices&&y)I.BONETEXTURE=!0;else{I.BonesPerMesh=R.skeleton.bones.length+1,I.BONETEXTURE=!y&&void 0;var p=R.getScene().prePassRenderer;if(p&&p.enabled){var g=p.excludedSkinnedMesh.indexOf(R)===-1;I.BONES_VELOCITY_ENABLED=g}}}else I.NUM_BONE_INFLUENCERS=0,I.BonesPerMesh=0},O.PrepareDefinesForMorphTargets=function(R,I){var y=R.morphTargetManager;y?(I.MORPHTARGETS_UV=y.supportsUVs&&I.UV1,I.MORPHTARGETS_TANGENT=y.supportsTangents&&I.TANGENT,I.MORPHTARGETS_NORMAL=y.supportsNormals&&I.NORMAL,I.MORPHTARGETS=y.numInfluencers>0,I.NUM_MORPH_INFLUENCERS=y.numInfluencers):(I.MORPHTARGETS_UV=!1,I.MORPHTARGETS_TANGENT=!1,I.MORPHTARGETS_NORMAL=!1,I.MORPHTARGETS=!1,I.NUM_MORPH_INFLUENCERS=0)},O.PrepareDefinesForAttributes=function(R,I,y,p,g,C){if(g===void 0&&(g=!1),C===void 0&&(C=!0),!I._areAttributesDirty&&I._needNormals===I._normals&&I._needUVs===I._uvs)return!1;if(I._normals=I._needNormals,I._uvs=I._needUVs,I.NORMAL=I._needNormals&&R.isVerticesDataPresent(d.b.NormalKind),I._needNormals&&R.isVerticesDataPresent(d.b.TangentKind)&&(I.TANGENT=!0),I._needUVs?(I.UV1=R.isVerticesDataPresent(d.b.UVKind),I.UV2=R.isVerticesDataPresent(d.b.UV2Kind)):(I.UV1=!1,I.UV2=!1),y){var P=R.useVertexColors&&R.isVerticesDataPresent(d.b.ColorKind);I.VERTEXCOLOR=P,I.VERTEXALPHA=R.hasVertexAlpha&&P&&C}return p&&this.PrepareDefinesForBones(R,I),g&&this.PrepareDefinesForMorphTargets(R,I),!0},O.PrepareDefinesForMultiview=function(R,I){if(R.activeCamera){var y=I.MULTIVIEW;I.MULTIVIEW=R.activeCamera.outputRenderTarget!==null&&R.activeCamera.outputRenderTarget.getViewCount()>1,I.MULTIVIEW!=y&&I.markAsUnprocessed()}},O.PrepareDefinesForPrePass=function(R,I,y){var p=I.PREPASS;if(I._arePrePassDirty){var g=[{type:M.a.PREPASS_POSITION_TEXTURE_TYPE,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:M.a.PREPASS_VELOCITY_TEXTURE_TYPE,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:M.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:M.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:M.a.PREPASS_ALBEDO_TEXTURE_TYPE,define:"PREPASS_ALBEDO",index:"PREPASS_ALBEDO_INDEX"},{type:M.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,define:"PREPASS_DEPTHNORMAL",index:"PREPASS_DEPTHNORMAL_INDEX"}];if(R.prePassRenderer&&R.prePassRenderer.enabled&&y){I.PREPASS=!0,I.SCENE_MRT_COUNT=R.prePassRenderer.mrtCount;for(var C=0;C<g.length;C++){var P=R.prePassRenderer.getIndex(g[C].type);P!==-1?(I[g[C].define]=!0,I[g[C].index]=P):I[g[C].define]=!1}}else for(I.PREPASS=!1,C=0;C<g.length;C++)I[g[C].define]=!1;I.PREPASS!=p&&(I.markAsUnprocessed(),I.markAsImageProcessingDirty())}},O.PrepareDefinesForLight=function(R,I,y,p,g,C,P){switch(P.needNormals=!0,g["LIGHT"+p]===void 0&&(P.needRebuild=!0),g["LIGHT"+p]=!0,g["SPOTLIGHT"+p]=!1,g["HEMILIGHT"+p]=!1,g["POINTLIGHT"+p]=!1,g["DIRLIGHT"+p]=!1,y.prepareLightSpecificDefines(g,p),g["LIGHT_FALLOFF_PHYSICAL"+p]=!1,g["LIGHT_FALLOFF_GLTF"+p]=!1,g["LIGHT_FALLOFF_STANDARD"+p]=!1,y.falloffType){case x.a.FALLOFF_GLTF:g["LIGHT_FALLOFF_GLTF"+p]=!0;break;case x.a.FALLOFF_PHYSICAL:g["LIGHT_FALLOFF_PHYSICAL"+p]=!0;break;case x.a.FALLOFF_STANDARD:g["LIGHT_FALLOFF_STANDARD"+p]=!0}if(C&&!y.specular.equalsFloats(0,0,0)&&(P.specularEnabled=!0),g["SHADOW"+p]=!1,g["SHADOWCSM"+p]=!1,g["SHADOWCSMDEBUG"+p]=!1,g["SHADOWCSMNUM_CASCADES"+p]=!1,g["SHADOWCSMUSESHADOWMAXZ"+p]=!1,g["SHADOWCSMNOBLEND"+p]=!1,g["SHADOWCSM_RIGHTHANDED"+p]=!1,g["SHADOWPCF"+p]=!1,g["SHADOWPCSS"+p]=!1,g["SHADOWPOISSON"+p]=!1,g["SHADOWESM"+p]=!1,g["SHADOWCLOSEESM"+p]=!1,g["SHADOWCUBE"+p]=!1,g["SHADOWLOWQUALITY"+p]=!1,g["SHADOWMEDIUMQUALITY"+p]=!1,I&&I.receiveShadows&&R.shadowsEnabled&&y.shadowEnabled){var F=y.getShadowGenerator();if(F){var U=F.getShadowMap();U&&U.renderList&&U.renderList.length>0&&(P.shadowEnabled=!0,F.prepareDefines(g,p))}}y.lightmapMode!=x.a.LIGHTMAP_DEFAULT?(P.lightmapMode=!0,g["LIGHTMAPEXCLUDED"+p]=!0,g["LIGHTMAPNOSPECULAR"+p]=y.lightmapMode==x.a.LIGHTMAP_SHADOWSONLY):(g["LIGHTMAPEXCLUDED"+p]=!1,g["LIGHTMAPNOSPECULAR"+p]=!1)},O.PrepareDefinesForLights=function(R,I,y,p,g,C){if(g===void 0&&(g=4),C===void 0&&(C=!1),!y._areLightsDirty)return y._needNormals;var P=0,F={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(R.lightsEnabled&&!C)for(var U=0,B=I.lightSources;U<B.length;U++){var L=B[U];if(this.PrepareDefinesForLight(R,I,L,P,y,p,F),++P===g)break}y.SPECULARTERM=F.specularEnabled,y.SHADOWS=F.shadowEnabled;for(var z=P;z<g;z++)y["LIGHT"+z]!==void 0&&(y["LIGHT"+z]=!1,y["HEMILIGHT"+z]=!1,y["POINTLIGHT"+z]=!1,y["DIRLIGHT"+z]=!1,y["SPOTLIGHT"+z]=!1,y["SHADOW"+z]=!1,y["SHADOWCSM"+z]=!1,y["SHADOWCSMDEBUG"+z]=!1,y["SHADOWCSMNUM_CASCADES"+z]=!1,y["SHADOWCSMUSESHADOWMAXZ"+z]=!1,y["SHADOWCSMNOBLEND"+z]=!1,y["SHADOWCSM_RIGHTHANDED"+z]=!1,y["SHADOWPCF"+z]=!1,y["SHADOWPCSS"+z]=!1,y["SHADOWPOISSON"+z]=!1,y["SHADOWESM"+z]=!1,y["SHADOWCLOSEESM"+z]=!1,y["SHADOWCUBE"+z]=!1,y["SHADOWLOWQUALITY"+z]=!1,y["SHADOWMEDIUMQUALITY"+z]=!1);var X=R.getEngine().getCaps();return y.SHADOWFLOAT===void 0&&(F.needRebuild=!0),y.SHADOWFLOAT=F.shadowEnabled&&(X.textureFloatRender&&X.textureFloatLinearFiltering||X.textureHalfFloatRender&&X.textureHalfFloatLinearFiltering),y.LIGHTMAPEXCLUDED=F.lightmapMode,F.needRebuild&&y.rebuild(),F.needNormals},O.PrepareUniformsAndSamplersForLight=function(R,I,y,p,g,C){g===void 0&&(g=null),C===void 0&&(C=!1),g&&g.push("Light"+R),C||(I.push("vLightData"+R,"vLightDiffuse"+R,"vLightSpecular"+R,"vLightDirection"+R,"vLightFalloff"+R,"vLightGround"+R,"lightMatrix"+R,"shadowsInfo"+R,"depthValues"+R),y.push("shadowSampler"+R),y.push("depthSampler"+R),I.push("viewFrustumZ"+R,"cascadeBlendFactor"+R,"lightSizeUVCorrection"+R,"depthCorrection"+R,"penumbraDarkness"+R,"frustumLengths"+R),p&&(y.push("projectionLightSampler"+R),I.push("textureProjectionMatrix"+R)))},O.PrepareUniformsAndSamplersList=function(R,I,y,p){var g;p===void 0&&(p=4);var C=null;if(R.uniformsNames){var P=R;g=P.uniformsNames,C=P.uniformBuffersNames,I=P.samplers,y=P.defines,p=P.maxSimultaneousLights||0}else g=R,I||(I=[]);for(var F=0;F<p&&y["LIGHT"+F];F++)this.PrepareUniformsAndSamplersForLight(F,g,I,y["PROJECTEDLIGHTTEXTURE"+F],C);y.NUM_MORPH_INFLUENCERS&&g.push("morphTargetInfluences")},O.HandleFallbacksForShadows=function(R,I,y,p){y===void 0&&(y=4),p===void 0&&(p=0);for(var g=0,C=0;C<y&&R["LIGHT"+C];C++)C>0&&(g=p+C,I.addFallback(g,"LIGHT"+C)),R.SHADOWS||(R["SHADOW"+C]&&I.addFallback(p,"SHADOW"+C),R["SHADOWPCF"+C]&&I.addFallback(p,"SHADOWPCF"+C),R["SHADOWPCSS"+C]&&I.addFallback(p,"SHADOWPCSS"+C),R["SHADOWPOISSON"+C]&&I.addFallback(p,"SHADOWPOISSON"+C),R["SHADOWESM"+C]&&I.addFallback(p,"SHADOWESM"+C),R["SHADOWCLOSEESM"+C]&&I.addFallback(p,"SHADOWCLOSEESM"+C));return g++},O.PrepareAttributesForMorphTargetsInfluencers=function(R,I,y){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=y,this.PrepareAttributesForMorphTargets(R,I,this._TmpMorphInfluencers)},O.PrepareAttributesForMorphTargets=function(R,I,y){var p=y.NUM_MORPH_INFLUENCERS;if(p>0&&E.a.LastCreatedEngine)for(var g=E.a.LastCreatedEngine.getCaps().maxVertexAttribs,C=I.morphTargetManager,P=C&&C.supportsNormals&&y.NORMAL,F=C&&C.supportsTangents&&y.TANGENT,U=C&&C.supportsUVs&&y.UV1,B=0;B<p;B++)R.push(d.b.PositionKind+B),P&&R.push(d.b.NormalKind+B),F&&R.push(d.b.TangentKind+B),U&&R.push(d.b.UVKind+"_"+B),R.length>g&&T.a.Error("Cannot add more vertex attributes for mesh "+I.name)},O.PrepareAttributesForBones=function(R,I,y,p){y.NUM_BONE_INFLUENCERS>0&&(p.addCPUSkinningFallback(0,I),R.push(d.b.MatricesIndicesKind),R.push(d.b.MatricesWeightsKind),y.NUM_BONE_INFLUENCERS>4&&(R.push(d.b.MatricesIndicesExtraKind),R.push(d.b.MatricesWeightsExtraKind)))},O.PrepareAttributesForInstances=function(R,I){(I.INSTANCES||I.THIN_INSTANCES)&&this.PushAttributesForInstances(R)},O.PushAttributesForInstances=function(R){R.push("world0"),R.push("world1"),R.push("world2"),R.push("world3")},O.BindLightProperties=function(R,I,y){R.transferToEffect(I,y+"")},O.BindLight=function(R,I,y,p,g,C){C===void 0&&(C=!1),R._bindLight(I,y,p,g,C)},O.BindLights=function(R,I,y,p,g,C){g===void 0&&(g=4),C===void 0&&(C=!1);for(var P=Math.min(I.lightSources.length,g),F=0;F<P;F++){var U=I.lightSources[F];this.BindLight(U,F,R,y,typeof p=="boolean"?p:p.SPECULARTERM,C)}},O.BindFogParameters=function(R,I,y,p){p===void 0&&(p=!1),R.fogEnabled&&I.applyFog&&R.fogMode!==m.a.FOGMODE_NONE&&(y.setFloat4("vFogInfos",R.fogMode,R.fogStart,R.fogEnd,R.fogDensity),p?(R.fogColor.toLinearSpaceToRef(this._tempFogColor),y.setColor3("vFogColor",this._tempFogColor)):y.setColor3("vFogColor",R.fogColor))},O.BindBonesParameters=function(R,I,y){if(I&&R&&(R.computeBonesUsingShaders&&I._bonesComputationForcedToCPU&&(R.computeBonesUsingShaders=!1),R.useBones&&R.computeBonesUsingShaders&&R.skeleton)){var p=R.skeleton;if(p.isUsingTextureForMatrices&&I.getUniformIndex("boneTextureWidth")>-1){var g=p.getTransformMatrixTexture(R);I.setTexture("boneSampler",g),I.setFloat("boneTextureWidth",4*(p.bones.length+1))}else{var C=p.getTransformMatrices(R);C&&(I.setMatrices("mBones",C),y&&R.getScene().prePassRenderer&&R.getScene().prePassRenderer.getIndex(M.a.PREPASS_VELOCITY_TEXTURE_TYPE)&&(y.previousBones[R.uniqueId]&&I.setMatrices("mPreviousBones",y.previousBones[R.uniqueId]),O._CopyBonesTransformationMatrices(C,y.previousBones[R.uniqueId])))}}},O._CopyBonesTransformationMatrices=function(R,I){return I.set(R),I},O.BindMorphTargetParameters=function(R,I){var y=R.morphTargetManager;R&&y&&I.setFloatArray("morphTargetInfluences",y.influences)},O.BindLogDepth=function(R,I,y){R.LOGARITHMICDEPTH&&I.setFloat("logarithmicDepthConstant",2/(Math.log(y.activeCamera.maxZ+1)/Math.LN2))},O.BindClipPlane=function(R,I){S.a.BindClipPlane(R,I)},O._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},O._tempFogColor=w.a.Black(),O}()},function(f,s,c){c.d(s,"a",function(){return M});var T=c(0),m=c(4),E=c(21),d=c(9),x=c(8),M=function(){function w(){}return w.prototype.set=function(S,_){switch(S.length||x.a.Warn("Setting vertex data kind '"+_+"' with an empty array"),_){case m.b.PositionKind:this.positions=S;break;case m.b.NormalKind:this.normals=S;break;case m.b.TangentKind:this.tangents=S;break;case m.b.UVKind:this.uvs=S;break;case m.b.UV2Kind:this.uvs2=S;break;case m.b.UV3Kind:this.uvs3=S;break;case m.b.UV4Kind:this.uvs4=S;break;case m.b.UV5Kind:this.uvs5=S;break;case m.b.UV6Kind:this.uvs6=S;break;case m.b.ColorKind:this.colors=S;break;case m.b.MatricesIndicesKind:this.matricesIndices=S;break;case m.b.MatricesWeightsKind:this.matricesWeights=S;break;case m.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=S;break;case m.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=S}},w.prototype.applyToMesh=function(S,_){return this._applyTo(S,_),this},w.prototype.applyToGeometry=function(S,_){return this._applyTo(S,_),this},w.prototype.updateMesh=function(S){return this._update(S),this},w.prototype.updateGeometry=function(S){return this._update(S),this},w.prototype._applyTo=function(S,_){return _===void 0&&(_=!1),this.positions&&S.setVerticesData(m.b.PositionKind,this.positions,_),this.normals&&S.setVerticesData(m.b.NormalKind,this.normals,_),this.tangents&&S.setVerticesData(m.b.TangentKind,this.tangents,_),this.uvs&&S.setVerticesData(m.b.UVKind,this.uvs,_),this.uvs2&&S.setVerticesData(m.b.UV2Kind,this.uvs2,_),this.uvs3&&S.setVerticesData(m.b.UV3Kind,this.uvs3,_),this.uvs4&&S.setVerticesData(m.b.UV4Kind,this.uvs4,_),this.uvs5&&S.setVerticesData(m.b.UV5Kind,this.uvs5,_),this.uvs6&&S.setVerticesData(m.b.UV6Kind,this.uvs6,_),this.colors&&S.setVerticesData(m.b.ColorKind,this.colors,_),this.matricesIndices&&S.setVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,_),this.matricesWeights&&S.setVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,_),this.matricesIndicesExtra&&S.setVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,_),this.matricesWeightsExtra&&S.setVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,_),this.indices?S.setIndices(this.indices,null,_):S.setIndices([],null),this},w.prototype._update=function(S,_,O){return this.positions&&S.updateVerticesData(m.b.PositionKind,this.positions,_,O),this.normals&&S.updateVerticesData(m.b.NormalKind,this.normals,_,O),this.tangents&&S.updateVerticesData(m.b.TangentKind,this.tangents,_,O),this.uvs&&S.updateVerticesData(m.b.UVKind,this.uvs,_,O),this.uvs2&&S.updateVerticesData(m.b.UV2Kind,this.uvs2,_,O),this.uvs3&&S.updateVerticesData(m.b.UV3Kind,this.uvs3,_,O),this.uvs4&&S.updateVerticesData(m.b.UV4Kind,this.uvs4,_,O),this.uvs5&&S.updateVerticesData(m.b.UV5Kind,this.uvs5,_,O),this.uvs6&&S.updateVerticesData(m.b.UV6Kind,this.uvs6,_,O),this.colors&&S.updateVerticesData(m.b.ColorKind,this.colors,_,O),this.matricesIndices&&S.updateVerticesData(m.b.MatricesIndicesKind,this.matricesIndices,_,O),this.matricesWeights&&S.updateVerticesData(m.b.MatricesWeightsKind,this.matricesWeights,_,O),this.matricesIndicesExtra&&S.updateVerticesData(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,_,O),this.matricesWeightsExtra&&S.updateVerticesData(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,_,O),this.indices&&S.setIndices(this.indices,null),this},w.prototype.transform=function(S){var _,O=S.determinant()<0,R=T.e.Zero();if(this.positions){var I=T.e.Zero();for(_=0;_<this.positions.length;_+=3)T.e.FromArrayToRef(this.positions,_,I),T.e.TransformCoordinatesToRef(I,S,R),this.positions[_]=R.x,this.positions[_+1]=R.y,this.positions[_+2]=R.z}if(this.normals){var y=T.e.Zero();for(_=0;_<this.normals.length;_+=3)T.e.FromArrayToRef(this.normals,_,y),T.e.TransformNormalToRef(y,S,R),this.normals[_]=R.x,this.normals[_+1]=R.y,this.normals[_+2]=R.z}if(this.tangents){var p=T.f.Zero(),g=T.f.Zero();for(_=0;_<this.tangents.length;_+=4)T.f.FromArrayToRef(this.tangents,_,p),T.f.TransformNormalToRef(p,S,g),this.tangents[_]=g.x,this.tangents[_+1]=g.y,this.tangents[_+2]=g.z,this.tangents[_+3]=g.w}if(O&&this.indices)for(_=0;_<this.indices.length;_+=3){var C=this.indices[_+1];this.indices[_+1]=this.indices[_+2],this.indices[_+2]=C}return this},w.prototype.merge=function(S,_){if(_===void 0&&(_=!1),this._validate(),S._validate(),!this.normals!=!S.normals||!this.tangents!=!S.tangents||!this.uvs!=!S.uvs||!this.uvs2!=!S.uvs2||!this.uvs3!=!S.uvs3||!this.uvs4!=!S.uvs4||!this.uvs5!=!S.uvs5||!this.uvs6!=!S.uvs6||!this.colors!=!S.colors||!this.matricesIndices!=!S.matricesIndices||!this.matricesWeights!=!S.matricesWeights||!this.matricesIndicesExtra!=!S.matricesIndicesExtra||!this.matricesWeightsExtra!=!S.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(S.indices){this.indices||(this.indices=[]);var O=this.positions?this.positions.length/3:0;if(this.indices.BYTES_PER_ELEMENT!==void 0){var R=this.indices.length+S.indices.length,I=_||this.indices instanceof Uint32Array?new Uint32Array(R):new Uint16Array(R);I.set(this.indices);for(var y=this.indices.length,p=0;p<S.indices.length;p++)I[y+p]=S.indices[p]+O;this.indices=I}else for(p=0;p<S.indices.length;p++)this.indices.push(S.indices[p]+O)}return this.positions=this._mergeElement(this.positions,S.positions),this.normals=this._mergeElement(this.normals,S.normals),this.tangents=this._mergeElement(this.tangents,S.tangents),this.uvs=this._mergeElement(this.uvs,S.uvs),this.uvs2=this._mergeElement(this.uvs2,S.uvs2),this.uvs3=this._mergeElement(this.uvs3,S.uvs3),this.uvs4=this._mergeElement(this.uvs4,S.uvs4),this.uvs5=this._mergeElement(this.uvs5,S.uvs5),this.uvs6=this._mergeElement(this.uvs6,S.uvs6),this.colors=this._mergeElement(this.colors,S.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,S.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,S.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,S.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,S.matricesWeightsExtra),this},w.prototype._mergeElement=function(S,_){if(!S)return _;if(!_)return S;var O=_.length+S.length,R=S instanceof Float32Array,I=_ instanceof Float32Array;if(R){var y=new Float32Array(O);return y.set(S),y.set(_,S.length),y}if(I){var p=S.slice(0),g=0;for(O=_.length;g<O;g++)p.push(_[g]);return p}return S.concat(_)},w.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var S=function(R,I){var y=m.b.DeduceStride(R);if(I.length%y!=0)throw new Error("The "+R+"s array count must be a multiple of "+y);return I.length/y},_=S(m.b.PositionKind,this.positions),O=function(R,I){var y=S(R,I);if(y!==_)throw new Error("The "+R+"s element count ("+y+") does not match the positions count ("+_+")")};this.normals&&O(m.b.NormalKind,this.normals),this.tangents&&O(m.b.TangentKind,this.tangents),this.uvs&&O(m.b.UVKind,this.uvs),this.uvs2&&O(m.b.UV2Kind,this.uvs2),this.uvs3&&O(m.b.UV3Kind,this.uvs3),this.uvs4&&O(m.b.UV4Kind,this.uvs4),this.uvs5&&O(m.b.UV5Kind,this.uvs5),this.uvs6&&O(m.b.UV6Kind,this.uvs6),this.colors&&O(m.b.ColorKind,this.colors),this.matricesIndices&&O(m.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&O(m.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&O(m.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&O(m.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},w.prototype.serialize=function(){var S=this.serialize();return this.positions&&(S.positions=this.positions),this.normals&&(S.normals=this.normals),this.tangents&&(S.tangents=this.tangents),this.uvs&&(S.uvs=this.uvs),this.uvs2&&(S.uvs2=this.uvs2),this.uvs3&&(S.uvs3=this.uvs3),this.uvs4&&(S.uvs4=this.uvs4),this.uvs5&&(S.uvs5=this.uvs5),this.uvs6&&(S.uvs6=this.uvs6),this.colors&&(S.colors=this.colors),this.matricesIndices&&(S.matricesIndices=this.matricesIndices,S.matricesIndices._isExpanded=!0),this.matricesWeights&&(S.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(S.matricesIndicesExtra=this.matricesIndicesExtra,S.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(S.matricesWeightsExtra=this.matricesWeightsExtra),S.indices=this.indices,S},w.ExtractFromMesh=function(S,_,O){return w._ExtractFrom(S,_,O)},w.ExtractFromGeometry=function(S,_,O){return w._ExtractFrom(S,_,O)},w._ExtractFrom=function(S,_,O){var R=new w;return S.isVerticesDataPresent(m.b.PositionKind)&&(R.positions=S.getVerticesData(m.b.PositionKind,_,O)),S.isVerticesDataPresent(m.b.NormalKind)&&(R.normals=S.getVerticesData(m.b.NormalKind,_,O)),S.isVerticesDataPresent(m.b.TangentKind)&&(R.tangents=S.getVerticesData(m.b.TangentKind,_,O)),S.isVerticesDataPresent(m.b.UVKind)&&(R.uvs=S.getVerticesData(m.b.UVKind,_,O)),S.isVerticesDataPresent(m.b.UV2Kind)&&(R.uvs2=S.getVerticesData(m.b.UV2Kind,_,O)),S.isVerticesDataPresent(m.b.UV3Kind)&&(R.uvs3=S.getVerticesData(m.b.UV3Kind,_,O)),S.isVerticesDataPresent(m.b.UV4Kind)&&(R.uvs4=S.getVerticesData(m.b.UV4Kind,_,O)),S.isVerticesDataPresent(m.b.UV5Kind)&&(R.uvs5=S.getVerticesData(m.b.UV5Kind,_,O)),S.isVerticesDataPresent(m.b.UV6Kind)&&(R.uvs6=S.getVerticesData(m.b.UV6Kind,_,O)),S.isVerticesDataPresent(m.b.ColorKind)&&(R.colors=S.getVerticesData(m.b.ColorKind,_,O)),S.isVerticesDataPresent(m.b.MatricesIndicesKind)&&(R.matricesIndices=S.getVerticesData(m.b.MatricesIndicesKind,_,O)),S.isVerticesDataPresent(m.b.MatricesWeightsKind)&&(R.matricesWeights=S.getVerticesData(m.b.MatricesWeightsKind,_,O)),S.isVerticesDataPresent(m.b.MatricesIndicesExtraKind)&&(R.matricesIndicesExtra=S.getVerticesData(m.b.MatricesIndicesExtraKind,_,O)),S.isVerticesDataPresent(m.b.MatricesWeightsExtraKind)&&(R.matricesWeightsExtra=S.getVerticesData(m.b.MatricesWeightsExtraKind,_,O)),R.indices=S.getIndices(_,O),R},w.CreateRibbon=function(S){throw E.a.WarnImport("ribbonBuilder")},w.CreateBox=function(S){throw E.a.WarnImport("boxBuilder")},w.CreateTiledBox=function(S){throw E.a.WarnImport("tiledBoxBuilder")},w.CreateTiledPlane=function(S){throw E.a.WarnImport("tiledPlaneBuilder")},w.CreateSphere=function(S){throw E.a.WarnImport("sphereBuilder")},w.CreateCylinder=function(S){throw E.a.WarnImport("cylinderBuilder")},w.CreateTorus=function(S){throw E.a.WarnImport("torusBuilder")},w.CreateLineSystem=function(S){throw E.a.WarnImport("linesBuilder")},w.CreateDashedLines=function(S){throw E.a.WarnImport("linesBuilder")},w.CreateGround=function(S){throw E.a.WarnImport("groundBuilder")},w.CreateTiledGround=function(S){throw E.a.WarnImport("groundBuilder")},w.CreateGroundFromHeightMap=function(S){throw E.a.WarnImport("groundBuilder")},w.CreatePlane=function(S){throw E.a.WarnImport("planeBuilder")},w.CreateDisc=function(S){throw E.a.WarnImport("discBuilder")},w.CreatePolygon=function(S,_,O,R,I,y,p){throw E.a.WarnImport("polygonBuilder")},w.CreateIcoSphere=function(S){throw E.a.WarnImport("icoSphereBuilder")},w.CreatePolyhedron=function(S){throw E.a.WarnImport("polyhedronBuilder")},w.CreateCapsule=function(S){throw S===void 0&&(S={orientation:T.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),E.a.WarnImport("capsuleBuilder")},w.CreateTorusKnot=function(S){throw E.a.WarnImport("torusKnotBuilder")},w.ComputeNormals=function(S,_,O,R){var I=0,y=0,p=0,g=0,C=0,P=0,F=0,U=0,B=0,L=0,z=0,X=0,G=0,ee=0,$=0,fe=0,me=0,ve=0,be=0,ie=0,se=!1,V=!1,K=!1,Z=!1,le=1,re=0,Q=null;if(R&&(se=!!R.facetNormals,V=!!R.facetPositions,K=!!R.facetPartitioning,le=R.useRightHandedSystem===!0?-1:1,re=R.ratio||0,Z=!!R.depthSort,Q=R.distanceTo,Z)){Q===void 0&&(Q=T.e.Zero());var W=R.depthSortedFacets}var Y=0,q=0,ae=0,pe=0;if(K&&R&&R.bbSize){var De=0,de=0,ge=0,ne=0,Te=0,we=0,Se=0,Ge=0,$e=0,nt=0,et=0,Ze=0,ht=0,gt=0,Rt=0,zt=0,un=R.bbSize.x>R.bbSize.y?R.bbSize.x:R.bbSize.y;un=un>R.bbSize.z?un:R.bbSize.z,Y=R.subDiv.X*re/R.bbSize.x,q=R.subDiv.Y*re/R.bbSize.y,ae=R.subDiv.Z*re/R.bbSize.z,pe=R.subDiv.max*R.subDiv.max,R.facetPartitioning.length=0}for(I=0;I<S.length;I++)O[I]=0;var Br=_.length/3|0;for(I=0;I<Br;I++){if(G=(X=3*_[3*I])+1,ee=X+2,fe=($=3*_[3*I+1])+1,me=$+2,be=(ve=3*_[3*I+2])+1,ie=ve+2,y=S[X]-S[$],p=S[G]-S[fe],g=S[ee]-S[me],C=S[ve]-S[$],P=S[be]-S[fe],U=le*(p*(F=S[ie]-S[me])-g*P),B=le*(g*C-y*F),L=le*(y*P-p*C),U/=z=(z=Math.sqrt(U*U+B*B+L*L))===0?1:z,B/=z,L/=z,se&&R&&(R.facetNormals[I].x=U,R.facetNormals[I].y=B,R.facetNormals[I].z=L),V&&R&&(R.facetPositions[I].x=(S[X]+S[$]+S[ve])/3,R.facetPositions[I].y=(S[G]+S[fe]+S[be])/3,R.facetPositions[I].z=(S[ee]+S[me]+S[ie])/3),K&&R&&(De=Math.floor((R.facetPositions[I].x-R.bInfo.minimum.x*re)*Y),de=Math.floor((R.facetPositions[I].y-R.bInfo.minimum.y*re)*q),ge=Math.floor((R.facetPositions[I].z-R.bInfo.minimum.z*re)*ae),ne=Math.floor((S[X]-R.bInfo.minimum.x*re)*Y),Te=Math.floor((S[G]-R.bInfo.minimum.y*re)*q),we=Math.floor((S[ee]-R.bInfo.minimum.z*re)*ae),Se=Math.floor((S[$]-R.bInfo.minimum.x*re)*Y),Ge=Math.floor((S[fe]-R.bInfo.minimum.y*re)*q),$e=Math.floor((S[me]-R.bInfo.minimum.z*re)*ae),nt=Math.floor((S[ve]-R.bInfo.minimum.x*re)*Y),et=Math.floor((S[be]-R.bInfo.minimum.y*re)*q),Ze=Math.floor((S[ie]-R.bInfo.minimum.z*re)*ae),gt=ne+R.subDiv.max*Te+pe*we,Rt=Se+R.subDiv.max*Ge+pe*$e,zt=nt+R.subDiv.max*et+pe*Ze,ht=De+R.subDiv.max*de+pe*ge,R.facetPartitioning[ht]=R.facetPartitioning[ht]?R.facetPartitioning[ht]:new Array,R.facetPartitioning[gt]=R.facetPartitioning[gt]?R.facetPartitioning[gt]:new Array,R.facetPartitioning[Rt]=R.facetPartitioning[Rt]?R.facetPartitioning[Rt]:new Array,R.facetPartitioning[zt]=R.facetPartitioning[zt]?R.facetPartitioning[zt]:new Array,R.facetPartitioning[gt].push(I),Rt!=gt&&R.facetPartitioning[Rt].push(I),zt!=Rt&&zt!=gt&&R.facetPartitioning[zt].push(I),ht!=gt&&ht!=Rt&&ht!=zt&&R.facetPartitioning[ht].push(I)),Z&&R&&R.facetPositions){var lr=W[I];lr.ind=3*I,lr.sqDistance=T.e.DistanceSquared(R.facetPositions[I],Q)}O[X]+=U,O[G]+=B,O[ee]+=L,O[$]+=U,O[fe]+=B,O[me]+=L,O[ve]+=U,O[be]+=B,O[ie]+=L}for(I=0;I<O.length/3;I++)U=O[3*I],B=O[3*I+1],L=O[3*I+2],U/=z=(z=Math.sqrt(U*U+B*B+L*L))===0?1:z,B/=z,L/=z,O[3*I]=U,O[3*I+1]=B,O[3*I+2]=L},w._ComputeSides=function(S,_,O,R,I,y,p){var g,C,P=O.length,F=R.length;switch(S=S||w.DEFAULTSIDE){case w.FRONTSIDE:break;case w.BACKSIDE:var U;for(g=0;g<P;g+=3)U=O[g],O[g]=O[g+2],O[g+2]=U;for(C=0;C<F;C++)R[C]=-R[C];break;case w.DOUBLESIDE:for(var B=_.length,L=B/3,z=0;z<B;z++)_[B+z]=_[z];for(g=0;g<P;g+=3)O[g+P]=O[g+2]+L,O[g+1+P]=O[g+1]+L,O[g+2+P]=O[g]+L;for(C=0;C<F;C++)R[F+C]=-R[C];var X=I.length,G=0;for(G=0;G<X;G++)I[G+X]=I[G];for(y=y||new T.f(0,0,1,1),p=p||new T.f(0,0,1,1),G=0,g=0;g<X/2;g++)I[G]=y.x+(y.z-y.x)*I[G],I[G+1]=y.y+(y.w-y.y)*I[G+1],I[G+X]=p.x+(p.z-p.x)*I[G+X],I[G+X+1]=p.y+(p.w-p.y)*I[G+X+1],G+=2}},w.ImportVertexData=function(S,_){var O=new w,R=S.positions;R&&O.set(R,m.b.PositionKind);var I=S.normals;I&&O.set(I,m.b.NormalKind);var y=S.tangents;y&&O.set(y,m.b.TangentKind);var p=S.uvs;p&&O.set(p,m.b.UVKind);var g=S.uv2s;g&&O.set(g,m.b.UV2Kind);var C=S.uv3s;C&&O.set(C,m.b.UV3Kind);var P=S.uv4s;P&&O.set(P,m.b.UV4Kind);var F=S.uv5s;F&&O.set(F,m.b.UV5Kind);var U=S.uv6s;U&&O.set(U,m.b.UV6Kind);var B=S.colors;B&&O.set(d.b.CheckColors4(B,R.length/3),m.b.ColorKind);var L=S.matricesIndices;L&&O.set(L,m.b.MatricesIndicesKind);var z=S.matricesWeights;z&&O.set(z,m.b.MatricesWeightsKind);var X=S.indices;X&&(O.indices=X),_.setAllVerticesData(O,S.updatable)},w.FRONTSIDE=0,w.BACKSIDE=1,w.DOUBLESIDE=2,w.DEFAULTSIDE=0,w}()},function(f,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return E});var T=c(1),m=function(){function d(){}return d.NAME_EFFECTLAYER="EffectLayer",d.NAME_LAYER="Layer",d.NAME_LENSFLARESYSTEM="LensFlareSystem",d.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",d.NAME_PARTICLESYSTEM="ParticleSystem",d.NAME_GAMEPAD="Gamepad",d.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",d.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",d.NAME_PREPASSRENDERER="PrePassRenderer",d.NAME_DEPTHRENDERER="DepthRenderer",d.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",d.NAME_SPRITE="Sprite",d.NAME_SUBSURFACE="SubSurface",d.NAME_OUTLINERENDERER="Outline",d.NAME_PROCEDURALTEXTURE="ProceduralTexture",d.NAME_SHADOWGENERATOR="ShadowGenerator",d.NAME_OCTREE="Octree",d.NAME_PHYSICSENGINE="PhysicsEngine",d.NAME_AUDIO="Audio",d.STEP_ISREADYFORMESH_EFFECTLAYER=0,d.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,d.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,d.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,d.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,d.STEP_BEFORECAMERADRAW_LAYER=1,d.STEP_BEFORECAMERADRAW_PREPASS=2,d.STEP_BEFORERENDERTARGETDRAW_LAYER=0,d.STEP_BEFORERENDERINGMESH_PREPASS=0,d.STEP_BEFORERENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGMESH_PREPASS=0,d.STEP_AFTERRENDERINGMESH_OUTLINE=1,d.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,d.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,d.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,d.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,d.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,d.STEP_AFTERRENDERTARGETDRAW_LAYER=0,d.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,d.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,d.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,d.STEP_AFTERCAMERADRAW_LAYER=3,d.STEP_AFTERCAMERADRAW_PREPASS=4,d.STEP_AFTERRENDER_AUDIO=0,d.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,d.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,d.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,d.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,d.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,d.STEP_BEFORECLEARSTAGE_PREPASS=0,d.STEP_POINTERMOVE_SPRITE=0,d.STEP_POINTERDOWN_SPRITE=0,d.STEP_POINTERUP_SPRITE=0,d}(),E=function(d){function x(M){return d.apply(this,M)||this}return Object(T.d)(x,d),x.Create=function(){return Object.create(x.prototype)},x.prototype.registerStep=function(M,w,S){var _=0;for(Number.MAX_VALUE;_<this.length&&!(M<this[_].index);_++);this.splice(_,0,{index:M,component:w,action:S.bind(w)})},x.prototype.clear=function(){this.length=0},x}(Array)},function(f,s,c){c.d(s,"a",function(){return E}),c.d(s,"c",function(){return d}),c.d(s,"d",function(){return x}),c.d(s,"b",function(){return M});var T=c(1),m=c(0),E=function(){function w(){}return w.POINTERDOWN=1,w.POINTERUP=2,w.POINTERMOVE=4,w.POINTERWHEEL=8,w.POINTERPICK=16,w.POINTERTAP=32,w.POINTERDOUBLETAP=64,w}(),d=function(w,S){this.type=w,this.event=S},x=function(w){function S(_,O,R,I){var y=w.call(this,_,O)||this;return y.ray=null,y.skipOnPointerObservable=!1,y.localPosition=new m.d(R,I),y}return Object(T.d)(S,w),S}(d),M=function(w){function S(_,O,R){var I=w.call(this,_,O)||this;return I.pickInfo=R,I}return Object(T.d)(S,w),S}(d)},function(f,s,c){c.d(s,"a",function(){return E});var T=c(13),m=c(2),E=function(){function d(){}return Object.defineProperty(d,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(x){this._DiffuseTextureEnabled!==x&&(this._DiffuseTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(x){this._DetailTextureEnabled!==x&&(this._DetailTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(x){this._AmbientTextureEnabled!==x&&(this._AmbientTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(x){this._OpacityTextureEnabled!==x&&(this._OpacityTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(x){this._ReflectionTextureEnabled!==x&&(this._ReflectionTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(x){this._EmissiveTextureEnabled!==x&&(this._EmissiveTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(x){this._SpecularTextureEnabled!==x&&(this._SpecularTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(x){this._BumpTextureEnabled!==x&&(this._BumpTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(x){this._LightmapTextureEnabled!==x&&(this._LightmapTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(x){this._RefractionTextureEnabled!==x&&(this._RefractionTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(x){this._ColorGradingTextureEnabled!==x&&(this._ColorGradingTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(x){this._FresnelEnabled!==x&&(this._FresnelEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_FresnelDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(x){this._ClearCoatTextureEnabled!==x&&(this._ClearCoatTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(x){this._ClearCoatBumpTextureEnabled!==x&&(this._ClearCoatBumpTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(x){this._ClearCoatTintTextureEnabled!==x&&(this._ClearCoatTintTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(x){this._SheenTextureEnabled!==x&&(this._SheenTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(x){this._AnisotropicTextureEnabled!==x&&(this._AnisotropicTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(x){this._ThicknessTextureEnabled!==x&&(this._ThicknessTextureEnabled=x,T.a.MarkAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),d._DiffuseTextureEnabled=!0,d._DetailTextureEnabled=!0,d._AmbientTextureEnabled=!0,d._OpacityTextureEnabled=!0,d._ReflectionTextureEnabled=!0,d._EmissiveTextureEnabled=!0,d._SpecularTextureEnabled=!0,d._BumpTextureEnabled=!0,d._LightmapTextureEnabled=!0,d._RefractionTextureEnabled=!0,d._ColorGradingTextureEnabled=!0,d._FresnelEnabled=!0,d._ClearCoatTextureEnabled=!0,d._ClearCoatBumpTextureEnabled=!0,d._ClearCoatTintTextureEnabled=!0,d._SheenTextureEnabled=!0,d._AnisotropicTextureEnabled=!0,d._ThicknessTextureEnabled=!0,d}()},function(f,s,c){c.d(s,"a",function(){return le});var T=c(1),m=c(12),E=c(57),d=c(6),x=c(33),M=c(112),w=c(37),S=c(0),_=c(46),O=c(31),R=c(24),I=c(35),y=c(42),p=c(85),g=c(48),C=c(54),P=c(47),F=c(95),U=c(96),B=c(17),L=c(2),z=c(38),X=c(8),G=c(22),ee=c(21),$=c(18),fe=c(91),me=c(66),ve=function(){function re(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(re.prototype,"singleClick",{get:function(){return this._singleClick},set:function(Q){this._singleClick=Q},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(Q){this._doubleClick=Q},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(Q){this._hasSwiped=Q},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"ignore",{get:function(){return this._ignore},set:function(Q){this._ignore=Q},enumerable:!1,configurable:!0}),re}(),be=function(){function re(Q){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new S.d(0,0),this._previousStartingPointerPosition=new S.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=Q}return Object.defineProperty(re.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),re.prototype.getMeshUnderPointerByPointerId=function(Q){return this._meshUnderPointerId[Q]},Object.defineProperty(re.prototype,"unTranslatedPointer",{get:function(){return new S.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"pointerX",{get:function(){return this._pointerX},set:function(Q){this._pointerX=Q},enumerable:!1,configurable:!0}),Object.defineProperty(re.prototype,"pointerY",{get:function(){return this._pointerY},set:function(Q){this._pointerY=Q},enumerable:!1,configurable:!0}),re.prototype._updatePointerPosition=function(Q){var W=this._scene.getEngine().getInputElementClientRect();W&&(this._pointerX=Q.clientX-W.left,this._pointerY=Q.clientY-W.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},re.prototype._processPointerMove=function(Q,W){var Y=this._scene,q=Y.getEngine(),ae=q.getInputElement();if(ae){ae.tabIndex=q.canvasTabIndex,Y.doNotHandleCursors||(ae.style.cursor=Y.defaultCursor);var pe=!!(Q&&Q.hit&&Q.pickedMesh);pe?(Y.setPointerOverMesh(Q.pickedMesh,W.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(Y.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?ae.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:ae.style.cursor=Y.hoverCursor))):Y.setPointerOverMesh(null,W.pointerId);for(var De=0,de=Y._pointerMoveStage;De<de.length;De++)Q=de[De].action(this._unTranslatedPointerX,this._unTranslatedPointerY,Q,pe,ae);if(Q){var ge=W.type===this._wheelEventName?$.a.POINTERWHEEL:$.a.POINTERMOVE;if(Y.onPointerMove&&Y.onPointerMove(W,Q,ge),Y.onPointerObservable.hasObservers()){var ne=new $.b(ge,W,Q);this._setRayOnPointerInfo(ne),Y.onPointerObservable.notifyObservers(ne,ge)}}}},re.prototype._setRayOnPointerInfo=function(Q){var W=this._scene;Q.pickInfo&&!Q.pickInfo._pickingUnavailable&&(Q.pickInfo.ray||(Q.pickInfo.ray=W.createPickingRay(Q.event.offsetX,Q.event.offsetY,S.a.Identity(),W.activeCamera)))},re.prototype._checkPrePointerObservable=function(Q,W,Y){var q=this._scene,ae=new $.d(Y,W,this._unTranslatedPointerX,this._unTranslatedPointerY);return Q&&(ae.ray=Q.ray),q.onPrePointerObservable.notifyObservers(ae,Y),!!ae.skipOnPointerObservable},re.prototype.simulatePointerMove=function(Q,W){var Y=new PointerEvent("pointermove",W);this._checkPrePointerObservable(Q,Y,$.a.POINTERMOVE)||this._processPointerMove(Q,Y)},re.prototype.simulatePointerDown=function(Q,W){var Y=new PointerEvent("pointerdown",W);this._checkPrePointerObservable(Q,Y,$.a.POINTERDOWN)||this._processPointerDown(Q,Y)},re.prototype._processPointerDown=function(Q,W){var Y=this,q=this._scene;if(Q&&Q.hit&&Q.pickedMesh){this._pickedDownMesh=Q.pickedMesh;var ae=Q.pickedMesh._getActionManagerForTrigger();if(ae){if(ae.hasPickTriggers)switch(ae.processTrigger(L.a.ACTION_OnPickDownTrigger,P.a.CreateNew(Q.pickedMesh,W)),W.button){case 0:ae.processTrigger(L.a.ACTION_OnLeftPickTrigger,P.a.CreateNew(Q.pickedMesh,W));break;case 1:ae.processTrigger(L.a.ACTION_OnCenterPickTrigger,P.a.CreateNew(Q.pickedMesh,W));break;case 2:ae.processTrigger(L.a.ACTION_OnRightPickTrigger,P.a.CreateNew(Q.pickedMesh,W))}ae.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var ne=q.pick(Y._unTranslatedPointerX,Y._unTranslatedPointerY,function(Te){return Te.isPickable&&Te.isVisible&&Te.isReady()&&Te.actionManager&&Te.actionManager.hasSpecificTrigger(L.a.ACTION_OnLongPressTrigger)&&Te==Y._pickedDownMesh},!1,q.cameraToUseForPointers);ne&&ne.hit&&ne.pickedMesh&&ae&&Y._totalPointersPressed!==0&&Date.now()-Y._startingPointerTime>re.LongPressDelay&&!Y._isPointerSwiping()&&(Y._startingPointerTime=0,ae.processTrigger(L.a.ACTION_OnLongPressTrigger,P.a.CreateNew(ne.pickedMesh,W)))},re.LongPressDelay)}}else for(var pe=0,De=q._pointerDownStage;pe<De.length;pe++)Q=De[pe].action(this._unTranslatedPointerX,this._unTranslatedPointerY,Q,W);if(Q){var de=$.a.POINTERDOWN;if(q.onPointerDown&&q.onPointerDown(W,Q,de),q.onPointerObservable.hasObservers()){var ge=new $.b(de,W,Q);this._setRayOnPointerInfo(ge),q.onPointerObservable.notifyObservers(ge,de)}}},re.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>re.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>re.DragMovementThreshold},re.prototype.simulatePointerUp=function(Q,W,Y){var q=new PointerEvent("pointerup",W),ae=new ve;Y?ae.doubleClick=!0:ae.singleClick=!0,this._checkPrePointerObservable(Q,q,$.a.POINTERUP)||this._processPointerUp(Q,q,ae)},re.prototype._processPointerUp=function(Q,W,Y){var q=this._scene;if(Q&&Q&&Q.pickedMesh){if(this._pickedUpMesh=Q.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(q.onPointerPick&&q.onPointerPick(W,Q),Y.singleClick&&!Y.ignore&&q.onPointerObservable.hasObservers())){var ae=$.a.POINTERPICK,pe=new $.b(ae,W,Q);this._setRayOnPointerInfo(pe),q.onPointerObservable.notifyObservers(pe,ae)}var De=Q.pickedMesh._getActionManagerForTrigger();if(De&&!Y.ignore){De.processTrigger(L.a.ACTION_OnPickUpTrigger,P.a.CreateNew(Q.pickedMesh,W)),!Y.hasSwiped&&Y.singleClick&&De.processTrigger(L.a.ACTION_OnPickTrigger,P.a.CreateNew(Q.pickedMesh,W));var de=Q.pickedMesh._getActionManagerForTrigger(L.a.ACTION_OnDoublePickTrigger);Y.doubleClick&&de&&de.processTrigger(L.a.ACTION_OnDoublePickTrigger,P.a.CreateNew(Q.pickedMesh,W))}}else if(!Y.ignore)for(var ge=0,ne=q._pointerUpStage;ge<ne.length;ge++)Q=ne[ge].action(this._unTranslatedPointerX,this._unTranslatedPointerY,Q,W);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var Te=this._pickedDownMesh._getActionManagerForTrigger(L.a.ACTION_OnPickOutTrigger);Te&&Te.processTrigger(L.a.ACTION_OnPickOutTrigger,P.a.CreateNew(this._pickedDownMesh,W))}var we=0;q.onPointerObservable.hasObservers()&&(!Y.ignore&&!Y.hasSwiped&&(Y.singleClick&&q.onPointerObservable.hasSpecificMask($.a.POINTERTAP)?we=$.a.POINTERTAP:Y.doubleClick&&q.onPointerObservable.hasSpecificMask($.a.POINTERDOUBLETAP)&&(we=$.a.POINTERDOUBLETAP),we)&&(pe=new $.b(we,W,Q),this._setRayOnPointerInfo(pe),q.onPointerObservable.notifyObservers(pe,we)),Y.ignore||(we=$.a.POINTERUP,pe=new $.b(we,W,Q),this._setRayOnPointerInfo(pe),q.onPointerObservable.notifyObservers(pe,we))),q.onPointerUp&&!Y.ignore&&q.onPointerUp(W,Q,we)},re.prototype.isPointerCaptured=function(Q){return Q===void 0&&(Q=0),this._pointerCaptures[Q]},re.prototype.attachControl=function(Q,W,Y,q){var ae=this;Q===void 0&&(Q=!0),W===void 0&&(W=!0),Y===void 0&&(Y=!0),q===void 0&&(q=null);var pe=this._scene;if(q||(q=pe.getEngine().getInputElement()),q){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=q;var De=pe.getEngine();this._initActionManager=function(Te,we){if(!ae._meshPickProceed){var Se=pe.pick(ae._unTranslatedPointerX,ae._unTranslatedPointerY,pe.pointerDownPredicate,!1,pe.cameraToUseForPointers);ae._currentPickResult=Se,Se&&(Te=Se.hit&&Se.pickedMesh?Se.pickedMesh._getActionManagerForTrigger():null),ae._meshPickProceed=!0}return Te},this._delayedSimpleClick=function(Te,we,Se){(Date.now()-ae._previousStartingPointerTime>re.DoubleClickDelay&&!ae._doubleClickOccured||Te!==ae._previousButtonPressed)&&(ae._doubleClickOccured=!1,we.singleClick=!0,we.ignore=!1,Se(we,ae._currentPickResult))},this._initClickEvent=function(Te,we,Se,Ge){var $e=new ve;ae._currentPickResult=null;var nt=null,et=Te.hasSpecificMask($.a.POINTERPICK)||we.hasSpecificMask($.a.POINTERPICK)||Te.hasSpecificMask($.a.POINTERTAP)||we.hasSpecificMask($.a.POINTERTAP)||Te.hasSpecificMask($.a.POINTERDOUBLETAP)||we.hasSpecificMask($.a.POINTERDOUBLETAP);!et&&fe.a&&(nt=ae._initActionManager(nt,$e))&&(et=nt.hasPickTriggers);var Ze=!1;if(et){var ht=Se.button;if($e.hasSwiped=ae._isPointerSwiping(),!$e.hasSwiped){var gt=!re.ExclusiveDoubleClickMode;gt||(gt=!Te.hasSpecificMask($.a.POINTERDOUBLETAP)&&!we.hasSpecificMask($.a.POINTERDOUBLETAP))&&!fe.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(nt=ae._initActionManager(nt,$e))&&(gt=!nt.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),gt?(Date.now()-ae._previousStartingPointerTime>re.DoubleClickDelay||ht!==ae._previousButtonPressed)&&($e.singleClick=!0,Ge($e,ae._currentPickResult),Ze=!0):(ae._previousDelayedSimpleClickTimeout=ae._delayedSimpleClickTimeout,ae._delayedSimpleClickTimeout=window.setTimeout(ae._delayedSimpleClick.bind(ae,ht,$e,Ge),re.DoubleClickDelay));var Rt=Te.hasSpecificMask($.a.POINTERDOUBLETAP)||we.hasSpecificMask($.a.POINTERDOUBLETAP);!Rt&&fe.a.HasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)&&(nt=ae._initActionManager(nt,$e))&&(Rt=nt.hasSpecificTrigger(L.a.ACTION_OnDoublePickTrigger)),Rt&&(ht===ae._previousButtonPressed&&Date.now()-ae._previousStartingPointerTime<re.DoubleClickDelay&&!ae._doubleClickOccured?($e.hasSwiped||ae._isPointerSwiping()?(ae._doubleClickOccured=!1,ae._previousStartingPointerTime=ae._startingPointerTime,ae._previousStartingPointerPosition.x=ae._startingPointerPosition.x,ae._previousStartingPointerPosition.y=ae._startingPointerPosition.y,ae._previousButtonPressed=ht,re.ExclusiveDoubleClickMode?(ae._previousDelayedSimpleClickTimeout&&clearTimeout(ae._previousDelayedSimpleClickTimeout),ae._previousDelayedSimpleClickTimeout=ae._delayedSimpleClickTimeout,Ge($e,ae._previousPickResult)):Ge($e,ae._currentPickResult)):(ae._previousStartingPointerTime=0,ae._doubleClickOccured=!0,$e.doubleClick=!0,$e.ignore=!1,re.ExclusiveDoubleClickMode&&ae._previousDelayedSimpleClickTimeout&&clearTimeout(ae._previousDelayedSimpleClickTimeout),ae._previousDelayedSimpleClickTimeout=ae._delayedSimpleClickTimeout,Ge($e,ae._currentPickResult)),Ze=!0):(ae._doubleClickOccured=!1,ae._previousStartingPointerTime=ae._startingPointerTime,ae._previousStartingPointerPosition.x=ae._startingPointerPosition.x,ae._previousStartingPointerPosition.y=ae._startingPointerPosition.y,ae._previousButtonPressed=ht))}}Ze||Ge($e,ae._currentPickResult)},this._onPointerMove=function(Te){if(Te.pointerId===void 0&&(Te.pointerId=0),ae._updatePointerPosition(Te),!ae._checkPrePointerObservable(null,Te,Te.type===ae._wheelEventName?$.a.POINTERWHEEL:$.a.POINTERMOVE)&&(pe.cameraToUseForPointers||pe.activeCamera)){pe.pointerMovePredicate||(pe.pointerMovePredicate=function(Se){return Se.isPickable&&Se.isVisible&&Se.isReady()&&Se.isEnabled()&&(Se.enablePointerMoveEvents||pe.constantlyUpdateMeshUnderPointer||Se._getActionManagerForTrigger()!=null)&&(!pe.cameraToUseForPointers||(pe.cameraToUseForPointers.layerMask&Se.layerMask)!=0)});var we=pe.pick(ae._unTranslatedPointerX,ae._unTranslatedPointerY,pe.pointerMovePredicate,!1,pe.cameraToUseForPointers);ae._processPointerMove(we,Te)}},this._onPointerDown=function(Te){if(ae._totalPointersPressed++,ae._pickedDownMesh=null,ae._meshPickProceed=!1,Te.pointerId===void 0&&(Te.pointerId=0),ae._updatePointerPosition(Te),pe.preventDefaultOnPointerDown&&q&&(Te.preventDefault(),q.focus()),ae._startingPointerPosition.x=ae._pointerX,ae._startingPointerPosition.y=ae._pointerY,ae._startingPointerTime=Date.now(),!ae._checkPrePointerObservable(null,Te,$.a.POINTERDOWN)&&(pe.cameraToUseForPointers||pe.activeCamera)){ae._pointerCaptures[Te.pointerId]=!0,pe.pointerDownPredicate||(pe.pointerDownPredicate=function(Se){return Se.isPickable&&Se.isVisible&&Se.isReady()&&Se.isEnabled()&&(!pe.cameraToUseForPointers||(pe.cameraToUseForPointers.layerMask&Se.layerMask)!=0)}),ae._pickedDownMesh=null;var we=pe.pick(ae._unTranslatedPointerX,ae._unTranslatedPointerY,pe.pointerDownPredicate,!1,pe.cameraToUseForPointers);ae._processPointerDown(we,Te)}},this._onPointerUp=function(Te){ae._totalPointersPressed!==0&&(ae._totalPointersPressed--,ae._pickedUpMesh=null,ae._meshPickProceed=!1,Te.pointerId===void 0&&(Te.pointerId=0),ae._updatePointerPosition(Te),pe.preventDefaultOnPointerUp&&q&&(Te.preventDefault(),q.focus()),ae._initClickEvent(pe.onPrePointerObservable,pe.onPointerObservable,Te,function(we,Se){pe.onPrePointerObservable.hasObservers()&&!we.ignore&&(!we.hasSwiped&&(we.singleClick&&pe.onPrePointerObservable.hasSpecificMask($.a.POINTERTAP)&&ae._checkPrePointerObservable(null,Te,$.a.POINTERTAP)||we.doubleClick&&pe.onPrePointerObservable.hasSpecificMask($.a.POINTERDOUBLETAP)&&ae._checkPrePointerObservable(null,Te,$.a.POINTERDOUBLETAP))||ae._checkPrePointerObservable(null,Te,$.a.POINTERUP))||ae._pointerCaptures[Te.pointerId]&&(ae._pointerCaptures[Te.pointerId]=!1,(pe.cameraToUseForPointers||pe.activeCamera)&&(pe.pointerUpPredicate||(pe.pointerUpPredicate=function(Ge){return Ge.isPickable&&Ge.isVisible&&Ge.isReady()&&Ge.isEnabled()&&(!pe.cameraToUseForPointers||(pe.cameraToUseForPointers.layerMask&Ge.layerMask)!=0)}),!ae._meshPickProceed&&(fe.a&&fe.a.HasTriggers||pe.onPointerObservable.hasObservers())&&ae._initActionManager(null,we),Se||(Se=ae._currentPickResult),ae._processPointerUp(Se,Te,we),ae._previousPickResult=ae._currentPickResult))}))},this._onKeyDown=function(Te){var we=me.a.KEYDOWN;if(pe.onPreKeyboardObservable.hasObservers()){var Se=new me.c(we,Te);if(pe.onPreKeyboardObservable.notifyObservers(Se,we),Se.skipOnPointerObservable)return}pe.onKeyboardObservable.hasObservers()&&(Se=new me.b(we,Te),pe.onKeyboardObservable.notifyObservers(Se,we)),pe.actionManager&&pe.actionManager.processTrigger(L.a.ACTION_OnKeyDownTrigger,P.a.CreateNewFromScene(pe,Te))},this._onKeyUp=function(Te){var we=me.a.KEYUP;if(pe.onPreKeyboardObservable.hasObservers()){var Se=new me.c(we,Te);if(pe.onPreKeyboardObservable.notifyObservers(Se,we),Se.skipOnPointerObservable)return}pe.onKeyboardObservable.hasObservers()&&(Se=new me.b(we,Te),pe.onKeyboardObservable.notifyObservers(Se,we)),pe.actionManager&&pe.actionManager.processTrigger(L.a.ACTION_OnKeyUpTrigger,P.a.CreateNewFromScene(pe,Te))};var de=function(){q&&!ae._keyboardIsAttached&&(q.addEventListener("keydown",ae._onKeyDown,!1),q.addEventListener("keyup",ae._onKeyUp,!1),ae._keyboardIsAttached=!0)};this._onCanvasFocusObserver=De.onCanvasFocusObservable.add((document.activeElement===q&&de(),de)),this._onCanvasBlurObserver=De.onCanvasBlurObservable.add(function(){q&&(q.removeEventListener("keydown",ae._onKeyDown),q.removeEventListener("keyup",ae._onKeyUp),ae._keyboardIsAttached=!1)}),de();var ge=m.b.GetPointerPrefix(De);if(Y&&(q.addEventListener(ge+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",q.addEventListener(this._wheelEventName,this._onPointerMove,!1)),W&&q.addEventListener(ge+"down",this._onPointerDown,!1),Q){var ne=pe.getEngine().getHostWindow();ne&&ne.addEventListener(ge+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},re.prototype.detachControl=function(){var Q=this._scene.getEngine(),W=m.b.GetPointerPrefix(Q);this._alreadyAttachedTo&&this._alreadyAttached&&(this._alreadyAttachedTo.removeEventListener(W+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(W+"down",this._onPointerDown),window.removeEventListener(W+"up",this._onPointerUp),this._onCanvasBlurObserver&&Q.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&Q.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},re.prototype.setPointerOverMesh=function(Q,W){if(W===void 0&&(W=0),W<0&&(W=0),this._meshUnderPointerId[W]!==Q){var Y,q=this._meshUnderPointerId[W];q&&(Y=q._getActionManagerForTrigger(L.a.ACTION_OnPointerOutTrigger))&&Y.processTrigger(L.a.ACTION_OnPointerOutTrigger,P.a.CreateNew(q,void 0,{pointerId:W})),this._meshUnderPointerId[W]=Q,this._pointerOverMesh=Q,(q=this._meshUnderPointerId[W])&&(Y=q._getActionManagerForTrigger(L.a.ACTION_OnPointerOverTrigger))&&Y.processTrigger(L.a.ACTION_OnPointerOverTrigger,P.a.CreateNew(q,void 0,{pointerId:W}))}},re.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},re.DragMovementThreshold=10,re.LongPressDelay=500,re.DoubleClickDelay=300,re.ExclusiveDoubleClickMode=!1,re}(),ie=c(55),se=c(9),V=c(90),K=c(152),Z=c(56),le=function(re){function Q(W,Y){var q=re.call(this)||this;q._inputManager=new be(q),q.cameraToUseForPointers=null,q._isScene=!0,q._blockEntityCollection=!1,q.autoClear=!0,q.autoClearDepthAndStencil=!0,q.clearColor=new se.b(.2,.2,.3,1),q.ambientColor=new se.a(0,0,0),q._environmentIntensity=1,q._forceWireframe=!1,q._skipFrustumClipping=!1,q._forcePointsCloud=!1,q.animationsEnabled=!0,q._animationPropertiesOverride=null,q.useConstantAnimationDeltaTime=!1,q.constantlyUpdateMeshUnderPointer=!1,q.hoverCursor="pointer",q.defaultCursor="",q.doNotHandleCursors=!1,q.preventDefaultOnPointerDown=!0,q.preventDefaultOnPointerUp=!0,q.metadata=null,q.reservedDataStore=null,q.disableOfflineSupportExceptionRules=new Array,q.onDisposeObservable=new d.c,q._onDisposeObserver=null,q.onBeforeRenderObservable=new d.c,q._onBeforeRenderObserver=null,q.onAfterRenderObservable=new d.c,q.onAfterRenderCameraObservable=new d.c,q._onAfterRenderObserver=null,q.onBeforeAnimationsObservable=new d.c,q.onAfterAnimationsObservable=new d.c,q.onBeforeDrawPhaseObservable=new d.c,q.onAfterDrawPhaseObservable=new d.c,q.onReadyObservable=new d.c,q.onBeforeCameraRenderObservable=new d.c,q._onBeforeCameraRenderObserver=null,q.onAfterCameraRenderObservable=new d.c,q._onAfterCameraRenderObserver=null,q.onBeforeActiveMeshesEvaluationObservable=new d.c,q.onAfterActiveMeshesEvaluationObservable=new d.c,q.onBeforeParticlesRenderingObservable=new d.c,q.onAfterParticlesRenderingObservable=new d.c,q.onDataLoadedObservable=new d.c,q.onNewCameraAddedObservable=new d.c,q.onCameraRemovedObservable=new d.c,q.onNewLightAddedObservable=new d.c,q.onLightRemovedObservable=new d.c,q.onNewGeometryAddedObservable=new d.c,q.onGeometryRemovedObservable=new d.c,q.onNewTransformNodeAddedObservable=new d.c,q.onTransformNodeRemovedObservable=new d.c,q.onNewMeshAddedObservable=new d.c,q.onMeshRemovedObservable=new d.c,q.onNewSkeletonAddedObservable=new d.c,q.onSkeletonRemovedObservable=new d.c,q.onNewMaterialAddedObservable=new d.c,q.onNewMultiMaterialAddedObservable=new d.c,q.onMaterialRemovedObservable=new d.c,q.onMultiMaterialRemovedObservable=new d.c,q.onNewTextureAddedObservable=new d.c,q.onTextureRemovedObservable=new d.c,q.onBeforeRenderTargetsRenderObservable=new d.c,q.onAfterRenderTargetsRenderObservable=new d.c,q.onBeforeStepObservable=new d.c,q.onAfterStepObservable=new d.c,q.onActiveCameraChanged=new d.c,q.onBeforeRenderingGroupObservable=new d.c,q.onAfterRenderingGroupObservable=new d.c,q.onMeshImportedObservable=new d.c,q.onAnimationFileImportedObservable=new d.c,q._registeredForLateAnimationBindings=new x.b(256),q.onPrePointerObservable=new d.c,q.onPointerObservable=new d.c,q.onPreKeyboardObservable=new d.c,q.onKeyboardObservable=new d.c,q._useRightHandedSystem=!1,q._timeAccumulator=0,q._currentStepId=0,q._currentInternalStep=0,q._fogEnabled=!0,q._fogMode=Q.FOGMODE_NONE,q.fogColor=new se.a(.2,.2,.3),q.fogDensity=.1,q.fogStart=0,q.fogEnd=1e3,q.prePass=!1,q._shadowsEnabled=!0,q._lightsEnabled=!0,q.activeCameras=new Array,q._texturesEnabled=!0,q.physicsEnabled=!0,q.particlesEnabled=!0,q.spritesEnabled=!0,q._skeletonsEnabled=!0,q.lensFlaresEnabled=!0,q.collisionsEnabled=!0,q.gravity=new S.e(0,-9.807,0),q.postProcessesEnabled=!0,q.renderTargetsEnabled=!0,q.dumpNextRenderTargets=!1,q.customRenderTargets=new Array,q.importedMeshesFiles=new Array,q.probesEnabled=!0,q._meshesForIntersections=new x.b(256),q.proceduralTexturesEnabled=!0,q._totalVertices=new ie.a,q._activeIndices=new ie.a,q._activeParticles=new ie.a,q._activeBones=new ie.a,q._animationTime=0,q.animationTimeScale=1,q._renderId=0,q._frameId=0,q._executeWhenReadyTimeoutId=-1,q._intermediateRendering=!1,q._viewUpdateFlag=-1,q._projectionUpdateFlag=-1,q._toBeDisposed=new Array(256),q._activeRequests=new Array,q._pendingData=new Array,q._isDisposed=!1,q.dispatchAllSubMeshesOfActiveMeshes=!1,q._activeMeshes=new x.a(256),q._processedMaterials=new x.a(256),q._renderTargets=new x.b(256),q._activeParticleSystems=new x.a(256),q._activeSkeletons=new x.b(32),q._softwareSkinnedMeshes=new x.b(32),q._activeAnimatables=new Array,q._transformMatrix=S.a.Zero(),q.requireLightSorting=!1,q._components=[],q._serializableComponents=[],q._transientComponents=[],q._beforeCameraUpdateStage=B.b.Create(),q._beforeClearStage=B.b.Create(),q._gatherRenderTargetsStage=B.b.Create(),q._gatherActiveCameraRenderTargetsStage=B.b.Create(),q._isReadyForMeshStage=B.b.Create(),q._beforeEvaluateActiveMeshStage=B.b.Create(),q._evaluateSubMeshStage=B.b.Create(),q._preActiveMeshStage=B.b.Create(),q._cameraDrawRenderTargetStage=B.b.Create(),q._beforeCameraDrawStage=B.b.Create(),q._beforeRenderTargetDrawStage=B.b.Create(),q._beforeRenderingGroupDrawStage=B.b.Create(),q._beforeRenderingMeshStage=B.b.Create(),q._afterRenderingMeshStage=B.b.Create(),q._afterRenderingGroupDrawStage=B.b.Create(),q._afterCameraDrawStage=B.b.Create(),q._afterRenderTargetDrawStage=B.b.Create(),q._afterRenderStage=B.b.Create(),q._pointerMoveStage=B.b.Create(),q._pointerDownStage=B.b.Create(),q._pointerUpStage=B.b.Create(),q.geometriesByUniqueId=null,q._defaultMeshCandidates={data:[],length:0},q._defaultSubMeshCandidates={data:[],length:0},q._preventFreeActiveMeshesAndRenderingGroups=!1,q._activeMeshesFrozen=!1,q._skipEvaluateActiveMeshesCompletely=!1,q._allowPostProcessClearColor=!0,q.getDeterministicFrameTime=function(){return q._engine.getTimeStep()},q._blockMaterialDirtyMechanism=!1;var ae=Object(T.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},Y);return q._engine=W||G.a.LastCreatedEngine,ae.virtual||(G.a._LastCreatedScene=q,q._engine.scenes.push(q)),q._uid=null,q._renderingManager=new U.b(q),F.a&&(q.postProcessManager=new F.a(q)),z.a.IsWindowObjectExist()&&q.attachControl(),q._createUbo(),y.a&&(q._imageProcessingConfiguration=new y.a),q.setDefaultCandidateProviders(),ae.useGeometryUniqueIdsMap&&(q.geometriesByUniqueId={}),q.useMaterialMeshMap=ae.useMaterialMeshMap,q.useClonedMeshMap=ae.useClonedMeshMap,Y&&Y.virtual||q._engine.onNewSceneAddedObservable.notifyObservers(q),q}return Object(T.d)(Q,re),Q.DefaultMaterialFactory=function(W){throw ee.a.WarnImport("StandardMaterial")},Q.CollisionCoordinatorFactory=function(){throw ee.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(Q.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(W){this._environmentTexture!==W&&(this._environmentTexture=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(W){this._environmentIntensity!==W&&(this._environmentIntensity=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(W){this._forceWireframe!==W&&(this._forceWireframe=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(W){this._skipFrustumClipping!==W&&(this._skipFrustumClipping=W)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(W){this._forcePointsCloud!==W&&(this._forcePointsCloud=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(W){this._animationPropertiesOverride=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"onDispose",{set:function(W){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"beforeRender",{set:function(W){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),W&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(W))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"afterRender",{set:function(W){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),W&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(W))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"beforeCameraRender",{set:function(W){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"afterCameraRender",{set:function(W){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(W)},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(Q,"DragMovementThreshold",{get:function(){return be.DragMovementThreshold},set:function(W){be.DragMovementThreshold=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q,"LongPressDelay",{get:function(){return be.LongPressDelay},set:function(W){be.LongPressDelay=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q,"DoubleClickDelay",{get:function(){return be.DoubleClickDelay},set:function(W){be.DoubleClickDelay=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q,"ExclusiveDoubleClickMode",{get:function(){return be.ExclusiveDoubleClickMode},set:function(W){be.ExclusiveDoubleClickMode=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(W){this._useRightHandedSystem!==W&&(this._useRightHandedSystem=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Q.prototype.setStepId=function(W){this._currentStepId=W},Q.prototype.getStepId=function(){return this._currentStepId},Q.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(Q.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(W){this._fogEnabled!==W&&(this._fogEnabled=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"fogMode",{get:function(){return this._fogMode},set:function(W){this._fogMode!==W&&(this._fogMode=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(W){this._shadowsEnabled!==W&&(this._shadowsEnabled=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(W){this._lightsEnabled!==W&&(this._lightsEnabled=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_LightDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(W){W!==this._activeCamera&&(this._activeCamera=W,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=Q.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(W){this._defaultMaterial=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(W){this._texturesEnabled!==W&&(this._texturesEnabled=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(W){this._skeletonsEnabled!==W&&(this._skeletonsEnabled=W,this.markAllMaterialsAsDirty(L.a.MATERIAL_AttributesDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=Q.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),Q.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var W=0,Y=this._transientComponents;W<Y.length;W++)Y[W].register();this._transientComponents=[]}},Q.prototype._addComponent=function(W){this._components.push(W),this._transientComponents.push(W);var Y=W;Y.addFromContainer&&Y.serialize&&this._serializableComponents.push(Y)},Q.prototype._getComponent=function(W){for(var Y=0,q=this._components;Y<q.length;Y++){var ae=q[Y];if(ae.name===W)return ae}return null},Q.prototype.getClassName=function(){return"Scene"},Q.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},Q.prototype._getDefaultSubMeshCandidates=function(W){return this._defaultSubMeshCandidates.data=W.subMeshes,this._defaultSubMeshCandidates.length=W.subMeshes.length,this._defaultSubMeshCandidates},Q.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(Q.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(W){this._inputManager.pointerX=W},enumerable:!1,configurable:!0}),Object.defineProperty(Q.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(W){this._inputManager.pointerY=W},enumerable:!1,configurable:!0}),Q.prototype.getCachedMaterial=function(){return this._cachedMaterial},Q.prototype.getCachedEffect=function(){return this._cachedEffect},Q.prototype.getCachedVisibility=function(){return this._cachedVisibility},Q.prototype.isCachedMaterialInvalid=function(W,Y,q){return q===void 0&&(q=1),this._cachedEffect!==Y||this._cachedMaterial!==W||this._cachedVisibility!==q},Q.prototype.getEngine=function(){return this._engine},Q.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(Q.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),Q.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(Q.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),Q.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(Q.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),Q.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(Q.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),Q.prototype.getActiveMeshes=function(){return this._activeMeshes},Q.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},Q.prototype.getRenderId=function(){return this._renderId},Q.prototype.getFrameId=function(){return this._frameId},Q.prototype.incrementRenderId=function(){this._renderId++},Q.prototype._createUbo=function(){this._sceneUbo=new p.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},Q.prototype.simulatePointerMove=function(W,Y){return this._inputManager.simulatePointerMove(W,Y),this},Q.prototype.simulatePointerDown=function(W,Y){return this._inputManager.simulatePointerDown(W,Y),this},Q.prototype.simulatePointerUp=function(W,Y,q){return this._inputManager.simulatePointerUp(W,Y,q),this},Q.prototype.isPointerCaptured=function(W){return W===void 0&&(W=0),this._inputManager.isPointerCaptured(W)},Q.prototype.attachControl=function(W,Y,q){W===void 0&&(W=!0),Y===void 0&&(Y=!0),q===void 0&&(q=!0),this._inputManager.attachControl(W,Y,q)},Q.prototype.detachControl=function(){this._inputManager.detachControl()},Q.prototype.isReady=function(){if(this._isDisposed)return!1;var W,Y=this.getEngine();if(!Y.areAllEffectsReady()||this._pendingData.length>0)return!1;for(W=0;W<this.meshes.length;W++){var q=this.meshes[W];if(q.isEnabled()&&q.subMeshes&&q.subMeshes.length!==0){if(!q.isReady(!0))return!1;for(var ae=q.hasThinInstances||q.getClassName()==="InstancedMesh"||q.getClassName()==="InstancedLinesMesh"||Y.getCaps().instancedArrays&&q.instances.length>0,pe=0,De=this._isReadyForMeshStage;pe<De.length;pe++)if(!De[pe].action(q,ae))return!1}}for(W=0;W<this.geometries.length;W++)if(this.geometries[W].delayLoadState===L.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var de=0,ge=this.activeCameras;de<ge.length;de++)if(!ge[de].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var ne=0,Te=this.particleSystems;ne<Te.length;ne++)if(!Te[ne].isReady())return!1;return!0},Q.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},Q.prototype.registerBeforeRender=function(W){this.onBeforeRenderObservable.add(W)},Q.prototype.unregisterBeforeRender=function(W){this.onBeforeRenderObservable.removeCallback(W)},Q.prototype.registerAfterRender=function(W){this.onAfterRenderObservable.add(W)},Q.prototype.unregisterAfterRender=function(W){this.onAfterRenderObservable.removeCallback(W)},Q.prototype._executeOnceBeforeRender=function(W){var Y=this,q=function(){W(),setTimeout(function(){Y.unregisterBeforeRender(q)})};this.registerBeforeRender(q)},Q.prototype.executeOnceBeforeRender=function(W,Y){var q=this;Y!==void 0?setTimeout(function(){q._executeOnceBeforeRender(W)},Y):this._executeOnceBeforeRender(W)},Q.prototype._addPendingData=function(W){this._pendingData.push(W)},Q.prototype._removePendingData=function(W){var Y=this.isLoading,q=this._pendingData.indexOf(W);q!==-1&&this._pendingData.splice(q,1),Y&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},Q.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(Q.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),Q.prototype.executeWhenReady=function(W){var Y=this;this.onReadyObservable.add(W),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){Y._checkIsReady()},150))},Q.prototype.whenReadyAsync=function(){var W=this;return new Promise(function(Y){W.executeWhenReady(function(){Y()})})},Q.prototype._checkIsReady=function(){var W=this;return this._registerTransientComponents(),this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){W._checkIsReady()},150))},Object.defineProperty(Q.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),Q.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=E.a.Now},Q.prototype.getViewMatrix=function(){return this._viewMatrix},Q.prototype.getProjectionMatrix=function(){return this._projectionMatrix},Q.prototype.getTransformMatrix=function(){return this._transformMatrix},Q.prototype.setTransformMatrix=function(W,Y,q,ae){this._viewUpdateFlag===W.updateFlag&&this._projectionUpdateFlag===Y.updateFlag||(this._viewUpdateFlag=W.updateFlag,this._projectionUpdateFlag=Y.updateFlag,this._viewMatrix=W,this._projectionMatrix=Y,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?V.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=V.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(q,ae):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},Q.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},Q.prototype.getUniqueId=function(){return K.a.UniqueId},Q.prototype.addMesh=function(W,Y){var q=this;Y===void 0&&(Y=!1),this._blockEntityCollection||(this.meshes.push(W),W._resyncLightSources(),W.parent||W._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(W),Y&&W.getChildMeshes().forEach(function(ae){q.addMesh(ae)}))},Q.prototype.removeMesh=function(W,Y){var q=this;Y===void 0&&(Y=!1);var ae=this.meshes.indexOf(W);return ae!==-1&&(this.meshes[ae]=this.meshes[this.meshes.length-1],this.meshes.pop(),W.parent||W._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(W),Y&&W.getChildMeshes().forEach(function(pe){q.removeMesh(pe)}),ae},Q.prototype.addTransformNode=function(W){this._blockEntityCollection||(W._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(W),W.parent||W._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(W))},Q.prototype.removeTransformNode=function(W){var Y=W._indexInSceneTransformNodesArray;if(Y!==-1){if(Y!==this.transformNodes.length-1){var q=this.transformNodes[this.transformNodes.length-1];this.transformNodes[Y]=q,q._indexInSceneTransformNodesArray=Y}W._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),W.parent||W._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(W),Y},Q.prototype.removeSkeleton=function(W){var Y=this.skeletons.indexOf(W);return Y!==-1&&(this.skeletons.splice(Y,1),this.onSkeletonRemovedObservable.notifyObservers(W)),Y},Q.prototype.removeMorphTargetManager=function(W){var Y=this.morphTargetManagers.indexOf(W);return Y!==-1&&this.morphTargetManagers.splice(Y,1),Y},Q.prototype.removeLight=function(W){var Y=this.lights.indexOf(W);if(Y!==-1){for(var q=0,ae=this.meshes;q<ae.length;q++)ae[q]._removeLightSource(W,!1);this.lights.splice(Y,1),this.sortLightsByPriority(),W.parent||W._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(W),Y},Q.prototype.removeCamera=function(W){var Y=this.cameras.indexOf(W);if(Y!==-1&&(this.cameras.splice(Y,1),W.parent||W._removeFromSceneRootNodes()),this.activeCameras){var q=this.activeCameras.indexOf(W);q!==-1&&this.activeCameras.splice(q,1)}return this.activeCamera===W&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(W),Y},Q.prototype.removeParticleSystem=function(W){var Y=this.particleSystems.indexOf(W);return Y!==-1&&this.particleSystems.splice(Y,1),Y},Q.prototype.removeAnimation=function(W){var Y=this.animations.indexOf(W);return Y!==-1&&this.animations.splice(Y,1),Y},Q.prototype.stopAnimation=function(W,Y,q){},Q.prototype.removeAnimationGroup=function(W){var Y=this.animationGroups.indexOf(W);return Y!==-1&&this.animationGroups.splice(Y,1),Y},Q.prototype.removeMultiMaterial=function(W){var Y=this.multiMaterials.indexOf(W);return Y!==-1&&this.multiMaterials.splice(Y,1),this.onMultiMaterialRemovedObservable.notifyObservers(W),Y},Q.prototype.removeMaterial=function(W){var Y=W._indexInSceneMaterialArray;if(Y!==-1&&Y<this.materials.length){if(Y!==this.materials.length-1){var q=this.materials[this.materials.length-1];this.materials[Y]=q,q._indexInSceneMaterialArray=Y}W._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(W),Y},Q.prototype.removeActionManager=function(W){var Y=this.actionManagers.indexOf(W);return Y!==-1&&this.actionManagers.splice(Y,1),Y},Q.prototype.removeTexture=function(W){var Y=this.textures.indexOf(W);return Y!==-1&&this.textures.splice(Y,1),this.onTextureRemovedObservable.notifyObservers(W),Y},Q.prototype.addLight=function(W){if(!this._blockEntityCollection){this.lights.push(W),this.sortLightsByPriority(),W.parent||W._addToSceneRootNodes();for(var Y=0,q=this.meshes;Y<q.length;Y++){var ae=q[Y];ae.lightSources.indexOf(W)===-1&&(ae.lightSources.push(W),ae._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(W)}},Q.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(g.a.CompareLightsPriority)},Q.prototype.addCamera=function(W){this._blockEntityCollection||(this.cameras.push(W),this.onNewCameraAddedObservable.notifyObservers(W),W.parent||W._addToSceneRootNodes())},Q.prototype.addSkeleton=function(W){this._blockEntityCollection||(this.skeletons.push(W),this.onNewSkeletonAddedObservable.notifyObservers(W))},Q.prototype.addParticleSystem=function(W){this._blockEntityCollection||this.particleSystems.push(W)},Q.prototype.addAnimation=function(W){this._blockEntityCollection||this.animations.push(W)},Q.prototype.addAnimationGroup=function(W){this._blockEntityCollection||this.animationGroups.push(W)},Q.prototype.addMultiMaterial=function(W){this._blockEntityCollection||(this.multiMaterials.push(W),this.onNewMultiMaterialAddedObservable.notifyObservers(W))},Q.prototype.addMaterial=function(W){this._blockEntityCollection||(W._indexInSceneMaterialArray=this.materials.length,this.materials.push(W),this.onNewMaterialAddedObservable.notifyObservers(W))},Q.prototype.addMorphTargetManager=function(W){this._blockEntityCollection||this.morphTargetManagers.push(W)},Q.prototype.addGeometry=function(W){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[W.uniqueId]=this.geometries.length),this.geometries.push(W))},Q.prototype.addActionManager=function(W){this.actionManagers.push(W)},Q.prototype.addTexture=function(W){this._blockEntityCollection||(this.textures.push(W),this.onNewTextureAddedObservable.notifyObservers(W))},Q.prototype.switchActiveCamera=function(W,Y){Y===void 0&&(Y=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=W,Y&&W.attachControl())},Q.prototype.setActiveCameraByID=function(W){var Y=this.getCameraByID(W);return Y?(this.activeCamera=Y,Y):null},Q.prototype.setActiveCameraByName=function(W){var Y=this.getCameraByName(W);return Y?(this.activeCamera=Y,Y):null},Q.prototype.getAnimationGroupByName=function(W){for(var Y=0;Y<this.animationGroups.length;Y++)if(this.animationGroups[Y].name===W)return this.animationGroups[Y];return null},Q.prototype.getMaterialByUniqueID=function(W){for(var Y=0;Y<this.materials.length;Y++)if(this.materials[Y].uniqueId===W)return this.materials[Y];return null},Q.prototype.getMaterialByID=function(W){for(var Y=0;Y<this.materials.length;Y++)if(this.materials[Y].id===W)return this.materials[Y];return null},Q.prototype.getLastMaterialByID=function(W){for(var Y=this.materials.length-1;Y>=0;Y--)if(this.materials[Y].id===W)return this.materials[Y];return null},Q.prototype.getMaterialByName=function(W){for(var Y=0;Y<this.materials.length;Y++)if(this.materials[Y].name===W)return this.materials[Y];return null},Q.prototype.getTextureByUniqueID=function(W){for(var Y=0;Y<this.textures.length;Y++)if(this.textures[Y].uniqueId===W)return this.textures[Y];return null},Q.prototype.getCameraByID=function(W){for(var Y=0;Y<this.cameras.length;Y++)if(this.cameras[Y].id===W)return this.cameras[Y];return null},Q.prototype.getCameraByUniqueID=function(W){for(var Y=0;Y<this.cameras.length;Y++)if(this.cameras[Y].uniqueId===W)return this.cameras[Y];return null},Q.prototype.getCameraByName=function(W){for(var Y=0;Y<this.cameras.length;Y++)if(this.cameras[Y].name===W)return this.cameras[Y];return null},Q.prototype.getBoneByID=function(W){for(var Y=0;Y<this.skeletons.length;Y++)for(var q=this.skeletons[Y],ae=0;ae<q.bones.length;ae++)if(q.bones[ae].id===W)return q.bones[ae];return null},Q.prototype.getBoneByName=function(W){for(var Y=0;Y<this.skeletons.length;Y++)for(var q=this.skeletons[Y],ae=0;ae<q.bones.length;ae++)if(q.bones[ae].name===W)return q.bones[ae];return null},Q.prototype.getLightByName=function(W){for(var Y=0;Y<this.lights.length;Y++)if(this.lights[Y].name===W)return this.lights[Y];return null},Q.prototype.getLightByID=function(W){for(var Y=0;Y<this.lights.length;Y++)if(this.lights[Y].id===W)return this.lights[Y];return null},Q.prototype.getLightByUniqueID=function(W){for(var Y=0;Y<this.lights.length;Y++)if(this.lights[Y].uniqueId===W)return this.lights[Y];return null},Q.prototype.getParticleSystemByID=function(W){for(var Y=0;Y<this.particleSystems.length;Y++)if(this.particleSystems[Y].id===W)return this.particleSystems[Y];return null},Q.prototype.getGeometryByID=function(W){for(var Y=0;Y<this.geometries.length;Y++)if(this.geometries[Y].id===W)return this.geometries[Y];return null},Q.prototype._getGeometryByUniqueID=function(W){if(this.geometriesByUniqueId){var Y=this.geometriesByUniqueId[W];if(Y!==void 0)return this.geometries[Y]}else for(var q=0;q<this.geometries.length;q++)if(this.geometries[q].uniqueId===W)return this.geometries[q];return null},Q.prototype.pushGeometry=function(W,Y){return!(!Y&&this._getGeometryByUniqueID(W.uniqueId))&&(this.addGeometry(W),this.onNewGeometryAddedObservable.notifyObservers(W),!0)},Q.prototype.removeGeometry=function(W){var Y;if(this.geometriesByUniqueId){if((Y=this.geometriesByUniqueId[W.uniqueId])===void 0)return!1}else if((Y=this.geometries.indexOf(W))<0)return!1;if(Y!==this.geometries.length-1){var q=this.geometries[this.geometries.length-1];q&&(this.geometries[Y]=q,this.geometriesByUniqueId&&(this.geometriesByUniqueId[q.uniqueId]=Y,this.geometriesByUniqueId[W.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(W),!0},Q.prototype.getGeometries=function(){return this.geometries},Q.prototype.getMeshByID=function(W){for(var Y=0;Y<this.meshes.length;Y++)if(this.meshes[Y].id===W)return this.meshes[Y];return null},Q.prototype.getMeshesByID=function(W){return this.meshes.filter(function(Y){return Y.id===W})},Q.prototype.getTransformNodeByID=function(W){for(var Y=0;Y<this.transformNodes.length;Y++)if(this.transformNodes[Y].id===W)return this.transformNodes[Y];return null},Q.prototype.getTransformNodeByUniqueID=function(W){for(var Y=0;Y<this.transformNodes.length;Y++)if(this.transformNodes[Y].uniqueId===W)return this.transformNodes[Y];return null},Q.prototype.getTransformNodesByID=function(W){return this.transformNodes.filter(function(Y){return Y.id===W})},Q.prototype.getMeshByUniqueID=function(W){for(var Y=0;Y<this.meshes.length;Y++)if(this.meshes[Y].uniqueId===W)return this.meshes[Y];return null},Q.prototype.getLastMeshByID=function(W){for(var Y=this.meshes.length-1;Y>=0;Y--)if(this.meshes[Y].id===W)return this.meshes[Y];return null},Q.prototype.getLastEntryByID=function(W){var Y;for(Y=this.meshes.length-1;Y>=0;Y--)if(this.meshes[Y].id===W)return this.meshes[Y];for(Y=this.transformNodes.length-1;Y>=0;Y--)if(this.transformNodes[Y].id===W)return this.transformNodes[Y];for(Y=this.cameras.length-1;Y>=0;Y--)if(this.cameras[Y].id===W)return this.cameras[Y];for(Y=this.lights.length-1;Y>=0;Y--)if(this.lights[Y].id===W)return this.lights[Y];return null},Q.prototype.getNodeByID=function(W){var Y=this.getMeshByID(W);if(Y)return Y;var q=this.getTransformNodeByID(W);if(q)return q;var ae=this.getLightByID(W);if(ae)return ae;var pe=this.getCameraByID(W);if(pe)return pe;var De=this.getBoneByID(W);return De||null},Q.prototype.getNodeByName=function(W){var Y=this.getMeshByName(W);if(Y)return Y;var q=this.getTransformNodeByName(W);if(q)return q;var ae=this.getLightByName(W);if(ae)return ae;var pe=this.getCameraByName(W);if(pe)return pe;var De=this.getBoneByName(W);return De||null},Q.prototype.getMeshByName=function(W){for(var Y=0;Y<this.meshes.length;Y++)if(this.meshes[Y].name===W)return this.meshes[Y];return null},Q.prototype.getTransformNodeByName=function(W){for(var Y=0;Y<this.transformNodes.length;Y++)if(this.transformNodes[Y].name===W)return this.transformNodes[Y];return null},Q.prototype.getLastSkeletonByID=function(W){for(var Y=this.skeletons.length-1;Y>=0;Y--)if(this.skeletons[Y].id===W)return this.skeletons[Y];return null},Q.prototype.getSkeletonByUniqueId=function(W){for(var Y=0;Y<this.skeletons.length;Y++)if(this.skeletons[Y].uniqueId===W)return this.skeletons[Y];return null},Q.prototype.getSkeletonById=function(W){for(var Y=0;Y<this.skeletons.length;Y++)if(this.skeletons[Y].id===W)return this.skeletons[Y];return null},Q.prototype.getSkeletonByName=function(W){for(var Y=0;Y<this.skeletons.length;Y++)if(this.skeletons[Y].name===W)return this.skeletons[Y];return null},Q.prototype.getMorphTargetManagerById=function(W){for(var Y=0;Y<this.morphTargetManagers.length;Y++)if(this.morphTargetManagers[Y].uniqueId===W)return this.morphTargetManagers[Y];return null},Q.prototype.getMorphTargetById=function(W){for(var Y=0;Y<this.morphTargetManagers.length;++Y)for(var q=this.morphTargetManagers[Y],ae=0;ae<q.numTargets;++ae){var pe=q.getTarget(ae);if(pe.id===W)return pe}return null},Q.prototype.getMorphTargetByName=function(W){for(var Y=0;Y<this.morphTargetManagers.length;++Y)for(var q=this.morphTargetManagers[Y],ae=0;ae<q.numTargets;++ae){var pe=q.getTarget(ae);if(pe.name===W)return pe}return null},Q.prototype.getPostProcessByName=function(W){for(var Y=0;Y<this.postProcesses.length;++Y){var q=this.postProcesses[Y];if(q.name===W)return q}return null},Q.prototype.isActiveMesh=function(W){return this._activeMeshes.indexOf(W)!==-1},Object.defineProperty(Q.prototype,"uid",{get:function(){return this._uid||(this._uid=m.b.RandomId()),this._uid},enumerable:!1,configurable:!0}),Q.prototype.addExternalData=function(W,Y){return this._externalData||(this._externalData=new M.a),this._externalData.add(W,Y)},Q.prototype.getExternalData=function(W){return this._externalData?this._externalData.get(W):null},Q.prototype.getOrAddExternalDataWithFactory=function(W,Y){return this._externalData||(this._externalData=new M.a),this._externalData.getOrAddWithFactory(W,Y)},Q.prototype.removeExternalData=function(W){return this._externalData.remove(W)},Q.prototype._evaluateSubMesh=function(W,Y,q){if(q.hasInstances||q.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||Y.alwaysSelectAsActiveMesh||Y.subMeshes.length===1||W.isInFrustum(this._frustumPlanes)){for(var ae=0,pe=this._evaluateSubMeshStage;ae<pe.length;ae++)pe[ae].action(Y,W);var De=W.getMaterial();De!=null&&(De.hasRenderTargetTextures&&De.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(De)===-1&&(this._processedMaterials.push(De),this._renderTargets.concatWithNoDuplicate(De.getRenderTargetTextures())),this._renderingManager.dispatch(W,Y,De))}},Q.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(Q.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(W){this._preventFreeActiveMeshesAndRenderingGroups!==W&&(W&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=W)},enumerable:!1,configurable:!0}),Q.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var W=0;W<this.activeCameras.length;W++){var Y=this.activeCameras[W];Y&&Y._activeMeshes&&Y._activeMeshes.dispose()}},Q.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var W=0;W<this.textures.length;W++){var Y=this.textures[W];Y&&Y.renderList&&Y.freeRenderingGroups()}},Q.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},Q.prototype.freezeActiveMeshes=function(W,Y,q){var ae=this;return W===void 0&&(W=!1),this.executeWhenReady(function(){if(ae.activeCamera){ae._frustumPlanes||ae.setTransformMatrix(ae.activeCamera.getViewMatrix(),ae.activeCamera.getProjectionMatrix()),ae._evaluateActiveMeshes(),ae._activeMeshesFrozen=!0,ae._skipEvaluateActiveMeshesCompletely=W;for(var pe=0;pe<ae._activeMeshes.length;pe++)ae._activeMeshes.data[pe]._freeze();Y&&Y()}else q&&q("No active camera found")}),this},Q.prototype.unfreezeActiveMeshes=function(){for(var W=0;W<this.meshes.length;W++){var Y=this.meshes[W];Y._internalAbstractMeshDataInfo&&(Y._internalAbstractMeshDataInfo._isActive=!1)}for(W=0;W<this._activeMeshes.length;W++)this._activeMeshes.data[W]._unFreeze();return this._activeMeshesFrozen=!1,this},Q.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var W=this._activeMeshes.length,Y=0;Y<W;Y++)(ge=this._activeMeshes.data[Y]).computeWorldMatrix();if(this._activeParticleSystems){var q=this._activeParticleSystems.length;for(Y=0;Y<q;Y++)this._activeParticleSystems.data[Y].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var ae=0,pe=this._beforeEvaluateActiveMeshStage;ae<pe.length;ae++)pe[ae].action();var De=this.getActiveMeshCandidates(),de=De.length;for(Y=0;Y<de;Y++){var ge;if((ge=De.data[Y])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!ge.isBlocked&&(this._totalVertices.addCount(ge.getTotalVertices(),!1),ge.isReady()&&ge.isEnabled()&&ge.scaling.lengthSquared()!==0)){ge.computeWorldMatrix(),ge.actionManager&&ge.actionManager.hasSpecificTriggers2(L.a.ACTION_OnIntersectionEnterTrigger,L.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(ge);var ne=this.customLODSelector?this.customLODSelector(ge,this.activeCamera):ge.getLOD(this.activeCamera);if(ge._internalAbstractMeshDataInfo._currentLOD=ne,ge._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,ne!=null&&(ne!==ge&&ne.billboardMode!==_.a.BILLBOARDMODE_NONE&&ne.computeWorldMatrix(),ge._preActivate(),ge.isVisible&&ge.visibility>0&&(ge.layerMask&this.activeCamera.layerMask)!=0&&(this._skipFrustumClipping||ge.alwaysSelectAsActiveMesh||ge.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(ge),this.activeCamera._activeMeshes.push(ge),ne!==ge&&ne._activate(this._renderId,!1);for(var Te=0,we=this._preActiveMeshStage;Te<we.length;Te++)we[Te].action(ge);ge._activate(this._renderId,!1)&&(ge.isAnInstance?ge._internalAbstractMeshDataInfo._actAsRegularMesh&&(ne=ge):ne._internalAbstractMeshDataInfo._onlyForInstances=!1,ne._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(ge,ne)),ge._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var Se=0;Se<this.particleSystems.length;Se++){var Ge=this.particleSystems[Se];if(Ge.isStarted()&&Ge.emitter){var $e=Ge.emitter;$e.position&&!$e.isEnabled()||(this._activeParticleSystems.push(Ge),Ge.animate(),this._renderingManager.dispatchParticles(Ge))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},Q.prototype._activeMesh=function(W,Y){if(this._skeletonsEnabled&&Y.skeleton!==null&&Y.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(Y.skeleton)&&Y.skeleton.prepare(),Y.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(Y)),Y!=null&&Y.subMeshes!==void 0&&Y.subMeshes!==null&&Y.subMeshes.length>0)for(var q=this.getActiveSubMeshCandidates(Y),ae=q.length,pe=0;pe<ae;pe++){var De=q.data[pe];this._evaluateSubMesh(De,Y,W)}},Q.prototype.updateTransformMatrix=function(W){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(W))},Q.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var W=this.activeCamera.outputRenderTarget.getInternalTexture();W?this.getEngine().bindFramebuffer(W):X.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},Q.prototype._renderForCamera=function(W,Y){if(!W||!W._skipRendering){var q=this._engine;if(this._activeCamera=W,!this.activeCamera)throw new Error("Active camera not set");q.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&W.outputRenderTarget&&W.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(W._rigCameras[0].getViewMatrix(),W._rigCameras[0].getProjectionMatrix(),W._rigCameras[1].getViewMatrix(),W._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var ae=0;ae<this._softwareSkinnedMeshes.length;ae++){var pe=this._softwareSkinnedMeshes.data[ae];pe.applySkeleton(pe.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),W.customRenderTargets&&W.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(W.customRenderTargets),Y&&Y.customRenderTargets&&Y.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(Y.customRenderTargets);for(var De=0,de=this._gatherActiveCameraRenderTargetsStage;De<de.length;De++)de[De].action(this._renderTargets);var ge=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){m.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var ne=0;ne<this._renderTargets.length;ne++){var Te=this._renderTargets.data[ne];if(Te._shouldRender()){this._renderId++;var we=Te.activeCamera&&Te.activeCamera!==this.activeCamera;Te.render(we,this.dumpNextRenderTargets),ge=!0}}m.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var Se=0,Ge=this._cameraDrawRenderTargetStage;Se<Ge.length;Se++)ge=Ge[Se].action(this.activeCamera)||ge;this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(ge=!0)}ge&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||W._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var $e=0,nt=this._beforeCameraDrawStage;$e<nt.length;$e++)nt[$e].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var et=0,Ze=this._afterCameraDrawStage;et<Ze.length;et++)Ze[et].action(this.activeCamera);if(this.postProcessManager&&!W._multiviewTexture){var ht=W.outputRenderTarget?W.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(W.isIntermediate,ht)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},Q.prototype._processSubCameras=function(W){if(W.cameraRigMode===R.a.RIG_MODE_NONE||W.outputRenderTarget&&W.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)return this._renderForCamera(W),void this.onAfterRenderCameraObservable.notifyObservers(W);if(W._useMultiviewToSingleView)this._renderMultiviewToSingleView(W);else for(var Y=0;Y<W._rigCameras.length;Y++)this._renderForCamera(W._rigCameras[Y],W);this._activeCamera=W,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(W)},Q.prototype._checkIntersections=function(){for(var W=0;W<this._meshesForIntersections.length;W++){var Y=this._meshesForIntersections.data[W];if(Y.actionManager)for(var q=0;Y.actionManager&&q<Y.actionManager.actions.length;q++){var ae=Y.actionManager.actions[q];if(ae.trigger===L.a.ACTION_OnIntersectionEnterTrigger||ae.trigger===L.a.ACTION_OnIntersectionExitTrigger){var pe=ae.getTriggerParameter(),De=pe instanceof O.a?pe:pe.mesh,de=De.intersectsMesh(Y,pe.usePreciseIntersection),ge=Y._intersectionsInProgress.indexOf(De);de&&ge===-1?ae.trigger===L.a.ACTION_OnIntersectionEnterTrigger?(ae._executeCurrent(P.a.CreateNew(Y,void 0,De)),Y._intersectionsInProgress.push(De)):ae.trigger===L.a.ACTION_OnIntersectionExitTrigger&&Y._intersectionsInProgress.push(De):!de&&ge>-1&&(ae.trigger===L.a.ACTION_OnIntersectionExitTrigger&&ae._executeCurrent(P.a.CreateNew(Y,void 0,De)),Y.actionManager.hasSpecificTrigger(L.a.ACTION_OnIntersectionExitTrigger,function(ne){var Te=ne instanceof O.a?ne:ne.mesh;return De===Te})&&ae.trigger!==L.a.ACTION_OnIntersectionExitTrigger||Y._intersectionsInProgress.splice(ge,1))}}}},Q.prototype._advancePhysicsEngineStep=function(W){},Q.prototype._animate=function(){},Q.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var W=Math.max(Q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Q.MaxDeltaTime))+this._timeAccumulator,Y=this._engine.getTimeStep(),q=1e3/Y/1e3,ae=0,pe=this._engine.getLockstepMaxSteps(),De=Math.floor(W/Y);for(De=Math.min(De,pe);W>0&&ae<De;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=Y*q,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(Y),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,ae++,W-=Y;this._timeAccumulator=W<0?0:W}else W=this.useConstantAnimationDeltaTime?16:Math.max(Q.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Q.MaxDeltaTime)),this._animationRatio=.06*W,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(W)},Q.prototype.render=function(W,Y){if(W===void 0&&(W=!0),Y===void 0&&(Y=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(L.a.ACTION_OnEveryFrameTrigger),Y||this.animate();for(var q=0,ae=this._beforeCameraUpdateStage;q<ae.length;q++)ae[q].action();if(W){if(this.activeCameras&&this.activeCameras.length>0)for(var pe=0;pe<this.activeCameras.length;pe++){var De=this.activeCameras[pe];if(De.update(),De.cameraRigMode!==R.a.RIG_MODE_NONE)for(var de=0;de<De._rigCameras.length;de++)De._rigCameras[de].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==R.a.RIG_MODE_NONE))for(de=0;de<this.activeCamera._rigCameras.length;de++)this.activeCamera._rigCameras[de].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var ge=this.getEngine(),ne=this.activeCamera;if(this.renderTargetsEnabled){m.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var Te=0;Te<this.customRenderTargets.length;Te++){var we=this.customRenderTargets[Te];if(we._shouldRender()){if(this._renderId++,this.activeCamera=we.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");ge.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),we.render(ne!==this.activeCamera,this.dumpNextRenderTargets)}}m.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=ne,this._activeCamera&&this._activeCamera.cameraRigMode!==R.a.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var Se=0,Ge=this._beforeClearStage;Se<Ge.length;Se++)Ge[Se].action();!this.autoClearDepthAndStencil&&!this.autoClear||this.prePass||this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var $e=0,nt=this._gatherRenderTargetsStage;$e<nt.length;$e++)nt[$e].action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(pe=0;pe<this.activeCameras.length;pe++)pe>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[pe]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var et=0,Ze=this._afterRenderStage;et<Ze.length;et++)Ze[et].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(de=0;de<this._toBeDisposed.length;de++){var ht=this._toBeDisposed[de];ht&&ht.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},Q.prototype.freezeMaterials=function(){for(var W=0;W<this.materials.length;W++)this.materials[W].freeze()},Q.prototype.unfreezeMaterials=function(){for(var W=0;W<this.materials.length;W++)this.materials[W].unfreeze()},Q.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,G.a._LastCreatedScene===this&&(G.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var W=0,Y=this._components;W<Y.length;W++)Y[W].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var q=0,ae=this._activeRequests;q<ae.length;q++)ae[q].abort();var pe;if(this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl(),this._engine.getInputElement())for(pe=0;pe<this.cameras.length;pe++)this.cameras[pe].detachControl();for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(pe=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(pe,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(Q.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Q.prototype.clearCachedVertexData=function(){for(var W=0;W<this.meshes.length;W++){var Y=this.meshes[W].geometry;if(Y)for(var q in Y._indices=[],Y._vertexBuffers)Y._vertexBuffers.hasOwnProperty(q)&&(Y._vertexBuffers[q]._buffer._data=null)}},Q.prototype.cleanCachedTextureBuffer=function(){for(var W=0,Y=this.textures;W<Y.length;W++){var q=Y[W];q._buffer&&(q._buffer=null)}},Q.prototype.getWorldExtends=function(W){var Y=new S.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new S.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return W=W||function(){return!0},this.meshes.filter(W).forEach(function(ae){if(ae.computeWorldMatrix(!0),ae.subMeshes&&ae.subMeshes.length!==0&&!ae.infiniteDistance){var pe=ae.getBoundingInfo(),De=pe.boundingBox.minimumWorld,de=pe.boundingBox.maximumWorld;S.e.CheckExtends(De,Y,q),S.e.CheckExtends(de,Y,q)}}),{min:Y,max:q}},Q.prototype.createPickingRay=function(W,Y,q,ae,pe){throw ee.a.WarnImport("Ray")},Q.prototype.createPickingRayToRef=function(W,Y,q,ae,pe,De){throw ee.a.WarnImport("Ray")},Q.prototype.createPickingRayInCameraSpace=function(W,Y,q){throw ee.a.WarnImport("Ray")},Q.prototype.createPickingRayInCameraSpaceToRef=function(W,Y,q,ae){throw ee.a.WarnImport("Ray")},Q.prototype.pick=function(W,Y,q,ae,pe,De){var de=new C.a;return de._pickingUnavailable=!0,de},Q.prototype.pickWithBoundingInfo=function(W,Y,q,ae,pe){var De=new C.a;return De._pickingUnavailable=!0,De},Q.prototype.pickWithRay=function(W,Y,q,ae){throw ee.a.WarnImport("Ray")},Q.prototype.multiPick=function(W,Y,q,ae,pe){throw ee.a.WarnImport("Ray")},Q.prototype.multiPickWithRay=function(W,Y,q){throw ee.a.WarnImport("Ray")},Q.prototype.setPointerOverMesh=function(W,Y){this._inputManager.setPointerOverMesh(W,Y)},Q.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},Q.prototype._rebuildGeometries=function(){for(var W=0,Y=this.geometries;W<Y.length;W++)Y[W]._rebuild();for(var q=0,ae=this.meshes;q<ae.length;q++)ae[q]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var pe=0,De=this._components;pe<De.length;pe++)De[pe].rebuild();for(var de=0,ge=this.particleSystems;de<ge.length;de++)ge[de].rebuild()},Q.prototype._rebuildTextures=function(){for(var W=0,Y=this.textures;W<Y.length;W++)Y[W]._rebuild();this.markAllMaterialsAsDirty(L.a.MATERIAL_TextureDirtyFlag)},Q.prototype._getByTags=function(W,Y,q){if(Y===void 0)return W;var ae=[];for(var pe in q=q||function(de){},W){var De=W[pe];w.a&&w.a.MatchesQuery(De,Y)&&(ae.push(De),q(De))}return ae},Q.prototype.getMeshesByTags=function(W,Y){return this._getByTags(this.meshes,W,Y)},Q.prototype.getCamerasByTags=function(W,Y){return this._getByTags(this.cameras,W,Y)},Q.prototype.getLightsByTags=function(W,Y){return this._getByTags(this.lights,W,Y)},Q.prototype.getMaterialByTags=function(W,Y){return this._getByTags(this.materials,W,Y).concat(this._getByTags(this.multiMaterials,W,Y))},Q.prototype.getTransformNodesByTags=function(W,Y){return this._getByTags(this.transformNodes,W,Y)},Q.prototype.setRenderingOrder=function(W,Y,q,ae){Y===void 0&&(Y=null),q===void 0&&(q=null),ae===void 0&&(ae=null),this._renderingManager.setRenderingOrder(W,Y,q,ae)},Q.prototype.setRenderingAutoClearDepthStencil=function(W,Y,q,ae){q===void 0&&(q=!0),ae===void 0&&(ae=!0),this._renderingManager.setRenderingAutoClearDepthStencil(W,Y,q,ae)},Q.prototype.getAutoClearDepthStencilSetup=function(W){return this._renderingManager.getAutoClearDepthStencilSetup(W)},Object.defineProperty(Q.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(W){this._blockMaterialDirtyMechanism!==W&&(this._blockMaterialDirtyMechanism=W,W||this.markAllMaterialsAsDirty(L.a.MATERIAL_AllDirtyFlag))},enumerable:!1,configurable:!0}),Q.prototype.markAllMaterialsAsDirty=function(W,Y){if(!this._blockMaterialDirtyMechanism)for(var q=0,ae=this.materials;q<ae.length;q++){var pe=ae[q];Y&&!Y(pe)||pe.markAsDirty(W)}},Q.prototype._loadFile=function(W,Y,q,ae,pe,De){var de=this,ge=Z.a.LoadFile(W,Y,q,ae?this.offlineProvider:void 0,pe,De);return this._activeRequests.push(ge),ge.onCompleteObservable.add(function(ne){de._activeRequests.splice(de._activeRequests.indexOf(ne),1)}),ge},Q.prototype._loadFileAsync=function(W,Y,q,ae){var pe=this;return new Promise(function(De,de){pe._loadFile(W,function(ge){De(ge)},Y,q,ae,function(ge,ne){de(ne)})})},Q.prototype._requestFile=function(W,Y,q,ae,pe,De,de){var ge=this,ne=Z.a.RequestFile(W,Y,q,ae?this.offlineProvider:void 0,pe,De,de);return this._activeRequests.push(ne),ne.onCompleteObservable.add(function(Te){ge._activeRequests.splice(ge._activeRequests.indexOf(Te),1)}),ne},Q.prototype._requestFileAsync=function(W,Y,q,ae,pe){var De=this;return new Promise(function(de,ge){De._requestFile(W,function(ne){de(ne)},Y,q,ae,function(ne){ge(ne)},pe)})},Q.prototype._readFile=function(W,Y,q,ae,pe){var De=this,de=Z.a.ReadFile(W,Y,q,ae,pe);return this._activeRequests.push(de),de.onCompleteObservable.add(function(ge){De._activeRequests.splice(De._activeRequests.indexOf(ge),1)}),de},Q.prototype._readFileAsync=function(W,Y,q){var ae=this;return new Promise(function(pe,De){ae._readFile(W,function(de){pe(de)},Y,q,function(de){De(de)})})},Q.FOGMODE_NONE=0,Q.FOGMODE_EXP=1,Q.FOGMODE_EXP2=2,Q.FOGMODE_LINEAR=3,Q.MinDeltaTime=1,Q.MaxDeltaTime=1e3,Q}(I.a)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.WarnImport=function(E){return E+" needs to be imported before as it contains a side-effect required by your code."},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return Object.defineProperty(m,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(m,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),m.Instances=new Array,m._LastCreatedScene=null,m.UseFallbackTexture=!0,m.FallbackTexture="",m}()},function(f,s,c){c.d(s,"c",function(){return T}),c.d(s,"a",function(){return d}),c.d(s,"b",function(){return E});var T,m=c(0);(function(x){x[x.LOCAL=0]="LOCAL",x[x.WORLD=1]="WORLD",x[x.BONE=2]="BONE"})(T||(T={}));var E,d=function(){function x(){}return x.X=new m.e(1,0,0),x.Y=new m.e(0,1,0),x.Z=new m.e(0,0,1),x}();(function(x){x[x.X=0]="X",x[x.Y=1]="Y",x[x.Z=2]="Z"})(E||(E={}))},function(f,s,c){c.d(s,"a",function(){return y});var T=c(1),m=c(3),E=c(33),d=c(12),x=c(6),M=c(0),w=c(29),S=c(8),_=c(11),O=c(21),R=c(58),I=c(90),y=function(p){function g(C,P,F,U){U===void 0&&(U=!0);var B=p.call(this,C,F)||this;return B._position=M.e.Zero(),B._upVector=M.e.Up(),B.orthoLeft=null,B.orthoRight=null,B.orthoBottom=null,B.orthoTop=null,B.fov=.8,B.minZ=1,B.maxZ=1e4,B.inertia=.9,B.mode=g.PERSPECTIVE_CAMERA,B.isIntermediate=!1,B.viewport=new R.a(0,0,1,1),B.layerMask=268435455,B.fovMode=g.FOVMODE_VERTICAL_FIXED,B.cameraRigMode=g.RIG_MODE_NONE,B.customRenderTargets=new Array,B.outputRenderTarget=null,B.onViewMatrixChangedObservable=new x.c,B.onProjectionMatrixChangedObservable=new x.c,B.onAfterCheckInputsObservable=new x.c,B.onRestoreStateObservable=new x.c,B.isRigCamera=!1,B._rigCameras=new Array,B._webvrViewMatrix=M.a.Identity(),B._skipRendering=!1,B._projectionMatrix=new M.a,B._postProcesses=new Array,B._activeMeshes=new E.a(256),B._globalPosition=M.e.Zero(),B._computedViewMatrix=M.a.Identity(),B._doNotComputeProjectionMatrix=!1,B._transformMatrix=M.a.Zero(),B._refreshFrustumPlanes=!0,B._isCamera=!0,B._isLeftCamera=!1,B._isRightCamera=!1,B.getScene().addCamera(B),U&&!B.getScene().activeCamera&&(B.getScene().activeCamera=B),B.position=P,B}return Object(T.d)(g,p),Object.defineProperty(g.prototype,"position",{get:function(){return this._position},set:function(C){this._position=C},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"upVector",{get:function(){return this._upVector},set:function(C){this._upVector=C},enumerable:!1,configurable:!0}),g.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},g.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},g.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},g.prototype.getClassName=function(){return"Camera"},g.prototype.toString=function(C){var P="Name: "+this.name;if(P+=", type: "+this.getClassName(),this.animations)for(var F=0;F<this.animations.length;F++)P+=", animation[0]: "+this.animations[F].toString(C);return P},Object.defineProperty(g.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),g.prototype.getActiveMeshes=function(){return this._activeMeshes},g.prototype.isActiveMesh=function(C){return this._activeMeshes.indexOf(C)!==-1},g.prototype.isReady=function(C){if(C===void 0&&(C=!1),C)for(var P=0,F=this._postProcesses;P<F.length;P++){var U=F[P];if(U&&!U.isReady())return!1}return p.prototype.isReady.call(this,C)},g.prototype._initCache=function(){p.prototype._initCache.call(this),this._cache.position=new M.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new M.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},g.prototype._updateCache=function(C){C||p.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},g.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},g.prototype._isSynchronizedViewMatrix=function(){return!!p.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},g.prototype._isSynchronizedProjectionMatrix=function(){var C=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!C)return!1;var P=this.getEngine();return C=this.mode===g.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===P.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===P.getRenderWidth()&&this._cache.renderHeight===P.getRenderHeight()},g.prototype.attachControl=function(C,P){},g.prototype.detachControl=function(C){},g.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==g.RIG_MODE_NONE&&this._updateRigCameras()},g.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(g.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),g.prototype._getFirstPostProcess=function(){for(var C=0;C<this._postProcesses.length;C++)if(this._postProcesses[C]!==null)return this._postProcesses[C];return null},g.prototype._cascadePostProcessesToRigCams=function(){var C=this._getFirstPostProcess();C&&C.markTextureDirty();for(var P=0,F=this._rigCameras.length;P<F;P++){var U=this._rigCameras[P],B=U._rigPostProcess;B?(B.getEffectName()==="pass"&&(U.isIntermediate=this._postProcesses.length===0),U._postProcesses=this._postProcesses.slice(0).concat(B),B.markTextureDirty()):U._postProcesses=this._postProcesses.slice(0)}},g.prototype.attachPostProcess=function(C,P){return P===void 0&&(P=null),!C.isReusable()&&this._postProcesses.indexOf(C)>-1?(S.a.Error("You're trying to reuse a post process not defined as reusable."),0):(P==null||P<0?this._postProcesses.push(C):this._postProcesses[P]===null?this._postProcesses[P]=C:this._postProcesses.splice(P,0,C),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(C))},g.prototype.detachPostProcess=function(C){var P=this._postProcesses.indexOf(C);P!==-1&&(this._postProcesses[P]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},g.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},g.prototype._getViewMatrix=function(){return M.a.Identity()},g.prototype.getViewMatrix=function(C){return!C&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},g.prototype.freezeProjectionMatrix=function(C){this._doNotComputeProjectionMatrix=!0,C!==void 0&&(this._projectionMatrix=C)},g.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},g.prototype.getProjectionMatrix=function(C){var P,F,U,B,L,z,X,G;if(this._doNotComputeProjectionMatrix||!C&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var ee=this.getEngine(),$=this.getScene();if(this.mode===g.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=ee.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var fe=ee.useReverseDepthBuffer;($.useRightHandedSystem?fe?M.a.PerspectiveFovReverseRHToRef:M.a.PerspectiveFovRHToRef:fe?M.a.PerspectiveFovReverseLHToRef:M.a.PerspectiveFovLHToRef)(this.fov,ee.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===g.FOVMODE_VERTICAL_FIXED)}else{var me=ee.getRenderWidth()/2,ve=ee.getRenderHeight()/2;$.useRightHandedSystem?M.a.OrthoOffCenterRHToRef((P=this.orthoLeft)!==null&&P!==void 0?P:-me,(F=this.orthoRight)!==null&&F!==void 0?F:me,(U=this.orthoBottom)!==null&&U!==void 0?U:-ve,(B=this.orthoTop)!==null&&B!==void 0?B:ve,this.minZ,this.maxZ,this._projectionMatrix):M.a.OrthoOffCenterLHToRef((L=this.orthoLeft)!==null&&L!==void 0?L:-me,(z=this.orthoRight)!==null&&z!==void 0?z:me,(X=this.orthoBottom)!==null&&X!==void 0?X:-ve,(G=this.orthoTop)!==null&&G!==void 0?G:ve,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=ee.getRenderWidth(),this._cache.renderHeight=ee.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},g.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},g.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?I.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=I.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},g.prototype.isInFrustum=function(C,P){if(P===void 0&&(P=!1),this._updateFrustumPlanes(),P&&this.rigCameras.length>0){var F=!1;return this.rigCameras.forEach(function(U){U._updateFrustumPlanes(),F=F||C.isInFrustum(U._frustumPlanes)}),F}return C.isInFrustum(this._frustumPlanes)},g.prototype.isCompletelyInFrustum=function(C){return this._updateFrustumPlanes(),C.isCompletelyInFrustum(this._frustumPlanes)},g.prototype.getForwardRay=function(C,P,F){throw O.a.WarnImport("Ray")},g.prototype.getForwardRayToRef=function(C,P,F,U){throw O.a.WarnImport("Ray")},g.prototype.dispose=function(C,P){for(P===void 0&&(P=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var F=this._rigCameras.pop();F&&F.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==g.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var U=this._postProcesses.length;--U>=0;){var B=this._postProcesses[U];B&&B.dispose(this)}for(U=this.customRenderTargets.length;--U>=0;)this.customRenderTargets[U].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),p.prototype.dispose.call(this,C,P)},Object.defineProperty(g.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),g.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},g.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},g.prototype.setCameraRigMode=function(C,P){if(this.cameraRigMode!==C){for(;this._rigCameras.length>0;){var F=this._rigCameras.pop();F&&F.dispose()}if(this.cameraRigMode=C,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=P.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=d.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==g.RIG_MODE_NONE){var U=this.createRigCamera(this.name+"_L",0);U&&(U._isLeftCamera=!0);var B=this.createRigCamera(this.name+"_R",1);B&&(B._isRightCamera=!0),U&&B&&(this._rigCameras.push(U),this._rigCameras.push(B))}switch(this.cameraRigMode){case g.RIG_MODE_STEREOSCOPIC_ANAGLYPH:g._setStereoscopicAnaglyphRigMode(this);break;case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case g.RIG_MODE_STEREOSCOPIC_OVERUNDER:case g.RIG_MODE_STEREOSCOPIC_INTERLACED:g._setStereoscopicRigMode(this);break;case g.RIG_MODE_VR:g._setVRRigMode(this,P);break;case g.RIG_MODE_WEBVR:g._setWebVRRigMode(this,P)}this._cascadePostProcessesToRigCams(),this.update()}},g._setStereoscopicRigMode=function(C){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},g._setStereoscopicAnaglyphRigMode=function(C){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},g._setVRRigMode=function(C,P){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},g._setWebVRRigMode=function(C,P){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},g.prototype._getVRProjectionMatrix=function(){return M.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},g.prototype._updateCameraRotationMatrix=function(){},g.prototype._updateWebVRCameraRotationMatrix=function(){},g.prototype._getWebVRProjectionMatrix=function(){return M.a.Identity()},g.prototype._getWebVRViewMatrix=function(){return M.a.Identity()},g.prototype.setCameraRigParameter=function(C,P){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[C]=P,C==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=d.b.ToRadians(P/.0637))},g.prototype.createRigCamera=function(C,P){return null},g.prototype._updateRigCameras=function(){for(var C=0;C<this._rigCameras.length;C++)this._rigCameras[C].minZ=this.minZ,this._rigCameras[C].maxZ=this.maxZ,this._rigCameras[C].fov=this.fov,this._rigCameras[C].upVector.copyFrom(this.upVector);this.cameraRigMode===g.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},g.prototype._setupInputs=function(){},g.prototype.serialize=function(){var C=m.a.Serialize(this);return C.type=this.getClassName(),this.parent&&(C.parentId=this.parent.id),this.inputs&&this.inputs.serialize(C),m.a.AppendSerializedAnimations(this,C),C.ranges=this.serializeAnimationRanges(),C},g.prototype.clone=function(C){return m.a.Clone(g.GetConstructorFromName(this.getClassName(),C,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},g.prototype.getDirection=function(C){var P=M.e.Zero();return this.getDirectionToRef(C,P),P},Object.defineProperty(g.prototype,"absoluteRotation",{get:function(){var C=M.b.Zero();return this.getWorldMatrix().decompose(void 0,C),C},enumerable:!1,configurable:!0}),g.prototype.getDirectionToRef=function(C,P){M.e.TransformNormalToRef(C,this.getWorldMatrix(),P)},g.GetConstructorFromName=function(C,P,F,U,B){U===void 0&&(U=0),B===void 0&&(B=!0);var L=w.a.Construct(C,P,F,{interaxial_distance:U,isStereoscopicSideBySide:B});return L||function(){return g._createDefaultParsedCamera(P,F)}},g.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},g.Parse=function(C,P){var F=C.type,U=g.GetConstructorFromName(F,C.name,P,C.interaxial_distance,C.isStereoscopicSideBySide),B=m.a.Parse(U,C,P);if(C.parentId&&(B._waitingParentId=C.parentId),B.inputs&&(B.inputs.parse(C),B._setupInputs()),C.upVector&&(B.upVector=M.e.FromArray(C.upVector)),B.setPosition&&(B.position.copyFromFloats(0,0,0),B.setPosition(M.e.FromArray(C.position))),C.target&&B.setTarget&&B.setTarget(M.e.FromArray(C.target)),C.cameraRigMode){var L=C.interaxial_distance?{interaxialDistance:C.interaxial_distance}:{};B.setCameraRigMode(C.cameraRigMode,L)}if(C.animations){for(var z=0;z<C.animations.length;z++){var X=C.animations[z],G=_.a.GetClass("BABYLON.Animation");G&&B.animations.push(G.Parse(X))}w.a.ParseAnimationRanges(B,C,P)}return C.autoAnimate&&P.beginAnimation(B,C.autoAnimateFrom,C.autoAnimateTo,C.autoAnimateLoop,C.autoAnimateSpeed||1),B},g._createDefaultParsedCamera=function(C,P){throw O.a.WarnImport("UniversalCamera")},g.PERSPECTIVE_CAMERA=0,g.ORTHOGRAPHIC_CAMERA=1,g.FOVMODE_VERTICAL_FIXED=0,g.FOVMODE_HORIZONTAL_FIXED=1,g.RIG_MODE_NONE=0,g.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,g.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,g.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,g.RIG_MODE_STEREOSCOPIC_INTERLACED=14,g.RIG_MODE_VR=20,g.RIG_MODE_WEBVR=21,g.RIG_MODE_CUSTOM=22,g.ForceAttachControlToAlwaysPreventDefault=!1,Object(T.c)([Object(m.o)("position")],g.prototype,"_position",void 0),Object(T.c)([Object(m.o)("upVector")],g.prototype,"_upVector",void 0),Object(T.c)([Object(m.c)()],g.prototype,"orthoLeft",void 0),Object(T.c)([Object(m.c)()],g.prototype,"orthoRight",void 0),Object(T.c)([Object(m.c)()],g.prototype,"orthoBottom",void 0),Object(T.c)([Object(m.c)()],g.prototype,"orthoTop",void 0),Object(T.c)([Object(m.c)()],g.prototype,"fov",void 0),Object(T.c)([Object(m.c)()],g.prototype,"minZ",void 0),Object(T.c)([Object(m.c)()],g.prototype,"maxZ",void 0),Object(T.c)([Object(m.c)()],g.prototype,"inertia",void 0),Object(T.c)([Object(m.c)()],g.prototype,"mode",void 0),Object(T.c)([Object(m.c)()],g.prototype,"layerMask",void 0),Object(T.c)([Object(m.c)()],g.prototype,"fovMode",void 0),Object(T.c)([Object(m.c)()],g.prototype,"cameraRigMode",void 0),Object(T.c)([Object(m.c)()],g.prototype,"interaxialDistance",void 0),Object(T.c)([Object(m.c)()],g.prototype,"isStereoscopicSideBySide",void 0),g}(w.a)},function(f,s,c){c.d(s,"a",function(){return R});var T=c(1),m=c(3),E=c(12),d=c(6),x=c(22),M=c(61),w=c(85),S=c(2),_=c(8),O=c(64),R=function(){function I(y,p,g){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new d.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=S.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=I.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=y;var C=1;for(this._scene=p||x.a.LastCreatedScene,this.id=y||E.b.RandomId();this._scene.getMaterialByID(this.id);)this.id=y+" "+C++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=I.ClockWiseSideOrientation:this.sideOrientation=I.CounterClockWiseSideOrientation,this._uniformBuffer=new w.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,g||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(I.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"alpha",{get:function(){return this._alpha},set:function(y){this._alpha!==y&&(this._alpha=y,this.markAsDirty(I.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(y){this._backFaceCulling!==y&&(this._backFaceCulling=y,this.markAsDirty(I.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onDispose",{set:function(y){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(y)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new d.c),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onBind",{set:function(y){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(y)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new d.c),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new d.c),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(y){this._alphaMode!==y&&(this._alphaMode=y,this.markAsDirty(I.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(y){this._needDepthPrePass!==y&&(this._needDepthPrePass=y,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(y){this._fogEnabled!==y&&(this._fogEnabled=y,this.markAsDirty(I.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"wireframe",{get:function(){switch(this._fillMode){case I.WireFrameFillMode:case I.LineListDrawMode:case I.LineLoopDrawMode:case I.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(y){this.fillMode=y?I.WireFrameFillMode:I.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case I.PointFillMode:case I.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(y){this.fillMode=y?I.PointFillMode:I.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fillMode",{get:function(){return this._fillMode},set:function(y){this._fillMode!==y&&(this._fillMode=y,this.markAsDirty(I.MiscDirtyFlag))},enumerable:!1,configurable:!0}),I.prototype.toString=function(y){return"Name: "+this.name},I.prototype.getClassName=function(){return"Material"},Object.defineProperty(I.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),I.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},I.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},I.prototype.isReady=function(y,p){return!0},I.prototype.isReadyForSubMesh=function(y,p,g){return!1},I.prototype.getEffect=function(){return this._effect},I.prototype.getScene=function(){return this._scene},Object.defineProperty(I.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(y){this._transparencyMode!==y&&(this._transparencyMode=y,this._forceAlphaTest=y===I.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===I.MATERIAL_OPAQUE||this._transparencyMode===I.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),I.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},I.prototype.needAlphaBlendingForMesh=function(y){return!(this._disableAlphaBlending&&y.visibility>=1)&&(this.needAlphaBlending()||y.visibility<1||y.hasVertexAlpha)},I.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},I.prototype._shouldTurnAlphaTestOn=function(y){return!this.needAlphaBlendingForMesh(y)&&this.needAlphaTesting()},I.prototype.getAlphaTestTexture=function(){return null},I.prototype.markDirty=function(){for(var y=0,p=this.getScene().meshes;y<p.length;y++){var g=p[y];if(g.subMeshes)for(var C=0,P=g.subMeshes;C<P.length;C++){var F=P[C];F.getMaterial()===this&&F.effect&&(F.effect._wasPreviouslyReady=!1)}}},I.prototype._preBind=function(y,p){p===void 0&&(p=null);var g=this._scene.getEngine(),C=(p??this.sideOrientation)===I.ClockWiseSideOrientation;return g.enableEffect(y||this._effect),g.setState(this.backFaceCulling,this.zOffset,!1,C),C},I.prototype.bind=function(y,p){},I.prototype.bindForSubMesh=function(y,p,g){},I.prototype.bindOnlyWorldMatrix=function(y){},I.prototype.bindSceneUniformBuffer=function(y,p){p.bindToEffect(y,"Scene")},I.prototype.bindView=function(y){this._useUBO?this.bindSceneUniformBuffer(y,this.getScene().getSceneUniformBuffer()):y.setMatrix("view",this.getScene().getViewMatrix())},I.prototype.bindViewProjection=function(y){this._useUBO?this.bindSceneUniformBuffer(y,this.getScene().getSceneUniformBuffer()):y.setMatrix("viewProjection",this.getScene().getTransformMatrix())},I.prototype._afterBind=function(y){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=y?y.visibility:1,this._onBindObservable&&y&&this._onBindObservable.notifyObservers(y),this.disableDepthWrite){var p=this._scene.getEngine();this._cachedDepthWriteState=p.getDepthWrite(),p.setDepthWrite(!1)}this.disableColorWrite&&(p=this._scene.getEngine(),this._cachedColorWriteState=p.getColorWrite(),p.setColorWrite(!1)),this.depthFunction!==0&&(p=this._scene.getEngine(),this._cachedDepthFunctionState=p.getDepthFunction()||0,p.setDepthFunction(this.depthFunction))},I.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},I.prototype.getActiveTextures=function(){return[]},I.prototype.hasTexture=function(y){return!1},I.prototype.clone=function(y){return null},I.prototype.getBindedMeshes=function(){var y=this;if(this.meshMap){var p=new Array;for(var g in this.meshMap){var C=this.meshMap[g];C&&p.push(C)}return p}return this._scene.meshes.filter(function(P){return P.material===y})},I.prototype.forceCompilation=function(y,p,g,C){var P=this,F=Object(T.a)({clipPlane:!1,useInstances:!1},g),U=this.getScene(),B=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var L=function(){if(P._scene&&P._scene.getEngine()){var z=U.clipPlane;if(F.clipPlane&&(U.clipPlane=new O.a(0,0,0,1)),P._storeEffectOnSubMeshes){var X=!0,G=null;if(y.subMeshes){var ee=new M.a(0,0,0,0,0,y,void 0,!1,!1);ee._materialDefines&&(ee._materialDefines._renderId=-1),P.isReadyForSubMesh(y,ee,F.useInstances)||(ee.effect&&ee.effect.getCompilationError()&&ee.effect.allFallbacksProcessed()?G=ee.effect.getCompilationError():(X=!1,setTimeout(L,16)))}X&&(P.allowShaderHotSwapping=B,G&&C&&C(G),p&&p(P))}else P.isReady()?(P.allowShaderHotSwapping=B,p&&p(P)):setTimeout(L,16);F.clipPlane&&(U.clipPlane=z)}};L()},I.prototype.forceCompilationAsync=function(y,p){var g=this;return new Promise(function(C,P){g.forceCompilation(y,function(){C()},p,function(F){P(F)})})},I.prototype.markAsDirty=function(y){this.getScene().blockMaterialDirtyMechanism||(I._DirtyCallbackArray.length=0,y&I.TextureDirtyFlag&&I._DirtyCallbackArray.push(I._TextureDirtyCallBack),y&I.LightDirtyFlag&&I._DirtyCallbackArray.push(I._LightsDirtyCallBack),y&I.FresnelDirtyFlag&&I._DirtyCallbackArray.push(I._FresnelDirtyCallBack),y&I.AttributesDirtyFlag&&I._DirtyCallbackArray.push(I._AttributeDirtyCallBack),y&I.MiscDirtyFlag&&I._DirtyCallbackArray.push(I._MiscDirtyCallBack),y&I.PrePassDirtyFlag&&I._DirtyCallbackArray.push(I._PrePassDirtyCallBack),I._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(I._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},I.prototype._markAllSubMeshesAsDirty=function(y){if(!this.getScene().blockMaterialDirtyMechanism)for(var p=0,g=this.getScene().meshes;p<g.length;p++){var C=g[p];if(C.subMeshes)for(var P=0,F=C.subMeshes;P<F.length;P++){var U=F[P];U.getMaterial()===this&&U._materialDefines&&y(U._materialDefines)}}},I.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var y=this.getScene().enablePrePassRenderer();y&&y.markAsDirty()}},I.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(I._AllDirtyCallBack)},I.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(I._ImageProcessingDirtyCallBack)},I.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(I._TextureDirtyCallBack)},I.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(I._FresnelDirtyCallBack)},I.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(I._FresnelAndMiscDirtyCallBack)},I.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(I._LightsDirtyCallBack)},I.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(I._AttributeDirtyCallBack)},I.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(I._MiscDirtyCallBack)},I.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(I._MiscDirtyCallBack)},I.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(I._TextureAndMiscDirtyCallBack)},I.prototype.setPrePassRenderer=function(y){return!1},I.prototype.dispose=function(y,p,g){var C=this.getScene();if(C.stopAnimation(this),C.freeProcessedMaterials(),C.removeMaterial(this),g!==!0)if(this.meshMap)for(var P in this.meshMap)(B=this.meshMap[P])&&(B.material=null,this.releaseVertexArrayObject(B,y));else for(var F=0,U=C.meshes;F<U.length;F++){var B;(B=U[F]).material!==this||B.sourceMesh||(B.material=null,this.releaseVertexArrayObject(B,y))}this._uniformBuffer.dispose(),y&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},I.prototype.releaseVertexArrayObject=function(y,p){if(y.geometry){var g=y.geometry;if(this._storeEffectOnSubMeshes)for(var C=0,P=y.subMeshes;C<P.length;C++){var F=P[C];g._releaseVertexArrayObject(F._materialEffect),p&&F._materialEffect&&F._materialEffect.dispose()}else g._releaseVertexArrayObject(this._effect)}},I.prototype.serialize=function(){return m.a.Serialize(this)},I.Parse=function(y,p,g){if(y.customType){if(y.customType==="BABYLON.PBRMaterial"&&y.overloadedAlbedo&&(y.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return _.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else y.customType="BABYLON.StandardMaterial";return E.b.Instantiate(y.customType).Parse(y,p,g)},I.TriangleFillMode=S.a.MATERIAL_TriangleFillMode,I.WireFrameFillMode=S.a.MATERIAL_WireFrameFillMode,I.PointFillMode=S.a.MATERIAL_PointFillMode,I.PointListDrawMode=S.a.MATERIAL_PointListDrawMode,I.LineListDrawMode=S.a.MATERIAL_LineListDrawMode,I.LineLoopDrawMode=S.a.MATERIAL_LineLoopDrawMode,I.LineStripDrawMode=S.a.MATERIAL_LineStripDrawMode,I.TriangleStripDrawMode=S.a.MATERIAL_TriangleStripDrawMode,I.TriangleFanDrawMode=S.a.MATERIAL_TriangleFanDrawMode,I.ClockWiseSideOrientation=S.a.MATERIAL_ClockWiseSideOrientation,I.CounterClockWiseSideOrientation=S.a.MATERIAL_CounterClockWiseSideOrientation,I.TextureDirtyFlag=S.a.MATERIAL_TextureDirtyFlag,I.LightDirtyFlag=S.a.MATERIAL_LightDirtyFlag,I.FresnelDirtyFlag=S.a.MATERIAL_FresnelDirtyFlag,I.AttributesDirtyFlag=S.a.MATERIAL_AttributesDirtyFlag,I.MiscDirtyFlag=S.a.MATERIAL_MiscDirtyFlag,I.PrePassDirtyFlag=S.a.MATERIAL_PrePassDirtyFlag,I.AllDirtyFlag=S.a.MATERIAL_AllDirtyFlag,I.MATERIAL_OPAQUE=0,I.MATERIAL_ALPHATEST=1,I.MATERIAL_ALPHABLEND=2,I.MATERIAL_ALPHATESTANDBLEND=3,I.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,I.MATERIAL_NORMALBLENDMETHOD_RNM=1,I._AllDirtyCallBack=function(y){return y.markAllAsDirty()},I._ImageProcessingDirtyCallBack=function(y){return y.markAsImageProcessingDirty()},I._TextureDirtyCallBack=function(y){return y.markAsTexturesDirty()},I._FresnelDirtyCallBack=function(y){return y.markAsFresnelDirty()},I._MiscDirtyCallBack=function(y){return y.markAsMiscDirty()},I._PrePassDirtyCallBack=function(y){return y.markAsPrePassDirty()},I._LightsDirtyCallBack=function(y){return y.markAsLightDirty()},I._AttributeDirtyCallBack=function(y){return y.markAsAttributesDirty()},I._FresnelAndMiscDirtyCallBack=function(y){I._FresnelDirtyCallBack(y),I._MiscDirtyCallBack(y)},I._TextureAndMiscDirtyCallBack=function(y){I._TextureDirtyCallBack(y),I._MiscDirtyCallBack(y)},I._DirtyCallbackArray=[],I._RunDirtyCallBacks=function(y){for(var p=0,g=I._DirtyCallbackArray;p<g.length;p++)(0,g[p])(y)},Object(T.c)([Object(m.c)()],I.prototype,"id",void 0),Object(T.c)([Object(m.c)()],I.prototype,"uniqueId",void 0),Object(T.c)([Object(m.c)()],I.prototype,"name",void 0),Object(T.c)([Object(m.c)()],I.prototype,"checkReadyOnEveryCall",void 0),Object(T.c)([Object(m.c)()],I.prototype,"checkReadyOnlyOnce",void 0),Object(T.c)([Object(m.c)()],I.prototype,"state",void 0),Object(T.c)([Object(m.c)("alpha")],I.prototype,"_alpha",void 0),Object(T.c)([Object(m.c)("backFaceCulling")],I.prototype,"_backFaceCulling",void 0),Object(T.c)([Object(m.c)()],I.prototype,"sideOrientation",void 0),Object(T.c)([Object(m.c)("alphaMode")],I.prototype,"_alphaMode",void 0),Object(T.c)([Object(m.c)()],I.prototype,"_needDepthPrePass",void 0),Object(T.c)([Object(m.c)()],I.prototype,"disableDepthWrite",void 0),Object(T.c)([Object(m.c)()],I.prototype,"disableColorWrite",void 0),Object(T.c)([Object(m.c)()],I.prototype,"forceDepthWrite",void 0),Object(T.c)([Object(m.c)()],I.prototype,"depthFunction",void 0),Object(T.c)([Object(m.c)()],I.prototype,"separateCullingPass",void 0),Object(T.c)([Object(m.c)("fogEnabled")],I.prototype,"_fogEnabled",void 0),Object(T.c)([Object(m.c)()],I.prototype,"pointSize",void 0),Object(T.c)([Object(m.c)()],I.prototype,"zOffset",void 0),Object(T.c)([Object(m.c)()],I.prototype,"pointsCloud",null),Object(T.c)([Object(m.c)()],I.prototype,"fillMode",null),Object(T.c)([Object(m.c)()],I.prototype,"transparencyMode",null),I}()},function(f,s,c){c.d(s,"a",function(){return U});var T=c(22),m=c(5),E=c(21),d=c(6),x=c(141),M=c(142),w=c(143),S=c(2),_=c(27),O=c(8),R=c(38),I=function(){function B(){}return B.prototype.postProcessor=function(L,z,X,G){return G.getCaps().drawBuffersExtension||(L=L.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),L},B}(),y=c(118),p=c(88),g=c(144),C=c(70),P=c(74),F=function(){},U=function(){function B(L,z,X,G){var ee=this;G===void 0&&(G=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new d.c,this.onContextRestoredObservable=new d.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new x.a,this._stencilState=new M.a,this._alphaState=new w.a,this._alphaMode=S.a.ALPHA_ADD,this._alphaEquation=S.a.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new d.c,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(ae,pe,De,de,ge,ne){var Te=ee._gl,we=Te.createRenderbuffer();return Te.bindRenderbuffer(Te.RENDERBUFFER,we),De>1&&Te.renderbufferStorageMultisample?Te.renderbufferStorageMultisample(Te.RENDERBUFFER,De,ge,ae,pe):Te.renderbufferStorage(Te.RENDERBUFFER,de,ae,pe),Te.framebufferRenderbuffer(Te.FRAMEBUFFER,ne,Te.RENDERBUFFER,we),Te.bindRenderbuffer(Te.RENDERBUFFER,null),we},this._boundUniforms={};var $=null;if(L){if(X=X||{},P.a.SetMatrixPrecision(!!X.useHighPrecisionMatrix),L.getContext){if($=L,this._renderingCanvas=$,z!=null&&(X.antialias=z),X.deterministicLockstep===void 0&&(X.deterministicLockstep=!1),X.lockstepMaxSteps===void 0&&(X.lockstepMaxSteps=4),X.timeStep===void 0&&(X.timeStep=1/60),X.preserveDrawingBuffer===void 0&&(X.preserveDrawingBuffer=!1),X.audioEngine===void 0&&(X.audioEngine=!0),X.stencil===void 0&&(X.stencil=!0),X.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),X.xrCompatible===void 0&&(X.xrCompatible=!0),this._doNotHandleContextLost=!!X.doNotHandleContextLost,navigator&&navigator.userAgent){var fe=navigator.userAgent;this.hostInformation.isMobile=fe.indexOf("Mobile")!==-1;for(var me=0,ve=B.ExceptionList;me<ve.length;me++){var be=ve[me],ie=be.key,se=be.targets;if(new RegExp(ie).test(fe)){if(be.capture&&be.captureConstraint){var V=be.capture,K=be.captureConstraint,Z=new RegExp(V).exec(fe);if(Z&&Z.length>0&&parseInt(Z[Z.length-1])>=K)continue}for(var le=0,re=se;le<re.length;le++)switch(re[le]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(ae){ae.preventDefault(),ee._contextWasLost=!0,O.a.Warn("WebGL context lost."),ee.onContextLostObservable.notifyObservers(ee)},this._onContextRestored=function(){setTimeout(function(){ee._initGLContext(),ee._rebuildEffects(),ee._rebuildInternalTextures(),ee._rebuildBuffers(),ee.wipeCaches(!0),O.a.Warn("WebGL context successfully restored."),ee.onContextRestoredObservable.notifyObservers(ee),ee._contextWasLost=!1},0)},$.addEventListener("webglcontextlost",this._onContextLost,!1),$.addEventListener("webglcontextrestored",this._onContextRestored,!1),X.powerPreference="high-performance"),!X.disableWebGL2Support)try{this._gl=$.getContext("webgl2",X)||$.getContext("experimental-webgl2",X),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(ae){}if(!this._gl){if(!$)throw new Error("The provided canvas is null or undefined.");try{this._gl=$.getContext("webgl",X)||$.getContext("experimental-webgl",X)}catch(ae){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=L,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var Q=this._gl.getContextAttributes();Q&&(X.stencil=Q.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),X.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=X.useHighPrecisionFloats);var W=R.a.IsWindowObjectExist()&&window.devicePixelRatio||1,Y=X.limitDeviceRatio||W;this._hardwareScalingLevel=G?1/Math.min(Y,W):1,this.resize(),this._isStencilEnable=!!X.stencil,this._initGLContext();for(var q=0;q<this._caps.maxVertexAttribs;q++)this._currentBufferPointers[q]=new F;this.webGLVersion>1?this._shaderProcessor=new y.a:this._shaderProcessor=new I,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=X,console.log("Babylon.js v"+B.Version+" - "+this.description)}}return Object.defineProperty(B,"NpmPackage",{get:function(){return"babylonjs@4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(B,"Version",{get:function(){return"4.2.0"},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"description",{get:function(){var L="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(L+=" - Parallel shader compilation"),L},enumerable:!1,configurable:!0}),Object.defineProperty(B,"ShadersRepository",{get:function(){return m.a.ShadersRepository},set:function(L){m.a.ShadersRepository=L},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(L){this._doNotHandleContextLost=L},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"framebufferDimensionsObject",{set:function(L){this._framebufferDimensionsObject=L},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,S.a.TEXTUREFORMAT_RGBA,!1,!1,S.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,S.a.TEXTUREFORMAT_RGBA,!1,!1,S.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,S.a.TEXTUREFORMAT_RGBA,!1,!1,S.a.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var L=new Uint8Array(4),z=[L,L,L,L,L,L];this._emptyCubeTexture=this.createRawCubeTexture(z,1,S.a.TEXTUREFORMAT_RGBA,S.a.TEXTURETYPE_UNSIGNED_INT,!1,!1,S.a.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),B.prototype._rebuildInternalTextures=function(){for(var L=0,z=this._internalTexturesCache.slice();L<z.length;L++)z[L]._rebuild()},B.prototype._rebuildEffects=function(){for(var L in this._compiledEffects)this._compiledEffects[L]._prepareEffect();m.a.ResetCache()},B.prototype.areAllEffectsReady=function(){for(var L in this._compiledEffects)if(!this._compiledEffects[L].isReady())return!1;return!0},B.prototype._rebuildBuffers=function(){for(var L=0,z=this._uniformBuffers;L<z.length;L++)z[L]._rebuild()},B.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var L=this._gl.getExtension("WEBGL_debug_renderer_info");if(L!=null&&(this._glRenderer=this._gl.getParameter(L.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(L.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var z=this._gl.getExtension("WEBGL_draw_buffers");if(z!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=z.drawBuffersWEBGL.bind(z),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var X=0;X<16;X++)this._gl["COLOR_ATTACHMENT"+X+"_WEBGL"]=z["COLOR_ATTACHMENT"+X+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var G=this._gl.getExtension("WEBGL_depth_texture");G!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=G.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var ee=this._gl.getExtension("OES_vertex_array_object");ee!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=ee.createVertexArrayOES.bind(ee),this._gl.bindVertexArray=ee.bindVertexArrayOES.bind(ee),this._gl.deleteVertexArray=ee.deleteVertexArrayOES.bind(ee))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var $=this._gl.getExtension("ANGLE_instanced_arrays");$!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=$.drawArraysInstancedANGLE.bind($),this._gl.drawElementsInstanced=$.drawElementsInstancedANGLE.bind($),this._gl.vertexAttribDivisor=$.vertexAttribDivisorANGLE.bind($)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var fe=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),me=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);fe&&me&&(this._caps.highPrecisionShaderSupported=fe.precision!==0&&me.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var ve=this._gl.getExtension("EXT_blend_minmax");ve!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=ve.MAX_EXT,this._gl.MIN=ve.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var be=0;be<this._maxSimultaneousTextures;be++)this._nextFreeTextureSlots.push(be)},Object.defineProperty(B.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),B.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(B.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),B.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=C.a.CreateCanvas(1,1);var L=this._workingCanvas.getContext("2d");L&&(this._workingContext=L)}},B.prototype.resetTextureCache=function(){for(var L in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(L)&&(this._boundTexturesCache[L]=null);this._currentTextureChannel=-1},B.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},B.prototype.setHardwareScalingLevel=function(L){this._hardwareScalingLevel=L,this.resize()},B.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},B.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},B.prototype.getCaps=function(){return this._caps},B.prototype.stopRenderLoop=function(L){if(L){var z=this._activeRenderLoops.indexOf(L);z>=0&&this._activeRenderLoops.splice(z,1)}else this._activeRenderLoops=[]},B.prototype._renderLoop=function(){if(!this._contextWasLost){var L=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(L=!1),L){this.beginFrame();for(var z=0;z<this._activeRenderLoops.length;z++)(0,this._activeRenderLoops[z])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},B.prototype.getRenderingCanvas=function(){return this._renderingCanvas},B.prototype.getHostWindow=function(){return R.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},B.prototype.getRenderWidth=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},B.prototype.getRenderHeight=function(L){return L===void 0&&(L=!1),!L&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},B.prototype._queueNewFrame=function(L,z){return B.QueueNewFrame(L,z)},B.prototype.runRenderLoop=function(L){this._activeRenderLoops.indexOf(L)===-1&&(this._activeRenderLoops.push(L),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},B.prototype.clear=function(L,z,X,G){G===void 0&&(G=!1),this.applyStates();var ee=0;z&&L&&(this._gl.clearColor(L.r,L.g,L.b,L.a!==void 0?L.a:1),ee|=this._gl.COLOR_BUFFER_BIT),X&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),ee|=this._gl.DEPTH_BUFFER_BIT),G&&(this._gl.clearStencil(0),ee|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(ee)},B.prototype._viewport=function(L,z,X,G){L===this._viewportCached.x&&z===this._viewportCached.y&&X===this._viewportCached.z&&G===this._viewportCached.w||(this._viewportCached.x=L,this._viewportCached.y=z,this._viewportCached.z=X,this._viewportCached.w=G,this._gl.viewport(L,z,X,G))},B.prototype.setViewport=function(L,z,X){var G=z||this.getRenderWidth(),ee=X||this.getRenderHeight(),$=L.x||0,fe=L.y||0;this._cachedViewport=L,this._viewport($*G,fe*ee,G*L.width,ee*L.height)},B.prototype.beginFrame=function(){},B.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},B.prototype.resize=function(){var L,z;R.a.IsWindowObjectExist()?(L=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,z=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(L=this._renderingCanvas?this._renderingCanvas.width:100,z=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(L/this._hardwareScalingLevel,z/this._hardwareScalingLevel)},B.prototype.setSize=function(L,z){return!!this._renderingCanvas&&(L|=0,z|=0,(this._renderingCanvas.width!==L||this._renderingCanvas.height!==z)&&(this._renderingCanvas.width=L,this._renderingCanvas.height=z,!0))},B.prototype.bindFramebuffer=function(L,z,X,G,ee,$,fe){z===void 0&&(z=0),$===void 0&&($=0),fe===void 0&&(fe=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=L,this._bindUnboundFramebuffer(L._MSAAFramebuffer?L._MSAAFramebuffer:L._framebuffer);var me=this._gl;L.is2DArray?me.framebufferTextureLayer(me.FRAMEBUFFER,me.COLOR_ATTACHMENT0,L._webGLTexture,$,fe):L.isCube&&me.framebufferTexture2D(me.FRAMEBUFFER,me.COLOR_ATTACHMENT0,me.TEXTURE_CUBE_MAP_POSITIVE_X+z,L._webGLTexture,$);var ve=L._depthStencilTexture;if(ve){var be=ve._generateStencilBuffer?me.DEPTH_STENCIL_ATTACHMENT:me.DEPTH_ATTACHMENT;L.is2DArray?me.framebufferTextureLayer(me.FRAMEBUFFER,be,ve._webGLTexture,$,fe):L.isCube?me.framebufferTexture2D(me.FRAMEBUFFER,be,me.TEXTURE_CUBE_MAP_POSITIVE_X+z,ve._webGLTexture,$):me.framebufferTexture2D(me.FRAMEBUFFER,be,me.TEXTURE_2D,ve._webGLTexture,$)}this._cachedViewport&&!ee?this.setViewport(this._cachedViewport,X,G):(X||(X=L.width,$&&(X/=Math.pow(2,$))),G||(G=L.height,$&&(G/=Math.pow(2,$))),this._viewport(0,0,X,G)),this.wipeCaches()},B.prototype._bindUnboundFramebuffer=function(L){this._currentFramebuffer!==L&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,L),this._currentFramebuffer=L)},B.prototype.unBindFramebuffer=function(L,z,X){z===void 0&&(z=!1),this._currentRenderTarget=null;var G=this._gl;if(L._MSAAFramebuffer){if(L._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(L._textureArray,z,X);G.bindFramebuffer(G.READ_FRAMEBUFFER,L._MSAAFramebuffer),G.bindFramebuffer(G.DRAW_FRAMEBUFFER,L._framebuffer),G.blitFramebuffer(0,0,L.width,L.height,0,0,L.width,L.height,G.COLOR_BUFFER_BIT,G.NEAREST)}!L.generateMipMaps||z||L.isCube||(this._bindTextureDirectly(G.TEXTURE_2D,L,!0),G.generateMipmap(G.TEXTURE_2D),this._bindTextureDirectly(G.TEXTURE_2D,null)),X&&(L._MSAAFramebuffer&&this._bindUnboundFramebuffer(L._framebuffer),X()),this._bindUnboundFramebuffer(null)},B.prototype.flushFramebuffer=function(){this._gl.flush()},B.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},B.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},B.prototype.createVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.STATIC_DRAW)},B.prototype._createVertexBuffer=function(L,z){var X=this._gl.createBuffer();if(!X)throw new Error("Unable to create vertex buffer");var G=new p.a(X);return this.bindArrayBuffer(G),L instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(L),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,L,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),G.references=1,G},B.prototype.createDynamicVertexBuffer=function(L){return this._createVertexBuffer(L,this._gl.DYNAMIC_DRAW)},B.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},B.prototype.createIndexBuffer=function(L,z){var X=this._gl.createBuffer(),G=new p.a(X);if(!X)throw new Error("Unable to create index buffer");this.bindIndexBuffer(G);var ee=this._normalizeIndexData(L);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,ee,z?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),G.references=1,G.is32Bits=ee.BYTES_PER_ELEMENT===4,G},B.prototype._normalizeIndexData=function(L){if(L instanceof Uint16Array)return L;if(this._caps.uintIndices){if(L instanceof Uint32Array)return L;for(var z=0;z<L.length;z++)if(L[z]>=65535)return new Uint32Array(L);return new Uint16Array(L)}return new Uint16Array(L)},B.prototype.bindArrayBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ARRAY_BUFFER)},B.prototype.bindUniformBlock=function(L,z,X){var G=L.program,ee=this._gl.getUniformBlockIndex(G,z);this._gl.uniformBlockBinding(G,ee,X)},B.prototype.bindIndexBuffer=function(L){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(L,this._gl.ELEMENT_ARRAY_BUFFER)},B.prototype.bindBuffer=function(L,z){(this._vaoRecordInProgress||this._currentBoundBuffer[z]!==L)&&(this._gl.bindBuffer(z,L?L.underlyingResource:null),this._currentBoundBuffer[z]=L)},B.prototype.updateArrayBuffer=function(L){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,L)},B.prototype._vertexAttribPointer=function(L,z,X,G,ee,$,fe){var me=this._currentBufferPointers[z];if(me){var ve=!1;me.active?(me.buffer!==L&&(me.buffer=L,ve=!0),me.size!==X&&(me.size=X,ve=!0),me.type!==G&&(me.type=G,ve=!0),me.normalized!==ee&&(me.normalized=ee,ve=!0),me.stride!==$&&(me.stride=$,ve=!0),me.offset!==fe&&(me.offset=fe,ve=!0)):(ve=!0,me.active=!0,me.index=z,me.size=X,me.type=G,me.normalized=ee,me.stride=$,me.offset=fe,me.buffer=L),(ve||this._vaoRecordInProgress)&&(this.bindArrayBuffer(L),this._gl.vertexAttribPointer(z,X,G,ee,$,fe))}},B.prototype._bindIndexBufferWithCache=function(L){L!=null&&this._cachedIndexBuffer!==L&&(this._cachedIndexBuffer=L,this.bindIndexBuffer(L),this._uintIndicesCurrentlySet=L.is32Bits)},B.prototype._bindVertexBuffersAttributes=function(L,z){var X=z.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var G=0;G<X.length;G++){var ee=z.getAttributeLocation(G);if(ee>=0){var $=L[X[G]];if(!$)continue;this._gl.enableVertexAttribArray(ee),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[ee]=!0);var fe=$.getBuffer();fe&&(this._vertexAttribPointer(fe,ee,$.getSize(),$.type,$.normalized,$.byteStride,$.byteOffset),$.getIsInstanced()&&(this._gl.vertexAttribDivisor(ee,$.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(ee),this._currentInstanceBuffers.push(fe))))}}},B.prototype.recordVertexArrayObject=function(L,z,X){var G=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(G),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(L,X),this.bindIndexBuffer(z),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),G},B.prototype.bindVertexArrayObject=function(L,z){this._cachedVertexArrayObject!==L&&(this._cachedVertexArrayObject=L,this._gl.bindVertexArray(L),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=z!=null&&z.is32Bits,this._mustWipeVertexAttributes=!0)},B.prototype.bindBuffersDirectly=function(L,z,X,G,ee){if(this._cachedVertexBuffers!==L||this._cachedEffectForVertexBuffers!==ee){this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=ee;var $=ee.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var fe=0,me=0;me<$;me++)if(me<X.length){var ve=ee.getAttributeLocation(me);ve>=0&&(this._gl.enableVertexAttribArray(ve),this._vertexAttribArraysEnabled[ve]=!0,this._vertexAttribPointer(L,ve,X[me],this._gl.FLOAT,!1,G,fe)),fe+=4*X[me]}}this._bindIndexBufferWithCache(z)},B.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},B.prototype.bindBuffers=function(L,z,X){this._cachedVertexBuffers===L&&this._cachedEffectForVertexBuffers===X||(this._cachedVertexBuffers=L,this._cachedEffectForVertexBuffers=X,this._bindVertexBuffersAttributes(L,X)),this._bindIndexBufferWithCache(z)},B.prototype.unbindInstanceAttributes=function(){for(var L,z=0,X=this._currentInstanceLocations.length;z<X;z++){var G=this._currentInstanceBuffers[z];L!=G&&G.references&&(L=G,this.bindArrayBuffer(G));var ee=this._currentInstanceLocations[z];this._gl.vertexAttribDivisor(ee,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},B.prototype.releaseVertexArrayObject=function(L){this._gl.deleteVertexArray(L)},B.prototype._releaseBuffer=function(L){return L.references--,L.references===0&&(this._deleteBuffer(L),!0)},B.prototype._deleteBuffer=function(L){this._gl.deleteBuffer(L.underlyingResource)},B.prototype.updateAndBindInstancesBuffer=function(L,z,X){if(this.bindArrayBuffer(L),z&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,z),X[0].index!==void 0)this.bindInstancesBuffer(L,X,!0);else for(var G=0;G<4;G++){var ee=X[G];this._vertexAttribArraysEnabled[ee]||(this._gl.enableVertexAttribArray(ee),this._vertexAttribArraysEnabled[ee]=!0),this._vertexAttribPointer(L,ee,4,this._gl.FLOAT,!1,64,16*G),this._gl.vertexAttribDivisor(ee,1),this._currentInstanceLocations.push(ee),this._currentInstanceBuffers.push(L)}},B.prototype.bindInstancesBuffer=function(L,z,X){X===void 0&&(X=!0),this.bindArrayBuffer(L);var G=0;if(X)for(var ee=0;ee<z.length;ee++)G+=4*($=z[ee]).attributeSize;for(ee=0;ee<z.length;ee++){var $;($=z[ee]).index===void 0&&($.index=this._currentEffect.getAttributeLocationByName($.attributeName)),$.index<0||(this._vertexAttribArraysEnabled[$.index]||(this._gl.enableVertexAttribArray($.index),this._vertexAttribArraysEnabled[$.index]=!0),this._vertexAttribPointer(L,$.index,$.attributeSize,$.attributeType||this._gl.FLOAT,$.normalized||!1,G,$.offset),this._gl.vertexAttribDivisor($.index,$.divisor===void 0?1:$.divisor),this._currentInstanceLocations.push($.index),this._currentInstanceBuffers.push(L))}},B.prototype.disableInstanceAttributeByName=function(L){if(this._currentEffect){var z=this._currentEffect.getAttributeLocationByName(L);this.disableInstanceAttribute(z)}},B.prototype.disableInstanceAttribute=function(L){for(var z,X=!1;(z=this._currentInstanceLocations.indexOf(L))!==-1;)this._currentInstanceLocations.splice(z,1),this._currentInstanceBuffers.splice(z,1),X=!0,z=this._currentInstanceLocations.indexOf(L);X&&(this._gl.vertexAttribDivisor(L,0),this.disableAttributeByIndex(L))},B.prototype.disableAttributeByIndex=function(L){this._gl.disableVertexAttribArray(L),this._vertexAttribArraysEnabled[L]=!1,this._currentBufferPointers[L].active=!1},B.prototype.draw=function(L,z,X,G){this.drawElementsType(L?S.a.MATERIAL_TriangleFillMode:S.a.MATERIAL_WireFrameFillMode,z,X,G)},B.prototype.drawPointClouds=function(L,z,X){this.drawArraysType(S.a.MATERIAL_PointFillMode,L,z,X)},B.prototype.drawUnIndexed=function(L,z,X,G){this.drawArraysType(L?S.a.MATERIAL_TriangleFillMode:S.a.MATERIAL_WireFrameFillMode,z,X,G)},B.prototype.drawElementsType=function(L,z,X,G){this.applyStates(),this._reportDrawCall();var ee=this._drawMode(L),$=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,fe=this._uintIndicesCurrentlySet?4:2;G?this._gl.drawElementsInstanced(ee,X,$,z*fe,G):this._gl.drawElements(ee,X,$,z*fe)},B.prototype.drawArraysType=function(L,z,X,G){this.applyStates(),this._reportDrawCall();var ee=this._drawMode(L);G?this._gl.drawArraysInstanced(ee,z,X,G):this._gl.drawArrays(ee,z,X)},B.prototype._drawMode=function(L){switch(L){case S.a.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case S.a.MATERIAL_PointFillMode:return this._gl.POINTS;case S.a.MATERIAL_WireFrameFillMode:return this._gl.LINES;case S.a.MATERIAL_PointListDrawMode:return this._gl.POINTS;case S.a.MATERIAL_LineListDrawMode:return this._gl.LINES;case S.a.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case S.a.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case S.a.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case S.a.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},B.prototype._reportDrawCall=function(){},B.prototype._releaseEffect=function(L){this._compiledEffects[L._key]&&(delete this._compiledEffects[L._key],this._deletePipelineContext(L.getPipelineContext()))},B.prototype._deletePipelineContext=function(L){var z=L;z&&z.program&&(z.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(z.program))},B.prototype.createEffect=function(L,z,X,G,ee,$,fe,me,ve){var be=(L.vertexElement||L.vertex||L.vertexToken||L.vertexSource||L)+"+"+(L.fragmentElement||L.fragment||L.fragmentToken||L.fragmentSource||L)+"@"+(ee||z.defines);if(this._compiledEffects[be]){var ie=this._compiledEffects[be];return fe&&ie.isReady()&&fe(ie),ie}var se=new m.a(L,z,X,G,this,ee,$,fe,me,ve);return se._key=be,this._compiledEffects[be]=se,se},B._ConcatenateShader=function(L,z,X){return X===void 0&&(X=""),X+(z?z+`
`:"")+L},B.prototype._compileShader=function(L,z,X,G){return this._compileRawShader(B._ConcatenateShader(L,X,G),z)},B.prototype._compileRawShader=function(L,z){var X=this._gl,G=X.createShader(z==="vertex"?X.VERTEX_SHADER:X.FRAGMENT_SHADER);if(!G)throw new Error("Something went wrong while compile the shader.");return X.shaderSource(G,L),X.compileShader(G),G},B.prototype._getShaderSource=function(L){return this._gl.getShaderSource(L)},B.prototype.createRawShaderProgram=function(L,z,X,G,ee){ee===void 0&&(ee=null),G=G||this._gl;var $=this._compileRawShader(z,"vertex"),fe=this._compileRawShader(X,"fragment");return this._createShaderProgram(L,$,fe,G,ee)},B.prototype.createShaderProgram=function(L,z,X,G,ee,$){$===void 0&&($=null),ee=ee||this._gl;var fe=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",me=this._compileShader(z,"vertex",G,fe),ve=this._compileShader(X,"fragment",G,fe);return this._createShaderProgram(L,me,ve,ee,$)},B.prototype.createPipelineContext=function(){var L=new g.a;return L.engine=this,this._caps.parallelShaderCompile&&(L.isParallelCompiled=!0),L},B.prototype._createShaderProgram=function(L,z,X,G,ee){var $=G.createProgram();if(L.program=$,!$)throw new Error("Unable to create program");return G.attachShader($,z),G.attachShader($,X),G.linkProgram($),L.context=G,L.vertexShader=z,L.fragmentShader=X,L.isParallelCompiled||this._finalizePipelineContext(L),$},B.prototype._finalizePipelineContext=function(L){var z=L.context,X=L.vertexShader,G=L.fragmentShader,ee=L.program;if(!z.getProgramParameter(ee,z.LINK_STATUS)){var $,fe;if(!this._gl.getShaderParameter(X,this._gl.COMPILE_STATUS)&&($=this._gl.getShaderInfoLog(X)))throw L.vertexCompilationError=$,new Error("VERTEX SHADER "+$);if(!this._gl.getShaderParameter(G,this._gl.COMPILE_STATUS)&&($=this._gl.getShaderInfoLog(G)))throw L.fragmentCompilationError=$,new Error("FRAGMENT SHADER "+$);if(fe=z.getProgramInfoLog(ee))throw L.programLinkError=fe,new Error(fe)}if(this.validateShaderPrograms&&(z.validateProgram(ee),!z.getProgramParameter(ee,z.VALIDATE_STATUS)&&(fe=z.getProgramInfoLog(ee))))throw L.programValidationError=fe,new Error(fe);z.deleteShader(X),z.deleteShader(G),L.vertexShader=void 0,L.fragmentShader=void 0,L.onCompiled&&(L.onCompiled(),L.onCompiled=void 0)},B.prototype._preparePipelineContext=function(L,z,X,G,ee,$,fe){var me=L;me.program=G?this.createRawShaderProgram(me,z,X,void 0,fe):this.createShaderProgram(me,z,X,$,void 0,fe),me.program.__SPECTOR_rebuildProgram=ee},B.prototype._isRenderingStateCompiled=function(L){var z=L;return!!this._gl.getProgramParameter(z.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(z),!0)},B.prototype._executeWhenRenderingStateIsCompiled=function(L,z){var X=L;if(X.isParallelCompiled){var G=X.onCompiled;X.onCompiled=G?function(){G(),z()}:z}else z()},B.prototype.getUniforms=function(L,z){for(var X=new Array,G=L,ee=0;ee<z.length;ee++)X.push(this._gl.getUniformLocation(G.program,z[ee]));return X},B.prototype.getAttributes=function(L,z){for(var X=[],G=L,ee=0;ee<z.length;ee++)try{X.push(this._gl.getAttribLocation(G.program,z[ee]))}catch($){X.push(-1)}return X},B.prototype.enableEffect=function(L){L&&L!==this._currentEffect&&(this.bindSamplers(L),this._currentEffect=L,L.onBind&&L.onBind(L),L._onBindObservable&&L._onBindObservable.notifyObservers(L))},B.prototype.setInt=function(L,z){return!!L&&(this._gl.uniform1i(L,z),!0)},B.prototype.setIntArray=function(L,z){return!!L&&(this._gl.uniform1iv(L,z),!0)},B.prototype.setIntArray2=function(L,z){return!(!L||z.length%2!=0)&&(this._gl.uniform2iv(L,z),!0)},B.prototype.setIntArray3=function(L,z){return!(!L||z.length%3!=0)&&(this._gl.uniform3iv(L,z),!0)},B.prototype.setIntArray4=function(L,z){return!(!L||z.length%4!=0)&&(this._gl.uniform4iv(L,z),!0)},B.prototype.setArray=function(L,z){return!!L&&(this._gl.uniform1fv(L,z),!0)},B.prototype.setArray2=function(L,z){return!(!L||z.length%2!=0)&&(this._gl.uniform2fv(L,z),!0)},B.prototype.setArray3=function(L,z){return!(!L||z.length%3!=0)&&(this._gl.uniform3fv(L,z),!0)},B.prototype.setArray4=function(L,z){return!(!L||z.length%4!=0)&&(this._gl.uniform4fv(L,z),!0)},B.prototype.setMatrices=function(L,z){return!!L&&(this._gl.uniformMatrix4fv(L,!1,z),!0)},B.prototype.setMatrix3x3=function(L,z){return!!L&&(this._gl.uniformMatrix3fv(L,!1,z),!0)},B.prototype.setMatrix2x2=function(L,z){return!!L&&(this._gl.uniformMatrix2fv(L,!1,z),!0)},B.prototype.setFloat=function(L,z){return!!L&&(this._gl.uniform1f(L,z),!0)},B.prototype.setFloat2=function(L,z,X){return!!L&&(this._gl.uniform2f(L,z,X),!0)},B.prototype.setFloat3=function(L,z,X,G){return!!L&&(this._gl.uniform3f(L,z,X,G),!0)},B.prototype.setFloat4=function(L,z,X,G,ee){return!!L&&(this._gl.uniform4f(L,z,X,G,ee),!0)},B.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var L=this._colorWrite;this._gl.colorMask(L,L,L,L)}},B.prototype.setColorWrite=function(L){L!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=L)},B.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(B.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),B.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},B.prototype.wipeCaches=function(L){this.preventCacheWipeBetweenFrames&&!L||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),L&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=S.a.ALPHA_ADD,this._alphaEquation=S.a.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},B.prototype._getSamplingParameters=function(L,z){var X=this._gl,G=X.NEAREST,ee=X.NEAREST;switch(L){case S.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:G=X.LINEAR,ee=z?X.LINEAR_MIPMAP_NEAREST:X.LINEAR;break;case S.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:G=X.LINEAR,ee=z?X.LINEAR_MIPMAP_LINEAR:X.LINEAR;break;case S.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:G=X.NEAREST,ee=z?X.NEAREST_MIPMAP_LINEAR:X.NEAREST;break;case S.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:G=X.NEAREST,ee=z?X.NEAREST_MIPMAP_NEAREST:X.NEAREST;break;case S.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:G=X.NEAREST,ee=z?X.LINEAR_MIPMAP_NEAREST:X.LINEAR;break;case S.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:G=X.NEAREST,ee=z?X.LINEAR_MIPMAP_LINEAR:X.LINEAR;break;case S.a.TEXTURE_NEAREST_LINEAR:G=X.NEAREST,ee=X.LINEAR;break;case S.a.TEXTURE_NEAREST_NEAREST:G=X.NEAREST,ee=X.NEAREST;break;case S.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:G=X.LINEAR,ee=z?X.NEAREST_MIPMAP_NEAREST:X.NEAREST;break;case S.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:G=X.LINEAR,ee=z?X.NEAREST_MIPMAP_LINEAR:X.NEAREST;break;case S.a.TEXTURE_LINEAR_LINEAR:G=X.LINEAR,ee=X.LINEAR;break;case S.a.TEXTURE_LINEAR_NEAREST:G=X.LINEAR,ee=X.NEAREST}return{min:ee,mag:G}},B.prototype._createTexture=function(){var L=this._gl.createTexture();if(!L)throw new Error("Unable to create texture");return L},B.prototype.createTexture=function(L,z,X,G,ee,$,fe,me,ve,be,ie,se,V){var K=this;ee===void 0&&(ee=S.a.TEXTURE_TRILINEAR_SAMPLINGMODE),$===void 0&&($=null),fe===void 0&&(fe=null),me===void 0&&(me=null),ve===void 0&&(ve=null),be===void 0&&(be=null),ie===void 0&&(ie=null);var Z=(L=L||"").substr(0,5)==="data:",le=L.substr(0,5)==="blob:",re=Z&&L.indexOf(";base64,")!==-1,Q=ve||new _.a(this,_.b.Url),W=L;!this._transformTextureUrl||re||ve||me||(L=this._transformTextureUrl(L)),W!==L&&(Q._originalUrl=W);var Y=L.lastIndexOf("."),q=ie||(Y>-1?L.substring(Y).toLowerCase():""),ae=null;q.indexOf("?")>-1&&(q=q.split("?")[0]);for(var pe=0,De=B._TextureLoaders;pe<De.length;pe++){var de=De[pe];if(de.canLoad(q,se)){ae=de;break}}G&&G._addPendingData(Q),Q.url=L,Q.generateMipMaps=!z,Q.samplingMode=ee,Q.invertY=X,this._doNotHandleContextLost||(Q._buffer=me);var ge=null;$&&!ve&&(ge=Q.onLoadedObservable.add($)),ve||this._internalTexturesCache.push(Q);var ne=function(Se,Ge){G&&G._removePendingData(Q),L===W?(ge&&Q.onLoadedObservable.remove(ge),T.a.UseFallbackTexture&&K.createTexture(T.a.FallbackTexture,z,Q.invertY,G,ee,null,fe,me,Q),fe&&fe((Se||"Unknown error")+(T.a.UseFallbackTexture?" - Fallback texture was used":""),Ge)):(O.a.Warn("Failed to load "+L+", falling back to "+W),K.createTexture(W,z,Q.invertY,G,ee,$,fe,me,Q,be,ie,se,V))};if(ae){var Te=function(Se){ae.loadData(Se,Q,function(Ge,$e,nt,et,Ze,ht){ht?ne("TextureLoader failed to load data"):K._prepareWebGLTexture(Q,G,Ge,$e,Q.invertY,!nt,et,function(){return Ze(),!1},ee)},V)};me?me instanceof ArrayBuffer?Te(new Uint8Array(me)):ArrayBuffer.isView(me)?Te(me):fe&&fe("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(L,function(Se){return Te(new Uint8Array(Se))},void 0,G?G.offlineProvider:void 0,!0,function(Se,Ge){ne("Unable to load "+(Se&&Se.responseURL,Ge))})}else{var we=function(Se){le&&!K._doNotHandleContextLost&&(Q._buffer=Se),K._prepareWebGLTexture(Q,G,Se.width,Se.height,Q.invertY,z,!1,function(Ge,$e,nt){var et=K._gl,Ze=Se.width===Ge&&Se.height===$e,ht=be?K._getInternalFormat(be):q===".jpg"?et.RGB:et.RGBA;if(Ze)return et.texImage2D(et.TEXTURE_2D,0,ht,ht,et.UNSIGNED_BYTE,Se),!1;var gt=K._caps.maxTextureSize;if(Se.width>gt||Se.height>gt||!K._supportsHardwareTextureRescaling)return K._prepareWorkingCanvas(),!(!K._workingCanvas||!K._workingContext)&&(K._workingCanvas.width=Ge,K._workingCanvas.height=$e,K._workingContext.drawImage(Se,0,0,Se.width,Se.height,0,0,Ge,$e),et.texImage2D(et.TEXTURE_2D,0,ht,ht,et.UNSIGNED_BYTE,K._workingCanvas),Q.width=Ge,Q.height=$e,!1);var Rt=new _.a(K,_.b.Temp);return K._bindTextureDirectly(et.TEXTURE_2D,Rt,!0),et.texImage2D(et.TEXTURE_2D,0,ht,ht,et.UNSIGNED_BYTE,Se),K._rescaleTexture(Rt,Q,G,ht,function(){K._releaseTexture(Rt),K._bindTextureDirectly(et.TEXTURE_2D,Q,!0),nt()}),!0},ee)};!Z||re?me&&(me.decoding||me.close)?we(me):B._FileToolsLoadImage(L,we,ne,G?G.offlineProvider:null,se):typeof me=="string"||me instanceof ArrayBuffer||ArrayBuffer.isView(me)||me instanceof Blob?B._FileToolsLoadImage(me,we,ne,G?G.offlineProvider:null,se):me&&we(me)}return Q},B._FileToolsLoadImage=function(L,z,X,G,ee){throw E.a.WarnImport("FileTools")},B.prototype._rescaleTexture=function(L,z,X,G,ee){},B.prototype.createRawTexture=function(L,z,X,G,ee,$,fe,me,ve){throw ve===void 0&&(ve=S.a.TEXTURETYPE_UNSIGNED_INT),E.a.WarnImport("Engine.RawTexture")},B.prototype.createRawCubeTexture=function(L,z,X,G,ee,$,fe,me){throw E.a.WarnImport("Engine.RawTexture")},B.prototype.createRawTexture3D=function(L,z,X,G,ee,$,fe,me,ve,be){throw be===void 0&&(be=S.a.TEXTURETYPE_UNSIGNED_INT),E.a.WarnImport("Engine.RawTexture")},B.prototype.createRawTexture2DArray=function(L,z,X,G,ee,$,fe,me,ve,be){throw be===void 0&&(be=S.a.TEXTURETYPE_UNSIGNED_INT),E.a.WarnImport("Engine.RawTexture")},B.prototype._unpackFlipY=function(L){this._unpackFlipYCached!==L&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,L?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=L))},B.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},B.prototype._getTextureTarget=function(L){return L.isCube?this._gl.TEXTURE_CUBE_MAP:L.is3D?this._gl.TEXTURE_3D:L.is2DArray||L.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},B.prototype.updateTextureSamplingMode=function(L,z,X){X===void 0&&(X=!1);var G=this._getTextureTarget(z),ee=this._getSamplingParameters(L,z.generateMipMaps||X);this._setTextureParameterInteger(G,this._gl.TEXTURE_MAG_FILTER,ee.mag,z),this._setTextureParameterInteger(G,this._gl.TEXTURE_MIN_FILTER,ee.min),X&&(z.generateMipMaps=!0,this._gl.generateMipmap(G)),this._bindTextureDirectly(G,null),z.samplingMode=L},B.prototype.updateTextureWrappingMode=function(L,z,X,G){X===void 0&&(X=null),G===void 0&&(G=null);var ee=this._getTextureTarget(L);z!==null&&(this._setTextureParameterInteger(ee,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(z),L),L._cachedWrapU=z),X!==null&&(this._setTextureParameterInteger(ee,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(X),L),L._cachedWrapV=X),(L.is2DArray||L.is3D)&&G!==null&&(this._setTextureParameterInteger(ee,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(G),L),L._cachedWrapR=G),this._bindTextureDirectly(ee,null)},B.prototype._setupDepthStencilTexture=function(L,z,X,G,ee){var $=z.width||z,fe=z.height||z,me=z.layers||0;L.baseWidth=$,L.baseHeight=fe,L.width=$,L.height=fe,L.is2DArray=me>0,L.depth=me,L.isReady=!0,L.samples=1,L.generateMipMaps=!1,L._generateDepthBuffer=!0,L._generateStencilBuffer=X,L.samplingMode=G?S.a.TEXTURE_BILINEAR_SAMPLINGMODE:S.a.TEXTURE_NEAREST_SAMPLINGMODE,L.type=S.a.TEXTURETYPE_UNSIGNED_INT,L._comparisonFunction=ee;var ve=this._gl,be=this._getTextureTarget(L),ie=this._getSamplingParameters(L.samplingMode,!1);ve.texParameteri(be,ve.TEXTURE_MAG_FILTER,ie.mag),ve.texParameteri(be,ve.TEXTURE_MIN_FILTER,ie.min),ve.texParameteri(be,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(be,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ee===0?(ve.texParameteri(be,ve.TEXTURE_COMPARE_FUNC,S.a.LEQUAL),ve.texParameteri(be,ve.TEXTURE_COMPARE_MODE,ve.NONE)):(ve.texParameteri(be,ve.TEXTURE_COMPARE_FUNC,ee),ve.texParameteri(be,ve.TEXTURE_COMPARE_MODE,ve.COMPARE_REF_TO_TEXTURE))},B.prototype._uploadCompressedDataToTextureDirectly=function(L,z,X,G,ee,$,fe){$===void 0&&($=0),fe===void 0&&(fe=0);var me=this._gl,ve=me.TEXTURE_2D;L.isCube&&(ve=me.TEXTURE_CUBE_MAP_POSITIVE_X+$),this._gl.compressedTexImage2D(ve,fe,z,X,G,0,ee)},B.prototype._uploadDataToTextureDirectly=function(L,z,X,G,ee,$){X===void 0&&(X=0),G===void 0&&(G=0),$===void 0&&($=!1);var fe=this._gl,me=this._getWebGLTextureType(L.type),ve=this._getInternalFormat(L.format),be=ee===void 0?this._getRGBABufferInternalSizedFormat(L.type,L.format):this._getInternalFormat(ee);this._unpackFlipY(L.invertY);var ie=fe.TEXTURE_2D;L.isCube&&(ie=fe.TEXTURE_CUBE_MAP_POSITIVE_X+X);var se=Math.round(Math.log(L.width)*Math.LOG2E),V=Math.round(Math.log(L.height)*Math.LOG2E),K=$?L.width:Math.pow(2,Math.max(se-G,0)),Z=$?L.height:Math.pow(2,Math.max(V-G,0));fe.texImage2D(ie,G,be,K,Z,0,ve,me,z)},B.prototype.updateTextureData=function(L,z,X,G,ee,$,fe,me){fe===void 0&&(fe=0),me===void 0&&(me=0);var ve=this._gl,be=this._getWebGLTextureType(L.type),ie=this._getInternalFormat(L.format);this._unpackFlipY(L.invertY);var se=ve.TEXTURE_2D;L.isCube&&(se=ve.TEXTURE_CUBE_MAP_POSITIVE_X+fe),ve.texSubImage2D(se,me,X,G,ee,$,ie,be,z)},B.prototype._uploadArrayBufferViewToTexture=function(L,z,X,G){X===void 0&&(X=0),G===void 0&&(G=0);var ee=this._gl,$=L.isCube?ee.TEXTURE_CUBE_MAP:ee.TEXTURE_2D;this._bindTextureDirectly($,L,!0),this._uploadDataToTextureDirectly(L,z,X,G),this._bindTextureDirectly($,null,!0)},B.prototype._prepareWebGLTextureContinuation=function(L,z,X,G,ee){var $=this._gl;if($){var fe=this._getSamplingParameters(ee,!X);$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,fe.mag),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,fe.min),X||G||$.generateMipmap($.TEXTURE_2D),this._bindTextureDirectly($.TEXTURE_2D,null),z&&z._removePendingData(L),L.onLoadedObservable.notifyObservers(L),L.onLoadedObservable.clear()}},B.prototype._prepareWebGLTexture=function(L,z,X,G,ee,$,fe,me,ve){var be=this;ve===void 0&&(ve=S.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var ie=this.getCaps().maxTextureSize,se=Math.min(ie,this.needPOTTextures?B.GetExponentOfTwo(X,ie):X),V=Math.min(ie,this.needPOTTextures?B.GetExponentOfTwo(G,ie):G),K=this._gl;K&&(L._webGLTexture?(this._bindTextureDirectly(K.TEXTURE_2D,L,!0),this._unpackFlipY(ee===void 0||!!ee),L.baseWidth=X,L.baseHeight=G,L.width=se,L.height=V,L.isReady=!0,me(se,V,function(){be._prepareWebGLTextureContinuation(L,z,$,fe,ve)})||this._prepareWebGLTextureContinuation(L,z,$,fe,ve)):z&&z._removePendingData(L))},B.prototype._setupFramebufferDepthAttachments=function(L,z,X,G,ee){ee===void 0&&(ee=1);var $=this._gl;if(L&&z)return this._getDepthStencilBuffer(X,G,ee,$.DEPTH_STENCIL,$.DEPTH24_STENCIL8,$.DEPTH_STENCIL_ATTACHMENT);if(z){var fe=$.DEPTH_COMPONENT16;return this._webGLVersion>1&&(fe=$.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(X,G,ee,fe,fe,$.DEPTH_ATTACHMENT)}return L?this._getDepthStencilBuffer(X,G,ee,$.STENCIL_INDEX8,$.STENCIL_INDEX8,$.STENCIL_ATTACHMENT):null},B.prototype._releaseFramebufferObjects=function(L){var z=this._gl;L._framebuffer&&(z.deleteFramebuffer(L._framebuffer),L._framebuffer=null),L._depthStencilBuffer&&(z.deleteRenderbuffer(L._depthStencilBuffer),L._depthStencilBuffer=null),L._MSAAFramebuffer&&(z.deleteFramebuffer(L._MSAAFramebuffer),L._MSAAFramebuffer=null),L._MSAARenderBuffer&&(z.deleteRenderbuffer(L._MSAARenderBuffer),L._MSAARenderBuffer=null)},B.prototype._releaseTexture=function(L){this._releaseFramebufferObjects(L),this._deleteTexture(L._webGLTexture),this.unbindAllTextures();var z=this._internalTexturesCache.indexOf(L);z!==-1&&this._internalTexturesCache.splice(z,1),L._lodTextureHigh&&L._lodTextureHigh.dispose(),L._lodTextureMid&&L._lodTextureMid.dispose(),L._lodTextureLow&&L._lodTextureLow.dispose(),L._irradianceTexture&&L._irradianceTexture.dispose()},B.prototype._deleteTexture=function(L){this._gl.deleteTexture(L)},B.prototype._setProgram=function(L){this._currentProgram!==L&&(this._gl.useProgram(L),this._currentProgram=L)},B.prototype.bindSamplers=function(L){var z=L.getPipelineContext();this._setProgram(z.program);for(var X=L.getSamplers(),G=0;G<X.length;G++){var ee=L.getUniform(X[G]);ee&&(this._boundUniforms[G]=ee)}this._currentEffect=null},B.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},B.prototype._bindTextureDirectly=function(L,z,X,G){X===void 0&&(X=!1),G===void 0&&(G=!1);var ee=!1,$=z&&z._associatedChannel>-1;return X&&$&&(this._activeChannel=z._associatedChannel),this._boundTexturesCache[this._activeChannel]!==z||G?(this._activateCurrentTexture(),z&&z.isMultiview?this._gl.bindTexture(L,z?z._colorTextureArray:null):this._gl.bindTexture(L,z?z._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=z,z&&(z._associatedChannel=this._activeChannel)):X&&(ee=!0,this._activateCurrentTexture()),$&&!X&&this._bindSamplerUniformToChannel(z._associatedChannel,this._activeChannel),ee},B.prototype._bindTexture=function(L,z){if(L!==void 0){z&&(z._associatedChannel=L),this._activeChannel=L;var X=z?this._getTextureTarget(z):this._gl.TEXTURE_2D;this._bindTextureDirectly(X,z)}},B.prototype.unbindAllTextures=function(){for(var L=0;L<this._maxSimultaneousTextures;L++)this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},B.prototype.setTexture=function(L,z,X){L!==void 0&&(z&&(this._boundUniforms[L]=z),this._setTexture(L,X))},B.prototype._bindSamplerUniformToChannel=function(L,z){var X=this._boundUniforms[L];X&&X._currentState!==z&&(this._gl.uniform1i(X,z),X._currentState=z)},B.prototype._getTextureWrapMode=function(L){switch(L){case S.a.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case S.a.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case S.a.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},B.prototype._setTexture=function(L,z,X,G){if(X===void 0&&(X=!1),G===void 0&&(G=!1),!z)return this._boundTexturesCache[L]!=null&&(this._activeChannel=L,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(z.video)this._activeChannel=L,z.update();else if(z.delayLoadState===S.a.DELAYLOADSTATE_NOTLOADED)return z.delayLoad(),!1;var ee;ee=G?z.depthStencilTexture:z.isReady()?z.getInternalTexture():z.isCube?this.emptyCubeTexture:z.is3D?this.emptyTexture3D:z.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!X&&ee&&(ee._associatedChannel=L);var $=!0;this._boundTexturesCache[L]===ee&&(X||this._bindSamplerUniformToChannel(ee._associatedChannel,L),$=!1),this._activeChannel=L;var fe=this._getTextureTarget(ee);if($&&this._bindTextureDirectly(fe,ee,X),ee&&!ee.isMultiview){if(ee.isCube&&ee._cachedCoordinatesMode!==z.coordinatesMode){ee._cachedCoordinatesMode=z.coordinatesMode;var me=z.coordinatesMode!==S.a.TEXTURE_CUBIC_MODE&&z.coordinatesMode!==S.a.TEXTURE_SKYBOX_MODE?S.a.TEXTURE_WRAP_ADDRESSMODE:S.a.TEXTURE_CLAMP_ADDRESSMODE;z.wrapU=me,z.wrapV=me}ee._cachedWrapU!==z.wrapU&&(ee._cachedWrapU=z.wrapU,this._setTextureParameterInteger(fe,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(z.wrapU),ee)),ee._cachedWrapV!==z.wrapV&&(ee._cachedWrapV=z.wrapV,this._setTextureParameterInteger(fe,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(z.wrapV),ee)),ee.is3D&&ee._cachedWrapR!==z.wrapR&&(ee._cachedWrapR=z.wrapR,this._setTextureParameterInteger(fe,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(z.wrapR),ee)),this._setAnisotropicLevel(fe,ee,z.anisotropicFilteringLevel)}return!0},B.prototype.setTextureArray=function(L,z,X){if(L!==void 0&&z){this._textureUnits&&this._textureUnits.length===X.length||(this._textureUnits=new Int32Array(X.length));for(var G=0;G<X.length;G++){var ee=X[G].getInternalTexture();ee?(this._textureUnits[G]=L+G,ee._associatedChannel=L+G):this._textureUnits[G]=-1}this._gl.uniform1iv(z,this._textureUnits);for(var $=0;$<X.length;$++)this._setTexture(this._textureUnits[$],X[$],!0)}},B.prototype._setAnisotropicLevel=function(L,z,X){var G=this._caps.textureAnisotropicFilterExtension;z.samplingMode!==S.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&z.samplingMode!==S.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&z.samplingMode!==S.a.TEXTURE_LINEAR_LINEAR&&(X=1),G&&z._cachedAnisotropicFilteringLevel!==X&&(this._setTextureParameterFloat(L,G.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X,this._caps.maxAnisotropy),z),z._cachedAnisotropicFilteringLevel=X)},B.prototype._setTextureParameterFloat=function(L,z,X,G){this._bindTextureDirectly(L,G,!0,!0),this._gl.texParameterf(L,z,X)},B.prototype._setTextureParameterInteger=function(L,z,X,G){G&&this._bindTextureDirectly(L,G,!0,!0),this._gl.texParameteri(L,z,X)},B.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var L=0;L<this._caps.maxVertexAttribs;L++)this.disableAttributeByIndex(L)}else{L=0;for(var z=this._vertexAttribArraysEnabled.length;L<z;L++)L>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[L]||this.disableAttributeByIndex(L)}},B.prototype.releaseEffects=function(){for(var L in this._compiledEffects){var z=this._compiledEffects[L].getPipelineContext();this._deletePipelineContext(z)}this._compiledEffects={}},B.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],R.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,m.a.ResetCache();for(var L=0,z=this._activeRequests;L<z.length;L++)z[L].abort()},B.prototype.attachContextLostEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",L,!1)},B.prototype.attachContextRestoredEvent=function(L){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",L,!1)},B.prototype.getError=function(){return this._gl.getError()},B.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(S.a.TEXTURETYPE_FLOAT)},B.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(S.a.TEXTURETYPE_HALF_FLOAT)},B.prototype._canRenderToFramebuffer=function(L){for(var z=this._gl;z.getError()!==z.NO_ERROR;);var X=!0,G=z.createTexture();z.bindTexture(z.TEXTURE_2D,G),z.texImage2D(z.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(L),1,1,0,z.RGBA,this._getWebGLTextureType(L),null),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST);var ee=z.createFramebuffer();z.bindFramebuffer(z.FRAMEBUFFER,ee),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,G,0);var $=z.checkFramebufferStatus(z.FRAMEBUFFER);if((X=(X=X&&$===z.FRAMEBUFFER_COMPLETE)&&z.getError()===z.NO_ERROR)&&(z.clear(z.COLOR_BUFFER_BIT),X=X&&z.getError()===z.NO_ERROR),X){z.bindFramebuffer(z.FRAMEBUFFER,null);var fe=z.RGBA,me=z.UNSIGNED_BYTE,ve=new Uint8Array(4);z.readPixels(0,0,1,1,fe,me,ve),X=X&&z.getError()===z.NO_ERROR}for(z.deleteTexture(G),z.deleteFramebuffer(ee),z.bindFramebuffer(z.FRAMEBUFFER,null);!X&&z.getError()!==z.NO_ERROR;);return X},B.prototype._getWebGLTextureType=function(L){if(this._webGLVersion===1){switch(L){case S.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case S.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case S.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case S.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(L){case S.a.TEXTURETYPE_BYTE:return this._gl.BYTE;case S.a.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case S.a.TEXTURETYPE_SHORT:return this._gl.SHORT;case S.a.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case S.a.TEXTURETYPE_INT:return this._gl.INT;case S.a.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case S.a.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case S.a.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case S.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case S.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case S.a.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case S.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case S.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case S.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},B.prototype._getInternalFormat=function(L){var z=this._gl.RGBA;switch(L){case S.a.TEXTUREFORMAT_ALPHA:z=this._gl.ALPHA;break;case S.a.TEXTUREFORMAT_LUMINANCE:z=this._gl.LUMINANCE;break;case S.a.TEXTUREFORMAT_LUMINANCE_ALPHA:z=this._gl.LUMINANCE_ALPHA;break;case S.a.TEXTUREFORMAT_RED:z=this._gl.RED;break;case S.a.TEXTUREFORMAT_RG:z=this._gl.RG;break;case S.a.TEXTUREFORMAT_RGB:z=this._gl.RGB;break;case S.a.TEXTUREFORMAT_RGBA:z=this._gl.RGBA}if(this._webGLVersion>1)switch(L){case S.a.TEXTUREFORMAT_RED_INTEGER:z=this._gl.RED_INTEGER;break;case S.a.TEXTUREFORMAT_RG_INTEGER:z=this._gl.RG_INTEGER;break;case S.a.TEXTUREFORMAT_RGB_INTEGER:z=this._gl.RGB_INTEGER;break;case S.a.TEXTUREFORMAT_RGBA_INTEGER:z=this._gl.RGBA_INTEGER}return z},B.prototype._getRGBABufferInternalSizedFormat=function(L,z){if(this._webGLVersion===1){if(z!==void 0)switch(z){case S.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case S.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case S.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case S.a.TEXTUREFORMAT_RGB:return this._gl.RGB}return this._gl.RGBA}switch(L){case S.a.TEXTURETYPE_BYTE:switch(z){case S.a.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case S.a.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case S.a.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case S.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case S.a.TEXTURETYPE_UNSIGNED_BYTE:switch(z){case S.a.TEXTUREFORMAT_RED:return this._gl.R8;case S.a.TEXTUREFORMAT_RG:return this._gl.RG8;case S.a.TEXTUREFORMAT_RGB:return this._gl.RGB8;case S.a.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case S.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case S.a.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case S.a.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case S.a.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case S.a.TEXTURETYPE_SHORT:switch(z){case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case S.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case S.a.TEXTURETYPE_UNSIGNED_SHORT:switch(z){case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case S.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case S.a.TEXTURETYPE_INT:switch(z){case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case S.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case S.a.TEXTURETYPE_UNSIGNED_INTEGER:switch(z){case S.a.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case S.a.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case S.a.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case S.a.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case S.a.TEXTURETYPE_FLOAT:switch(z){case S.a.TEXTUREFORMAT_RED:return this._gl.R32F;case S.a.TEXTUREFORMAT_RG:return this._gl.RG32F;case S.a.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case S.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case S.a.TEXTURETYPE_HALF_FLOAT:switch(z){case S.a.TEXTUREFORMAT_RED:return this._gl.R16F;case S.a.TEXTUREFORMAT_RG:return this._gl.RG16F;case S.a.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case S.a.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case S.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case S.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case S.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case S.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case S.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(z){case S.a.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case S.a.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},B.prototype._getRGBAMultiSampleBufferFormat=function(L){return L===S.a.TEXTURETYPE_FLOAT?this._gl.RGBA32F:L===S.a.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},B.prototype._loadFile=function(L,z,X,G,ee,$){var fe=this,me=B._FileToolsLoadFile(L,z,X,G,ee,$);return this._activeRequests.push(me),me.onCompleteObservable.add(function(ve){fe._activeRequests.splice(fe._activeRequests.indexOf(ve),1)}),me},B._FileToolsLoadFile=function(L,z,X,G,ee,$){throw E.a.WarnImport("FileTools")},B.prototype.readPixels=function(L,z,X,G,ee){ee===void 0&&(ee=!0);var $=ee?4:3,fe=ee?this._gl.RGBA:this._gl.RGB,me=new Uint8Array(G*X*$);return this._gl.readPixels(L,z,X,G,fe,this._gl.UNSIGNED_BYTE,me),me},Object.defineProperty(B,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),B.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var L=C.a.CreateCanvas(1,1),z=L.getContext("webgl")||L.getContext("experimental-webgl");this._IsSupported=z!=null&&!!window.WebGLRenderingContext}catch(X){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(B,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var L=C.a.CreateCanvas(1,1),z=L.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||L.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!z}catch(X){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),B.CeilingPOT=function(L){return L--,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L|=L>>16,++L},B.FloorPOT=function(L){return L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,(L|=L>>16)-(L>>1)},B.NearestPOT=function(L){var z=B.CeilingPOT(L),X=B.FloorPOT(L);return z-L>L-X?X:z},B.GetExponentOfTwo=function(L,z,X){var G;switch(X===void 0&&(X=S.a.SCALEMODE_NEAREST),X){case S.a.SCALEMODE_FLOOR:G=B.FloorPOT(L);break;case S.a.SCALEMODE_NEAREST:G=B.NearestPOT(L);break;case S.a.SCALEMODE_CEILING:default:G=B.CeilingPOT(L)}return Math.min(G,z)},B.QueueNewFrame=function(L,z){return R.a.IsWindowObjectExist()?(z||(z=window),z.requestPostAnimationFrame?z.requestPostAnimationFrame(L):z.requestAnimationFrame?z.requestAnimationFrame(L):z.msRequestAnimationFrame?z.msRequestAnimationFrame(L):z.webkitRequestAnimationFrame?z.webkitRequestAnimationFrame(L):z.mozRequestAnimationFrame?z.mozRequestAnimationFrame(L):z.oRequestAnimationFrame?z.oRequestAnimationFrame(L):window.setTimeout(L,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(L):setTimeout(L,16)},B.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},B.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],B._TextureLoaders=[],B.CollisionsEpsilon=.001,B._IsSupported=null,B._HasMajorPerformanceCaveat=null,B}()},function(f,s,c){c.d(s,"b",function(){return T}),c.d(s,"a",function(){return M});var T,m=c(6),E=c(102),d=c(2),x=c(21);(function(w){w[w.Unknown=0]="Unknown",w[w.Url=1]="Url",w[w.Temp=2]="Temp",w[w.Raw=3]="Raw",w[w.Dynamic=4]="Dynamic",w[w.RenderTarget=5]="RenderTarget",w[w.MultiRenderTarget=6]="MultiRenderTarget",w[w.Cube=7]="Cube",w[w.CubeRaw=8]="CubeRaw",w[w.CubePrefiltered=9]="CubePrefiltered",w[w.Raw3D=10]="Raw3D",w[w.Raw2DArray=11]="Raw2DArray",w[w.Depth=12]="Depth",w[w.CubeRawRGBD=13]="CubeRawRGBD"})(T||(T={}));var M=function(){function w(S,_,O){O===void 0&&(O=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new m.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=T.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=S,this._source=_,O||(this._webGLTexture=S._createTexture())}return w.prototype.getEngine=function(){return this._engine},Object.defineProperty(w.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),w.prototype.incrementReferences=function(){this._references++},w.prototype.updateSize=function(S,_,O){O===void 0&&(O=1),this.width=S,this.height=_,this.depth=O,this.baseWidth=S,this.baseHeight=_,this.baseDepth=O,this._size=S*_*O},w.prototype._rebuild=function(){var S,_,O=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case T.Temp:return;case T.Url:return void(_=this._engine.createTexture((S=this._originalUrl)!==null&&S!==void 0?S:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){_._swapAndDie(O),O.isReady=!0},null,this._buffer,void 0,this.format));case T.Raw:return(_=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case T.Raw3D:return(_=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case T.Raw2DArray:return(_=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case T.Dynamic:return(_=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case T.RenderTarget:var R=new E.a;if(R.generateDepthBuffer=this._generateDepthBuffer,R.generateMipMaps=this.generateMipMaps,R.generateStencilBuffer=this._generateStencilBuffer,R.samplingMode=this.samplingMode,R.type=this.type,this.isCube)_=this._engine.createRenderTargetCubeTexture(this.width,R);else{var I={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};_=this._engine.createRenderTargetTexture(I,R)}return _._swapAndDie(this),void(this.isReady=!0);case T.Depth:var y={bilinearFiltering:this.samplingMode!==d.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},p={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(_=this._engine.createDepthStencilTexture(p,y))._swapAndDie(this),void(this.isReady=!0);case T.Cube:return void(_=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){_._swapAndDie(O),O.isReady=!0},null,this.format,this._extension));case T.CubeRaw:return(_=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case T.CubeRawRGBD:return _=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void w._UpdateRGBDAsync(_,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){_._swapAndDie(O),O.isReady=!0});case T.CubePrefiltered:return void((_=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(g){g&&g._swapAndDie(O),O.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},w.prototype._swapAndDie=function(S){S._webGLTexture=this._webGLTexture,S._isRGBD=this._isRGBD,this._framebuffer&&(S._framebuffer=this._framebuffer),this._depthStencilBuffer&&(S._depthStencilBuffer=this._depthStencilBuffer),S._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(S._lodTextureHigh&&S._lodTextureHigh.dispose(),S._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(S._lodTextureMid&&S._lodTextureMid.dispose(),S._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(S._lodTextureLow&&S._lodTextureLow.dispose(),S._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(S._irradianceTexture&&S._irradianceTexture.dispose(),S._irradianceTexture=this._irradianceTexture);var _,O=this._engine.getLoadedTexturesCache();(_=O.indexOf(this))!==-1&&O.splice(_,1),(_=O.indexOf(S))===-1&&O.push(S)},w.prototype.dispose=function(){this._webGLTexture&&(this._references--,this._references===0&&(this._engine._releaseTexture(this),this._webGLTexture=null))},w._UpdateRGBDAsync=function(S,_,O,R,I){throw x.a.WarnImport("environmentTextureTools")},w}()},function(f,s,c){c.d(s,"b",function(){return T}),c.d(s,"c",function(){return m}),c.d(s,"a",function(){return E});var T=1/2.2,m=2.2,E=.001},function(f,s,c){c.d(s,"a",function(){return w});var T=c(1),m=c(0),E=c(3),d=c(6),x=c(22),M=c(21),w=function(){function S(_,O){O===void 0&&(O=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=m.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new d.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=_,this.id=_,this._scene=O||x.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return S.AddNodeConstructor=function(_,O){this._NodeConstructors[_]=O},S.Construct=function(_,O,R,I){var y=this._NodeConstructors[_];return y?y(O,R,I):null},Object.defineProperty(S.prototype,"doNotSerialize",{get:function(){return!!this._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(_){this._doNotSerialize=_},enumerable:!1,configurable:!0}),S.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(S.prototype,"parent",{get:function(){return this._parentNode},set:function(_){if(this._parentNode!==_){var O=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var R=this._parentNode._children.indexOf(this);R!==-1&&this._parentNode._children.splice(R,1),_||this._isDisposed||this._addToSceneRootNodes()}this._parentNode=_,this._parentNode&&(this._parentNode._children!==void 0&&this._parentNode._children!==null||(this._parentNode._children=new Array),this._parentNode._children.push(this),O||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),S.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},S.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var _=this._scene.rootNodes,O=_.length-1;_[this._sceneRootNodesIndex]=_[O],_[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(S.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(_){this._animationPropertiesOverride=_},enumerable:!1,configurable:!0}),S.prototype.getClassName=function(){return"Node"},Object.defineProperty(S.prototype,"onDispose",{set:function(_){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(_)},enumerable:!1,configurable:!0}),S.prototype.getScene=function(){return this._scene},S.prototype.getEngine=function(){return this._scene.getEngine()},S.prototype.addBehavior=function(_,O){var R=this;return O===void 0&&(O=!1),this._behaviors.indexOf(_)!==-1||(_.init(),this._scene.isLoading&&!O?this._scene.onDataLoadedObservable.addOnce(function(){_.attach(R)}):_.attach(this),this._behaviors.push(_)),this},S.prototype.removeBehavior=function(_){var O=this._behaviors.indexOf(_);return O===-1||(this._behaviors[O].detach(),this._behaviors.splice(O,1)),this},Object.defineProperty(S.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),S.prototype.getBehaviorByName=function(_){for(var O=0,R=this._behaviors;O<R.length;O++){var I=R[O];if(I.name===_)return I}return null},S.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},S.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(S.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),S.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},S.prototype.updateCache=function(_){!_&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},S.prototype._getActionManagerForTrigger=function(_,O){return this.parent?this.parent._getActionManagerForTrigger(_,!1):null},S.prototype._updateCache=function(_){},S.prototype._isSynchronized=function(){return!0},S.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},S.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},S.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},S.prototype.isReady=function(_){return this._isReady},S.prototype.isEnabled=function(_){return _===void 0&&(_=!0),_===!1?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},S.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(_){_._syncParentEnabledState()})},S.prototype.setEnabled=function(_){this._isEnabled=_,this._syncParentEnabledState()},S.prototype.isDescendantOf=function(_){return!!this.parent&&(this.parent===_||this.parent.isDescendantOf(_))},S.prototype._getDescendants=function(_,O,R){if(O===void 0&&(O=!1),this._children)for(var I=0;I<this._children.length;I++){var y=this._children[I];R&&!R(y)||_.push(y),O||y._getDescendants(_,!1,R)}},S.prototype.getDescendants=function(_,O){var R=new Array;return this._getDescendants(R,_,O),R},S.prototype.getChildMeshes=function(_,O){var R=[];return this._getDescendants(R,_,function(I){return(!O||O(I))&&I.cullingStrategy!==void 0}),R},S.prototype.getChildren=function(_,O){return O===void 0&&(O=!0),this.getDescendants(O,_)},S.prototype._setReady=function(_){_!==this._isReady&&(_?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},S.prototype.getAnimationByName=function(_){for(var O=0;O<this.animations.length;O++){var R=this.animations[O];if(R.name===_)return R}return null},S.prototype.createAnimationRange=function(_,O,R){if(!this._ranges[_]){this._ranges[_]=S._AnimationRangeFactory(_,O,R);for(var I=0,y=this.animations.length;I<y;I++)this.animations[I]&&this.animations[I].createRange(_,O,R)}},S.prototype.deleteAnimationRange=function(_,O){O===void 0&&(O=!0);for(var R=0,I=this.animations.length;R<I;R++)this.animations[R]&&this.animations[R].deleteRange(_,O);this._ranges[_]=null},S.prototype.getAnimationRange=function(_){return this._ranges[_]||null},S.prototype.getAnimationRanges=function(){var _,O=[];for(_ in this._ranges)O.push(this._ranges[_]);return O},S.prototype.beginAnimation=function(_,O,R,I){var y=this.getAnimationRange(_);return y?this._scene.beginAnimation(this,y.from,y.to,O,R,I):null},S.prototype.serializeAnimationRanges=function(){var _=[];for(var O in this._ranges){var R=this._ranges[O];if(R){var I={};I.name=O,I.from=R.from,I.to=R.to,_.push(I)}}return _},S.prototype.computeWorldMatrix=function(_){return this._worldMatrix||(this._worldMatrix=m.a.Identity()),this._worldMatrix},S.prototype.dispose=function(_,O){if(O===void 0&&(O=!1),this._isDisposed=!0,!_)for(var R=0,I=this.getDescendants(!0);R<I.length;R++)I[R].dispose(_,O);this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var y=0,p=this._behaviors;y<p.length;y++)p[y].detach();this._behaviors=[]},S.ParseAnimationRanges=function(_,O,R){if(O.ranges)for(var I=0;I<O.ranges.length;I++){var y=O.ranges[I];_.createAnimationRange(y.name,y.from,y.to)}},S.prototype.getHierarchyBoundingVectors=function(_,O){var R,I;if(_===void 0&&(_=!0),O===void 0&&(O=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var y=this.getBoundingInfo();R=y.boundingBox.minimumWorld.clone(),I=y.boundingBox.maximumWorld.clone()}else R=new m.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),I=new m.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(_)for(var p=0,g=this.getDescendants(!1);p<g.length;p++){var C=g[p];if(C.computeWorldMatrix(!0),(!O||O(C))&&C.getBoundingInfo&&C.getTotalVertices()!==0){var P=C.getBoundingInfo().boundingBox,F=P.minimumWorld,U=P.maximumWorld;m.e.CheckExtends(F,R,I),m.e.CheckExtends(U,R,I)}}return{min:R,max:I}},S._AnimationRangeFactory=function(_,O,R){throw M.a.WarnImport("AnimationRange")},S._NodeConstructors={},Object(T.c)([Object(E.c)()],S.prototype,"name",void 0),Object(T.c)([Object(E.c)()],S.prototype,"id",void 0),Object(T.c)([Object(E.c)()],S.prototype,"uniqueId",void 0),Object(T.c)([Object(E.c)()],S.prototype,"state",void 0),Object(T.c)([Object(E.c)()],S.prototype,"metadata",void 0),S}()},function(f,s,c){c.d(s,"b",function(){return fe}),c.d(s,"a",function(){return me});var T=c(1),m=c(3),E=c(33),d=c(20),x=c(0),M=c(9),w=c(4),S=c(105),_=c(42),O=c(25),R=c(76),I=c(87),y=c(15),p=c(10),g=c(11),C=c(19),P=c(5),F=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;P.a.IncludesShadersStore.defaultFragmentDeclaration=F;var U=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
vec4 vDetailInfos;
mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;P.a.IncludesShadersStore.defaultUboDeclaration=U,c(160),c(59),c(106),c(107),c(154),c(130),c(161),c(131),c(108),c(109),c(132),c(133),c(115),c(116),c(125),c(110),c(134),c(162),c(135),c(155),c(136);var B=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector);
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif

vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
gl_FragData[0]=color;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=specularMapColor;
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
}
`;P.a.ShadersStore.defaultPixelShader=B;var L=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;P.a.IncludesShadersStore.defaultVertexDeclaration=L,c(78),c(79),c(163),c(164),c(117),c(137),c(93),c(94),c(100),c(80),c(81),c(165),c(156),c(111),c(157),c(138),P.a.IncludesShadersStore.pointCloudVertex=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,c(158);var z=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;P.a.ShadersStore.defaultVertexShader=z;var X=c(2),G=c(67),ee=c(92),$={effect:null,subMesh:null},fe=function(ve){function be(){var ie=ve.call(this)||this;return ie.MAINUV1=!1,ie.MAINUV2=!1,ie.DIFFUSE=!1,ie.DIFFUSEDIRECTUV=0,ie.DETAIL=!1,ie.DETAILDIRECTUV=0,ie.DETAIL_NORMALBLENDMETHOD=0,ie.AMBIENT=!1,ie.AMBIENTDIRECTUV=0,ie.OPACITY=!1,ie.OPACITYDIRECTUV=0,ie.OPACITYRGB=!1,ie.REFLECTION=!1,ie.EMISSIVE=!1,ie.EMISSIVEDIRECTUV=0,ie.SPECULAR=!1,ie.SPECULARDIRECTUV=0,ie.BUMP=!1,ie.BUMPDIRECTUV=0,ie.PARALLAX=!1,ie.PARALLAXOCCLUSION=!1,ie.SPECULAROVERALPHA=!1,ie.CLIPPLANE=!1,ie.CLIPPLANE2=!1,ie.CLIPPLANE3=!1,ie.CLIPPLANE4=!1,ie.CLIPPLANE5=!1,ie.CLIPPLANE6=!1,ie.ALPHATEST=!1,ie.DEPTHPREPASS=!1,ie.ALPHAFROMDIFFUSE=!1,ie.POINTSIZE=!1,ie.FOG=!1,ie.SPECULARTERM=!1,ie.DIFFUSEFRESNEL=!1,ie.OPACITYFRESNEL=!1,ie.REFLECTIONFRESNEL=!1,ie.REFRACTIONFRESNEL=!1,ie.EMISSIVEFRESNEL=!1,ie.FRESNEL=!1,ie.NORMAL=!1,ie.UV1=!1,ie.UV2=!1,ie.VERTEXCOLOR=!1,ie.VERTEXALPHA=!1,ie.NUM_BONE_INFLUENCERS=0,ie.BonesPerMesh=0,ie.BONETEXTURE=!1,ie.BONES_VELOCITY_ENABLED=!1,ie.INSTANCES=!1,ie.THIN_INSTANCES=!1,ie.GLOSSINESS=!1,ie.ROUGHNESS=!1,ie.EMISSIVEASILLUMINATION=!1,ie.LINKEMISSIVEWITHDIFFUSE=!1,ie.REFLECTIONFRESNELFROMSPECULAR=!1,ie.LIGHTMAP=!1,ie.LIGHTMAPDIRECTUV=0,ie.OBJECTSPACE_NORMALMAP=!1,ie.USELIGHTMAPASSHADOWMAP=!1,ie.REFLECTIONMAP_3D=!1,ie.REFLECTIONMAP_SPHERICAL=!1,ie.REFLECTIONMAP_PLANAR=!1,ie.REFLECTIONMAP_CUBIC=!1,ie.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,ie.REFLECTIONMAP_PROJECTION=!1,ie.REFLECTIONMAP_SKYBOX=!1,ie.REFLECTIONMAP_EXPLICIT=!1,ie.REFLECTIONMAP_EQUIRECTANGULAR=!1,ie.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,ie.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,ie.INVERTCUBICMAP=!1,ie.LOGARITHMICDEPTH=!1,ie.REFRACTION=!1,ie.REFRACTIONMAP_3D=!1,ie.REFLECTIONOVERALPHA=!1,ie.TWOSIDEDLIGHTING=!1,ie.SHADOWFLOAT=!1,ie.MORPHTARGETS=!1,ie.MORPHTARGETS_NORMAL=!1,ie.MORPHTARGETS_TANGENT=!1,ie.MORPHTARGETS_UV=!1,ie.NUM_MORPH_INFLUENCERS=0,ie.NONUNIFORMSCALING=!1,ie.PREMULTIPLYALPHA=!1,ie.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,ie.ALPHABLEND=!0,ie.PREPASS=!1,ie.PREPASS_IRRADIANCE=!1,ie.PREPASS_IRRADIANCE_INDEX=-1,ie.PREPASS_ALBEDO=!1,ie.PREPASS_ALBEDO_INDEX=-1,ie.PREPASS_DEPTHNORMAL=!1,ie.PREPASS_DEPTHNORMAL_INDEX=-1,ie.PREPASS_POSITION=!1,ie.PREPASS_POSITION_INDEX=-1,ie.PREPASS_VELOCITY=!1,ie.PREPASS_VELOCITY_INDEX=-1,ie.PREPASS_REFLECTIVITY=!1,ie.PREPASS_REFLECTIVITY_INDEX=-1,ie.SCENE_MRT_COUNT=0,ie.RGBDLIGHTMAP=!1,ie.RGBDREFLECTION=!1,ie.RGBDREFRACTION=!1,ie.IMAGEPROCESSING=!1,ie.VIGNETTE=!1,ie.VIGNETTEBLENDMODEMULTIPLY=!1,ie.VIGNETTEBLENDMODEOPAQUE=!1,ie.TONEMAPPING=!1,ie.TONEMAPPING_ACES=!1,ie.CONTRAST=!1,ie.COLORCURVES=!1,ie.COLORGRADING=!1,ie.COLORGRADING3D=!1,ie.SAMPLER3DGREENDEPTH=!1,ie.SAMPLER3DBGRMAP=!1,ie.IMAGEPROCESSINGPOSTPROCESS=!1,ie.MULTIVIEW=!1,ie.IS_REFLECTION_LINEAR=!1,ie.IS_REFRACTION_LINEAR=!1,ie.EXPOSURE=!1,ie.rebuild(),ie}return Object(T.d)(be,ve),be.prototype.setReflectionMode=function(ie){for(var se=0,V=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];se<V.length;se++){var K=V[se];this[K]=K===ie}},be}(R.a),me=function(ve){function be(ie,se){var V=ve.call(this,ie,se)||this;return V._diffuseTexture=null,V._ambientTexture=null,V._opacityTexture=null,V._reflectionTexture=null,V._emissiveTexture=null,V._specularTexture=null,V._bumpTexture=null,V._lightmapTexture=null,V._refractionTexture=null,V.ambientColor=new M.a(0,0,0),V.diffuseColor=new M.a(1,1,1),V.specularColor=new M.a(1,1,1),V.emissiveColor=new M.a(0,0,0),V.specularPower=64,V._useAlphaFromDiffuseTexture=!1,V._useEmissiveAsIllumination=!1,V._linkEmissiveWithDiffuse=!1,V._useSpecularOverAlpha=!1,V._useReflectionOverAlpha=!1,V._disableLighting=!1,V._useObjectSpaceNormalMap=!1,V._useParallax=!1,V._useParallaxOcclusion=!1,V.parallaxScaleBias=.05,V._roughness=0,V.indexOfRefraction=.98,V.invertRefractionY=!0,V.alphaCutOff=.4,V._useLightmapAsShadowmap=!1,V._useReflectionFresnelFromSpecular=!1,V._useGlossinessFromSpecularMapAlpha=!1,V._maxSimultaneousLights=4,V._invertNormalMapX=!1,V._invertNormalMapY=!1,V._twoSidedLighting=!1,V.detailMap=new ee.a(V._markAllSubMeshesAsTexturesDirty.bind(V)),V._renderTargets=new E.a(16),V._worldViewProjectionMatrix=x.a.Zero(),V._globalAmbientColor=new M.a(0,0,0),V._rebuildInParallel=!1,V._attachImageProcessingConfiguration(null),V.prePassConfiguration=new S.a,V.getRenderTargetTextures=function(){return V._renderTargets.reset(),be.ReflectionTextureEnabled&&V._reflectionTexture&&V._reflectionTexture.isRenderTarget&&V._renderTargets.push(V._reflectionTexture),be.RefractionTextureEnabled&&V._refractionTexture&&V._refractionTexture.isRenderTarget&&V._renderTargets.push(V._refractionTexture),V._renderTargets},V}return Object(T.d)(be,ve),Object.defineProperty(be.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(ie){this._attachImageProcessingConfiguration(ie),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),be.prototype._attachImageProcessingConfiguration=function(ie){var se=this;ie!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=ie||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){se._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(be.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(ie){this.imageProcessingConfiguration.colorCurvesEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(ie){this.imageProcessingConfiguration.colorGradingEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(ie){this._imageProcessingConfiguration.toneMappingEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(ie){this._imageProcessingConfiguration.exposure=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(ie){this._imageProcessingConfiguration.contrast=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(ie){this._imageProcessingConfiguration.colorGradingTexture=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(ie){this._imageProcessingConfiguration.colorCurves=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(be.prototype,"hasRenderTargetTextures",{get:function(){return!!(be.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(be.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),be.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(be.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(ie){this._useLogarithmicDepth=ie&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),be.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},be.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===O.a.MATERIAL_ALPHATEST)},be.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==O.a.MATERIAL_OPAQUE},be.prototype._hasAlphaChannel=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null},be.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},be.prototype.isReadyForSubMesh=function(ie,se,V){if(V===void 0&&(V=!1),se.effect&&this.isFrozen&&se.effect._wasPreviouslyReady)return!0;se._materialDefines||(se._materialDefines=new fe);var K=this.getScene(),Z=se._materialDefines;if(this._isReadyForSubMesh(se))return!0;var le=K.getEngine();if(Z._needNormals=y.a.PrepareDefinesForLights(K,ie,Z,!0,this._maxSimultaneousLights,this._disableLighting),y.a.PrepareDefinesForMultiview(K,Z),y.a.PrepareDefinesForPrePass(K,Z,this.canRenderToMRT),Z._areTexturesDirty){if(Z._needUVs=!1,Z.MAINUV1=!1,Z.MAINUV2=!1,K.texturesEnabled){if(this._diffuseTexture&&be.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._diffuseTexture,Z,"DIFFUSE")}else Z.DIFFUSE=!1;if(this._ambientTexture&&be.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._ambientTexture,Z,"AMBIENT")}else Z.AMBIENT=!1;if(this._opacityTexture&&be.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._opacityTexture,Z,"OPACITY"),Z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else Z.OPACITY=!1;if(this._reflectionTexture&&be.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(Z._needNormals=!0,Z.REFLECTION=!0,Z.ROUGHNESS=this._roughness>0,Z.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,Z.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.a.INVCUBIC_MODE,Z.REFLECTIONMAP_3D=this._reflectionTexture.isCube,Z.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case p.a.EXPLICIT_MODE:Z.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.a.PLANAR_MODE:Z.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.a.PROJECTION_MODE:Z.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.a.SKYBOX_MODE:Z.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case p.a.SPHERICAL_MODE:Z.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.a.EQUIRECTANGULAR_MODE:Z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.a.FIXED_EQUIRECTANGULAR_MODE:Z.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Z.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.a.CUBIC_MODE:case p.a.INVCUBIC_MODE:default:Z.setReflectionMode("REFLECTIONMAP_CUBIC")}Z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else Z.REFLECTION=!1;if(this._emissiveTexture&&be.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._emissiveTexture,Z,"EMISSIVE")}else Z.EMISSIVE=!1;if(this._lightmapTexture&&be.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._lightmapTexture,Z,"LIGHTMAP"),Z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else Z.LIGHTMAP=!1;if(this._specularTexture&&be.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;y.a.PrepareDefinesForMergedUV(this._specularTexture,Z,"SPECULAR"),Z.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else Z.SPECULAR=!1;if(K.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&be.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;y.a.PrepareDefinesForMergedUV(this._bumpTexture,Z,"BUMP"),Z.PARALLAX=this._useParallax,Z.PARALLAXOCCLUSION=this._useParallaxOcclusion,Z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else Z.BUMP=!1;if(this._refractionTexture&&be.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;Z._needUVs=!0,Z.REFRACTION=!0,Z.REFRACTIONMAP_3D=this._refractionTexture.isCube,Z.RGBDREFRACTION=this._refractionTexture.isRGBD}else Z.REFRACTION=!1;Z.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else Z.DIFFUSE=!1,Z.AMBIENT=!1,Z.OPACITY=!1,Z.REFLECTION=!1,Z.EMISSIVE=!1,Z.LIGHTMAP=!1,Z.BUMP=!1,Z.REFRACTION=!1;Z.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),Z.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,Z.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,Z.SPECULAROVERALPHA=this._useSpecularOverAlpha,Z.PREMULTIPLYALPHA=this.alphaMode===X.a.ALPHA_PREMULTIPLIED||this.alphaMode===X.a.ALPHA_PREMULTIPLIED_PORTERDUFF,Z.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,Z.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(ie)}if(!this.detailMap.isReadyForSubMesh(Z,K))return!1;if(Z._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(Z),Z.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,Z.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if(Z._areFresnelDirty&&(be.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(Z.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,Z.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,Z.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,Z.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,Z.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,Z.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,Z._needNormals=!0,Z.FRESNEL=!0):Z.FRESNEL=!1),y.a.PrepareDefinesForMisc(ie,K,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(ie)||this._forceAlphaTest,Z),y.a.PrepareDefinesForAttributes(ie,Z,!0,!0,!0),y.a.PrepareDefinesForFrameBoundValues(K,le,Z,V,null,se.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines(Z,K),Z.isDirty){var re=Z._areLightsDisposed;Z.markAsProcessed();var Q=new G.a;Z.REFLECTION&&Q.addFallback(0,"REFLECTION"),Z.SPECULAR&&Q.addFallback(0,"SPECULAR"),Z.BUMP&&Q.addFallback(0,"BUMP"),Z.PARALLAX&&Q.addFallback(1,"PARALLAX"),Z.PARALLAXOCCLUSION&&Q.addFallback(0,"PARALLAXOCCLUSION"),Z.SPECULAROVERALPHA&&Q.addFallback(0,"SPECULAROVERALPHA"),Z.FOG&&Q.addFallback(1,"FOG"),Z.POINTSIZE&&Q.addFallback(0,"POINTSIZE"),Z.LOGARITHMICDEPTH&&Q.addFallback(0,"LOGARITHMICDEPTH"),y.a.HandleFallbacksForShadows(Z,Q,this._maxSimultaneousLights),Z.SPECULARTERM&&Q.addFallback(0,"SPECULARTERM"),Z.DIFFUSEFRESNEL&&Q.addFallback(1,"DIFFUSEFRESNEL"),Z.OPACITYFRESNEL&&Q.addFallback(2,"OPACITYFRESNEL"),Z.REFLECTIONFRESNEL&&Q.addFallback(3,"REFLECTIONFRESNEL"),Z.EMISSIVEFRESNEL&&Q.addFallback(4,"EMISSIVEFRESNEL"),Z.FRESNEL&&Q.addFallback(4,"FRESNEL"),Z.MULTIVIEW&&Q.addFallback(0,"MULTIVIEW");var W=[w.b.PositionKind];Z.NORMAL&&W.push(w.b.NormalKind),Z.UV1&&W.push(w.b.UVKind),Z.UV2&&W.push(w.b.UV2Kind),Z.VERTEXCOLOR&&W.push(w.b.ColorKind),y.a.PrepareAttributesForBones(W,ie,Z,Q),y.a.PrepareAttributesForInstances(W,Z),y.a.PrepareAttributesForMorphTargets(W,ie,Z);var Y="default",q=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],ae=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],pe=["Material","Scene"];ee.a.AddUniforms(q),ee.a.AddSamplers(ae),S.a.AddUniforms(q),S.a.AddSamplers(q),_.a&&(_.a.PrepareUniforms(q,Z),_.a.PrepareSamplers(ae,Z)),y.a.PrepareUniformsAndSamplersList({uniformsNames:q,uniformBuffersNames:pe,samplers:ae,defines:Z,maxSimultaneousLights:this._maxSimultaneousLights});var De={};this.customShaderNameResolve&&(Y=this.customShaderNameResolve(Y,q,pe,ae,Z,W,De));var de=Z.toString(),ge=se.effect,ne=K.getEngine().createEffect(Y,{attributes:W,uniformsNames:q,uniformBuffersNames:pe,samplers:ae,defines:de,fallbacks:Q,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Z.NUM_MORPH_INFLUENCERS},processFinalCode:De.processFinalCode,multiTarget:Z.PREPASS},le);if(ne)if(this._onEffectCreatedObservable&&($.effect=ne,$.subMesh=se,this._onEffectCreatedObservable.notifyObservers($)),this.allowShaderHotSwapping&&ge&&!ne.isReady()){if(ne=ge,this._rebuildInParallel=!0,Z.markAsUnprocessed(),re)return Z._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,K.resetCachedMaterial(),se.setEffect(ne,Z),this.buildUniformLayout()}return!(!se.effect||!se.effect.isReady())&&(Z._renderId=K.getRenderId(),se.effect._wasPreviouslyReady=!0,!0)},be.prototype.buildUniformLayout=function(){var ie=this._uniformBuffer;ie.addUniform("diffuseLeftColor",4),ie.addUniform("diffuseRightColor",4),ie.addUniform("opacityParts",4),ie.addUniform("reflectionLeftColor",4),ie.addUniform("reflectionRightColor",4),ie.addUniform("refractionLeftColor",4),ie.addUniform("refractionRightColor",4),ie.addUniform("emissiveLeftColor",4),ie.addUniform("emissiveRightColor",4),ie.addUniform("vDiffuseInfos",2),ie.addUniform("vAmbientInfos",2),ie.addUniform("vOpacityInfos",2),ie.addUniform("vReflectionInfos",2),ie.addUniform("vReflectionPosition",3),ie.addUniform("vReflectionSize",3),ie.addUniform("vEmissiveInfos",2),ie.addUniform("vLightmapInfos",2),ie.addUniform("vSpecularInfos",2),ie.addUniform("vBumpInfos",3),ie.addUniform("diffuseMatrix",16),ie.addUniform("ambientMatrix",16),ie.addUniform("opacityMatrix",16),ie.addUniform("reflectionMatrix",16),ie.addUniform("emissiveMatrix",16),ie.addUniform("lightmapMatrix",16),ie.addUniform("specularMatrix",16),ie.addUniform("bumpMatrix",16),ie.addUniform("vTangentSpaceParams",2),ie.addUniform("pointSize",1),ie.addUniform("refractionMatrix",16),ie.addUniform("vRefractionInfos",4),ie.addUniform("vSpecularColor",4),ie.addUniform("vEmissiveColor",3),ie.addUniform("visibility",1),ie.addUniform("vDiffuseColor",4),ee.a.PrepareUniformBuffer(ie),ie.create()},be.prototype.unbind=function(){if(this._activeEffect){var ie=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),ie=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),ie=!0),ie&&this._markAllSubMeshesAsTexturesDirty()}ve.prototype.unbind.call(this)},be.prototype.bindForSubMesh=function(ie,se,V){var K=this.getScene(),Z=V._materialDefines;if(Z){var le=V.effect;if(le){this._activeEffect=le,Z.INSTANCES&&!Z.THIN_INSTANCES||this.bindOnlyWorldMatrix(ie),this.prePassConfiguration.bindForSubMesh(this._activeEffect,K,se,ie,this.isFrozen),Z.OBJECTSPACE_NORMALMAP&&(ie.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var re=this._mustRebind(K,le,se.visibility);y.a.BindBonesParameters(se,le);var Q=this._uniformBuffer;if(re){if(Q.bindToEffect(le,"Material"),this.bindViewProjection(le),!Q.useUbo||!this.isFrozen||!Q.isSync){if(be.FresnelEnabled&&Z.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Q.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),Q.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&Q.updateColor4("opacityParts",new M.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Q.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),Q.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(Q.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),Q.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Q.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),Q.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),K.texturesEnabled){if(this._diffuseTexture&&be.DiffuseTextureEnabled&&(Q.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),y.a.BindTextureMatrix(this._diffuseTexture,Q,"diffuse")),this._ambientTexture&&be.AmbientTextureEnabled&&(Q.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),y.a.BindTextureMatrix(this._ambientTexture,Q,"ambient")),this._opacityTexture&&be.OpacityTextureEnabled&&(Q.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),y.a.BindTextureMatrix(this._opacityTexture,Q,"opacity")),this._hasAlphaChannel()&&le.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&be.ReflectionTextureEnabled&&(Q.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),Q.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var W=this._reflectionTexture;Q.updateVector3("vReflectionPosition",W.boundingBoxPosition),Q.updateVector3("vReflectionSize",W.boundingBoxSize)}if(this._emissiveTexture&&be.EmissiveTextureEnabled&&(Q.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),y.a.BindTextureMatrix(this._emissiveTexture,Q,"emissive")),this._lightmapTexture&&be.LightmapTextureEnabled&&(Q.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),y.a.BindTextureMatrix(this._lightmapTexture,Q,"lightmap")),this._specularTexture&&be.SpecularTextureEnabled&&(Q.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),y.a.BindTextureMatrix(this._specularTexture,Q,"specular")),this._bumpTexture&&K.getEngine().getCaps().standardDerivatives&&be.BumpTextureEnabled&&(Q.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),y.a.BindTextureMatrix(this._bumpTexture,Q,"bump"),K._mirroredCameraPosition?Q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Q.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&be.RefractionTextureEnabled){var Y=1;this._refractionTexture.isCube||(Q.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(Y=this._refractionTexture.depth)),Q.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,Y,this.invertRefractionY?-1:1)}}this.pointsCloud&&Q.updateFloat("pointSize",this.pointSize),Z.SPECULARTERM&&Q.updateColor4("vSpecularColor",this.specularColor,this.specularPower),Q.updateColor3("vEmissiveColor",be.EmissiveTextureEnabled?this.emissiveColor:M.a.BlackReadOnly),Q.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}Q.updateFloat("visibility",se.visibility),K.texturesEnabled&&(this._diffuseTexture&&be.DiffuseTextureEnabled&&le.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&be.AmbientTextureEnabled&&le.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&be.OpacityTextureEnabled&&le.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&be.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?le.setTexture("reflectionCubeSampler",this._reflectionTexture):le.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&be.EmissiveTextureEnabled&&le.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&be.LightmapTextureEnabled&&le.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&be.SpecularTextureEnabled&&le.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&K.getEngine().getCaps().standardDerivatives&&be.BumpTextureEnabled&&le.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&be.RefractionTextureEnabled)&&(Y=1,this._refractionTexture.isCube?le.setTexture("refractionCubeSampler",this._refractionTexture):le.setTexture("refraction2DSampler",this._refractionTexture)),this.detailMap.bindForSubMesh(Q,K,this.isFrozen),y.a.BindClipPlane(le,K),K.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),y.a.BindEyePosition(le,K),le.setColor3("vAmbientColor",this._globalAmbientColor)}!re&&this.isFrozen||(K.lightsEnabled&&!this._disableLighting&&y.a.BindLights(K,se,le,Z,this._maxSimultaneousLights,this._rebuildInParallel),(K.fogEnabled&&se.applyFog&&K.fogMode!==d.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(le),y.a.BindFogParameters(K,se,le),Z.NUM_MORPH_INFLUENCERS&&y.a.BindMorphTargetParameters(se,le),this.useLogarithmicDepth&&y.a.BindLogDepth(Z,le,K),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),Q.update(),this._afterBind(se,this._activeEffect)}}},be.prototype.getAnimatables=function(){var ie=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&ie.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&ie.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&ie.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&ie.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&ie.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&ie.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&ie.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&ie.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&ie.push(this._refractionTexture),this.detailMap.getAnimatables(ie),ie},be.prototype.getActiveTextures=function(){var ie=ve.prototype.getActiveTextures.call(this);return this._diffuseTexture&&ie.push(this._diffuseTexture),this._ambientTexture&&ie.push(this._ambientTexture),this._opacityTexture&&ie.push(this._opacityTexture),this._reflectionTexture&&ie.push(this._reflectionTexture),this._emissiveTexture&&ie.push(this._emissiveTexture),this._specularTexture&&ie.push(this._specularTexture),this._bumpTexture&&ie.push(this._bumpTexture),this._lightmapTexture&&ie.push(this._lightmapTexture),this._refractionTexture&&ie.push(this._refractionTexture),this.detailMap.getActiveTextures(ie),ie},be.prototype.hasTexture=function(ie){return!!ve.prototype.hasTexture.call(this,ie)||this._diffuseTexture===ie||this._ambientTexture===ie||this._opacityTexture===ie||this._reflectionTexture===ie||this._emissiveTexture===ie||this._specularTexture===ie||this._bumpTexture===ie||this._lightmapTexture===ie||this._refractionTexture===ie||this.detailMap.hasTexture(ie)},be.prototype.dispose=function(ie,se){var V,K,Z,le,re,Q,W,Y,q;se&&((V=this._diffuseTexture)===null||V===void 0||V.dispose(),(K=this._ambientTexture)===null||K===void 0||K.dispose(),(Z=this._opacityTexture)===null||Z===void 0||Z.dispose(),(le=this._reflectionTexture)===null||le===void 0||le.dispose(),(re=this._emissiveTexture)===null||re===void 0||re.dispose(),(Q=this._specularTexture)===null||Q===void 0||Q.dispose(),(W=this._bumpTexture)===null||W===void 0||W.dispose(),(Y=this._lightmapTexture)===null||Y===void 0||Y.dispose(),(q=this._refractionTexture)===null||q===void 0||q.dispose()),this.detailMap.dispose(se),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),ve.prototype.dispose.call(this,ie,se)},be.prototype.clone=function(ie){var se=this,V=m.a.Clone(function(){return new be(ie,se.getScene())},this);return V.name=ie,V.id=ie,V},be.prototype.serialize=function(){return m.a.Serialize(this)},be.Parse=function(ie,se,V){return m.a.Parse(function(){return new be(ie.name,se)},ie,se,V)},Object.defineProperty(be,"DiffuseTextureEnabled",{get:function(){return C.a.DiffuseTextureEnabled},set:function(ie){C.a.DiffuseTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"DetailTextureEnabled",{get:function(){return C.a.DetailTextureEnabled},set:function(ie){C.a.DetailTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"AmbientTextureEnabled",{get:function(){return C.a.AmbientTextureEnabled},set:function(ie){C.a.AmbientTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"OpacityTextureEnabled",{get:function(){return C.a.OpacityTextureEnabled},set:function(ie){C.a.OpacityTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"ReflectionTextureEnabled",{get:function(){return C.a.ReflectionTextureEnabled},set:function(ie){C.a.ReflectionTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"EmissiveTextureEnabled",{get:function(){return C.a.EmissiveTextureEnabled},set:function(ie){C.a.EmissiveTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"SpecularTextureEnabled",{get:function(){return C.a.SpecularTextureEnabled},set:function(ie){C.a.SpecularTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"BumpTextureEnabled",{get:function(){return C.a.BumpTextureEnabled},set:function(ie){C.a.BumpTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"LightmapTextureEnabled",{get:function(){return C.a.LightmapTextureEnabled},set:function(ie){C.a.LightmapTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"RefractionTextureEnabled",{get:function(){return C.a.RefractionTextureEnabled},set:function(ie){C.a.RefractionTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"ColorGradingTextureEnabled",{get:function(){return C.a.ColorGradingTextureEnabled},set:function(ie){C.a.ColorGradingTextureEnabled=ie},enumerable:!1,configurable:!0}),Object.defineProperty(be,"FresnelEnabled",{get:function(){return C.a.FresnelEnabled},set:function(ie){C.a.FresnelEnabled=ie},enumerable:!1,configurable:!0}),Object(T.c)([Object(m.m)("diffuseTexture")],be.prototype,"_diffuseTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],be.prototype,"diffuseTexture",void 0),Object(T.c)([Object(m.m)("ambientTexture")],be.prototype,"_ambientTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"ambientTexture",void 0),Object(T.c)([Object(m.m)("opacityTexture")],be.prototype,"_opacityTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],be.prototype,"opacityTexture",void 0),Object(T.c)([Object(m.m)("reflectionTexture")],be.prototype,"_reflectionTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"reflectionTexture",void 0),Object(T.c)([Object(m.m)("emissiveTexture")],be.prototype,"_emissiveTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"emissiveTexture",void 0),Object(T.c)([Object(m.m)("specularTexture")],be.prototype,"_specularTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"specularTexture",void 0),Object(T.c)([Object(m.m)("bumpTexture")],be.prototype,"_bumpTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"bumpTexture",void 0),Object(T.c)([Object(m.m)("lightmapTexture")],be.prototype,"_lightmapTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"lightmapTexture",void 0),Object(T.c)([Object(m.m)("refractionTexture")],be.prototype,"_refractionTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"refractionTexture",void 0),Object(T.c)([Object(m.e)("ambient")],be.prototype,"ambientColor",void 0),Object(T.c)([Object(m.e)("diffuse")],be.prototype,"diffuseColor",void 0),Object(T.c)([Object(m.e)("specular")],be.prototype,"specularColor",void 0),Object(T.c)([Object(m.e)("emissive")],be.prototype,"emissiveColor",void 0),Object(T.c)([Object(m.c)()],be.prototype,"specularPower",void 0),Object(T.c)([Object(m.c)("useAlphaFromDiffuseTexture")],be.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],be.prototype,"useAlphaFromDiffuseTexture",void 0),Object(T.c)([Object(m.c)("useEmissiveAsIllumination")],be.prototype,"_useEmissiveAsIllumination",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useEmissiveAsIllumination",void 0),Object(T.c)([Object(m.c)("linkEmissiveWithDiffuse")],be.prototype,"_linkEmissiveWithDiffuse",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"linkEmissiveWithDiffuse",void 0),Object(T.c)([Object(m.c)("useSpecularOverAlpha")],be.prototype,"_useSpecularOverAlpha",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useSpecularOverAlpha",void 0),Object(T.c)([Object(m.c)("useReflectionOverAlpha")],be.prototype,"_useReflectionOverAlpha",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useReflectionOverAlpha",void 0),Object(T.c)([Object(m.c)("disableLighting")],be.prototype,"_disableLighting",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],be.prototype,"disableLighting",void 0),Object(T.c)([Object(m.c)("useObjectSpaceNormalMap")],be.prototype,"_useObjectSpaceNormalMap",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useObjectSpaceNormalMap",void 0),Object(T.c)([Object(m.c)("useParallax")],be.prototype,"_useParallax",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useParallax",void 0),Object(T.c)([Object(m.c)("useParallaxOcclusion")],be.prototype,"_useParallaxOcclusion",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useParallaxOcclusion",void 0),Object(T.c)([Object(m.c)()],be.prototype,"parallaxScaleBias",void 0),Object(T.c)([Object(m.c)("roughness")],be.prototype,"_roughness",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"roughness",void 0),Object(T.c)([Object(m.c)()],be.prototype,"indexOfRefraction",void 0),Object(T.c)([Object(m.c)()],be.prototype,"invertRefractionY",void 0),Object(T.c)([Object(m.c)()],be.prototype,"alphaCutOff",void 0),Object(T.c)([Object(m.c)("useLightmapAsShadowmap")],be.prototype,"_useLightmapAsShadowmap",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useLightmapAsShadowmap",void 0),Object(T.c)([Object(m.h)("diffuseFresnelParameters")],be.prototype,"_diffuseFresnelParameters",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],be.prototype,"diffuseFresnelParameters",void 0),Object(T.c)([Object(m.h)("opacityFresnelParameters")],be.prototype,"_opacityFresnelParameters",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],be.prototype,"opacityFresnelParameters",void 0),Object(T.c)([Object(m.h)("reflectionFresnelParameters")],be.prototype,"_reflectionFresnelParameters",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],be.prototype,"reflectionFresnelParameters",void 0),Object(T.c)([Object(m.h)("refractionFresnelParameters")],be.prototype,"_refractionFresnelParameters",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],be.prototype,"refractionFresnelParameters",void 0),Object(T.c)([Object(m.h)("emissiveFresnelParameters")],be.prototype,"_emissiveFresnelParameters",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],be.prototype,"emissiveFresnelParameters",void 0),Object(T.c)([Object(m.c)("useReflectionFresnelFromSpecular")],be.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsFresnelDirty")],be.prototype,"useReflectionFresnelFromSpecular",void 0),Object(T.c)([Object(m.c)("useGlossinessFromSpecularMapAlpha")],be.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(T.c)([Object(m.c)("maxSimultaneousLights")],be.prototype,"_maxSimultaneousLights",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsLightsDirty")],be.prototype,"maxSimultaneousLights",void 0),Object(T.c)([Object(m.c)("invertNormalMapX")],be.prototype,"_invertNormalMapX",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"invertNormalMapX",void 0),Object(T.c)([Object(m.c)("invertNormalMapY")],be.prototype,"_invertNormalMapY",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"invertNormalMapY",void 0),Object(T.c)([Object(m.c)("twoSidedLighting")],be.prototype,"_twoSidedLighting",void 0),Object(T.c)([Object(m.b)("_markAllSubMeshesAsTexturesDirty")],be.prototype,"twoSidedLighting",void 0),Object(T.c)([Object(m.c)()],be.prototype,"useLogarithmicDepth",null),be}(I.a);g.a.RegisteredTypes["BABYLON.StandardMaterial"]=me,d.a.DefaultMaterialFactory=function(ve){return new me("default material",ve)}},function(f,s,c){c.d(s,"a",function(){return L});var T=c(1),m=c(12),E=c(6),d=c(0),x=c(13),M=c(4),w=c(16),S=c(46),_=c(54),O=c(43),R=c(2),I=c(147),y=c(21),p=c(101),g=c(9),C=c(28),P=c(23),F=c(11),U=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=d.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},B=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new U,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1},L=function(z){function X(G,ee){ee===void 0&&(ee=null);var $=z.call(this,G,ee,!1)||this;return $._internalAbstractMeshDataInfo=new B,$.cullingStrategy=X.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,$.onCollideObservable=new E.c,$.onCollisionPositionChangeObservable=new E.c,$.onMaterialChangedObservable=new E.c,$.definedFacingForward=!0,$._occlusionQuery=null,$._renderingGroup=null,$.alphaIndex=Number.MAX_VALUE,$.isVisible=!0,$.isPickable=!0,$.showSubMeshesBoundingBox=!1,$.isBlocker=!1,$.enablePointerMoveEvents=!1,$._renderingGroupId=0,$._material=null,$.outlineColor=g.a.Red(),$.outlineWidth=.02,$.overlayColor=g.a.Red(),$.overlayAlpha=.5,$.useOctreeForRenderingSelection=!0,$.useOctreeForPicking=!0,$.useOctreeForCollisions=!0,$.alwaysSelectAsActiveMesh=!1,$.doNotSyncBoundingInfo=!1,$.actionManager=null,$._meshCollisionData=new I.a,$.ellipsoid=new d.e(.5,1,.5),$.ellipsoidOffset=new d.e(0,0,0),$.edgesWidth=1,$.edgesColor=new g.b(1,0,0,1),$._edgesRenderer=null,$._masterMesh=null,$._boundingInfo=null,$._renderId=0,$._intersectionsInProgress=new Array,$._unIndexed=!1,$._lightSources=new Array,$._waitingData={lods:null,actions:null,freezeWorldMatrix:null},$._bonesTransformMatrices=null,$._transformMatrixTexture=null,$.onRebuildObservable=new E.c,$._onCollisionPositionChange=function(fe,me,ve){ve===void 0&&(ve=null),me.subtractToRef($._meshCollisionData._oldPositionForCollisions,$._meshCollisionData._diffPositionForCollisions),$._meshCollisionData._diffPositionForCollisions.length()>x.a.CollisionsEpsilon&&$.position.addInPlace($._meshCollisionData._diffPositionForCollisions),ve&&$.onCollideObservable.notifyObservers(ve),$.onCollisionPositionChangeObservable.notifyObservers($.position)},$.getScene().addMesh($),$._resyncLightSources(),$}return Object(T.d)(X,z),Object.defineProperty(X,"BILLBOARDMODE_NONE",{get:function(){return S.a.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(X,"BILLBOARDMODE_X",{get:function(){return S.a.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(X,"BILLBOARDMODE_Y",{get:function(){return S.a.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(X,"BILLBOARDMODE_Z",{get:function(){return S.a.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(X,"BILLBOARDMODE_ALL",{get:function(){return S.a.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(X,"BILLBOARDMODE_USE_POSITION",{get:function(){return S.a.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(G){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(G){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),X.prototype._updateNonUniformScalingState=function(G){return!!z.prototype._updateNonUniformScalingState.call(this,G)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(X.prototype,"onCollide",{set:function(G){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(G)},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"onCollisionPositionChange",{set:function(G){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(G)},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(G){this._internalAbstractMeshDataInfo._visibility!==G&&(this._internalAbstractMeshDataInfo._visibility=G,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(G){this._renderingGroupId=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"material",{get:function(){return this._material},set:function(G){this._material!==G&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=G,G&&G.meshMap&&(G.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(G){this._internalAbstractMeshDataInfo._receiveShadows!==G&&(this._internalAbstractMeshDataInfo._receiveShadows=G,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(G){this._internalAbstractMeshDataInfo._hasVertexAlpha!==G&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=G,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(G){this._internalAbstractMeshDataInfo._useVertexColors!==G&&(this._internalAbstractMeshDataInfo._useVertexColors=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(G){this._internalAbstractMeshDataInfo._numBoneInfluencers!==G&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=G,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(G){this._internalAbstractMeshDataInfo._applyFog!==G&&(this._internalAbstractMeshDataInfo._applyFog=G,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(G){G!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=G,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(G){this._meshCollisionData._collisionMask=isNaN(G)?-1:G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(G){this._meshCollisionData._collisionResponse=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(G){this._meshCollisionData._collisionGroup=isNaN(G)?-1:G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(G){this._meshCollisionData._surroundingMeshes=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(G){var ee=this._internalAbstractMeshDataInfo._skeleton;ee&&ee.needInitialSkinMatrix&&ee._unregisterMeshWithPoseMatrix(this),G&&G.needInitialSkinMatrix&&G._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=G,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),X.prototype.getClassName=function(){return"AbstractMesh"},X.prototype.toString=function(G){var ee="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");ee+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var $=this._internalAbstractMeshDataInfo._skeleton;return $&&(ee+=", skeleton: "+$.name),G&&(ee+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],ee+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),ee},X.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==S.a.BILLBOARDMODE_NONE?this._masterMesh:z.prototype._getEffectiveParent.call(this)},X.prototype._getActionManagerForTrigger=function(G,ee){if(ee===void 0&&(ee=!0),this.actionManager&&(ee||this.actionManager.isRecursive)){if(!G)return this.actionManager;if(this.actionManager.hasSpecificTrigger(G))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(G,!1):null},X.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var G=0,ee=this.subMeshes;G<ee.length;G++)ee[G]._rebuild()},X.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var G=0,ee=this.getScene().lights;G<ee.length;G++){var $=ee[G];$.isEnabled()&&$.canAffectMesh(this)&&this._lightSources.push($)}this._markSubMeshesAsLightDirty()},X.prototype._resyncLightSource=function(G){var ee=G.isEnabled()&&G.canAffectMesh(this),$=this._lightSources.indexOf(G),fe=!1;if($===-1){if(!ee)return;this._lightSources.push(G)}else{if(ee)return;fe=!0,this._lightSources.splice($,1)}this._markSubMeshesAsLightDirty(fe)},X.prototype._unBindEffect=function(){for(var G=0,ee=this.subMeshes;G<ee.length;G++)ee[G].setEffect(null)},X.prototype._removeLightSource=function(G,ee){var $=this._lightSources.indexOf(G);$!==-1&&(this._lightSources.splice($,1),this._markSubMeshesAsLightDirty(ee))},X.prototype._markSubMeshesAsDirty=function(G){if(this.subMeshes)for(var ee=0,$=this.subMeshes;ee<$.length;ee++){var fe=$[ee];fe._materialDefines&&G(fe._materialDefines)}},X.prototype._markSubMeshesAsLightDirty=function(G){G===void 0&&(G=!1),this._markSubMeshesAsDirty(function(ee){return ee.markAsLightDirty(G)})},X.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(G){return G.markAsAttributesDirty()})},X.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(G){return G.markAsMiscDirty()})},Object.defineProperty(X.prototype,"scaling",{get:function(){return this._scaling},set:function(G){this._scaling=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),X.prototype.getLOD=function(G){return this},X.prototype.getTotalVertices=function(){return 0},X.prototype.getTotalIndices=function(){return 0},X.prototype.getIndices=function(){return null},X.prototype.getVerticesData=function(G){return null},X.prototype.setVerticesData=function(G,ee,$,fe){return this},X.prototype.updateVerticesData=function(G,ee,$,fe){return this},X.prototype.setIndices=function(G,ee){return this},X.prototype.isVerticesDataPresent=function(G){return!1},X.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},X.prototype.normalizeToUnitCube=function(G,ee,$){return G===void 0&&(G=!0),ee===void 0&&(ee=!1),z.prototype.normalizeToUnitCube.call(this,G,ee,$)},X.prototype.setBoundingInfo=function(G){return this._boundingInfo=G,this},Object.defineProperty(X.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(M.b.MatricesIndicesKind)&&this.isVerticesDataPresent(M.b.MatricesWeightsKind)},enumerable:!1,configurable:!0}),X.prototype._preActivate=function(){},X.prototype._preActivateForIntermediateRendering=function(G){},X.prototype._activate=function(G,ee){return this._renderId=G,!0},X.prototype._postActivate=function(){},X.prototype._freeze=function(){},X.prototype._unFreeze=function(){},X.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===S.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():z.prototype.getWorldMatrix.call(this)},X.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():z.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(X.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),X.prototype.movePOV=function(G,ee,$){return this.position.addInPlace(this.calcMovePOV(G,ee,$)),this},X.prototype.calcMovePOV=function(G,ee,$){var fe=new d.a;(this.rotationQuaternion?this.rotationQuaternion:d.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(fe);var me=d.e.Zero(),ve=this.definedFacingForward?-1:1;return d.e.TransformCoordinatesFromFloatsToRef(G*ve,ee,$*ve,fe,me),me},X.prototype.rotatePOV=function(G,ee,$){return this.rotation.addInPlace(this.calcRotatePOV(G,ee,$)),this},X.prototype.calcRotatePOV=function(G,ee,$){var fe=this.definedFacingForward?1:-1;return new d.e(G*fe,ee,$*fe)},X.prototype.refreshBoundingInfo=function(G){return G===void 0&&(G=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(G),null),this},X.prototype._refreshBoundingInfo=function(G,ee){if(G){var $=Object(p.a)(G,0,this.getTotalVertices(),ee);this._boundingInfo?this._boundingInfo.reConstruct($.minimum,$.maximum):this._boundingInfo=new O.a($.minimum,$.maximum)}if(this.subMeshes)for(var fe=0;fe<this.subMeshes.length;fe++)this.subMeshes[fe].refreshBoundingInfo(G);this._updateBoundingInfo()},X.prototype._getPositionData=function(G){var ee=this.getVerticesData(M.b.PositionKind);if(ee&&G&&this.skeleton){ee=m.b.Slice(ee),this._generatePointsArray();var $=this.getVerticesData(M.b.MatricesIndicesKind),fe=this.getVerticesData(M.b.MatricesWeightsKind);if(fe&&$){var me=this.numBoneInfluencers>4,ve=me?this.getVerticesData(M.b.MatricesIndicesExtraKind):null,be=me?this.getVerticesData(M.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var ie=this.skeleton.getTransformMatrices(this),se=d.c.Vector3[0],V=d.c.Matrix[0],K=d.c.Matrix[1],Z=0,le=0;le<ee.length;le+=3,Z+=4){var re,Q;for(V.reset(),re=0;re<4;re++)(Q=fe[Z+re])>0&&(d.a.FromFloat32ArrayToRefScaled(ie,Math.floor(16*$[Z+re]),Q,K),V.addToSelf(K));if(me)for(re=0;re<4;re++)(Q=be[Z+re])>0&&(d.a.FromFloat32ArrayToRefScaled(ie,Math.floor(16*ve[Z+re]),Q,K),V.addToSelf(K));d.e.TransformCoordinatesFromFloatsToRef(ee[le],ee[le+1],ee[le+2],V,se),se.toArray(ee,le),this._positions&&this._positions[le/3].copyFrom(se)}}}return ee},X.prototype._updateBoundingInfo=function(){var G=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(G.worldMatrixFromCache):this._boundingInfo=new O.a(this.absolutePosition,this.absolutePosition,G.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(G.worldMatrixFromCache),this},X.prototype._updateSubMeshesBoundingInfo=function(G){if(!this.subMeshes)return this;for(var ee=this.subMeshes.length,$=0;$<ee;$++){var fe=this.subMeshes[$];(ee>1||!fe.IsGlobal)&&fe.updateBoundingInfo(G)}return this},X.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(X.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),X.prototype.isInFrustum=function(G){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(G,this.cullingStrategy)},X.prototype.isCompletelyInFrustum=function(G){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(G)},X.prototype.intersectsMesh=function(G,ee,$){if(ee===void 0&&(ee=!1),!this._boundingInfo||!G._boundingInfo)return!1;if(this._boundingInfo.intersects(G._boundingInfo,ee))return!0;if($){for(var fe=0,me=this.getChildMeshes();fe<me.length;fe++)if(me[fe].intersectsMesh(G,ee,!0))return!0}return!1},X.prototype.intersectsPoint=function(G){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(G)},Object.defineProperty(X.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(G){this._meshCollisionData._checkCollisions=G},enumerable:!1,configurable:!0}),Object.defineProperty(X.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),X.prototype.moveWithCollisions=function(G){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var ee=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=ee.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,ee.getNewPosition(this._meshCollisionData._oldPositionForCollisions,G,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},X.prototype._collideForSubMesh=function(G,ee,$){if(this._generatePointsArray(),!this._positions)return this;if(!G._lastColliderWorldVertices||!G._lastColliderTransformMatrix.equals(ee)){G._lastColliderTransformMatrix=ee.clone(),G._lastColliderWorldVertices=[],G._trianglePlanes=[];for(var fe=G.verticesStart,me=G.verticesStart+G.verticesCount,ve=fe;ve<me;ve++)G._lastColliderWorldVertices.push(d.e.TransformCoordinates(this._positions[ve],ee))}return $._collide(G._trianglePlanes,G._lastColliderWorldVertices,this.getIndices(),G.indexStart,G.indexStart+G.indexCount,G.verticesStart,!!G.getMaterial(),this),this},X.prototype._processCollisionsForSubMeshes=function(G,ee){for(var $=this._scene.getCollidingSubMeshCandidates(this,G),fe=$.length,me=0;me<fe;me++){var ve=$.data[me];fe>1&&!ve._checkCollision(G)||this._collideForSubMesh(ve,ee,G)}return this},X.prototype._checkCollision=function(G){if(!this._boundingInfo||!this._boundingInfo._checkCollision(G))return this;var ee=d.c.Matrix[0],$=d.c.Matrix[1];return d.a.ScalingToRef(1/G._radius.x,1/G._radius.y,1/G._radius.z,ee),this.worldMatrixFromCache.multiplyToRef(ee,$),this._processCollisionsForSubMeshes(G,$),this},X.prototype._generatePointsArray=function(){return!1},X.prototype.intersects=function(G,ee,$,fe,me,ve){var be;fe===void 0&&(fe=!1),ve===void 0&&(ve=!1);var ie=new _.a,se=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,V=this._boundingInfo;if(!this.subMeshes||!V||!(ve||G.intersectsSphere(V.boundingSphere,se)&&G.intersectsBox(V.boundingBox,se)))return ie;if(fe)return ie.hit=!ve,ie.pickedMesh=ve?null:this,ie.distance=ve?0:d.e.Distance(G.origin,V.boundingSphere.center),ie.subMeshId=0,ie;if(!this._generatePointsArray())return ie;for(var K=null,Z=this._scene.getIntersectingSubMeshCandidates(this,G),le=Z.length,re=!1,Q=0;Q<le;Q++){var W=(Y=Z.data[Q]).getMaterial();if(W&&((be=this.getIndices())===null||be===void 0?void 0:be.length)&&(W.fillMode==R.a.MATERIAL_TriangleStripDrawMode||W.fillMode==R.a.MATERIAL_TriangleFillMode||W.fillMode==R.a.MATERIAL_WireFrameFillMode||W.fillMode==R.a.MATERIAL_PointFillMode)){re=!0;break}}if(!re)return ie.hit=!0,ie.pickedMesh=this,ie.distance=d.e.Distance(G.origin,V.boundingSphere.center),ie.subMeshId=-1,ie;for(Q=0;Q<le;Q++){var Y=Z.data[Q];if(!(le>1)||Y.canIntersects(G)){var q=Y.intersects(G,this._positions,this.getIndices(),ee,$);if(q&&(ee||!K||q.distance<K.distance)&&((K=q).subMeshId=Q,ee))break}}if(K){var ae=me??(this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix()),pe=d.c.Vector3[0],De=d.c.Vector3[1];d.e.TransformCoordinatesToRef(G.origin,ae,pe),G.direction.scaleToRef(K.distance,De);var de=d.e.TransformNormal(De,ae).addInPlace(pe);return ie.hit=!0,ie.distance=d.e.Distance(pe,de),ie.pickedPoint=de,ie.pickedMesh=this,ie.bu=K.bu||0,ie.bv=K.bv||0,ie.subMeshFaceId=K.faceId,ie.faceId=K.faceId+Z.data[K.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),ie.subMeshId=K.subMeshId,ie}return ie},X.prototype.clone=function(G,ee,$){return null},X.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},X.prototype.dispose=function(G,ee){var $,fe=this;for(ee===void 0&&(ee=!1),this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),$=0;$<this._intersectionsInProgress.length;$++){var me=this._intersectionsInProgress[$],ve=me._intersectionsInProgress.indexOf(this);me._intersectionsInProgress.splice(ve,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(ie){var se=ie.includedOnlyMeshes.indexOf(fe);se!==-1&&ie.includedOnlyMeshes.splice(se,1),(se=ie.excludedMeshes.indexOf(fe))!==-1&&ie.excludedMeshes.splice(se,1);var V=ie.getShadowGenerator();if(V){var K=V.getShadowMap();K&&K.renderList&&(se=K.renderList.indexOf(fe))!==-1&&K.renderList.splice(se,1)}}),this.getClassName()==="InstancedMesh"&&this.getClassName()==="InstancedLinesMesh"||this.releaseSubMeshes();var be=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,be.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),be.wipeCaches(),this.getScene().removeMesh(this),ee&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!G)for($=0;$<this.getScene().particleSystems.length;$++)this.getScene().particleSystems[$].emitter===this&&(this.getScene().particleSystems[$].dispose(),$--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),z.prototype.dispose.call(this,G,ee)},X.prototype.addChild=function(G){return G.setParent(this),this},X.prototype.removeChild=function(G){return G.setParent(null),this},X.prototype._initFacetData=function(){var G=this._internalAbstractMeshDataInfo._facetData;G.facetNormals||(G.facetNormals=new Array),G.facetPositions||(G.facetPositions=new Array),G.facetPartitioning||(G.facetPartitioning=new Array),G.facetNb=this.getIndices().length/3|0,G.partitioningSubdivisions=G.partitioningSubdivisions?G.partitioningSubdivisions:10,G.partitioningBBoxRatio=G.partitioningBBoxRatio?G.partitioningBBoxRatio:1.01;for(var ee=0;ee<G.facetNb;ee++)G.facetNormals[ee]=d.e.Zero(),G.facetPositions[ee]=d.e.Zero();return G.facetDataEnabled=!0,this},X.prototype.updateFacetData=function(){var G=this._internalAbstractMeshDataInfo._facetData;G.facetDataEnabled||this._initFacetData();var ee=this.getVerticesData(M.b.PositionKind),$=this.getIndices(),fe=this.getVerticesData(M.b.NormalKind),me=this.getBoundingInfo();if(G.facetDepthSort&&!G.facetDepthSortEnabled){if(G.facetDepthSortEnabled=!0,$ instanceof Uint16Array)G.depthSortedIndices=new Uint16Array($);else if($ instanceof Uint32Array)G.depthSortedIndices=new Uint32Array($);else{for(var ve=!1,be=0;be<$.length;be++)if($[be]>65535){ve=!0;break}G.depthSortedIndices=ve?new Uint32Array($):new Uint16Array($)}if(G.facetDepthSortFunction=function(re,Q){return Q.sqDistance-re.sqDistance},!G.facetDepthSortFrom){var ie=this.getScene().activeCamera;G.facetDepthSortFrom=ie?ie.position:d.e.Zero()}G.depthSortedFacets=[];for(var se=0;se<G.facetNb;se++){var V={ind:3*se,sqDistance:0};G.depthSortedFacets.push(V)}G.invertedMatrix=d.a.Identity(),G.facetDepthSortOrigin=d.e.Zero()}G.bbSize.x=me.maximum.x-me.minimum.x>C.a?me.maximum.x-me.minimum.x:C.a,G.bbSize.y=me.maximum.y-me.minimum.y>C.a?me.maximum.y-me.minimum.y:C.a,G.bbSize.z=me.maximum.z-me.minimum.z>C.a?me.maximum.z-me.minimum.z:C.a;var K=G.bbSize.x>G.bbSize.y?G.bbSize.x:G.bbSize.y;if(K=K>G.bbSize.z?K:G.bbSize.z,G.subDiv.max=G.partitioningSubdivisions,G.subDiv.X=Math.floor(G.subDiv.max*G.bbSize.x/K),G.subDiv.Y=Math.floor(G.subDiv.max*G.bbSize.y/K),G.subDiv.Z=Math.floor(G.subDiv.max*G.bbSize.z/K),G.subDiv.X=G.subDiv.X<1?1:G.subDiv.X,G.subDiv.Y=G.subDiv.Y<1?1:G.subDiv.Y,G.subDiv.Z=G.subDiv.Z<1?1:G.subDiv.Z,G.facetParameters.facetNormals=this.getFacetLocalNormals(),G.facetParameters.facetPositions=this.getFacetLocalPositions(),G.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),G.facetParameters.bInfo=me,G.facetParameters.bbSize=G.bbSize,G.facetParameters.subDiv=G.subDiv,G.facetParameters.ratio=this.partitioningBBoxRatio,G.facetParameters.depthSort=G.facetDepthSort,G.facetDepthSort&&G.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(G.invertedMatrix),d.e.TransformCoordinatesToRef(G.facetDepthSortFrom,G.invertedMatrix,G.facetDepthSortOrigin),G.facetParameters.distanceTo=G.facetDepthSortOrigin),G.facetParameters.depthSortedFacets=G.depthSortedFacets,w.a.ComputeNormals(ee,$,fe,G.facetParameters),G.facetDepthSort&&G.facetDepthSortEnabled){G.depthSortedFacets.sort(G.facetDepthSortFunction);var Z=G.depthSortedIndices.length/3|0;for(se=0;se<Z;se++){var le=G.depthSortedFacets[se].ind;G.depthSortedIndices[3*se]=$[le],G.depthSortedIndices[3*se+1]=$[le+1],G.depthSortedIndices[3*se+2]=$[le+2]}this.updateIndices(G.depthSortedIndices,void 0,!0)}return this},X.prototype.getFacetLocalNormals=function(){var G=this._internalAbstractMeshDataInfo._facetData;return G.facetNormals||this.updateFacetData(),G.facetNormals},X.prototype.getFacetLocalPositions=function(){var G=this._internalAbstractMeshDataInfo._facetData;return G.facetPositions||this.updateFacetData(),G.facetPositions},X.prototype.getFacetLocalPartitioning=function(){var G=this._internalAbstractMeshDataInfo._facetData;return G.facetPartitioning||this.updateFacetData(),G.facetPartitioning},X.prototype.getFacetPosition=function(G){var ee=d.e.Zero();return this.getFacetPositionToRef(G,ee),ee},X.prototype.getFacetPositionToRef=function(G,ee){var $=this.getFacetLocalPositions()[G],fe=this.getWorldMatrix();return d.e.TransformCoordinatesToRef($,fe,ee),this},X.prototype.getFacetNormal=function(G){var ee=d.e.Zero();return this.getFacetNormalToRef(G,ee),ee},X.prototype.getFacetNormalToRef=function(G,ee){var $=this.getFacetLocalNormals()[G];return d.e.TransformNormalToRef($,this.getWorldMatrix(),ee),this},X.prototype.getFacetsAtLocalCoordinates=function(G,ee,$){var fe=this.getBoundingInfo(),me=this._internalAbstractMeshDataInfo._facetData,ve=Math.floor((G-fe.minimum.x*me.partitioningBBoxRatio)*me.subDiv.X*me.partitioningBBoxRatio/me.bbSize.x),be=Math.floor((ee-fe.minimum.y*me.partitioningBBoxRatio)*me.subDiv.Y*me.partitioningBBoxRatio/me.bbSize.y),ie=Math.floor(($-fe.minimum.z*me.partitioningBBoxRatio)*me.subDiv.Z*me.partitioningBBoxRatio/me.bbSize.z);return ve<0||ve>me.subDiv.max||be<0||be>me.subDiv.max||ie<0||ie>me.subDiv.max?null:me.facetPartitioning[ve+me.subDiv.max*be+me.subDiv.max*me.subDiv.max*ie]},X.prototype.getClosestFacetAtCoordinates=function(G,ee,$,fe,me,ve){me===void 0&&(me=!1),ve===void 0&&(ve=!0);var be=this.getWorldMatrix(),ie=d.c.Matrix[5];be.invertToRef(ie);var se=d.c.Vector3[8];d.e.TransformCoordinatesFromFloatsToRef(G,ee,$,ie,se);var V=this.getClosestFacetAtLocalCoordinates(se.x,se.y,se.z,fe,me,ve);return fe&&d.e.TransformCoordinatesFromFloatsToRef(fe.x,fe.y,fe.z,be,fe),V},X.prototype.getClosestFacetAtLocalCoordinates=function(G,ee,$,fe,me,ve){me===void 0&&(me=!1),ve===void 0&&(ve=!0);var be=null,ie=0,se=0,V=0,K=0,Z=0,le=0,re=0,Q=0,W=this.getFacetLocalPositions(),Y=this.getFacetLocalNormals(),q=this.getFacetsAtLocalCoordinates(G,ee,$);if(!q)return null;for(var ae,pe,De,de=Number.MAX_VALUE,ge=de,ne=0;ne<q.length;ne++)pe=Y[ae=q[ne]],K=(G-(De=W[ae]).x)*pe.x+(ee-De.y)*pe.y+($-De.z)*pe.z,(!me||me&&ve&&K>=0||me&&!ve&&K<=0)&&(K=pe.x*De.x+pe.y*De.y+pe.z*De.z,Z=-(pe.x*G+pe.y*ee+pe.z*$-K)/(pe.x*pe.x+pe.y*pe.y+pe.z*pe.z),(ge=(ie=(le=G+pe.x*Z)-G)*ie+(se=(re=ee+pe.y*Z)-ee)*se+(V=(Q=$+pe.z*Z)-$)*V)<de&&(de=ge,be=ae,fe&&(fe.x=le,fe.y=re,fe.z=Q)));return be},X.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},X.prototype.disableFacetData=function(){var G=this._internalAbstractMeshDataInfo._facetData;return G.facetDataEnabled&&(G.facetDataEnabled=!1,G.facetPositions=new Array,G.facetNormals=new Array,G.facetPartitioning=new Array,G.facetParameters=null,G.depthSortedIndices=new Uint32Array(0)),this},X.prototype.updateIndices=function(G,ee,$){return this},X.prototype.createNormals=function(G){var ee,$=this.getVerticesData(M.b.PositionKind),fe=this.getIndices();return ee=this.isVerticesDataPresent(M.b.NormalKind)?this.getVerticesData(M.b.NormalKind):[],w.a.ComputeNormals($,fe,ee,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(M.b.NormalKind,ee,G),this},X.prototype.alignWithNormal=function(G,ee){ee||(ee=P.a.Y);var $=d.c.Vector3[0],fe=d.c.Vector3[1];return d.e.CrossToRef(ee,G,fe),d.e.CrossToRef(G,fe,$),this.rotationQuaternion?d.b.RotationQuaternionFromAxisToRef($,G,fe,this.rotationQuaternion):d.e.RotationFromAxisToRef($,G,fe,this.rotation),this},X.prototype._checkOcclusionQuery=function(){return!1},X.prototype.disableEdgesRendering=function(){throw y.a.WarnImport("EdgesRenderer")},X.prototype.enableEdgesRendering=function(G,ee,$){throw y.a.WarnImport("EdgesRenderer")},X.prototype.getConnectedParticleSystems=function(){var G=this;return this._scene.particleSystems.filter(function(ee){return ee.emitter===G})},X.OCCLUSION_TYPE_NONE=0,X.OCCLUSION_TYPE_OPTIMISTIC=1,X.OCCLUSION_TYPE_STRICT=2,X.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,X.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,X.CULLINGSTRATEGY_STANDARD=R.a.MESHES_CULLINGSTRATEGY_STANDARD,X.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=R.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=R.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,X.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=R.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,X}(S.a);F.a.RegisteredTypes["BABYLON.AbstractMesh"]=L},function(f,s,c){c.d(s,"a",function(){return S});var T=c(8),m=c(44),E=c(0),d=c(31),x=c(7),M=c(50),w=c(23);x.a._PhysicsImpostorParser=function(_,O,R){return new S(O,R.physicsImpostor,{mass:R.physicsMass,friction:R.physicsFriction,restitution:R.physicsRestitution},_)};var S=function(){function _(O,R,I,y){var p=this;I===void 0&&(I={mass:0}),this.object=O,this.type=R,this._options=I,this._scene=y,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=E.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new E.b,this._tmpQuat2=new E.b,this.beforeStep=function(){p._physicsEngine&&(p.object.translate(p._deltaPosition,-1),p._deltaRotationConjugated&&p.object.rotationQuaternion&&p.object.rotationQuaternion.multiplyToRef(p._deltaRotationConjugated,p.object.rotationQuaternion),p.object.computeWorldMatrix(!1),p.object.parent&&p.object.rotationQuaternion?(p.getParentsRotation(),p._tmpQuat.multiplyToRef(p.object.rotationQuaternion,p._tmpQuat)):p._tmpQuat.copyFrom(p.object.rotationQuaternion||new E.b),p._options.disableBidirectionalTransformation||p.object.rotationQuaternion&&p._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(p,p.object.getAbsolutePosition(),p._tmpQuat),p._onBeforePhysicsStepCallbacks.forEach(function(g){g(p)}))},this.afterStep=function(){p._physicsEngine&&(p._onAfterPhysicsStepCallbacks.forEach(function(g){g(p)}),p._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(p),p.object.parent&&p.object.rotationQuaternion&&(p.getParentsRotation(),p._tmpQuat.conjugateInPlace(),p._tmpQuat.multiplyToRef(p.object.rotationQuaternion,p.object.rotationQuaternion)),p.object.setAbsolutePosition(p.object.position),p._deltaRotation&&p.object.rotationQuaternion&&p.object.rotationQuaternion.multiplyToRef(p._deltaRotation,p.object.rotationQuaternion),p.object.translate(p._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(g){if((p._onPhysicsCollideCallbacks.length||p.onCollideEvent)&&p._physicsEngine){var C=p._physicsEngine.getImpostorWithPhysicsBody(g.body);C&&(p.onCollideEvent&&p.onCollideEvent(p,C),p._onPhysicsCollideCallbacks.filter(function(P){return P.otherImpostors.indexOf(C)!==-1}).forEach(function(P){P.callback(p,C,g.point)}))}},this.object?(this.object.parent&&I.mass!==0&&T.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&O.getScene&&(this._scene=O.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=E.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new E.b),this._options.mass=I.mass===void 0?0:I.mass,this._options.friction=I.friction===void 0?.2:I.friction,this._options.restitution=I.restitution===void 0?.2:I.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=I.pressure===void 0?200:I.pressure,this._options.stiffness=I.stiffness===void 0?1:I.stiffness,this._options.velocityIterations=I.velocityIterations===void 0?20:I.velocityIterations,this._options.positionIterations=I.positionIterations===void 0?20:I.positionIterations,this._options.fixedPoints=I.fixedPoints===void 0?0:I.fixedPoints,this._options.margin=I.margin===void 0?0:I.margin,this._options.damping=I.damping===void 0?0:I.damping,this._options.path=I.path===void 0?null:I.path,this._options.shape=I.shape===void 0?null:I.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&T.a.Warn("You must affect impostors to children before affecting impostor to parent.")):T.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):T.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(_.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(O){this.setMass(O)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(O){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,O)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(O){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,O)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var O=this._physicsEngine.getPhysicsPlugin();return O.setBodyPressure?O.getBodyPressure(this):0},set:function(O){if(this._physicsEngine){var R=this._physicsEngine.getPhysicsPlugin();R.setBodyPressure&&R.setBodyPressure(this,O)}},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var O=this._physicsEngine.getPhysicsPlugin();return O.getBodyStiffness?O.getBodyStiffness(this):0},set:function(O){if(this._physicsEngine){var R=this._physicsEngine.getPhysicsPlugin();R.setBodyStiffness&&R.setBodyStiffness(this,O)}},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var O=this._physicsEngine.getPhysicsPlugin();return O.getBodyVelocityIterations?O.getBodyVelocityIterations(this):0},set:function(O){if(this._physicsEngine){var R=this._physicsEngine.getPhysicsPlugin();R.setBodyVelocityIterations&&R.setBodyVelocityIterations(this,O)}},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var O=this._physicsEngine.getPhysicsPlugin();return O.getBodyPositionIterations?O.getBodyPositionIterations(this):0},set:function(O){if(this._physicsEngine){var R=this._physicsEngine.getPhysicsPlugin();R.setBodyPositionIterations&&R.setBodyPositionIterations(this,O)}},enumerable:!1,configurable:!0}),_.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},_.prototype._getPhysicsParent=function(){return this.object.parent instanceof d.a?this.object.parent.physicsImpostor:null},_.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},_.prototype.setScalingUpdated=function(){this.forceUpdate()},_.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(_.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(O){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=O,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(O){this._parent=O},enumerable:!1,configurable:!0}),_.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},_.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var O=this.object.rotationQuaternion,R=this.object.scaling.clone();this.object.rotationQuaternion=_.IDENTITY_QUATERNION;var I=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);I&&I.decompose(R,void 0,void 0);var y=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(R);return this.object.rotationQuaternion=O,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),y}return _.DEFAULT_OBJECT_SIZE},_.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},_.prototype.getParam=function(O){return this._options[O]},_.prototype.setParam=function(O,R){this._options[O]=R,this._bodyUpdateRequired=!0},_.prototype.setMass=function(O){this.getParam("mass")!==O&&this.setParam("mass",O),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,O)},_.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):E.e.Zero()},_.prototype.setLinearVelocity=function(O){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,O)},_.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):E.e.Zero()},_.prototype.setAngularVelocity=function(O){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,O)},_.prototype.executeNativeFunction=function(O){this._physicsEngine&&O(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},_.prototype.registerBeforePhysicsStep=function(O){this._onBeforePhysicsStepCallbacks.push(O)},_.prototype.unregisterBeforePhysicsStep=function(O){var R=this._onBeforePhysicsStepCallbacks.indexOf(O);R>-1?this._onBeforePhysicsStepCallbacks.splice(R,1):T.a.Warn("Function to remove was not found")},_.prototype.registerAfterPhysicsStep=function(O){this._onAfterPhysicsStepCallbacks.push(O)},_.prototype.unregisterAfterPhysicsStep=function(O){var R=this._onAfterPhysicsStepCallbacks.indexOf(O);R>-1?this._onAfterPhysicsStepCallbacks.splice(R,1):T.a.Warn("Function to remove was not found")},_.prototype.registerOnPhysicsCollide=function(O,R){var I=O instanceof Array?O:[O];this._onPhysicsCollideCallbacks.push({callback:R,otherImpostors:I})},_.prototype.unregisterOnPhysicsCollide=function(O,R){var I=O instanceof Array?O:[O],y=-1;this._onPhysicsCollideCallbacks.some(function(p,g){if(p.callback===R&&p.otherImpostors.length===I.length){var C=p.otherImpostors.every(function(P){return I.indexOf(P)>-1});return C&&(y=g),C}return!1})?this._onPhysicsCollideCallbacks.splice(y,1):T.a.Warn("Function to remove was not found")},_.prototype.getParentsRotation=function(){var O=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);O;)O.rotationQuaternion?this._tmpQuat2.copyFrom(O.rotationQuaternion):E.b.RotationYawPitchRollToRef(O.rotation.y,O.rotation.x,O.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),O=O.parent;return this._tmpQuat},_.prototype.applyForce=function(O,R){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,O,R),this},_.prototype.applyImpulse=function(O,R){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,O,R),this},_.prototype.createJoint=function(O,R,I){var y=new M.e(R,I);return this.addJoint(O,y),this},_.prototype.addJoint=function(O,R){return this._joints.push({otherImpostor:O,joint:R}),this._physicsEngine&&this._physicsEngine.addJoint(this,O,R),this},_.prototype.addAnchor=function(O,R,I,y,p){if(!this._physicsEngine)return this;var g=this._physicsEngine.getPhysicsPlugin();return g.appendAnchor?(this._physicsEngine&&g.appendAnchor(this,O,R,I,y,p),this):this},_.prototype.addHook=function(O,R,I,y){if(!this._physicsEngine)return this;var p=this._physicsEngine.getPhysicsPlugin();return p.appendAnchor?(this._physicsEngine&&p.appendHook(this,O,R,I,y),this):this},_.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},_.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},_.prototype.clone=function(O){return O?new _(O,this.type,this._options,this._scene):null},_.prototype.dispose=function(){var O=this;this._physicsEngine&&(this._joints.forEach(function(R){O._physicsEngine&&O._physicsEngine.removeJoint(O,R.otherImpostor,R.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},_.prototype.setDeltaPosition=function(O){this._deltaPosition.copyFrom(O)},_.prototype.setDeltaRotation=function(O){this._deltaRotation||(this._deltaRotation=new E.b),this._deltaRotation.copyFrom(O),this._deltaRotationConjugated=this._deltaRotation.conjugate()},_.prototype.getBoxSizeToRef=function(O){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,O),this},_.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},_.prototype.syncBoneWithImpostor=function(O,R,I,y,p){var g=_._tmpVecs[0],C=this.object;if(C.rotationQuaternion)if(p){var P=_._tmpQuat;C.rotationQuaternion.multiplyToRef(p,P),O.setRotationQuaternion(P,w.c.WORLD,R)}else O.setRotationQuaternion(C.rotationQuaternion,w.c.WORLD,R);g.x=0,g.y=0,g.z=0,I&&(g.x=I.x,g.y=I.y,g.z=I.z,O.getDirectionToRef(g,R,g),y==null&&(y=I.length()),g.x*=y,g.y*=y,g.z*=y),O.getParent()?(g.addInPlace(C.getAbsolutePosition()),O.setAbsolutePosition(g,R)):(R.setAbsolutePosition(C.getAbsolutePosition()),R.position.x-=g.x,R.position.y-=g.y,R.position.z-=g.z)},_.prototype.syncImpostorWithBone=function(O,R,I,y,p,g){var C=this.object;if(C.rotationQuaternion)if(p){var P=_._tmpQuat;O.getRotationQuaternionToRef(w.c.WORLD,R,P),P.multiplyToRef(p,C.rotationQuaternion)}else O.getRotationQuaternionToRef(w.c.WORLD,R,C.rotationQuaternion);var F=_._tmpVecs[0],U=_._tmpVecs[1];g||((g=_._tmpVecs[2]).x=0,g.y=1,g.z=0),O.getDirectionToRef(g,R,U),O.getAbsolutePositionToRef(R,F),y==null&&I&&(y=I.length()),y!=null&&(F.x+=U.x*y,F.y+=U.y*y,F.z+=U.z*y),C.setAbsolutePosition(F)},_.DEFAULT_OBJECT_SIZE=new E.e(1,1,1),_.IDENTITY_QUATERNION=E.b.Identity(),_._tmpVecs=m.a.BuildArray(3,E.e.Zero),_._tmpQuat=E.b.Identity(),_.NoImpostor=0,_.SphereImpostor=1,_.BoxImpostor=2,_.PlaneImpostor=3,_.MeshImpostor=4,_.CapsuleImpostor=6,_.CylinderImpostor=7,_.ParticleImpostor=8,_.HeightmapImpostor=9,_.ConvexHullImpostor=10,_.CustomImpostor=100,_.RopeImpostor=101,_.ClothImpostor=102,_.SoftbodyImpostor=103,_}()},function(f,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return E});var T=c(1),m=function(){function d(x){this.length=0,this.data=new Array(x),this._id=d._GlobalId++}return d.prototype.push=function(x){this.data[this.length++]=x,this.length>this.data.length&&(this.data.length*=2)},d.prototype.forEach=function(x){for(var M=0;M<this.length;M++)x(this.data[M])},d.prototype.sort=function(x){this.data.sort(x)},d.prototype.reset=function(){this.length=0},d.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},d.prototype.concat=function(x){if(x.length!==0){this.length+x.length>this.data.length&&(this.data.length=2*(this.length+x.length));for(var M=0;M<x.length;M++)this.data[this.length++]=(x.data||x)[M]}},d.prototype.indexOf=function(x){var M=this.data.indexOf(x);return M>=this.length?-1:M},d.prototype.contains=function(x){return this.indexOf(x)!==-1},d._GlobalId=0,d}(),E=function(d){function x(){var M=d!==null&&d.apply(this,arguments)||this;return M._duplicateId=0,M}return Object(T.d)(x,d),x.prototype.push=function(M){d.prototype.push.call(this,M),M.__smartArrayFlags||(M.__smartArrayFlags={}),M.__smartArrayFlags[this._id]=this._duplicateId},x.prototype.pushNoDuplicate=function(M){return(!M.__smartArrayFlags||M.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(M),!0)},x.prototype.reset=function(){d.prototype.reset.call(this),this._duplicateId++},x.prototype.concatWithNoDuplicate=function(M){if(M.length!==0){this.length+M.length>this.data.length&&(this.data.length=2*(this.length+M.length));for(var w=0;w<M.length;w++){var S=(M.data||M)[w];this.pushNoDuplicate(S)}}},x}(m)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.EndsWith=function(E,d){return E.indexOf(d,E.length-d.length)!==-1},m.StartsWith=function(E,d){return!!E&&E.indexOf(d)===0},m.Decode=function(E){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(E);for(var d="",x=0;x<E.byteLength;x++)d+=String.fromCharCode(E[x]);return d},m.EncodeArrayBufferToBase64=function(E){for(var d,x,M,w,S,_,O,R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",I="",y=0,p=ArrayBuffer.isView(E)?new Uint8Array(E.buffer,E.byteOffset,E.byteLength):new Uint8Array(E);y<p.length;)w=(d=p[y++])>>2,S=(3&d)<<4|(x=y<p.length?p[y++]:Number.NaN)>>4,_=(15&x)<<2|(M=y<p.length?p[y++]:Number.NaN)>>6,O=63&M,isNaN(x)?_=O=64:isNaN(M)&&(O=64),I+=R.charAt(w)+R.charAt(S)+R.charAt(_)+R.charAt(O);return I},m.PadNumber=function(E,d){for(var x=String(E);x.length<d;)x="0"+x;return x},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return m.AddParser=function(E,d){this._BabylonFileParsers[E]=d},m.GetParser=function(E){return this._BabylonFileParsers[E]?this._BabylonFileParsers[E]:null},m.AddIndividualParser=function(E,d){this._IndividualBabylonFileParsers[E]=d},m.GetIndividualParser=function(E){return this._IndividualBabylonFileParsers[E]?this._IndividualBabylonFileParsers[E]:null},m.Parse=function(E,d,x,M){for(var w in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(w)&&this._BabylonFileParsers[w](E,d,x,M)},Object.defineProperty(m.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(E){this._environmentTexture=E},enumerable:!1,configurable:!0}),m.prototype.getNodes=function(){var E=new Array;return E=(E=(E=(E=E.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach(function(d){return E=E.concat(d.bones)}),E},m._BabylonFileParsers={},m._IndividualBabylonFileParsers={},m}()},function(f,s,c){c.d(s,"a",function(){return S});var T=c(20),m=c(6),E=c(18),d=c(22),x=c(86),M=c(0),w=c(9),S=function(){function _(O,R){var I=this;R===void 0&&(R=!0),this.originalScene=O,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new m.c,this.utilityLayerScene=new T.a(O.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=O.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),R&&(this._originalPointerObserver=O.onPrePointerObservable.add(function(y,p){if(I.utilityLayerScene.activeCamera&&(I.processAllEvents||y.type===E.a.POINTERMOVE||y.type===E.a.POINTERUP||y.type===E.a.POINTERDOWN||y.type===E.a.POINTERDOUBLETAP)){I.utilityLayerScene.pointerX=O.pointerX,I.utilityLayerScene.pointerY=O.pointerY;var g=y.event;if(O.isPointerCaptured(g.pointerId))I._pointerCaptures[g.pointerId]=!1;else{var C=y.ray?I.utilityLayerScene.pickWithRay(y.ray):I.utilityLayerScene.pick(O.pointerX,O.pointerY);if(!y.ray&&C&&(y.ray=C.ray),I.utilityLayerScene.onPrePointerObservable.notifyObservers(y),I.onlyCheckPointerDownEvents&&y.type!=E.a.POINTERDOWN)return y.skipOnPointerObservable||I.utilityLayerScene.onPointerObservable.notifyObservers(new E.b(y.type,y.event,C),y.type),void(y.type===E.a.POINTERUP&&I._pointerCaptures[g.pointerId]&&(I._pointerCaptures[g.pointerId]=!1));if(I.utilityLayerScene.autoClearDepthAndStencil||I.pickUtilitySceneFirst)C&&C.hit&&(y.skipOnPointerObservable||I.utilityLayerScene.onPointerObservable.notifyObservers(new E.b(y.type,y.event,C),y.type),y.skipOnPointerObservable=!0);else{var P=y.ray?O.pickWithRay(y.ray):O.pick(O.pointerX,O.pointerY),F=y.event;P&&C&&(C.distance===0&&P.pickedMesh?I.mainSceneTrackerPredicate&&I.mainSceneTrackerPredicate(P.pickedMesh)?(I._notifyObservers(y,P,F),y.skipOnPointerObservable=!0):y.type===E.a.POINTERDOWN?I._pointerCaptures[F.pointerId]=!0:I._lastPointerEvents[F.pointerId]&&(I.onPointerOutObservable.notifyObservers(F.pointerId),delete I._lastPointerEvents[F.pointerId]):!I._pointerCaptures[F.pointerId]&&(C.distance<P.distance||P.distance===0)?(I._notifyObservers(y,C,F),y.skipOnPointerObservable||(y.skipOnPointerObservable=C.distance>0)):!I._pointerCaptures[F.pointerId]&&C.distance>P.distance&&(I.mainSceneTrackerPredicate&&I.mainSceneTrackerPredicate(P.pickedMesh)?(I._notifyObservers(y,P,F),y.skipOnPointerObservable=!0):I._lastPointerEvents[F.pointerId]&&(I.onPointerOutObservable.notifyObservers(F.pointerId),delete I._lastPointerEvents[F.pointerId])),y.type===E.a.POINTERUP&&I._pointerCaptures[F.pointerId]&&(I._pointerCaptures[F.pointerId]=!1))}}}}),this._originalPointerObserver&&O.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(y){I.shouldRender&&y==I.getRenderCamera()&&I.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){I.dispose()}),this._updateCamera()}return _.prototype.getRenderCamera=function(O){if(this._renderCamera)return this._renderCamera;var R=void 0;return R=this.originalScene.activeCameras&&this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera,O&&R&&R.isRigCamera?R.rigParent:R},_.prototype.setRenderCamera=function(O){this._renderCamera=O},_.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new x.a("shared gizmo light",new M.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=w.a.Gray()),this._sharedGizmoLight},Object.defineProperty(_,"DefaultUtilityLayer",{get:function(){return _._DefaultUtilityLayer==null&&(_._DefaultUtilityLayer=new _(d.a.LastCreatedScene),_._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){_._DefaultUtilityLayer=null})),_._DefaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(_,"DefaultKeepDepthUtilityLayer",{get:function(){return _._DefaultKeepDepthUtilityLayer==null&&(_._DefaultKeepDepthUtilityLayer=new _(d.a.LastCreatedScene),_._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,_._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){_._DefaultKeepDepthUtilityLayer=null})),_._DefaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),_.prototype._notifyObservers=function(O,R,I){O.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new E.b(O.type,O.event,R),O.type),this._lastPointerEvents[I.pointerId]=!0)},_.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var O=this.utilityLayerScene.activeCamera.getScene(),R=this.utilityLayerScene.activeCamera;R._scene=this.utilityLayerScene,R.leftCamera&&(R.leftCamera._scene=this.utilityLayerScene),R.rightCamera&&(R.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),R._scene=O,R.leftCamera&&(R.leftCamera._scene=O),R.rightCamera&&(R.rightCamera._scene=O)}},_.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},_.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera(),this.utilityLayerScene.activeCamera=this.getRenderCamera()},_._DefaultUtilityLayer=null,_._DefaultKeepDepthUtilityLayer=null,_}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(139),m=function(){function E(){}return E.EnableFor=function(d){d._tags=d._tags||{},d.hasTags=function(){return E.HasTags(d)},d.addTags=function(x){return E.AddTagsTo(d,x)},d.removeTags=function(x){return E.RemoveTagsFrom(d,x)},d.matchesTagsQuery=function(x){return E.MatchesQuery(d,x)}},E.DisableFor=function(d){delete d._tags,delete d.hasTags,delete d.addTags,delete d.removeTags,delete d.matchesTagsQuery},E.HasTags=function(d){if(!d._tags)return!1;var x=d._tags;for(var M in x)if(x.hasOwnProperty(M))return!0;return!1},E.GetTags=function(d,x){if(x===void 0&&(x=!0),!d._tags)return null;if(x){var M=[];for(var w in d._tags)d._tags.hasOwnProperty(w)&&d._tags[w]===!0&&M.push(w);return M.join(" ")}return d._tags},E.AddTagsTo=function(d,x){x&&typeof x=="string"&&x.split(" ").forEach(function(M,w,S){E._AddTagTo(d,M)})},E._AddTagTo=function(d,x){(x=x.trim())!==""&&x!=="true"&&x!=="false"&&(x.match(/[\s]/)||x.match(/^([!]|([|]|[&]){2})/)||(E.EnableFor(d),d._tags[x]=!0))},E.RemoveTagsFrom=function(d,x){if(E.HasTags(d)){var M=x.split(" ");for(var w in M)E._RemoveTagFrom(d,M[w])}},E._RemoveTagFrom=function(d,x){delete d._tags[x]},E.MatchesQuery=function(d,x){return x===void 0||(x===""?E.HasTags(d):T.a.Eval(x,function(M){return E.HasTags(d)&&d._tags[M]}))},E}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.IsWindowObjectExist=function(){return typeof window!="undefined"},m.IsNavigatorAvailable=function(){return typeof navigator!="undefined"},m.IsDocumentAvailable=function(){return typeof document!="undefined"},m.GetDOMTextContent=function(E){for(var d="",x=E.firstChild;x;)x.nodeType===3&&(d+=x.textContent),x=x.nextSibling;return d},m}()},function(f,s,c){c.d(s,"a",function(){return w});var T=c(44),m=c(0),E=c(54),d=c(114),x=c(20),M=c(24),w=function(){function S(_,O,R){R===void 0&&(R=Number.MAX_VALUE),this.origin=_,this.direction=O,this.length=R}return S.prototype.intersectsBoxMinMax=function(_,O,R){R===void 0&&(R=0);var I,y,p,g,C=S._TmpVector3[0].copyFromFloats(_.x-R,_.y-R,_.z-R),P=S._TmpVector3[1].copyFromFloats(O.x+R,O.y+R,O.z+R),F=0,U=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<C.x||this.origin.x>P.x)return!1}else if(I=1/this.direction.x,y=(C.x-this.origin.x)*I,(p=(P.x-this.origin.x)*I)==-1/0&&(p=1/0),y>p&&(g=y,y=p,p=g),(F=Math.max(y,F))>(U=Math.min(p,U)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<C.y||this.origin.y>P.y)return!1}else if(I=1/this.direction.y,y=(C.y-this.origin.y)*I,(p=(P.y-this.origin.y)*I)==-1/0&&(p=1/0),y>p&&(g=y,y=p,p=g),(F=Math.max(y,F))>(U=Math.min(p,U)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<C.z||this.origin.z>P.z)return!1}else if(I=1/this.direction.z,y=(C.z-this.origin.z)*I,(p=(P.z-this.origin.z)*I)==-1/0&&(p=1/0),y>p&&(g=y,y=p,p=g),(F=Math.max(y,F))>(U=Math.min(p,U)))return!1;return!0},S.prototype.intersectsBox=function(_,O){return O===void 0&&(O=0),this.intersectsBoxMinMax(_.minimum,_.maximum,O)},S.prototype.intersectsSphere=function(_,O){O===void 0&&(O=0);var R=_.center.x-this.origin.x,I=_.center.y-this.origin.y,y=_.center.z-this.origin.z,p=R*R+I*I+y*y,g=_.radius+O,C=g*g;if(p<=C)return!0;var P=R*this.direction.x+I*this.direction.y+y*this.direction.z;return!(P<0)&&p-P*P<=C},S.prototype.intersectsTriangle=function(_,O,R){var I=S._TmpVector3[0],y=S._TmpVector3[1],p=S._TmpVector3[2],g=S._TmpVector3[3],C=S._TmpVector3[4];O.subtractToRef(_,I),R.subtractToRef(_,y),m.e.CrossToRef(this.direction,y,p);var P=m.e.Dot(I,p);if(P===0)return null;var F=1/P;this.origin.subtractToRef(_,g);var U=m.e.Dot(g,p)*F;if(U<0||U>1)return null;m.e.CrossToRef(g,I,C);var B=m.e.Dot(this.direction,C)*F;if(B<0||U+B>1)return null;var L=m.e.Dot(y,C)*F;return L>this.length?null:new d.a(1-U-B,U,L)},S.prototype.intersectsPlane=function(_){var O,R=m.e.Dot(_.normal,this.direction);if(Math.abs(R)<999999997475243e-21)return null;var I=m.e.Dot(_.normal,this.origin);return(O=(-_.d-I)/R)<0?O<-999999997475243e-21?null:0:O},S.prototype.intersectsAxis=function(_,O){switch(O===void 0&&(O=0),_){case"y":return(R=(this.origin.y-O)/this.direction.y)>0?null:new m.e(this.origin.x+this.direction.x*-R,O,this.origin.z+this.direction.z*-R);case"x":return(R=(this.origin.x-O)/this.direction.x)>0?null:new m.e(O,this.origin.y+this.direction.y*-R,this.origin.z+this.direction.z*-R);case"z":var R;return(R=(this.origin.z-O)/this.direction.z)>0?null:new m.e(this.origin.x+this.direction.x*-R,this.origin.y+this.direction.y*-R,O);default:return null}},S.prototype.intersectsMesh=function(_,O){var R=m.c.Matrix[0];return _.getWorldMatrix().invertToRef(R),this._tmpRay?S.TransformToRef(this,R,this._tmpRay):this._tmpRay=S.Transform(this,R),_.intersects(this._tmpRay,O)},S.prototype.intersectsMeshes=function(_,O,R){R?R.length=0:R=[];for(var I=0;I<_.length;I++){var y=this.intersectsMesh(_[I],O);y.hit&&R.push(y)}return R.sort(this._comparePickingInfo),R},S.prototype._comparePickingInfo=function(_,O){return _.distance<O.distance?-1:_.distance>O.distance?1:0},S.prototype.intersectionSegment=function(_,O,R){var I=this.origin,y=m.c.Vector3[0],p=m.c.Vector3[1],g=m.c.Vector3[2],C=m.c.Vector3[3];O.subtractToRef(_,y),this.direction.scaleToRef(S.rayl,g),I.addToRef(g,p),_.subtractToRef(I,C);var P,F,U,B,L=m.e.Dot(y,y),z=m.e.Dot(y,g),X=m.e.Dot(g,g),G=m.e.Dot(y,C),ee=m.e.Dot(g,C),$=L*X-z*z,fe=$,me=$;$<S.smallnum?(F=0,fe=1,B=ee,me=X):(B=L*ee-z*G,(F=z*ee-X*G)<0?(F=0,B=ee,me=X):F>fe&&(F=fe,B=ee+z,me=X)),B<0?(B=0,-G<0?F=0:-G>L?F=fe:(F=-G,fe=L)):B>me&&(B=me,-G+z<0?F=0:-G+z>L?F=fe:(F=-G+z,fe=L)),P=Math.abs(F)<S.smallnum?0:F/fe,U=Math.abs(B)<S.smallnum?0:B/me;var ve=m.c.Vector3[4];g.scaleToRef(U,ve);var be=m.c.Vector3[5];y.scaleToRef(P,be),be.addInPlace(C);var ie=m.c.Vector3[6];return be.subtractToRef(ve,ie),U>0&&U<=this.length&&ie.lengthSquared()<R*R?be.length():-1},S.prototype.update=function(_,O,R,I,y,p,g){return this.unprojectRayToRef(_,O,R,I,y,p,g),this},S.Zero=function(){return new S(m.e.Zero(),m.e.Zero())},S.CreateNew=function(_,O,R,I,y,p,g){return S.Zero().update(_,O,R,I,y,p,g)},S.CreateNewFromTo=function(_,O,R){R===void 0&&(R=m.a.IdentityReadOnly);var I=O.subtract(_),y=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);return I.normalize(),S.Transform(new S(_,I,y),R)},S.Transform=function(_,O){var R=new S(new m.e(0,0,0),new m.e(0,0,0));return S.TransformToRef(_,O,R),R},S.TransformToRef=function(_,O,R){m.e.TransformCoordinatesToRef(_.origin,O,R.origin),m.e.TransformNormalToRef(_.direction,O,R.direction),R.length=_.length;var I=R.direction,y=I.length();if(y!==0&&y!==1){var p=1/y;I.x*=p,I.y*=p,I.z*=p,R.length*=y}},S.prototype.unprojectRayToRef=function(_,O,R,I,y,p,g){var C=m.c.Matrix[0];y.multiplyToRef(p,C),C.multiplyToRef(g,C),C.invert();var P=m.c.Vector3[0];P.x=_/R*2-1,P.y=-(O/I*2-1),P.z=-1;var F=m.c.Vector3[1].copyFromFloats(P.x,P.y,1),U=m.c.Vector3[2],B=m.c.Vector3[3];m.e._UnprojectFromInvertedMatrixToRef(P,C,U),m.e._UnprojectFromInvertedMatrixToRef(F,C,B),this.origin.copyFrom(U),B.subtractToRef(U,this.direction),this.direction.normalize()},S._TmpVector3=T.a.BuildArray(6,m.e.Zero),S.smallnum=1e-8,S.rayl=1e9,S}();x.a.prototype.createPickingRay=function(S,_,O,R,I){I===void 0&&(I=!1);var y=w.Zero();return this.createPickingRayToRef(S,_,O,y,R,I),y},x.a.prototype.createPickingRayToRef=function(S,_,O,R,I,y){y===void 0&&(y=!1);var p=this.getEngine();if(!I){if(!this.activeCamera)return this;I=this.activeCamera}var g=I.viewport.toGlobal(p.getRenderWidth(),p.getRenderHeight());return S=S/p.getHardwareScalingLevel()-g.x,_=_/p.getHardwareScalingLevel()-(p.getRenderHeight()-g.y-g.height),R.update(S,_,g.width,g.height,O||m.a.IdentityReadOnly,y?m.a.IdentityReadOnly:I.getViewMatrix(),I.getProjectionMatrix()),this},x.a.prototype.createPickingRayInCameraSpace=function(S,_,O){var R=w.Zero();return this.createPickingRayInCameraSpaceToRef(S,_,R,O),R},x.a.prototype.createPickingRayInCameraSpaceToRef=function(S,_,O,R){if(!E.a)return this;var I=this.getEngine();if(!R){if(!this.activeCamera)throw new Error("Active camera not set");R=this.activeCamera}var y=R.viewport.toGlobal(I.getRenderWidth(),I.getRenderHeight()),p=m.a.Identity();return S=S/I.getHardwareScalingLevel()-y.x,_=_/I.getHardwareScalingLevel()-(I.getRenderHeight()-y.y-y.height),O.update(S,_,y.width,y.height,p,p,R.getProjectionMatrix()),this},x.a.prototype._internalPickForMesh=function(S,_,O,R,I,y,p,g){var C=_(R),P=O.intersects(C,I,p,y,R,g);return P&&P.hit?!I&&S!=null&&P.distance>=S.distance?null:P:null},x.a.prototype._internalPick=function(S,_,O,R,I){if(!E.a)return null;for(var y=null,p=0;p<this.meshes.length;p++){var g=this.meshes[p];if(_){if(!_(g))continue}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;var C,P=g.skeleton&&g.skeleton.overrideMesh?g.skeleton.overrideMesh.getWorldMatrix():g.getWorldMatrix();if(g.hasThinInstances&&g.thinInstanceEnablePicking){if(C=this._internalPickForMesh(y,S,g,P,!0,!0,I)){if(R)return y;for(var F=m.c.Matrix[1],U=g.thinInstanceGetWorldMatrices(),B=0;B<U.length;B++){U[B].multiplyToRef(P,F);var L=this._internalPickForMesh(y,S,g,F,O,R,I,!0);if(L&&((y=L).thinInstanceIndex=B,O))return y}}}else if((C=this._internalPickForMesh(y,S,g,P,O,R,I))&&(y=C,O))return y}return y||new E.a},x.a.prototype._internalMultiPick=function(S,_,O){if(!E.a)return null;for(var R=new Array,I=0;I<this.meshes.length;I++){var y=this.meshes[I];if(_){if(!_(y))continue}else if(!y.isEnabled()||!y.isVisible||!y.isPickable)continue;var p,g=y.skeleton&&y.skeleton.overrideMesh?y.skeleton.overrideMesh.getWorldMatrix():y.getWorldMatrix();if(y.hasThinInstances&&y.thinInstanceEnablePicking){if(p=this._internalPickForMesh(null,S,y,g,!0,!0,O))for(var C=m.c.Matrix[1],P=y.thinInstanceGetWorldMatrices(),F=0;F<P.length;F++){P[F].multiplyToRef(g,C);var U=this._internalPickForMesh(null,S,y,C,!1,!1,O,!0);U&&(U.thinInstanceIndex=F,R.push(U))}}else(p=this._internalPickForMesh(null,S,y,g,!1,!1,O))&&R.push(p)}return R},x.a.prototype.pickWithBoundingInfo=function(S,_,O,R,I){var y=this;if(!E.a)return null;var p=this._internalPick(function(g){return y._tempPickingRay||(y._tempPickingRay=w.Zero()),y.createPickingRayToRef(S,_,g,y._tempPickingRay,I||null),y._tempPickingRay},O,R,!0);return p&&(p.ray=this.createPickingRay(S,_,m.a.Identity(),I||null)),p},x.a.prototype.pick=function(S,_,O,R,I,y){var p=this;if(!E.a)return null;var g=this._internalPick(function(C){return p._tempPickingRay||(p._tempPickingRay=w.Zero()),p.createPickingRayToRef(S,_,C,p._tempPickingRay,I||null),p._tempPickingRay},O,R,!1,y);return g&&(g.ray=this.createPickingRay(S,_,m.a.Identity(),I||null)),g},x.a.prototype.pickWithRay=function(S,_,O,R){var I=this,y=this._internalPick(function(p){return I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=m.a.Identity()),p.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=w.Zero()),w.TransformToRef(S,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform},_,O,!1,R);return y&&(y.ray=S),y},x.a.prototype.multiPick=function(S,_,O,R,I){var y=this;return this._internalMultiPick(function(p){return y.createPickingRay(S,_,p,R||null)},O,I)},x.a.prototype.multiPickWithRay=function(S,_,O){var R=this;return this._internalMultiPick(function(I){return R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=m.a.Identity()),I.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=w.Zero()),w.TransformToRef(S,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform},_,O)},M.a.prototype.getForwardRay=function(S,_,O){return S===void 0&&(S=100),this.getForwardRayToRef(new w(m.e.Zero(),m.e.Zero(),S),S,_,O)},M.a.prototype.getForwardRayToRef=function(S,_,O,R){return _===void 0&&(_=100),O||(O=this.getWorldMatrix()),S.length=_,R?S.origin.copyFrom(R):S.origin.copyFrom(this.position),m.c.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),m.e.TransformNormalToRef(m.c.Vector3[2],O,m.c.Vector3[3]),m.e.NormalizeToRef(m.c.Vector3[3],S.direction),S}},function(f,s,c){c.d(s,"a",function(){return M});var T=c(0),m=c(7),E=c(16),d=c(98),x=c(4);E.a.CreateLineSystem=function(w){for(var S=[],_=[],O=w.lines,R=w.colors,I=[],y=0,p=0;p<O.length;p++)for(var g=O[p],C=0;C<g.length;C++){if(_.push(g[C].x,g[C].y,g[C].z),R){var P=R[p];I.push(P[C].r,P[C].g,P[C].b,P[C].a)}C>0&&(S.push(y-1),S.push(y)),y++}var F=new E.a;return F.indices=S,F.positions=_,R&&(F.colors=I),F},E.a.CreateDashedLines=function(w){var S,_,O=w.dashSize||3,R=w.gapSize||1,I=w.dashNb||200,y=w.points,p=new Array,g=new Array,C=T.e.Zero(),P=0,F=0,U=0,B=0,L=0;for(L=0;L<y.length-1;L++)y[L+1].subtractToRef(y[L],C),P+=C.length();for(_=O*(S=P/I)/(O+R),L=0;L<y.length-1;L++){y[L+1].subtractToRef(y[L],C),F=Math.floor(C.length()/S),C.normalize();for(var z=0;z<F;z++)U=S*z,p.push(y[L].x+U*C.x,y[L].y+U*C.y,y[L].z+U*C.z),p.push(y[L].x+(U+_)*C.x,y[L].y+(U+_)*C.y,y[L].z+(U+_)*C.z),g.push(B,B+1),B+=2}var X=new E.a;return X.positions=p,X.indices=g,X},m.a.CreateLines=function(w,S,_,O,R){_===void 0&&(_=null),O===void 0&&(O=!1),R===void 0&&(R=null);var I={points:S,updatable:O,instance:R};return M.CreateLines(w,I,_)},m.a.CreateDashedLines=function(w,S,_,O,R,I,y,p){I===void 0&&(I=null);var g={points:S,dashSize:_,gapSize:O,dashNb:R,updatable:y,instance:p};return M.CreateDashedLines(w,g,I)};var M=function(){function w(){}return w.CreateLineSystem=function(S,_,O){var R=_.instance,I=_.lines,y=_.colors;if(R){var p,g,C=R.getVerticesData(x.b.PositionKind);y&&(p=R.getVerticesData(x.b.ColorKind));for(var P=0,F=0,U=0;U<I.length;U++)for(var B=I[U],L=0;L<B.length;L++)C[P]=B[L].x,C[P+1]=B[L].y,C[P+2]=B[L].z,y&&p&&(g=y[U],p[F]=g[L].r,p[F+1]=g[L].g,p[F+2]=g[L].b,p[F+3]=g[L].a,F+=4),P+=3;return R.updateVerticesData(x.b.PositionKind,C,!1,!1),y&&p&&R.updateVerticesData(x.b.ColorKind,p,!1,!1),R}var z=!!y,X=new d.b(S,O,null,void 0,void 0,z,_.useVertexAlpha);return E.a.CreateLineSystem(_).applyToMesh(X,_.updatable),X},w.CreateLines=function(S,_,O){O===void 0&&(O=null);var R=_.colors?[_.colors]:null;return w.CreateLineSystem(S,{lines:[_.points],updatable:_.updatable,instance:_.instance,colors:R,useVertexAlpha:_.useVertexAlpha},O)},w.CreateDashedLines=function(S,_,O){O===void 0&&(O=null);var R=_.points,I=_.instance,y=_.gapSize||1,p=_.dashSize||3;if(I)return I.updateMeshPositions(function(C){var P,F,U=T.e.Zero(),B=C.length/6,L=0,z=0,X=0,G=0,ee=0,$=0;for(ee=0;ee<R.length-1;ee++)R[ee+1].subtractToRef(R[ee],U),L+=U.length();P=L/B;var fe=I._creationDataStorage.dashSize;for(F=fe*P/(fe+I._creationDataStorage.gapSize),ee=0;ee<R.length-1;ee++)for(R[ee+1].subtractToRef(R[ee],U),z=Math.floor(U.length()/P),U.normalize(),$=0;$<z&&G<C.length;)X=P*$,C[G]=R[ee].x+X*U.x,C[G+1]=R[ee].y+X*U.y,C[G+2]=R[ee].z+X*U.z,C[G+3]=R[ee].x+(X+F)*U.x,C[G+4]=R[ee].y+(X+F)*U.y,C[G+5]=R[ee].z+(X+F)*U.z,G+=6,$++;for(;G<C.length;)C[G]=R[ee].x,C[G+1]=R[ee].y,C[G+2]=R[ee].z,G+=3},!1),I;var g=new d.b(S,O,null,void 0,void 0,void 0,_.useVertexAlpha);return E.a.CreateDashedLines(_).applyToMesh(g,_.updatable),g._creationDataStorage=new m.b,g._creationDataStorage.dashSize=p,g._creationDataStorage.gapSize=y,g},w}()},function(f,s,c){c.d(s,"a",function(){return d});var T=c(34),m=c(8),E=function(x,M){return x?x.getClassName&&x.getClassName()==="Mesh"?null:x.getClassName&&x.getClassName()==="SubMesh"?x.clone(M):x.clone?x.clone():null:null},d=function(){function x(){}return x.DeepCopy=function(M,w,S,_){for(var O=0,R=function(P){var F=[];do Object.getOwnPropertyNames(P).forEach(function(U){F.indexOf(U)===-1&&F.push(U)});while(P=Object.getPrototypeOf(P));return F}(M);O<R.length;O++){var I=R[O];if((I[0]!=="_"||_&&_.indexOf(I)!==-1)&&!(T.a.EndsWith(I,"Observable")||S&&S.indexOf(I)!==-1)){var y=M[I],p=typeof y;if(p!=="function")try{if(p==="object")if(y instanceof Array){if(w[I]=[],y.length>0)if(typeof y[0]=="object")for(var g=0;g<y.length;g++){var C=E(y[g],w);w[I].indexOf(C)===-1&&w[I].push(C)}else w[I]=y.slice(0)}else w[I]=E(y,w);else w[I]=y}catch(P){m.a.Warn(P.message)}}}},x}()},function(f,s,c){c.d(s,"b",function(){return S}),c.d(s,"a",function(){return _});var T=c(1),m=c(3),E=c(6),d=c(12),x=c(9),M=c(76),w=c(121),S=function(O){function R(){var I=O.call(this)||this;return I.IMAGEPROCESSING=!1,I.VIGNETTE=!1,I.VIGNETTEBLENDMODEMULTIPLY=!1,I.VIGNETTEBLENDMODEOPAQUE=!1,I.TONEMAPPING=!1,I.TONEMAPPING_ACES=!1,I.CONTRAST=!1,I.COLORCURVES=!1,I.COLORGRADING=!1,I.COLORGRADING3D=!1,I.SAMPLER3DGREENDEPTH=!1,I.SAMPLER3DBGRMAP=!1,I.IMAGEPROCESSINGPOSTPROCESS=!1,I.EXPOSURE=!1,I.rebuild(),I}return Object(T.d)(R,O),R}(M.a),_=function(){function O(){this.colorCurves=new w.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=O.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new x.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=O.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new E.c}return Object.defineProperty(O.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(R){this._colorCurvesEnabled!==R&&(this._colorCurvesEnabled=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(R){this._colorGradingTexture!==R&&(this._colorGradingTexture=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(R){this._colorGradingEnabled!==R&&(this._colorGradingEnabled=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(R){this._colorGradingWithGreenDepth!==R&&(this._colorGradingWithGreenDepth=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(R){this._colorGradingBGR!==R&&(this._colorGradingBGR=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"exposure",{get:function(){return this._exposure},set:function(R){this._exposure!==R&&(this._exposure=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(R){this._toneMappingEnabled!==R&&(this._toneMappingEnabled=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(R){this._toneMappingType!==R&&(this._toneMappingType=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"contrast",{get:function(){return this._contrast},set:function(R){this._contrast!==R&&(this._contrast=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(R){this._vignetteBlendMode!==R&&(this._vignetteBlendMode=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(R){this._vignetteEnabled!==R&&(this._vignetteEnabled=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(R){this._applyByPostProcess!==R&&(this._applyByPostProcess=R,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(R){this._isEnabled!==R&&(this._isEnabled=R,this._updateParameters())},enumerable:!1,configurable:!0}),O.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},O.prototype.getClassName=function(){return"ImageProcessingConfiguration"},O.PrepareUniforms=function(R,I){I.EXPOSURE&&R.push("exposureLinear"),I.CONTRAST&&R.push("contrast"),I.COLORGRADING&&R.push("colorTransformSettings"),I.VIGNETTE&&(R.push("vInverseScreenSize"),R.push("vignetteSettings1"),R.push("vignetteSettings2")),I.COLORCURVES&&w.a.PrepareUniforms(R)},O.PrepareSamplers=function(R,I){I.COLORGRADING&&R.push("txColorTransform")},O.prototype.prepareDefines=function(R,I){if(I===void 0&&(I=!1),I!==this.applyByPostProcess||!this._isEnabled)return R.VIGNETTE=!1,R.TONEMAPPING=!1,R.TONEMAPPING_ACES=!1,R.CONTRAST=!1,R.EXPOSURE=!1,R.COLORCURVES=!1,R.COLORGRADING=!1,R.COLORGRADING3D=!1,R.IMAGEPROCESSING=!1,void(R.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(R.VIGNETTE=this.vignetteEnabled,R.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===O._VIGNETTEMODE_MULTIPLY,R.VIGNETTEBLENDMODEOPAQUE=!R.VIGNETTEBLENDMODEMULTIPLY,R.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case O.TONEMAPPING_ACES:R.TONEMAPPING_ACES=!0;break;default:R.TONEMAPPING_ACES=!1}R.CONTRAST=this.contrast!==1,R.EXPOSURE=this.exposure!==1,R.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,R.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,R.COLORGRADING?R.COLORGRADING3D=this.colorGradingTexture.is3D:R.COLORGRADING3D=!1,R.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,R.SAMPLER3DBGRMAP=this.colorGradingBGR,R.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,R.IMAGEPROCESSING=R.VIGNETTE||R.TONEMAPPING||R.CONTRAST||R.EXPOSURE||R.COLORCURVES||R.COLORGRADING},O.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},O.prototype.bind=function(R,I){if(this._colorCurvesEnabled&&this.colorCurves&&w.a.Bind(this.colorCurves,R),this._vignetteEnabled){var y=1/R.getEngine().getRenderWidth(),p=1/R.getEngine().getRenderHeight();R.setFloat2("vInverseScreenSize",y,p);var g=I??p/y,C=Math.tan(.5*this.vignetteCameraFov),P=C*g,F=Math.sqrt(P*C);P=d.b.Mix(P,F,this.vignetteStretch),C=d.b.Mix(C,F,this.vignetteStretch),R.setFloat4("vignetteSettings1",P,C,-P*this.vignetteCentreX,-C*this.vignetteCentreY);var U=-2*this.vignetteWeight;R.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,U)}if(R.setFloat("exposureLinear",this.exposure),R.setFloat("contrast",this.contrast),this.colorGradingTexture){R.setTexture("txColorTransform",this.colorGradingTexture);var B=this.colorGradingTexture.getSize().height;R.setFloat4("colorTransformSettings",(B-1)/B,.5/B,B,this.colorGradingTexture.level)}},O.prototype.clone=function(){return m.a.Clone(function(){return new O},this)},O.prototype.serialize=function(){return m.a.Serialize(this)},O.Parse=function(R){return m.a.Parse(function(){return new O},R,null,null)},Object.defineProperty(O,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(O,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),O.TONEMAPPING_STANDARD=0,O.TONEMAPPING_ACES=1,O._VIGNETTEMODE_MULTIPLY=0,O._VIGNETTEMODE_OPAQUE=1,Object(T.c)([Object(m.g)()],O.prototype,"colorCurves",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_colorCurvesEnabled",void 0),Object(T.c)([Object(m.m)("colorGradingTexture")],O.prototype,"_colorGradingTexture",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_colorGradingEnabled",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_colorGradingWithGreenDepth",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_colorGradingBGR",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_exposure",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_toneMappingEnabled",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_toneMappingType",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_contrast",void 0),Object(T.c)([Object(m.c)()],O.prototype,"vignetteStretch",void 0),Object(T.c)([Object(m.c)()],O.prototype,"vignetteCentreX",void 0),Object(T.c)([Object(m.c)()],O.prototype,"vignetteCentreY",void 0),Object(T.c)([Object(m.c)()],O.prototype,"vignetteWeight",void 0),Object(T.c)([Object(m.f)()],O.prototype,"vignetteColor",void 0),Object(T.c)([Object(m.c)()],O.prototype,"vignetteCameraFov",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_vignetteBlendMode",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_vignetteEnabled",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_applyByPostProcess",void 0),Object(T.c)([Object(m.c)()],O.prototype,"_isEnabled",void 0),O}();m.a._ImageProcessingConfigurationParser=_.Parse},function(f,s,c){c.d(s,"a",function(){return O});var T=c(44),m=c(0),E=c(2),d=c(103),x=c(113),M={min:0,max:0},w={min:0,max:0},S=function(R,I,y){var p=m.e.Dot(I.centerWorld,R),g=Math.abs(m.e.Dot(I.directions[0],R))*I.extendSize.x+Math.abs(m.e.Dot(I.directions[1],R))*I.extendSize.y+Math.abs(m.e.Dot(I.directions[2],R))*I.extendSize.z;y.min=p-g,y.max=p+g},_=function(R,I,y){return S(R,I,M),S(R,y,w),!(M.min>w.max||w.min>M.max)},O=function(){function R(I,y,p){this._isLocked=!1,this.boundingBox=new d.a(I,y,p),this.boundingSphere=new x.a(I,y,p)}return R.prototype.reConstruct=function(I,y,p){this.boundingBox.reConstruct(I,y,p),this.boundingSphere.reConstruct(I,y,p)},Object.defineProperty(R.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isLocked",{get:function(){return this._isLocked},set:function(I){this._isLocked=I},enumerable:!1,configurable:!0}),R.prototype.update=function(I){this._isLocked||(this.boundingBox._update(I),this.boundingSphere._update(I))},R.prototype.centerOn=function(I,y){var p=R.TmpVector3[0].copyFrom(I).subtractInPlace(y),g=R.TmpVector3[1].copyFrom(I).addInPlace(y);return this.boundingBox.reConstruct(p,g,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(p,g,this.boundingBox.getWorldMatrix()),this},R.prototype.scale=function(I){return this.boundingBox.scale(I),this.boundingSphere.scale(I),this},R.prototype.isInFrustum=function(I,y){return y===void 0&&(y=E.a.MESHES_CULLINGSTRATEGY_STANDARD),!(y!==E.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&y!==E.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(I))||!!this.boundingSphere.isInFrustum(I)&&(!(y!==E.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&y!==E.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(I))},Object.defineProperty(R.prototype,"diagonalLength",{get:function(){var I=this.boundingBox;return I.maximumWorld.subtractToRef(I.minimumWorld,R.TmpVector3[0]).length()},enumerable:!1,configurable:!0}),R.prototype.isCompletelyInFrustum=function(I){return this.boundingBox.isCompletelyInFrustum(I)},R.prototype._checkCollision=function(I){return I._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},R.prototype.intersectsPoint=function(I){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(I)&&!!this.boundingBox.intersectsPoint(I)},R.prototype.intersects=function(I,y){if(!x.a.Intersects(this.boundingSphere,I.boundingSphere)||!d.a.Intersects(this.boundingBox,I.boundingBox))return!1;if(!y)return!0;var p=this.boundingBox,g=I.boundingBox;return!!_(p.directions[0],p,g)&&!!_(p.directions[1],p,g)&&!!_(p.directions[2],p,g)&&!!_(g.directions[0],p,g)&&!!_(g.directions[1],p,g)&&!!_(g.directions[2],p,g)&&!!_(m.e.Cross(p.directions[0],g.directions[0]),p,g)&&!!_(m.e.Cross(p.directions[0],g.directions[1]),p,g)&&!!_(m.e.Cross(p.directions[0],g.directions[2]),p,g)&&!!_(m.e.Cross(p.directions[1],g.directions[0]),p,g)&&!!_(m.e.Cross(p.directions[1],g.directions[1]),p,g)&&!!_(m.e.Cross(p.directions[1],g.directions[2]),p,g)&&!!_(m.e.Cross(p.directions[2],g.directions[0]),p,g)&&!!_(m.e.Cross(p.directions[2],g.directions[1]),p,g)&&!!_(m.e.Cross(p.directions[2],g.directions[2]),p,g)},R.TmpVector3=T.a.BuildArray(2,m.e.Zero),R}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.BuildArray=function(E,d){for(var x=[],M=0;M<E;++M)x.push(d());return x},m}()},function(f,s,c){c.d(s,"a",function(){return d});var T=c(0),m=c(7),E=c(16);E.a.CreateSphere=function(x){for(var M=x.segments||32,w=x.diameterX||x.diameter||1,S=x.diameterY||x.diameter||1,_=x.diameterZ||x.diameter||1,O=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1,R=x.slice&&x.slice<=0?1:x.slice||1,I=x.sideOrientation===0?0:x.sideOrientation||E.a.DEFAULTSIDE,y=!!x.dedupTopBottomIndices,p=new T.e(w/2,S/2,_/2),g=2+M,C=2*g,P=[],F=[],U=[],B=[],L=0;L<=g;L++){for(var z=L/g,X=z*Math.PI*R,G=0;G<=C;G++){var ee=G/C,$=ee*Math.PI*2*O,fe=T.a.RotationZ(-X),me=T.a.RotationY($),ve=T.e.TransformCoordinates(T.e.Up(),fe),be=T.e.TransformCoordinates(ve,me),ie=be.multiply(p),se=be.divide(p).normalize();F.push(ie.x,ie.y,ie.z),U.push(se.x,se.y,se.z),B.push(ee,z)}if(L>0)for(var V=F.length/3,K=V-2*(C+1);K+C+2<V;K++)y?(L>1&&(P.push(K),P.push(K+1),P.push(K+C+1)),(L<g||R<1)&&(P.push(K+C+1),P.push(K+1),P.push(K+C+2))):(P.push(K),P.push(K+1),P.push(K+C+1),P.push(K+C+1),P.push(K+1),P.push(K+C+2))}E.a._ComputeSides(I,F,P,U,B,x.frontUVs,x.backUVs);var Z=new E.a;return Z.indices=P,Z.positions=F,Z.normals=U,Z.uvs=B,Z},m.a.CreateSphere=function(x,M,w,S,_,O){var R={segments:M,diameterX:w,diameterY:w,diameterZ:w,sideOrientation:O,updatable:_};return d.CreateSphere(x,R,S)};var d=function(){function x(){}return x.CreateSphere=function(M,w,S){S===void 0&&(S=null);var _=new m.a(M,S);return w.sideOrientation=m.a._GetDefaultSideOrientation(w.sideOrientation),_._originalBuilderSideOrientation=w.sideOrientation,E.a.CreateSphere(w).applyToMesh(_,w.updatable),_},x}()},function(f,s,c){c.d(s,"a",function(){return w});var T=c(1),m=c(3),E=c(6),d=c(0),x=c(29),M=c(23),w=function(S){function _(O,R,I){R===void 0&&(R=null),I===void 0&&(I=!0);var y=S.call(this,O,R)||this;return y._forward=new d.e(0,0,1),y._forwardInverted=new d.e(0,0,-1),y._up=new d.e(0,1,0),y._right=new d.e(1,0,0),y._rightInverted=new d.e(-1,0,0),y._position=d.e.Zero(),y._rotation=d.e.Zero(),y._rotationQuaternion=null,y._scaling=d.e.One(),y._isDirty=!1,y._transformToBoneReferal=null,y._isAbsoluteSynced=!1,y._billboardMode=_.BILLBOARDMODE_NONE,y._preserveParentRotationForBillboard=!1,y.scalingDeterminant=1,y._infiniteDistance=!1,y.ignoreNonUniformScaling=!1,y.reIntegrateRotationIntoRotationQuaternion=!1,y._poseMatrix=null,y._localMatrix=d.a.Zero(),y._usePivotMatrix=!1,y._absolutePosition=d.e.Zero(),y._absoluteScaling=d.e.Zero(),y._absoluteRotationQuaternion=d.b.Identity(),y._pivotMatrix=d.a.Identity(),y._postMultiplyPivotMatrix=!1,y._isWorldMatrixFrozen=!1,y._indexInSceneTransformNodesArray=-1,y.onAfterWorldMatrixUpdateObservable=new E.c,y._nonUniformScaling=!1,I&&y.getScene().addTransformNode(y),y}return Object(T.d)(_,S),Object.defineProperty(_.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(O){this._billboardMode!==O&&(this._billboardMode=O)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(O){O!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=O)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(O){this._infiniteDistance!==O&&(this._infiniteDistance=O)},enumerable:!1,configurable:!0}),_.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(_.prototype,"position",{get:function(){return this._position},set:function(O){this._position=O,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"rotation",{get:function(){return this._rotation},set:function(O){this._rotation=O,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"scaling",{get:function(){return this._scaling},set:function(O){this._scaling=O,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(O){this._rotationQuaternion=O,O&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"forward",{get:function(){return d.e.Normalize(d.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"up",{get:function(){return d.e.Normalize(d.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"right",{get:function(){return d.e.Normalize(d.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),_.prototype.updatePoseMatrix=function(O){return this._poseMatrix?(this._poseMatrix.copyFrom(O),this):(this._poseMatrix=O.clone(),this)},_.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=d.a.Identity()),this._poseMatrix},_.prototype._isSynchronized=function(){var O=this._cache;return this.billboardMode===O.billboardMode&&this.billboardMode===_.BILLBOARDMODE_NONE&&!O.pivotMatrixUpdated&&!this.infiniteDistance&&!this.position._isDirty&&!this.scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},_.prototype._initCache=function(){S.prototype._initCache.call(this);var O=this._cache;O.localMatrixUpdated=!1,O.billboardMode=-1,O.infiniteDistance=!1},_.prototype.markAsDirty=function(O){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(_.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),_.prototype.setPreTransformMatrix=function(O){return this.setPivotMatrix(O,!1)},_.prototype.setPivotMatrix=function(O,R){return R===void 0&&(R=!0),this._pivotMatrix.copyFrom(O),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=R,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=d.a.Invert(this._pivotMatrix)),this},_.prototype.getPivotMatrix=function(){return this._pivotMatrix},_.prototype.instantiateHierarchy=function(O,R,I){O===void 0&&(O=null);var y=this.clone("Clone of "+(this.name||this.id),O||this.parent,!0);y&&I&&I(this,y);for(var p=0,g=this.getChildTransformNodes(!0);p<g.length;p++)g[p].instantiateHierarchy(y,R,I);return y},_.prototype.freezeWorldMatrix=function(O){return O===void 0&&(O=null),O?this._worldMatrix=O:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},_.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(_.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),_.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},_.prototype.setAbsolutePosition=function(O){if(!O)return this;var R,I,y;if(O.x===void 0){if(arguments.length<3)return this;R=arguments[0],I=arguments[1],y=arguments[2]}else R=O.x,I=O.y,y=O.z;if(this.parent){var p=d.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(p),d.e.TransformCoordinatesFromFloatsToRef(R,I,y,p,this.position)}else this.position.x=R,this.position.y=I,this.position.z=y;return this._absolutePosition.copyFrom(O),this},_.prototype.setPositionWithLocalVector=function(O){return this.computeWorldMatrix(),this.position=d.e.TransformNormal(O,this._localMatrix),this},_.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var O=d.c.Matrix[0];return this._localMatrix.invertToRef(O),d.e.TransformNormal(this.position,O)},_.prototype.locallyTranslate=function(O){return this.computeWorldMatrix(!0),this.position=d.e.TransformCoordinates(O,this._localMatrix),this},_.prototype.lookAt=function(O,R,I,y,p){R===void 0&&(R=0),I===void 0&&(I=0),y===void 0&&(y=0),p===void 0&&(p=M.c.LOCAL);var g=_._lookAtVectorCache,C=p===M.c.LOCAL?this.position:this.getAbsolutePosition();if(O.subtractToRef(C,g),this.setDirection(g,R,I,y),p===M.c.WORLD&&this.parent)if(this.rotationQuaternion){var P=d.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(P);var F=d.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(F),F.invert(),P.multiplyToRef(F,P),this.rotationQuaternion.fromRotationMatrix(P)}else{var U=d.c.Quaternion[0];d.b.FromEulerVectorToRef(this.rotation,U),P=d.c.Matrix[0],U.toRotationMatrix(P),F=d.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(F),F.invert(),P.multiplyToRef(F,P),U.fromRotationMatrix(P),U.toEulerAnglesToRef(this.rotation)}return this},_.prototype.getDirection=function(O){var R=d.e.Zero();return this.getDirectionToRef(O,R),R},_.prototype.getDirectionToRef=function(O,R){return d.e.TransformNormalToRef(O,this.getWorldMatrix(),R),this},_.prototype.setDirection=function(O,R,I,y){R===void 0&&(R=0),I===void 0&&(I=0),y===void 0&&(y=0);var p=-Math.atan2(O.z,O.x)+Math.PI/2,g=Math.sqrt(O.x*O.x+O.z*O.z),C=-Math.atan2(O.y,g);return this.rotationQuaternion?d.b.RotationYawPitchRollToRef(p+R,C+I,y,this.rotationQuaternion):(this.rotation.x=C+I,this.rotation.y=p+R,this.rotation.z=y),this},_.prototype.setPivotPoint=function(O,R){R===void 0&&(R=M.c.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var I=this.getWorldMatrix();if(R==M.c.WORLD){var y=d.c.Matrix[0];I.invertToRef(y),O=d.e.TransformCoordinates(O,y)}return this.setPivotMatrix(d.a.Translation(-O.x,-O.y,-O.z),!0)},_.prototype.getPivotPoint=function(){var O=d.e.Zero();return this.getPivotPointToRef(O),O},_.prototype.getPivotPointToRef=function(O){return O.x=-this._pivotMatrix.m[12],O.y=-this._pivotMatrix.m[13],O.z=-this._pivotMatrix.m[14],this},_.prototype.getAbsolutePivotPoint=function(){var O=d.e.Zero();return this.getAbsolutePivotPointToRef(O),O},_.prototype.getAbsolutePivotPointToRef=function(O){return this.getPivotPointToRef(O),d.e.TransformCoordinatesToRef(O,this.getWorldMatrix(),O),this},_.prototype.setParent=function(O){if(!O&&!this.parent)return this;var R=d.c.Quaternion[0],I=d.c.Vector3[0],y=d.c.Vector3[1];if(O){var p=d.c.Matrix[0],g=d.c.Matrix[1];this.computeWorldMatrix(!0),O.computeWorldMatrix(!0),O.getWorldMatrix().invertToRef(g),this.getWorldMatrix().multiplyToRef(g,p),p.decompose(y,R,I)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(y,R,I);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(R):R.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(y),this.position.copyFrom(I),this.parent=O,this},Object.defineProperty(_.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),_.prototype._updateNonUniformScalingState=function(O){return this._nonUniformScaling!==O&&(this._nonUniformScaling=O,!0)},_.prototype.attachToBone=function(O,R){return this._transformToBoneReferal=R,this.parent=O,O.getSkeleton().prepare(),O.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},_.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},_.prototype.rotate=function(O,R,I){var y;if(O.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),I&&I!==M.c.LOCAL){if(this.parent){var p=d.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(p),O=d.e.TransformNormal(O,p)}(y=d.b.RotationAxisToRef(O,R,_._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else y=d.b.RotationAxisToRef(O,R,_._rotationAxisCache),this.rotationQuaternion.multiplyToRef(y,this.rotationQuaternion);return this},_.prototype.rotateAround=function(O,R,I){R.normalize(),this.rotationQuaternion||(this.rotationQuaternion=d.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var y=d.c.Vector3[0],p=d.c.Vector3[1],g=d.c.Vector3[2],C=d.c.Quaternion[0],P=d.c.Matrix[0],F=d.c.Matrix[1],U=d.c.Matrix[2],B=d.c.Matrix[3];return O.subtractToRef(this.position,y),d.a.TranslationToRef(y.x,y.y,y.z,P),d.a.TranslationToRef(-y.x,-y.y,-y.z,F),d.a.RotationAxisToRef(R,I,U),F.multiplyToRef(U,B),B.multiplyToRef(P,B),B.decompose(p,C,g),this.position.addInPlace(g),C.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},_.prototype.translate=function(O,R,I){var y=O.scale(R);if(I&&I!==M.c.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(y));else{var p=this.getPositionExpressedInLocalSpace().add(y);this.setPositionWithLocalVector(p)}return this},_.prototype.addRotation=function(O,R,I){var y;this.rotationQuaternion?y=this.rotationQuaternion:(y=d.c.Quaternion[1],d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,y));var p=d.c.Quaternion[0];return d.b.RotationYawPitchRollToRef(R,O,I,p),y.multiplyInPlace(p),this.rotationQuaternion||y.toEulerAnglesToRef(this.rotation),this},_.prototype._getEffectiveParent=function(){return this.parent},_.prototype.computeWorldMatrix=function(O){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var R=this.getScene().getRenderId();if(!this._isDirty&&!O&&this.isSynchronized())return this._currentRenderId=R,this._worldMatrix;var I=this.getScene().activeCamera,y=(this._billboardMode&_.BILLBOARDMODE_USE_POSITION)!=0,p=this._billboardMode!==_.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;p&&I&&y&&(this.lookAt(I.position),(this.billboardMode&_.BILLBOARDMODE_X)!==_.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&_.BILLBOARDMODE_Y)!==_.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&_.BILLBOARDMODE_Z)!==_.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var g=this._cache;g.pivotMatrixUpdated=!1,g.billboardMode=this.billboardMode,g.infiniteDistance=this.infiniteDistance,this._currentRenderId=R,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var C,P=this._getEffectiveParent(),F=_._TmpScaling,U=this._position;if(this._infiniteDistance&&!this.parent&&I){var B=I.getWorldMatrix(),L=new d.e(B.m[12],B.m[13],B.m[14]);(U=_._TmpTranslation).copyFromFloats(this._position.x+L.x,this._position.y+L.y,this._position.z+L.z)}if(F.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,C=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(d.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(C=_._TmpRotation,d.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,C)),this._usePivotMatrix){var z=d.c.Matrix[1];d.a.ScalingToRef(F.x,F.y,F.z,z);var X=d.c.Matrix[0];C.toRotationMatrix(X),this._pivotMatrix.multiplyToRef(z,d.c.Matrix[4]),d.c.Matrix[4].multiplyToRef(X,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(U.x,U.y,U.z)}else d.a.ComposeToRef(F,C,U,this._localMatrix);if(P&&P.getWorldMatrix){if(O&&P.computeWorldMatrix(),p){this._transformToBoneReferal?P.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),d.c.Matrix[7]):d.c.Matrix[7].copyFrom(P.getWorldMatrix());var G=d.c.Vector3[5],ee=d.c.Vector3[6];d.c.Matrix[7].decompose(ee,void 0,G),d.a.ScalingToRef(ee.x,ee.y,ee.z,d.c.Matrix[7]),d.c.Matrix[7].setTranslation(G),this._localMatrix.multiplyToRef(d.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(P.getWorldMatrix(),d.c.Matrix[6]),d.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(P.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(p&&I&&this.billboardMode&&!y){var $=d.c.Vector3[0];if(this._worldMatrix.getTranslationToRef($),d.c.Matrix[1].copyFrom(I.getViewMatrix()),d.c.Matrix[1].setTranslationFromFloats(0,0,0),d.c.Matrix[1].invertToRef(d.c.Matrix[0]),(this.billboardMode&_.BILLBOARDMODE_ALL)!==_.BILLBOARDMODE_ALL){d.c.Matrix[0].decompose(void 0,d.c.Quaternion[0],void 0);var fe=d.c.Vector3[1];d.c.Quaternion[0].toEulerAnglesToRef(fe),(this.billboardMode&_.BILLBOARDMODE_X)!==_.BILLBOARDMODE_X&&(fe.x=0),(this.billboardMode&_.BILLBOARDMODE_Y)!==_.BILLBOARDMODE_Y&&(fe.y=0),(this.billboardMode&_.BILLBOARDMODE_Z)!==_.BILLBOARDMODE_Z&&(fe.z=0),d.a.RotationYawPitchRollToRef(fe.y,fe.x,fe.z,d.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):P&&P._nonUniformScaling?this._updateNonUniformScalingState(P._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=d.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},_.prototype.resetLocalMatrix=function(O){if(O===void 0&&(O=!0),this.computeWorldMatrix(),O)for(var R=this.getChildren(),I=0;I<R.length;++I){var y=R[I];if(y){y.computeWorldMatrix();var p=d.c.Matrix[0];y._localMatrix.multiplyToRef(this._localMatrix,p);var g=d.c.Quaternion[0];p.decompose(y.scaling,g,y.position),y.rotationQuaternion?y.rotationQuaternion=g:g.toEulerAnglesToRef(y.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=d.b.Identity()),this._worldMatrix=d.a.Identity()},_.prototype._afterComputeWorldMatrix=function(){},_.prototype.registerAfterWorldMatrixUpdate=function(O){return this.onAfterWorldMatrixUpdateObservable.add(O),this},_.prototype.unregisterAfterWorldMatrixUpdate=function(O){return this.onAfterWorldMatrixUpdateObservable.removeCallback(O),this},_.prototype.getPositionInCameraSpace=function(O){return O===void 0&&(O=null),O||(O=this.getScene().activeCamera),d.e.TransformCoordinates(this.getAbsolutePosition(),O.getViewMatrix())},_.prototype.getDistanceToCamera=function(O){return O===void 0&&(O=null),O||(O=this.getScene().activeCamera),this.getAbsolutePosition().subtract(O.globalPosition).length()},_.prototype.clone=function(O,R,I){var y=this,p=m.a.Clone(function(){return new _(O,y.getScene())},this);if(p.name=O,p.id=O,R&&(p.parent=R),!I)for(var g=this.getDescendants(!0),C=0;C<g.length;C++){var P=g[C];P.clone&&P.clone(O+"."+P.name,p)}return p},_.prototype.serialize=function(O){var R=m.a.Serialize(this,O);return R.type=this.getClassName(),this.parent&&(R.parentId=this.parent.id),R.localMatrix=this.getPivotMatrix().asArray(),R.isEnabled=this.isEnabled(),this.parent&&(R.parentId=this.parent.id),R},_.Parse=function(O,R,I){var y=m.a.Parse(function(){return new _(O.name,R)},O,R,I);return O.localMatrix?y.setPreTransformMatrix(d.a.FromArray(O.localMatrix)):O.pivotMatrix&&y.setPivotMatrix(d.a.FromArray(O.pivotMatrix)),y.setEnabled(O.isEnabled),O.parentId&&(y._waitingParentId=O.parentId),y},_.prototype.getChildTransformNodes=function(O,R){var I=[];return this._getDescendants(I,O,function(y){return(!R||R(y))&&y instanceof _}),I},_.prototype.dispose=function(O,R){if(R===void 0&&(R=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),O)for(var I=0,y=this.getChildTransformNodes(!0);I<y.length;I++){var p=y[I];p.parent=null,p.computeWorldMatrix(!0)}S.prototype.dispose.call(this,O,R)},_.prototype.normalizeToUnitCube=function(O,R,I){O===void 0&&(O=!0),R===void 0&&(R=!1);var y=null,p=null;R&&(this.rotationQuaternion?(p=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(y=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var g=this.getHierarchyBoundingVectors(O,I),C=g.max.subtract(g.min),P=Math.max(C.x,C.y,C.z);if(P===0)return this;var F=1/P;return this.scaling.scaleInPlace(F),R&&(this.rotationQuaternion&&p?this.rotationQuaternion.copyFrom(p):this.rotation&&y&&this.rotation.copyFrom(y)),this},_.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},_.BILLBOARDMODE_NONE=0,_.BILLBOARDMODE_X=1,_.BILLBOARDMODE_Y=2,_.BILLBOARDMODE_Z=4,_.BILLBOARDMODE_ALL=7,_.BILLBOARDMODE_USE_POSITION=128,_._TmpRotation=d.b.Zero(),_._TmpScaling=d.e.Zero(),_._TmpTranslation=d.e.Zero(),_._lookAtVectorCache=new d.e(0,0,0),_._rotationAxisCache=new d.b,Object(T.c)([Object(m.o)("position")],_.prototype,"_position",void 0),Object(T.c)([Object(m.o)("rotation")],_.prototype,"_rotation",void 0),Object(T.c)([Object(m.l)("rotationQuaternion")],_.prototype,"_rotationQuaternion",void 0),Object(T.c)([Object(m.o)("scaling")],_.prototype,"_scaling",void 0),Object(T.c)([Object(m.c)("billboardMode")],_.prototype,"_billboardMode",void 0),Object(T.c)([Object(m.c)()],_.prototype,"scalingDeterminant",void 0),Object(T.c)([Object(m.c)("infiniteDistance")],_.prototype,"_infiniteDistance",void 0),Object(T.c)([Object(m.c)()],_.prototype,"ignoreNonUniformScaling",void 0),Object(T.c)([Object(m.c)()],_.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),_}(x.a)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(E,d,x,M,w,S){this.source=E,this.pointerX=d,this.pointerY=x,this.meshUnderPointer=M,this.sourceEvent=w,this.additionalData=S}return m.CreateNew=function(E,d,x){var M=E.getScene();return new m(E,M.pointerX,M.pointerY,M.meshUnderPointer||E,d,x)},m.CreateNewFromSprite=function(E,d,x,M){return new m(E,d.pointerX,d.pointerY,d.meshUnderPointer,x,M)},m.CreateNewFromScene=function(E,d){return new m(null,E.pointerX,E.pointerY,E.meshUnderPointer,d)},m.CreateNewFromPrimitive=function(E,d,x,M){return new m(E,d.x,d.y,null,x,M)},m}()},function(f,s,c){c.d(s,"a",function(){return S});var T=c(1),m=c(3),E=c(0),d=c(9),x=c(29),M=c(85),w=c(11),S=function(_){function O(R,I){var y=_.call(this,R,I)||this;return y.diffuse=new d.a(1,1,1),y.specular=new d.a(1,1,1),y.falloffType=O.FALLOFF_DEFAULT,y.intensity=1,y._range=Number.MAX_VALUE,y._inverseSquaredRange=0,y._photometricScale=1,y._intensityMode=O.INTENSITYMODE_AUTOMATIC,y._radius=1e-5,y.renderPriority=0,y._shadowEnabled=!0,y._excludeWithLayerMask=0,y._includeOnlyWithLayerMask=0,y._lightmapMode=0,y._excludedMeshesIds=new Array,y._includedOnlyMeshesIds=new Array,y._isLight=!0,y.getScene().addLight(y),y._uniformBuffer=new M.a(y.getScene().getEngine()),y._buildUniformLayout(),y.includedOnlyMeshes=new Array,y.excludedMeshes=new Array,y._resyncMeshes(),y}return Object(T.d)(O,_),Object.defineProperty(O.prototype,"range",{get:function(){return this._range},set:function(R){this._range=R,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(R){this._intensityMode=R,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"radius",{get:function(){return this._radius},set:function(R){this._radius=R,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(R){this._shadowEnabled!==R&&(this._shadowEnabled=R,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(R){this._includedOnlyMeshes=R,this._hookArrayForIncludedOnly(R)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(R){this._excludedMeshes=R,this._hookArrayForExcluded(R)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(R){this._excludeWithLayerMask=R,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(R){this._includeOnlyWithLayerMask=R,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(R){this._lightmapMode!==R&&(this._lightmapMode=R,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),O.prototype.transferTexturesToEffect=function(R,I){return this},O.prototype._bindLight=function(R,I,y,p,g){g===void 0&&(g=!1);var C=R.toString(),P=!1;if(!g||!this._uniformBuffer._alreadyBound){if(this._uniformBuffer.bindToEffect(y,"Light"+C),this._renderId!==I.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=I.getRenderId();var F=this.getScaledIntensity();this.transferToEffect(y,C),this.diffuse.scaleToRef(F,d.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",d.c.Color3[0],this.range,C),p&&(this.specular.scaleToRef(F,d.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",d.c.Color3[1],this.radius,C)),P=!0}if(this.transferTexturesToEffect(y,C),I.shadowsEnabled&&this.shadowEnabled){var U=this.getShadowGenerator();U&&(U.bindShadowLight(C,y),P=!0)}P&&this._uniformBuffer.update()}},O.prototype.getClassName=function(){return"Light"},O.prototype.toString=function(R){var I="Name: "+this.name;if(I+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var y=0;y<this.animations.length;y++)I+=", animation[0]: "+this.animations[y].toString(R);return I},O.prototype._syncParentEnabledState=function(){_.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},O.prototype.setEnabled=function(R){_.prototype.setEnabled.call(this,R),this._resyncMeshes()},O.prototype.getShadowGenerator=function(){return this._shadowGenerator},O.prototype.getAbsolutePosition=function(){return E.e.Zero()},O.prototype.canAffectMesh=function(R){return!R||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(R)===-1)&&!(this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(R)!==-1)&&(this.includeOnlyWithLayerMask===0||(this.includeOnlyWithLayerMask&R.layerMask)!=0)&&!(this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&R.layerMask)},O.CompareLightsPriority=function(R,I){return R.shadowEnabled!==I.shadowEnabled?(I.shadowEnabled?1:0)-(R.shadowEnabled?1:0):I.renderPriority-R.renderPriority},O.prototype.dispose=function(R,I){I===void 0&&(I=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var y=0,p=this.getScene().meshes;y<p.length;y++)p[y]._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),_.prototype.dispose.call(this,R,I)},O.prototype.getTypeID=function(){return 0},O.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},O.prototype.clone=function(R,I){I===void 0&&(I=null);var y=O.GetConstructorFromName(this.getTypeID(),R,this.getScene());if(!y)return null;var p=m.a.Clone(y,this);return I&&(p.parent=I),p.setEnabled(this.isEnabled()),p},O.prototype.serialize=function(){var R=m.a.Serialize(this);return R.type=this.getTypeID(),this.parent&&(R.parentId=this.parent.id),this.excludedMeshes.length>0&&(R.excludedMeshesIds=[],this.excludedMeshes.forEach(function(I){R.excludedMeshesIds.push(I.id)})),this.includedOnlyMeshes.length>0&&(R.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(I){R.includedOnlyMeshesIds.push(I.id)})),m.a.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R},O.GetConstructorFromName=function(R,I,y){var p=x.a.Construct("Light_Type_"+R,I,y);return p||null},O.Parse=function(R,I){var y=O.GetConstructorFromName(R.type,R.name,I);if(!y)return null;var p=m.a.Parse(y,R,I);if(R.excludedMeshesIds&&(p._excludedMeshesIds=R.excludedMeshesIds),R.includedOnlyMeshesIds&&(p._includedOnlyMeshesIds=R.includedOnlyMeshesIds),R.parentId&&(p._waitingParentId=R.parentId),R.falloffType!==void 0&&(p.falloffType=R.falloffType),R.lightmapMode!==void 0&&(p.lightmapMode=R.lightmapMode),R.animations){for(var g=0;g<R.animations.length;g++){var C=R.animations[g],P=w.a.GetClass("BABYLON.Animation");P&&p.animations.push(P.Parse(C))}x.a.ParseAnimationRanges(p,R,I)}return R.autoAnimate&&I.beginAnimation(p,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),p},O.prototype._hookArrayForExcluded=function(R){var I=this,y=R.push;R.push=function(){for(var P=[],F=0;F<arguments.length;F++)P[F]=arguments[F];for(var U=y.apply(R,P),B=0,L=P;B<L.length;B++){var z=L[B];z._resyncLightSource(I)}return U};var p=R.splice;R.splice=function(P,F){for(var U=p.apply(R,[P,F]),B=0,L=U;B<L.length;B++)L[B]._resyncLightSource(I);return U};for(var g=0,C=R;g<C.length;g++)C[g]._resyncLightSource(this)},O.prototype._hookArrayForIncludedOnly=function(R){var I=this,y=R.push;R.push=function(){for(var g=[],C=0;C<arguments.length;C++)g[C]=arguments[C];var P=y.apply(R,g);return I._resyncMeshes(),P};var p=R.splice;R.splice=function(g,C){var P=p.apply(R,[g,C]);return I._resyncMeshes(),P},this._resyncMeshes()},O.prototype._resyncMeshes=function(){for(var R=0,I=this.getScene().meshes;R<I.length;R++)I[R]._resyncLightSource(this)},O.prototype._markMeshesAsLightDirty=function(){for(var R=0,I=this.getScene().meshes;R<I.length;R++){var y=I[R];y.lightSources.indexOf(this)!==-1&&y._markSubMeshesAsLightDirty()}},O.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},O.prototype._getPhotometricScale=function(){var R=0,I=this.getTypeID(),y=this.intensityMode;switch(y===O.INTENSITYMODE_AUTOMATIC&&(y=I===O.LIGHTTYPEID_DIRECTIONALLIGHT?O.INTENSITYMODE_ILLUMINANCE:O.INTENSITYMODE_LUMINOUSINTENSITY),I){case O.LIGHTTYPEID_POINTLIGHT:case O.LIGHTTYPEID_SPOTLIGHT:switch(y){case O.INTENSITYMODE_LUMINOUSPOWER:R=1/(4*Math.PI);break;case O.INTENSITYMODE_LUMINOUSINTENSITY:R=1;break;case O.INTENSITYMODE_LUMINANCE:R=this.radius*this.radius}break;case O.LIGHTTYPEID_DIRECTIONALLIGHT:switch(y){case O.INTENSITYMODE_ILLUMINANCE:R=1;break;case O.INTENSITYMODE_LUMINANCE:var p=this.radius;p=Math.max(p,.001),R=2*Math.PI*(1-Math.cos(p))}break;case O.LIGHTTYPEID_HEMISPHERICLIGHT:R=1}return R},O.prototype._reorderLightsInScene=function(){var R=this.getScene();this._renderPriority!=0&&(R.requireLightSorting=!0),this.getScene().sortLightsByPriority()},O.FALLOFF_DEFAULT=0,O.FALLOFF_PHYSICAL=1,O.FALLOFF_GLTF=2,O.FALLOFF_STANDARD=3,O.LIGHTMAP_DEFAULT=0,O.LIGHTMAP_SPECULAR=1,O.LIGHTMAP_SHADOWSONLY=2,O.INTENSITYMODE_AUTOMATIC=0,O.INTENSITYMODE_LUMINOUSPOWER=1,O.INTENSITYMODE_LUMINOUSINTENSITY=2,O.INTENSITYMODE_ILLUMINANCE=3,O.INTENSITYMODE_LUMINANCE=4,O.LIGHTTYPEID_POINTLIGHT=0,O.LIGHTTYPEID_DIRECTIONALLIGHT=1,O.LIGHTTYPEID_SPOTLIGHT=2,O.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(T.c)([Object(m.e)()],O.prototype,"diffuse",void 0),Object(T.c)([Object(m.e)()],O.prototype,"specular",void 0),Object(T.c)([Object(m.c)()],O.prototype,"falloffType",void 0),Object(T.c)([Object(m.c)()],O.prototype,"intensity",void 0),Object(T.c)([Object(m.c)()],O.prototype,"range",null),Object(T.c)([Object(m.c)()],O.prototype,"intensityMode",null),Object(T.c)([Object(m.c)()],O.prototype,"radius",null),Object(T.c)([Object(m.c)()],O.prototype,"_renderPriority",void 0),Object(T.c)([Object(m.b)("_reorderLightsInScene")],O.prototype,"renderPriority",void 0),Object(T.c)([Object(m.c)("shadowEnabled")],O.prototype,"_shadowEnabled",void 0),Object(T.c)([Object(m.c)("excludeWithLayerMask")],O.prototype,"_excludeWithLayerMask",void 0),Object(T.c)([Object(m.c)("includeOnlyWithLayerMask")],O.prototype,"_includeOnlyWithLayerMask",void 0),Object(T.c)([Object(m.c)("lightmapMode")],O.prototype,"_lightmapMode",void 0),O}(x.a)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._xhr=typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}return m.prototype._injectCustomRequestHeaders=function(){for(var E in m.CustomRequestHeaders){var d=m.CustomRequestHeaders[E];d&&this._xhr.setRequestHeader(E,d)}},Object.defineProperty(m.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(E){this._xhr.onprogress=E},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(E){this._xhr.responseType=E},enumerable:!1,configurable:!0}),m.prototype.addEventListener=function(E,d,x){this._xhr.addEventListener(E,d,x)},m.prototype.removeEventListener=function(E,d,x){this._xhr.removeEventListener(E,d,x)},m.prototype.abort=function(){this._xhr.abort()},m.prototype.send=function(E){m.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(E)},m.prototype.open=function(E,d){for(var x=0,M=m.CustomRequestModifiers;x<M.length;x++)(0,M[x])(this._xhr,d);return d=(d=d.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(E,d,!0)},m.prototype.setRequestHeader=function(E,d){this._xhr.setRequestHeader(E,d)},m.prototype.getResponseHeader=function(E){return this._xhr.getResponseHeader(E)},m.CustomRequestHeaders={},m.CustomRequestModifiers=new Array,m}()},function(f,s,c){c.d(s,"e",function(){return m}),c.d(s,"a",function(){return E}),c.d(s,"d",function(){return d}),c.d(s,"c",function(){return x}),c.d(s,"b",function(){return M});var T=c(1),m=function(){function w(S,_){this.type=S,this.jointData=_,_.nativeParams=_.nativeParams||{}}return Object.defineProperty(w.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(S){this._physicsJoint,this._physicsJoint=S},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"physicsPlugin",{set:function(S){this._physicsPlugin=S},enumerable:!1,configurable:!0}),w.prototype.executeNativeFunction=function(S){S(this._physicsPlugin.world,this._physicsJoint)},w.DistanceJoint=0,w.HingeJoint=1,w.BallAndSocketJoint=2,w.WheelJoint=3,w.SliderJoint=4,w.PrismaticJoint=5,w.UniversalJoint=6,w.Hinge2Joint=w.WheelJoint,w.PointToPointJoint=8,w.SpringJoint=9,w.LockJoint=10,w}(),E=function(w){function S(_){return w.call(this,m.DistanceJoint,_)||this}return Object(T.d)(S,w),S.prototype.updateDistance=function(_,O){this._physicsPlugin.updateDistanceJoint(this,_,O)},S}(m),d=function(w){function S(_,O){return w.call(this,_,O)||this}return Object(T.d)(S,w),S.prototype.setMotor=function(_,O){this._physicsPlugin.setMotor(this,_||0,O)},S.prototype.setLimit=function(_,O){this._physicsPlugin.setLimit(this,_,O)},S}(m),x=function(w){function S(_){return w.call(this,m.HingeJoint,_)||this}return Object(T.d)(S,w),S.prototype.setMotor=function(_,O){this._physicsPlugin.setMotor(this,_||0,O)},S.prototype.setLimit=function(_,O){this._physicsPlugin.setLimit(this,_,O)},S}(d),M=function(w){function S(_){return w.call(this,m.Hinge2Joint,_)||this}return Object(T.d)(S,w),S.prototype.setMotor=function(_,O,R){R===void 0&&(R=0),this._physicsPlugin.setMotor(this,_||0,O,R)},S.prototype.setLimit=function(_,O,R){R===void 0&&(R=0),this._physicsPlugin.setLimit(this,_,O,R)},S}(d)},function(f,s,c){c.d(s,"a",function(){return x});var T=c(0),m=c(7),E=c(36),d=c(18),x=function(){function M(w){var S=this;w===void 0&&(w=E.a.DefaultUtilityLayer),this.gizmoLayer=w,this._attachedMesh=null,this._attachedNode=null,this._scaleRatio=1,this._isHovered=!1,this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempQuaternion=new T.b(0,0,0,1),this._tempVector=new T.e,this._tempVector2=new T.e,this._tempMatrix1=new T.a,this._tempMatrix2=new T.a,this._rightHandtoLeftHandMatrix=T.a.RotationY(Math.PI),this._rootMesh=new m.a("gizmoRootNode",w.utilityLayerScene),this._rootMesh.rotationQuaternion=T.b.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){S._update()})}return Object.defineProperty(M.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(w){this._scaleRatio=w},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"isHovered",{get:function(){return this._isHovered},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(w){this._attachedMesh=w,w&&(this._attachedNode=w),this._rootMesh.setEnabled(!!w),this._attachedNodeChanged(w)},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(w){this._attachedNode=w,this._attachedMesh=null,this._rootMesh.setEnabled(!!w),this._attachedNodeChanged(w)},enumerable:!1,configurable:!0}),M.prototype.setCustomMesh=function(w){if(w.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(S){S.dispose()}),w.parent=this._rootMesh,this._customMeshSet=!0},Object.defineProperty(M.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(w){this._updateGizmoRotationToMatchAttachedMesh=w},enumerable:!1,configurable:!0}),M.prototype._attachedNodeChanged=function(w){},M.prototype._update=function(){if(this.attachedNode){var w=this.attachedNode;if(this.attachedMesh&&(w=this.attachedMesh._effectiveMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh){var S=w.getWorldMatrix().getRow(3),_=S?S.toVector3():new T.e(0,0,0);this._rootMesh.position.copyFrom(_)}if(this.updateGizmoRotationToMatchAttachedMesh?w.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){var O=this.gizmoLayer.utilityLayerScene.activeCamera,R=O.globalPosition;O.devicePosition&&(R=O.devicePosition),this._rootMesh.position.subtractToRef(R,this._tempVector);var I=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(I,I,I),w._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},M.prototype._matrixChanged=function(){if(this._attachedNode){if(this._attachedNode._isCamera){var w,S,_=this._attachedNode;if(_.parent){var O=this._tempMatrix2;_.parent._worldMatrix.invertToRef(O),this._attachedNode._worldMatrix.multiplyToRef(O,this._tempMatrix1),w=this._tempMatrix1}else w=this._attachedNode._worldMatrix;if(_.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(w,this._tempMatrix2),S=this._tempMatrix2):S=w,S.decompose(this._tempVector2,this._tempQuaternion,this._tempVector),this._attachedNode.getClassName()==="FreeCamera"||this._attachedNode.getClassName()==="FlyCamera"||this._attachedNode.getClassName()==="ArcFollowCamera"||this._attachedNode.getClassName()==="TargetCamera"||this._attachedNode.getClassName()==="TouchCamera"||this._attachedNode.getClassName()==="UniversalCamera"){var R=this._attachedNode;R.rotation=this._tempQuaternion.toEulerAngles(),R.rotationQuaternion&&R.rotationQuaternion.copyFrom(this._tempQuaternion)}_.position.copyFrom(this._tempVector)}else if(this._attachedNode._isMesh||this._attachedNode.getClassName()==="AbstractMesh"||this._attachedNode.getClassName()==="TransformNode"||this._attachedNode.getClassName()==="InstancedMesh"){var I=this._attachedNode;if(I.parent){O=this._tempMatrix1;var y=this._tempMatrix2;I.parent.getWorldMatrix().invertToRef(O),this._attachedNode.getWorldMatrix().multiplyToRef(O,y),y.decompose(I.scaling,this._tempQuaternion,I.position)}else this._attachedNode._worldMatrix.decompose(I.scaling,this._tempQuaternion,I.position);I.billboardMode||(I.rotationQuaternion?I.rotationQuaternion.copyFrom(this._tempQuaternion):I.rotation=this._tempQuaternion.toEulerAngles())}else if(this._attachedNode.getClassName()==="Bone"){var p=this._attachedNode,g=p.getParent();if(g){var C=this._tempMatrix1,P=this._tempMatrix2;g.getWorldMatrix().invertToRef(C),p.getWorldMatrix().multiplyToRef(C,P),p.getLocalMatrix().copyFrom(P)}else p.getLocalMatrix().copyFrom(p.getWorldMatrix());p.markAsDirty()}}},M.GizmoAxisPointerObserver=function(w,S){var _=!1;return w.utilityLayerScene.onPointerObservable.add(function(O){var R,I;if(O.pickInfo){if(O.type===d.a.POINTERMOVE){if(_)return;S.forEach(function(y){var p,g;if(y.colliderMeshes&&y.gizmoMeshes){var C=((p=y.colliderMeshes)===null||p===void 0?void 0:p.indexOf((g=O==null?void 0:O.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||y.active?y.hoverMaterial:y.material;y.gizmoMeshes.forEach(function(P){P.material=C,P.color&&(P.color=C.diffuseColor)})}})}O.type===d.a.POINTERDOWN&&S.has((R=O.pickInfo.pickedMesh)===null||R===void 0?void 0:R.parent)&&(_=!0,S.get((I=O.pickInfo.pickedMesh)===null||I===void 0?void 0:I.parent).active=!0,S.forEach(function(y){var p,g,C=((p=y.colliderMeshes)===null||p===void 0?void 0:p.indexOf((g=O==null?void 0:O.pickInfo)===null||g===void 0?void 0:g.pickedMesh))!=-1||y.active?y.hoverMaterial:y.disableMaterial;y.gizmoMeshes.forEach(function(P){P.material=C,P.color&&(P.color=C.diffuseColor)})})),O.type===d.a.POINTERUP&&S.forEach(function(y){y.active=!1,_=!1,y.gizmoMeshes.forEach(function(p){p.material=y.material,p.color&&(p.color=y.material.diffuseColor)})})}})},M.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},M}()},function(f,s,c){c.d(s,"a",function(){return _});var T=c(1),m=c(3),E=c(6),d=c(0),x=c(22),M=c(2),w=c(120),S=(c(56),c(77)),_=function(O){function R(I){var y=O.call(this,null)||this;return y.metadata=null,y.reservedDataStore=null,y._hasAlpha=!1,y.getAlphaFromRGB=!1,y.level=1,y.coordinatesIndex=0,y._coordinatesMode=M.a.TEXTURE_EXPLICIT_MODE,y.wrapR=M.a.TEXTURE_WRAP_ADDRESSMODE,y.anisotropicFilteringLevel=R.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,y._isCube=!1,y._gammaSpace=!0,y.invertZ=!1,y.lodLevelInAlpha=!1,y.isRenderTarget=!1,y._prefiltered=!1,y.animations=new Array,y.onDisposeObservable=new E.c,y._onDisposeObserver=null,y._scene=null,y._texture=null,y._uid=null,I?R._isScene(I)?y._scene=I:y._engine=I:y._scene=x.a.LastCreatedScene,y._scene&&(y.uniqueId=y._scene.getUniqueId(),y._scene.addTexture(y),y._engine=y._scene.getEngine()),y._uid=null,y}return Object(T.d)(R,O),Object.defineProperty(R.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(I){this._hasAlpha!==I&&(this._hasAlpha=I,this._scene&&this._scene.markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag|M.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(I){this._coordinatesMode!==I&&(this._coordinatesMode=I,this._scene&&this._scene.markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"wrapU",{get:function(){return this._wrapU},set:function(I){this._wrapU=I},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"wrapV",{get:function(){return this._wrapV},set:function(I){this._wrapV=I},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(I){this._texture?this._texture.isCube=I:this._isCube=I},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(I){this._texture&&(this._texture.is3D=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(I){this._texture&&(this._texture.is2DArray=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"gammaSpace",{get:function(){return this._texture?(this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace):this._gammaSpace},set:function(I){if(this._texture){if(this._texture._gammaSpace===I)return;this._texture._gammaSpace=I}else{if(this._gammaSpace===I)return;this._gammaSpace=I}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(I){this._texture&&(this._texture._isRGBD=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(I){this._texture&&(this._texture._lodGenerationOffset=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(I){this._texture&&(this._texture._lodGenerationScale=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(I){this._texture&&(this._texture._linearSpecularLOD=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(I){this._texture&&(this._texture._irradianceTexture=I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"uid",{get:function(){return this._uid||(this._uid=w.a.RandomId()),this._uid},enumerable:!1,configurable:!0}),R.prototype.toString=function(){return this.name},R.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(R.prototype,"onDispose",{set:function(I){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(I)},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),R.prototype.getScene=function(){return this._scene},R.prototype._getEngine=function(){return this._engine},R.prototype.checkTransformsAreIdentical=function(I){return I!==null},R.prototype.getTextureMatrix=function(){return d.a.IdentityReadOnly},R.prototype.getReflectionTextureMatrix=function(){return d.a.IdentityReadOnly},R.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},R.prototype.scale=function(I){},Object.defineProperty(R.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),R.prototype._getFromCache=function(I,y,p,g){var C=this._getEngine();if(!C)return null;for(var P=C.getLoadedTexturesCache(),F=0;F<P.length;F++){var U=P[F];if(!(g!==void 0&&g!==U.invertY||U.url!==I||U.generateMipMaps!==!y||p&&p!==U.samplingMode))return U.incrementReferences(),U}return null},R.prototype._rebuild=function(){},R.prototype.clone=function(){return null},Object.defineProperty(R.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:M.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:M.a.TEXTUREFORMAT_RGBA},enumerable:!1,configurable:!0}),R.prototype._markAllSubMeshesAsTexturesDirty=function(){var I=this.getScene();I&&I.markAllMaterialsAsDirty(M.a.MATERIAL_TextureDirtyFlag)},R.prototype.readPixels=function(I,y,p){if(I===void 0&&(I=0),y===void 0&&(y=0),p===void 0&&(p=null),!this._texture)return null;var g=this.getSize(),C=g.width,P=g.height,F=this._getEngine();if(!F)return null;y!=0&&(C/=Math.pow(2,y),P/=Math.pow(2,y),C=Math.round(C),P=Math.round(P));try{return this._texture.isCube?F._readTexturePixels(this._texture,C,P,I,y,p):F._readTexturePixels(this._texture,C,P,-1,y,p)}catch(U){return null}},Object.defineProperty(R.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(R.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),R.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var I=this._scene.textures.indexOf(this);I>=0&&this._scene.textures.splice(I,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),O.prototype.dispose.call(this)},R.prototype.serialize=function(){if(!this.name)return null;var I=m.a.Serialize(this);return m.a.AppendSerializedAnimations(this,I),I},R.WhenAllReady=function(I,y){var p=I.length;if(p!==0)for(var g=0;g<I.length;g++){var C=I[g];if(C.isReady())--p==0&&y();else{var P=C.onLoadObservable;P&&P.addOnce(function(){--p==0&&y()})}}else y()},R._isScene=function(I){return I.getClassName()==="Scene"},R.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(T.c)([Object(m.c)()],R.prototype,"uniqueId",void 0),Object(T.c)([Object(m.c)()],R.prototype,"name",void 0),Object(T.c)([Object(m.c)()],R.prototype,"metadata",void 0),Object(T.c)([Object(m.c)("hasAlpha")],R.prototype,"_hasAlpha",void 0),Object(T.c)([Object(m.c)()],R.prototype,"getAlphaFromRGB",void 0),Object(T.c)([Object(m.c)()],R.prototype,"level",void 0),Object(T.c)([Object(m.c)()],R.prototype,"coordinatesIndex",void 0),Object(T.c)([Object(m.c)("coordinatesMode")],R.prototype,"_coordinatesMode",void 0),Object(T.c)([Object(m.c)()],R.prototype,"wrapU",null),Object(T.c)([Object(m.c)()],R.prototype,"wrapV",null),Object(T.c)([Object(m.c)()],R.prototype,"wrapR",void 0),Object(T.c)([Object(m.c)()],R.prototype,"anisotropicFilteringLevel",void 0),Object(T.c)([Object(m.c)()],R.prototype,"isCube",null),Object(T.c)([Object(m.c)()],R.prototype,"is3D",null),Object(T.c)([Object(m.c)()],R.prototype,"is2DArray",null),Object(T.c)([Object(m.c)()],R.prototype,"gammaSpace",null),Object(T.c)([Object(m.c)()],R.prototype,"invertZ",void 0),Object(T.c)([Object(m.c)()],R.prototype,"lodLevelInAlpha",void 0),Object(T.c)([Object(m.c)()],R.prototype,"lodGenerationOffset",null),Object(T.c)([Object(m.c)()],R.prototype,"lodGenerationScale",null),Object(T.c)([Object(m.c)()],R.prototype,"linearSpecularLOD",null),Object(T.c)([Object(m.m)()],R.prototype,"irradianceTexture",null),Object(T.c)([Object(m.c)()],R.prototype,"isRenderTarget",void 0),R}(function(){function O(R){this._wrapU=M.a.TEXTURE_WRAP_ADDRESSMODE,this._wrapV=M.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=M.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.delayLoadState=M.a.DELAYLOADSTATE_NONE,this._texture=null,this._engine=null,this._cachedSize=S.a.Zero(),this._cachedBaseSize=S.a.Zero(),this._texture=R,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(O.prototype,"wrapU",{get:function(){return this._wrapU},set:function(R){this._wrapU=R},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"wrapV",{get:function(){return this._wrapV},set:function(R){this._wrapV=R},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(R){this._texture&&(this._texture.isCube=R)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(R){this._texture&&(this._texture.is3D=R)},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(R){this._texture&&(this._texture.is2DArray=R)},enumerable:!1,configurable:!0}),O.prototype.getClassName=function(){return"ThinTexture"},O.prototype.isReady=function(){return this.delayLoadState===M.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},O.prototype.delayLoad=function(){},O.prototype.getInternalTexture=function(){return this._texture},O.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},O.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},O.prototype.updateSamplingMode=function(R){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(R,this._texture)},O.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},O.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},O}())},function(f,s,c){c.d(s,"a",function(){return w});var T=c(0),m=c(9),E=c(7),d=c(16),x=c(20),M=c(23);d.a.CreateCylinder=function(S){var _=S.height||2,O=S.diameterTop===0?0:S.diameterTop||S.diameter||1,R=S.diameterBottom===0?0:S.diameterBottom||S.diameter||1;O=O||1e-5,R=R||1e-5;var I,y=S.tessellation||24,p=S.subdivisions||1,g=!!S.hasRings,C=!!S.enclose,P=S.cap===0?0:S.cap||E.a.CAP_ALL,F=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1,U=S.sideOrientation===0?0:S.sideOrientation||d.a.DEFAULTSIDE,B=S.faceUV||new Array(3),L=S.faceColors,z=2+(1+(F!==1&&C?2:0))*(g?p:1);for(I=0;I<z;I++)L&&L[I]===void 0&&(L[I]=new m.b(1,1,1,1));for(I=0;I<z;I++)B&&B[I]===void 0&&(B[I]=new T.f(0,0,1,1));var X,G,ee,$,fe,me,ve=new Array,be=new Array,ie=new Array,se=new Array,V=new Array,K=2*Math.PI*F/y,Z=(R-O)/2/_,le=T.e.Zero(),re=T.e.Zero(),Q=T.e.Zero(),W=T.e.Zero(),Y=T.e.Zero(),q=M.a.Y,ae=1,pe=1,De=0,de=0;for($=0;$<=p;$++)for(ee=((G=$/p)*(O-R)+R)/2,ae=g&&$!==0&&$!==p?2:1,me=0;me<ae;me++){for(g&&(pe+=me),C&&(pe+=2*me),fe=0;fe<=y;fe++)X=fe*K,le.x=Math.cos(-X)*ee,le.y=-_/2+G*_,le.z=Math.sin(-X)*ee,O===0&&$===p?(re.x=ie[ie.length-3*(y+1)],re.y=ie[ie.length-3*(y+1)+1],re.z=ie[ie.length-3*(y+1)+2]):(re.x=le.x,re.z=le.z,re.y=Math.sqrt(re.x*re.x+re.z*re.z)*Z,re.normalize()),fe===0&&(Q.copyFrom(le),W.copyFrom(re)),be.push(le.x,le.y,le.z),ie.push(re.x,re.y,re.z),de=g?De!==pe?B[pe].y:B[pe].w:B[pe].y+(B[pe].w-B[pe].y)*G,se.push(B[pe].x+(B[pe].z-B[pe].x)*fe/y,de),L&&V.push(L[pe].r,L[pe].g,L[pe].b,L[pe].a);F!==1&&C&&(be.push(le.x,le.y,le.z),be.push(0,le.y,0),be.push(0,le.y,0),be.push(Q.x,Q.y,Q.z),T.e.CrossToRef(q,re,Y),Y.normalize(),ie.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),T.e.CrossToRef(W,q,Y),Y.normalize(),ie.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),de=g?De!==pe?B[pe+1].y:B[pe+1].w:B[pe+1].y+(B[pe+1].w-B[pe+1].y)*G,se.push(B[pe+1].x,de),se.push(B[pe+1].z,de),de=g?De!==pe?B[pe+2].y:B[pe+2].w:B[pe+2].y+(B[pe+2].w-B[pe+2].y)*G,se.push(B[pe+2].x,de),se.push(B[pe+2].z,de),L&&(V.push(L[pe+1].r,L[pe+1].g,L[pe+1].b,L[pe+1].a),V.push(L[pe+1].r,L[pe+1].g,L[pe+1].b,L[pe+1].a),V.push(L[pe+2].r,L[pe+2].g,L[pe+2].b,L[pe+2].a),V.push(L[pe+2].r,L[pe+2].g,L[pe+2].b,L[pe+2].a))),De!==pe&&(De=pe)}var ge=F!==1&&C?y+4:y;for($=0,pe=0;pe<p;pe++){var ne=0,Te=0,we=0,Se=0;for(fe=0;fe<y;fe++)ne=$*(ge+1)+fe,Te=($+1)*(ge+1)+fe,we=$*(ge+1)+(fe+1),Se=($+1)*(ge+1)+(fe+1),ve.push(ne,Te,we),ve.push(Se,we,Te);F!==1&&C&&(ve.push(ne+2,Te+2,we+2),ve.push(Se+2,we+2,Te+2),ve.push(ne+4,Te+4,we+4),ve.push(Se+4,we+4,Te+4)),$=g?$+2:$+1}var Ge=function(nt){var et=nt?O/2:R/2;if(et!==0){var Ze,ht,gt,Rt=nt?B[z-1]:B[0],zt=null;L&&(zt=nt?L[z-1]:L[0]);var un=be.length/3,Br=nt?_/2:-_/2,lr=new T.e(0,Br,0);be.push(lr.x,lr.y,lr.z),ie.push(0,nt?1:-1,0),se.push(Rt.x+.5*(Rt.z-Rt.x),Rt.y+.5*(Rt.w-Rt.y)),zt&&V.push(zt.r,zt.g,zt.b,zt.a);var Ur=new T.d(.5,.5);for(gt=0;gt<=y;gt++){Ze=2*Math.PI*gt*F/y;var Qr=Math.cos(-Ze),qr=Math.sin(-Ze);ht=new T.e(Qr*et,Br,qr*et);var Xi=new T.d(Qr*Ur.x+.5,qr*Ur.y+.5);be.push(ht.x,ht.y,ht.z),ie.push(0,nt?1:-1,0),se.push(Rt.x+(Rt.z-Rt.x)*Xi.x,Rt.y+(Rt.w-Rt.y)*Xi.y),zt&&V.push(zt.r,zt.g,zt.b,zt.a)}for(gt=0;gt<y;gt++)nt?(ve.push(un),ve.push(un+(gt+2)),ve.push(un+(gt+1))):(ve.push(un),ve.push(un+(gt+1)),ve.push(un+(gt+2)))}};P!==E.a.CAP_START&&P!==E.a.CAP_ALL||Ge(!1),P!==E.a.CAP_END&&P!==E.a.CAP_ALL||Ge(!0),d.a._ComputeSides(U,be,ve,ie,se,S.frontUVs,S.backUVs);var $e=new d.a;return $e.indices=ve,$e.positions=be,$e.normals=ie,$e.uvs=se,L&&($e.colors=V),$e},E.a.CreateCylinder=function(S,_,O,R,I,y,p,g,C){p!==void 0&&p instanceof x.a||(p!==void 0&&(C=g||E.a.DEFAULTSIDE,g=p),p=y,y=1);var P={height:_,diameterTop:O,diameterBottom:R,tessellation:I,subdivisions:y,sideOrientation:C,updatable:g};return w.CreateCylinder(S,P,p)};var w=function(){function S(){}return S.CreateCylinder=function(_,O,R){var I=new E.a(_,R);return O.sideOrientation=E.a._GetDefaultSideOrientation(O.sideOrientation),I._originalBuilderSideOrientation=O.sideOrientation,d.a.CreateCylinder(O).applyToMesh(I,O.updatable),I},S}()},function(f,s,c){c.d(s,"a",function(){return E});var T=c(0),m=c(4),E=function(){function d(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return d.prototype.getNormal=function(x,M){if(x===void 0&&(x=!1),M===void 0&&(M=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.NormalKind))return null;var w,S=this.pickedMesh.getIndices();if(!S)return null;if(M){var _=this.pickedMesh.getVerticesData(m.b.NormalKind),O=T.e.FromArray(_,3*S[3*this.faceId]),R=T.e.FromArray(_,3*S[3*this.faceId+1]),I=T.e.FromArray(_,3*S[3*this.faceId+2]);O=O.scale(this.bu),R=R.scale(this.bv),I=I.scale(1-this.bu-this.bv),w=new T.e(O.x+R.x+I.x,O.y+R.y+I.y,O.z+R.z+I.z)}else{var y=this.pickedMesh.getVerticesData(m.b.PositionKind),p=T.e.FromArray(y,3*S[3*this.faceId]),g=T.e.FromArray(y,3*S[3*this.faceId+1]),C=T.e.FromArray(y,3*S[3*this.faceId+2]),P=p.subtract(g),F=C.subtract(g);w=T.e.Cross(P,F)}if(x){var U=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(T.c.Matrix[0].copyFrom(U),(U=T.c.Matrix[0]).setTranslationFromFloats(0,0,0),U.invert(),U.transposeToRef(T.c.Matrix[1]),U=T.c.Matrix[1]),w=T.e.TransformNormal(w,U)}return w.normalize(),w},d.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(m.b.UVKind))return null;var x=this.pickedMesh.getIndices();if(!x)return null;var M=this.pickedMesh.getVerticesData(m.b.UVKind);if(!M)return null;var w=T.d.FromArray(M,2*x[3*this.faceId]),S=T.d.FromArray(M,2*x[3*this.faceId+1]),_=T.d.FromArray(M,2*x[3*this.faceId+2]);return w=w.scale(this.bu),S=S.scale(this.bv),_=_.scale(1-this.bu-this.bv),new T.d(w.x+S.x+_.x,w.y+S.y+_.y)},d}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(57),m=function(){function E(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(E.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),E.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},E.prototype.addCount=function(d,x){E.Enabled&&(this._current+=d,x&&this._fetchResult())},E.prototype.beginMonitoring=function(){E.Enabled&&(this._startMonitoringTime=T.a.Now)},E.prototype.endMonitoring=function(d){if(d===void 0&&(d=!0),E.Enabled){d&&this.fetchNewFrame();var x=T.a.Now;this._current=x-this._startMonitoringTime,d&&this._fetchResult()}},E.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var d=T.a.Now;d-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=d,this._lastSecAccumulated=0,this._lastSecValueCount=0)},E.Enabled=!0,E}()},function(f,s,c){c.d(s,"b",function(){return R}),c.d(s,"d",function(){return I}),c.d(s,"c",function(){return y}),c.d(s,"a",function(){return p});var T=c(1),m=c(49),E=c(38),d=c(6),x=c(83),M=c(140),w=function(g){function C(){return g!==null&&g.apply(this,arguments)||this}return Object(T.d)(C,g),C._setPrototypeOf=Object.setPrototypeOf||function(P,F){return P.__proto__=F,P},C}(Error),S=c(34),_=c(26),O=c(128),R=function(g){function C(P,F){var U=g.call(this,P)||this;return U.name="LoadFileError",w._setPrototypeOf(U,C.prototype),F instanceof m.a?U.request=F:U.file=F,U}return Object(T.d)(C,g),C}(w),I=function(g){function C(P,F){var U=g.call(this,P)||this;return U.request=F,U.name="RequestFileError",w._setPrototypeOf(U,C.prototype),U}return Object(T.d)(C,g),C}(w),y=function(g){function C(P,F){var U=g.call(this,P)||this;return U.file=F,U.name="ReadFileError",w._setPrototypeOf(U,C.prototype),U}return Object(T.d)(C,g),C}(w),p=function(){function g(){}return g._CleanUrl=function(C){return C=C.replace(/#/gm,"%23")},g.SetCorsBehavior=function(C,P){if((!C||C.indexOf("data:")!==0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||this.CorsBehavior instanceof String)P.crossOrigin=g.CorsBehavior;else{var F=g.CorsBehavior(C);F&&(P.crossOrigin=F)}},g.LoadImage=function(C,P,F,U,B){var L;B===void 0&&(B="");var z=!1;if(C instanceof ArrayBuffer||ArrayBuffer.isView(C)?typeof Blob!="undefined"?(L=URL.createObjectURL(new Blob([C],{type:B})),z=!0):L="data:"+B+";base64,"+S.a.EncodeArrayBufferToBase64(C):C instanceof Blob?(L=URL.createObjectURL(C),z=!0):(L=g._CleanUrl(C),L=g.PreprocessUrl(C)),typeof Image=="undefined")return g.LoadFile(L,function(ve){createImageBitmap(new Blob([ve],{type:B})).then(function(be){P(be),z&&URL.revokeObjectURL(L)}).catch(function(be){F&&F("Error while trying to load image: "+C,be)})},void 0,U||void 0,!0,function(ve,be){F&&F("Error while trying to load image: "+C,be)}),null;var X=new Image;g.SetCorsBehavior(L,X);var G=function(){X.removeEventListener("load",G),X.removeEventListener("error",ee),P(X),z&&X.src&&URL.revokeObjectURL(X.src)},ee=function(ve){if(X.removeEventListener("load",G),X.removeEventListener("error",ee),F){var be=C.toString();F("Error while trying to load image: "+(be.length<32?be:be.slice(0,32)+"..."),ve)}z&&X.src&&URL.revokeObjectURL(X.src)};X.addEventListener("load",G),X.addEventListener("error",ee);var $=function(){X.src=L};if(L.substr(0,5)!=="data:"&&U&&U.enableTexturesOffline)U.open(function(){U&&U.loadImage(L,X)},$);else{if(L.indexOf("file:")!==-1){var fe=decodeURIComponent(L.substring(5).toLowerCase());if(x.a.FilesToLoad[fe]){try{var me;try{me=URL.createObjectURL(x.a.FilesToLoad[fe])}catch(ve){me=URL.createObjectURL(x.a.FilesToLoad[fe])}X.src=me,z=!0}catch(ve){X.src=""}return X}}$()}return X},g.ReadFile=function(C,P,F,U,B){var L=new FileReader,z={onCompleteObservable:new d.c,abort:function(){return L.abort()}};return L.onloadend=function(X){return z.onCompleteObservable.notifyObservers(z)},B&&(L.onerror=function(X){B(new y("Unable to read "+C.name,C))}),L.onload=function(X){P(X.target.result)},F&&(L.onprogress=F),U?L.readAsArrayBuffer(C):L.readAsText(C),z},g.LoadFile=function(C,P,F,U,B,L){if(C.indexOf("file:")!==-1){var z=decodeURIComponent(C.substring(5).toLowerCase());z.indexOf("./")===0&&(z=z.substring(2));var X=x.a.FilesToLoad[z];if(X)return g.ReadFile(X,P,F,B,L?function(G){return L(void 0,new R(G.message,G.file))}:void 0)}return g.RequestFile(C,function(G,ee){P(G,ee?ee.responseURL:void 0)},F,U,B,L?function(G){L(G.request,new R(G.message,G.request))}:void 0)},g.RequestFile=function(C,P,F,U,B,L,z){C=g._CleanUrl(C),C=g.PreprocessUrl(C);var X=g.BaseUrl+C,G=!1,ee={onCompleteObservable:new d.c,abort:function(){return G=!0}},$=function(){var me=new m.a,ve=null;ee.abort=function(){G=!0,me.readyState!==(XMLHttpRequest.DONE||4)&&me.abort(),ve!==null&&(clearTimeout(ve),ve=null)};var be=function(ie){me.open("GET",X),z&&z(me),B&&(me.responseType="arraybuffer"),F&&me.addEventListener("progress",F);var se=function(){me.removeEventListener("loadend",se),ee.onCompleteObservable.notifyObservers(ee),ee.onCompleteObservable.clear()};me.addEventListener("loadend",se);var V=function(){if(!G&&me.readyState===(XMLHttpRequest.DONE||4)){if(me.removeEventListener("readystatechange",V),me.status>=200&&me.status<300||me.status===0&&(!E.a.IsWindowObjectExist()||g.IsFileURL()))return void P(B?me.response:me.responseText,me);var K=g.DefaultRetryStrategy;if(K){var Z=K(X,me,ie);if(Z!==-1)return me.removeEventListener("loadend",se),me=new m.a,void(ve=setTimeout(function(){return be(ie+1)},Z))}var le=new I("Error status: "+me.status+" "+me.statusText+" - Unable to load "+X,me);L&&L(le)}};me.addEventListener("readystatechange",V),me.send()};be(0)};if(U&&U.enableSceneOffline){var fe=function(me){me&&me.status>400?L&&L(me):$()};U.open(function(){U&&U.loadFile(g.BaseUrl+C,function(me){G||P(me),ee.onCompleteObservable.notifyObservers(ee)},F?function(me){G||F(me)}:void 0,fe,B)},fe)}else $();return ee},g.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},g.DefaultRetryStrategy=M.a.ExponentialBackoff(),g.BaseUrl="",g.CorsBehavior="anonymous",g.PreprocessUrl=function(C){return C},g}();_.a._FileToolsLoadImage=p.LoadImage.bind(p),_.a._FileToolsLoadFile=p.LoadFile.bind(p),O.a._FileToolsLoadFile=p.LoadFile.bind(p)},function(f,s,c){c.d(s,"a",function(){return m});var T=c(38),m=function(){function E(){}return Object.defineProperty(E,"Now",{get:function(){return T.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),E}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(E,d,x,M){this.x=E,this.y=d,this.width=x,this.height=M}return m.prototype.toGlobal=function(E,d){return new m(this.x*E,this.y*d,this.width*E,this.height*d)},m.prototype.toGlobalToRef=function(E,d,x){return x.x=this.x*E,x.y=this.y*d,x.width=this.width*E,x.height=this.height*d,this},m.prototype.clone=function(){return new m(this.x,this.y,this.width,this.height)},m}()},function(f,s,c){var T="helperFunctions",m=`const float PI=3.1415926535897932384626433832795;
const float HALF_MIN=5.96046448e-08;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float toLinearSpace(float color)
{
return pow(color,LinearEncodePowerApprox);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec4 toLinearSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
vec4 toGammaSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"a",function(){return m});var T=c(0),m=function(){function E(){}return E._RemoveAndStorePivotPoint=function(d){d&&E._PivotCached===0&&(d.getPivotPointToRef(E._OldPivotPoint),E._PivotPostMultiplyPivotMatrix=d._postMultiplyPivotMatrix,E._OldPivotPoint.equalsToFloats(0,0,0)||(d.setPivotMatrix(T.a.IdentityReadOnly),E._OldPivotPoint.subtractToRef(d.getPivotPoint(),E._PivotTranslation),E._PivotTmpVector.copyFromFloats(1,1,1),E._PivotTmpVector.subtractInPlace(d.scaling),E._PivotTmpVector.multiplyInPlace(E._PivotTranslation),d.position.addInPlace(E._PivotTmpVector))),E._PivotCached++},E._RestorePivotPoint=function(d){d&&!E._OldPivotPoint.equalsToFloats(0,0,0)&&E._PivotCached===1&&(d.setPivotPoint(E._OldPivotPoint),d._postMultiplyPivotMatrix=E._PivotPostMultiplyPivotMatrix,E._PivotTmpVector.copyFromFloats(1,1,1),E._PivotTmpVector.subtractInPlace(d.scaling),E._PivotTmpVector.multiplyInPlace(E._PivotTranslation),d.position.subtractInPlace(E._PivotTmpVector)),this._PivotCached--},E._PivotCached=0,E._OldPivotPoint=new T.e,E._PivotTranslation=new T.e,E._PivotTmpVector=new T.e,E._PivotPostMultiplyPivotMatrix=!1,E}()},function(f,s,c){c.d(s,"a",function(){return M});var T=c(4),m=c(114),E=c(43),d=c(2),x=c(101),M=function(){function w(S,_,O,R,I,y,p,g,C){g===void 0&&(g=!0),C===void 0&&(C=!0),this.materialIndex=S,this.verticesStart=_,this.verticesCount=O,this.indexStart=R,this.indexCount=I,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=y,this._renderingMesh=p||y,C&&y.subMeshes.push(this),this._trianglePlanes=[],this._id=y.subMeshes.length-1,g&&(this.refreshBoundingInfo(),y.computeWorldMatrix(!0))}return Object.defineProperty(w.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(S){this._materialDefines=S},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"effect",{get:function(){var S;return(S=this._effectOverride)!==null&&S!==void 0?S:this._materialEffect},enumerable:!1,configurable:!0}),w.prototype.setEffect=function(S,_){_===void 0&&(_=null),this._materialEffect!==S?(this._materialDefines=_,this._materialEffect=S):S||(this._materialDefines=null)},w.AddToMesh=function(S,_,O,R,I,y,p,g){return g===void 0&&(g=!0),new w(S,_,O,R,I,y,p,g)},Object.defineProperty(w.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),w.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},w.prototype.setBoundingInfo=function(S){return this._boundingInfo=S,this},w.prototype.getMesh=function(){return this._mesh},w.prototype.getRenderingMesh=function(){return this._renderingMesh},w.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},w.prototype.getEffectiveMesh=function(){var S=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return S||this._renderingMesh},w.prototype.getMaterial=function(){var S=this._renderingMesh.material;if(S==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(S)){var _=S.getSubMaterial(this.materialIndex);return this._currentMaterial!==_&&(this._currentMaterial=_,this._materialDefines=null),_}return S},w.prototype._IsMultiMaterial=function(S){return S.getSubMaterial!==void 0},w.prototype.refreshBoundingInfo=function(S){if(S===void 0&&(S=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(S||(S=this._renderingMesh.getVerticesData(T.b.PositionKind)),!S)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var _,O=this._renderingMesh.getIndices();if(this.indexStart===0&&this.indexCount===O.length){var R=this._renderingMesh.getBoundingInfo();_={minimum:R.minimum.clone(),maximum:R.maximum.clone()}}else _=Object(x.b)(S,O,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(_.minimum,_.maximum):this._boundingInfo=new E.a(_.minimum,_.maximum),this},w.prototype._checkCollision=function(S){return this.getBoundingInfo()._checkCollision(S)},w.prototype.updateBoundingInfo=function(S){var _=this.getBoundingInfo();return _||(this.refreshBoundingInfo(),_=this.getBoundingInfo()),_&&_.update(S),this},w.prototype.isInFrustum=function(S){var _=this.getBoundingInfo();return!!_&&_.isInFrustum(S,this._mesh.cullingStrategy)},w.prototype.isCompletelyInFrustum=function(S){var _=this.getBoundingInfo();return!!_&&_.isCompletelyInFrustum(S)},w.prototype.render=function(S){return this._renderingMesh.render(this,S,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},w.prototype._getLinesIndexBuffer=function(S,_){if(!this._linesIndexBuffer){for(var O=[],R=this.indexStart;R<this.indexStart+this.indexCount;R+=3)O.push(S[R],S[R+1],S[R+1],S[R+2],S[R+2],S[R]);this._linesIndexBuffer=_.createIndexBuffer(O),this._linesIndexCount=O.length}return this._linesIndexBuffer},w.prototype.canIntersects=function(S){var _=this.getBoundingInfo();return!!_&&S.intersectsBox(_.boundingBox)},w.prototype.intersects=function(S,_,O,R,I){var y=this.getMaterial();if(!y)return null;var p=3,g=!1;switch(y.fillMode){case d.a.MATERIAL_PointListDrawMode:case d.a.MATERIAL_LineListDrawMode:case d.a.MATERIAL_LineLoopDrawMode:case d.a.MATERIAL_LineStripDrawMode:case d.a.MATERIAL_TriangleFanDrawMode:return null;case d.a.MATERIAL_TriangleStripDrawMode:p=1,g=!0}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?O.length?this._intersectLines(S,_,O,this._mesh.intersectionThreshold,R):this._intersectUnIndexedLines(S,_,O,this._mesh.intersectionThreshold,R):!O.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(S,_,O,R,I):this._intersectTriangles(S,_,O,p,g,R,I)},w.prototype._intersectLines=function(S,_,O,R,I){for(var y=null,p=this.indexStart;p<this.indexStart+this.indexCount;p+=2){var g=_[O[p]],C=_[O[p+1]],P=S.intersectionSegment(g,C,R);if(!(P<0)&&(I||!y||P<y.distance)&&((y=new m.a(null,null,P)).faceId=p/2,I))break}return y},w.prototype._intersectUnIndexedLines=function(S,_,O,R,I){for(var y=null,p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=2){var g=_[p],C=_[p+1],P=S.intersectionSegment(g,C,R);if(!(P<0)&&(I||!y||P<y.distance)&&((y=new m.a(null,null,P)).faceId=p/2,I))break}return y},w.prototype._intersectTriangles=function(S,_,O,R,I,y,p){for(var g=null,C=-1,P=this.indexStart;P<this.indexStart+this.indexCount;P+=R){C++;var F=O[P],U=O[P+1],B=O[P+2];if(I&&B===4294967295)P+=2;else{var L=_[F],z=_[U],X=_[B];if(!p||p(L,z,X,S)){var G=S.intersectsTriangle(L,z,X);if(G){if(G.distance<0)continue;if((y||!g||G.distance<g.distance)&&((g=G).faceId=C,y))break}}}}return g},w.prototype._intersectUnIndexedTriangles=function(S,_,O,R,I){for(var y=null,p=this.verticesStart;p<this.verticesStart+this.verticesCount;p+=3){var g=_[p],C=_[p+1],P=_[p+2];if(!I||I(g,C,P,S)){var F=S.intersectsTriangle(g,C,P);if(F){if(F.distance<0)continue;if((R||!y||F.distance<y.distance)&&((y=F).faceId=p/3,R))break}}}return y},w.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},w.prototype.clone=function(S,_){var O=new w(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,S,_,!1);if(!this.IsGlobal){var R=this.getBoundingInfo();if(!R)return O;O._boundingInfo=new E.a(R.minimum,R.maximum)}return O},w.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var S=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(S,1)},w.prototype.getClassName=function(){return"SubMesh"},w.CreateFromIndices=function(S,_,O,R,I){for(var y=Number.MAX_VALUE,p=-Number.MAX_VALUE,g=(I||R).getIndices(),C=_;C<_+O;C++){var P=g[C];P<y&&(y=P),P>p&&(p=P)}return new w(S,y,p-y+1,_,O,R,I)},w}()},function(f,s,c){c.d(s,"a",function(){return M});var T=c(1),m=c(8),E=c(10),d=c(2),x=(c(126),c(70)),M=function(w){function S(_,O,R,I,y,p,g){R===void 0&&(R=null),y===void 0&&(y=d.a.TEXTURE_TRILINEAR_SAMPLINGMODE),p===void 0&&(p=d.a.TEXTUREFORMAT_RGBA);var C=w.call(this,null,R,!I,g,y,void 0,void 0,void 0,void 0,p)||this;C.name=_,C.wrapU=E.a.CLAMP_ADDRESSMODE,C.wrapV=E.a.CLAMP_ADDRESSMODE,C._generateMipMaps=I;var P=C._getEngine();if(!P)return C;O.getContext?(C._canvas=O,C._texture=P.createDynamicTexture(O.width,O.height,I,y)):(C._canvas=x.a.CreateCanvas(1,1),O.width||O.width===0?C._texture=P.createDynamicTexture(O.width,O.height,I,y):C._texture=P.createDynamicTexture(O,O,I,y));var F=C.getSize();return C._canvas.width=F.width,C._canvas.height=F.height,C._context=C._canvas.getContext("2d"),C}return Object(T.d)(S,w),S.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(S.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),S.prototype._recreate=function(_){this._canvas.width=_.width,this._canvas.height=_.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(_.width,_.height,this._generateMipMaps,this.samplingMode)},S.prototype.scale=function(_){var O=this.getSize();O.width*=_,O.height*=_,this._recreate(O)},S.prototype.scaleTo=function(_,O){var R=this.getSize();R.width=_,R.height=O,this._recreate(R)},S.prototype.getContext=function(){return this._context},S.prototype.clear=function(){var _=this.getSize();this._context.fillRect(0,0,_.width,_.height)},S.prototype.update=function(_,O){O===void 0&&(O=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,_===void 0||_,O,this._format||void 0)},S.prototype.drawText=function(_,O,R,I,y,p,g,C){C===void 0&&(C=!0);var P=this.getSize();if(p&&(this._context.fillStyle=p,this._context.fillRect(0,0,P.width,P.height)),this._context.font=I,O==null){var F=this._context.measureText(_);O=(P.width-F.width)/2}if(R==null){var U=parseInt(I.replace(/\D/g,""));R=P.height/2+U/3.65}this._context.fillStyle=y||"",this._context.fillText(_,O,R),C&&this.update(g)},S.prototype.clone=function(){var _=this.getScene();if(!_)return this;var O=this.getSize(),R=new S(this.name,O,_,this._generateMipMaps);return R.hasAlpha=this.hasAlpha,R.level=this.level,R.wrapU=this.wrapU,R.wrapV=this.wrapV,R},S.prototype.serialize=function(){var _=this.getScene();_&&!_.isReady()&&m.a.Warn("The scene must be ready before serializing the dynamic texture");var O=w.prototype.serialize.call(this);return this._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O},S.prototype._IsCanvasElement=function(_){return _.toDataURL!==void 0},S.prototype._rebuild=function(){this.update()},S}(E.a)},function(f,s,c){c.d(s,"a",function(){return x});var T=c(0),m=c(9),E=c(7),d=c(16);d.a.CreateBox=function(M){var w,S=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],_=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],O=[],R=M.width||M.size||1,I=M.height||M.size||1,y=M.depth||M.size||1,p=M.wrap||!1,g=M.topBaseAt===void 0?1:M.topBaseAt,C=M.bottomBaseAt===void 0?0:M.bottomBaseAt,P=[2,0,3,1][g=(g+4)%4],F=[2,0,1,3][C=(C+4)%4],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(p){S=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var B=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],L=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],z=[17,18,19,16],X=[22,23,20,21];P>0;)B.unshift(B.pop()),z.unshift(z.pop()),P--;for(;F>0;)L.unshift(L.pop()),X.unshift(X.pop()),F--;B=B.flat(),L=L.flat(),U=U.concat(B).concat(L),S.push(z[0],z[2],z[3],z[0],z[1],z[2]),S.push(X[0],X[2],X[3],X[0],X[1],X[2])}var G=[R/2,I/2,y/2];w=U.reduce(function(K,Z,le){return K.concat(Z*G[le%3])},[]);for(var ee=M.sideOrientation===0?0:M.sideOrientation||d.a.DEFAULTSIDE,$=M.faceUV||new Array(6),fe=M.faceColors,me=[],ve=0;ve<6;ve++)$[ve]===void 0&&($[ve]=new T.f(0,0,1,1)),fe&&fe[ve]===void 0&&(fe[ve]=new m.b(1,1,1,1));for(var be=0;be<6;be++)if(O.push($[be].z,$[be].w),O.push($[be].x,$[be].w),O.push($[be].x,$[be].y),O.push($[be].z,$[be].y),fe)for(var ie=0;ie<4;ie++)me.push(fe[be].r,fe[be].g,fe[be].b,fe[be].a);d.a._ComputeSides(ee,w,S,_,O,M.frontUVs,M.backUVs);var se=new d.a;if(se.indices=S,se.positions=w,se.normals=_,se.uvs=O,fe){var V=ee===d.a.DOUBLESIDE?me.concat(me):me;se.colors=V}return se},E.a.CreateBox=function(M,w,S,_,O){S===void 0&&(S=null);var R={size:w,sideOrientation:O,updatable:_};return x.CreateBox(M,R,S)};var x=function(){function M(){}return M.CreateBox=function(w,S,_){_===void 0&&(_=null);var O=new E.a(w,_);return S.sideOrientation=E.a._GetDefaultSideOrientation(S.sideOrientation),O._originalBuilderSideOrientation=S.sideOrientation,d.a.CreateBox(S).applyToMesh(O,S.updatable),O},M}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(0),m=function(){function E(d,x,M,w){this.normal=new T.e(d,x,M),this.d=w}return E.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},E.prototype.clone=function(){return new E(this.normal.x,this.normal.y,this.normal.z,this.d)},E.prototype.getClassName=function(){return"Plane"},E.prototype.getHashCode=function(){var d=this.normal.getHashCode();return d=397*d^(0|this.d)},E.prototype.normalize=function(){var d=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),x=0;return d!==0&&(x=1/d),this.normal.x*=x,this.normal.y*=x,this.normal.z*=x,this.d*=x,this},E.prototype.transform=function(d){var x=E._TmpMatrix;d.invertToRef(x);var M=x.m,w=this.normal.x,S=this.normal.y,_=this.normal.z,O=this.d;return new E(w*M[0]+S*M[1]+_*M[2]+O*M[3],w*M[4]+S*M[5]+_*M[6]+O*M[7],w*M[8]+S*M[9]+_*M[10]+O*M[11],w*M[12]+S*M[13]+_*M[14]+O*M[15])},E.prototype.dotCoordinate=function(d){return this.normal.x*d.x+this.normal.y*d.y+this.normal.z*d.z+this.d},E.prototype.copyFromPoints=function(d,x,M){var w,S=x.x-d.x,_=x.y-d.y,O=x.z-d.z,R=M.x-d.x,I=M.y-d.y,y=M.z-d.z,p=_*y-O*I,g=O*R-S*y,C=S*I-_*R,P=Math.sqrt(p*p+g*g+C*C);return w=P!==0?1/P:0,this.normal.x=p*w,this.normal.y=g*w,this.normal.z=C*w,this.d=-(this.normal.x*d.x+this.normal.y*d.y+this.normal.z*d.z),this},E.prototype.isFrontFacingTo=function(d,x){return T.e.Dot(this.normal,d)<=x},E.prototype.signedDistanceTo=function(d){return T.e.Dot(d,this.normal)+this.d},E.FromArray=function(d){return new E(d[0],d[1],d[2],d[3])},E.FromPoints=function(d,x,M){var w=new E(0,0,0,0);return w.copyFromPoints(d,x,M),w},E.FromPositionAndNormal=function(d,x){var M=new E(0,0,0,0);return x.normalize(),M.normal=x,M.d=-(x.x*d.x+x.y*d.y+x.z*d.z),M},E.SignedDistanceToPlaneFromPositionAndNormal=function(d,x,M){var w=-(x.x*d.x+x.y*d.y+x.z*d.z);return T.e.Dot(M,x)+w},E._TmpMatrix=T.a.Identity(),E}()},function(f,s,c){c.d(s,"a",function(){return S});var T=c(7),m=c(20),E=c(6),d=c(0),x=c(18),M=c(39),w=c(60),S=(c(84),function(){function _(O){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new E.c,this.onDragStartObservable=new E.c,this.onDragEndObservable=new E.c,this.moveAttached=!0,this.enabled=!0,this.startAndReleaseDragOnPointerEvents=!0,this.detachCameraControls=!0,this.useObjectOrientationForDragging=!0,this.validateDrag=function(I){return!0},this._tmpVector=new d.e(0,0,0),this._alternatePickedPoint=new d.e(0,0,0),this._worldDragAxis=new d.e(0,0,0),this._targetPosition=new d.e(0,0,0),this._attachedToElement=!1,this._startDragRay=new M.a(new d.e,new d.e),this._lastPointerRay={},this._dragDelta=new d.e,this._pointA=new d.e(0,0,0),this._pointC=new d.e(0,0,0),this._localAxis=new d.e(0,0,0),this._lookAt=new d.e(0,0,0),this._options=O||{};var R=0;if(this._options.dragAxis&&R++,this._options.dragPlaneNormal&&R++,R>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(_.prototype,"options",{get:function(){return this._options},set:function(O){this._options=O},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!1,configurable:!0}),_.prototype.init=function(){},_.prototype.attach=function(O,R){var I=this;this._scene=O.getScene(),this.attachedNode=O,_._planeScene||(this._debugMode?_._planeScene=this._scene:(_._planeScene=new m.a(this._scene.getEngine(),{virtual:!0}),_._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){_._planeScene.dispose(),_._planeScene=null}))),this._dragPlane=T.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,_._planeScene,!1,T.a.DOUBLESIDE),this.lastDragPosition=new d.e(0,0,0);var y=R||function(p){return I.attachedNode==p||p.isDescendantOf(I.attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(p,g){if(I.enabled){if(p.type==x.a.POINTERDOWN)I.startAndReleaseDragOnPointerEvents&&!I.dragging&&p.pickInfo&&p.pickInfo.hit&&p.pickInfo.pickedMesh&&p.pickInfo.pickedPoint&&p.pickInfo.ray&&y(p.pickInfo.pickedMesh)&&I._startDrag(p.event.pointerId,p.pickInfo.ray,p.pickInfo.pickedPoint);else if(p.type==x.a.POINTERUP)I.startAndReleaseDragOnPointerEvents&&I.currentDraggingPointerID==p.event.pointerId&&I.releaseDrag();else if(p.type==x.a.POINTERMOVE){var C=p.event.pointerId;if(I.currentDraggingPointerID===_._AnyMouseID&&C!==_._AnyMouseID){var P=p.event;(P.pointerType==="mouse"||!I._scene.getEngine().hostInformation.isMobile&&P instanceof MouseEvent)&&(I._lastPointerRay[I.currentDraggingPointerID]&&(I._lastPointerRay[C]=I._lastPointerRay[I.currentDraggingPointerID],delete I._lastPointerRay[I.currentDraggingPointerID]),I.currentDraggingPointerID=C)}I._lastPointerRay[C]||(I._lastPointerRay[C]=new M.a(new d.e,new d.e)),p.pickInfo&&p.pickInfo.ray&&(I._lastPointerRay[C].origin.copyFrom(p.pickInfo.ray.origin),I._lastPointerRay[C].direction.copyFrom(p.pickInfo.ray.direction),I.currentDraggingPointerID==C&&I.dragging&&I._moveDrag(p.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){I._moving&&I.moveAttached&&(w.a._RemoveAndStorePivotPoint(I.attachedNode),I._targetPosition.subtractToRef(I.attachedNode.absolutePosition,I._tmpVector),I._tmpVector.scaleInPlace(I.dragDeltaRatio),I.attachedNode.getAbsolutePosition().addToRef(I._tmpVector,I._tmpVector),I.validateDrag(I._tmpVector)&&I.attachedNode.setAbsolutePosition(I._tmpVector),w.a._RestorePivotPoint(I.attachedNode))})},_.prototype.releaseDrag=function(){if(this.dragging&&(this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID})),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedToElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera){if(this._scene.activeCamera.getClassName()==="ArcRotateCamera"){var O=this._scene.activeCamera;O.attachControl(!O.inputs||O.inputs.noPreventDefault,O._useCtrlForPanning,O._panningMouseButton)}else this._scene.activeCamera.attachControl(!this._scene.activeCamera.inputs||this._scene.activeCamera.inputs.noPreventDefault);this._attachedToElement=!1}},_.prototype.startDrag=function(O,R,I){O===void 0&&(O=_._AnyMouseID),this._startDrag(O,R,I);var y=this._lastPointerRay[O];O===_._AnyMouseID&&(y=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),y&&this._moveDrag(y)},_.prototype._startDrag=function(O,R,I){if(this._scene.activeCamera&&!this.dragging&&this.attachedNode){w.a._RemoveAndStorePivotPoint(this.attachedNode),R?(this._startDragRay.direction.copyFrom(R.direction),this._startDragRay.origin.copyFrom(R.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this.attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,I||this._tmpVector);var y=this._pickWithRayOnDragPlane(this._startDragRay);y&&(this.dragging=!0,this.currentDraggingPointerID=O,this.lastDragPosition.copyFrom(y),this.onDragStartObservable.notifyObservers({dragPlanePoint:y,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this.attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&this._scene.activeCamera.inputs&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedToElement?(this._scene.activeCamera.detachControl(),this._attachedToElement=!0):this._attachedToElement=!1)),w.a._RestorePivotPoint(this.attachedNode)}},_.prototype._moveDrag=function(O){this._moving=!0;var R=this._pickWithRayOnDragPlane(O);if(R){this.updateDragPlane&&this._updateDragPlanePosition(O,R);var I=0;this._options.dragAxis?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis):this._worldDragAxis.copyFrom(this._options.dragAxis),R.subtractToRef(this.lastDragPosition,this._tmpVector),I=d.e.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(I,this._dragDelta)):(I=this._dragDelta.length(),R.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:I,delta:this._dragDelta,dragPlanePoint:R,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(R)}},_.prototype._pickWithRayOnDragPlane=function(O){var R=this;if(!O)return null;var I=Math.acos(d.e.Dot(this._dragPlane.forward,O.direction));if(I>Math.PI/2&&(I=Math.PI-I),this.maxDragAngle>0&&I>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(O.direction),this.attachedNode.absolutePosition.subtractToRef(O.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*d.e.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var y=d.e.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-y,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this.attachedNode.absolutePosition),this._alternatePickedPoint}return null}var p=_._planeScene.pickWithRay(O,function(g){return g==R._dragPlane});return p&&p.hit&&p.pickedMesh&&p.pickedPoint?p.pickedPoint:null},_.prototype._updateDragPlanePosition=function(O,R){this._pointA.copyFrom(R),this._options.dragAxis?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragAxis,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),O.origin.subtractToRef(this._pointA,this._pointC),this._pointC.normalize(),Math.abs(d.e.Dot(this._localAxis,this._pointC))>.999?Math.abs(d.e.Dot(d.e.UpReadOnly,this._pointC))>.999?this._lookAt.copyFrom(d.e.Right()):this._lookAt.copyFrom(d.e.UpReadOnly):(d.e.CrossToRef(this._localAxis,this._pointC,this._lookAt),d.e.CrossToRef(this._localAxis,this._lookAt,this._lookAt),this._lookAt.normalize()),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrientationForDragging?d.e.TransformCoordinatesToRef(this._options.dragPlaneNormal,this.attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(O.origin)),this._dragPlane.position.copyFrom(this.attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},_.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},_._AnyMouseID=-2,_}())},function(f,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return E}),c.d(s,"c",function(){return d});var T=c(1),m=function(){function x(){}return x.KEYDOWN=1,x.KEYUP=2,x}(),E=function(x,M){this.type=x,this.event=M},d=function(x){function M(w,S){var _=x.call(this,w,S)||this;return _.type=w,_.event=S,_.skipOnPointerObservable=!1,_}return Object(T.d)(M,x),M}(E)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return m.prototype.unBindMesh=function(){this._mesh=null},m.prototype.addFallback=function(E,d){this._defines[E]||(E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E),this._defines[E]=new Array),this._defines[E].push(d)},m.prototype.addCPUSkinningFallback=function(E,d){this._mesh=d,E<this._currentRank&&(this._currentRank=E),E>this._maxRank&&(this._maxRank=E)},Object.defineProperty(m.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),m.prototype.reduce=function(E,d){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,E=E.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),d._bonesComputationForcedToCPU=!0;for(var x=this._mesh.getScene(),M=0;M<x.meshes.length;M++){var w=x.meshes[M];if(w.material){if(w.computeBonesUsingShaders&&w.numBoneInfluencers!==0){if(w.material.getEffect()===d)w.computeBonesUsingShaders=!1;else if(w.subMeshes){for(var S=0,_=w.subMeshes;S<_.length;S++)if(_[S].effect===d){w.computeBonesUsingShaders=!1;break}}}}else!this._mesh.material&&w.computeBonesUsingShaders&&w.numBoneInfluencers>0&&(w.computeBonesUsingShaders=!1)}}else{var O=this._defines[this._currentRank];if(O)for(M=0;M<O.length;M++)E=E.replace("#define "+O[M],"");this._currentRank++}return E},m}()},function(f,s,c){c.d(s,"a",function(){return x});var T=c(1),m=c(25),E=c(37),d=c(11),x=function(M){function w(S,_){var O=M.call(this,S,_,!0)||this;return _.multiMaterials.push(O),O.subMaterials=new Array,O._storeEffectOnSubMeshes=!0,O}return Object(T.d)(w,M),Object.defineProperty(w.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(S){this._subMaterials=S,this._hookArray(S)},enumerable:!1,configurable:!0}),w.prototype.getChildren=function(){return this.subMaterials},w.prototype._hookArray=function(S){var _=this,O=S.push;S.push=function(){for(var I=[],y=0;y<arguments.length;y++)I[y]=arguments[y];var p=O.apply(S,I);return _._markAllSubMeshesAsTexturesDirty(),p};var R=S.splice;S.splice=function(I,y){var p=R.apply(S,[I,y]);return _._markAllSubMeshesAsTexturesDirty(),p}},w.prototype.getSubMaterial=function(S){return S<0||S>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[S]},w.prototype.getActiveTextures=function(){var S;return(S=M.prototype.getActiveTextures.call(this)).concat.apply(S,this.subMaterials.map(function(_){return _?_.getActiveTextures():[]}))},w.prototype.hasTexture=function(S){var _;if(M.prototype.hasTexture.call(this,S))return!0;for(var O=0;O<this.subMaterials.length;O++)if((_=this.subMaterials[O])===null||_===void 0?void 0:_.hasTexture(S))return!0;return!1},w.prototype.getClassName=function(){return"MultiMaterial"},w.prototype.isReadyForSubMesh=function(S,_,O){for(var R=0;R<this.subMaterials.length;R++){var I=this.subMaterials[R];if(I){if(I._storeEffectOnSubMeshes){if(!I.isReadyForSubMesh(S,_,O))return!1;continue}if(!I.isReady(S))return!1}}return!0},w.prototype.clone=function(S,_){for(var O=new w(S,this.getScene()),R=0;R<this.subMaterials.length;R++){var I=null,y=this.subMaterials[R];I=_&&y?y.clone(S+"-"+y.name):this.subMaterials[R],O.subMaterials.push(I)}return O},w.prototype.serialize=function(){var S={};S.name=this.name,S.id=this.id,E.a&&(S.tags=E.a.GetTags(this)),S.materials=[];for(var _=0;_<this.subMaterials.length;_++){var O=this.subMaterials[_];O?S.materials.push(O.id):S.materials.push(null)}return S},w.prototype.dispose=function(S,_,O){var R=this.getScene();if(R){if(O)for(var I=0;I<this.subMaterials.length;I++){var y=this.subMaterials[I];y&&y.dispose(S,_)}(I=R.multiMaterials.indexOf(this))>=0&&R.multiMaterials.splice(I,1),M.prototype.dispose.call(this,S,_)}},w.ParseMultiMaterial=function(S,_){var O=new w(S.name,_);O.id=S.id,E.a&&E.a.AddTagsTo(O,S.tags);for(var R=0;R<S.materials.length;R++){var I=S.materials[R];I?O.subMaterials.push(_.getLastMaterialByID(I)):O.subMaterials.push(null)}return O},w}(m.a);d.a.RegisteredTypes["BABYLON.MultiMaterial"]=x},function(f,s,c){c.d(s,"a",function(){return m});var T=c(2),m=function(){function E(){}return Object.defineProperty(E,"ForceFullSceneLoadingForIncremental",{get:function(){return E._ForceFullSceneLoadingForIncremental},set:function(d){E._ForceFullSceneLoadingForIncremental=d},enumerable:!1,configurable:!0}),Object.defineProperty(E,"ShowLoadingScreen",{get:function(){return E._ShowLoadingScreen},set:function(d){E._ShowLoadingScreen=d},enumerable:!1,configurable:!0}),Object.defineProperty(E,"loggingLevel",{get:function(){return E._loggingLevel},set:function(d){E._loggingLevel=d},enumerable:!1,configurable:!0}),Object.defineProperty(E,"CleanBoneMatrixWeights",{get:function(){return E._CleanBoneMatrixWeights},set:function(d){E._CleanBoneMatrixWeights=d},enumerable:!1,configurable:!0}),E._ForceFullSceneLoadingForIncremental=!1,E._ShowLoadingScreen=!0,E._CleanBoneMatrixWeights=!1,E._loggingLevel=T.a.SCENELOADER_NO_LOGGING,E}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.CreateCanvas=function(E,d){if(typeof document=="undefined")return new OffscreenCanvas(E,d);var x=document.createElement("canvas");return x.width=E,x.height=d,x},m}()},function(f,s,c){c.d(s,"a",function(){return I});var T=c(0),m=c(9),E=c(16),d=c(4),x=c(61),M=c(69),w=c(43),S=c(2),_=c(12),O=c(37),R=c(101),I=function(){function y(p,g,C,P,F){P===void 0&&(P=!1),F===void 0&&(F=null),this.delayLoadState=S.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=p,this.uniqueId=g.getUniqueId(),this._engine=g.getEngine(),this._meshes=[],this._scene=g,this._vertexBuffers={},this._indices=[],this._updatable=P,C?this.setAllVerticesData(C,P):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),F&&(this.applyToMesh(F),F.computeWorldMatrix(!0))}return Object.defineProperty(y.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(p){this._boundingBias?this._boundingBias.copyFrom(p):this._boundingBias=p.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),y.CreateGeometryForMesh=function(p){var g=new y(y.RandomId(),p.getScene());return g.applyToMesh(p),g},Object.defineProperty(y.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),y.prototype.getScene=function(){return this._scene},y.prototype.getEngine=function(){return this._engine},y.prototype.isReady=function(){return this.delayLoadState===S.a.DELAYLOADSTATE_LOADED||this.delayLoadState===S.a.DELAYLOADSTATE_NONE},Object.defineProperty(y.prototype,"doNotSerialize",{get:function(){for(var p=0;p<this._meshes.length;p++)if(!this._meshes[p].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),y.prototype._rebuild=function(){for(var p in this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[p]._rebuild()},y.prototype.setAllVerticesData=function(p,g){p.applyToGeometry(this,g),this.notifyUpdate()},y.prototype.setVerticesData=function(p,g,C,P){C===void 0&&(C=!1),C&&Array.isArray(g)&&(g=new Float32Array(g));var F=new d.b(this._engine,g,p,C,this._meshes.length===0,P);this.setVerticesBuffer(F)},y.prototype.removeVerticesData=function(p){this._vertexBuffers[p]&&(this._vertexBuffers[p].dispose(),delete this._vertexBuffers[p])},y.prototype.setVerticesBuffer=function(p,g){g===void 0&&(g=null);var C=p.getKind();if(this._vertexBuffers[C]&&this._vertexBuffers[C].dispose(),this._vertexBuffers[C]=p,C===d.b.PositionKind){var P=p.getData();g!=null?this._totalVertices=g:P!=null&&(this._totalVertices=P.length/(p.byteStride/4)),this._updateExtend(P),this._resetPointsArrayCache();for(var F=this._meshes,U=F.length,B=0;B<U;B++){var L=F[B];L._boundingInfo=new w.a(this._extend.minimum,this._extend.maximum),L._createGlobalSubMesh(!1),L.computeWorldMatrix(!0)}}this.notifyUpdate(C),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},y.prototype.updateVerticesDataDirectly=function(p,g,C,P){P===void 0&&(P=!1);var F=this.getVertexBuffer(p);F&&(F.updateDirectly(g,C,P),this.notifyUpdate(p))},y.prototype.updateVerticesData=function(p,g,C){C===void 0&&(C=!1);var P=this.getVertexBuffer(p);P&&(P.update(g),p===d.b.PositionKind&&this._updateBoundingInfo(C,g),this.notifyUpdate(p))},y.prototype._updateBoundingInfo=function(p,g){if(p&&this._updateExtend(g),this._resetPointsArrayCache(),p)for(var C=0,P=this._meshes;C<P.length;C++){var F=P[C];F._boundingInfo?F._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):F._boundingInfo=new w.a(this._extend.minimum,this._extend.maximum);for(var U=0,B=F.subMeshes;U<B.length;U++)B[U].refreshBoundingInfo()}},y.prototype._bind=function(p,g){if(p){g===void 0&&(g=this._indexBuffer);var C=this.getVertexBuffers();C&&(g==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[p.key]||(this._vertexArrayObjects[p.key]=this._engine.recordVertexArrayObject(C,g,p)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[p.key],g)):this._engine.bindBuffers(C,g,p))}},y.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},y.prototype.getVerticesData=function(p,g,C){var P=this.getVertexBuffer(p);if(!P)return null;var F=P.getData();if(!F)return null;var U=P.getSize()*d.b.GetTypeByteLength(P.type),B=this._totalVertices*P.getSize();if(P.type!==d.b.FLOAT||P.byteStride!==U){var L=[];return P.forEach(B,function($){return L.push($)}),L}if(!(F instanceof Array||F instanceof Float32Array)||P.byteOffset!==0||F.length!==B){if(F instanceof Array){var z=P.byteOffset/4;return _.b.Slice(F,z,z+B)}if(F instanceof ArrayBuffer)return new Float32Array(F,P.byteOffset,B);if(z=F.byteOffset+P.byteOffset,C||g&&this._meshes.length!==1){var X=new Float32Array(B),G=new Float32Array(F.buffer,z,B);return X.set(G),X}var ee=z%4;return ee&&(z=Math.max(0,z-ee)),new Float32Array(F.buffer,z,B)}return C||g&&this._meshes.length!==1?_.b.Slice(F):F},y.prototype.isVertexBufferUpdatable=function(p){var g=this._vertexBuffers[p];return!!g&&g.isUpdatable()},y.prototype.getVertexBuffer=function(p){return this.isReady()?this._vertexBuffers[p]:null},y.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},y.prototype.isVerticesDataPresent=function(p){return this._vertexBuffers?this._vertexBuffers[p]!==void 0:!!this._delayInfo&&this._delayInfo.indexOf(p)!==-1},y.prototype.getVerticesDataKinds=function(){var p,g=[];if(!this._vertexBuffers&&this._delayInfo)for(p in this._delayInfo)g.push(p);else for(p in this._vertexBuffers)g.push(p);return g},y.prototype.updateIndices=function(p,g,C){if(C===void 0&&(C=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var P=p.length!==this._indices.length;if(C||(this._indices=p.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,p,g),P)for(var F=0,U=this._meshes;F<U.length;F++)U[F]._createGlobalSubMesh(!0)}else this.setIndices(p,null,!0)},y.prototype.setIndices=function(p,g,C){g===void 0&&(g=null),C===void 0&&(C=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=p,this._indexBufferIsUpdatable=C,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,C)),g!=null&&(this._totalVertices=g);for(var P=0,F=this._meshes;P<F.length;P++)F[P]._createGlobalSubMesh(!0);this.notifyUpdate()},y.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},y.prototype.getIndices=function(p,g){if(!this.isReady())return null;var C=this._indices;if(g||p&&this._meshes.length!==1){for(var P=C.length,F=[],U=0;U<P;U++)F.push(C[U]);return F}return C},y.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},y.prototype._releaseVertexArrayObject=function(p){p===void 0&&(p=null),p&&this._vertexArrayObjects&&this._vertexArrayObjects[p.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[p.key]),delete this._vertexArrayObjects[p.key])},y.prototype.releaseForMesh=function(p,g){var C=this._meshes,P=C.indexOf(p);P!==-1&&(C.splice(P,1),p._geometry=null,C.length===0&&g&&this.dispose())},y.prototype.applyToMesh=function(p){if(p._geometry!==this){var g=p._geometry;g&&g.releaseForMesh(p);var C=this._meshes;p._geometry=this,this._scene.pushGeometry(this),C.push(p),this.isReady()?this._applyToMesh(p):p._boundingInfo=this._boundingInfo}},y.prototype._updateExtend=function(p){p===void 0&&(p=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(p||(p=this.getVerticesData(d.b.PositionKind)),this._extend=Object(R.a)(p,0,this._totalVertices,this.boundingBias,3))},y.prototype._applyToMesh=function(p){var g=this._meshes.length;for(var C in this._vertexBuffers){g===1&&this._vertexBuffers[C].create();var P=this._vertexBuffers[C].getBuffer();P&&(P.references=g),C===d.b.PositionKind&&(this._extend||this._updateExtend(),p._boundingInfo=new w.a(this._extend.minimum,this._extend.maximum),p._createGlobalSubMesh(!1),p._updateBoundingInfo())}g===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=g),p._syncGeometryWithMorphTargetManager(),p.synchronizeInstances()},y.prototype.notifyUpdate=function(p){this.onGeometryUpdated&&this.onGeometryUpdated(this,p);for(var g=0,C=this._meshes;g<C.length;g++)C[g]._markSubMeshesAsAttributesDirty()},y.prototype.load=function(p,g){this.delayLoadState!==S.a.DELAYLOADSTATE_LOADING&&(this.isReady()?g&&g():(this.delayLoadState=S.a.DELAYLOADSTATE_LOADING,this._queueLoad(p,g)))},y.prototype._queueLoad=function(p,g){var C=this;this.delayLoadingFile&&(p._addPendingData(this),p._loadFile(this.delayLoadingFile,function(P){if(C._delayLoadingFunction){C._delayLoadingFunction(JSON.parse(P),C),C.delayLoadState=S.a.DELAYLOADSTATE_LOADED,C._delayInfo=[],p._removePendingData(C);for(var F=C._meshes,U=F.length,B=0;B<U;B++)C._applyToMesh(F[B]);g&&g()}},void 0,!0))},y.prototype.toLeftHanded=function(){var p=this.getIndices(!1);if(p!=null&&p.length>0){for(var g=0;g<p.length;g+=3){var C=p[g+0];p[g+0]=p[g+2],p[g+2]=C}this.setIndices(p)}var P=this.getVerticesData(d.b.PositionKind,!1);if(P!=null&&P.length>0){for(g=0;g<P.length;g+=3)P[g+2]=-P[g+2];this.setVerticesData(d.b.PositionKind,P,!1)}var F=this.getVerticesData(d.b.NormalKind,!1);if(F!=null&&F.length>0){for(g=0;g<F.length;g+=3)F[g+2]=-F[g+2];this.setVerticesData(d.b.NormalKind,F,!1)}},y.prototype._resetPointsArrayCache=function(){this._positions=null},y.prototype._generatePointsArray=function(){if(this._positions)return!0;var p=this.getVerticesData(d.b.PositionKind);if(!p||p.length===0)return!1;for(var g=3*this._positionsCache.length,C=this._positionsCache.length;g<p.length;g+=3,++C)this._positionsCache[C]=T.e.FromArray(p,g);for(g=0,C=0;g<p.length;g+=3,++C)this._positionsCache[C].set(p[0+g],p[1+g],p[2+g]);return this._positionsCache.length=p.length/3,this._positions=this._positionsCache,!0},y.prototype.isDisposed=function(){return this._isDisposed},y.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var p in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[p]);this._vertexArrayObjects={}}},y.prototype.dispose=function(){var p,g=this._meshes,C=g.length;for(p=0;p<C;p++)this.releaseForMesh(g[p]);for(var P in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[P].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=S.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},y.prototype.copy=function(p){var g=new E.a;g.indices=[];var C=this.getIndices();if(C)for(var P=0;P<C.length;P++)g.indices.push(C[P]);var F,U=!1,B=!1;for(F in this._vertexBuffers){var L=this.getVerticesData(F);if(L&&(L instanceof Float32Array?g.set(new Float32Array(L),F):g.set(L.slice(0),F),!B)){var z=this.getVertexBuffer(F);z&&(B=!(U=z.isUpdatable()))}}var X=new y(p,this._scene,g,U);for(F in X.delayLoadState=this.delayLoadState,X.delayLoadingFile=this.delayLoadingFile,X._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)X._delayInfo=X._delayInfo||[],X._delayInfo.push(F);return X._boundingInfo=new w.a(this._extend.minimum,this._extend.maximum),X},y.prototype.serialize=function(){var p={};return p.id=this.id,p.updatable=this._updatable,O.a&&O.a.HasTags(this)&&(p.tags=O.a.GetTags(this)),p},y.prototype.toNumberArray=function(p){return Array.isArray(p)?p:Array.prototype.slice.call(p)},y.prototype.serializeVerticeData=function(){var p=this.serialize();return this.isVerticesDataPresent(d.b.PositionKind)&&(p.positions=this.toNumberArray(this.getVerticesData(d.b.PositionKind)),this.isVertexBufferUpdatable(d.b.PositionKind)&&(p.positions._updatable=!0)),this.isVerticesDataPresent(d.b.NormalKind)&&(p.normals=this.toNumberArray(this.getVerticesData(d.b.NormalKind)),this.isVertexBufferUpdatable(d.b.NormalKind)&&(p.normals._updatable=!0)),this.isVerticesDataPresent(d.b.TangentKind)&&(p.tangets=this.toNumberArray(this.getVerticesData(d.b.TangentKind)),this.isVertexBufferUpdatable(d.b.TangentKind)&&(p.tangets._updatable=!0)),this.isVerticesDataPresent(d.b.UVKind)&&(p.uvs=this.toNumberArray(this.getVerticesData(d.b.UVKind)),this.isVertexBufferUpdatable(d.b.UVKind)&&(p.uvs._updatable=!0)),this.isVerticesDataPresent(d.b.UV2Kind)&&(p.uv2s=this.toNumberArray(this.getVerticesData(d.b.UV2Kind)),this.isVertexBufferUpdatable(d.b.UV2Kind)&&(p.uv2s._updatable=!0)),this.isVerticesDataPresent(d.b.UV3Kind)&&(p.uv3s=this.toNumberArray(this.getVerticesData(d.b.UV3Kind)),this.isVertexBufferUpdatable(d.b.UV3Kind)&&(p.uv3s._updatable=!0)),this.isVerticesDataPresent(d.b.UV4Kind)&&(p.uv4s=this.toNumberArray(this.getVerticesData(d.b.UV4Kind)),this.isVertexBufferUpdatable(d.b.UV4Kind)&&(p.uv4s._updatable=!0)),this.isVerticesDataPresent(d.b.UV5Kind)&&(p.uv5s=this.toNumberArray(this.getVerticesData(d.b.UV5Kind)),this.isVertexBufferUpdatable(d.b.UV5Kind)&&(p.uv5s._updatable=!0)),this.isVerticesDataPresent(d.b.UV6Kind)&&(p.uv6s=this.toNumberArray(this.getVerticesData(d.b.UV6Kind)),this.isVertexBufferUpdatable(d.b.UV6Kind)&&(p.uv6s._updatable=!0)),this.isVerticesDataPresent(d.b.ColorKind)&&(p.colors=this.toNumberArray(this.getVerticesData(d.b.ColorKind)),this.isVertexBufferUpdatable(d.b.ColorKind)&&(p.colors._updatable=!0)),this.isVerticesDataPresent(d.b.MatricesIndicesKind)&&(p.matricesIndices=this.toNumberArray(this.getVerticesData(d.b.MatricesIndicesKind)),p.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(d.b.MatricesIndicesKind)&&(p.matricesIndices._updatable=!0)),this.isVerticesDataPresent(d.b.MatricesWeightsKind)&&(p.matricesWeights=this.toNumberArray(this.getVerticesData(d.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(d.b.MatricesWeightsKind)&&(p.matricesWeights._updatable=!0)),p.indices=this.toNumberArray(this.getIndices()),p},y.ExtractFromMesh=function(p,g){var C=p._geometry;return C?C.copy(g):null},y.RandomId=function(){return _.b.RandomId()},y._ImportGeometry=function(p,g){var C=g.getScene(),P=p.geometryId;if(P){var F=C.getGeometryByID(P);F&&F.applyToMesh(g)}else if(p instanceof ArrayBuffer){var U=g._binaryInfo;if(U.positionsAttrDesc&&U.positionsAttrDesc.count>0){var B=new Float32Array(p,U.positionsAttrDesc.offset,U.positionsAttrDesc.count);g.setVerticesData(d.b.PositionKind,B,!1)}if(U.normalsAttrDesc&&U.normalsAttrDesc.count>0){var L=new Float32Array(p,U.normalsAttrDesc.offset,U.normalsAttrDesc.count);g.setVerticesData(d.b.NormalKind,L,!1)}if(U.tangetsAttrDesc&&U.tangetsAttrDesc.count>0){var z=new Float32Array(p,U.tangetsAttrDesc.offset,U.tangetsAttrDesc.count);g.setVerticesData(d.b.TangentKind,z,!1)}if(U.uvsAttrDesc&&U.uvsAttrDesc.count>0){var X=new Float32Array(p,U.uvsAttrDesc.offset,U.uvsAttrDesc.count);g.setVerticesData(d.b.UVKind,X,!1)}if(U.uvs2AttrDesc&&U.uvs2AttrDesc.count>0){var G=new Float32Array(p,U.uvs2AttrDesc.offset,U.uvs2AttrDesc.count);g.setVerticesData(d.b.UV2Kind,G,!1)}if(U.uvs3AttrDesc&&U.uvs3AttrDesc.count>0){var ee=new Float32Array(p,U.uvs3AttrDesc.offset,U.uvs3AttrDesc.count);g.setVerticesData(d.b.UV3Kind,ee,!1)}if(U.uvs4AttrDesc&&U.uvs4AttrDesc.count>0){var $=new Float32Array(p,U.uvs4AttrDesc.offset,U.uvs4AttrDesc.count);g.setVerticesData(d.b.UV4Kind,$,!1)}if(U.uvs5AttrDesc&&U.uvs5AttrDesc.count>0){var fe=new Float32Array(p,U.uvs5AttrDesc.offset,U.uvs5AttrDesc.count);g.setVerticesData(d.b.UV5Kind,fe,!1)}if(U.uvs6AttrDesc&&U.uvs6AttrDesc.count>0){var me=new Float32Array(p,U.uvs6AttrDesc.offset,U.uvs6AttrDesc.count);g.setVerticesData(d.b.UV6Kind,me,!1)}if(U.colorsAttrDesc&&U.colorsAttrDesc.count>0){var ve=new Float32Array(p,U.colorsAttrDesc.offset,U.colorsAttrDesc.count);g.setVerticesData(d.b.ColorKind,ve,!1,U.colorsAttrDesc.stride)}if(U.matricesIndicesAttrDesc&&U.matricesIndicesAttrDesc.count>0){for(var be=new Int32Array(p,U.matricesIndicesAttrDesc.offset,U.matricesIndicesAttrDesc.count),ie=[],se=0;se<be.length;se++){var V=be[se];ie.push(255&V),ie.push((65280&V)>>8),ie.push((16711680&V)>>16),ie.push(V>>24&255)}g.setVerticesData(d.b.MatricesIndicesKind,ie,!1)}if(U.matricesIndicesExtraAttrDesc&&U.matricesIndicesExtraAttrDesc.count>0){for(be=new Int32Array(p,U.matricesIndicesExtraAttrDesc.offset,U.matricesIndicesExtraAttrDesc.count),ie=[],se=0;se<be.length;se++)V=be[se],ie.push(255&V),ie.push((65280&V)>>8),ie.push((16711680&V)>>16),ie.push(V>>24&255);g.setVerticesData(d.b.MatricesIndicesExtraKind,ie,!1)}if(U.matricesWeightsAttrDesc&&U.matricesWeightsAttrDesc.count>0){var K=new Float32Array(p,U.matricesWeightsAttrDesc.offset,U.matricesWeightsAttrDesc.count);g.setVerticesData(d.b.MatricesWeightsKind,K,!1)}if(U.indicesAttrDesc&&U.indicesAttrDesc.count>0){var Z=new Int32Array(p,U.indicesAttrDesc.offset,U.indicesAttrDesc.count);g.setIndices(Z,null)}if(U.subMeshesAttrDesc&&U.subMeshesAttrDesc.count>0){var le=new Int32Array(p,U.subMeshesAttrDesc.offset,5*U.subMeshesAttrDesc.count);for(g.subMeshes=[],se=0;se<U.subMeshesAttrDesc.count;se++){var re=le[5*se+0],Q=le[5*se+1],W=le[5*se+2],Y=le[5*se+3],q=le[5*se+4];x.a.AddToMesh(re,Q,W,Y,q,g)}}}else if(p.positions&&p.normals&&p.indices){if(g.setVerticesData(d.b.PositionKind,p.positions,p.positions._updatable),g.setVerticesData(d.b.NormalKind,p.normals,p.normals._updatable),p.tangents&&g.setVerticesData(d.b.TangentKind,p.tangents,p.tangents._updatable),p.uvs&&g.setVerticesData(d.b.UVKind,p.uvs,p.uvs._updatable),p.uvs2&&g.setVerticesData(d.b.UV2Kind,p.uvs2,p.uvs2._updatable),p.uvs3&&g.setVerticesData(d.b.UV3Kind,p.uvs3,p.uvs3._updatable),p.uvs4&&g.setVerticesData(d.b.UV4Kind,p.uvs4,p.uvs4._updatable),p.uvs5&&g.setVerticesData(d.b.UV5Kind,p.uvs5,p.uvs5._updatable),p.uvs6&&g.setVerticesData(d.b.UV6Kind,p.uvs6,p.uvs6._updatable),p.colors&&g.setVerticesData(d.b.ColorKind,m.b.CheckColors4(p.colors,p.positions.length/3),p.colors._updatable),p.matricesIndices)if(p.matricesIndices._isExpanded)delete p.matricesIndices._isExpanded,g.setVerticesData(d.b.MatricesIndicesKind,p.matricesIndices,p.matricesIndices._updatable);else{for(ie=[],se=0;se<p.matricesIndices.length;se++){var ae=p.matricesIndices[se];ie.push(255&ae),ie.push((65280&ae)>>8),ie.push((16711680&ae)>>16),ie.push(ae>>24&255)}g.setVerticesData(d.b.MatricesIndicesKind,ie,p.matricesIndices._updatable)}if(p.matricesIndicesExtra)if(p.matricesIndicesExtra._isExpanded)delete p.matricesIndices._isExpanded,g.setVerticesData(d.b.MatricesIndicesExtraKind,p.matricesIndicesExtra,p.matricesIndicesExtra._updatable);else{for(ie=[],se=0;se<p.matricesIndicesExtra.length;se++)ae=p.matricesIndicesExtra[se],ie.push(255&ae),ie.push((65280&ae)>>8),ie.push((16711680&ae)>>16),ie.push(ae>>24&255);g.setVerticesData(d.b.MatricesIndicesExtraKind,ie,p.matricesIndicesExtra._updatable)}p.matricesWeights&&(y._CleanMatricesWeights(p,g),g.setVerticesData(d.b.MatricesWeightsKind,p.matricesWeights,p.matricesWeights._updatable)),p.matricesWeightsExtra&&g.setVerticesData(d.b.MatricesWeightsExtraKind,p.matricesWeightsExtra,p.matricesWeights._updatable),g.setIndices(p.indices,null)}if(p.subMeshes){g.subMeshes=[];for(var pe=0;pe<p.subMeshes.length;pe++){var De=p.subMeshes[pe];x.a.AddToMesh(De.materialIndex,De.verticesStart,De.verticesCount,De.indexStart,De.indexCount,g)}}g._shouldGenerateFlatShading&&(g.convertToFlatShadedMesh(),g._shouldGenerateFlatShading=!1),g.computeWorldMatrix(!0),C.onMeshImportedObservable.notifyObservers(g)},y._CleanMatricesWeights=function(p,g){if(M.a.CleanBoneMatrixWeights){var C=0;if(p.skeletonId>-1){var P=g.getScene().getLastSkeletonByID(p.skeletonId);if(P){C=P.bones.length;for(var F=g.getVerticesData(d.b.MatricesIndicesKind),U=g.getVerticesData(d.b.MatricesIndicesExtraKind),B=p.matricesWeights,L=p.matricesWeightsExtra,z=p.numBoneInfluencer,X=B.length,G=0;G<X;G+=4){for(var ee=0,$=-1,fe=0;fe<4;fe++)ee+=me=B[G+fe],me<.001&&$<0&&($=fe);if(L)for(fe=0;fe<4;fe++){var me;ee+=me=L[G+fe],me<.001&&$<0&&($=fe+4)}if(($<0||$>z-1)&&($=z-1),ee>.001){var ve=1/ee;for(fe=0;fe<4;fe++)B[G+fe]*=ve;if(L)for(fe=0;fe<4;fe++)L[G+fe]*=ve}else $>=4?(L[G+$-4]=1-ee,U[G+$-4]=C):(B[G+$]=1-ee,F[G+$]=C)}g.setVerticesData(d.b.MatricesIndicesKind,F),p.matricesWeightsExtra&&g.setVerticesData(d.b.MatricesIndicesExtraKind,U)}}}},y.Parse=function(p,g,C){if(g.getGeometryByID(p.id))return null;var P=new y(p.id,g,void 0,p.updatable);return O.a&&O.a.AddTagsTo(P,p.tags),p.delayLoadingFile?(P.delayLoadState=S.a.DELAYLOADSTATE_NOTLOADED,P.delayLoadingFile=C+p.delayLoadingFile,P._boundingInfo=new w.a(T.e.FromArray(p.boundingBoxMinimum),T.e.FromArray(p.boundingBoxMaximum)),P._delayInfo=[],p.hasUVs&&P._delayInfo.push(d.b.UVKind),p.hasUVs2&&P._delayInfo.push(d.b.UV2Kind),p.hasUVs3&&P._delayInfo.push(d.b.UV3Kind),p.hasUVs4&&P._delayInfo.push(d.b.UV4Kind),p.hasUVs5&&P._delayInfo.push(d.b.UV5Kind),p.hasUVs6&&P._delayInfo.push(d.b.UV6Kind),p.hasColors&&P._delayInfo.push(d.b.ColorKind),p.hasMatricesIndices&&P._delayInfo.push(d.b.MatricesIndicesKind),p.hasMatricesWeights&&P._delayInfo.push(d.b.MatricesWeightsKind),P._delayLoadingFunction=E.a.ImportVertexData):E.a.ImportVertexData(p,P),g.pushGeometry(P,!0),P},y}()},function(f,s,c){c.d(s,"e",function(){return T}),c.d(s,"c",function(){return x}),c.d(s,"a",function(){return M}),c.d(s,"b",function(){return w}),c.d(s,"f",function(){return S}),c.d(s,"g",function(){return _}),c.d(s,"d",function(){return O});var T,m=c(14),E=c(0),d=c(28);(function(R){R[R.CW=0]="CW",R[R.CCW=1]="CCW"})(T||(T={}));var x=function(){function R(){}return R.Interpolate=function(I,y,p,g,C){for(var P=1-3*g+3*y,F=3*g-6*y,U=3*y,B=I,L=0;L<5;L++){var z=B*B;B-=(P*(z*B)+F*z+U*B-I)*(1/(3*P*z+2*F*B+U)),B=Math.min(1,Math.max(0,B))}return 3*Math.pow(1-B,2)*B*p+3*(1-B)*Math.pow(B,2)*C+Math.pow(B,3)},R}(),M=function(){function R(I){this._radians=I,this._radians<0&&(this._radians+=2*Math.PI)}return R.prototype.degrees=function(){return 180*this._radians/Math.PI},R.prototype.radians=function(){return this._radians},R.BetweenTwoPoints=function(I,y){var p=y.subtract(I);return new R(Math.atan2(p.y,p.x))},R.FromRadians=function(I){return new R(I)},R.FromDegrees=function(I){return new R(I*Math.PI/180)},R}(),w=function(R,I,y){this.startPoint=R,this.midPoint=I,this.endPoint=y;var p=Math.pow(I.x,2)+Math.pow(I.y,2),g=(Math.pow(R.x,2)+Math.pow(R.y,2)-p)/2,C=(p-Math.pow(y.x,2)-Math.pow(y.y,2))/2,P=(R.x-I.x)*(I.y-y.y)-(I.x-y.x)*(R.y-I.y);this.centerPoint=new E.d((g*(I.y-y.y)-C*(R.y-I.y))/P,((R.x-I.x)*C-(I.x-y.x)*g)/P),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=M.BetweenTwoPoints(this.centerPoint,this.startPoint);var F=this.startAngle.degrees(),U=M.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),B=M.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();U-F>180&&(U-=360),U-F<-180&&(U+=360),B-U>180&&(B-=360),B-U<-180&&(B+=360),this.orientation=U-F<0?T.CW:T.CCW,this.angle=M.FromDegrees(this.orientation===T.CW?F-B:B-F)},S=function(){function R(I,y){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new E.d(I,y))}return R.prototype.addLineTo=function(I,y){if(this.closed)return this;var p=new E.d(I,y),g=this._points[this._points.length-1];return this._points.push(p),this._length+=p.subtract(g).length(),this},R.prototype.addArcTo=function(I,y,p,g,C){if(C===void 0&&(C=36),this.closed)return this;var P=this._points[this._points.length-1],F=new E.d(I,y),U=new E.d(p,g),B=new w(P,F,U),L=B.angle.radians()/C;B.orientation===T.CW&&(L*=-1);for(var z=B.startAngle.radians()+L,X=0;X<C;X++){var G=Math.cos(z)*B.radius+B.centerPoint.x,ee=Math.sin(z)*B.radius+B.centerPoint.y;this.addLineTo(G,ee),z+=L}return this},R.prototype.close=function(){return this.closed=!0,this},R.prototype.length=function(){var I=this._length;if(this.closed){var y=this._points[this._points.length-1];I+=this._points[0].subtract(y).length()}return I},R.prototype.getPoints=function(){return this._points},R.prototype.getPointAtLengthPosition=function(I){if(I<0||I>1)return E.d.Zero();for(var y=I*this.length(),p=0,g=0;g<this._points.length;g++){var C=(g+1)%this._points.length,P=this._points[g],F=this._points[C].subtract(P),U=F.length()+p;if(y>=p&&y<=U){var B=F.normalize(),L=y-p;return new E.d(P.x+B.x*L,P.y+B.y*L)}p=U}return E.d.Zero()},R.StartingAt=function(I,y){return new R(I,y)},R}(),_=function(){function R(I,y,p,g){y===void 0&&(y=null),g===void 0&&(g=!1),this.path=I,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:E.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:E.a.Identity()};for(var C=0;C<I.length;C++)this._curve[C]=I[C].clone();this._raw=p||!1,this._alignTangentsWithPath=g,this._compute(y,g)}return R.prototype.getCurve=function(){return this._curve},R.prototype.getPoints=function(){return this._curve},R.prototype.length=function(){return this._distances[this._distances.length-1]},R.prototype.getTangents=function(){return this._tangents},R.prototype.getNormals=function(){return this._normals},R.prototype.getBinormals=function(){return this._binormals},R.prototype.getDistances=function(){return this._distances},R.prototype.getPointAt=function(I){return this._updatePointAtData(I).point},R.prototype.getTangentAt=function(I,y){return y===void 0&&(y=!1),this._updatePointAtData(I,y),y?E.e.TransformCoordinates(E.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},R.prototype.getNormalAt=function(I,y){return y===void 0&&(y=!1),this._updatePointAtData(I,y),y?E.e.TransformCoordinates(E.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},R.prototype.getBinormalAt=function(I,y){return y===void 0&&(y=!1),this._updatePointAtData(I,y),y?E.e.TransformCoordinates(E.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},R.prototype.getDistanceAt=function(I){return this.length()*I},R.prototype.getPreviousPointIndexAt=function(I){return this._updatePointAtData(I),this._pointAtData.previousPointArrayIndex},R.prototype.getSubPositionAt=function(I){return this._updatePointAtData(I),this._pointAtData.subPosition},R.prototype.getClosestPositionTo=function(I){for(var y=Number.MAX_VALUE,p=0,g=0;g<this._curve.length-1;g++){var C=this._curve[g+0],P=this._curve[g+1].subtract(C).normalize(),F=this._distances[g+1]-this._distances[g+0],U=Math.min(Math.max(E.e.Dot(P,I.subtract(C).normalize()),0)*E.e.Distance(C,I)/F,1),B=E.e.Distance(C.add(P.scale(U*F)),I);B<y&&(y=B,p=(this._distances[g+0]+F*U)/this.length())}return p},R.prototype.slice=function(I,y){if(I===void 0&&(I=0),y===void 0&&(y=1),I<0&&(I=1- -1*I%1),y<0&&(y=1- -1*y%1),I>y){var p=I;I=y,y=p}var g=this.getCurve(),C=this.getPointAt(I),P=this.getPreviousPointIndexAt(I),F=this.getPointAt(y),U=this.getPreviousPointIndexAt(y)+1,B=[];return I!==0&&(P++,B.push(C)),B.push.apply(B,g.slice(P,U)),y===1&&I!==1||B.push(F),new R(B,this.getNormalAt(I),this._raw,this._alignTangentsWithPath)},R.prototype.update=function(I,y,p){y===void 0&&(y=null),p===void 0&&(p=!1);for(var g=0;g<I.length;g++)this._curve[g].x=I[g].x,this._curve[g].y=I[g].y,this._curve[g].z=I[g].z;return this._compute(y,p),this},R.prototype._compute=function(I,y){y===void 0&&(y=!1);var p=this._curve.length;if(!(p<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[p-1]=this._curve[p-1].subtract(this._curve[p-2]),this._raw||this._tangents[p-1].normalize();var g,C,P,F,U,B=this._tangents[0],L=this._normalVector(B,I);this._normals[0]=L,this._raw||this._normals[0].normalize(),this._binormals[0]=E.e.Cross(B,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var z=1;z<p;z++)g=this._getLastNonNullVector(z),z<p-1&&(C=this._getFirstNonNullVector(z),this._tangents[z]=y?C:g.add(C),this._tangents[z].normalize()),this._distances[z]=this._distances[z-1]+this._curve[z].subtract(this._curve[z-1]).length(),P=this._tangents[z],U=this._binormals[z-1],this._normals[z]=E.e.Cross(U,P),this._raw||(this._normals[z].length()===0?(F=this._normals[z-1],this._normals[z]=F.clone()):this._normals[z].normalize()),this._binormals[z]=E.e.Cross(P,this._normals[z]),this._raw||this._binormals[z].normalize();this._pointAtData.id=NaN}},R.prototype._getFirstNonNullVector=function(I){for(var y=1,p=this._curve[I+y].subtract(this._curve[I]);p.length()===0&&I+y+1<this._curve.length;)y++,p=this._curve[I+y].subtract(this._curve[I]);return p},R.prototype._getLastNonNullVector=function(I){for(var y=1,p=this._curve[I].subtract(this._curve[I-y]);p.length()===0&&I>y+1;)y++,p=this._curve[I].subtract(this._curve[I-y]);return p},R.prototype._normalVector=function(I,y){var p,g,C=I.length();return C===0&&(C=1),y==null?(g=m.a.WithinEpsilon(Math.abs(I.y)/C,1,d.a)?m.a.WithinEpsilon(Math.abs(I.x)/C,1,d.a)?m.a.WithinEpsilon(Math.abs(I.z)/C,1,d.a)?E.e.Zero():new E.e(0,0,1):new E.e(1,0,0):new E.e(0,-1,0),p=E.e.Cross(I,g)):(p=E.e.Cross(I,y),E.e.CrossToRef(p,I,p)),p.normalize(),p},R.prototype._updatePointAtData=function(I,y){if(y===void 0&&(y=!1),this._pointAtData.id===I)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=I;var p=this.getPoints();if(I<=0)return this._setPointAtData(0,0,p[0],0,y);if(I>=1)return this._setPointAtData(1,1,p[p.length-1],p.length-1,y);for(var g,C=p[0],P=0,F=I*this.length(),U=1;U<p.length;U++){g=p[U];var B=E.e.Distance(C,g);if((P+=B)===F)return this._setPointAtData(I,1,g,U,y);if(P>F){var L=(P-F)/B,z=C.subtract(g),X=g.add(z.scaleInPlace(L));return this._setPointAtData(I,1-L,X,U-1,y)}C=g}return this._pointAtData},R.prototype._setPointAtData=function(I,y,p,g,C){return this._pointAtData.point=p,this._pointAtData.position=I,this._pointAtData.subPosition=y,this._pointAtData.previousPointArrayIndex=g,this._pointAtData.interpolateReady=C,C&&this._updateInterpolationMatrix(),this._pointAtData},R.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=E.a.Identity();var I=this._pointAtData.previousPointArrayIndex;if(I!==this._tangents.length-1){var y=I+1,p=this._tangents[I].clone(),g=this._normals[I].clone(),C=this._binormals[I].clone(),P=this._tangents[y].clone(),F=this._normals[y].clone(),U=this._binormals[y].clone(),B=E.b.RotationQuaternionFromAxis(g,C,p),L=E.b.RotationQuaternionFromAxis(F,U,P);E.b.Slerp(B,L,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},R}(),O=function(){function R(I){this._length=0,this._points=I,this._length=this._computeLength(I)}return R.CreateQuadraticBezier=function(I,y,p,g){g=g>2?g:3;for(var C=new Array,P=function(U,B,L,z){return(1-U)*(1-U)*B+2*U*(1-U)*L+U*U*z},F=0;F<=g;F++)C.push(new E.e(P(F/g,I.x,y.x,p.x),P(F/g,I.y,y.y,p.y),P(F/g,I.z,y.z,p.z)));return new R(C)},R.CreateCubicBezier=function(I,y,p,g,C){C=C>3?C:4;for(var P=new Array,F=function(B,L,z,X,G){return(1-B)*(1-B)*(1-B)*L+3*B*(1-B)*(1-B)*z+3*B*B*(1-B)*X+B*B*B*G},U=0;U<=C;U++)P.push(new E.e(F(U/C,I.x,y.x,p.x,g.x),F(U/C,I.y,y.y,p.y,g.y),F(U/C,I.z,y.z,p.z,g.z)));return new R(P)},R.CreateHermiteSpline=function(I,y,p,g,C){for(var P=new Array,F=1/C,U=0;U<=C;U++)P.push(E.e.Hermite(I,y,p,g,U*F));return new R(P)},R.CreateCatmullRomSpline=function(I,y,p){var g=new Array,C=1/y,P=0;if(p){for(var F=I.length,U=0;U<F;U++){P=0;for(var B=0;B<y;B++)g.push(E.e.CatmullRom(I[U%F],I[(U+1)%F],I[(U+2)%F],I[(U+3)%F],P)),P+=C}g.push(g[0])}else{var L=new Array;for(L.push(I[0].clone()),Array.prototype.push.apply(L,I),L.push(I[I.length-1].clone()),U=0;U<L.length-3;U++)for(P=0,B=0;B<y;B++)g.push(E.e.CatmullRom(L[U],L[U+1],L[U+2],L[U+3],P)),P+=C;U--,g.push(E.e.CatmullRom(L[U],L[U+1],L[U+2],L[U+3],P))}return new R(g)},R.prototype.getPoints=function(){return this._points},R.prototype.length=function(){return this._length},R.prototype.continue=function(I){for(var y=this._points[this._points.length-1],p=this._points.slice(),g=I.getPoints(),C=1;C<g.length;C++)p.push(g[C].subtract(g[0]).add(y));return new R(p)},R.prototype._computeLength=function(I){for(var y=0,p=1;p<I.length;p++)y+=I[p].subtract(I[p-1]).length();return y},R}()},function(f,s,c){c.d(s,"a",function(){return p});var T=c(1),m=c(3),E=c(0),d=c(4),x=c(10),M=c(15),w=c(25),S=c(11),_=c(9),O=c(67),R=c(49),I=c(13),y={effect:null,subMesh:null},p=function(g){function C(P,F,U,B){B===void 0&&(B={});var L=g.call(this,P,F)||this;return L._textures={},L._textureArrays={},L._floats={},L._ints={},L._floatsArrays={},L._colors3={},L._colors3Arrays={},L._colors4={},L._colors4Arrays={},L._vectors2={},L._vectors3={},L._vectors4={},L._matrices={},L._matrixArrays={},L._matrices3x3={},L._matrices2x2={},L._vectors2Arrays={},L._vectors3Arrays={},L._vectors4Arrays={},L._cachedWorldViewMatrix=new E.a,L._cachedWorldViewProjectionMatrix=new E.a,L._multiview=!1,L._shaderPath=U,L._options=Object(T.a)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},B),L}return Object(T.d)(C,g),Object.defineProperty(C.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(P){this._shaderPath=P},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),C.prototype.getClassName=function(){return"ShaderMaterial"},C.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},C.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},C.prototype._checkUniform=function(P){this._options.uniforms.indexOf(P)===-1&&this._options.uniforms.push(P)},C.prototype.setTexture=function(P,F){return this._options.samplers.indexOf(P)===-1&&this._options.samplers.push(P),this._textures[P]=F,this},C.prototype.setTextureArray=function(P,F){return this._options.samplers.indexOf(P)===-1&&this._options.samplers.push(P),this._checkUniform(P),this._textureArrays[P]=F,this},C.prototype.setFloat=function(P,F){return this._checkUniform(P),this._floats[P]=F,this},C.prototype.setInt=function(P,F){return this._checkUniform(P),this._ints[P]=F,this},C.prototype.setFloats=function(P,F){return this._checkUniform(P),this._floatsArrays[P]=F,this},C.prototype.setColor3=function(P,F){return this._checkUniform(P),this._colors3[P]=F,this},C.prototype.setColor3Array=function(P,F){return this._checkUniform(P),this._colors3Arrays[P]=F.reduce(function(U,B){return B.toArray(U,U.length),U},[]),this},C.prototype.setColor4=function(P,F){return this._checkUniform(P),this._colors4[P]=F,this},C.prototype.setColor4Array=function(P,F){return this._checkUniform(P),this._colors4Arrays[P]=F.reduce(function(U,B){return B.toArray(U,U.length),U},[]),this},C.prototype.setVector2=function(P,F){return this._checkUniform(P),this._vectors2[P]=F,this},C.prototype.setVector3=function(P,F){return this._checkUniform(P),this._vectors3[P]=F,this},C.prototype.setVector4=function(P,F){return this._checkUniform(P),this._vectors4[P]=F,this},C.prototype.setMatrix=function(P,F){return this._checkUniform(P),this._matrices[P]=F,this},C.prototype.setMatrices=function(P,F){this._checkUniform(P);for(var U=new Float32Array(16*F.length),B=0;B<F.length;B++)F[B].copyToArray(U,16*B);return this._matrixArrays[P]=U,this},C.prototype.setMatrix3x3=function(P,F){return this._checkUniform(P),this._matrices3x3[P]=F,this},C.prototype.setMatrix2x2=function(P,F){return this._checkUniform(P),this._matrices2x2[P]=F,this},C.prototype.setArray2=function(P,F){return this._checkUniform(P),this._vectors2Arrays[P]=F,this},C.prototype.setArray3=function(P,F){return this._checkUniform(P),this._vectors3Arrays[P]=F,this},C.prototype.setArray4=function(P,F){return this._checkUniform(P),this._vectors4Arrays[P]=F,this},C.prototype._checkCache=function(P,F){return!P||!this._effect||this._effect.defines.indexOf("#define INSTANCES")!==-1===F},C.prototype.isReadyForSubMesh=function(P,F,U){return this.isReady(P,U)},C.prototype.isReady=function(P,F){var U,B;if(this._effect&&this.isFrozen&&this._effect._wasPreviouslyReady)return!0;var L=this.getScene(),z=L.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===L.getRenderId()&&this._checkCache(P,F))return!0;var X=[],G=[],ee=new O.a;z.getCaps().multiview&&L.activeCamera&&L.activeCamera.outputRenderTarget&&L.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,X.push("#define MULTIVIEW"),this._options.uniforms.indexOf("viewProjection")!==-1&&this._options.uniforms.push("viewProjectionR")===-1&&this._options.uniforms.push("viewProjectionR"));for(var $=0;$<this._options.defines.length;$++)X.push(this._options.defines[$]);for($=0;$<this._options.attributes.length;$++)G.push(this._options.attributes[$]);P&&P.isVerticesDataPresent(d.b.ColorKind)&&(G.push(d.b.ColorKind),X.push("#define VERTEXCOLOR")),F&&(X.push("#define INSTANCES"),M.a.PushAttributesForInstances(G),(P==null?void 0:P.hasThinInstances)&&X.push("#define THIN_INSTANCES"));var fe=0;if(P&&P.useBones&&P.computeBonesUsingShaders&&P.skeleton){G.push(d.b.MatricesIndicesKind),G.push(d.b.MatricesWeightsKind),P.numBoneInfluencers>4&&(G.push(d.b.MatricesIndicesExtraKind),G.push(d.b.MatricesWeightsExtraKind));var me=P.skeleton;fe=P.numBoneInfluencers,X.push("#define NUM_BONE_INFLUENCERS "+fe),ee.addCPUSkinningFallback(0,P),me.isUsingTextureForMatrices?(X.push("#define BONETEXTURE"),this._options.uniforms.indexOf("boneTextureWidth")===-1&&this._options.uniforms.push("boneTextureWidth"),this._options.samplers.indexOf("boneSampler")===-1&&this._options.samplers.push("boneSampler")):(X.push("#define BonesPerMesh "+(me.bones.length+1)),this._options.uniforms.indexOf("mBones")===-1&&this._options.uniforms.push("mBones"))}else X.push("#define NUM_BONE_INFLUENCERS 0");for(var ve in this._textures)if(!this._textures[ve].isReady())return!1;P&&this._shouldTurnAlphaTestOn(P)&&X.push("#define ALPHATEST");var be=this._shaderPath,ie=this._options.uniforms,se=this._options.uniformBuffers,V=this._options.samplers;this.customShaderNameResolve&&(ie=ie.slice(),se=se.slice(),V=V.slice(),be=this.customShaderNameResolve(be,ie,se,V,X,G));var K=this._effect,Z=X.join(`
`);return this._cachedDefines!==Z&&(this._cachedDefines=Z,this._effect=z.createEffect(be,{attributes:G,uniformsNames:ie,uniformBuffersNames:se,samplers:V,defines:Z,fallbacks:ee,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:fe}},z),this._onEffectCreatedObservable&&(y.effect=this._effect,this._onEffectCreatedObservable.notifyObservers(y))),(B=!((U=this._effect)===null||U===void 0?void 0:U.isReady()))!==null&&B!==void 0&&!B&&(K!==this._effect&&L.resetCachedMaterial(),this._renderId=L.getRenderId(),this._effect._wasPreviouslyReady=!0,!0)},C.prototype.bindOnlyWorldMatrix=function(P,F){var U=this.getScene(),B=F??this._effect;B&&(this._options.uniforms.indexOf("world")!==-1&&B.setMatrix("world",P),this._options.uniforms.indexOf("worldView")!==-1&&(P.multiplyToRef(U.getViewMatrix(),this._cachedWorldViewMatrix),B.setMatrix("worldView",this._cachedWorldViewMatrix)),this._options.uniforms.indexOf("worldViewProjection")!==-1&&(P.multiplyToRef(U.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),B.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},C.prototype.bindForSubMesh=function(P,F,U){this.bind(P,F,U._effectOverride)},C.prototype.bind=function(P,F,U){this.bindOnlyWorldMatrix(P,U);var B=U??this._effect;if(B&&this.getScene().getCachedMaterial()!==this){var L;for(L in this._options.uniforms.indexOf("view")!==-1&&B.setMatrix("view",this.getScene().getViewMatrix()),this._options.uniforms.indexOf("projection")!==-1&&B.setMatrix("projection",this.getScene().getProjectionMatrix()),this._options.uniforms.indexOf("viewProjection")!==-1&&(B.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&B.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1&&B.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),M.a.BindBonesParameters(F,B),this._textures)B.setTexture(L,this._textures[L]);for(L in this._textureArrays)B.setTextureArray(L,this._textureArrays[L]);for(L in this._ints)B.setInt(L,this._ints[L]);for(L in this._floats)B.setFloat(L,this._floats[L]);for(L in this._floatsArrays)B.setArray(L,this._floatsArrays[L]);for(L in this._colors3)B.setColor3(L,this._colors3[L]);for(L in this._colors3Arrays)B.setArray3(L,this._colors3Arrays[L]);for(L in this._colors4){var z=this._colors4[L];B.setFloat4(L,z.r,z.g,z.b,z.a)}for(L in this._colors4Arrays)B.setArray4(L,this._colors4Arrays[L]);for(L in this._vectors2)B.setVector2(L,this._vectors2[L]);for(L in this._vectors3)B.setVector3(L,this._vectors3[L]);for(L in this._vectors4)B.setVector4(L,this._vectors4[L]);for(L in this._matrices)B.setMatrix(L,this._matrices[L]);for(L in this._matrixArrays)B.setMatrices(L,this._matrixArrays[L]);for(L in this._matrices3x3)B.setMatrix3x3(L,this._matrices3x3[L]);for(L in this._matrices2x2)B.setMatrix2x2(L,this._matrices2x2[L]);for(L in this._vectors2Arrays)B.setArray2(L,this._vectors2Arrays[L]);for(L in this._vectors3Arrays)B.setArray3(L,this._vectors3Arrays[L]);for(L in this._vectors4Arrays)B.setArray4(L,this._vectors4Arrays[L])}var X=this._effect;this._effect=B,this._afterBind(F),this._effect=X},C.prototype._afterBind=function(P){g.prototype._afterBind.call(this,P),this.getScene()._cachedEffect=this._effect},C.prototype.getActiveTextures=function(){var P=g.prototype.getActiveTextures.call(this);for(var F in this._textures)P.push(this._textures[F]);for(var F in this._textureArrays)for(var U=this._textureArrays[F],B=0;B<U.length;B++)P.push(U[B]);return P},C.prototype.hasTexture=function(P){if(g.prototype.hasTexture.call(this,P))return!0;for(var F in this._textures)if(this._textures[F]===P)return!0;for(var F in this._textureArrays)for(var U=this._textureArrays[F],B=0;B<U.length;B++)if(U[B]===P)return!0;return!1},C.prototype.clone=function(P){var F=this,U=m.a.Clone(function(){return new C(P,F.getScene(),F._shaderPath,F._options)},this);for(var B in U.name=P,U.id=P,typeof U._shaderPath=="object"&&(U._shaderPath=Object(T.a)({},U._shaderPath)),this._options=Object(T.a)({},this._options),Object.keys(this._options).forEach(function(L){var z=F._options[L];Array.isArray(z)&&(F._options[L]=z.slice(0))}),this._textures)U.setTexture(B,this._textures[B]);for(var B in this._floats)U.setFloat(B,this._floats[B]);for(var B in this._floatsArrays)U.setFloats(B,this._floatsArrays[B]);for(var B in this._colors3)U.setColor3(B,this._colors3[B]);for(var B in this._colors4)U.setColor4(B,this._colors4[B]);for(var B in this._vectors2)U.setVector2(B,this._vectors2[B]);for(var B in this._vectors3)U.setVector3(B,this._vectors3[B]);for(var B in this._vectors4)U.setVector4(B,this._vectors4[B]);for(var B in this._matrices)U.setMatrix(B,this._matrices[B]);for(var B in this._matrices3x3)U.setMatrix3x3(B,this._matrices3x3[B]);for(var B in this._matrices2x2)U.setMatrix2x2(B,this._matrices2x2[B]);return U},C.prototype.dispose=function(P,F,U){if(F){var B;for(B in this._textures)this._textures[B].dispose();for(B in this._textureArrays)for(var L=this._textureArrays[B],z=0;z<L.length;z++)L[z].dispose()}this._textures={},g.prototype.dispose.call(this,P,F,U)},C.prototype.serialize=function(){var P,F=m.a.Serialize(this);for(P in F.customType="BABYLON.ShaderMaterial",F.options=this._options,F.shaderPath=this._shaderPath,F.textures={},this._textures)F.textures[P]=this._textures[P].serialize();for(P in F.textureArrays={},this._textureArrays){F.textureArrays[P]=[];for(var U=this._textureArrays[P],B=0;B<U.length;B++)F.textureArrays[P].push(U[B].serialize())}for(P in F.floats={},this._floats)F.floats[P]=this._floats[P];for(P in F.FloatArrays={},this._floatsArrays)F.FloatArrays[P]=this._floatsArrays[P];for(P in F.colors3={},this._colors3)F.colors3[P]=this._colors3[P].asArray();for(P in F.colors3Arrays={},this._colors3Arrays)F.colors3Arrays[P]=this._colors3Arrays[P];for(P in F.colors4={},this._colors4)F.colors4[P]=this._colors4[P].asArray();for(P in F.colors4Arrays={},this._colors4Arrays)F.colors4Arrays[P]=this._colors4Arrays[P];for(P in F.vectors2={},this._vectors2)F.vectors2[P]=this._vectors2[P].asArray();for(P in F.vectors3={},this._vectors3)F.vectors3[P]=this._vectors3[P].asArray();for(P in F.vectors4={},this._vectors4)F.vectors4[P]=this._vectors4[P].asArray();for(P in F.matrices={},this._matrices)F.matrices[P]=this._matrices[P].asArray();for(P in F.matrixArray={},this._matrixArrays)F.matrixArray[P]=this._matrixArrays[P];for(P in F.matrices3x3={},this._matrices3x3)F.matrices3x3[P]=this._matrices3x3[P];for(P in F.matrices2x2={},this._matrices2x2)F.matrices2x2[P]=this._matrices2x2[P];for(P in F.vectors2Arrays={},this._vectors2Arrays)F.vectors2Arrays[P]=this._vectors2Arrays[P];for(P in F.vectors3Arrays={},this._vectors3Arrays)F.vectors3Arrays[P]=this._vectors3Arrays[P];for(P in F.vectors4Arrays={},this._vectors4Arrays)F.vectors4Arrays[P]=this._vectors4Arrays[P];return F},C.Parse=function(P,F,U){var B,L=m.a.Parse(function(){return new C(P.name,F,P.shaderPath,P.options)},P,F,U);for(B in P.textures)L.setTexture(B,x.a.Parse(P.textures[B],F,U));for(B in P.textureArrays){for(var z=P.textureArrays[B],X=new Array,G=0;G<z.length;G++)X.push(x.a.Parse(z[G],F,U));L.setTextureArray(B,X)}for(B in P.floats)L.setFloat(B,P.floats[B]);for(B in P.floatsArrays)L.setFloats(B,P.floatsArrays[B]);for(B in P.colors3)L.setColor3(B,_.a.FromArray(P.colors3[B]));for(B in P.colors3Arrays){var ee=P.colors3Arrays[B].reduce(function($,fe,me){return me%3==0?$.push([fe]):$[$.length-1].push(fe),$},[]).map(function($){return _.a.FromArray($)});L.setColor3Array(B,ee)}for(B in P.colors4)L.setColor4(B,_.b.FromArray(P.colors4[B]));for(B in P.colors4Arrays)ee=P.colors4Arrays[B].reduce(function($,fe,me){return me%4==0?$.push([fe]):$[$.length-1].push(fe),$},[]).map(function($){return _.b.FromArray($)}),L.setColor4Array(B,ee);for(B in P.vectors2)L.setVector2(B,E.d.FromArray(P.vectors2[B]));for(B in P.vectors3)L.setVector3(B,E.e.FromArray(P.vectors3[B]));for(B in P.vectors4)L.setVector4(B,E.f.FromArray(P.vectors4[B]));for(B in P.matrices)L.setMatrix(B,E.a.FromArray(P.matrices[B]));for(B in P.matrixArray)L._matrixArrays[B]=new Float32Array(P.matrixArray[B]);for(B in P.matrices3x3)L.setMatrix3x3(B,P.matrices3x3[B]);for(B in P.matrices2x2)L.setMatrix2x2(B,P.matrices2x2[B]);for(B in P.vectors2Arrays)L.setArray2(B,P.vectors2Arrays[B]);for(B in P.vectors3Arrays)L.setArray3(B,P.vectors3Arrays[B]);for(B in P.vectors4Arrays)L.setArray4(B,P.vectors4Arrays[B]);return L},C.ParseFromFileAsync=function(P,F,U,B){var L=this;return B===void 0&&(B=""),new Promise(function(z,X){var G=new R.a;G.addEventListener("readystatechange",function(){if(G.readyState==4)if(G.status==200){var ee=JSON.parse(G.responseText),$=L.Parse(ee,U||I.a.LastCreatedScene,B);P&&($.name=P),z($)}else X("Unable to load the ShaderMaterial")}),G.open("GET",F),G.send()})},C.CreateFromSnippetAsync=function(P,F,U){var B=this;return U===void 0&&(U=""),new Promise(function(L,z){var X=new R.a;X.addEventListener("readystatechange",function(){if(X.readyState==4)if(X.status==200){var G=JSON.parse(JSON.parse(X.responseText).jsonPayload),ee=JSON.parse(G.shaderMaterial),$=B.Parse(ee,F||I.a.LastCreatedScene,U);$.snippetId=P,L($)}else z("Unable to load the snippet "+P)}),X.open("GET",B.SnippetUrl+"/"+P.replace(/#/g,"/")),X.send()})},C.SnippetUrl="https://snippet.babylonjs.com",C}(w.a);S.a.RegisteredTypes["BABYLON.ShaderMaterial"]=p},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.SetMatrixPrecision=function(E){if(m.MatrixTrackPrecisionChange=!1,E&&!m.MatrixUse64Bits&&m.MatrixTrackedMatrices)for(var d=0;d<m.MatrixTrackedMatrices.length;++d){var x=m.MatrixTrackedMatrices[d],M=x._m;x._m=new Array(16);for(var w=0;w<16;++w)x._m[w]=M[w]}m.MatrixUse64Bits=E,m.MatrixCurrentType=m.MatrixUse64Bits?Array:Float32Array,m.MatrixTrackedMatrices=null},m.MatrixUse64Bits=!1,m.MatrixTrackPrecisionChange=!0,m.MatrixCurrentType=Float32Array,m.MatrixTrackedMatrices=[],m}()},function(f,s,c){c.d(s,"a",function(){return I});var T=c(1),m=c(6),E=c(0),d=c(46),x=c(7),M=c(53),w=c(65),S=c(51),_=c(36),O=c(30),R=c(9),I=function(y){function p(g,C,P,F,U){var B;C===void 0&&(C=R.a.Gray()),P===void 0&&(P=_.a.DefaultUtilityLayer),F===void 0&&(F=null),U===void 0&&(U=1);var L=y.call(this,P)||this;L._pointerObserver=null,L.snapDistance=0,L.onSnapObservable=new m.c,L._isEnabled=!0,L._parent=null,L._dragging=!1,L._parent=F,L._coloredMaterial=new O.a("",P.utilityLayerScene),L._coloredMaterial.diffuseColor=C,L._coloredMaterial.specularColor=C.subtract(new R.a(.1,.1,.1)),L._hoverMaterial=new O.a("",P.utilityLayerScene),L._hoverMaterial.diffuseColor=R.a.Yellow(),L._disableMaterial=new O.a("",P.utilityLayerScene),L._disableMaterial.diffuseColor=R.a.Gray(),L._disableMaterial.alpha=.4;var z=p._CreateArrow(P.utilityLayerScene,L._coloredMaterial,U),X=p._CreateArrow(P.utilityLayerScene,L._coloredMaterial,U+4,!0);L._gizmoMesh=new x.a("",P.utilityLayerScene),L._gizmoMesh.addChild(z),L._gizmoMesh.addChild(X),L._gizmoMesh.lookAt(L._rootMesh.position.add(g)),L._gizmoMesh.scaling.scaleInPlace(1/3),L._gizmoMesh.parent=L._rootMesh;var G=0,ee=new E.e,$={snapDistance:0};L.dragBehavior=new w.a({dragAxis:g}),L.dragBehavior.moveAttached=!1,L._rootMesh.addBehavior(L.dragBehavior),L.dragBehavior.onDragObservable.add(function(ve){if(L.attachedNode){if(L.snapDistance==0)L.attachedNode.position&&L.attachedNode.position.addInPlaceFromFloats(ve.delta.x,ve.delta.y,ve.delta.z),L.attachedNode.getWorldMatrix().addTranslationFromFloats(ve.delta.x,ve.delta.y,ve.delta.z),L.attachedNode.updateCache();else if(G+=ve.dragDistance,Math.abs(G)>L.snapDistance){var be=Math.floor(Math.abs(G)/L.snapDistance);G%=L.snapDistance,ve.delta.normalizeToRef(ee),ee.scaleInPlace(L.snapDistance*be),L.attachedNode.getWorldMatrix().addTranslationFromFloats(ee.x,ee.y,ee.z),L.attachedNode.updateCache(),$.snapDistance=L.snapDistance*be,L.onSnapObservable.notifyObservers($)}L._matrixChanged()}}),L.dragBehavior.onDragStartObservable.add(function(){L._dragging=!0}),L.dragBehavior.onDragEndObservable.add(function(){L._dragging=!1});var fe=P._getSharedGizmoLight();fe.includedOnlyMeshes=fe.includedOnlyMeshes.concat(L._rootMesh.getChildMeshes(!1));var me={gizmoMeshes:z.getChildMeshes(),colliderMeshes:X.getChildMeshes(),material:L._coloredMaterial,hoverMaterial:L._hoverMaterial,disableMaterial:L._disableMaterial,active:!1};return(B=L._parent)===null||B===void 0||B.addToAxisCache(X,me),L._pointerObserver=P.utilityLayerScene.onPointerObservable.add(function(ve){var be;if(!L._customMeshSet&&(L._isHovered=me.colliderMeshes.indexOf((be=ve==null?void 0:ve.pickInfo)===null||be===void 0?void 0:be.pickedMesh)!=-1,!L._parent)){var ie=L._isHovered||L._dragging?L._hoverMaterial:L._coloredMaterial;me.gizmoMeshes.forEach(function(se){se.material=ie,se.color&&(se.color=ie.diffuseColor)})}}),L}return Object(T.d)(p,y),p._CreateArrow=function(g,C,P,F){P===void 0&&(P=1),F===void 0&&(F=!1);var U=new d.a("arrow",g),B=M.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(P-1)/4),tessellation:96},g),L=M.a.CreateCylinder("cylinder",{diameterTop:.005*P,height:.275,diameterBottom:.005*P,tessellation:96},g);return B.parent=U,B.material=C,B.rotation.x=Math.PI/2,B.position.z+=.3,L.parent=U,L.material=C,L.position.z+=.1375,L.rotation.x=Math.PI/2,F&&(L.visibility=0,B.visibility=0),U},p._CreateArrowInstance=function(g,C){for(var P=new d.a("arrow",g),F=0,U=C.getChildMeshes();F<U.length;F++){var B=U[F];B.createInstance(B.name).parent=P}return P},p.prototype._attachedNodeChanged=function(g){this.dragBehavior&&(this.dragBehavior.enabled=!!g)},Object.defineProperty(p.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(g){this._isEnabled=g,g?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),p.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(g){g&&g.dispose()}),y.prototype.dispose.call(this)},p}(S.a)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),m.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},m.prototype.markAsUnprocessed=function(){this._isDirty=!0},m.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},m.prototype.markAsLightDirty=function(E){E===void 0&&(E=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||E,this._isDirty=!0},m.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},m.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},m.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},m.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},m.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},m.prototype.rebuild=function(){this._keys=[];for(var E=0,d=Object.keys(this);E<d.length;E++){var x=d[E];x[0]!=="_"&&this._keys.push(x)}},m.prototype.isEqual=function(E){if(this._keys.length!==E._keys.length)return!1;for(var d=0;d<this._keys.length;d++){var x=this._keys[d];if(this[x]!==E[x])return!1}return!0},m.prototype.cloneTo=function(E){this._keys.length!==E._keys.length&&(E._keys=this._keys.slice(0));for(var d=0;d<this._keys.length;d++){var x=this._keys[d];E[x]=this[x]}},m.prototype.reset=function(){for(var E=0;E<this._keys.length;E++){var d=this._keys[E];switch(typeof this[d]){case"number":this[d]=0;break;case"string":this[d]="";break;default:this[d]=!1}}},m.prototype.toString=function(){for(var E="",d=0;d<this._keys.length;d++){var x=this._keys[d],M=this[x];switch(typeof M){case"number":case"string":E+="#define "+x+" "+M+`
`;break;default:M&&(E+="#define "+x+`
`)}}return E},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(E,d){this.width=E,this.height=d}return m.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},m.prototype.getClassName=function(){return"Size"},m.prototype.getHashCode=function(){var E=0|this.width;return E=397*E^(0|this.height)},m.prototype.copyFrom=function(E){this.width=E.width,this.height=E.height},m.prototype.copyFromFloats=function(E,d){return this.width=E,this.height=d,this},m.prototype.set=function(E,d){return this.copyFromFloats(E,d)},m.prototype.multiplyByFloats=function(E,d){return new m(this.width*E,this.height*d)},m.prototype.clone=function(){return new m(this.width,this.height)},m.prototype.equals=function(E){return!!E&&this.width===E.width&&this.height===E.height},Object.defineProperty(m.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),m.Zero=function(){return new m(0,0)},m.prototype.add=function(E){return new m(this.width+E.width,this.height+E.height)},m.prototype.subtract=function(E){return new m(this.width-E.width,this.height-E.height)},m.Lerp=function(E,d,x){return new m(E.width+(d.width-E.width)*x,E.height+(d.height-E.height)*x)},m}()},function(f,s,c){var T="bonesDeclaration",m=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="instancesDeclaration",m=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#ifdef THIN_INSTANCES
uniform mat4 world;
#endif
#else
uniform mat4 world;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="instancesVertex",m=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#endif
#else
mat4 finalWorld=world;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;c(5).a.IncludesShadersStore.bonesVertex=T},function(f,s,c){c.d(s,"a",function(){return M});var T=c(0),m=c(7),E=c(4),d=c(16),x=c(43);d.a.CreateRibbon=function(w){var S=w.pathArray,_=w.closeArray||!1,O=w.closePath||!1,R=w.invertUV||!1,I=Math.floor(S[0].length/2),y=w.offset||I;y=y>I?I:Math.floor(y);var p,g,C,P,F=w.sideOrientation===0?0:w.sideOrientation||d.a.DEFAULTSIDE,U=w.uvs,B=w.colors,L=[],z=[],X=[],G=[],ee=[],$=[],fe=[],me=[],ve=[],be=[];if(S.length<2){var ie=[],se=[];for(C=0;C<S[0].length-y;C++)ie.push(S[0][C]),se.push(S[0][C+y]);S=[ie,se]}var V,K,Z,le,re,Q=0,W=O?1:0;for(p=S[0].length,g=0;g<S.length;g++){for(fe[g]=0,ee[g]=[0],p=p<(K=(V=S[g]).length)?p:K,P=0;P<K;)L.push(V[P].x,V[P].y,V[P].z),P>0&&(Z=V[P].subtract(V[P-1]).length()+fe[g],ee[g].push(Z),fe[g]=Z),P++;O&&(P--,L.push(V[0].x,V[0].y,V[0].z),Z=V[P].subtract(V[0]).length()+fe[g],ee[g].push(Z),fe[g]=Z),ve[g]=K+W,be[g]=Q,Q+=K+W}var Y,q,ae=null,pe=null;for(C=0;C<p+W;C++){for(me[C]=0,$[C]=[0],g=0;g<S.length-1;g++)le=S[g],re=S[g+1],C===p?(ae=le[0],pe=re[0]):(ae=le[C],pe=re[C]),Z=pe.subtract(ae).length()+me[C],$[C].push(Z),me[C]=Z;_&&pe&&ae&&(le=S[g],re=S[0],C===p&&(pe=re[0]),Z=pe.subtract(ae).length()+me[C],me[C]=Z)}if(U)for(g=0;g<U.length;g++)G.push(U[g].x,U[g].y);else for(g=0;g<S.length;g++)for(C=0;C<p+W;C++)Y=fe[g]!=0?ee[g][C]/fe[g]:0,q=me[C]!=0?$[C][g]/me[C]:0,R?G.push(q,Y):G.push(Y,q);for(var De=0,de=ve[g=0]-1,ge=ve[g+1]-1,ne=de<ge?de:ge,Te=be[1]-be[0],we=_?ve.length:ve.length-1;De<=ne&&g<we;)z.push(De,De+Te,De+1),z.push(De+Te+1,De+1,De+Te),(De+=1)===ne&&(++g==ve.length-1?(Te=be[0]-be[g],de=ve[g]-1,ge=ve[0]-1):(Te=be[g+1]-be[g],de=ve[g]-1,ge=ve[g+1]-1),De=be[g],ne=de<ge?de+De:ge+De);if(d.a.ComputeNormals(L,z,X),O){var Se=0,Ge=0;for(g=0;g<S.length;g++)Se=3*be[g],Ge=g+1<S.length?3*(be[g+1]-1):X.length-3,X[Se]=.5*(X[Se]+X[Ge]),X[Se+1]=.5*(X[Se+1]+X[Ge+1]),X[Se+2]=.5*(X[Se+2]+X[Ge+2]),X[Ge]=X[Se],X[Ge+1]=X[Se+1],X[Ge+2]=X[Se+2]}d.a._ComputeSides(F,L,z,X,G,w.frontUVs,w.backUVs);var $e=null;if(B){$e=new Float32Array(4*B.length);for(var nt=0;nt<B.length;nt++)$e[4*nt]=B[nt].r,$e[4*nt+1]=B[nt].g,$e[4*nt+2]=B[nt].b,$e[4*nt+3]=B[nt].a}var et=new d.a,Ze=new Float32Array(L),ht=new Float32Array(X),gt=new Float32Array(G);return et.indices=z,et.positions=Ze,et.normals=ht,et.uvs=gt,$e&&et.set($e,E.b.ColorKind),O&&(et._idx=be),et},m.a.CreateRibbon=function(w,S,_,O,R,I,y,p,g){return _===void 0&&(_=!1),y===void 0&&(y=!1),M.CreateRibbon(w,{pathArray:S,closeArray:_,closePath:O,offset:R,updatable:y,sideOrientation:p,instance:g},I)};var M=function(){function w(){}return w.CreateRibbon=function(S,_,O){O===void 0&&(O=null);var R=_.pathArray,I=_.closeArray,y=_.closePath,p=m.a._GetDefaultSideOrientation(_.sideOrientation),g=_.instance,C=_.updatable;if(g){var P=T.c.Vector3[0].setAll(Number.MAX_VALUE),F=T.c.Vector3[1].setAll(-Number.MAX_VALUE),U=g.getVerticesData(E.b.PositionKind);if(function(K){for(var Z=R[0].length,le=g,re=0,Q=le._originalBuilderSideOrientation===m.a.DOUBLESIDE?2:1,W=1;W<=Q;++W)for(var Y=0;Y<R.length;++Y){var q=R[Y],ae=q.length;Z=Z<ae?Z:ae;for(var pe=0;pe<Z;++pe){var De=q[pe];K[re]=De.x,K[re+1]=De.y,K[re+2]=De.z,P.minimizeInPlaceFromFloats(De.x,De.y,De.z),F.maximizeInPlaceFromFloats(De.x,De.y,De.z),re+=3}le._creationDataStorage&&le._creationDataStorage.closePath&&(De=q[0],K[re]=De.x,K[re+1]=De.y,K[re+2]=De.z,re+=3)}}(U),g._boundingInfo?g._boundingInfo.reConstruct(P,F,g._worldMatrix):g._boundingInfo=new x.a(P,F,g._worldMatrix),g.updateVerticesData(E.b.PositionKind,U,!1,!1),_.colors){for(var B=g.getVerticesData(E.b.ColorKind),L=0,z=0;L<_.colors.length;L++,z+=4){var X=_.colors[L];B[z]=X.r,B[z+1]=X.g,B[z+2]=X.b,B[z+3]=X.a}g.updateVerticesData(E.b.ColorKind,B,!1,!1)}if(_.uvs){for(var G=g.getVerticesData(E.b.UVKind),ee=0;ee<_.uvs.length;ee++)G[2*ee]=_.uvs[ee].x,G[2*ee+1]=_.uvs[ee].y;g.updateVerticesData(E.b.UVKind,G,!1,!1)}if(!g.areNormalsFrozen||g.isFacetDataEnabled){var $=g.getIndices(),fe=g.getVerticesData(E.b.NormalKind),me=g.isFacetDataEnabled?g.getFacetDataParameters():null;if(d.a.ComputeNormals(U,$,fe,me),g._creationDataStorage&&g._creationDataStorage.closePath)for(var ve=0,be=0,ie=0;ie<R.length;ie++)ve=3*g._creationDataStorage.idx[ie],be=ie+1<R.length?3*(g._creationDataStorage.idx[ie+1]-1):fe.length-3,fe[ve]=.5*(fe[ve]+fe[be]),fe[ve+1]=.5*(fe[ve+1]+fe[be+1]),fe[ve+2]=.5*(fe[ve+2]+fe[be+2]),fe[be]=fe[ve],fe[be+1]=fe[ve+1],fe[be+2]=fe[ve+2];g.areNormalsFrozen||g.updateVerticesData(E.b.NormalKind,fe,!1,!1)}return g}var se=new m.a(S,O);se._originalBuilderSideOrientation=p,se._creationDataStorage=new m.b;var V=d.a.CreateRibbon(_);return y&&(se._creationDataStorage.idx=V._idx),se._creationDataStorage.closePath=y,se._creationDataStorage.closeArray=I,V.applyToMesh(se,C),se},w}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.FilesToLoad={},m}()},function(f,s,c){c.d(s,"a",function(){return E});var T=c(7),m=c(16);m.a.CreatePlane=function(d){var x=[],M=[],w=[],S=[],_=d.width||d.size||1,O=d.height||d.size||1,R=d.sideOrientation===0?0:d.sideOrientation||m.a.DEFAULTSIDE,I=_/2,y=O/2;M.push(-I,-y,0),w.push(0,0,-1),S.push(0,0),M.push(I,-y,0),w.push(0,0,-1),S.push(1,0),M.push(I,y,0),w.push(0,0,-1),S.push(1,1),M.push(-I,y,0),w.push(0,0,-1),S.push(0,1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),m.a._ComputeSides(R,M,x,w,S,d.frontUVs,d.backUVs);var p=new m.a;return p.indices=x,p.positions=M,p.normals=w,p.uvs=S,p},T.a.CreatePlane=function(d,x,M,w,S){var _={size:x,width:x,height:x,sideOrientation:S,updatable:w};return E.CreatePlane(d,_,M)};var E=function(){function d(){}return d.CreatePlane=function(x,M,w){w===void 0&&(w=null);var S=new T.a(x,w);return M.sideOrientation=T.a._GetDefaultSideOrientation(M.sideOrientation),S._originalBuilderSideOrientation=M.sideOrientation,m.a.CreatePlane(M).applyToMesh(S,M.updatable),M.sourcePlane&&(S.translate(M.sourcePlane.normal,-M.sourcePlane.d),S.setDirection(M.sourcePlane.normal.scale(-1))),S},d}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(8),m=(c(153),function(){function E(d,x,M){this._alreadyBound=!1,this._valueCache={},this._engine=d,this._noUBO=!d.supportsUniformBuffers,this._dynamic=M,this._data=x||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(E.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),E.prototype.isDynamic=function(){return this._dynamic!==void 0},E.prototype.getData=function(){return this._bufferData},E.prototype.getBuffer=function(){return this._buffer},E.prototype._fillAlignment=function(d){var x;if(x=d<=2?d:4,this._uniformLocationPointer%x!=0){var M=this._uniformLocationPointer;this._uniformLocationPointer+=x-this._uniformLocationPointer%x;for(var w=this._uniformLocationPointer-M,S=0;S<w;S++)this._data.push(0)}},E.prototype.addUniform=function(d,x){if(!this._noUBO&&this._uniformLocations[d]===void 0){var M;if(x instanceof Array)x=(M=x).length;else{x=x,M=[];for(var w=0;w<x;w++)M.push(0)}for(this._fillAlignment(x),this._uniformSizes[d]=x,this._uniformLocations[d]=this._uniformLocationPointer,this._uniformLocationPointer+=x,w=0;w<x;w++)this._data.push(M[w]);this._needSync=!0}},E.prototype.addMatrix=function(d,x){this.addUniform(d,Array.prototype.slice.call(x.toArray()))},E.prototype.addFloat2=function(d,x,M){var w=[x,M];this.addUniform(d,w)},E.prototype.addFloat3=function(d,x,M,w){var S=[x,M,w];this.addUniform(d,S)},E.prototype.addColor3=function(d,x){var M=new Array;x.toArray(M),this.addUniform(d,M)},E.prototype.addColor4=function(d,x,M){var w=new Array;x.toArray(w),w.push(M),this.addUniform(d,w)},E.prototype.addVector3=function(d,x){var M=new Array;x.toArray(M),this.addUniform(d,M)},E.prototype.addMatrix3x3=function(d){this.addUniform(d,12)},E.prototype.addMatrix2x2=function(d){this.addUniform(d,8)},E.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},E.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},E.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},E.prototype.updateUniform=function(d,x,M){var w=this._uniformLocations[d];if(w===void 0){if(this._buffer)return void T.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(d,M),w=this._uniformLocations[d]}if(this._buffer||this.create(),this._dynamic)for(_=0;_<M;_++)this._bufferData[w+_]=x[_];else{for(var S=!1,_=0;_<M;_++)M!==16&&this._bufferData[w+_]===x[_]||(S=!0,this._bufferData[w+_]=x[_]);this._needSync=this._needSync||S}},E.prototype._cacheMatrix=function(d,x){var M=this._valueCache[d],w=x.updateFlag;return(M===void 0||M!==w)&&(this._valueCache[d]=w,!0)},E.prototype._updateMatrix3x3ForUniform=function(d,x){for(var M=0;M<3;M++)E._tempBuffer[4*M]=x[3*M],E._tempBuffer[4*M+1]=x[3*M+1],E._tempBuffer[4*M+2]=x[3*M+2],E._tempBuffer[4*M+3]=0;this.updateUniform(d,E._tempBuffer,12)},E.prototype._updateMatrix3x3ForEffect=function(d,x){this._currentEffect.setMatrix3x3(d,x)},E.prototype._updateMatrix2x2ForEffect=function(d,x){this._currentEffect.setMatrix2x2(d,x)},E.prototype._updateMatrix2x2ForUniform=function(d,x){for(var M=0;M<2;M++)E._tempBuffer[4*M]=x[2*M],E._tempBuffer[4*M+1]=x[2*M+1],E._tempBuffer[4*M+2]=0,E._tempBuffer[4*M+3]=0;this.updateUniform(d,E._tempBuffer,8)},E.prototype._updateFloatForEffect=function(d,x){this._currentEffect.setFloat(d,x)},E.prototype._updateFloatForUniform=function(d,x){E._tempBuffer[0]=x,this.updateUniform(d,E._tempBuffer,1)},E.prototype._updateFloat2ForEffect=function(d,x,M,w){w===void 0&&(w=""),this._currentEffect.setFloat2(d+w,x,M)},E.prototype._updateFloat2ForUniform=function(d,x,M){E._tempBuffer[0]=x,E._tempBuffer[1]=M,this.updateUniform(d,E._tempBuffer,2)},E.prototype._updateFloat3ForEffect=function(d,x,M,w,S){S===void 0&&(S=""),this._currentEffect.setFloat3(d+S,x,M,w)},E.prototype._updateFloat3ForUniform=function(d,x,M,w){E._tempBuffer[0]=x,E._tempBuffer[1]=M,E._tempBuffer[2]=w,this.updateUniform(d,E._tempBuffer,3)},E.prototype._updateFloat4ForEffect=function(d,x,M,w,S,_){_===void 0&&(_=""),this._currentEffect.setFloat4(d+_,x,M,w,S)},E.prototype._updateFloat4ForUniform=function(d,x,M,w,S){E._tempBuffer[0]=x,E._tempBuffer[1]=M,E._tempBuffer[2]=w,E._tempBuffer[3]=S,this.updateUniform(d,E._tempBuffer,4)},E.prototype._updateMatrixForEffect=function(d,x){this._currentEffect.setMatrix(d,x)},E.prototype._updateMatrixForUniform=function(d,x){this._cacheMatrix(d,x)&&this.updateUniform(d,x.toArray(),16)},E.prototype._updateVector3ForEffect=function(d,x){this._currentEffect.setVector3(d,x)},E.prototype._updateVector3ForUniform=function(d,x){x.toArray(E._tempBuffer),this.updateUniform(d,E._tempBuffer,3)},E.prototype._updateVector4ForEffect=function(d,x){this._currentEffect.setVector4(d,x)},E.prototype._updateVector4ForUniform=function(d,x){x.toArray(E._tempBuffer),this.updateUniform(d,E._tempBuffer,4)},E.prototype._updateColor3ForEffect=function(d,x,M){M===void 0&&(M=""),this._currentEffect.setColor3(d+M,x)},E.prototype._updateColor3ForUniform=function(d,x){x.toArray(E._tempBuffer),this.updateUniform(d,E._tempBuffer,3)},E.prototype._updateColor4ForEffect=function(d,x,M,w){w===void 0&&(w=""),this._currentEffect.setColor4(d+w,x,M)},E.prototype._updateColor4ForUniform=function(d,x,M){x.toArray(E._tempBuffer),E._tempBuffer[3]=M,this.updateUniform(d,E._tempBuffer,4)},E.prototype.setTexture=function(d,x){this._currentEffect.setTexture(d,x)},E.prototype.updateUniformDirectly=function(d,x){this.updateUniform(d,x,x.length),this.update()},E.prototype.bindToEffect=function(d,x){this._currentEffect=d,!this._noUBO&&this._buffer&&(this._alreadyBound=!0,d.bindUniformBuffer(this._buffer,x))},E.prototype.dispose=function(){if(!this._noUBO){var d=this._engine._uniformBuffers,x=d.indexOf(this);x!==-1&&(d[x]=d[d.length-1],d.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},E._MAX_UNIFORM_SIZE=256,E._tempBuffer=new Float32Array(E._MAX_UNIFORM_SIZE),E}())},function(f,s,c){c.d(s,"a",function(){return w});var T=c(1),m=c(3),E=c(0),d=c(9),x=c(29),M=c(48);x.a.AddNodeConstructor("Light_Type_3",function(S,_){return function(){return new w(S,E.e.Zero(),_)}});var w=function(S){function _(O,R,I){var y=S.call(this,O,I)||this;return y.groundColor=new d.a(0,0,0),y.direction=R||E.e.Up(),y}return Object(T.d)(_,S),_.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},_.prototype.getClassName=function(){return"HemisphericLight"},_.prototype.setDirectionToTarget=function(O){return this.direction=E.e.Normalize(O.subtract(E.e.Zero())),this.direction},_.prototype.getShadowGenerator=function(){return null},_.prototype.transferToEffect=function(O,R){var I=E.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",I.x,I.y,I.z,0,R),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),R),this},_.prototype.transferToNodeMaterialEffect=function(O,R){var I=E.e.Normalize(this.direction);return O.setFloat3(R,I.x,I.y,I.z),this},_.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=E.a.Identity()),this._worldMatrix},_.prototype.getTypeID=function(){return M.a.LIGHTTYPEID_HEMISPHERICLIGHT},_.prototype.prepareLightSpecificDefines=function(O,R){O["HEMILIGHT"+R]=!0},Object(T.c)([Object(m.e)()],_.prototype,"groundColor",void 0),Object(T.c)([Object(m.o)()],_.prototype,"direction",void 0),_}(M.a)},function(f,s,c){c.d(s,"a",function(){return E});var T=c(1),m=c(0),E=function(d){function x(M,w){var S=d.call(this,M,w)||this;return S._normalMatrix=new m.a,S._storeEffectOnSubMeshes=!0,S}return Object(T.d)(x,d),x.prototype.getEffect=function(){return this._activeEffect},x.prototype.isReady=function(M,w){return!!M&&(!M.subMeshes||M.subMeshes.length===0||this.isReadyForSubMesh(M,M.subMeshes[0],w))},x.prototype._isReadyForSubMesh=function(M){var w=M._materialDefines;return!(this.checkReadyOnEveryCall||!M.effect||!w||w._renderId!==this.getScene().getRenderId())},x.prototype.bindOnlyWorldMatrix=function(M){this._activeEffect.setMatrix("world",M)},x.prototype.bindOnlyNormalMatrix=function(M){this._activeEffect.setMatrix("normalMatrix",M)},x.prototype.bind=function(M,w){w&&this.bindForSubMesh(M,w,w.subMeshes[0])},x.prototype._afterBind=function(M,w){w===void 0&&(w=null),d.prototype._afterBind.call(this,M),this.getScene()._cachedEffect=w},x.prototype._mustRebind=function(M,w,S){return S===void 0&&(S=1),M.isCachedMaterialInvalid(this,w,S)},x}(c(25).a)},function(f,s,c){c.d(s,"a",function(){return m});var T=c(1),m=function(E){function d(x){var M=E.call(this)||this;return M._buffer=x,M}return Object(T.d)(d,E),Object.defineProperty(d.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),d}(c(89).a)},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(m.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),m}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(64),m=function(){function E(){}return E.GetPlanes=function(d){for(var x=[],M=0;M<6;M++)x.push(new T.a(0,0,0,0));return E.GetPlanesToRef(d,x),x},E.GetNearPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]+M[2],x.normal.y=M[7]+M[6],x.normal.z=M[11]+M[10],x.d=M[15]+M[14],x.normalize()},E.GetFarPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]-M[2],x.normal.y=M[7]-M[6],x.normal.z=M[11]-M[10],x.d=M[15]-M[14],x.normalize()},E.GetLeftPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]+M[0],x.normal.y=M[7]+M[4],x.normal.z=M[11]+M[8],x.d=M[15]+M[12],x.normalize()},E.GetRightPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]-M[0],x.normal.y=M[7]-M[4],x.normal.z=M[11]-M[8],x.d=M[15]-M[12],x.normalize()},E.GetTopPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]-M[1],x.normal.y=M[7]-M[5],x.normal.z=M[11]-M[9],x.d=M[15]-M[13],x.normalize()},E.GetBottomPlaneToRef=function(d,x){var M=d.m;x.normal.x=M[3]+M[1],x.normal.y=M[7]+M[5],x.normal.z=M[11]+M[9],x.d=M[15]+M[13],x.normalize()},E.GetPlanesToRef=function(d,x){E.GetNearPlaneToRef(d,x[0]),E.GetFarPlaneToRef(d,x[1]),E.GetLeftPlaneToRef(d,x[2]),E.GetRightPlaneToRef(d,x[3]),E.GetTopPlaneToRef(d,x[4]),E.GetBottomPlaneToRef(d,x[5])},E}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(2),m=function(){function E(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(E,"HasTriggers",{get:function(){for(var d in E.Triggers)if(E.Triggers.hasOwnProperty(d))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(E,"HasPickTriggers",{get:function(){for(var d in E.Triggers)if(E.Triggers.hasOwnProperty(d)){var x=parseInt(d);if(x>=T.a.ACTION_OnPickTrigger&&x<=T.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),E.HasSpecificTrigger=function(d){for(var x in E.Triggers)if(E.Triggers.hasOwnProperty(x)&&parseInt(x)===d)return!0;return!1},E.Triggers={},E}()},function(f,s,c){c.d(s,"a",function(){return M});var T=c(1),m=c(25),E=c(3),d=c(19),x=c(15),M=function(){function w(S){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=m.a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=S}return w.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},w.prototype.isReadyForSubMesh=function(S,_){var O=_.getEngine();return!(S._areTexturesDirty&&_.texturesEnabled&&O.getCaps().standardDerivatives&&this._texture&&d.a.DetailTextureEnabled&&!this._texture.isReady())},w.prototype.prepareDefines=function(S,_){if(this._isEnabled){S.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var O=_.getEngine();S._areTexturesDirty&&(O.getCaps().standardDerivatives&&this._texture&&d.a.DetailTextureEnabled&&this._isEnabled?(x.a.PrepareDefinesForMergedUV(this._texture,S,"DETAIL"),S.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):S.DETAIL=!1)}else S.DETAIL=!1},w.prototype.bindForSubMesh=function(S,_,O){this._isEnabled&&(S.useUbo&&O&&S.isSync||this._texture&&d.a.DetailTextureEnabled&&(S.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),x.a.BindTextureMatrix(this._texture,S,"detail")),_.texturesEnabled&&this._texture&&d.a.DetailTextureEnabled&&S.setTexture("detailSampler",this._texture))},w.prototype.hasTexture=function(S){return this._texture===S},w.prototype.getActiveTextures=function(S){this._texture&&S.push(this._texture)},w.prototype.getAnimatables=function(S){this._texture&&this._texture.animations&&this._texture.animations.length>0&&S.push(this._texture)},w.prototype.dispose=function(S){var _;S&&((_=this._texture)===null||_===void 0||_.dispose())},w.prototype.getClassName=function(){return"DetailMap"},w.AddUniforms=function(S){S.push("vDetailInfos")},w.AddSamplers=function(S){S.push("detailSampler")},w.PrepareUniformBuffer=function(S){S.addUniform("vDetailInfos",4),S.addUniform("detailMatrix",16)},w.prototype.copyTo=function(S){E.a.Clone(function(){return S},this)},w.prototype.serialize=function(){return E.a.Serialize(this)},w.prototype.parse=function(S,_,O){var R=this;E.a.Parse(function(){return R},S,_,O)},Object(T.c)([Object(E.m)("detailTexture"),Object(E.b)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"texture",void 0),Object(T.c)([Object(E.c)()],w.prototype,"diffuseBlendLevel",void 0),Object(T.c)([Object(E.c)()],w.prototype,"roughnessBlendLevel",void 0),Object(T.c)([Object(E.c)()],w.prototype,"bumpLevel",void 0),Object(T.c)([Object(E.c)(),Object(E.b)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"normalBlendMethod",void 0),Object(T.c)([Object(E.c)(),Object(E.b)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isEnabled",void 0),w}()},function(f,s,c){var T="morphTargetsVertexGlobalDeclaration",m=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="morphTargetsVertexDeclaration",m=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"a",function(){return d});var T=c(25),m=c(4),E=c(2),d=function(){function x(M){this._vertexBuffers={},this._scene=M}return x.prototype._prepareBuffers=function(){if(!this._vertexBuffers[m.b.PositionKind]){var M=[];M.push(1,1),M.push(-1,1),M.push(-1,-1),M.push(1,-1),this._vertexBuffers[m.b.PositionKind]=new m.b(this._scene.getEngine(),M,m.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},x.prototype._buildIndexBuffer=function(){var M=[];M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(M)},x.prototype._rebuild=function(){var M=this._vertexBuffers[m.b.PositionKind];M&&(M._rebuild(),this._buildIndexBuffer())},x.prototype._prepareFrame=function(M,w){M===void 0&&(M=null),w===void 0&&(w=null);var S=this._scene.activeCamera;return!!S&&!(!(w=w||S._postProcesses.filter(function(_){return _!=null}))||w.length===0||!this._scene.postProcessesEnabled)&&(w[0].activate(S,M,w!=null),!0)},x.prototype.directRender=function(M,w,S,_,O,R){w===void 0&&(w=null),S===void 0&&(S=!1),_===void 0&&(_=0),O===void 0&&(O=0),R===void 0&&(R=!1);for(var I=this._scene.getEngine(),y=0;y<M.length;y++){y<M.length-1?M[y+1].activate(this._scene.activeCamera,w):w?I.bindFramebuffer(w,_,void 0,void 0,S,O):R||I.restoreDefaultFramebuffer();var p=M[y],g=p.apply();g&&(p.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),I.bindBuffers(this._vertexBuffers,this._indexBuffer,g),I.drawElementsType(T.a.TriangleFillMode,0,6),p.onAfterRenderObservable.notifyObservers(g))}I.setDepthBuffer(!0),I.setDepthWrite(!0)},x.prototype._finalizeFrame=function(M,w,S,_,O){O===void 0&&(O=!1);var R=this._scene.activeCamera;if(R&&(_=_||R._postProcesses.filter(function(P){return P!=null})).length!==0&&this._scene.postProcessesEnabled){for(var I=this._scene.getEngine(),y=0,p=_.length;y<p;y++){var g=_[y];if(y<p-1?g._outputTexture=_[y+1].activate(R,w):w?(I.bindFramebuffer(w,S,void 0,void 0,O),g._outputTexture=w):(I.restoreDefaultFramebuffer(),g._outputTexture=null),M)break;var C=g.apply();C&&(g.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),I.bindBuffers(this._vertexBuffers,this._indexBuffer,C),I.drawElementsType(T.a.TriangleFillMode,0,6),g.onAfterRenderObservable.notifyObservers(C))}I.setDepthBuffer(!0),I.setDepthWrite(!0),I.setAlphaMode(E.a.ALPHA_DISABLE)}},x.prototype.dispose=function(){var M=this._vertexBuffers[m.b.PositionKind];M&&(M.dispose(),this._vertexBuffers[m.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},x}()},function(f,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return E});var T=c(148),m=function(){},E=function(){function d(x){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new m,this._scene=x;for(var M=d.MIN_RENDERINGGROUPS;M<d.MAX_RENDERINGGROUPS;M++)this._autoClearDepthStencil[M]={autoClear:!0,depth:!0,stencil:!0}}return d.prototype._clearDepthStencilBuffer=function(x,M){x===void 0&&(x=!0),M===void 0&&(M=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,x,M),this._depthStencilBufferAlreadyCleaned=!0)},d.prototype.render=function(x,M,w,S){var _=this._renderingGroupInfo;if(_.scene=this._scene,_.camera=this._scene.activeCamera,this._scene.spriteManagers&&S)for(var O=0;O<this._scene.spriteManagers.length;O++){var R=this._scene.spriteManagers[O];this.dispatchSprites(R)}for(O=d.MIN_RENDERINGGROUPS;O<d.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===d.MIN_RENDERINGGROUPS;var I=this._renderingGroups[O];if(I){var y=Math.pow(2,O);if(_.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(_,y),d.AUTOCLEAR){var p=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];p&&p.autoClear&&this._clearDepthStencilBuffer(p.depth,p.stencil)}for(var g=0,C=this._scene._beforeRenderingGroupDrawStage;g<C.length;g++)C[g].action(O);I.render(x,S,w,M);for(var P=0,F=this._scene._afterRenderingGroupDrawStage;P<F.length;P++)F[P].action(O);this._scene.onAfterRenderingGroupObservable.notifyObservers(_,y)}}},d.prototype.reset=function(){for(var x=d.MIN_RENDERINGGROUPS;x<d.MAX_RENDERINGGROUPS;x++){var M=this._renderingGroups[x];M&&M.prepare()}},d.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},d.prototype.freeRenderingGroups=function(){for(var x=d.MIN_RENDERINGGROUPS;x<d.MAX_RENDERINGGROUPS;x++){var M=this._renderingGroups[x];M&&M.dispose()}},d.prototype._prepareRenderingGroup=function(x){this._renderingGroups[x]===void 0&&(this._renderingGroups[x]=new T.a(x,this._scene,this._customOpaqueSortCompareFn[x],this._customAlphaTestSortCompareFn[x],this._customTransparentSortCompareFn[x]))},d.prototype.dispatchSprites=function(x){var M=x.renderingGroupId||0;this._prepareRenderingGroup(M),this._renderingGroups[M].dispatchSprites(x)},d.prototype.dispatchParticles=function(x){var M=x.renderingGroupId||0;this._prepareRenderingGroup(M),this._renderingGroups[M].dispatchParticles(x)},d.prototype.dispatch=function(x,M,w){M===void 0&&(M=x.getMesh());var S=M.renderingGroupId||0;this._prepareRenderingGroup(S),this._renderingGroups[S].dispatch(x,M,w)},d.prototype.setRenderingOrder=function(x,M,w,S){if(M===void 0&&(M=null),w===void 0&&(w=null),S===void 0&&(S=null),this._customOpaqueSortCompareFn[x]=M,this._customAlphaTestSortCompareFn[x]=w,this._customTransparentSortCompareFn[x]=S,this._renderingGroups[x]){var _=this._renderingGroups[x];_.opaqueSortCompareFn=this._customOpaqueSortCompareFn[x],_.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[x],_.transparentSortCompareFn=this._customTransparentSortCompareFn[x]}},d.prototype.setRenderingAutoClearDepthStencil=function(x,M,w,S){w===void 0&&(w=!0),S===void 0&&(S=!0),this._autoClearDepthStencil[x]={autoClear:M,depth:w,stencil:S}},d.prototype.getAutoClearDepthStencilSetup=function(x){return this._autoClearDepthStencil[x]},d.MAX_RENDERINGGROUPS=4,d.MIN_RENDERINGGROUPS=0,d.AUTOCLEAR=!0,d}()},function(f,s,c){c.d(s,"a",function(){return x});var T=c(0),m=c(7),E=c(82),d=c(72);m.a.ExtrudeShape=function(M,w,S,_,O,R,I,y,p,g){I===void 0&&(I=null);var C={shape:w,path:S,scale:_,rotation:O,cap:R===0?0:R||m.a.NO_CAP,sideOrientation:p,instance:g,updatable:y};return x.ExtrudeShape(M,C,I)},m.a.ExtrudeShapeCustom=function(M,w,S,_,O,R,I,y,p,g,C,P){var F={shape:w,path:S,scaleFunction:_,rotationFunction:O,ribbonCloseArray:R,ribbonClosePath:I,cap:y===0?0:y||m.a.NO_CAP,sideOrientation:C,instance:P,updatable:g};return x.ExtrudeShapeCustom(M,F,p)};var x=function(){function M(){}return M.ExtrudeShape=function(w,S,_){_===void 0&&(_=null);var O=S.path,R=S.shape,I=S.scale||1,y=S.rotation||0,p=S.cap===0?0:S.cap||m.a.NO_CAP,g=S.updatable,C=m.a._GetDefaultSideOrientation(S.sideOrientation),P=S.instance||null,F=S.invertUV||!1;return M._ExtrudeShapeGeneric(w,R,O,I,y,null,null,!1,!1,p,!1,_,!!g,C,P,F,S.frontUVs||null,S.backUVs||null)},M.ExtrudeShapeCustom=function(w,S,_){_===void 0&&(_=null);var O=S.path,R=S.shape,I=S.scaleFunction||function(){return 1},y=S.rotationFunction||function(){return 0},p=S.ribbonCloseArray||!1,g=S.ribbonClosePath||!1,C=S.cap===0?0:S.cap||m.a.NO_CAP,P=S.updatable,F=m.a._GetDefaultSideOrientation(S.sideOrientation),U=S.instance,B=S.invertUV||!1;return M._ExtrudeShapeGeneric(w,R,O,null,null,I,y,p,g,C,!0,_,!!P,F,U||null,B,S.frontUVs||null,S.backUVs||null)},M._ExtrudeShapeGeneric=function(w,S,_,O,R,I,y,p,g,C,P,F,U,B,L,z,X,G){var ee,$,fe=function(be,ie,se,V,K,Z,le,re,Q,W){for(var Y=se.getTangents(),q=se.getNormals(),ae=se.getBinormals(),pe=se.getDistances(),De=0,de=W&&re?re:function(){return Z!==null?Z:0},ge=W&&le?le:function(){return K!==null?K:1},ne=Q===m.a.NO_CAP||Q===m.a.CAP_END?0:2,Te=T.c.Matrix[0],we=0;we<ie.length;we++){for(var Se=new Array,Ge=de(we,pe[we]),$e=ge(we,pe[we]),nt=0;nt<be.length;nt++){T.a.RotationAxisToRef(Y[we],De,Te);var et=Y[we].scale(be[nt].z).add(q[we].scale(be[nt].x)).add(ae[we].scale(be[nt].y)),Ze=Se[nt]?Se[nt]:T.e.Zero();T.e.TransformCoordinatesToRef(et,Te,Ze),Ze.scaleInPlace($e).addInPlace(ie[we]),Se[nt]=Ze}V[ne]=Se,De+=Ge,ne++}var ht=function(gt){var Rt,zt=Array(),un=T.e.Zero();for(Rt=0;Rt<gt.length;Rt++)un.addInPlace(gt[Rt]);for(un.scaleInPlace(1/gt.length),Rt=0;Rt<gt.length;Rt++)zt.push(un);return zt};switch(Q){case m.a.NO_CAP:break;case m.a.CAP_START:V[0]=ht(V[2]),V[1]=V[2];break;case m.a.CAP_END:V[ne]=V[ne-1],V[ne+1]=ht(V[ne-1]);break;case m.a.CAP_ALL:V[0]=ht(V[2]),V[1]=V[2],V[ne]=V[ne-1],V[ne+1]=ht(V[ne-1])}return V};if(L){var me=L._creationDataStorage;return ee=me.path3D.update(_),$=fe(S,_,me.path3D,me.pathArray,O,R,I,y,me.cap,P),L=m.a.CreateRibbon("",$,!1,!1,0,F||void 0,!1,0,L)}$=fe(S,_,ee=new d.g(_),new Array,O,R,I,y,C=C<0||C>3?0:C,P);var ve=E.a.CreateRibbon(w,{pathArray:$,closeArray:p,closePath:g,updatable:U,sideOrientation:B,invertUV:z,frontUVs:X||void 0,backUVs:G||void 0},F);return ve._creationDataStorage.pathArray=$,ve._creationDataStorage.path3D=ee,ve._creationDataStorage.cap=C,ve},M}()},function(f,s,c){c.d(s,"b",function(){return _}),c.d(s,"a",function(){return O});var T=c(1),m=c(9),E=c(4),d=c(7),x=c(151),M=c(25),w=c(73),S=c(15),_=(c(166),c(167),function(R){function I(y,p,g,C,P,F,U){p===void 0&&(p=null),g===void 0&&(g=null),C===void 0&&(C=null);var B=R.call(this,y,p,g,C,P)||this;B.useVertexColor=F,B.useVertexAlpha=U,B.color=new m.a(1,1,1),B.alpha=1,C&&(B.color=C.color.clone(),B.alpha=C.alpha,B.useVertexColor=C.useVertexColor,B.useVertexAlpha=C.useVertexAlpha),B.intersectionThreshold=.1;var L={attributes:[E.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return U===!1&&(L.needAlphaBlending=!1),F?(L.defines.push("#define VERTEXCOLOR"),L.attributes.push(E.b.ColorKind)):(L.uniforms.push("color"),B.color4=new m.b),B._colorShader=new w.a("colorShader",B.getScene(),"color",L),B}return Object(T.d)(I,R),I.prototype._addClipPlaneDefine=function(y){var p="#define "+y;this._colorShader.options.defines.indexOf(p)===-1&&this._colorShader.options.defines.push(p)},I.prototype._removeClipPlaneDefine=function(y){var p="#define "+y,g=this._colorShader.options.defines.indexOf(p);g!==-1&&this._colorShader.options.defines.splice(g,1)},I.prototype.isReady=function(){var y=this.getScene();return y.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),y.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),y.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),y.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),y.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),y.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady(this)&&R.prototype.isReady.call(this)},I.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(I.prototype,"material",{get:function(){return this._colorShader},set:function(y){},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"checkCollisions",{get:function(){return!1},enumerable:!1,configurable:!0}),I.prototype._bind=function(y,p,g){if(!this._geometry)return this;var C=this._colorShader.getEffect(),P=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(C,P),!this.useVertexColor){var F=this.color,U=F.r,B=F.g,L=F.b;this.color4.set(U,B,L,this.alpha),this._colorShader.setColor4("color",this.color4)}return S.a.BindClipPlane(C,this.getScene()),this},I.prototype._draw=function(y,p,g){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var C=this.getScene().getEngine();return this._unIndexed?C.drawArraysType(M.a.LineListDrawMode,y.verticesStart,y.verticesCount,g):C.drawElementsType(M.a.LineListDrawMode,y.indexStart,y.indexCount,g),this},I.prototype.dispose=function(y){this._colorShader.dispose(!1,!1,!0),R.prototype.dispose.call(this,y)},I.prototype.clone=function(y,p,g){return p===void 0&&(p=null),new I(y,this.getScene(),p,this,g)},I.prototype.createInstance=function(y){return new O(y,this)},I}(d.a)),O=function(R){function I(y,p){var g=R.call(this,y,p)||this;return g.intersectionThreshold=p.intersectionThreshold,g}return Object(T.d)(I,R),I.prototype.getClassName=function(){return"InstancedLinesMesh"},I}(x.a)},function(f,s,c){c.r(s),c.d(s,"AxesViewer",function(){return M}),c.d(s,"BoneAxesViewer",function(){return _}),c.d(s,"DebugLayerTab",function(){return T}),c.d(s,"DebugLayer",function(){return p}),c.d(s,"PhysicsViewer",function(){return z}),c.d(s,"RayHelper",function(){return G}),c.d(s,"SkeletonViewer",function(){return ie});var T,m=c(0),E=c(30),d=c(75),x=c(9),M=function(){function se(V,K,Z,le,re,Q){if(K===void 0&&(K=1),Z===void 0&&(Z=2),this._scaleLinesFactor=4,this._instanced=!1,this.scene=null,this.scaleLines=1,this.scaleLines=K,!le){var W=new E.a("",V);W.disableLighting=!0,W.emissiveColor=x.a.Red().scale(.5),le=d.a._CreateArrow(V,W)}if(!re){var Y=new E.a("",V);Y.disableLighting=!0,Y.emissiveColor=x.a.Green().scale(.5),re=d.a._CreateArrow(V,Y)}if(!Q){var q=new E.a("",V);q.disableLighting=!0,q.emissiveColor=x.a.Blue().scale(.5),Q=d.a._CreateArrow(V,q)}this._xAxis=le,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=re,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=Q,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),Z!=null&&(se._SetRenderingGroupId(this._xAxis,Z),se._SetRenderingGroupId(this._yAxis,Z),se._SetRenderingGroupId(this._zAxis,Z)),this.scene=V,this.update(new m.e,m.e.Right(),m.e.Up(),m.e.Forward())}return Object.defineProperty(se.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!1,configurable:!0}),se.prototype.update=function(V,K,Z,le){this._xAxis.position.copyFrom(V),this._xAxis.setDirection(K),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(V),this._yAxis.setDirection(Z),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(V),this._zAxis.setDirection(le),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},se.prototype.createInstance=function(){var V=d.a._CreateArrowInstance(this.scene,this._xAxis),K=d.a._CreateArrowInstance(this.scene,this._yAxis),Z=d.a._CreateArrowInstance(this.scene,this._zAxis),le=new se(this.scene,this.scaleLines,null,V,K,Z);return le._instanced=!0,le},se.prototype.dispose=function(){this._xAxis&&this._xAxis.dispose(!1,!this._instanced),this._yAxis&&this._yAxis.dispose(!1,!this._instanced),this._zAxis&&this._zAxis.dispose(!1,!this._instanced),this.scene=null},se._SetRenderingGroupId=function(V,K){V.getChildMeshes().forEach(function(Z){Z.renderingGroupId=K})},se}(),w=c(1),S=c(23),_=function(se){function V(K,Z,le,re){re===void 0&&(re=1);var Q=se.call(this,K,re)||this;return Q.pos=m.e.Zero(),Q.xaxis=m.e.Zero(),Q.yaxis=m.e.Zero(),Q.zaxis=m.e.Zero(),Q.mesh=le,Q.bone=Z,Q}return Object(w.d)(V,se),V.prototype.update=function(){if(this.mesh&&this.bone){var K=this.bone;K._markAsDirtyAndCompose(),K.getAbsolutePositionToRef(this.mesh,this.pos),K.getDirectionToRef(S.a.X,this.mesh,this.xaxis),K.getDirectionToRef(S.a.Y,this.mesh,this.yaxis),K.getDirectionToRef(S.a.Z,this.mesh,this.zaxis),se.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},V.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,se.prototype.dispose.call(this))},V}(M),O=c(12),R=c(6),I=c(20),y=c(13);Object.defineProperty(I.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new p(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(se){se[se.Properties=0]="Properties",se[se.Debug=1]="Debug",se[se.Statistics=2]="Statistics",se[se.Tools=3]="Tools",se[se.Settings=4]="Settings"}(T||(T={}));var p=function(){function se(V){var K=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=V,this._scene.onDisposeObservable.add(function(){K._scene._debugLayer&&K._scene._debugLayer.hide()})}return Object.defineProperty(se.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new R.c),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),se.prototype._createInspector=function(V){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var K=0,Z=this._onPropertyChangedObservable.observers;K<Z.length;K++){var le=Z[K];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(le)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}var re=Object(w.a)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},V);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,re)}},se.prototype.select=function(V,K){this.BJSINSPECTOR&&(K&&(Object.prototype.toString.call(K)=="[object String]"?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(K):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(K)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(V))},se.prototype._getGlobalInspector=function(){return typeof INSPECTOR!="undefined"?INSPECTOR:typeof BABYLON!="undefined"&&BABYLON.Inspector!==void 0?BABYLON:void 0},se.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},se.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},se.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},se.prototype.show=function(V){var K=this;return new Promise(function(Z,le){if(K.BJSINSPECTOR===void 0){var re=V&&V.inspectorURL?V.inspectorURL:se.InspectorURL;O.b.LoadScript(re,function(){K._createInspector(V),Z(K)})}else K._createInspector(V),Z(K)})},se.InspectorURL="https://unpkg.com/babylonjs-inspector@"+y.a.Version+"/babylon.inspector.bundle.js",se}(),g=c(7),C=c(63),P=c(45),F=c(22),U=c(32),B=c(36),L=c(53),z=function(){function se(V){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=V||F.a.LastCreatedScene;var K=this._scene.getPhysicsEngine();K&&(this._physicsEnginePlugin=K.getPhysicsPlugin()),this._utilityLayer=new B.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return se.prototype._updateDebugMeshes=function(){for(var V=this._physicsEnginePlugin,K=0;K<this._numMeshes;K++){var Z=this._impostors[K];if(Z)if(Z.isDisposed)this.hideImpostor(this._impostors[K--]);else{if(Z.type===U.a.MeshImpostor)continue;var le=this._meshes[K];le&&V&&V.syncMeshWithImpostor(le,Z)}}},se.prototype.showImpostor=function(V,K){if(!this._scene)return null;for(var Z=0;Z<this._numMeshes;Z++)if(this._impostors[Z]==V)return null;var le=this._getDebugMesh(V,K);return le&&(this._impostors[this._numMeshes]=V,this._meshes[this._numMeshes]=le,this._numMeshes===0&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),le},se.prototype.hideImpostor=function(V){if(V&&this._scene&&this._utilityLayer){for(var K=!1,Z=this._utilityLayer.utilityLayerScene,le=0;le<this._numMeshes;le++)if(this._impostors[le]==V){var re=this._meshes[le];if(!re)continue;Z.removeMesh(re),re.dispose();var Q=this._debugMeshMeshes.indexOf(re);Q>-1&&this._debugMeshMeshes.splice(Q,1),this._numMeshes--,this._numMeshes>0?(this._meshes[le]=this._meshes[this._numMeshes],this._impostors[le]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),K=!0;break}K&&this._numMeshes===0&&this._scene.unregisterBeforeRender(this._renderFunction)}},se.prototype._getDebugMaterial=function(V){return this._debugMaterial||(this._debugMaterial=new E.a("",V),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=x.a.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},se.prototype._getDebugBoxMesh=function(V){return this._debugBoxMesh||(this._debugBoxMesh=C.a.CreateBox("physicsBodyBoxViewMesh",{size:1},V),this._debugBoxMesh.rotationQuaternion=m.b.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(V),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},se.prototype._getDebugSphereMesh=function(V){return this._debugSphereMesh||(this._debugSphereMesh=P.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},V),this._debugSphereMesh.rotationQuaternion=m.b.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(V),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},se.prototype._getDebugCylinderMesh=function(V){return this._debugCylinderMesh||(this._debugCylinderMesh=L.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},V),this._debugCylinderMesh.rotationQuaternion=m.b.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(V),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},se.prototype._getDebugMeshMesh=function(V,K){var Z=new g.a(V.name,K,null,V);return Z.position=m.e.Zero(),Z.setParent(V),Z.material=this._getDebugMaterial(K),this._debugMeshMeshes.push(Z),Z},se.prototype._getDebugMesh=function(V,K){var Z=this;if(!this._utilityLayer||K&&K.parent&&K.parent.physicsImpostor)return null;var le=null,re=this._utilityLayer.utilityLayerScene;switch(V.type){case U.a.BoxImpostor:le=this._getDebugBoxMesh(re),V.getBoxSizeToRef(le.scaling);break;case U.a.SphereImpostor:le=this._getDebugSphereMesh(re);var Q=V.getRadius();le.scaling.x=2*Q,le.scaling.y=2*Q,le.scaling.z=2*Q;break;case U.a.MeshImpostor:K&&(le=this._getDebugMeshMesh(K,re));break;case U.a.NoImpostor:K&&K.getChildMeshes().filter(function(Y){return Y.physicsImpostor?1:0}).forEach(function(Y){Z._getDebugBoxMesh(re).parent=Y});break;case U.a.CylinderImpostor:le=this._getDebugCylinderMesh(re);var W=V.object.getBoundingInfo();le.scaling.x=W.boundingBox.maximum.x-W.boundingBox.minimum.x,le.scaling.y=W.boundingBox.maximum.y-W.boundingBox.minimum.y,le.scaling.z=W.boundingBox.maximum.z-W.boundingBox.minimum.z}return le},se.prototype.dispose=function(){for(var V=this._numMeshes,K=0;K<V;K++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},se}(),X=c(40),G=function(){function se(V){this.ray=V}return se.CreateAndShow=function(V,K,Z){var le=new se(V);return le.show(K,Z),le},se.prototype.show=function(V,K){if(!this._renderFunction&&this.ray){var Z=this.ray;this._renderFunction=this._render.bind(this),this._scene=V,this._renderPoints=[Z.origin,Z.origin.add(Z.direction.scale(Z.length))],this._renderLine=g.a.CreateLines("ray",this._renderPoints,V,!0),this._renderLine.isPickable=!1,this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}K&&this._renderLine&&this._renderLine.color.copyFrom(K)},se.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},se.prototype._render=function(){var V=this.ray;if(V){var K=this._renderPoints[1],Z=Math.min(V.length,1e6);K.copyFrom(V.direction),K.scaleInPlace(Z),K.addInPlace(V.origin),this._renderPoints[0].copyFrom(V.origin),g.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},se.prototype.attachToMesh=function(V,K,Z,le){var re=this;this._attachedToMesh=V;var Q=this.ray;Q&&(Q.direction||(Q.direction=m.e.Zero()),Q.origin||(Q.origin=m.e.Zero()),le&&(Q.length=le),Z||(Z=m.e.Zero()),K||(K=new m.e(0,0,-1)),this._scene||(this._scene=V.getScene()),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(K),this._meshSpaceOrigin.copyFrom(Z)):(this._meshSpaceDirection=K.clone(),this._meshSpaceOrigin=Z.clone()),this._onAfterRenderObserver||(this._onAfterRenderObserver=this._scene.onBeforeRenderObservable.add(function(){return re._updateToMesh()}),this._onAfterStepObserver=this._scene.onAfterStepObservable.add(function(){return re._updateToMesh()})),this._attachedToMesh.computeWorldMatrix(!0),this._updateToMesh())},se.prototype.detachFromMesh=function(){this._attachedToMesh&&this._scene&&(this._onAfterRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._onAfterRenderObserver),this._scene.onAfterStepObservable.remove(this._onAfterStepObserver)),this._attachedToMesh=null,this._onAfterRenderObserver=null,this._onAfterStepObserver=null,this._scene=null)},se.prototype._updateToMesh=function(){var V=this.ray;this._attachedToMesh&&V&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,V.direction),m.e.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),V.origin)))},se.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},se}(),ee=c(25),$=c(73),fe=c(62),me=c(4),ve=c(5),be=c(97),ie=function(){function se(V,K,Z,le,re,Q){var W,Y,q,ae,pe,De,de,ge,ne,Te,we,Se,Ge,$e;le===void 0&&(le=!0),re===void 0&&(re=3),Q===void 0&&(Q={}),this.skeleton=V,this.mesh=K,this.autoUpdateBonesMatrices=le,this.renderingGroupId=re,this.options=Q,this.color=x.a.White(),this._debugLines=new Array,this._localAxes=null,this._isEnabled=!1,this._obs=null,this._scene=Z,this._ready=!1,Q.pauseAnimations=(W=Q.pauseAnimations)===null||W===void 0||W,Q.returnToRest=(Y=Q.returnToRest)!==null&&Y!==void 0&&Y,Q.displayMode=(q=Q.displayMode)!==null&&q!==void 0?q:se.DISPLAY_LINES,Q.displayOptions=(ae=Q.displayOptions)!==null&&ae!==void 0?ae:{},Q.displayOptions.midStep=(pe=Q.displayOptions.midStep)!==null&&pe!==void 0?pe:.235,Q.displayOptions.midStepFactor=(De=Q.displayOptions.midStepFactor)!==null&&De!==void 0?De:.155,Q.displayOptions.sphereBaseSize=(de=Q.displayOptions.sphereBaseSize)!==null&&de!==void 0?de:.15,Q.displayOptions.sphereScaleUnit=(ge=Q.displayOptions.sphereScaleUnit)!==null&&ge!==void 0?ge:2,Q.displayOptions.sphereFactor=(ne=Q.displayOptions.sphereFactor)!==null&&ne!==void 0?ne:.865,Q.displayOptions.spurFollowsChild=(Te=Q.displayOptions.spurFollowsChild)!==null&&Te!==void 0&&Te,Q.displayOptions.showLocalAxes=(we=Q.displayOptions.showLocalAxes)!==null&&we!==void 0&&we,Q.displayOptions.localAxesSize=(Se=Q.displayOptions.localAxesSize)!==null&&Se!==void 0?Se:.075,Q.computeBonesUsingShaders=(Ge=Q.computeBonesUsingShaders)===null||Ge===void 0||Ge,Q.useAllBones=($e=Q.useAllBones)===null||$e===void 0||$e;var nt=K.getVerticesData(me.b.MatricesIndicesKind),et=K.getVerticesData(me.b.MatricesWeightsKind);if(this._boneIndices=new Set,!Q.useAllBones&&nt&&et)for(var Ze=0;Ze<nt.length;++Ze){var ht=nt[Ze];et[Ze]!==0&&this._boneIndices.add(ht)}this._utilityLayer=new B.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0;var gt=this.options.displayMode||0;gt>se.DISPLAY_SPHERE_AND_SPURS&&(gt=se.DISPLAY_LINES),this.displayMode=gt,this.update(),this._bindObs()}return se.CreateBoneWeightShader=function(V,K){var Z,le,re,Q,W,Y,q=V.skeleton,ae=(Z=V.colorBase)!==null&&Z!==void 0?Z:x.a.Black(),pe=(le=V.colorZero)!==null&&le!==void 0?le:x.a.Blue(),De=(re=V.colorQuarter)!==null&&re!==void 0?re:x.a.Green(),de=(Q=V.colorHalf)!==null&&Q!==void 0?Q:x.a.Yellow(),ge=(W=V.colorFull)!==null&&W!==void 0?W:x.a.Red(),ne=(Y=V.targetBoneIndex)!==null&&Y!==void 0?Y:0;ve.a.ShadersStore["boneWeights:"+q.name+"VertexShader"]=`precision highp float;

        attribute vec3 position;
        attribute vec2 uv;

        uniform mat4 view;
        uniform mat4 projection;
        uniform mat4 worldViewProjection;

        #include<bonesDeclaration>
        #if NUM_BONE_INFLUENCERS == 0
            attribute vec4 matricesIndices;
            attribute vec4 matricesWeights;
        #endif

        #include<instancesDeclaration>

        varying vec3 vColor;

        uniform vec3 colorBase;
        uniform vec3 colorZero;
        uniform vec3 colorQuarter;
        uniform vec3 colorHalf;
        uniform vec3 colorFull;

        uniform float targetBoneIndex;

        void main() {
            vec3 positionUpdated = position;

            #include<instancesVertex>
            #include<bonesVertex>

            vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

            vec3 color = colorBase;
            float totalWeight = 0.;
            if(matricesIndices[0] == targetBoneIndex && matricesWeights[0] > 0.){
                totalWeight += matricesWeights[0];
            }
            if(matricesIndices[1] == targetBoneIndex && matricesWeights[1] > 0.){
                totalWeight += matricesWeights[1];
            }
            if(matricesIndices[2] == targetBoneIndex && matricesWeights[2] > 0.){
                totalWeight += matricesWeights[2];
            }
            if(matricesIndices[3] == targetBoneIndex && matricesWeights[3] > 0.){
                totalWeight += matricesWeights[3];
            }

            color = mix(color, colorZero, smoothstep(0., 0.25, totalWeight));
            color = mix(color, colorQuarter, smoothstep(0.25, 0.5, totalWeight));
            color = mix(color, colorHalf, smoothstep(0.5, 0.75, totalWeight));
            color = mix(color, colorFull, smoothstep(0.75, 1.0, totalWeight));
            vColor = color;

        gl_Position = projection * view * worldPos;
        }`,ve.a.ShadersStore["boneWeights:"+q.name+"FragmentShader"]=`
            precision highp float;
            varying vec3 vPosition;

            varying vec3 vColor;

            void main() {
                vec4 color = vec4(vColor, 1.0);
                gl_FragColor = color;
            }
        `;var Te=new $.a("boneWeight:"+q.name,K,{vertex:"boneWeights:"+q.name,fragment:"boneWeights:"+q.name},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorBase","colorZero","colorQuarter","colorHalf","colorFull","targetBoneIndex"]});return Te.setColor3("colorBase",ae),Te.setColor3("colorZero",pe),Te.setColor3("colorQuarter",De),Te.setColor3("colorHalf",de),Te.setColor3("colorFull",ge),Te.setFloat("targetBoneIndex",ne),Te.getClassName=function(){return"BoneWeightShader"},Te.transparencyMode=ee.a.MATERIAL_OPAQUE,Te},se.CreateSkeletonMapShader=function(V,K){var Z,le=V.skeleton,re=(Z=V.colorMap)!==null&&Z!==void 0?Z:[{color:new x.a(1,.38,.18),location:0},{color:new x.a(.59,.18,1),location:.2},{color:new x.a(.59,1,.18),location:.4},{color:new x.a(1,.87,.17),location:.6},{color:new x.a(1,.17,.42),location:.8},{color:new x.a(.17,.68,1),location:1}],Q=le.bones.length+1,W=se._CreateBoneMapColorBuffer(Q,re,K),Y=new $.a("boneWeights:"+le.name,K,{vertexSource:`precision highp float;

            attribute vec3 position;
            attribute vec2 uv;

            uniform mat4 view;
            uniform mat4 projection;
            uniform mat4 worldViewProjection;
            uniform float colorMap[`+4*le.bones.length+`];

            #include<bonesDeclaration>
            #if NUM_BONE_INFLUENCERS == 0
                attribute vec4 matricesIndices;
                attribute vec4 matricesWeights;
            #endif
            #include<instancesDeclaration>

            varying vec3 vColor;

            void main() {
                vec3 positionUpdated = position;

                #include<instancesVertex>
                #include<bonesVertex>

                vec3 color = vec3(0.);
                bool first = true;

                for (int i = 0; i < 4; i++) {
                    int boneIdx = int(matricesIndices[i]);
                    float boneWgt = matricesWeights[i];

                    vec3 c = vec3(colorMap[boneIdx * 4 + 0], colorMap[boneIdx * 4 + 1], colorMap[boneIdx * 4 + 2]);

                    if (boneWgt > 0.) {
                        if (first) {
                            first = false;
                            color = c;
                        } else {
                            color = mix(color, c, boneWgt);
                        }
                    }
                }

                vColor = color;

                vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);

                gl_Position = projection * view * worldPos;
            }`,fragmentSource:`
            precision highp float;
            varying vec3 vColor;

            void main() {
                vec4 color = vec4( vColor, 1.0 );
                gl_FragColor = color;
            }
            `},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorMap"]});return Y.setFloats("colorMap",W),Y.getClassName=function(){return"SkeletonMapShader"},Y.transparencyMode=ee.a.MATERIAL_OPAQUE,Y},se._CreateBoneMapColorBuffer=function(V,K,Z){var le=new fe.a("temp",{width:V,height:1},Z,!1),re=le.getContext(),Q=re.createLinearGradient(0,0,V,0);K.forEach(function(ae){Q.addColorStop(ae.location,ae.color.toHexString())}),re.fillStyle=Q,re.fillRect(0,0,V,1),le.update();for(var W=[],Y=re.getImageData(0,0,V,1).data,q=0;q<Y.length;q++)W.push(Y[q]*(1/255));return le.dispose(),W},Object.defineProperty(se.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"isReady",{get:function(){return this._ready},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"ready",{set:function(V){this._ready=V},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"debugMesh",{get:function(){return this._debugMesh},set:function(V){this._debugMesh=V},enumerable:!1,configurable:!0}),Object.defineProperty(se.prototype,"displayMode",{get:function(){return this.options.displayMode||se.DISPLAY_LINES},set:function(V){V>se.DISPLAY_SPHERE_AND_SPURS&&(V=se.DISPLAY_LINES),this.options.displayMode=V},enumerable:!1,configurable:!0}),se.prototype._bindObs=function(){var V=this;switch(this.displayMode){case se.DISPLAY_LINES:this._obs=this.scene.onBeforeRenderObservable.add(function(){V._displayLinesUpdate()})}},se.prototype.update=function(){switch(this.displayMode){case se.DISPLAY_LINES:this._displayLinesUpdate();break;case se.DISPLAY_SPHERES:this._buildSpheresAndSpurs(!0);break;case se.DISPLAY_SPHERE_AND_SPURS:this._buildSpheresAndSpurs(!1)}this._buildLocalAxes()},Object.defineProperty(se.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(V){this.isEnabled!==V&&(this._isEnabled=V,this.debugMesh&&this.debugMesh.setEnabled(V),V&&!this._obs?this._bindObs():!V&&this._obs&&(this.scene.onBeforeRenderObservable.remove(this._obs),this._obs=null))},enumerable:!1,configurable:!0}),se.prototype._getBonePosition=function(V,K,Z,le,re,Q){le===void 0&&(le=0),re===void 0&&(re=0),Q===void 0&&(Q=0);var W=m.c.Matrix[0],Y=K.getParent();if(W.copyFrom(K.getLocalMatrix()),le!==0||re!==0||Q!==0){var q=m.c.Matrix[1];m.a.IdentityToRef(q),q.setTranslationFromFloats(le,re,Q),q.multiplyToRef(W,W)}Y&&W.multiplyToRef(Y.getAbsoluteTransform(),W),W.multiplyToRef(Z,W),V.x=W.m[12],V.y=W.m[13],V.z=W.m[14]},se.prototype._getLinesForBonesWithLength=function(V,K){for(var Z=V.length,le=this.mesh._effectiveMesh.position,re=0,Q=0;Q<Z;Q++){var W=V[Q],Y=this._debugLines[re];W._index!==-1&&(this._boneIndices.has(W.getIndex())||this.options.useAllBones)&&(Y||(Y=[m.e.Zero(),m.e.Zero()],this._debugLines[re]=Y),this._getBonePosition(Y[0],W,K),this._getBonePosition(Y[1],W,K,0,W.length,0),Y[0].subtractInPlace(le),Y[1].subtractInPlace(le),re++)}},se.prototype._getLinesForBonesNoLength=function(V){for(var K=V.length,Z=0,le=this.mesh._effectiveMesh,re=le.position,Q=K-1;Q>=0;Q--){var W=V[Q],Y=W.getParent();if(Y&&(this._boneIndices.has(W.getIndex())||this.options.useAllBones)){var q=this._debugLines[Z];q||(q=[m.e.Zero(),m.e.Zero()],this._debugLines[Z]=q),W.getAbsolutePositionToRef(le,q[0]),Y.getAbsolutePositionToRef(le,q[1]),q[0].subtractInPlace(re),q[1].subtractInPlace(re),Z++}}},se.prototype._revert=function(V){this.options.pauseAnimations&&(this.scene.animationsEnabled=V,this.utilityLayer.utilityLayerScene.animationsEnabled=V)},se.prototype._getAbsoluteBindPoseToRef=function(V,K){V!==null&&V._index!==-1?(this._getAbsoluteBindPoseToRef(V.getParent(),K),V.getBindPose().multiplyToRef(K,K)):K.copyFrom(m.a.Identity())},se.prototype._buildSpheresAndSpurs=function(V){var K,Z;V===void 0&&(V=!0),this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this._ready=!1;var le=(K=this.utilityLayer)===null||K===void 0?void 0:K.utilityLayerScene,re=this.skeleton.bones,Q=[],W=[],Y=this.scene.animationsEnabled;try{this.options.pauseAnimations&&(this.scene.animationsEnabled=!1,le.animationsEnabled=!1),this.options.returnToRest&&this.skeleton.returnToRest(),this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();for(var q=Number.NEGATIVE_INFINITY,ae=this.options.displayOptions||{},pe=function(Ze){var ht=re[Ze];if(ht._index===-1||!De._boneIndices.has(ht.getIndex())&&!De.options.useAllBones)return"continue";var gt=new m.a;De._getAbsoluteBindPoseToRef(ht,gt);var Rt=new m.e;gt.decompose(void 0,void 0,Rt),ht.children.forEach(function(qr,Xi){var Co=new m.a;qr.getBindPose().multiplyToRef(gt,Co);var gr=new m.e;Co.decompose(void 0,void 0,gr);var Yi=m.e.Distance(Rt,gr);if(Yi>q&&(q=Yi),!V){for(var Ja=gr.clone().subtract(Rt.clone()),Ne=Ja.length(),pa=Ja.normalize().scale(Ne),ma=ae.midStep||.165,Oi=ae.midStepFactor||.215,Xe=pa.scale(ma),ur=be.a.ExtrudeShapeCustom("skeletonViewer",{shape:[new m.e(1,-1,0),new m.e(1,1,0),new m.e(-1,1,0),new m.e(-1,-1,0),new m.e(1,-1,0)],path:[m.e.Zero(),Xe,pa],scaleFunction:function(ts){switch(ts){case 0:case 2:return 0;case 1:return Ne*Oi}return 0},sideOrientation:g.a.DEFAULTSIDE,updatable:!1},le),es=ur.getTotalVertices(),Qe=[],rr=[],li=0;li<es;li++)Qe.push(1,0,0,0),ae.spurFollowsChild&&li>9?rr.push(qr.getIndex(),0,0,0):rr.push(ht.getIndex(),0,0,0);ur.position=Rt.clone(),ur.setVerticesData(me.b.MatricesWeightsKind,Qe,!1),ur.setVerticesData(me.b.MatricesIndicesKind,rr,!1),ur.convertToFlatShadedMesh(),W.push(ur)}});for(var zt=ae.sphereBaseSize||.2,un=P.a.CreateSphere("skeletonViewer",{segments:6,diameter:zt,updatable:!0},le),Br=un.getTotalVertices(),lr=[],Ur=[],Qr=0;Qr<Br;Qr++)lr.push(1,0,0,0),Ur.push(ht.getIndex(),0,0,0);un.setVerticesData(me.b.MatricesWeightsKind,lr,!1),un.setVerticesData(me.b.MatricesIndicesKind,Ur,!1),un.position=Rt.clone(),Q.push([un,ht])},De=this,de=0;de<re.length;de++)pe(de);var ge=ae.sphereScaleUnit||2,ne=ae.sphereFactor||.85,Te=[];for(de=0;de<Q.length;de++){for(var we=Q[de],Se=we[0],Ge=we[1],$e=1/(ge/q),nt=0,et=Ge;et.getParent()&&et.getParent().getIndex()!==-1;)nt++,et=et.getParent();Se.scaling.scaleInPlace($e*Math.pow(ne,nt)),Te.push(Se)}this.debugMesh=g.a.MergeMeshes(Te.concat(W),!0,!0),this.debugMesh&&(this.debugMesh.renderingGroupId=this.renderingGroupId,this.debugMesh.skeleton=this.skeleton,this.debugMesh.parent=this.mesh,this.debugMesh.computeBonesUsingShaders=(Z=this.options.computeBonesUsingShaders)===null||Z===void 0||Z,this.debugMesh.alwaysSelectAsActiveMesh=!0),this.utilityLayer._getSharedGizmoLight().intensity=.7,this._revert(Y),this.ready=!0}catch(Ze){console.error(Ze),this._revert(Y),this.dispose()}},se.prototype._buildLocalAxes=function(){var V;this._localAxes&&this._localAxes.dispose(),this._localAxes=null;var K=this.options.displayOptions||{};if(K.showLocalAxes){var Z=this._utilityLayer.utilityLayerScene,le=K.localAxesSize||.075,re=[],Q=[],W=new x.b(1,0,0,1),Y=new x.b(0,1,0,1),q=new x.b(0,0,1,1),ae=[],pe=[];for(var De in this.skeleton.bones){var de=this.skeleton.bones[De];if(de._index!==-1&&(this._boneIndices.has(de.getIndex())||this.options.useAllBones)){var ge=new m.a,ne=new m.e;this._getAbsoluteBindPoseToRef(de,ge),ge.decompose(void 0,void 0,ne);var Te=de.getBindPose().getRotationMatrix(),we=m.e.TransformCoordinates(new m.e(0+le,0,0),Te),Se=m.e.TransformCoordinates(new m.e(0,0+le,0),Te),Ge=m.e.TransformCoordinates(new m.e(0,0,0+le),Te),$e=[[ne,ne.add(we)],[ne,ne.add(Se)],[ne,ne.add(Ge)]],nt=[[W,W],[Y,Y],[q,q]];re.push.apply(re,$e),Q.push.apply(Q,nt);for(var et=0;et<6;et++)ae.push(1,0,0,0),pe.push(de.getIndex(),0,0,0)}}this._localAxes=X.a.CreateLineSystem("localAxes",{lines:re,colors:Q,updatable:!0},Z),this._localAxes.setVerticesData(me.b.MatricesWeightsKind,ae,!1),this._localAxes.setVerticesData(me.b.MatricesIndicesKind,pe,!1),this._localAxes.skeleton=this.skeleton,this._localAxes.renderingGroupId=this.renderingGroupId,this._localAxes.parent=this.mesh,this._localAxes.computeBonesUsingShaders=(V=this.options.computeBonesUsingShaders)===null||V===void 0||V}},se.prototype._displayLinesUpdate=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var V=this.mesh._effectiveMesh;this.skeleton.bones[0].length===void 0?this._getLinesForBonesNoLength(this.skeleton.bones):this._getLinesForBonesWithLength(this.skeleton.bones,V.getWorldMatrix());var K=this._utilityLayer.utilityLayerScene;K&&(this._debugMesh?X.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},K):(this._debugMesh=X.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},K),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color)}},se.prototype.changeDisplayMode=function(V){var K=!!this.isEnabled;this.displayMode!==V&&(this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.displayMode=V,this.update(),this._bindObs(),this.isEnabled=K)},se.prototype.changeDisplayOptions=function(V,K){var Z=!!this.isEnabled;this.options.displayOptions[V]=K,this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.update(),this._bindObs(),this.isEnabled=Z},se.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null),this.ready=!1},se.DISPLAY_LINES=0,se.DISPLAY_SPHERES=1,se.DISPLAY_SPHERE_AND_SPURS=2,se}()},function(f,s,c){var T="morphTargetsVertex",m=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"b",function(){return m}),c.d(s,"a",function(){return E});var T=c(0);function m(d,x,M,w,S){S===void 0&&(S=null);for(var _=new T.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new T.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R=M;R<M+w;R++){var I=3*x[R],y=d[I],p=d[I+1],g=d[I+2];_.minimizeInPlaceFromFloats(y,p,g),O.maximizeInPlaceFromFloats(y,p,g)}return S&&(_.x-=_.x*S.x+S.y,_.y-=_.y*S.x+S.y,_.z-=_.z*S.x+S.y,O.x+=O.x*S.x+S.y,O.y+=O.y*S.x+S.y,O.z+=O.z*S.x+S.y),{minimum:_,maximum:O}}function E(d,x,M,w,S){w===void 0&&(w=null);var _=new T.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),O=new T.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);S||(S=3);for(var R=x,I=x*S;R<x+M;R++,I+=S){var y=d[I],p=d[I+1],g=d[I+2];_.minimizeInPlaceFromFloats(y,p,g),O.maximizeInPlaceFromFloats(y,p,g)}return w&&(_.x-=_.x*w.x+w.y,_.y-=_.y*w.x+w.y,_.z-=_.z*w.x+w.y,O.x+=O.x*w.x+w.y,O.y+=O.y*w.x+w.y,O.z+=O.z*w.x+w.y),{minimum:_,maximum:O}}},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){}},function(f,s,c){c.d(s,"a",function(){return d});var T=c(44),m=c(0),E=c(28),d=function(){function x(M,w,S){this.vectors=T.a.BuildArray(8,m.e.Zero),this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.extendSize=m.e.Zero(),this.extendSizeWorld=m.e.Zero(),this.directions=T.a.BuildArray(3,m.e.Zero),this.vectorsWorld=T.a.BuildArray(8,m.e.Zero),this.minimumWorld=m.e.Zero(),this.maximumWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(M,w,S)}return x.prototype.reConstruct=function(M,w,S){var _=M.x,O=M.y,R=M.z,I=w.x,y=w.y,p=w.z,g=this.vectors;this.minimum.copyFromFloats(_,O,R),this.maximum.copyFromFloats(I,y,p),g[0].copyFromFloats(_,O,R),g[1].copyFromFloats(I,y,p),g[2].copyFromFloats(I,O,R),g[3].copyFromFloats(_,y,R),g[4].copyFromFloats(_,O,p),g[5].copyFromFloats(I,y,R),g[6].copyFromFloats(_,y,p),g[7].copyFromFloats(I,O,p),w.addToRef(M,this.center).scaleInPlace(.5),w.subtractToRef(M,this.extendSize).scaleInPlace(.5),this._worldMatrix=S||m.a.IdentityReadOnly,this._update(this._worldMatrix)},x.prototype.scale=function(M){var w=x.TmpVector3,S=this.maximum.subtractToRef(this.minimum,w[0]),_=S.length();S.normalizeFromLength(_);var O=_*M,R=S.scaleInPlace(.5*O),I=this.center.subtractToRef(R,w[1]),y=this.center.addToRef(R,w[2]);return this.reConstruct(I,y,this._worldMatrix),this},x.prototype.getWorldMatrix=function(){return this._worldMatrix},x.prototype._update=function(M){var w=this.minimumWorld,S=this.maximumWorld,_=this.directions,O=this.vectorsWorld,R=this.vectors;if(M.isIdentity()){for(w.copyFrom(this.minimum),S.copyFrom(this.maximum),I=0;I<8;++I)O[I].copyFrom(R[I]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{w.setAll(Number.MAX_VALUE),S.setAll(-Number.MAX_VALUE);for(var I=0;I<8;++I){var y=O[I];m.e.TransformCoordinatesToRef(R[I],M,y),w.minimizeInPlace(y),S.maximizeInPlace(y)}S.subtractToRef(w,this.extendSizeWorld).scaleInPlace(.5),S.addToRef(w,this.centerWorld).scaleInPlace(.5)}m.e.FromArrayToRef(M.m,0,_[0]),m.e.FromArrayToRef(M.m,4,_[1]),m.e.FromArrayToRef(M.m,8,_[2]),this._worldMatrix=M},x.prototype.isInFrustum=function(M){return x.IsInFrustum(this.vectorsWorld,M)},x.prototype.isCompletelyInFrustum=function(M){return x.IsCompletelyInFrustum(this.vectorsWorld,M)},x.prototype.intersectsPoint=function(M){var w=this.minimumWorld,S=this.maximumWorld,_=w.x,O=w.y,R=w.z,I=S.x,y=S.y,p=S.z,g=M.x,C=M.y,P=M.z,F=-E.a;return!(I-g<F||F>g-_)&&!(y-C<F||F>C-O)&&!(p-P<F||F>P-R)},x.prototype.intersectsSphere=function(M){return x.IntersectsSphere(this.minimumWorld,this.maximumWorld,M.centerWorld,M.radiusWorld)},x.prototype.intersectsMinMax=function(M,w){var S=this.minimumWorld,_=this.maximumWorld,O=S.x,R=S.y,I=S.z,y=_.x,p=_.y,g=_.z,C=M.x,P=M.y,F=M.z,U=w.x,B=w.y,L=w.z;return!(y<C||O>U)&&!(p<P||R>B)&&!(g<F||I>L)},x.Intersects=function(M,w){return M.intersectsMinMax(w.minimumWorld,w.maximumWorld)},x.IntersectsSphere=function(M,w,S,_){var O=x.TmpVector3[0];return m.e.ClampToRef(S,M,w,O),m.e.DistanceSquared(S,O)<=_*_},x.IsCompletelyInFrustum=function(M,w){for(var S=0;S<6;++S)for(var _=w[S],O=0;O<8;++O)if(_.dotCoordinate(M[O])<0)return!1;return!0},x.IsInFrustum=function(M,w){for(var S=0;S<6;++S){for(var _=!0,O=w[S],R=0;R<8;++R)if(O.dotCoordinate(M[R])>=0){_=!1;break}if(_)return!1}return!0},x.TmpVector3=T.a.BuildArray(3,m.e.Zero),x}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(38),m=function(){function E(){}return E.SetImmediate=function(d){T.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(d):setTimeout(d,1)},E}()},function(f,s,c){c.d(s,"a",function(){return E});var T=c(0),m=c(2),E=function(){function d(){this.previousWorldMatrices={},this.previousBones={}}return d.AddUniforms=function(x){x.push("previousWorld","previousViewProjection")},d.AddSamplers=function(x){},d.prototype.bindForSubMesh=function(x,M,w,S,_){M.prePassRenderer&&M.prePassRenderer.enabled&&M.prePassRenderer.getIndex(m.a.PREPASS_VELOCITY_TEXTURE_TYPE)!==-1&&(this.previousWorldMatrices[w.uniqueId]||(this.previousWorldMatrices[w.uniqueId]=T.a.Identity()),this.previousViewProjection||(this.previousViewProjection=M.getTransformMatrix()),x.setMatrix("previousWorld",this.previousWorldMatrices[w.uniqueId]),x.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[w.uniqueId]=S.clone(),this.previousViewProjection=M.getTransformMatrix().clone())},d}()},function(f,s,c){var T="lightFragmentDeclaration",m=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="lightUboDeclaration",m=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="imageProcessingDeclaration",m=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="imageProcessingFunctions",m=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="clipPlaneFragment",m=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="clipPlaneVertex",m=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._count=0,this._data={}}return m.prototype.copyFrom=function(E){var d=this;this.clear(),E.forEach(function(x,M){return d.add(x,M)})},m.prototype.get=function(E){var d=this._data[E];if(d!==void 0)return d},m.prototype.getOrAddWithFactory=function(E,d){var x=this.get(E);return x!==void 0||(x=d(E))&&this.add(E,x),x},m.prototype.getOrAdd=function(E,d){var x=this.get(E);return x!==void 0?x:(this.add(E,d),d)},m.prototype.contains=function(E){return this._data[E]!==void 0},m.prototype.add=function(E,d){return this._data[E]===void 0&&(this._data[E]=d,++this._count,!0)},m.prototype.set=function(E,d){return this._data[E]!==void 0&&(this._data[E]=d,!0)},m.prototype.getAndRemove=function(E){var d=this.get(E);return d!==void 0?(delete this._data[E],--this._count,d):null},m.prototype.remove=function(E){return!!this.contains(E)&&(delete this._data[E],--this._count,!0)},m.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(m.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),m.prototype.forEach=function(E){for(var d in this._data)E(d,this._data[d])},m.prototype.first=function(E){for(var d in this._data){var x=E(d,this._data[d]);if(x)return x}return null},m}()},function(f,s,c){c.d(s,"a",function(){return E});var T=c(44),m=c(0),E=function(){function d(x,M,w){this.center=m.e.Zero(),this.centerWorld=m.e.Zero(),this.minimum=m.e.Zero(),this.maximum=m.e.Zero(),this.reConstruct(x,M,w)}return d.prototype.reConstruct=function(x,M,w){this.minimum.copyFrom(x),this.maximum.copyFrom(M);var S=m.e.Distance(x,M);M.addToRef(x,this.center).scaleInPlace(.5),this.radius=.5*S,this._update(w||m.a.IdentityReadOnly)},d.prototype.scale=function(x){var M=this.radius*x,w=d.TmpVector3,S=w[0].setAll(M),_=this.center.subtractToRef(S,w[1]),O=this.center.addToRef(S,w[2]);return this.reConstruct(_,O,this._worldMatrix),this},d.prototype.getWorldMatrix=function(){return this._worldMatrix},d.prototype._update=function(x){if(x.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{m.e.TransformCoordinatesToRef(this.center,x,this.centerWorld);var M=d.TmpVector3[0];m.e.TransformNormalFromFloatsToRef(1,1,1,x,M),this.radiusWorld=Math.max(Math.abs(M.x),Math.abs(M.y),Math.abs(M.z))*this.radius}},d.prototype.isInFrustum=function(x){for(var M=this.centerWorld,w=this.radiusWorld,S=0;S<6;S++)if(x[S].dotCoordinate(M)<=-w)return!1;return!0},d.prototype.isCenterInFrustum=function(x){for(var M=this.centerWorld,w=0;w<6;w++)if(x[w].dotCoordinate(M)<0)return!1;return!0},d.prototype.intersectsPoint=function(x){var M=m.e.DistanceSquared(this.centerWorld,x);return!(this.radiusWorld*this.radiusWorld<M)},d.Intersects=function(x,M){var w=m.e.DistanceSquared(x.centerWorld,M.centerWorld),S=x.radiusWorld+M.radiusWorld;return!(S*S<w)},d.TmpVector3=T.a.BuildArray(3,m.e.Zero),d}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(m,E,d){this.bu=m,this.bv=E,this.distance=d,this.faceId=0,this.subMeshId=0}},function(f,s,c){var T="clipPlaneFragmentDeclaration",m=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="logDepthDeclaration",m=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="clipPlaneVertexDeclaration",m=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.prototype.attributeProcessor=function(E){return E.replace("attribute","in")},m.prototype.varyingProcessor=function(E,d){return E.replace("varying",d?"in":"out")},m.prototype.postProcessor=function(E,d,x){var M=E.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1;if(E=(E=E.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),x)E=(E=(E=(E=(E=(E=(E=E.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(M?"":`out vec4 glFragColor;
`)+"void main(");else if(d.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+E;return E},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.BindClipPlane=function(E,d){if(d.clipPlane){var x=d.clipPlane;E.setFloat4("vClipPlane",x.normal.x,x.normal.y,x.normal.z,x.d)}d.clipPlane2&&(x=d.clipPlane2,E.setFloat4("vClipPlane2",x.normal.x,x.normal.y,x.normal.z,x.d)),d.clipPlane3&&(x=d.clipPlane3,E.setFloat4("vClipPlane3",x.normal.x,x.normal.y,x.normal.z,x.d)),d.clipPlane4&&(x=d.clipPlane4,E.setFloat4("vClipPlane4",x.normal.x,x.normal.y,x.normal.z,x.d)),d.clipPlane5&&(x=d.clipPlane5,E.setFloat4("vClipPlane5",x.normal.x,x.normal.y,x.normal.z,x.d)),d.clipPlane6&&(x=d.clipPlane6,E.setFloat4("vClipPlane6",x.normal.x,x.normal.y,x.normal.z,x.d))},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(E){var d=16*Math.random()|0;return(E==="x"?d:3&d|8).toString(16)})},m}()},function(f,s,c){c.d(s,"a",function(){return d});var T=c(1),m=c(3),E=c(9),d=function(){function x(){this._dirty=!0,this._tempColor=new E.b(0,0,0,0),this._globalCurve=new E.b(0,0,0,0),this._highlightsCurve=new E.b(0,0,0,0),this._midtonesCurve=new E.b(0,0,0,0),this._shadowsCurve=new E.b(0,0,0,0),this._positiveCurve=new E.b(0,0,0,0),this._negativeCurve=new E.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(x.prototype,"globalHue",{get:function(){return this._globalHue},set:function(M){this._globalHue=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(M){this._globalDensity=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(M){this._globalSaturation=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(M){this._globalExposure=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(M){this._highlightsHue=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(M){this._highlightsDensity=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(M){this._highlightsSaturation=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(M){this._highlightsExposure=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(M){this._midtonesHue=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(M){this._midtonesDensity=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(M){this._midtonesSaturation=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(M){this._midtonesExposure=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(M){this._shadowsHue=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(M){this._shadowsDensity=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(M){this._shadowsSaturation=M,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(M){this._shadowsExposure=M,this._dirty=!0},enumerable:!1,configurable:!0}),x.prototype.getClassName=function(){return"ColorCurves"},x.Bind=function(M,w,S,_,O){S===void 0&&(S="vCameraColorCurvePositive"),_===void 0&&(_="vCameraColorCurveNeutral"),O===void 0&&(O="vCameraColorCurveNegative"),M._dirty&&(M._dirty=!1,M.getColorGradingDataToRef(M._globalHue,M._globalDensity,M._globalSaturation,M._globalExposure,M._globalCurve),M.getColorGradingDataToRef(M._highlightsHue,M._highlightsDensity,M._highlightsSaturation,M._highlightsExposure,M._tempColor),M._tempColor.multiplyToRef(M._globalCurve,M._highlightsCurve),M.getColorGradingDataToRef(M._midtonesHue,M._midtonesDensity,M._midtonesSaturation,M._midtonesExposure,M._tempColor),M._tempColor.multiplyToRef(M._globalCurve,M._midtonesCurve),M.getColorGradingDataToRef(M._shadowsHue,M._shadowsDensity,M._shadowsSaturation,M._shadowsExposure,M._tempColor),M._tempColor.multiplyToRef(M._globalCurve,M._shadowsCurve),M._highlightsCurve.subtractToRef(M._midtonesCurve,M._positiveCurve),M._midtonesCurve.subtractToRef(M._shadowsCurve,M._negativeCurve)),w&&(w.setFloat4(S,M._positiveCurve.r,M._positiveCurve.g,M._positiveCurve.b,M._positiveCurve.a),w.setFloat4(_,M._midtonesCurve.r,M._midtonesCurve.g,M._midtonesCurve.b,M._midtonesCurve.a),w.setFloat4(O,M._negativeCurve.r,M._negativeCurve.g,M._negativeCurve.b,M._negativeCurve.a))},x.PrepareUniforms=function(M){M.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},x.prototype.getColorGradingDataToRef=function(M,w,S,_,O){M!=null&&(M=x.clamp(M,0,360),w=x.clamp(w,-100,100),S=x.clamp(S,-100,100),_=x.clamp(_,-100,100),w=x.applyColorGradingSliderNonlinear(w),w*=.5,_=x.applyColorGradingSliderNonlinear(_),w<0&&(w*=-1,M=(M+180)%360),x.fromHSBToRef(M,w,50+.25*_,O),O.scaleToRef(2,O),O.a=1+.01*S)},x.applyColorGradingSliderNonlinear=function(M){M/=100;var w=Math.abs(M);return w=Math.pow(w,2),M<0&&(w*=-1),w*=100},x.fromHSBToRef=function(M,w,S,_){var O=x.clamp(M,0,360),R=x.clamp(w/100,0,1),I=x.clamp(S/100,0,1);if(R===0)_.r=I,_.g=I,_.b=I;else{O/=60;var y=Math.floor(O),p=O-y,g=I*(1-R),C=I*(1-R*p),P=I*(1-R*(1-p));switch(y){case 0:_.r=I,_.g=P,_.b=g;break;case 1:_.r=C,_.g=I,_.b=g;break;case 2:_.r=g,_.g=I,_.b=P;break;case 3:_.r=g,_.g=C,_.b=I;break;case 4:_.r=P,_.g=g,_.b=I;break;default:_.r=I,_.g=g,_.b=C}}_.a=1},x.clamp=function(M,w,S){return Math.min(Math.max(M,w),S)},x.prototype.clone=function(){return m.a.Clone(function(){return new x},this)},x.prototype.serialize=function(){return m.a.Serialize(this)},x.Parse=function(M){return m.a.Parse(function(){return new x},M,null,null)},Object(T.c)([Object(m.c)()],x.prototype,"_globalHue",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_globalDensity",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_globalSaturation",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_globalExposure",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_highlightsHue",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_highlightsDensity",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_highlightsSaturation",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_highlightsExposure",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_midtonesHue",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_midtonesDensity",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_midtonesSaturation",void 0),Object(T.c)([Object(m.c)()],x.prototype,"_midtonesExposure",void 0),x}();m.a._ColorCurvesParser=d.Parse},function(f,s,c){c.d(s,"a",function(){return E});var T=c(8),m=c(11),E=function(){function d(){}return d.Instantiate=function(x){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[x])return this.RegisteredExternalClasses[x];var M=m.a.GetClass(x);if(M)return M;T.a.Warn(x+" not found, you may have missed an import.");for(var w=x.split("."),S=window||this,_=0,O=w.length;_<O;_++)S=S[w[_]];return typeof S!="function"?null:S},d.RegisteredExternalClasses={},d}()},function(f,s,c){var T=c(26),m=c(2);T.a.prototype.setAlphaConstants=function(E,d,x,M){this._alphaState.setAlphaBlendConstants(E,d,x,M)},T.a.prototype.setAlphaMode=function(E,d){if(d===void 0&&(d=!1),this._alphaMode!==E){switch(E){case m.a.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case m.a.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ALPHATOCOLOR:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_REVERSEONEMINUS:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_SRC_DSTONEMINUSSRCALPHA:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_ONEONE_ONEZERO:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case m.a.ALPHA_EXCLUSION:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}d||(this.depthCullingState.depthMask=E===m.a.ALPHA_DISABLE),this._alphaMode=E}},T.a.prototype.getAlphaMode=function(){return this._alphaMode},T.a.prototype.setAlphaEquation=function(E){if(this._alphaEquation!==E){switch(E){case m.a.ALPHA_EQUATION_ADD:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case m.a.ALPHA_EQUATION_SUBSTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case m.a.ALPHA_EQUATION_REVERSE_SUBTRACT:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case m.a.ALPHA_EQUATION_MAX:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case m.a.ALPHA_EQUATION_MIN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case m.a.ALPHA_EQUATION_DARKEN:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=E}},T.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},function(f,s,c){var T=c(26);T.a.prototype.updateDynamicIndexBuffer=function(m,E,d){var x;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(m),x=E instanceof Uint16Array||E instanceof Uint32Array?E:m.is32Bits?new Uint32Array(E):new Uint16Array(E),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,x,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},T.a.prototype.updateDynamicVertexBuffer=function(m,E,d,x){this.bindArrayBuffer(m),d===void 0&&(d=0);var M=E.length||E.byteLength;x===void 0||x>=M&&d===0?E instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,new Float32Array(E)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,E):E instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(E).subarray(d,d+x)):(E=E instanceof ArrayBuffer?new Uint8Array(E,d,x):new Uint8Array(E.buffer,E.byteOffset+d,x),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,E)),this._resetVertexBufferBinding()}},function(f,s,c){var T="fogFragmentDeclaration",m=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=c(26),m=c(27);T.a.prototype.createDynamicTexture=function(E,d,x,M){var w=new m.a(this,m.b.Dynamic);return w.baseWidth=E,w.baseHeight=d,x&&(E=this.needPOTTextures?T.a.GetExponentOfTwo(E,this._caps.maxTextureSize):E,d=this.needPOTTextures?T.a.GetExponentOfTwo(d,this._caps.maxTextureSize):d),w.width=E,w.height=d,w.isReady=!1,w.generateMipMaps=x,w.samplingMode=M,this.updateTextureSamplingMode(M,w),this._internalTexturesCache.push(w),w},T.a.prototype.updateDynamicTexture=function(E,d,x,M,w,S){if(M===void 0&&(M=!1),S===void 0&&(S=!1),E){var _=this._gl,O=_.TEXTURE_2D,R=this._bindTextureDirectly(O,E,!0,S);this._unpackFlipY(x===void 0?E.invertY:x),M&&_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var I=this._getWebGLTextureType(E.type),y=this._getInternalFormat(w||E.format),p=this._getRGBABufferInternalSizedFormat(E.type,y);_.texImage2D(O,0,p,y,I,d),E.generateMipMaps&&_.generateMipmap(O),R||this._bindTextureDirectly(O,null),M&&_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E.isReady=!0}}},function(f,s,c){c.r(s),c.d(s,"AbstractScene",function(){return T.a}),c.d(s,"AbstractActionManager",function(){return m.a}),c.d(s,"Action",function(){return w}),c.d(s,"ActionEvent",function(){return S.a}),c.d(s,"ActionManager",function(){return me}),c.d(s,"Condition",function(){return O}),c.d(s,"ValueCondition",function(){return R}),c.d(s,"PredicateCondition",function(){return I}),c.d(s,"StateCondition",function(){return y}),c.d(s,"SwitchBooleanAction",function(){return C}),c.d(s,"SetStateAction",function(){return P}),c.d(s,"SetValueAction",function(){return F}),c.d(s,"IncrementValueAction",function(){return U}),c.d(s,"PlayAnimationAction",function(){return B}),c.d(s,"StopAnimationAction",function(){return L}),c.d(s,"DoNothingAction",function(){return z}),c.d(s,"CombineAction",function(){return X}),c.d(s,"ExecuteCodeAction",function(){return G}),c.d(s,"SetParentAction",function(){return ee}),c.d(s,"PlaySoundAction",function(){return ve}),c.d(s,"StopSoundAction",function(){return be}),c.d(s,"InterpolateValueAction",function(){return Y}),c.d(s,"Animatable",function(){return $e}),c.d(s,"_IAnimationState",function(){return Q}),c.d(s,"Animation",function(){return W}),c.d(s,"TargetedAnimation",function(){return nt}),c.d(s,"AnimationGroup",function(){return et}),c.d(s,"AnimationPropertiesOverride",function(){return Ze}),c.d(s,"EasingFunction",function(){return gt}),c.d(s,"CircleEase",function(){return Rt}),c.d(s,"BackEase",function(){return zt}),c.d(s,"BounceEase",function(){return un}),c.d(s,"CubicEase",function(){return Br}),c.d(s,"ElasticEase",function(){return lr}),c.d(s,"ExponentialEase",function(){return Ur}),c.d(s,"PowerEase",function(){return Qr}),c.d(s,"QuadraticEase",function(){return qr}),c.d(s,"QuarticEase",function(){return Xi}),c.d(s,"QuinticEase",function(){return Co}),c.d(s,"SineEase",function(){return gr}),c.d(s,"BezierCurveEase",function(){return Yi}),c.d(s,"RuntimeAnimation",function(){return ge}),c.d(s,"AnimationEvent",function(){return Ja}),c.d(s,"AnimationKeyInterpolation",function(){return ie}),c.d(s,"AnimationRange",function(){return K}),c.d(s,"KeepAssets",function(){return pa}),c.d(s,"InstantiatedEntries",function(){return ma}),c.d(s,"AssetContainer",function(){return Oi}),c.d(s,"Analyser",function(){return ur}),c.d(s,"AudioEngine",function(){return es}),c.d(s,"AudioSceneComponent",function(){return Vr}),c.d(s,"Sound",function(){return li}),c.d(s,"SoundTrack",function(){return ts}),c.d(s,"WeightedSound",function(){return cp}),c.d(s,"AutoRotationBehavior",function(){return Bu}),c.d(s,"BouncingBehavior",function(){return Uu}),c.d(s,"FramingBehavior",function(){return Ki}),c.d(s,"AttachToBoxBehavior",function(){return lp}),c.d(s,"FadeInOutBehavior",function(){return up}),c.d(s,"MultiPointerScaleBehavior",function(){return hp}),c.d(s,"PointerDragBehavior",function(){return ui.a}),c.d(s,"SixDofDragBehavior",function(){return Vu}),c.d(s,"Bone",function(){return Ge}),c.d(s,"BoneIKController",function(){return dp}),c.d(s,"BoneLookController",function(){return fp}),c.d(s,"Skeleton",function(){return ga}),c.d(s,"ArcRotateCameraGamepadInput",function(){return Ic}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return Dc}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return wc}),c.d(s,"ArcRotateCameraPointersInput",function(){return Lc}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return Nc}),c.d(s,"FlyCameraKeyboardInput",function(){return Fc}),c.d(s,"FlyCameraMouseInput",function(){return Oo}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return ba}),c.d(s,"FollowCameraMouseWheelInput",function(){return Bc}),c.d(s,"FollowCameraPointersInput",function(){return Uc}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return jc}),c.d(s,"FreeCameraGamepadInput",function(){return Ta}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return is}),c.d(s,"FreeCameraMouseInput",function(){return Vc}),c.d(s,"FreeCameraMouseWheelInput",function(){return os}),c.d(s,"FreeCameraTouchInput",function(){return kc}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return Mo}),c.d(s,"CameraInputTypes",function(){return Fn}),c.d(s,"CameraInputsManager",function(){return va}),c.d(s,"Camera",function(){return Tt.a}),c.d(s,"TargetCamera",function(){return Zr}),c.d(s,"FreeCamera",function(){return dr}),c.d(s,"FreeCameraInputsManager",function(){return ya}),c.d(s,"TouchCamera",function(){return Gc}),c.d(s,"ArcRotateCamera",function(){return Mi}),c.d(s,"ArcRotateCameraInputsManager",function(){return rs}),c.d(s,"DeviceOrientationCamera",function(){return Io}),c.d(s,"FlyCamera",function(){return qi}),c.d(s,"FlyCameraInputsManager",function(){return Wc}),c.d(s,"FollowCamera",function(){return Hc}),c.d(s,"ArcFollowCamera",function(){return Wu}),c.d(s,"FollowCameraInputsManager",function(){return Do}),c.d(s,"GamepadCamera",function(){return hn}),c.d(s,"AnaglyphArcRotateCamera",function(){return Jb}),c.d(s,"AnaglyphFreeCamera",function(){return ey}),c.d(s,"AnaglyphGamepadCamera",function(){return ty}),c.d(s,"AnaglyphUniversalCamera",function(){return ny}),c.d(s,"StereoscopicArcRotateCamera",function(){return ry}),c.d(s,"StereoscopicFreeCamera",function(){return iy}),c.d(s,"StereoscopicGamepadCamera",function(){return oy}),c.d(s,"StereoscopicUniversalCamera",function(){return ay}),c.d(s,"UniversalCamera",function(){return Ft}),c.d(s,"VirtualJoysticksCamera",function(){return sy}),c.d(s,"VRCameraMetrics",function(){return cs}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return hy}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return Xu}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return dy}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return q1}),c.d(s,"VRExperienceHelper",function(){return _y}),c.d(s,"WebVRFreeCamera",function(){return Ku}),c.d(s,"Collider",function(){return gy}),c.d(s,"DefaultCollisionCoordinator",function(){return vy}),c.d(s,"PickingInfo",function(){return xa.a}),c.d(s,"IntersectionInfo",function(){return Z1.a}),c.d(s,"_MeshCollisionData",function(){return $1.a}),c.d(s,"BoundingBox",function(){return Sp.a}),c.d(s,"BoundingInfo",function(){return Fo.a}),c.d(s,"BoundingSphere",function(){return by.a}),c.d(s,"Octree",function(){return Yc}),c.d(s,"OctreeBlock",function(){return yy}),c.d(s,"OctreeSceneComponent",function(){return Rp}),c.d(s,"Ray",function(){return Bn.a}),c.d(s,"AxesViewer",function(){return Pa.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return Pa.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return Pa.DebugLayerTab}),c.d(s,"DebugLayer",function(){return Pa.DebugLayer}),c.d(s,"PhysicsViewer",function(){return Pa.PhysicsViewer}),c.d(s,"RayHelper",function(){return Pa.RayHelper}),c.d(s,"SkeletonViewer",function(){return Pa.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return Ty}),c.d(s,"DeviceType",function(){return dn}),c.d(s,"PointerInput",function(){return xp}),c.d(s,"DualShockInput",function(){return Pp}),c.d(s,"XboxInput",function(){return Ap}),c.d(s,"SwitchInput",function(){return Cp}),c.d(s,"DeviceSource",function(){return Ey}),c.d(s,"DeviceSourceManager",function(){return J1}),c.d(s,"Constants",function(){return g.a}),c.d(s,"ThinEngine",function(){return Xt.a}),c.d(s,"Engine",function(){return Xe.a}),c.d(s,"EngineStore",function(){return $.a}),c.d(s,"NullEngineOptions",function(){return Sy.b}),c.d(s,"NullEngine",function(){return Sy.a}),c.d(s,"_OcclusionDataStorage",function(){return Py}),c.d(s,"_forceTransformFeedbackToBundle",function(){return eI}),c.d(s,"EngineView",function(){return tI}),c.d(s,"WebGLPipelineContext",function(){return rI.a}),c.d(s,"WebGL2ShaderProcessor",function(){return Ay.a}),c.d(s,"NativeEngine",function(){return cI}),c.d(s,"ShaderCodeInliner",function(){return Mp}),c.d(s,"PerformanceConfigurator",function(){return lI.a}),c.d(s,"KeyboardEventTypes",function(){return Qi.a}),c.d(s,"KeyboardInfo",function(){return Qi.b}),c.d(s,"KeyboardInfoPre",function(){return Qi.c}),c.d(s,"PointerEventTypes",function(){return xt.a}),c.d(s,"PointerInfoBase",function(){return xt.c}),c.d(s,"PointerInfoPre",function(){return xt.d}),c.d(s,"PointerInfo",function(){return xt.b}),c.d(s,"ClipboardEventTypes",function(){return $u}),c.d(s,"ClipboardInfo",function(){return uI}),c.d(s,"DaydreamController",function(){return Dp}),c.d(s,"GearVRController",function(){return wp}),c.d(s,"GenericController",function(){return Ju}),c.d(s,"OculusTouchController",function(){return Lp}),c.d(s,"PoseEnabledControllerType",function(){return kr}),c.d(s,"PoseEnabledControllerHelper",function(){return Di}),c.d(s,"PoseEnabledController",function(){return Ie}),c.d(s,"ViveController",function(){return My}),c.d(s,"WebVRController",function(){return Lo}),c.d(s,"WindowsMotionController",function(){return eh}),c.d(s,"XRWindowsMotionController",function(){return dI}),c.d(s,"StickValues",function(){return pp}),c.d(s,"Gamepad",function(){return Mn}),c.d(s,"GenericPad",function(){return ju}),c.d(s,"GamepadManager",function(){return an}),c.d(s,"GamepadSystemSceneComponent",function(){return yn}),c.d(s,"Xbox360Button",function(){return ir}),c.d(s,"Xbox360Dpad",function(){return Ii}),c.d(s,"Xbox360Pad",function(){return yt}),c.d(s,"DualShockButton",function(){return je}),c.d(s,"DualShockDpad",function(){return Ke}),c.d(s,"DualShockPad",function(){return Yt}),c.d(s,"AxisDragGizmo",function(){return th.a}),c.d(s,"AxisScaleGizmo",function(){return qc}),c.d(s,"BoundingBoxGizmo",function(){return Iy}),c.d(s,"Gizmo",function(){return Or.a}),c.d(s,"GizmoManager",function(){return fI}),c.d(s,"PlaneRotationGizmo",function(){return nh}),c.d(s,"PositionGizmo",function(){return wy}),c.d(s,"RotationGizmo",function(){return Dy}),c.d(s,"ScaleGizmo",function(){return Ly}),c.d(s,"LightGizmo",function(){return pI}),c.d(s,"CameraGizmo",function(){return _I}),c.d(s,"PlaneDragGizmo",function(){return rh}),c.d(s,"EnvironmentHelper",function(){return kp}),c.d(s,"PhotoDome",function(){return RI}),c.d(s,"_forceSceneHelpersToBundle",function(){return bD}),c.d(s,"VideoDome",function(){return yD}),c.d(s,"EngineInstrumentation",function(){return TD}),c.d(s,"SceneInstrumentation",function(){return ED}),c.d(s,"_TimeToken",function(){return xy}),c.d(s,"EffectLayer",function(){return il}),c.d(s,"EffectLayerSceneComponent",function(){return Zy}),c.d(s,"GlowLayer",function(){return dh}),c.d(s,"HighlightLayer",function(){return Kp}),c.d(s,"Layer",function(){return MD}),c.d(s,"LayerSceneComponent",function(){return Jy}),c.d(s,"LensFlare",function(){return e0}),c.d(s,"LensFlareSystem",function(){return Qp}),c.d(s,"LensFlareSystemSceneComponent",function(){return t0}),c.d(s,"Light",function(){return ro.a}),c.d(s,"ShadowLight",function(){return ih}),c.d(s,"ShadowGenerator",function(){return Dr}),c.d(s,"CascadedShadowGenerator",function(){return qp}),c.d(s,"ShadowGeneratorSceneComponent",function(){return c0}),c.d(s,"DirectionalLight",function(){return Fp}),c.d(s,"HemisphericLight",function(){return Yu.a}),c.d(s,"PointLight",function(){return Zp}),c.d(s,"SpotLight",function(){return Bp}),c.d(s,"DefaultLoadingScreen",function(){return l0}),c.d(s,"_BabylonLoaderRegistered",function(){return QD}),c.d(s,"BabylonFileLoaderConfiguration",function(){return gh}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return to}),c.d(s,"SceneLoader",function(){return Zt}),c.d(s,"SceneLoaderFlags",function(){return no.a}),c.d(s,"BackgroundMaterial",function(){return $c}),c.d(s,"ColorCurves",function(){return ZD.a}),c.d(s,"EffectFallbacks",function(){return ms.a}),c.d(s,"Effect",function(){return We.a}),c.d(s,"FresnelParameters",function(){return T0}),c.d(s,"ImageProcessingConfigurationDefines",function(){return Jn.b}),c.d(s,"ImageProcessingConfiguration",function(){return Jn.a}),c.d(s,"Material",function(){return nn.a}),c.d(s,"MaterialDefines",function(){return ah.a}),c.d(s,"ThinMaterialHelper",function(){return E0.a}),c.d(s,"MaterialHelper",function(){return ot.a}),c.d(s,"MultiMaterial",function(){return Aa.a}),c.d(s,"PBRMaterialDefines",function(){return zp}),c.d(s,"PBRBaseMaterial",function(){return Gn}),c.d(s,"PBRBaseSimpleMaterial",function(){return nm}),c.d(s,"PBRMaterial",function(){return tl}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return S0}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return x0}),c.d(s,"PushMaterial",function(){return sh.a}),c.d(s,"ShaderMaterial",function(){return vh.a}),c.d(s,"StandardMaterialDefines",function(){return Qt.b}),c.d(s,"StandardMaterial",function(){return Qt.a}),c.d(s,"BaseTexture",function(){return jr.a}),c.d(s,"ColorGradingTexture",function(){return P0}),c.d(s,"CubeTexture",function(){return di}),c.d(s,"DynamicTexture",function(){return Zi.a}),c.d(s,"EquiRectangularCubeTexture",function(){return A0}),c.d(s,"HDRFiltering",function(){return f0}),c.d(s,"HDRCubeTexture",function(){return ph}),c.d(s,"HtmlElementTexture",function(){return $D}),c.d(s,"InternalTextureSource",function(){return Mt.b}),c.d(s,"InternalTexture",function(){return Mt.a}),c.d(s,"_DDSTextureLoader",function(){return Vy}),c.d(s,"_ENVTextureLoader",function(){return ky}),c.d(s,"_KTXTextureLoader",function(){return jy}),c.d(s,"_TGATextureLoader",function(){return C0}),c.d(s,"_BasisTextureLoader",function(){return R0}),c.d(s,"MirrorTexture",function(){return Vp}),c.d(s,"MultiRenderTarget",function(){return rm}),c.d(s,"TexturePacker",function(){return tw}),c.d(s,"TexturePackerFrame",function(){return im}),c.d(s,"CustomProceduralTexture",function(){return rw}),c.d(s,"NoiseProceduralTexture",function(){return M0}),c.d(s,"ProceduralTexture",function(){return sl}),c.d(s,"ProceduralTextureSceneComponent",function(){return O0}),c.d(s,"RawCubeTexture",function(){return ow}),c.d(s,"RawTexture",function(){return hr}),c.d(s,"RawTexture2DArray",function(){return aw}),c.d(s,"RawTexture3D",function(){return sw}),c.d(s,"RefractionTexture",function(){return cw}),c.d(s,"RenderTargetTexture",function(){return Un}),c.d(s,"Texture",function(){return Ve.a}),c.d(s,"VideoTexture",function(){return qy}),c.d(s,"UniformBuffer",function(){return cy.a}),c.d(s,"MaterialFlags",function(){return pt.a}),c.d(s,"NodeMaterialBlockTargets",function(){return Re}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return ue}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return Qn}),c.d(s,"NodeMaterialSystemValues",function(){return Pt}),c.d(s,"NodeMaterialModes",function(){return yr}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return mi}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return or}),c.d(s,"NodeMaterialConnectionPoint",function(){return yh}),c.d(s,"NodeMaterialBlock",function(){return vt}),c.d(s,"NodeMaterialDefines",function(){return hl}),c.d(s,"NodeMaterial",function(){return Ph}),c.d(s,"VertexOutputBlock",function(){return cl}),c.d(s,"BonesBlock",function(){return N0}),c.d(s,"InstancesBlock",function(){return F0}),c.d(s,"MorphTargetsBlock",function(){return B0}),c.d(s,"LightInformationBlock",function(){return U0}),c.d(s,"FragmentOutputBlock",function(){return Ps}),c.d(s,"ImageProcessingBlock",function(){return V0}),c.d(s,"PerturbNormalBlock",function(){return k0}),c.d(s,"DiscardBlock",function(){return j0}),c.d(s,"FrontFacingBlock",function(){return z0}),c.d(s,"DerivativeBlock",function(){return G0}),c.d(s,"FragCoordBlock",function(){return W0}),c.d(s,"ScreenSizeBlock",function(){return H0}),c.d(s,"FogBlock",function(){return X0}),c.d(s,"LightBlock",function(){return Y0}),c.d(s,"TextureBlock",function(){return K0}),c.d(s,"ReflectionTextureBlock",function(){return Q0}),c.d(s,"CurrentScreenBlock",function(){return am}),c.d(s,"InputBlock",function(){return It}),c.d(s,"AnimatedInputBlockTypes",function(){return ko}),c.d(s,"MultiplyBlock",function(){return Eh}),c.d(s,"AddBlock",function(){return q0}),c.d(s,"ScaleBlock",function(){return Z0}),c.d(s,"ClampBlock",function(){return $0}),c.d(s,"CrossBlock",function(){return J0}),c.d(s,"DotBlock",function(){return eT}),c.d(s,"TransformBlock",function(){return Th}),c.d(s,"RemapBlock",function(){return um}),c.d(s,"NormalizeBlock",function(){return tT}),c.d(s,"TrigonometryBlockOperations",function(){return Cn}),c.d(s,"TrigonometryBlock",function(){return gm}),c.d(s,"ColorMergerBlock",function(){return nT}),c.d(s,"VectorMergerBlock",function(){return ll}),c.d(s,"ColorSplitterBlock",function(){return _m}),c.d(s,"VectorSplitterBlock",function(){return rT}),c.d(s,"LerpBlock",function(){return iT}),c.d(s,"DivideBlock",function(){return oT}),c.d(s,"SubtractBlock",function(){return aT}),c.d(s,"StepBlock",function(){return sT}),c.d(s,"OneMinusBlock",function(){return ym}),c.d(s,"ViewDirectionBlock",function(){return Tm}),c.d(s,"FresnelBlock",function(){return cT}),c.d(s,"MaxBlock",function(){return lT}),c.d(s,"MinBlock",function(){return uT}),c.d(s,"DistanceBlock",function(){return hT}),c.d(s,"LengthBlock",function(){return dT}),c.d(s,"NegateBlock",function(){return fT}),c.d(s,"PowBlock",function(){return pT}),c.d(s,"RandomNumberBlock",function(){return mT}),c.d(s,"ArcTan2Block",function(){return _T}),c.d(s,"SmoothStepBlock",function(){return gT}),c.d(s,"ReciprocalBlock",function(){return vT}),c.d(s,"ReplaceColorBlock",function(){return bT}),c.d(s,"PosterizeBlock",function(){return yT}),c.d(s,"WaveBlockKind",function(){return Ca}),c.d(s,"WaveBlock",function(){return TT}),c.d(s,"GradientBlockColorStep",function(){return Ah}),c.d(s,"GradientBlock",function(){return ET}),c.d(s,"NLerpBlock",function(){return ST}),c.d(s,"WorleyNoise3DBlock",function(){return xT}),c.d(s,"SimplexPerlin3DBlock",function(){return PT}),c.d(s,"NormalBlendBlock",function(){return AT}),c.d(s,"Rotate2dBlock",function(){return CT}),c.d(s,"ReflectBlock",function(){return RT}),c.d(s,"RefractBlock",function(){return OT}),c.d(s,"DesaturateBlock",function(){return MT}),c.d(s,"PBRMetallicRoughnessBlock",function(){return IT}),c.d(s,"SheenBlock",function(){return Em}),c.d(s,"AnisotropyBlock",function(){return Sm}),c.d(s,"ReflectionBlock",function(){return xm}),c.d(s,"ClearCoatBlock",function(){return Ch}),c.d(s,"RefractionBlock",function(){return Pm}),c.d(s,"SubSurfaceBlock",function(){return Rh}),c.d(s,"ParticleTextureBlock",function(){return sm}),c.d(s,"ParticleRampGradientBlock",function(){return cm}),c.d(s,"ParticleBlendMultiplyBlock",function(){return lm}),c.d(s,"ModBlock",function(){return DT}),c.d(s,"NodeMaterialOptimizer",function(){return fw}),c.d(s,"PropertyTypeForEdition",function(){return Wt}),c.d(s,"editableInPropertyPage",function(){return $t}),c.d(s,"EffectRenderer",function(){return h0}),c.d(s,"EffectWrapper",function(){return d0}),c.d(s,"ShadowDepthWrapper",function(){return _w}),c.d(s,"Scalar",function(){return se.a}),c.d(s,"extractMinAndMaxIndexed",function(){return wT.b}),c.d(s,"extractMinAndMax",function(){return wT.a}),c.d(s,"Space",function(){return Se.c}),c.d(s,"Axis",function(){return Se.a}),c.d(s,"Coordinate",function(){return Se.b}),c.d(s,"Color3",function(){return x.a}),c.d(s,"Color4",function(){return x.b}),c.d(s,"TmpColors",function(){return x.c}),c.d(s,"ToGammaSpace",function(){return Gt.b}),c.d(s,"ToLinearSpace",function(){return Gt.c}),c.d(s,"Epsilon",function(){return Gt.a}),c.d(s,"Frustum",function(){return uy.a}),c.d(s,"Orientation",function(){return ht.e}),c.d(s,"BezierCurve",function(){return ht.c}),c.d(s,"Angle",function(){return ht.a}),c.d(s,"Arc2",function(){return ht.b}),c.d(s,"Path2",function(){return ht.f}),c.d(s,"Path3D",function(){return ht.g}),c.d(s,"Curve3",function(){return ht.d}),c.d(s,"Plane",function(){return us.a}),c.d(s,"Size",function(){return le.a}),c.d(s,"Vector2",function(){return d.d}),c.d(s,"Vector3",function(){return d.e}),c.d(s,"Vector4",function(){return d.f}),c.d(s,"Quaternion",function(){return d.b}),c.d(s,"Matrix",function(){return d.a}),c.d(s,"TmpVectors",function(){return d.c}),c.d(s,"PositionNormalVertex",function(){return Up}),c.d(s,"PositionNormalTextureVertex",function(){return mI}),c.d(s,"Viewport",function(){return $r.a}),c.d(s,"SphericalHarmonics",function(){return Op}),c.d(s,"SphericalPolynomial",function(){return Qc}),c.d(s,"AbstractMesh",function(){return Lt.a}),c.d(s,"Buffer",function(){return Me.a}),c.d(s,"VertexBuffer",function(){return Me.b}),c.d(s,"DracoCompression",function(){return vw}),c.d(s,"CSG",function(){return Tw}),c.d(s,"Geometry",function(){return $p.a}),c.d(s,"GroundMesh",function(){return qu}),c.d(s,"TrailMesh",function(){return Ew}),c.d(s,"InstancedMesh",function(){return Sw.a}),c.d(s,"LinesMesh",function(){return fl.b}),c.d(s,"InstancedLinesMesh",function(){return fl.a}),c.d(s,"_CreationDataStorage",function(){return Ne.b}),c.d(s,"_InstancesBatch",function(){return Ne.c}),c.d(s,"Mesh",function(){return Ne.a}),c.d(s,"VertexData",function(){return _t.a}),c.d(s,"MeshBuilder",function(){return Aw}),c.d(s,"SimplificationSettings",function(){return Cw}),c.d(s,"SimplificationQueue",function(){return VT}),c.d(s,"SimplificationType",function(){return _l}),c.d(s,"QuadraticErrorSimplification",function(){return jT}),c.d(s,"SimplicationQueueSceneComponent",function(){return zT}),c.d(s,"Polygon",function(){return Pw}),c.d(s,"PolygonMeshBuilder",function(){return BT}),c.d(s,"SubMesh",function(){return dl.a}),c.d(s,"MeshLODLevel",function(){return Iw.a}),c.d(s,"TransformNode",function(){return ps.a}),c.d(s,"BoxBuilder",function(){return fs.a}),c.d(s,"TiledBoxBuilder",function(){return FT}),c.d(s,"DiscBuilder",function(){return Oh}),c.d(s,"RibbonBuilder",function(){return pl.a}),c.d(s,"SphereBuilder",function(){return Mr.a}),c.d(s,"HemisphereBuilder",function(){return oh}),c.d(s,"CylinderBuilder",function(){return wi.a}),c.d(s,"TorusBuilder",function(){return ls}),c.d(s,"TorusKnotBuilder",function(){return Rm}),c.d(s,"LinesBuilder",function(){return kn.a}),c.d(s,"PolygonBuilder",function(){return ml}),c.d(s,"ShapeBuilder",function(){return _h.a}),c.d(s,"LatheBuilder",function(){return Mm}),c.d(s,"PlaneBuilder",function(){return Np.a}),c.d(s,"TiledPlaneBuilder",function(){return UT}),c.d(s,"GroundBuilder",function(){return No}),c.d(s,"TubeBuilder",function(){return Im}),c.d(s,"PolyhedronBuilder",function(){return Zc}),c.d(s,"IcoSphereBuilder",function(){return Dm}),c.d(s,"DecalBuilder",function(){return wm}),c.d(s,"CapsuleBuilder",function(){return Lm}),c.d(s,"DataBuffer",function(){return Cy.a}),c.d(s,"WebGLDataBuffer",function(){return Dw.a}),c.d(s,"MorphTarget",function(){return p0}),c.d(s,"MorphTargetManager",function(){return mh}),c.d(s,"RecastJSPlugin",function(){return ww}),c.d(s,"RecastJSCrowd",function(){return GT}),c.d(s,"Node",function(){return Z.a}),c.d(s,"Database",function(){return WT}),c.d(s,"BaseParticleSystem",function(){return ul}),c.d(s,"BoxParticleEmitter",function(){return As}),c.d(s,"ConeParticleEmitter",function(){return hm}),c.d(s,"CylinderParticleEmitter",function(){return Sh}),c.d(s,"CylinderDirectedParticleEmitter",function(){return dm}),c.d(s,"HemisphericParticleEmitter",function(){return fm}),c.d(s,"PointParticleEmitter",function(){return pm}),c.d(s,"SphereParticleEmitter",function(){return xh}),c.d(s,"SphereDirectedParticleEmitter",function(){return mm}),c.d(s,"CustomParticleEmitter",function(){return Cs}),c.d(s,"MeshParticleEmitter",function(){return w0}),c.d(s,"GPUParticleSystem",function(){return Ra}),c.d(s,"Particle",function(){return XT}),c.d(s,"ParticleHelper",function(){return jw}),c.d(s,"ParticleSystem",function(){return jn}),c.d(s,"ParticleSystemSet",function(){return Mh}),c.d(s,"SolidParticle",function(){return Bm}),c.d(s,"ModelShape",function(){return Um}),c.d(s,"DepthSortedParticle",function(){return YT}),c.d(s,"SolidParticleVertex",function(){return KT}),c.d(s,"SolidParticleSystem",function(){return zw}),c.d(s,"CloudPoint",function(){return QT}),c.d(s,"PointsGroup",function(){return Ih}),c.d(s,"PointColor",function(){return ar}),c.d(s,"PointsCloudSystem",function(){return Gw}),c.d(s,"SubEmitterType",function(){return Rs}),c.d(s,"SubEmitter",function(){return gl}),c.d(s,"PhysicsEngine",function(){return Ss}),c.d(s,"PhysicsEngineSceneComponent",function(){return qT}),c.d(s,"PhysicsHelper",function(){return Ww}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return Ms}),c.d(s,"PhysicsUpdraftEventOptions",function(){return Vm}),c.d(s,"PhysicsVortexEventOptions",function(){return km}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return vl}),c.d(s,"PhysicsUpdraftMode",function(){return Os}),c.d(s,"PhysicsImpostor",function(){return Dt.a}),c.d(s,"PhysicsJoint",function(){return Pn.e}),c.d(s,"DistanceJoint",function(){return Pn.a}),c.d(s,"MotorEnabledJoint",function(){return Pn.d}),c.d(s,"HingeJoint",function(){return Pn.c}),c.d(s,"Hinge2Joint",function(){return Pn.b}),c.d(s,"CannonJSPlugin",function(){return tm}),c.d(s,"AmmoJSPlugin",function(){return _0}),c.d(s,"OimoJSPlugin",function(){return m0}),c.d(s,"AnaglyphPostProcess",function(){return _p}),c.d(s,"BlackAndWhitePostProcess",function(){return $T}),c.d(s,"BloomEffect",function(){return Gm}),c.d(s,"BloomMergePostProcess",function(){return zm}),c.d(s,"BlurPostProcess",function(){return Yn}),c.d(s,"ChromaticAberrationPostProcess",function(){return Wm}),c.d(s,"CircleOfConfusionPostProcess",function(){return Hm}),c.d(s,"ColorCorrectionPostProcess",function(){return JT}),c.d(s,"ConvolutionPostProcess",function(){return eE}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return Dh}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return Oa}),c.d(s,"DepthOfFieldEffect",function(){return Xm}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return nL}),c.d(s,"DepthOfFieldMergePostProcess",function(){return tE}),c.d(s,"DisplayPassPostProcess",function(){return nE}),c.d(s,"ExtractHighlightsPostProcess",function(){return jm}),c.d(s,"FilterPostProcess",function(){return rE}),c.d(s,"FxaaPostProcess",function(){return bl}),c.d(s,"GrainPostProcess",function(){return Ym}),c.d(s,"HighlightsPostProcess",function(){return lL}),c.d(s,"ImageProcessingPostProcess",function(){return Qu}),c.d(s,"MotionBlurPostProcess",function(){return Km}),c.d(s,"PassPostProcess",function(){return wo}),c.d(s,"PassCubePostProcess",function(){return W1}),c.d(s,"PostProcess",function(){return bt}),c.d(s,"PostProcessManager",function(){return vp.a}),c.d(s,"RefractionPostProcess",function(){return oE}),c.d(s,"DefaultRenderingPipeline",function(){return cE}),c.d(s,"LensRenderingPipeline",function(){return vL}),c.d(s,"SSAO2RenderingPipeline",function(){return lE}),c.d(s,"SSAORenderingPipeline",function(){return SL}),c.d(s,"StandardRenderingPipeline",function(){return uE}),c.d(s,"PostProcessRenderEffect",function(){return Bt}),c.d(s,"PostProcessRenderPipeline",function(){return Is}),c.d(s,"PostProcessRenderPipelineManager",function(){return aE}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return sE}),c.d(s,"SharpenPostProcess",function(){return Qm}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return RL}),c.d(s,"StereoscopicInterlacePostProcess",function(){return OL}),c.d(s,"TonemappingOperator",function(){return Ma}),c.d(s,"TonemapPostProcess",function(){return IL}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return hE}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return gp}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return bp}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return qm}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return dE}),c.d(s,"ReflectionProbe",function(){return g0}),c.d(s,"BoundingBoxRenderer",function(){return fE}),c.d(s,"DepthRenderer",function(){return fh}),c.d(s,"DepthRendererSceneComponent",function(){return pE}),c.d(s,"EdgesRenderer",function(){return Zm}),c.d(s,"LineEdgesRenderer",function(){return mE}),c.d(s,"GeometryBufferRenderer",function(){return _i}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return iE}),c.d(s,"PrePassRenderer",function(){return $m}),c.d(s,"PrePassRendererSceneComponent",function(){return _E}),c.d(s,"SubSurfaceSceneComponent",function(){return vE}),c.d(s,"OutlineRenderer",function(){return bE}),c.d(s,"RenderingGroup",function(){return WL.a}),c.d(s,"RenderingGroupInfo",function(){return Xc.a}),c.d(s,"RenderingManager",function(){return Xc.b}),c.d(s,"UtilityLayerRenderer",function(){return br.a}),c.d(s,"Scene",function(){return ne.a}),c.d(s,"SceneComponentConstants",function(){return ct.a}),c.d(s,"Stage",function(){return ct.b}),c.d(s,"Sprite",function(){return yE}),c.d(s,"SpriteManager",function(){return EE}),c.d(s,"SpriteMap",function(){return qL}),c.d(s,"SpritePackedManager",function(){return ZL}),c.d(s,"SpriteSceneComponent",function(){return TE}),c.d(s,"AlphaState",function(){return $L.a}),c.d(s,"DepthCullingState",function(){return JL.a}),c.d(s,"StencilState",function(){return eN.a}),c.d(s,"AndOrNotEvaluator",function(){return tN.a}),c.d(s,"AssetTaskState",function(){return Ni}),c.d(s,"AbstractAssetTask",function(){return Fi}),c.d(s,"AssetsProgressEvent",function(){return SE}),c.d(s,"ContainerAssetTask",function(){return xE}),c.d(s,"MeshAssetTask",function(){return PE}),c.d(s,"TextFileAssetTask",function(){return AE}),c.d(s,"BinaryFileAssetTask",function(){return CE}),c.d(s,"ImageAssetTask",function(){return RE}),c.d(s,"TextureAssetTask",function(){return OE}),c.d(s,"CubeTextureAssetTask",function(){return ME}),c.d(s,"HDRCubeTextureAssetTask",function(){return IE}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return DE}),c.d(s,"AssetsManager",function(){return nN}),c.d(s,"BasisTranscodeConfiguration",function(){return JD}),c.d(s,"BasisTools",function(){return al}),c.d(s,"DDSTools",function(){return Uo}),c.d(s,"expandToProperty",function(){return V.b}),c.d(s,"serialize",function(){return V.c}),c.d(s,"serializeAsTexture",function(){return V.m}),c.d(s,"serializeAsColor3",function(){return V.e}),c.d(s,"serializeAsFresnelParameters",function(){return V.h}),c.d(s,"serializeAsVector2",function(){return V.n}),c.d(s,"serializeAsVector3",function(){return V.o}),c.d(s,"serializeAsMeshReference",function(){return V.k}),c.d(s,"serializeAsColorCurves",function(){return V.g}),c.d(s,"serializeAsColor4",function(){return V.f}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return V.i}),c.d(s,"serializeAsQuaternion",function(){return V.l}),c.d(s,"serializeAsMatrix",function(){return V.j}),c.d(s,"serializeAsCameraReference",function(){return V.d}),c.d(s,"SerializationHelper",function(){return V.a}),c.d(s,"Deferred",function(){return rN}),c.d(s,"EnvironmentTextureTools",function(){return eo}),c.d(s,"MeshExploder",function(){return iN}),c.d(s,"FilesInput",function(){return oN}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return Zu}),c.d(s,"HDRTools",function(){return u0}),c.d(s,"PanoramaToCubeMapTools",function(){return Jp}),c.d(s,"KhronosTextureContainer",function(){return hh}),c.d(s,"EventState",function(){return E.a}),c.d(s,"Observer",function(){return E.d}),c.d(s,"MultiObserver",function(){return E.b}),c.d(s,"Observable",function(){return E.c}),c.d(s,"PerformanceMonitor",function(){return wE.a}),c.d(s,"RollingAverage",function(){return wE.b}),c.d(s,"PromisePolyfill",function(){return aN.a}),c.d(s,"SceneOptimization",function(){return Bi}),c.d(s,"TextureOptimization",function(){return wh}),c.d(s,"HardwareScalingOptimization",function(){return e_}),c.d(s,"ShadowsOptimization",function(){return Lh}),c.d(s,"PostProcessesOptimization",function(){return Nh}),c.d(s,"LensFlaresOptimization",function(){return Fh}),c.d(s,"CustomOptimization",function(){return LE}),c.d(s,"ParticlesOptimization",function(){return Bh}),c.d(s,"RenderTargetsOptimization",function(){return t_}),c.d(s,"MergeMeshesOptimization",function(){return Uh}),c.d(s,"SceneOptimizerOptions",function(){return n_}),c.d(s,"SceneOptimizer",function(){return sN}),c.d(s,"SceneSerializer",function(){return i_}),c.d(s,"SmartArray",function(){return In.a}),c.d(s,"SmartArrayNoDuplicate",function(){return In.b}),c.d(s,"StringDictionary",function(){return Gu.a}),c.d(s,"Tags",function(){return cN.a}),c.d(s,"TextureTools",function(){return lN}),c.d(s,"TGATools",function(){return bh}),c.d(s,"Tools",function(){return Qe.b}),c.d(s,"className",function(){return Qe.c}),c.d(s,"AsyncLoop",function(){return Qe.a}),c.d(s,"VideoRecorder",function(){return uN}),c.d(s,"JoystickAxis",function(){return xn}),c.d(s,"VirtualJoystick",function(){return zc}),c.d(s,"WorkerPool",function(){return Wp}),c.d(s,"Logger",function(){return p.a}),c.d(s,"_TypeStore",function(){return M.a}),c.d(s,"FilesInputStore",function(){return Ip.a}),c.d(s,"DeepCopier",function(){return fe.a}),c.d(s,"PivotTools",function(){return vr.a}),c.d(s,"PrecisionDate",function(){return Te.a}),c.d(s,"ScreenshotTools",function(){return yl}),c.d(s,"WebRequest",function(){return re.a}),c.d(s,"InspectableType",function(){return Jm}),c.d(s,"BRDFTextureTools",function(){return ch}),c.d(s,"RGBDTextureTools",function(){return Ny}),c.d(s,"ColorGradient",function(){return Nm}),c.d(s,"Color3Gradient",function(){return HT}),c.d(s,"FactorGradient",function(){return Fm}),c.d(s,"GradientHelper",function(){return Tr}),c.d(s,"PerfCounter",function(){return zr.a}),c.d(s,"RetryStrategy",function(){return hN.a}),c.d(s,"CanvasGenerator",function(){return yp.a}),c.d(s,"LoadFileError",function(){return Kc.b}),c.d(s,"RequestFileError",function(){return Kc.d}),c.d(s,"ReadFileError",function(){return Kc.c}),c.d(s,"FileTools",function(){return Kc.a}),c.d(s,"StringTools",function(){return Jr.a}),c.d(s,"DataReader",function(){return dN}),c.d(s,"MinMaxReducer",function(){return i0}),c.d(s,"DepthReducer",function(){return o0}),c.d(s,"DataStorage",function(){return fN}),c.d(s,"SceneRecorder",function(){return pN}),c.d(s,"KhronosTextureContainer2",function(){return Hp}),c.d(s,"Trajectory",function(){return mN}),c.d(s,"TrajectoryClassifier",function(){return _N}),c.d(s,"TimerState",function(){return Vo}),c.d(s,"setAndStartTimer",function(){return Yp}),c.d(s,"AdvancedTimer",function(){return gD}),c.d(s,"CopyTools",function(){return gN.a}),c.d(s,"WebXRCamera",function(){return zy}),c.d(s,"WebXREnterExitUIButton",function(){return Yy}),c.d(s,"WebXREnterExitUIOptions",function(){return _D}),c.d(s,"WebXREnterExitUI",function(){return Ky}),c.d(s,"WebXRExperienceHelper",function(){return Gy}),c.d(s,"WebXRInput",function(){return Xy}),c.d(s,"WebXRInputSource",function(){return Hy}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return Tp}),c.d(s,"WebXRManagedOutputCanvas",function(){return fy}),c.d(s,"WebXRState",function(){return zn}),c.d(s,"WebXRTrackingState",function(){return Sa}),c.d(s,"WebXRSessionManager",function(){return Ep}),c.d(s,"WebXRDefaultExperienceOptions",function(){return vD}),c.d(s,"WebXRDefaultExperience",function(){return Qy}),c.d(s,"WebXRFeatureName",function(){return fi}),c.d(s,"WebXRFeaturesManager",function(){return ei}),c.d(s,"WebXRAbstractFeature",function(){return pi}),c.d(s,"WebXRHitTestLegacy",function(){return kh}),c.d(s,"WebXRAnchorSystem",function(){return jh}),c.d(s,"WebXRPlaneDetector",function(){return zh}),c.d(s,"WebXRBackgroundRemover",function(){return Gh}),c.d(s,"WebXRMotionControllerTeleportation",function(){return rl}),c.d(s,"WebXRControllerPointerSelection",function(){return nl}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return yN}),c.d(s,"WebXRControllerPhysics",function(){return Wh}),c.d(s,"WebXRHitTest",function(){return Hh}),c.d(s,"WebXRFeaturePointSystem",function(){return Xh}),c.d(s,"WebXRHand",function(){return UE}),c.d(s,"WebXRHandTracking",function(){return Yh}),c.d(s,"WebXRAbstractMotionController",function(){return ys}),c.d(s,"WebXRControllerComponent",function(){return bs}),c.d(s,"WebXRGenericTriggerMotionController",function(){return Xp}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return VE}),c.d(s,"WebXRMotionControllerManager",function(){return Ir}),c.d(s,"WebXROculusTouchMotionController",function(){return a_}),c.d(s,"WebXRHTCViveMotionController",function(){return kE}),c.d(s,"WebXRProfiledMotionController",function(){return Wy});var T=c(35),m=c(91),E=c(6),d=c(0),x=c(9),M=c(11),w=function(){function i(t,e){this.triggerOptions=t,this.onBeforeExecuteObservable=new E.c,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):t.trigger?this.trigger=t.trigger:this.trigger=t,this._nextActiveAction=this,this._condition=e}return i.prototype._prepare=function(){},i.prototype.getTriggerParameter=function(){return this._triggerParameter},i.prototype._executeCurrent=function(t){if(this._nextActiveAction._condition){var e=this._nextActiveAction._condition,n=this._actionManager.getScene().getRenderId();if(e._evaluationId===n){if(!e._currentResult)return}else{if(e._evaluationId=n,!e.isValid())return void(e._currentResult=!1);e._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(t),this.skipToNextActiveAction()},i.prototype.execute=function(t){},i.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},i.prototype.then=function(t){return this._child=t,t._actionManager=this._actionManager,t._prepare(),t},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(t){},i.prototype._serialize=function(t,e){var n={type:1,children:[],name:t.name,properties:t.properties||[]};if(this._child&&this._child.serialize(n),this._condition){var r=this._condition.serialize();return r.children.push(n),e&&e.children.push(r),r}return e&&e.children.push(n),n},i._SerializeValueAsString=function(t){return typeof t=="number"?t.toString():typeof t=="boolean"?t?"true":"false":t instanceof d.d?t.x+", "+t.y:t instanceof d.e?t.x+", "+t.y+", "+t.z:t instanceof x.a?t.r+", "+t.g+", "+t.b:t instanceof x.b?t.r+", "+t.g+", "+t.b+", "+t.a:t},i._GetTargetProperty=function(t){return{name:"target",targetType:t._isMesh?"MeshProperties":t._isLight?"LightProperties":t._isCamera?"CameraProperties":"SceneProperties",value:t._isScene?"Scene":t.name}},i}();M.a.RegisteredTypes["BABYLON.Action"]=w;var S=c(47),_=c(1),O=function(){function i(t){this._actionManager=t}return i.prototype.isValid=function(){return!0},i.prototype._getProperty=function(t){return this._actionManager._getProperty(t)},i.prototype._getEffectiveTarget=function(t,e){return this._actionManager._getEffectiveTarget(t,e)},i.prototype.serialize=function(){},i.prototype._serialize=function(t){return{type:2,children:[],name:t.name,properties:t.properties}},i}(),R=function(i){function t(e,n,r,o,l){l===void 0&&(l=t.IsEqual);var h=i.call(this,e)||this;return h.propertyPath=r,h.value=o,h.operator=l,h._target=n,h._effectiveTarget=h._getEffectiveTarget(n,h.propertyPath),h._property=h._getProperty(h.propertyPath),h}return Object(_.d)(t,i),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!1,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?e:!e}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[w._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:w._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(e){switch(e){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(O),I=function(i){function t(e,n){var r=i.call(this,e)||this;return r.predicate=n,r}return Object(_.d)(t,i),t.prototype.isValid=function(){return this.predicate()},t}(O),y=function(i){function t(e,n,r){var o=i.call(this,e)||this;return o.value=r,o._target=n,o}return Object(_.d)(t,i),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[w._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(O);M.a.RegisteredTypes["BABYLON.ValueCondition"]=R,M.a.RegisteredTypes["BABYLON.PredicateCondition"]=I,M.a.RegisteredTypes["BABYLON.StateCondition"]=y;var p=c(8),g=c(2),C=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l.propertyPath=r,l._target=l._effectiveTarget=n,l}return Object(_.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[w._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},e)},t}(w),P=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l.value=r,l._target=n,l}return Object(_.d)(t,i),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetStateAction",properties:[w._GetTargetProperty(this._target),{name:"value",value:this.value}]},e)},t}(w),F=function(i){function t(e,n,r,o,l){var h=i.call(this,e,l)||this;return h.propertyPath=r,h.value=o,h._target=h._effectiveTarget=n,h}return Object(_.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetValueAction",properties:[w._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:w._SerializeValueAsString(this.value)}]},e)},t}(w),U=function(i){function t(e,n,r,o,l){var h=i.call(this,e,l)||this;return h.propertyPath=r,h.value=o,h._target=h._effectiveTarget=n,h}return Object(_.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&p.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[w._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:w._SerializeValueAsString(this.value)}]},e)},t}(w),B=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,h)||this;return v.from=r,v.to=o,v.loop=l,v._target=n,v}return Object(_.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[w._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:w._SerializeValueAsString(this.loop)||!1}]},e)},t}(w),L=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._target=n,o}return Object(_.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[w._GetTargetProperty(this._target)]},e)},t}(w),z=function(i){function t(e,n){return e===void 0&&(e=g.a.ACTION_NothingTrigger),i.call(this,e,n)||this}return Object(_.d)(t,i),t.prototype.execute=function(){},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},t}(w),X=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.children=n,o}return Object(_.d)(t,i),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var n=0;n<this.children.length;n++)this.children[n].execute(e)},t.prototype.serialize=function(e){for(var n=i.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},e),r=0;r<this.children.length;r++)n.combine.push(this.children[r].serialize(null));return n},t}(w),G=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o.func=n,o}return Object(_.d)(t,i),t.prototype.execute=function(e){this.func(e)},t}(w),ee=function(i){function t(e,n,r,o){var l=i.call(this,e,o)||this;return l._target=n,l._parent=r,l}return Object(_.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=d.e.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"SetParentAction",properties:[w._GetTargetProperty(this._target),w._GetTargetProperty(this._parent)]},e)},t}(w);M.a.RegisteredTypes["BABYLON.SetParentAction"]=ee,M.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=G,M.a.RegisteredTypes["BABYLON.DoNothingAction"]=z,M.a.RegisteredTypes["BABYLON.StopAnimationAction"]=L,M.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=B,M.a.RegisteredTypes["BABYLON.IncrementValueAction"]=U,M.a.RegisteredTypes["BABYLON.SetValueAction"]=F,M.a.RegisteredTypes["BABYLON.SetStateAction"]=P,M.a.RegisteredTypes["BABYLON.SetParentAction"]=ee;var $=c(22),fe=c(41),me=function(i){function t(e){var n=i.call(this)||this;return n._scene=e||$.a.LastCreatedScene,e.actionManagers.push(n),n}return Object(_.d)(t,i),t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),n=0;n<this.actions.length;n++){var r=this.actions[n];t.Triggers[r.trigger]--,t.Triggers[r.trigger]===0&&delete t.Triggers[r.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(e.indexOf(r.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(e==o.trigger||n==o.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e&&(!n||n(o.getTriggerParameter())))return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.registerAction=function(e){return e.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(p.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),t.Triggers[e.trigger]?t.Triggers[e.trigger]++:t.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)},t.prototype.unregisterAction=function(e){var n=this.actions.indexOf(e);return n!==-1&&(this.actions.splice(n,1),t.Triggers[e.trigger]-=1,t.Triggers[e.trigger]===0&&delete t.Triggers[e.trigger],e._actionManager=null,!0)},t.prototype.processTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var o=this.actions[r];if(o.trigger===e){if(n&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var l=o.getTriggerParameter();if(l&&l!==n.sourceEvent.keyCode){if(!l.toLowerCase)continue;var h=l.toLowerCase();if(h!==n.sourceEvent.key){var v=n.sourceEvent.charCode?n.sourceEvent.charCode:n.sourceEvent.keyCode;if(String.fromCharCode(v).toLowerCase()!==h)continue}}}o._executeCurrent(n)}}},t.prototype._getEffectiveTarget=function(e,n){for(var r=n.split("."),o=0;o<r.length-1;o++)e=e[r[o]];return e},t.prototype._getProperty=function(e){var n=e.split(".");return n[n.length-1]},t.prototype.serialize=function(e){for(var n={children:new Array,name:e,type:3,properties:new Array},r=0;r<this.actions.length;r++){var o={type:0,children:new Array,name:t.GetTriggerName(this.actions[r].trigger),properties:new Array},l=this.actions[r].triggerOptions;if(l&&typeof l!="number")if(l.parameter instanceof Node)o.properties.push(w._GetTargetProperty(l.parameter));else{var h={};fe.a.DeepCopy(l.parameter,h,["mesh"]),l.parameter&&l.parameter.mesh&&(h._meshId=l.parameter.mesh.id),o.properties.push({name:"parameter",targetType:null,value:h})}this.actions[r].serialize(o),n.children.push(o)}return n},t.Parse=function(e,n,r){var o=new t(r);n===null?r.actionManager=o:n.actionManager=o;for(var l=function(k,H,J,te){if(te===null){var oe=parseFloat(H);return H==="true"||H==="false"?H==="true":isNaN(oe)?H:oe}for(var ce=te.split("."),he=H.split(","),_e=0;_e<ce.length;_e++)J=J[ce[_e]];if(typeof J=="boolean")return he[0]==="true";if(typeof J=="string")return he[0];var ye=new Array;for(_e=0;_e<he.length;_e++)ye.push(parseFloat(he[_e]));return J instanceof d.e?d.e.FromArray(ye):J instanceof d.f?d.f.FromArray(ye):J instanceof x.a?x.a.FromArray(ye):J instanceof x.b?x.b.FromArray(ye):parseFloat(he[0])},h=function(k,H,J,te,oe){if(oe===void 0&&(oe=null),!k.detached){var ce=new Array,he=null,_e=null,ye=k.combine&&k.combine.length>0;if(k.type===2?ce.push(o):ce.push(H),ye){for(var Ee=new Array,Oe=0;Oe<k.combine.length;Oe++)h(k.combine[Oe],t.NothingTrigger,J,te,Ee);ce.push(Ee)}else for(var Ae=0;Ae<k.properties.length;Ae++){var xe=k.properties[Ae].value,Pe=k.properties[Ae].name,Be=k.properties[Ae].targetType;Pe==="target"?xe=he=Be!==null&&Be==="SceneProperties"?r:r.getNodeByName(xe):Pe==="parent"?xe=r.getNodeByName(xe):Pe==="sound"?r.getSoundByName&&(xe=r.getSoundByName(xe)):Pe!=="propertyPath"?xe=k.type===2&&Pe==="operator"?R[xe]:l(0,xe,he,Pe==="value"?_e:null):_e=xe,ce.push(xe)}if(oe===null?ce.push(J):ce.push(null),k.name==="InterpolateValueAction"){var Ce=ce[ce.length-2];ce[ce.length-1]=Ce,ce[ce.length-2]=J}var Ue=function(ke,qe){var at=M.a.GetClass("BABYLON."+ke);if(at){var lt=Object.create(at.prototype);return lt.constructor.apply(lt,qe),lt}}(k.name,ce);if(Ue instanceof O&&J!==null){var Le=new z(H,J);te?te.then(Le):o.registerAction(Le),te=Le}for(oe===null?Ue instanceof O?(J=Ue,Ue=te):(J=null,te?te.then(Ue):o.registerAction(Ue)):oe.push(Ue),Ae=0;Ae<k.children.length;Ae++)h(k.children[Ae],H,J,Ue,null)}},v=0;v<e.children.length;v++){var b,A=e.children[v];if(A.properties.length>0){var D=A.properties[0].value,N=A.properties[0].targetType===null?D:r.getMeshByName(D);N._meshId&&(N.mesh=r.getMeshByID(N._meshId)),b={trigger:t[A.name],parameter:N}}else b=t[A.name];for(var j=0;j<A.children.length;j++)A.detached||h(A.children[j],b,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=g.a.ACTION_NothingTrigger,t.OnPickTrigger=g.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=g.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=g.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=g.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=g.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=g.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=g.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=g.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=g.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=g.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=g.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=g.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=g.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=g.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=g.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(m.a),ve=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(_.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.play()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(w),be=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._sound=n,o}return Object(_.d)(t,i),t.prototype._prepare=function(){},t.prototype.execute=function(){this._sound!==void 0&&this._sound.stop()},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},e)},t}(w);M.a.RegisteredTypes["BABYLON.PlaySoundAction"]=be,M.a.RegisteredTypes["BABYLON.StopSoundAction"]=be;var ie,se=c(14),V=c(3);(function(i){i[i.STEP=1]="STEP"})(ie||(ie={}));var K=function(){function i(t,e,n){this.name=t,this.from=e,this.to=n}return i.prototype.clone=function(){return new i(this.name,this.from,this.to)},i}(),Z=c(29),le=c(77),re=c(49),Q=function(){},W=function(){function i(t,e,n,r,o,l){this.name=t,this.targetProperty=e,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this.enableBlending=l,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=r,this.loopMode=o===void 0?i.ANIMATIONLOOPMODE_CYCLE:o}return i._PrepareAnimation=function(t,e,n,r,o,l,h,v){var b=void 0;if(!isNaN(parseFloat(o))&&isFinite(o)?b=i.ANIMATIONTYPE_FLOAT:o instanceof d.b?b=i.ANIMATIONTYPE_QUATERNION:o instanceof d.e?b=i.ANIMATIONTYPE_VECTOR3:o instanceof d.d?b=i.ANIMATIONTYPE_VECTOR2:o instanceof x.a?b=i.ANIMATIONTYPE_COLOR3:o instanceof x.b?b=i.ANIMATIONTYPE_COLOR4:o instanceof le.a&&(b=i.ANIMATIONTYPE_SIZE),b==null)return null;var A=new i(t,e,n,b,h),D=[{frame:0,value:o},{frame:r,value:l}];return A.setKeys(D),v!==void 0&&A.setEasingFunction(v),A},i.CreateAnimation=function(t,e,n,r){var o=new i(t+"Animation",t,n,e,i.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(r),o},i.CreateAndStartAnimation=function(t,e,n,r,o,l,h,v,b,A){var D=i._PrepareAnimation(t,n,r,o,l,h,v,b);return D?e.getScene().beginDirectAnimation(e,[D],0,o,D.loopMode===1,1,A):null},i.CreateAndStartHierarchyAnimation=function(t,e,n,r,o,l,h,v,b,A,D){var N=i._PrepareAnimation(t,r,o,l,h,v,b,A);return N?e.getScene().beginDirectHierarchyAnimation(e,n,[N],0,l,N.loopMode===1,1,D):null},i.CreateMergeAndStartAnimation=function(t,e,n,r,o,l,h,v,b,A){var D=i._PrepareAnimation(t,n,r,o,l,h,v,b);return D?(e.animations.push(D),e.getScene().beginAnimation(e,0,o,D.loopMode===1,1,A)):null},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var l=t;if(r&&((l=t.clone()).name=o||l.name),!l._keys.length)return l;e=e>=0?e:0;var h=0,v=l._keys[0],b=l._keys.length-1,A=l._keys[b],D={referenceValue:v.value,referencePosition:d.c.Vector3[0],referenceQuaternion:d.c.Quaternion[0],referenceScaling:d.c.Vector3[1],keyPosition:d.c.Vector3[2],keyQuaternion:d.c.Quaternion[1],keyScaling:d.c.Vector3[3]},N=!1,j=v.frame,k=A.frame;if(n){var H=l.getRange(n);H&&(j=H.from,k=H.to)}var J=v.frame===j,te=A.frame===k;if(l._keys.length===1){var oe=l._getKeyValue(l._keys[0]);D.referenceValue=oe.clone?oe.clone():oe,N=!0}else e<=v.frame?(oe=l._getKeyValue(v.value),D.referenceValue=oe.clone?oe.clone():oe,N=!0):e>=A.frame&&(oe=l._getKeyValue(A.value),D.referenceValue=oe.clone?oe.clone():oe,N=!0);for(var ce=0;!N||!J||!te&&ce<l._keys.length-1;){var he=l._keys[ce],_e=l._keys[ce+1];if(!N&&e>=he.frame&&e<=_e.frame){if(oe=void 0,e===he.frame)oe=l._getKeyValue(he.value);else if(e===_e.frame)oe=l._getKeyValue(_e.value);else{var ye={key:ce,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};oe=l._interpolate(e,ye)}D.referenceValue=oe.clone?oe.clone():oe,N=!0}if(!J&&j>=he.frame&&j<=_e.frame){if(j===he.frame)h=ce;else if(j===_e.frame)h=ce+1;else{ye={key:ce,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var Ee={frame:j,value:(oe=l._interpolate(j,ye)).clone?oe.clone():oe};l._keys.splice(ce+1,0,Ee),h=ce+1}J=!0}!te&&k>=he.frame&&k<=_e.frame&&(k===he.frame?b=ce:k===_e.frame?b=ce+1:(ye={key:ce,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},Ee={frame:k,value:(oe=l._interpolate(k,ye)).clone?oe.clone():oe},l._keys.splice(ce+1,0,Ee),b=ce+1),te=!0),ce++}for(l.dataType===i.ANIMATIONTYPE_QUATERNION?D.referenceValue.normalize().conjugateInPlace():l.dataType===i.ANIMATIONTYPE_MATRIX&&(D.referenceValue.decompose(D.referenceScaling,D.referenceQuaternion,D.referencePosition),D.referenceQuaternion.normalize().conjugateInPlace()),ce=h;ce<=b;ce++)if(Ee=l._keys[ce],!ce||l.dataType===i.ANIMATIONTYPE_FLOAT||Ee.value!==v.value)switch(l.dataType){case i.ANIMATIONTYPE_MATRIX:Ee.value.decompose(D.keyScaling,D.keyQuaternion,D.keyPosition),D.keyPosition.subtractInPlace(D.referencePosition),D.keyScaling.divideInPlace(D.referenceScaling),D.referenceQuaternion.multiplyToRef(D.keyQuaternion,D.keyQuaternion),d.a.ComposeToRef(D.keyScaling,D.keyQuaternion,D.keyPosition,Ee.value);break;case i.ANIMATIONTYPE_QUATERNION:D.referenceValue.multiplyToRef(Ee.value,Ee.value);break;case i.ANIMATIONTYPE_VECTOR2:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:Ee.value.subtractToRef(D.referenceValue,Ee.value);break;case i.ANIMATIONTYPE_SIZE:Ee.value.width-=D.referenceValue.width,Ee.value.height-=D.referenceValue.height;break;default:Ee.value-=D.referenceValue}return l},i.TransitionTo=function(t,e,n,r,o,l,h,v){if(v===void 0&&(v=null),h<=0)return n[t]=e,v&&v(),null;var b=o*(h/1e3);l.setKeys([{frame:0,value:n[t].clone?n[t].clone():n[t]},{frame:b,value:e}]),n.animations||(n.animations=[]),n.animations.push(l);var A=r.beginAnimation(n,0,b,!1);return A.onAnimationEnd=v,A},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var t=0,e=this._runtimeAnimations;t<e.length;t++)if(!e[t].isStopped)return!0;return!1},enumerable:!1,configurable:!0}),i.prototype.toString=function(t){var e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.addEvent=function(t){this._events.push(t),this._events.sort(function(e,n){return e.frame-n.frame})},i.prototype.removeEvents=function(t){for(var e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(t,e,n){this._ranges[t]||(this._ranges[t]=new K(t,e,n))},i.prototype.deleteRange=function(t,e){e===void 0&&(e=!0);var n=this._ranges[t];if(n){if(e)for(var r=n.from,o=n.to,l=this._keys.length-1;l>=0;l--)this._keys[l].frame>=r&&this._keys[l].frame<=o&&this._keys.splice(l,1);this._ranges[t]=null}},i.prototype.getRange=function(t){return this._ranges[t]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var t=0,e=0,n=this._keys.length;e<n;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(t){this._easingFunction=t},i.prototype.floatInterpolateFunction=function(t,e,n){return se.a.Lerp(t,e,n)},i.prototype.floatInterpolateFunctionWithTangents=function(t,e,n,r,o){return se.a.Hermite(t,e,n,r,o)},i.prototype.quaternionInterpolateFunction=function(t,e,n){return d.b.Slerp(t,e,n)},i.prototype.quaternionInterpolateFunctionWithTangents=function(t,e,n,r,o){return d.b.Hermite(t,e,n,r,o).normalize()},i.prototype.vector3InterpolateFunction=function(t,e,n){return d.e.Lerp(t,e,n)},i.prototype.vector3InterpolateFunctionWithTangents=function(t,e,n,r,o){return d.e.Hermite(t,e,n,r,o)},i.prototype.vector2InterpolateFunction=function(t,e,n){return d.d.Lerp(t,e,n)},i.prototype.vector2InterpolateFunctionWithTangents=function(t,e,n,r,o){return d.d.Hermite(t,e,n,r,o)},i.prototype.sizeInterpolateFunction=function(t,e,n){return le.a.Lerp(t,e,n)},i.prototype.color3InterpolateFunction=function(t,e,n){return x.a.Lerp(t,e,n)},i.prototype.color4InterpolateFunction=function(t,e,n){return x.b.Lerp(t,e,n)},i.prototype._getKeyValue=function(t){return typeof t=="function"?t():t},i.prototype._interpolate=function(t,e){if(e.loopMode===i.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;var n=this._keys;if(n.length===1)return this._getKeyValue(n[0].value);var r=e.key;if(n[r].frame>=t)for(;r-1>=0&&n[r].frame>=t;)r--;for(var o=r;o<n.length;o++){var l=n[o+1];if(l.frame>=t){e.key=o;var h=n[o],v=this._getKeyValue(h.value);if(h.interpolation===ie.STEP)return v;var b=this._getKeyValue(l.value),A=h.outTangent!==void 0&&l.inTangent!==void 0,D=l.frame-h.frame,N=(t-h.frame)/D,j=this.getEasingFunction();switch(j!=null&&(N=j.ease(N)),this.dataType){case i.ANIMATIONTYPE_FLOAT:var k=A?this.floatInterpolateFunctionWithTangents(v,h.outTangent*D,b,l.inTangent*D,N):this.floatInterpolateFunction(v,b,N);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return k;case i.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+k}break;case i.ANIMATIONTYPE_QUATERNION:var H=A?this.quaternionInterpolateFunctionWithTangents(v,h.outTangent.scale(D),b,l.inTangent.scale(D),N):this.quaternionInterpolateFunction(v,b,N);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return H;case i.ANIMATIONLOOPMODE_RELATIVE:return H.addInPlace(e.offsetValue.scale(e.repeatCount))}return H;case i.ANIMATIONTYPE_VECTOR3:var J=A?this.vector3InterpolateFunctionWithTangents(v,h.outTangent.scale(D),b,l.inTangent.scale(D),N):this.vector3InterpolateFunction(v,b,N);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return J;case i.ANIMATIONLOOPMODE_RELATIVE:return J.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_VECTOR2:var te=A?this.vector2InterpolateFunctionWithTangents(v,h.outTangent.scale(D),b,l.inTangent.scale(D),N):this.vector2InterpolateFunction(v,b,N);switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return te;case i.ANIMATIONLOOPMODE_RELATIVE:return te.add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_SIZE:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(v,b,N);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(v,b,N).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR3:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(v,b,N);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(v,b,N).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_COLOR4:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(v,b,N);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(v,b,N).add(e.offsetValue.scale(e.repeatCount))}case i.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:if(i.AllowMatricesInterpolation)return this.matrixInterpolateFunction(v,b,N,e.workValue);case i.ANIMATIONLOOPMODE_RELATIVE:return v}}break}}return this._getKeyValue(n[n.length-1].value)},i.prototype.matrixInterpolateFunction=function(t,e,n,r){return i.AllowMatrixDecomposeForInterpolation?r?(d.a.DecomposeLerpToRef(t,e,n,r),r):d.a.DecomposeLerp(t,e,n):r?(d.a.LerpToRef(t,e,n,r),r):d.a.Lerp(t,e,n)},i.prototype.clone=function(){var t=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var e in t._ranges={},this._ranges){var n=this._ranges[e];n&&(t._ranges[e]=n.clone())}return t},i.prototype.setKeys=function(t){this._keys=t.slice(0)},i.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var e=this.dataType;t.keys=[];for(var n=this.getKeys(),r=0;r<n.length;r++){var o=n[r],l={};switch(l.frame=o.frame,e){case i.ANIMATIONTYPE_FLOAT:l.values=[o.value],o.inTangent!==void 0&&l.values.push(o.inTangent),o.outTangent!==void 0&&(o.inTangent===void 0&&l.values.push(void 0),l.values.push(o.outTangent));break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:l.values=o.value.asArray(),o.inTangent!=null&&l.values.push(o.inTangent.asArray()),o.outTangent!=null&&(o.inTangent===void 0&&l.values.push(void 0),l.values.push(o.outTangent.asArray()))}t.keys.push(l)}for(var h in t.ranges=[],this._ranges){var v=this._ranges[h];if(v){var b={};b.name=h,b.from=v.from,b.to=v.to,t.ranges.push(b)}}return t},i._UniversalLerp=function(t,e,n){var r=t.constructor;return r.Lerp?r.Lerp(t,e,n):r.Slerp?r.Slerp(t,e,n):t.toFixed?t*(1-n)+n*e:e},i.Parse=function(t){var e,n,r=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),o=t.dataType,l=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),n=0;n<t.keys.length;n++){var h,v,b=t.keys[n];switch(o){case i.ANIMATIONTYPE_FLOAT:e=b.values[0],b.values.length>=1&&(h=b.values[1]),b.values.length>=2&&(v=b.values[2]);break;case i.ANIMATIONTYPE_QUATERNION:if(e=d.b.FromArray(b.values),b.values.length>=8){var A=d.b.FromArray(b.values.slice(4,8));A.equals(d.b.Zero())||(h=A)}if(b.values.length>=12){var D=d.b.FromArray(b.values.slice(8,12));D.equals(d.b.Zero())||(v=D)}break;case i.ANIMATIONTYPE_MATRIX:e=d.a.FromArray(b.values);break;case i.ANIMATIONTYPE_COLOR3:e=x.a.FromArray(b.values);break;case i.ANIMATIONTYPE_COLOR4:e=x.b.FromArray(b.values);break;case i.ANIMATIONTYPE_VECTOR3:default:e=d.e.FromArray(b.values)}var N={};N.frame=b.frame,N.value=e,h!=null&&(N.inTangent=h),v!=null&&(N.outTangent=v),l.push(N)}if(r.setKeys(l),t.ranges)for(n=0;n<t.ranges.length;n++)e=t.ranges[n],r.createRange(e.name,e.from,e.to);return r},i.AppendSerializedAnimations=function(t,e){V.a.AppendSerializedAnimations(t,e)},i.ParseFromFileAsync=function(t,e){var n=this;return new Promise(function(r,o){var l=new re.a;l.addEventListener("readystatechange",function(){if(l.readyState==4)if(l.status==200){var h=JSON.parse(l.responseText);if(h.length){for(var v=new Array,b=0,A=h;b<A.length;b++){var D=A[b];v.push(n.Parse(D))}r(v)}else v=n.Parse(h),t&&(v.name=t),r(v)}else o("Unable to load the animation")}),l.open("GET",e),l.send()})},i.CreateFromSnippetAsync=function(t){var e=this;return new Promise(function(n,r){var o=new re.a;o.addEventListener("readystatechange",function(){if(o.readyState==4)if(o.status==200){var l=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(l.animations){for(var h=JSON.parse(l.animations),v=new Array,b=0,A=h;b<A.length;b++){var D=A[b];v.push(e.Parse(D))}n(v)}else h=JSON.parse(l.animation),(v=e.Parse(h)).snippetId=t,n(v)}else r("Unable to load the snippet "+t)}),o.open("GET",e.SnippetUrl+"/"+t.replace(/#/g,"/")),o.send()})},i.AllowMatricesInterpolation=!1,i.AllowMatrixDecomposeForInterpolation=!0,i.SnippetUrl="https://snippet.babylonjs.com",i.ANIMATIONTYPE_FLOAT=0,i.ANIMATIONTYPE_VECTOR3=1,i.ANIMATIONTYPE_QUATERNION=2,i.ANIMATIONTYPE_MATRIX=3,i.ANIMATIONTYPE_COLOR3=4,i.ANIMATIONTYPE_COLOR4=7,i.ANIMATIONTYPE_VECTOR2=5,i.ANIMATIONTYPE_SIZE=6,i.ANIMATIONLOOPMODE_RELATIVE=0,i.ANIMATIONLOOPMODE_CYCLE=1,i.ANIMATIONLOOPMODE_CONSTANT=2,i}();M.a.RegisteredTypes["BABYLON.Animation"]=W,Z.a._AnimationRangeFactory=function(i,t,e){return new K(i,t,e)};var Y=function(i){function t(e,n,r,o,l,h,v,b){l===void 0&&(l=1e3);var A=i.call(this,e,h)||this;return A.duration=1e3,A.onInterpolationDoneObservable=new E.c,A.propertyPath=r,A.value=o,A.duration=l,A.stopOtherAnimations=v,A.onInterpolationDone=b,A._target=A._effectiveTarget=n,A}return Object(_.d)(t,i),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var e,n=this,r=this._actionManager.getScene(),o=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if(typeof this.value=="number")e=W.ANIMATIONTYPE_FLOAT;else if(this.value instanceof x.a)e=W.ANIMATIONTYPE_COLOR3;else if(this.value instanceof d.e)e=W.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof d.a)e=W.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof d.b))return void p.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");e=W.ANIMATIONTYPE_QUATERNION}var l=new W("InterpolateValueAction",this._property,1e3/this.duration*100,e,W.ANIMATIONLOOPMODE_CONSTANT);l.setKeys(o),this.stopOtherAnimations&&r.stopAnimation(this._effectiveTarget),r.beginDirectAnimation(this._effectiveTarget,[l],0,100,!1,1,function(){n.onInterpolationDoneObservable.notifyObservers(n),n.onInterpolationDone&&n.onInterpolationDone()})},t.prototype.serialize=function(e){return i.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[w._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:w._SerializeValueAsString(this.value)},{name:"duration",value:w._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:w._SerializeValueAsString(this.stopOtherAnimations)||!1}]},e)},t}(w);M.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=Y;var q=Object.freeze(new d.b(0,0,0,0)),ae=Object.freeze(d.e.Zero()),pe=Object.freeze(d.d.Zero()),De=Object.freeze(le.a.Zero()),de=Object.freeze(x.a.Black()),ge=function(){function i(t,e,n,r){var o=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=e,this._target=t,this._scene=n,this._host=r,this._activeTargets=[],e._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===W.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=d.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var l={frame:0,value:this._minValue};this._keys.splice(0,0,l)}if(this._target instanceof Array){for(var h=0,v=0,b=this._target;v<b.length;v++){var A=b[v];this._preparePath(A,h),this._getOriginalValues(h),h++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var D=e.getEvents();D&&D.length>0&&D.forEach(function(N){o._events.push(N._clone())}),this._enableBlending=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),i.prototype._preparePath=function(t,e){e===void 0&&(e=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var r=t[n[0]],o=1;o<n.length-1;o++)r=r[n[o]];this._targetPath=n[n.length-1],this._activeTargets[e]=r}else this._targetPath=n[0],this._activeTargets[e]=t},Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),i.prototype.reset=function(t){if(t===void 0&&(t=!1),t)if(this._target instanceof Array)for(var e=0,n=0,r=this._target;n<r.length;n++){var o=r[n];this._originalValue[e]!==void 0&&this._setValue(o,this._activeTargets[e],this._originalValue[e],-1,e),e++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,e=0;e<this._events.length;e++)this._events[e].isDone=!1},i.prototype.isStopped=function(){return this._stopped},i.prototype.dispose=function(){var t=this._animation.runtimeAnimations.indexOf(this);t>-1&&this._animation.runtimeAnimations.splice(t,1)},i.prototype.setValue=function(t,e){if(this._targetIsArray)for(var n=0;n<this._target.length;n++){var r=this._target[n];this._setValue(r,this._activeTargets[n],t,e,n)}else this._setValue(this._target,this._directTarget,t,e,0)},i.prototype._getOriginalValues=function(t){var e;t===void 0&&(t=0);var n=this._activeTargets[t];(e=n.getRestPose&&this._targetPath==="_matrix"?n.getRestPose():n[this._targetPath])&&e.clone?this._originalValue[t]=e.clone():this._originalValue[t]=e},i.prototype._setValue=function(t,e,n,r,o){if(this._currentActiveTarget=e,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var l=e[this._targetPath];l.clone?this._originalBlendValue=l.clone():this._originalBlendValue=l}this._originalBlendValue.m?W.AllowMatrixDecomposeForInterpolation?this._currentValue?d.a.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=d.a.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?d.a.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=d.a.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=W._UniversalLerp(this._originalBlendValue,n,this._blendingFactor);var h=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=h}else this._currentValue=n;r!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[o]):e[this._targetPath]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)},i.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},i.prototype.goToFrame=function(t){var e=this._animation.getKeys();t<e[0].frame?t=e[0].frame:t>e[e.length-1].frame&&(t=e[e.length-1].frame);var n=this._events;if(n.length)for(var r=0;r<n.length;r++)n[r].onlyOnce||(n[r].isDone=n[r].frame<t);this._currentFrame=t;var o=this._animation._interpolate(t,this._animationState);this.setValue(o,-1)},i.prototype._prepareForSpeedRatioChange=function(t){var e=this._previousDelay*(this._animation.framePerSecond*t)/1e3;this._ratioOffset=this._previousRatio-e},i.prototype.animate=function(t,e,n,r,o,l){l===void 0&&(l=-1);var h=this._animation,v=h.targetPropertyPath;if(!v||v.length<1)return this._stopped=!0,!1;var b=!0;(e<this._minFrame||e>this._maxFrame)&&(e=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var A,D,N=n-e,j=t*(h.framePerSecond*o)/1e3+this._ratioOffset,k=0;if(this._previousDelay=t,this._previousRatio=j,!r&&n>=e&&j>=N)b=!1,k=h._getKeyValue(this._maxValue);else if(!r&&e>=n&&j<=N)b=!1,k=h._getKeyValue(this._minValue);else if(this._animationState.loopMode!==W.ANIMATIONLOOPMODE_CYCLE){var H=n.toString()+e.toString();if(!this._offsetsCache[H]){this._animationState.repeatCount=0,this._animationState.loopMode=W.ANIMATIONLOOPMODE_CYCLE;var J=h._interpolate(e,this._animationState),te=h._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),h.dataType){case W.ANIMATIONTYPE_FLOAT:this._offsetsCache[H]=te-J;break;case W.ANIMATIONTYPE_QUATERNION:this._offsetsCache[H]=te.subtract(J);break;case W.ANIMATIONTYPE_VECTOR3:this._offsetsCache[H]=te.subtract(J);case W.ANIMATIONTYPE_VECTOR2:this._offsetsCache[H]=te.subtract(J);case W.ANIMATIONTYPE_SIZE:this._offsetsCache[H]=te.subtract(J);case W.ANIMATIONTYPE_COLOR3:this._offsetsCache[H]=te.subtract(J)}this._highLimitsCache[H]=te}k=this._highLimitsCache[H],A=this._offsetsCache[H]}if(A===void 0)switch(h.dataType){case W.ANIMATIONTYPE_FLOAT:A=0;break;case W.ANIMATIONTYPE_QUATERNION:A=q;break;case W.ANIMATIONTYPE_VECTOR3:A=ae;break;case W.ANIMATIONTYPE_VECTOR2:A=pe;break;case W.ANIMATIONTYPE_SIZE:A=De;break;case W.ANIMATIONTYPE_COLOR3:A=de}if(this._host&&this._host.syncRoot){var oe=this._host.syncRoot;D=e+(n-e)*((oe.masterFrame-oe.fromFrame)/(oe.toFrame-oe.fromFrame))}else D=b&&N!==0?e+j%N:n;var ce=this._events;if((N>0&&this.currentFrame>D||N<0&&this.currentFrame<D)&&(this._onLoop(),ce.length))for(var he=0;he<ce.length;he++)ce[he].onlyOnce||(ce[he].isDone=!1);this._currentFrame=D,this._animationState.repeatCount=N===0?0:j/N>>0,this._animationState.highLimitValue=k,this._animationState.offsetValue=A;var _e=h._interpolate(D,this._animationState);if(this.setValue(_e,l),ce.length){for(he=0;he<ce.length;he++)if(N>0&&D>=ce[he].frame&&ce[he].frame>=e||N<0&&D<=ce[he].frame&&ce[he].frame<=e){var ye=ce[he];ye.isDone||(ye.onlyOnce&&(ce.splice(he,1),he--),ye.isDone=!0,ye.action(D))}}return b||(this._stopped=!0),b},i}(),ne=c(20),Te=c(57),we=c(44),Se=c(23),Ge=function(i){function t(e,n,r,o,l,h,v){r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),v===void 0&&(v=null);var b=i.call(this,e,n.getScene())||this;return b.name=e,b.children=new Array,b.animations=new Array,b._index=null,b._absoluteTransform=new d.a,b._invertedAbsoluteTransform=new d.a,b._scalingDeterminant=1,b._worldTransform=new d.a,b._needToDecompose=!0,b._needToCompose=!1,b._linkedTransformNode=null,b._waitingTransformNodeId=null,b._skeleton=n,b._localMatrix=o?o.clone():d.a.Identity(),b._restPose=l||b._localMatrix.clone(),b._bindPose=b._localMatrix.clone(),b._baseMatrix=h||b._localMatrix.clone(),b._index=v,n.bones.push(b),b.setParent(r,!1),(h||o)&&b._updateDifferenceMatrix(),b}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},t.prototype.setParent=function(e,n){if(n===void 0&&(n=!0),this._parent!==e){if(this._parent){var r=this._parent.children.indexOf(this);r!==-1&&this._parent.children.splice(r,1)}this._parent=e,this._parent&&this._parent.children.push(this),n&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.setRestPose=function(e){this._restPose.copyFrom(e)},t.prototype.getBindPose=function(){return this._bindPose},t.prototype.setBindPose=function(e){this._bindPose.copyFrom(e)},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},t.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=d.e.Zero(),this._localRotation=d.b.Zero(),this._localPosition=d.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,d.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},t.prototype.updateMatrix=function(e,n,r){n===void 0&&(n=!0),r===void 0&&(r=!0),this._baseMatrix.copyFrom(e),n&&this._updateDifferenceMatrix(),r?(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(e,n){if(n===void 0&&(n=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),n)for(var r=0;r<this.children.length;r++)this.children[r]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix();if(n==Se.c.LOCAL)o.addAtIndex(12,e.x),o.addAtIndex(13,e.y),o.addAtIndex(14,e.z);else{var l=null;r&&(l=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=t._tmpMats[0],v=t._tmpVecs[0];this._parent?r&&l?(h.copyFrom(this._parent.getAbsoluteTransform()),h.multiplyToRef(l,h)):h.copyFrom(this._parent.getAbsoluteTransform()):d.a.IdentityToRef(h),h.setTranslationFromFloats(0,0,0),h.invert(),d.e.TransformCoordinatesToRef(e,h,v),o.addAtIndex(12,v.x),o.addAtIndex(13,v.y),o.addAtIndex(14,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix();if(n==Se.c.LOCAL)o.setTranslationFromFloats(e.x,e.y,e.z);else{var l=null;r&&(l=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=t._tmpMats[0],v=t._tmpVecs[0];this._parent?(r&&l?(h.copyFrom(this._parent.getAbsoluteTransform()),h.multiplyToRef(l,h)):h.copyFrom(this._parent.getAbsoluteTransform()),h.invert()):d.a.IdentityToRef(h),d.e.TransformCoordinatesToRef(e,h,v),o.setTranslationFromFloats(v.x,v.y,v.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(e,n){this.setPosition(e,Se.c.WORLD,n)},t.prototype.scale=function(e,n,r,o){o===void 0&&(o=!1);var l=this.getLocalMatrix(),h=t._tmpMats[0];d.a.ScalingToRef(e,n,r,h),h.multiplyToRef(l,l),h.invert();for(var v=0,b=this.children;v<b.length;v++){var A=(j=b[v]).getLocalMatrix();A.multiplyToRef(h,A),A.multiplyAtIndex(12,e),A.multiplyAtIndex(13,n),A.multiplyAtIndex(14,r),j._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(var D=0,N=this.children;D<N.length;D++){var j;(j=N[D]).scale(e,n,r,o)}},t.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(e,n,r,o,l){if(o===void 0&&(o=Se.c.LOCAL),o===Se.c.LOCAL){var h=t._tmpQuat;return d.b.RotationYawPitchRollToRef(e,n,r,h),void this.setRotationQuaternion(h,o,l)}var v=t._tmpMats[0];if(this._getNegativeRotationToRef(v,l)){var b=t._tmpMats[1];d.a.RotationYawPitchRollToRef(e,n,r,b),v.multiplyToRef(b,b),this._rotateWithMatrix(b,o,l)}},t.prototype.rotate=function(e,n,r,o){r===void 0&&(r=Se.c.LOCAL);var l=t._tmpMats[0];l.setTranslationFromFloats(0,0,0),d.a.RotationAxisToRef(e,n,l),this._rotateWithMatrix(l,r,o)},t.prototype.setAxisAngle=function(e,n,r,o){if(r===void 0&&(r=Se.c.LOCAL),r===Se.c.LOCAL){var l=t._tmpQuat;return d.b.RotationAxisToRef(e,n,l),void this.setRotationQuaternion(l,r,o)}var h=t._tmpMats[0];if(this._getNegativeRotationToRef(h,o)){var v=t._tmpMats[1];d.a.RotationAxisToRef(e,n,v),h.multiplyToRef(v,v),this._rotateWithMatrix(v,r,o)}},t.prototype.setRotation=function(e,n,r){n===void 0&&(n=Se.c.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,n,r)},t.prototype.setRotationQuaternion=function(e,n,r){if(n===void 0&&(n=Se.c.LOCAL),n===Se.c.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var o=t._tmpMats[0];if(this._getNegativeRotationToRef(o,r)){var l=t._tmpMats[1];d.a.FromQuaternionToRef(e,l),o.multiplyToRef(l,l),this._rotateWithMatrix(l,n,r)}},t.prototype.setRotationMatrix=function(e,n,r){if(n===void 0&&(n=Se.c.LOCAL),n===Se.c.LOCAL){var o=t._tmpQuat;return d.b.FromRotationMatrixToRef(e,o),void this.setRotationQuaternion(o,n,r)}var l=t._tmpMats[0];if(this._getNegativeRotationToRef(l,r)){var h=t._tmpMats[1];h.copyFrom(e),l.multiplyToRef(e,h),this._rotateWithMatrix(h,n,r)}},t.prototype._rotateWithMatrix=function(e,n,r){n===void 0&&(n=Se.c.LOCAL);var o=this.getLocalMatrix(),l=o.m[12],h=o.m[13],v=o.m[14],b=this.getParent(),A=t._tmpMats[3],D=t._tmpMats[4];b&&n==Se.c.WORLD?(r?(A.copyFrom(r.getWorldMatrix()),b.getAbsoluteTransform().multiplyToRef(A,A)):A.copyFrom(b.getAbsoluteTransform()),D.copyFrom(A),D.invert(),o.multiplyToRef(A,o),o.multiplyToRef(e,o),o.multiplyToRef(D,o)):n==Se.c.WORLD&&r?(A.copyFrom(r.getWorldMatrix()),D.copyFrom(A),D.invert(),o.multiplyToRef(A,o),o.multiplyToRef(e,o),o.multiplyToRef(D,o)):o.multiplyToRef(e,o),o.setTranslationFromFloats(l,h,v),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(e,n){var r=t._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),n&&(e.multiplyToRef(n.getWorldMatrix(),e),d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,r)),e.invert(),!isNaN(e.m[0])&&(r.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(r,e),!0)},t.prototype.getPosition=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.e.Zero();return this.getPositionToRef(e,n,r),r},t.prototype.getPositionToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),e==Se.c.LOCAL){var o=this.getLocalMatrix();r.x=o.m[12],r.y=o.m[13],r.z=o.m[14]}else{var l=null;n&&(l=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=t._tmpMats[0];n&&l?(h.copyFrom(this.getAbsoluteTransform()),h.multiplyToRef(l,h)):h=this.getAbsoluteTransform(),r.x=h.m[12],r.y=h.m[13],r.z=h.m[14]}},t.prototype.getAbsolutePosition=function(e){e===void 0&&(e=null);var n=d.e.Zero();return this.getPositionToRef(Se.c.WORLD,e,n),n},t.prototype.getAbsolutePositionToRef=function(e,n){this.getPositionToRef(Se.c.WORLD,e,n)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var n=this.children,r=n.length,o=0;o<r;o++)n[o].computeAbsoluteTransforms()},t.prototype.getDirection=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getDirectionToRef(e,n,r),r},t.prototype.getDirectionToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];l.copyFrom(this.getAbsoluteTransform()),n&&o&&l.multiplyToRef(o,l),d.e.TransformNormalToRef(e,l,r),r.normalize()},t.prototype.getRotation=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.e.Zero();return this.getRotationToRef(e,n,r),r},t.prototype.getRotationToRef=function(e,n,r){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var o=t._tmpQuat;this.getRotationQuaternionToRef(e,n,o),o.toEulerAnglesToRef(r)},t.prototype.getRotationQuaternion=function(e,n){e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null);var r=d.b.Identity();return this.getRotationQuaternionToRef(e,n,r),r},t.prototype.getRotationQuaternionToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),n===void 0&&(n=null),e==Se.c.LOCAL)this._decompose(),r.copyFrom(this._localRotation);else{var o=t._tmpMats[0],l=this.getAbsoluteTransform();n?l.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(l),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,r,void 0)}},t.prototype.getRotationMatrix=function(e,n){e===void 0&&(e=Se.c.LOCAL);var r=d.a.Identity();return this.getRotationMatrixToRef(e,n,r),r},t.prototype.getRotationMatrixToRef=function(e,n,r){if(e===void 0&&(e=Se.c.LOCAL),e==Se.c.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(r);else{var o=t._tmpMats[0],l=this.getAbsoluteTransform();n?l.multiplyToRef(n.getWorldMatrix(),o):o.copyFrom(l),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(r)}},t.prototype.getAbsolutePositionFromLocal=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getAbsolutePositionFromLocalToRef(e,n,r),r},t.prototype.getAbsolutePositionFromLocalToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];n&&o?(l.copyFrom(this.getAbsoluteTransform()),l.multiplyToRef(o,l)):l=this.getAbsoluteTransform(),d.e.TransformCoordinatesToRef(e,l,r)},t.prototype.getLocalPositionFromAbsolute=function(e,n){n===void 0&&(n=null);var r=d.e.Zero();return this.getLocalPositionFromAbsoluteToRef(e,n,r),r},t.prototype.getLocalPositionFromAbsoluteToRef=function(e,n,r){n===void 0&&(n=null);var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=t._tmpMats[0];l.copyFrom(this.getAbsoluteTransform()),n&&o&&l.multiplyToRef(o,l),l.invert(),d.e.TransformCoordinatesToRef(e,l,r)},t.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},t._tmpVecs=we.a.BuildArray(2,d.e.Zero),t._tmpQuat=d.b.Identity(),t._tmpMats=we.a.BuildArray(5,d.a.Identity),t}(Z.a),$e=function(){function i(t,e,n,r,o,l,h,v,b,A){n===void 0&&(n=0),r===void 0&&(r=100),o===void 0&&(o=!1),l===void 0&&(l=1),A===void 0&&(A=!1),this.target=e,this.fromFrame=n,this.toFrame=r,this.loopAnimation=o,this.onAnimationEnd=h,this.onAnimationLoop=b,this.isAdditive=A,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new E.c,this.onAnimationLoopObservable=new E.c,this._scene=t,v&&this.appendAnimations(e,v),this._speedRatio=l,t._activeAnimatables.push(this)}return Object.defineProperty(i.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=t!==-1?Math.min(Math.max(t,0),1):-1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){for(var e=0;e<this._runtimeAnimations.length;e++)this._runtimeAnimations[e]._prepareForSpeedRatioChange(t);this._speedRatio=t},enumerable:!1,configurable:!0}),i.prototype.syncWith=function(t){if(this._syncRoot=t,t){var e=this._scene._activeAnimatables.indexOf(this);e>-1&&(this._scene._activeAnimatables.splice(e,1),this._scene._activeAnimatables.push(this))}return this},i.prototype.getAnimations=function(){return this._runtimeAnimations},i.prototype.appendAnimations=function(t,e){for(var n=this,r=0;r<e.length;r++){var o=e[r],l=new ge(t,o,this._scene,this);l._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(l)}},i.prototype.getAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n].animation;return null},i.prototype.getRuntimeAnimationByTargetProperty=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)if(e[n].animation.targetProperty===t)return e[n];return null},i.prototype.reset=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},i.prototype.enableBlending=function(t){for(var e=this._runtimeAnimations,n=0;n<e.length;n++)e[n].animation.enableBlending=!0,e[n].animation.blendingSpeed=t},i.prototype.disableBlending=function(){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].animation.enableBlending=!1},i.prototype.goToFrame=function(t){var e=this._runtimeAnimations;if(e[0]){var n=e[0].animation.framePerSecond,r=e[0].currentFrame,o=this.speedRatio===0?0:(t-r)/n*1e3/this.speedRatio;this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=o}for(var l=0;l<e.length;l++)e[l].goToFrame(t)},i.prototype.pause=function(){this._paused||(this._paused=!0)},i.prototype.restart=function(){this._paused=!1},i.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},i.prototype.stop=function(t,e){if(t||e){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var r=(l=this._runtimeAnimations).length-1;r>=0;r--){var o=l[r];t&&o.animation.name!=t||e&&!e(o.target)||(o.dispose(),l.splice(r,1))}l.length==0&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else if((r=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(r,1);var l=this._runtimeAnimations;for(r=0;r<l.length;r++)l[r].dispose();this._raiseOnAnimationEnd()}},i.prototype.waitAsync=function(){var t=this;return new Promise(function(e,n){t.onAnimationEndObservable.add(function(){e(t)},void 0,void 0,t,!0)})},i.prototype._animate=function(t){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=t),!0;if(this._localDelayOffset===null?(this._localDelayOffset=t,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var e,n=!1,r=this._runtimeAnimations;for(e=0;e<r.length;e++){var o=r[e].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||o}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<r.length;e++)r[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},i}();ne.a.prototype._animate=function(){if(this.animationsEnabled){var i=Te.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=i}this.deltaTime=this.useConstantAnimationDeltaTime?16:(i-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=i;var t=this._activeAnimatables;if(t.length!==0){this._animationTime+=this.deltaTime;for(var e=this._animationTime,n=0;n<t.length;n++){var r=t[n];!r._animate(e)&&r.disposeOnEnd&&n--}this._processLateAnimationBindings()}}},ne.a.prototype.beginWeightedAnimation=function(i,t,e,n,r,o,l,h,v,b,A){n===void 0&&(n=1),o===void 0&&(o=1),A===void 0&&(A=!1);var D=this.beginAnimation(i,t,e,r,o,l,h,!1,v,b,A);return D.weight=n,D},ne.a.prototype.beginAnimation=function(i,t,e,n,r,o,l,h,v,b,A){r===void 0&&(r=1),h===void 0&&(h=!0),A===void 0&&(A=!1),t>e&&r>0&&(r*=-1),h&&this.stopAnimation(i,void 0,v),l||(l=new $e(this,i,t,e,n,r,o,void 0,b,A));var D=!v||v(i);if(i.animations&&D&&l.appendAnimations(i,i.animations),i.getAnimatables)for(var N=i.getAnimatables(),j=0;j<N.length;j++)this.beginAnimation(N[j],t,e,n,r,o,l,h,v,b);return l.reset(),l},ne.a.prototype.beginHierarchyAnimation=function(i,t,e,n,r,o,l,h,v,b,A,D){o===void 0&&(o=1),v===void 0&&(v=!0),D===void 0&&(D=!1);var N=i.getDescendants(t),j=[];j.push(this.beginAnimation(i,e,n,r,o,l,h,v,b,void 0,D));for(var k=0,H=N;k<H.length;k++){var J=H[k];j.push(this.beginAnimation(J,e,n,r,o,l,h,v,b,void 0,D))}return j},ne.a.prototype.beginDirectAnimation=function(i,t,e,n,r,o,l,h,v){return v===void 0&&(v=!1),o===void 0&&(o=1),e>n&&o>0&&(o*=-1),new $e(this,i,e,n,r,o,l,t,h,v)},ne.a.prototype.beginDirectHierarchyAnimation=function(i,t,e,n,r,o,l,h,v,b){b===void 0&&(b=!1);var A=i.getDescendants(t),D=[];D.push(this.beginDirectAnimation(i,e,n,r,o,l,h,v,b));for(var N=0,j=A;N<j.length;N++){var k=j[N];D.push(this.beginDirectAnimation(k,e,n,r,o,l,h,v,b))}return D},ne.a.prototype.getAnimatableByTarget=function(i){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===i)return this._activeAnimatables[t];return null},ne.a.prototype.getAllAnimatablesByTarget=function(i){for(var t=[],e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].target===i&&t.push(this._activeAnimatables[e]);return t},ne.a.prototype.stopAnimation=function(i,t,e){for(var n=0,r=this.getAllAnimatablesByTarget(i);n<r.length;n++)r[n].stop(t,e)},ne.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].stop();this._activeAnimatables=[]}for(var t=0,e=this.animationGroups;t<e.length;t++)e[t].stop()},ne.a.prototype._registerTargetForLateAnimationBinding=function(i,t){var e=i.target;this._registeredForLateAnimationBindings.pushNoDuplicate(e),e._lateAnimationHolders||(e._lateAnimationHolders={}),e._lateAnimationHolders[i.targetPath]||(e._lateAnimationHolders[i.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:t}),i.isAdditive?(e._lateAnimationHolders[i.targetPath].additiveAnimations.push(i),e._lateAnimationHolders[i.targetPath].totalAdditiveWeight+=i.weight):(e._lateAnimationHolders[i.targetPath].animations.push(i),e._lateAnimationHolders[i.targetPath].totalWeight+=i.weight)},ne.a.prototype._processLateAnimationBindingsForMatrices=function(i){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return i.originalValue;var t=1,e=d.c.Vector3[0],n=d.c.Vector3[1],r=d.c.Quaternion[0],o=0,l=i.animations[0],h=i.originalValue,v=1,b=!1;if(i.totalWeight<1)v=1-i.totalWeight,h.decompose(n,r,e);else{if(o=1,t=i.totalWeight,(v=l.weight/t)==1){if(!i.totalAdditiveWeight)return l.currentValue;b=!0}l.currentValue.decompose(n,r,e)}if(!b){n.scaleInPlace(v),e.scaleInPlace(v),r.scaleInPlace(v);for(var A=o;A<i.animations.length;A++)if((H=i.animations[A]).weight!==0){v=H.weight/t;var D=d.c.Vector3[2],N=d.c.Vector3[3],j=d.c.Quaternion[1];H.currentValue.decompose(N,j,D),N.scaleAndAddToRef(v,n),j.scaleAndAddToRef(v,r),D.scaleAndAddToRef(v,e)}}for(var k=0;k<i.additiveAnimations.length;k++){var H;(H=i.additiveAnimations[k]).weight!==0&&(D=d.c.Vector3[2],N=d.c.Vector3[3],j=d.c.Quaternion[1],H.currentValue.decompose(N,j,D),N.multiplyToRef(n,N),d.e.LerpToRef(n,N,H.weight,n),r.multiplyToRef(j,j),d.b.SlerpToRef(r,j,H.weight,r),D.scaleAndAddToRef(H.weight,e))}var J=l?l._animationState.workValue:d.c.Matrix[0].clone();return d.a.ComposeToRef(n,r,e,J),J},ne.a.prototype._processLateAnimationBindingsForQuaternions=function(i,t){if(i.totalWeight===0&&i.totalAdditiveWeight===0)return t;var e=i.animations[0],n=i.originalValue,r=t;if(i.totalWeight===0&&i.totalAdditiveWeight>0)r.copyFrom(n);else if(i.animations.length===1){if(d.b.SlerpToRef(n,e.currentValue,Math.min(1,i.totalWeight),r),i.totalAdditiveWeight===0)return r}else if(i.animations.length>1){var o=1,l=void 0,h=void 0;if(i.totalWeight<1){var v=1-i.totalWeight;h=[],(l=[]).push(n),h.push(v)}else{if(i.animations.length===2&&(d.b.SlerpToRef(i.animations[0].currentValue,i.animations[1].currentValue,i.animations[1].weight/i.totalWeight,t),i.totalAdditiveWeight===0))return t;l=[],h=[],o=i.totalWeight}for(var b=0;b<i.animations.length;b++){var A=i.animations[b];l.push(A.currentValue),h.push(A.weight/o)}for(var D=0,N=0;N<l.length;)N?(D+=h[N],d.b.SlerpToRef(r,l[N],h[N]/D,r),N++):(d.b.SlerpToRef(l[N],l[N+1],h[N+1]/(h[N]+h[N+1]),t),r=t,D=h[N]+h[N+1],N+=2)}for(var j=0;j<i.additiveAnimations.length;j++)(A=i.additiveAnimations[j]).weight!==0&&(r.multiplyToRef(A.currentValue,d.c.Quaternion[0]),d.b.SlerpToRef(r,d.c.Quaternion[0],A.weight,r));return r},ne.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var i=0;i<this._registeredForLateAnimationBindings.length;i++){var t=this._registeredForLateAnimationBindings.data[i];for(var e in t._lateAnimationHolders){var n=t._lateAnimationHolders[e],r=n.animations[0],o=n.originalValue,l=W.AllowMatrixDecomposeForInterpolation&&o.m,h=t[e];if(l)h=this._processLateAnimationBindingsForMatrices(n);else if(o.w!==void 0)h=this._processLateAnimationBindingsForQuaternions(n,h||d.b.Identity());else{var v=0,b=1;if(n.totalWeight<1)h=r&&o.scale?o.scale(1-n.totalWeight):r?o*(1-n.totalWeight):o.clone?o.clone():o;else if(r){b=n.totalWeight;var A=r.weight/b;h=A!==1?r.currentValue.scale?r.currentValue.scale(A):r.currentValue*A:r.currentValue,v=1}for(var D=v;D<n.animations.length;D++)(k=(j=n.animations[D]).weight/b)&&(j.currentValue.scaleAndAddToRef?j.currentValue.scaleAndAddToRef(k,h):h+=j.currentValue*k);for(var N=0;N<n.additiveAnimations.length;N++){var j,k;(k=(j=n.additiveAnimations[N]).weight)&&(j.currentValue.scaleAndAddToRef?j.currentValue.scaleAndAddToRef(k,h):h+=j.currentValue*k)}}t[e]=h}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},Ge.prototype.copyAnimationRange=function(i,t,e,n,r){n===void 0&&(n=!1),r===void 0&&(r=null),this.animations.length===0&&(this.animations.push(new W(this.name,"_matrix",i.animations[0].framePerSecond,W.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=i.animations[0].getRange(t);if(!o)return!1;for(var l,h,v,b=o.from,A=o.to,D=i.animations[0].getKeys(),N=i.length,j=i.getParent(),k=this.getParent(),H=n&&j&&N&&this.length&&N!==this.length,J=H&&k&&j?k.length/j.length:1,te=n&&!k&&r&&(r.x!==1||r.y!==1||r.z!==1),oe=this.animations[0].getKeys(),ce=0,he=D.length;ce<he;ce++)(l=D[ce]).frame>=b&&l.frame<=A&&(n?(v=l.value.clone(),H?(h=v.getTranslation(),v.setTranslation(h.scaleInPlace(J))):te&&r?(h=v.getTranslation(),v.setTranslation(h.multiplyInPlace(r))):v=l.value):v=l.value,oe.push({frame:l.frame+e,value:v}));return this.animations[0].createRange(t,b+e,A+e),!0};var nt=function(){function i(){}return i.prototype.getClassName=function(){return"TargetedAnimation"},i.prototype.serialize=function(){var t={};return t.animation=this.animation.serialize(),t.targetId=this.target.id,t},i}(),et=function(){function i(t,e){e===void 0&&(e=null),this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this.onAnimationEndObservable=new E.c,this.onAnimationLoopObservable=new E.c,this.onAnimationGroupLoopObservable=new E.c,this.onAnimationGroupEndObservable=new E.c,this.onAnimationGroupPauseObservable=new E.c,this.onAnimationGroupPlayObservable=new E.c,this._scene=e||$.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(i.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){if(this._speedRatio!==t){this._speedRatio=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].speedRatio=this._speedRatio}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(t){if(this._loopAnimation!==t){this._loopAnimation=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].loopAnimation=this._loopAnimation}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(t){if(this._isAdditive!==t){this._isAdditive=t;for(var e=0;e<this._animatables.length;e++)this._animatables[e].isAdditive=this._isAdditive}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),i.prototype.addTargetedAnimation=function(t,e){var n=new nt;n.animation=t,n.target=e;var r=t.getKeys();return this._from>r[0].frame&&(this._from=r[0].frame),this._to<r[r.length-1].frame&&(this._to=r[r.length-1].frame),this._targetedAnimations.push(n),n},i.prototype.normalize=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null),t==null&&(t=this._from),e==null&&(e=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var r=this._targetedAnimations[n].animation.getKeys(),o=r[0],l=r[r.length-1];if(o.frame>t){var h={frame:t,value:o.value,inTangent:o.inTangent,outTangent:o.outTangent,interpolation:o.interpolation};r.splice(0,0,h)}l.frame<e&&(h={frame:e,value:l.value,inTangent:l.inTangent,outTangent:l.outTangent,interpolation:l.interpolation},r.push(h))}return this._from=t,this._to=e,this},i.prototype._processLoop=function(t,e,n){var r=this;t.onAnimationLoop=function(){r.onAnimationLoopObservable.notifyObservers(e),r._animationLoopFlags[n]||(r._animationLoopFlags[n]=!0,r._animationLoopCount++,r._animationLoopCount===r._targetedAnimations.length&&(r.onAnimationGroupLoopObservable.notifyObservers(r),r._animationLoopCount=0,r._animationLoopFlags=[]))}},i.prototype.start=function(t,e,n,r,o){var l=this;if(t===void 0&&(t=!1),e===void 0&&(e=1),this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=t,this._animationLoopCount=0,this._animationLoopFlags=[];for(var h=function(){var D=v._targetedAnimations[b],N=v._scene.beginDirectAnimation(D.target,[D.animation],n!==void 0?n:v._from,r!==void 0?r:v._to,t,e,void 0,void 0,o!==void 0?o:v._isAdditive);N.onAnimationEnd=function(){l.onAnimationEndObservable.notifyObservers(D),l._checkAnimationGroupEnded(N)},v._processLoop(N,D,b),v._animatables.push(N)},v=this,b=0;b<this._targetedAnimations.length;b++)h();if(this._speedRatio=e,n!==void 0&&r!==void 0)if(n<r&&this._speedRatio<0){var A=r;r=n,n=A}else n>r&&this._speedRatio>0&&(this._speedRatio=-e);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var t=0;t<this._animatables.length;t++)this._animatables[t].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},i.prototype.play=function(t){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(t!==void 0&&(this.loopAnimation=t),this.restart()):(this.stop(),this.start(t,this._speedRatio)),this._isPaused=!1,this},i.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].reset();return this},i.prototype.restart=function(){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},i.prototype.stop=function(){if(!this._isStarted)return this;for(var t=this._animatables.slice(),e=0;e<t.length;e++)t[e].stop();return this._isStarted=!1,this},i.prototype.setWeightForAllAnimatables=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].weight=t;return this},i.prototype.syncAllAnimationsWith=function(t){for(var e=0;e<this._animatables.length;e++)this._animatables[e].syncWith(t);return this},i.prototype.goToFrame=function(t){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].goToFrame(t);return this},i.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var t=this._scene.animationGroups.indexOf(this);t>-1&&this._scene.animationGroups.splice(t,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},i.prototype._checkAnimationGroupEnded=function(t){var e=this._animatables.indexOf(t);e>-1&&this._animatables.splice(e,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},i.prototype.clone=function(t,e){for(var n=new i(t||this.name,this._scene),r=0,o=this._targetedAnimations;r<o.length;r++){var l=o[r];n.addTargetedAnimation(l.animation.clone(),e?e(l.target):l.target)}return n},i.prototype.serialize=function(){var t={};t.name=this.name,t.from=this.from,t.to=this.to,t.targetedAnimations=[];for(var e=0;e<this.targetedAnimations.length;e++){var n=this.targetedAnimations[e];t.targetedAnimations[e]=n.serialize()}return t},i.Parse=function(t,e){for(var n=new i(t.name,e),r=0;r<t.targetedAnimations.length;r++){var o=t.targetedAnimations[r],l=W.Parse(o.animation),h=o.targetId;if(o.animation.property==="influence"){var v=e.getMorphTargetById(h);v&&n.addTargetedAnimation(l,v)}else{var b=e.getNodeByID(h);b!=null&&n.addTargetedAnimation(l,b)}}return t.from!==null&&t.to!==null&&n.normalize(t.from,t.to),n},i.MakeAnimationAdditive=function(t,e,n,r,o){e===void 0&&(e=0),r===void 0&&(r=!1);var l=t;r&&(l=t.clone(o||l.name));for(var h=l.targetedAnimations,v=0;v<h.length;v++){var b=h[v];W.MakeAnimationAdditive(b.animation,e,n)}return l.isAdditive=!0,l},i.prototype.getClassName=function(){return"AnimationGroup"},i.prototype.toString=function(t){var e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e},i}(),Ze=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=W.ANIMATIONLOOPMODE_CYCLE},ht=c(72),gt=function(){function i(){this._easingMode=i.EASINGMODE_EASEIN}return i.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},i.prototype.getEasingMode=function(){return this._easingMode},i.prototype.easeInCore=function(t){throw new Error("You must implement this method")},i.prototype.ease=function(t){switch(this._easingMode){case i.EASINGMODE_EASEIN:return this.easeInCore(t);case i.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},i.EASINGMODE_EASEIN=0,i.EASINGMODE_EASEOUT=1,i.EASINGMODE_EASEINOUT=2,i}(),Rt=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(gt),zt=function(i){function t(e){e===void 0&&(e=1);var n=i.call(this)||this;return n.amplitude=e,n}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.amplitude);return Math.pow(e,3)-e*n*Math.sin(3.141592653589793*e)},t}(gt),un=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=2);var r=i.call(this)||this;return r.bounces=e,r.bounciness=n,r}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.bounces),r=this.bounciness;r<=1&&(r=1.001);var o=Math.pow(r,n),l=1-r,h=(1-o)/l+.5*o,v=e*h,b=Math.log(-v*(1-r)+1)/Math.log(r),A=Math.floor(b),D=A+1,N=(1-Math.pow(r,A))/(l*h),j=.5*(N+(1-Math.pow(r,D))/(l*h)),k=e-j,H=j-N;return-Math.pow(1/r,n-A)/(H*H)*(k-H)*(k+H)},t}(gt),Br=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e},t}(gt),lr=function(i){function t(e,n){e===void 0&&(e=3),n===void 0&&(n=3);var r=i.call(this)||this;return r.oscillations=e,r.springiness=n,r}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return(r==0?e:(Math.exp(r*e)-1)/(Math.exp(r)-1))*Math.sin((6.283185307179586*n+1.5707963267948966)*e)},t}(gt),Ur=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.exponent=e,n}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(gt),Qr=function(i){function t(e){e===void 0&&(e=2);var n=i.call(this)||this;return n.power=e,n}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){var n=Math.max(0,this.power);return Math.pow(e,n)},t}(gt),qr=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return e*e},t}(gt),Xi=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e},t}(gt),Co=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(gt),gr=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(gt),Yi=function(i){function t(e,n,r,o){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=1),o===void 0&&(o=1);var l=i.call(this)||this;return l.x1=e,l.y1=n,l.x2=r,l.y2=o,l}return Object(_.d)(t,i),t.prototype.easeInCore=function(e){return ht.c.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t}(gt),Ja=function(){function i(t,e,n){this.frame=t,this.action=e,this.onlyOnce=n,this.isDone=!1}return i.prototype._clone=function(){return new i(this.frame,this.action,this.onlyOnce)},i}(),Ne=c(7),pa=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t}(T.a),ma=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},Oi=function(i){function t(e){var n=i.call(this)||this;return n._wasAddedToScene=!1,n.scene=e,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],e.onDisposeObservable.add(function(){n._wasAddedToScene||n.dispose()}),n}return Object(_.d)(t,i),t.prototype.instantiateModelsToScene=function(e,n){var r=this;n===void 0&&(n=!1);var o={},l={},h=new ma,v=[],b=[],A={doNotInstantiate:!0},D=function(N,j){if(o[N.uniqueId]=j.uniqueId,l[j.uniqueId]=j,e&&(j.name=e(N.name)),j instanceof Ne.a){var k=j;if(k.morphTargetManager){var H=N.morphTargetManager;k.morphTargetManager=H.clone();for(var J=0;J<H.numTargets;J++){var te=H.getTarget(J),oe=k.morphTargetManager.getTarget(J);o[te.uniqueId]=oe.uniqueId,l[oe.uniqueId]=oe}}}};return this.transformNodes.forEach(function(N){if(!N.parent){var j=N.instantiateHierarchy(null,A,function(k,H){D(k,H)});j&&h.rootNodes.push(j)}}),this.meshes.forEach(function(N){if(!N.parent){var j=N.instantiateHierarchy(null,A,function(k,H){if(D(k,H),H.material){var J=H;if(J.material)if(n){var te=k.material;if(b.indexOf(te)===-1){var oe=te.clone(e?e(te.name):"Clone of "+te.name);if(b.push(te),o[te.uniqueId]=oe.uniqueId,l[oe.uniqueId]=oe,te.getClassName()==="MultiMaterial"){for(var ce=te,he=0,_e=ce.subMaterials;he<_e.length;he++){var ye=_e[he];ye&&(oe=ye.clone(e?e(ye.name):"Clone of "+ye.name),b.push(ye),o[ye.uniqueId]=oe.uniqueId,l[oe.uniqueId]=oe)}ce.subMaterials=ce.subMaterials.map(function(Ee){return Ee&&l[o[Ee.uniqueId]]})}}J.material=l[o[te.uniqueId]]}else J.material.getClassName()==="MultiMaterial"?r.scene.multiMaterials.indexOf(J.material)===-1&&r.scene.addMultiMaterial(J.material):r.scene.materials.indexOf(J.material)===-1&&r.scene.addMaterial(J.material)}});j&&h.rootNodes.push(j)}}),this.skeletons.forEach(function(N){var j=N.clone(e?e(N.name):"Clone of "+N.name);N.overrideMesh&&(j.overrideMesh=l[o[N.overrideMesh.uniqueId]]);for(var k=0,H=r.meshes;k<H.length;k++){var J=H[k];if(J.skeleton===N&&!J.isAnInstance){if(l[o[J.uniqueId]].skeleton=j,v.indexOf(j)!==-1)continue;v.push(j);for(var te=0,oe=j.bones;te<oe.length;te++){var ce=oe[te];ce._linkedTransformNode&&(ce._linkedTransformNode=l[o[ce._linkedTransformNode.uniqueId]])}}}h.skeletons.push(j)}),this.animationGroups.forEach(function(N){var j=N.clone(N.name,function(k){return l[o[k.uniqueId]]||k});h.animationGroups.push(j)}),h},t.prototype.addAllToScene=function(){var e=this;this._wasAddedToScene=!0,this.cameras.forEach(function(o){e.scene.addCamera(o)}),this.lights.forEach(function(o){e.scene.addLight(o)}),this.meshes.forEach(function(o){e.scene.addMesh(o)}),this.skeletons.forEach(function(o){e.scene.addSkeleton(o)}),this.animations.forEach(function(o){e.scene.addAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.addAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.addMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.addMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.addMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.addGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.addTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.addActionManager(o)}),this.textures.forEach(function(o){e.scene.addTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.addReflectionProbe(o)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var e=this;this._wasAddedToScene=!1,this.cameras.forEach(function(o){e.scene.removeCamera(o)}),this.lights.forEach(function(o){e.scene.removeLight(o)}),this.meshes.forEach(function(o){e.scene.removeMesh(o)}),this.skeletons.forEach(function(o){e.scene.removeSkeleton(o)}),this.animations.forEach(function(o){e.scene.removeAnimation(o)}),this.animationGroups.forEach(function(o){e.scene.removeAnimationGroup(o)}),this.multiMaterials.forEach(function(o){e.scene.removeMultiMaterial(o)}),this.materials.forEach(function(o){e.scene.removeMaterial(o)}),this.morphTargetManagers.forEach(function(o){e.scene.removeMorphTargetManager(o)}),this.geometries.forEach(function(o){e.scene.removeGeometry(o)}),this.transformNodes.forEach(function(o){e.scene.removeTransformNode(o)}),this.actionManagers.forEach(function(o){e.scene.removeActionManager(o)}),this.textures.forEach(function(o){e.scene.removeTexture(o)}),this.reflectionProbes.forEach(function(o){e.scene.removeReflectionProbe(o)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var n=0,r=this.scene._serializableComponents;n<r.length;n++)r[n].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach(function(r){r.dispose()}),this.cameras=[],this.lights.forEach(function(r){r.dispose()}),this.lights=[],this.meshes.forEach(function(r){r.dispose()}),this.meshes=[],this.skeletons.forEach(function(r){r.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(r){r.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(r){r.dispose()}),this.multiMaterials=[],this.materials.forEach(function(r){r.dispose()}),this.materials=[],this.geometries.forEach(function(r){r.dispose()}),this.geometries=[],this.transformNodes.forEach(function(r){r.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(r){r.dispose()}),this.actionManagers=[],this.textures.forEach(function(r){r.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(r){r.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,n=this.scene._serializableComponents;e<n.length;e++)n[e].removeFromContainer(this,!0)},t.prototype._moveAssets=function(e,n,r){if(e)for(var o=0,l=e;o<l.length;o++){var h=l[o],v=!0;if(r){for(var b=0,A=r;b<A.length;b++)if(h===A[b]){v=!1;break}}v&&n.push(h)}},t.prototype.moveAllFromScene=function(e){for(var n in this._wasAddedToScene=!1,e===void 0&&(e=new pa),this)this.hasOwnProperty(n)&&(this[n]=this[n]||(n==="environmentTexture"?null:[]),this._moveAssets(this.scene[n],this[n],e[n]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new Ne.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(n){n.parent||e.addChild(n)}),this.meshes.unshift(e),e},t.prototype.mergeAnimationsTo=function(e,n,r){if(e===void 0&&(e=$.a.LastCreatedScene),r===void 0&&(r=null),!e)return p.a.Error("No scene available to merge animations to"),[];var o=r||function(h){var v=null,b=h.animations.length?h.animations[0].targetProperty:"",A=h.name.split(".").join("").split("_primitive")[0];switch(b){case"position":case"rotationQuaternion":v=e.getTransformNodeByName(h.name)||e.getTransformNodeByName(A);break;case"influence":v=e.getMorphTargetByName(h.name)||e.getMorphTargetByName(A);break;default:v=e.getNodeByName(h.name)||e.getNodeByName(A)}return v};this.getNodes().forEach(function(h){var v=o(h);if(v!==null){for(var b=function(N){for(var j=0,k=v.animations.filter(function(te){return te.targetProperty===N.targetProperty});j<k.length;j++){var H=k[j],J=v.animations.indexOf(H,0);J>-1&&v.animations.splice(J,1)}},A=0,D=h.animations;A<D.length;A++)b(D[A]);v.animations=v.animations.concat(h.animations)}});var l=new Array;return this.animationGroups.slice().forEach(function(h){l.push(h.clone(h.name,o)),h.animatables.forEach(function(v){v.stop()})}),n.forEach(function(h){var v=o(h.target);v&&(e.beginAnimation(v,h.fromFrame,h.toFrame,h.loopAnimation,h.speedRatio,h.onAnimationEnd?h.onAnimationEnd:void 0,void 0,!0,void 0,h.onAnimationLoop?h.onAnimationLoop:void 0),e.stopAnimation(h.target))}),l},t}(T.a),Xe=c(13),ur=function(){function i(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=Xe.a.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return i.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},i.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},i.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},i.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},i.prototype.drawDebugCanvas=function(){var t=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){t.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var e=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var n=0;n<this.getFrequencyBinCount();n++){var r=e[n]/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*r,l=this.DEBUGCANVASSIZE.height-o-1,h=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),v=n/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+v+", 100%, 50%)",this._debugCanvasContext.fillRect(n*h,l,h,o)}}},i.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},i.prototype.connectAudioNodes=function(t,e){this._audioEngine.canUseWebAudio&&(t.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(e))},i.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},i}();Xe.a.AudioEngineFactory=function(i){return new es(i)};var es=function(){function i(t){var e=this;t===void 0&&(t=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new E.c,this.onAudioLockedObservable=new E.c,this._tryToRun=!1,this._onResize=function(){e._moveButtonToTopLeft()},window.AudioContext===void 0&&window.webkitAudioContext===void 0||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var n=document.createElement("audio");this._hostElement=t;try{n&&n.canPlayType&&(n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||n.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(r){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(r){}}return Object.defineProperty(i.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!1,configurable:!0}),i.prototype.lock=function(){this._triggerSuspendedState()},i.prototype.unlock=function(){this._triggerRunningState()},i.prototype._resumeAudioContext=function(){var t;return this._audioContext.resume!==void 0&&(t=this._audioContext.resume()),t||Promise.resolve()},i.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(t){this.canUseWebAudio=!1,p.a.Error("Web Audio: "+t.message)}},i.prototype._triggerRunningState=function(){var t=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){t._tryToRun=!1,t._muteButton&&t._hideMuteButton(),t.unlocked=!0,t.onAudioUnlockedObservable.notifyObservers(t)}).catch(function(){t._tryToRun=!1,t.unlocked=!1}))},i.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},i.prototype._displayMuteButton=function(){var t=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var e=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",n=document.createElement("style");n.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(n),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){t._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){t._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},i.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},i.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},i.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},i.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},i.prototype.setGlobalVolume=function(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},i}(),Qe=c(12),rr=c(21),li=function(){function i(t,e,n,r,o){var l,h,v,b,A=this;if(r===void 0&&(r=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new E.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=d.e.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new d.e(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=n,i._SceneComponentInitialization(n),this._readyToPlayCallback=r,this._customAttenuationFunction=function(J,te,oe,ce,he){return te<oe?J*(1-te/oe):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,o.volume!==void 0&&(this._volume=o.volume),this.spatialSound=(l=o.spatialSound)!==null&&l!==void 0&&l,this.maxDistance=(h=o.maxDistance)!==null&&h!==void 0?h:100,this.useCustomAttenuation=(v=o.useCustomAttenuation)!==null&&v!==void 0&&v,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=(b=o.streaming)!==null&&b!==void 0&&b,this._length=o.length,this._offset=o.offset),Xe.a.audioEngine.canUseWebAudio&&Xe.a.audioEngine.audioContext){this._soundGain=Xe.a.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);var D=!0;if(e)try{typeof e=="string"?this._urlType="String":e instanceof ArrayBuffer?this._urlType="ArrayBuffer":e instanceof MediaStream?this._urlType="MediaStream":Array.isArray(e)&&(this._urlType="Array");var N=[],j=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Xe.a.audioEngine.audioContext.createMediaStreamSource(e),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":e.byteLength>0&&(j=!0,this._soundLoaded(e));break;case"String":N.push(e);case"Array":N.length===0&&(N=e);for(var k=0;k<N.length;k++){var H=N[k];if(j=o&&o.skipCodecCheck||H.indexOf(".mp3",H.length-4)!==-1&&Xe.a.audioEngine.isMP3supported||H.indexOf(".ogg",H.length-4)!==-1&&Xe.a.audioEngine.isOGGsupported||H.indexOf(".wav",H.length-4)!==-1||H.indexOf(".m4a",H.length-4)!==-1||H.indexOf("blob:")!==-1){this._streaming?(this._htmlAudioElement=new Audio(H),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Qe.b.SetCorsBehavior(H,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){A._isReadyToPlay=!0,A.autoplay&&A.play(0,A._offset,A._length),A._readyToPlayCallback&&A._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(H,function(J){A._soundLoaded(J)},void 0,!0,!0,function(J){J&&p.a.Error("XHR "+J.status+" error on: "+H+"."),p.a.Error("Sound creation aborted."),A._scene.mainSoundTrack.removeSound(A)});break}}break;default:D=!1}D?j||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){A._readyToPlayCallback&&A._readyToPlayCallback()},1e3)):p.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){p.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Xe.a.audioEngine.WarnedWebAudioUnsupported||(p.a.Error("Web Audio is not supported by your browser."),Xe.a.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){A._readyToPlayCallback&&A._readyToPlayCallback()},1e3)}return Object.defineProperty(i.prototype,"currentTime",{get:function(){if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;var t=this._startOffset;return this.isPlaying&&Xe.a.audioEngine.audioContext&&(t+=Xe.a.audioEngine.audioContext.currentTime-this._startTime),t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){Xe.a.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,this.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},i.prototype.isReady=function(){return this._isReadyToPlay},i.prototype._soundLoaded=function(t){var e=this;Xe.a.audioEngine.audioContext&&Xe.a.audioEngine.audioContext.decodeAudioData(t,function(n){e._audioBuffer=n,e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length),e._readyToPlayCallback&&e._readyToPlayCallback()},function(n){p.a.Error("Error while decoding audio data for: "+e.name+" / Error: "+n)})},i.prototype.setAudioBuffer=function(t){Xe.a.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},i.prototype.updateOptions=function(t){var e,n,r,o,l,h,v,b,A;t&&(this.loop=(e=t.loop)!==null&&e!==void 0?e:this.loop,this.maxDistance=(n=t.maxDistance)!==null&&n!==void 0?n:this.maxDistance,this.useCustomAttenuation=(r=t.useCustomAttenuation)!==null&&r!==void 0?r:this.useCustomAttenuation,this.rolloffFactor=(o=t.rolloffFactor)!==null&&o!==void 0?o:this.rolloffFactor,this.refDistance=(l=t.refDistance)!==null&&l!==void 0?l:this.refDistance,this.distanceModel=(h=t.distanceModel)!==null&&h!==void 0?h:this.distanceModel,this._playbackRate=(v=t.playbackRate)!==null&&v!==void 0?v:this._playbackRate,this._length=(b=t.length)!==null&&b!==void 0?b:void 0,this._offset=(A=t.offset)!==null&&A!==void 0?A:void 0,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),this._offset!==void 0&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),this._length!==void 0&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))},i.prototype._createSpatialParameters=function(){Xe.a.audioEngine.canUseWebAudio&&Xe.a.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=Xe.a.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))},i.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},i.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},i.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},i.prototype._switchPanningModel=function(){Xe.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},i.prototype.connectToSoundTrackAudioNode=function(t){Xe.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)},i.prototype.setDirectionalCone=function(t,e,n){e<t?p.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=e,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))},Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!=this._coneInnerAngle){if(this._coneOuterAngle<t)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,Xe.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!=this._coneOuterAngle){if(t<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,Xe.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t){this._position=t,Xe.a.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},i.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,Xe.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},i.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var t=this._connectedTransformNode.getWorldMatrix(),e=d.e.TransformNormal(this._localDirection,t);e.normalize(),this._soundPanner.setOrientation(e.x,e.y,e.z)}},i.prototype.updateDistanceFromListener=function(){if(Xe.a.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},i.prototype.setAttenuationFunction=function(t){this._customAttenuationFunction=t},i.prototype.play=function(t,e,n){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&Xe.a.audioEngine.audioContext)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var o=t?Xe.a.audioEngine.audioContext.currentTime+t:Xe.a.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=Xe.a.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){r._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(l=function(){if(Xe.a.audioEngine.unlocked){var h=r._htmlAudioElement.play();h!==void 0&&h.catch(function(v){Xe.a.audioEngine.lock(),(r.loop||r.autoplay)&&Xe.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})})}else(r.loop||r.autoplay)&&Xe.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})})();else{var l=function(){if(Xe.a.audioEngine.audioContext){if(n=n||r._length,e=e||r._offset,r._soundSource){var h=r._soundSource;h.onended=function(){h.disconnect()}}if(r._soundSource=Xe.a.audioEngine.audioContext.createBufferSource(),r._soundSource&&r._inputAudioNode){r._soundSource.buffer=r._audioBuffer,r._soundSource.connect(r._inputAudioNode),r._soundSource.loop=r.loop,e!==void 0&&(r._soundSource.loopStart=e),n!==void 0&&(r._soundSource.loopEnd=(0|e)+n),r._soundSource.playbackRate.value=r._playbackRate,r._soundSource.onended=function(){r._onended()},o=t?Xe.a.audioEngine.audioContext.currentTime+t:Xe.a.audioEngine.audioContext.currentTime;var v=r.isPaused?r._startOffset%r._soundSource.buffer.duration:e||0;r._soundSource.start(o,v,r.loop?void 0:n)}}};Xe.a.audioEngine.audioContext.state==="suspended"?setTimeout(function(){Xe.a.audioEngine.audioContext.state==="suspended"?(Xe.a.audioEngine.lock(),(r.loop||r.autoplay)&&Xe.a.audioEngine.onAudioUnlockedObservable.addOnce(function(){l()})):l()},500):l()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(h){p.a.Error("Error while trying to play audio: "+this.name+", "+h.message)}},i.prototype._onended=function(){this.isPlaying=!1,this._startOffset=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},i.prototype.stop=function(t){var e=this;if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(Xe.a.audioEngine.audioContext&&this._soundSource){var n=t?Xe.a.audioEngine.audioContext.currentTime+t:Xe.a.audioEngine.audioContext.currentTime;this._soundSource.stop(n),this._soundSource.onended=function(){e.isPlaying=!1},this.isPaused||(this._startOffset=0)}}},i.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():Xe.a.audioEngine.audioContext&&(this.stop(0),this._startOffset+=Xe.a.audioEngine.audioContext.currentTime-this._startTime))},i.prototype.setVolume=function(t,e){Xe.a.audioEngine.canUseWebAudio&&this._soundGain&&(e&&Xe.a.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Xe.a.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Xe.a.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,Xe.a.audioEngine.audioContext.currentTime+e)):this._soundGain.gain.value=t),this._volume=t},i.prototype.setPlaybackRate=function(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},i.prototype.getVolume=function(){return this._volume},i.prototype.attachToMesh=function(t){var e=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(n){return e._onRegisterAfterWorldMatrixUpdate(n)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},i.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},i.prototype._onRegisterAfterWorldMatrixUpdate=function(t){if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(d.c.Matrix[0]),this.setPosition(d.c.Matrix[0].getTranslation());else if(t.getBoundingInfo){var e=t.getBoundingInfo();this.setPosition(e.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);Xe.a.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},i.prototype.clone=function(){var t=this;if(this._streaming)return null;var e=function(){t._isReadyToPlay?(r._audioBuffer=t.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,t._offset,t._length)):window.setTimeout(e,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new i(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),e(),r},i.prototype.getAudioBuffer=function(){return this._audioBuffer},i.prototype.getSoundSource=function(){return this._soundSource},i.prototype.getSoundGain=function(){return this._soundGain},i.prototype.serialize=function(){var t={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this.spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.asArray(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.asArray(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t},i.Parse=function(t,e,n,r){var o,l=t.name;o=t.url?n+t.url:n+l;var h,v={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};if(r){var b=function(){r._isReadyToPlay?(h._audioBuffer=r.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,h._offset,h._length)):window.setTimeout(b,300)};h=new i(l,new ArrayBuffer(0),e,null,v),b()}else h=new i(l,o,e,function(){e._removePendingData(h)},v),e._addPendingData(h);if(t.position){var A=d.e.FromArray(t.position);h.setPosition(A)}if(t.isDirectional&&(h.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var D=d.e.FromArray(t.localDirectionToMesh);h.setLocalDirectionToMesh(D)}if(t.connectedMeshId){var N=e.getMeshByID(t.connectedMeshId);N&&h.attachToMesh(N)}return t.metadata&&(h.metadata=t.metadata),h},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("AudioSceneComponent")},i}(),ts=function(){function i(t,e){e===void 0&&(e={}),this.id=-1,this._isInitialized=!1,this._scene=t,this.soundCollection=new Array,this._options=e,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return i.prototype._initializeSoundTrackAudioGraph=function(){Xe.a.audioEngine.canUseWebAudio&&Xe.a.audioEngine.audioContext&&(this._outputAudioNode=Xe.a.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Xe.a.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)},i.prototype.dispose=function(){if(Xe.a.audioEngine&&Xe.a.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},i.prototype.addSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),Xe.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(t.soundTrackId===-1?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},i.prototype.removeSound=function(t){var e=this.soundCollection.indexOf(t);e!==-1&&this.soundCollection.splice(e,1)},i.prototype.setVolume=function(t){Xe.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)},i.prototype.switchPanningModelToHRTF=function(){if(Xe.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},i.prototype.switchPanningModelToEqualPower=function(){if(Xe.a.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},i.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,Xe.a.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Xe.a.audioEngine.masterGain))},i}(),ct=c(17);T.a.AddParser(ct.a.NAME_AUDIO,function(i,t,e,n){var r,o=[];if(e.sounds=e.sounds||[],i.sounds!==void 0&&i.sounds!==null)for(var l=0,h=i.sounds.length;l<h;l++){var v=i.sounds[l];Xe.a.audioEngine.canUseWebAudio?(v.url||(v.url=v.name),o[v.url]?e.sounds.push(li.Parse(v,t,n,o[v.url])):(r=li.Parse(v,t,n),o[v.url]=r,e.sounds.push(r))):e.sounds.push(new li(v.name,null,t))}o=[]}),Object.defineProperty(ne.a.prototype,"mainSoundTrack",{get:function(){var i=this._getComponent(ct.a.NAME_AUDIO);return i||(i=new Vr(this),this._addComponent(i)),this._mainSoundTrack||(this._mainSoundTrack=new ts(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ne.a.prototype.getSoundByName=function(i){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===i)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks){for(var e=0;e<this.soundTracks.length;e++)for(t=0;t<this.soundTracks[e].soundCollection.length;t++)if(this.soundTracks[e].soundCollection[t].name===i)return this.soundTracks[e].soundCollection[t]}return null},Object.defineProperty(ne.a.prototype,"audioEnabled",{get:function(){var i=this._getComponent(ct.a.NAME_AUDIO);return i||(i=new Vr(this),this._addComponent(i)),i.audioEnabled},set:function(i){var t=this._getComponent(ct.a.NAME_AUDIO);t||(t=new Vr(this),this._addComponent(t)),i?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"headphone",{get:function(){var i=this._getComponent(ct.a.NAME_AUDIO);return i||(i=new Vr(this),this._addComponent(i)),i.headphone},set:function(i){var t=this._getComponent(ct.a.NAME_AUDIO);t||(t=new Vr(this),this._addComponent(t)),i?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"audioListenerPositionProvider",{get:function(){var i=this._getComponent(ct.a.NAME_AUDIO);return i||(i=new Vr(this),this._addComponent(i)),i.audioListenerPositionProvider},set:function(i){var t=this._getComponent(ct.a.NAME_AUDIO);if(t||(t=new Vr(this),this._addComponent(t)),typeof i!="function")throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=i},enumerable:!0,configurable:!0}),Object.defineProperty(ne.a.prototype,"audioPositioningRefreshRate",{get:function(){var i=this._getComponent(ct.a.NAME_AUDIO);return i||(i=new Vr(this),this._addComponent(i)),i.audioPositioningRefreshRate},set:function(i){var t=this._getComponent(ct.a.NAME_AUDIO);t||(t=new Vr(this),this._addComponent(t)),t.audioPositioningRefreshRate=i},enumerable:!0,configurable:!0});var Vr=function(){function i(t){this.name=ct.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this._audioListenerPositionProvider=null,this._cachedCameraDirection=new d.e,this._cachedCameraPosition=new d.e,this._lastCheck=0,this.scene=t,t.soundTracks=new Array,t.sounds=new Array}return Object.defineProperty(i.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"headphone",{get:function(){return this._headphone},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"audioListenerPositionProvider",{get:function(){return this._audioListenerPositionProvider},set:function(t){this._audioListenerPositionProvider=t},enumerable:!1,configurable:!0}),i.prototype.register=function(){this.scene._afterRenderStage.registerStep(ct.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){if(t.sounds=[],this.scene.soundTracks)for(var e=0;e<this.scene.soundTracks.length;e++)for(var n=this.scene.soundTracks[e],r=0;r<n.soundCollection.length;r++)t.sounds.push(n.soundCollection[r].serialize())},i.prototype.addFromContainer=function(t){var e=this;t.sounds&&t.sounds.forEach(function(n){n.play(),n.autoplay=!0,e.scene.mainSoundTrack.addSound(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.sounds&&t.sounds.forEach(function(r){r.stop(),r.autoplay=!1,n.scene.mainSoundTrack.removeSound(r),e&&r.dispose()})},i.prototype.dispose=function(){var t=this.scene;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].dispose()},i.prototype.disableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!1,Xe.a.audioEngine&&Xe.a.audioEngine.audioContext&&Xe.a.audioEngine.audioContext.suspend(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].pause();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].pause()},i.prototype.enableAudio=function(){var t,e=this.scene;for(this._audioEnabled=!0,Xe.a.audioEngine&&Xe.a.audioEngine.audioContext&&Xe.a.audioEngine.audioContext.resume(),t=0;t<e.mainSoundTrack.soundCollection.length;t++)e.mainSoundTrack.soundCollection[t].isPaused&&e.mainSoundTrack.soundCollection[t].play();if(e.soundTracks)for(t=0;t<e.soundTracks.length;t++)for(var n=0;n<e.soundTracks[t].soundCollection.length;n++)e.soundTracks[t].soundCollection[n].isPaused&&e.soundTracks[t].soundCollection[n].play()},i.prototype.switchAudioModeForHeadphones=function(){var t=this.scene;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToHRTF()},i.prototype.switchAudioModeForNormalSpeakers=function(){var t=this.scene;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(var e=0;e<t.soundTracks.length;e++)t.soundTracks[e].switchPanningModelToEqualPower()},i.prototype._afterRender=function(){var t=Te.a.Now;if(!(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)){this._lastCheck=t;var e=this.scene;if(this._audioEnabled&&e._mainSoundTrack&&e.soundTracks&&(e._mainSoundTrack.soundCollection.length!==0||e.soundTracks.length!==1)){var n=Xe.a.audioEngine;if(n&&n.audioContext){if(this._audioListenerPositionProvider){var r=this._audioListenerPositionProvider();r.x=r.x||0,r.y=r.y||0,r.z=r.z||0,n.audioContext.listener.setPosition(r.x,r.y,r.z)}else{var o;if(o=e.activeCameras&&e.activeCameras.length>0?e.activeCameras[0]:e.activeCamera){this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.copyFrom(o.globalPosition),n.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)),o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]);var l=d.a.Invert(o.getViewMatrix()),h=d.e.TransformNormal(e.useRightHandedSystem?i._CameraDirectionRH:i._CameraDirectionLH,l);h.normalize(),isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||this._cachedCameraDirection.equals(h)||(this._cachedCameraDirection.copyFrom(h),n.audioContext.listener.setOrientation(h.x,h.y,h.z,0,1,0))}else n.audioContext.listener.setPosition(0,0,0)}var v;for(v=0;v<e.mainSoundTrack.soundCollection.length;v++){var b=e.mainSoundTrack.soundCollection[v];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(e.soundTracks)for(v=0;v<e.soundTracks.length;v++)for(var A=0;A<e.soundTracks[v].soundCollection.length;A++)(b=e.soundTracks[v].soundCollection[A]).useCustomAttenuation&&b.updateDistanceFromListener()}}}},i._CameraDirectionLH=new d.e(0,0,-1),i._CameraDirectionRH=new d.e(0,0,1),i}();li._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_AUDIO);t||(t=new Vr(i),i._addComponent(t))};var cp=function(){function i(t,e,n){var r=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],e.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=n;for(var o=0,l=0,h=n;l<h.length;l++)o+=h[l];for(var v=o>0?1/o:0,b=0;b<this._weights.length;b++)this._weights[b]*=v;this._sounds=e;for(var A=0,D=this._sounds;A<D.length;A++)D[A].onEndedObservable.add(function(){r._onended()})}return Object.defineProperty(i.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeInnerAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(var e=0,n=this._sounds;e<n.length;e++)n[e].directionalConeOuterAngle=t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t!==this._volume)for(var e=0,n=this._sounds;e<n.length;e++)n[e].setVolume(t)},enumerable:!1,configurable:!0}),i.prototype._onended=function(){this._currentIndex!==void 0&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},i.prototype.pause=function(){this.isPaused=!0,this._currentIndex!==void 0&&this._sounds[this._currentIndex].pause()},i.prototype.stop=function(){this.isPlaying=!1,this._currentIndex!==void 0&&this._sounds[this._currentIndex].stop()},i.prototype.play=function(t){if(!this.isPaused){this.stop();for(var e=Math.random(),n=0,r=0;r<this._weights.length;r++)if(e<=(n+=this._weights[r])){this._currentIndex=r;break}}var o=this._sounds[this._currentIndex];o.isReady()?o.play(0,this.isPaused?void 0:t):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},i}(),xt=c(18),Bu=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==xt.a.POINTERDOWN?r.type===xt.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){var r=Te.a.Now,o=0;e._lastFrameTime!=null&&(o=r-e._lastFrameTime),e._lastFrameTime=r,e._applyUserInteraction();var l=r-e._lastInteractionTime-e._idleRotationWaitTime,h=Math.max(Math.min(l/e._idleRotationSpinupTime,1),0);e._cameraRotationSpeed=e._idleRotationSpeed*h,e._attachedCamera&&(e._attachedCamera.alpha-=e._cameraRotationSpeed*(o/1e3))})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype._userIsZooming=function(){return!!this._attachedCamera&&this._attachedCamera.inertialRadiusOffset!==0},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Te.a.Now)},i.prototype._userIsMoving=function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},i}(),Uu=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(t){var e=this;if(this._autoTransitionRange!==t){this._autoTransitionRange=t;var n=this._attachedCamera;n&&(t?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add(function(r){if(r){r.computeWorldMatrix(!0);var o=r.getBoundingInfo().diagonalLength;e.lowerRadiusTransitionRange=.05*o,e.upperRadiusTransitionRange=.05*o}}):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._attachedCamera&&(e._isRadiusAtLimit(e._attachedCamera.lowerRadiusLimit)&&e._applyBoundRadiusAnimation(e.lowerRadiusTransitionRange),e._isRadiusAtLimit(e._attachedCamera.upperRadiusLimit)&&e._applyBoundRadiusAnimation(e.upperRadiusTransitionRange))})},i.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(t){return!!this._attachedCamera&&this._attachedCamera.radius===t&&!this._radiusIsAnimating},i.prototype._applyBoundRadiusAnimation=function(t){var e=this;if(this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=W.CreateAnimation("radius",W.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=W.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});n&&this._animatables.push(n)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new zt(.3),i.EasingMode=gt.EASINGMODE_EASEOUT,i}(),Ki=function(){function i(){this._mode=i.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){var e=this;this._attachedCamera=t;var n=this._attachedCamera.getScene();i.EasingFunction.setEasingMode(i.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(r){r.type!==xt.a.POINTERDOWN?r.type===xt.a.POINTERUP&&(e._isPointerDown=!1):e._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(r){r&&e.zoomOnMesh(r)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._applyUserInteraction(),e._maintainCameraAboveGround()})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},i.prototype.zoomOnMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,e,n)},i.prototype.zoomOnMeshHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),t.computeWorldMatrix(!0);var r=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,e,n)},i.prototype.zoomOnMeshesHierarchy=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null);for(var r=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new d.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=0;l<t.length;l++){var h=t[l].getHierarchyBoundingVectors(!0);d.e.CheckExtends(h.min,r,o),d.e.CheckExtends(h.max,r,o)}this.zoomOnBoundingInfo(r,o,e,n)},i.prototype.zoomOnBoundingInfo=function(t,e,n,r){var o,l=this;if(n===void 0&&(n=!1),r===void 0&&(r=null),this._attachedCamera){var h=t.y,v=h+(e.y-h)*this._positionScale,b=e.subtract(t).scale(.5);if(n)o=new d.e(0,v,0);else{var A=t.add(b);o=new d.e(A.x,v,A.z)}this._vectorTransition||(this._vectorTransition=W.CreateAnimation("target",W.ANIMATIONTYPE_VECTOR3,60,i.EasingFunction)),this._betaIsAnimating=!0;var D=W.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);D&&this._animatables.push(D);var N=0;if(this._mode===i.FitFrustumSidesMode){var j=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=b.length()+this._attachedCamera.minZ),N=j}else this._mode===i.IgnoreBoundsSizeMode&&(N=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var k=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/k,this._attachedCamera.wheelPrecision=100/N}this._radiusTransition||(this._radiusTransition=W.CreateAnimation("radius",W.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),(D=W.TransitionTo("radius",N,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){l.stopAllAnimations(),r&&r(),l._attachedCamera&&l._attachedCamera.useInputToRestoreState&&l._attachedCamera.storeState()}))&&this._animatables.push(D)}},i.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var n=e.subtract(t).length(),r=this._getFrustumSlope(),o=.5*n*this._radiusScale,l=o*Math.sqrt(1+1/(r.x*r.x)),h=o*Math.sqrt(1+1/(r.y*r.y)),v=Math.max(l,h),b=this._attachedCamera;return b?(b.lowerRadiusLimit&&this._mode===i.IgnoreBoundsSizeMode&&(v=v<b.lowerRadiusLimit?b.lowerRadiusLimit:v),b.upperRadiusLimit&&(v=v>b.upperRadiusLimit?b.upperRadiusLimit:v),v):0},i.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=Te.a.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,r=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>r&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=W.CreateAnimation("beta",W.ANIMATIONTYPE_FLOAT,60,i.EasingFunction));var o=W.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});o&&this._animatables.push(o)}}},i.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return d.d.Zero();var e=t.getScene().getEngine().getAspectRatio(t),n=Math.tan(t.fov/2),r=n*e;return new d.d(r,n)},i.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},i.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=Te.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(i.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown)},enumerable:!1,configurable:!0}),i.EasingFunction=new Ur,i.EasingMode=gt.EASINGMODE_EASEINOUT,i.IgnoreBoundsSizeMode=0,i.FitFrustumSidesMode=1,i}(),Ro=function(i,t,e,n){t===void 0&&(t=new d.e),e===void 0&&(e=0),n===void 0&&(n=!1),this.direction=i,this.rotatedDirection=t,this.diff=e,this.ignore=n},lp=function(){function i(t){this.ui=t,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new Ro(d.e.Up()),new Ro(d.e.Down()),new Ro(d.e.Left()),new Ro(d.e.Right()),new Ro(d.e.Forward()),new Ro(d.e.Forward().scaleInPlace(-1))],this._tmpMatrix=new d.a,this._tmpVector=new d.e,this._zeroVector=d.e.Zero(),this._lookAtTmpMatrix=new d.a}return i.prototype.init=function(){},i.prototype._closestFace=function(t){var e=this;return this._faceVectors.forEach(function(n){e._target.rotationQuaternion||(e._target.rotationQuaternion=d.b.RotationYawPitchRoll(e._target.rotation.y,e._target.rotation.x,e._target.rotation.z)),e._target.rotationQuaternion.toRotationMatrix(e._tmpMatrix),d.e.TransformCoordinatesToRef(n.direction,e._tmpMatrix,n.rotatedDirection),n.diff=d.e.GetAngleBetweenVectors(n.rotatedDirection,t,d.e.Cross(n.rotatedDirection,t))}),this._faceVectors.reduce(function(n,r){return n.ignore?r:r.ignore||n.diff<r.diff?n:r},this._faceVectors[0])},i.prototype._lookAtToRef=function(t,e,n){e===void 0&&(e=new d.e(0,1,0)),d.a.LookAtLHToRef(this._zeroVector,t,e,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),d.b.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},i.prototype.attach=function(t){var e=this;this._target=t,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(e._scene.activeCamera){var n=e._scene.activeCamera.position;e._scene.activeCamera.devicePosition&&(n=e._scene.activeCamera.devicePosition);var r=e._closestFace(n.subtract(t.position));e._scene.activeCamera.leftCamera?e._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix):e._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(e._tmpMatrix),d.e.TransformCoordinatesToRef(d.e.Up(),e._tmpMatrix,e._tmpVector),e._faceVectors.forEach(function(l){r.direction.x&&l.direction.x&&(l.ignore=!0),r.direction.y&&l.direction.y&&(l.ignore=!0),r.direction.z&&l.direction.z&&(l.ignore=!0)});var o=e._closestFace(e._tmpVector);e._faceVectors.forEach(function(l){l.ignore=!1}),e.ui.position.copyFrom(t.position),r.direction.x&&(r.rotatedDirection.scaleToRef(t.scaling.x/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.y&&(r.rotatedDirection.scaleToRef(t.scaling.y/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),r.direction.z&&(r.rotatedDirection.scaleToRef(t.scaling.z/2+e.distanceAwayFromFace,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)),e.ui.rotationQuaternion||(e.ui.rotationQuaternion=d.b.RotationYawPitchRoll(e.ui.rotation.y,e.ui.rotation.x,e.ui.rotation.z)),r.rotatedDirection.scaleToRef(-1,e._tmpVector),e._lookAtToRef(e._tmpVector,o.rotatedDirection,e.ui.rotationQuaternion),o.direction.x&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.x/2,e._tmpVector),o.direction.y&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.y/2,e._tmpVector),o.direction.z&&e.ui.up.scaleToRef(e.distanceAwayFromBottomOfFace-t.scaling.z/2,e._tmpVector),e.ui.position.addInPlace(e._tmpVector)}})},i.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},i}(),up=function(){function i(){var t=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(t._ownerNode){if(t._hoverValue+=t._hovered?t._millisecondsPerFrame:-t._millisecondsPerFrame,t._setAllVisibility(t._ownerNode,(t._hoverValue-t.delay)/t.fadeInTime),t._ownerNode.visibility>1)return t._setAllVisibility(t._ownerNode,1),void(t._hoverValue=t.fadeInTime+t.delay);if(t._ownerNode.visibility<0&&(t._setAllVisibility(t._ownerNode,0),t._hoverValue<0))return void(t._hoverValue=0);setTimeout(t._update,t._millisecondsPerFrame)}}}return Object.defineProperty(i.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(t){this._ownerNode=t,this._setAllVisibility(this._ownerNode,0)},i.prototype.detach=function(){this._ownerNode=null},i.prototype.fadeIn=function(t){this._hovered=t,this._update()},i.prototype._setAllVisibility=function(t,e){var n=this;t.visibility=e,t.getChildMeshes().forEach(function(r){n._setAllVisibility(r,e)})},i}(),ui=c(65),hp=function(){function i(){this._startDistance=0,this._initialScale=new d.e(0,0,0),this._targetScale=new d.e(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new ui.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new ui.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(i.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},i.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._dragBehaviorA.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorA.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(n){e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging&&(e._dragBehaviorA.currentDraggingPointerID==e._dragBehaviorB.currentDraggingPointerID?e._dragBehaviorB.releaseDrag():(e._initialScale.copyFrom(t.scaling),e._startDistance=e._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(n){n.onDragObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var r=e._getCurrentDistance()/e._startDistance;e._initialScale.scaleToRef(r,e._targetScale)}})}),t.addBehavior(this._dragBehaviorA),t.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e._dragBehaviorA.dragging&&e._dragBehaviorB.dragging){var n=e._targetScale.subtract(t.scaling).scaleInPlace(.1);n.length()>.01&&t.scaling.addInPlace(n)}})},i.prototype.detach=function(){var t=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(e){e.onDragStartObservable.clear(),e.onDragObservable.clear(),t._ownerNode.removeBehavior(e)})},i}(),Lt=c(31),Tt=c(24),vr=c(60),Vu=function(){function i(){this._sceneRenderObserver=null,this._targetPosition=new d.e(0,0,0),this._moving=!1,this._startingOrientation=new d.b,this._attachedToElement=!1,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new E.c,this.onDragObservable=new E.c,this.onDragEndObservable=new E.c}return Object.defineProperty(i.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!1,configurable:!0}),i.prototype.init=function(){},Object.defineProperty(i.prototype,"_pointerCamera",{get:function(){return this._scene.cameraToUseForPointers?this._scene.cameraToUseForPointers:this._scene.activeCamera},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;this._ownerNode=t,this._scene=this._ownerNode.getScene(),i._virtualScene||(i._virtualScene=new ne.a(this._scene.getEngine(),{virtual:!0}),i._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var n=null,r=new d.e(0,0,0);this._virtualOriginMesh=new Lt.a("",i._virtualScene),this._virtualOriginMesh.rotationQuaternion=new d.b,this._virtualDragMesh=new Lt.a("",i._virtualScene),this._virtualDragMesh.rotationQuaternion=new d.b,this._pointerObserver=this._scene.onPointerObservable.add(function(l,h){if(l.type==xt.a.POINTERDOWN){if(!e.dragging&&l.pickInfo&&l.pickInfo.hit&&l.pickInfo.pickedMesh&&l.pickInfo.ray&&(N=l.pickInfo.pickedMesh,e._ownerNode==N||N.isDescendantOf(e._ownerNode))){e._pointerCamera&&e._pointerCamera.cameraRigMode==Tt.a.RIG_MODE_NONE&&l.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),n=e._ownerNode,vr.a._RemoveAndStorePivotPoint(n),r.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.position.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(l.pickInfo.ray.origin.add(l.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),n.computeWorldMatrix(),e._virtualDragMesh.position.copyFrom(n.absolutePosition),n.rotationQuaternion||(n.rotationQuaternion=d.b.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z));var v=n.parent;n.setParent(null),e._virtualDragMesh.rotationQuaternion.copyFrom(n.rotationQuaternion),n.setParent(v),e._virtualOriginMesh.addChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),e.dragging=!0,e.currentDraggingPointerID=l.event.pointerId,e.detachCameraControls&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.inputs.attachedToElement?(e._pointerCamera.detachControl(),e._attachedToElement=!0):e._attachedToElement=!1),vr.a._RestorePivotPoint(n),e.onDragStartObservable.notifyObservers({})}}else if(l.type==xt.a.POINTERUP||l.type==xt.a.POINTERDOUBLETAP)e.currentDraggingPointerID==l.event.pointerId&&(e.dragging=!1,e._moving=!1,e.currentDraggingPointerID=-1,n=null,e._virtualOriginMesh.removeChild(e._virtualDragMesh),e.detachCameraControls&&e._attachedToElement&&e._pointerCamera&&!e._pointerCamera.leftCamera&&(e._pointerCamera.attachControl(!0),e._attachedToElement=!1),e.onDragEndObservable.notifyObservers({}));else if(l.type==xt.a.POINTERMOVE&&e.currentDraggingPointerID==l.event.pointerId&&e.dragging&&l.pickInfo&&l.pickInfo.ray&&n){var b=e.zDragFactor;e._pointerCamera&&e._pointerCamera.cameraRigMode==Tt.a.RIG_MODE_NONE&&(l.pickInfo.ray.origin.copyFrom(e._pointerCamera.globalPosition),b=0);var A=l.pickInfo.ray.origin.subtract(r);r.copyFrom(l.pickInfo.ray.origin);var D=-d.e.Dot(A,l.pickInfo.ray.direction);e._virtualOriginMesh.addChild(e._virtualDragMesh),e._virtualDragMesh.position.z-=e._virtualDragMesh.position.z<1?D*e.zDragFactor:D*b*e._virtualDragMesh.position.z,e._virtualDragMesh.position.z<0&&(e._virtualDragMesh.position.z=0),e._virtualOriginMesh.position.copyFrom(l.pickInfo.ray.origin),e._virtualOriginMesh.lookAt(l.pickInfo.ray.origin.add(l.pickInfo.ray.direction)),e._virtualOriginMesh.removeChild(e._virtualDragMesh),e._targetPosition.copyFrom(e._virtualDragMesh.absolutePosition),n.parent&&d.e.TransformCoordinatesToRef(e._targetPosition,d.a.Invert(n.parent.getWorldMatrix()),e._targetPosition),e._moving||e._startingOrientation.copyFrom(e._virtualDragMesh.rotationQuaternion),e._moving=!0}var N});var o=new d.b;this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(e.dragging&&e._moving&&n){if(vr.a._RemoveAndStorePivotPoint(n),n.position.addInPlace(e._targetPosition.subtract(n.position).scale(e.dragDeltaRatio)),e.rotateDraggedObject){o.copyFrom(e._startingOrientation),o.x=-o.x,o.y=-o.y,o.z=-o.z,e._virtualDragMesh.rotationQuaternion.multiplyToRef(o,o),d.b.RotationYawPitchRollToRef(o.toEulerAngles("xyz").y,0,0,o),o.multiplyToRef(e._startingOrientation,o);var l=n.parent;(!l||l.scaling&&!l.scaling.isNonUniformWithinEpsilon(.001))&&(n.setParent(null),d.b.SlerpToRef(n.rotationQuaternion,o,e.dragDeltaRatio,n.rotationQuaternion),n.setParent(l))}vr.a._RestorePivotPoint(n),e.onDragObservable.notifyObservers()}})},i.prototype.detach=function(){this._scene&&(this.detachCameraControls&&this._attachedToElement&&this._pointerCamera&&!this._pointerCamera.leftCamera&&(this._pointerCamera.attachControl(!0),this._attachedToElement=!1),this._scene.onPointerObservable.remove(this._pointerObserver)),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragObservable.clear(),this.onDragStartObservable.clear()},i}(),dp=function(){function i(t,e,n){if(this.targetPosition=d.e.Zero(),this.poleTargetPosition=d.e.Zero(),this.poleTargetLocalOffset=d.e.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=d.b.Identity(),this._bone1Mat=d.a.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=d.e.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=e,this._bone1=e.getParent(),this._bone1){this.mesh=t;var r=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,r.x>r.y&&r.x>r.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var o=this._bone1.getScale(),l=this._bone2.getScale();this._bone1Length=this._bone1.length*o.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*l.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var h=this._bone2.children[0].getAbsolutePosition(t),v=this._bone2.getAbsolutePosition(t),b=this._bone1.getAbsolutePosition(t);this._bone1Length=d.e.Distance(h,v),this._bone2Length=d.e.Distance(v,b)}this._bone1.getRotationMatrixToRef(Se.c.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,n&&(n.targetMesh&&(this.targetMesh=n.targetMesh,this.targetMesh.computeWorldMatrix(!0)),n.poleTargetMesh?(this.poleTargetMesh=n.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):n.poleTargetBone?this.poleTargetBone=n.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),n.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(n.poleTargetLocalOffset),n.poleAngle&&(this.poleAngle=n.poleAngle),n.bendAxis&&this._bendAxis.copyFrom(n.bendAxis),n.maxAngle&&(this.maxAngle=n.maxAngle),n.slerpAmount&&(this.slerpAmount=n.slerpAmount))}}return Object.defineProperty(i.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){this._setMaxAngle(t)},enumerable:!1,configurable:!0}),i.prototype._setMaxAngle=function(t){t<0&&(t=0),(t>Math.PI||t==null)&&(t=Math.PI),this._maxAngle=t;var e=this._bone1Length,n=this._bone2Length;this._maxReach=Math.sqrt(e*e+n*n-2*e*n*Math.cos(t))},i.prototype.update=function(){var t=this._bone1;if(t){var e=this.targetPosition,n=this.poleTargetPosition,r=i._tmpMats[0],o=i._tmpMats[1];this.targetMesh&&e.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,n):this.poleTargetMesh&&d.e.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),n);var l=i._tmpVecs[0],h=i._tmpVecs[1],v=i._tmpVecs[2],b=i._tmpVecs[3],A=i._tmpVecs[4],D=i._tmpQuat;t.getAbsolutePositionToRef(this.mesh,l),n.subtractToRef(l,A),A.x==0&&A.y==0&&A.z==0?A.y=1:A.normalize(),e.subtractToRef(l,b),b.normalize(),d.e.CrossToRef(b,A,h),h.normalize(),d.e.CrossToRef(b,h,v),v.normalize(),d.a.FromXYZAxesToRef(v,b,h,r);var N=this._bone1Length,j=this._bone2Length,k=d.e.Distance(l,e);this._maxReach>0&&(k=Math.min(this._maxReach,k));var H=(j*j+k*k-N*N)/(2*j*k),J=(k*k+N*N-j*j)/(2*k*N);H>1&&(H=1),J>1&&(J=1),H<-1&&(H=-1),J<-1&&(J=-1);var te=Math.acos(H),oe=Math.acos(J),ce=-te-oe;if(this._rightHandedSystem)d.a.RotationYawPitchRollToRef(0,0,this._adjustRoll,o),o.multiplyToRef(r,r),d.a.RotationAxisToRef(this._bendAxis,oe,o),o.multiplyToRef(r,r);else{var he=i._tmpVecs[5];he.copyFrom(this._bendAxis),he.x*=-1,d.a.RotationAxisToRef(he,-oe,o),o.multiplyToRef(r,r)}this.poleAngle&&(d.a.RotationAxisToRef(b,this.poleAngle,o),r.multiplyToRef(o,r)),this._bone1&&(this.slerpAmount<1?(this._slerping||d.b.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),d.b.FromRotationMatrixToRef(r,D),d.b.SlerpToRef(this._bone1Quat,D,this.slerpAmount,this._bone1Quat),ce=this._bone2Ang*(1-this.slerpAmount)+ce*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,Se.c.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(r,Se.c.WORLD,this.mesh),this._bone1Mat.copyFrom(r),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,ce,Se.c.LOCAL),this._bone2Ang=ce}},i._tmpVecs=[d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero(),d.e.Zero()],i._tmpQuat=d.b.Identity(),i._tmpMats=[d.a.Identity(),d.a.Identity()],i}(),fp=function(){function i(t,e,n,r){if(this.upAxis=d.e.Up(),this.upAxisSpace=Se.c.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=d.b.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=d.e.Forward(),this.mesh=t,this.bone=e,this.target=n,r&&(r.adjustYaw&&(this.adjustYaw=r.adjustYaw),r.adjustPitch&&(this.adjustPitch=r.adjustPitch),r.adjustRoll&&(this.adjustRoll=r.adjustRoll),r.maxYaw!=null?this.maxYaw=r.maxYaw:this.maxYaw=Math.PI,r.minYaw!=null?this.minYaw=r.minYaw:this.minYaw=-Math.PI,r.maxPitch!=null?this.maxPitch=r.maxPitch:this.maxPitch=Math.PI,r.minPitch!=null?this.minPitch=r.minPitch:this.minPitch=-Math.PI,r.slerpAmount!=null&&(this.slerpAmount=r.slerpAmount),r.upAxis!=null&&(this.upAxis=r.upAxis),r.upAxisSpace!=null&&(this.upAxisSpace=r.upAxisSpace),r.yawAxis!=null||r.pitchAxis!=null)){var o=Se.a.Y,l=Se.a.X;r.yawAxis!=null&&(o=r.yawAxis.clone()).normalize(),r.pitchAxis!=null&&(l=r.pitchAxis.clone()).normalize();var h=d.e.Cross(l,o);this._transformYawPitch=d.a.Identity(),d.a.FromXYZAxesToRef(l,o,h,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=Se.c.BONE||(this.upAxisSpace=Se.c.LOCAL)}return Object.defineProperty(i.prototype,"minYaw",{get:function(){return this._minYaw},set:function(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),this._maxYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),this._minYaw!=null&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPitch",{get:function(){return this._minPitch},set:function(t){this._minPitch=t,this._minPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),i.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var t=this.bone,e=i._tmpVecs[0];t.getAbsolutePositionToRef(this.mesh,e);var n=this.target,r=i._tmpMats[0],o=i._tmpMats[1],l=this.mesh,h=t.getParent(),v=i._tmpVecs[1];v.copyFrom(this.upAxis),this.upAxisSpace==Se.c.BONE&&h?(this._transformYawPitch&&d.e.TransformCoordinatesToRef(v,this._transformYawPitchInv,v),h.getDirectionToRef(v,this.mesh,v)):this.upAxisSpace==Se.c.LOCAL&&(l.getDirectionToRef(v,v),l.scaling.x==1&&l.scaling.y==1&&l.scaling.z==1||v.normalize());var b=!1,A=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(b=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(A=!0),b||A){var D=i._tmpMats[2],N=i._tmpMats[3];if(this.upAxisSpace==Se.c.BONE&&v.y==1&&h)h.getRotationMatrixToRef(Se.c.WORLD,this.mesh,D);else if(this.upAxisSpace!=Se.c.LOCAL||v.y!=1||h){(k=i._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&d.e.TransformCoordinatesToRef(k,this._transformYawPitchInv,k),h?h.getDirectionToRef(k,this.mesh,k):l.getDirectionToRef(k,k);var j=d.e.Cross(v,k);j.normalize();var k=d.e.Cross(j,v);d.a.FromXYZAxesToRef(j,v,k,D)}else D.copyFrom(l.getWorldMatrix());D.invertToRef(N);var H=null;if(A){var J=i._tmpVecs[3];n.subtractToRef(e,J),d.e.TransformCoordinatesToRef(J,N,J),H=Math.sqrt(J.x*J.x+J.z*J.z);var te=Math.atan2(J.y,H),oe=te;te>this._maxPitch?(J.y=this._maxPitchTan*H,oe=this._maxPitch):te<this._minPitch&&(J.y=this._minPitchTan*H,oe=this._minPitch),te!=oe&&(d.e.TransformCoordinatesToRef(J,D,J),J.addInPlace(e),n=J)}if(b){J=i._tmpVecs[4],n.subtractToRef(e,J),d.e.TransformCoordinatesToRef(J,N,J);var ce=Math.atan2(J.x,J.z),he=ce;if((ce>this._maxYaw||ce<this._minYaw)&&(H==null&&(H=Math.sqrt(J.x*J.x+J.z*J.z)),this._yawRange>Math.PI?this._isAngleBetween(ce,this._maxYaw,this._midYawConstraint)?(J.z=this._maxYawCos*H,J.x=this._maxYawSin*H,he=this._maxYaw):this._isAngleBetween(ce,this._midYawConstraint,this._minYaw)&&(J.z=this._minYawCos*H,J.x=this._minYawSin*H,he=this._minYaw):ce>this._maxYaw?(J.z=this._maxYawCos*H,J.x=this._maxYawSin*H,he=this._maxYaw):ce<this._minYaw&&(J.z=this._minYawCos*H,J.x=this._minYawSin*H,he=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var _e=i._tmpVecs[8];_e.copyFrom(Se.a.Z),this._transformYawPitch&&d.e.TransformCoordinatesToRef(_e,this._transformYawPitchInv,_e);var ye=i._tmpMats[4];this._boneQuat.toRotationMatrix(ye),this.mesh.getWorldMatrix().multiplyToRef(ye,ye),d.e.TransformCoordinatesToRef(_e,ye,_e),d.e.TransformCoordinatesToRef(_e,N,_e);var Ee=Math.atan2(_e.x,_e.z);if(this._getAngleBetween(Ee,ce)>this._getAngleBetween(Ee,this._midYawConstraint)){H==null&&(H=Math.sqrt(J.x*J.x+J.z*J.z));var Oe=this._getAngleBetween(Ee,this._maxYaw);this._getAngleBetween(Ee,this._minYaw)<Oe?(he=Ee+.75*Math.PI,J.z=Math.cos(he)*H,J.x=Math.sin(he)*H):(he=Ee-.75*Math.PI,J.z=Math.cos(he)*H,J.x=Math.sin(he)*H)}}ce!=he&&(d.e.TransformCoordinatesToRef(J,D,J),J.addInPlace(e),n=J)}}var Ae=i._tmpVecs[5],xe=i._tmpVecs[6],Pe=i._tmpVecs[7],Be=i._tmpQuat;n.subtractToRef(e,Ae),Ae.normalize(),d.e.CrossToRef(v,Ae,xe),xe.normalize(),d.e.CrossToRef(Ae,xe,Pe),Pe.normalize(),d.a.FromXYZAxesToRef(xe,Pe,Ae,r),xe.x===0&&xe.y===0&&xe.z===0||Pe.x===0&&Pe.y===0&&Pe.z===0||Ae.x===0&&Ae.y===0&&Ae.z===0||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(d.a.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,o),o.multiplyToRef(r,r)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(Se.c.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),d.b.FromRotationMatrixToRef(r,Be),d.b.SlerpToRef(this._boneQuat,Be,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,Se.c.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),this.bone.setRotationMatrix(r,Se.c.WORLD,this.mesh),this._slerping=!1))}},i.prototype._getAngleDiff=function(t,e){var n=e-t;return(n%=2*Math.PI)>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),n},i.prototype._getAngleBetween=function(t,e){var n=0;return(n=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},i.prototype._isAngleBetween=function(t,e,n){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(n=(n%=2*Math.PI)<0?n+2*Math.PI:n)){if(t>e&&t<n)return!0}else if(t>n&&t<e)return!0;return!1},i._tmpVecs=we.a.BuildArray(10,d.e.Zero),i._tmpQuat=d.b.Identity(),i._tmpMats=we.a.BuildArray(5,d.a.Identity),i}(),Ve=c(10),Mt=c(27),Xt=c(26);function _a(i,t,e,n){var r;r=n===g.a.TEXTURETYPE_FLOAT?new Float32Array(t*e*4):new Uint32Array(t*e*4);for(var o=0;o<t;o++)for(var l=0;l<e;l++){var h=3*(l*t+o),v=4*(l*t+o);r[v+0]=i[h+0],r[v+1]=i[h+1],r[v+2]=i[h+2],r[v+3]=1}return r}function ns(i){return function(t,e,n,r,o,l,h,v,b,A){b===void 0&&(b=null),A===void 0&&(A=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,N=i?Mt.b.Raw3D:Mt.b.Raw2DArray,j=new Mt.a(this,N);j.baseWidth=e,j.baseHeight=n,j.baseDepth=r,j.width=e,j.height=n,j.depth=r,j.format=o,j.type=A,j.generateMipMaps=l,j.samplingMode=v,i?j.is3D=!0:j.is2DArray=!0,this._doNotHandleContextLost||(j._bufferView=t),i?this.updateRawTexture3D(j,t,o,h,b,A):this.updateRawTexture2DArray(j,t,o,h,b,A),this._bindTextureDirectly(D,j,!0);var k=this._getSamplingParameters(v,l);return this._gl.texParameteri(D,this._gl.TEXTURE_MAG_FILTER,k.mag),this._gl.texParameteri(D,this._gl.TEXTURE_MIN_FILTER,k.min),l&&this._gl.generateMipmap(D),this._bindTextureDirectly(D,null),this._internalTexturesCache.push(j),j}}function ku(i){return function(t,e,n,r,o,l){o===void 0&&(o=null),l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT);var h=i?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,v=this._getWebGLTextureType(l),b=this._getInternalFormat(n),A=this._getRGBABufferInternalSizedFormat(l,n);this._bindTextureDirectly(h,t,!0),this._unpackFlipY(r===void 0||!!r),this._doNotHandleContextLost||(t._bufferView=e,t.format=n,t.invertY=r,t._compression=o),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&e?this._gl.compressedTexImage3D(h,0,this.getCaps().s3tc[o],t.width,t.height,t.depth,0,e):this._gl.texImage3D(h,0,A,t.width,t.height,t.depth,0,b,v,e),t.generateMipMaps&&this._gl.generateMipmap(h),this._bindTextureDirectly(h,null),t.isReady=!0}}Xt.a.prototype.updateRawTexture=function(i,t,e,n,r,o){if(r===void 0&&(r=null),o===void 0&&(o=g.a.TEXTURETYPE_UNSIGNED_INT),i){var l=this._getRGBABufferInternalSizedFormat(o,e),h=this._getInternalFormat(e),v=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0),this._unpackFlipY(n===void 0||!!n),this._doNotHandleContextLost||(i._bufferView=t,i.format=e,i.type=o,i.invertY=n,i._compression=r),i.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],i.width,i.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,i.width,i.height,0,h,v,t),i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}},Xt.a.prototype.createRawTexture=function(i,t,e,n,r,o,l,h,v){h===void 0&&(h=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var b=new Mt.a(this,Mt.b.Raw);b.baseWidth=t,b.baseHeight=e,b.width=t,b.height=e,b.format=n,b.generateMipMaps=r,b.samplingMode=l,b.invertY=o,b._compression=h,b.type=v,this._doNotHandleContextLost||(b._bufferView=i),this.updateRawTexture(b,i,n,o,h,v),this._bindTextureDirectly(this._gl.TEXTURE_2D,b,!0);var A=this._getSamplingParameters(l,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,A.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,A.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(b),b},Xt.a.prototype.createRawCubeTexture=function(i,t,e,n,r,o,l,h){h===void 0&&(h=null);var v=this._gl,b=new Mt.a(this,Mt.b.CubeRaw);b.isCube=!0,b.format=e,b.type=n,this._doNotHandleContextLost||(b._bufferViewArray=i);var A=this._getWebGLTextureType(n),D=this._getInternalFormat(e);D===v.RGB&&(D=v.RGBA),A!==v.FLOAT||this._caps.textureFloatLinearFiltering?A!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?A!==v.FLOAT||this._caps.textureFloatRender?A!==v.HALF_FLOAT||this._caps.colorBufferFloat||(r=!1,p.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(r=!1,p.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(r=!1,l=g.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(r=!1,l=g.a.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var N=t,j=N;b.width=N,b.height=j,!this.needPOTTextures||Qe.b.IsExponentOfTwo(b.width)&&Qe.b.IsExponentOfTwo(b.height)||(r=!1),i&&this.updateRawCubeTexture(b,i,e,n,o,h),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,b,!0),i&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var k=this._getSamplingParameters(l,r);return v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,k.mag),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,k.min),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null),b.generateMipMaps=r,b},Xt.a.prototype.updateRawCubeTexture=function(i,t,e,n,r,o,l){o===void 0&&(o=null),l===void 0&&(l=0),i._bufferViewArray=t,i.format=e,i.type=n,i.invertY=r,i._compression=o;var h=this._gl,v=this._getWebGLTextureType(n),b=this._getInternalFormat(e),A=this._getRGBABufferInternalSizedFormat(n),D=!1;b===h.RGB&&(b=h.RGBA,D=!0),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,i,!0),this._unpackFlipY(r===void 0||!!r),i.width%4!=0&&h.pixelStorei(h.UNPACK_ALIGNMENT,1);for(var N=0;N<6;N++){var j=t[N];o?h.compressedTexImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+N,l,this.getCaps().s3tc[o],i.width,i.height,0,j):(D&&(j=_a(j,i.width,i.height,n)),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+N,l,A,i.width,i.height,0,b,v,j))}(!this.needPOTTextures||Qe.b.IsExponentOfTwo(i.width)&&Qe.b.IsExponentOfTwo(i.height))&&i.generateMipMaps&&l===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),i.isReady=!0},Xt.a.prototype.createRawCubeTextureFromUrl=function(i,t,e,n,r,o,l,h,v,b,A,D){var N=this;v===void 0&&(v=null),b===void 0&&(b=null),A===void 0&&(A=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=!1);var j=this._gl,k=this.createRawCubeTexture(null,e,n,r,!o,D,A,null);return t==null||t._addPendingData(k),k.url=i,this._internalTexturesCache.push(k),this._loadFile(i,function(H){(function(J){var te=k.width,oe=l(J);if(oe){if(h){var ce=N._getWebGLTextureType(r),he=N._getInternalFormat(n),_e=N._getRGBABufferInternalSizedFormat(r),ye=!1;he===j.RGB&&(he=j.RGBA,ye=!0),N._bindTextureDirectly(j.TEXTURE_CUBE_MAP,k,!0),N._unpackFlipY(!1);for(var Ee=h(oe),Oe=0;Oe<Ee.length;Oe++)for(var Ae=te>>Oe,xe=0;xe<6;xe++){var Pe=Ee[Oe][xe];ye&&(Pe=_a(Pe,Ae,Ae,r)),j.texImage2D(xe,Oe,_e,Ae,Ae,0,he,ce,Pe)}N._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)}else N.updateRawCubeTexture(k,oe,n,r,D);k.isReady=!0,t==null||t._removePendingData(k),v&&v()}})(H)},void 0,t==null?void 0:t.offlineProvider,!0,function(H,J){t==null||t._removePendingData(k),b&&H&&b(H.status+" "+H.statusText,J)}),k},Xt.a.prototype.createRawTexture2DArray=ns(!1),Xt.a.prototype.createRawTexture3D=ns(!0),Xt.a.prototype.updateRawTexture2DArray=ku(!1),Xt.a.prototype.updateRawTexture3D=ku(!0);var hr=function(i){function t(e,n,r,o,l,h,v,b,A){h===void 0&&(h=!0),v===void 0&&(v=!1),b===void 0&&(b=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),A===void 0&&(A=g.a.TEXTURETYPE_UNSIGNED_INT);var D=i.call(this,null,l,!h,v)||this;return D.format=o,D._engine&&(D._texture=D._engine.createRawTexture(e,n,r,o,h,v,b,null,A),D.wrapU=Ve.a.CLAMP_ADDRESSMODE,D.wrapV=Ve.a.CLAMP_ADDRESSMODE),D}return Object(_.d)(t,i),t.prototype.update=function(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(e,n,r,o,l,h,v){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE,o,l,h,v)},t.CreateLuminanceAlphaTexture=function(e,n,r,o,l,h,v){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_LUMINANCE_ALPHA,o,l,h,v)},t.CreateAlphaTexture=function(e,n,r,o,l,h,v){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,g.a.TEXTUREFORMAT_ALPHA,o,l,h,v)},t.CreateRGBTexture=function(e,n,r,o,l,h,v,b){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGB,o,l,h,v,b)},t.CreateRGBATexture=function(e,n,r,o,l,h,v,b){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,g.a.TEXTUREFORMAT_RGBA,o,l,h,v,b)},t.CreateRTexture=function(e,n,r,o,l,h,v,b){return l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=Ve.a.TRILINEAR_SAMPLINGMODE),b===void 0&&(b=g.a.TEXTURETYPE_FLOAT),new t(e,n,r,g.a.TEXTUREFORMAT_R,o,l,h,v,b)},t}(Ve.a),ga=function(){function i(t,e,n){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=d.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._waitingOverrideMeshId=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new E.c,this.bones=[],this._scene=n||$.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}return Object.defineProperty(i.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Skeleton"},i.prototype.getChildren=function(){return this.bones.filter(function(t){return!t.getParent()})},i.prototype.getTransformMatrices=function(t){return this.needInitialSkinMatrix&&t._bonesTransformMatrices?t._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},i.prototype.getTransformMatrixTexture=function(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture},i.prototype.getScene=function(){return this._scene},i.prototype.toString=function(t){var e="Name: "+this.name+", nBones: "+this.bones.length;if(e+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(e+=", ",n=!1),e+=r;e+="}"}return e},i.prototype.getBoneIndexByName=function(t){for(var e=0,n=this.bones.length;e<n;e++)if(this.bones[e].name===t)return e;return-1},i.prototype.createAnimationRange=function(t,e,n){if(!this._ranges[t]){this._ranges[t]=new K(t,e,n);for(var r=0,o=this.bones.length;r<o;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(t,e,n)}},i.prototype.deleteAnimationRange=function(t,e){e===void 0&&(e=!0);for(var n=0,r=this.bones.length;n<r;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(t,e);this._ranges[t]=null},i.prototype.getAnimationRange=function(t){return this._ranges[t]||null},i.prototype.getAnimationRanges=function(){var t,e=[];for(t in this._ranges)e.push(this._ranges[t]);return e},i.prototype.copyAnimationRange=function(t,e,n){if(n===void 0&&(n=!1),this._ranges[e]||!t.getAnimationRange(e))return!1;var r,o,l=!0,h=this._getHighestAnimationFrame()+1,v={},b=t.bones;for(o=0,r=b.length;o<r;o++)v[b[o].name]=b[o];this.bones.length!==b.length&&(p.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+b.length),l=!1);var A=n&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(o=0,r=this.bones.length;o<r;o++){var D=this.bones[o].name,N=v[D];N?l=l&&this.bones[o].copyAnimationRange(N,e,h,n,A):(p.a.Warn("copyAnimationRange: not same rig, missing source bone "+D),l=!1)}var j=t.getAnimationRange(e);return j&&(this._ranges[e]=new K(e,j.from+h,j.to+h)),l},i.prototype.returnToRest=function(){for(var t=d.c.Vector3[0],e=d.c.Quaternion[0],n=d.c.Vector3[1],r=0;r<this.bones.length;r++){var o=this.bones[r];o._index!==-1&&(o.returnToRest(),o._linkedTransformNode&&(o.getRestPose().decompose(t,e,n),o._linkedTransformNode.position=n.clone(),o._linkedTransformNode.rotationQuaternion=e.clone(),o._linkedTransformNode.scaling=t.clone()))}},i.prototype._getHighestAnimationFrame=function(){for(var t=0,e=0,n=this.bones.length;e<n;e++)if(this.bones[e].animations[0]){var r=this.bones[e].animations[0].getHighestFrame();t<r&&(t=r)}return t},i.prototype.beginAnimation=function(t,e,n,r){var o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,n,r):null},i.MakeAnimationAdditive=function(t,e,n){e===void 0&&(e=0);var r=t.getAnimationRange(n);if(!r)return null;for(var o=t._scene.getAllAnimatablesByTarget(t),l=null,h=0;h<o.length;h++){var v=o[h];if(v.fromFrame===(r==null?void 0:r.from)&&v.toFrame===(r==null?void 0:r.to)){l=v;break}}var b=t.getAnimatables();for(h=0;h<b.length;h++){var A=b[h].animations;if(A)for(var D=0;D<A.length;D++)W.MakeAnimationAdditive(A[D],e,n)}return l&&(l.isAdditive=!0),t},i.prototype._markAsDirty=function(){this._isDirty=!0},i.prototype._registerMeshWithPoseMatrix=function(t){this._meshesWithPoseMatrix.push(t)},i.prototype._unregisterMeshWithPoseMatrix=function(t){var e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)},i.prototype._computeTransformMatrices=function(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var r=this.bones[n];r._childUpdateId++;var o=r.getParent();if(o?r.getLocalMatrix().multiplyToRef(o.getWorldMatrix(),r.getWorldMatrix()):e?r.getLocalMatrix().multiplyToRef(e,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),r._index!==-1){var l=r._index===null?n:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),t,16*l)}}this._identity.copyToArray(t,16*this.bones.length)},i.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];n._linkedTransformNode&&(n._linkedTransformNode.computeWorldMatrix(),n._matrix=n._linkedTransformNode._localMatrix,n.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var o=this._meshesWithPoseMatrix[r],l=o.getPoseMatrix();if(o._bonesTransformMatrices&&o._bonesTransformMatrices.length===16*(this.bones.length+1)||(o._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==o){this._synchronizedWithMesh=o;for(var h=0;h<this.bones.length;h++){var v=this.bones[h];v.getParent()||(v.getBaseMatrix().multiplyToRef(l,d.c.Matrix[1]),v._updateDifferenceMatrix(d.c.Matrix[1]))}if(this.isUsingTextureForMatrices){var b=4*(this.bones.length+1);o._transformMatrixTexture&&o._transformMatrixTexture.getSize().width===b||(o._transformMatrixTexture&&o._transformMatrixTexture.dispose(),o._transformMatrixTexture=hr.CreateRGBATexture(o._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))}}this._computeTransformMatrices(o._bonesTransformMatrices,l),this.isUsingTextureForMatrices&&o._transformMatrixTexture&&o._transformMatrixTexture.update(o._bonesTransformMatrices)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=hr.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},i.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables},i.prototype.clone=function(t,e){var n=new i(t,e||t,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMesh=this.overrideMesh;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],l=null,h=o.getParent();if(h){var v=this.bones.indexOf(h);l=n.bones[v]}var b=new Ge(o.name,n,l,o.getBaseMatrix().clone(),o.getRestPose().clone());b._index=o._index,o._linkedTransformNode&&b.linkTransformNode(o._linkedTransformNode),fe.a.DeepCopy(o.animations,b.animations)}if(this._ranges)for(var A in n._ranges={},this._ranges){var D=this._ranges[A];D&&(n._ranges[A]=D.clone())}return this._isDirty=!0,n},i.prototype.enableBlending=function(t){t===void 0&&(t=.01),this.bones.forEach(function(e){e.animations.forEach(function(n){n.enableBlending=!0,n.blendingSpeed=t})})},i.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},i.prototype.serialize=function(){var t,e,n={};n.name=this.name,n.id=this.id,this.dimensionsAtRest&&(n.dimensionsAtRest=this.dimensionsAtRest.asArray()),n.bones=[],n.needInitialSkinMatrix=this.needInitialSkinMatrix,n.overrideMeshId=(t=this.overrideMesh)===null||t===void 0?void 0:t.id;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],l=o.getParent(),h={parentBoneIndex:l?this.bones.indexOf(l):-1,index:o.getIndex(),name:o.name,matrix:o.getBaseMatrix().toArray(),rest:o.getRestPose().toArray(),linkedTransformNodeId:(e=o.getTransformNode())===null||e===void 0?void 0:e.id};for(var v in n.bones.push(h),o.length&&(h.length=o.length),o.metadata&&(h.metadata=o.metadata),o.animations&&o.animations.length>0&&(h.animation=o.animations[0].serialize()),n.ranges=[],this._ranges){var b=this._ranges[v];if(b){var A={};A.name=v,A.from=b.from,A.to=b.to,n.ranges.push(A)}}}return n},i.Parse=function(t,e){var n,r=new i(t.name,t.id,e);for(t.dimensionsAtRest&&(r.dimensionsAtRest=d.e.FromArray(t.dimensionsAtRest)),r.needInitialSkinMatrix=t.needInitialSkinMatrix,t.overrideMeshId&&(r._hasWaitingData=!0,r._waitingOverrideMeshId=t.overrideMeshId),n=0;n<t.bones.length;n++){var o=t.bones[n],l=t.bones[n].index,h=null;o.parentBoneIndex>-1&&(h=r.bones[o.parentBoneIndex]);var v=o.rest?d.a.FromArray(o.rest):null,b=new Ge(o.name,r,h,d.a.FromArray(o.matrix),v,null,l);o.id!==void 0&&o.id!==null&&(b.id=o.id),o.length&&(b.length=o.length),o.metadata&&(b.metadata=o.metadata),o.animation&&b.animations.push(W.Parse(o.animation)),o.linkedTransformNodeId!==void 0&&o.linkedTransformNodeId!==null&&(r._hasWaitingData=!0,b._waitingTransformNodeId=o.linkedTransformNodeId)}if(t.ranges)for(n=0;n<t.ranges.length;n++){var A=t.ranges[n];r.createAnimationRange(A.name,A.from,A.to)}return r},i.prototype.computeAbsoluteTransforms=function(t){t===void 0&&(t=!1);var e=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=e||t)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=e)},i.prototype.getPoseMatrix=function(){var t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t},i.prototype.sortBones=function(){for(var t=new Array,e=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,t,e);this.bones=t},i.prototype._sortBones=function(t,e,n){if(!n[t]){n[t]=!0;var r=this.bones[t];r._index===void 0&&(r._index=t);var o=r.getParent();o&&this._sortBones(this.bones.indexOf(o),e,n),e.push(r)}},i.prototype.setCurrentPoseAsRest=function(){this.bones.forEach(function(t){t.setCurrentPoseAsRest()})},i}(),Fn={},va=function(){function i(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return i.prototype.add=function(t){var e=t.getSimpleName();this.attached[e]?p.a.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl())},i.prototype.remove=function(t){for(var e in this.attached){var n=this.attached[e];n===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype.removeByType=function(t){for(var e in this.attached){var n=this.attached[e];n.getClassName()===t&&(n.detachControl(),n.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},i.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},i.prototype.attachElement=function(t){if(t===void 0&&(t=!1),!this.attachedToElement)for(var e in t=!Tt.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t,this.attached)this.attached[e].attachControl(t)},i.prototype.detachElement=function(t){for(var e in t===void 0&&(t=!1),this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},i.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},i.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},i.prototype.serialize=function(t){var e={};for(var n in this.attached){var r=this.attached[n],o=V.a.Serialize(r);e[r.getClassName()]=o}t.inputsmgr=e},i.prototype.parse=function(t){var e=t.inputsmgr;if(e){for(var n in this.clear(),e)if(l=Fn[n]){var r=e[n],o=V.a.Parse(function(){return new l},r,null);this.add(o)}}else for(var n in this.attached){var l;(l=Fn[this.attached[n].getClassName()])&&(o=V.a.Parse(function(){return new l},t,null),this.remove(this.attached[n]),this.add(o))}},i}(),pp=function(i,t){this.x=i,this.y=t},Mn=function(){function i(t,e,n,r,o,l,h){r===void 0&&(r=0),o===void 0&&(o=1),l===void 0&&(l=2),h===void 0&&(h=3),this.id=t,this.index=e,this.browserGamepad=n,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=i.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=o,this._rightStickAxisX=l,this._rightStickAxisY=h,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0}),i.prototype.onleftstickchanged=function(t){this._onleftstickchanged=t},i.prototype.onrightstickchanged=function(t){this._onrightstickchanged=t},Object.defineProperty(i.prototype,"leftStick",{get:function(){return this._leftStick},set:function(t){!this._onleftstickchanged||this._leftStick.x===t.x&&this._leftStick.y===t.y||this._onleftstickchanged(t),this._leftStick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightStick",{get:function(){return this._rightStick},set:function(t){!this._onrightstickchanged||this._rightStick.x===t.x&&this._rightStick.y===t.y||this._onrightstickchanged(t),this._rightStick=t},enumerable:!1,configurable:!0}),i.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},i.prototype.dispose=function(){},i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,i.DUALSHOCK=4,i}(),ju=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.onButtonDownObservable=new E.c,o.onButtonUpObservable=new E.c,o.type=Mn.GENERIC,o._buttons=new Array(r.buttons.length),o}return Object(_.d)(t,i),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(Mn),Ic=function(){function i(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==Mn.POSE_ENABLED&&(t.gamepad&&n.type!==Mn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(Mn.XBOX)},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(e.x!=0){var n=e.x/this.gamepadRotationSensibility;n!=0&&Math.abs(n)>.005&&(t.inertialAlphaOffset+=n)}if(e.y!=0){var r=e.y/this.gamepadRotationSensibility*this._yAxisScale;r!=0&&Math.abs(r)>.005&&(t.inertialBetaOffset+=r)}}var o=this.gamepad.leftStick;if(o&&o.y!=0){var l=o.y/this.gamepadMoveSensibility;l!=0&&Math.abs(l)>.005&&(this.camera.inertialRadiusOffset-=l)}}},i.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(_.c)([Object(V.c)()],i.prototype,"gamepadRotationSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Fn.ArcRotateCameraGamepadInput=Ic;var Qi=c(66),Dc=function(){function i(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Qi.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,(e.keysUp.indexOf(o.keyCode)!==-1||e.keysDown.indexOf(o.keyCode)!==-1||e.keysLeft.indexOf(o.keyCode)!==-1||e.keysRight.indexOf(o.keyCode)!==-1||e.keysReset.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysReset.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e];this.keysLeft.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(n)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(n)!==-1&&t.useInputToRestoreState&&t.restoreState()}},i.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},Object(_.c)([Object(V.c)()],i.prototype,"keysUp",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysDown",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysLeft",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRight",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysReset",void 0),Object(_.c)([Object(V.c)()],i.prototype,"panningSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"zoomingSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"useAltToZoom",void 0),Object(_.c)([Object(V.c)()],i.prototype,"angularSpeed",void 0),i}();Fn.ArcRotateCameraKeyboardMoveInput=Dc;var wc=function(){function i(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.computeDeltaFromMouseWheelLegacyEvent=function(t,e){var n=.01*t*this.wheelDeltaPercentage*e;return t>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)},i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===xt.a.POINTERWHEEL){var o=n.event,l=0,h=o,v=0;if(v=h.wheelDelta?h.wheelDelta:60*-(o.deltaY||o.detail),e.wheelDeltaPercentage){if((l=e.computeDeltaFromMouseWheelLegacyEvent(v,e.camera.radius))>0){for(var b=e.camera.radius,A=e.camera.inertialRadiusOffset+l,D=0;D<20&&Math.abs(A)>.001;D++)b-=A,A*=e.camera.inertia;b=se.a.Clamp(b,0,Number.MAX_VALUE),l=e.computeDeltaFromMouseWheelLegacyEvent(v,b)}}else l=v/(40*e.wheelPrecision);l&&(e.camera.inertialRadiusOffset+=l),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,xt.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(_.c)([Object(V.c)()],i.prototype,"wheelPrecision",void 0),Object(_.c)([Object(V.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Fn.ArcRotateCameraMouseWheelInput=wc;var zu=function(){function i(){this.buttons=[0,1,2]}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement(),o=0,l=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(v,b){var A=v.event,D=A.pointerType==="touch";if(!n.isInVRExclusivePointerMode&&(v.type===xt.a.POINTERMOVE||e.buttons.indexOf(A.button)!==-1)){var N=A.srcElement||A.target;if(e._altKey=A.altKey,e._ctrlKey=A.ctrlKey,e._metaKey=A.metaKey,e._shiftKey=A.shiftKey,e._buttonsPressed=A.buttons,n.isPointerLock){var j=A.movementX||A.mozMovementX||A.webkitMovementX||A.msMovementX||0,k=A.movementY||A.mozMovementY||A.webkitMovementY||A.msMovementY||0;e.onTouch(null,j,k),e.pointA=null,e.pointB=null}else if(v.type===xt.a.POINTERDOWN&&N){try{N.setPointerCapture(A.pointerId)}catch(he){}e.pointA===null?e.pointA={x:A.clientX,y:A.clientY,pointerId:A.pointerId,type:A.pointerType}:e.pointB===null&&(e.pointB={x:A.clientX,y:A.clientY,pointerId:A.pointerId,type:A.pointerType}),e.onButtonDown(A),t||(A.preventDefault(),r&&r.focus())}else if(v.type===xt.a.POINTERDOUBLETAP)e.onDoubleTap(A.pointerType);else if(v.type===xt.a.POINTERUP&&N){try{N.releasePointerCapture(A.pointerId)}catch(he){}D||(e.pointB=null),n._badOS?e.pointA=e.pointB=null:e.pointB&&e.pointA&&e.pointA.pointerId==A.pointerId?(e.pointA=e.pointB,e.pointB=null):e.pointA&&e.pointB&&e.pointB.pointerId==A.pointerId?e.pointB=null:e.pointA=e.pointB=null,(o!==0||l)&&(e.onMultiTouch(e.pointA,e.pointB,o,0,l,null),o=0,l=null),e.onButtonUp(A),t||A.preventDefault()}else if(v.type===xt.a.POINTERMOVE){if(t||A.preventDefault(),e.pointA&&e.pointB===null)j=A.clientX-e.pointA.x,k=A.clientY-e.pointA.y,e.onTouch(e.pointA,j,k),e.pointA.x=A.clientX,e.pointA.y=A.clientY;else if(e.pointA&&e.pointB){var H=e.pointA.pointerId===A.pointerId?e.pointA:e.pointB;H.x=A.clientX,H.y=A.clientY;var J=e.pointA.x-e.pointB.x,te=e.pointA.y-e.pointB.y,oe=J*J+te*te,ce={x:(e.pointA.x+e.pointB.x)/2,y:(e.pointA.y+e.pointB.y)/2,pointerId:A.pointerId,type:v.type};e.onMultiTouch(e.pointA,e.pointB,o,oe,l,ce),l=ce,o=oe}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,xt.a.POINTERDOWN|xt.a.POINTERUP|xt.a.POINTERMOVE),this._onLostFocus=function(){e.pointA=e.pointB=null,o=0,l=null,e.onLostFocus()},r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var h=this.camera.getScene().getEngine().getHostWindow();h&&Qe.b.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])},i.prototype.detachControl=function(t){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&Qe.b.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var n=this.camera.getScene().getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},i.prototype.getClassName=function(){return"BaseCameraPointersInput"},i.prototype.getSimpleName=function(){return"pointers"},i.prototype.onDoubleTap=function(t){},i.prototype.onTouch=function(t,e,n){},i.prototype.onMultiTouch=function(t,e,n,r,o,l){},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.onButtonDown=function(t){},i.prototype.onButtonUp=function(t){},i.prototype.onLostFocus=function(){},Object(_.c)([Object(V.c)()],i.prototype,"buttons",void 0),i}(),Lc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=r/this.panningSensibility):(this.camera.inertialAlphaOffset-=n/this.angularSensibilityX,this.camera.inertialBetaOffset-=r/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,n,r,o,l,h){if(!(r===0&&l===null||o===0&&h===null)){var v=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(r)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this.panningSensibility!==0&&l&&h){var b=h.x-l.x,A=h.y-l.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}else{this._twoFingerActivityCount++;var D=Math.sqrt(r),N=Math.sqrt(o);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(N-D)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-r)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-r)/(this.pinchPrecision*v*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):this.panningSensibility!==0&&this.multiTouchPanning&&h&&l&&(b=h.x-l.x,A=h.y-l.y,this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility)}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(_.c)([Object(V.c)()],t.prototype,"buttons",void 0),Object(_.c)([Object(V.c)()],t.prototype,"angularSensibilityX",void 0),Object(_.c)([Object(V.c)()],t.prototype,"angularSensibilityY",void 0),Object(_.c)([Object(V.c)()],t.prototype,"pinchPrecision",void 0),Object(_.c)([Object(V.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(_.c)([Object(V.c)()],t.prototype,"useNaturalPinchZoom",void 0),Object(_.c)([Object(V.c)()],t.prototype,"panningSensibility",void 0),Object(_.c)([Object(V.c)()],t.prototype,"multiTouchPanning",void 0),Object(_.c)([Object(V.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(zu);Fn.ArcRotateCameraPointersInput=Lc;var rs=function(i){function t(e){return i.call(this,e)||this}return Object(_.d)(t,i),t.prototype.addMouseWheel=function(){return this.add(new wc),this},t.prototype.addPointers=function(){return this.add(new Lc),this},t.prototype.addKeyboard=function(){return this.add(new Dc),this},t}(va);rs.prototype.addVRDeviceOrientation=function(){return this.add(new Nc),this};var Nc=function(){function i(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);var n=this.camera.getScene().getEngine().getHostWindow();n&&(typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n.addEventListener("deviceorientation",e._deviceOrientationHandler):Qe.b.Warn("Permission not granted.")}).catch(function(r){Qe.b.Error(r)}):n.addEventListener("deviceorientation",this._deviceOrientationHandler))},i.prototype._onOrientationEvent=function(t){t.alpha!==null&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),t.gamma!==null&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},i.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},i.prototype.detachControl=function(t){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},i.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"VRDeviceOrientation"},i}();Fn.ArcRotateCameraVRDeviceOrientationInput=Nc;var Fc=function(){function i(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;n.type===Qi.a.KEYDOWN?e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysForward.indexOf(o.keyCode)===-1&&e.keysBackward.indexOf(o.keyCode)===-1&&e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault())}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},i.prototype._onLostFocus=function(t){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysForward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysBackward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,-r,0):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysLeft.indexOf(n)!==-1&&t._localDirection.copyFromFloats(-r,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),d.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},Object(_.c)([Object(V.c)()],i.prototype,"keysForward",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysBackward",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysUp",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysDown",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRight",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysLeft",void 0),i}();Fn.FlyCameraKeyboardInput=Fc;var Oo=function(){function i(t){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this.noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(n,r){e._pointerInput(n,r)},xt.a.POINTERDOWN|xt.a.POINTERUP|xt.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){e.camera.rollCorrect&&e.camera.restoreRoll(e.camera.rollCorrect)})},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},i.prototype.getClassName=function(){return"FlyCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},i.prototype._pointerInput=function(t,e){var n=t.event,r=this.camera.getEngine();if(!r.isInVRExclusivePointerMode&&(this.touchEnabled||n.pointerType!=="touch")&&(t.type===xt.a.POINTERMOVE||this.buttons.indexOf(n.button)!==-1)){var o=n.srcElement||n.target;if(t.type===xt.a.POINTERDOWN&&o){try{o.setPointerCapture(n.pointerId)}catch(v){}this.previousPosition={x:n.clientX,y:n.clientY},this.activeButton=n.button,this.noPreventDefault||(n.preventDefault(),this.element.focus()),r.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===xt.a.POINTERUP&&o){try{o.releasePointerCapture(n.pointerId)}catch(v){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||n.preventDefault()}else if(t.type===xt.a.POINTERMOVE){if(!this.previousPosition)return void(r.isPointerLock&&this._onMouseMove(t.event));var l=n.clientX-this.previousPosition.x,h=n.clientY-this.previousPosition.y;this.rotateCamera(l,h),this.previousPosition={x:n.clientX,y:n.clientY},this.noPreventDefault||n.preventDefault()}}},i.prototype._onMouseMove=function(t){var e=this.camera.getEngine();if(e.isPointerLock&&!e.isInVRExclusivePointerMode){var n=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,r=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this.rotateCamera(n,r),this.previousPosition=null,this.noPreventDefault||t.preventDefault()}},i.prototype.rotateCamera=function(t,e){var n=this,r=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),r.parent&&r.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var o,l=t/this.angularSensibility,h=e/this.angularSensibility,v=d.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z);if(this.buttonsPitch.some(function(D){return D===n.activeButton})&&(o=d.b.RotationAxis(Se.a.X,h),v.multiplyInPlace(o)),this.buttonsYaw.some(function(D){return D===n.activeButton})){o=d.b.RotationAxis(Se.a.Y,l),v.multiplyInPlace(o);var b=r.bankedTurnLimit+r._trackRoll;if(r.bankedTurn&&-b<r.rotation.z&&r.rotation.z<b){var A=r.bankedTurnMultiplier*-l;o=d.b.RotationAxis(Se.a.Z,A),v.multiplyInPlace(o)}}this.buttonsRoll.some(function(D){return D===n.activeButton})&&(o=d.b.RotationAxis(Se.a.Z,-l),r._trackRoll-=l,v.multiplyInPlace(o)),v.toEulerAnglesToRef(r.rotation)},Object(_.c)([Object(V.c)()],i.prototype,"buttons",void 0),Object(_.c)([Object(V.c)()],i.prototype,"angularSensibility",void 0),i}();Fn.FlyCameraMouseInput=Oo;var ba=function(){function i(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Qi.a.KEYDOWN?(e._ctrlPressed=o.ctrlKey,e._altPressed=o.altKey,e._shiftPressed=o.shiftKey,(e.keysHeightOffsetIncr.indexOf(o.keyCode)!==-1||e.keysHeightOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetIncr.indexOf(o.keyCode)!==-1||e.keysRotationOffsetDecr.indexOf(o.keyCode)!==-1||e.keysRadiusIncr.indexOf(o.keyCode)!==-1||e.keysRadiusDecr.indexOf(o.keyCode)!==-1)&&((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),o.preventDefault&&(t||o.preventDefault()))):e.keysHeightOffsetIncr.indexOf(o.keyCode)===-1&&e.keysHeightOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetIncr.indexOf(o.keyCode)===-1&&e.keysRotationOffsetDecr.indexOf(o.keyCode)===-1&&e.keysRadiusIncr.indexOf(o.keyCode)===-1&&e.keysRadiusDecr.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),o.preventDefault&&(t||o.preventDefault())))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){var t=this;this._onKeyboardObserver&&this._keys.forEach(function(e){t.keysHeightOffsetIncr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset+=t.heightSensibility:t.keysHeightOffsetDecr.indexOf(e)!==-1&&t._modifierHeightOffset()?t.camera.heightOffset-=t.heightSensibility:t.keysRotationOffsetIncr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset+=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRotationOffsetDecr.indexOf(e)!==-1&&t._modifierRotationOffset()?(t.camera.rotationOffset-=t.rotationSensibility,t.camera.rotationOffset%=360):t.keysRadiusIncr.indexOf(e)!==-1&&t._modifierRadius()?t.camera.radius+=t.radiusSensibility:t.keysRadiusDecr.indexOf(e)!==-1&&t._modifierRadius()&&(t.camera.radius-=t.radiusSensibility)})},i.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},i.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},i.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},i.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},Object(_.c)([Object(V.c)()],i.prototype,"keysHeightOffsetIncr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysHeightOffsetDecr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysHeightOffsetModifierAlt",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysHeightOffsetModifierCtrl",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysHeightOffsetModifierShift",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRotationOffsetIncr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRotationOffsetDecr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRotationOffsetModifierAlt",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRotationOffsetModifierCtrl",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRotationOffsetModifierShift",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRadiusIncr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRadiusDecr",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRadiusModifierAlt",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRadiusModifierCtrl",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRadiusModifierShift",void 0),Object(_.c)([Object(V.c)()],i.prototype,"heightSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"rotationSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"radiusSensibility",void 0),i}();Fn.FollowCameraKeyboardMoveInput=ba;var Bc=function(){function i(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n,r){if(n.type===xt.a.POINTERWHEEL){var o=n.event,l=0,h=Math.max(-1,Math.min(1,o.deltaY||o.wheelDelta||-o.detail));e.wheelDeltaPercentage?(console.assert(e.axisControlRadius+e.axisControlHeight+e.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+e.axisControlRadius+", axisControlHeightOffset: "+e.axisControlHeight+", axisControlRotationOffset: "+e.axisControlRotation),e.axisControlRadius?l=.01*h*e.wheelDeltaPercentage*e.camera.radius:e.axisControlHeight?l=.01*h*e.wheelDeltaPercentage*e.camera.heightOffset:e.axisControlRotation&&(l=.01*h*e.wheelDeltaPercentage*e.camera.rotationOffset)):l=h*e.wheelPrecision,l&&(e.axisControlRadius?e.camera.radius+=l:e.axisControlHeight?e.camera.heightOffset-=l:e.axisControlRotation&&(e.camera.rotationOffset-=l)),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,xt.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},i.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(_.c)([Object(V.c)()],i.prototype,"axisControlRadius",void 0),Object(_.c)([Object(V.c)()],i.prototype,"axisControlHeight",void 0),Object(_.c)([Object(V.c)()],i.prototype,"axisControlRotation",void 0),Object(_.c)([Object(V.c)()],i.prototype,"wheelPrecision",void 0),Object(_.c)([Object(V.c)()],i.prototype,"wheelDeltaPercentage",void 0),i}();Fn.FollowCameraMouseWheelInput=Bc;var Uc=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.angularSensibilityX=1,e.angularSensibilityY=1,e.pinchPrecision=1e4,e.pinchDeltaPercentage=0,e.axisXControlRadius=!1,e.axisXControlHeight=!1,e.axisXControlRotation=!0,e.axisYControlRadius=!1,e.axisYControlHeight=!0,e.axisYControlRotation=!1,e.axisPinchControlRadius=!0,e.axisPinchControlHeight=!1,e.axisPinchControlRotation=!1,e.warningEnable=!0,e._warningCounter=0,e}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,n,r){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=n/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=r/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=n/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=r/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=n/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=r/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,n,r,o,l,h){if(!(r===0&&l===null||o===0&&h===null)){var v=(o-r)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(v*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=v*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=v*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=v*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=v),this.axisPinchControlHeight&&(this.camera.heightOffset+=v),this.axisPinchControlRadius&&(this.camera.radius-=v))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},Object(_.c)([Object(V.c)()],t.prototype,"angularSensibilityX",void 0),Object(_.c)([Object(V.c)()],t.prototype,"angularSensibilityY",void 0),Object(_.c)([Object(V.c)()],t.prototype,"pinchPrecision",void 0),Object(_.c)([Object(V.c)()],t.prototype,"pinchDeltaPercentage",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisXControlRadius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisXControlHeight",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisXControlRotation",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisYControlRadius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisYControlHeight",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisYControlRotation",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisPinchControlRadius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisPinchControlHeight",void 0),Object(_.c)([Object(V.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(zu);Fn.FollowCameraPointersInput=Uc;var is=function(){function i(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var r,o=n.event;o.metaKey||(n.type===Qi.a.KEYDOWN?e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))===-1&&e._keys.push(o.keyCode),t||o.preventDefault()):e.keysUp.indexOf(o.keyCode)===-1&&e.keysDown.indexOf(o.keyCode)===-1&&e.keysLeft.indexOf(o.keyCode)===-1&&e.keysRight.indexOf(o.keyCode)===-1&&e.keysUpward.indexOf(o.keyCode)===-1&&e.keysDownward.indexOf(o.keyCode)===-1||((r=e._keys.indexOf(o.keyCode))>=0&&e._keys.splice(r,1),t||o.preventDefault()))}))},i.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var n=this._keys[e],r=t._computeLocalCameraSpeed();this.keysLeft.indexOf(n)!==-1?t._localDirection.copyFromFloats(-r,0,0):this.keysUp.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,r):this.keysRight.indexOf(n)!==-1?t._localDirection.copyFromFloats(r,0,0):this.keysDown.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,0,-r):this.keysUpward.indexOf(n)!==-1?t._localDirection.copyFromFloats(0,r,0):this.keysDownward.indexOf(n)!==-1&&t._localDirection.copyFromFloats(0,-r,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),d.e.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},i.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},i.prototype._onLostFocus=function(){this._keys=[]},i.prototype.getSimpleName=function(){return"keyboard"},Object(_.c)([Object(V.c)()],i.prototype,"keysUp",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysUpward",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysDown",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysDownward",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysLeft",void 0),Object(_.c)([Object(V.c)()],i.prototype,"keysRight",void 0),i}();Fn.FreeCameraKeyboardMoveInput=is;var Vc=function(){function i(t){t===void 0&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new E.c,this._allowCameraRotation=!0}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments);var n=this.camera.getEngine(),r=n.getInputElement();this._pointerInput||(this._pointerInput=function(o){var l=o.event;if(!n.isInVRExclusivePointerMode&&(e.touchEnabled||l.pointerType!=="touch")&&(o.type===xt.a.POINTERMOVE||e.buttons.indexOf(l.button)!==-1)){var h=l.srcElement||l.target;if(o.type===xt.a.POINTERDOWN&&h){try{h.setPointerCapture(l.pointerId)}catch(A){}e.previousPosition={x:l.clientX,y:l.clientY},t||(l.preventDefault(),r&&r.focus()),n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event)}else if(o.type===xt.a.POINTERUP&&h){try{h.releasePointerCapture(l.pointerId)}catch(A){}e.previousPosition=null,t||l.preventDefault()}else if(o.type===xt.a.POINTERMOVE){if(!e.previousPosition)return void(n.isPointerLock&&e._onMouseMove&&e._onMouseMove(o.event));var v=l.clientX-e.previousPosition.x,b=l.clientY-e.previousPosition.y;e.camera.getScene().useRightHandedSystem&&(v*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(v*=-1),e._allowCameraRotation&&(e.camera.cameraRotation.y+=v/e.angularSensibility,e.camera.cameraRotation.x+=b/e.angularSensibility),e.onPointerMovedObservable.notifyObservers({offsetX:v,offsetY:b}),e.previousPosition={x:l.clientX,y:l.clientY},t||l.preventDefault()}}}),this._onMouseMove=function(o){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var l=o.movementX||o.mozMovementX||o.webkitMovementX||o.msMovementX||0;e.camera.getScene().useRightHandedSystem&&(l*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(l*=-1),e.camera.cameraRotation.y+=l/e.angularSensibility;var h=o.movementY||o.mozMovementY||o.webkitMovementY||o.msMovementY||0;e.camera.cameraRotation.x+=h/e.angularSensibility,e.previousPosition=null,t||o.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,xt.a.POINTERDOWN|xt.a.POINTERUP|xt.a.POINTERMOVE),r&&r.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.detachControl=function(t){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this.onContextMenu){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this.onContextMenu)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null}},i.prototype.getClassName=function(){return"FreeCameraMouseInput"},i.prototype.getSimpleName=function(){return"mouse"},Object(_.c)([Object(V.c)()],i.prototype,"buttons",void 0),Object(_.c)([Object(V.c)()],i.prototype,"angularSensibility",void 0),i}();Fn.FreeCameraMouseInput=Vc;var Kt,mp=function(){function i(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new E.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(n){if(n.type===xt.a.POINTERWHEEL){var r=n.event,o=r.deltaMode===WheelEvent.DOM_DELTA_LINE?e._ffMultiplier:1;r.deltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.deltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.deltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.deltaZ/e._normalize):r.wheelDeltaY!==void 0?(e._wheelDeltaX+=e.wheelPrecisionX*o*r.wheelDeltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*o*r.wheelDeltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*o*r.wheelDeltaZ/e._normalize):r.wheelDelta&&(e._wheelDeltaY-=e.wheelPrecisionY*r.wheelDelta/e._normalize),r.preventDefault&&(t||r.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,xt.a.POINTERWHEEL)},i.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},i.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},i.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},i.prototype.getSimpleName=function(){return"mousewheel"},Object(_.c)([Object(V.c)()],i.prototype,"wheelPrecisionX",void 0),Object(_.c)([Object(V.c)()],i.prototype,"wheelPrecisionY",void 0),Object(_.c)([Object(V.c)()],i.prototype,"wheelPrecisionZ",void 0),i}();(function(i){i[i.MoveRelative=0]="MoveRelative",i[i.RotateRelative=1]="RotateRelative",i[i.MoveScene=2]="MoveScene"})(Kt||(Kt={}));var os=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._moveRelative=d.e.Zero(),e._rotateRelative=d.e.Zero(),e._moveScene=d.e.Zero(),e._wheelXAction=Kt.MoveRelative,e._wheelXActionCoordinate=Se.b.X,e._wheelYAction=Kt.MoveRelative,e._wheelYActionCoordinate=Se.b.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(t.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==Kt.MoveRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==Kt.MoveRelative||(this._wheelXAction=Kt.MoveRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==Kt.MoveRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==Kt.MoveRelative||(this._wheelYAction=Kt.MoveRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==Kt.MoveRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==Kt.MoveRelative||(this._wheelZAction=Kt.MoveRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==Kt.RotateRelative?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==Kt.RotateRelative||(this._wheelXAction=Kt.RotateRelative,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==Kt.RotateRelative?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==Kt.RotateRelative||(this._wheelYAction=Kt.RotateRelative,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==Kt.RotateRelative?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==Kt.RotateRelative||(this._wheelZAction=Kt.RotateRelative,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==Kt.MoveScene?null:this._wheelXActionCoordinate},set:function(e){e===null&&this._wheelXAction!==Kt.MoveScene||(this._wheelXAction=Kt.MoveScene,this._wheelXActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==Kt.MoveScene?null:this._wheelYActionCoordinate},set:function(e){e===null&&this._wheelYAction!==Kt.MoveScene||(this._wheelYAction=Kt.MoveScene,this._wheelYActionCoordinate=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==Kt.MoveScene?null:this._wheelZActionCoordinate},set:function(e){e===null&&this._wheelZAction!==Kt.MoveScene||(this._wheelZAction=Kt.MoveScene,this._wheelZActionCoordinate=e)},enumerable:!1,configurable:!0}),t.prototype.checkInputs=function(){if(this._wheelDeltaX!==0||this._wheelDeltaY!==0||this._wheelDeltaZ!=0){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=d.a.Zero();this.camera.getViewMatrix().invertToRef(e);var n=d.e.Zero();d.e.TransformNormalToRef(this._moveRelative,e,n),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(n),this.camera.cameraDirection.addInPlace(this._moveScene),i.prototype.checkInputs.call(this)}},t.prototype._updateCamera=function(){var e=this._moveRelative,n=this._rotateRelative,r=this._moveScene,o=function(l,h,v){if(l!==0&&h!==null&&v!==null){var b=null;switch(h){case Kt.MoveRelative:b=e;break;case Kt.RotateRelative:b=n;break;case Kt.MoveScene:b=r}switch(v){case Se.b.X:b.set(l,0,0);break;case Se.b.Y:b.set(0,l,0);break;case Se.b.Z:b.set(0,0,l)}}};o(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),o(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),o(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},Object(_.c)([Object(V.c)()],t.prototype,"wheelXMoveRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelYMoveRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelZMoveRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelXRotateRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelYRotateRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelZRotateRelative",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelXMoveScene",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelYMoveScene",null),Object(_.c)([Object(V.c)()],t.prototype,"wheelZMoveScene",null),t}(mp);Fn.FreeCameraMouseWheelInput=os;var kc=function(){function i(t){t===void 0&&(t=!1),this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return i.prototype.attachControl=function(t){var e=this;t=Qe.b.BackCompatCameraNoPreventDefault(arguments);var n=null;if(this._pointerInput===void 0&&(this._onLostFocus=function(){e._offsetX=null,e._offsetY=null},this._pointerInput=function(l){var h=l.event,v=!e.camera.getEngine().hostInformation.isMobile&&h instanceof MouseEvent;if(e.allowMouse||h.pointerType!=="mouse"&&!v){if(l.type===xt.a.POINTERDOWN){if(t||h.preventDefault(),e._pointerPressed.push(h.pointerId),e._pointerPressed.length!==1)return;n={x:h.clientX,y:h.clientY}}else if(l.type===xt.a.POINTERUP){if(t||h.preventDefault(),(b=e._pointerPressed.indexOf(h.pointerId))===-1||(e._pointerPressed.splice(b,1),b!=0))return;n=null,e._offsetX=null,e._offsetY=null}else if(l.type===xt.a.POINTERMOVE){if(t||h.preventDefault(),!n)return;var b;if((b=e._pointerPressed.indexOf(h.pointerId))!=0)return;e._offsetX=h.clientX-n.x,e._offsetY=-(h.clientY-n.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,xt.a.POINTERDOWN|xt.a.POINTERUP|xt.a.POINTERMOVE),this._onLostFocus){var r=this.camera.getEngine(),o=r.getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}},i.prototype.detachControl=function(t){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var e=this.camera.getEngine().getInputElement();e&&e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},i.prototype.checkInputs=function(){if(this._offsetX!==null&&this._offsetY!==null&&(this._offsetX!==0||this._offsetY!==0)){var t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var e=t._computeLocalCameraSpeed(),n=new d.e(0,0,e*this._offsetY/this.touchMoveSensibility);d.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(d.e.TransformCoordinates(n,t._cameraRotationMatrix))}}},i.prototype.getClassName=function(){return"FreeCameraTouchInput"},i.prototype.getSimpleName=function(){return"touch"},Object(_.c)([Object(V.c)()],i.prototype,"touchAngularSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"touchMoveSensibility",void 0),i}();Fn.FreeCameraTouchInput=kc;var ya=function(i){function t(e){var n=i.call(this,e)||this;return n._mouseInput=null,n._mouseWheelInput=null,n}return Object(_.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new is),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this._mouseInput||(this._mouseInput=new Vc(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new os,this.add(this._mouseWheelInput)),this},t.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},t.prototype.addTouch=function(){return this.add(new kc),this},t.prototype.clear=function(){i.prototype.clear.call(this),this._mouseInput=null},t}(va);ya.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new jc,this.add(this._deviceOrientationInput)),this};var jc=function(){function i(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new d.b,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new E.c,this._orientationChanged=function(){t._screenOrientationAngle=window.orientation!==void 0?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-Qe.b.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=e.alpha!==null?e.alpha:0,t._beta=e.beta!==null?e.beta:0,t._gamma=e.gamma!==null?e.gamma:0,e.alpha!==null&&t._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new d.b(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return i.WaitForOrientationChangeAsync=function(t){return new Promise(function(e,n){var r=!1,o=function(){window.removeEventListener("deviceorientation",o),r=!0,e()};t&&setTimeout(function(){r||(window.removeEventListener("deviceorientation",o),n("WaitForOrientationChangeAsync timed out"))},t),typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(l){l=="granted"?window.addEventListener("deviceorientation",o):Qe.b.Warn("Permission not granted.")}).catch(function(l){Qe.b.Error(l)}):window.addEventListener("deviceorientation",o)})},Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},set:function(t){var e=this;this._camera=t,this._camera==null||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new d.b),this._camera&&this._camera.onDisposeObservable.add(function(){e._onDeviceOrientationChangedObservable.clear()})},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().getEngine().getHostWindow();if(e){var n=function(){e.addEventListener("orientationchange",t._orientationChanged),e.addEventListener("deviceorientation",t._deviceOrientation),t._orientationChanged()};typeof DeviceOrientationEvent!="undefined"&&typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(function(r){r==="granted"?n():Qe.b.Warn("Permission not granted.")}).catch(function(r){Qe.b.Error(r)}):n()}},i.prototype.detachControl=function(t){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},i.prototype.checkInputs=function(){this._alpha&&(d.b.RotationYawPitchRollToRef(Qe.b.ToRadians(this._alpha),Qe.b.ToRadians(this._beta),-Qe.b.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},i.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},i.prototype.getSimpleName=function(){return"deviceOrientation"},i}();Fn.FreeCameraDeviceOrientationInput=jc;var Ta=function(){function i(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._yAxisScale=1,this._cameraTransform=d.a.Identity(),this._deltaTransform=d.e.Zero(),this._vector3=d.e.Zero(),this._vector2=d.d.Zero()}return Object.defineProperty(i.prototype,"invertYAxis",{get:function(){return this._yAxisScale!==1},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),i.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add(function(n){n.type!==Mn.POSE_ENABLED&&(t.gamepad&&n.type!==Mn.XBOX||(t.gamepad=n))}),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add(function(n){t.gamepad===n&&(t.gamepad=null)}),this.gamepad=e.getGamepadByType(Mn.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])},i.prototype.detachControl=function(t){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},i.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick,n=e.x/this.gamepadMoveSensibility,r=e.y/this.gamepadMoveSensibility;e.x=Math.abs(n)>.005?0+n:0,e.y=Math.abs(r)>.005?0+r:0;var o=this.gamepad.rightStick;if(o){var l=o.x/this.gamepadAngularSensibility,h=o.y/this.gamepadAngularSensibility*this._yAxisScale;o.x=Math.abs(l)>.001?0+l:0,o.y=Math.abs(h)>.001?0+h:0}else o={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):d.a.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var v=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*v,0,-e.y*v),d.e.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(o.y,o.x),t.cameraRotation.addInPlace(this._vector2)}},i.prototype.getClassName=function(){return"FreeCameraGamepadInput"},i.prototype.getSimpleName=function(){return"gamepad"},Object(_.c)([Object(V.c)()],i.prototype,"gamepadAngularSensibility",void 0),Object(_.c)([Object(V.c)()],i.prototype,"gamepadMoveSensibility",void 0),i}();Fn.FreeCameraGamepadInput=Ta;var xn,Gu=c(112);(function(i){i[i.X=0]="X",i[i.Y=1]="Y",i[i.Z=2]="Z"})(xn||(xn={}));var zc=function(){function i(t,e){var n=this,r=Object(_.a)(Object(_.a)({},i._GetDefaultOptions()),e);if(this._leftJoystick=!!t,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=xn.X,this._axisTargetedByUpAndDown=xn.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new Gu.a,this.deltaPosition=d.e.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(l){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas&&(i.Canvas.width=i.vjCanvasWidth,i.Canvas.height=i.vjCanvasHeight),i.halfWidth=i.vjCanvasWidth/2},!i.Canvas){window.addEventListener("resize",this._onResize,!1),i.Canvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.Canvas.width=window.innerWidth,i.Canvas.height=window.innerHeight,i.Canvas.style.width="100%",i.Canvas.style.height="100%",i.Canvas.style.position="absolute",i.Canvas.style.backgroundColor="transparent",i.Canvas.style.top="0px",i.Canvas.style.left="0px",i.Canvas.style.zIndex="5",i.Canvas.style.msTouchAction="none",i.Canvas.style.touchAction="none",i.Canvas.setAttribute("touch-action","none");var o=i.Canvas.getContext("2d");if(!o)throw new Error("Unable to create canvas for virtual joystick");i.vjCanvasContext=o,i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.Canvas)}i.halfWidth=i.Canvas.width/2,this.pressed=!1,this.limitToContainer=r.limitToContainer,this._joystickColor=r.color,this.containerSize=r.containerSize,this.puckSize=r.puckSize,r.position&&this.setPosition(r.position.x,r.position.y),r.puckImage&&this.setPuckImage(r.puckImage),r.containerImage&&this.setContainerImage(r.containerImage),r.alwaysVisible&&i._alwaysVisibleSticks++,this.alwaysVisible=r.alwaysVisible,this._joystickPointerID=-1,this._joystickPointerPos=new d.d(0,0),this._joystickPreviousPointerPos=new d.d(0,0),this._joystickPointerStartPos=new d.d(0,0),this._deltaJoystickVector=new d.d(0,0),this._onPointerDownHandlerRef=function(l){n._onPointerDown(l)},this._onPointerMoveHandlerRef=function(l){n._onPointerMove(l)},this._onPointerUpHandlerRef=function(l){n._onPointerUp(l)},i.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.Canvas.addEventListener("contextmenu",function(l){l.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return i._GetDefaultOptions=function(){return{puckSize:40,containerSize:60,color:"cyan",puckImage:void 0,containerImage:void 0,position:void 0,alwaysVisible:!1,limitToContainer:!1}},i.prototype.setJoystickSensibility=function(t){this._joystickSensibility=t,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(t){t.preventDefault(),(this._leftJoystick===!0?t.clientX<i.halfWidth:t.clientX>i.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPosition?(this._joystickPointerStartPos=this._joystickPosition.clone(),this._joystickPointerPos=this._joystickPosition.clone(),this._joystickPreviousPointerPos=this._joystickPosition.clone(),this._onPointerMove(t)):(this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone()),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},i.prototype._onPointerMove=function(t){if(this._joystickPointerID==t.pointerId){if(this.limitToContainer){var e=new d.d(t.clientX-this._joystickPointerStartPos.x,t.clientY-this._joystickPointerStartPos.y),n=e.length();n>this.containerSize&&e.scaleInPlace(this.containerSize/n),this._joystickPointerPos.x=this._joystickPointerStartPos.x+e.x,this._joystickPointerPos.y=this._joystickPointerStartPos.y+e.y}else this._joystickPointerPos.x=t.clientX,this._joystickPointerPos.y=t.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos),0<i._alwaysVisibleSticks&&(this._leftJoystick?this._joystickPointerPos.x=Math.min(i.halfWidth,this._joystickPointerPos.x):this._joystickPointerPos.x=Math.max(i.halfWidth,this._joystickPointerPos.x));var r=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case xn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case xn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case xn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}var o=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case xn.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case xn.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case xn.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var l=this._touches.get(t.pointerId.toString());l&&(l.x=t.clientX,l.y=t.clientY)}},i.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)this._clearPreviousDraw(),this._joystickPointerID=-1,this.pressed=!1;else{var e=this._touches.get(t.pointerId.toString());e&&i.vjCanvasContext.clearRect(e.prevX-44,e.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},i.prototype.setJoystickColor=function(t){this._joystickColor=t},Object.defineProperty(i.prototype,"containerSize",{get:function(){return this._joystickContainerSize},set:function(t){this._joystickContainerSize=t,this._clearContainerSize=~~(2.1*this._joystickContainerSize),this._clearContainerSizeOffset=~~(this._clearContainerSize/2)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"puckSize",{get:function(){return this._joystickPuckSize},set:function(t){this._joystickPuckSize=t,this._clearPuckSize=~~(2.1*this._joystickPuckSize),this._clearPuckSizeOffset=~~(this._clearPuckSize/2)},enumerable:!1,configurable:!0}),i.prototype.clearPosition=function(){this.alwaysVisible=!1,this._joystickPosition=null},Object.defineProperty(i.prototype,"alwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible!==t&&(t&&this._joystickPosition?(i._alwaysVisibleSticks++,this._alwaysVisible=!0):(i._alwaysVisibleSticks--,this._alwaysVisible=!1))},enumerable:!1,configurable:!0}),i.prototype.setPosition=function(t,e){this._joystickPointerStartPos&&this._clearPreviousDraw(),this._joystickPosition=new d.d(t,e)},i.prototype.setActionOnTouch=function(t){this._action=t},i.prototype.setAxisForLeftRight=function(t){switch(t){case xn.X:case xn.Y:case xn.Z:this._axisTargetedByLeftAndRight=t;break;default:this._axisTargetedByLeftAndRight=xn.X}},i.prototype.setAxisForUpDown=function(t){switch(t){case xn.X:case xn.Y:case xn.Z:this._axisTargetedByUpAndDown=t;break;default:this._axisTargetedByUpAndDown=xn.Y}},i.prototype._clearPreviousDraw=function(){var t=this._joystickPosition||this._joystickPointerStartPos;i.vjCanvasContext.clearRect(t.x-this._clearContainerSizeOffset,t.y-this._clearContainerSizeOffset,this._clearContainerSize,this._clearContainerSize),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-this._clearPuckSizeOffset,this._joystickPreviousPointerPos.y-this._clearPuckSizeOffset,this._clearPuckSize,this._clearPuckSize)},i.prototype.setContainerImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._containerImage=n}},i.prototype.setPuckImage=function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e._puckImage=n}},i.prototype._drawContainer=function(){var t=this._joystickPosition||this._joystickPointerStartPos;this._clearPreviousDraw(),this._containerImage?i.vjCanvasContext.drawImage(this._containerImage,t.x-this.containerSize,t.y-this.containerSize,2*this.containerSize,2*this.containerSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(t.x,t.y,this.containerSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.arc(t.x,t.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawPuck=function(){this._puckImage?i.vjCanvasContext.drawImage(this._puckImage,this._joystickPointerPos.x-this.puckSize,this._joystickPointerPos.y-this.puckSize,2*this.puckSize,2*this.puckSize):(i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=this._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(this._joystickPointerPos.x,this._joystickPointerPos.y,this.puckSize,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath())},i.prototype._drawVirtualJoystick=function(){var t=this;this.alwaysVisible&&this._drawContainer(),this.pressed&&this._touches.forEach(function(e,n){n.pointerId===t._joystickPointerID?(t.alwaysVisible||t._drawContainer(),t._drawPuck(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(n.x,n.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),n.prevX=n.x,n.prevY=n.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},i.prototype.releaseCanvas=function(){i.Canvas&&(i.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.Canvas),i.Canvas=null)},i._globalJoystickIndex=0,i._alwaysVisibleSticks=0,i}();ya.prototype.addVirtualJoystick=function(){return this.add(new Mo),this};var Mo=function(){function i(){}return i.prototype.getLeftJoystick=function(){return this._leftjoystick},i.prototype.getRightJoystick=function(){return this._rightjoystick},i.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=50*t._computeLocalCameraSpeed(),n=d.a.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),r=d.e.TransformCoordinates(new d.e(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),n);t.cameraDirection=t.cameraDirection.add(r),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},i.prototype.attachControl=function(){this._leftjoystick=new zc(!0),this._leftjoystick.setAxisForUpDown(xn.Z),this._leftjoystick.setAxisForLeftRight(xn.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new zc(!1),this._rightjoystick.setAxisForUpDown(xn.X),this._rightjoystick.setAxisForLeftRight(xn.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},i.prototype.detachControl=function(t){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},i.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},i.prototype.getSimpleName=function(){return"virtualJoystick"},i}();Fn.FreeCameraVirtualJoystickInput=Mo;var Gt=c(28),Zr=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l._tmpUpVector=d.e.Zero(),l._tmpTargetVector=d.e.Zero(),l.cameraDirection=new d.e(0,0,0),l.cameraRotation=new d.d(0,0),l.ignoreParentScaling=!1,l.updateUpVectorFromRotation=!1,l._tmpQuaternion=new d.b,l.rotation=new d.e(0,0,0),l.speed=2,l.noRotationConstraint=!1,l.invertRotation=!1,l.inverseRotationSpeed=.2,l.lockedTarget=null,l._currentTarget=d.e.Zero(),l._initialFocalDistance=1,l._viewMatrix=d.a.Zero(),l._camMatrix=d.a.Zero(),l._cameraTransformMatrix=d.a.Zero(),l._cameraRotationMatrix=d.a.Zero(),l._referencePoint=new d.e(0,0,1),l._transformedReferencePoint=d.e.Zero(),l._defaultUp=d.e.Up(),l._cachedRotationZ=0,l._cachedQuaternionRotationZ=0,l}return Object(_.d)(t,i),t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var n=this.getTarget().subtract(this.position);return n.normalize(),n.scaleInPlace(e),this.globalPosition.add(n)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.lockedTarget=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new d.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this);var n=this._getLockedTargetPosition();n?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(n):this._cache.lockedTarget=n.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!i.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=Gt.a),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),d.a.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var n=e.subtract(this.position);n.x>=0?this.rotation.y=-Math.atan(n.z/n.x)+Math.PI/2:this.rotation.y=-Math.atan(n.z/n.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(t.prototype,"target",{get:function(){return this.getTarget()},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(d.c.Matrix[0]),d.e.TransformNormalToRef(this.cameraDirection,d.c.Matrix[0],d.c.Vector3[0]),void this.position.addInPlace(d.c.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,n=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;n&&this._updatePosition(),r&&(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint&&(this.rotation.x>1.570796&&(this.rotation.x=1.570796),this.rotation.x<-1.570796&&(this.rotation.x=-1.570796)),this.rotationQuaternion&&this.rotation.lengthSquared()&&d.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)),n&&(Math.abs(this.cameraDirection.x)<this.speed*Gt.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*Gt.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*Gt.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*Gt.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*Gt.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),i.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):d.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return d.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),d.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Se.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(d.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Se.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,n,r){if(this.ignoreParentScaling){if(this.parent){var o=this.parent.getWorldMatrix();d.e.TransformCoordinatesToRef(e,o,this._globalPosition),d.e.TransformCoordinatesToRef(n,o,this._tmpTargetVector),d.e.TransformNormalToRef(r,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(n),this._tmpUpVector.copyFrom(r);this.getScene().useRightHandedSystem?d.a.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):d.a.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else this.getScene().useRightHandedSystem?d.a.LookAtRHToRef(e,n,r,this._viewMatrix):d.a.LookAtLHToRef(e,n,r,this._viewMatrix),this.parent?(o=this.parent.getWorldMatrix(),this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(e)},t.prototype.createRigCamera=function(e,n){if(this.cameraRigMode!==Tt.a.RIG_MODE_NONE){var r=new t(e,this.position.clone(),this.getScene());return r.isRigCamera=!0,r.rigParent=this,this.cameraRigMode!==Tt.a.RIG_MODE_VR&&this.cameraRigMode!==Tt.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new d.b),r._cameraRigParams={},r.rotationQuaternion=new d.b),r}return null},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Tt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var r=this.cameraRigMode===Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,n);break;case Tt.a.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),n.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),n.position.copyFrom(this.position)}i.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,n){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var r=t._TargetFocalPoint.addInPlace(this.position);d.a.TranslationToRef(-r.x,-r.y,-r.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(d.a.RotationAxis(n.upVector,e),t._RigCamTransformMatrix),d.a.TranslationToRef(r.x,r.y,r.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),d.e.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,n.position),n.setTarget(r)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new d.a,t._TargetTransformMatrix=new d.a,t._TargetFocalPoint=new d.e,Object(_.c)([Object(V.o)()],t.prototype,"rotation",void 0),Object(_.c)([Object(V.c)()],t.prototype,"speed",void 0),Object(_.c)([Object(V.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Tt.a),dr=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l.ellipsoid=new d.e(.5,1,.5),l.ellipsoidOffset=new d.e(0,0,0),l.checkCollisions=!1,l.applyGravity=!1,l._needMoveForGravity=!1,l._oldPosition=d.e.Zero(),l._diffPosition=d.e.Zero(),l._newPosition=d.e.Zero(),l._collisionMask=-1,l._onCollisionPositionChange=function(h,v,b){b===void 0&&(b=null);var A;A=v,l._newPosition.copyFrom(A),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>Xe.a.CollisionsEpsilon&&(l.position.addInPlace(l._diffPosition),l.onCollide&&b&&l.onCollide(b))},l.inputs=new ya(l),l.inputs.addKeyboard().addMouse(),l}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUpward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUpward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUpward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDownward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDownward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDownward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=Qe.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(e){this.inputs.detachElement(),this.cameraDirection=new d.e(0,0,0),this.cameraRotation=new d.d(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?d.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},Object(_.c)([Object(V.o)()],t.prototype,"ellipsoid",void 0),Object(_.c)([Object(V.o)()],t.prototype,"ellipsoidOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"checkCollisions",void 0),Object(_.c)([Object(V.c)()],t.prototype,"applyGravity",void 0),t}(Zr);Z.a.AddNodeConstructor("TouchCamera",function(i,t){return function(){return new Gc(i,d.e.Zero(),t)}});var Gc=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addTouch(),o._setupInputs(),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var n=this.inputs.attached.touch;n&&(n.touchMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.touch,n=this.inputs.attached.mouse;n?n.touchEnabled=!1:e.allowMouse=!0},t}(dr);Z.a.AddNodeConstructor("ArcRotateCamera",function(i,t){return function(){return new Mi(i,0,0,1,d.e.Zero(),t)}});var Mi=function(i){function t(e,n,r,o,l,h,v){v===void 0&&(v=!0);var b=i.call(this,e,d.e.Zero(),h,v)||this;return b.inertialAlphaOffset=0,b.inertialBetaOffset=0,b.inertialRadiusOffset=0,b.lowerAlphaLimit=null,b.upperAlphaLimit=null,b.lowerBetaLimit=.01,b.upperBetaLimit=Math.PI-.01,b.lowerRadiusLimit=null,b.upperRadiusLimit=null,b.inertialPanningX=0,b.inertialPanningY=0,b.pinchToPanMaxDistance=20,b.panningDistanceLimit=null,b.panningOriginTarget=d.e.Zero(),b.panningInertia=.9,b.zoomOnFactor=1,b.targetScreenOffset=d.d.Zero(),b.allowUpsideDown=!0,b.useInputToRestoreState=!0,b._viewMatrix=new d.a,b.panningAxis=new d.e(1,1,0),b.onMeshTargetChangedObservable=new E.c,b.checkCollisions=!1,b.collisionRadius=new d.e(.5,.5,.5),b._previousPosition=d.e.Zero(),b._collisionVelocity=d.e.Zero(),b._newPosition=d.e.Zero(),b._computationVector=d.e.Zero(),b._onCollisionPositionChange=function(A,D,N){N===void 0&&(N=null),N?(b.setPosition(D),b.onCollide&&b.onCollide(N)):b._previousPosition.copyFrom(b._position);var j=Math.cos(b.alpha),k=Math.sin(b.alpha),H=Math.cos(b.beta),J=Math.sin(b.beta);J===0&&(J=1e-4);var te=b._getTargetPosition();b._computationVector.copyFromFloats(b.radius*j*J,b.radius*H,b.radius*k*J),te.addToRef(b._computationVector,b._newPosition),b._position.copyFrom(b._newPosition);var oe=b.upVector;b.allowUpsideDown&&b.beta<0&&(oe=(oe=oe.clone()).negate()),b._computeViewMatrix(b._position,te,oe),b._viewMatrix.addAtIndex(12,b.targetScreenOffset.x),b._viewMatrix.addAtIndex(13,b.targetScreenOffset.y),b._collisionTriggered=!1},b._target=d.e.Zero(),l&&b.setTarget(l),b.alpha=n,b.beta=r,b.radius=o,b.getViewMatrix(),b.inputs=new rs(b),b.inputs.addKeyboard().addMouseWheel().addPointers(),b}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new d.a,this._upToYMatrix=new d.a,this._upVector=d.e.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!1,configurable:!0}),t.prototype.setMatUp=function(){d.a.RotationAlignToRef(d.e.UpReadOnly,this._upVector,this._YToUpMatrix),d.a.RotationAlignToRef(this._upVector,d.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityX=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.angularSensibilityY=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.pinchDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return!!e&&e.useNaturalPinchZoom},set:function(e){var n=this.inputs.attached.pointers;n&&(n.useNaturalPinchZoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var n=this.inputs.attached.pointers;n&&(n.panningSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var n=this.inputs.attached.mousewheel;n&&(n.wheelDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Uu,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Ki,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Bu,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache._target=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=d.d.Zero()},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var n=this._getLockedTargetPosition();return n||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),i.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!i.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!i.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(e,n,r,o){var l=this;r===void 0&&(r=!0),o===void 0&&(o=2),n=Qe.b.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=r,this._panningMouseButton=o,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(n),this._reset=function(){l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.inertialPanningX=0,l.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Gt.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Gt.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Gt.a&&(this.inertialRadiusOffset=0)}(this.inertialPanningX!==0||this.inertialPanningY!==0)&&(this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.e.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost&&(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),d.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Gt.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Gt.a&&(this.inertialPanningY=0)),this._checkLimits(),i.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||d.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var e=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var n=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=2*n*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,n,r){if(n===void 0&&(n=!1),r===void 0&&(r=!1),e.getBoundingInfo)this._targetBoundingCenter=n?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var o=e,l=this._getTargetPosition();if(l&&!r&&l.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),n=Math.sin(this.alpha),r=Math.cos(this.beta),o=Math.sin(this.beta);o===0&&(o=1e-4),this.radius===0&&(this.radius=1e-4);var l=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*o,this.radius*r,this.radius*n*o),this._upVector.x===0&&this._upVector.y===1&&this._upVector.z===0||d.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),l.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var h=this.getScene().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var v=this.upVector;this.allowUpsideDown&&o<0&&(v=v.negate()),this._computeViewMatrix(this._position,l,v),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=l,this._viewMatrix},t.prototype.zoomOn=function(e,n){n===void 0&&(n=!1),e=e||this.getScene().meshes;var r=Ne.a.MinMax(e),o=d.e.Distance(r.min,r.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:r.min,max:r.max,distance:o},n)},t.prototype.focusOn=function(e,n){var r,o;if(n===void 0&&(n=!1),e.min===void 0){var l=e||this.getScene().meshes;r=Ne.a.MinMax(l),o=d.e.Distance(r.min,r.max)}else r=e,o=e.distance;this._target=Ne.a.Center(r),n||(this.maxZ=2*o)},t.prototype.createRigCamera=function(e,n){var r=0;switch(this.cameraRigMode){case Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Tt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Tt.a.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(n===0?1:-1);break;case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(n===0?-1:1)}var o=new t(e,this.alpha+r,this.beta,this.radius,this._target,this.getScene());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];switch(e.beta=n.beta=this.beta,this.cameraRigMode){case Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Tt.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case Tt.a.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}i.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},Object(_.c)([Object(V.c)()],t.prototype,"alpha",void 0),Object(_.c)([Object(V.c)()],t.prototype,"beta",void 0),Object(_.c)([Object(V.c)()],t.prototype,"radius",void 0),Object(_.c)([Object(V.o)("target")],t.prototype,"_target",void 0),Object(_.c)([Object(V.c)()],t.prototype,"inertialAlphaOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"inertialBetaOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"inertialRadiusOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerAlphaLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperAlphaLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerBetaLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperBetaLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperRadiusLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"inertialPanningX",void 0),Object(_.c)([Object(V.c)()],t.prototype,"inertialPanningY",void 0),Object(_.c)([Object(V.c)()],t.prototype,"pinchToPanMaxDistance",void 0),Object(_.c)([Object(V.c)()],t.prototype,"panningDistanceLimit",void 0),Object(_.c)([Object(V.o)()],t.prototype,"panningOriginTarget",void 0),Object(_.c)([Object(V.c)()],t.prototype,"panningInertia",void 0),Object(_.c)([Object(V.c)()],t.prototype,"zoomOnFactor",void 0),Object(_.c)([Object(V.c)()],t.prototype,"targetScreenOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"allowUpsideDown",void 0),Object(_.c)([Object(V.c)()],t.prototype,"useInputToRestoreState",void 0),t}(Zr);Z.a.AddNodeConstructor("DeviceOrientationCamera",function(i,t){return function(){return new Io(i,d.e.Zero(),t)}});var Io=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o._tmpDragQuaternion=new d.b,o._disablePointerInputWhenUsingDeviceOrientation=!0,o._dragFactor=0,o._quaternionCache=new d.b,o.inputs.addDeviceOrientation(),o.inputs._deviceOrientationInput&&o.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){o._disablePointerInputWhenUsingDeviceOrientation&&o.inputs._mouseInput&&(o.inputs._mouseInput._allowCameraRotation=!1,o.inputs._mouseInput.onPointerMovedObservable.add(function(l){o._dragFactor!=0&&(o._initialQuaternion||(o._initialQuaternion=new d.b),d.b.FromEulerAnglesToRef(0,l.offsetX*o._dragFactor,0,o._tmpDragQuaternion),o._initialQuaternion.multiplyToRef(o._tmpDragQuaternion,o._initialQuaternion))}))}),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(e){this._disablePointerInputWhenUsingDeviceOrientation=e},enumerable:!1,configurable:!0}),t.prototype.enableHorizontalDragging=function(e){e===void 0&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var n=this;e===void 0&&(e=Se.a.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new d.b),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(r){e[r]?n._initialQuaternion[r]*=-1:n._initialQuaternion[r]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(dr),Wc=function(i){function t(e){return i.call(this,e)||this}return Object(_.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new Fc),this},t.prototype.addMouse=function(e){return e===void 0&&(e=!0),this.add(new Oo(e)),this},t}(va),qi=function(i){function t(e,n,r,o){o===void 0&&(o=!0);var l=i.call(this,e,n,r,o)||this;return l.ellipsoid=new d.e(1,1,1),l.ellipsoidOffset=new d.e(0,0,0),l.checkCollisions=!1,l.applyGravity=!1,l.cameraDirection=d.e.Zero(),l._trackRoll=0,l.rollCorrect=100,l.bankedTurn=!1,l.bankedTurnLimit=Math.PI/2,l.bankedTurnMultiplier=1,l._needMoveForGravity=!1,l._oldPosition=d.e.Zero(),l._diffPosition=d.e.Zero(),l._newPosition=d.e.Zero(),l._collisionMask=-1,l._onCollisionPositionChange=function(h,v,b){b===void 0&&(b=null);var A;A=v,l._newPosition.copyFrom(A),l._newPosition.subtractToRef(l._oldPosition,l._diffPosition),l._diffPosition.length()>Xe.a.CollisionsEpsilon&&(l.position.addInPlace(l._diffPosition),l.onCollide&&b&&l.onCollide(b))},l.inputs=new Wc(l),l.inputs.addKeyboard().addMouse(),l}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var n=this.inputs.attached.mouse;n&&(n.angularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysForward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysBackward=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var n=this.inputs.attached.keyboard;n&&(n.keysRight=e)},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(e,n){n=Qe.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n)},t.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new d.e(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?d.e.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var n=this.getScene().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=e;this.applyGravity&&(r=e.add(this.getScene().gravity)),n.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=d.e.Zero(),this._transformedDirection=d.e.Zero()),this.inputs.checkInputs(),i.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):i.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var n=this._trackRoll,r=n-this.rotation.z;Math.abs(r)>=.001&&(this.rotation.z+=r/e,Math.abs(n-this.rotation.z)<=.001&&(this.rotation.z=n))},t.prototype.dispose=function(){this.inputs.clear(),i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},Object(_.c)([Object(V.o)()],t.prototype,"ellipsoid",void 0),Object(_.c)([Object(V.o)()],t.prototype,"ellipsoidOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"checkCollisions",void 0),Object(_.c)([Object(V.c)()],t.prototype,"applyGravity",void 0),t}(Zr),Do=function(i){function t(e){return i.call(this,e)||this}return Object(_.d)(t,i),t.prototype.addKeyboard=function(){return this.add(new ba),this},t.prototype.addMouseWheel=function(){return this.add(new Bc),this},t.prototype.addPointers=function(){return this.add(new Uc),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(va);Z.a.AddNodeConstructor("FollowCamera",function(i,t){return function(){return new Hc(i,d.e.Zero(),t)}}),Z.a.AddNodeConstructor("ArcFollowCamera",function(i,t){return function(){return new Wu(i,0,0,1,null,t)}});var kr,Hc=function(i){function t(e,n,r,o){o===void 0&&(o=null);var l=i.call(this,e,n,r)||this;return l.radius=12,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.rotationOffset=0,l.lowerRotationOffsetLimit=null,l.upperRotationOffsetLimit=null,l.heightOffset=4,l.lowerHeightOffsetLimit=null,l.upperHeightOffsetLimit=null,l.cameraAcceleration=.05,l.maxCameraSpeed=20,l.lockedTarget=o,l.inputs=new Do(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return Object(_.d)(t,i),t.prototype._follow=function(e){if(e){var n;if(e.rotationQuaternion){var r=new d.a;e.rotationQuaternion.toRotationMatrix(r),n=Math.atan2(r.m[8],r.m[10])}else n=e.rotation.y;var o=Qe.b.ToRadians(this.rotationOffset)+n,l=e.getAbsolutePosition(),h=l.x+Math.sin(o)*this.radius,v=l.z+Math.cos(o)*this.radius,b=h-this.position.x,A=l.y+this.heightOffset-this.position.y,D=v-this.position.z,N=b*this.cameraAcceleration*2,j=A*this.cameraAcceleration,k=D*this.cameraAcceleration*2;(N>this.maxCameraSpeed||N<-this.maxCameraSpeed)&&(N=N<1?-this.maxCameraSpeed:this.maxCameraSpeed),(j>this.maxCameraSpeed||j<-this.maxCameraSpeed)&&(j=j<1?-this.maxCameraSpeed:this.maxCameraSpeed),(k>this.maxCameraSpeed||k<-this.maxCameraSpeed)&&(k=k<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new d.e(this.position.x+N,this.position.y+j,this.position.z+k),this.setTarget(l)}},t.prototype.attachControl=function(e,n){n=Qe.b.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(n),this._reset=function(){}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),i.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),this.lowerHeightOffsetLimit!==null&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),this.upperHeightOffsetLimit!==null&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),this.lowerRotationOffsetLimit!==null&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),this.upperRotationOffsetLimit!==null&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},Object(_.c)([Object(V.c)()],t.prototype,"radius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerRadiusLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperRadiusLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"rotationOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperRotationOffsetLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"heightOffset",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"upperHeightOffsetLimit",void 0),Object(_.c)([Object(V.c)()],t.prototype,"cameraAcceleration",void 0),Object(_.c)([Object(V.c)()],t.prototype,"maxCameraSpeed",void 0),Object(_.c)([Object(V.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Zr),Wu=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,d.e.Zero(),h)||this;return v.alpha=n,v.beta=r,v.radius=o,v._cartesianCoordinates=d.e.Zero(),v._meshTarget=l,v._follow(),v}return Object(_.d)(t,i),t.prototype._follow=function(){if(this._meshTarget){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this._meshTarget.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){i.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(Zr),as=c(38),Bn=c(39);(function(i){i[i.VIVE=0]="VIVE",i[i.OCULUS=1]="OCULUS",i[i.WINDOWS=2]="WINDOWS",i[i.GEAR_VR=3]="GEAR_VR",i[i.DAYDREAM=4]="DAYDREAM",i[i.GENERIC=5]="GENERIC"})(kr||(kr={}));var ir,Ii,Di=function(){function i(){}return i.InitiateController=function(t){for(var e=0,n=this._ControllerFactories;e<n.length;e++){var r=n[e];if(r.canCreate(t))return r.create(t)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(t);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},i._ControllerFactories=[],i._DefaultControllerFactory=null,i}(),Ie=function(i){function t(e){var n=i.call(this,e.id,e.index,e)||this;return n.isXR=!1,n._deviceRoomPosition=d.e.Zero(),n._deviceRoomRotationQuaternion=new d.b,n.devicePosition=d.e.Zero(),n.deviceRotationQuaternion=new d.b,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new d.b,n._deviceToWorld=d.a.Identity(),n._pointingPoseNode=null,n._workingMatrix=d.a.Identity(),n._meshAttachedObservable=new E.c,n.type=Mn.POSE_ENABLED,n.controllerType=kr.GENERIC,n.position=d.e.Zero(),n.rotationQuaternion=new d.b,n._calculatedPosition=d.e.Zero(),n._calculatedRotation=new d.b,d.b.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return Object(_.d)(t,i),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(!this.isXR){var e=this.browserGamepad.pose;if(this.updateFromDevice(e),!this._trackPosition&&$.a.LastCreatedScene&&$.a.LastCreatedScene.activeCamera&&$.a.LastCreatedScene.activeCamera.devicePosition&&((n=$.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(n.devicePosition),n.deviceRotationQuaternion)){var n;(n=n)._deviceRoomRotationQuaternion.toEulerAnglesToRef(d.c.Vector3[0]);var r=Math.atan2(Math.sin(d.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(d.c.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(r)>this._maxRotationDistFromHeadset){var o=r-(r<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=o;var l=Math.sin(-o),h=Math.cos(-o);this._calculatedPosition.x=this._calculatedPosition.x*h-this._calculatedPosition.z*l,this._calculatedPosition.z=this._calculatedPosition.x*l+this._calculatedPosition.z*h}}d.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),d.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},t.prototype.updateFromDevice=function(e){if(!this.isXR&&e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var n=this.rawPose;e.orientation&&n.orientation&&n.orientation.length===4&&(this._deviceRoomRotationQuaternion.copyFromFloats(n.orientation[0],n.orientation[1],-n.orientation[2],-n.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new d.b),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var n=[],r=this._pointingPoseNode;r.parent;)n.push(r.parent),r=r.parent;n.reverse().forEach(function(o){o.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this.mesh)return new Bn.a(d.e.Zero(),new d.e(0,0,1),e);var n=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),r=n.getTranslation(),o=new d.e(0,0,-1),l=d.e.TransformNormal(o,n),h=d.e.Normalize(l);return new Bn.a(r,h,e)},t.POINTING_POSE="POINTING_POSE",t}(Mn);(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(ir||(ir={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(Ii||(Ii={}));var je,Ke,yt=function(i){function t(e,n,r,o){o===void 0&&(o=!1);var l=i.call(this,e,n,r,0,1,2,3)||this;return l._leftTrigger=0,l._rightTrigger=0,l.onButtonDownObservable=new E.c,l.onButtonUpObservable=new E.c,l.onPadDownObservable=new E.c,l.onPadUpObservable=new E.c,l._buttonA=0,l._buttonB=0,l._buttonX=0,l._buttonY=0,l._buttonBack=0,l._buttonStart=0,l._buttonLB=0,l._buttonRB=0,l._buttonLeftStick=0,l._buttonRightStick=0,l._dPadUp=0,l._dPadDown=0,l._dPadLeft=0,l._dPadRight=0,l._isXboxOnePad=!1,l.type=Mn.XBOX,l._isXboxOnePad=o,l}return Object(_.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,ir.A)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,ir.B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,ir.X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,ir.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,ir.Start)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,ir.Back)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,ir.LB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,ir.RB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,ir.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,ir.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Ii.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Ii.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Ii.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Ii.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Mn);(function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.LeftStick=10]="LeftStick",i[i.RightStick=11]="RightStick"})(je||(je={})),function(i){i[i.Up=12]="Up",i[i.Down=13]="Down",i[i.Left=14]="Left",i[i.Right=15]="Right"}(Ke||(Ke={}));var Yt=function(i){function t(e,n,r){var o=i.call(this,e.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),n,r,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new E.c,o.onButtonUpObservable=new E.c,o.onPadDownObservable=new E.c,o.onPadUpObservable=new E.c,o._buttonCross=0,o._buttonCircle=0,o._buttonSquare=0,o._buttonTriangle=0,o._buttonShare=0,o._buttonOptions=0,o._buttonL1=0,o._buttonR1=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o.type=Mn.DUALSHOCK,o}return Object(_.d)(t,i),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,n,r){return e!==n&&(e===1&&(this._onbuttondown&&this._onbuttondown(r),this.onButtonDownObservable.notifyObservers(r)),e===0&&(this._onbuttonup&&this._onbuttonup(r),this.onButtonUpObservable.notifyObservers(r))),e},t.prototype._setDPadValue=function(e,n,r){return e!==n&&(e===1&&(this._ondpaddown&&this._ondpaddown(r),this.onPadDownObservable.notifyObservers(r)),e===0&&(this._ondpadup&&this._ondpadup(r),this.onPadUpObservable.notifyObservers(r))),e},Object.defineProperty(t.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,je.Cross)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,je.Circle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,je.Square)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,je.Triangle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,je.Options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,je.Share)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,je.L1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,je.R1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,je.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,je.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Ke.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Ke.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Ke.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Ke.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Mn),an=function(){function i(t){var e=this;if(this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new E.c,as.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new E.c(function(r){for(var o in e._babylonGamepads){var l=e._babylonGamepads[o];l&&l._isConnected&&e.onGamepadConnectedObservable.notifyObserver(r,l)}}),this._onGamepadConnectedEvent=function(r){var o,l=r.gamepad;l.index in e._babylonGamepads&&e._babylonGamepads[l.index].isConnected||(e._babylonGamepads[l.index]?((o=e._babylonGamepads[l.index]).browserGamepad=l,o._isConnected=!0):o=e._addNewGamepad(l),e.onGamepadConnectedObservable.notifyObservers(o),e._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(r){var o=r.gamepad;for(var l in e._babylonGamepads)if(e._babylonGamepads[l].index===o.index){var h=e._babylonGamepads[l];h._isConnected=!1,e.onGamepadDisconnectedObservable.notifyObservers(h),h.dispose&&h.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var n=this._scene?this._scene.getEngine().getHostWindow():window;n&&(n.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),n.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(i.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0}),i.prototype.getGamepadByType=function(t){t===void 0&&(t=Mn.XBOX);for(var e=0,n=this._babylonGamepads;e<n.length;e++){var r=n[e];if(r&&r.type===t)return r}return null},i.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(t){t.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},i.prototype._addNewGamepad=function(t){var e;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=t.id.search("054c")!==-1,r=t.id.search("Xbox One")!==-1;return e=r||t.id.search("Xbox 360")!==-1||t.id.search("xinput")!==-1?new yt(t.id,t.index,t,r):n?new Yt(t.id,t.index,t):t.pose?Di.InitiateController(t):new ju(t.id,t.index,t),this._babylonGamepads[e.index]=e,e},i.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},i.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},i.prototype._checkGamepadsStatus=function(){var t=this;for(var e in this._updateGamepadObjects(),this._babylonGamepads){var n=this._babylonGamepads[e];n&&n.isConnected&&n.update()}this._isMonitoring&&!this._scene&&Xe.a.QueueNewFrame(function(){t._checkGamepadsStatus()})},i.prototype._updateGamepadObjects=function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++){var n=t[e];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[e].browserGamepad=n,this._babylonGamepads[e].isConnected||(this._babylonGamepads[e]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[e]));else{var r=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(r)}}},i}();Object.defineProperty(ne.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new an(this);var i=this._getComponent(ct.a.NAME_GAMEPAD);i||(i=new yn(this),this._addComponent(i))}return this._gamepadManager},enumerable:!0,configurable:!0}),ya.prototype.addGamepad=function(){return this.add(new Ta),this},rs.prototype.addGamepad=function(){return this.add(new Ic),this};var yn=function(){function i(t){this.name=ct.a.NAME_GAMEPAD,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(ct.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){var t=this.scene._gamepadManager;t&&(t.dispose(),this.scene._gamepadManager=null)},i.prototype._beforeCameraUpdate=function(){var t=this.scene._gamepadManager;t&&t._isMonitoring&&t._checkGamepadsStatus()},i}();Z.a.AddNodeConstructor("FreeCamera",function(i,t){return function(){return new Ft(i,d.e.Zero(),t)}});var Ft=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addGamepad(),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadAngularSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var n=this.inputs.attached.gamepad;n&&(n.gamepadMoveSensibility=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Gc);Tt.a._createDefaultParsedCamera=function(i,t){return new Ft(i,d.e.Zero(),t)},Z.a.AddNodeConstructor("GamepadCamera",function(i,t){return function(){return new hn(i,d.e.Zero(),t)}});var hn=function(i){function t(e,n,r){return i.call(this,e,n,r)||this}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"GamepadCamera"},t}(Ft),In=c(33),We=c(5),Ea=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.postprocessVertexShader=Ea;var ss=c(102);Xt.a.prototype.createRenderTargetTexture=function(i,t){var e=new ss.a;t!==void 0&&typeof t=="object"?(e.generateMipMaps=t.generateMipMaps,e.generateDepthBuffer=!!t.generateDepthBuffer,e.generateStencilBuffer=!!t.generateStencilBuffer,e.type=t.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:t.type,e.samplingMode=t.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,e.format=t.format===void 0?g.a.TEXTUREFORMAT_RGBA:t.format):(e.generateMipMaps=t,e.generateDepthBuffer=!0,e.generateStencilBuffer=!1,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,e.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.format=g.a.TEXTUREFORMAT_RGBA),(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE),e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var n=this._gl,r=new Mt.a(this,Mt.b.RenderTarget),o=i.width||i,l=i.height||i,h=i.layers||0,v=this._getSamplingParameters(e.samplingMode,!!e.generateMipMaps),b=h!==0?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D,A=this._getRGBABufferInternalSizedFormat(e.type,e.format),D=this._getInternalFormat(e.format),N=this._getWebGLTextureType(e.type);this._bindTextureDirectly(b,r),h!==0?(r.is2DArray=!0,n.texImage3D(b,0,A,o,l,h,0,D,N,null)):n.texImage2D(b,0,A,o,l,0,D,N,null),n.texParameteri(b,n.TEXTURE_MAG_FILTER,v.mag),n.texParameteri(b,n.TEXTURE_MIN_FILTER,v.min),n.texParameteri(b,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(b,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.generateMipMaps&&this._gl.generateMipmap(b),this._bindTextureDirectly(b,null);var j=this._currentFramebuffer,k=n.createFramebuffer();return this._bindUnboundFramebuffer(k),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!e.generateStencilBuffer,e.generateDepthBuffer,o,l),r.is2DArray||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r._webGLTexture,0),this._bindUnboundFramebuffer(j),r._framebuffer=k,r.baseWidth=o,r.baseHeight=l,r.width=o,r.height=l,r.depth=h,r.isReady=!0,r.samples=1,r.generateMipMaps=!!e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=!!e.generateStencilBuffer,this._internalTexturesCache.push(r),r},Xt.a.prototype.createDepthStencilTexture=function(i,t){if(t.isCube){var e=i.width||i;return this._createDepthStencilCubeTexture(e,t)}return this._createDepthStencilTexture(i,t)},Xt.a.prototype._createDepthStencilTexture=function(i,t){var e=this._gl,n=i.layers||0,r=n!==0?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,o=new Mt.a(this,Mt.b.Depth);if(!this._caps.depthTextureExtension)return p.a.Error("Depth texture is not supported by your browser or hardware."),o;var l=Object(_.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(r,o,!0),this._setupDepthStencilTexture(o,i,l.generateStencil,l.bilinearFiltering,l.comparisonFunction);var h=l.generateStencil?e.UNSIGNED_INT_24_8:e.UNSIGNED_INT,v=l.generateStencil?e.DEPTH_STENCIL:e.DEPTH_COMPONENT,b=v;return this.webGLVersion>1&&(b=l.generateStencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24),o.is2DArray?e.texImage3D(r,0,b,o.width,o.height,n,0,v,h,null):e.texImage2D(r,0,b,o.width,o.height,0,v,h,null),this._bindTextureDirectly(r,null),o};var bt=function(){function i(t,e,n,r,o,l,h,v,b,A,D,N,j,k,H){h===void 0&&(h=g.a.TEXTURE_NEAREST_SAMPLINGMODE),A===void 0&&(A=null),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),N===void 0&&(N="postprocess"),k===void 0&&(k=!1),H===void 0&&(H=g.a.TEXTUREFORMAT_RGBA),this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=g.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=g.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new In.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new d.d(1,1),this._texelSize=d.d.Zero(),this.onActivateObservable=new E.c,this.onSizeChangedObservable=new E.c,this.onApplyObservable=new E.c,this.onBeforeRenderObservable=new E.c,this.onAfterRenderObservable=new E.c,this.name=t,l!=null?(this._camera=l,this._scene=l.getScene(),l.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):v&&(this._engine=v,this._engine.postProcesses.push(this)),this._options=o,this.renderTargetSamplingMode=h||g.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=b||!1,this._textureType=D,this._textureFormat=H,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=e,this._vertexUrl=N,this._parameters=n||[],this._parameters.push("scale"),this._indexParameters=j,k||this.updateEffect(A)}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(t){var e=this;this._samples=Math.min(t,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(n){n.samples!==e._samples&&e._engine.updateRenderTargetTextureSampleCount(n,e._samples)})},enumerable:!1,configurable:!0}),i.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(i.prototype,"onActivate",{set:function(t){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),t&&(this._onActivateObserver=this.onActivateObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSizeChanged",{set:function(t){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onApply",{set:function(t){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(t){this._forcedOutputTexture=t},enumerable:!1,configurable:!0}),i.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture=null},i.prototype.getCamera=function(){return this._camera},Object.defineProperty(i.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcess"},i.prototype.getEngine=function(){return this._engine},i.prototype.getEffect=function(){return this._effect},i.prototype.shareOutputWith=function(t){return this._disposeTextures(),this._shareOutputWithPostProcess=t,this},i.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new In.a(2)),this._shareOutputWithPostProcess=null},i.prototype.updateEffect=function(t,e,n,r,o,l,h,v){t===void 0&&(t=null),e===void 0&&(e=null),n===void 0&&(n=null),this._effect=this._engine.createEffect({vertex:h??this._vertexUrl,fragment:v??this._fragmentUrl},["position"],e||this._parameters,n||this._samplers,t!==null?t:"",void 0,o,l,r||this._indexParameters)},i.prototype.isReusable=function(){return this._reusable},i.prototype.markTextureDirty=function(){this.width=-1},i.prototype.activate=function(t,e,n){var r=this;e===void 0&&(e=null);var o=(t=t||this._camera).getScene(),l=o.getEngine(),h=l.getCaps().maxTextureSize,v=(e?e.width:this._engine.getRenderWidth(!0))*this._options|0,b=(e?e.height:this._engine.getRenderHeight(!0))*this._options|0,A=t.parent;!A||A.leftCamera!=t&&A.rightCamera!=t||(v/=2);var D,N=this._options.width||v,j=this._options.height||b,k=this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==g.a.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==g.a.TEXTURE_LINEAR_LINEAR;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var H=l.currentViewport;H&&(N*=H.width,j*=H.height)}if((k||this.alwaysForcePOT)&&(this._options.width||(N=l.needPOTTextures?Xe.a.GetExponentOfTwo(N,h,this.scaleMode):N),this._options.height||(j=l.needPOTTextures?Xe.a.GetExponentOfTwo(j,h,this.scaleMode):j)),this.width!==N||this.height!==j){if(this._textures.length>0){for(var J=0;J<this._textures.length;J++)this._engine._releaseTexture(this._textures.data[J]);this._textures.reset()}this.width=N,this.height=j;var te={width:this.width,height:this.height},oe={generateMipMaps:k,generateDepthBuffer:n||t._postProcesses.indexOf(this)===0,generateStencilBuffer:(n||t._postProcesses.indexOf(this)===0)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(te,oe)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(te,oe)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(ce){ce.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(ce,r.samples)})}return this._shareOutputWithPostProcess?D=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(D=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):D=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(v/N,b/j),this._engine.bindFramebuffer(D,0,v,b,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(D,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===g.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),D},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),i.prototype.isReady=function(){return this._effect&&this._effect.isReady()},i.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",t),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var t},i.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.dispose()}},i.prototype.setPrePassRenderer=function(t){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=t.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},i.prototype.dispose=function(t){var e;if(t=t||this._camera,this._disposeTextures(),this._scene&&(e=this._scene.postProcesses.indexOf(this))!==-1&&this._scene.postProcesses.splice(e,1),(e=this._engine.postProcesses.indexOf(this))!==-1&&this._engine.postProcesses.splice(e,1),t){if(t.detachPostProcess(this),(e=t._postProcesses.indexOf(this))===0&&t._postProcesses.length>0){var n=this._camera._getFirstPostProcess();n&&n.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},i.prototype.serialize=function(){var t=V.a.Serialize(this);return t.customType="BABYLON."+this.getClassName(),t.cameraId=this.getCamera().id,t.reusable=this._reusable,t.options=this._options,t.textureType=this._textureType,t},i.Parse=function(t,e,n){var r=M.a.GetClass(t.customType);if(!r||!r._Parse)return null;var o=e.getCameraByID(t.cameraId);return o?r._Parse(t,o,e,n):null},Object(_.c)([Object(V.c)()],i.prototype,"uniqueId",void 0),Object(_.c)([Object(V.c)()],i.prototype,"name",void 0),Object(_.c)([Object(V.c)()],i.prototype,"width",void 0),Object(_.c)([Object(V.c)()],i.prototype,"height",void 0),Object(_.c)([Object(V.c)()],i.prototype,"renderTargetSamplingMode",void 0),Object(_.c)([Object(V.f)()],i.prototype,"clearColor",void 0),Object(_.c)([Object(V.c)()],i.prototype,"autoClear",void 0),Object(_.c)([Object(V.c)()],i.prototype,"alphaMode",void 0),Object(_.c)([Object(V.c)()],i.prototype,"alphaConstants",void 0),Object(_.c)([Object(V.c)()],i.prototype,"enablePixelPerfectMode",void 0),Object(_.c)([Object(V.c)()],i.prototype,"forceFullscreenViewport",void 0),Object(_.c)([Object(V.c)()],i.prototype,"scaleMode",void 0),Object(_.c)([Object(V.c)()],i.prototype,"alwaysForcePOT",void 0),Object(_.c)([Object(V.c)("samples")],i.prototype,"_samples",void 0),Object(_.c)([Object(V.c)()],i.prototype,"adaptScaleToCurrentViewport",void 0),i}();M.a.RegisteredTypes["BABYLON.PostProcess"]=bt;var Hu=`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
}`;We.a.ShadersStore.passPixelShader=Hu;var G1=`
varying vec2 vUV;
uniform samplerCube textureSampler;
void main(void)
{
vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001));
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));
#endif
}`;We.a.ShadersStore.passCubePixelShader=G1;var wo=function(i){function t(e,n,r,o,l,h,v,b){return r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=!1),i.call(this,e,"pass",null,null,n,r,o,l,h,void 0,v,void 0,null,b)||this}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PassPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(bt);M.a.RegisteredTypes["BABYLON.PassPostProcess"]=wo;var W1=function(i){function t(e,n,r,o,l,h,v,b){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=!1);var A=i.call(this,e,"passCube",null,null,n,r,o,l,h,"#define POSITIVEX",v,void 0,null,b)||this;return A._face=0,A}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PassCubePostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(bt);Xe.a._RescalePostProcessFactory=function(i){return new wo("rescale",1,null,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,i,!1,g.a.TEXTURETYPE_UNSIGNED_INT)};var H1=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`;We.a.ShadersStore.anaglyphPixelShader=H1;var _p=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,"anaglyph",null,["leftSampler"],n,r[1],o,l,h)||this;return v._passedProcess=r[0]._rigPostProcess,v.onApplyObservable.add(function(b){b.setTextureFromPostProcess("leftSampler",v._passedProcess)}),v}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphPostProcess"},t}(bt);M.a.RegisteredTypes["BABYLON.AnaglyphPostProcess"]=_p,Tt.a._setStereoscopicAnaglyphRigMode=function(i){i._rigCameras[0]._rigPostProcess=new wo(i.name+"_passthru",1,i._rigCameras[0]),i._rigCameras[1]._rigPostProcess=new _p(i.name+"_anaglyph",1,i._rigCameras)},Z.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(i,t,e){return function(){return new Jb(i,0,0,1,d.e.Zero(),e.interaxial_distance,t)}});var Jb=function(i){function t(e,n,r,o,l,h,v){var b=i.call(this,e,n,r,o,l,v)||this;return b.interaxialDistance=h,b.setCameraRigMode(Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:h}),b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(Mi);Z.a.AddNodeConstructor("AnaglyphFreeCamera",function(i,t,e){return function(){return new ey(i,d.e.Zero(),e.interaxial_distance,t)}});var ey=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(dr);Z.a.AddNodeConstructor("AnaglyphGamepadCamera",function(i,t,e){return function(){return new ty(i,d.e.Zero(),e.interaxial_distance,t)}});var ty=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(hn);Z.a.AddNodeConstructor("AnaglyphUniversalCamera",function(i,t,e){return function(){return new ny(i,d.e.Zero(),e.interaxial_distance,t)}});var ny=function(i){function t(e,n,r,o){var l=i.call(this,e,n,o)||this;return l.interaxialDistance=r,l.setCameraRigMode(Tt.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),l}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(Ft),$r=c(58);Tt.a._setStereoscopicRigMode=function(i){var t=i.cameraRigMode===Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||i.cameraRigMode===Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,e=i.cameraRigMode===Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;i._rigCameras[e?1:0].viewport=new $r.a(0,0,t?.5:1,t?1:.5),i._rigCameras[e?0:1].viewport=new $r.a(t?.5:0,t?0:.5,t?.5:1,t?1:.5)},Z.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(i,t,e){return function(){return new ry(i,0,0,1,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var ry=function(i){function t(e,n,r,o,l,h,v,b){var A=i.call(this,e,n,r,o,l,b)||this;return A.interaxialDistance=h,A.isStereoscopicSideBySide=v,A.setCameraRigMode(v?Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:h}),A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(Mi);Z.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new iy(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var iy=function(i){function t(e,n,r,o,l){var h=i.call(this,e,n,l)||this;return h.interaxialDistance=r,h.isStereoscopicSideBySide=o,h.setCameraRigMode(o?Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(dr);Z.a.AddNodeConstructor("StereoscopicGamepadCamera",function(i,t,e){return function(){return new oy(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var oy=function(i){function t(e,n,r,o,l){var h=i.call(this,e,n,l)||this;return h.interaxialDistance=r,h.isStereoscopicSideBySide=o,h.setCameraRigMode(o?Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(hn);Z.a.AddNodeConstructor("StereoscopicFreeCamera",function(i,t,e){return function(){return new ay(i,d.e.Zero(),e.interaxial_distance,e.isStereoscopicSideBySide,t)}});var ay=function(i){function t(e,n,r,o,l){var h=i.call(this,e,n,l)||this;return h.interaxialDistance=r,h.isStereoscopicSideBySide=o,h.setCameraRigMode(o?Tt.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Tt.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(Ft);Z.a.AddNodeConstructor("VirtualJoysticksCamera",function(i,t){return function(){return new sy(i,d.e.Zero(),t)}});var sy=function(i){function t(e,n,r){var o=i.call(this,e,n,r)||this;return o.inputs.addVirtualJoystick(),o}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(dr),cs=function(){function i(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(i.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return d.a.Translation(t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return d.a.Translation(-t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftPreViewMatrix",{get:function(){return d.a.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightPreViewMatrix",{get:function(){return d.a.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),i.GetDefault=function(){var t=new i;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},i}(),X1=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn;
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`;We.a.ShadersStore.vrDistortionCorrectionPixelShader=X1;var gp=function(i){function t(e,n,r,o){var l=i.call(this,e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,n,Ve.a.BILINEAR_SAMPLINGMODE)||this;return l._isRightEye=r,l._distortionFactors=o.distortionK,l._postProcessScaleFactor=o.postProcessScaleFactor,l._lensCenterOffset=o.lensCenterOffset,l.adaptScaleToCurrentViewport=!0,l.onSizeChangedObservable.add(function(){l._scaleIn=new d.d(2,2/l.aspectRatio),l._scaleFactor=new d.d(1/l._postProcessScaleFactor*.5,1/l._postProcessScaleFactor*.5*l.aspectRatio),l._lensCenter=new d.d(l._isRightEye?.5-.5*l._lensCenterOffset:.5+.5*l._lensCenterOffset,.5)}),l.onApplyObservable.add(function(h){h.setFloat2("LensCenter",l._lensCenter.x,l._lensCenter.y),h.setFloat2("Scale",l._scaleFactor.x,l._scaleFactor.y),h.setFloat2("ScaleIn",l._scaleIn.x,l._scaleIn.y),h.setFloat4("HmdWarpParam",l._distortionFactors[0],l._distortionFactors[1],l._distortionFactors[2],l._distortionFactors[3])}),l}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VRDistortionCorrectionPostProcess"},t}(bt),Y1=`precision mediump sampler2DArray;
varying vec2 vUV;
uniform sampler2DArray multiviewSampler;
uniform int imageIndex;
void main(void)
{
gl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));
}`;We.a.ShadersStore.vrMultiviewToSingleviewPixelShader=Y1;var cy=c(85),vp=c(95),Xc=c(96);Xt.a.prototype.createRenderTargetCubeTexture=function(i,t){var e=Object(_.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:g.a.TEXTURETYPE_UNSIGNED_INT,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,format:g.a.TEXTUREFORMAT_RGBA},t);e.generateStencilBuffer=e.generateDepthBuffer&&e.generateStencilBuffer,(e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(e.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(e.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,r=new Mt.a(this,Mt.b.RenderTarget);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,r,!0);var o=this._getSamplingParameters(e.samplingMode,e.generateMipMaps);e.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(e.type=g.a.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,o.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,o.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(var l=0;l<6;l++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this._getRGBABufferInternalSizedFormat(e.type,e.format),i,i,0,this._getInternalFormat(e.format),this._getWebGLTextureType(e.type),null);var h=n.createFramebuffer();return this._bindUnboundFramebuffer(h),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(e.generateStencilBuffer,e.generateDepthBuffer,i,i),e.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),r._framebuffer=h,r.width=i,r.height=i,r.isReady=!0,r.isCube=!0,r.samples=1,r.generateMipMaps=e.generateMipMaps,r.samplingMode=e.samplingMode,r.type=e.type,r.format=e.format,r._generateDepthBuffer=e.generateDepthBuffer,r._generateStencilBuffer=e.generateStencilBuffer,this._internalTexturesCache.push(r),r};var Un=function(i){function t(e,n,r,o,l,h,v,b,A,D,N,j,k){l===void 0&&(l=!0),h===void 0&&(h=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=!1),b===void 0&&(b=Ve.a.TRILINEAR_SAMPLINGMODE),A===void 0&&(A=!0),D===void 0&&(D=!1),N===void 0&&(N=!1),j===void 0&&(j=g.a.TEXTUREFORMAT_RGBA),k===void 0&&(k=!1);var H=i.call(this,null,r,!o)||this;return H.renderParticles=!0,H.renderSprites=!1,H.ignoreCameraViewport=!1,H.onBeforeBindObservable=new E.c,H.onAfterUnbindObservable=new E.c,H.onBeforeRenderObservable=new E.c,H.onAfterRenderObservable=new E.c,H.onClearObservable=new E.c,H.onResizeObservable=new E.c,H._currentRefreshId=-1,H._refreshRate=1,H._samples=1,H.boundingBoxPosition=d.e.Zero(),(r=H.getScene())&&(H._coordinatesMode=Ve.a.PROJECTION_MODE,H.renderList=new Array,H.name=e,H.isRenderTarget=!0,H._initialSizeParameter=n,H._processSizeParameter(n),H._resizeObserver=H.getScene().getEngine().onResizeObservable.add(function(){}),H._generateMipMaps=!!o,H._doNotChangeAspectRatio=l,H._renderingManager=new Xc.b(r),H._renderingManager._useSceneAutoClearSetup=!0,N||(H._renderTargetOptions={generateMipMaps:o,type:h,format:j,samplingMode:b,generateDepthBuffer:A,generateStencilBuffer:D},b===Ve.a.NEAREST_SAMPLINGMODE&&(H.wrapU=Ve.a.CLAMP_ADDRESSMODE,H.wrapV=Ve.a.CLAMP_ADDRESSMODE),k||(v?(H._texture=r.getEngine().createRenderTargetCubeTexture(H.getRenderSize(),H._renderTargetOptions),H.coordinatesMode=Ve.a.INVCUBIC_MODE,H._textureMatrix=d.a.Identity()):H._texture=r.getEngine().createRenderTargetTexture(H._size,H._renderTargetOptions)))),H}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),t.prototype._hookArray=function(e){var n=this,r=e.push;e.push=function(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];var v=e.length===0,b=r.apply(e,l);return v&&n.getScene()&&n.getScene().meshes.forEach(function(A){A._markSubMeshesAsLightDirty()}),b};var o=e.splice;e.splice=function(l,h){var v=o.apply(e,[l,h]);return e.length===0&&n.getScene().meshes.forEach(function(b){b._markSubMeshesAsLightDirty()}),v}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var e;return((e=this.getInternalTexture())===null||e===void 0?void 0:e._depthStencilTexture)||null},enumerable:!1,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,n,r){e===void 0&&(e=0),n===void 0&&(n=!0),r===void 0&&(r=!1);var o=this.getInternalTexture();if(this.getScene()&&o){var l=this.getScene().getEngine();o._depthStencilTexture=l.createDepthStencilTexture(this._size,{bilinearFiltering:n,comparisonFunction:e,generateStencil:r,isCube:this.isCube})}},t.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var n=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(n.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(n.getRenderHeight(),this._sizeRatio)}}else this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var n=this.getScene();n&&(this._samples=n.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!1,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var n=this.getScene();if(!n)return;this._postProcessManager=new vp.a(n),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(e===void 0&&(e=!1),this._postProcesses){if(e)for(var n=0,r=this._postProcesses;n<r.length;n++)r[n].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var n=this._postProcesses.indexOf(e);n!==-1&&(this._postProcesses.splice(n,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.scale=function(e){var n=Math.max(1,this.getRenderSize()*e);this.resize(n)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:i.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var n=this.isCube;this.releaseInternalTexture();var r=this.getScene();r&&(this._processSizeParameter(e),this._texture=n?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(e,n){if(e===void 0&&(e=!1),n===void 0&&(n=!1),b=this.getScene()){var r,o=b.getEngine();if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var l=0;l<this._waitingRenderList.length;l++){var h=this._waitingRenderList[l],v=b.getMeshByID(h);v&&this.renderList.push(v)}this._waitingRenderList=void 0}if(this.renderListPredicate){var b;if(this.renderList?this.renderList.length=0:this.renderList=[],!(b=this.getScene()))return;var A=b.meshes;for(l=0;l<A.length;l++){var D=A[l];this.renderListPredicate(D)&&this.renderList.push(D)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,o.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==b.activeCamera&&b.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=b.activeCamera)&&o.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var N=0;N<this.getRenderLayers();N++)this.renderToTarget(0,e,n,N,r),b.incrementRenderId(),b.resetCachedMaterial();else if(this.isCube)for(var j=0;j<6;j++)this.renderToTarget(j,e,n,void 0,r),b.incrementRenderId(),b.resetCachedMaterial();else this.renderToTarget(0,e,n,void 0,r);this.onAfterUnbindObservable.notifyObservers(this),b.activeCamera&&((b.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==b.activeCamera)&&b.setTransformMatrix(b.activeCamera.getViewMatrix(),b.activeCamera.getProjectionMatrix(!0)),o.setViewport(b.activeCamera.viewport)),b.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,n){var r=e*n,o=Xe.a.NearestPOT(r+16384/(128+r));return Math.min(Xe.a.FloorPOT(e),o)},t.prototype._prepareRenderingManager=function(e,n,r,o){var l=this.getScene();if(l){this._renderingManager.reset();for(var h=l.getRenderId(),v=0;v<n;v++){var b=e[v];if(b&&!b.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(b,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!b.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!b._internalAbstractMeshDataInfo._currentLODIsUpToDate&&l.activeCamera&&(b._internalAbstractMeshDataInfo._currentLOD=l.customLODSelector?l.customLODSelector(b,l.activeCamera):b.getLOD(l.activeCamera),b._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!b._internalAbstractMeshDataInfo._currentLOD)continue;var A=b._internalAbstractMeshDataInfo._currentLOD;A._preActivateForIntermediateRendering(h);var D=void 0;if(D=!(!o||!r)&&(b.layerMask&r.layerMask)==0,b.isEnabled()&&b.isVisible&&b.subMeshes&&!D&&(A!==b&&A._activate(h,!0),b._activate(h,!0)&&b.subMeshes.length)){b.isAnInstance?b._internalAbstractMeshDataInfo._actAsRegularMesh&&(A=b):A._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,A._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var N=0;N<A.subMeshes.length;N++){var j=A.subMeshes[N];this._renderingManager.dispatch(j,A)}}}}for(var k=0;k<l.particleSystems.length;k++){var H=l.particleSystems[k],J=H.emitter;H.isStarted()&&J&&J.position&&J.isEnabled()&&e.indexOf(J)>=0&&this._renderingManager.dispatchParticles(H)}}},t.prototype._bindFrameBuffer=function(e,n){e===void 0&&(e=0),n===void 0&&(n=0);var r=this.getScene();if(r){var o=r.getEngine();this._texture&&o.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,n)}},t.prototype.unbindFrameBuffer=function(e,n){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.renderToTarget=function(e,n,r,o,l){o===void 0&&(o=0),l===void 0&&(l=null);var h=this.getScene();if(h){var v=h.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&h.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e,o),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(o):this.onBeforeRenderObservable.notifyObservers(e);var b=null,A=this.renderList?this.renderList:h.getActiveMeshes().data,D=this.renderList?this.renderList.length:h.getActiveMeshes().length;this.getCustomRenderList&&(b=this.getCustomRenderList(this.is2DArray?o:e,A,D)),b?this._prepareRenderingManager(b,b.length,l,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(A,D,l,!this.renderList),this._defaultRenderListPrepared=!0),b=A),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(v):v.clear(this.clearColor||h.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);for(var N=0,j=h._beforeRenderTargetDrawStage;N<j.length;N++)j[N].action(this);this._renderingManager.render(this.customRenderFunction,b,this.renderParticles,this.renderSprites);for(var k=0,H=h._afterRenderTargetDrawStage;k<H.length;k++)H[k].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):n&&h.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||h.updateTransformMatrix(!0),r&&Qe.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),v),this.isCube&&e!==5?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&e===5&&v.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(v,e))}}},t.prototype.setRenderingOrder=function(e,n,r,o){n===void 0&&(n=null),r===void 0&&(r=null),o===void 0&&(o=null),this._renderingManager.setRenderingOrder(e,n,r,o)},t.prototype.setRenderingAutoClearDepthStencil=function(e,n){this._renderingManager.setRenderingAutoClearDepthStencil(e,n),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,this.renderList&&(n.renderList=this.renderList.slice(0)),n},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var n=0;n<this.renderList.length;n++)e.renderList.push(this.renderList[n].id);return e},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),n=this.getScene();e&&n&&n.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var n=e.customRenderTargets.indexOf(this);n>=0&&e.customRenderTargets.splice(n,1);for(var r=0,o=e.cameras;r<o.length;r++){var l=o[r];(n=l.customRenderTargets.indexOf(this))>=0&&l.customRenderTargets.splice(n,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),i.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(Ve.a);Ve.a._CreateRenderTargetTexture=function(i,t,e,n){return new Un(i,t,e,n)};var ly=function(i){function t(e,n){n===void 0&&(n=512);var r=i.call(this,"multiview rtt",n,e,!1,!0,Mt.b.Unknown,!1,void 0,!1,!1,!0,void 0,!0)||this,o=e.getEngine().createMultiviewRenderTargetTexture(r.getRenderWidth(),r.getRenderHeight());return o.isMultiview=!0,o.format=g.a.TEXTUREFORMAT_RGBA,r._texture=o,r.samples=r._getEngine().getCaps().maxSamples||r.samples,r}return Object(_.d)(t,i),t.prototype._bindFrameBuffer=function(e){this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(Un),uy=c(90);Xe.a.prototype.createMultiviewRenderTargetTexture=function(i,t){var e=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var n=new Mt.a(this,Mt.b.Unknown,!0);return n.width=i,n.height=t,n._framebuffer=e.createFramebuffer(),n._colorTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._colorTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.RGBA8,i,t,2),n._depthStencilTextureArray=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,n._depthStencilTextureArray),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,e.DEPTH32F_STENCIL8,i,t,2),n.isReady=!0,n},Xe.a.prototype.bindMultiviewFramebuffer=function(i){var t=this._gl,e=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(i,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i._framebuffer),!i._colorTextureArray||!i._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,i.samples,0,2),e.framebufferTextureMultisampleMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,i.samples,0,2)):(e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,i._colorTextureArray,0,0,2),e.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,i._depthStencilTextureArray,0,0,2))},Tt.a.prototype._useMultiviewToSingleView=!1,Tt.a.prototype._multiviewTexture=null,Tt.a.prototype._resizeOrCreateMultiviewTexture=function(i,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==i&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new ly(this.getScene(),{width:i,height:t})):this._multiviewTexture=new ly(this.getScene(),{width:i,height:t})},ne.a.prototype._transformMatrixR=d.a.Zero(),ne.a.prototype._multiviewSceneUbo=null,ne.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new cy.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},ne.a.prototype._updateMultiviewUbo=function(i,t){i&&t&&i.multiplyToRef(t,this._transformMatrixR),i&&t&&(i.multiplyToRef(t,d.c.Matrix[0]),uy.a.GetRightPlaneToRef(d.c.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},ne.a.prototype._renderMultiviewToSingleView=function(i){i._resizeOrCreateMultiviewTexture(i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.width>0?i._rigPostProcess.width:this.getEngine().getRenderWidth(!0),i._rigPostProcess&&i._rigPostProcess&&i._rigPostProcess.height>0?i._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),i.outputRenderTarget=i._multiviewTexture,this._renderForCamera(i),i.outputRenderTarget=null;for(var t=0;t<i._rigCameras.length;t++){var e=this.getEngine();this._activeCamera=i._rigCameras[t],e.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var bp=function(i){function t(e,n,r){var o=i.call(this,e,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],r,n,Ve.a.BILINEAR_SAMPLINGMODE)||this;return o.onSizeChangedObservable.add(function(){}),o.onApplyObservable.add(function(l){n._scene.activeCamera&&n._scene.activeCamera.isLeftCamera?l.setInt("imageIndex",0):l.setInt("imageIndex",1),l.setTexture("multiviewSampler",n._multiviewTexture)}),o}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VRMultiviewToSingleviewPostProcess"},t}(bt);Tt.a._setVRRigMode=function(i,t){var e=t.vrCameraMetrics||cs.GetDefault();i._rigCameras[0]._cameraRigParams.vrMetrics=e,i._rigCameras[0].viewport=new $r.a(0,0,.5,1),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[0]._cameraRigParams.vrHMatrix=e.leftHMatrix,i._rigCameras[0]._cameraRigParams.vrPreViewMatrix=e.leftPreViewMatrix,i._rigCameras[0].getProjectionMatrix=i._rigCameras[0]._getVRProjectionMatrix,i._rigCameras[1]._cameraRigParams.vrMetrics=e,i._rigCameras[1].viewport=new $r.a(.5,0,.5,1),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[1]._cameraRigParams.vrHMatrix=e.rightHMatrix,i._rigCameras[1]._cameraRigParams.vrPreViewMatrix=e.rightPreViewMatrix,i._rigCameras[1].getProjectionMatrix=i._rigCameras[1]._getVRProjectionMatrix,e.multiviewEnabled&&(i.getScene().getEngine().getCaps().multiview?(i._useMultiviewToSingleView=!0,i._rigPostProcess=new bp("VRMultiviewToSingleview",i,e.postProcessScaleFactor)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),e.multiviewEnabled=!1)),e.compensateDistortion&&(i._rigCameras[0]._rigPostProcess=new gp("VR_Distort_Compensation_Left",i._rigCameras[0],!1,e),i._rigCameras[1]._rigPostProcess=new gp("VR_Distort_Compensation_Right",i._rigCameras[1],!0,e))},Z.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new hy(i,0,0,1,d.e.Zero(),t)}});var hy=function(i){function t(e,n,r,o,l,h,v,b){v===void 0&&(v=!0),b===void 0&&(b=cs.GetDefault());var A=i.call(this,e,n,r,o,l,h)||this;return b.compensateDistortion=v,A.setCameraRigMode(Tt.a.RIG_MODE_VR,{vrCameraMetrics:b}),A.inputs.addVRDeviceOrientation(),A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(Mi);Z.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(i,t){return function(){return new Xu(i,d.e.Zero(),t)}});var Xu=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=cs.GetDefault());var h=i.call(this,e,n,r)||this;return l.compensateDistortion=o,h.setCameraRigMode(Tt.a.RIG_MODE_VR,{vrCameraMetrics:l}),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(Io);Z.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(i,t){return function(){return new dy(i,d.e.Zero(),t)}});var dy=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=cs.GetDefault());var h=i.call(this,e,n,r,o,l)||this;return h.inputs.addGamepad(),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(Xu),Yu=c(86);Tt.a._setWebVRRigMode=function(i,t){if(t.vrDisplay){var e=t.vrDisplay.getEyeParameters("left"),n=t.vrDisplay.getEyeParameters("right");i._rigCameras[0].viewport=new $r.a(0,0,.5,1),i._rigCameras[0].setCameraRigParameter("left",!0),i._rigCameras[0].setCameraRigParameter("specs",t.specs),i._rigCameras[0].setCameraRigParameter("eyeParameters",e),i._rigCameras[0].setCameraRigParameter("frameData",t.frameData),i._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[0]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[0].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[0].parent=i,i._rigCameras[0]._getViewMatrix=i._getWebVRViewMatrix,i._rigCameras[1].viewport=new $r.a(.5,0,.5,1),i._rigCameras[1].setCameraRigParameter("eyeParameters",n),i._rigCameras[1].setCameraRigParameter("specs",t.specs),i._rigCameras[1].setCameraRigParameter("frameData",t.frameData),i._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),i._rigCameras[1]._cameraRigParams.vrWorkMatrix=new d.a,i._rigCameras[1].getProjectionMatrix=i._getWebVRProjectionMatrix,i._rigCameras[1].parent=i,i._rigCameras[1]._getViewMatrix=i._getWebVRViewMatrix}},Object.defineProperty(Xe.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Xe.a.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new E.c,this.onVRRequestPresentComplete=new E.c,this.onVRRequestPresentStart=new E.c},Xe.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},Xe.a.prototype.getVRDevice=function(){return this._vrDisplay},Xe.a.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},Xe.a.prototype.initWebVRAsync=function(){var i=this,t=function(){var n={vrDisplay:i._vrDisplay,vrSupported:i._vrSupported};i.onVRDisplayChangedObservable.notifyObservers(n),i._webVRInitPromise=new Promise(function(r){r(n)})};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(n){i._vrDisplay=n.display,t()},this._onVrDisplayDisconnect=function(){i._vrDisplay.cancelAnimationFrame(i._frameHandler),i._vrDisplay=void 0,i._frameHandler=Xe.a.QueueNewFrame(i._boundRenderFunction),t()},this._onVrDisplayPresentChange=function(){i._vrExclusivePointerMode=i._vrDisplay&&i._vrDisplay.isPresenting};var e=this.getHostWindow();e&&(e.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),e.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),e.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},Xe.a.prototype._getVRDisplaysAsync=function(){var i=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){i._vrSupported=!0,i._vrDisplay=e[0],t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported})}):(i._vrDisplay=void 0,i._vrSupported=!1,t({vrDisplay:i._vrDisplay,vrSupported:i._vrSupported}))})},Xe.a.prototype.enableVR=function(i){var t=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var e={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&i.useMultiview};this._vrDisplay.requestPresent([Object(_.a)({source:this.getRenderingCanvas(),attributes:e},e)]).then(function(){t.onVRRequestPresentComplete.notifyObservers(!0),t._onVRFullScreenTriggered()}).catch(function(){t.onVRRequestPresentComplete.notifyObservers(!1)})}},Xe.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new le.a(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var i=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*i.renderWidth,i.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},Xe.a.prototype.disableVR=function(){var i=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return i._onVRFullScreenTriggered()}).catch(function(){return i._onVRFullScreenTriggered()}),as.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},Xe.a.prototype._connectVREvents=function(i,t){var e=this;if(this._onVRDisplayPointerRestricted=function(){i&&i.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(t)t.exitPointerLock&&t.exitPointerLock();else{var r=e.getHostWindow();r.document&&r.document.exitPointerLock&&r.document.exitPointerLock()}},as.a.IsWindowObjectExist()){var n=this.getHostWindow();n.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),n.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},Xe.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(i){Qe.b.Warn("webVR submitFrame has had an unexpected failure: "+i)}},Xe.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},Xe.a.prototype._requestVRFrame=function(){this._frameHandler=Xe.a.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)},Z.a.AddNodeConstructor("WebVRFreeCamera",function(i,t){return function(){return new Ku(i,d.e.Zero(),t)}}),Z.a.AddNodeConstructor("WebVRGamepadCamera",function(i,t){return function(){return new Ku(i,d.e.Zero(),t)}});var Ku=function(i){function t(e,n,r,o){o===void 0&&(o={});var l=i.call(this,e,n,r)||this;l.webVROptions=o,l._vrDevice=null,l.rawPose=null,l._specsVersion="1.1",l._attached=!1,l._descendants=[],l._deviceRoomPosition=d.e.Zero(),l._deviceRoomRotationQuaternion=d.b.Identity(),l._standingMatrix=null,l.devicePosition=d.e.Zero(),l.deviceRotationQuaternion=d.b.Identity(),l.deviceScaleFactor=1,l._deviceToWorld=d.a.Identity(),l._worldToDevice=d.a.Identity(),l.controllers=[],l.onControllersAttachedObservable=new E.c,l.onControllerMeshLoadedObservable=new E.c,l.onPoseUpdatedFromDeviceObservable=new E.c,l._poseSet=!1,l.rigParenting=!0,l._defaultHeight=void 0,l._detachIfAttached=function(){var v=l.getEngine().getVRDevice();v&&!v.isPresenting&&l.detachControl()},l._workingVector=d.e.Zero(),l._oneVector=d.e.One(),l._workingMatrix=d.a.Identity(),l._tmpMatrix=new d.a,l._cache.position=d.e.Zero(),o.defaultHeight&&(l._defaultHeight=o.defaultHeight,l.position.y=l._defaultHeight),l.minZ=.1,arguments.length===5&&(l.webVROptions=arguments[4]),l.webVROptions.trackPosition==null&&(l.webVROptions.trackPosition=!0),l.webVROptions.controllerMeshes==null&&(l.webVROptions.controllerMeshes=!0),l.webVROptions.defaultLightingOnControllers==null&&(l.webVROptions.defaultLightingOnControllers=!0),l.rotationQuaternion=new d.b,l.webVROptions&&l.webVROptions.positionScale&&(l.deviceScaleFactor=l.webVROptions.positionScale);var h=l.getEngine();return l._onVREnabled=function(v){v&&l.initControllers()},h.onVRRequestPresentComplete.add(l._onVREnabled),h.initWebVR().add(function(v){v.vrDisplay&&l._vrDevice!==v.vrDisplay&&(l._vrDevice=v.vrDisplay,l.setCameraRigMode(Tt.a.RIG_MODE_WEBVR,{parentCamera:l,vrDisplay:l._vrDevice,frameData:l._frameData,specs:l._specsVersion}),l._attached&&l.getEngine().enableVR(l.webVROptions))}),typeof VRFrameData!="undefined"&&(l._frameData=new VRFrameData),o.useMultiview&&(l.getScene().getEngine().getCaps().multiview?(l._useMultiviewToSingleView=!0,l._rigPostProcess=new bp("VRMultiviewToSingleview",l,1)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),l._useMultiviewToSingleView=!1)),r.onBeforeCameraRenderObservable.add(function(v){v.parent===l&&l.rigParenting&&(l._descendants=l.getDescendants(!0,function(b){var A=l.controllers.some(function(N){return N._mesh===b}),D=l._rigCameras.indexOf(b)!==-1;return!A&&!D}),l._descendants.forEach(function(b){b.parent=v}))}),r.onAfterCameraRenderObservable.add(function(v){v.parent===l&&l.rigParenting&&l._descendants.forEach(function(b){b.parent=l})}),l}return Object(_.d)(t,i),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var n=this;e===void 0&&(e=function(r){}),this.getEngine().initWebVRAsync().then(function(r){r.vrDisplay&&r.vrDisplay.stageParameters&&r.vrDisplay.stageParameters.sittingToStandingTransform&&n.webVROptions.trackPosition?(n._standingMatrix=new d.a,d.a.FromFloat32ArrayToRefScaled(r.vrDisplay.stageParameters.sittingToStandingTransform,0,1,n._standingMatrix),n.getScene().useRightHandedSystem||n._standingMatrix&&n._standingMatrix.toggleModelMatrixHandInPlace(),e(!0)):e(!1)})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(n){e.useStandingMatrix(function(r){n(r)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),i.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var n=0,r=this.controllers;n<r.length;n++){var o=r[n];if(o.hand===e)return o}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){return e===void 0&&(e=100),this.leftCamera?i.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):i.prototype.getForwardRay.call(this,e)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),i.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&e.orientation.length===4&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(e){e=Qe.b.BackCompatCameraNoPreventDefault(arguments),i.prototype.attachControl.call(this,e),this._attached=!0,e=!Tt.a.ForceAttachControlToAlwaysPreventDefault&&e,this._vrDevice&&this.getEngine().enableVR(this.webVROptions);var n=this._scene.getEngine().getHostWindow();n&&n.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),i.prototype.detachControl.call(this),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],n=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),n.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),n.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,n){n===void 0&&(n=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(d.a.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),n||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(e){var n=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),d.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),d.a.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(r){r._deviceToWorld.copyFrom(n._deviceToWorld),n._correctPositionIfNotTrackPosition(r._deviceToWorld),r.update()})),e||i.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){d.e.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),d.a.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),d.b.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),i.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return d.a.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;e._updateCache();var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return d.a.FromArrayToRef(n,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),d.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.deviceScaleFactor!==1&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||d.a.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ;var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return d.a.FromArrayToRef(n,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers=[];var n=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(r){if(r.type===Mn.POSE_ENABLED){var o=r;o.defaultModel&&o.defaultModel.setEnabled(!1),o.hand==="right"&&(e._rightController=null),o.hand==="left"&&(e._leftController=null);var l=e.controllers.indexOf(o);l!==-1&&e.controllers.splice(l,1)}}),this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(r){if(r.type===Mn.POSE_ENABLED){var o=r;if(e.webVROptions.trackPosition||(o._disableTrackPosition(new d.e(o.hand=="left"?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),o.deviceScaleFactor=e.deviceScaleFactor,o._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(o._deviceToWorld),e.webVROptions.controllerMeshes&&(o.defaultModel?o.defaultModel.setEnabled(!0):o.initControllerMesh(e.getScene(),function(v){if(v.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(o),e.webVROptions.defaultLightingOnControllers){e._lightOnControllers||(e._lightOnControllers=new Yu.a("vrControllersLight",new d.e(0,1,0),e.getScene()));var b=function(A,D){var N=A.getChildren();N&&N.length!==0&&N.forEach(function(j){D.includedOnlyMeshes.push(j),b(j,D)})};e._lightOnControllers.includedOnlyMeshes.push(v),b(v,e._lightOnControllers)}})),o.attachToPoseControlledCamera(e),e.controllers.indexOf(o)===-1){e.controllers.push(o);for(var l=!1,h=0;h<e.controllers.length;h++)e.controllers[h].controllerType===kr.VIVE&&(l?e.controllers[h].hand="right":(l=!0,e.controllers[h].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(dr),Lo=function(i){function t(e){var n=i.call(this,e)||this;return n.onTriggerStateChangedObservable=new E.c,n.onMainButtonStateChangedObservable=new E.c,n.onSecondaryButtonStateChangedObservable=new E.c,n.onPadStateChangedObservable=new E.c,n.onPadValuesChangedObservable=new E.c,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(e.buttons.length),n.hand=e.hand,n}return Object(_.d)(t,i),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0}),t.prototype.update=function(){i.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[e],this._buttons[e],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,n,r){e||(e={pressed:!1,touched:!1,value:0}),n?(this._checkChanges(e,n),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,r,e),this._handleButtonChange(r,e,this._changes)),this._buttons[r].pressed=e.pressed,this._buttons[r].touched=e.touched,this._buttons[r].value=e.value<1e-8?0:e.value):this._buttons[r]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,n){return this._changes.pressChanged=e.pressed!==n.pressed,this._changes.touchChanged=e.touched!==n.touched,this._changes.valueChanged=e.value!==n.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(Ie),Jn=c(42),Qt=c(30),Zi=c(62),K1=(c(108),c(59),c(109),`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`);We.a.ShadersStore.imageProcessingPixelShader=K1;var Qu=function(i){function t(e,n,r,o,l,h,v,b){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var A=i.call(this,e,"imageProcessing",[],[],n,r,o,l,h,null,v,"postprocess",null,!0)||this;return A._fromLinearSpace=!0,A._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},b?(b.applyByPostProcess=!0,A._attachImageProcessingConfiguration(b,!0),A.fromLinearSpace=!1):(A._attachImageProcessingConfiguration(null,!0),A.imageProcessingConfiguration.applyByPostProcess=!0),A.onApply=function(D){A.imageProcessingConfiguration.bind(D,A.aspectRatio)},A}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){e.applyByPostProcess=!0,this._attachImageProcessingConfiguration(e)},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,n){var r=this;if(n===void 0&&(n=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var o=null,l=this.getEngine(),h=this.getCamera();if(h)o=h.getScene();else if(l&&l.scenes){var v=l.scenes;o=v[v.length-1]}else o=$.a.LastCreatedScene;this._imageProcessingConfiguration=o?o.imageProcessingConfiguration:new Jn.a}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){r._updateParameters()})),n||this._updateParameters()}},Object.defineProperty(t.prototype,"isSupported",{get:function(){var e=this.getEffect();return!e||e.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var n in this._defines)this._defines[n]&&(e+="#define "+n+`;\r
`);var r=["textureSampler"],o=["scale"];Jn.a&&(Jn.a.PrepareSamplers(r,this._defines),Jn.a.PrepareUniforms(o,this._defines)),this.updateEffect(e,o,r)},t.prototype.dispose=function(e){i.prototype.dispose.call(this,e),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},Object(_.c)([Object(V.c)()],t.prototype,"_fromLinearSpace",void 0),t}(bt),_t=c(16),Me=c(4);Ne.a._GroundMeshParser=function(i,t){return qu.Parse(i,t)};var qu=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.generateOctree=!1,r}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),t.prototype.optimize=function(e,n){n===void 0&&(n=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(n)},t.prototype.getHeightAtCoordinates=function(e,n){var r=this.getWorldMatrix(),o=d.c.Matrix[5];r.invertToRef(o);var l=d.c.Vector3[8];if(d.e.TransformCoordinatesFromFloatsToRef(e,0,n,o,l),e=l.x,n=l.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this.position.y;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var h=this._getFacetAt(e,n),v=-(h.x*e+h.z*n+h.w)/h.y;return d.e.TransformCoordinatesFromFloatsToRef(0,v,0,r,l),l.y},t.prototype.getNormalAtCoordinates=function(e,n){var r=new d.e(0,1,0);return this.getNormalAtCoordinatesToRef(e,n,r),r},t.prototype.getNormalAtCoordinatesToRef=function(e,n,r){var o=this.getWorldMatrix(),l=d.c.Matrix[5];o.invertToRef(l);var h=d.c.Vector3[8];if(d.e.TransformCoordinatesFromFloatsToRef(e,0,n,l,h),e=h.x,n=h.z,e<this._minX||e>this._maxX||n<this._minZ||n>this._maxZ)return this;this._heightQuads&&this._heightQuads.length!=0||(this._initHeightQuads(),this._computeHeightQuads());var v=this._getFacetAt(e,n);return d.e.TransformNormalFromFloatsToRef(v.x,v.y,v.z,o,r),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&this._heightQuads.length!=0||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,n){var r=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(n+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),l=this._heightQuads[o*this._subdivisionsX+r];return n<l.slope.x*e+l.slope.y?l.facet1:l.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,n=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<n;r++)for(var o=0;o<e;o++){var l={slope:d.d.Zero(),facet1:new d.f(0,0,0,0),facet2:new d.f(0,0,0,0)};this._heightQuads[r*e+o]=l}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(Me.b.PositionKind);if(!e)return this;for(var n=d.c.Vector3[3],r=d.c.Vector3[2],o=d.c.Vector3[1],l=d.c.Vector3[0],h=d.c.Vector3[4],v=d.c.Vector3[5],b=d.c.Vector3[6],A=d.c.Vector3[7],D=d.c.Vector3[8],N=0,j=0,k=0,H=0,J=0,te=0,oe=0,ce=this._subdivisionsX,he=this._subdivisionsY,_e=0;_e<he;_e++)for(var ye=0;ye<ce;ye++){N=3*ye,j=_e*(ce+1)*3,k=(_e+1)*(ce+1)*3,n.x=e[j+N],n.y=e[j+N+1],n.z=e[j+N+2],r.x=e[j+N+3],r.y=e[j+N+4],r.z=e[j+N+5],o.x=e[k+N],o.y=e[k+N+1],o.z=e[k+N+2],l.x=e[k+N+3],l.y=e[k+N+4],l.z=e[k+N+5],H=(l.z-n.z)/(l.x-n.x),J=n.z-H*n.x,r.subtractToRef(n,h),o.subtractToRef(n,v),l.subtractToRef(n,b),d.e.CrossToRef(b,v,A),d.e.CrossToRef(h,b,D),A.normalize(),D.normalize(),te=-(A.x*n.x+A.y*n.y+A.z*n.z),oe=-(D.x*r.x+D.y*r.y+D.z*r.z);var Ee=this._heightQuads[_e*ce+ye];Ee.slope.copyFromFloats(H,J),Ee.facet1.copyFromFloats(A.x,A.y,A.z,te),Ee.facet2.copyFromFloats(D.x,D.y,D.z,oe)}return this},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},t.Parse=function(e,n){var r=new t(e.name,n);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},t}(Ne.a),yp=c(70);_t.a.CreateGround=function(i){var t,e,n=[],r=[],o=[],l=[],h=i.width||1,v=i.height||1,b=i.subdivisionsX||i.subdivisions||1,A=i.subdivisionsY||i.subdivisions||1;for(t=0;t<=A;t++)for(e=0;e<=b;e++){var D=new d.e(e*h/b-h/2,0,(A-t)*v/A-v/2),N=new d.e(0,1,0);r.push(D.x,D.y,D.z),o.push(N.x,N.y,N.z),l.push(e/b,1-t/A)}for(t=0;t<A;t++)for(e=0;e<b;e++)n.push(e+1+(t+1)*(b+1)),n.push(e+1+t*(b+1)),n.push(e+t*(b+1)),n.push(e+(t+1)*(b+1)),n.push(e+1+(t+1)*(b+1)),n.push(e+t*(b+1));var j=new _t.a;return j.indices=n,j.positions=r,j.normals=o,j.uvs=l,j},_t.a.CreateTiledGround=function(i){var t,e,n,r,o=i.xmin!==void 0&&i.xmin!==null?i.xmin:-1,l=i.zmin!==void 0&&i.zmin!==null?i.zmin:-1,h=i.xmax!==void 0&&i.xmax!==null?i.xmax:1,v=i.zmax!==void 0&&i.zmax!==null?i.zmax:1,b=i.subdivisions||{w:1,h:1},A=i.precision||{w:1,h:1},D=new Array,N=new Array,j=new Array,k=new Array;b.h=b.h<1?1:b.h,b.w=b.w<1?1:b.w,A.w=A.w<1?1:A.w,A.h=A.h<1?1:A.h;var H=(h-o)/b.w,J=(v-l)/b.h;function te(ce,he,_e,ye){var Ee=N.length/3,Oe=A.w+1;for(t=0;t<A.h;t++)for(e=0;e<A.w;e++){var Ae=[Ee+e+t*Oe,Ee+(e+1)+t*Oe,Ee+(e+1)+(t+1)*Oe,Ee+e+(t+1)*Oe];D.push(Ae[1]),D.push(Ae[2]),D.push(Ae[3]),D.push(Ae[0]),D.push(Ae[1]),D.push(Ae[3])}var xe=d.e.Zero(),Pe=new d.e(0,1,0);for(t=0;t<=A.h;t++)for(xe.z=t*(ye-he)/A.h+he,e=0;e<=A.w;e++)xe.x=e*(_e-ce)/A.w+ce,xe.y=0,N.push(xe.x,xe.y,xe.z),j.push(Pe.x,Pe.y,Pe.z),k.push(e/A.w,t/A.h)}for(n=0;n<b.h;n++)for(r=0;r<b.w;r++)te(o+r*H,l+n*J,o+(r+1)*H,l+(n+1)*J);var oe=new _t.a;return oe.indices=D,oe.positions=N,oe.normals=j,oe.uvs=k,oe},_t.a.CreateGroundFromHeightMap=function(i){var t,e,n=[],r=[],o=[],l=[],h=i.colorFilter||new x.a(.3,.59,.11),v=i.alphaFilter||0,b=!1;if(i.minHeight>i.maxHeight){b=!0;var A=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=A}for(t=0;t<=i.subdivisions;t++)for(e=0;e<=i.subdivisions;e++){var D=new d.e(e*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-t)*i.height/i.subdivisions-i.height/2),N=4*(((D.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(D.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth),j=i.buffer[N]/255,k=i.buffer[N+1]/255,H=i.buffer[N+2]/255,J=i.buffer[N+3]/255;b&&(j=1-j,k=1-k,H=1-H);var te=j*h.r+k*h.g+H*h.b;D.y=J>=v?i.minHeight+(i.maxHeight-i.minHeight)*te:i.minHeight-Gt.a,r.push(D.x,D.y,D.z),o.push(0,0,0),l.push(e/i.subdivisions,1-t/i.subdivisions)}for(t=0;t<i.subdivisions;t++)for(e=0;e<i.subdivisions;e++){var oe=e+1+(t+1)*(i.subdivisions+1),ce=e+1+t*(i.subdivisions+1),he=e+t*(i.subdivisions+1),_e=e+(t+1)*(i.subdivisions+1),ye=r[3*oe+1]>=i.minHeight,Ee=r[3*ce+1]>=i.minHeight,Oe=r[3*he+1]>=i.minHeight;ye&&Ee&&Oe&&(n.push(oe),n.push(ce),n.push(he)),r[3*_e+1]>=i.minHeight&&ye&&Oe&&(n.push(_e),n.push(oe),n.push(he))}_t.a.ComputeNormals(r,n,o);var Ae=new _t.a;return Ae.indices=n,Ae.positions=r,Ae.normals=o,Ae.uvs=l,Ae},Ne.a.CreateGround=function(i,t,e,n,r,o){var l={width:t,height:e,subdivisions:n,updatable:o};return No.CreateGround(i,l,r)},Ne.a.CreateTiledGround=function(i,t,e,n,r,o,l,h,v){var b={xmin:t,zmin:e,xmax:n,zmax:r,subdivisions:o,precision:l,updatable:v};return No.CreateTiledGround(i,b,h)},Ne.a.CreateGroundFromHeightMap=function(i,t,e,n,r,o,l,h,v,b,A){var D={width:e,height:n,subdivisions:r,minHeight:o,maxHeight:l,updatable:v,onReady:b,alphaFilter:A};return No.CreateGroundFromHeightMap(i,t,D,h)};var No=function(){function i(){}return i.CreateGround=function(t,e,n){var r=new qu(t,n);return r._setReady(!1),r._subdivisionsX=e.subdivisionsX||e.subdivisions||1,r._subdivisionsY=e.subdivisionsY||e.subdivisions||1,r._width=e.width||1,r._height=e.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,_t.a.CreateGround(e).applyToMesh(r,e.updatable),r._setReady(!0),r},i.CreateTiledGround=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return _t.a.CreateTiledGround(e).applyToMesh(r,e.updatable),r},i.CreateGroundFromHeightMap=function(t,e,n,r){r===void 0&&(r=null);var o=n.width||10,l=n.height||10,h=n.subdivisions||1,v=n.minHeight||0,b=n.maxHeight||1,A=n.colorFilter||new x.a(.3,.59,.11),D=n.alphaFilter||0,N=n.updatable,j=n.onReady;r=r||$.a.LastCreatedScene;var k=new qu(t,r);return k._subdivisionsX=h,k._subdivisionsY=h,k._width=o,k._height=l,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),Qe.b.LoadImage(e,function(H){var J=H.width,te=H.height,oe=yp.a.CreateCanvas(J,te).getContext("2d");if(!oe)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!r.isDisposed){oe.drawImage(H,0,0);var ce=oe.getImageData(0,0,J,te).data;_t.a.CreateGroundFromHeightMap({width:o,height:l,subdivisions:h,minHeight:v,maxHeight:b,colorFilter:A,buffer:ce,bufferWidth:J,bufferHeight:te,alphaFilter:D}).applyToMesh(k,N),j&&j(k),k._setReady(!0)}},function(){},r.offlineProvider),k},i}();_t.a.CreateTorus=function(i){for(var t=[],e=[],n=[],r=[],o=i.diameter||1,l=i.thickness||.5,h=i.tessellation||16,v=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE,b=h+1,A=0;A<=h;A++)for(var D=A/h,N=A*Math.PI*2/h-Math.PI/2,j=d.a.Translation(o/2,0,0).multiply(d.a.RotationY(N)),k=0;k<=h;k++){var H=1-k/h,J=k*Math.PI*2/h+Math.PI,te=Math.cos(J),oe=Math.sin(J),ce=new d.e(te,oe,0),he=ce.scale(l/2),_e=new d.d(D,H);he=d.e.TransformCoordinates(he,j),ce=d.e.TransformNormal(ce,j),e.push(he.x,he.y,he.z),n.push(ce.x,ce.y,ce.z),r.push(_e.x,_e.y);var ye=(A+1)%b,Ee=(k+1)%b;t.push(A*b+k),t.push(A*b+Ee),t.push(ye*b+k),t.push(A*b+Ee),t.push(ye*b+Ee),t.push(ye*b+k)}_t.a._ComputeSides(v,e,t,n,r,i.frontUVs,i.backUVs);var Oe=new _t.a;return Oe.indices=t,Oe.positions=e,Oe.normals=n,Oe.uvs=r,Oe},Ne.a.CreateTorus=function(i,t,e,n,r,o,l){var h={diameter:t,thickness:e,tessellation:n,sideOrientation:l,updatable:o};return ls.CreateTorus(i,h,r)};var zn,Sa,ls=function(){function i(){}return i.CreateTorus=function(t,e,n){var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateTorus(e).applyToMesh(r,e.updatable),r},i}(),wi=c(53),Tp=function(){function i(){}return i.GetDefaults=function(t){var e=new i;return e.canvasOptions={antialias:!0,depth:!0,stencil:!t||t.isStencilEnable,alpha:!0,multiview:!1,framebufferScaleFactor:1},e.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",e},i}(),fy=function(){function i(t,e){var n=this;if(e===void 0&&(e=Tp.GetDefaults()),this._options=e,this._canvas=null,this.xrLayer=null,this.onXRLayerInitObservable=new E.c,this._engine=t.scene.getEngine(),e.canvasElement)this._setManagedOutputCanvas(e.canvasElement);else{var r=document.createElement("canvas");r.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(r)}t.onXRSessionInit.add(function(){n._addCanvas()}),t.onXRSessionEnded.add(function(){n._removeCanvas()})}return i.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},i.prototype.initializeXRLayerAsync=function(t){var e=this,n=function(){var r=new XRWebGLLayer(t,e.canvasContext,e._options.canvasOptions);return e.onXRLayerInitObservable.notifyObservers(r),r};return this.canvasContext.makeXRCompatible?this.canvasContext.makeXRCompatible().then(function(){return e.xrLayer=n(),e.xrLayer}):(this.xrLayer=n(),Promise.resolve(this.xrLayer))},i.prototype._addCanvas=function(){var t=this;this._canvas&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce(function(e){t._setCanvasSize(!0,e)})},i.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)},i.prototype._setCanvasSize=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=this.xrLayer),this._canvas&&(t?e&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=e.framebufferWidth+"px",this._canvas.style.height=e.framebufferHeight+"px"):this._engine.setSize(e.framebufferWidth,e.framebufferHeight)):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))},i.prototype._setManagedOutputCanvas=function(t){this._removeCanvas(),t?(this._originalCanvasSize={width:t.offsetWidth,height:t.offsetHeight},this._canvas=t,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},i}(),Ep=function(){function i(t){this.scene=t,this._sessionEnded=!1,this.baseLayer=null,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new E.c,this.onXRReferenceSpaceChanged=new E.c,this.onXRSessionEnded=new E.c,this.onXRSessionInit=new E.c}return Object.defineProperty(i.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(t){this._referenceSpace=t,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._sessionEnded||this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear()},i.prototype.exitXRAsync=function(){return this.session&&!this._sessionEnded?(this._sessionEnded=!0,this.session.end().catch(function(t){p.a.Warn("Could not end XR session.")})):Promise.resolve()},i.prototype.getRenderTargetTextureForEye=function(t){return this._rttProvider.getRenderTargetForEye(t)},i.prototype.getWebXRRenderTarget=function(t){var e=this.scene.getEngine();return this._xrNavigator.xr.native?this._xrNavigator.xr.getWebXRRenderTarget(e):((t=t||Tp.GetDefaults(e)).canvasElement=e.getRenderingCanvas()||void 0,new fy(this,t))},i.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},i.prototype.initializeSessionAsync=function(t,e){var n=this;return t===void 0&&(t="immersive-vr"),e===void 0&&(e={}),this._xrNavigator.xr.requestSession(t,e).then(function(r){return n.session=r,n.onXRSessionInit.notifyObservers(r),n._sessionEnded=!1,n.session.addEventListener("end",function(){var o=n.scene.getEngine();n._sessionEnded=!0,n._rttProvider=null,o.framebufferDimensionsObject=null,o.restoreDefaultFramebuffer(),o.customAnimationFrameRequester=null,n.onXRSessionEnded.notifyObservers(null),o._renderLoop()},{once:!0}),n.session})},i.prototype.isSessionSupportedAsync=function(t){return i.IsSessionSupportedAsync(t)},i.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},i.prototype.runXRRenderLoop=function(){var t=this,e=this.scene.getEngine();if(e.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(r,o){t._sessionEnded||(t.currentFrame=o,t.currentTimestamp=r,o&&(e.framebufferDimensionsObject=t.baseLayer,t.onXRFrameObservable.notifyObservers(o),e._renderLoop(),e.framebufferDimensionsObject=null))}},this._xrNavigator.xr.native)this._rttProvider=this._xrNavigator.xr.getNativeRenderTargetProvider(this.session,this._createRenderTargetTexture.bind(this));else{var n=this._createRenderTargetTexture(this.baseLayer.framebufferWidth,this.baseLayer.framebufferHeight,this.baseLayer.framebuffer);this._rttProvider={getRenderTargetForEye:function(){return n}},e.framebufferDimensionsObject=this.baseLayer}typeof window!="undefined"&&window.cancelAnimationFrame&&window.cancelAnimationFrame(e._frameHandler),e._renderLoop()},i.prototype.setReferenceSpaceTypeAsync=function(t){var e=this;return t===void 0&&(t="local-floor"),this.session.requestReferenceSpace(t).then(function(n){return n},function(n){return p.a.Error("XR.requestReferenceSpace failed for the following reason: "),p.a.Error(n),p.a.Log('Defaulting to universally-supported "viewer" reference space type.'),e.session.requestReferenceSpace("viewer").then(function(r){var o=new XRRigidTransform({x:0,y:-e.defaultHeightCompensation,z:0});return r.getOffsetReferenceSpace(o)},function(r){throw p.a.Error(r),'XR initialization failed: required "viewer" reference space type not supported.'})}).then(function(n){return e.session.requestReferenceSpace("viewer").then(function(r){return e.viewerReferenceSpace=r,n})}).then(function(n){return e.referenceSpace=e.baseReferenceSpace=n,e.referenceSpace})},i.prototype.updateRenderStateAsync=function(t){return t.baseLayer&&(this.baseLayer=t.baseLayer),this.session.updateRenderState(t)},i.IsSessionSupportedAsync=function(t){if(!navigator.xr)return Promise.resolve(!1);var e=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return e?e.call(navigator.xr,t).then(function(n){var r=n===void 0||n;return Promise.resolve(r)}).catch(function(n){return p.a.Warn(n),Promise.resolve(!1)}):Promise.resolve(!1)},i.prototype._createRenderTargetTexture=function(t,e,n){n===void 0&&(n=null);var r=new Mt.a(this.scene.getEngine(),Mt.b.Unknown,!0);r.width=t,r.height=e,r._framebuffer=n;var o=new Un("XR renderTargetTexture",{width:t,height:e},this.scene,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return o._texture=r,o},i}();(function(i){i[i.ENTERING_XR=0]="ENTERING_XR",i[i.EXITING_XR=1]="EXITING_XR",i[i.IN_XR=2]="IN_XR",i[i.NOT_IN_XR=3]="NOT_IN_XR"})(zn||(zn={})),function(i){i[i.NOT_TRACKING=0]="NOT_TRACKING",i[i.TRACKING_LOST=1]="TRACKING_LOST",i[i.TRACKING=2]="TRACKING"}(Sa||(Sa={}));var hi,py=function(){function i(t,e){if(e===void 0&&(e=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=i._idCounter++,e)this._gazeTracker=e.clone("gazeTracker");else{this._gazeTracker=Ne.a.CreateTorus("gazeTracker",.0035,.0025,20,t,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var n=new Qt.a("targetMat",t);n.specularColor=x.a.Black(),n.emissiveColor=new x.a(.7,.7,.7),n.backFaceCulling=!1,this._gazeTracker.material=n}}return i.prototype._getForwardRay=function(t){return new Bn.a(d.e.Zero(),new d.e(0,0,t))},i.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},i.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},i.prototype._activatePointer=function(){this._activePointer=!0},i.prototype._deactivatePointer=function(){this._activePointer=!1},i.prototype._updatePointerDistance=function(t){},i.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},i._idCounter=0,i}(),Q1=function(i){function t(e,n,r){var o=i.call(this,n,r)||this;o.webVRController=e,o._laserPointer=Ne.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,n,!1);var l=new Qt.a("laserPointerMat",n);if(l.emissiveColor=new x.a(.7,.7,.7),l.alpha=.6,o._laserPointer.material=l,o._laserPointer.rotation.x=Math.PI/2,o._laserPointer.position.z=-.5,o._laserPointer.isVisible=!1,o._laserPointer.isPickable=!1,!e.mesh){var h=new Ne.a("preloadControllerMesh",n),v=new Ne.a(Ie.POINTING_POSE,n);v.rotation.x=-.7,h.addChild(v),e.attachToMesh(h)}return o._setLaserPointerParent(e.mesh),o._meshAttachedObserver=e._meshAttachedObservable.add(function(b){o._setLaserPointerParent(b)}),o}return Object(_.d)(t,i),t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){i.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){i.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerLightingDisabled=function(e){this._laserPointer.material.disableLighting=e},t.prototype._setLaserPointerParent=function(e){var n=function(h){h.isPickable=!1,h.getChildMeshes().forEach(function(v){n(v)})};n(e);var r=e.getChildren(void 0,!1),o=e;this.webVRController._pointingPoseNode=null;for(var l=0;l<r.length;l++)if(r[l].name&&r[l].name.indexOf(Ie.POINTING_POSE)>=0){o=r[l],this.webVRController._pointingPoseNode=o;break}this._laserPointer.parent=o},t.prototype._updatePointerDistance=function(e){e===void 0&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(py),my=function(i){function t(e,n){var r=i.call(this,n)||this;return r.getCamera=e,r}return Object(_.d)(t,i),t.prototype._getForwardRay=function(e){var n=this.getCamera();return n?n.getForwardRay(e):new Bn.a(d.e.Zero(),d.e.Forward())},t}(py),q1=function(){},_y=function(){function i(t,e){var n=this;if(e===void 0&&(e={}),this.webVROptions=e,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new E.c,this.onAfterEnteringVRObservable=new E.c,this.onExitingVRObservable=new E.c,this.onControllerMeshLoadedObservable=new E.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=i.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new d.e(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new d.e(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new x.a(.7,.7,.7),this._laserColor=new x.a(.7,.7,.7),this._pickedLaserColor=new x.a(.2,.2,1),this._pickedGazeColor=new x.a(0,0,1),this.onNewMeshSelected=new E.c,this.onMeshSelectedWithController=new E.c,this.onNewMeshPicked=new E.c,this.onBeforeCameraTeleport=new E.c,this.onAfterCameraTeleport=new E.c,this.onSelectedMeshUnselected=new E.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){n.moveButtonToBottomRight(),n._fullscreenVRpresenting&&n._webVRready&&n.exitVR()},this._onFullscreenChange=function(){var o=document;o.fullscreen!==void 0?n._fullscreenVRpresenting=document.fullscreen:o.mozFullScreen!==void 0?n._fullscreenVRpresenting=o.mozFullScreen:o.webkitIsFullScreen!==void 0?n._fullscreenVRpresenting=o.webkitIsFullScreen:o.msIsFullScreen!==void 0?n._fullscreenVRpresenting=o.msIsFullScreen:document.msFullscreenElement!==void 0&&(n._fullscreenVRpresenting=document.msFullscreenElement),!n._fullscreenVRpresenting&&n._inputElement&&(n.exitVR(),!n._useCustomVRButton&&n._btnVR&&(n._btnVR.style.top=n._inputElement.offsetTop+n._inputElement.offsetHeight-70+"px",n._btnVR.style.left=n._inputElement.offsetLeft+n._inputElement.offsetWidth-100+"px",n.updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){n._leftController&&n._leftController._activePointer&&n._castRayAndSelectObject(n._leftController),n._rightController&&n._rightController._activePointer&&n._castRayAndSelectObject(n._rightController),n._noControllerIsActive&&(n._scene.getEngine().isPointerLock||n.enableGazeEvenWhenNoPointerLock)?n._castRayAndSelectObject(n._cameraGazer):n._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(o){if(o.type!==Mn.POSE_ENABLED)o.leftStick&&o.onleftstickchanged(function(v){n._teleportationInitialized&&n.teleportationEnabled&&(!n._leftController&&!n._rightController||n._leftController&&!n._leftController._activePointer&&n._rightController&&!n._rightController._activePointer)&&(n._checkTeleportWithRay(v,n._cameraGazer),n._checkTeleportBackwards(v,n._cameraGazer))}),o.rightStick&&o.onrightstickchanged(function(v){n._teleportationInitialized&&n._checkRotate(v,n._cameraGazer)}),o.type===Mn.XBOX&&(o.onbuttondown(function(v){n._interactionsEnabled&&v===ir.A&&n._cameraGazer._selectionPointerDown()}),o.onbuttonup(function(v){n._interactionsEnabled&&v===ir.A&&n._cameraGazer._selectionPointerUp()}));else{var l=o,h=new Q1(l,n._scene,n._cameraGazer._gazeTracker);l.hand==="right"||n._leftController&&n._leftController.webVRController!=l?n._rightController=h:n._leftController=h,n._tryEnableInteractionOnController(h)}},this._tryEnableInteractionOnController=function(o){n._interactionsRequested&&!o._interactionsEnabled&&n._enableInteractionOnController(o),n._teleportationRequested&&!o._teleportationEnabled&&n._enableTeleportationOnController(o)},this._onNewGamepadDisconnected=function(o){o instanceof Lo&&(o.hand==="left"&&n._leftController!=null&&(n._leftController.dispose(),n._leftController=null),o.hand==="right"&&n._rightController!=null&&(n._rightController.dispose(),n._rightController=null))},this._workingVector=d.e.Zero(),this._workingQuaternion=d.b.Identity(),this._workingMatrix=d.a.Identity(),this._scene=t,this._inputElement=t.getEngine().getInputElement(),"getVRDisplays"in navigator||(e.useXR=!0),e.createFallbackVRDeviceOrientationFreeCamera===void 0&&(e.createFallbackVRDeviceOrientationFreeCamera=!0),e.createDeviceOrientationCamera===void 0&&(e.createDeviceOrientationCamera=!0),e.laserToggle===void 0&&(e.laserToggle=!0),e.defaultHeight===void 0&&(e.defaultHeight=1.7),e.useCustomVRButton&&(this._useCustomVRButton=!0,e.customVRButton&&(this._btnVR=e.customVRButton)),e.rayLength&&(this._rayLength=e.rayLength),this._defaultHeight=e.defaultHeight,e.positionScale&&(this._rayLength*=e.positionScale,this._defaultHeight*=e.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new d.e(0,this._defaultHeight,0),e.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Io("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof Zr&&this._scene.activeCamera.rotation)){var r=this._scene.activeCamera;r.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(r.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(d.b.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z)),this._deviceOrientationCamera.rotation=r.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?Ep.IsSessionSupportedAsync("immersive-vr").then(function(o){o?(p.a.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),t.createDefaultXRExperienceAsync({floorMeshes:e.floorMeshes||[]}).then(function(l){n.xr=l,n.xrTestDone=!0,n._cameraGazer=new my(function(){return n.xr.baseExperience.camera},t),n.xr.baseExperience.onStateChangedObservable.add(function(h){switch(h){case zn.ENTERING_XR:n.onEnteringVRObservable.notifyObservers(n),n._interactionsEnabled||n.xr.pointerSelection.detach(),n.xr.pointerSelection.displayLaserPointer=n._displayLaserPointer;break;case zn.EXITING_XR:n.onExitingVRObservable.notifyObservers(n),n._scene.getEngine().resize();break;case zn.IN_XR:n._hasEnteredVR=!0;break;case zn.NOT_IN_XR:n._hasEnteredVR=!1}})})):n.completeVRInit(t,e)}):this.completeVRInit(t,e)}return Object.defineProperty(i.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||this._leftController!==null&&this._leftController._teleportationRequestInitiated||this._rightController!==null&&this._rightController._teleportationRequestInitiated},enumerable:!1,configurable:!0}),i.prototype.completeVRInit=function(t,e){var n=this;if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=cs.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new Xu("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new Ku("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new my(function(){return n.currentVRCamera},t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var r=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";r+=".babylonVRicon.vrdisplaypresenting { display: none; }";var o=document.createElement("style");o.appendChild(document.createTextNode(r)),document.getElementsByTagName("head")[0].appendChild(o),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){n.isInVRMode?n._scene.getEngine().disableVR():n.enterVR()});var l=this._scene.getEngine().getHostWindow();l&&(l.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(h){h.vrDisplay&&n.displayVRButton()}),this._onKeyDown=function(h){h.keyCode===27&&n.isInVRMode&&n.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){n._hasEnteredVR&&n.exitVROnDoubleTap&&(n.exitVR(),n._fullscreenVRpresenting&&n._scene.getEngine().exitFullscreen())},xt.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(h){return n.onVRDisplayChanged(h)},this._onVrDisplayPresentChange=function(){return n.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){n._webVRrequesting=!0,n.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){n._webVRrequesting=!1,n.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),l.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add(function(){n.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(h){return n._onDefaultMeshLoaded(h)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new Rt,this._circleEase.setEasingMode(gt.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add(function(h){n._interactionsEnabled&&t.activeCamera===n.vrDeviceOrientationCamera&&h.event.pointerType==="mouse"&&(h.type===xt.a.POINTERDOWN?n._cameraGazer._selectionPointerDown():h.type===xt.a.POINTERUP&&n._cameraGazer._selectionPointerUp())}),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},i.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(e){p.a.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(i.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===zn.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!1,configurable:!0}),i.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else p.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},i.prototype.onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this.updateButtonVisibility()},i.prototype.moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}},i.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},i.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},i.prototype.enterVR=function(){var t=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(o){p.a.Warn("Error in your custom logic onEnteringVR: "+o)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=d.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var e=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,n=d.b.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-e,r=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=d.b.FromEulerAngles(0,r+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(o){t.onAfterEnteringVRObservable.notifyObservers({success:o})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){t.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(o){o&&o._activatePointer()}),this._hasEnteredVR=!0)}},i.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){p.a.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!1,configurable:!0}),i.prototype.enableInteractions=function(){var t=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===zn.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return!!(t._isTeleportationFloor(e)||e.name.indexOf("gazeTracker")===-1&&e.name.indexOf("teleportationTarget")===-1&&e.name.indexOf("torusTeleportation")===-1)&&t.raySelectionPredicate(e)},this._interactionsEnabled=!0}},Object.defineProperty(i.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!1,configurable:!0}),i.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)},i.prototype.addFloorMesh=function(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))},i.prototype.removeFloorMesh=function(t){if(this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);e!==-1&&this._floorMeshesCollection.splice(e,1)}},i.prototype.enableTeleportation=function(t){var e=this;if(t===void 0&&(t={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){var n=t.floorMeshes||[];if(!n.length){var r=this._scene.getMeshByName(t.floorMeshName);r&&n.push(r)}if(this.xr)return n.forEach(function(h){e.xr.teleportation.addFloorMesh(h)}),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var o=function(){e.xrTestDone&&(e._scene.unregisterBeforeRender(o),e.xr?e.xr.teleportation.attached||e.xr.teleportation.attach():e.enableTeleportation(t))};return void this._scene.registerBeforeRender(o)}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),t.easingFunction!==void 0&&(this._teleportationEasing=t.easingFunction),this._leftController!=null&&this._enableTeleportationOnController(this._leftController),this._rightController!=null&&this._enableTeleportationOnController(this._rightController);var l=new Jn.a;l.vignetteColor=new x.b(0,0,0,0),l.vignetteEnabled=!0,this._postProcessMove=new Qu("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,l),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},i.prototype._enableInteractionOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add(function(n){e._displayLaserPointer&&n.value===1&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))}),t.webVRController.onTriggerStateChangedObservable.add(function(n){var r=t;e._noControllerIsActive&&(r=e._cameraGazer),r._pointerDownOnMeshAsked?n.value<e._padSensibilityDown&&r._selectionPointerUp():n.value>e._padSensibilityUp&&r._selectionPointerDown()}))},i.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},i.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},i.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var n=d.b.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),r=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(n=this.currentVRCamera.deviceRotationQuaternion,r=this.currentVRCamera.devicePosition),n.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,d.b.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),d.e.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var o=new Bn.a(r,this._workingVector),l=this._scene.pickWithRay(o,this._raySelectionPredicate);l&&l.pickedPoint&&l.pickedMesh&&this._isTeleportationFloor(l.pickedMesh)&&l.distance<5&&this.teleportCamera(l.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},i.prototype._enableTeleportationOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===kr.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add(function(n){t._dpadPressed=n.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)})),t.webVRController.onPadValuesChangedObservable.add(function(n){e.teleportationEnabled&&(e._checkTeleportBackwards(n,t),e._checkTeleportWithRay(n,t)),e._checkRotate(n,t)}))},i.prototype._createTeleportationCircles=function(){this._teleportationTarget=Ne.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new Zi.a("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();var n=new Qt.a("TextPlaneMaterial",this._scene);n.diffuseTexture=t,this._teleportationTarget.material=n;var r=Ne.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);r.isPickable=!1,r.parent=this._teleportationTarget;var o=new W("animationInnerCircle","position.y",30,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CYCLE),l=[];l.push({frame:0,value:0}),l.push({frame:30,value:.4}),l.push({frame:60,value:0}),o.setKeys(l);var h=new gr;h.setEasingMode(gt.EASINGMODE_EASEINOUT),o.setEasingFunction(h),r.animations=[],r.animations.push(o),this._scene.beginAnimation(r,0,60,!0),this._hideTeleportationTarget()},i.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},i.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},i.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof dr){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var n=d.b.FromRotationMatrix(d.a.RotationY(Math.PI/4*this._rotationAngle)),r=new W("animationRotation","rotationQuaternion",90,W.ANIMATIONTYPE_QUATERNION,W.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),o.push({frame:6,value:n}),r.setKeys(o),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var l=new W("animationPP","vignetteWeight",90,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:4}),h.push({frame:6,value:0}),l.setKeys(h),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l);var v=new W("animationPP2","vignetteStretch",90,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CONSTANT),b=[];b.push({frame:0,value:0}),b.push({frame:3,value:10}),b.push({frame:6,value:0}),v.setKeys(b),v.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(v),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},i.prototype._moveTeleportationSelectorTo=function(t,e,n){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var r=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),n);if(r){var o=d.e.Cross(Se.a.Y,r),l=d.e.Cross(r,o);d.e.RotationFromAxisToRef(l,r,o,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},i.prototype.teleportCamera=function(t){var e=this;if(this.currentVRCamera instanceof dr){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var n,r;if(this._teleportationMode==i.TELEPORTATIONMODE_CONSTANTSPEED){r=90;var o=d.e.Distance(this.currentVRCamera.position,this._workingVector);n=this._teleportationSpeed/o}else r=Math.round(90*this._teleportationTime/1e3),n=1;this.currentVRCamera.animations=[];var l=new W("animationCameraTeleportation","position",90,W.ANIMATIONTYPE_VECTOR3,W.ANIMATIONLOOPMODE_CONSTANT),h=[{frame:0,value:this.currentVRCamera.position},{frame:r,value:this._workingVector}];l.setKeys(h),l.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(l),this._postProcessMove.animations=[];var v=Math.round(r/2),b=new W("animationPP","vignetteWeight",90,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CONSTANT),A=[];A.push({frame:0,value:0}),A.push({frame:v,value:8}),A.push({frame:r,value:0}),b.setKeys(A),this._postProcessMove.animations.push(b);var D=new W("animationPP2","vignetteStretch",90,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CONSTANT),N=[];N.push({frame:0,value:0}),N.push({frame:v,value:10}),N.push({frame:r,value:0}),D.setKeys(N),this._postProcessMove.animations.push(D),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,r,!1,n,function(){e._webVRCamera.detachPostProcess(e._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,r,!1,n,function(){e.onAfterCameraTeleport.notifyObservers(e._workingVector)}),this._hideTeleportationTarget()}},i.prototype._convertNormalToDirectionOfRay=function(t,e){return t&&Math.acos(d.e.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1),t},i.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof dr){var e=t._getForwardRay(this._rayLength),n=this._scene.pickWithRay(e,this._raySelectionPredicate);if(n&&(t._laserPointer&&(n.originMesh=t._laserPointer.parent),this._scene.simulatePointerMove(n,{pointerId:t._id})),t._currentHit=n,n&&n.pickedPoint){if(this._displayGaze){var r=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(r=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=n.distance*r,t._gazeTracker.scaling.y=n.distance*r,t._gazeTracker.scaling.z=n.distance*r);var o=this._convertNormalToDirectionOfRay(n.getNormal(),e);if(o){var l=d.e.Cross(Se.a.Y,o),h=d.e.Cross(o,l);d.e.RotationFromAxisToRef(h,o,l,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(n.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=.002:t._gazeTracker.position.x-=.002,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=.002:t._gazeTracker.position.y-=.002,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=.002:t._gazeTracker.position.z-=.002}t._updatePointerDistance(n.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(n&&n.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(n.pickedMesh)&&n.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(n,t,e));if(n.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(n.pickedMesh)){this.onNewMeshPicked.notifyObservers(n),t._currentMeshSelected=n.pickedMesh,n.pickedMesh.isPickable&&n.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(n.pickedMesh);var v=t;v.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:n.pickedMesh,controller:v.webVRController})}catch(b){p.a.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+b)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},i.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},i.prototype.setLaserColor=function(t,e){e===void 0&&(e=this._pickedLaserColor),this._laserColor=t,this._pickedLaserColor=e},i.prototype.setLaserLightingState=function(t){t===void 0&&(t=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)},i.prototype.setGazeColor=function(t,e){e===void 0&&(e=this._pickedGazeColor),this._gazeColor=t,this._pickedGazeColor=e},i.prototype.changeLaserColor=function(t){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))},i.prototype.changeGazeColor=function(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},i.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},i.prototype.getClassName=function(){return"VRExperienceHelper"},i.TELEPORTATIONMODE_CONSTANTTIME=0,i.TELEPORTATIONMODE_CONSTANTSPEED=1,i}(),us=c(64),hs=(hi={root:0,found:!1},function(i,t,e,n){hi.root=0,hi.found=!1;var r=t*t-4*i*e;if(r<0)return hi;var o=Math.sqrt(r),l=(-t-o)/(2*i),h=(-t+o)/(2*i);if(l>h){var v=h;h=l,l=v}return l>0&&l<n?(hi.root=l,hi.found=!0,hi):(h>0&&h<n&&(hi.root=h,hi.found=!0),hi)}),gy=function(){function i(){this._collisionPoint=d.e.Zero(),this._planeIntersectionPoint=d.e.Zero(),this._tempVector=d.e.Zero(),this._tempVector2=d.e.Zero(),this._tempVector3=d.e.Zero(),this._tempVector4=d.e.Zero(),this._edge=d.e.Zero(),this._baseToVertex=d.e.Zero(),this._destinationPoint=d.e.Zero(),this._slidePlaneNormal=d.e.Zero(),this._displacementVector=d.e.Zero(),this._radius=d.e.One(),this._retry=0,this._basePointWorld=d.e.Zero(),this._velocityWorld=d.e.Zero(),this._normalizedVelocity=d.e.Zero(),this._collisionMask=-1}return Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!1,configurable:!0}),i.prototype._initialize=function(t,e,n){this._velocity=e,d.e.NormalizeToRef(e,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=n,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(t,e,n,r,o){e.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),d.e.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var l=d.e.Dot(this._tempVector4,o);return!(l<0)&&(r.subtractToRef(t,this._tempVector3),d.e.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((l=d.e.Dot(this._tempVector4,o))<0)&&(d.e.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(l=d.e.Dot(this._tempVector4,o))>=0))},i.prototype._canDoCollision=function(t,e,n,r){var o=d.e.Distance(this._basePointWorld,t),l=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(o>this._velocityWorldLength+l+e)&&!!function(h,v,b,A){return!(h.x>b.x+A)&&!(b.x-A>v.x)&&!(h.y>b.y+A)&&!(b.y-A>v.y)&&!(h.z>b.z+A)&&!(b.z-A>v.z)}(n,r,this._basePointWorld,this._velocityWorldLength+l)},i.prototype._testTriangle=function(t,e,n,r,o,l,h){var v,b=!1;e||(e=[]),e[t]||(e[t]=new us.a(0,0,0,0),e[t].copyFromPoints(n,r,o));var A=e[t];if(l||A.isFrontFacingTo(this._normalizedVelocity,0)){var D=A.signedDistanceTo(this._basePoint),N=d.e.Dot(A.normal,this._velocity);if(N==0){if(Math.abs(D)>=1)return;b=!0,v=0}else{var j=(1-D)/N;if((v=(-1-D)/N)>j){var k=j;j=v,v=k}if(v>1||j<0)return;v<0&&(v=0),v>1&&(v=1)}this._collisionPoint.copyFromFloats(0,0,0);var H=!1,J=1;if(b||(this._basePoint.subtractToRef(A.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(v,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,r,o,A.normal)&&(H=!0,J=v,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!H){var te=this._velocity.lengthSquared(),oe=te;this._basePoint.subtractToRef(n,this._tempVector);var ce=2*d.e.Dot(this._velocity,this._tempVector),he=this._tempVector.lengthSquared()-1,_e=hs(oe,ce,he,J);_e.found&&(J=_e.root,H=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(r,this._tempVector),ce=2*d.e.Dot(this._velocity,this._tempVector),he=this._tempVector.lengthSquared()-1,(_e=hs(oe,ce,he,J)).found&&(J=_e.root,H=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(o,this._tempVector),ce=2*d.e.Dot(this._velocity,this._tempVector),he=this._tempVector.lengthSquared()-1,(_e=hs(oe,ce,he,J)).found&&(J=_e.root,H=!0,this._collisionPoint.copyFrom(o)),r.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var ye=this._edge.lengthSquared(),Ee=d.e.Dot(this._edge,this._velocity),Oe=d.e.Dot(this._edge,this._baseToVertex);if(oe=ye*-te+Ee*Ee,ce=ye*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ee*Oe,he=ye*(1-this._baseToVertex.lengthSquared())+Oe*Oe,(_e=hs(oe,ce,he,J)).found){var Ae=(Ee*_e.root-Oe)/ye;Ae>=0&&Ae<=1&&(J=_e.root,H=!0,this._edge.scaleInPlace(Ae),n.addToRef(this._edge,this._collisionPoint))}o.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),ye=this._edge.lengthSquared(),Ee=d.e.Dot(this._edge,this._velocity),Oe=d.e.Dot(this._edge,this._baseToVertex),oe=ye*-te+Ee*Ee,ce=ye*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ee*Oe,he=ye*(1-this._baseToVertex.lengthSquared())+Oe*Oe,(_e=hs(oe,ce,he,J)).found&&(Ae=(Ee*_e.root-Oe)/ye)>=0&&Ae<=1&&(J=_e.root,H=!0,this._edge.scaleInPlace(Ae),r.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),ye=this._edge.lengthSquared(),Ee=d.e.Dot(this._edge,this._velocity),Oe=d.e.Dot(this._edge,this._baseToVertex),oe=ye*-te+Ee*Ee,ce=ye*(2*d.e.Dot(this._velocity,this._baseToVertex))-2*Ee*Oe,he=ye*(1-this._baseToVertex.lengthSquared())+Oe*Oe,(_e=hs(oe,ce,he,J)).found&&(Ae=(Ee*_e.root-Oe)/ye)>=0&&Ae<=1&&(J=_e.root,H=!0,this._edge.scaleInPlace(Ae),o.addToRef(this._edge,this._collisionPoint))}if(H){var xe=J*this._velocity.length();(!this.collisionFound||xe<this._nearestDistance)&&(h.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=xe,this.collisionFound=!0),this.collidedMesh=h)}}},i.prototype._collide=function(t,e,n,r,o,l,h,v){if(n&&n.length!==0)for(b=r;b<o;b+=3)A=e[n[b]-l],D=e[n[b+1]-l],N=e[n[b+2]-l],this._testTriangle(b,t,N,D,A,h,v);else for(var b=0;b<e.length;b+=3){var A=e[b],D=e[b+1],N=e[b+2];this._testTriangle(b,t,N,D,A,h,v)}},i.prototype._getResponse=function(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(us.a.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)},i}(),vy=function(){function i(){this._scaledPosition=d.e.Zero(),this._scaledVelocity=d.e.Zero(),this._finalPosition=d.e.Zero()}return i.prototype.getNewPosition=function(t,e,n,r,o,l,h){t.divideToRef(n._radius,this._scaledPosition),e.divideToRef(n._radius,this._scaledVelocity),n.collidedMesh=null,n._retry=0,n._initialVelocity=this._scaledVelocity,n._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,n,r,this._finalPosition,o),this._finalPosition.multiplyInPlace(n._radius),l(h,this._finalPosition,n.collidedMesh)},i.prototype.createCollider=function(){return new gy},i.prototype.init=function(t){this._scene=t},i.prototype._collideWithWorld=function(t,e,n,r,o,l){l===void 0&&(l=null);var h=10*Xe.a.CollisionsEpsilon;if(n._retry>=r)o.copyFrom(t);else{var v=l?l.collisionMask:n.collisionMask;n._initialize(t,e,h);for(var b=l&&l.surroundingMeshes||this._scene.meshes,A=0;A<b.length;A++){var D=b[A];D.isEnabled()&&D.checkCollisions&&D.subMeshes&&D!==l&&(v&D.collisionGroup)!=0&&D._checkCollision(n)}n.collisionFound?(e.x===0&&e.y===0&&e.z===0||n._getResponse(t,e),e.length()<=h?o.copyFrom(t):(n._retry++,this._collideWithWorld(t,e,n,r,o,l))):t.addToRef(e,o)}},i}();ne.a.CollisionCoordinatorFactory=function(){return new vy};var xa=c(54),Z1=c(114),$1=c(147),Sp=c(103),Fo=c(43),by=c(113),yy=function(){function i(t,e,n,r,o,l){this.entries=new Array,this._boundingVectors=new Array,this._capacity=n,this._depth=r,this._maxDepth=o,this._creationFunc=l,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),i.prototype.addEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t);else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},i.prototype.removeEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t);else{var n=this.entries.indexOf(t);n>-1&&this.entries.splice(n,1)}},i.prototype.addEntries=function(t){for(var e=0;e<t.length;e++){var n=t[e];this.addEntry(n)}},i.prototype.select=function(t,e,n){if(Sp.a.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++)this.blocks[r].select(t,e,n);return}n?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}},i.prototype.intersects=function(t,e,n,r){if(Sp.a.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(var o=0;o<this.blocks.length;o++)this.blocks[o].intersects(t,e,n,r);return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},i.prototype.intersectsRay=function(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var n=0;n<this.blocks.length;n++)this.blocks[n].intersectsRay(t,e);return}e.concatWithNoDuplicate(this.entries)}},i.prototype.createInnerBlocks=function(){i._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},i._CreateBlocks=function(t,e,n,r,o,l,h,v){h.blocks=new Array;for(var b=new d.e((e.x-t.x)/2,(e.y-t.y)/2,(e.z-t.z)/2),A=0;A<2;A++)for(var D=0;D<2;D++)for(var N=0;N<2;N++){var j=new i(t.add(b.multiplyByFloats(A,D,N)),t.add(b.multiplyByFloats(A+1,D+1,N+1)),r,o+1,l,v);j.addEntries(n),h.blocks.push(j)}},i}(),Yc=function(){function i(t,e,n){n===void 0&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new In.b(1024),this._creationFunc=t}return i.prototype.update=function(t,e,n){yy._CreateBlocks(t,e,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},i.prototype.addMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].addEntry(t)},i.prototype.removeMesh=function(t){for(var e=0;e<this.blocks.length;e++)this.blocks[e].removeEntry(t)},i.prototype.select=function(t,e){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++)this.blocks[n].select(t,this._selectionContent,e);return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersects=function(t,e,n){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++)this.blocks[r].intersects(t,e,this._selectionContent,n);return n?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.prototype.intersectsRay=function(t){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].intersectsRay(t,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},i.CreationFuncForMeshes=function(t,e){var n=t.getBoundingInfo();!t.isBlocked&&n.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i.CreationFuncForSubMeshes=function(t,e){t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},i}();ne.a.prototype.createOrUpdateSelectionOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this._getComponent(ct.a.NAME_OCTREE);e||(e=new Rp(this),this._addComponent(e)),this._selectionOctree||(this._selectionOctree=new Yc(Yc.CreationFuncForMeshes,i,t));var n=this.getWorldExtends();return this._selectionOctree.update(n.min,n.max,this.meshes),this._selectionOctree},Object.defineProperty(ne.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Lt.a.prototype.createOrUpdateSubmeshesOctree=function(i,t){i===void 0&&(i=64),t===void 0&&(t=2);var e=this.getScene(),n=e._getComponent(ct.a.NAME_OCTREE);n||(n=new Rp(e),e._addComponent(n)),this._submeshesOctree||(this._submeshesOctree=new Yc(Yc.CreationFuncForSubMeshes,i,t)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree};var dn,xp,Pp,Ap,Cp,Rp=function(){function i(t){this.name=ct.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Bn.a(d.e.Zero(),new d.e(1,1,1)),this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return i.prototype.register=function(){var t=this;this.scene.onMeshRemovedObservable.add(function(e){var n=t.scene.selectionOctree;if(n!=null){var r=n.dynamicContent.indexOf(e);r!==-1&&n.dynamicContent.splice(r,1)}}),this.scene.onMeshImportedObservable.add(function(e){var n=t.scene.selectionOctree;n!=null&&n.addMesh(e)})},i.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},i.prototype.getActiveSubMeshCandidates=function(t){return t._submeshesOctree&&t.useOctreeForRenderingSelection?t._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getIntersectingSubMeshCandidates=function(t,e){return t._submeshesOctree&&t.useOctreeForPicking?(Bn.a.TransformToRef(e,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},i.prototype.getCollidingSubMeshCandidates=function(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){var n=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,n)}return this.scene._getDefaultSubMeshCandidates(t)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}(),Pa=c(99);(function(i){i[i.Generic=0]="Generic",i[i.Keyboard=1]="Keyboard",i[i.Mouse=2]="Mouse",i[i.Touch=3]="Touch",i[i.DualShock=4]="DualShock",i[i.Xbox=5]="Xbox",i[i.Switch=6]="Switch"})(dn||(dn={})),function(i){i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i[i.LeftClick=2]="LeftClick",i[i.MiddleClick=3]="MiddleClick",i[i.RightClick=4]="RightClick",i[i.BrowserBack=5]="BrowserBack",i[i.BrowserForward=6]="BrowserForward"}(xp||(xp={})),function(i){i[i.Cross=0]="Cross",i[i.Circle=1]="Circle",i[i.Square=2]="Square",i[i.Triangle=3]="Triangle",i[i.L1=4]="L1",i[i.R1=5]="R1",i[i.L2=6]="L2",i[i.R2=7]="R2",i[i.Share=8]="Share",i[i.Options=9]="Options",i[i.L3=10]="L3",i[i.R3=11]="R3",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.TouchPad=17]="TouchPad",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Pp||(Pp={})),function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.LB=4]="LB",i[i.RB=5]="RB",i[i.LT=6]="LT",i[i.RT=7]="RT",i[i.Back=8]="Back",i[i.Start=9]="Start",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.LStickXAxis=17]="LStickXAxis",i[i.LStickYAxis=18]="LStickYAxis",i[i.RStickXAxis=19]="RStickXAxis",i[i.RStickYAxis=20]="RStickYAxis"}(Ap||(Ap={})),function(i){i[i.B=0]="B",i[i.A=1]="A",i[i.Y=2]="Y",i[i.X=3]="X",i[i.L=4]="L",i[i.R=5]="R",i[i.ZL=6]="ZL",i[i.ZR=7]="ZR",i[i.Minus=8]="Minus",i[i.Plus=9]="Plus",i[i.LS=10]="LS",i[i.RS=11]="RS",i[i.DPadUp=12]="DPadUp",i[i.DPadDown=13]="DPadDown",i[i.DPadLeft=14]="DPadLeft",i[i.DPadRight=15]="DPadRight",i[i.Home=16]="Home",i[i.Capture=17]="Capture",i[i.LStickXAxis=18]="LStickXAxis",i[i.LStickYAxis=19]="LStickYAxis",i[i.RStickXAxis=20]="RStickXAxis",i[i.RStickYAxis=21]="RStickYAxis"}(Cp||(Cp={}));var Ty=function(){function i(t){this.onDeviceDisconnected=function(){},this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._keyboardDownEvent=function(n){},this._keyboardUpEvent=function(n){},this._pointerMoveEvent=function(n){},this._pointerDownEvent=function(n){},this._pointerUpEvent=function(n){},this._gamepadConnectedEvent=function(n){},this._gamepadDisconnectedEvent=function(n){},this._onDeviceConnected=function(){};var e=t.getInputElement();e&&(this._elementToAttachTo=e,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._checkForConnectedDevices())}return Object.defineProperty(i.prototype,"onDeviceConnected",{get:function(){return this._onDeviceConnected},set:function(t){this._onDeviceConnected=t;for(var e=0;e<this._inputs.length;e++)if(this._inputs[e])for(var n=0;n<this._inputs[e].length;n++)this._inputs[e][n]&&this._onDeviceConnected(e,n)},enumerable:!1,configurable:!0}),i.Create=function(t){return typeof _native!="undefined"&&_native.DeviceInputSystem?new _native.DeviceInputSystem(t):new i(t)},i.prototype.pollInput=function(t,e,n){var r=this._inputs[t][e];if(!r)throw"Unable to find device "+dn[t];if(this._updateDevice(t,e,n),r[n]===void 0)throw"Unable to find input "+n+" for device "+dn[t]+" in slot "+e;return r[n]},i.prototype.dispose=function(){this._keyboardActive&&(window.removeEventListener("keydown",this._keyboardDownEvent),window.removeEventListener("keyup",this._keyboardUpEvent)),this._pointerActive&&(this._elementToAttachTo.removeEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.removeEventListener("pointerup",this._pointerUpEvent)),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._checkForConnectedDevices=function(){for(var t=0,e=navigator.getGamepads();t<e.length;t++){var n=e[t];n&&this._addGamePad(n)}matchMedia("(pointer:fine)").matches&&this._addPointerDevice(dn.Mouse,0,0,0)},i.prototype._addGamePad=function(t){var e=this._getGamepadDeviceType(t.id),n=t.index;this._registerDevice(e,n,t.buttons.length+t.axes.length),this._gamepads=this._gamepads||new Array(t.index+1),this._gamepads[n]=e},i.prototype._addPointerDevice=function(t,e,n,r){this._pointerActive=!0,this._registerDevice(t,e,i._MAX_POINTER_INPUTS);var o=this._inputs[t][e];o[0]=n,o[1]=r},i.prototype._registerDevice=function(t,e,n){if(this._inputs[t]||(this._inputs[t]=[]),!this._inputs[t][e]){for(var r=new Array(n),o=0;o<n;o++)r[o]=0;this._inputs[t][e]=r,this.onDeviceConnected(t,e)}},i.prototype._unregisterDevice=function(t,e){this._inputs[t][e]&&(delete this._inputs[t][e],this.onDeviceDisconnected(t,e))},i.prototype._handleKeyActions=function(){var t=this;this._keyboardDownEvent=function(e){t._keyboardActive||(t._keyboardActive=!0,t._registerDevice(dn.Keyboard,0,i._MAX_KEYCODES));var n=t._inputs[dn.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(dn.Keyboard,0,e.keyCode,n[e.keyCode],1),n[e.keyCode]=1)},this._keyboardUpEvent=function(e){var n=t._inputs[dn.Keyboard][0];n&&(t.onInputChanged&&t.onInputChanged(dn.Keyboard,0,e.keyCode,n[e.keyCode],0),n[e.keyCode]=0)},window.addEventListener("keydown",this._keyboardDownEvent),window.addEventListener("keyup",this._keyboardUpEvent)},i.prototype._handlePointerActions=function(){var t=this;this._pointerMoveEvent=function(e){var n=e.pointerType=="mouse"?dn.Mouse:dn.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY)),o[0]=e.clientX,o[1]=e.clientY)},this._pointerDownEvent=function(e){var n=e.pointerType=="mouse"?dn.Mouse:dn.Touch,r=e.pointerType=="mouse"?0:e.pointerId;t._inputs[n]||(t._inputs[n]=[]),t._inputs[n][r]||t._addPointerDevice(n,r,e.clientX,e.clientY);var o=t._inputs[n][r];o&&(t.onInputChanged&&(t.onInputChanged(n,r,0,o[0],e.clientX),t.onInputChanged(n,r,1,o[1],e.clientY),t.onInputChanged(n,r,e.button+2,o[e.button+2],1)),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=1)},this._pointerUpEvent=function(e){var n=e.pointerType=="mouse"?dn.Mouse:dn.Touch,r=e.pointerType=="mouse"?0:e.pointerId,o=t._inputs[n][r];o&&(t.onInputChanged&&t.onInputChanged(n,r,e.button+2,o[e.button+2],0),o[0]=e.clientX,o[1]=e.clientY,o[e.button+2]=0),e.pointerType!="mouse"&&t._unregisterDevice(n,r)},this._elementToAttachTo.addEventListener("pointermove",this._pointerMoveEvent),this._elementToAttachTo.addEventListener("pointerdown",this._pointerDownEvent),this._elementToAttachTo.addEventListener("pointerup",this._pointerUpEvent)},i.prototype._handleGamepadActions=function(){var t=this;this._gamepadConnectedEvent=function(e){t._addGamePad(e.gamepad)},this._gamepadDisconnectedEvent=function(e){if(t._gamepads){var n=t._getGamepadDeviceType(e.gamepad.id),r=e.gamepad.index;t._unregisterDevice(n,r),delete t._gamepads[r]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},i.prototype._updateDevice=function(t,e,n){var r=navigator.getGamepads()[e];if(r&&t==this._gamepads[e]){var o=this._inputs[t][e];n>=r.buttons.length?o[n]=r.axes[n-r.buttons.length].valueOf():o[n]=r.buttons[n].value}},i.prototype._getGamepadDeviceType=function(t){return t.indexOf("054c")!==-1?dn.DualShock:t.indexOf("Xbox One")!==-1||t.search("Xbox 360")!==-1||t.search("xinput")!==-1?dn.Xbox:t.indexOf("057e")!==-1?dn.Switch:dn.Generic},i._MAX_KEYCODES=255,i._MAX_POINTER_INPUTS=7,i}(),Ey=function(){function i(t,e,n){n===void 0&&(n=0),this.deviceType=e,this.deviceSlot=n,this.onInputChangedObservable=new E.c,this._deviceInputSystem=t}return i.prototype.getInput=function(t){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,t)},i}(),J1=function(){function i(t){var e=this;this.onDeviceConnectedObservable=new E.c(function(r){e.getDevices().forEach(function(o){e.onDeviceConnectedObservable.notifyObserver(r,o)})}),this.onDeviceDisconnectedObservable=new E.c;var n=Object.keys(dn).length/2;this._devices=new Array(n),this._firstDevice=new Array(n),this._deviceInputSystem=Ty.Create(t),this._deviceInputSystem.onDeviceConnected=function(r,o){e._addDevice(r,o),e.onDeviceConnectedObservable.notifyObservers(e.getDeviceSource(r,o))},this._deviceInputSystem.onDeviceDisconnected=function(r,o){var l=e.getDeviceSource(r,o);e._removeDevice(r,o),e.onDeviceDisconnectedObservable.notifyObservers(l)},this._deviceInputSystem.onInputChanged||(this._deviceInputSystem.onInputChanged=function(r,o,l,h,v){var b;(b=e.getDeviceSource(r,o))===null||b===void 0||b.onInputChangedObservable.notifyObservers({inputIndex:l,previousState:h,currentState:v})})}return i.prototype.getDeviceSource=function(t,e){if(e===void 0){if(this._firstDevice[t]===void 0)return null;e=this._firstDevice[t]}return this._devices[t]&&this._devices[t][e]!==void 0?this._devices[t][e]:null},i.prototype.getDeviceSources=function(t){return this._devices[t].filter(function(e){return!!e})},i.prototype.getDevices=function(){var t=new Array;return this._devices.forEach(function(e){t.push.apply(t,e)}),t},i.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._deviceInputSystem.dispose()},i.prototype._addDevice=function(t,e){this._devices[t]||(this._devices[t]=new Array),this._devices[t][e]||(this._devices[t][e]=new Ey(this._deviceInputSystem,t,e),this._updateFirstDevices(t))},i.prototype._removeDevice=function(t,e){delete this._devices[t][e],this._updateFirstDevices(t)},i.prototype._updateFirstDevices=function(t){switch(t){case dn.Keyboard:case dn.Mouse:this._firstDevice[t]=0;break;case dn.Touch:case dn.DualShock:case dn.Xbox:case dn.Switch:case dn.Generic:var e=this._devices[t];delete this._firstDevice[t];for(var n=0;n<e.length;n++)if(e[n]){this._firstDevice[t]=n;break}}},i}(),Sy=c(168),xy=(c(123),function(){this._timeElapsedQueryEnded=!1}),Py=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=Lt.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=Lt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};Xe.a.prototype.createQuery=function(){return this._gl.createQuery()},Xe.a.prototype.deleteQuery=function(i){return this._gl.deleteQuery(i),this},Xe.a.prototype.isQueryResultAvailable=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT_AVAILABLE)},Xe.a.prototype.getQueryResult=function(i){return this._gl.getQueryParameter(i,this._gl.QUERY_RESULT)},Xe.a.prototype.beginOcclusionQuery=function(i,t){var e=this._getGlAlgorithmType(i);return this._gl.beginQuery(e,t),this},Xe.a.prototype.endOcclusionQuery=function(i){var t=this._getGlAlgorithmType(i);return this._gl.endQuery(t),this},Xe.a.prototype._createTimeQuery=function(){var i=this.getCaps().timerQuery;return i.createQueryEXT?i.createQueryEXT():this.createQuery()},Xe.a.prototype._deleteTimeQuery=function(i){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(i):this.deleteQuery(i)},Xe.a.prototype._getTimeQueryResult=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_EXT):this.getQueryResult(i)},Xe.a.prototype._getTimeQueryAvailability=function(i){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(i,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(i)},Xe.a.prototype.startTimeQuery=function(){var i=this.getCaps(),t=i.timerQuery;if(!t)return null;var e=new xy;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),i.canUseTimestampForTimerQuery)e._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(e._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;e._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,e._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,e._timeElapsedQuery),this._currentNonTimestampToken=e}return e},Xe.a.prototype.endTimeQuery=function(i){var t=this.getCaps(),e=t.timerQuery;if(!e||!i)return-1;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery)return-1;i._endTimeQuery||(i._endTimeQuery=this._createTimeQuery(),e.queryCounterEXT(i._endTimeQuery,e.TIMESTAMP_EXT))}else if(!i._timeElapsedQueryEnded){if(!i._timeElapsedQuery)return-1;e.endQueryEXT?e.endQueryEXT(e.TIME_ELAPSED_EXT):this._gl.endQuery(e.TIME_ELAPSED_EXT),i._timeElapsedQueryEnded=!0}var n=this._gl.getParameter(e.GPU_DISJOINT_EXT),r=!1;if(i._endTimeQuery?r=this._getTimeQueryAvailability(i._endTimeQuery):i._timeElapsedQuery&&(r=this._getTimeQueryAvailability(i._timeElapsedQuery)),r&&!n){var o=0;if(t.canUseTimestampForTimerQuery){if(!i._startTimeQuery||!i._endTimeQuery)return-1;var l=this._getTimeQueryResult(i._startTimeQuery);o=this._getTimeQueryResult(i._endTimeQuery)-l,this._deleteTimeQuery(i._startTimeQuery),this._deleteTimeQuery(i._endTimeQuery),i._startTimeQuery=null,i._endTimeQuery=null}else{if(!i._timeElapsedQuery)return-1;o=this._getTimeQueryResult(i._timeElapsedQuery),this._deleteTimeQuery(i._timeElapsedQuery),i._timeElapsedQuery=null,i._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},Xe.a.prototype._getGlAlgorithmType=function(i){return i===Lt.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(Lt.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(i){this._occlusionDataStorage.isOcclusionQueryInProgress=i},enumerable:!1,configurable:!0}),Object.defineProperty(Lt.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new Py),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(Lt.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(i){this._occlusionDataStorage.isOccluded=i},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(i){this._occlusionDataStorage.occlusionQueryAlgorithmType=i},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(i){this._occlusionDataStorage.occlusionType=i},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(i){this._occlusionDataStorage.occlusionRetryCount=i},enumerable:!0,configurable:!0}),Lt.a.prototype._checkOcclusionQuery=function(){var i=this._occlusionDataStorage;if(i.occlusionType===Lt.a.OCCLUSION_TYPE_NONE)return i.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2||!t.isQueryResultAvailable)return i.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var e=t.getQueryResult(this._occlusionQuery);i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=e!==1}else{if(i.occlusionInternalRetryCounter++,!(i.occlusionRetryCount!==-1&&i.occlusionInternalRetryCounter>i.occlusionRetryCount))return!1;i.isOcclusionQueryInProgress=!1,i.occlusionInternalRetryCounter=0,i.isOccluded=i.occlusionType!==Lt.a.OCCLUSION_TYPE_OPTIMISTIC&&i.isOccluded}var n=this.getScene();if(n.getBoundingBoxRenderer){var r=n.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(i.occlusionQueryAlgorithmType,this._occlusionQuery),r.renderOcclusionBoundingBox(this),t.endOcclusionQuery(i.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return i.isOccluded};var eI=!0;Xe.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},Xe.a.prototype.deleteTransformFeedback=function(i){this._gl.deleteTransformFeedback(i)},Xe.a.prototype.bindTransformFeedback=function(i){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,i)},Xe.a.prototype.beginTransformFeedback=function(i){i===void 0&&(i=!0),this._gl.beginTransformFeedback(i?this._gl.POINTS:this._gl.TRIANGLES)},Xe.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Xe.a.prototype.setTranformFeedbackVaryings=function(i,t){this._gl.transformFeedbackVaryings(i,t,this._gl.INTERLEAVED_ATTRIBS)},Xe.a.prototype.bindTransformFeedbackBuffer=function(i){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,i?i.underlyingResource:null)},c(126),Xt.a.prototype.updateVideoTexture=function(i,t,e){if(i&&!i._isDisabled){var n=this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);this._unpackFlipY(!e);try{if(this._videoTextureSupported===void 0&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.getError()!==0?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!i._workingCanvas){i._workingCanvas=yp.a.CreateCanvas(i.width,i.height);var r=i._workingCanvas.getContext("2d");if(!r)throw new Error("Unable to get 2d context");i._workingContext=r,i._workingCanvas.width=i.width,i._workingCanvas.height=i.height}i._workingContext.clearRect(0,0,i.width,i.height),i._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,i.width,i.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i._workingCanvas)}i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),n||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i.isReady=!0}catch(o){i._isDisabled=!0}}},Xt.a.prototype.restoreSingleAttachment=function(){var i=this._gl;this.bindAttachments([i.BACK])},Xt.a.prototype.buildTextureLayout=function(i){for(var t=this._gl,e=[],n=0;n<i.length;n++)i[n]?e.push(t["COLOR_ATTACHMENT"+n]):e.push(t.NONE);return e},Xt.a.prototype.bindAttachments=function(i){this._gl.drawBuffers(i)},Xt.a.prototype.unBindMultiColorAttachmentFramebuffer=function(i,t,e){t===void 0&&(t=!1),this._currentRenderTarget=null;var n=this._gl,r=i[0]._attachments,o=r.length;if(i[0]._MSAAFramebuffer){n.bindFramebuffer(n.READ_FRAMEBUFFER,i[0]._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,i[0]._framebuffer);for(var l=0;l<o;l++){for(var h=i[l],v=0;v<o;v++)r[v]=n.NONE;r[l]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+l:"COLOR_ATTACHMENT"+l+"_WEBGL"],n.readBuffer(r[l]),n.drawBuffers(r),n.blitFramebuffer(0,0,h.width,h.height,0,0,h.width,h.height,n.COLOR_BUFFER_BIT,n.NEAREST)}for(l=0;l<o;l++)r[l]=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+l:"COLOR_ATTACHMENT"+l+"_WEBGL"];n.drawBuffers(r)}for(l=0;l<o;l++)!(h=i[l]).generateMipMaps||t||h.isCube||(this._bindTextureDirectly(n.TEXTURE_2D,h,!0),n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null));e&&(i[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(i[0]._framebuffer),e()),this._bindUnboundFramebuffer(null)},Xt.a.prototype.createMultipleRenderTarget=function(i,t){var e=!1,n=!0,r=!1,o=!1,l=1,h=g.a.TEXTURETYPE_UNSIGNED_INT,v=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,b=new Array,A=new Array;t!==void 0&&(e=t.generateMipMaps!==void 0&&t.generateMipMaps,n=t.generateDepthBuffer===void 0||t.generateDepthBuffer,r=t.generateStencilBuffer!==void 0&&t.generateStencilBuffer,o=t.generateDepthTexture!==void 0&&t.generateDepthTexture,l=t.textureCount||1,t.types&&(b=t.types),t.samplingModes&&(A=t.samplingModes));var D=this._gl,N=D.createFramebuffer();this._bindUnboundFramebuffer(N);for(var j=i.width||i,k=i.height||i,H=[],J=[],te=this._setupFramebufferDepthAttachments(r,n,j,k),oe=0;oe<l;oe++){var ce=A[oe]||v,he=b[oe]||h;(he!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(he!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(ce=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var _e=this._getSamplingParameters(ce,e);he!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(he=g.a.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var ye=new Mt.a(this,Mt.b.MultiRenderTarget),Ee=D[this.webGLVersion>1?"COLOR_ATTACHMENT"+oe:"COLOR_ATTACHMENT"+oe+"_WEBGL"];H.push(ye),J.push(Ee),D.activeTexture(D["TEXTURE"+oe]),D.bindTexture(D.TEXTURE_2D,ye._webGLTexture),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,_e.mag),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,_e.min),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texImage2D(D.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(he),j,k,0,D.RGBA,this._getWebGLTextureType(he),null),D.framebufferTexture2D(D.DRAW_FRAMEBUFFER,Ee,D.TEXTURE_2D,ye._webGLTexture,0),e&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(D.TEXTURE_2D,null),ye._framebuffer=N,ye._depthStencilBuffer=te,ye.baseWidth=j,ye.baseHeight=k,ye.width=j,ye.height=k,ye.isReady=!0,ye.samples=1,ye.generateMipMaps=e,ye.samplingMode=ce,ye.type=he,ye._generateDepthBuffer=n,ye._generateStencilBuffer=r,ye._attachments=J,ye._textureArray=H,this._internalTexturesCache.push(ye)}if(o&&this._caps.depthTextureExtension){var Oe=new Mt.a(this,Mt.b.MultiRenderTarget);D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,Oe._webGLTexture),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texImage2D(D.TEXTURE_2D,0,this.webGLVersion<2?D.DEPTH_COMPONENT:D.DEPTH_COMPONENT16,j,k,0,D.DEPTH_COMPONENT,D.UNSIGNED_SHORT,null),D.framebufferTexture2D(D.FRAMEBUFFER,D.DEPTH_ATTACHMENT,D.TEXTURE_2D,Oe._webGLTexture,0),Oe._framebuffer=N,Oe.baseWidth=j,Oe.baseHeight=k,Oe.width=j,Oe.height=k,Oe.isReady=!0,Oe.samples=1,Oe.generateMipMaps=e,Oe.samplingMode=D.NEAREST,Oe._generateDepthBuffer=n,Oe._generateStencilBuffer=r,H.push(Oe),this._internalTexturesCache.push(Oe)}return D.drawBuffers(J),this._bindUnboundFramebuffer(null),this.resetTextureCache(),H},Xt.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(i,t){if(this.webGLVersion<2||!i)return 1;if(i[0].samples===t)return t;var e=i[0]._attachments.length;if(e===0)return 1;var n=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),i[0]._depthStencilBuffer&&(n.deleteRenderbuffer(i[0]._depthStencilBuffer),i[0]._depthStencilBuffer=null),i[0]._MSAAFramebuffer&&(n.deleteFramebuffer(i[0]._MSAAFramebuffer),i[0]._MSAAFramebuffer=null);for(var r=0;r<e;r++)i[r]._MSAARenderBuffer&&(n.deleteRenderbuffer(i[r]._MSAARenderBuffer),i[r]._MSAARenderBuffer=null);if(t>1&&n.renderbufferStorageMultisample){var o=n.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(o);var l=this._setupFramebufferDepthAttachments(i[0]._generateStencilBuffer,i[0]._generateDepthBuffer,i[0].width,i[0].height,t),h=[];for(r=0;r<e;r++){var v=i[r],b=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+r:"COLOR_ATTACHMENT"+r+"_WEBGL"],A=n.createRenderbuffer();if(!A)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,A),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(v.type),v.width,v.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,b,n.RENDERBUFFER,A),v._MSAAFramebuffer=o,v._MSAARenderBuffer=A,v.samples=t,v._depthStencilBuffer=l,n.bindRenderbuffer(n.RENDERBUFFER,null),h.push(b)}n.drawBuffers(h)}else this._bindUnboundFramebuffer(i[0]._framebuffer);return this._bindUnboundFramebuffer(null),t};var Kc=c(56);Xt.a.prototype._createDepthStencilCubeTexture=function(i,t){var e=new Mt.a(this,Mt.b.Unknown);if(e.isCube=!0,this.webGLVersion===1)return p.a.Error("Depth cube texture is not supported by WebGL 1."),e;var n=Object(_.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,i,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var o=0;o<6;o++)n.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH24_STENCIL8,i,i,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH_COMPONENT24,i,i,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),e},Xt.a.prototype._partialLoadFile=function(i,t,e,n,r){r===void 0&&(r=null),this._loadFile(i,function(o){e[t]=o,e._internalCount++,e._internalCount===6&&n(e)},void 0,void 0,!0,function(o,l){r&&o&&r(o.status+" "+o.statusText,l)})},Xt.a.prototype._cascadeLoadFiles=function(i,t,e,n){n===void 0&&(n=null);var r=[];r._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(e[o],o,r,t,n)},Xt.a.prototype._cascadeLoadImgs=function(i,t,e,n,r){n===void 0&&(n=null);var o=[];o._internalCount=0;for(var l=0;l<6;l++)this._partialLoadImg(e[l],l,o,i,t,n,r)},Xt.a.prototype._partialLoadImg=function(i,t,e,n,r,o,l){var h;o===void 0&&(o=null),h=Kc.a.LoadImage(i,function(){h&&(e[t]=h,e._internalCount++,n&&n._removePendingData(h)),e._internalCount===6&&r(e)},function(v,b){n&&n._removePendingData(h),o&&o(v,b)},n?n.offlineProvider:null,l),n&&h&&n._addPendingData(h)},Xt.a.prototype._setCubeMapTextureParams=function(i,t){var e=this._gl;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i.samplingMode=t?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.a.TEXTURE_LINEAR_LINEAR,this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)},Xt.a.prototype.createCubeTexture=function(i,t,e,n,r,o,l,h,v,b,A,D,N){var j=this;r===void 0&&(r=null),o===void 0&&(o=null),h===void 0&&(h=null),v===void 0&&(v=!1),b===void 0&&(b=0),A===void 0&&(A=0),D===void 0&&(D=null);var k=this._gl,H=D||new Mt.a(this,Mt.b.Cube);H.isCube=!0,H.url=i,H.generateMipMaps=!n,H._lodGenerationScale=b,H._lodGenerationOffset=A,this._doNotHandleContextLost||(H._extension=h,H._files=e);var J=i;this._transformTextureUrl&&!D&&(i=this._transformTextureUrl(i));for(var te=i.lastIndexOf("."),oe=h||(te>-1?i.substring(te).toLowerCase():""),ce=null,he=0,_e=Xt.a._TextureLoaders;he<_e.length;he++){var ye=_e[he];if(ye.canLoad(oe)){ce=ye;break}}if(ce){var Ee=function(Oe){j._bindTextureDirectly(k.TEXTURE_CUBE_MAP,H,!0),ce.loadCubeData(Oe,H,v,r,o)};e&&e.length===6?ce.supportCascades?this._cascadeLoadFiles(t,function(Oe){return Ee(Oe.map(function(Ae){return new Uint8Array(Ae)}))},e,o):o?o("Textures type does not support cascades."):p.a.Warn("Texture loader does not support cascades."):this._loadFile(i,function(Oe){return Ee(new Uint8Array(Oe))},void 0,void 0,!0,function(Oe,Ae){i===J?o&&Oe&&o(Oe.status+" "+Oe.statusText,Ae):(p.a.Warn("Failed to load "+i+", falling back to the "+J),j.createCubeTexture(J,t,e,n,r,o,l,h,v,b,A,H,N))})}else{if(!e)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(Oe){var Ae=j.needPOTTextures?Xt.a.GetExponentOfTwo(Oe[0].width,j._caps.maxCubemapTextureSize):Oe[0].width,xe=Ae,Pe=[k.TEXTURE_CUBE_MAP_POSITIVE_X,k.TEXTURE_CUBE_MAP_POSITIVE_Y,k.TEXTURE_CUBE_MAP_POSITIVE_Z,k.TEXTURE_CUBE_MAP_NEGATIVE_X,k.TEXTURE_CUBE_MAP_NEGATIVE_Y,k.TEXTURE_CUBE_MAP_NEGATIVE_Z];j._bindTextureDirectly(k.TEXTURE_CUBE_MAP,H,!0),j._unpackFlipY(!1);for(var Be=l?j._getInternalFormat(l):j._gl.RGBA,Ce=0;Ce<Pe.length;Ce++)if(Oe[Ce].width!==Ae||Oe[Ce].height!==xe){if(j._prepareWorkingCanvas(),!j._workingCanvas||!j._workingContext)return void p.a.Warn("Cannot create canvas to resize texture.");j._workingCanvas.width=Ae,j._workingCanvas.height=xe,j._workingContext.drawImage(Oe[Ce],0,0,Oe[Ce].width,Oe[Ce].height,0,0,Ae,xe),k.texImage2D(Pe[Ce],0,Be,Be,k.UNSIGNED_BYTE,j._workingCanvas)}else k.texImage2D(Pe[Ce],0,Be,Be,k.UNSIGNED_BYTE,Oe[Ce]);n||k.generateMipmap(k.TEXTURE_CUBE_MAP),j._setCubeMapTextureParams(H,!n),H.width=Ae,H.height=xe,H.isReady=!0,l&&(H.format=l),H.onLoadedObservable.notifyObservers(H),H.onLoadedObservable.clear(),r&&r()},e,o)}return this._internalTexturesCache.push(H),H},c(153),c(124);var tI=function(){};Xe.a.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},Xe.a.prototype.registerView=function(i,t){var e=this;this.views||(this.views=[]);for(var n=0,r=this.views;n<r.length;n++){var o=r[n];if(o.target===i)return o}var l=this.getRenderingCanvas();l&&(i.width=l.width,i.height=l.height);var h={target:i,camera:t};return this.views.push(h),t&&t.onDisposeObservable.add(function(){e.unRegisterView(i)}),h},Xe.a.prototype.unRegisterView=function(i){if(!this.views)return this;for(var t=0,e=this.views;t<e.length;t++){var n=e[t];if(n.target===i){var r=this.views.indexOf(n);r!==-1&&this.views.splice(r,1);break}}return this},Xe.a.prototype._renderViews=function(){if(!this.views)return!1;var i=this.getRenderingCanvas();if(!i)return!1;for(var t=0,e=this.views;t<e.length;t++){var n=e[t],r=n.target,o=r.getContext("2d");if(o){var l=n.camera,h=null,v=null;if(l){if((v=l.getScene()).activeCameras&&v.activeCameras.length)continue;this.activeView=n,h=v.activeCamera,v.activeCamera=l}var b=r.width!==r.clientWidth||r.height!==r.clientHeight;if(r.clientWidth&&r.clientHeight&&b&&(r.width=r.clientWidth,r.height=r.clientHeight,i.width=r.clientWidth,i.height=r.clientHeight,this.resize()),!i.width||!i.height)return!1;this._renderFrame(),o.drawImage(i,0,0),h&&v&&(v.activeCamera=h)}}return this.activeView=null,!0},c(129);function nI(i){if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some(function(r){var o="\\b"+r+"\\b";return i&&(i===r||i.match(new RegExp(o,"g")))}))return i;var t=i.lastIndexOf("."),e=i.lastIndexOf("?"),n=e>-1?i.substring(e,i.length):"";return(t>-1?i.substring(0,t):i)+this._textureFormatInUse+n}Object.defineProperty(Xe.a.prototype,"texturesSupported",{get:function(){var i=new Array;return this._caps.astc&&i.push("-astc.ktx"),this._caps.s3tc&&i.push("-dxt.ktx"),this._caps.pvrtc&&i.push("-pvrtc.ktx"),this._caps.etc2&&i.push("-etc2.ktx"),this._caps.etc1&&i.push("-etc1.ktx"),i},enumerable:!0,configurable:!0}),Object.defineProperty(Xe.a.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0}),Xe.a.prototype.setCompressedTextureExclusions=function(i){this._excludedCompressedTextures=i},Xe.a.prototype.setTextureFormatToUse=function(i){for(var t=this.texturesSupported,e=0,n=t.length;e<n;e++)for(var r=0,o=i.length;r<o;r++)if(t[e]===i[r].toLowerCase())return this._transformTextureUrl=nI.bind(this),this._textureFormatInUse=t[e];return this._textureFormatInUse="",this._transformTextureUrl=null,null};var rI=c(144),Ay=c(118),Cy=c(89),Li=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],iI=[function(i){return 1},function(i){return i.y},function(i){return i.z},function(i){return i.x},function(i){return i.x*i.y},function(i){return i.y*i.z},function(i){return 3*i.z*i.z-1},function(i){return i.x*i.z},function(i){return i.x*i.x-i.y*i.y}],$i=function(i,t){return Li[i]*iI[i](t)},Ji=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],Op=function(){function i(){this.preScaled=!1,this.l00=d.e.Zero(),this.l1_1=d.e.Zero(),this.l10=d.e.Zero(),this.l11=d.e.Zero(),this.l2_2=d.e.Zero(),this.l2_1=d.e.Zero(),this.l20=d.e.Zero(),this.l21=d.e.Zero(),this.l22=d.e.Zero()}return i.prototype.addLight=function(t,e,n){var r=new d.e(e.r,e.g,e.b).scale(n);this.l00=this.l00.add(r.scale($i(0,t))),this.l1_1=this.l1_1.add(r.scale($i(1,t))),this.l10=this.l10.add(r.scale($i(2,t))),this.l11=this.l11.add(r.scale($i(3,t))),this.l2_2=this.l2_2.add(r.scale($i(4,t))),this.l2_1=this.l2_1.add(r.scale($i(5,t))),this.l20=this.l20.add(r.scale($i(6,t))),this.l21=this.l21.add(r.scale($i(7,t))),this.l22=this.l22.add(r.scale($i(8,t)))},i.prototype.scaleInPlace=function(t){this.l00.scaleInPlace(t),this.l1_1.scaleInPlace(t),this.l10.scaleInPlace(t),this.l11.scaleInPlace(t),this.l2_2.scaleInPlace(t),this.l2_1.scaleInPlace(t),this.l20.scaleInPlace(t),this.l21.scaleInPlace(t),this.l22.scaleInPlace(t)},i.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(Ji[0]),this.l1_1.scaleInPlace(Ji[1]),this.l10.scaleInPlace(Ji[2]),this.l11.scaleInPlace(Ji[3]),this.l2_2.scaleInPlace(Ji[4]),this.l2_1.scaleInPlace(Ji[5]),this.l20.scaleInPlace(Ji[6]),this.l21.scaleInPlace(Ji[7]),this.l22.scaleInPlace(Ji[8])},i.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},i.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(Li[0]),this.l1_1.scaleInPlace(Li[1]),this.l10.scaleInPlace(Li[2]),this.l11.scaleInPlace(Li[3]),this.l2_2.scaleInPlace(Li[4]),this.l2_1.scaleInPlace(Li[5]),this.l20.scaleInPlace(Li[6]),this.l21.scaleInPlace(Li[7]),this.l22.scaleInPlace(Li[8])},i.FromArray=function(t){var e=new i;return d.e.FromArrayToRef(t[0],0,e.l00),d.e.FromArrayToRef(t[1],0,e.l1_1),d.e.FromArrayToRef(t[2],0,e.l10),d.e.FromArrayToRef(t[3],0,e.l11),d.e.FromArrayToRef(t[4],0,e.l2_2),d.e.FromArrayToRef(t[5],0,e.l2_1),d.e.FromArrayToRef(t[6],0,e.l20),d.e.FromArrayToRef(t[7],0,e.l21),d.e.FromArrayToRef(t[8],0,e.l22),e},i.FromPolynomial=function(t){var e=new i;return e.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),e.l1_1=t.y.scale(.977204),e.l10=t.z.scale(.977204),e.l11=t.x.scale(.977204),e.l2_2=t.xy.scale(1.16538),e.l2_1=t.yz.scale(1.16538),e.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),e.l21=t.zx.scale(1.16538),e.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),e.l1_1.scaleInPlace(-1),e.l11.scaleInPlace(-1),e.l2_1.scaleInPlace(-1),e.l21.scaleInPlace(-1),e.scaleInPlace(Math.PI),e},i}(),Qc=function(){function i(){this.x=d.e.Zero(),this.y=d.e.Zero(),this.z=d.e.Zero(),this.xx=d.e.Zero(),this.yy=d.e.Zero(),this.zz=d.e.Zero(),this.xy=d.e.Zero(),this.yz=d.e.Zero(),this.zx=d.e.Zero()}return Object.defineProperty(i.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=Op.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),i.prototype.addAmbient=function(t){var e=new d.e(t.r,t.g,t.b);this.xx=this.xx.add(e),this.yy=this.yy.add(e),this.zz=this.zz.add(e)},i.prototype.scaleInPlace=function(t){this.x.scaleInPlace(t),this.y.scaleInPlace(t),this.z.scaleInPlace(t),this.xx.scaleInPlace(t),this.yy.scaleInPlace(t),this.zz.scaleInPlace(t),this.yz.scaleInPlace(t),this.zx.scaleInPlace(t),this.xy.scaleInPlace(t)},i.FromHarmonics=function(t){var e=new i;return e._harmonics=t,e.x=t.l11.scale(1.02333).scale(-1),e.y=t.l1_1.scale(1.02333).scale(-1),e.z=t.l10.scale(1.02333),e.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)),e.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)),e.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),e.yz=t.l2_1.scale(.858086).scale(-1),e.zx=t.l21.scale(.858086).scale(-1),e.xy=t.l2_2.scale(.858086),e.scaleInPlace(1/Math.PI),e},i.FromArray=function(t){var e=new i;return d.e.FromArrayToRef(t[0],0,e.x),d.e.FromArrayToRef(t[1],0,e.y),d.e.FromArrayToRef(t[2],0,e.z),d.e.FromArrayToRef(t[3],0,e.xx),d.e.FromArrayToRef(t[4],0,e.yy),d.e.FromArrayToRef(t[5],0,e.zz),d.e.FromArrayToRef(t[6],0,e.yz),d.e.FromArrayToRef(t[7],0,e.zx),d.e.FromArrayToRef(t[8],0,e.xy),e},i}(),jr=c(52),ds=function(i,t,e,n){this.name=i,this.worldAxisForNormal=t,this.worldAxisForFileX=e,this.worldAxisForFileY=n},Zu=function(){function i(){}return i.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var e,n,r=t.getSize().width,o=t.readPixels(0),l=t.readPixels(1);t.isRenderTarget?(e=t.readPixels(3),n=t.readPixels(2)):(e=t.readPixels(2),n=t.readPixels(3));var h=t.readPixels(4),v=t.readPixels(5),b=t.gammaSpace,A=g.a.TEXTUREFORMAT_RGBA,D=g.a.TEXTURETYPE_UNSIGNED_INT;t.textureType!=g.a.TEXTURETYPE_FLOAT&&t.textureType!=g.a.TEXTURETYPE_HALF_FLOAT||(D=g.a.TEXTURETYPE_FLOAT);var N={size:r,right:o,left:l,up:e,down:n,front:h,back:v,format:A,type:D,gammaSpace:b};return this.ConvertCubeMapToSphericalPolynomial(N)},i.ConvertCubeMapToSphericalPolynomial=function(t){for(var e=new Op,n=0,r=2/t.size,o=r,l=.5*r-1,h=0;h<6;h++)for(var v=this.FileFaces[h],b=t[v.name],A=l,D=t.format===g.a.TEXTUREFORMAT_RGBA?4:3,N=0;N<t.size;N++){for(var j=l,k=0;k<t.size;k++){var H=v.worldAxisForFileX.scale(j).add(v.worldAxisForFileY.scale(A)).add(v.worldAxisForNormal);H.normalize();var J=Math.pow(1+j*j+A*A,-1.5),te=b[N*t.size*D+k*D+0],oe=b[N*t.size*D+k*D+1],ce=b[N*t.size*D+k*D+2];isNaN(te)&&(te=0),isNaN(oe)&&(oe=0),isNaN(ce)&&(ce=0),t.type===g.a.TEXTURETYPE_UNSIGNED_INT&&(te/=255,oe/=255,ce/=255),t.gammaSpace&&(te=Math.pow(se.a.Clamp(te),Gt.c),oe=Math.pow(se.a.Clamp(oe),Gt.c),ce=Math.pow(se.a.Clamp(ce),Gt.c)),te=se.a.Clamp(te,0,4096),oe=se.a.Clamp(oe,0,4096),ce=se.a.Clamp(ce,0,4096);var he=new x.a(te,oe,ce);e.addLight(H,he,J),n+=J,j+=r}A+=o}var _e=6*(4*Math.PI)/6/n;return e.scaleInPlace(_e),e.convertIncidentRadianceToIrradiance(),e.convertIrradianceToLambertianRadiance(),Qc.FromHarmonics(e)},i.FileFaces=[new ds("right",new d.e(1,0,0),new d.e(0,0,-1),new d.e(0,-1,0)),new ds("left",new d.e(-1,0,0),new d.e(0,0,1),new d.e(0,-1,0)),new ds("up",new d.e(0,1,0),new d.e(1,0,0),new d.e(0,0,1)),new ds("down",new d.e(0,-1,0),new d.e(1,0,0),new d.e(0,0,-1)),new ds("front",new d.e(0,0,1),new d.e(1,0,0),new d.e(0,-1,0)),new ds("back",new d.e(0,0,-1),new d.e(-1,0,0),new d.e(0,-1,0))],i}();Object.defineProperty(jr.a.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomial=Zu.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomial}return null},set:function(i){this._texture&&(this._texture._sphericalPolynomial=i)},enumerable:!0,configurable:!0});var oI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`;We.a.ShadersStore.rgbdEncodePixelShader=oI;var aI=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void)
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`;We.a.ShadersStore.rgbdDecodePixelShader=aI;var eo=function(){function i(){}return i.GetEnvInfo=function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),n=0,r=0;r<i._MagicBytes.length;r++)if(e.getUint8(n++)!==i._MagicBytes[r])return p.a.Error("Not a babylon environment map"),null;for(var o="",l=0;l=e.getUint8(n++);)o+=String.fromCharCode(l);var h=JSON.parse(o);return h.specular&&(h.specular.specularDataPosition=n,h.specular.lodGenerationScale=h.specular.lodGenerationScale||.8),h},i.CreateEnvTextureAsync=function(t){var e=this,n=t.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");var r=n.getEngine();if(r&&r.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===g.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=r.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var l=g.a.TEXTURETYPE_FLOAT;if(!r.getCaps().textureFloatRender&&(l=g.a.TEXTURETYPE_HALF_FLOAT,!r.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var h=n.width,v=new ne.a(r),b={},A=[],D=se.a.Log2(n.width);D=Math.round(D);for(var N=function(k){for(var H=Math.pow(2,D-k),J=function(oe){var ce=t.readPixels(oe,k),he=r.createRawTexture(ce,H,H,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,l),_e=new Promise(function(ye,Ee){var Oe=new bt("rgbdEncode","rgbdEncode",null,null,1,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,r,!1,void 0,g.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);Oe.getEffect().executeWhenCompiled(function(){Oe.onApply=function(Pe){Pe._bindTexture("textureSampler",he)};var Ae=r.getRenderWidth(),xe=r.getRenderHeight();r.setSize(H,H),v.postProcessManager.directRender([Oe],null),Qe.b.ToBlob(o,function(Pe){var Be=new FileReader;Be.onload=function(Ce){var Ue=Ce.target.result;b[6*k+oe]=Ue,ye()},Be.readAsArrayBuffer(Pe)}),r.setSize(Ae,xe)})});A.push(_e)},te=0;te<6;te++)J(te)},j=0;j<=D;j++)N(j);return Promise.all(A).then(function(){v.dispose();for(var k={version:1,width:h,irradiance:e._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},H=0,J=0;J<=D;J++)for(var te=0;te<6;te++){var oe=b[6*J+te].byteLength;k.specular.mipmaps.push({length:oe,position:H}),H+=oe}for(var ce=JSON.stringify(k),he=new ArrayBuffer(ce.length+1),_e=new Uint8Array(he),ye=(J=0,ce.length);J<ye;J++)_e[J]=ce.charCodeAt(J);_e[ce.length]=0;var Ee=i._MagicBytes.length+H+he.byteLength,Oe=new ArrayBuffer(Ee),Ae=new Uint8Array(Oe),xe=new DataView(Oe),Pe=0;for(J=0;J<i._MagicBytes.length;J++)xe.setUint8(Pe++,i._MagicBytes[J]);for(Ae.set(new Uint8Array(he),Pe),Pe+=he.byteLength,J=0;J<=D;J++)for(te=0;te<6;te++){var Be=b[6*J+te];Ae.set(new Uint8Array(Be),Pe),Pe+=Be.byteLength}return Oe})},i._CreateEnvTextureIrradiance=function(t){var e=t.sphericalPolynomial;return e==null?null:{x:[e.x.x,e.x.y,e.x.z],y:[e.y.x,e.y.y,e.y.z],z:[e.z.x,e.z.y,e.z.z],xx:[e.xx.x,e.xx.y,e.xx.z],yy:[e.yy.x,e.yy.y,e.yy.z],zz:[e.zz.x,e.zz.y,e.zz.z],yz:[e.yz.x,e.yz.y,e.yz.z],zx:[e.zx.x,e.zx.y,e.zx.z],xy:[e.xy.x,e.xy.y,e.xy.z]}},i.CreateImageDataArrayBufferViews=function(t,e){if(e.version!==1)throw new Error('Unsupported babylon environment map version "'+e.version+'"');var n=e.specular,r=se.a.Log2(e.width);if(r=Math.round(r)+1,n.mipmaps.length!==6*r)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');for(var o=new Array(r),l=0;l<r;l++){o[l]=new Array(6);for(var h=0;h<6;h++){var v=n.mipmaps[6*l+h];o[l][h]=new Uint8Array(t.buffer,t.byteOffset+n.specularDataPosition+v.position,v.length)}}return o},i.UploadEnvLevelsAsync=function(t,e,n){if(n.version!==1)throw new Error('Unsupported babylon environment map version "'+n.version+'"');var r=n.specular;if(!r)return Promise.resolve();t._lodGenerationScale=r.lodGenerationScale;var o=i.CreateImageDataArrayBufferViews(e,n);return i.UploadLevelsAsync(t,o)},i._OnImageReadyAsync=function(t,e,n,r,o,l,h,v,b,A,D){return new Promise(function(N,j){if(n){var k=e.createTexture(null,!0,!0,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(J){j(J)},t);r.getEffect().executeWhenCompiled(function(){r.onApply=function(J){J._bindTexture("textureSampler",k),J.setFloat2("scale",1,1)},e.scenes[0].postProcessManager.directRender([r],A,!0,l,h),e.restoreDefaultFramebuffer(),k.dispose(),URL.revokeObjectURL(o),N()})}else{if(e._uploadImageToTexture(D,t,l,h),v){var H=b[h];H&&e._uploadImageToTexture(H._texture,t,l,0)}N()}})},i.UploadLevelsAsync=function(t,e){var n=this;if(!Qe.b.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");var r=Math.round(se.a.Log2(t.width))+1,o=t.getEngine(),l=!1,h=!1,v=null,b=null,A=null,D=o.getCaps();if(t.format=g.a.TEXTUREFORMAT_RGBA,t.type=g.a.TEXTURETYPE_UNSIGNED_INT,t.generateMipMaps=!0,t._cachedAnisotropicFilteringLevel=null,o.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t),D.textureLOD?o.webGLVersion<2?l=!1:D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering?(l=!0,t.type=g.a.TEXTURETYPE_HALF_FLOAT):D.textureFloatRender&&D.textureFloatLinearFiltering&&(l=!0,t.type=g.a.TEXTURETYPE_FLOAT):(l=!1,h=!0,A={}),l)v=new bt("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,o,!1,void 0,t.type,void 0,null,!1),t._isRGBD=!1,t.invertY=!1,b=o.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:t.type,format:g.a.TEXTUREFORMAT_RGBA});else if(t._isRGBD=!0,t.invertY=!0,h)for(var N=t._lodGenerationScale,j=t._lodGenerationOffset,k=0;k<3;k++){var H=(r-1)*N+j,J=j+(H-j)*(1-k/2),te=Math.round(Math.min(Math.max(J,0),H)),oe=new Mt.a(o,Mt.b.Temp);oe.isCube=!0,oe.invertY=!0,oe.generateMipMaps=!1,o.updateTextureSamplingMode(g.a.TEXTURE_LINEAR_LINEAR,oe);var ce=new jr.a(null);switch(ce.isCube=!0,ce._texture=oe,A[te]=ce,k){case 0:t._lodTextureLow=ce;break;case 1:t._lodTextureMid=ce;break;case 2:t._lodTextureHigh=ce}}var he=[],_e=function(xe){for(var Pe=function(Ce){var Ue=e[xe][Ce],Le=new Blob([Ue],{type:"image/png"}),ke=URL.createObjectURL(Le),qe=void 0;if(typeof Image=="undefined")qe=createImageBitmap(Le).then(function(lt){return n._OnImageReadyAsync(lt,o,l,v,ke,Ce,xe,h,A,b,t)});else{var at=new Image;at.src=ke,qe=new Promise(function(lt,ft){at.onload=function(){n._OnImageReadyAsync(at,o,l,v,ke,Ce,xe,h,A,b,t).then(function(){return lt()}).catch(function(Je){ft(Je)})},at.onerror=function(Je){ft(Je)}})}he.push(qe)},Be=0;Be<6;Be++)Pe(Be)};for(k=0;k<e.length;k++)_e(k);if(e.length<r){var ye=void 0,Ee=Math.pow(2,r-1-e.length),Oe=Ee*Ee*4;switch(t.type){case g.a.TEXTURETYPE_UNSIGNED_INT:ye=new Uint8Array(Oe);break;case g.a.TEXTURETYPE_HALF_FLOAT:ye=new Uint16Array(Oe);break;case g.a.TEXTURETYPE_FLOAT:ye=new Float32Array(Oe)}for(k=e.length;k<r;k++)for(var Ae=0;Ae<6;Ae++)o._uploadArrayBufferViewToTexture(t,ye,Ae,k)}return Promise.all(he).then(function(){b&&(o._releaseFramebufferObjects(b),o._releaseTexture(t),b._swapAndDie(t)),v&&v.dispose(),h&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))})},i.UploadEnvSpherical=function(t,e){e.version!==1&&p.a.Warn('Unsupported babylon environment map version "'+e.version+'"');var n=e.irradiance;if(n){var r=new Qc;d.e.FromArrayToRef(n.x,0,r.x),d.e.FromArrayToRef(n.y,0,r.y),d.e.FromArrayToRef(n.z,0,r.z),d.e.FromArrayToRef(n.xx,0,r.xx),d.e.FromArrayToRef(n.yy,0,r.yy),d.e.FromArrayToRef(n.zz,0,r.zz),d.e.FromArrayToRef(n.yz,0,r.yz),d.e.FromArrayToRef(n.zx,0,r.zx),d.e.FromArrayToRef(n.xy,0,r.xy),t._sphericalPolynomial=r}},i._UpdateRGBDAsync=function(t,e,n,r,o){return t._source=Mt.b.CubeRawRGBD,t._bufferViewArrayArray=e,t._lodGenerationScale=r,t._lodGenerationOffset=o,t._sphericalPolynomial=n,i.UploadLevelsAsync(t,e).then(function(){t.isReady=!0})},i._MagicBytes=[134,22,135,150,246,214,150,54],i}();Mt.a._UpdateRGBDAsync=eo._UpdateRGBDAsync;var to,Mp=function(){function i(t,e){e===void 0&&(e=20),this.debug=!1,this._sourceCode=t,this._numMaxIterations=e,this._functionDescr=[],this.inlineToken="#define inline"}return Object.defineProperty(i.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),i.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size="+this._sourceCode.length+")..."),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&console.log("End of inlining process.")},i.prototype._collectFunctions=function(){for(var t=0;t<this._sourceCode.length;){var e=this._sourceCode.indexOf(this.inlineToken,t);if(e<0)break;var n=this._sourceCode.indexOf("(",e+this.inlineToken.length);if(n<0)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex="+t),t=e+this.inlineToken.length;else{var r=i._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(e+this.inlineToken.length,n));if(r){var o=[r[3],r[4]],l=o[0],h=o[1],v=this._extractBetweenMarkers("(",")",this._sourceCode,n);if(v<0)this.debug&&console.warn("Could not extract the parameters the function '"+h+"' (type="+l+"). funcParamsStartIndex="+n),t=e+this.inlineToken.length;else{var b=this._sourceCode.substring(n+1,v),A=this._skipWhitespaces(this._sourceCode,v+1);if(A!==this._sourceCode.length){var D=this._extractBetweenMarkers("{","}",this._sourceCode,A);if(D<0)this.debug&&console.warn("Could not extract the body of the function '"+h+"' (type="+l+"). funcBodyStartIndex="+A),t=e+this.inlineToken.length;else{for(var N=this._sourceCode.substring(A,D+1),j=this._removeComments(b).split(","),k=[],H=0;H<j.length;++H){var J=j[H].trim(),te=J.lastIndexOf(" ");te>=0&&k.push(J.substring(te+1))}l!=="void"&&k.push("return"),this._functionDescr.push({name:h,type:l,parameters:k,body:N,callIndex:0}),t=D+1;var oe=e>0?this._sourceCode.substring(0,e):"",ce=D+1<this._sourceCode.length-1?this._sourceCode.substring(D+1):"";this._sourceCode=oe+ce,t-=D+1-e}}else this.debug&&console.warn("Could not extract the body of the function '"+h+"' (type="+l+"). funcParamsEndIndex="+v),t=e+this.inlineToken.length}}else this.debug&&console.warn("Could not extract the name/type of the function from: "+this._sourceCode.substring(e+this.inlineToken.length,n)),t=e+this.inlineToken.length}}this.debug&&console.log("Collect functions: "+this._functionDescr.length+" functions found. functionDescr=",this._functionDescr)},i.prototype._processInlining=function(t){for(t===void 0&&(t=20);t-->=0&&this._replaceFunctionCallsByCode(););return this.debug&&console.log("numMaxIterations is "+t+" after inlining process"),t>=0},i.prototype._extractBetweenMarkers=function(t,e,n,r){for(var o=r,l=0,h="";o<n.length;){var v=n.charAt(o);if(h)v===h?h==='"'||h==="'"?n.charAt(o-1)!=="\\"&&(h=""):h="":h==="*/"&&v==="*"&&o+1<n.length&&(n.charAt(o+1)==="/"&&(h=""),h===""&&o++);else switch(v){case t:l++;break;case e:l--;break;case'"':case"'":case"`":h=v;break;case"/":if(o+1<n.length){var b=n.charAt(o+1);b==="/"?h=`
`:b==="*"&&(h="*/")}}if(o++,l===0)break}return l===0?o-1:-1},i.prototype._skipWhitespaces=function(t,e){for(;e<t.length;){var n=t[e];if(n!==" "&&n!==`
`&&n!=="\r"&&n!=="	"&&n!==`
`&&n!=="\xA0")break;e++}return e},i.prototype._removeComments=function(t){for(var e=0,n="",r=!1,o=[];e<t.length;){var l=t.charAt(e);if(n)l===n?n==='"'||n==="'"?(t.charAt(e-1)!=="\\"&&(n=""),o.push(l)):(n="",r=!1):n==="*/"&&l==="*"&&e+1<t.length?(t.charAt(e+1)==="/"&&(n=""),n===""&&(r=!1,e++)):r||o.push(l);else{switch(l){case'"':case"'":case"`":n=l;break;case"/":if(e+1<t.length){var h=t.charAt(e+1);h==="/"?(n=`
`,r=!0):h==="*"&&(n="*/",r=!0)}}r||o.push(l)}e++}return o.join("")},i.prototype._replaceFunctionCallsByCode=function(){for(var t=!1,e=0,n=this._functionDescr;e<n.length;e++)for(var r=n[e],o=r.name,l=r.type,h=r.parameters,v=r.body,b=0;b<this._sourceCode.length;){var A=this._sourceCode.indexOf(o,b);if(A<0)break;var D=this._skipWhitespaces(this._sourceCode,A+o.length);if(D!==this._sourceCode.length&&this._sourceCode.charAt(D)==="("){var N=this._extractBetweenMarkers("(",")",this._sourceCode,D);if(N<0)this.debug&&console.warn("Could not extract the parameters of the function call. Function '"+o+"' (type="+l+"). callParamsStartIndex="+D),b=A+o.length;else{for(var j=this._sourceCode.substring(D+1,N),k=this._removeComments(j).split(","),H=[],J=0;J<k.length;++J){var te=k[J].trim();H.push(te)}var oe=l!=="void"?o+"_"+r.callIndex++:null;if(oe&&H.push(oe+" ="),H.length===h.length){b=N+1;var ce=this._replaceNames(v,h,H),he=A>0?this._sourceCode.substring(0,A):"",_e=N+1<this._sourceCode.length-1?this._sourceCode.substring(N+1):"";if(oe){var ye=this._findBackward(this._sourceCode,A-1,`
`);he=this._sourceCode.substring(0,ye+1);var Ee=this._sourceCode.substring(ye+1,A);this._sourceCode=he+l+" "+oe+`;
`+ce+`
`+Ee+oe+_e,this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+l+"). injectDeclarationIndex="+ye)}else this._sourceCode=he+ce+_e,b+=ce.length-(N+1-A),this.debug&&console.log("Replace function call by code. Function '"+o+"' (type="+l+"). functionCallIndex="+A);t=!0}else this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '"+o+"' (type="+l+"). function parameters="+h+", call parameters="+H),b=A+o.length}}else b=A+o.length}return t},i.prototype._findBackward=function(t,e,n){for(;e>=0&&t.charAt(e)!==n;)e--;return e},i.prototype._escapeRegExp=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},i.prototype._replaceNames=function(t,e,n){for(var r=0;r<e.length;++r){var o=new RegExp(this._escapeRegExp(e[r]),"g"),l=n[r];t=t.replace(o,l)}return t},i._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,i}(),sI=function(){function i(){this.isAsync=!1,this.isReady=!1}return i.prototype._getVertexShaderCode=function(){return null},i.prototype._getFragmentShaderCode=function(){return null},i.prototype._handlesSpectorRebuildCallback=function(t){throw new Error("Not implemented")},i}(),Ry=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t}(Cy.a),Oy=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getInternalTexture=function(){return this},t.prototype.getViewCount=function(){return 1},t}(Mt.a),cI=function(i){function t(){var e=i.call(this,null)||this;return e._native=new _native.Engine,e.INVALID_HANDLE=65535,e._boundBuffersVertexArray=null,e._currentDepthTest=e._native.DEPTH_TEST_LEQUAL,e._webGLVersion=2,e.disableUniformBuffers=!0,e._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1},Qe.b.Log("Babylon Native (v"+Xe.a.Version+") launched"),Qe.b.LoadScript=function(n,r,o,l){Qe.b.LoadFile(n,function(h){Function(h).apply(null),r&&r()},void 0,void 0,!1,function(h,v){o&&o("LoadScript Error",v)})},typeof URL=="undefined"&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(window.Blob=function(){}),e._shaderProcessor=new Ay.a,e}return Object(_.d)(t,i),t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._native.dispose()},t.prototype._queueNewFrame=function(e,n){return n.requestAnimationFrame&&n!==window?n.requestAnimationFrame(e):this._native.requestAnimationFrame(e),0},t.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._currentFramebuffer&&this._native.unbindFramebuffer(this._currentFramebuffer),e&&this._native.bindFramebuffer(e),this._currentFramebuffer=e)},t.prototype.getHostDocument=function(){return null},t.prototype.clear=function(e,n,r,o){o===void 0&&(o=!1);var l=0;n&&e&&(this._native.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),l|=this._native.CLEAR_FLAG_COLOR),r&&(this._native.clearDepth(1),l|=this._native.CLEAR_FLAG_DEPTH),o&&(this._native.clearStencil(0),l|=this._native.CLEAR_FLAG_STENCIL),this._native.clear(l)},t.prototype.createIndexBuffer=function(e,n){var r=this._normalizeIndexData(e),o=new Ry;if(o.references=1,o.is32Bits=r.BYTES_PER_ELEMENT===4,r.length){if(o.nativeIndexBuffer=this._native.createIndexBuffer(r,n!=null&&n),o.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native index buffer.")}else o.nativeVertexBuffer=this.INVALID_HANDLE;return o},t.prototype.createVertexBuffer=function(e,n){var r=new Ry;if(r.references=1,r.nativeVertexBuffer=this._native.createVertexBuffer(ArrayBuffer.isView(e)?e:new Float32Array(e),n!=null&&n),r.nativeVertexBuffer===this.INVALID_HANDLE)throw new Error("Could not create a native vertex buffer.");return r},t.prototype._recordVertexArrayObject=function(e,n,r,o){r&&this._native.recordIndexBuffer(e,r.nativeIndexBuffer);for(var l=o.getAttributesNames(),h=0;h<l.length;h++){var v=o.getAttributeLocation(h);if(v>=0){var b=n[l[h]];if(b){var A=b.getBuffer();A&&this._native.recordVertexBuffer(e,A.nativeVertexBuffer,v,b.byteOffset,b.byteStride,b.getSize(),this._getNativeAttribType(b.type),b.normalized)}}}},t.prototype.bindBuffers=function(e,n,r){this._boundBuffersVertexArray&&this._native.deleteVertexArray(this._boundBuffersVertexArray),this._boundBuffersVertexArray=this._native.createVertexArray(),this._recordVertexArrayObject(this._boundBuffersVertexArray,e,n,r),this._native.bindVertexArray(this._boundBuffersVertexArray)},t.prototype.recordVertexArrayObject=function(e,n,r){var o=this._native.createVertexArray();return this._recordVertexArrayObject(o,e,n,r),o},t.prototype.bindVertexArrayObject=function(e){this._native.bindVertexArray(e)},t.prototype.releaseVertexArrayObject=function(e){this._native.deleteVertexArray(e)},t.prototype.getAttributes=function(e,n){var r=e;return this._native.getAttributes(r.nativeProgram,n)},t.prototype.drawElementsType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.drawIndexed(e,n,r)},t.prototype.drawArraysType=function(e,n,r,o){this._drawCalls.addCount(1,!1),this._native.draw(e,n,r)},t.prototype.createPipelineContext=function(){return new sI},t.prototype._preparePipelineContext=function(e,n,r,o,l,h,v){var b=e;b.nativeProgram=o?this.createRawShaderProgram(e,n,r,void 0,v):this.createShaderProgram(e,n,r,h,void 0,v)},t.prototype._isRenderingStateCompiled=function(e){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,n){n()},t.prototype.createRawShaderProgram=function(e,n,r,o,l){throw new Error("Not Supported")},t.prototype.createShaderProgram=function(e,n,r,o,l,h){this.onBeforeShaderCompilationObservable.notifyObservers(this);var v=new Mp(n);v.processCode(),n=v.code;var b=new Mp(r);b.processCode(),r=b.code,n=Xt.a._ConcatenateShader(n,o),r=Xt.a._ConcatenateShader(r,o);var A=this._native.createProgram(n,r);return this.onAfterShaderCompilationObservable.notifyObservers(this),A},t.prototype._setProgram=function(e){this._currentProgram!==e&&(this._native.setProgram(e),this._currentProgram=e)},t.prototype._releaseEffect=function(e){},t.prototype._deletePipelineContext=function(e){},t.prototype.getUniforms=function(e,n){var r=e;return this._native.getUniforms(r.nativeProgram,n)},t.prototype.bindUniformBlock=function(e,n,r){throw new Error("Not Implemented")},t.prototype.bindSamplers=function(e){var n=e.getPipelineContext();this._setProgram(n.nativeProgram);for(var r=e.getSamplers(),o=0;o<r.length;o++){var l=e.getUniform(r[o]);l&&(this._boundUniforms[o]=l)}this._currentEffect=null},t.prototype.setMatrix=function(e,n){e&&this._native.setMatrix(e,n.toArray())},t.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._native.getRenderWidth()},t.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._native.getRenderHeight()},t.prototype.setViewport=function(e,n,r){this._cachedViewport=e,this._native.setViewPort(e.x,e.y,e.width,e.height)},t.prototype.setState=function(e,n,r,o){n===void 0&&(n=0),o===void 0&&(o=!1),this._native.setState(e,n,o)},t.prototype.setZOffset=function(e){this._native.setZOffset(e)},t.prototype.getZOffset=function(){return this._native.getZOffset()},t.prototype.setDepthBuffer=function(e){this._native.setDepthTest(e?this._currentDepthTest:this._native.DEPTH_TEST_ALWAYS)},t.prototype.getDepthWrite=function(){return this._native.getDepthWrite()},t.prototype.setDepthFunctionToGreater=function(){this._currentDepthTest=this._native.DEPTH_TEST_GREATER,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_GEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLess=function(){this._currentDepthTest=this._native.DEPTH_TEST_LESS,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthFunctionToLessOrEqual=function(){this._currentDepthTest=this._native.DEPTH_TEST_LEQUAL,this._native.setDepthTest(this._currentDepthTest)},t.prototype.setDepthWrite=function(e){this._native.setDepthWrite(e)},t.prototype.setColorWrite=function(e){this._native.setColorWrite(e),this._colorWrite=e},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.setAlphaConstants=function(e,n,r,o){throw new Error("Setting alpha blend constant color not yet implemented.")},t.prototype.setAlphaMode=function(e,n){n===void 0&&(n=!1),this._alphaMode!==e&&(e=this._getNativeAlphaMode(e),this._native.setBlendMode(e),n||this.setDepthWrite(e===g.a.ALPHA_DISABLE),this._alphaMode=e)},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setInt=function(e,n){return!!e&&(this._native.setInt(e,n),!0)},t.prototype.setIntArray=function(e,n){return!!e&&(this._native.setIntArray(e,n),!0)},t.prototype.setIntArray2=function(e,n){return!!e&&(this._native.setIntArray2(e,n),!0)},t.prototype.setIntArray3=function(e,n){return!!e&&(this._native.setIntArray3(e,n),!0)},t.prototype.setIntArray4=function(e,n){return!!e&&(this._native.setIntArray4(e,n),!0)},t.prototype.setFloatArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setFloatArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setFloatArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setFloatArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setArray=function(e,n){return!!e&&(this._native.setFloatArray(e,n),!0)},t.prototype.setArray2=function(e,n){return!!e&&(this._native.setFloatArray2(e,n),!0)},t.prototype.setArray3=function(e,n){return!!e&&(this._native.setFloatArray3(e,n),!0)},t.prototype.setArray4=function(e,n){return!!e&&(this._native.setFloatArray4(e,n),!0)},t.prototype.setMatrices=function(e,n){return!!e&&(this._native.setMatrices(e,n),!0)},t.prototype.setMatrix3x3=function(e,n){return!!e&&(this._native.setMatrix3x3(e,n),!0)},t.prototype.setMatrix2x2=function(e,n){return!!e&&(this._native.setMatrix2x2(e,n),!0)},t.prototype.setFloat=function(e,n){return!!e&&(this._native.setFloat(e,n),!0)},t.prototype.setFloat2=function(e,n,r){return!!e&&(this._native.setFloat2(e,n,r),!0)},t.prototype.setFloat3=function(e,n,r,o){return!!e&&(this._native.setFloat3(e,n,r,o),!0)},t.prototype.setFloat4=function(e,n,r,o,l){return!!e&&(this._native.setFloat4(e,n,r,o,l),!0)},t.prototype.setColor3=function(e,n){return!!e&&(this._native.setFloat3(e,n.r,n.g,n.b),!0)},t.prototype.setColor4=function(e,n,r){return!!e&&(this._native.setFloat4(e,n.r,n.g,n.b,r),!0)},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype._createTexture=function(){return this._native.createTexture()},t.prototype._deleteTexture=function(e){this._native.deleteTexture(e)},t.prototype.updateDynamicTexture=function(e,n,r,o,l){this.createTexture("data:my_image_name",!0,r,null,Ve.a.BILINEAR_SAMPLINGMODE,void 0,void 0,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYSURBVChTY/z//z8DPsAEpXGC4aCAgQEAGGMDDWwwgqsAAAAASUVORK5CYII=",e,t.TEXTUREFORMAT_RGBA,null,void 0)},t.prototype.createTexture=function(e,n,r,o,l,h,v,b,A,D,N,j,k){var H=this;l===void 0&&(l=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),h===void 0&&(h=null),v===void 0&&(v=null),b===void 0&&(b=null),A===void 0&&(A=null),D===void 0&&(D=null),N===void 0&&(N=null);var J=(e=e||"").substr(0,5)==="data:",te=J&&e.indexOf(";base64,")!==-1,oe=A||new Mt.a(this,Mt.b.Url),ce=e;!this._transformTextureUrl||te||A||b||(e=this._transformTextureUrl(e));for(var he=e.lastIndexOf("."),_e=N||(he>-1?e.substring(he).toLowerCase():""),ye=null,Ee=0,Oe=Xe.a._TextureLoaders;Ee<Oe.length;Ee++){var Ae=Oe[Ee];if(Ae.canLoad(_e)){ye=Ae;break}}o&&o._addPendingData(oe),oe.url=e,oe.generateMipMaps=!n,oe.samplingMode=l,oe.invertY=r,this.doNotHandleContextLost||(oe._buffer=b);var xe=null;if(h&&!A&&(xe=oe.onLoadedObservable.add(h)),A||this._internalTexturesCache.push(oe),ye)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var Pe=function(Be){var Ce=oe._webGLTexture;Ce?H._native.loadTexture(Ce,Be,!n,r,function(){oe.baseWidth=H._native.getTextureWidth(Ce),oe.baseHeight=H._native.getTextureHeight(Ce),oe.width=oe.baseWidth,oe.height=oe.baseHeight,oe.isReady=!0;var Ue=H._getNativeSamplingMode(l);H._native.setTextureSampling(Ce,Ue),o&&o._removePendingData(oe),oe.onLoadedObservable.notifyObservers(oe),oe.onLoadedObservable.clear()},function(){throw new Error("Could not load a native texture.")}):o&&o._removePendingData(oe)};if(J)if(b instanceof ArrayBuffer)Pe(new Uint8Array(b));else if(ArrayBuffer.isView(b))Pe(b);else{if(typeof b!="string")throw new Error("Unsupported buffer type");Pe(new Uint8Array(Qe.b.DecodeBase64(b)))}else te?Pe(new Uint8Array(Qe.b.DecodeBase64(e))):this._loadFile(e,function(Be){return Pe(new Uint8Array(Be))},void 0,void 0,!0,function(Be,Ce){(function(Ue,Le){o&&o._removePendingData(oe),e===ce?(xe&&oe.onLoadedObservable.remove(xe),$.a.UseFallbackTexture&&H.createTexture($.a.FallbackTexture,n,oe.invertY,o,l,null,v,b,oe),v&&v((Ue||"Unknown error")+($.a.UseFallbackTexture?" - Fallback texture was used":""),Le)):(p.a.Warn("Failed to load "+e+", falling back to "+ce),H.createTexture(ce,n,oe.invertY,o,l,h,v,b,oe,D,N,j,k))})("Unable to load "+(Be&&Be.responseURL,Ce))});return oe},t.prototype._createDepthStencilTexture=function(e,n){var r=new Oy(this,Mt.b.Depth),o=e.width||e,l=e.height||e,h=this._native.createDepthTexture(r._webGLTexture,o,l);return r._framebuffer=h,r},t.prototype._releaseFramebufferObjects=function(e){},t.prototype.createCubeTexture=function(e,n,r,o,l,h,v,b,A,D,N,j){var k=this;l===void 0&&(l=null),h===void 0&&(h=null),b===void 0&&(b=null),D===void 0&&(D=0),N===void 0&&(N=0),j===void 0&&(j=null);var H=j||new Mt.a(this,Mt.b.Cube);H.isCube=!0,H.url=e,H.generateMipMaps=!o,H._lodGenerationScale=D,H._lodGenerationOffset=N,this._doNotHandleContextLost||(H._extension=b,H._files=r);var J=e.lastIndexOf(".");if((b||(J>-1?e.substring(J).toLowerCase():""))===".env"){if(r&&r.length===6)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(e,function(oe){return function(ce){var he=eo.GetEnvInfo(ce);if(H.width=he.width,H.height=he.width,eo.UploadEnvSpherical(H,he),he.version!==1)throw new Error('Unsupported babylon environment map version "'+he.version+'"');var _e=he.specular;if(!_e)throw new Error("Nothing else parsed so far");H._lodGenerationScale=_e.lodGenerationScale;var ye=eo.CreateImageDataArrayBufferViews(ce,he);H.format=g.a.TEXTUREFORMAT_RGBA,H.type=g.a.TEXTURETYPE_UNSIGNED_INT,H.generateMipMaps=!0,H.getEngine().updateTextureSamplingMode(Ve.a.TRILINEAR_SAMPLINGMODE,H),H._isRGBD=!0,H.invertY=!0,k._native.loadCubeTextureWithMips(H._webGLTexture,ye,function(){H.isReady=!0,l&&l()},function(){throw new Error("Could not load a native cube texture.")})}(new Uint8Array(oe))},void 0,void 0,!0,function(oe,ce){h&&oe&&h(oe.status+" "+oe.statusText,ce)})}else{if(!r||r.length!==6)throw new Error("Cannot load cubemap because 6 files were not defined");var te=[r[0],r[3],r[1],r[4],r[2],r[5]];Promise.all(te.map(function(oe){return Qe.b.LoadFileAsync(oe).then(function(ce){return new Uint8Array(ce)})})).then(function(oe){return new Promise(function(ce,he){k._native.loadCubeTexture(H._webGLTexture,oe,!o,ce,he)})}).then(function(){H.isReady=!0,l&&l()},function(oe){h&&h("Failed to load cubemap: "+oe.message,oe)})}return this._internalTexturesCache.push(H),H},t.prototype.createRenderTargetTexture=function(e,n){var r=new ss.a;n!==void 0&&typeof n=="object"?(r.generateMipMaps=n.generateMipMaps,r.generateDepthBuffer=n.generateDepthBuffer===void 0||n.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&n.generateStencilBuffer,r.type=n.type===void 0?g.a.TEXTURETYPE_UNSIGNED_INT:n.type,r.samplingMode=n.samplingMode===void 0?g.a.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,r.format=n.format===void 0?g.a.TEXTUREFORMAT_RGBA:n.format):(r.generateMipMaps=n,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=g.a.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=g.a.TEXTUREFORMAT_RGBA),(r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==g.a.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=g.a.TEXTURE_NEAREST_SAMPLINGMODE);var o=new Oy(this,Mt.b.RenderTarget),l=e.width||e,h=e.height||e;r.type!==g.a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=g.a.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var v=this._native.createFramebuffer(o._webGLTexture,l,h,this._getNativeTextureFormat(r.format,r.type),r.samplingMode,!!r.generateStencilBuffer,r.generateDepthBuffer,!!r.generateMipMaps);return o._framebuffer=v,o.baseWidth=l,o.baseHeight=h,o.width=l,o.height=h,o.isReady=!0,o.samples=1,o.generateMipMaps=!!r.generateMipMaps,o.samplingMode=r.samplingMode,o.type=r.type,o.format=r.format,o._generateDepthBuffer=r.generateDepthBuffer,o._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(o),o},t.prototype.updateTextureSamplingMode=function(e,n){if(n._webGLTexture){var r=this._getNativeSamplingMode(e);this._native.setTextureSampling(n._webGLTexture,r)}n.samplingMode=e},t.prototype.bindFramebuffer=function(e,n,r,o,l){if(n)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(r||o)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");e._depthStencilTexture?this._bindUnboundFramebuffer(e._depthStencilTexture._framebuffer):this._bindUnboundFramebuffer(e._framebuffer)},t.prototype.unBindFramebuffer=function(e,n,r){n===void 0&&(n=!1),n&&p.a.Warn("Disabling mipmap generation not yet supported in NativeEngine. Ignoring."),r&&r(),this._bindUnboundFramebuffer(null)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e,!0)},t.prototype.updateDynamicIndexBuffer=function(e,n,r){r===void 0&&(r=0);var o=e,l=this._normalizeIndexData(n);o.is32Bits=l.BYTES_PER_ELEMENT===4,this._native.updateDynamicIndexBuffer(o.nativeIndexBuffer,l,r)},t.prototype.updateDynamicVertexBuffer=function(e,n,r,o){var l=e,h=ArrayBuffer.isView(n)?n:new Float32Array(n);this._native.updateDynamicVertexBuffer(l.nativeVertexBuffer,h,r??0,o??h.byteLength)},t.prototype._setTexture=function(e,n,r,o){o===void 0&&(o=!1);var l,h=this._boundUniforms[e];if(!h)return!1;if(!n)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._native.setTexture(h,null)),!1;if(n.video)this._activeChannel=e,n.update();else if(n.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED)return n.delayLoad(),!1;return l=o?n.depthStencilTexture:n.isReady()?n.getInternalTexture():n.isCube?this.emptyCubeTexture:n.is3D?this.emptyTexture3D:n.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=e,!(!l||!l._webGLTexture)&&(this._native.setTextureWrapMode(l._webGLTexture,this._getAddressMode(n.wrapU),this._getAddressMode(n.wrapV),this._getAddressMode(n.wrapR)),this._updateAnisotropicLevel(n),this._native.setTexture(h,l._webGLTexture),!0)},t.prototype._updateAnisotropicLevel=function(e){var n=e.getInternalTexture(),r=e.anisotropicFilteringLevel;n&&n._webGLTexture&&n._cachedAnisotropicFilteringLevel!==r&&(this._native.setTextureAnisotropicLevel(n._webGLTexture,r),n._cachedAnisotropicFilteringLevel=r)},t.prototype._getAddressMode=function(e){switch(e){case g.a.TEXTURE_WRAP_ADDRESSMODE:return this._native.ADDRESS_MODE_WRAP;case g.a.TEXTURE_CLAMP_ADDRESSMODE:return this._native.ADDRESS_MODE_CLAMP;case g.a.TEXTURE_MIRROR_ADDRESSMODE:return this._native.ADDRESS_MODE_MIRROR;default:throw new Error("Unexpected wrap mode: "+e+".")}},t.prototype._bindTexture=function(e,n){var r=this._boundUniforms[e];r&&this._native.setTexture(r,n._webGLTexture)},t.prototype._deleteBuffer=function(e){e.nativeIndexBuffer&&(this._native.deleteIndexBuffer(e.nativeIndexBuffer),delete e.nativeIndexBuffer),e.nativeVertexBuffer&&(this._native.deleteVertexBuffer(e.nativeVertexBuffer),delete e.nativeVertexBuffer)},t.prototype.releaseEffects=function(){},t.prototype._uploadCompressedDataToTextureDirectly=function(e,n,r,o,l,h,v){throw new Error("_uploadCompressedDataToTextureDirectly not implemented.")},t.prototype._uploadDataToTextureDirectly=function(e,n,r,o){throw new Error("_uploadDataToTextureDirectly not implemented.")},t.prototype._uploadArrayBufferViewToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._uploadImageToTexture=function(e,n,r,o){throw new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._getNativeSamplingMode=function(e){switch(e){case g.a.TEXTURE_NEAREST_NEAREST:return this._native.TEXTURE_NEAREST_NEAREST;case g.a.TEXTURE_LINEAR_LINEAR:return this._native.TEXTURE_LINEAR_LINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR:return this._native.TEXTURE_LINEAR_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST:return this._native.TEXTURE_NEAREST_NEAREST_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST:return this._native.TEXTURE_NEAREST_LINEAR_MIPNEAREST;case g.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR:return this._native.TEXTURE_NEAREST_LINEAR_MIPLINEAR;case g.a.TEXTURE_NEAREST_LINEAR:return this._native.TEXTURE_NEAREST_LINEAR;case g.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR:return this._native.TEXTURE_NEAREST_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST:return this._native.TEXTURE_LINEAR_NEAREST_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR:return this._native.TEXTURE_LINEAR_NEAREST_MIPLINEAR;case g.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST:return this._native.TEXTURE_LINEAR_LINEAR_MIPNEAREST;case g.a.TEXTURE_LINEAR_NEAREST:return this._native.TEXTURE_LINEAR_NEAREST;default:throw new Error("Unsupported sampling mode: "+e+".")}},t.prototype._getNativeTextureFormat=function(e,n){if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_UNSIGNED_INT)return this._native.TEXTURE_FORMAT_RGBA8;if(e==g.a.TEXTUREFORMAT_RGBA&&n==g.a.TEXTURETYPE_FLOAT)return this._native.TEXTURE_FORMAT_RGBA32F;throw new Error("Unsupported texture format or type: format "+e+", type "+n+".")},t.prototype._getNativeAlphaMode=function(e){switch(e){case g.a.ALPHA_DISABLE:return this._native.ALPHA_DISABLE;case g.a.ALPHA_ADD:return this._native.ALPHA_ADD;case g.a.ALPHA_COMBINE:return this._native.ALPHA_COMBINE;case g.a.ALPHA_SUBTRACT:return this._native.ALPHA_SUBTRACT;case g.a.ALPHA_MULTIPLY:return this._native.ALPHA_MULTIPLY;case g.a.ALPHA_MAXIMIZED:return this._native.ALPHA_MAXIMIZED;case g.a.ALPHA_ONEONE:return this._native.ALPHA_ONEONE;case g.a.ALPHA_PREMULTIPLIED:return this._native.ALPHA_PREMULTIPLIED;case g.a.ALPHA_PREMULTIPLIED_PORTERDUFF:return this._native.ALPHA_PREMULTIPLIED_PORTERDUFF;case g.a.ALPHA_INTERPOLATE:return this._native.ALPHA_INTERPOLATE;case g.a.ALPHA_SCREENMODE:return this._native.ALPHA_SCREENMODE;default:throw new Error("Unsupported alpha mode: "+e+".")}},t.prototype._getNativeAttribType=function(e){switch(e){case Me.b.UNSIGNED_BYTE:return this._native.ATTRIB_TYPE_UINT8;case Me.b.SHORT:return this._native.ATTRIB_TYPE_INT16;case Me.b.FLOAT:return this._native.ATTRIB_TYPE_FLOAT;default:throw new Error("Unsupported attribute type: "+e+".")}},t}(Xe.a),lI=c(74),$u=function(){function i(){}return i.COPY=1,i.CUT=2,i.PASTE=3,i}(),uI=function(){function i(t,e){this.type=t,this.event=e}return i.GetTypeFromCharacter=function(t){switch(t){case 67:return $u.COPY;case 86:return $u.PASTE;case 88:return $u.CUT;default:return-1}},i}(),Ip=c(83),no=c(69);(function(i){i[i.Clean=0]="Clean",i[i.Stop=1]="Stop",i[i.Sync=2]="Sync",i[i.NoSync=3]="NoSync"})(to||(to={}));var Zt=function(){function i(){}return Object.defineProperty(i,"ForceFullSceneLoadingForIncremental",{get:function(){return no.a.ForceFullSceneLoadingForIncremental},set:function(t){no.a.ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ShowLoadingScreen",{get:function(){return no.a.ShowLoadingScreen},set:function(t){no.a.ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"loggingLevel",{get:function(){return no.a.loggingLevel},set:function(t){no.a.loggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"CleanBoneMatrixWeights",{get:function(){return no.a.CleanBoneMatrixWeights},set:function(t){no.a.CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),i.GetDefaultPlugin=function(){return i._registeredPlugins[".babylon"]},i._GetPluginForExtension=function(t){var e=i._registeredPlugins[t];return e||(p.a.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),i.GetDefaultPlugin())},i._GetPluginForDirectLoad=function(t){for(var e in i._registeredPlugins){var n=i._registeredPlugins[e].plugin;if(n.canDirectLoad&&n.canDirectLoad(t))return i._registeredPlugins[e]}return i.GetDefaultPlugin()},i._GetPluginForFilename=function(t){var e=t.indexOf("?");e!==-1&&(t=t.substring(0,e));var n=t.lastIndexOf("."),r=t.substring(n,t.length).toLowerCase();return i._GetPluginForExtension(r)},i._GetDirectLoad=function(t){return t.substr(0,5)==="data:"?t.substr(5):null},i._LoadData=function(t,e,n,r,o,l,h){var v,b=i._GetDirectLoad(t.name),A=h?i._GetPluginForExtension(h):b?i._GetPluginForDirectLoad(t.name):i._GetPluginForFilename(t.name);if(!(v=A.plugin.createPlugin!==void 0?A.plugin.createPlugin():A.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(i.OnPluginActivatedObservable.notifyObservers(v),b){if(v.directLoad){var D=v.directLoad(e,b);D.then?D.then(function(Ae){n(v,Ae)}).catch(function(Ae){o("Error in directLoad of _loadData: "+Ae,Ae)}):n(v,D)}else n(v,b);return v}var N=A.isBinary,j=function(Ae,xe){e.isDisposed?o("Scene has been disposed"):n(v,Ae,xe)},k=null,H=!1,J=v.onDisposeObservable;J&&J.add(function(){H=!0,k&&(k.abort(),k=null),l()});var te=function(){if(!H){var Ae=function(Pe,Be){j(Pe,Be?Be.responseURL:void 0)},xe=function(Pe){o(Pe.message,Pe)};k=v.requestFile?v.requestFile(e,t.url,Ae,r,N,xe):e._requestFile(t.url,Ae,r,!0,N,xe)}},oe=t.file||Ip.a.FilesToLoad[t.name.toLowerCase()];if(t.rootUrl.indexOf("file:")===-1||t.rootUrl.indexOf("file:")!==-1&&!oe){var ce=e.getEngine(),he=ce.enableOfflineSupport;if(he){for(var _e=!1,ye=0,Ee=e.disableOfflineSupportExceptionRules;ye<Ee.length;ye++)if(Ee[ye].test(t.url)){_e=!0;break}he=!_e}he&&Xe.a.OfflineProviderFactory?e.offlineProvider=Xe.a.OfflineProviderFactory(t.url,te,ce.disableManifestCheck):te()}else if(oe){var Oe=function(Ae){o(Ae.message,Ae)};k=v.readFile?v.readFile(e,oe,j,r,N,Oe):e._readFile(oe,j,r,N,Oe)}else o("Unable to find file named "+t.name);return v},i._GetFileInfo=function(t,e){var n,r,o=null;if(e)if(e.name){var l=e;n=t+l.name,r=l.name,o=l}else{var h=e;if(h.substr(0,1)==="/")return Qe.b.Error("Wrong sceneFilename parameter"),null;n=t+h,r=h}else n=t,r=Qe.b.GetFilename(t),t=Qe.b.GetFolderPath(t);return{url:n,rootUrl:t,name:r,file:o}},i.GetPluginForExtension=function(t){return i._GetPluginForExtension(t).plugin},i.IsPluginForExtensionAvailable=function(t){return!!i._registeredPlugins[t]},i.RegisterPlugin=function(t){if(typeof t.extensions=="string"){var e=t.extensions;i._registeredPlugins[e.toLowerCase()]={plugin:t,isBinary:!1}}else{var n=t.extensions;Object.keys(n).forEach(function(r){i._registeredPlugins[r.toLowerCase()]={plugin:t,isBinary:n[r].isBinary}})}},i.ImportMesh=function(t,e,n,r,o,l,h,v){if(n===void 0&&(n=""),r===void 0&&(r=$.a.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),v===void 0&&(v=null),!r)return p.a.Error("No scene available to import mesh to"),null;var b=i._GetFileInfo(e,n);if(!b)return null;var A={};r._addPendingData(A);var D=function(){r._removePendingData(A)},N=function(H,J){var te="Unable to import meshes from "+b.url+": "+H;h?h(r,te,J):p.a.Error(te),D()},j=l?function(H){try{l(H)}catch(J){N("Error in onProgress callback: "+J,J)}}:void 0,k=function(H,J,te,oe,ce,he,_e){if(r.importedMeshesFiles.push(b.url),o)try{o(H,J,te,oe,ce,he,_e)}catch(ye){N("Error in onSuccess callback: "+ye,ye)}r._removePendingData(A)};return i._LoadData(b,r,function(H,J,te){if(H.rewriteRootURL&&(b.rootUrl=H.rewriteRootURL(b.rootUrl,te)),H.importMesh){var oe=H,ce=new Array,he=new Array,_e=new Array;if(!oe.importMesh(t,r,J,b.rootUrl,ce,he,_e,N))return;r.loadingPluginName=H.name,k(ce,he,_e,[],[],[],[])}else H.importMeshAsync(t,r,J,b.rootUrl,j,b.name).then(function(ye){r.loadingPluginName=H.name,k(ye.meshes,ye.particleSystems,ye.skeletons,ye.animationGroups,ye.transformNodes,ye.geometries,ye.lights)}).catch(function(ye){N(ye.message,ye)})},j,N,D,v)},i.ImportMeshAsync=function(t,e,n,r,o,l){return n===void 0&&(n=""),r===void 0&&(r=$.a.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),new Promise(function(h,v){i.ImportMesh(t,e,n,r,function(b,A,D,N,j,k,H){h({meshes:b,particleSystems:A,skeletons:D,animationGroups:N,transformNodes:j,geometries:k,lights:H})},o,function(b,A,D){v(D||new Error(A))},l)})},i.Load=function(t,e,n,r,o,l,h){return e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),n?i.Append(t,e,new ne.a(n),r,o,l,h):(Qe.b.Error("No engine available"),null)},i.LoadAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedEngine),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,h){i.Load(t,e,n,function(v){l(v)},r,function(v,b,A){h(A||new Error(b))},o)})},i.Append=function(t,e,n,r,o,l,h){var v=this;if(e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),!n)return p.a.Error("No scene available to append to"),null;var b=i._GetFileInfo(t,e);if(!b)return null;i.ShowLoadingScreen&&!this._showingLoadingScreen&&(this._showingLoadingScreen=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady(function(){n.getEngine().hideLoadingUI(),v._showingLoadingScreen=!1}));var A={};n._addPendingData(A);var D=function(){n._removePendingData(A)},N=function(H,J){var te="Unable to load from "+b.url+(H?": "+H:"");l?l(n,te,J):p.a.Error(te),D()},j=o?function(H){try{o(H)}catch(J){N("Error in onProgress callback",J)}}:void 0,k=function(){if(r)try{r(n)}catch(H){N("Error in onSuccess callback",H)}n._removePendingData(A)};return i._LoadData(b,n,function(H,J){if(H.load){if(!H.load(n,J,b.rootUrl,N))return;n.loadingPluginName=H.name,k()}else H.loadAsync(n,J,b.rootUrl,j,b.name).then(function(){n.loadingPluginName=H.name,k()}).catch(function(te){N(te.message,te)})},j,N,D,h)},i.AppendAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,h){i.Append(t,e,n,function(v){l(v)},r,function(v,b,A){h(A||new Error(b))},o)})},i.LoadAssetContainer=function(t,e,n,r,o,l,h){if(e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),!n)return p.a.Error("No scene available to load asset container to"),null;var v=i._GetFileInfo(t,e);if(!v)return null;var b={};n._addPendingData(b);var A=function(){n._removePendingData(b)},D=function(k,H){var J="Unable to load assets from "+v.url+(k?": "+k:"");H&&H.message&&(J+=" ("+H.message+")"),l?l(n,J,H):p.a.Error(J),A()},N=o?function(k){try{o(k)}catch(H){D("Error in onProgress callback",H)}}:void 0,j=function(k){if(r)try{r(k)}catch(H){D("Error in onSuccess callback",H)}n._removePendingData(b)};return i._LoadData(v,n,function(k,H){if(k.loadAssetContainer){var J=k.loadAssetContainer(n,H,v.rootUrl,D);if(!J)return;n.loadingPluginName=k.name,j(J)}else k.loadAssetContainerAsync?k.loadAssetContainerAsync(n,H,v.rootUrl,N,v.name).then(function(te){n.loadingPluginName=k.name,j(te)}).catch(function(te){D(te.message,te)}):D("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")},N,D,A,h)},i.LoadAssetContainerAsync=function(t,e,n,r,o){return e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=null),o===void 0&&(o=null),new Promise(function(l,h){i.LoadAssetContainer(t,e,n,function(v){l(v)},r,function(v,b,A){h(A||new Error(b))},o)})},i.ImportAnimations=function(t,e,n,r,o,l,h,v,b,A){if(e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=to.Clean),l===void 0&&(l=null),h===void 0&&(h=null),v===void 0&&(v=null),b===void 0&&(b=null),A===void 0&&(A=null),n){if(r){for(var D=0,N=n.animatables;D<N.length;D++)N[D].reset();n.stopAllAnimations(),n.animationGroups.slice().forEach(function(k){k.dispose()}),n.getNodes().forEach(function(k){k.animations&&(k.animations=[])})}else switch(o){case to.Clean:n.animationGroups.slice().forEach(function(k){k.dispose()});break;case to.Stop:n.animationGroups.forEach(function(k){k.stop()});break;case to.Sync:n.animationGroups.forEach(function(k){k.reset(),k.restart()});break;case to.NoSync:break;default:return void p.a.Error("Unknown animation group loading mode value '"+o+"'")}var j=n.animatables.length;this.LoadAssetContainer(t,e,n,function(k){k.mergeAnimationsTo(n,n.animatables.slice(j),l),k.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),h&&h(n)},v,b,A)}else p.a.Error("No scene available to load animations to")},i.ImportAnimationsAsync=function(t,e,n,r,o,l,h,v,b,A){return e===void 0&&(e=""),n===void 0&&(n=$.a.LastCreatedScene),r===void 0&&(r=!0),o===void 0&&(o=to.Clean),l===void 0&&(l=null),v===void 0&&(v=null),A===void 0&&(A=null),new Promise(function(D,N){i.ImportAnimations(t,e,n,r,o,l,function(j){D(j)},v,function(j,k,H){N(H||new Error(k))},A)})},i.NO_LOGGING=g.a.SCENELOADER_NO_LOGGING,i.MINIMAL_LOGGING=g.a.SCENELOADER_MINIMAL_LOGGING,i.SUMMARY_LOGGING=g.a.SCENELOADER_SUMMARY_LOGGING,i.DETAILED_LOGGING=g.a.SCENELOADER_DETAILED_LOGGING,i.OnPluginActivatedObservable=new E.c,i._registeredPlugins={},i._showingLoadingScreen=!1,i}(),Dp=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=kr.DAYDREAM,n}return Object(_.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;Zt.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e===0){var o=this.onTriggerStateChangedObservable;o&&o.notifyObservers(n)}else p.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(Lo);Di._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(Dp.GAMEPAD_ID_PREFIX)===0},create:function(i){return new Dp(i)}});var wp=function(i){function t(e){var n=i.call(this,e)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=kr.GEAR_VR,n._calculatedPosition=new d.e(n.hand=="left"?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return Object(_.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;Zt.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){var l=new Ne.a("",e);o[1].parent=l,o[1].position.z=-.15,r._defaultModel=l,r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){if(e<this._buttonIndexToObservableNameMap.length){var o=this[this._buttonIndexToObservableNameMap[e]];o&&o.notifyObservers(n)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(Lo);Di._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(wp.GAMEPAD_ID_PREFIX)===0||i.id.indexOf("Oculus Go")!==-1||i.id.indexOf("Vive Focus")!==-1},create:function(i){return new wp(i)}});var Ju=function(i){function t(e){return i.call(this,e)||this}return Object(_.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;Zt.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,n,r){console.log("Button id: "+e+"state: "),console.dir(n)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(Lo);Di._DefaultControllerFactory=function(i){return new Ju(i)};var Lp=function(i){function t(e){var n=i.call(this,e)||this;return n.onSecondaryTriggerStateChangedObservable=new E.c,n.onThumbRestChangedObservable=new E.c,n.controllerType=kr.OCULUS,n}return Object(_.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r,o=this;r=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,Zt.ImportMesh("",t._IsQuest?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL,r,e,function(l){o._defaultModel=t._IsQuest?l[0]:l[1],o.attachToMesh(o._defaultModel),n&&n(o._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n,l=this.hand==="right"?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-o.value,this._defaultModel.getChildren()[3].position.y=.005*-o.value,this._defaultModel.getChildren()[3].position.z=.005*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=l*o.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(o);case 3:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(o);case 4:return!t._IsQuest&&this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o);case 5:return void this.onThumbRestChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t._IsQuest=!1,t}(Lo);Di._ControllerFactories.push({canCreate:function(i){return Xe.a.LastCreatedEngine&&Xe.a.LastCreatedEngine._vrDisplay&&Xe.a.LastCreatedEngine._vrDisplay.displayName==="Oculus Quest"&&(Lp._IsQuest=!0),i.id.indexOf("Oculus Touch")!==-1},create:function(i){return new Lp(i)}});var My=function(i){function t(e){var n=i.call(this,e)||this;return n.controllerType=kr.VIVE,n._invertLeftStickY=!0,n}return Object(_.d)(t,i),t.prototype.initControllerMesh=function(e,n){var r=this;Zt.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(o){r._defaultModel=o[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,n,r){var o=n;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(o);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-o.value),void this.onTriggerStateChangedObservable.notifyObservers(o);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(o);case 3:return this._defaultModel&&(o.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(o)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(Lo);Di._ControllerFactories.push({canCreate:function(i){return i.id.toLowerCase().indexOf("openvr")!==-1},create:function(i){return new My(i)}});var hI=function(){this.buttonMeshes={},this.axisMeshes={}},eh=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:Ie.POINTING_POSE},n.onTrackpadChangedObservable=new E.c,n.onTrackpadValuesChangedObservable=new E.c,n.trackpad={x:0,y:0},n.controllerType=kr.WINDOWS,n._loadedMeshInfo=null,n}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(i.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var e=0;e<this._mapping.axisMeshNames.length;e++)this._lerpAxisTransform(e,this.browserGamepad.axes[e])},t.prototype._handleButtonChange=function(e,n,r){var o=this._mapping.buttons[e];if(o){this._updateTrackpad();var l=this[this._mapping.buttonObservableNames[o]];l&&l.notifyObservers(n),this._lerpButtonTransform(o,n.value)}},t.prototype._lerpButtonTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[e];r&&r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(d.b.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,n,r.value.rotationQuaternion),d.e.LerpToRef(r.unpressed.position,r.pressed.position,n,r.value.position))}},t.prototype._lerpAxisTransform=function(e,n){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[e];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var o=.5*n+.5;d.b.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,o,r.value.rotationQuaternion),d.e.LerpToRef(r.min.position,r.max.position,o,r.value.position)}}},t.prototype.initControllerMesh=function(e,n,r){var o,l,h=this;if(r===void 0&&(r=!1),Zt.IsPluginForExtensionAvailable(".glb")){var v="default";if(this.id&&!r){var b=this.id.match(t.GAMEPAD_ID_PATTERN);v=b&&b[0]||v}l=this.hand==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,o=t.MODEL_BASE_URL+v+"/"}else p.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),o=Ju.MODEL_BASE_URL,l=Ju.MODEL_FILENAME;Zt.ImportMesh("",o,l,e,function(A){h._loadedMeshInfo=h.processModel(e,A),h._loadedMeshInfo&&(h._defaultModel=h._loadedMeshInfo.rootNode,h.attachToMesh(h._defaultModel),n&&n(h._defaultModel))},null,function(A,D){p.a.Log(D),p.a.Warn("Failed to retrieve controller model from the remote server: "+o+l),r||h.initControllerMesh(A,n,!0)})},t.prototype.processModel=function(e,n){for(var r=null,o=new Ne.a(this.id+" "+this.hand,e),l=null,h=0;h<n.length;h++){var v=n[h];if(!v.parent){v.isPickable=!1,l=v;break}}return l?(l.setParent(o),r=this.createMeshInfo(o)):p.a.Warn("Could not find root node in model file."),r},t.prototype.createMeshInfo=function(e){var n,r=new hI;for(r.rootNode=e,r.buttonMeshes={},r.axisMeshes={},n=0;n<this._mapping.buttons.length;n++){var o=this._mapping.buttonMeshNames[this._mapping.buttons[n]];if(o){var l=D(e,o);if(l){var h={index:n,value:N(l,"VALUE"),pressed:N(l,"PRESSED"),unpressed:N(l,"UNPRESSED")};h.value&&h.pressed&&h.unpressed?r.buttonMeshes[this._mapping.buttons[n]]=h:p.a.Warn("Missing button submesh under mesh with name: "+o+"(VALUE: "+!!h.value+", PRESSED: "+!!h.pressed+", UNPRESSED:"+!!h.unpressed+")")}else p.a.Warn("Missing button mesh with name: "+o)}else p.a.Log("Skipping unknown button at index: "+n+" with mapped name: "+this._mapping.buttons[n])}for(n=0;n<this._mapping.axisMeshNames.length;n++){var v=this._mapping.axisMeshNames[n];if(v){var b=D(e,v);if(b){var A={index:n,value:N(b,"VALUE"),min:N(b,"MIN"),max:N(b,"MAX")};A.value&&A.min&&A.max?r.axisMeshes[n]=A:p.a.Warn("Missing axis submesh under mesh with name: "+v+"(VALUE: "+!!A.value+", MIN: "+!!A.min+", MAX:"+!!A.max+")")}else p.a.Warn("Missing axis mesh with name: "+v)}else p.a.Log("Skipping unknown axis at index: "+n)}return r.pointingPoseNode=D(e,this._mapping.pointingPoseMeshName),r.pointingPoseNode?this._pointingPoseNode=r.pointingPoseNode:p.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),r;function D(j,k){return j.getChildren(function(H){return H.name===k},!1)[0]}function N(j,k){return j.getChildren(function(H){return H.name==k},!0)[0]}},t.prototype.getForwardRay=function(e){if(e===void 0&&(e=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return i.prototype.getForwardRay.call(this,e);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),r=n.getTranslation(),o=new d.e(0,0,-1),l=d.e.TransformNormal(o,n),h=d.e.Normalize(l);return new Bn.a(r,h,e)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(Lo),dI=function(i){function t(e){var n=i.call(this,e)||this;return n._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:Ie.POINTING_POSE},n.thumbstickValues={x:0,y:0},n.onThumbstickStateChangedObservable=new E.c,n.onThumbstickValuesChangedObservable=new E.c,n.onTrackpadChangedObservable=n.onPadStateChangedObservable,n.onTrackpadValuesChangedObservable=n.onPadValuesChangedObservable,n}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},t}(eh);Di._ControllerFactories.push({canCreate:function(i){return i.id.indexOf(eh.GAMEPAD_ID_PREFIX)===0},create:function(i){return new eh(i)}});var th=c(75),fs=c(63),Or=c(51),br=c(36),qc=function(i){function t(e,n,r,o,l){var h,v,b,A,D,N,j;n===void 0&&(n=x.a.Gray()),r===void 0&&(r=br.a.DefaultUtilityLayer),o===void 0&&(o=null),l===void 0&&(l=1);var k=i.call(this,r)||this;k._pointerObserver=null,k.snapDistance=0,k.onSnapObservable=new E.c,k.uniformScaling=!1,k.sensitivity=1,k._isEnabled=!0,k._parent=null,k._dragging=!1,k._tmpVector=new d.e,k._tmpMatrix=new d.a,k._tmpMatrix2=new d.a,k._parent=o,k._coloredMaterial=new Qt.a("",r.utilityLayerScene),k._coloredMaterial.diffuseColor=n,k._coloredMaterial.specularColor=n.subtract(new x.a(.1,.1,.1)),k._hoverMaterial=new Qt.a("",r.utilityLayerScene),k._hoverMaterial.diffuseColor=x.a.Yellow(),k._disableMaterial=new Qt.a("",r.utilityLayerScene),k._disableMaterial.diffuseColor=x.a.Gray(),k._disableMaterial.alpha=.4,k._gizmoMesh=new Ne.a("axis",r.utilityLayerScene);var H=k._createGizmoMesh(k._gizmoMesh,l),J=H.arrowMesh,te=H.arrowTail,oe=k._createGizmoMesh(k._gizmoMesh,l+4,!0);k._gizmoMesh.lookAt(k._rootMesh.position.add(e)),k._rootMesh.addChild(k._gizmoMesh),k._gizmoMesh.scaling.scaleInPlace(1/3);var ce=J.position.clone(),he=te.position.clone(),_e=te.scaling.clone(),ye=function(Ce){var Ue=Ce*(3/k._rootMesh.scaling.length())*6;J.position.z+=Ue/3.5,te.scaling.y+=Ue,te.position.z=J.position.z/2},Ee=function(){J.position.set(ce.x,ce.y,ce.z),te.position.set(he.x,he.y,he.z),te.scaling.set(_e.x,_e.y,_e.z),k._dragging=!1};k.dragBehavior=new ui.a({dragAxis:e}),k.dragBehavior.moveAttached=!1,k._rootMesh.addBehavior(k.dragBehavior);var Oe=0,Ae=new d.e,xe={snapDistance:0};k.dragBehavior.onDragObservable.add(function(Ce){if(k.attachedNode){var Ue=k.sensitivity*Ce.dragDistance*(3*k.scaleRatio/k._rootMesh.scaling.length()),Le=!1,ke=0;k.uniformScaling?(k.attachedNode.getWorldMatrix().decompose(Ae),Ae.normalize(),Ae.y<0&&Ae.scaleInPlace(-1)):Ae.copyFrom(e),k.snapDistance==0?Ae.scaleToRef(Ue,Ae):(Oe+=Ue,Math.abs(Oe)>k.snapDistance?(ke=Math.floor(Math.abs(Oe)/k.snapDistance),Oe<0&&(ke*=-1),Oe%=k.snapDistance,Ae.scaleToRef(k.snapDistance*ke,Ae),Le=!0):Ae.scaleInPlace(0)),d.a.ScalingToRef(1+Ae.x,1+Ae.y,1+Ae.z,k._tmpMatrix2),k._tmpMatrix2.multiplyToRef(k.attachedNode.getWorldMatrix(),k._tmpMatrix),k._tmpMatrix.decompose(k._tmpVector),Math.abs(k._tmpVector.x)<1e5&&Math.abs(k._tmpVector.y)<1e5&&Math.abs(k._tmpVector.z)<1e5&&k.attachedNode.getWorldMatrix().copyFrom(k._tmpMatrix),Le&&(xe.snapDistance=k.snapDistance*ke,k.onSnapObservable.notifyObservers(xe)),k._matrixChanged()}}),k.dragBehavior.onDragStartObservable.add(function(){k._dragging=!0}),k.dragBehavior.onDragObservable.add(function(Ce){return ye(Ce.dragDistance)}),k.dragBehavior.onDragEndObservable.add(Ee),(b=(v=(h=o==null?void 0:o.uniformScaleGizmo)===null||h===void 0?void 0:h.dragBehavior)===null||v===void 0?void 0:v.onDragObservable)===null||b===void 0||b.add(function(Ce){return ye(Ce.delta.y)}),(N=(D=(A=o==null?void 0:o.uniformScaleGizmo)===null||A===void 0?void 0:A.dragBehavior)===null||D===void 0?void 0:D.onDragEndObservable)===null||N===void 0||N.add(Ee);var Pe={gizmoMeshes:[J,te],colliderMeshes:[oe.arrowMesh,oe.arrowTail],material:k._coloredMaterial,hoverMaterial:k._hoverMaterial,disableMaterial:k._disableMaterial,active:!1};(j=k._parent)===null||j===void 0||j.addToAxisCache(k._gizmoMesh,Pe),k._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Ce){var Ue;if(!k._customMeshSet&&(k._isHovered=Pe.colliderMeshes.indexOf((Ue=Ce==null?void 0:Ce.pickInfo)===null||Ue===void 0?void 0:Ue.pickedMesh)!=-1,!k._parent)){var Le=k._isHovered||k._dragging?k._hoverMaterial:k._coloredMaterial;Pe.gizmoMeshes.forEach(function(ke){ke.material=Le,ke.color&&(ke.color=Le.diffuseColor)})}});var Be=r._getSharedGizmoLight();return Be.includedOnlyMeshes=Be.includedOnlyMeshes.concat(k._rootMesh.getChildMeshes()),k}return Object(_.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){r===void 0&&(r=!1);var o=fs.a.CreateBox("yPosMesh",{size:.4*(1+(n-1)/4)},this.gizmoLayer.utilityLayerScene),l=wi.a.CreateCylinder("cylinder",{diameterTop:.005*n,height:.275,diameterBottom:.005*n,tessellation:96},this.gizmoLayer.utilityLayerScene);return o.scaling.scaleInPlace(.1),o.material=this._coloredMaterial,o.rotation.x=Math.PI/2,o.position.z+=.3,l.material=this._coloredMaterial,l.position.z+=.1375,l.rotation.x=Math.PI/2,r&&(o.visibility=0,l.visibility=0),e.addChild(o),e.addChild(l),{arrowMesh:o,arrowTail:l}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(e,n){var r=this;n===void 0&&(n=!1),i.prototype.setCustomMesh.call(this,e),n&&(this._rootMesh.getChildMeshes().forEach(function(o){o.material=r._coloredMaterial,o.color&&(o.color=r._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},t}(Or.a),Mr=c(45),kn=c(40),Iy=function(i){function t(e,n){e===void 0&&(e=x.a.Gray()),n===void 0&&(n=br.a.DefaultKeepDepthUtilityLayer);var r=i.call(this,n)||this;r._boundingDimensions=new d.e(1,1,1),r._renderObserver=null,r._pointerObserver=null,r._scaleDragSpeed=.2,r._tmpQuaternion=new d.b,r._tmpVector=new d.e(0,0,0),r._tmpRotationMatrix=new d.a,r.ignoreChildren=!1,r.includeChildPredicate=null,r.rotationSphereSize=.1,r.scaleBoxSize=.1,r.fixedDragMeshScreenSize=!1,r.fixedDragMeshBoundsSize=!1,r.fixedDragMeshScreenSizeDistanceFactor=10,r.onDragStartObservable=new E.c,r.onScaleBoxDragObservable=new E.c,r.onScaleBoxDragEndObservable=new E.c,r.onRotationSphereDragObservable=new E.c,r.onRotationSphereDragEndObservable=new E.c,r.scalePivot=null,r._existingMeshScale=new d.e,r._dragMesh=null,r.pointerDragBehavior=new ui.a,r.updateScale=!1,r._anchorMesh=new Lt.a("anchor",n.utilityLayerScene),r.coloredMaterial=new Qt.a("",n.utilityLayerScene),r.coloredMaterial.disableLighting=!0,r.hoverColoredMaterial=new Qt.a("",n.utilityLayerScene),r.hoverColoredMaterial.disableLighting=!0,r._lineBoundingBox=new Lt.a("",n.utilityLayerScene),r._lineBoundingBox.rotationQuaternion=new d.b;var o=[];o.push(kn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(r._boundingDimensions.x,0,0)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(0,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,0,0),new d.e(0,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,0,0),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,0,0),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,r._boundingDimensions.y,0),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,r._boundingDimensions.y,0),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,0,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(0,0,r._boundingDimensions.z),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),o.push(kn.a.CreateLines("lines",{points:[new d.e(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new d.e(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),o.forEach(function(J){J.color=e,J.position.addInPlace(new d.e(-r._boundingDimensions.x/2,-r._boundingDimensions.y/2,-r._boundingDimensions.z/2)),J.isPickable=!1,r._lineBoundingBox.addChild(J)}),r._rootMesh.addChild(r._lineBoundingBox),r.setColor(e),r._rotateSpheresParent=new Lt.a("",n.utilityLayerScene),r._rotateSpheresParent.rotationQuaternion=new d.b;for(var l=function(J){var te=Mr.a.CreateSphere("",{diameter:1},n.utilityLayerScene);te.rotationQuaternion=new d.b,te.material=h.coloredMaterial,(D=new ui.a({})).moveAttached=!1,D.updateDragPlane=!1,te.addBehavior(D);var oe=new d.e(1,0,0),ce=0;D.onDragStartObservable.add(function(){oe.copyFrom(te.forward),ce=0}),D.onDragObservable.add(function(he){if(r.onRotationSphereDragObservable.notifyObservers({}),r.attachedMesh){var _e=r.attachedMesh.parent;if(_e&&_e.scaling&&_e.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");vr.a._RemoveAndStorePivotPoint(r.attachedMesh);var ye=oe,Ee=he.dragPlaneNormal.scale(d.e.Dot(he.dragPlaneNormal,ye)),Oe=ye.subtract(Ee).normalizeToNew(),Ae=d.e.Dot(Oe,he.delta)<0?Math.abs(he.delta.length()):-Math.abs(he.delta.length());Ae=Ae/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),r.attachedMesh.rotationQuaternion||(r.attachedMesh.rotationQuaternion=d.b.RotationYawPitchRoll(r.attachedMesh.rotation.y,r.attachedMesh.rotation.x,r.attachedMesh.rotation.z)),r._anchorMesh.rotationQuaternion||(r._anchorMesh.rotationQuaternion=d.b.RotationYawPitchRoll(r._anchorMesh.rotation.y,r._anchorMesh.rotation.x,r._anchorMesh.rotation.z)),ce+=Ae,Math.abs(ce)<=2*Math.PI&&(J>=8?d.b.RotationYawPitchRollToRef(0,0,Ae,r._tmpQuaternion):J>=4?d.b.RotationYawPitchRollToRef(Ae,0,0,r._tmpQuaternion):d.b.RotationYawPitchRollToRef(0,Ae,0,r._tmpQuaternion),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.rotationQuaternion.multiplyToRef(r._tmpQuaternion,r._anchorMesh.rotationQuaternion),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(_e)),r.updateBoundingBox(),vr.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),D.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(te)}),D.onDragEndObservable.add(function(){r.onRotationSphereDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),h._rotateSpheresParent.addChild(te)},h=this,v=0;v<12;v++)l(v);r._rootMesh.addChild(r._rotateSpheresParent),r._scaleBoxesParent=new Lt.a("",n.utilityLayerScene),r._scaleBoxesParent.rotationQuaternion=new d.b;for(var b=0;b<3;b++)for(var A=0;A<3;A++)for(var D,N=function(){var J=(b===1?1:0)+(A===1?1:0)+(k===1?1:0);if(J===1||J===3)return"continue";var te=fs.a.CreateBox("",{size:1},n.utilityLayerScene);te.material=j.coloredMaterial,te.metadata=J===2;var oe=new d.e(b-1,A-1,k-1).normalize();(D=new ui.a({dragAxis:oe})).updateDragPlane=!1,D.moveAttached=!1,te.addBehavior(D),D.onDragObservable.add(function(ce){if(r.onScaleBoxDragObservable.notifyObservers({}),r.attachedMesh){var he=r.attachedMesh.parent;if(he&&he.scaling&&he.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");vr.a._RemoveAndStorePivotPoint(r.attachedMesh);var _e=ce.dragDistance/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),ye=new d.e(_e,_e,_e);J===2&&(ye.x*=Math.abs(oe.x),ye.y*=Math.abs(oe.y),ye.z*=Math.abs(oe.z)),ye.scaleInPlace(r._scaleDragSpeed),r.updateBoundingBox(),r.scalePivot?(r.attachedMesh.getWorldMatrix().getRotationMatrixToRef(r._tmpRotationMatrix),r._boundingDimensions.scaleToRef(.5,r._tmpVector),d.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector),r._boundingDimensions.multiplyToRef(r.scalePivot,r._tmpVector),d.e.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.addInPlace(r._tmpVector)):(te.absolutePosition.subtractToRef(r._anchorMesh.position,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector)),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.scaling.addInPlace(ye),(r._anchorMesh.scaling.x<0||r._anchorMesh.scaling.y<0||r._anchorMesh.scaling.z<0)&&r._anchorMesh.scaling.subtractInPlace(ye),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(he),vr.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),D.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(te)}),D.onDragEndObservable.add(function(){r.onScaleBoxDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),j._scaleBoxesParent.addChild(te)},j=this,k=0;k<3;k++)N();r._rootMesh.addChild(r._scaleBoxesParent);var H=new Array;return r._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(J){H[J.event.pointerId]?J.pickInfo&&J.pickInfo.pickedMesh!=H[J.event.pointerId]&&(H[J.event.pointerId].material=r.coloredMaterial,delete H[J.event.pointerId]):r._rotateSpheresParent.getChildMeshes().concat(r._scaleBoxesParent.getChildMeshes()).forEach(function(te){J.pickInfo&&J.pickInfo.pickedMesh==te&&(H[J.event.pointerId]=te,te.material=r.hoverColoredMaterial)})}),r._renderObserver=r.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){r.attachedMesh&&!r._existingMeshScale.equals(r.attachedMesh.scaling)?r.updateBoundingBox():(r.fixedDragMeshScreenSize||r.fixedDragMeshBoundsSize)&&(r._updateRotationSpheres(),r._updateScaleBoxes()),r._dragMesh&&r.attachedMesh&&r.pointerDragBehavior.dragging&&(r._lineBoundingBox.position.rotateByQuaternionToRef(r._rootMesh.rotationQuaternion,r._tmpVector),r.attachedMesh.setAbsolutePosition(r._dragMesh.position.add(r._tmpVector.scale(-1))))}),r.updateBoundingBox(),r}return Object(_.d)(t,i),t.prototype.setColor=function(e){this.coloredMaterial.emissiveColor=e,this.hoverColoredMaterial.emissiveColor=e.clone().add(new x.a(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(n){n.color&&(n.color=e)})},t.prototype._attachedNodeChanged=function(e){var n=this;if(e){vr.a._RemoveAndStorePivotPoint(e);var r=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(r),vr.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(o){o.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){n._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(n){n.isVisible=!e||n==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){vr.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null);var n=null;this.attachedMesh.skeleton&&(n=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=d.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=d.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var r=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);r.max.subtractToRef(r.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((r.max.x+r.min.x)/2,(r.max.y+r.min.y)/2,(r.max.z+r.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=n)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),vr.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),n=0;n<3;n++)for(var r=0;r<2;r++)for(var o=0;o<2;o++){var l=4*n+2*r+o;if(n==0&&(e[l].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*r,this._boundingDimensions.z*o),e[l].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(d.e.Cross(e[l].position.normalizeToNew(),d.e.Right()).normalizeToNew().add(e[l].position))),n==1&&(e[l].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y/2,this._boundingDimensions.z*o),e[l].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(d.e.Cross(e[l].position.normalizeToNew(),d.e.Up()).normalizeToNew().add(e[l].position))),n==2&&(e[l].position.set(this._boundingDimensions.x*r,this._boundingDimensions.y*o,this._boundingDimensions.z/2),e[l].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[l].lookAt(d.e.Cross(e[l].position.normalizeToNew(),d.e.Forward()).normalizeToNew().add(e[l].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[l].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var h=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[l].scaling.set(h,h,h)}else this.fixedDragMeshBoundsSize?e[l].scaling.set(this.rotationSphereSize*this._boundingDimensions.x,this.rotationSphereSize*this._boundingDimensions.y,this.rotationSphereSize*this._boundingDimensions.z):e[l].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),n=0,r=0;r<3;r++)for(var o=0;o<3;o++)for(var l=0;l<3;l++){var h=(r===1?1:0)+(o===1?1:0)+(l===1?1:0);if(h!==1&&h!==3){if(e[n])if(e[n].position.set(this._boundingDimensions.x*(r/2),this._boundingDimensions.y*(o/2),this._boundingDimensions.z*(l/2)),e[n].position.addInPlace(new d.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var v=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(v,v,v)}else this.fixedDragMeshBoundsSize?e[n].scaling.set(this.scaleBoxSize*this._boundingDimensions.x,this.scaleBoxSize*this._boundingDimensions.y,this.scaleBoxSize*this._boundingDimensions.z):e[n].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize);n++}}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(n,r){r<4?n.setEnabled(e.indexOf("x")!=-1):r<8?n.setEnabled(e.indexOf("y")!=-1):n.setEnabled(e.indexOf("z")!=-1)})},t.prototype.setEnabledScaling=function(e,n){n===void 0&&(n=!1),this._scaleBoxesParent.getChildMeshes().forEach(function(r,o){var l=e;n&&r.metadata===!0&&(l=!1),r.setEnabled(l)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=Ne.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new d.b,this.pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),i.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var n=function(v){v.isPickable=!1,v.getChildMeshes().forEach(function(b){n(b)})};n(e),e.rotationQuaternion||(e.rotationQuaternion=d.b.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var r=e.position.clone(),o=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var l=fs.a.CreateBox("box",{size:1},e.getScene()),h=e.getHierarchyBoundingVectors();return h.max.subtractToRef(h.min,l.scaling),l.scaling.y===0&&(l.scaling.y=Gt.a),l.scaling.x===0&&(l.scaling.x=Gt.a),l.scaling.z===0&&(l.scaling.z=Gt.a),l.position.set((h.max.x+h.min.x)/2,(h.max.y+h.min.y)/2,(h.max.z+h.min.z)/2),e.addChild(l),e.rotationQuaternion.copyFrom(o),e.position.copyFrom(r),e.removeChild(l),l.addChild(e),l.visibility=0,l},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo")},t}(Or.a),nh=function(i){function t(e,n,r,o,l,h,v){var b;n===void 0&&(n=x.a.Gray()),r===void 0&&(r=br.a.DefaultUtilityLayer),o===void 0&&(o=32),l===void 0&&(l=null),v===void 0&&(v=1);var A=i.call(this,r)||this;A._pointerObserver=null,A.snapDistance=0,A.onSnapObservable=new E.c,A._isEnabled=!0,A._parent=null,A._dragging=!1,A._parent=l,A._coloredMaterial=new Qt.a("",r.utilityLayerScene),A._coloredMaterial.diffuseColor=n,A._coloredMaterial.specularColor=n.subtract(new x.a(.1,.1,.1)),A._hoverMaterial=new Qt.a("",r.utilityLayerScene),A._hoverMaterial.diffuseColor=x.a.Yellow(),A._disableMaterial=new Qt.a("",r.utilityLayerScene),A._disableMaterial.diffuseColor=x.a.Gray(),A._disableMaterial.alpha=.4,A._gizmoMesh=new Ne.a("",r.utilityLayerScene);var D=A._createGizmoMesh(A._gizmoMesh,v,o),N=D.rotationMesh,j=D.collider,k=[];A._rotationCircle=A.setupRotationCircle(k,A._gizmoMesh),A._gizmoMesh.lookAt(A._rootMesh.position.add(e)),A._rootMesh.addChild(A._gizmoMesh),A._gizmoMesh.scaling.scaleInPlace(1/3),A.dragBehavior=new ui.a({dragPlaneNormal:e}),A.dragBehavior.moveAttached=!1,A.dragBehavior.maxDragAngle=9*Math.PI/20,A.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,A._rootMesh.addBehavior(A.dragBehavior);var H=0,J=new d.e,te=new d.e,oe=new d.a,ce=new d.e,he=new d.e;A.dragBehavior.onDragStartObservable.add(function(Pe){if(A.attachedNode){J.copyFrom(Pe.dragPlanePoint);var Be=new d.e(0,0,1),Ce=A._rotationCircle.getDirection(Be);Ce.normalize(),A._gizmoMesh.removeChild(A._rotationCircle),J.copyFrom(Pe.dragPlanePoint),te=Pe.dragPlanePoint;var Ue=A._rotationCircle.getAbsolutePosition().clone(),Le=A._rotationCircle.getAbsolutePosition().clone().addInPlace(Ce),ke=Pe.dragPlanePoint,qe=d.e.GetAngleBetweenVectors(Le.subtract(Ue),ke.subtract(Ue),A._rotationCircle.up);A._rotationCircle.addRotation(0,qe,0),A._dragging=!0}}),A.dragBehavior.onDragEndObservable.add(function(){H=0,A.updateRotationCircle(A._rotationCircle,k,H,te),A._gizmoMesh.addChild(A._rotationCircle),A._dragging=!1});var _e={snapDistance:0},ye=0,Ee=new d.a,Oe=new d.b;A.dragBehavior.onDragObservable.add(function(Pe){if(A.attachedNode){var Be=new d.e(1,1,1),Ce=new d.b(0,0,0,1),Ue=new d.e(0,0,0);A.attachedNode.getWorldMatrix().decompose(Be,Ce,Ue);var Le=Pe.dragPlanePoint.subtract(Ue).normalize(),ke=J.subtract(Ue).normalize(),qe=d.e.Cross(Le,ke),at=d.e.Dot(Le,ke),lt=Math.atan2(qe.length(),at);ce.copyFrom(e),he.copyFrom(e),A.updateGizmoRotationToMatchAttachedMesh&&(Ce.toRotationMatrix(oe),he=d.e.TransformCoordinates(ce,oe));var ft=!1;if(r.utilityLayerScene.activeCamera){var Je=r.utilityLayerScene.activeCamera.position.subtract(Ue);d.e.Dot(Je,he)>0&&(ce.scaleInPlace(-1),he.scaleInPlace(-1),ft=!0)}d.e.Dot(he,qe)>0&&(lt=-lt);var dt=!1;if(A.snapDistance!=0)if(ye+=lt,Math.abs(ye)>A.snapDistance){var ut=Math.floor(Math.abs(ye)/A.snapDistance);ye<0&&(ut*=-1),ye%=A.snapDistance,lt=A.snapDistance*ut,dt=!0}else lt=0;H+=ft?-lt:lt,A.updateRotationCircle(A._rotationCircle,k,H,te);var tt=Math.sin(lt/2);if(Oe.set(ce.x*tt,ce.y*tt,ce.z*tt,Math.cos(lt/2)),Ee.determinant()>0){var mt=new d.e;Oe.toEulerAnglesToRef(mt),d.b.RotationYawPitchRollToRef(mt.y,-mt.x,-mt.z,Oe)}A.updateGizmoRotationToMatchAttachedMesh?Ce.multiplyToRef(Oe,Ce):Oe.multiplyToRef(Ce,Ce),A.attachedNode.getWorldMatrix().copyFrom(d.a.Compose(Be,Ce,Ue)),J.copyFrom(Pe.dragPlanePoint),dt&&(_e.snapDistance=lt,A.onSnapObservable.notifyObservers(_e)),A._matrixChanged()}});var Ae=r._getSharedGizmoLight();Ae.includedOnlyMeshes=Ae.includedOnlyMeshes.concat(A._rootMesh.getChildMeshes(!1));var xe={colliderMeshes:[j],gizmoMeshes:[N],material:A._coloredMaterial,hoverMaterial:A._hoverMaterial,disableMaterial:A._disableMaterial,active:!1};return(b=A._parent)===null||b===void 0||b.addToAxisCache(A._gizmoMesh,xe),A._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(Pe){var Be;if(!A._customMeshSet&&(A._isHovered=xe.colliderMeshes.indexOf((Be=Pe==null?void 0:Pe.pickInfo)===null||Be===void 0?void 0:Be.pickedMesh)!=-1,!A._parent)){var Ce=A._isHovered||A._dragging?A._hoverMaterial:A._coloredMaterial;xe.gizmoMeshes.forEach(function(Ue){Ue.material=Ce,Ue.color&&(Ue.color=Ce.diffuseColor)})}}),A}return Object(_.d)(t,i),t.prototype._createGizmoMesh=function(e,n,r){var o=Ne.a.CreateTorus("ignore",.6,.03*n,r,this.gizmoLayer.utilityLayerScene);o.visibility=0;var l=Ne.a.CreateTorus("",.6,.005*n,r,this.gizmoLayer.utilityLayerScene);return l.material=this._coloredMaterial,l.rotation.x=Math.PI/2,o.rotation.x=Math.PI/2,e.addChild(l),e.addChild(o),{rotationMesh:l,collider:o}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.setupRotationCircle=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=-Math.PI/2;o<Math.PI/2-1.5;o+=r/2){for(var l=[],h=0;h<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;h+=r)if(h<0){var v=t._CircleConstants.radius*Math.sin(h)*Math.cos(o),b=t._CircleConstants.radius*Math.cos(h)*Math.cos(o);l.push(new d.e(v,0,b))}else l.push(new d.e(0,0,0));e.push(l)}var A=new Qt.a("",this.gizmoLayer.utilityLayerScene);A.diffuseColor=x.a.Yellow(),A.backFaceCulling=!1;var D=Ne.a.CreateRibbon("rotationCircle",e,!1,!1,0,this.gizmoLayer.utilityLayerScene,!0);return D.material=A,D.material.alpha=.25,D.rotation.x=Math.PI/2,n.addChild(D),D},t.prototype.updateRotationPath=function(e,n){for(var r=t._CircleConstants.pi2/t._CircleConstants.tessellation,o=0,l=-Math.PI/2;l<Math.PI/2-1.5;l+=r/2){var h=e[o];if(h)for(var v=0,b=0;b<t._CircleConstants.pi2*t._CircleConstants.rotationCircleRange+.01;b+=r){if(h[v])if(b<Math.abs(n)){var A=n>0?b:-1*b,D=n>0?l:-1*l;h[v].set(t._CircleConstants.radius*Math.sin(A)*Math.cos(D),0,t._CircleConstants.radius*Math.cos(A)*Math.cos(D))}else h[v].set(0,0,0);v++}o++}},t.prototype.updateRotationCircle=function(e,n,r,o){this.updateRotationPath(n,r),Ne.a.CreateRibbon("rotationCircle",n,!1,!1,0,this.gizmoLayer.utilityLayerScene,void 0,void 0,e.geometry?e:void 0)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),this._rotationCircle&&this._rotationCircle.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()}),i.prototype.dispose.call(this)},t._CircleConstants={radius:.3,pi2:2*Math.PI,tessellation:70,rotationCircleRange:4},t}(Or.a),Dy=function(i){function t(e,n,r,o,l){e===void 0&&(e=br.a.DefaultUtilityLayer),n===void 0&&(n=32),r===void 0&&(r=!1),o===void 0&&(o=1);var h=i.call(this,e)||this;return h.onDragStartObservable=new E.c,h.onDragEndObservable=new E.c,h._observables=[],h._gizmoAxisCache=new Map,h.xGizmo=new nh(new d.e(1,0,0),x.a.Red().scale(.5),e,n,h,r,o),h.yGizmo=new nh(new d.e(0,1,0),x.a.Green().scale(.5),e,n,h,r,o),h.zGizmo=new nh(new d.e(0,0,1),x.a.Blue().scale(.5),e,n,h,r,o),[h.xGizmo,h.yGizmo,h.zGizmo].forEach(function(v){v.dragBehavior.onDragStartObservable.add(function(){h.onDragStartObservable.notifyObservers({})}),v.dragBehavior.onDragEndObservable.add(function(){h.onDragEndObservable.notifyObservers({})})}),h.attachedMesh=null,h.attachedNode=null,l?l.addToAxisCache(h._gizmoAxisCache):Or.a.GizmoAxisPointerObserver(e,h._gizmoAxisCache),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),t.prototype._checkBillboardTransform=function(){this._nodeAttached&&this._nodeAttached.billboardMode&&console.log("Rotation Gizmo will not work with transforms in billboard mode.")},Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)})},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(Or.a),ps=c(46),Np=c(84),rh=function(i){function t(e,n,r,o){var l;n===void 0&&(n=x.a.Gray()),r===void 0&&(r=br.a.DefaultUtilityLayer),o===void 0&&(o=null);var h=i.call(this,r)||this;h._pointerObserver=null,h.snapDistance=0,h.onSnapObservable=new E.c,h._isEnabled=!1,h._parent=null,h._dragging=!1,h._parent=o,h._coloredMaterial=new Qt.a("",r.utilityLayerScene),h._coloredMaterial.diffuseColor=n,h._coloredMaterial.specularColor=n.subtract(new x.a(.1,.1,.1)),h._hoverMaterial=new Qt.a("",r.utilityLayerScene),h._hoverMaterial.diffuseColor=x.a.Yellow(),h._disableMaterial=new Qt.a("",r.utilityLayerScene),h._disableMaterial.diffuseColor=x.a.Gray(),h._disableMaterial.alpha=.4,h._gizmoMesh=t._CreatePlane(r.utilityLayerScene,h._coloredMaterial),h._gizmoMesh.lookAt(h._rootMesh.position.add(e)),h._gizmoMesh.scaling.scaleInPlace(1/3),h._gizmoMesh.parent=h._rootMesh;var v=0,b=new d.e,A={snapDistance:0};h.dragBehavior=new ui.a({dragPlaneNormal:e}),h.dragBehavior.moveAttached=!1,h._rootMesh.addBehavior(h.dragBehavior),h.dragBehavior.onDragObservable.add(function(j){if(h.attachedNode){if(h.snapDistance==0)h.attachedNode.getWorldMatrix().addTranslationFromFloats(j.delta.x,j.delta.y,j.delta.z);else if(v+=j.dragDistance,Math.abs(v)>h.snapDistance){var k=Math.floor(Math.abs(v)/h.snapDistance);v%=h.snapDistance,j.delta.normalizeToRef(b),b.scaleInPlace(h.snapDistance*k),h.attachedNode.getWorldMatrix().addTranslationFromFloats(b.x,b.y,b.z),A.snapDistance=h.snapDistance*k,h.onSnapObservable.notifyObservers(A)}h._matrixChanged()}}),h.dragBehavior.onDragStartObservable.add(function(){h._dragging=!0}),h.dragBehavior.onDragEndObservable.add(function(){h._dragging=!1});var D=r._getSharedGizmoLight();D.includedOnlyMeshes=D.includedOnlyMeshes.concat(h._rootMesh.getChildMeshes(!1));var N={gizmoMeshes:h._gizmoMesh.getChildMeshes(),colliderMeshes:h._gizmoMesh.getChildMeshes(),material:h._coloredMaterial,hoverMaterial:h._hoverMaterial,disableMaterial:h._disableMaterial,active:!1};return(l=h._parent)===null||l===void 0||l.addToAxisCache(h._gizmoMesh,N),h._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(j){var k;if(!h._customMeshSet&&(h._isHovered=N.colliderMeshes.indexOf((k=j==null?void 0:j.pickInfo)===null||k===void 0?void 0:k.pickedMesh)!=-1,!h._parent)){var H=h._isHovered||h._dragging?h._hoverMaterial:h._coloredMaterial;N.gizmoMeshes.forEach(function(J){J.material=H})}}),h}return Object(_.d)(t,i),t._CreatePlane=function(e,n){var r=new ps.a("plane",e),o=Np.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return o.material=n,o.parent=r,r},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),i.prototype.dispose.call(this),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(e){e&&e.dispose()})},t}(Or.a),wy=function(i){function t(e,n,r){e===void 0&&(e=br.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new E.c,o.onDragEndObservable=new E.c,o._planarGizmoEnabled=!1,o.xGizmo=new th.a(new d.e(1,0,0),x.a.Red().scale(.5),e,o,n),o.yGizmo=new th.a(new d.e(0,1,0),x.a.Green().scale(.5),e,o,n),o.zGizmo=new th.a(new d.e(0,0,1),x.a.Blue().scale(.5),e,o,n),o.xPlaneGizmo=new rh(new d.e(1,0,0),x.a.Red().scale(.5),o.gizmoLayer,o),o.yPlaneGizmo=new rh(new d.e(0,1,0),x.a.Green().scale(.5),o.gizmoLayer,o),o.zPlaneGizmo=new rh(new d.e(0,0,1),x.a.Blue().scale(.5),o.gizmoLayer,o),[o.xGizmo,o.yGizmo,o.zGizmo,o.xPlaneGizmo,o.yPlaneGizmo,o.zPlaneGizmo].forEach(function(l){l.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),l.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,r?r.addToAxisCache(o._gizmoAxisCache):Or.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=null,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(e){var n=this;this._planarGizmoEnabled=e,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(r){r&&(r.isEnabled=e,e&&(r.attachedMesh?r.attachedMesh=n.attachedMesh:r.attachedNode=n.attachedNode))},this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},t}(Or.a);_t.a.CreatePolyhedron=function(i){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var e,n,r,o,l,h,v=i.type&&(i.type<0||i.type>=t.length)?0:i.type||0,b=i.size,A=i.sizeX||b||1,D=i.sizeY||b||1,N=i.sizeZ||b||1,j=i.custom||t[v],k=j.face.length,H=i.faceUV||new Array(k),J=i.faceColors,te=i.flat===void 0||i.flat,oe=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE,ce=new Array,he=new Array,_e=new Array,ye=new Array,Ee=new Array,Oe=0,Ae=0,xe=new Array,Pe=0,Be=0;if(te)for(Be=0;Be<k;Be++)J&&J[Be]===void 0&&(J[Be]=new x.b(1,1,1,1)),H&&H[Be]===void 0&&(H[Be]=new d.f(0,0,1,1));if(te)for(Be=0;Be<k;Be++){var Ce=j.face[Be].length;for(r=2*Math.PI/Ce,o=.5*Math.tan(r/2),l=.5,Pe=0;Pe<Ce;Pe++)ce.push(j.vertex[j.face[Be][Pe]][0]*A,j.vertex[j.face[Be][Pe]][1]*D,j.vertex[j.face[Be][Pe]][2]*N),xe.push(Oe),Oe++,e=H[Be].x+(H[Be].z-H[Be].x)*(.5+o),n=H[Be].y+(H[Be].w-H[Be].y)*(l-.5),ye.push(e,n),h=o*Math.cos(r)-l*Math.sin(r),l=o*Math.sin(r)+l*Math.cos(r),o=h,J&&Ee.push(J[Be].r,J[Be].g,J[Be].b,J[Be].a);for(Pe=0;Pe<Ce-2;Pe++)he.push(xe[0+Ae],xe[Pe+2+Ae],xe[Pe+1+Ae]);Ae+=Ce}else{for(Pe=0;Pe<j.vertex.length;Pe++)ce.push(j.vertex[Pe][0]*A,j.vertex[Pe][1]*D,j.vertex[Pe][2]*N),ye.push(0,0);for(Be=0;Be<k;Be++)for(Pe=0;Pe<j.face[Be].length-2;Pe++)he.push(j.face[Be][0],j.face[Be][Pe+2],j.face[Be][Pe+1])}_t.a.ComputeNormals(ce,he,_e),_t.a._ComputeSides(oe,ce,he,_e,ye,i.frontUVs,i.backUVs);var Ue=new _t.a;return Ue.positions=ce,Ue.indices=he,Ue.normals=_e,Ue.uvs=ye,J&&te&&(Ue.colors=Ee),Ue},Ne.a.CreatePolyhedron=function(i,t,e){return Zc.CreatePolyhedron(i,t,e)};var Zc=function(){function i(){}return i.CreatePolyhedron=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreatePolyhedron(e).applyToMesh(r,e.updatable),r},i}(),Ly=function(i){function t(e,n,r){e===void 0&&(e=br.a.DefaultUtilityLayer),n===void 0&&(n=1);var o=i.call(this,e)||this;return o._meshAttached=null,o._nodeAttached=null,o._sensitivity=1,o._observables=[],o._gizmoAxisCache=new Map,o.onDragStartObservable=new E.c,o.onDragEndObservable=new E.c,o.uniformScaleGizmo=o._createUniformScaleMesh(),o.xGizmo=new qc(new d.e(1,0,0),x.a.Red().scale(.5),e,o,n),o.yGizmo=new qc(new d.e(0,1,0),x.a.Green().scale(.5),e,o,n),o.zGizmo=new qc(new d.e(0,0,1),x.a.Blue().scale(.5),e,o,n),[o.xGizmo,o.yGizmo,o.zGizmo,o.uniformScaleGizmo].forEach(function(l){l.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),l.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,o.attachedNode=null,r?r.addToAxisCache(o._gizmoAxisCache):Or.a.GizmoAxisPointerObserver(e,o._gizmoAxisCache),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedMesh=e:n.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n.isEnabled?n.attachedNode=e:n.attachedNode=null})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(n){e=e||n.isHovered}),e},enumerable:!1,configurable:!0}),t.prototype._createUniformScaleMesh=function(){this._coloredMaterial=new Qt.a("",this.gizmoLayer.utilityLayerScene),this._coloredMaterial.diffuseColor=x.a.Gray(),this._hoverMaterial=new Qt.a("",this.gizmoLayer.utilityLayerScene),this._hoverMaterial.diffuseColor=x.a.Yellow(),this._disableMaterial=new Qt.a("",this.gizmoLayer.utilityLayerScene),this._disableMaterial.diffuseColor=x.a.Gray(),this._disableMaterial.alpha=.4;var e=new qc(new d.e(0,1,0),x.a.Gray().scale(.5),this.gizmoLayer,this);e.updateGizmoRotationToMatchAttachedMesh=!1,e.uniformScaling=!0,this._uniformScalingMesh=Zc.CreatePolyhedron("uniform",{type:1},e.gizmoLayer.utilityLayerScene),this._uniformScalingMesh.scaling.scaleInPlace(.01),this._uniformScalingMesh.visibility=0,this._octahedron=Zc.CreatePolyhedron("",{type:1},e.gizmoLayer.utilityLayerScene),this._octahedron.scaling.scaleInPlace(.007),this._uniformScalingMesh.addChild(this._octahedron),e.setCustomMesh(this._uniformScalingMesh,!0);var n=this.gizmoLayer._getSharedGizmoLight();n.includedOnlyMeshes=n.includedOnlyMeshes.concat(this._octahedron);var r={gizmoMeshes:[this._octahedron,this._uniformScalingMesh],colliderMeshes:[this._uniformScalingMesh],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1};return this.addToAxisCache(e._rootMesh,r),e},Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){e?(this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.updateGizmoRotationToMatchAttachedMesh=e)})):p.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.snapDistance=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.scaleRatio=e)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&(n.sensitivity=e)})},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,n){this._gizmoAxisCache.set(e,n)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(n){n&&n.dispose()}),this._observables.forEach(function(n){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(n)}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach(function(n){n&&n.dispose()}),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(n){n&&n.dispose()})},t}(Or.a),fI=function(){function i(t,e,n,r){e===void 0&&(e=1),n===void 0&&(n=br.a.DefaultUtilityLayer),r===void 0&&(r=br.a.DefaultKeepDepthUtilityLayer),this.scene=t,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new E.c,this.onAttachedToNodeObservable=new E.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObservers=[],this._attachedMesh=null,this._attachedNode=null,this._boundingBoxColor=x.a.FromHexString("#0984e3"),this._thickness=1,this._gizmoAxisCache=new Map,this.boundingBoxDragBehavior=new Vu,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultUtilityLayer=n,this._defaultKeepDepthUtilityLayer=r,this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._thickness=e,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null};var o=this._attachToMeshPointerObserver(t),l=Or.a.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache);this._pointerObservers=[o,l]}return Object.defineProperty(i.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isHovered",{get:function(){var t=!1;for(var e in this.gizmos){var n=this.gizmos[e];if(n&&n.isHovered){t=!0;break}}return t},enumerable:!1,configurable:!0}),i.prototype._attachToMeshPointerObserver=function(t){var e=this;return t.onPointerObservable.add(function(n){if(e.usePointerToAttachGizmos&&n.type==xt.a.POINTERDOWN)if(n.pickInfo&&n.pickInfo.pickedMesh){var r=n.pickInfo.pickedMesh;if(e.attachableMeshes==null)for(;r&&r.parent!=null;)r=r.parent;else{var o=!1;e.attachableMeshes.forEach(function(l){r&&(r==l||r.isDescendantOf(l))&&(r=l,o=!0)}),o||(r=null)}r instanceof Lt.a?e._attachedMesh!=r&&e.attachToMesh(r):e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)}else e.clearGizmoOnEmptyPointerEvent&&e.attachToMesh(null)})},i.prototype.attachToMesh=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=t,this._attachedNode=null,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedMesh=t)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(t)},i.prototype.attachToNode=function(t){for(var e in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=null,this._attachedNode=t,this.gizmos){var n=this.gizmos[e];n&&this._gizmosEnabled[e]&&(n.attachedNode=t)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(t)},Object.defineProperty(i.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(t){t?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new wy(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null),this._gizmosEnabled.positionGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(t){t?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Dy(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null),this._gizmosEnabled.rotationGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(t){t?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Ly(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(t){t?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new Iy(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=t},enumerable:!1,configurable:!0}),i.prototype.addToAxisCache=function(t){var e=this;t.size>0&&t.forEach(function(n,r){e._gizmoAxisCache.set(r,n)})},i.prototype.dispose=function(){var t=this;for(var e in this._pointerObservers.forEach(function(r){t.scene.onPointerObservable.remove(r)}),this.gizmos){var n=this.gizmos[e];n&&n.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},i}(),ro=c(48),ih=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._needProjectionMatrixCompute=!0,e}return Object(_.d)(t,i),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!1,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=d.e.Zero()),d.e.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=d.e.Zero()),d.e.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=d.e.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=d.e.Cross(this.direction,Se.a.Y),n=d.e.Cross(e,this.direction);return d.e.RotationFromAxis(e,n,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=d.e.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=d.a.Identity()),d.a.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return this.shadowMinZ!==void 0?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return this.shadowMaxZ!==void 0?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,n,r){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(n,r,e):this._setDefaultShadowProjectionMatrix(e,n,r),this},Object(_.c)([Object(V.o)()],t.prototype,"position",null),Object(_.c)([Object(V.o)()],t.prototype,"direction",null),Object(_.c)([Object(V.c)()],t.prototype,"shadowMinZ",null),Object(_.c)([Object(V.c)()],t.prototype,"shadowMaxZ",null),t}(ro.a);Z.a.AddNodeConstructor("Light_Type_1",function(i,t){return function(){return new Fp(i,d.e.Zero(),t)}});var Fp=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowFrustumSize=0,o._shadowOrthoScale=.1,o.autoUpdateExtends=!0,o.autoCalcShadowZBounds=!1,o._orthoLeft=Number.MAX_VALUE,o._orthoRight=Number.MIN_VALUE,o._orthoTop=Number.MIN_VALUE,o._orthoBottom=Number.MAX_VALUE,o.position=n.scale(-1),o.direction=n,o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return ro.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,n,r)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var n=this.getScene().activeCamera;n&&d.a.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,this.shadowMinZ!==void 0?this.shadowMinZ:n.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:n.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var l=d.e.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var h=Number.MAX_VALUE,v=Number.MIN_VALUE,b=0;b<r.length;b++){var A=r[b];if(A)for(var D=A.getBoundingInfo().boundingBox,N=0;N<D.vectorsWorld.length;N++)d.e.TransformCoordinatesToRef(D.vectorsWorld[N],n,l),l.x<this._orthoLeft&&(this._orthoLeft=l.x),l.y<this._orthoBottom&&(this._orthoBottom=l.y),l.x>this._orthoRight&&(this._orthoRight=l.x),l.y>this._orthoTop&&(this._orthoTop=l.y),this.autoCalcShadowZBounds&&(l.z<h&&(h=l.z),l.z>v&&(v=l.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=h,this._shadowMaxZ=v)}var j=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom;d.a.OrthoOffCenterLHToRef(this._orthoLeft-j*this.shadowOrthoScale,this._orthoRight+j*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,this.shadowMinZ!==void 0?this.shadowMinZ:o.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:o.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,n),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,n),this)},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?(e.setFloat3(n,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(n,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,n){e["DIRLIGHT"+n]=!0},Object(_.c)([Object(V.c)()],t.prototype,"shadowFrustumSize",null),Object(_.c)([Object(V.c)()],t.prototype,"shadowOrthoScale",null),Object(_.c)([Object(V.c)()],t.prototype,"autoUpdateExtends",void 0),Object(_.c)([Object(V.c)()],t.prototype,"autoCalcShadowZBounds",void 0),t}(ih);Ne.a.CreateHemisphere=function(i,t,e,n){var r={segments:t,diameter:e};return oh.CreateHemisphere(i,r,n)};var oh=function(){function i(){}return i.CreateHemisphere=function(t,e,n){e.diameter||(e.diameter=1),e.segments||(e.segments=16);var r=Mr.a.CreateSphere("",{slice:.5,diameter:e.diameter,segments:e.segments},n),o=Ne.a.CreateDisc("",e.diameter/2,3*e.segments+(4-e.segments),n);o.rotation.x=-Math.PI/2,o.parent=r;var l=Ne.a.MergeMeshes([o,r],!0);return l.name=t,l},i}();Z.a.AddNodeConstructor("Light_Type_2",function(i,t){return function(){return new Bp(i,d.e.Zero(),d.e.Zero(),0,0,t)}});var Bp=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,h)||this;return v._innerAngle=0,v._projectionTextureMatrix=d.a.Zero(),v._projectionTextureLightNear=1e-6,v._projectionTextureLightFar=1e3,v._projectionTextureUpDirection=d.e.Up(),v._projectionTextureViewLightDirty=!0,v._projectionTextureProjectionLightDirty=!0,v._projectionTextureDirty=!0,v._projectionTextureViewTargetVector=d.e.Zero(),v._projectionTextureViewLightMatrix=d.a.Zero(),v._projectionTextureProjectionLightMatrix=d.a.Zero(),v._projectionTextureScalingMatrix=d.a.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),v.position=n,v.direction=r,v.angle=o,v.exponent=l,v}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var n=this;this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled(function(){n._markMeshesAsLightDirty()}):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce(function(){n._markMeshesAsLightDirty()})))},enumerable:!1,configurable:!0}),t._IsProceduralTexture=function(e){return e.onGeneratedObservable!==void 0},t._IsTexture=function(e){return e.onLoadObservable!==void 0},t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return ro.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(e){i.prototype._setDirection.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(e){i.prototype._setPosition.call(this,e),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;if(o){this._shadowAngleScale=this._shadowAngleScale||1;var l=this._shadowAngleScale*this._angle;d.a.PerspectiveFovLHToRef(l,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),d.a.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,n=this.projectionTextureLightNear,r=e/(e-n),o=-r*n,l=1/Math.tan(this._angle/2);d.a.FromValuesToRef(l/1,0,0,0,0,l,0,0,0,0,r,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Ve.a){var e=this._projectionTexture.uScale/2,n=this._projectionTexture.vScale/2;d.a.FromValuesToRef(e,0,0,0,0,n,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferTexturesToEffect=function(e,n){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+n,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+n,this.projectionTexture)),this},t.prototype.transferToEffect=function(e,n){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,n),r=d.e.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,n),r=d.e.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){var r;return r=this.computeTransformedInformation()?d.e.Normalize(this.transformedDirection):d.e.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(n,-r.x,-r.y,-r.z):e.setFloat3(n,r.x,r.y,r.z),this},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,n){e["SPOTLIGHT"+n]=!0,e["PROJECTEDLIGHTTEXTURE"+n]=!(!this.projectionTexture||!this.projectionTexture.isReady())},Object(_.c)([Object(V.c)()],t.prototype,"angle",null),Object(_.c)([Object(V.c)()],t.prototype,"innerAngle",null),Object(_.c)([Object(V.c)()],t.prototype,"shadowAngleScale",null),Object(_.c)([Object(V.c)()],t.prototype,"exponent",void 0),Object(_.c)([Object(V.c)()],t.prototype,"projectionTextureLightNear",null),Object(_.c)([Object(V.c)()],t.prototype,"projectionTextureLightFar",null),Object(_.c)([Object(V.c)()],t.prototype,"projectionTextureUpDirection",null),Object(_.c)([Object(V.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(ih),pI=function(i){function t(e){e===void 0&&(e=br.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._cachedPosition=new d.e,n._cachedForward=new d.e(0,0,1),n._pointerObserver=null,n.onClickedObservable=new E.c,n._light=null,n.attachedMesh=new Lt.a("",n.gizmoLayer.utilityLayerScene),n._attachedMeshParent=new ps.a("parent",n.gizmoLayer.utilityLayerScene),n.attachedMesh.parent=n._attachedMeshParent,n._material=new Qt.a("light",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new x.a(.5,.5,.5),n._material.specularColor=new x.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._light&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._light))},xt.a.POINTERDOWN),n}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var n=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),e instanceof Yu.a?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=e instanceof Fp?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof Bp?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._lightMesh.parent=this._rootMesh;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new d.b,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,e.parent&&this._attachedMeshParent.freezeWorldMatrix(e.parent.getWorldMatrix()),e.position&&(this.attachedMesh.position.copyFrom(e.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(this.attachedMesh.setDirection(e.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)):(this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(d.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):d.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))))},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._material.dispose(),i.prototype.dispose.call(this),this._attachedMeshParent.dispose()},t._CreateHemisphericLightMesh=function(e){var n=new Ne.a("hemisphereLight",e),r=oh.CreateHemisphere(n.name,{segments:10,diameter:1},e);r.position.z=-.15,r.rotation.x=Math.PI/2,r.parent=n;var o=this._CreateLightLines(3,e);return o.parent=n,o.position.z,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreatePointLightMesh=function(e){var n=new Ne.a("pointLight",e),r=Mr.a.CreateSphere(n.name,{segments:10,diameter:1},e);return r.rotation.x=Math.PI/2,r.parent=n,this._CreateLightLines(5,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateSpotLightMesh=function(e){var n=new Ne.a("spotLight",e);Mr.a.CreateSphere(n.name,{segments:10,diameter:1},e).parent=n;var r=oh.CreateHemisphere(n.name,{segments:10,diameter:2},e);return r.parent=n,r.rotation.x=-Math.PI/2,this._CreateLightLines(2,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateDirectionalLightMesh=function(e){var n=new Ne.a("directionalLight",e),r=new Ne.a(n.name,e);r.parent=n,Mr.a.CreateSphere(n.name,{diameter:1.2,segments:10},e).parent=r;var o=Ne.a.CreateCylinder(n.name,6,.3,.3,6,1,e);o.parent=r,(l=o.clone(n.name)).scaling.y=.5,l.position.x+=1.25,(h=o.clone(n.name)).scaling.y=.5,h.position.x+=-1.25;var l,h,v=Ne.a.CreateCylinder(n.name,1,0,.6,6,1,e);return v.position.y+=3,v.parent=r,(l=v.clone(n.name)).position.y=1.5,l.position.x+=1.25,(h=v.clone(n.name)).position.y=1.5,h.position.x+=-1.25,r.scaling.scaleInPlace(t._Scale),r.rotation.z=Math.PI/2,r.rotation.y=Math.PI/2,n},t._Scale=.007,t._CreateLightLines=function(e,n){var r=new Ne.a("root",n);r.rotation.x=Math.PI/2;var o=new Ne.a("linePivot",n);o.parent=r;var l=Ne.a.CreateCylinder("line",2,.2,.3,6,1,n);if(l.position.y=l.scaling.y/2+1.2,l.parent=o,e<2)return o;for(var h=0;h<4;h++)(v=o.clone("lineParentClone")).rotation.z=Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*h,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2;if(e<3)return r;for(h=0;h<4;h++)(v=o.clone("linePivotClone")).rotation.z=Math.PI/2,v.rotation.y=Math.PI/2*h;if(e<4)return r;for(h=0;h<4;h++){var v;(v=o.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,v.rotation.y=Math.PI/2+Math.PI/2*h,v.getChildMeshes()[0].scaling.y=.5,v.getChildMeshes()[0].scaling.x=v.getChildMeshes()[0].scaling.z=.8,v.getChildMeshes()[0].position.y=v.getChildMeshes()[0].scaling.y/2+1.2}return e<5||((v=o.clone("linePivotClone")).rotation.z=Math.PI),r},t}(Or.a),Up=function(){function i(t,e){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Up()),this.position=t,this.normal=e}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone())},i}(),mI=function(){function i(t,e,n){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Up()),n===void 0&&(n=d.d.Zero()),this.position=t,this.normal=e,this.uv=n}return i.prototype.clone=function(){return new i(this.position.clone(),this.normal.clone(),this.uv.clone())},i}(),_I=function(i){function t(e){e===void 0&&(e=br.a.DefaultUtilityLayer);var n=i.call(this,e)||this;return n._pointerObserver=null,n.onClickedObservable=new E.c,n._camera=null,n._invProjection=new d.a,n._material=new Qt.a("cameraGizmoMaterial",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new x.a(.5,.5,.5),n._material.specularColor=new x.a(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(r){n._camera&&(n._isHovered=!(!r.pickInfo||n._rootMesh.getChildMeshes().indexOf(r.pickInfo.pickedMesh)==-1),n._isHovered&&r.event.button===0&&n.onClickedObservable.notifyObservers(n._camera))},xt.a.POINTERDOWN),n}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(e){this._cameraLinesMesh.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){var n=this;if(this._camera=e,this.attachedNode=e,e){this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._cameraMesh=t._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=t._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach(function(o){o.material=n._material}),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*e.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=1.5*e.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),this.attachedNode.reservedDataStore.cameraGizmo=this;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){i.prototype._update.call(this),this._camera&&(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._material.dispose(),i.prototype.dispose.call(this)},t._CreateCameraMesh=function(e){var n=new Ne.a("rootCameraGizmo",e),r=new Ne.a(n.name,e);r.parent=n,fs.a.CreateBox(n.name,{width:1,height:.8,depth:.5},e).parent=r;var o=wi.a.CreateCylinder(n.name,{height:.5,diameterTop:.8,diameterBottom:.8},e);o.parent=r,o.position.y=.3,o.position.x=-.6,o.rotation.x=.5*Math.PI;var l=wi.a.CreateCylinder(n.name,{height:.5,diameterTop:.6,diameterBottom:.6},e);l.parent=r,l.position.y=.5,l.position.x=.4,l.rotation.x=.5*Math.PI;var h=wi.a.CreateCylinder(n.name,{height:.5,diameterTop:.5,diameterBottom:.5},e);return h.parent=r,h.position.y=0,h.position.x=.6,h.rotation.z=.5*Math.PI,n.scaling.scaleInPlace(t._Scale),r.position.x=-.9,n},t._CreateCameraFrustum=function(e){var n=new Ne.a("rootCameraGizmo",e),r=new Ne.a(n.name,e);r.parent=n;for(var o=0;o<4;o+=2)for(var l=0;l<4;l+=2){var h;(h=kn.a.CreateLines("lines",{points:[new d.e(-1+l,-1+o,-1),new d.e(-1+l,-1+o,1)]},e)).parent=r,h.alwaysSelectAsActiveMesh=!0,h.isPickable=!1,(h=kn.a.CreateLines("lines",{points:[new d.e(-1,-1+l,-1+o),new d.e(1,-1+l,-1+o)]},e)).parent=r,h.alwaysSelectAsActiveMesh=!0,h.isPickable=!1,(h=kn.a.CreateLines("lines",{points:[new d.e(-1+l,-1,-1+o),new d.e(-1+l,1,-1+o)]},e)).parent=r,h.alwaysSelectAsActiveMesh=!0,h.isPickable=!1}return n},t._Scale=.05,t}(Or.a);We.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};";var gI=`vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}`;We.a.IncludesShadersStore.packingFunctions=gI;var vI=`#ifdef DOF
factor=sampleCoC(sampleCoord{X});
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`;We.a.IncludesShadersStore.kernelBlurFragment=vI;var bI=`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`;We.a.IncludesShadersStore.kernelBlurFragment2=bI;var yI=`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g;
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r;
return coc;
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
#include<packingFunctions>
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT;
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`;We.a.ShadersStore.kernelBlurPixelShader=yI,We.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";var TI=`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) {
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.kernelBlurVertexShader=TI;var Yn=function(i){function t(e,n,r,o,l,h,v,b,A,D,N){h===void 0&&(h=Ve.a.BILINEAR_SAMPLINGMODE),A===void 0&&(A=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=""),N===void 0&&(N=!1);var j=i.call(this,e,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],o,l,h,v,b,null,A,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return j.blockCompilation=N,j._packedFloat=!1,j._staticDefines="",j._staticDefines=D,j.direction=n,j.onApplyObservable.add(function(k){j._outputTexture?k.setFloat2("delta",1/j._outputTexture.width*j.direction.x,1/j._outputTexture.height*j.direction.y):k.setFloat2("delta",1/j.width*j.direction.x,1/j.height*j.direction.y)}),j.kernel=r,j}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"BlurPostProcess"},t.prototype.updateEffect=function(e,n,r,o,l,h){this._updateParameters(l,h)},t.prototype._updateParameters=function(e,n){for(var r=this._kernel,o=(r-1)/2,l=[],h=[],v=0,b=0;b<r;b++){var A=b/(r-1),D=this._gaussianWeight(2*A-1);l[b]=b-o,h[b]=D,v+=D}for(b=0;b<h.length;b++)h[b]/=v;var N=[],j=[],k=[];for(b=0;b<=o;b+=2){var H=Math.min(b+1,Math.floor(o));if(b===H)k.push({o:l[b],w:h[b]});else{var J=H===o,te=h[b]+h[H]*(J?.5:1),oe=l[b]+1/(1+h[b]/h[H]);oe===0?(k.push({o:l[b],w:h[b]}),k.push({o:l[b+1],w:h[b+1]})):(k.push({o:oe,w:te}),k.push({o:-oe,w:te}))}}for(b=0;b<k.length;b++)j[b]=k[b].o,N[b]=k[b].w;l=j,h=N;var ce=this.getEngine().getCaps().maxVaryingVectors,he=Math.max(ce,0)-1,_e=Math.min(l.length,he),ye="";for(ye+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(ye+="#define CENTER_WEIGHT "+this._glslFloat(h[_e-1])+`\r
`,_e--),b=0;b<_e;b++)ye+="#define KERNEL_OFFSET"+b+" "+this._glslFloat(l[b])+`\r
`,ye+="#define KERNEL_WEIGHT"+b+" "+this._glslFloat(h[b])+`\r
`;var Ee=0;for(b=he;b<l.length;b++)ye+="#define KERNEL_DEP_OFFSET"+Ee+" "+this._glslFloat(l[b])+`\r
`,ye+="#define KERNEL_DEP_WEIGHT"+Ee+" "+this._glslFloat(h[b])+`\r
`,Ee++;this.packedFloat&&(ye+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,i.prototype.updateEffect.call(this,ye,null,null,{varyingCount:_e,depCount:Ee},e,n)},t.prototype._nearestBestKernel=function(e){for(var n=Math.round(e),r=0,o=[n,n-1,n+1,n-2,n+2];r<o.length;r++){var l=o[r];if(l%2!=0&&Math.floor(l/2)%2==0&&l>0)return Math.max(l,3)}return Math.max(n,3)},t.prototype._gaussianWeight=function(e){var n=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(n)},t.prototype._glslFloat=function(e,n){return n===void 0&&(n=8),e.toFixed(n).replace(/0+$/,"")},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.direction,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,void 0,!1)},e,r,o)},Object(_.c)([Object(V.c)("kernel")],t.prototype,"_kernel",void 0),Object(_.c)([Object(V.c)("packedFloat")],t.prototype,"_packedFloat",void 0),Object(_.c)([Object(V.n)()],t.prototype,"direction",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.BlurPostProcess"]=Yn;var Vp=function(i){function t(e,n,r,o,l,h,v){l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=Ve.a.BILINEAR_SAMPLINGMODE),v===void 0&&(v=!0);var b=i.call(this,e,n,r,o,!0,l,!1,h,v)||this;return b.scene=r,b.mirrorPlane=new us.a(0,1,0,1),b._transformMatrix=d.a.Zero(),b._mirrorMatrix=d.a.Zero(),b._adaptiveBlurKernel=0,b._blurKernelX=0,b._blurKernelY=0,b._blurRatio=1,b.ignoreCameraViewport=!0,b._updateGammaSpace(),b._imageProcessingConfigChangeObserver=r.imageProcessingConfiguration.onUpdateParameters.add(function(){b._updateGammaSpace}),b.onBeforeRenderObservable.add(function(){d.a.ReflectionToRef(b.mirrorPlane,b._mirrorMatrix),b._savedViewMatrix=r.getViewMatrix(),b._mirrorMatrix.multiplyToRef(b._savedViewMatrix,b._transformMatrix),r.setTransformMatrix(b._transformMatrix,r.getProjectionMatrix()),r.clipPlane=b.mirrorPlane,r.getEngine().cullBackFaces=!1,r._mirroredCameraPosition=d.e.TransformCoordinates(r.activeCamera.globalPosition,b._mirrorMatrix)}),b.onAfterRenderObservable.add(function(){r.setTransformMatrix(b._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,r._mirroredCameraPosition=null,r.clipPlane=null}),b}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),n=this.getRenderWidth()/e.getRenderWidth(),r=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*n,this.blurKernelY=this._adaptiveBlurKernel*r},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),n=e.getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new Yn("horizontal blur",new d.d(1,0),this._blurKernelX,this._blurRatio,null,Ve.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurX.autoClear=!1,this._blurRatio===1&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new Yn("vertical blur",new d.d(0,1),this._blurKernelY,this._blurRatio,null,Ve.a.BILINEAR_SAMPLINGMODE,e,!1,n),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=this._blurRatio!==1,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(Un);Ve.a._CreateMirror=function(i,t,e,n){return new Vp(i,t,e,n)};var Jr=c(34),di=function(i){function t(e,n,r,o,l,h,v,b,A,D,N,j,k,H){var J;r===void 0&&(r=null),o===void 0&&(o=!1),l===void 0&&(l=null),h===void 0&&(h=null),v===void 0&&(v=null),b===void 0&&(b=g.a.TEXTUREFORMAT_RGBA),A===void 0&&(A=!1),D===void 0&&(D=null),N===void 0&&(N=!1),j===void 0&&(j=.8),k===void 0&&(k=0);var te=i.call(this,n)||this;if(te.onLoadObservable=new E.c,te.boundingBoxPosition=d.e.Zero(),te._rotationY=0,te._files=null,te._forcedExtension=null,te._extensions=null,te.name=e,te.url=e,te._noMipmap=o,te.hasAlpha=!1,te._format=b,te.isCube=!0,te._textureMatrix=d.a.Identity(),te._createPolynomials=N,te.coordinatesMode=Ve.a.CUBIC_MODE,te._extensions=r,te._files=l,te._forcedExtension=D,te._loaderOptions=H,!e&&!l)return te;var oe=e.lastIndexOf("."),ce=D||(oe>-1?e.substring(oe).toLowerCase():""),he=ce===".dds",_e=ce===".env";if(_e?(te.gammaSpace=!1,te._prefiltered=!1,te.anisotropicFilteringLevel=1):(te._prefiltered=A,A&&(te.gammaSpace=!1,te.anisotropicFilteringLevel=1)),te._texture=te._getFromCache(e,o),!l&&(_e||he||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),l=[],r))for(var ye=0;ye<r.length;ye++)l.push(e+r[ye]);te._files=l;var Ee=function(){te.onLoadObservable.notifyObservers(te),h&&h()};if(te._texture)te._texture.isReady?Qe.b.SetImmediate(function(){return Ee()}):te._texture.onLoadedObservable.add(function(){return Ee()});else{var Oe=te.getScene();(Oe==null?void 0:Oe.useDelayedTextureLoading)?te.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:(te._texture=A?te._getEngine().createPrefilteredCubeTexture(e,Oe,j,k,h,v,b,D,te._createPolynomials):te._getEngine().createCubeTexture(e,Oe,l,o,h,v,te._format,D,!1,j,k,null,H),(J=te._texture)===null||J===void 0||J.onLoadedObservable.add(function(){return te.onLoadObservable.notifyObservers(te)}))}return te}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(d.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),t.CreateFromImages=function(e,n,r){var o="";return e.forEach(function(l){return o+=l}),new t(o,n,null,r,e)},t.CreateFromPrefilteredData=function(e,n,r,o){r===void 0&&(r=null),o===void 0&&(o=!0);var l=n.useDelayedTextureLoading;n.useDelayedTextureLoading=!1;var h=new t(e,n,null,!1,null,null,null,void 0,!0,r,o);return n.useDelayedTextureLoading=l,h},t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,n,r,o){var l;o===void 0&&(o=!1),this.url&&(this.releaseInternalTexture(),(l=this.getScene())===null||l===void 0||l.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)),this.name&&!Jr.a.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=o,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=n||null,r&&(this._delayedOnLoad=r),this.delayLoad(n)},t.prototype.delayLoad=function(e){var n,r=this;if(this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),!this._texture)){var o=this.getScene();this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,.8,0,this._delayedOnLoad,void 0,this._format,e,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,e,!1,0,0,null,this._loaderOptions),(n=this._texture)===null||n===void 0||n.onLoadedObservable.add(function(){return r.onLoadObservable.notifyObservers(r)})}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1})),this._textureMatrix=e)},t.Parse=function(e,n,r){var o=V.a.Parse(function(){var b=!1;return e.prefiltered&&(b=e.prefiltered),new t(r+e.name,n,e.extensions,!1,e.files||null,null,null,void 0,b,e.forcedExtension)},e,n);if(e.boundingBoxPosition&&(o.boundingBoxPosition=d.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=d.e.FromArray(e.boundingBoxSize)),e.animations)for(var l=0;l<e.animations.length;l++){var h=e.animations[l],v=M.a.GetClass("BABYLON.Animation");v&&o.animations.push(v.Parse(h))}return o},t.prototype.clone=function(){var e=this,n=0,r=V.a.Clone(function(){var o=new t(e.url,e.getScene()||e._getEngine(),e._extensions,e._noMipmap,e._files);return n=o.uniqueId,o},this);return r.uniqueId=n,r},Object(_.c)([Object(V.c)()],t.prototype,"url",void 0),Object(_.c)([Object(V.c)("rotationY")],t.prototype,"rotationY",null),Object(_.c)([Object(V.c)("files")],t.prototype,"_files",void 0),Object(_.c)([Object(V.c)("forcedExtension")],t.prototype,"_forcedExtension",void 0),Object(_.c)([Object(V.c)("extensions")],t.prototype,"_extensions",void 0),Object(_.c)([Object(V.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(jr.a);Ve.a._CubeTextureParser=di.Parse,M.a.RegisteredTypes["BABYLON.CubeTexture"]=di;var ot=c(15),ah=c(76),sh=c(87),pt=c(19),EI=` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`;We.a.IncludesShadersStore.backgroundFragmentDeclaration=EI;var SI=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;We.a.IncludesShadersStore.backgroundUboDeclaration=SI,c(131),c(106),c(107),c(154),c(130),c(115),c(125),c(110),c(135),c(136);var xI=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif
#ifndef BACKMAT_SHADOWONLY

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=saturate(viewAngleToFloor/startAngle);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#else
vec4 color=vec4(vPrimaryColor.rgb,(1.0-clamp(globalShadow,0.,1.))*alpha);
#endif
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`;We.a.ShadersStore.backgroundPixelShader=xI;var PI=`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`;We.a.IncludesShadersStore.backgroundVertexDeclaration=PI,c(78),c(79),c(117),c(137),c(80),c(81),c(111),c(157),c(138);var AI=`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=position;
#endif
#include<instancesVertex>
#include<bonesVertex>
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
} else {
gl_Position=viewProjectionR*finalWorld*vec4(position,1.0);
}
#else
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#endif
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`;We.a.ShadersStore.backgroundVertexShader=AI;var ms=c(67),CI=function(i){function t(){var e=i.call(this)||this;return e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.GAMMADIFFUSE=!1,e.DIFFUSEHASALPHA=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONBLUR=!1,e.REFLECTIONFRESNEL=!1,e.REFLECTIONFALLOFF=!1,e.TEXTURELODSUPPORT=!1,e.PREMULTIPLYALPHA=!1,e.USERGBCOLOR=!1,e.USEHIGHLIGHTANDSHADOWCOLORS=!1,e.BACKMAT_SHADOWONLY=!1,e.NOISE=!1,e.REFLECTIONBGR=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.EQUIRECTANGULAR_RELFECTION_FOV=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.NORMAL=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.INSTANCES=!1,e.SHADOWFLOAT=!1,e.rebuild(),e}return Object(_.d)(t,i),t}(ah.a),$c=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.primaryColor=x.a.White(),r._primaryColorShadowLevel=0,r._primaryColorHighlightLevel=0,r.reflectionTexture=null,r.reflectionBlur=0,r.diffuseTexture=null,r._shadowLights=null,r.shadowLights=null,r.shadowLevel=0,r.sceneCenter=d.e.Zero(),r.opacityFresnel=!0,r.reflectionFresnel=!1,r.reflectionFalloffDistance=0,r.reflectionAmount=1,r.reflectionReflectance0=.05,r.reflectionReflectance90=.5,r.useRGBColor=!0,r.enableNoise=!1,r._fovMultiplier=1,r.useEquirectangularFOV=!1,r._maxSimultaneousLights=4,r.maxSimultaneousLights=4,r._shadowOnly=!1,r.shadowOnly=!1,r._imageProcessingObserver=null,r.switchToBGR=!1,r._renderTargets=new In.a(16),r._reflectionControls=d.f.Zero(),r._white=x.a.White(),r._primaryShadowColor=x.a.Black(),r._primaryHighlightColor=x.a.Black(),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._diffuseTexture&&r._diffuseTexture.isRenderTarget&&r._renderTargets.push(r._diffuseTexture),r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r._renderTargets},r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var n=e;n<.5?(n*=2,this.reflectionReflectance0=t.StandardReflectance0*n,this.reflectionReflectance90=t.StandardReflectance90*n):(n=2*n-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*n,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._computePrimaryColorFromPerceptualColor(),n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._shadowOnly},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new CI);var l=this.getScene(),h=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var v=l.getEngine();if(ot.a.PrepareDefinesForLights(l,e,h,!1,this._maxSimultaneousLights),h._needNormals=!0,ot.a.PrepareDefinesForMultiview(l,h),h._areTexturesDirty){if(h._needUVs=!1,l.texturesEnabled){if(l.getEngine().getCaps().textureLOD&&(h.TEXTURELODSUPPORT=!0),this._diffuseTexture&&pt.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;ot.a.PrepareDefinesForMergedUV(this._diffuseTexture,h,"DIFFUSE"),h.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,h.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,h.OPACITYFRESNEL=this._opacityFresnel}else h.DIFFUSE=!1,h.DIFFUSEHASALPHA=!1,h.GAMMADIFFUSE=!1,h.OPACITYFRESNEL=!1;var b=this._reflectionTexture;if(b&&pt.a.ReflectionTextureEnabled){if(!b.isReadyOrNotBlocking())return!1;switch(h.REFLECTION=!0,h.GAMMAREFLECTION=b.gammaSpace,h.RGBDREFLECTION=b.isRGBD,h.REFLECTIONBLUR=this._reflectionBlur>0,h.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!b.invertZ:b.invertZ,h.LODINREFLECTIONALPHA=b.lodLevelInAlpha,h.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,h.REFLECTIONBGR=this.switchToBGR,b.coordinatesMode===Ve.a.INVCUBIC_MODE&&(h.INVERTCUBICMAP=!0),h.REFLECTIONMAP_3D=b.isCube,b.coordinatesMode){case Ve.a.EXPLICIT_MODE:h.REFLECTIONMAP_EXPLICIT=!0;break;case Ve.a.PLANAR_MODE:h.REFLECTIONMAP_PLANAR=!0;break;case Ve.a.PROJECTION_MODE:h.REFLECTIONMAP_PROJECTION=!0;break;case Ve.a.SKYBOX_MODE:h.REFLECTIONMAP_SKYBOX=!0;break;case Ve.a.SPHERICAL_MODE:h.REFLECTIONMAP_SPHERICAL=!0;break;case Ve.a.EQUIRECTANGULAR_MODE:h.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ve.a.FIXED_EQUIRECTANGULAR_MODE:h.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ve.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:h.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ve.a.CUBIC_MODE:case Ve.a.INVCUBIC_MODE:default:h.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(h.REFLECTIONFRESNEL=!0,h.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(h.REFLECTIONFRESNEL=!1,h.REFLECTIONFALLOFF=!1)}else h.REFLECTION=!1,h.REFLECTIONFRESNEL=!1,h.REFLECTIONFALLOFF=!1,h.REFLECTIONBLUR=!1,h.REFLECTIONMAP_3D=!1,h.REFLECTIONMAP_SPHERICAL=!1,h.REFLECTIONMAP_PLANAR=!1,h.REFLECTIONMAP_CUBIC=!1,h.REFLECTIONMAP_PROJECTION=!1,h.REFLECTIONMAP_SKYBOX=!1,h.REFLECTIONMAP_EXPLICIT=!1,h.REFLECTIONMAP_EQUIRECTANGULAR=!1,h.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,h.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,h.INVERTCUBICMAP=!1,h.REFLECTIONMAP_OPPOSITEZ=!1,h.LODINREFLECTIONALPHA=!1,h.GAMMAREFLECTION=!1,h.RGBDREFLECTION=!1}h.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,h.USERGBCOLOR=this._useRGBColor,h.NOISE=this._enableNoise}if(h._areLightsDirty&&(h.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(this._primaryColorShadowLevel!==0||this._primaryColorHighlightLevel!==0),h.BACKMAT_SHADOWONLY=this._shadowOnly),h._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(h)}if(ot.a.PrepareDefinesForMisc(e,l,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),h),ot.a.PrepareDefinesForFrameBoundValues(l,v,h,r,null,n.getRenderingMesh().hasThinInstances),ot.a.PrepareDefinesForAttributes(e,h,!1,!0,!1)&&e&&(l.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(Me.b.NormalKind)||(e.createNormals(!0),p.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),h.isDirty){h.markAsProcessed(),l.resetCachedMaterial();var A=new ms.a;h.FOG&&A.addFallback(0,"FOG"),h.POINTSIZE&&A.addFallback(1,"POINTSIZE"),h.MULTIVIEW&&A.addFallback(0,"MULTIVIEW"),ot.a.HandleFallbacksForShadows(h,A,this._maxSimultaneousLights);var D=[Me.b.PositionKind];h.NORMAL&&D.push(Me.b.NormalKind),h.UV1&&D.push(Me.b.UVKind),h.UV2&&D.push(Me.b.UV2Kind),ot.a.PrepareAttributesForBones(D,e,h,A),ot.a.PrepareAttributesForInstances(D,h);var N=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],j=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],k=["Material","Scene"];Jn.a&&(Jn.a.PrepareUniforms(N,h),Jn.a.PrepareSamplers(j,h)),ot.a.PrepareUniformsAndSamplersList({uniformsNames:N,uniformBuffersNames:k,samplers:j,defines:h,maxSimultaneousLights:this._maxSimultaneousLights});var H=h.toString();n.setEffect(l.getEngine().createEffect("background",{attributes:D,uniformsNames:N,uniformBuffersNames:k,samplers:j,defines:H,fallbacks:A,onCompiled:function(J){o.onCompiled&&o.onCompiled(J),o.bindSceneUniformBuffer(J,l.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},v),h),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(h._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){this._primaryColorShadowLevel===0&&this._primaryColorHighlightLevel===0||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),i.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r._materialDefines;if(l){var h=r.effect;if(h){this._activeEffect=h,this.bindOnlyWorldMatrix(e),ot.a.BindBonesParameters(n,this._activeEffect);var v=this._mustRebind(o,h,n.visibility);if(v){this._uniformBuffer.bindToEffect(h,"Material"),this.bindViewProjection(h);var b=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(o.texturesEnabled&&(this._diffuseTexture&&pt.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),ot.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),b&&pt.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",b.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",b.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",b.getSize().width,b.lodGenerationScale,b.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),l.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),o.texturesEnabled&&(this._diffuseTexture&&pt.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),b&&pt.a.ReflectionTextureEnabled&&(l.REFLECTIONBLUR&&l.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",b):l.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",b._lodTextureMid||b),this._uniformBuffer.setTexture("reflectionSamplerLow",b._lodTextureLow||b),this._uniformBuffer.setTexture("reflectionSamplerHigh",b._lodTextureHigh||b)):this._uniformBuffer.setTexture("reflectionSampler",b),l.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),ot.a.BindClipPlane(this._activeEffect,o),ot.a.BindEyePosition(h,o)}!v&&this.isFrozen||(o.lightsEnabled&&ot.a.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,!1),this.bindView(h),ot.a.BindFogParameters(o,n,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._reflectionTexture===e||this._diffuseTexture===e},t.prototype.dispose=function(e,n){e===void 0&&(e=!1),n===void 0&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e)},t.prototype.clone=function(e){var n=this;return V.a.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="BABYLON.BackgroundMaterial",e},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,n,r){return V.a.Parse(function(){return new t(e.name,n)},e,n,r)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,Object(_.c)([Object(V.e)()],t.prototype,"_primaryColor",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),Object(_.c)([Object(V.e)()],t.prototype,"__perceptualColor",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_primaryColorShadowLevel",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),Object(_.c)([Object(V.m)()],t.prototype,"_reflectionTexture",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionBlur",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),Object(_.c)([Object(V.m)()],t.prototype,"_diffuseTexture",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_shadowLevel",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),Object(_.c)([Object(V.o)()],t.prototype,"_sceneCenter",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_opacityFresnel",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionFresnel",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionFalloffDistance",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionAmount",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionReflectance0",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_reflectionReflectance90",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_useRGBColor",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_enableNoise",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_maxSimultaneousLights",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_shadowOnly",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"shadowOnly",void 0),Object(_.c)([Object(V.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(sh.a);M.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=$c;var kp=function(){function i(t,e){var n=this;this._errorHandler=function(r,o){n.onErrorObservable.notifyObservers({message:r,exception:o})},this._options=Object(_.a)(Object(_.a)({},i._getDefaultOptions()),t),this._scene=e,this.onErrorObservable=new E.c,this._setupBackground(),this._setupImageProcessing()}return i._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new x.a(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:g.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new x.a(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:d.e.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(i.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skybox",{get:function(){return this._skybox},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ground",{get:function(){return this._ground},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!1,configurable:!0}),i.prototype.updateOptions=function(t){var e=Object(_.a)(Object(_.a)({},this._options),t);this._ground&&!e.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!e.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=e.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!e.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!e.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=e.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!e.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=e.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=e,this._setupBackground(),this._setupImageProcessing()},i.prototype.setMainColor=function(t){this.groundMaterial&&(this.groundMaterial.primaryColor=t),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=t),this.groundMirror&&(this.groundMirror.clearColor=new x.b(t.r,t.g,t.b,1))},i.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},i.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof jr.a)this._scene.environmentTexture=this._options.environmentTexture;else{var t=di.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=t}},i.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new Ne.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var t=this._getSceneSize();this._options.createGround&&(this._setupGround(t),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(t),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(t),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=t.rootPosition.x,this._rootMesh.position.z=t.rootPosition.z,this._rootMesh.position.y=t.rootPosition.y},i.prototype._getSceneSize=function(){var t=this,e=this._options.groundSize,n=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||this._scene.meshes.length===1)return{groundSize:e,skyboxSize:n,rootPosition:r};var o=this._scene.getWorldExtends(function(v){return v!==t._ground&&v!==t._rootMesh&&v!==t._skybox}),l=o.max.subtract(o.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Mi&&this._scene.activeCamera.upperRadiusLimit&&(n=e=2*this._scene.activeCamera.upperRadiusLimit);var h=l.length();h>e&&(n=e=2*h),e*=1.1,n*=1.5,(r=o.min.add(l.scale(.5))).y=o.min.y-this._options.groundYBias}return{groundSize:e,skyboxSize:n,rootPosition:r}},i.prototype._setupGround=function(t){var e=this;this._ground&&!this._ground.isDisposed()||(this._ground=Ne.a.CreatePlane("BackgroundPlane",t.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){e._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},i.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new $c("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},i.prototype._setupGroundDiffuseTexture=function(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof jr.a?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new Ve.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))},i.prototype._setupGroundMirrorTexture=function(t){var e=Ve.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new Vp("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,Ve.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new us.a(0,-1,0,t.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=e,this._groundMirror.wrapV=e,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var n=0;n<this._scene.meshes.length;n++){var r=this._scene.meshes[n];r!==this._ground&&r!==this._skybox&&r!==this._rootMesh&&this._groundMirror.renderList.push(r)}this._groundMirror.clearColor=new x.b(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},i.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},i.prototype._setupSkybox=function(t){var e=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=Ne.a.CreateBox("BackgroundSkybox",t.skyboxSize,this._scene,void 0,Ne.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){e._skybox=null})),this._skybox.parent=this._rootMesh},i.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new $c("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},i.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof jr.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new di(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=Ve.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},i.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},i._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",i._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",i._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",i}(),Bo=function(i){function t(e,n,r,o,l){l===void 0&&(l=null);var h=i.call(this,e,o)||this;h.onError=l,h._halfDome=!1,h._crossEye=!1,h._useDirectMapping=!1,h._textureMode=t.MODE_MONOSCOPIC,h._onBeforeCameraRenderObserver=null,h.onLoadErrorObservable=new E.c,o=h.getScene(),e=e||"textureDome",r.resolution=0|Math.abs(r.resolution)||32,r.clickToPlay=Boolean(r.clickToPlay),r.autoPlay=r.autoPlay===void 0||Boolean(r.autoPlay),r.loop=r.loop===void 0||Boolean(r.loop),r.size=Math.abs(r.size)||(o.activeCamera?.48*o.activeCamera.maxZ:1e3),r.useDirectMapping===void 0?h._useDirectMapping=!0:h._useDirectMapping=r.useDirectMapping,r.faceForward===void 0&&(r.faceForward=!0),h._setReady(!1),h._mesh=Ne.a.CreateSphere(e+"_mesh",r.resolution,r.size,o,!1,Ne.a.BACKSIDE);var v=h._material=new $c(e+"_material",o);v.useEquirectangularFOV=!0,v.fovMultiplier=1,v.opacityFresnel=!1;var b=h._initTexture(n,o,r);if(h.texture=b,h._mesh.material=v,h._mesh.parent=h,h._halfDomeMask=Mr.a.CreateSphere("",{slice:.5,diameter:.98*r.size,segments:2*r.resolution,sideOrientation:Ne.a.BACKSIDE},o),h._halfDomeMask.rotate(Se.a.X,-Math.PI/2),h._halfDomeMask.parent=h._mesh,h._halfDome=!!r.halfDomeMode,h._halfDomeMask.setEnabled(h._halfDome),h._crossEye=!!r.crossEyeMode,h._texture.anisotropicFilteringLevel=1,h._texture.onLoadObservable.addOnce(function(){h._setReady(!0)}),r.faceForward&&o.activeCamera){var A=o.activeCamera,D=d.e.Forward(),N=d.e.TransformNormal(D,A.getViewMatrix());N.normalize(),h.rotation.y=Math.acos(d.e.Dot(D,N))}return h._changeTextureMode(h._textureMode),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._useDirectMapping?(this._texture.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._texture.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._texture):(this._texture.coordinatesMode=Ve.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._texture.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._texture),this._changeTextureMode(this._textureMode))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureMode",{get:function(){return this._textureMode},set:function(e){this._textureMode!==e&&this._changeTextureMode(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDome",{get:function(){return this._halfDome},set:function(e){this._halfDome=e,this._halfDomeMask.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"crossEye",{get:function(){return this._crossEye},set:function(e){this._crossEye=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._changeTextureMode=function(e){var n=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._textureMode=e,this._texture.uScale=1,this._texture.vScale=1,this._texture.uOffset=0,this._texture.vOffset=0,this._texture.vAng=0,e){case t.MODE_MONOSCOPIC:this._halfDome&&(this._texture.uScale=2,this._texture.uOffset=-1);break;case t.MODE_SIDEBYSIDE:this._texture.uScale=this._halfDome?.99999:.5;var r=this._halfDome?0:.5,o=this._halfDome?-.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(l){var h=l.isRightCamera;n._crossEye&&(h=!h),n._texture.uOffset=h?r:o});break;case t.MODE_TOPBOTTOM:this._texture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(l){var h=l.isRightCamera;n._crossEye&&(h=!h),n._texture.vOffset=h?.5:0})}},t.prototype.dispose=function(e,n){n===void 0&&(n=!1),this._texture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this.onLoadErrorObservable.clear(),i.prototype.dispose.call(this,e,n)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(ps.a),RI=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this.texture},set:function(e){this.texture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this;return new Ve.a(e,n,!r.generateMipMaps,!this._useDirectMapping,void 0,void 0,function(l,h){o.onLoadErrorObservable.notifyObservers(l||"Unknown error occured"),o.onError&&o.onError(l,h)})},t.MODE_MONOSCOPIC=Bo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=Bo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=Bo.MODE_SIDEBYSIDE,t}(Bo),Ny=function(){function i(){}return i.ExpandRGBDTexture=function(t){var e=t._texture;if(e&&t.isRGBD){var n=e.getEngine(),r=n.getCaps(),o=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(o=!0,e.type=g.a.TEXTURETYPE_HALF_FLOAT):r.textureFloatRender&&r.textureFloatLinearFiltering&&(o=!0,e.type=g.a.TEXTURETYPE_FLOAT),o&&(e.isReady=!1,e._isRGBD=!1,e.invertY=!1),t.onLoadObservable.addOnce(function(){if(o){var l=new bt("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!1,void 0,e.type,void 0,null,!1),h=n.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:e.samplingMode,type:e.type,format:g.a.TEXTUREFORMAT_RGBA});l.getEffect().executeWhenCompiled(function(){l.onApply=function(v){v._bindTexture("textureSampler",e),v.setFloat2("scale",1,1)},t.getScene().postProcessManager.directRender([l],h,!0),n.restoreDefaultFramebuffer(),n._releaseTexture(e),n._releaseFramebufferObjects(h),l&&l.dispose(),h._swapAndDie(e),e.isReady=!0})}})}},i}(),ch=function(){function i(){}return i.GetEnvironmentBRDFTexture=function(t){if(!t.environmentBRDFTexture){var e=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;var n=t._blockEntityCollection;t._blockEntityCollection=!1;var r=Ve.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+this._instanceNumber++,t,!0,!1,Ve.a.BILINEAR_SAMPLINGMODE);t._blockEntityCollection=n;var o=t.getEngine().getLoadedTexturesCache(),l=o.indexOf(r.getInternalTexture());l!==-1&&o.splice(l,1),r.isRGBD=!0,r.wrapU=Ve.a.CLAMP_ADDRESSMODE,r.wrapV=Ve.a.CLAMP_ADDRESSMODE,t.environmentBRDFTexture=r,t.useDelayedTextureLoading=e,Ny.ExpandRGBDTexture(r)}return t.environmentBRDFTexture},i._instanceNumber=0,i._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==",i}(),_s=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=i._DefaultIndexOfRefraction,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=x.a.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e,n,r){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&pt.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&pt.a.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()||n.getCaps().standardDerivatives&&this._bumpTexture&&pt.a.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady()||this._isTintEnabled&&this._tintTexture&&pt.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.CLEARCOAT=!0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&pt.a.ClearCoatTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&pt.a.ClearCoatTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"CLEARCOAT_TEXTURE_ROUGHNESS"):t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&pt.a.ClearCoatBumpTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===i._DefaultIndexOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&pt.a.ClearCoatTintTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r,o,l,h,v){var b,A,D,N,j,k,H,J,te=v._materialDefines,oe=te.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!t.useUbo||!o||!t.isSync){oe&&pt.a.ClearCoatTextureEnabled?(t.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),ot.a.BindTextureMatrix(this._texture,t,"clearCoat")):(this._texture||this._textureRoughness)&&pt.a.ClearCoatTextureEnabled&&(t.updateFloat4("vClearCoatInfos",(A=(b=this._texture)===null||b===void 0?void 0:b.coordinatesIndex)!==null&&A!==void 0?A:0,(N=(D=this._texture)===null||D===void 0?void 0:D.level)!==null&&N!==void 0?N:0,(k=(j=this._textureRoughness)===null||j===void 0?void 0:j.coordinatesIndex)!==null&&k!==void 0?k:0,(J=(H=this._textureRoughness)===null||H===void 0?void 0:H.level)!==null&&J!==void 0?J:0),this._texture&&ot.a.BindTextureMatrix(this._texture,t,"clearCoat"),!this._textureRoughness||oe||te.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||ot.a.BindTextureMatrix(this._textureRoughness,t,"clearCoatRoughness")),this._bumpTexture&&n.getCaps().standardDerivatives&&pt.a.ClearCoatTextureEnabled&&!r&&(t.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),ot.a.BindTextureMatrix(this._bumpTexture,t,"clearCoatBump"),e._mirroredCameraPosition?t.updateFloat2("vClearCoatTangentSpaceParams",l?1:-1,h?1:-1):t.updateFloat2("vClearCoatTangentSpaceParams",l?-1:1,h?-1:1)),this._tintTexture&&pt.a.ClearCoatTintTextureEnabled&&(t.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),ot.a.BindTextureMatrix(this._tintTexture,t,"clearCoatTint")),t.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var ce=1-this._indexOfRefraction,he=1+this._indexOfRefraction,_e=Math.pow(-ce/he,2),ye=1/this._indexOfRefraction;t.updateFloat4("vClearCoatRefractionParams",_e,ye,ce,he),this._isTintEnabled&&(t.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),t.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}e.texturesEnabled&&(this._texture&&pt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!oe&&!te.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&pt.a.ClearCoatTextureEnabled&&t.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&n.getCaps().standardDerivatives&&pt.a.ClearCoatBumpTextureEnabled&&!r&&t.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&pt.a.ClearCoatTintTextureEnabled&&t.setTexture("clearCoatTintSampler",this._tintTexture))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t||this._bumpTexture===t||this._tintTexture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness),this._bumpTexture&&t.push(this._bumpTexture),this._tintTexture&&t.push(this._tintTexture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&t.push(this._tintTexture)},i.prototype.dispose=function(t){var e,n,r,o;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose(),(r=this._bumpTexture)===null||r===void 0||r.dispose(),(o=this._tintTexture)===null||o===void 0||o.dispose())},i.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},i.AddFallbacks=function(t,e,n){return t.CLEARCOAT_BUMP&&e.addFallback(n++,"CLEARCOAT_BUMP"),t.CLEARCOAT_TINT&&e.addFallback(n++,"CLEARCOAT_TINT"),t.CLEARCOAT&&e.addFallback(n++,"CLEARCOAT"),n},i.AddUniforms=function(t){t.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatRoughnessMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},i.AddSamplers=function(t){t.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},i.PrepareUniformBuffer=function(t){t.addUniform("vClearCoatParams",2),t.addUniform("vClearCoatRefractionParams",4),t.addUniform("vClearCoatInfos",4),t.addUniform("clearCoatMatrix",16),t.addUniform("clearCoatRoughnessMatrix",16),t.addUniform("vClearCoatBumpInfos",2),t.addUniform("vClearCoatTangentSpaceParams",2),t.addUniform("clearCoatBumpMatrix",16),t.addUniform("vClearCoatTintParams",4),t.addUniform("clearCoatColorAtDistance",1),t.addUniform("vClearCoatTintInfos",2),t.addUniform("clearCoatTintMatrix",16)},i.prototype.copyTo=function(t){V.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return V.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;V.a.Parse(function(){return r},t,e,n)},i._DefaultIndexOfRefraction=1.5,Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(_.c)([Object(V.c)()],i.prototype,"intensity",void 0),Object(_.c)([Object(V.c)()],i.prototype,"roughness",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"remapF0OnInterfaceChange",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTintEnabled",void 0),Object(_.c)([Object(V.e)()],i.prototype,"tintColor",void 0),Object(_.c)([Object(V.c)()],i.prototype,"tintColorAtDistance",void 0),Object(_.c)([Object(V.c)()],i.prototype,"tintThickness",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"tintTexture",void 0),i}(),gs=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new d.d(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&this._texture&&pt.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},i.prototype.prepareDefines=function(t,e,n){this._isEnabled?(t.ANISOTROPIC=this._isEnabled,this._isEnabled&&!e.isVerticesDataPresent(Me.b.TangentKind)&&(t._needUVs=!0,t.MAINUV1=!0),t._areTexturesDirty&&n.texturesEnabled&&(this._texture&&pt.a.AnisotropicTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._texture,t,"ANISOTROPIC_TEXTURE"):t.ANISOTROPIC_TEXTURE=!1)):(t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1)},i.prototype.bindForSubMesh=function(t,e,n){t.useUbo&&n&&t.isSync||(this._texture&&pt.a.AnisotropicTextureEnabled&&(t.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),ot.a.BindTextureMatrix(this._texture,t,"anisotropy")),t.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),e.texturesEnabled&&this._texture&&pt.a.AnisotropicTextureEnabled&&t.setTexture("anisotropySampler",this._texture)},i.prototype.hasTexture=function(t){return this._texture===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture)},i.prototype.dispose=function(t){t&&this._texture&&this._texture.dispose()},i.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},i.AddFallbacks=function(t,e,n){return t.ANISOTROPIC&&e.addFallback(n++,"ANISOTROPIC"),n},i.AddUniforms=function(t){t.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vAnisotropy",3),t.addUniform("vAnisotropyInfos",2),t.addUniform("anisotropyMatrix",16)},i.AddSamplers=function(t){t.push("anisotropySampler")},i.prototype.copyTo=function(t){V.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return V.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;V.a.Parse(function(){return r},t,e,n)},Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(_.c)([Object(V.c)()],i.prototype,"intensity",void 0),Object(_.c)([Object(V.n)()],i.prototype,"direction",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),i}(),OI=function(){function i(t){this._useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=i.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=i.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=t}return i.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},i.prototype.prepareDefines=function(t){t.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,t.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,t.SPHERICAL_HARMONICS=this._useSphericalHarmonics,t.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},i.prototype.getClassName=function(){return"PBRBRDFConfiguration"},i.prototype.copyTo=function(t){V.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return V.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;V.a.Parse(function(){return r},t,e,n)},i.DEFAULT_USE_ENERGY_CONSERVATION=!0,i.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,i.DEFAULT_USE_SPHERICAL_HARMONICS=!0,i.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useEnergyConservation",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSmithVisibilityHeightCorrelated",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSphericalHarmonics",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsMiscDirty")],i.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),i}(),Jc=function(){function i(t){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=x.a.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t}return i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype.isReadyForSubMesh=function(t,e){return!(t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&pt.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&pt.a.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()))},i.prototype.prepareDefines=function(t,e){var n;this._isEnabled?(t.SHEEN=this._isEnabled,t.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,t.SHEEN_ROUGHNESS=this._roughness!==null,t.SHEEN_ALBEDOSCALING=this._albedoScaling,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((n=this._textureRoughness)===null||n===void 0?void 0:n._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),t._areTexturesDirty&&e.texturesEnabled&&(this._texture&&pt.a.SheenTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._texture,t,"SHEEN_TEXTURE"):t.SHEEN_TEXTURE=!1,this._textureRoughness&&pt.a.SheenTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._textureRoughness,t,"SHEEN_TEXTURE_ROUGHNESS"):t.SHEEN_TEXTURE_ROUGHNESS=!1)):(t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS=!1,t.SHEEN_LINKWITHALBEDO=!1,t.SHEEN_ROUGHNESS=!1,t.SHEEN_ALBEDOSCALING=!1,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},i.prototype.bindForSubMesh=function(t,e,n,r){var o,l,h,v,b,A,D,N,j=r._materialDefines,k=j.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;t.useUbo&&n&&t.isSync||(k&&pt.a.SheenTextureEnabled?(t.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),ot.a.BindTextureMatrix(this._texture,t,"sheen")):(this._texture||this._textureRoughness)&&pt.a.SheenTextureEnabled&&(t.updateFloat4("vSheenInfos",(l=(o=this._texture)===null||o===void 0?void 0:o.coordinatesIndex)!==null&&l!==void 0?l:0,(v=(h=this._texture)===null||h===void 0?void 0:h.level)!==null&&v!==void 0?v:0,(A=(b=this._textureRoughness)===null||b===void 0?void 0:b.coordinatesIndex)!==null&&A!==void 0?A:0,(N=(D=this._textureRoughness)===null||D===void 0?void 0:D.level)!==null&&N!==void 0?N:0),this._texture&&ot.a.BindTextureMatrix(this._texture,t,"sheen"),!this._textureRoughness||k||j.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||ot.a.BindTextureMatrix(this._textureRoughness,t,"sheenRoughness")),t.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),this._roughness!==null&&t.updateFloat("vSheenRoughness",this._roughness)),e.texturesEnabled&&(this._texture&&pt.a.SheenTextureEnabled&&t.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k&&!j.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&pt.a.SheenTextureEnabled&&t.setTexture("sheenRoughnessSampler",this._textureRoughness))},i.prototype.hasTexture=function(t){return this._texture===t||this._textureRoughness===t},i.prototype.getActiveTextures=function(t){this._texture&&t.push(this._texture),this._textureRoughness&&t.push(this._textureRoughness)},i.prototype.getAnimatables=function(t){this._texture&&this._texture.animations&&this._texture.animations.length>0&&t.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&t.push(this._textureRoughness)},i.prototype.dispose=function(t){var e,n;t&&((e=this._texture)===null||e===void 0||e.dispose(),(n=this._textureRoughness)===null||n===void 0||n.dispose())},i.prototype.getClassName=function(){return"PBRSheenConfiguration"},i.AddFallbacks=function(t,e,n){return t.SHEEN&&e.addFallback(n++,"SHEEN"),n},i.AddUniforms=function(t){t.push("vSheenColor","vSheenRoughness","vSheenInfos","sheenMatrix","sheenRoughnessMatrix")},i.PrepareUniformBuffer=function(t){t.addUniform("vSheenColor",4),t.addUniform("vSheenRoughness",1),t.addUniform("vSheenInfos",4),t.addUniform("sheenMatrix",16),t.addUniform("sheenRoughnessMatrix",16)},i.AddSamplers=function(t){t.push("sheenSampler"),t.push("sheenRoughnessSampler")},i.prototype.copyTo=function(t){V.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return V.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;V.a.Parse(function(){return r},t,e,n)},Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkSheenWithAlbedo",void 0),Object(_.c)([Object(V.c)()],i.prototype,"intensity",void 0),Object(_.c)([Object(V.e)()],i.prototype,"color",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoScaling",void 0),i}(),el=function(){function i(t,e,n){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=x.a.White(),this.tintColorAtDistance=1,this.diffusionDistance=x.a.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._useMaskFromThicknessTextureGltf=!1,this.useMaskFromThicknessTextureGltf=!1,this._internalMarkAllSubMeshesAsTexturesDirty=t,this._internalMarkScenePrePassDirty=e,this._scene=n}return Object.defineProperty(i.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(t){this._scene.enableSubSurfaceForPrePass()&&t&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(t){this._volumeIndexOfRefraction=t>=1?t:-1},enumerable:!1,configurable:!0}),i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},i.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},i.prototype.isReadyForSubMesh=function(t,e){if(t._areTexturesDirty&&e.texturesEnabled){if(this._thicknessTexture&&pt.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var n=this._getRefractionTexture(e);if(n&&pt.a.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0},i.prototype.prepareDefines=function(t,e){if(t._areTexturesDirty&&(t.SUBSURFACE=!1,t.SS_TRANSLUCENCY=this._isTranslucencyEnabled,t.SS_SCATTERING=this._isScatteringEnabled,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,t.SS_REFRACTION=!1,t.SS_REFRACTIONMAP_3D=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(t.SUBSURFACE=!0,t._areTexturesDirty&&e.texturesEnabled&&this._thicknessTexture&&pt.a.ThicknessTextureEnabled&&ot.a.PrepareDefinesForMergedUV(this._thicknessTexture,t,"SS_THICKNESSANDMASK_TEXTURE"),t.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture,t.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=this._useMaskFromThicknessTextureGltf),this._isRefractionEnabled&&e.texturesEnabled)){var n=this._getRefractionTexture(e);n&&pt.a.RefractionTextureEnabled&&(t.SS_REFRACTION=!0,t.SS_REFRACTIONMAP_3D=n.isCube,t.SS_GAMMAREFRACTION=n.gammaSpace,t.SS_RGBDREFRACTION=n.isRGBD,t.SS_LINEARSPECULARREFRACTION=n.linearSpecularLOD,t.SS_REFRACTIONMAP_OPPOSITEZ=n.invertZ,t.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,t.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,t.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction)}},i.prototype.bindForSubMesh=function(t,e,n,r,o,l){var h=this._getRefractionTexture(e);if(!t.useUbo||!r||!t.isSync){if(this._thicknessTexture&&pt.a.ThicknessTextureEnabled&&(t.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),ot.a.BindTextureMatrix(this._thicknessTexture,t,"thickness")),t.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),h&&pt.a.RefractionTextureEnabled){t.updateMatrix("refractionMatrix",h.getReflectionTextureMatrix());var v=1;h.isCube||h.depth&&(v=h.depth);var b=h.getSize().width,A=this.volumeIndexOfRefraction;t.updateFloat4("vRefractionInfos",h.level,1/A,v,this._invertRefractionY?-1:1),t.updateFloat3("vRefractionMicrosurfaceInfos",b,h.lodGenerationScale,h.lodGenerationOffset),l&&t.updateFloat2("vRefractionFilteringInfo",b,se.a.Log2(b))}this.isScatteringEnabled&&t.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),t.updateColor3("vDiffusionDistance",this.diffusionDistance),t.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),t.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}e.texturesEnabled&&(this._thicknessTexture&&pt.a.ThicknessTextureEnabled&&t.setTexture("thicknessSampler",this._thicknessTexture),h&&pt.a.RefractionTextureEnabled&&(o?t.setTexture("refractionSampler",h):(t.setTexture("refractionSampler",h._lodTextureMid||h),t.setTexture("refractionSamplerLow",h._lodTextureLow||h),t.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))))},i.prototype.unbind=function(t){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(t.setTexture("refractionSampler",null),!0)},i.prototype._getRefractionTexture=function(t){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?t.environmentTexture:null},Object.defineProperty(i.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),i.prototype.fillRenderTargetTextures=function(t){pt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&t.push(this._refractionTexture)},i.prototype.hasTexture=function(t){return this._thicknessTexture===t||this._refractionTexture===t},i.prototype.hasRenderTargetTextures=function(){return!!(pt.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},i.prototype.getActiveTextures=function(t){this._thicknessTexture&&t.push(this._thicknessTexture),this._refractionTexture&&t.push(this._refractionTexture)},i.prototype.getAnimatables=function(t){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&t.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture)},i.prototype.dispose=function(t){t&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},i.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},i.AddFallbacks=function(t,e,n){return t.SS_SCATTERING&&e.addFallback(n++,"SS_SCATTERING"),t.SS_TRANSLUCENCY&&e.addFallback(n++,"SS_TRANSLUCENCY"),n},i.AddUniforms=function(t){t.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionFilteringInfo","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix","scatteringDiffusionProfile")},i.AddSamplers=function(t){t.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},i.PrepareUniformBuffer=function(t){t.addUniform("vRefractionMicrosurfaceInfos",3),t.addUniform("vRefractionFilteringInfo",2),t.addUniform("vRefractionInfos",4),t.addUniform("refractionMatrix",16),t.addUniform("vThicknessInfos",2),t.addUniform("thicknessMatrix",16),t.addUniform("vThicknessParam",2),t.addUniform("vDiffusionDistance",3),t.addUniform("vTintColor",4),t.addUniform("vSubSurfaceIntensity",3),t.addUniform("scatteringDiffusionProfile",1)},i.prototype.copyTo=function(t){V.a.Clone(function(){return t},this)},i.prototype.serialize=function(){return V.a.Serialize(this)},i.prototype.parse=function(t,e,n){var r=this;V.a.Parse(function(){return r},t,e,n)},Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isRefractionEnabled",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTranslucencyEnabled",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markScenePrePassDirty")],i.prototype,"isScatteringEnabled",void 0),Object(_.c)([Object(V.c)()],i.prototype,"_scatteringDiffusionProfileIndex",void 0),Object(_.c)([Object(V.c)()],i.prototype,"refractionIntensity",void 0),Object(_.c)([Object(V.c)()],i.prototype,"translucencyIntensity",void 0),Object(_.c)([Object(V.c)()],i.prototype,"useAlbedoToTintRefraction",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"thicknessTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),Object(_.c)([Object(V.c)()],i.prototype,"_volumeIndexOfRefraction",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"volumeIndexOfRefraction",null),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertRefractionY",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkRefractionWithTransparency",void 0),Object(_.c)([Object(V.c)()],i.prototype,"minimumThickness",void 0),Object(_.c)([Object(V.c)()],i.prototype,"maximumThickness",void 0),Object(_.c)([Object(V.e)()],i.prototype,"tintColor",void 0),Object(_.c)([Object(V.c)()],i.prototype,"tintColorAtDistance",void 0),Object(_.c)([Object(V.e)()],i.prototype,"diffusionDistance",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMaskFromThicknessTextureGltf",void 0),i}(),jp=c(105),nn=c(25),MI=(c(160),`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec4 vMetallicReflectanceFactors;
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)
uniform mat4 view;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#ifdef REALTIME_FILTERING
uniform vec2 vReflectionFilteringInfo;
#endif
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif

#ifdef CLEARCOAT
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif
#endif

#ifdef ANISOTROPIC
uniform vec3 vAnisotropy;
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
uniform vec4 vSheenColor;
#ifdef SHEEN_ROUGHNESS
uniform float vSheenRoughness;
#endif
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#ifdef REALTIME_FILTERING
uniform vec2 vRefractionFilteringInfo;
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
#endif
#ifdef PREPASS
#ifdef PREPASS_IRRADIANCE
uniform float scatteringDiffusionProfile;
#endif
#endif`);We.a.IncludesShadersStore.pbrFragmentDeclaration=MI;var II=`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec2 vReflectionInfos;
uniform vec2 vReflectionFilteringInfo;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float pointSize;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float visibility;
uniform vec4 vMetallicReflectanceFactors;
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
uniform vec2 vClearCoatParams;
uniform vec4 vClearCoatRefractionParams;
uniform vec4 vClearCoatInfos;
uniform mat4 clearCoatMatrix;
uniform mat4 clearCoatRoughnessMatrix;
uniform vec2 vClearCoatBumpInfos;
uniform vec2 vClearCoatTangentSpaceParams;
uniform mat4 clearCoatBumpMatrix;
uniform vec4 vClearCoatTintParams;
uniform float clearCoatColorAtDistance;
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
uniform vec3 vAnisotropy;
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
uniform vec4 vSheenColor;
uniform float vSheenRoughness;
uniform vec4 vSheenInfos;
uniform mat4 sheenMatrix;
uniform mat4 sheenRoughnessMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec2 vRefractionFilteringInfo;
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
uniform vec2 vThicknessParam;
uniform vec3 vDiffusionDistance;
uniform vec4 vTintColor;
uniform vec3 vSubSurfaceIntensity;
uniform float scatteringDiffusionProfile;
uniform vec4 vDetailInfos;
uniform mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};`;We.a.IncludesShadersStore.pbrUboDeclaration=II;var DI=`uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#if DEBUGMODE>0
uniform vec2 vDebugMode;
varying vec4 vClipSpacePosition;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif`;We.a.IncludesShadersStore.pbrFragmentExtraDeclaration=DI;var wI=`#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif
#ifdef METALLIC_REFLECTANCE
#if METALLIC_REFLECTANCEDIRECTUV == 1
#define vMetallicReflectanceUV vMainUV1
#elif METALLIC_REFLECTANCEDIRECTUV == 2
#define vMetallicReflectanceUV vMainUV2
#else
varying vec2 vMetallicReflectanceUV;
#endif
uniform sampler2D metallicReflectanceSampler;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE)
#if CLEARCOAT_TEXTUREDIRECTUV == 1
#define vClearCoatUV vMainUV1
#elif CLEARCOAT_TEXTUREDIRECTUV == 2
#define vClearCoatUV vMainUV2
#else
varying vec2 vClearCoatUV;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS)
#if CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vClearCoatRoughnessUV vMainUV1
#elif CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vClearCoatRoughnessUV vMainUV2
#else
varying vec2 vClearCoatRoughnessUV;
#endif
#endif
#ifdef CLEARCOAT_TEXTURE
uniform sampler2D clearCoatSampler;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D clearCoatRoughnessSampler;
#endif
#ifdef CLEARCOAT_BUMP
#if CLEARCOAT_BUMPDIRECTUV == 1
#define vClearCoatBumpUV vMainUV1
#elif CLEARCOAT_BUMPDIRECTUV == 2
#define vClearCoatBumpUV vMainUV2
#else
varying vec2 vClearCoatBumpUV;
#endif
uniform sampler2D clearCoatBumpSampler;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1
#define vClearCoatTintUV vMainUV1
#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2
#define vClearCoatTintUV vMainUV2
#else
varying vec2 vClearCoatTintUV;
#endif
uniform sampler2D clearCoatTintSampler;
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_TEXTURE
#if SHEEN_TEXTUREDIRECTUV == 1
#define vSheenUV vMainUV1
#elif SHEEN_TEXTUREDIRECTUV == 2
#define vSheenUV vMainUV2
#else
varying vec2 vSheenUV;
#endif
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
#if SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 1
#define vSheenRoughnessUV vMainUV1
#elif SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 2
#define vSheenRoughnessUV vMainUV2
#else
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef SHEEN_TEXTURE
uniform sampler2D sheenSampler;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)
uniform sampler2D sheenRoughnessSampler;
#endif
#endif
#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
#if ANISOTROPIC_TEXTUREDIRECTUV == 1
#define vAnisotropyUV vMainUV1
#elif ANISOTROPIC_TEXTUREDIRECTUV == 2
#define vAnisotropyUV vMainUV2
#else
varying vec2 vAnisotropyUV;
#endif
uniform sampler2D anisotropySampler;
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform samplerCube irradianceSampler;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D reflectionSamplerLow;
uniform sampler2D reflectionSamplerHigh;
#endif
#ifdef USEIRRADIANCEMAP
uniform sampler2D irradianceSampler;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
#ifdef SS_REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform sampler2D refractionSamplerLow;
uniform sampler2D refractionSamplerHigh;
#endif
#endif
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1
#define vThicknessUV vMainUV1
#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2
#define vThicknessUV vMainUV2
#else
varying vec2 vThicknessUV;
#endif
uniform sampler2D thicknessSampler;
#endif
#endif`;We.a.IncludesShadersStore.pbrFragmentSamplersDeclaration=wI,c(116),We.a.IncludesShadersStore.subSurfaceScatteringFunctions=`bool testLightingForSSS(float diffusionProfile)
{
return diffusionProfile<1.;
}`;var LI=`




























vec3 hemisphereCosSample(vec2 u) {

float phi=2.*PI*u.x;
float cosTheta2=1.-u.y;
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}





































vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {

float phi=2.*PI*u.x;

float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}

























































vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) {

float phi=2.*PI*u.x;
float sinTheta=pow(u.y,a/(2.*a+1.));
float cosTheta=sqrt(1.-sinTheta*sinTheta);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}`;We.a.IncludesShadersStore.importanceSampling=LI;var NI=`
#define RECIPROCAL_PI2 0.15915494
#define RECIPROCAL_PI 0.31830988618

#define MINIMUMVARIANCE 0.0005
float convertRoughnessToAverageSlope(float roughness)
{

return square(roughness)+MINIMUMVARIANCE;
}
float fresnelGrazingReflectance(float reflectance0) {


float reflectance90=saturate(reflectance0*25.0);
return reflectance90;
}
vec2 getAARoughnessFactors(vec3 normalVector) {
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalVector.xyz);
vec3 nDfdy=dFdy(normalVector.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);

geometricAlphaGFactor*=0.75;
return vec2(geometricRoughnessFactor,geometricAlphaGFactor);
#else
return vec2(0.);
#endif
}
#ifdef ANISOTROPIC


vec2 getAnisotropicRoughness(float alphaG,float anisotropy) {
float alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);
float alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);
return vec2(alphaT,alphaB);
}


vec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {
vec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;
vec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);
vec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);
vec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));
return anisotropicNormal;

}
#endif
#if defined(CLEARCOAT) || defined(SS_REFRACTION)



vec3 cocaLambert(vec3 alpha,float distance) {
return exp(-alpha*distance);
}

vec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {
return cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));
}

vec3 computeColorAtDistanceInMedia(vec3 color,float distance) {
return -log(color)/distance;
}
vec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 clearCoatAbsorption=mix(vec3(1.0),
cocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),
clearCoatIntensity);
return clearCoatAbsorption;
}
#endif




#ifdef MICROSURFACEAUTOMATIC
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}
#endif`;We.a.IncludesShadersStore.pbrHelperFunctions=NI;var FI=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
uniform vec3 vSphericalL00;
uniform vec3 vSphericalL1_1;
uniform vec3 vSphericalL10;
uniform vec3 vSphericalL11;
uniform vec3 vSphericalL2_2;
uniform vec3 vSphericalL2_1;
uniform vec3 vSphericalL20;
uniform vec3 vSphericalL21;
uniform vec3 vSphericalL22;







vec3 computeEnvironmentIrradiance(vec3 normal) {
return vSphericalL00
+vSphericalL1_1*(normal.y)
+vSphericalL10*(normal.z)
+vSphericalL11*(normal.x)
+vSphericalL2_2*(normal.y*normal.x)
+vSphericalL2_1*(normal.y*normal.z)
+vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+vSphericalL21*(normal.z*normal.x)
+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));
}
#else
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;

vec3 computeEnvironmentIrradiance(vec3 normal) {









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif
#endif`;We.a.IncludesShadersStore.harmonicsFunctions=FI;var BI=`
struct preLightingInfo
{

vec3 lightOffset;
float lightDistanceSquared;
float lightDistance;

float attenuation;

vec3 L;
vec3 H;
float NdotV;
float NdotLUnclamped;
float NdotL;
float VdotH;
float roughness;
};
preLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);

result.lightDistance=sqrt(result.lightDistanceSquared);

result.L=normalize(result.lightOffset);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;

result.lightDistance=length(-lightData.xyz);

result.L=normalize(-lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
result.NdotLUnclamped=dot(N,result.L);
result.NdotL=saturateEps(result.NdotLUnclamped);
return result;
}
preLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {
preLightingInfo result;


result.NdotL=dot(N,lightData.xyz)*0.5+0.5;
result.NdotL=saturateEps(result.NdotL);
result.NdotLUnclamped=result.NdotL;
#ifdef SPECULARTERM
result.L=normalize(lightData.xyz);
result.H=normalize(V+result.L);
result.VdotH=saturate(dot(V,result.H));
#endif
return result;
}`;We.a.IncludesShadersStore.pbrDirectLightingSetupFunctions=BI;var UI=`float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/maxEps(lightDistanceSquared);
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
float lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=saturate(1.0-factor*factor);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977;





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=saturate(cd*lightAngleScale+lightAngleOffset);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}`;We.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions=UI;var VI=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;

#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif

#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif
























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN


float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}

#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;We.a.IncludesShadersStore.pbrBRDFFunctions=VI;var kI=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#ifdef WEBGL2


float radicalInverse_VdC(uint bits)
{
bits=(bits << 16u) | (bits >> 16u);
bits=((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
bits=((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
bits=((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
bits=((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
return float(bits)*2.3283064365386963e-10;
}
vec2 hammersley(uint i,uint N)
{
return vec2(float(i)/float(N),radicalInverse_VdC(i));
}
#else
float vanDerCorpus(int n,int base)
{
float invBase=1.0/float(base);
float denom=1.0;
float result=0.0;
for(int i=0; i<32; ++i)
{
if(n>0)
{
denom=mod(float(n),2.0);
result+=denom*invBase;
invBase=invBase/2.0;
n=int(float(n)/2.0);
}
}
return result;
}
vec2 hammersley(int i,int N)
{
return vec2(float(i)/float(N),vanDerCorpus(i,2));
}
#endif
float log4(float x) {
return log2(x)/2.;
}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);
const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;
const float K=4.;



















































































































#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
vec3 result=vec3(0.0);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 Ls=hemisphereCosSample(Xi);
Ls=normalize(Ls);
vec3 Ns=vec3(0.,0.,1.);
float NoL=dot(Ns,Ls);
if (NoL>0.) {
float pdf_inversed=PI/NoL;
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(l,0.0,maxLevel);
vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;
}
}
result=result*NUM_SAMPLES_FLOAT_INVERSED;
return result;
}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
if (alphaG == 0.) {
vec3 c=textureCube(inputTexture,n).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;
}
vec3 result=vec3(0.);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
float weight=0.;
#ifdef WEBGL2
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);
float NoV=1.;
float NoH=H.z;
float NoH2=H.z*H.z;
float NoL=2.*NoH2-1.;
vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);
L=normalize(L);
if (NoL>0.) {
float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(float(l),0.0,maxLevel);
weight+=NoL;
vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;
}
}
result=result/weight;
return result;
}
#endif
#endif`;We.a.IncludesShadersStore.hdrFilteringFunctions=kI;var jI=`#define CLEARCOATREFLECTANCE90 1.0

struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef CLEARCOAT


vec4 clearCoat;
#endif
#ifdef SHEEN
vec3 sheen;
#endif
};

float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=saturate(lightRoughness+roughness);
return totalRoughness;
#else
return roughness;
#endif
}
vec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {
return mix(groundColor,lightColor,info.NdotL);
}
vec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {
float diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*info.attenuation*info.NdotL*lightColor;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}
#ifdef SS_TRANSLUCENCY
vec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {
float NdotL=absEps(info.NdotLUnclamped);

float wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);

float trAdapt=step(0.,info.NdotLUnclamped);
vec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);
float diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);
return diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;
}
#endif
#ifdef SPECULARTERM
vec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);
#else
float smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);
#endif
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef ANISOTROPIC
vec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float TdotH=dot(T,info.H);
float BdotH=dot(B,info.H);
float TdotV=dot(T,V);
float BdotV=dot(B,V);
float TdotL=dot(T,info.L);
float BdotL=dot(B,info.L);
float alphaG=convertRoughnessToAverageSlope(info.roughness);
vec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);
alphaTB=max(alphaTB,square(geometricRoughnessFactor));
vec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);
float distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);
float smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);
vec3 specTerm=fresnel*distribution*smithVisibility;
return specTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
#ifdef CLEARCOAT
vec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {
float NccdotL=saturateEps(dot(Ncc,info.L));
float NccdotH=saturateEps(dot(Ncc,info.H));
float clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
float fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnel*=clearCoatIntensity;
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);
float kelemenVisibility=visibility_Kelemen(info.VdotH);
float clearCoatTerm=fresnel*distribution*kelemenVisibility;
return vec4(
clearCoatTerm*info.attenuation*NccdotL*lightColor,
1.0-fresnel
);
}
vec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {
vec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);
float NdotLRefract=saturateEps(dot(Ncc,LRefract));
vec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);
return absorption;
}
#endif
#ifdef SHEEN
vec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {
float NdotH=saturateEps(dot(N,info.H));
float roughness=max(info.roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);


float fresnel=1.;
float distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);

float visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);

float sheenTerm=fresnel*distribution*visibility;
return sheenTerm*info.attenuation*info.NdotL*lightColor;
}
#endif
`;We.a.IncludesShadersStore.pbrDirectLightingFunctions=jI;var zI=`#if defined(REFLECTION) || defined(SS_REFRACTION)
float getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {
float microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
float getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {
float lod=log2(cubeMapDimensionPixels)*roughness;
return lod;
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return saturate(square(temp)-1.0+ambientOcclusion);
}
#endif
#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)
float environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {

vec3 reflection=reflect(view,normal);
float temp=saturate(1.0+1.1*dot(reflection,geometricNormal));
return square(temp);
}
#endif




#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
return getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);
}
#endif`;We.a.IncludesShadersStore.pbrIBLFunctions=zI,c(132),c(133);var GI=`struct albedoOpacityOutParams
{
vec3 surfaceAlbedo;
float alpha;
};
#define pbr_inline
void albedoOpacityBlock(
const in vec4 vAlbedoColor,
#ifdef ALBEDO
const in vec4 albedoTexture,
const in vec2 albedoInfos,
#endif
#ifdef OPACITY
const in vec4 opacityMap,
const in vec2 vOpacityInfos,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out albedoOpacityOutParams outParams
)
{

vec3 surfaceAlbedo=vAlbedoColor.rgb;
float alpha=vAlbedoColor.a;
#ifdef ALBEDO
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
#ifdef GAMMAALBEDO
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
#else
surfaceAlbedo*=albedoTexture.rgb;
#endif
surfaceAlbedo*=albedoInfos.y;
#endif
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif
#ifdef DETAIL
float detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);
surfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALBEDO

#ifdef OPACITY
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
outParams.surfaceAlbedo=surfaceAlbedo;
outParams.alpha=alpha;
}
`;We.a.IncludesShadersStore.pbrBlockAlbedoOpacity=GI;var WI=`struct reflectivityOutParams
{
float microSurface;
float roughness;
vec3 surfaceReflectivityColor;
#ifdef METALLICWORKFLOW
vec3 surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
vec3 ambientOcclusionColor;
#endif
#if DEBUGMODE>0
vec4 surfaceMetallicColorMap;
vec4 surfaceReflectivityColorMap;
vec2 metallicRoughness;
vec3 metallicF0;
#endif
};
#define pbr_inline
void reflectivityBlock(
const in vec4 vReflectivityColor,
#ifdef METALLICWORKFLOW
const in vec3 surfaceAlbedo,
const in vec4 metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
const in vec3 reflectivityInfos,
const in vec4 surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
const in vec3 ambientOcclusionColorIn,
#endif
#ifdef MICROSURFACEMAP
const in vec4 microSurfaceTexel,
#endif
#ifdef DETAIL
const in vec4 detailColor,
const in vec4 vDetailInfos,
#endif
out reflectivityOutParams outParams
)
{
float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
#if DEBUGMODE>0
outParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);
outParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;
#endif
#endif
#endif
#ifdef DETAIL
float detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);
float loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);
float hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);
metallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));
#endif
#ifdef MICROSURFACEMAP
metallicRoughness.g*=microSurfaceTexel.r;
#endif
#if DEBUGMODE>0
outParams.metallicRoughness=metallicRoughness;
#endif
#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;
#ifdef FROSTBITE_REFLECTANCE






outParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);

surfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);
#else
vec3 metallicF0=metallicReflectanceFactors.rgb;
#if DEBUGMODE>0
outParams.metallicF0=metallicF0;
#endif

outParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);
#endif
#else
#ifdef REFLECTIVITY
surfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;
#if DEBUGMODE>0
outParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;
#endif
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceMetallicOrReflectivityColorMap.a;
microSurface*=reflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
microSurface*=microSurfaceTexel.r;
#endif
#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE
#endif
#endif
#endif

microSurface=saturate(microSurface);

float roughness=1.-microSurface;
outParams.microSurface=microSurface;
outParams.roughness=roughness;
outParams.surfaceReflectivityColor=surfaceReflectivityColor;
}
`;We.a.IncludesShadersStore.pbrBlockReflectivity=WI;var HI=`struct ambientOcclusionOutParams
{
vec3 ambientOcclusionColor;
#if DEBUGMODE>0
vec3 ambientOcclusionColorMap;
#endif
};
#define pbr_inline
void ambientOcclusionBlock(
#ifdef AMBIENT
const in vec3 ambientOcclusionColorMap_,
const in vec4 vAmbientInfos,
#endif
out ambientOcclusionOutParams outParams
)
{
vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#if DEBUGMODE>0
outParams.ambientOcclusionColorMap=ambientOcclusionColorMap;
#endif
#endif
outParams.ambientOcclusionColor=ambientOcclusionColor;
}
`;We.a.IncludesShadersStore.pbrBlockAmbientOcclusion=HI;var XI=`#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
struct alphaFresnelOutParams
{
float alpha;
};
#define pbr_inline
void alphaFresnelBlock(
const in vec3 normalW,
const in vec3 viewDirectionW,
const in float alpha,
const in float microSurface,
out alphaFresnelOutParams outParams
)
{



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

outParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (outParams.alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

outParams.alpha=1.0;
#endif
#endif
}
#endif
#endif
`;We.a.IncludesShadersStore.pbrBlockAlphaFresnel=XI;var YI=`#ifdef ANISOTROPIC
struct anisotropicOutParams
{
float anisotropy;
vec3 anisotropicTangent;
vec3 anisotropicBitangent;
vec3 anisotropicNormal;
#if DEBUGMODE>0
vec3 anisotropyMapData;
#endif
};
#define pbr_inline
void anisotropicBlock(
const in vec3 vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
const in vec3 anisotropyMapData,
#endif
const in mat3 TBN,
const in vec3 normalW,
const in vec3 viewDirectionW,
out anisotropicOutParams outParams
)
{
float anisotropy=vAnisotropy.b;
vec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);
#ifdef ANISOTROPIC_TEXTURE
anisotropy*=anisotropyMapData.b;
anisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;
#if DEBUGMODE>0
outParams.anisotropyMapData=anisotropyMapData;
#endif
#endif
mat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));
vec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);
vec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));
outParams.anisotropy=anisotropy;
outParams.anisotropicTangent=anisotropicTangent;
outParams.anisotropicBitangent=anisotropicBitangent;
outParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);
}
#endif
`;We.a.IncludesShadersStore.pbrBlockAnisotropic=YI;var KI=`#ifdef REFLECTION
struct reflectionOutParams
{
vec4 environmentRadiance;
vec3 environmentIrradiance;
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords;
#else
vec2 reflectionCoords;
#endif
#ifdef SS_TRANSLUCENCY
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
vec3 irradianceVector;
#endif
#endif
#endif
};
#define pbr_inline
void createReflectionCoords(
const in vec3 vPositionW,
const in vec3 normalW,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REFLECTIONMAP_3D
out vec3 reflectionCoords
#else
out vec2 reflectionCoords
#endif
)
{
#ifdef ANISOTROPIC
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
reflectionCoords=reflectionVector;
#else
reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
}
#define pbr_inline
#define inline
void sampleReflectionTexture(
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const vec2 reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out vec4 environmentRadiance
)
{

#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(LINEARSPECULARREFLECTION)
float reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);
#else
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#endif
#else
float lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);
if (lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentMid,
lodReflectionNormalizedDoubled
);
} else {
environmentRadiance=mix(
environmentMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
}
#define pbr_inline
#define inline
void reflectionBlock(
const in vec3 vPositionW,
const in vec3 normalW,
const in float alphaG,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
const in float NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
const in float roughness,
#endif
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
const in vec3 vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in mat4 reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
out reflectionOutParams outParams
)
{

vec4 environmentRadiance=vec4(0.,0.,0.,0.);
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=vec3(0.);
#else
vec2 reflectionCoords=vec2(0.);
#endif
createReflectionCoords(
vPositionW,
normalW,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
reflectionCoords
);
sampleReflectionTexture(
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
#ifdef REFLECTIONMAP_3D
reflectionSampler,
reflectionCoords,
#else
reflectionSampler,
reflectionCoords,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentRadiance
);

vec3 environmentIrradiance=vec3(0.,0.,0.);
#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
#ifdef ANISOTROPIC
vec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#if defined(REALTIME_FILTERING)
environmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);
#else
environmentIrradiance=computeEnvironmentIrradiance(irradianceVector);
#endif
#ifdef SS_TRANSLUCENCY
outParams.irradianceVector=irradianceVector;
#endif
#endif
#elif defined(USEIRRADIANCEMAP)
vec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);
environmentIrradiance=environmentIrradiance4.rgb;
#ifdef RGBDREFLECTION
environmentIrradiance.rgb=fromRGBD(environmentIrradiance4);
#endif
#ifdef GAMMAREFLECTION
environmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);
#endif
#endif
environmentIrradiance*=vReflectionColor.rgb;
outParams.environmentRadiance=environmentRadiance;
outParams.environmentIrradiance=environmentIrradiance;
outParams.reflectionCoords=reflectionCoords;
}
#endif
`;We.a.IncludesShadersStore.pbrBlockReflection=KI;var QI=`#ifdef SHEEN
struct sheenOutParams
{
float sheenIntensity;
vec3 sheenColor;
float sheenRoughness;
#ifdef SHEEN_LINKWITHALBEDO
vec3 surfaceAlbedo;
#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
float sheenAlbedoScaling;
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
vec3 finalSheenRadianceScaled;
#endif
#if DEBUGMODE>0
vec4 sheenMapData;
vec3 sheenEnvironmentReflectance;
#endif
};
#define pbr_inline
#define inline
void sheenBlock(
const in vec4 vSheenColor,
#ifdef SHEEN_ROUGHNESS
const in float vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 sheenMapRoughnessData,
#endif
#endif
const in float roughness,
#ifdef SHEEN_TEXTURE
const in vec4 sheenMapData,
#endif
const in float reflectance,
#ifdef SHEEN_LINKWITHALBEDO
const in vec3 baseColor,
const in vec3 surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
const in float NdotV,
const in vec3 environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
const in vec2 AARoughnessFactors,
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
const in vec3 reflectionCoords,
#else
const in sampler2D reflectionSampler,
const in vec2 reflectionCoords,
#endif
const in float NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
const in float seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
const in float eho,
#endif
#endif
out sheenOutParams outParams
)
{
float sheenIntensity=vSheenColor.a;
#ifdef SHEEN_TEXTURE
#if DEBUGMODE>0
outParams.sheenMapData=sheenMapData;
#endif
#endif
#ifdef SHEEN_LINKWITHALBEDO
float sheenFactor=pow5(1.0-sheenIntensity);
vec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);
float sheenRoughness=sheenIntensity;
outParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#else
vec3 sheenColor=vSheenColor.rgb;
#ifdef SHEEN_TEXTURE
sheenColor.rgb*=sheenMapData.rgb;
#endif
#ifdef SHEEN_ROUGHNESS
float sheenRoughness=vSheenRoughness;
#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE
#if defined(SHEEN_TEXTURE)
sheenRoughness*=sheenMapData.a;
#endif
#elif defined(SHEEN_TEXTURE_ROUGHNESS)
#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL
sheenRoughness*=sheenMapData.a;
#else
sheenRoughness*=sheenMapRoughnessData.a;
#endif
#endif
#else
float sheenRoughness=roughness;
#ifdef SHEEN_TEXTURE
sheenIntensity*=sheenMapData.a;
#endif
#endif

#if !defined(SHEEN_ALBEDOSCALING)
sheenIntensity*=(1.-reflectance);
#endif

sheenColor*=sheenIntensity;
#endif

#ifdef ENVIRONMENTBRDF

#ifdef SHEEN_ROUGHNESS
vec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);
#else
vec3 environmentSheenBrdf=environmentBrdf;
#endif

#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
float sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);
#ifdef SPECULARAA

sheenAlphaG+=AARoughnessFactors.y;
#endif
vec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);
sampleReflectionTexture(
sheenAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
sheenRoughness,
#endif
reflectionSampler,
reflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentSheenRadiance
);
vec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
sheenEnvironmentReflectance*=seo;
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
sheenEnvironmentReflectance*=eho;
#endif
#if DEBUGMODE>0
outParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;
#endif
outParams.finalSheenRadianceScaled=
environmentSheenRadiance.rgb *
sheenEnvironmentReflectance *
vLightingIntensity.z;





#endif
#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)



outParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;
#endif

outParams.sheenIntensity=sheenIntensity;
outParams.sheenColor=sheenColor;
outParams.sheenRoughness=sheenRoughness;
}
#endif
`;We.a.IncludesShadersStore.pbrBlockSheen=QI;var qI=`struct clearcoatOutParams
{
vec3 specularEnvironmentR0;
float conservationFactor;
vec3 clearCoatNormalW;
vec2 clearCoatAARoughnessFactors;
float clearCoatIntensity;
float clearCoatRoughness;
#ifdef REFLECTION
vec3 finalClearCoatRadianceScaled;
#endif
#ifdef CLEARCOAT_TINT
vec3 absorption;
float clearCoatNdotVRefract;
vec3 clearCoatColor;
float clearCoatThickness;
#endif
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
vec3 energyConservationFactorClearCoat;
#endif
#if DEBUGMODE>0
mat3 TBNClearCoat;
vec2 clearCoatMapData;
vec4 clearCoatTintMapData;
vec4 environmentClearCoatRadiance;
float clearCoatNdotV;
vec3 clearCoatEnvironmentReflectance;
#endif
};
#ifdef CLEARCOAT
#define pbr_inline
#define inline
void clearcoatBlock(
const in vec3 vPositionW,
const in vec3 geometricNormalW,
const in vec3 viewDirectionW,
const in vec2 vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
const in vec4 clearCoatMapRoughnessData,
#endif
const in vec3 specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
const in vec2 clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
const in vec4 vClearCoatTintParams,
const in float clearCoatColorAtDistance,
const in vec4 vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
const in vec4 clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
const in vec2 vClearCoatBumpInfos,
const in vec4 clearCoatBumpMapData,
const in vec2 vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
const in mat3 vTBN,
#else
const in vec2 vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
const in mat4 normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
const in vec3 faceNormal,
#endif
#ifdef REFLECTION
const in vec3 vReflectionMicrosurfaceInfos,
const in vec2 vReflectionInfos,
const in vec3 vReflectionColor,
const in vec4 vLightingIntensity,
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSampler,
#else
const in sampler2D reflectionSampler,
#endif
#ifndef LODBASEDMICROSFURACE
#ifdef REFLECTIONMAP_3D
const in samplerCube reflectionSamplerLow,
const in samplerCube reflectionSamplerHigh,
#else
const in sampler2D reflectionSamplerLow,
const in sampler2D reflectionSamplerHigh,
#endif
#endif
#ifdef REALTIME_FILTERING
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
const in float ambientMonochrome,
#endif
#endif
out clearcoatOutParams outParams
)
{

float clearCoatIntensity=vClearCoatParams.x;
float clearCoatRoughness=vClearCoatParams.y;
#ifdef CLEARCOAT_TEXTURE
clearCoatIntensity*=clearCoatMapData.x;
#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE
clearCoatRoughness*=clearCoatMapData.y;
#endif
#if DEBUGMODE>0
outParams.clearCoatMapData=clearCoatMapData;
#endif
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL
clearCoatRoughness*=clearCoatMapData.y;
#else
clearCoatRoughness*=clearCoatMapRoughnessData.y;
#endif
#endif
outParams.clearCoatIntensity=clearCoatIntensity;
outParams.clearCoatRoughness=clearCoatRoughness;
#ifdef CLEARCOAT_TINT
vec3 clearCoatColor=vClearCoatTintParams.rgb;
float clearCoatThickness=vClearCoatTintParams.a;
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatColor*=clearCoatTintMapData.rgb;
clearCoatThickness*=clearCoatTintMapData.a;
#if DEBUGMODE>0
outParams.clearCoatTintMapData=clearCoatTintMapData;
#endif
#endif
outParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);
outParams.clearCoatThickness=clearCoatThickness;
#endif




#ifdef CLEARCOAT_REMAP_F0
vec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);
#else
vec3 specularEnvironmentR0Updated=specularEnvironmentR0;
#endif
outParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);

vec3 clearCoatNormalW=geometricNormalW;
#ifdef CLEARCOAT_BUMP
#ifdef NORMALXYSCALE
float clearCoatNormalScale=1.0;
#else
float clearCoatNormalScale=vClearCoatBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBNClearCoat=vTBN;
#else
mat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);
#endif
#if DEBUGMODE>0
outParams.TBNClearCoat=TBNClearCoat;
#endif
#ifdef OBJECTSPACE_NORMALMAP
clearCoatNormalW=normalize(clearCoatBumpMapData.xyz*2.0-1.0);
clearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);
#else
clearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
clearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
clearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;
#endif
outParams.clearCoatNormalW=clearCoatNormalW;

outParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);

float clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);

float clearCoatNdotV=absEps(clearCoatNdotVUnclamped);
#if DEBUGMODE>0
outParams.clearCoatNdotV=clearCoatNdotV;
#endif
#ifdef CLEARCOAT_TINT

vec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);

outParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);
#endif

#if defined(REFLECTION)
float clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);
#ifdef SPECULARAA

clearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;
#endif
vec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);
vec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
clearCoatReflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 clearCoatReflectionCoords=clearCoatReflectionVector;
#else
vec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
clearCoatReflectionCoords/=clearCoatReflectionVector.z;
#endif
clearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;
#endif
sampleReflectionTexture(
clearCoatAlphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
clearCoatNdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
clearCoatRoughness,
#endif
reflectionSampler,
clearCoatReflectionCoords,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
environmentClearCoatRadiance
);
#if DEBUGMODE>0
outParams.environmentClearCoatRadiance=environmentClearCoatRadiance;
#endif

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);
#ifdef RADIANCEOCCLUSION
float clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);
clearCoatEnvironmentReflectance*=clearCoatSeo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);
clearCoatEnvironmentReflectance*=clearCoatEho;
#endif
#endif
#endif
#else

vec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));
#endif
clearCoatEnvironmentReflectance*=clearCoatIntensity;
#if DEBUGMODE>0
outParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;
#endif
outParams.finalClearCoatRadianceScaled=
environmentClearCoatRadiance.rgb *
clearCoatEnvironmentReflectance *
vLightingIntensity.z;
#endif
#if defined(CLEARCOAT_TINT)

outParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);
#endif

float fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);
fresnelIBLClearCoat*=clearCoatIntensity;
outParams.conservationFactor=(1.-fresnelIBLClearCoat);
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
outParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);
#endif
}
#endif
`;We.a.IncludesShadersStore.pbrBlockClearcoat=qI;var ZI=`struct subSurfaceOutParams
{
vec3 specularEnvironmentReflectance;
#ifdef SS_REFRACTION
vec3 finalRefraction;
vec3 surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
float alpha;
#endif
#ifdef REFLECTION
float refractionFactorForIrradiance;
#endif
#endif
#ifdef SS_TRANSLUCENCY
vec3 transmittance;
float translucencyIntensity;
#ifdef REFLECTION
vec3 refractionIrradiance;
#endif
#endif
#if DEBUGMODE>0
vec4 thicknessMap;
vec4 environmentRefraction;
vec3 refractionTransmittance;
#endif
};
#ifdef SUBSURFACE
#define pbr_inline
#define inline
void subSurfaceBlock(
const in vec3 vSubSurfaceIntensity,
const in vec2 vThicknessParam,
const in vec4 vTintColor,
const in vec3 normalW,
const in vec3 specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
const in vec4 thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
const in mat4 reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
const in vec3 irradianceVector_,
#endif
#if defined(REALTIME_FILTERING)
const in samplerCube reflectionSampler,
const in vec2 vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
#ifdef REFLECTIONMAP_3D
const in samplerCube irradianceSampler,
#else
const in sampler2D irradianceSampler,
#endif
#endif
#endif
#endif
#ifdef SS_REFRACTION
const in vec3 vPositionW,
const in vec3 viewDirectionW,
const in mat4 view,
const in vec3 surfaceAlbedo,
const in vec4 vRefractionInfos,
const in mat4 refractionMatrix,
const in vec3 vRefractionMicrosurfaceInfos,
const in vec4 vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
const in float alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
const in float NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
const in float roughness,
#else
const in float alphaG,
#endif
#ifdef SS_REFRACTIONMAP_3D
const in samplerCube refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in samplerCube refractionSamplerLow,
const in samplerCube refractionSamplerHigh,
#endif
#else
const in sampler2D refractionSampler,
#ifndef LODBASEDMICROSFURACE
const in sampler2D refractionSamplerLow,
const in sampler2D refractionSamplerHigh,
#endif
#endif
#ifdef ANISOTROPIC
const in anisotropicOutParams anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
const in vec2 vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
const in vec3 vDiffusionDistance,
#endif
out subSurfaceOutParams outParams
)
{
outParams.specularEnvironmentReflectance=specularEnvironmentReflectance;



#ifdef SS_REFRACTION
float refractionIntensity=vSubSurfaceIntensity.x;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
refractionIntensity*=(1.0-alpha);

outParams.alpha=1.0;
#endif
#endif
#ifdef SS_TRANSLUCENCY
float translucencyIntensity=vSubSurfaceIntensity.y;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
float thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;
#if DEBUGMODE>0
outParams.thicknessMap=thicknessMap;
#endif
#ifdef SS_MASK_FROM_THICKNESS_TEXTURE
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.g;
#endif
#ifdef SS_TRANSLUCENCY
translucencyIntensity*=thicknessMap.b;
#endif
#elif defined(SS_MASK_FROM_THICKNESS_TEXTURE_GLTF)
#ifdef SS_REFRACTION
refractionIntensity*=thicknessMap.r;
#elif defined(SS_TRANSLUCENCY)
translucencyIntensity*=thicknessMap.r;
#endif
thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;
#endif
#else
float thickness=vThicknessParam.y;
#endif



#ifdef SS_TRANSLUCENCY
thickness=maxEps(thickness);
vec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);
transmittance*=translucencyIntensity;
outParams.transmittance=transmittance;
outParams.translucencyIntensity=translucencyIntensity;
#endif



#ifdef SS_REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
#ifdef ANISOTROPIC
vec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);
#else
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#endif
#ifdef SS_REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef SS_REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef SS_LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#elif defined(SS_LINEARSPECULARREFRACTION)
float refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,roughness);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef SS_LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
#ifdef REALTIME_FILTERING
environmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);
#else
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#endif
#else
float lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if (lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
} else {
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef SS_RGBDREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef SS_GAMMAREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif



#ifdef SS_REFRACTION
vec3 refractionTransmittance=vec3(refractionIntensity);
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);





refractionTransmittance*=cocaLambert(volumeAlbedo,thickness);
#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)

float maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);
vec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);

environmentRefraction.rgb*=volumeAlbedo;
#else

vec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);
refractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);
#endif
#ifdef SS_ALBEDOFORREFRACTIONTINT

environmentRefraction.rgb*=surfaceAlbedo.rgb;
#endif

outParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);
#ifdef REFLECTION

outParams.refractionFactorForIrradiance=(1.-refractionIntensity);

#endif

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
outParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);

refractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;
#if DEBUGMODE>0
outParams.refractionTransmittance=refractionTransmittance;
#endif
outParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;
#if DEBUGMODE>0
outParams.environmentRefraction=environmentRefraction;
#endif
#endif



#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)
#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
#ifdef INVERTCUBICMAP
irradianceVector.y*=-1.0;
#endif
#else
vec3 irradianceVector=irradianceVector_;
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP)
#if defined(REALTIME_FILTERING)
vec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);
#else
vec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);
#endif
#elif defined(USEIRRADIANCEMAP)
#ifdef REFLECTIONMAP_3D
vec3 irradianceCoords=irradianceVector;
#else
vec2 irradianceCoords=irradianceVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
irradianceCoords/=irradianceVector.z;
#endif
irradianceCoords.y=1.0-irradianceCoords.y;
#endif
vec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);
#ifdef RGBDREFLECTION
refractionIrradiance.rgb=fromRGBD(refractionIrradiance);
#endif
#ifdef GAMMAREFLECTION
refractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);
#endif
#else
vec4 refractionIrradiance=vec4(0.);
#endif
refractionIrradiance.rgb*=transmittance;
outParams.refractionIrradiance=refractionIrradiance.rgb;
#endif
}
#endif
`;We.a.IncludesShadersStore.pbrBlockSubSurface=ZI;var $I=`vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
vec3 geometricNormalW=normalW;
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
geometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;
#endif
`;We.a.IncludesShadersStore.pbrBlockNormalGeometric=$I,c(134);var JI=`#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
`;We.a.IncludesShadersStore.pbrBlockNormalFinal=JI,c(162);var eD=`#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
#ifdef GAMMALIGHTMAP
lightmapColor.rgb=toLinearSpace(lightmapColor.rgb);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
`;We.a.IncludesShadersStore.pbrBlockLightmapInit=eD;var tD=`float NdotVUnclamped=dot(normalW,viewDirectionW);

float NdotV=absEps(NdotVUnclamped);
float alphaG=convertRoughnessToAverageSlope(roughness);
vec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);
#ifdef SPECULARAA

alphaG+=AARoughnessFactors.y;
#endif
#if defined(ENVIRONMENTBRDF)

vec3 environmentBrdf=getBRDFLookup(NdotV,roughness);
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=aoOut.ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);
#endif
#endif
#endif
#endif
`;We.a.IncludesShadersStore.pbrBlockGeometryInfo=tD;var nD=`float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);
vec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);
#else
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);
#endif

#ifdef ALPHAFRESNEL
float reflectance90=fresnelGrazingReflectance(reflectance);
specularEnvironmentR90=specularEnvironmentR90*reflectance90;
#endif
`;We.a.IncludesShadersStore.pbrBlockReflectance0=nD;var rD=`#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
vec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);
#ifdef RADIANCEOCCLUSION
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif
#ifdef CLEARCOAT
specularEnvironmentReflectance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
specularEnvironmentReflectance*=clearcoatOut.absorption;
#endif
#endif
`;We.a.IncludesShadersStore.pbrBlockReflectance=rD;var iD=`vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef CLEARCOAT
vec3 clearCoatBase=vec3(0.,0.,0.);
#endif
#ifdef SHEEN
vec3 sheenBase=vec3(0.,0.,0.);
#endif

preLightingInfo preInfo;
lightingInfo info;
float shadow=1.;
#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
vec3 absorption=vec3(0.);
#endif
`;We.a.IncludesShadersStore.pbrBlockDirectLighting=iD;var oD=`



#if defined(ENVIRONMENTBRDF)
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);
#endif
#endif
#ifndef METALLICWORKFLOW
#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION
surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;
#endif
#endif
#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)
surfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;
#endif

#ifdef REFLECTION
vec3 finalIrradiance=reflectionOut.environmentIrradiance;
#if defined(CLEARCOAT)
finalIrradiance*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
finalIrradiance*=clearcoatOut.absorption;
#endif
#endif
#if defined(SS_REFRACTION)
finalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;
#endif
#if defined(SS_TRANSLUCENCY)
finalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);
finalIrradiance+=subSurfaceOut.refractionIrradiance;
#endif
finalIrradiance*=surfaceAlbedo.rgb;
finalIrradiance*=vLightingIntensity.z;
finalIrradiance*=aoOut.ambientOcclusionColor;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);
vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalSpecularScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalSpecularScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef REFLECTION
vec3 finalRadiance=reflectionOut.environmentRadiance.rgb;
finalRadiance*=subSurfaceOut.specularEnvironmentReflectance;
vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalRadianceScaled*=energyConservationFactor;
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)
finalRadianceScaled*=sheenOut.sheenAlbedoScaling;
#endif
#endif

#ifdef SHEEN
vec3 finalSheen=sheenBase*sheenOut.sheenColor;
finalSheen=max(finalSheen,0.0);
vec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;
#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;
#if defined(CLEARCOAT_TINT)
sheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef CLEARCOAT
vec3 finalClearCoat=clearCoatBase;
finalClearCoat=max(finalClearCoat,0.0);
vec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;
#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)
finalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;
#ifdef CLEARCOAT_TINT
subSurfaceOut.finalRefraction*=clearcoatOut.absorption;
#endif
#endif
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#if defined(CLEARCOAT)
luminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);
#endif
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)
luminanceOverAlpha+=getLuminance(finalClearCoatScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)
alpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);
#endif
#endif
`;We.a.IncludesShadersStore.pbrBlockFinalLitComponents=oD;var aD=`
vec3 finalDiffuse=diffuseBase;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);
finalDiffuse*=vLightingIntensity.x;

vec3 finalAmbient=vAmbientColor;
finalAmbient*=surfaceAlbedo.rgb;

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif
finalEmissive*=vLightingIntensity.y;

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;
#endif
finalAmbient*=aoOut.ambientOcclusionColor;
finalDiffuse*=ambientOcclusionForDirectDiffuse;
`;We.a.IncludesShadersStore.pbrBlockFinalUnlitComponents=aD;var sD=`vec4 finalColor=vec4(
finalAmbient +
finalDiffuse +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance +
#endif
#ifdef SPECULARTERM
finalSpecularScaled +
#endif
#ifdef SHEEN
finalSheenScaled +
#endif
#ifdef CLEARCOAT
finalClearCoatScaled +
#endif
#ifdef REFLECTION
finalRadianceScaled +
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
sheenOut.finalSheenRadianceScaled +
#endif
#ifdef CLEARCOAT
clearcoatOut.finalClearCoatRadianceScaled +
#endif
#endif
#ifdef SS_REFRACTION
subSurfaceOut.finalRefraction +
#endif
#endif
finalEmissive,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor.rgb;
#else
finalColor.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG

finalColor=max(finalColor,0.0);
`;We.a.IncludesShadersStore.pbrBlockFinalColorComposition=sD,c(155);var cD=`#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
finalColor.a*=visibility;
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
`;We.a.IncludesShadersStore.pbrBlockImageProcessing=cD;var lD=`#if DEBUGMODE>0
if (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {

#if DEBUGMODE == 1
gl_FragColor.rgb=vPositionW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 2 && defined(NORMAL)
gl_FragColor.rgb=vNormalW.rgb;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 3 && defined(BUMP) || DEBUGMODE == 3 && defined(PARALLAX) || DEBUGMODE == 3 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 4 && defined(BUMP) || DEBUGMODE == 4 && defined(PARALLAX) || DEBUGMODE == 4 && defined(ANISOTROPIC)

gl_FragColor.rgb=TBN[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 5

gl_FragColor.rgb=normalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 6 && defined(MAINUV1)
gl_FragColor.rgb=vec3(vMainUV1,0.0);
#elif DEBUGMODE == 7 && defined(MAINUV2)
gl_FragColor.rgb=vec3(vMainUV2,0.0);
#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)

gl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 10 && defined(CLEARCOAT)

gl_FragColor.rgb=clearcoatOut.clearCoatNormalW;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 11 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicNormal;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 12 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicTangent;
#define DEBUGMODE_NORMALIZE
#elif DEBUGMODE == 13 && defined(ANISOTROPIC)
gl_FragColor.rgb=anisotropicOut.anisotropicBitangent;
#define DEBUGMODE_NORMALIZE

#elif DEBUGMODE == 20 && defined(ALBEDO)
gl_FragColor.rgb=albedoTexture.rgb;
#elif DEBUGMODE == 21 && defined(AMBIENT)
gl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;
#elif DEBUGMODE == 22 && defined(OPACITY)
gl_FragColor.rgb=opacityMap.rgb;
#elif DEBUGMODE == 23 && defined(EMISSIVE)
gl_FragColor.rgb=emissiveColorTex.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 24 && defined(LIGHTMAP)
gl_FragColor.rgb=lightmapColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;
#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);
#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
gl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;
#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)
gl_FragColor.rgb=sheenOut.sheenMapData.rgb;
#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)
gl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;
#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)
gl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;

#elif DEBUGMODE == 40 && defined(SS_REFRACTION)

gl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 41 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)
gl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 50
gl_FragColor.rgb=diffuseBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 51 && defined(SPECULARTERM)
gl_FragColor.rgb=specularBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 52 && defined(CLEARCOAT)
gl_FragColor.rgb=clearCoatBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 53 && defined(SHEEN)
gl_FragColor.rgb=sheenBase.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 54 && defined(REFLECTION)
gl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;
#define DEBUGMODE_GAMMA

#elif DEBUGMODE == 60
gl_FragColor.rgb=surfaceAlbedo.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 61
gl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 62 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);
#elif DEBUGMODE == 71 && defined(METALLICWORKFLOW)
gl_FragColor.rgb=reflectivityOut.metallicF0;
#elif DEBUGMODE == 63
gl_FragColor.rgb=vec3(roughness);
#elif DEBUGMODE == 64
gl_FragColor.rgb=vec3(alphaG);
#elif DEBUGMODE == 65
gl_FragColor.rgb=vec3(NdotV);
#elif DEBUGMODE == 66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)
gl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 67 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);
#elif DEBUGMODE == 68 && defined(CLEARCOAT)
gl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);
#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)
gl_FragColor.rgb=subSurfaceOut.transmittance;
#elif DEBUGMODE == 70 && defined(SUBSURFACE) && defined(SS_REFRACTION)
gl_FragColor.rgb=subSurfaceOut.refractionTransmittance;

#elif DEBUGMODE == 80 && defined(RADIANCEOCCLUSION)
gl_FragColor.rgb=vec3(seo);
#elif DEBUGMODE == 81 && defined(HORIZONOCCLUSION)
gl_FragColor.rgb=vec3(eho);
#elif DEBUGMODE == 82 && defined(MS_BRDF_ENERGY_CONSERVATION)
gl_FragColor.rgb=vec3(energyConservationFactor);
#elif DEBUGMODE == 83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=specularEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
gl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 85 && defined(SHEEN) && defined(REFLECTION)
gl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;
#define DEBUGMODE_GAMMA
#elif DEBUGMODE == 86 && defined(ALPHABLEND)
gl_FragColor.rgb=vec3(luminanceOverAlpha);
#elif DEBUGMODE == 87
gl_FragColor.rgb=vec3(alpha);
#endif
gl_FragColor.rgb*=vDebugMode.y;
#ifdef DEBUGMODE_NORMALIZE
gl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;
#endif
#ifdef DEBUGMODE_GAMMA
gl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);
#endif
gl_FragColor.a=1.0;
#ifdef PREPASS
gl_FragData[0]=toLinearSpace(gl_FragColor);
gl_FragData[1]=vec4(0.,0.,0.,0.);
#endif
return;
}
#endif`;We.a.IncludesShadersStore.pbrDebug=lD;var uD=`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
precision highp float;

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE
#endif

#include<__decl__pbrFragment>
#include<pbrFragmentExtraDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<pbrFragmentSamplersDeclaration>
#include<imageProcessingDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>

#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<importanceSampling>
#include<pbrHelperFunctions>
#include<imageProcessingFunctions>
#include<shadowsFragmentFunctions>
#include<harmonicsFunctions>
#include<pbrDirectLightingSetupFunctions>
#include<pbrDirectLightingFalloffFunctions>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
#include<pbrDirectLightingFunctions>
#include<pbrIBLFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#ifdef REFLECTION
#include<reflectionFunction>
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
#include<pbrBlockAlbedoOpacity>
#include<pbrBlockReflectivity>
#include<pbrBlockAmbientOcclusion>
#include<pbrBlockAlphaFresnel>
#include<pbrBlockAnisotropic>
#include<pbrBlockReflection>
#include<pbrBlockSheen>
#include<pbrBlockClearcoat>
#include<pbrBlockSubSurface>

void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>

#include<pbrBlockNormalGeometric>
#include<bumpFragment>
#include<pbrBlockNormalFinal>

albedoOpacityOutParams albedoOpacityOut;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#endif
albedoOpacityBlock(
vAlbedoColor,
#ifdef ALBEDO
albedoTexture,
vAlbedoInfos,
#endif
#ifdef OPACITY
opacityMap,
vOpacityInfos,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
albedoOpacityOut
);
vec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;
float alpha=albedoOpacityOut.alpha;
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
#include<depthPrePass>
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

ambientOcclusionOutParams aoOut;
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;
#endif
ambientOcclusionBlock(
#ifdef AMBIENT
ambientOcclusionColorMap,
vAmbientInfos,
#endif
aoOut
);
#include<pbrBlockLightmapInit>
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

vec3 baseColor=surfaceAlbedo;
reflectivityOutParams reflectivityOut;
#if defined(REFLECTIVITY)
vec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
vec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;
#ifndef METALLICWORKFLOW
surfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);
surfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;
#endif
#endif
#if defined(MICROSURFACEMAP)
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
#endif
#ifdef METALLICWORKFLOW
vec4 metallicReflectanceFactors=vMetallicReflectanceFactors;
#ifdef METALLIC_REFLECTANCE
vec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);
metallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);
metallicReflectanceFactors*=metallicReflectanceFactorsMap;
#endif
#endif
reflectivityBlock(
vReflectivityColor,
#ifdef METALLICWORKFLOW
surfaceAlbedo,
metallicReflectanceFactors,
#endif
#ifdef REFLECTIVITY
vReflectivityInfos,
surfaceMetallicOrReflectivityColorMap,
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor,
#endif
#ifdef MICROSURFACEMAP
microSurfaceTexel,
#endif
#ifdef DETAIL
detailColor,
vDetailInfos,
#endif
reflectivityOut
);
float microSurface=reflectivityOut.microSurface;
float roughness=reflectivityOut.roughness;
#ifdef METALLICWORKFLOW
surfaceAlbedo=reflectivityOut.surfaceAlbedo;
#endif
#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
aoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;
#endif

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)
alphaFresnelOutParams alphaFresnelOut;
alphaFresnelBlock(
normalW,
viewDirectionW,
alpha,
microSurface,
alphaFresnelOut
);
alpha=alphaFresnelOut.alpha;
#endif
#endif

#include<pbrBlockGeometryInfo>

#ifdef ANISOTROPIC
anisotropicOutParams anisotropicOut;
#ifdef ANISOTROPIC_TEXTURE
vec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;
#endif
anisotropicBlock(
vAnisotropy,
#ifdef ANISOTROPIC_TEXTURE
anisotropyMapData,
#endif
TBN,
normalW,
viewDirectionW,
anisotropicOut
);
#endif

#ifdef REFLECTION
reflectionOutParams reflectionOut;
reflectionBlock(
vPositionW,
normalW,
alphaG,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
NdotVUnclamped,
#endif
#ifdef LINEARSPECULARREFLECTION
roughness,
#endif
reflectionSampler,
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
vEnvironmentIrradiance,
#endif
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionMatrix,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
reflectionOut
);
#endif

#include<pbrBlockReflectance0>

#ifdef SHEEN
sheenOutParams sheenOut;
#ifdef SHEEN_TEXTURE
vec4 sheenMapData=toLinearSpace(texture2D(sheenSampler,vSheenUV+uvOffset))*vSheenInfos.y;
#endif
#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;
#endif
sheenBlock(
vSheenColor,
#ifdef SHEEN_ROUGHNESS
vSheenRoughness,
#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)
sheenMapRoughnessData,
#endif
#endif
roughness,
#ifdef SHEEN_TEXTURE
sheenMapData,
#endif
reflectance,
#ifdef SHEEN_LINKWITHALBEDO
baseColor,
surfaceAlbedo,
#endif
#ifdef ENVIRONMENTBRDF
NdotV,
environmentBrdf,
#endif
#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
AARoughnessFactors,
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
reflectionOut.reflectionCoords,
NdotVUnclamped,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)
seo,
#endif
#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)
eho,
#endif
#endif
sheenOut
);
#ifdef SHEEN_LINKWITHALBEDO
surfaceAlbedo=sheenOut.surfaceAlbedo;
#endif
#endif

clearcoatOutParams clearcoatOut;
#ifdef CLEARCOAT
#ifdef CLEARCOAT_TEXTURE
vec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
vec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;
#endif
#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)
vec4 clearCoatTintMapData=toLinearSpace(texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset));
#endif
#ifdef CLEARCOAT_BUMP
vec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);
#endif
clearcoatBlock(
vPositionW,
geometricNormalW,
viewDirectionW,
vClearCoatParams,
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)
clearCoatMapRoughnessData,
#endif
specularEnvironmentR0,
#ifdef CLEARCOAT_TEXTURE
clearCoatMapData,
#endif
#ifdef CLEARCOAT_TINT
vClearCoatTintParams,
clearCoatColorAtDistance,
vClearCoatRefractionParams,
#ifdef CLEARCOAT_TINT_TEXTURE
clearCoatTintMapData,
#endif
#endif
#ifdef CLEARCOAT_BUMP
vClearCoatBumpInfos,
clearCoatBumpMapData,
vClearCoatBumpUV,
#if defined(TANGENT) && defined(NORMAL)
vTBN,
#else
vClearCoatTangentSpaceParams,
#endif
#ifdef OBJECTSPACE_NORMALMAP
normalMatrix,
#endif
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
faceNormal,
#endif
#ifdef REFLECTION
vReflectionMicrosurfaceInfos,
vReflectionInfos,
vReflectionColor,
vLightingIntensity,
reflectionSampler,
#ifndef LODBASEDMICROSFURACE
reflectionSamplerLow,
reflectionSamplerHigh,
#endif
#ifdef REALTIME_FILTERING
vReflectionFilteringInfo,
#endif
#endif
#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)
#ifdef RADIANCEOCCLUSION
ambientMonochrome,
#endif
#endif
clearcoatOut
);
#else
clearcoatOut.specularEnvironmentR0=specularEnvironmentR0;
#endif

#include<pbrBlockReflectance>

subSurfaceOutParams subSurfaceOut;
#ifdef SUBSURFACE
#ifdef SS_THICKNESSANDMASK_TEXTURE
vec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);
#endif
subSurfaceBlock(
vSubSurfaceIntensity,
vThicknessParam,
vTintColor,
normalW,
specularEnvironmentReflectance,
#ifdef SS_THICKNESSANDMASK_TEXTURE
thicknessMap,
#endif
#ifdef REFLECTION
#ifdef SS_TRANSLUCENCY
reflectionMatrix,
#ifdef USESPHERICALFROMREFLECTIONMAP
#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
reflectionOut.irradianceVector,
#endif
#if defined(REALTIME_FILTERING)
reflectionSampler,
vReflectionFilteringInfo,
#endif
#endif
#ifdef USEIRRADIANCEMAP
irradianceSampler,
#endif
#endif
#endif
#ifdef SS_REFRACTION
vPositionW,
viewDirectionW,
view,
surfaceAlbedo,
vRefractionInfos,
refractionMatrix,
vRefractionMicrosurfaceInfos,
vLightingIntensity,
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha,
#endif
#ifdef SS_LODINREFRACTIONALPHA
NdotVUnclamped,
#endif
#ifdef SS_LINEARSPECULARREFRACTION
roughness,
#else
alphaG,
#endif
refractionSampler,
#ifndef LODBASEDMICROSFURACE
refractionSamplerLow,
refractionSamplerHigh,
#endif
#ifdef ANISOTROPIC
anisotropicOut,
#endif
#ifdef REALTIME_FILTERING
vRefractionFilteringInfo,
#endif
#endif
#ifdef SS_TRANSLUCENCY
vDiffusionDistance,
#endif
subSurfaceOut
);
#ifdef SS_REFRACTION
surfaceAlbedo=subSurfaceOut.surfaceAlbedo;
#ifdef SS_LINKREFRACTIONTOTRANSPARENCY
alpha=subSurfaceOut.alpha;
#endif
#endif
#else
subSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;
#endif

#include<pbrBlockDirectLighting>
#include<lightFragment>[0..maxSimultaneousLights]

#include<pbrBlockFinalLitComponents>
#endif
#include<pbrBlockFinalUnlitComponents>
#include<pbrBlockFinalColorComposition>
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#include<pbrBlockImageProcessing>
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
vec3 irradiance=finalDiffuse;
#ifndef UNLIT
#ifdef REFLECTION
irradiance+=finalIrradiance;
#endif
#endif
vec3 sqAlbedo=sqrt(surfaceAlbedo);
#ifdef SS_SCATTERING
gl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a);
irradiance/=sqAlbedo;
#else
gl_FragData[0]=finalColor;
float scatteringDiffusionProfile=255.;
#endif
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(irradiance,scatteringDiffusionProfile/255.);
#else
gl_FragData[0]=vec4(finalColor.rgb,finalColor.a);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(sqAlbedo,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(REFLECTIVITY)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(baseReflectivity.rgb,1.0);
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=finalColor;
#endif
#include<pbrDebug>
}
`;We.a.ShadersStore.pbrPixelShader=uD;var hD=`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef METALLIC_REFLECTANCE
uniform vec2 vMetallicReflectanceInfos;
uniform mat4 metallicReflectanceMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
#endif

#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)
uniform vec4 vClearCoatInfos;
#endif
#ifdef CLEARCOAT_TEXTURE
uniform mat4 clearCoatMatrix;
#endif
#ifdef CLEARCOAT_TEXTURE_ROUGHNESS
uniform mat4 clearCoatRoughnessMatrix;
#endif
#ifdef CLEARCOAT_BUMP
uniform vec2 vClearCoatBumpInfos;
uniform mat4 clearCoatBumpMatrix;
#endif
#ifdef CLEARCOAT_TINT_TEXTURE
uniform vec2 vClearCoatTintInfos;
uniform mat4 clearCoatTintMatrix;
#endif
#endif

#ifdef ANISOTROPIC
#ifdef ANISOTROPIC_TEXTURE
uniform vec2 vAnisotropyInfos;
uniform mat4 anisotropyMatrix;
#endif
#endif

#ifdef SHEEN
#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)
uniform vec4 vSheenInfos;
#endif
#ifdef SHEEN_TEXTURE
uniform mat4 sheenMatrix;
#endif
#ifdef SHEEN_TEXTURE_ROUGHNESS
uniform mat4 sheenRoughnessMatrix;
#endif
#endif

#ifdef SUBSURFACE
#ifdef SS_REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
#endif
#ifdef SS_THICKNESSANDMASK_TEXTURE
uniform vec2 vThicknessInfos;
uniform mat4 thicknessMatrix;
#endif
#endif
`;We.a.IncludesShadersStore.pbrVertexDeclaration=hD,c(163),c(164),c(93),c(94),c(100),c(165),c(156),c(158);var dD=`precision highp float;
#include<__decl__pbrVertex>
#define CUSTOM_VERTEX_BEGIN

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
varying vec2 vMetallicReflectanceUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatUV;
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vClearCoatRoughnessUV;
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
varying vec2 vClearCoatBumpUV;
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
varying vec2 vClearCoatTintUV;
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
varying vec2 vSheenUV;
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
varying vec2 vSheenRoughnessUV;
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
varying vec2 vAnisotropyUV;
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
varying vec2 vThicknessUV;
#endif
#endif

varying vec3 vPositionW;
#if DEBUGMODE>0
varying vec4 vClipSpacePosition;
#endif
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#include<prePassVertex>
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#if DEBUGMODE>0
vClipSpacePosition=gl_Position;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(METALLIC_REFLECTANCE) && METALLIC_REFLECTANCEDIRECTUV == 0
if (vMetallicReflectanceInfos.x == 0.)
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vMetallicReflectanceUV=vec2(metallicReflectanceMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#ifdef CLEARCOAT
#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0
if (vClearCoatInfos.x == 0.)
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vClearCoatInfos.z == 0.)
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatRoughnessUV=vec2(clearCoatRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0
if (vClearCoatBumpInfos.x == 0.)
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0
if (vClearCoatTintInfos.x == 0.)
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SHEEN
#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0
if (vSheenInfos.x == 0.)
{
vSheenUV=vec2(sheenMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SHEEN_TEXTURE_ROUGHNESS) && SHEEN_TEXTURE_ROUGHNESSDIRECTUV == 0
if (vSheenInfos.z == 0.)
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSheenRoughnessUV=vec2(sheenRoughnessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef ANISOTROPIC
#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0
if (vAnisotropyInfos.x == 0.)
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif
#ifdef SUBSURFACE
#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0
if (vThicknessInfos.x == 0.)
{
vThicknessUV=vec2(thicknessMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));
}
#endif
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}`;We.a.ShadersStore.pbrVertexShader=dD;var lh=c(92),vs={effect:null,subMesh:null},zp=function(i){function t(){var e=i.call(this)||this;return e.PBR=!0,e.NUM_SAMPLES="0",e.REALTIME_FILTERING=!1,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.ALBEDO=!1,e.GAMMAALBEDO=!1,e.ALBEDODIRECTUV=0,e.VERTEXCOLOR=!1,e.DETAIL=!1,e.DETAILDIRECTUV=0,e.DETAIL_NORMALBLENDMETHOD=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.AMBIENTINGRAYSCALE=!1,e.OPACITY=!1,e.VERTEXALPHA=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHABLEND=!1,e.ALPHAFROMALBEDO=!1,e.ALPHATESTVALUE="0.5",e.SPECULAROVERALPHA=!1,e.RADIANCEOVERALPHA=!1,e.ALPHAFRESNEL=!1,e.LINEARALPHAFRESNEL=!1,e.PREMULTIPLYALPHA=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.REFLECTIVITY=!1,e.REFLECTIVITYDIRECTUV=0,e.SPECULARTERM=!1,e.MICROSURFACEFROMREFLECTIVITYMAP=!1,e.MICROSURFACEAUTOMATIC=!1,e.LODBASEDMICROSFURACE=!1,e.MICROSURFACEMAP=!1,e.MICROSURFACEMAPDIRECTUV=0,e.METALLICWORKFLOW=!1,e.ROUGHNESSSTOREINMETALMAPALPHA=!1,e.ROUGHNESSSTOREINMETALMAPGREEN=!1,e.METALLNESSSTOREINMETALMAPBLUE=!1,e.AOSTOREINMETALMAPRED=!1,e.METALLIC_REFLECTANCE=!1,e.METALLIC_REFLECTANCEDIRECTUV=0,e.ENVIRONMENTBRDF=!1,e.ENVIRONMENTBRDF_RGBD=!1,e.NORMAL=!1,e.TANGENT=!1,e.BUMP=!1,e.BUMPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.NORMALXYSCALE=!0,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.USELIGHTMAPASSHADOWMAP=!1,e.GAMMALIGHTMAP=!1,e.RGBDLIGHTMAP=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USEIRRADIANCEMAP=!1,e.SPHERICAL_HARMONICS=!1,e.USESPHERICALINVERTEX=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.LINEARSPECULARREFLECTION=!1,e.RADIANCEOCCLUSION=!1,e.HORIZONOCCLUSION=!1,e.INSTANCES=!1,e.THIN_INSTANCES=!1,e.PREPASS=!1,e.PREPASS_IRRADIANCE=!1,e.PREPASS_IRRADIANCE_INDEX=-1,e.PREPASS_ALBEDO=!1,e.PREPASS_ALBEDO_INDEX=-1,e.PREPASS_DEPTHNORMAL=!1,e.PREPASS_DEPTHNORMAL_INDEX=-1,e.PREPASS_POSITION=!1,e.PREPASS_POSITION_INDEX=-1,e.PREPASS_VELOCITY=!1,e.PREPASS_VELOCITY_INDEX=-1,e.PREPASS_REFLECTIVITY=!1,e.PREPASS_REFLECTIVITY_INDEX=-1,e.SCENE_MRT_COUNT=0,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.BONES_VELOCITY_ENABLED=!1,e.NONUNIFORMSCALING=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.MULTIVIEW=!1,e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.CLIPPLANE5=!1,e.CLIPPLANE6=!1,e.POINTSIZE=!1,e.FOG=!1,e.LOGARITHMICDEPTH=!1,e.FORCENORMALFORWARD=!1,e.SPECULARAA=!1,e.CLEARCOAT=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!0,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.BRDF_V_HEIGHT_CORRELATED=!1,e.MS_BRDF_ENERGY_CONSERVATION=!1,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,e.SUBSURFACE=!1,e.SS_REFRACTION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE_GLTF=!1,e.UNLIT=!1,e.DEBUGMODE=0,e.rebuild(),e}return Object(_.d)(t,i),t.prototype.reset=function(){i.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(ah.a),Gn=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._directIntensity=1,r._emissiveIntensity=1,r._environmentIntensity=1,r._specularIntensity=1,r._lightingInfos=new d.f(r._directIntensity,r._emissiveIntensity,r._environmentIntensity,r._specularIntensity),r._disableBumpMap=!1,r._albedoTexture=null,r._ambientTexture=null,r._ambientTextureStrength=1,r._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._reflectivityTexture=null,r._metallicTexture=null,r._metallic=null,r._roughness=null,r._metallicF0Factor=1,r._metallicReflectanceColor=x.a.White(),r._metallicReflectanceTexture=null,r._microSurfaceTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._ambientColor=new x.a(0,0,0),r._albedoColor=new x.a(1,1,1),r._reflectivityColor=new x.a(1,1,1),r._reflectionColor=new x.a(1,1,1),r._emissiveColor=new x.a(0,0,0),r._microSurface=.9,r._useLightmapAsShadowmap=!1,r._useHorizonOcclusion=!0,r._useRadianceOcclusion=!0,r._useAlphaFromAlbedoTexture=!1,r._useSpecularOverAlpha=!0,r._useMicroSurfaceFromReflectivityMapAlpha=!1,r._useRoughnessFromMetallicTextureAlpha=!0,r._useRoughnessFromMetallicTextureGreen=!1,r._useMetallnessFromMetallicTextureBlue=!1,r._useAmbientOcclusionFromMetallicTextureRed=!1,r._useAmbientInGrayScale=!1,r._useAutoMicroSurfaceFromReflectivityMap=!1,r._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,r._useRadianceOverAlpha=!0,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r._parallaxScaleBias=.05,r._disableLighting=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._alphaCutOff=.4,r._forceAlphaTest=!1,r._useAlphaFresnel=!1,r._useLinearAlphaFresnel=!1,r._environmentBRDFTexture=null,r._forceIrradianceInFragment=!1,r._realTimeFiltering=!1,r._realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,r._forceNormalForward=!1,r._enableSpecularAntiAliasing=!1,r._imageProcessingObserver=null,r._renderTargets=new In.a(16),r._globalAmbientColor=new x.a(0,0,0),r._useLogarithmicDepth=!1,r._unlit=!1,r._debugMode=0,r.debugMode=0,r.debugLimit=-1,r.debugFactor=1,r.clearCoat=new _s(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.anisotropy=new gs(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.brdf=new OI(r._markAllSubMeshesAsMiscDirty.bind(r)),r.sheen=new Jc(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.detailMap=new lh.a(r._markAllSubMeshesAsTexturesDirty.bind(r)),r._rebuildInParallel=!1,r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),pt.a.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r.subSurface.fillRenderTargetTextures(r._renderTargets),r._renderTargets},r._environmentBRDFTexture=ch.GetEnvironmentBRDFTexture(n),r.subSurface=new el(r._markAllSubMeshesAsTexturesDirty.bind(r),r._markScenePrePassDirty.bind(r),n),r.prePassConfiguration=new jp.a,r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(e){this._realTimeFiltering=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(e){this._realTimeFilteringQuality=e,this.markAsDirty(g.a.MATERIAL_TextureDirtyFlag)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(pt.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype._hasAlphaChannel=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,n,r){if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new zp);var o=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var l=this.getScene(),h=l.getEngine();if(o._areTexturesDirty&&l.texturesEnabled){if(this._albedoTexture&&pt.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._ambientTexture&&pt.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&pt.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var v=this._getReflectionTexture();if(v&&pt.a.ReflectionTextureEnabled&&(!v.isReadyOrNotBlocking()||v.irradianceTexture&&!v.irradianceTexture.isReadyOrNotBlocking())||this._lightmapTexture&&pt.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&pt.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(pt.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking()||this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(h.getCaps().standardDerivatives&&this._bumpTexture&&pt.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady()||this._environmentBRDFTexture&&pt.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(o,l)&&this.clearCoat.isReadyForSubMesh(o,l,h,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(o,l)&&this.anisotropy.isReadyForSubMesh(o,l)&&this.detailMap.isReadyForSubMesh(o,l))||o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;h.getCaps().standardDerivatives||e.isVerticesDataPresent(Me.b.NormalKind)||(e.createNormals(!0),p.a.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var b=n.effect,A=o._areLightsDisposed,D=this._prepareEffect(e,o,this.onCompiled,this.onError,r,null,n.getRenderingMesh().hasThinInstances);if(D)if(this._onEffectCreatedObservable&&(vs.effect=D,vs.subMesh=n,this._onEffectCreatedObservable.notifyObservers(vs)),this.allowShaderHotSwapping&&b&&!D.isReady()){if(D=b,this._rebuildInParallel=!0,o.markAsUnprocessed(),A)return o._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,l.resetCachedMaterial(),n.setEffect(D,o),this.buildUniformLayout();return!(!n.effect||!n.effect.isReady())&&(o._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},t.prototype.isMetallicWorkflow=function(){return!(this._metallic==null&&this._roughness==null&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,n,r,o,l,h,v){if(r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),this._prepareDefines(e,n,l,h,v),!n.isDirty)return null;n.markAsProcessed();var b=this.getScene().getEngine(),A=new ms.a,D=0;n.USESPHERICALINVERTEX&&A.addFallback(D++,"USESPHERICALINVERTEX"),n.FOG&&A.addFallback(D,"FOG"),n.SPECULARAA&&A.addFallback(D,"SPECULARAA"),n.POINTSIZE&&A.addFallback(D,"POINTSIZE"),n.LOGARITHMICDEPTH&&A.addFallback(D,"LOGARITHMICDEPTH"),n.PARALLAX&&A.addFallback(D,"PARALLAX"),n.PARALLAXOCCLUSION&&A.addFallback(D++,"PARALLAXOCCLUSION"),D=gs.AddFallbacks(n,A,D),D=gs.AddFallbacks(n,A,D),D=el.AddFallbacks(n,A,D),D=Jc.AddFallbacks(n,A,D),n.ENVIRONMENTBRDF&&A.addFallback(D++,"ENVIRONMENTBRDF"),n.TANGENT&&A.addFallback(D++,"TANGENT"),n.BUMP&&A.addFallback(D++,"BUMP"),D=ot.a.HandleFallbacksForShadows(n,A,this._maxSimultaneousLights,D++),n.SPECULARTERM&&A.addFallback(D++,"SPECULARTERM"),n.USESPHERICALFROMREFLECTIONMAP&&A.addFallback(D++,"USESPHERICALFROMREFLECTIONMAP"),n.USEIRRADIANCEMAP&&A.addFallback(D++,"USEIRRADIANCEMAP"),n.LIGHTMAP&&A.addFallback(D++,"LIGHTMAP"),n.NORMAL&&A.addFallback(D++,"NORMAL"),n.AMBIENT&&A.addFallback(D++,"AMBIENT"),n.EMISSIVE&&A.addFallback(D++,"EMISSIVE"),n.VERTEXCOLOR&&A.addFallback(D++,"VERTEXCOLOR"),n.MORPHTARGETS&&A.addFallback(D++,"MORPHTARGETS"),n.MULTIVIEW&&A.addFallback(0,"MULTIVIEW");var N=[Me.b.PositionKind];n.NORMAL&&N.push(Me.b.NormalKind),n.TANGENT&&N.push(Me.b.TangentKind),n.UV1&&N.push(Me.b.UVKind),n.UV2&&N.push(Me.b.UV2Kind),n.VERTEXCOLOR&&N.push(Me.b.ColorKind),ot.a.PrepareAttributesForBones(N,e,n,A),ot.a.PrepareAttributesForInstances(N,n),ot.a.PrepareAttributesForMorphTargets(N,e,n);var j="pbr",k=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],H=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler"],J=["Material","Scene"];lh.a.AddUniforms(k),lh.a.AddSamplers(H),el.AddUniforms(k),el.AddSamplers(H),_s.AddUniforms(k),_s.AddSamplers(H),gs.AddUniforms(k),gs.AddSamplers(H),Jc.AddUniforms(k),Jc.AddSamplers(H),jp.a.AddUniforms(k),jp.a.AddSamplers(k),Jn.a&&(Jn.a.PrepareUniforms(k,n),Jn.a.PrepareSamplers(H,n)),ot.a.PrepareUniformsAndSamplersList({uniformsNames:k,uniformBuffersNames:J,samplers:H,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var te={};this.customShaderNameResolve&&(j=this.customShaderNameResolve(j,k,J,H,n,N,te));var oe=n.toString();return b.createEffect(j,{attributes:N,uniformsNames:k,uniformBuffersNames:J,samplers:H,defines:oe,fallbacks:A,onCompiled:r,onError:o,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS},processFinalCode:te.processFinalCode,multiTarget:n.PREPASS},b)},t.prototype._prepareDefines=function(e,n,r,o,l){r===void 0&&(r=null),o===void 0&&(o=null),l===void 0&&(l=!1);var h=this.getScene(),v=h.getEngine();if(ot.a.PrepareDefinesForLights(h,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,ot.a.PrepareDefinesForMultiview(h,n),ot.a.PrepareDefinesForPrePass(h,n,this.canRenderToMRT),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,h.texturesEnabled){h.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&pt.a.DiffuseTextureEnabled?(ot.a.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"),n.GAMMAALBEDO=this._albedoTexture.gammaSpace):n.ALBEDO=!1,this._ambientTexture&&pt.a.AmbientTextureEnabled?(ot.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&pt.a.OpacityTextureEnabled?(ot.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var b=this._getReflectionTexture();if(b&&pt.a.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=b.gammaSpace,n.RGBDREFLECTION=b.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!b.invertZ:b.invertZ,n.LODINREFLECTIONALPHA=b.lodLevelInAlpha,n.LINEARSPECULARREFLECTION=b.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(n.NUM_SAMPLES=""+this.realTimeFilteringQuality,v.webGLVersion>1&&(n.NUM_SAMPLES=n.NUM_SAMPLES+"u"),n.REALTIME_FILTERING=!0):n.REALTIME_FILTERING=!1,b.coordinatesMode===Ve.a.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=b.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.coordinatesMode){case Ve.a.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case Ve.a.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case Ve.a.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case Ve.a.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case Ve.a.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case Ve.a.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ve.a.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ve.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ve.a.CUBIC_MODE:case Ve.a.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!b.boundingBoxSize}b.coordinatesMode!==Ve.a.SKYBOX_MODE&&(b.irradianceTexture?(n.USEIRRADIANCEMAP=!0,n.USESPHERICALFROMREFLECTIONMAP=!1):b.isCube&&(n.USESPHERICALFROMREFLECTIONMAP=!0,n.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||h.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0))}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USEIRRADIANCEMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1,n.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&pt.a.LightmapTextureEnabled?(ot.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,n.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):n.LIGHTMAP=!1,this._emissiveTexture&&pt.a.EmissiveTextureEnabled?ot.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,pt.a.SpecularTextureEnabled?(this._metallicTexture?(ot.a.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(ot.a.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._metallicReflectanceTexture?ot.a.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,n,"METALLIC_REFLECTANCE"):n.METALLIC_REFLECTANCE=!1,this._microSurfaceTexture?ot.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),h.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&pt.a.BumpTextureEnabled&&!this._disableBumpMap?(ot.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&pt.a.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&pt.a.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.SPECULARAA=h.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(n._areTexturesDirty||n._areMiscDirty)&&(n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(ot.a.PrepareDefinesForMisc(e,h,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(Me.b.NormalKind),n.DEBUGMODE=this._debugMode),this.detailMap.prepareDefines(n,h),this.subSurface.prepareDefines(n,h),this.clearCoat.prepareDefines(n,h),this.anisotropy.prepareDefines(n,e,h),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,h),ot.a.PrepareDefinesForFrameBoundValues(h,v,n,!!r,o,l),ot.a.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(e,n,r){var o=this,l=Object(_.a)({clipPlane:!1,useInstances:!1},r),h=new zp,v=this._prepareEffect(e,h,void 0,void 0,l.useInstances,l.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(vs.effect=v,vs.subMesh=null,this._onEffectCreatedObservable.notifyObservers(vs)),v.isReady()?n&&n(this):v.onCompileObservable.add(function(){n&&n(o)})},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionFilteringInfo",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),_s.PrepareUniformBuffer(e),gs.PrepareUniformBuffer(e),Jc.PrepareUniformBuffer(e),el.PrepareUniformBuffer(e),lh.a.PrepareUniformBuffer(e),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this.subSurface.unbind(this._activeEffect)&&(e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}i.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r._materialDefines;if(l){var h=r.effect;if(h){this._activeEffect=h,l.INSTANCES&&!l.THIN_INSTANCES||this.bindOnlyWorldMatrix(e),this.prePassConfiguration.bindForSubMesh(this._activeEffect,o,n,e,this.isFrozen),l.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var v=this._mustRebind(o,h,n.visibility);ot.a.BindBonesParameters(n,this._activeEffect,this.prePassConfiguration);var b=null,A=this._uniformBuffer;if(v){var D=o.getEngine();if(A.bindToEffect(h,"Material"),this.bindViewProjection(h),b=this._getReflectionTexture(),!A.useUbo||!this.isFrozen||!A.isSync){if(o.texturesEnabled){if(this._albedoTexture&&pt.a.DiffuseTextureEnabled&&(A.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),ot.a.BindTextureMatrix(this._albedoTexture,A,"albedo")),this._ambientTexture&&pt.a.AmbientTextureEnabled&&(A.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),ot.a.BindTextureMatrix(this._ambientTexture,A,"ambient")),this._opacityTexture&&pt.a.OpacityTextureEnabled&&(A.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),ot.a.BindTextureMatrix(this._opacityTexture,A,"opacity")),b&&pt.a.ReflectionTextureEnabled){if(A.updateMatrix("reflectionMatrix",b.getReflectionTextureMatrix()),A.updateFloat2("vReflectionInfos",b.level,0),b.boundingBoxSize){var N=b;A.updateVector3("vReflectionPosition",N.boundingBoxPosition),A.updateVector3("vReflectionSize",N.boundingBoxSize)}if(this.realTimeFiltering){var j=b.getSize().width;A.updateFloat2("vReflectionFilteringInfo",j,se.a.Log2(j))}if(!l.USEIRRADIANCEMAP){var k=b.sphericalPolynomial;if(l.USESPHERICALFROMREFLECTIONMAP&&k)if(l.SPHERICAL_HARMONICS){var H=k.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",H.l00),this._activeEffect.setVector3("vSphericalL1_1",H.l1_1),this._activeEffect.setVector3("vSphericalL10",H.l10),this._activeEffect.setVector3("vSphericalL11",H.l11),this._activeEffect.setVector3("vSphericalL2_2",H.l2_2),this._activeEffect.setVector3("vSphericalL2_1",H.l2_1),this._activeEffect.setVector3("vSphericalL20",H.l20),this._activeEffect.setVector3("vSphericalL21",H.l21),this._activeEffect.setVector3("vSphericalL22",H.l22)}else this._activeEffect.setFloat3("vSphericalX",k.x.x,k.x.y,k.x.z),this._activeEffect.setFloat3("vSphericalY",k.y.x,k.y.y,k.y.z),this._activeEffect.setFloat3("vSphericalZ",k.z.x,k.z.y,k.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",k.xx.x-k.zz.x,k.xx.y-k.zz.y,k.xx.z-k.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",k.yy.x-k.zz.x,k.yy.y-k.zz.y,k.yy.z-k.zz.z),this._activeEffect.setFloat3("vSphericalZZ",k.zz.x,k.zz.y,k.zz.z),this._activeEffect.setFloat3("vSphericalXY",k.xy.x,k.xy.y,k.xy.z),this._activeEffect.setFloat3("vSphericalYZ",k.yz.x,k.yz.y,k.yz.z),this._activeEffect.setFloat3("vSphericalZX",k.zx.x,k.zx.y,k.zx.z)}A.updateFloat3("vReflectionMicrosurfaceInfos",b.getSize().width,b.lodGenerationScale,b.lodGenerationOffset)}this._emissiveTexture&&pt.a.EmissiveTextureEnabled&&(A.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),ot.a.BindTextureMatrix(this._emissiveTexture,A,"emissive")),this._lightmapTexture&&pt.a.LightmapTextureEnabled&&(A.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),ot.a.BindTextureMatrix(this._lightmapTexture,A,"lightmap")),pt.a.SpecularTextureEnabled&&(this._metallicTexture?(A.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),ot.a.BindTextureMatrix(this._metallicTexture,A,"reflectivity")):this._reflectivityTexture&&(A.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),ot.a.BindTextureMatrix(this._reflectivityTexture,A,"reflectivity")),this._metallicReflectanceTexture&&(A.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),ot.a.BindTextureMatrix(this._metallicReflectanceTexture,A,"metallicReflectance")),this._microSurfaceTexture&&(A.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),ot.a.BindTextureMatrix(this._microSurfaceTexture,A,"microSurfaceSampler"))),this._bumpTexture&&D.getCaps().standardDerivatives&&pt.a.BumpTextureEnabled&&!this._disableBumpMap&&(A.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),ot.a.BindTextureMatrix(this._bumpTexture,A,"bump"),o._mirroredCameraPosition?A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&A.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW){x.c.Color3[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic,x.c.Color3[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness,A.updateColor4("vReflectivityColor",x.c.Color3[0],1);var J=this.subSurface.indexOfRefraction,te=Math.pow((J-1)/(J+1),2);this._metallicReflectanceColor.scaleToRef(te*this._metallicF0Factor,x.c.Color3[0]);var oe=this._metallicF0Factor;A.updateColor4("vMetallicReflectanceFactors",x.c.Color3[0],oe)}else A.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);A.updateColor3("vEmissiveColor",pt.a.EmissiveTextureEnabled?this._emissiveColor:x.a.BlackReadOnly),A.updateColor3("vReflectionColor",this._reflectionColor),!l.SS_REFRACTION&&this.subSurface.linkRefractionWithTransparency?A.updateColor4("vAlbedoColor",this._albedoColor,1):A.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*o.environmentIntensity,this._lightingInfos.w=this._specularIntensity,A.updateVector4("vLightingIntensity",this._lightingInfos)}A.updateFloat("visibility",n.visibility),o.texturesEnabled&&(this._albedoTexture&&pt.a.DiffuseTextureEnabled&&A.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&pt.a.AmbientTextureEnabled&&A.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&pt.a.OpacityTextureEnabled&&A.setTexture("opacitySampler",this._opacityTexture),b&&pt.a.ReflectionTextureEnabled&&(l.LODBASEDMICROSFURACE?A.setTexture("reflectionSampler",b):(A.setTexture("reflectionSampler",b._lodTextureMid||b),A.setTexture("reflectionSamplerLow",b._lodTextureLow||b),A.setTexture("reflectionSamplerHigh",b._lodTextureHigh||b)),l.USEIRRADIANCEMAP&&A.setTexture("irradianceSampler",b.irradianceTexture)),l.ENVIRONMENTBRDF&&A.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&pt.a.EmissiveTextureEnabled&&A.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&pt.a.LightmapTextureEnabled&&A.setTexture("lightmapSampler",this._lightmapTexture),pt.a.SpecularTextureEnabled&&(this._metallicTexture?A.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&A.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&A.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._microSurfaceTexture&&A.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&D.getCaps().standardDerivatives&&pt.a.BumpTextureEnabled&&!this._disableBumpMap&&A.setTexture("bumpSampler",this._bumpTexture)),this.detailMap.bindForSubMesh(A,o,this.isFrozen),this.subSurface.bindForSubMesh(A,o,D,this.isFrozen,l.LODBASEDMICROSFURACE,this.realTimeFiltering),this.clearCoat.bindForSubMesh(A,o,D,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY,r),this.anisotropy.bindForSubMesh(A,o,this.isFrozen),this.sheen.bindForSubMesh(A,o,this.isFrozen,r),ot.a.BindClipPlane(this._activeEffect,o),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var ce=o._forcedViewPosition?o._forcedViewPosition:o._mirroredCameraPosition?o._mirroredCameraPosition:o.activeCamera.globalPosition,he=o.useRightHandedSystem===(o._mirroredCameraPosition!=null);h.setFloat4("vEyePosition",ce.x,ce.y,ce.z,he?-1:1),h.setColor3("vAmbientColor",this._globalAmbientColor),h.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!v&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&ot.a.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,this._rebuildInParallel),(o.fogEnabled&&n.applyFog&&o.fogMode!==ne.a.FOGMODE_NONE||b)&&this.bindView(h),ot.a.BindFogParameters(o,n,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&ot.a.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),ot.a.BindLogDepth(l,this._activeEffect,o)),A.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.detailMap.getAnimatables(e),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this.detailMap.getActiveTextures(e),this.subSurface.getActiveTextures(e),this.clearCoat.getActiveTextures(e),this.sheen.getActiveTextures(e),this.anisotropy.getActiveTextures(e),e},t.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._albedoTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e||this.detailMap.hasTexture(e)||this.subSurface.hasTexture(e)||this.clearCoat.hasTexture(e)||this.sheen.hasTexture(e)||this.anisotropy.hasTexture(e)},t.prototype.setPrePassRenderer=function(e){if(this.subSurface.isScatteringEnabled){var n=this.getScene().enableSubSurfaceForPrePass();return n&&(n.enabled=!0),!0}return!1},t.prototype.dispose=function(e,n){var r,o,l,h,v,b,A,D,N,j,k;n&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),(r=this._albedoTexture)===null||r===void 0||r.dispose(),(o=this._ambientTexture)===null||o===void 0||o.dispose(),(l=this._opacityTexture)===null||l===void 0||l.dispose(),(h=this._reflectionTexture)===null||h===void 0||h.dispose(),(v=this._emissiveTexture)===null||v===void 0||v.dispose(),(b=this._metallicTexture)===null||b===void 0||b.dispose(),(A=this._reflectivityTexture)===null||A===void 0||A.dispose(),(D=this._bumpTexture)===null||D===void 0||D.dispose(),(N=this._lightmapTexture)===null||N===void 0||N.dispose(),(j=this._metallicReflectanceTexture)===null||j===void 0||j.dispose(),(k=this._microSurfaceTexture)===null||k===void 0||k.dispose()),this.detailMap.dispose(n),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,n)},t.PBRMATERIAL_OPAQUE=nn.a.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=nn.a.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=nn.a.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=nn.a.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,Object(_.c)([Object(V.i)()],t.prototype,"_imageProcessingConfiguration",void 0),Object(_.c)([Object(V.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),Object(_.c)([Object(V.c)()],t.prototype,"useLogarithmicDepth",null),t}(sh.a),tl=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.directIntensity=1,r.emissiveIntensity=1,r.environmentIntensity=1,r.specularIntensity=1,r.disableBumpMap=!1,r.ambientTextureStrength=1,r.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r.metallicF0Factor=1,r.metallicReflectanceColor=x.a.White(),r.ambientColor=new x.a(0,0,0),r.albedoColor=new x.a(1,1,1),r.reflectivityColor=new x.a(1,1,1),r.reflectionColor=new x.a(1,1,1),r.emissiveColor=new x.a(0,0,0),r.microSurface=1,r.useLightmapAsShadowmap=!1,r.useAlphaFromAlbedoTexture=!1,r.forceAlphaTest=!1,r.alphaCutOff=.4,r.useSpecularOverAlpha=!0,r.useMicroSurfaceFromReflectivityMapAlpha=!1,r.useRoughnessFromMetallicTextureAlpha=!0,r.useRoughnessFromMetallicTextureGreen=!1,r.useMetallnessFromMetallicTextureBlue=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.useAmbientInGrayScale=!1,r.useAutoMicroSurfaceFromReflectivityMap=!1,r.useRadianceOverAlpha=!0,r.useObjectSpaceNormalMap=!1,r.useParallax=!1,r.useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r.disableLighting=!1,r.forceIrradianceInFragment=!1,r.maxSimultaneousLights=4,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.twoSidedLighting=!1,r.useAlphaFresnel=!1,r.useLinearAlphaFresnel=!1,r.environmentBRDFTexture=null,r.forceNormalForward=!1,r.enableSpecularAntiAliasing=!1,r.useHorizonOcclusion=!0,r.useRadianceOcclusion=!0,r.unlit=!1,r._environmentBRDFTexture=ch.GetEnvironmentBRDFTexture(n),r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===Gn.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?Gn.LIGHTFALLOFF_PHYSICAL:Gn.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===Gn.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?Gn.LIGHTFALLOFF_GLTF:Gn.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var n=this,r=V.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=V.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},t.PBRMATERIAL_OPAQUE=Gn.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=Gn.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=Gn.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=Gn.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=Gn.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicF0Factor",void 0),Object(_.c)([Object(V.e)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceColor",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(_.c)([Object(V.e)("ambient"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),Object(_.c)([Object(V.e)("albedo"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),Object(_.c)([Object(V.e)("reflectivity"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),Object(_.c)([Object(V.e)("reflection"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),Object(_.c)([Object(V.e)("emissive"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),Object(_.c)([Object(V.c)()],t.prototype,"usePhysicalLightFalloff",null),Object(_.c)([Object(V.c)()],t.prototype,"useGLTFLightFalloff",null),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(Gn);M.a.RegisteredTypes["BABYLON.PBRMaterial"]=tl;function uh(i){return i.charCodeAt(0)+(i.charCodeAt(1)<<8)+(i.charCodeAt(2)<<16)+(i.charCodeAt(3)<<24)}var Fy=uh("DXT1"),By=uh("DXT3"),Uy=uh("DXT5"),Gp=uh("DX10"),Uo=function(){function i(){}return i.GetDDSInfo=function(t){var e=new Int32Array(t.buffer,t.byteOffset,31),n=new Int32Array(t.buffer,t.byteOffset,35),r=1;131072&e[2]&&(r=Math.max(1,e[7]));var o=e[21],l=o===Gp?n[32]:0,h=g.a.TEXTURETYPE_UNSIGNED_INT;switch(o){case 113:h=g.a.TEXTURETYPE_HALF_FLOAT;break;case 116:h=g.a.TEXTURETYPE_FLOAT;break;case Gp:if(l===10){h=g.a.TEXTURETYPE_HALF_FLOAT;break}if(l===2){h=g.a.TEXTURETYPE_FLOAT;break}}return{width:e[4],height:e[3],mipmapCount:r,isFourCC:(4&e[20])==4,isRGB:(64&e[20])==64,isLuminance:(131072&e[20])==131072,isCube:(512&e[28])==512,isCompressed:o===Fy||o===By||o===Uy,dxgiFormat:l,textureType:h}},i._ToHalfFloat=function(t){i._FloatView||(i._FloatView=new Float32Array(1),i._Int32View=new Int32Array(i._FloatView.buffer)),i._FloatView[0]=t;var e=i._Int32View[0],n=e>>16&32768,r=e>>12&2047,o=e>>23&255;return o<103?n:o>142?(n|=31744,n|=(o==255?0:1)&&8388607&e):o<113?n|=((r|=2048)>>114-o)+(r>>113-o&1):(n|=o-112<<10|r>>1,n+=1&r)},i._FromHalfFloat=function(t){var e=(32768&t)>>15,n=(31744&t)>>10,r=1023&t;return n===0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},i._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,e,n,r,o,l){for(var h=new Float32Array(r),v=new Uint16Array(o,n),b=0,A=0;A<e;A++)for(var D=0;D<t;D++){var N=4*(D+A*t);h[b]=i._FromHalfFloat(v[N]),h[b+1]=i._FromHalfFloat(v[N+1]),h[b+2]=i._FromHalfFloat(v[N+2]),i.StoreLODInAlphaChannel?h[b+3]=l:h[b+3]=i._FromHalfFloat(v[N+3]),b+=4}return h},i._GetHalfFloatRGBAArrayBuffer=function(t,e,n,r,o,l){if(i.StoreLODInAlphaChannel){for(var h=new Uint16Array(r),v=new Uint16Array(o,n),b=0,A=0;A<e;A++)for(var D=0;D<t;D++){var N=4*(D+A*t);h[b]=v[N],h[b+1]=v[N+1],h[b+2]=v[N+2],h[b+3]=i._ToHalfFloat(l),b+=4}return h}return new Uint16Array(o,n,r)},i._GetFloatRGBAArrayBuffer=function(t,e,n,r,o,l){if(i.StoreLODInAlphaChannel){for(var h=new Float32Array(r),v=new Float32Array(o,n),b=0,A=0;A<e;A++)for(var D=0;D<t;D++){var N=4*(D+A*t);h[b]=v[N],h[b+1]=v[N+1],h[b+2]=v[N+2],h[b+3]=l,b+=4}return h}return new Float32Array(o,n,r)},i._GetFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,l){for(var h=new Uint8Array(r),v=new Float32Array(o,n),b=0,A=0;A<e;A++)for(var D=0;D<t;D++){var N=4*(D+A*t);h[b]=255*se.a.Clamp(v[N]),h[b+1]=255*se.a.Clamp(v[N+1]),h[b+2]=255*se.a.Clamp(v[N+2]),i.StoreLODInAlphaChannel?h[b+3]=l:h[b+3]=255*se.a.Clamp(v[N+3]),b+=4}return h},i._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,e,n,r,o,l){for(var h=new Uint8Array(r),v=new Uint16Array(o,n),b=0,A=0;A<e;A++)for(var D=0;D<t;D++){var N=4*(D+A*t);h[b]=255*se.a.Clamp(i._FromHalfFloat(v[N])),h[b+1]=255*se.a.Clamp(i._FromHalfFloat(v[N+1])),h[b+2]=255*se.a.Clamp(i._FromHalfFloat(v[N+2])),i.StoreLODInAlphaChannel?h[b+3]=l:h[b+3]=255*se.a.Clamp(i._FromHalfFloat(v[N+3])),b+=4}return h},i._GetRGBAArrayBuffer=function(t,e,n,r,o,l,h,v,b){for(var A=new Uint8Array(r),D=new Uint8Array(o,n),N=0,j=0;j<e;j++)for(var k=0;k<t;k++){var H=4*(k+j*t);A[N]=D[H+l],A[N+1]=D[H+h],A[N+2]=D[H+v],A[N+3]=D[H+b],N+=4}return A},i._ExtractLongWordOrder=function(t){return t===0||t===255||t===-16777216?0:1+i._ExtractLongWordOrder(t>>8)},i._GetRGBArrayBuffer=function(t,e,n,r,o,l,h,v){for(var b=new Uint8Array(r),A=new Uint8Array(o,n),D=0,N=0;N<e;N++)for(var j=0;j<t;j++){var k=3*(j+N*t);b[D]=A[k+l],b[D+1]=A[k+h],b[D+2]=A[k+v],D+=3}return b},i._GetLuminanceArrayBuffer=function(t,e,n,r,o){for(var l=new Uint8Array(r),h=new Uint8Array(o,n),v=0,b=0;b<e;b++)for(var A=0;A<t;A++){var D=A+b*t;l[v]=h[D],v++}return l},i.UploadDDSLevels=function(t,e,n,r,o,l,h,v){h===void 0&&(h=-1);var b=null;r.sphericalPolynomial&&(b=new Array);var A,D,N,j,k,H,J,te=t.getCaps().s3tc,oe=new Int32Array(n.buffer,n.byteOffset,31),ce=0,he=0,_e=1;if(oe[0]===542327876)if(r.isFourCC||r.isRGB||r.isLuminance)if(!r.isCompressed||te){var ye=oe[22];j=oe[1]+4;var Ee,Oe=!1;if(r.isFourCC)switch(A=oe[21]){case Fy:_e=8,he=te.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case By:_e=16,he=te.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Uy:_e=16,he=te.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:Oe=!0;break;case Gp:j+=20;var Ae=!1;switch(r.dxgiFormat){case 10:case 2:Oe=!0,Ae=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,ye=32,Ae=!0}if(Ae)break;default:return void console.error("Unsupported FourCC code:",(Ee=A,String.fromCharCode(255&Ee,Ee>>8&255,Ee>>16&255,Ee>>24&255)))}var xe=i._ExtractLongWordOrder(oe[23]),Pe=i._ExtractLongWordOrder(oe[24]),Be=i._ExtractLongWordOrder(oe[25]),Ce=i._ExtractLongWordOrder(oe[26]);Oe&&(he=t._getRGBABufferInternalSizedFormat(r.textureType)),H=1,131072&oe[2]&&o!==!1&&(H=Math.max(1,oe[7]));for(var Ue=v||0;Ue<l;Ue++){for(D=oe[4],N=oe[3],J=0;J<H;++J){if(h===-1||h===J){var Le=h===-1?J:0;if(!r.isCompressed&&r.isFourCC){e.format=g.a.TEXTUREFORMAT_RGBA,ce=D*N*4;var ke=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(ye===128?(ke=i._GetFloatAsUIntRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le),b&&Le==0&&b.push(i._GetFloatRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le))):ye===64&&(ke=i._GetHalfFloatAsUIntRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le),b&&Le==0&&b.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le))),e.type=g.a.TEXTURETYPE_UNSIGNED_INT):ye===128?(e.type=g.a.TEXTURETYPE_FLOAT,ke=i._GetFloatRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le),b&&Le==0&&b.push(ke)):ye!==64||t.getCaps().textureHalfFloat?(e.type=g.a.TEXTURETYPE_HALF_FLOAT,ke=i._GetHalfFloatRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le),b&&Le==0&&b.push(i._GetHalfFloatAsFloatRGBAArrayBuffer(D,N,j,ce,n.buffer,Le))):(e.type=g.a.TEXTURETYPE_FLOAT,ke=i._GetHalfFloatAsFloatRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,Le),b&&Le==0&&b.push(ke)),ke&&t._uploadDataToTextureDirectly(e,ke,Ue,Le)}else if(r.isRGB)e.type=g.a.TEXTURETYPE_UNSIGNED_INT,ye===24?(e.format=g.a.TEXTUREFORMAT_RGB,ce=D*N*3,k=i._GetRGBArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,xe,Pe,Be),t._uploadDataToTextureDirectly(e,k,Ue,Le)):(e.format=g.a.TEXTUREFORMAT_RGBA,ce=D*N*4,k=i._GetRGBAArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer,xe,Pe,Be,Ce),t._uploadDataToTextureDirectly(e,k,Ue,Le));else if(r.isLuminance){var qe=t._getUnpackAlignement(),at=D;ce=Math.floor((D+qe-1)/qe)*qe*(N-1)+at,k=i._GetLuminanceArrayBuffer(D,N,n.byteOffset+j,ce,n.buffer),e.format=g.a.TEXTUREFORMAT_LUMINANCE,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(e,k,Ue,Le)}else ce=Math.max(4,D)/4*Math.max(4,N)/4*_e,k=new Uint8Array(n.buffer,n.byteOffset+j,ce),e.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(e,he,D,N,k,Ue,Le)}j+=ye?D*N*(ye/8):ce,D*=.5,N*=.5,D=Math.max(1,D),N=Math.max(1,N)}if(v!==void 0)break}b&&b.length>0?r.sphericalPolynomial=Zu.ConvertCubeMapToSphericalPolynomial({size:oe[4],right:b[0],left:b[1],up:b[2],down:b[3],front:b[4],back:b[5],format:g.a.TEXTUREFORMAT_RGBA,type:g.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):r.sphericalPolynomial=void 0}else p.a.Error("Compressed textures are not supported on this platform.");else p.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else p.a.Error("Invalid magic number in DDS header")},i.StoreLODInAlphaChannel=!1,i}();Xt.a.prototype.createPrefilteredCubeTexture=function(i,t,e,n,r,o,l,h,v){var b=this;return r===void 0&&(r=null),o===void 0&&(o=null),h===void 0&&(h=null),v===void 0&&(v=!0),this.createCubeTexture(i,t,null,!1,function(A){if(A){var D=A.texture;if(v?A.info.sphericalPolynomial&&(D._sphericalPolynomial=A.info.sphericalPolynomial):D._sphericalPolynomial=new Qc,D._source=Mt.b.CubePrefiltered,b.getCaps().textureLOD)r&&r(D);else{var N=b._gl,j=A.width;if(j){for(var k=[],H=0;H<3;H++){var J=1-H/2,te=n,oe=se.a.Log2(j)*e+n,ce=te+(oe-te)*J,he=Math.round(Math.min(Math.max(ce,0),oe)),_e=new Mt.a(b,Mt.b.Temp);if(_e.type=D.type,_e.format=D.format,_e.width=Math.pow(2,Math.max(se.a.Log2(j)-he,0)),_e.height=_e.width,_e.isCube=!0,b._bindTextureDirectly(N.TEXTURE_CUBE_MAP,_e,!0),_e.samplingMode=g.a.TEXTURE_LINEAR_LINEAR,N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),A.isDDS){var ye=A.info,Ee=A.data;b._unpackFlipY(ye.isCompressed),Uo.UploadDDSLevels(b,_e,Ee,ye,!0,6,he)}else p.a.Warn("DDS is the only prefiltered cube map supported so far.");b._bindTextureDirectly(N.TEXTURE_CUBE_MAP,null);var Oe=new jr.a(t);Oe.isCube=!0,Oe._texture=_e,_e.isReady=!0,k.push(Oe)}D._lodTextureHigh=k[2],D._lodTextureMid=k[1],D._lodTextureLow=k[0],r&&r(D)}}}else r&&r(null)},o,l,h,v,e,n)};var Vy=function(){function i(){this.supportCascades=!0}return i.prototype.canLoad=function(t){return Jr.a.EndsWith(t,".dds")},i.prototype.loadCubeData=function(t,e,n,r,o){var l,h=e.getEngine(),v=!1;if(Array.isArray(t))for(var b=0;b<t.length;b++){var A=t[b];l=Uo.GetDDSInfo(A),e.width=l.width,e.height=l.height,v=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&e.generateMipMaps,h._unpackFlipY(l.isCompressed),Uo.UploadDDSLevels(h,e,A,l,v,6,-1,b),l.isFourCC||l.mipmapCount!==1||h.generateMipMapsForCubemap(e)}else{var D=t;l=Uo.GetDDSInfo(D),e.width=l.width,e.height=l.height,n&&(l.sphericalPolynomial=new Qc),v=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&e.generateMipMaps,h._unpackFlipY(l.isCompressed),Uo.UploadDDSLevels(h,e,D,l,v,6),l.isFourCC||l.mipmapCount!==1||h.generateMipMapsForCubemap(e,!1)}h._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r({isDDS:!0,width:e.width,info:l,data:t,texture:e})},i.prototype.loadData=function(t,e,n){var r=Uo.GetDDSInfo(t),o=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&e.generateMipMaps&&r.width>>r.mipmapCount-1==1;n(r.width,r.height,o,r.isFourCC,function(){Uo.UploadDDSLevels(e.getEngine(),e,t,r,o,1)})},i}();Xe.a._TextureLoaders.push(new Vy);var ky=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return Jr.a.EndsWith(t,".env")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var l=eo.GetEnvInfo(t);l?(e.width=l.width,e.height=l.width,eo.UploadEnvSpherical(e,l),eo.UploadEnvLevelsAsync(e,t,l).then(function(){e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()})):o&&o("Can not parse the environment file",null)}},i.prototype.loadData=function(t,e,n){throw".env not supported in 2d."},i}();Xe.a._TextureLoaders.push(new ky);var hh=function(){function i(t,e,n,r){if(this.data=t,this.isInvalid=!1,!i.IsValid(t))return this.isInvalid=!0,void p.a.Error("texture missing KTX identifier");var o=Uint32Array.BYTES_PER_ELEMENT,l=new DataView(this.data.buffer,this.data.byteOffset+12,13*o),h=l.getUint32(0,!0)===67305985;this.glType=l.getUint32(1*o,h),this.glTypeSize=l.getUint32(2*o,h),this.glFormat=l.getUint32(3*o,h),this.glInternalFormat=l.getUint32(4*o,h),this.glBaseInternalFormat=l.getUint32(5*o,h),this.pixelWidth=l.getUint32(6*o,h),this.pixelHeight=l.getUint32(7*o,h),this.pixelDepth=l.getUint32(8*o,h),this.numberOfArrayElements=l.getUint32(9*o,h),this.numberOfFaces=l.getUint32(10*o,h),this.numberOfMipmapLevels=l.getUint32(11*o,h),this.bytesOfKeyValueData=l.getUint32(12*o,h),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===e?this.loadType=i.COMPRESSED_2D:p.a.Error("number of faces expected"+e+", but found "+this.numberOfFaces):p.a.Error("texture arrays not currently supported"):p.a.Error("only 2D textures currently supported")):p.a.Error("only compressed formats currently supported")}return i.prototype.uploadLevels=function(t,e){switch(this.loadType){case i.COMPRESSED_2D:this._upload2DCompressedLevels(t,e);break}},i.prototype._upload2DCompressedLevels=function(t,e){for(var n=i.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight,l=e?this.numberOfMipmapLevels:1,h=0;h<l;h++){var v=new Int32Array(this.data.buffer,this.data.byteOffset+n,1)[0];n+=4;for(var b=0;b<this.numberOfFaces;b++){var A=new Uint8Array(this.data.buffer,this.data.byteOffset+n,v);t.getEngine()._uploadCompressedDataToTextureDirectly(t,this.glInternalFormat,r,o,A,b,h),n+=v,n+=3-(v+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===49&&e[6]===49&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.HEADER_LEN=64,i.COMPRESSED_2D=0,i.COMPRESSED_3D=1,i.TEX_2D=2,i.TEX_3D=3,i}(),Wp=function(){function i(t){this._pendingActions=new Array,this._workerInfos=t.map(function(e){return{worker:e,active:!1}})}return i.prototype.dispose=function(){for(var t=0,e=this._workerInfos;t<e.length;t++)e[t].worker.terminate();this._workerInfos=[],this._pendingActions=[]},i.prototype.push=function(t){for(var e=0,n=this._workerInfos;e<n.length;e++){var r=n[e];if(!r.active)return void this._execute(r,t)}this._pendingActions.push(t)},i.prototype._execute=function(t,e){var n=this;t.active=!0,e(t.worker,function(){t.active=!1;var r=n._pendingActions.shift();r&&n._execute(t,r)})},i}(),Hp=function(){function i(t,e){e===void 0&&(e=i.DefaultNumWorkers),this._engine=t,i._Initialized||i._CreateWorkerPool(e)}return i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},i._CreateWorkerPool=function(t){this._Initialized=!0,t&&typeof Worker=="function"?i._WorkerPoolPromise=new Promise(function(e){for(var n="("+fD+")()",r=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),o=new Array(t),l=0;l<o.length;l++)o[l]=new Promise(function(h,v){var b=new Worker(r),A=function(N){b.removeEventListener("error",A),b.removeEventListener("message",D),v(N)},D=function(N){N.data.action==="init"&&(b.removeEventListener("error",A),b.removeEventListener("message",D),h(b))};b.addEventListener("error",A),b.addEventListener("message",D),b.postMessage({action:"init",urls:i.URLConfig})});Promise.all(o).then(function(h){e(new Wp(h))})}):(KTX2DECODER.MSCTranscoder.UseFromWorkerThread=!1,KTX2DECODER.WASMMemoryManager.LoadBinariesFromCurrentThread=!0)},i.prototype.uploadAsync=function(t,e,n){var r=this,o=this._engine.getCaps(),l={astc:!!o.astc,bptc:!!o.bptc,s3tc:!!o.s3tc,pvrtc:!!o.pvrtc,etc2:!!o.etc2,etc1:!!o.etc1};return i._WorkerPoolPromise?i._WorkerPoolPromise.then(function(h){return new Promise(function(v,b){h.push(function(A,D){var N=function(k){A.removeEventListener("error",N),A.removeEventListener("message",j),b(k),D()},j=function(k){if(k.data.action==="decoded"){if(A.removeEventListener("error",N),A.removeEventListener("message",j),k.data.success)try{r._createTexture(k.data.decodedData,e,n),v()}catch(H){b({message:H})}else b({message:k.data.msg});D()}};A.addEventListener("error",N),A.addEventListener("message",j),A.postMessage({action:"decode",data:t,caps:l,options:n})})})}):new Promise(function(h,v){i._Ktx2Decoder||(i._Ktx2Decoder=new KTX2DECODER.KTX2Decoder),i._Ktx2Decoder.decode(t,o).then(function(b){r._createTexture(b,e),h()}).catch(function(b){v({message:b})})})},i.prototype.dispose=function(){i._WorkerPoolPromise&&i._WorkerPoolPromise.then(function(t){t.dispose()}),delete i._WorkerPoolPromise},i.prototype._createTexture=function(t,e,n){if(this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,e),n&&(n.transcodedFormat=t.transcodedFormat,n.isInGammaSpace=t.isInGammaSpace,n.transcoderName=t.transcoderName),t.transcodedFormat===32856?(e.type=g.a.TEXTURETYPE_UNSIGNED_BYTE,e.format=g.a.TEXTUREFORMAT_RGBA):e.format=t.transcodedFormat,e._gammaSpace=t.isInGammaSpace,t.errors)throw new Error("KTX2 container - could not transcode the data. "+t.errors);for(var r=0;r<t.mipmaps.length;++r){var o=t.mipmaps[r];if(!o||!o.data)throw new Error("KTX2 container - could not transcode one of the image");t.transcodedFormat===32856?(e.width=o.width,e.height=o.height,this._engine._uploadDataToTextureDirectly(e,o.data,0,r,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(e,t.transcodedFormat,o.width,o.height,o.data,0,r)}e.width=t.mipmaps[0].width,e.height=t.mipmaps[0].height,e.generateMipMaps=t.mipmaps.length>1,e.isReady=!0,this._engine._bindTextureDirectly(this._engine._gl.TEXTURE_2D,null)},i.IsValid=function(t){if(t.byteLength>=12){var e=new Uint8Array(t.buffer,t.byteOffset,12);if(e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10)return!0}return!1},i.URLConfig={jsDecoderModule:"https://preview.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,jsMSCTranscoder:null,wasmMSCTranscoder:null},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i}();function fD(){var i;onmessage=function(t){switch(t.data.action){case"init":var e=t.data.urls;importScripts(e.jsDecoderModule),e.wasmUASTCToASTC!==null&&(KTX2DECODER.LiteTranscoder_UASTC_ASTC.WasmModuleURL=e.wasmUASTCToASTC),e.wasmUASTCToBC7!==null&&(KTX2DECODER.LiteTranscoder_UASTC_BC7.WasmModuleURL=e.wasmUASTCToBC7),e.wasmUASTCToRGBA_UNORM!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=e.wasmUASTCToRGBA_UNORM),e.wasmUASTCToRGBA_SRGB!==null&&(KTX2DECODER.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=e.wasmUASTCToRGBA_SRGB),e.jsMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.JSModuleURL=e.jsMSCTranscoder),e.wasmMSCTranscoder!==null&&(KTX2DECODER.MSCTranscoder.WasmModuleURL=e.wasmMSCTranscoder),i=new KTX2DECODER.KTX2Decoder,postMessage({action:"init"});break;case"decode":i.decode(t.data.data,t.data.caps,t.data.options).then(function(n){for(var r=[],o=0;o<n.mipmaps.length;++o){var l=n.mipmaps[o];l&&l.data&&r.push(l.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:n},r)}).catch(function(n){postMessage({action:"decoded",success:!1,msg:n})})}}}var jy=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t,e){return Jr.a.EndsWith(t,".ktx")||Jr.a.EndsWith(t,".ktx2")||e==="image/ktx"||e==="image/ktx2"},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){e._invertVScale=!e.invertY;var l=e.getEngine(),h=new hh(t,6),v=h.numberOfMipmapLevels>1&&e.generateMipMaps;l._unpackFlipY(!0),h.uploadLevels(e,e.generateMipMaps),e.width=h.pixelWidth,e.height=h.pixelHeight,l._setCubeMapTextureParams(e,v),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}},i.prototype.loadData=function(t,e,n,r){if(hh.IsValid(t)){e._invertVScale=!e.invertY;var o=new hh(t,1);n(o.pixelWidth,o.pixelHeight,e.generateMipMaps,!0,function(){o.uploadLevels(e,e.generateMipMaps)},o.isInvalid)}else Hp.IsValid(t)?new Hp(e.getEngine()).uploadAsync(t,e,r).then(function(){n(e.width,e.height,e.generateMipMaps,!0,function(){},!1)},function(l){p.a.Warn("Failed to load KTX2 texture data: "+l.message),n(0,0,!1,!1,function(){},!0)}):(p.a.Error("texture missing KTX identifier"),n(0,0,!1,!1,function(){},!0))},i}();Xe.a._TextureLoaders.unshift(new jy);var zy=function(i){function t(e,n,r){var o=i.call(this,e,d.e.Zero(),n)||this;return o._xrSessionManager=r,o._firstFrame=!1,o._referenceQuaternion=d.b.Identity(),o._referencedPosition=new d.e,o._xrInvPositionCache=new d.e,o._xrInvQuaternionCache=d.b.Identity(),o._trackingState=Sa.NOT_TRACKING,o.onBeforeCameraTeleport=new E.c,o.onAfterCameraTeleport=new E.c,o.onTrackingStateChanged=new E.c,o.compensateOnFirstFrame=!0,o._rotate180=new d.b(0,1,0,0),o.minZ=.1,o.rotationQuaternion=new d.b,o.cameraRigMode=Tt.a.RIG_MODE_CUSTOM,o.updateUpVectorFromRotation=!0,o._updateNumberOfRigCameras(1),o.freezeProjectionMatrix(),o._xrSessionManager.onXRSessionInit.add(function(){o._referencedPosition.copyFromFloats(0,0,0),o._referenceQuaternion.copyFromFloats(0,0,0,1),o._firstFrame=o.compensateOnFirstFrame}),o._xrSessionManager.onXRFrameObservable.add(function(l){o._firstFrame&&o._updateFromXRSession(),o._updateReferenceSpace(),o._updateFromXRSession()},void 0,!0),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"trackingState",{get:function(){return this._trackingState},enumerable:!1,configurable:!0}),t.prototype._setTrackingState=function(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))},Object.defineProperty(t.prototype,"realWorldHeight",{get:function(){var e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y:0},enumerable:!1,configurable:!0}),t.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new $r.a(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new $r.a(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},t.prototype.setTransformationFromNonVRCamera=function(e,n){e===void 0&&(e=this.getScene().activeCamera),n===void 0&&(n=!0),e&&e!==this&&(e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,d.b.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,n&&this._xrSessionManager.resetReferenceSpace())},t.prototype.getClassName=function(){return"WebXRCamera"},t.prototype._updateFromXRSession=function(){var e=this,n=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(n){var r=n.emulatedPosition?Sa.TRACKING_LOST:Sa.TRACKING;if(this._setTrackingState(r),n.transform){var o=n.transform.position;this._referencedPosition.set(o.x,o.y,o.z);var l=n.transform.orientation;this._referenceQuaternion.set(l.x,l.y,l.z,l.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==n.views.length&&this._updateNumberOfRigCameras(n.views.length),n.views.forEach(function(h,v){var b=e.rigCameras[v];b.isLeftCamera||b.isRightCamera||(h.eye==="right"?b._isRightCamera=!0:h.eye==="left"&&(b._isLeftCamera=!0));var A=h.transform.position,D=h.transform.orientation;if(b.position.set(A.x,A.y,A.z),b.rotationQuaternion.set(D.x,D.y,D.z,D.w),e._scene.useRightHandedSystem?b.rotationQuaternion.multiplyInPlace(e._rotate180):(b.position.z*=-1,b.rotationQuaternion.z*=-1,b.rotationQuaternion.w*=-1),d.a.FromFloat32ArrayToRefScaled(h.projectionMatrix,0,1,b._projectionMatrix),e._scene.useRightHandedSystem||b._projectionMatrix.toggleProjectionMatrixHandInPlace(),v===0&&e._projectionMatrix.copyFrom(b._projectionMatrix),e._xrSessionManager.session.renderState.baseLayer){var N=e._xrSessionManager.session.renderState.baseLayer.getViewport(h),j=e._xrSessionManager.session.renderState.baseLayer.framebufferWidth,k=e._xrSessionManager.session.renderState.baseLayer.framebufferHeight;b.viewport.width=N.width/j,b.viewport.height=N.height/k,b.viewport.x=N.x/j,b.viewport.y=N.y/k}b.outputRenderTarget=e._xrSessionManager.getRenderTargetTextureForEye(h.eye)})}else this._setTrackingState(Sa.NOT_TRACKING)},t.prototype._updateNumberOfRigCameras=function(e){for(e===void 0&&(e=1);this.rigCameras.length<e;){var n=new Zr("XR-RigCamera: "+this.rigCameras.length,d.e.Zero(),this.getScene());n.minZ=.1,n.rotationQuaternion=new d.b,n.updateUpVectorFromRotation=!0,n.isRigCamera=!0,n.rigParent=this,n.freezeProjectionMatrix(),this.rigCameras.push(n)}for(;this.rigCameras.length>e;){var r=this.rigCameras.pop();r&&r.dispose()}},t.prototype._updateReferenceSpace=function(){this.position.equals(this._referencedPosition)&&this.rotationQuaternion.equals(this._referenceQuaternion)||(this.position.subtractToRef(this._referencedPosition,this._referencedPosition),this._referenceQuaternion.conjugateInPlace(),this._referenceQuaternion.multiplyToRef(this.rotationQuaternion,this._referenceQuaternion),this._updateReferenceSpaceOffset(this._referencedPosition,this._referenceQuaternion.normalize()))},t.prototype._updateReferenceSpaceOffset=function(e,n,r){if(r===void 0&&(r=!1),this._xrSessionManager.referenceSpace&&this._xrSessionManager.currentFrame){this._xrInvPositionCache.copyFrom(e),n?this._xrInvQuaternionCache.copyFrom(n):this._xrInvQuaternionCache.copyFromFloats(0,0,0,1),this._scene.useRightHandedSystem||(this._xrInvPositionCache.z*=-1,this._xrInvQuaternionCache.z*=-1,this._xrInvQuaternionCache.w*=-1),this._xrInvPositionCache.negateInPlace(),this._xrInvQuaternionCache.conjugateInPlace(),this._xrInvPositionCache.rotateByQuaternionToRef(this._xrInvQuaternionCache,this._xrInvPositionCache),r&&(this._xrInvPositionCache.y=0);var o=new XRRigidTransform({x:this._xrInvPositionCache.x,y:this._xrInvPositionCache.y,z:this._xrInvPositionCache.z},{x:this._xrInvQuaternionCache.x,y:this._xrInvQuaternionCache.y,z:this._xrInvQuaternionCache.z,w:this._xrInvQuaternionCache.w}),l=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(o),h=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(l);if(h){var v=new d.e(h.transform.position.x,h.transform.position.y,h.transform.position.z);this._scene.useRightHandedSystem||(v.z*=-1),this.position.subtractToRef(v,v),this._scene.useRightHandedSystem||(v.z*=-1),v.negateInPlace();var b=new XRRigidTransform({x:v.x,y:v.y,z:v.z});this._xrSessionManager.referenceSpace=l.getOffsetReferenceSpace(b)}}},t}(dr),fi=function(){function i(){}return i.ANCHOR_SYSTEM="xr-anchor-system",i.BACKGROUND_REMOVER="xr-background-remover",i.HIT_TEST="xr-hit-test",i.PHYSICS_CONTROLLERS="xr-physics-controller",i.PLANE_DETECTION="xr-plane-detection",i.POINTER_SELECTION="xr-controller-pointer-selection",i.TELEPORTATION="xr-controller-teleportation",i.FEATURE_POINTS="xr-feature-points",i.HAND_TRACKING="xr-hand-tracking",i}(),ei=function(){function i(t){var e=this;this._xrSessionManager=t,this._features={},this._xrSessionManager.onXRSessionInit.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];!r.enabled||r.featureImplementation.attached||r.featureImplementation.disableAutoAttach||e.attachFeature(n)})}),this._xrSessionManager.onXRSessionEnded.add(function(){e.getEnabledFeatures().forEach(function(n){var r=e._features[n];r.enabled&&r.featureImplementation.attached&&e.detachFeature(n)})})}return i.AddWebXRFeature=function(t,e,n,r){n===void 0&&(n=1),r===void 0&&(r=!1),this._AvailableFeatures[t]=this._AvailableFeatures[t]||{latest:n},n>this._AvailableFeatures[t].latest&&(this._AvailableFeatures[t].latest=n),r&&(this._AvailableFeatures[t].stable=n),this._AvailableFeatures[t][n]=e},i.ConstructFeature=function(t,e,n,r){e===void 0&&(e=1);var o=this._AvailableFeatures[t][e];if(!o)throw new Error("feature not found");return o(n,r)},i.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},i.GetAvailableVersions=function(t){return Object.keys(this._AvailableFeatures[t])},i.GetLatestVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].latest||-1},i.GetStableVersionOfFeature=function(t){return this._AvailableFeatures[t]&&this._AvailableFeatures[t].stable||-1},i.prototype.attachFeature=function(t){var e=this._features[t];e&&e.enabled&&!e.featureImplementation.attached&&e.featureImplementation.attach()},i.prototype.detachFeature=function(t){var e=this._features[t];e&&e.featureImplementation.attached&&e.featureImplementation.detach()},i.prototype.disableFeature=function(t){var e=typeof t=="string"?t:t.Name,n=this._features[e];return!(!n||!n.enabled)&&(n.enabled=!1,this.detachFeature(e),n.featureImplementation.dispose(),!0)},i.prototype.dispose=function(){var t=this;this.getEnabledFeatures().forEach(function(e){t.disableFeature(e),t._features[e].featureImplementation.dispose()})},i.prototype.enableFeature=function(t,e,n,r,o){var l=this;e===void 0&&(e="latest"),n===void 0&&(n={}),r===void 0&&(r=!0),o===void 0&&(o=!0);var h=typeof t=="string"?t:t.Name,v=0;if(typeof e=="string"){if(!e)throw new Error("Error in provided version - "+h+" ("+e+")");if((v=e==="stable"?i.GetStableVersionOfFeature(h):e==="latest"?i.GetLatestVersionOfFeature(h):+e)===-1||isNaN(v))throw new Error("feature not found - "+h+" ("+e+")")}else v=e;var b=this._features[h],A=i.ConstructFeature(h,v,this._xrSessionManager,n);if(!A)throw new Error("feature not found - "+h);b&&this.disableFeature(h);var D=A();if(D.dependsOn&&!D.dependsOn.every(function(N){return!!l._features[N]}))throw new Error("Dependant features missing. Make sure the following features are enabled - "+D.dependsOn.join(", "));if(D.isCompatible())return this._features[h]={featureImplementation:D,enabled:!0,version:v,required:o},r?this._xrSessionManager.session&&!this._features[h].featureImplementation.attached&&this.attachFeature(h):this._features[h].featureImplementation.disableAutoAttach=!0,this._features[h].featureImplementation;if(o)throw new Error("required feature not compatible");return Qe.b.Warn("Feature "+h+" not compatible with the current environment/browser and was not enabled."),D},i.prototype.getEnabledFeature=function(t){return this._features[t]&&this._features[t].featureImplementation},i.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},i.prototype.extendXRSessionInitObject=function(t){var e=this;return this.getEnabledFeatures().forEach(function(n){var r=e._features[n],o=r.featureImplementation.xrNativeFeatureName;o&&(r.required?(t.requiredFeatures=t.requiredFeatures||[],t.requiredFeatures.indexOf(o)===-1&&t.requiredFeatures.push(o)):(t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.indexOf(o)===-1&&t.optionalFeatures.push(o)))}),t},i._AvailableFeatures={},i}(),Gy=function(){function i(t){var e=this;this.scene=t,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.onInitialXRPoseSetObservable=new E.c,this.onStateChangedObservable=new E.c,this.state=zn.NOT_IN_XR,this.sessionManager=new Ep(t),this.camera=new zy("",t,this.sessionManager),this.featuresManager=new ei(this.sessionManager),t.onDisposeObservable.add(function(){e.exitXRAsync()})}return i.CreateAsync=function(t){var e=new i(t);return e.sessionManager.initializeAsync().then(function(){return e._supported=!0,e}).catch(function(n){throw e._setState(zn.NOT_IN_XR),e.dispose(),n})},i.prototype.dispose=function(){this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),this._nonVRCamera&&(this.scene.activeCamera=this._nonVRCamera)},i.prototype.enterXRAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=this.sessionManager.getWebXRRenderTarget()),r===void 0&&(r={}),!this._supported)throw"WebXR not supported in this browser or environment";return this._setState(zn.ENTERING_XR),e!=="viewer"&&e!=="local"&&(r.optionalFeatures=r.optionalFeatures||[],r.optionalFeatures.push(e)),this.featuresManager.extendXRSessionInitObject(r),t==="immersive-ar"&&e!=="unbounded"&&p.a.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode"),this.sessionManager.initializeSessionAsync(t,r).then(function(){return o.sessionManager.setReferenceSpaceTypeAsync(e)}).then(function(){return n.initializeXRLayerAsync(o.sessionManager.session)}).then(function(){return o.sessionManager.updateRenderStateAsync({depthFar:o.camera.maxZ,depthNear:o.camera.minZ,baseLayer:n.xrLayer})}).then(function(){return o.sessionManager.runXRRenderLoop(),o._originalSceneAutoClear=o.scene.autoClear,o._nonVRCamera=o.scene.activeCamera,o.scene.activeCamera=o.camera,t!=="immersive-ar"?o._nonXRToXRCamera():(o.scene.autoClear=!1,o.camera.compensateOnFirstFrame=!1),o.sessionManager.onXRSessionEnded.addOnce(function(){o.camera.rigCameras.forEach(function(l){l.outputRenderTarget=null}),o.scene.autoClear=o._originalSceneAutoClear,o.scene.activeCamera=o._nonVRCamera,t!=="immersive-ar"&&o.camera.compensateOnFirstFrame&&(o._nonVRCamera.setPosition?o._nonVRCamera.setPosition(o.camera.position):o._nonVRCamera.position.copyFrom(o.camera.position)),o._setState(zn.NOT_IN_XR)}),o.sessionManager.onXRFrameObservable.addOnce(function(){o._setState(zn.IN_XR)}),o.sessionManager}).catch(function(l){throw console.log(l),console.log(l.message),o._setState(zn.NOT_IN_XR),l})},i.prototype.exitXRAsync=function(){return this.state!==zn.IN_XR?Promise.resolve():(this._setState(zn.EXITING_XR),this.sessionManager.exitXRAsync())},i.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},i.prototype._setState=function(t){this.state!==t&&(this.state=t,this.onStateChangedObservable.notifyObservers(this.state))},i}(),bs=function(){function i(t,e,n,r){n===void 0&&(n=-1),r===void 0&&(r=[]),this.id=t,this.type=e,this._buttonIndex=n,this._axesIndices=r,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new E.c,this.onButtonStateChangedObservable=new E.c}return Object.defineProperty(i.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pressed",{get:function(){return this._pressed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"touched",{get:function(){return this._touched},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},i.prototype.isAxes=function(){return this._axesIndices.length!==0},i.prototype.isButton=function(){return this._buttonIndex!==-1},i.prototype.update=function(t){var e=!1,n=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var r=t.buttons[this._buttonIndex];if(!r)return;this._currentValue!==r.value&&(this.changes.value={current:r.value,previous:this._currentValue},e=!0,this._currentValue=r.value),this._touched!==r.touched&&(this.changes.touched={current:r.touched,previous:this._touched},e=!0,this._touched=r.touched),this._pressed!==r.pressed&&(this.changes.pressed={current:r.pressed,previous:this._pressed},e=!0,this._pressed=r.pressed)}this.isAxes()&&(this._axes.x!==t.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:t.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=t.axes[this._axesIndices[0]],n=!0),this._axes.y!==t.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=t.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:t.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=t.axes[this._axesIndices[1]],n=!0)),e&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),n&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},i.BUTTON_TYPE="button",i.SQUEEZE_TYPE="squeeze",i.THUMBSTICK_TYPE="thumbstick",i.TOUCHPAD_TYPE="touchpad",i.TRIGGER_TYPE="trigger",i}(),ys=function(){function i(t,e,n,r,o){var l=this;this.scene=t,this.layout=e,this.gamepadObject=n,this.handedness=r,this._initComponent=function(h){if(h){var v=l.layout.components[h],b=v.type,A=v.gamepadIndices.button,D=[];v.gamepadIndices.xAxis!==void 0&&v.gamepadIndices.yAxis!==void 0&&D.push(v.gamepadIndices.xAxis,v.gamepadIndices.yAxis),l.components[h]=new bs(h,b,A,D)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new E.c,e.components&&Object.keys(e.components).forEach(this._initComponent)}return i.prototype.dispose=function(){var t=this;this.getComponentIds().forEach(function(e){return t.getComponent(e).dispose()}),this.rootMesh&&this.rootMesh.dispose()},i.prototype.getAllComponentsOfType=function(t){var e=this;return this.getComponentIds().map(function(n){return e.components[n]}).filter(function(n){return n.type===t})},i.prototype.getComponent=function(t){return this.components[t]},i.prototype.getComponentIds=function(){return Object.keys(this.components)},i.prototype.getComponentOfType=function(t){return this.getAllComponentsOfType(t)[0]||null},i.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},i.prototype.loadModel=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(_.e)(this,function(r){return t=!this._getModelLoadingConstraints(),e=this._getGenericFilenameAndPath(),t?p.a.Warn("Falling back to generic models"):e=this._getFilenameAndPath(),[2,new Promise(function(o,l){Zt.ImportMesh("",e.path,e.filename,n.scene,function(h){t?n._getGenericParentMesh(h):n._setRootMesh(h),n._processLoadedModel(h),n._modelReady=!0,n.onModelLoadedObservable.notifyObservers(n),o(!0)},null,function(h,v){p.a.Log(v),p.a.Warn("Failed to retrieve controller model of type "+n.profileId+" from the remote server: "+e.path+e.filename),l(v)})})]})})},i.prototype.updateFromXRFrame=function(t){var e=this;this.getComponentIds().forEach(function(n){return e.getComponent(n).update(e.gamepadObject)}),this.updateModel(t)},Object.defineProperty(i.prototype,"handness",{get:function(){return this.handedness},enumerable:!1,configurable:!0}),i.prototype.pulse=function(t,e,n){return n===void 0&&(n=0),this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[n]?this.gamepadObject.hapticActuators[n].pulse(t,e):Promise.resolve(!1)},i.prototype._getChildByName=function(t,e){return t.getChildren(function(n){return n.name===e},!1)[0]},i.prototype._getImmediateChildByName=function(t,e){return t.getChildren(function(n){return n.name==e},!0)[0]},i.prototype._lerpTransform=function(t,e,n){if(t.minMesh&&t.maxMesh&&t.valueMesh&&t.minMesh.rotationQuaternion&&t.maxMesh.rotationQuaternion&&t.valueMesh.rotationQuaternion){var r=n?.5*e+.5:e;d.b.SlerpToRef(t.minMesh.rotationQuaternion,t.maxMesh.rotationQuaternion,r,t.valueMesh.rotationQuaternion),d.e.LerpToRef(t.minMesh.position,t.maxMesh.position,r,t.valueMesh.position)}},i.prototype.updateModel=function(t){this._modelReady&&this._updateModel(t)},i.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},i.prototype._getGenericParentMesh=function(t){var e=this;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),t.forEach(function(n){n.parent||(n.isPickable=!1,n.setParent(e.rootMesh))}),this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)},i}(),Xp=function(i){function t(e,n,r){var o=i.call(this,e,pD[r],n,r)||this;return o.profileId=t.ProfileId,o}return Object(_.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){},t.prototype._setRootMesh=function(e){var n=this;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(r){r.isPickable=!1,r.parent||r.setParent(n.rootMesh)}),this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.ProfileId="generic-trigger",t}(ys),pD={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}},Wy=function(i){function t(e,n,r,o){var l=i.call(this,e,r.layouts[n.handedness||"none"],n.gamepad,n.handedness)||this;return l._repositoryUrl=o,l._buttonMeshMapping={},l._touchDots={},l.profileId=r.profileId,l}return Object(_.d)(t,i),t.prototype.dispose=function(){var e=this;i.prototype.dispose.call(this),Object.keys(this._touchDots).forEach(function(n){e._touchDots[n].dispose()})},t.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:this._repositoryUrl+"/profiles/"+this.profileId+"/"}},t.prototype._getModelLoadingConstraints=function(){var e=Zt.IsPluginForExtensionAvailable(".glb");return e||p.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=n.layout.components[r];n._buttonMeshMapping[r]={mainMesh:n._getChildByName(n.rootMesh,o.rootNodeName),states:{}},Object.keys(o.visualResponses).forEach(function(l){var h=o.visualResponses[l];if(h.valueNodeProperty==="transform")n._buttonMeshMapping[r].states[l]={valueMesh:n._getChildByName(n.rootMesh,h.valueNodeName),minMesh:n._getChildByName(n.rootMesh,h.minNodeName),maxMesh:n._getChildByName(n.rootMesh,h.maxNodeName)};else{var v=o.type===bs.TOUCHPAD_TYPE&&o.touchPointNodeName?o.touchPointNodeName:h.valueNodeName;if(n._buttonMeshMapping[r].states[l]={valueMesh:n._getChildByName(n.rootMesh,v)},o.type===bs.TOUCHPAD_TYPE&&!n._touchDots[l]){var b=Mr.a.CreateSphere(l+"dot",{diameter:.0015,segments:8},n.scene);b.material=new Qt.a(l+"mat",n.scene),b.material.diffuseColor=x.a.Red(),b.parent=n._buttonMeshMapping[r].states[l].valueMesh||null,b.isVisible=!1,n._touchDots[l]=b}}})})},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Ne.a(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(Se.a.Y,Math.PI,Se.c.WORLD)},t.prototype._updateModel=function(e){var n=this;this.disableAnimation||this.getComponentIds().forEach(function(r){var o=n.getComponent(r);if(o.hasChanges){var l=n._buttonMeshMapping[r],h=n.layout.components[r];Object.keys(h.visualResponses).forEach(function(v){var b=h.visualResponses[v],A=o.value;if(b.componentProperty==="xAxis"?A=o.axes.x:b.componentProperty==="yAxis"&&(A=o.axes.y),b.valueNodeProperty==="transform")n._lerpTransform(l.states[v],A,b.componentProperty!=="button");else{var D=l.states[v].valueMesh;D&&(D.isVisible=o.touched||o.pressed),n._touchDots[v]&&(n._touchDots[v].isVisible=o.touched||o.pressed)}})}})},t}(ys),Ir=function(){function i(){}return i.ClearProfilesCache=function(){this._ProfilesList=null,this._ProfileLoadingPromises={}},i.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"])},i.FindFallbackWithProfileId=function(t){var e=this._Fallbacks[t]||[];return e.unshift(t),e},i.GetMotionControllerWithXRInput=function(t,e,n){var r=this,o=[];if(n&&o.push(n),o.push.apply(o,t.profiles||[]),o.length&&!o[0]&&o.pop(),t.gamepad&&t.gamepad.id)switch(t.gamepad.id){case(t.gamepad.id.match(/oculus touch/gi)?t.gamepad.id:void 0):o.push("oculus-touch-v2")}var l=o.indexOf("windows-mixed-reality");if(l!==-1&&o.splice(l,0,"microsoft-mixed-reality"),o.length||o.push("generic-trigger"),this.UseOnlineRepository){var h=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,v=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return h.call(this,o,t,e).catch(function(){return v.call(r,o,t,e)})}return this._LoadProfilesFromAvailableControllers(o,t,e)},i.RegisterController=function(t,e){this._AvailableControllers[t]=e},i.RegisterFallbacksForProfileId=function(t,e){var n;this._Fallbacks[t]?(n=this._Fallbacks[t]).push.apply(n,e):this._Fallbacks[t]=e},i.UpdateProfilesList=function(){return this._ProfilesList=Qe.b.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then(function(t){return JSON.parse(t.toString())}),this._ProfilesList},i._LoadProfileFromRepository=function(t,e,n){var r=this;return Promise.resolve().then(function(){return r._ProfilesList?r._ProfilesList:r.UpdateProfilesList()}).then(function(o){for(var l=0;l<t.length;++l)if(t[l]&&o[t[l]])return t[l];throw new Error("neither controller "+t[0]+" nor all fallbacks were found in the repository,")}).then(function(o){return r._ProfileLoadingPromises[o]||(r._ProfileLoadingPromises[o]=Qe.b.LoadFileAsync(r.BaseRepositoryUrl+"/profiles/"+o+"/profile.json",!1).then(function(l){return JSON.parse(l)})),r._ProfileLoadingPromises[o]}).then(function(o){return new Wy(n,e,o,r.BaseRepositoryUrl)})},i._LoadProfilesFromAvailableControllers=function(t,e,n){for(var r=0;r<t.length;++r)if(t[r])for(var o=this.FindFallbackWithProfileId(t[r]),l=0;l<o.length;++l){var h=this._AvailableControllers[o[l]];if(h)return Promise.resolve(h(e,n))}throw new Error("no controller requested was found in the available controllers list")},i._AvailableControllers={},i._Fallbacks={},i._ProfileLoadingPromises={},i.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",i.PrioritizeOnlineRepository=!0,i.UseOnlineRepository=!0,i}();Ir.RegisterController(Xp.ProfileId,function(i,t){return new Xp(t,i.gamepad,i.handedness)}),Ir.DefaultFallbacks();var mD=0,Hy=function(){function i(t,e,n){var r=this;n===void 0&&(n={}),this._scene=t,this.inputSource=e,this._options=n,this._tmpVector=new d.e,this._disposed=!1,this.onDisposeObservable=new E.c,this.onMeshLoadedObservable=new E.c,this.onMotionControllerInitObservable=new E.c,this._uniqueId="controller-"+mD+++"-"+e.targetRayMode+"-"+e.handedness,this.pointer=new Lt.a(this._uniqueId+"-pointer",t),this.pointer.rotationQuaternion=new d.b,this.inputSource.gripSpace&&(this.grip=new Lt.a(this._uniqueId+"-grip",this._scene),this.grip.rotationQuaternion=new d.b),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&Ir.GetMotionControllerWithXRInput(e,t,this._options.forceControllerProfile).then(function(o){r.motionController=o,r.onMotionControllerInitObservable.notifyObservers(o),r._options.doNotLoadControllerMesh||r.motionController.loadModel().then(function(l){var h;l&&r.motionController&&r.motionController.rootMesh&&(r._options.renderingGroupId&&(r.motionController.rootMesh.renderingGroupId=r._options.renderingGroupId,r.motionController.rootMesh.getChildMeshes(!1).forEach(function(v){return v.renderingGroupId=r._options.renderingGroupId})),r.onMeshLoadedObservable.notifyObservers(r.motionController.rootMesh),r.motionController.rootMesh.parent=r.grip||r.pointer,r.motionController.disableAnimation=!!r._options.disableMotionControllerAnimation),r._disposed&&((h=r.motionController)===null||h===void 0||h.dispose())})},function(){Qe.b.Warn("Could not find a matching motion controller for the registered input source")})}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.motionController&&this.motionController.dispose(),this.pointer.dispose(),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0},i.prototype.getWorldPointerRayToRef=function(t,e){e===void 0&&(e=!1);var n=e&&this.grip?this.grip:this.pointer;d.e.TransformNormalToRef(this._tmpVector,n.getWorldMatrix(),t.direction),t.direction.normalize(),t.origin.copyFrom(n.absolutePosition),t.length=1e3},i.prototype.updateFromXRFrame=function(t,e){var n=t.getPose(this.inputSource.targetRaySpace,e);if(n){var r=n.transform.position;this.pointer.position.set(r.x,r.y,r.z);var o=n.transform.orientation;this.pointer.rotationQuaternion.set(o.x,o.y,o.z,o.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1)}if(this.inputSource.gripSpace&&this.grip){var l=t.getPose(this.inputSource.gripSpace,e);if(l){r=l.transform.position;var h=l.transform.orientation;this.grip.position.set(r.x,r.y,r.z),this.grip.rotationQuaternion.set(h.x,h.y,h.z,h.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}}this.motionController&&this.motionController.updateFromXRFrame(t)},i}(),Xy=function(){function i(t,e,n){var r=this;if(n===void 0&&(n={}),this.xrSessionManager=t,this.xrCamera=e,this.options=n,this.controllers=[],this.onControllerAddedObservable=new E.c,this.onControllerRemovedObservable=new E.c,this._onInputSourcesChange=function(o){r._addAndRemoveControllers(o.added,o.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add(function(){r._addAndRemoveControllers([],r.controllers.map(function(o){return o.inputSource}))}),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add(function(o){o.addEventListener("inputsourceschange",r._onInputSourcesChange)}),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add(function(o){r.controllers.forEach(function(l){l.updateFromXRFrame(o,r.xrSessionManager.referenceSpace)})}),this.options.customControllersRepositoryURL&&(Ir.BaseRepositoryUrl=this.options.customControllersRepositoryURL),Ir.UseOnlineRepository=!this.options.disableOnlineControllerRepository,Ir.UseOnlineRepository)try{Ir.UpdateProfilesList().catch(function(){Ir.UseOnlineRepository=!1})}catch(o){Ir.UseOnlineRepository=!1}}return i.prototype._addAndRemoveControllers=function(t,e){for(var n=this,r=this.controllers.map(function(D){return D.inputSource}),o=0,l=t;o<l.length;o++){var h=l[o];if(r.indexOf(h)===-1){var v=new Hy(this.xrSessionManager.scene,h,Object(_.a)(Object(_.a)({},this.options.controllerOptions||{}),{forceControllerProfile:this.options.forceInputProfile,doNotLoadControllerMesh:this.options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this.options.disableControllerAnimation}));this.controllers.push(v),this.onControllerAddedObservable.notifyObservers(v)}}var b=[],A=[];this.controllers.forEach(function(D){e.indexOf(D.inputSource)===-1?b.push(D):A.push(D)}),this.controllers=b,A.forEach(function(D){n.onControllerRemovedObservable.notifyObservers(D),D.dispose()})},i.prototype.dispose=function(){this.controllers.forEach(function(t){t.dispose()}),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear()},i}(),pi=function(){function i(t){this._xrSessionManager=t,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this.xrNativeFeatureName=""}return Object.defineProperty(i.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),i.prototype.attach=function(t){var e=this;if(this.isDisposed)return!1;if(t)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,function(n){return e._onXRFrame(n)}),!0},i.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach(function(t){t.observable.remove(t.observer)}),!0):(this.disableAutoAttach=!0,!1)},i.prototype.dispose=function(){this.detach(),this.isDisposed=!0},i.prototype.isCompatible=function(){return!0},i.prototype._addNewAttachObserver=function(t,e){this._removeOnDetach.push({observable:t,observer:t.add(e)})},i}(),nl=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId]){var l=r._generateNewMeshPair(o.pointer),h=l.laserPointer,v=l.selectionMesh;switch(r._controllers[o.uniqueId]={xrController:o,laserPointer:h,selectionMesh:v,meshUnderPointer:null,pick:null,tmpRay:new Bn.a(new d.e,new d.e),id:t._idCounter++},r._attachedController?!r._options.enablePointerSelectionOnAllControllers&&r._options.preferredHandedness&&o.inputSource.handedness===r._options.preferredHandedness&&(r._attachedController=o.uniqueId):r._options.enablePointerSelectionOnAllControllers||(r._attachedController=o.uniqueId),o.inputSource.targetRayMode){case"tracked-pointer":return r._attachTrackedPointerRayMode(o);case"gaze":return r._attachGazeMode(o);case"screen":return r._attachScreenRayMode(o)}}},r._controllers={},r._tmpVectorForPickCompare=new d.e,r.disablePointerLighting=!0,r.disableSelectionMeshLighting=!0,r.displayLaserPointer=!0,r.displaySelectionMesh=!0,r.laserPointerPickedColor=new x.a(.9,.9,.9),r.laserPointerDefaultColor=new x.a(.7,.7,.7),r.selectionMeshDefaultColor=new x.a(.8,.8,.8),r.selectionMeshPickedColor=new x.a(.3,.3,1),r._identityMatrix=d.a.Identity(),r._screenCoordinatesRef=d.e.Zero(),r._viewportRef=new $r.a(0,0,0,0),r._scene=r._xrSessionManager.scene,r}return Object(_.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(h){e._detachController(h.uniqueId)}),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){var n=this._options.gazeCamera,r=this._generateNewMeshPair(n),o=r.laserPointer,l=r.selectionMesh;this._controllers.camera={webXRCamera:n,laserPointer:o,selectionMesh:l,meshUnderPointer:null,pick:null,tmpRay:new Bn.a(new d.e,new d.e),id:t._idCounter++},this._attachGazeMode()}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),!0)},t.prototype.getMeshUnderPointer=function(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(e){for(var n=Object.keys(this._controllers),r=0;r<n.length;++r)if(this._controllers[n[r]].id===e)return this._controllers[n[r]].xrController||null;return null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._controllers).forEach(function(r){var o,l=n._controllers[r];if(!n._options.enablePointerSelectionOnAllControllers&&r!==n._attachedController)return l.selectionMesh.isVisible=!1,l.laserPointer.isVisible=!1,void(l.pick=null);if(l.laserPointer.isVisible=n.displayLaserPointer,l.xrController)o=l.xrController.pointer.position,l.xrController.getWorldPointerRayToRef(l.tmpRay);else{if(!l.webXRCamera)return;o=l.webXRCamera.position,l.webXRCamera.getForwardRayToRef(l.tmpRay)}if(n._options.maxPointerDistance&&(l.tmpRay.length=n._options.maxPointerDistance),!n._options.disableScenePointerVectorUpdate&&o){var h=n._xrSessionManager.scene,v=n._options.xrInput.xrCamera;v&&(v.viewport.toGlobalToRef(h.getEngine().getRenderWidth(),h.getEngine().getRenderHeight(),n._viewportRef),d.e.ProjectToRef(o,n._identityMatrix,h.getTransformMatrix(),n._viewportRef,n._screenCoordinatesRef),h.pointerX=n._screenCoordinatesRef.x,h.pointerY=n._screenCoordinatesRef.y)}l.pick=n._scene.pickWithRay(l.tmpRay,n._scene.pointerMovePredicate||n.raySelectionPredicate);var b=l.pick;if(b&&b.pickedPoint&&b.hit){n._updatePointerDistance(l.laserPointer,b.distance),l.selectionMesh.position.copyFrom(b.pickedPoint),l.selectionMesh.scaling.x=Math.sqrt(b.distance),l.selectionMesh.scaling.y=Math.sqrt(b.distance),l.selectionMesh.scaling.z=Math.sqrt(b.distance);var A=n._convertNormalToDirectionOfRay(b.getNormal(!0),l.tmpRay);if(l.selectionMesh.position.copyFrom(b.pickedPoint),A){var D=d.e.Cross(Se.a.Y,A),N=d.e.Cross(A,D);d.e.RotationFromAxisToRef(N,A,D,l.selectionMesh.rotation),l.selectionMesh.position.addInPlace(A.scale(.001))}l.selectionMesh.isVisible=n.displaySelectionMesh,l.meshUnderPointer=b.pickedMesh}else l.selectionMesh.isVisible=!1,n._updatePointerDistance(l.laserPointer,1),l.meshUnderPointer=null})},t.prototype._attachGazeMode=function(e){var n=this,r=this._controllers[e&&e.uniqueId||"camera"],o=this._options.timeToSelect||3e3,l=this._options.useUtilityLayer?this._options.customUtilityLayerScene||br.a.DefaultUtilityLayer.utilityLayerScene:this._scene,h=new xa.a,v=ls.CreateTorus("selection",{diameter:.0525,thickness:.015,tessellation:20},l);v.isVisible=!1,v.isPickable=!1,v.parent=r.selectionMesh;var b=0,A=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){if(r.pick){if(r.laserPointer.material.alpha=0,v.isVisible=!1,r.pick.hit)if(n._pickingMoved(h,r.pick))A&&(n._options.disablePointerUpOnTouchOut||n._scene.simulatePointerUp(r.pick,{pointerId:r.id})),A=!1,b=0;else if(b>o/10&&(v.isVisible=!0),(b+=n._scene.getEngine().getDeltaTime())>=o)n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),A=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.isVisible=!1;else{var D=1-b/o;v.scaling.set(D,D,D)}else A=!1,b=0;n._scene.simulatePointerMove(r.pick,{pointerId:r.id}),h=r.pick}}),this._options.renderingGroupId!==void 0&&(v.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce(function(){r.pick&&!n._options.disablePointerUpOnTouchOut&&A&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),v.dispose()})},t.prototype._attachScreenRayMode=function(e){var n=this,r=this._controllers[e.uniqueId],o=!1;r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){!r.pick||n._options.disablePointerUpOnTouchOut&&o||(o?n._scene.simulatePointerMove(r.pick,{pointerId:r.id}):(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),o=!0,n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})))}),e.onDisposeObservable.addOnce(function(){r.pick&&o&&!n._options.disablePointerUpOnTouchOut&&n._scene.simulatePointerUp(r.pick,{pointerId:r.id})})},t.prototype._attachTrackedPointerRayMode=function(e){var n=this,r=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);if(r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add(function(){r.laserPointer.material.disableLighting=n.disablePointerLighting,r.selectionMesh.material.disableLighting=n.disableSelectionMeshLighting,r.pick&&n._scene.simulatePointerMove(r.pick,{pointerId:r.id})}),e.inputSource.gamepad){var o=function(v){n._options.overrideButtonId&&(r.selectionComponent=v.getComponent(n._options.overrideButtonId)),r.selectionComponent||(r.selectionComponent=v.getMainComponent()),r.onButtonChangedObserver=r.selectionComponent.onButtonStateChangedObservable.add(function(b){if(b.changes.pressed){var A=b.changes.pressed.current;r.pick?(n._options.enablePointerSelectionOnAllControllers||e.uniqueId===n._attachedController)&&(A?(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor):(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)):!A||n._options.enablePointerSelectionOnAllControllers||n._options.disableSwitchOnClick||(n._attachedController=e.uniqueId)}})};e.motionController?o(e.motionController):e.onMotionControllerInitObservable.add(o)}else{var l=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerDown(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=n.laserPointerPickedColor)},h=function(v){r.xrController&&v.inputSource===r.xrController.inputSource&&r.pick&&(n._scene.simulatePointerUp(r.pick,{pointerId:r.id}),r.selectionMesh.material.emissiveColor=n.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=n.laserPointerDefaultColor)};r.eventListeners={selectend:h,selectstart:l},this._xrSessionManager.session.addEventListener("selectstart",l),this._xrSessionManager.session.addEventListener("selectend",h)}},t.prototype._convertNormalToDirectionOfRay=function(e,n){return e&&Math.acos(d.e.Dot(e,n.direction))<Math.PI/2&&e.scaleInPlace(-1),e},t.prototype._detachController=function(e){var n=this,r=this._controllers[e];if(r&&(r.selectionComponent&&r.onButtonChangedObserver&&r.selectionComponent.onButtonStateChangedObservable.remove(r.onButtonChangedObserver),r.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(r.onFrameObserver),r.eventListeners&&Object.keys(r.eventListeners).forEach(function(l){var h=r.eventListeners&&r.eventListeners[l];h&&n._xrSessionManager.session.removeEventListener(l,h)}),r.selectionMesh.dispose(),r.laserPointer.dispose(),delete this._controllers[e],this._attachedController===e)){var o=Object.keys(this._controllers);o.length?this._attachedController=o[0]:this._attachedController=""}},t.prototype._generateNewMeshPair=function(e){var n=this._options.useUtilityLayer?this._options.customUtilityLayerScene||br.a.DefaultUtilityLayer.utilityLayerScene:this._scene,r=wi.a.CreateCylinder("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},n);r.parent=e;var o=new Qt.a("laserPointerMat",n);o.emissiveColor=this.laserPointerDefaultColor,o.alpha=.7,r.material=o,r.rotation.x=Math.PI/2,this._updatePointerDistance(r,1),r.isPickable=!1;var l=ls.CreateTorus("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},n);l.bakeCurrentTransformIntoVertices(),l.isPickable=!1,l.isVisible=!1;var h=new Qt.a("targetMat",n);return h.specularColor=x.a.Black(),h.emissiveColor=this.selectionMeshDefaultColor,h.backFaceCulling=!1,l.material=h,this._options.renderingGroupId!==void 0&&(r.renderingGroupId=this._options.renderingGroupId,l.renderingGroupId=this._options.renderingGroupId),{laserPointer:r,selectionMesh:l}},t.prototype._pickingMoved=function(e,n){var r;if(!e.hit||!n.hit||!(e.pickedMesh&&e.pickedPoint&&n.pickedMesh&&n.pickedPoint)||e.pickedMesh!==n.pickedMesh)return!0;(r=e.pickedPoint)===null||r===void 0||r.subtractToRef(n.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var o=.01*(this._options.gazeModePointerMovedFactor||1)*n.distance;return this._tmpVectorForPickCompare.length()>o},t.prototype._updatePointerDistance=function(e,n){n===void 0&&(n=100),e.scaling.y=n,this._scene.useRightHandedSystem&&(n*=-1),e.position.z=n/2+.05},Object.defineProperty(t.prototype,"lasterPointerDefaultColor",{get:function(){return this.laserPointerDefaultColor},enumerable:!1,configurable:!0}),t._idCounter=200,t.Name=fi.POINTER_SELECTION,t.Version=1,t}(pi);ei.AddWebXRFeature(nl.Name,function(i,t){return function(){return new nl(i,t)}},nl.Version,!0);var Vo,Yy=function(){function i(t,e,n){this.element=t,this.sessionMode=e,this.referenceSpaceType=n}return i.prototype.update=function(t){},i}(),_D=function(){},Ky=function(){function i(t,e){var n=this;if(this.scene=t,this.options=e,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new E.c,this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",typeof window!="undefined"&&window.location&&window.location.protocol==="http:"&&Qe.b.Warn("WebXR can only be served over HTTPS"),e.customButtons)this._buttons=e.customButtons;else{var r=e.sessionMode||"immersive-vr",o=e.referenceSpaceType||"local-floor",l=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(typeof SVGSVGElement=="undefined"?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";l+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var h=document.createElement("style");h.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(h);var v=document.createElement("button");v.className="babylonVRicon",v.title=r+" - "+o,this._buttons.push(new Yy(v,r,o)),this._buttons[this._buttons.length-1].update=function(A){this.element.style.display=A===null||A===this?"":"none",v.className="babylonVRicon"+(A===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var b=t.getEngine().getInputElement();b&&b.parentNode&&(b.parentNode.appendChild(this.overlay),t.onDisposeObservable.addOnce(function(){n.dispose()}))}return i.CreateAsync=function(t,e,n){var r=this,o=new i(t,n),l=o._buttons.map(function(h){return e.sessionManager.isSessionSupportedAsync(h.sessionMode)});return e.onStateChangedObservable.add(function(h){h==zn.NOT_IN_XR&&o._updateButtons(null)}),Promise.all(l).then(function(h){return h.forEach(function(v,b){v?(o.overlay.appendChild(o._buttons[b].element),o._buttons[b].element.onclick=function(){return Object(_.b)(r,void 0,void 0,function(){var A,D,N;return Object(_.e)(this,function(j){switch(j.label){case 0:return e.state!=zn.IN_XR?[3,2]:[4,e.exitXRAsync()];case 1:return j.sent(),o._updateButtons(null),[3,6];case 2:if(e.state!=zn.NOT_IN_XR)return[3,6];if(!n.renderTarget)return[3,6];j.label=3;case 3:return j.trys.push([3,5,,6]),[4,e.enterXRAsync(o._buttons[b].sessionMode,o._buttons[b].referenceSpaceType,n.renderTarget,{optionalFeatures:n.optionalFeatures,requiredFeatures:n.requiredFeatures})];case 4:return j.sent(),o._updateButtons(o._buttons[b]),[3,6];case 5:return A=j.sent(),o._updateButtons(null),D=o._buttons[b].element,N=D.title,D.title="Error entering XR session : "+N,D.classList.add("xr-error"),n.onError&&n.onError(A),[3,6];case 6:return[2]}})})}):Qe.b.Warn('Session mode "'+o._buttons[b].sessionMode+'" not supported in browser')}),o})},i.prototype.dispose=function(){var t=this.scene.getEngine().getInputElement();t&&t.parentNode&&t.parentNode.contains(this.overlay)&&t.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear()},i.prototype._updateButtons=function(t){var e=this;this._activeButton=t,this._buttons.forEach(function(n){n.update(e._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},i}();function Yp(i){var t,e=0,n=Date.now();i.observableParameters=(t=i.observableParameters)!==null&&t!==void 0?t:{};var r=i.contextObservable.add(function(o){var l=Date.now(),h={startTime:n,currentTime:l,deltaTime:e=l-n,completeRate:e/i.timeout,payload:o};i.onTick&&i.onTick(h),i.breakCondition&&i.breakCondition()&&(i.contextObservable.remove(r),i.onAborted&&i.onAborted(h)),e>=i.timeout&&(i.contextObservable.remove(r),i.onEnded&&i.onEnded(h))},i.observableParameters.mask,i.observableParameters.insertFirst,i.observableParameters.scope);return r}(function(i){i[i.INIT=0]="INIT",i[i.STARTED=1]="STARTED",i[i.ENDED=2]="ENDED"})(Vo||(Vo={}));var gD=function(){function i(t){var e,n,r=this;this.onEachCountObservable=new E.c,this.onTimerAbortedObservable=new E.c,this.onTimerEndedObservable=new E.c,this.onStateChangedObservable=new E.c,this._observer=null,this._breakOnNextTick=!1,this._tick=function(o){var l=Date.now();r._timer=l-r._startTime;var h={startTime:r._startTime,currentTime:l,deltaTime:r._timer,completeRate:r._timer/r._timeToEnd,payload:o},v=r._breakOnNextTick||r._breakCondition(h);v||r._timer>=r._timeToEnd?r._stop(h,v):r.onEachCountObservable.notifyObservers(h)},this._setState(Vo.INIT),this._contextObservable=t.contextObservable,this._observableParameters=(e=t.observableParameters)!==null&&e!==void 0?e:{},this._breakCondition=(n=t.breakCondition)!==null&&n!==void 0?n:function(){return!1},t.onEnded&&this.onTimerEndedObservable.add(t.onEnded),t.onTick&&this.onEachCountObservable.add(t.onTick),t.onAborted&&this.onTimerAbortedObservable.add(t.onAborted)}return Object.defineProperty(i.prototype,"breakCondition",{set:function(t){this._breakCondition=t},enumerable:!1,configurable:!0}),i.prototype.clearObservables=function(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()},i.prototype.start=function(t){if(t===void 0&&(t=this._timeToEnd),this._state===Vo.STARTED)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=t,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(Vo.STARTED)},i.prototype.stop=function(){this._state===Vo.STARTED&&(this._breakOnNextTick=!0)},i.prototype.dispose=function(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()},i.prototype._setState=function(t){this._state=t,this.onStateChangedObservable.notifyObservers(this._state)},i.prototype._stop=function(t,e){e===void 0&&(e=!1),this._contextObservable.remove(this._observer),this._setState(Vo.ENDED),e?this.onTimerAbortedObservable.notifyObservers(t):this.onTimerEndedObservable.notifyObservers(t)},i}(),rl=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._controllers={},r._snappedToPoint=!1,r._tmpRay=new Bn.a(new d.e,new d.e),r._tmpVector=new d.e,r._tmpQuaternion=new d.b,r.backwardsMovementEnabled=!0,r.backwardsTeleportationDistance=.7,r.parabolicCheckRadius=5,r.parabolicRayEnabled=!0,r.straightRayEnabled=!0,r.rotationAngle=Math.PI/8,r._rotationEnabled=!0,r._attachController=function(o){if(!(r._controllers[o.uniqueId]||r._options.forceHandedness&&o.inputSource.handedness!==r._options.forceHandedness)){r._controllers[o.uniqueId]={xrController:o,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var l=r._controllers[o.uniqueId];if(l.xrController.inputSource.targetRayMode==="tracked-pointer"&&l.xrController.inputSource.gamepad){var h=function(){if(o.motionController){var v=o.motionController.getComponentOfType(bs.THUMBSTICK_TYPE)||o.motionController.getComponentOfType(bs.TOUCHPAD_TYPE);if(!v||r._options.useMainComponentOnly){var b=o.motionController.getMainComponent();if(!b)return;l.teleportationComponent=b,l.onButtonChangedObserver=b.onButtonStateChangedObservable.add(function(){b.changes.pressed&&(b.changes.pressed.current?(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,l.teleportationState.currentRotation=0,Yp({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,breakCondition:function(){return!b.pressed},onEnded:function(){r._currentTeleportationControllerId===l.xrController.uniqueId&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):(l.teleportationState.forward=!1,r._currentTeleportationControllerId=""))})}else l.teleportationComponent=v,l.onAxisChangedObserver=v.onAxisValueChangedObservable.add(function(A){if(A.y<=.7&&l.teleportationState.backwards&&(l.teleportationState.backwards=!1),A.y>.7&&!l.teleportationState.forward&&r.backwardsMovementEnabled&&!r.snapPointsOnly&&!l.teleportationState.backwards){l.teleportationState.backwards=!0,r._tmpQuaternion.copyFrom(r._options.xrInput.xrCamera.rotationQuaternion),r._tmpQuaternion.toEulerAnglesToRef(r._tmpVector),r._tmpVector.x=0,r._tmpVector.z=0,d.b.FromEulerVectorToRef(r._tmpVector,r._tmpQuaternion),r._tmpVector.set(0,0,r.backwardsTeleportationDistance*(r._xrSessionManager.scene.useRightHandedSystem?1:-1)),r._tmpVector.rotateByQuaternionToRef(r._tmpQuaternion,r._tmpVector),r._tmpVector.addInPlace(r._options.xrInput.xrCamera.position),r._tmpRay.origin.copyFrom(r._tmpVector),r._tmpRay.length=r._options.xrInput.xrCamera.realWorldHeight+.1,r._tmpRay.direction.set(0,-1,0);var D=r._xrSessionManager.scene.pickWithRay(r._tmpRay,function(j){return r._floorMeshes.indexOf(j)!==-1});D&&D.pickedPoint&&(r._options.xrInput.xrCamera.position.x=D.pickedPoint.x,r._options.xrInput.xrCamera.position.z=D.pickedPoint.z)}if(A.y<-.7&&!r._currentTeleportationControllerId&&!l.teleportationState.rotating&&(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),A.x){if(l.teleportationState.forward)r._currentTeleportationControllerId===l.xrController.uniqueId&&(r.rotationEnabled?setTimeout(function(){l.teleportationState.currentRotation=Math.atan2(A.x,A.y*(r._xrSessionManager.scene.useRightHandedSystem?1:-1))}):l.teleportationState.currentRotation=0);else if(!l.teleportationState.rotating&&Math.abs(A.x)>.7){l.teleportationState.rotating=!0;var N=r.rotationAngle*(A.x>0?1:-1)*(r._xrSessionManager.scene.useRightHandedSystem?-1:1);r._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(d.b.FromEulerAngles(0,N,0))}}else l.teleportationState.rotating=!1;A.x===0&&A.y===0&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)})}};o.motionController?h():o.onMotionControllerInitObservable.addOnce(function(){h()})}else r._xrSessionManager.scene.onPointerObservable.add(function(v){v.type===xt.a.POINTERDOWN?(l.teleportationState.forward=!0,r._currentTeleportationControllerId=l.xrController.uniqueId,l.teleportationState.baseRotation=r._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,l.teleportationState.currentRotation=0,Yp({timeout:r._options.timeToTeleport||3e3,contextObservable:r._xrSessionManager.onXRFrameObservable,onEnded:function(){r._currentTeleportationControllerId===l.xrController.uniqueId&&l.teleportationState.forward&&r._teleportForward(o.uniqueId)}})):v.type===xt.a.POINTERUP&&(l.teleportationState.forward=!1,r._currentTeleportationControllerId="")})}},r._options.teleportationTargetMesh||r._createDefaultTargetMesh(),r._floorMeshes=r._options.floorMeshes||[],r._snapToPositions=r._options.snapPositions||[],r._setTargetMeshVisibility(!1),r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this._rotationEnabled},set:function(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){var n=this._options.teleportationTargetMesh.getChildMeshes(!1,function(r){return r.name==="rotationCone"});n[0]&&n[0].setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTargetMesh",{get:function(){return this._options.teleportationTargetMesh||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(e){this._options.snapPointsOnly=e},enumerable:!1,configurable:!0}),t.prototype.addFloorMesh=function(e){this._floorMeshes.push(e)},t.prototype.addSnapPoint=function(e){this._snapToPositions.push(e)},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(n){e._detachController(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},t.prototype.removeFloorMesh=function(e){var n=this._floorMeshes.indexOf(e);n!==-1&&this._floorMeshes.splice(n,1)},t.prototype.removeFloorMeshByName=function(e){var n=this._xrSessionManager.scene.getMeshByName(e);n&&this.removeFloorMesh(n)},t.prototype.removeSnapPoint=function(e){var n=this._snapToPositions.indexOf(e);if(n===-1){for(var r=0;r<this._snapToPositions.length;++r)if(this._snapToPositions[r].equals(e)){n=r;break}}return n!==-1&&(this._snapToPositions.splice(n,1),!0)},t.prototype.setSelectionFeature=function(e){this._selectionFeature=e},t.prototype._onXRFrame=function(e){var n=this,r=this._xrSessionManager.currentFrame,o=this._xrSessionManager.scene;if(this.attach&&r){var l=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!l)return;l.rotationQuaternion=l.rotationQuaternion||new d.b;var h=this._controllers[this._currentTeleportationControllerId];if(h&&h.teleportationState.forward){d.b.RotationYawPitchRollToRef(h.teleportationState.currentRotation+h.teleportationState.baseRotation,0,0,l.rotationQuaternion);var v=!1;if(h.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){if((b=o.pickWithRay(this._tmpRay,function(j){if(n._options.pickBlockerMeshes&&n._options.pickBlockerMeshes.indexOf(j)!==-1)return!0;var k=n._floorMeshes.indexOf(j);return k!==-1&&n._floorMeshes[k].absolutePosition.y<n._options.xrInput.xrCamera.position.y}))&&b.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(b.pickedMesh)!==-1)return;b&&b.pickedPoint&&(v=!0,this._setTargetMeshPosition(b.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(b))}if(this.parabolicRayEnabled&&!v){var b,A=h.xrController.pointer.rotationQuaternion.toEulerAngles().x,D=Math.PI/2-Math.abs(A)+1,N=this.parabolicCheckRadius*D;if(this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*N),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(N)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize(),(b=o.pickWithRay(this._tmpRay,function(j){return!(!n._options.pickBlockerMeshes||n._options.pickBlockerMeshes.indexOf(j)===-1)||n._floorMeshes.indexOf(j)!==-1}))&&b.pickedMesh&&this._options.pickBlockerMeshes&&this._options.pickBlockerMeshes.indexOf(b.pickedMesh)!==-1)return;b&&b.pickedPoint&&(v=!0,this._setTargetMeshPosition(b.pickedPoint),this._setTargetMeshVisibility(!0),this._showParabolicPath(b))}this._setTargetMeshVisibility(v)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},t.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||br.a.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,n=No.CreateGround("teleportationTarget",{width:2,height:2,subdivisions:2},e);n.isPickable=!1;var r=new Zi.a("teleportationPlaneDynamicTexture",512,e,!0);r.hasAlpha=!0;var o=r.getContext();o.beginPath(),o.arc(256,256,200,0,2*Math.PI,!1),o.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",o.fill(),o.lineWidth=10,o.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",o.stroke(),o.closePath(),r.update();var l=new Qt.a("teleportationPlaneMaterial",e);l.diffuseTexture=r,n.material=l;var h=ls.CreateTorus("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(h.isPickable=!1,h.parent=n,!this._options.defaultTargetMeshOptions.disableAnimation){var v=new W("animationInnerCircle","position.y",30,W.ANIMATIONTYPE_FLOAT,W.ANIMATIONLOOPMODE_CYCLE),b=[];b.push({frame:0,value:0}),b.push({frame:30,value:.4}),b.push({frame:60,value:0}),v.setKeys(b);var A=new gr;A.setEasingMode(gt.EASINGMODE_EASEINOUT),v.setEasingFunction(A),h.animations=[],h.animations.push(v),e.beginAnimation(h,0,60,!0)}var D=wi.a.CreateCylinder("rotationCone",{diameterTop:0,tessellation:4},e);if(D.isPickable=!1,D.scaling.set(.5,.12,.2),D.rotate(Se.a.X,Math.PI/2),D.position.z=.6,D.parent=h,this._options.defaultTargetMeshOptions.torusArrowMaterial)h.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,D.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var N=new Qt.a("torusConsMat",e);N.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,N.disableLighting?N.emissiveColor=new x.a(.3,.3,1):N.diffuseColor=new x.a(.3,.3,1),N.alpha=.9,h.material=N,D.material=N,this._teleportationRingMaterial=N}this._options.renderingGroupId!==void 0&&(n.renderingGroupId=this._options.renderingGroupId,h.renderingGroupId=this._options.renderingGroupId,D.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=n},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.teleportationComponent&&(n.onAxisChangedObserver&&n.teleportationComponent.onAxisValueChangedObservable.remove(n.onAxisChangedObserver),n.onButtonChangedObserver&&n.teleportationComponent.onButtonStateChangedObservable.remove(n.onButtonChangedObserver)),delete this._controllers[e])},t.prototype._findClosestSnapPointWithRadius=function(e,n){n===void 0&&(n=this._options.snapToPositionRadius||.8);var r=null,o=Number.MAX_VALUE;if(this._snapToPositions.length){var l=n*n;this._snapToPositions.forEach(function(h){var v=d.e.DistanceSquared(h,e);v<=l&&v<o&&(o=v,r=h)})}return r},t.prototype._setTargetMeshPosition=function(e){if(this._options.teleportationTargetMesh){var n=this._findClosestSnapPointWithRadius(e);this._snappedToPoint=!!n,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(n||e),this._options.teleportationTargetMesh.position.y+=.01}},t.prototype._setTargetMeshVisibility=function(e){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==e&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach(function(n){n.isVisible=e}),e?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&this._selectionFeature.attach()))},t.prototype._showParabolicPath=function(e){if(e.pickedPoint){var n=this._controllers[this._currentTeleportationControllerId],r=ht.d.CreateQuadraticBezier(n.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25);this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(r.getPoints()):this._quadraticBezierCurve=kn.a.CreateLines("teleportation path line",{points:r.getPoints(),instance:this._quadraticBezierCurve,updatable:!0}),this._quadraticBezierCurve.isPickable=!1}},t.prototype._teleportForward=function(e){var n=this._controllers[e];if(n&&n.teleportationState.forward&&(n.teleportationState.forward=!1,this._currentTeleportationControllerId="",(!this.snapPointsOnly||this._snappedToPoint)&&this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible)){var r=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=r,this._options.xrInput.xrCamera.rotationQuaternion.multiplyInPlace(d.b.FromEulerAngles(0,n.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0)),this._options.xrInput.xrCamera.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}},t.Name=fi.TELEPORTATION,t.Version=1,t}(pi);ei.AddWebXRFeature(rl.Name,function(i,t){return function(){return new rl(i,t)}},rl.Version,!0);var vD=function(){},Qy=function(){function i(){}return i.CreateAsync=function(t,e){e===void 0&&(e={});var n=new i;return Gy.CreateAsync(t).then(function(r){if(n.baseExperience=r,e.ignoreNativeCameraTransformation&&(n.baseExperience.camera.compensateOnFirstFrame=!1),n.input=new Xy(r.sessionManager,r.camera,Object(_.a)({controllerOptions:{renderingGroupId:e.renderingGroupId}},e.inputOptions||{})),n.pointerSelection=n.baseExperience.featuresManager.enableFeature(nl.Name,e.useStablePlugins?"stable":"latest",{xrInput:n.input,renderingGroupId:e.renderingGroupId}),e.disableTeleportation||(n.teleportation=n.baseExperience.featuresManager.enableFeature(rl.Name,e.useStablePlugins?"stable":"latest",{floorMeshes:e.floorMeshes,xrInput:n.input,renderingGroupId:e.renderingGroupId}),n.teleportation.setSelectionFeature(n.pointerSelection)),n.renderTarget=n.baseExperience.sessionManager.getWebXRRenderTarget(e.outputCanvasOptions),!e.disableDefaultUI){var o=Object(_.a)({renderTarget:n.renderTarget},e.uiOptions||{});return e.optionalFeatures&&(typeof e.optionalFeatures=="boolean"?o.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:o.optionalFeatures=e.optionalFeatures),Ky.CreateAsync(t,n.baseExperience,o).then(function(l){n.enterExitUI=l})}}).then(function(){return n}).catch(function(r){return p.a.Error("Error initializing XR"),p.a.Error(r),n})},i.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},i}(),bD=!0;ne.a.prototype.createDefaultLight=function(i){if(i===void 0&&(i=!1),i&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();this.lights.length===0&&new Yu.a("default light",d.e.Up(),this)},ne.a.prototype.createDefaultCamera=function(i,t,e){if(i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var n,r=this.getWorldExtends(function(D){return D.isVisible&&D.isEnabled()}),o=r.max.subtract(r.min),l=r.min.add(o.scale(.5)),h=1.5*o.length();if(isFinite(h)||(h=1,l.copyFromFloats(0,0,0)),i){var v=new Mi("default camera",-Math.PI/2,Math.PI/2,h,l,this);v.lowerRadiusLimit=.01*h,v.wheelPrecision=100/h,n=v}else{var b=new dr("default camera",new d.e(l.x,l.y,-h),this);b.setTarget(l),n=b}n.minZ=.01*h,n.maxZ=1e3*h,n.speed=.2*h,this.activeCamera=n;var A=this.getEngine().getInputElement();e&&A&&n.attachControl()}},ne.a.prototype.createDefaultCameraOrLight=function(i,t,e){i===void 0&&(i=!1),t===void 0&&(t=!1),e===void 0&&(e=!1),this.createDefaultLight(t),this.createDefaultCamera(i,t,e)},ne.a.prototype.createDefaultSkybox=function(i,t,e,n,r){if(t===void 0&&(t=!1),e===void 0&&(e=1e3),n===void 0&&(n=0),r===void 0&&(r=!0),!i)return p.a.Warn("Can not create default skybox without environment texture."),null;r&&i&&(this.environmentTexture=i);var o=Ne.a.CreateBox("hdrSkyBox",e,this);if(t){var l=new tl("skyBox",this);l.backFaceCulling=!1,l.reflectionTexture=i.clone(),l.reflectionTexture&&(l.reflectionTexture.coordinatesMode=Ve.a.SKYBOX_MODE),l.microSurface=1-n,l.disableLighting=!0,l.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=l}else{var h=new Qt.a("skyBox",this);h.backFaceCulling=!1,h.reflectionTexture=i.clone(),h.reflectionTexture&&(h.reflectionTexture.coordinatesMode=Ve.a.SKYBOX_MODE),h.disableLighting=!0,o.infiniteDistance=!0,o.material=h}return o.isPickable=!1,o},ne.a.prototype.createDefaultEnvironment=function(i){return kp?new kp(i,this):null},ne.a.prototype.createDefaultVRExperience=function(i){return i===void 0&&(i={}),new _y(this,i)},ne.a.prototype.createDefaultXRExperienceAsync=function(i){return i===void 0&&(i={}),Qy.CreateAsync(this,i).then(function(t){return t})};var qy=function(i){function t(e,n,r,o,l,h,v){o===void 0&&(o=!1),l===void 0&&(l=!1),h===void 0&&(h=Ve.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var b=i.call(this,null,r,!o,l)||this;b._onUserActionRequestedObservable=null,b._stillImageCaptured=!1,b._displayingPosterTexture=!1,b._frameId=-1,b._currentSrc=null,b._createInternalTexture=function(){if(b._texture!=null){if(!b._displayingPosterTexture)return;b._texture.dispose(),b._displayingPosterTexture=!1}if(!b._getEngine().needPOTTextures||Qe.b.IsExponentOfTwo(b.video.videoWidth)&&Qe.b.IsExponentOfTwo(b.video.videoHeight)?(b.wrapU=Ve.a.WRAP_ADDRESSMODE,b.wrapV=Ve.a.WRAP_ADDRESSMODE):(b.wrapU=Ve.a.CLAMP_ADDRESSMODE,b.wrapV=Ve.a.CLAMP_ADDRESSMODE,b._generateMipMaps=!1),b._texture=b._getEngine().createDynamicTexture(b.video.videoWidth,b.video.videoHeight,b._generateMipMaps,b.samplingMode),b.video.autoplay||b._settings.poster)b._texture.isReady=!0,b._updateInternalTexture(),b.onLoadObservable.hasObservers()&&b.onLoadObservable.notifyObservers(b);else{var D=b.video.onplaying,N=!1,j=b.video.muted;b.video.muted=!0,b.video.onplaying=function(){b.video.muted=j,b.video.onplaying=D,b._texture.isReady=!0,b._updateInternalTexture(),N||b.video.pause(),b.onLoadObservable.hasObservers()&&b.onLoadObservable.notifyObservers(b)};var k=b.video.play();k?k.then(function(){}).catch(function(){N=!0,b._onUserActionRequestedObservable&&b._onUserActionRequestedObservable.hasObservers()&&b._onUserActionRequestedObservable.notifyObservers(b)}):(b.video.onplaying=D,b._texture.isReady=!0,b._updateInternalTexture(),b.onLoadObservable.hasObservers()&&b.onLoadObservable.notifyObservers(b))}},b.reset=function(){b._texture!=null&&(b._displayingPosterTexture||(b._texture.dispose(),b._texture=null))},b._updateInternalTexture=function(){if(b._texture!=null&&b._texture.isReady&&!(b.video.readyState<b.video.HAVE_CURRENT_DATA||b._displayingPosterTexture)){var D=b.getScene().getFrameId();b._frameId!==D&&(b._frameId=D,b._getEngine().updateVideoTexture(b._texture,b.video,b._invertY))}},b._generateMipMaps=o,b._initialSamplingMode=h,b.autoUpdateTexture=v.autoUpdateTexture,b._currentSrc=n,b.name=e||b._getName(n),b.video=b._getVideo(n),b._settings=v,v.poster&&(b.video.poster=v.poster),v.autoPlay!==void 0&&(b.video.autoplay=v.autoPlay),v.loop!==void 0&&(b.video.loop=v.loop),v.muted!==void 0&&(b.video.muted=v.muted),b.video.setAttribute("playsinline",""),b.video.addEventListener("paused",b._updateInternalTexture),b.video.addEventListener("seeked",b._updateInternalTexture),b.video.addEventListener("emptied",b.reset),b._createInternalTextureOnEvent=v.poster&&!v.autoPlay?"play":"canplay",b.video.addEventListener(b._createInternalTextureOnEvent,b._createInternalTexture),v.autoPlay&&b.video.play();var A=b.video.readyState>=b.video.HAVE_CURRENT_DATA;return!v.poster||v.autoPlay&&A?A&&b._createInternalTexture():(b._texture=b._getEngine().createTexture(v.poster,!1,!b.invertY,r),b._displayingPosterTexture=!0),b}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new E.c),this._onUserActionRequestedObservable},enumerable:!1,configurable:!0}),t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:typeof e=="object"?e.toString():e},t.prototype._getVideo=function(e){if(e instanceof HTMLVideoElement)return Qe.b.SetCorsBehavior(e.currentSrc,e),e;var n=document.createElement("video");return typeof e=="string"?(Qe.b.SetCorsBehavior(e,n),n.src=e):(Qe.b.SetCorsBehavior(e[0],n),e.forEach(function(r){var o=document.createElement("source");o.src=r,n.appendChild(o)})),n},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e,this._currentSrc=e},t.prototype.clone=function(){return new t(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(e,n){var r=document.createElement("video");return e.getEngine()._badOS&&(document.body.appendChild(r),r.style.transform="scale(0.0001, 0.0001)",r.style.opacity="0",r.style.position="fixed",r.style.bottom="0px",r.style.right="0px"),r.setAttribute("autoplay",""),r.setAttribute("muted","true"),r.setAttribute("playsinline",""),r.muted=!0,r.mozSrcObject!==void 0?r.mozSrcObject=n:typeof r.srcObject=="object"?r.srcObject=n:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.src=window.URL&&window.URL.createObjectURL(n)),new Promise(function(o){var l=function(){o(new t("video",r,e,!0,!0)),r.removeEventListener("playing",l)};r.addEventListener("playing",l),r.play()})},t.CreateFromWebCamAsync=function(e,n,r){var o,l=this;return r===void 0&&(r=!1),n&&n.deviceId&&(o={exact:n.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:n,audio:r}).then(function(h){return l.CreateFromStreamAsync(e,h)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:o,width:{min:n&&n.minWidth||256,max:n&&n.maxWidth||640},height:{min:n&&n.minHeight||256,max:n&&n.maxHeight||480}},audio:r},function(h){return l.CreateFromStreamAsync(e,h)},function(h){p.a.Error(h.name)}),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(e,n,r,o){o===void 0&&(o=!1),this.CreateFromWebCamAsync(e,r,o).then(function(l){n&&n(l)}).catch(function(l){p.a.Error(l.name)})},t}(Ve.a),yD=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,n,r){var o=this,l={loop:r.loop,autoPlay:r.autoPlay,autoUpdateTexture:!0,poster:r.poster},h=new qy((this.name||"videoDome")+"_texture",e,n,r.generateMipMaps,this._useDirectMapping,Ve.a.TRILINEAR_SAMPLINGMODE,l);return r.clickToPlay&&(n.onPointerUp=function(){o._texture.video.play()}),h},t.MODE_MONOSCOPIC=Bo.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=Bo.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=Bo.MODE_SIDEBYSIDE,t}(Bo),zr=c(55),TD=function(){function i(t){this.engine=t,this._captureGPUFrameTime=!1,this._gpuFrameTime=new zr.a,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new zr.a,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(i.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(t){var e=this;t!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=t,t?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){e._gpuFrameTimeToken||(e._gpuFrameTimeToken=e.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(e._gpuFrameTimeToken){var n=e.engine.endTimeQuery(e._gpuFrameTimeToken);n>-1&&(e._gpuFrameTimeToken=null,e._gpuFrameTime.fetchNewFrame(),e._gpuFrameTime.addCount(n,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(t){var e=this;t!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=t,t?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){e._shaderCompilationTime.fetchNewFrame(),e._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){e._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},i}(),ED=function(){function i(t){var e=this;this.scene=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new zr.a,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new zr.a,this._captureFrameTime=!1,this._frameTime=new zr.a,this._captureRenderTime=!1,this._renderTime=new zr.a,this._captureInterFrameTime=!1,this._interFrameTime=new zr.a,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new zr.a,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new zr.a,this._capturePhysicsTime=!1,this._physicsTime=new zr.a,this._captureAnimationsTime=!1,this._animationsTime=new zr.a,this._captureCameraRenderTime=!1,this._cameraRenderTime=new zr.a,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add(function(){e._captureActiveMeshesEvaluationTime&&e._activeMeshesEvaluationTime.fetchNewFrame(),e._captureRenderTargetsRenderTime&&e._renderTargetsRenderTime.fetchNewFrame(),e._captureFrameTime&&(Qe.b.StartPerformanceCounter("Scene rendering"),e._frameTime.beginMonitoring()),e._captureInterFrameTime&&e._interFrameTime.endMonitoring(),e._captureParticlesRenderTime&&e._particlesRenderTime.fetchNewFrame(),e._captureSpritesRenderTime&&e._spritesRenderTime.fetchNewFrame(),e._captureAnimationsTime&&e._animationsTime.beginMonitoring(),e.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=t.onAfterRenderObservable.add(function(){e._captureFrameTime&&(Qe.b.EndPerformanceCounter("Scene rendering"),e._frameTime.endMonitoring()),e._captureRenderTime&&e._renderTime.endMonitoring(!1),e._captureInterFrameTime&&e._interFrameTime.beginMonitoring()})}return Object.defineProperty(i.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(t){var e=this;t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){Qe.b.StartPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){Qe.b.EndPerformanceCounter("Active meshes evaluation"),e._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(t){var e=this;t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){Qe.b.StartPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){Qe.b.EndPerformanceCounter("Render targets rendering"),e._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(t){var e=this;t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){Qe.b.StartPerformanceCounter("Particles"),e._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){Qe.b.EndPerformanceCounter("Particles"),e._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(t){var e=this;t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.scene.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){Qe.b.StartPerformanceCounter("Sprites"),e._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){Qe.b.EndPerformanceCounter("Sprites"),e._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(t){var e=this;t!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){Qe.b.StartPerformanceCounter("Physics"),e._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){Qe.b.EndPerformanceCounter("Physics"),e._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(t){var e=this;t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){e._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(t){this._captureFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(t){this._captureInterFrameTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var e=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){e._renderTime.beginMonitoring(),Qe.b.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){e._renderTime.endMonitoring(!1),Qe.b.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(t){var e=this;t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(n){e._cameraRenderTime.beginMonitoring(),Qe.b.StartPerformanceCounter("Rendering camera "+n.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(n){e._cameraRenderTime.endMonitoring(!1),Qe.b.EndPerformanceCounter("Rendering camera "+n.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},i}(),SD=`#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform sampler2D opacitySampler;
uniform float opacityIntensity;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
#ifdef VERTEXALPHA
varying vec4 vColor;
#endif
uniform vec4 glowColor;
void main(void)
{
vec4 finalColor=glowColor;

#ifdef DIFFUSE
vec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);
#ifdef GLOW

finalColor.a*=albedoTexture.a;
#endif
#ifdef HIGHLIGHT

finalColor.a=albedoTexture.a;
#endif
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vUVOpacity);
#ifdef OPACITYRGB
finalColor.a*=getLuminance(opacityMap.rgb);
#else
finalColor.a*=opacityMap.a;
#endif
finalColor.a*=opacityIntensity;
#endif
#ifdef VERTEXALPHA
finalColor.a*=vColor.a;
#endif
#ifdef ALPHATEST
if (finalColor.a<ALPHATESTVALUE)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;
#else
gl_FragColor=finalColor;
#endif
#ifdef HIGHLIGHT

gl_FragColor.a=glowColor.a;
#endif
}`;We.a.ShadersStore.glowMapGenerationPixelShader=SD;var xD=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef DIFFUSE
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef OPACITY
varying vec2 vUVOpacity;
uniform mat4 opacityMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
#ifdef VERTEXALPHA
attribute vec4 color;
varying vec4 vColor;
#endif
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef DIFFUSE
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef OPACITY
#ifdef OPACITYUV1
vUVOpacity=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef OPACITYUV2
vUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef VERTEXALPHA
vColor=color;
#endif
}`;We.a.ShadersStore.glowMapGenerationVertexShader=xD;var il=function(){function i(t,e){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new x.b},this.neutralColor=new x.b,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new E.c,this.onBeforeRenderMainTextureObservable=new E.c,this.onBeforeComposeObservable=new E.c,this.onBeforeRenderMeshToEffect=new E.c,this.onAfterRenderMeshToEffect=new E.c,this.onAfterComposeObservable=new E.c,this.onSizeChangedObservable=new E.c,this.name=t,this._scene=e||$.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(i.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(t){this._effectLayerOptions.renderingGroupId=t},enumerable:!1,configurable:!0}),i.prototype._init=function(t){this._effectLayerOptions=Object(_.a)({mainTextureRatio:.5,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},t),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},i.prototype._generateIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._engine.createIndexBuffer(t)},i.prototype._generateVertexBuffer=function(){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1);var e=new Me.b(this._engine,t,Me.b.PositionKind,!1,!1,2);this._vertexBuffers[Me.b.PositionKind]=e},i.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},i.prototype._createMainTexture=function(){var t=this;this._mainTexture=new Un("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(n,r,o,l){var h;t.onBeforeRenderMainTextureObservable.notifyObservers(t);var v=t._scene.getEngine();if(l.length){for(v.setColorWrite(!1),h=0;h<l.length;h++)t._renderSubMesh(l.data[h]);v.setColorWrite(!0)}for(h=0;h<n.length;h++)t._renderSubMesh(n.data[h]);for(h=0;h<r.length;h++)t._renderSubMesh(r.data[h]);var b=v.getAlphaMode();for(h=0;h<o.length;h++)t._renderSubMesh(o.data[h],!0);v.setAlphaMode(b)},this._mainTexture.onClearObservable.add(function(n){n.clear(t.neutralColor,!0,!0,!0)});var e=this._scene.getBoundingBoxRenderer().enabled;this._mainTexture.onBeforeBindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=!t.disableBoundingBoxesFromEffectLayer&&e}),this._mainTexture.onAfterUnbindObservable.add(function(){t._scene.getBoundingBoxRenderer().enabled=e})},i.prototype._addCustomEffectDefines=function(t){},i.prototype._isReady=function(t,e,n){var r=t.getMaterial();if(!r||!r.isReadyForSubMesh(t.getMesh(),t,e))return!1;var o=[],l=[Me.b.PositionKind],h=t.getMesh(),v=!1,b=!1;if(r){var A=r.needAlphaTesting(),D=r.getAlphaTestTexture(),N=D&&D.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);D&&(A||N)&&(o.push("#define DIFFUSE"),h.isVerticesDataPresent(Me.b.UV2Kind)&&D.coordinatesIndex===1?(o.push("#define DIFFUSEUV2"),b=!0):h.isVerticesDataPresent(Me.b.UVKind)&&(o.push("#define DIFFUSEUV1"),v=!0),A&&(o.push("#define ALPHATEST"),o.push("#define ALPHATESTVALUE 0.4")));var j=r.opacityTexture;j&&(o.push("#define OPACITY"),h.isVerticesDataPresent(Me.b.UV2Kind)&&j.coordinatesIndex===1?(o.push("#define OPACITYUV2"),b=!0):h.isVerticesDataPresent(Me.b.UVKind)&&(o.push("#define OPACITYUV1"),v=!0))}n&&(o.push("#define EMISSIVE"),h.isVerticesDataPresent(Me.b.UV2Kind)&&n.coordinatesIndex===1?(o.push("#define EMISSIVEUV2"),b=!0):h.isVerticesDataPresent(Me.b.UVKind)&&(o.push("#define EMISSIVEUV1"),v=!0)),h.isVerticesDataPresent(Me.b.ColorKind)&&h.hasVertexAlpha&&(l.push(Me.b.ColorKind),o.push("#define VERTEXALPHA")),v&&(l.push(Me.b.UVKind),o.push("#define UV1")),b&&(l.push(Me.b.UV2Kind),o.push("#define UV2"));var k=new ms.a;if(h.useBones&&h.computeBonesUsingShaders){l.push(Me.b.MatricesIndicesKind),l.push(Me.b.MatricesWeightsKind),h.numBoneInfluencers>4&&(l.push(Me.b.MatricesIndicesExtraKind),l.push(Me.b.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers);var H=h.skeleton;H&&H.isUsingTextureForMatrices?o.push("#define BONETEXTURE"):o.push("#define BonesPerMesh "+(H?H.bones.length+1:0)),h.numBoneInfluencers>0&&k.addCPUSkinningFallback(0,h)}else o.push("#define NUM_BONE_INFLUENCERS 0");var J=h.morphTargetManager,te=0;J&&J.numInfluencers>0&&(o.push("#define MORPHTARGETS"),te=J.numInfluencers,o.push("#define NUM_MORPH_INFLUENCERS "+te),ot.a.PrepareAttributesForMorphTargetsInfluencers(l,h,te)),e&&(o.push("#define INSTANCES"),ot.a.PushAttributesForInstances(l),t.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES")),this._addCustomEffectDefines(o);var oe=o.join(`
`);return this._cachedDefines!==oe&&(this._cachedDefines=oe,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",l,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler"],oe,k,void 0,void 0,{maxSimultaneousMorphTargets:te})),this._effectLayerMapGenerationEffect.isReady()},i.prototype.render=function(){var t=this._mergeEffect;if(t.isReady()){for(var e=0;e<this._postProcesses.length;e++)if(!this._postProcesses[e].isReady())return;var n=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),n.enableEffect(t),n.setState(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,t);var r=n.getAlphaMode();n.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(t),n.setAlphaMode(r),this.onAfterComposeObservable.notifyObservers(this);var o=this._mainTexture.getSize();this._setMainTextureSize(),o.width===this._mainTextureDesiredSize.width&&o.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},i.prototype.hasMesh=function(t){return this.renderingGroupId===-1||t.renderingGroupId===this.renderingGroupId},i.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},i.prototype._shouldRenderMesh=function(t){return!0},i.prototype._canRenderMesh=function(t,e){return!e.needAlphaBlendingForMesh(t)},i.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},i.prototype._renderSubMesh=function(t,e){var n,r=this;if(e===void 0&&(e=!1),this.shouldRender()){var o=t.getMaterial(),l=t.getMesh(),h=t.getReplacementMesh(),v=t.getRenderingMesh(),b=t.getEffectiveMesh(),A=this._scene,D=A.getEngine();if(b._internalAbstractMeshDataInfo._isActiveIntermediate=!1,o&&this._canRenderMesh(v,o)){var N=(n=v.overrideMaterialSideOrientation)!==null&&n!==void 0?n:o.sideOrientation;v._getWorldMatrixDeterminant()<0&&(N=N===nn.a.ClockWiseSideOrientation?nn.a.CounterClockWiseSideOrientation:nn.a.ClockWiseSideOrientation);var j=N===nn.a.ClockWiseSideOrientation;D.setState(o.backFaceCulling,o.zOffset,void 0,j);var k=v._getInstancesRenderList(t._id,!!h);if(!k.mustReturn&&this._shouldRenderMesh(v)){var H=k.hardwareInstancedRendering[t._id]||v.hasThinInstances;if(this._setEmissiveTextureAndColor(v,t,o),this.onBeforeRenderMeshToEffect.notifyObservers(l),this._useMeshMaterial(v))v.render(t,H,h||void 0);else if(this._isReady(t,H,this._emissiveTextureAndColor.texture)){D.enableEffect(this._effectLayerMapGenerationEffect),v._bind(t,this._effectLayerMapGenerationEffect,nn.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._effectLayerMapGenerationEffect.setMatrix("world",b.getWorldMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var J=o.needAlphaTesting(),te=o.getAlphaTestTexture(),oe=te&&te.hasAlpha&&(o.useAlphaFromDiffuseTexture||o._useAlphaFromAlbedoTexture);te&&(J||oe)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",te),(ce=te.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",ce));var ce,he=o.opacityTexture;if(he&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",he),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",he.level),(ce=he.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",ce)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),v.useBones&&v.computeBonesUsingShaders&&v.skeleton){var _e=v.skeleton;if(_e.isUsingTextureForMatrices){var ye=_e.getTransformMatrixTexture(v);if(!ye)return;this._effectLayerMapGenerationEffect.setTexture("boneSampler",ye),this._effectLayerMapGenerationEffect.setFloat("boneTextureWidth",4*(_e.bones.length+1))}else this._effectLayerMapGenerationEffect.setMatrices("mBones",_e.getTransformMatrices(v))}ot.a.BindMorphTargetParameters(v,this._effectLayerMapGenerationEffect),e&&D.setAlphaMode(o.alphaMode),v._processRendering(b,t,this._effectLayerMapGenerationEffect,o.fillMode,k,H,function(Ee,Oe){return r._effectLayerMapGenerationEffect.setMatrix("world",Oe)})}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(l)}}}},i.prototype._useMeshMaterial=function(t){return!1},i.prototype._rebuild=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&t._rebuild(),this._generateIndexBuffer()},i.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var t=0;t<this._postProcesses.length;t++)this._postProcesses[t]&&this._postProcesses[t].dispose();for(this._postProcesses=[],t=0;t<this._textures.length;t++)this._textures[t]&&this._textures[t].dispose();this._textures=[]},i.prototype.dispose=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[Me.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var e=this._scene.effectLayers.indexOf(this,0);e>-1&&this._scene.effectLayers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},i.prototype.getClassName=function(){return"EffectLayer"},i.Parse=function(t,e,n){return Qe.b.Instantiate(t.customType).Parse(t,e,n)},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("EffectLayerSceneComponent")},Object(_.c)([Object(V.c)()],i.prototype,"name",void 0),Object(_.c)([Object(V.f)()],i.prototype,"neutralColor",void 0),Object(_.c)([Object(V.c)()],i.prototype,"isEnabled",void 0),Object(_.c)([Object(V.d)()],i.prototype,"camera",null),Object(_.c)([Object(V.c)()],i.prototype,"renderingGroupId",null),Object(_.c)([Object(V.c)()],i.prototype,"disableBoundingBoxesFromEffectLayer",void 0),i}();T.a.AddParser(ct.a.NAME_EFFECTLAYER,function(i,t,e,n){if(i.effectLayers){e.effectLayers||(e.effectLayers=new Array);for(var r=0;r<i.effectLayers.length;r++){var o=il.Parse(i.effectLayers[r],t,n);e.effectLayers.push(o)}}}),T.a.prototype.removeEffectLayer=function(i){var t=this.effectLayers.indexOf(i);return t!==-1&&this.effectLayers.splice(t,1),t},T.a.prototype.addEffectLayer=function(i){this.effectLayers.push(i)};var Zy=function(){function i(t){this.name=ct.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=t,this._engine=t.getEngine(),t.effectLayers=new Array}return i.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(ct.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(ct.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(ct.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(ct.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(ct.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(ct.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.effectLayers;t<e.length;t++)e[t]._rebuild()},i.prototype.serialize=function(t){t.effectLayers=[];for(var e=0,n=this.scene.effectLayers;e<n.length;e++){var r=n[e];r.serialize&&t.effectLayers.push(r.serialize())}},i.prototype.addFromContainer=function(t){var e=this;t.effectLayers&&t.effectLayers.forEach(function(n){e.scene.addEffectLayer(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.effectLayers&&t.effectLayers.forEach(function(r){n.scene.removeEffectLayer(r),e&&r.dispose()})},i.prototype.dispose=function(){for(var t=this.scene.effectLayers;t.length;)t[0].dispose()},i.prototype._isReadyForMesh=function(t,e){for(var n=0,r=this.scene.effectLayers;n<r.length;n++){var o=r[n];if(o.hasMesh(t))for(var l=0,h=t.subMeshes;l<h.length;l++){var v=h[l];if(!o.isReady(v,e))return!1}}return!0},i.prototype._renderMainTexture=function(t){this._renderEffects=!1,this._needStencil=!1;var e=!1,n=this.scene.effectLayers;if(n&&n.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,o=n;r<o.length;r++){var l=o[r];if(l.shouldRender()&&(!l.camera||l.camera.cameraRigMode===Tt.a.RIG_MODE_NONE&&t===l.camera||l.camera.cameraRigMode!==Tt.a.RIG_MODE_NONE&&l.camera._rigCameras.indexOf(t)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||l.needStencil();var h=l._mainTexture;h._shouldRender()&&(this.scene.incrementRenderId(),h.render(!1,!1),e=!0)}}this.scene.incrementRenderId()}return e},i.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},i.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},i.prototype._draw=function(t){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var e=this.scene.effectLayers,n=0;n<e.length;n++){var r=e[n];r.renderingGroupId===t&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},i.prototype._drawRenderingGroup=function(t){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(t)},i}();il._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_EFFECTLAYER);t||(t=new Zy(i),i._addComponent(t))};var PD=`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`;We.a.ShadersStore.glowMapMergePixelShader=PD;var AD=`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.glowMapMergeVertexShader=AD,T.a.prototype.getGlowLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===dh.EffectName)return this.effectLayers[t];return null};var dh=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o._intensity=1,o._includedOnlyMeshes=[],o._excludedMeshes=[],o._meshesUsingTheirOwnMaterials=[],o.neutralColor=new x.b(0,0,0,1),o._options=Object(_.a)({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},r),o._init({alphaBlendingMode:g.a.ALPHA_ADD,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Me.b.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width,r=this._mainTextureDesiredSize.height;n=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new Un("GlowLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture1.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var l=Math.floor(n/2),h=Math.floor(r/2);this._blurTexture2=new Un("GlowLayerBlurRTT2",{width:l,height:h},this._scene,!1,!0,o),this._blurTexture2.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new Yn("GlowLayerHBP1",new d.d(1,0),this._options.blurKernelSize/2,{width:n,height:r},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess1.width=n,this._horizontalBlurPostprocess1.height=r,this._horizontalBlurPostprocess1.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess1=new Yn("GlowLayerVBP1",new d.d(0,1),this._options.blurKernelSize/2,{width:n,height:r},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2=new Yn("GlowLayerHBP2",new d.d(1,0),this._options.blurKernelSize/2,{width:l,height:h},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess2.width=l,this._horizontalBlurPostprocess2.height=h,this._horizontalBlurPostprocess2.onApplyObservable.add(function(v){v.setTexture("textureSampler",e._blurTexture1)}),this._verticalBlurPostprocess2=new Yn("GlowLayerVBP2",new d.d(0,1),this._options.blurKernelSize/2,{width:l,height:h},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var v=e._blurTexture1.getInternalTexture();if(v){e._scene.postProcessManager.directRender(e._postProcesses1,v,!0);var b=e._blurTexture2.getInternalTexture();b&&e._scene.postProcessManager.directRender(e._postProcesses2,b,!0),e._engine.unBindFramebuffer(b??v,!0)}}),this._postProcesses.map(function(v){v.autoClear=!1})},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o)return!1;var l=r.emissiveTexture;return i.prototype._isReady.call(this,e,n,l)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var n=this._engine,r=n.getStencilBuffer();n.setStencilBuffer(!1),n.drawElementsType(nn.a.TriangleFillMode,0,6),n.setStencilBuffer(r)},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,n,r):r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.texture&&(o=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,n,r,this._emissiveTextureAndColor.color):r.emissiveColor?this._emissiveTextureAndColor.color.set(r.emissiveColor.r*o,r.emissiveColor.g*o,r.emissiveColor.b*o,r.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){this._excludedMeshes.indexOf(e.uniqueId)===-1&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var n=this._excludedMeshes.indexOf(e.uniqueId);n!==-1&&this._excludedMeshes.splice(n,1)},t.prototype.addIncludedOnlyMesh=function(e){this._includedOnlyMeshes.indexOf(e.uniqueId)===-1&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var n=this._includedOnlyMeshes.indexOf(e.uniqueId);n!==-1&&this._includedOnlyMeshes.splice(n,1)},t.prototype.hasMesh=function(e){return!!i.prototype.hasMesh.call(this,e)&&(this._includedOnlyMeshes.length?this._includedOnlyMeshes.indexOf(e.uniqueId)!==-1:!this._excludedMeshes.length||this._excludedMeshes.indexOf(e.uniqueId)===-1)},t.prototype._useMeshMaterial=function(e){return this._meshesUsingTheirOwnMaterials.length!=0&&this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)>-1},t.prototype.referenceMeshToUseItsOwnMaterial=function(e){this._meshesUsingTheirOwnMaterials.push(e.uniqueId)},t.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(e){for(var n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);n>=0;)this._meshesUsingTheirOwnMaterials.splice(n,1),n=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,n=V.a.Serialize(this);if(n.customType="BABYLON.GlowLayer",n.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++)(r=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&n.includedMeshes.push(r.id);if(n.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var r;(r=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&n.excludedMeshes.push(r.id)}return n},t.Parse=function(e,n,r){var o,l=V.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(h=n.getMeshByID(e.excludedMeshes[o]))&&l.addExcludedMesh(h);for(o=0;o<e.includedMeshes.length;o++){var h;(h=n.getMeshByID(e.includedMeshes[o]))&&l.addIncludedOnlyMesh(h)}return l},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,Object(_.c)([Object(V.c)()],t.prototype,"blurKernelSize",null),Object(_.c)([Object(V.c)()],t.prototype,"intensity",null),Object(_.c)([Object(V.c)("options")],t.prototype,"_options",void 0),t}(il);M.a.RegisteredTypes["BABYLON.GlowLayer"]=dh;var CD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`;We.a.ShadersStore.glowBlurPostProcessPixelShader=CD,T.a.prototype.getHighlightLayerByName=function(i){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===i&&this.effectLayers[t].getEffectName()===Kp.EffectName)return this.effectLayers[t];return null};var $y=function(i){function t(e,n,r,o,l,h,v,b){h===void 0&&(h=Ve.a.BILINEAR_SAMPLINGMODE);var A=i.call(this,e,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,o,l,h,v,b)||this;return A.direction=n,A.kernel=r,A.onApplyObservable.add(function(D){D.setFloat2("screenSize",A.width,A.height),D.setVector2("direction",A.direction),D.setFloat("blurWidth",A.kernel)}),A}return Object(_.d)(t,i),t}(bt),Kp=function(i){function t(e,n,r){var o=i.call(this,e,n)||this;return o.name=e,o.innerGlow=!0,o.outerGlow=!0,o.onBeforeBlurObservable=new E.c,o.onAfterBlurObservable=new E.c,o._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,o._meshes={},o._excludedMeshes={},o.neutralColor=t.NeutralColor,o._engine.isStencilEnable||p.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),o._options=Object(_.a)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},r),o._init({alphaBlendingMode:o._options.alphaBlendingMode,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o._shouldRender=!1,o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Me.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,r=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(n,this._maxSize):n,r=this._engine.needPOTTextures?Xe.a.GetExponentOfTwo(r,this._maxSize):r;var o=0;o=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new Un("HighlightLayerBlurRTT",{width:n,height:r},this._scene,!1,!0,o),this._blurTexture.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(Ve.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===g.a.ALPHA_COMBINE?(this._downSamplePostprocess=new wo("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",e._mainTexture)}),this._horizontalBlurPostprocess=new $y("HighlightLayerHBP",new d.d(1,0),this._options.blurHorizontalSize,1,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,r)}),this._verticalBlurPostprocess=new $y("HighlightLayerVBP",new d.d(0,1),this._options.blurVerticalSize,1,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,r)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new Yn("HighlightLayerHBP",new d.d(1,0),this._options.blurHorizontalSize/2,{width:n,height:r},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess.width=n,this._horizontalBlurPostprocess.height=r,this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess=new Yn("HighlightLayerVBP",new d.d(0,1),this._options.blurVerticalSize/2,{width:n,height:r},null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){e.onBeforeBlurObservable.notifyObservers(e);var l=e._blurTexture.getInternalTexture();l&&(e._scene.postProcessManager.directRender(e._postProcesses,l,!0),e._engine.unBindFramebuffer(l,!0)),e.onAfterBlurObservable.notifyObservers(e)}),this._postProcesses.map(function(l){l.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(e,n){var r=e.getMaterial(),o=e.getRenderingMesh();if(!r||!o||!this._meshes)return!1;var l=null,h=this._meshes[o.uniqueId];return h&&h.glowEmissiveOnly&&r&&(l=r.emissiveTexture),i.prototype._isReady.call(this,e,n,l)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var n=this._engine;n.cacheStencilState(),n.setStencilOperationPass(g.a.REPLACE),n.setStencilOperationFail(g.a.KEEP),n.setStencilOperationDepthFail(g.a.KEEP),n.setStencilMask(0),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),n.setStencilFunction(g.a.NOTEQUAL),n.drawElementsType(nn.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),n.setStencilFunction(g.a.EQUAL),n.drawElementsType(nn.a.TriangleFillMode,0,6)),n.restoreStencilState()},t.prototype.shouldRender=function(){return!!i.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(e){return(!this._excludedMeshes||!this._excludedMeshes[e.uniqueId])&&!!i.prototype.hasMesh.call(this,e)},t.prototype._canRenderMesh=function(e,n){return!0},t.prototype._addCustomEffectDefines=function(e){e.push("#define HIGHLIGHT")},t.prototype._setEmissiveTextureAndColor=function(e,n,r){var o=this._meshes[e.uniqueId];o?this._emissiveTextureAndColor.color.set(o.color.r,o.color.g,o.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),o&&o.glowEmissiveOnly&&r?(this._emissiveTextureAndColor.texture=r.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add(function(n){n.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(n){n.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var n=this._excludedMeshes[e.uniqueId];n&&(n.beforeBind&&e.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&e.onAfterRenderObservable.remove(n.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(e){return!!this._meshes&&!!i.prototype.hasMesh.call(this,e)&&this._meshes[e.uniqueId]!==void 0&&this._meshes[e.uniqueId]!==null},t.prototype.addMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),this._meshes){var l=this._meshes[e.uniqueId];l?l.color=n:(this._meshes[e.uniqueId]={mesh:e,color:n,observerHighlight:e.onBeforeBindObservable.add(function(h){o.isEnabled&&(o._excludedMeshes&&o._excludedMeshes[h.uniqueId]?o._defaultStencilReference(h):h.getScene().getEngine().setStencilFunctionReference(o._instanceGlowingMeshStencilReference))}),observerDefault:e.onAfterRenderObservable.add(function(h){o.isEnabled&&o._defaultStencilReference(h)}),glowEmissiveOnly:r},e.onDisposeObservable.add(function(){o._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var n=this._meshes[e.uniqueId];for(var r in n&&(n.observerHighlight&&e.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&e.onAfterRenderObservable.remove(n.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[r]){this._shouldRender=!0;break}}},t.prototype.removeAllMeshes=function(){if(this._meshes){for(var e in this._meshes)if(this._meshes.hasOwnProperty(e)){var n=this._meshes[e];n&&this.removeMesh(n.mesh)}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var e in this._meshes)(n=this._meshes[e])&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var e in this._excludedMeshes){var n;(n=this._excludedMeshes[e])&&(n.beforeBind&&n.mesh.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}i.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=V.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var n in this._meshes){var r=this._meshes[n];r&&e.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var o in this._excludedMeshes){var l=this._excludedMeshes[o];l&&e.excludedMeshes.push(l.mesh.id)}return e},t.Parse=function(e,n,r){var o,l=V.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(o=0;o<e.excludedMeshes.length;o++)(h=n.getMeshByID(e.excludedMeshes[o]))&&l.addExcludedMesh(h);for(o=0;o<e.meshes.length;o++){var h,v=e.meshes[o];(h=n.getMeshByID(v.meshId))&&l.addMesh(h,x.a.FromArray(v.color),v.glowEmissiveOnly)}return l},t.EffectName="HighlightLayer",t.NeutralColor=new x.b(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,Object(_.c)([Object(V.c)()],t.prototype,"innerGlow",void 0),Object(_.c)([Object(V.c)()],t.prototype,"outerGlow",void 0),Object(_.c)([Object(V.c)()],t.prototype,"blurHorizontalSize",null),Object(_.c)([Object(V.c)()],t.prototype,"blurVerticalSize",null),Object(_.c)([Object(V.c)("options")],t.prototype,"_options",void 0),t}(il);M.a.RegisteredTypes["BABYLON.HighlightLayer"]=Kp;var Jy=function(){function i(t){this.name=ct.a.NAME_LAYER,this.scene=t,this._engine=t.getEngine(),t.layers=new Array}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(ct.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(ct.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(ct.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(ct.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},i.prototype.rebuild=function(){for(var t=0,e=this.scene.layers;t<e.length;t++)e[t]._rebuild()},i.prototype.dispose=function(){for(var t=this.scene.layers;t.length;)t[0].dispose()},i.prototype._draw=function(t){var e=this.scene.layers;if(e.length){this._engine.setDepthBuffer(!1);for(var n=0,r=e;n<r.length;n++){var o=r[n];t(o)&&o.render()}this._engine.setDepthBuffer(!0)}},i.prototype._drawCameraPredicate=function(t,e,n){return!t.renderOnlyInRenderTargetTextures&&t.isBackground===e&&(t.layerMask&n)!=0},i.prototype._drawCameraBackground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!0,t.layerMask)})},i.prototype._drawCameraForeground=function(t){var e=this;this._draw(function(n){return e._drawCameraPredicate(n,!1,t.layerMask)})},i.prototype._drawRenderTargetPredicate=function(t,e,n,r){return t.renderTargetTextures.length>0&&t.isBackground===e&&t.renderTargetTextures.indexOf(r)>-1&&(t.layerMask&n)!=0},i.prototype._drawRenderTargetBackground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!0,e.scene.activeCamera.layerMask,t)})},i.prototype._drawRenderTargetForeground=function(t){var e=this;this._draw(function(n){return e._drawRenderTargetPredicate(n,!1,e.scene.activeCamera.layerMask,t)})},i.prototype.addFromContainer=function(t){var e=this;t.layers&&t.layers.forEach(function(n){e.scene.layers.push(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;e===void 0&&(e=!1),t.layers&&t.layers.forEach(function(r){var o=n.scene.layers.indexOf(r);o!==-1&&n.scene.layers.splice(o,1),e&&r.dispose()})},i}(),RD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;

#include<helperFunctions>
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef LINEAR
baseColor.rgb=toGammaSpace(baseColor.rgb);
#endif
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`;We.a.ShadersStore.layerPixelShader=RD;var OD=`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`;We.a.ShadersStore.layerVertexShader=OD;var MD=function(){function i(t,e,n,r,o){this.name=t,this.scale=new d.d(1,1),this.offset=new d.d(0,0),this.alphaBlendingMode=g.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new E.c,this.onBeforeRenderObservable=new E.c,this.onAfterRenderObservable=new E.c,this.texture=e?new Ve.a(e,n,!0):null,this.isBackground=r===void 0||r,this.color=o===void 0?new x.b(1,1,1,1):o,this._scene=n||$.a.LastCreatedScene;var l=this._scene._getComponent(ct.a.NAME_LAYER);l||(l=new Jy(this._scene),this._scene._addComponent(l)),this._scene.layers.push(this);var h=this._scene.getEngine(),v=[];v.push(1,1),v.push(-1,1),v.push(-1,-1),v.push(1,-1);var b=new Me.b(h,v,Me.b.PositionKind,!1,!1,2);this._vertexBuffers[Me.b.PositionKind]=b,this._createIndexBuffer()}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),i.prototype._createIndexBuffer=function(){var t=this._scene.getEngine(),e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=t.createIndexBuffer(e)},i.prototype._rebuild=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.render=function(){var t=this._scene.getEngine(),e="";this.alphaTest&&(e="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(e+=`\r
#define LINEAR`),this._previousDefines!==e&&(this._previousDefines=e,this._effect=t.createEffect("layer",[Me.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],e));var n=this._effect;n&&n.isReady()&&this.texture&&this.texture.isReady()&&(t=this._scene.getEngine(),this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(n),t.setState(!1),n.setTexture("textureSampler",this.texture),n.setMatrix("textureMatrix",this.texture.getTextureMatrix()),n.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),n.setVector2("offset",this.offset),n.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,n),this.alphaTest?t.drawElementsType(nn.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(nn.a.TriangleFillMode,0,6),t.setAlphaMode(g.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this))},i.prototype.dispose=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[Me.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},i}(),e0=function(){function i(t,e,n,r,o){this.size=t,this.position=e,this.alphaMode=g.a.ALPHA_ONEONE,this.color=n||new x.a(1,1,1),this.texture=r?new Ve.a(r,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return i.AddFlare=function(t,e,n,r,o){return new i(t,e,n,r,o)},i.prototype.dispose=function(){this.texture&&this.texture.dispose();var t=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(t,1)},i}(),ID=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`;We.a.ShadersStore.lensFlarePixelShader=ID;var DD=`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`;We.a.ShadersStore.lensFlareVertexShader=DD;var Qp=function(){function i(t,e,n){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=n||$.a.LastCreatedScene,i._SceneComponentInitialization(this._scene),this._emitter=e,this.id=t,n.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(h){return n.activeCamera&&h.material&&h.isVisible&&h.isEnabled()&&h.isBlocker&&(h.layerMask&n.activeCamera.layerMask)!=0};var r=n.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[Me.b.PositionKind]=new Me.b(r,o,Me.b.PositionKind,!1,!1,2);var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=r.createIndexBuffer(l),this._effect=r.createEffect("lensFlare",[Me.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype.getEmitter=function(){return this._emitter},i.prototype.setEmitter=function(t){this._emitter=t},i.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},i.prototype.computeEffectivePosition=function(t){var e=this.getEmitterPosition();return e=d.e.Project(e,d.a.Identity(),this._scene.getTransformMatrix(),t),this._positionX=e.x,this._positionY=e.y,e=d.e.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(t.x-=this.viewportBorder,t.y-=this.viewportBorder,t.width+=2*this.viewportBorder,t.height+=2*this.viewportBorder,e.x+=this.viewportBorder,e.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),e.z>0&&(this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&(this._positionY,t.y,t.height),!0)},i.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var t=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),e=t.length();t.normalize();var n=new Bn.a(this._scene.activeCamera.globalPosition,t),r=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>e},i.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var t,e,n=this._scene.getEngine(),r=this._scene.activeCamera.viewport.toGlobal(n.getRenderWidth(!0),n.getRenderHeight(!0));if(!this.computeEffectivePosition(r)||!this._isVisible())return!1;var o=(t=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0)>(e=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0)?t:e;(o-=this.viewportBorder)>this.borderLimit&&(o=this.borderLimit);var l=1-se.a.Clamp(o/this.borderLimit,0,1);if(l<0)return!1;l>1&&(l=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var h=r.x+r.width/2,v=r.y+r.height/2,b=h-this._positionX,A=v-this._positionY;n.enableEffect(this._effect),n.setState(!1),n.setDepthBuffer(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var D=0;D<this.lensFlares.length;D++){var N=this.lensFlares[D];if(!N.texture||N.texture.isReady()){n.setAlphaMode(N.alphaMode);var j=h-b*N.position,k=v-A*N.position,H=N.size,J=N.size*n.getAspectRatio(this._scene.activeCamera,!0),te=j/(r.width+2*r.x)*2-1,oe=1-k/(r.height+2*r.y)*2,ce=d.a.FromValues(H/2,0,0,0,0,J/2,0,0,0,0,1,0,te,oe,0,1);this._effect.setMatrix("viewportMatrix",ce),this._effect.setTexture("textureSampler",N.texture),this._effect.setFloat4("color",N.color.r*l,N.color.g*l,N.color.b*l,1),n.drawElementsType(nn.a.TriangleFillMode,0,6)}}return n.setDepthBuffer(!0),n.setAlphaMode(g.a.ALPHA_DISABLE),!0},i.prototype.dispose=function(){var t=this._vertexBuffers[Me.b.PositionKind];for(t&&(t.dispose(),this._vertexBuffers[Me.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var e=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(e,1)},i.Parse=function(t,e,n){var r=e.getLastEntryByID(t.emitterId),o=t.name||"lensFlareSystem#"+t.emitterId,l=new i(o,r,e);l.id=t.id||o,l.borderLimit=t.borderLimit;for(var h=0;h<t.flares.length;h++){var v=t.flares[h];e0.AddFlare(v.size,v.position,x.a.FromArray(v.color),v.textureName?n+v.textureName:"",l)}return l},i.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var e=0;e<this.lensFlares.length;e++){var n=this.lensFlares[e];t.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:Qe.b.GetFilename(n.texture?n.texture.name:"")})}return t},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("LensFlareSystemSceneComponent")},i}();T.a.AddParser(ct.a.NAME_LENSFLARESYSTEM,function(i,t,e,n){if(i.lensFlareSystems!==void 0&&i.lensFlareSystems!==null){e.lensFlareSystems||(e.lensFlareSystems=new Array);for(var r=0,o=i.lensFlareSystems.length;r<o;r++){var l=i.lensFlareSystems[r],h=Qp.Parse(l,t,n);e.lensFlareSystems.push(h)}}}),T.a.prototype.getLensFlareSystemByName=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===i)return this.lensFlareSystems[t];return null},T.a.prototype.getLensFlareSystemByID=function(i){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===i)return this.lensFlareSystems[t];return null},T.a.prototype.removeLensFlareSystem=function(i){var t=this.lensFlareSystems.indexOf(i);return t!==-1&&this.lensFlareSystems.splice(t,1),t},T.a.prototype.addLensFlareSystem=function(i){this.lensFlareSystems.push(i)};var t0=function(){function i(t){this.name=ct.a.NAME_LENSFLARESYSTEM,this.scene=t,t.lensFlareSystems=new Array}return i.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(ct.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},i.prototype.rebuild=function(){},i.prototype.addFromContainer=function(t){var e=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(n){e.scene.addLensFlareSystem(n)})},i.prototype.removeFromContainer=function(t,e){var n=this;t.lensFlareSystems&&t.lensFlareSystems.forEach(function(r){n.scene.removeLensFlareSystem(r),e&&r.dispose()})},i.prototype.serialize=function(t){t.lensFlareSystems=[];for(var e=0,n=this.scene.lensFlareSystems;e<n.length;e++){var r=n[e];t.lensFlareSystems.push(r.serialize())}},i.prototype.dispose=function(){for(var t=this.scene.lensFlareSystems;t.length;)t[0].dispose()},i.prototype._draw=function(t){if(this.scene.lensFlaresEnabled){var e=this.scene.lensFlareSystems;Qe.b.StartPerformanceCounter("Lens flares",e.length>0);for(var n=0,r=e;n<r.length;n++){var o=r[n];(t.layerMask&o.layerMask)!=0&&o.render()}Qe.b.EndPerformanceCounter("Lens flares",e.length>0)}},i}();Qp._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_LENSFLARESYSTEM);t||(t=new t0(i),i._addComponent(t))};var wD=`




float bayerDither2(vec2 _P) {
return mod(2.0*_P.y+_P.x+1.0,4.0);
}


float bayerDither4(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
return 4.0*bayerDither2(P1)+bayerDither2(P2);
}

float bayerDither8(vec2 _P) {
vec2 P1=mod(_P,2.0);
vec2 P2=floor(0.5*mod(_P,4.0));
vec2 P4=floor(0.25*mod(_P,8.0));
return 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);
}
`;We.a.IncludesShadersStore.bayerDitherFunctions=wD;var LD=`#if SM_FLOAT == 0
#include<packingFunctions>
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#include<bayerDitherFunctions>
uniform float softTransparentShadowSM;
#endif
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
uniform vec3 lightDataSM;
varying vec3 vPositionWSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;We.a.IncludesShadersStore.shadowMapFragmentDeclaration=LD;var ND=` float depthSM=vDepthMetricSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
#if SM_USEDISTANCE == 1
depthSM=clamp(((length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#else
depthSM=clamp(((zSM+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);
#endif
gl_FragDepth=depthSM;
#elif SM_USEDISTANCE == 1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y)+biasAndScaleSM.x;
#endif
#if SM_ESM == 1
depthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);
#endif
#if SM_FLOAT == 1
gl_FragColor=vec4(depthSM,1.0,1.0,1.0);
#else
gl_FragColor=pack(depthSM);
#endif
return;`;We.a.IncludesShadersStore.shadowMapFragment=ND;var FD=`#include<shadowMapFragmentDeclaration>
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void)
{
#include<clipPlaneFragment>
#ifdef ALPHATEST
float alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;
if (alphaFromAlphaTexture<0.4)
discard;
#endif
#if SM_SOFTTRANSPARENTSHADOW == 1
#ifdef ALPHATEST
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;
#else
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;
#endif
#endif
#include<shadowMapFragment>
}`;We.a.ShadersStore.shadowMapPixelShader=FD;var BD=`#if SM_NORMALBIAS == 1
uniform vec3 lightDataSM;
#endif
uniform vec3 biasAndScaleSM;
uniform vec2 depthValuesSM;
varying float vDepthMetricSM;
#if SM_USEDISTANCE == 1
varying vec3 vPositionWSM;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
varying float zSM;
#endif
`;We.a.IncludesShadersStore.shadowMapVertexDeclaration=BD;var UD=`
#if SM_NORMALBIAS == 1
#if SM_DIRECTIONINLIGHTDATA == 1
vec3 worldLightDirSM=normalize(-lightDataSM.xyz);
#else
vec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;
vec3 worldLightDirSM=normalize(directionToLightSM);
#endif
float ndlSM=dot(vNormalW,worldLightDirSM);
float sinNLSM=sqrt(1.0-ndlSM*ndlSM);
float normalBiasSM=biasAndScaleSM.y*sinNLSM;
worldPos.xyz-=vNormalW*normalBiasSM;
#endif
`;We.a.IncludesShadersStore.shadowMapVertexNormalBias=UD;var VD=`#if SM_USEDISTANCE == 1
vPositionWSM=worldPos.xyz;
#endif
#if SM_DEPTHTEXTURE == 1

gl_Position.z+=biasAndScaleSM.x*gl_Position.w;
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1
zSM=gl_Position.z;
gl_Position.z=0.0;
#elif SM_USEDISTANCE == 0

vDepthMetricSM=((gl_Position.z+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x;
#endif
`;We.a.IncludesShadersStore.shadowMapVertexMetric=VD;var kD=`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<shadowMapVertexDeclaration>
#include<clipPlaneVertexDeclaration>
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normWorldSM=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));
vNormalW=normalize(normWorldSM*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normWorldSM=transposeMat3(inverseMat3(normWorldSM));
#endif
vec3 vNormalW=normalize(normWorldSM*normalUpdated);
#endif
#endif
#include<shadowMapVertexNormalBias>

gl_Position=viewProjection*worldPos;
#include<shadowMapVertexMetric>
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<clipPlaneVertex>
}`;We.a.ShadersStore.shadowMapVertexShader=kD;var jD=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`;We.a.ShadersStore.depthBoxBlurPixelShader=jD;var zD=`#if SM_SOFTTRANSPARENTSHADOW == 1
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;
#endif
`;We.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow=zD;var n0=new d.a,r0=new d.a,Dr=function(){function i(t,e,n){this.onBeforeShadowMapRenderObservable=new E.c,this.onAfterShadowMapRenderObservable=new E.c,this.onBeforeShadowMapRenderMeshObservable=new E.c,this.onAfterShadowMapRenderMeshObservable=new E.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=i.FILTER_NONE,this._filteringQuality=i.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=d.e.Zero(),this._viewMatrix=d.a.Zero(),this._projectionMatrix=d.a.Zero(),this._transformMatrix=d.a.Zero(),this._cachedPosition=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=d.a.Identity(),this._mapSize=t,this._light=e,this._scene=e.getScene(),e._shadowGenerator=this,this.id=e.id,i._SceneComponentInitialization(this._scene);var r=this._scene.getEngine().getCaps();n?r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_HALF_FLOAT:r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=g.a.TEXTURETYPE_FLOAT:this._textureType=g.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(i.prototype,"bias",{get:function(){return this._bias},set:function(t){this._bias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"normalBias",{get:function(){return this._normalBias},set:function(t){this._normalBias=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(t){this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurScale",{get:function(){return this._blurScale},set:function(t){this._blurScale!==t&&(this._blurScale=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(t){this._blurKernel!==t&&(this._blurKernel=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(t){this._useKernelBlur!==t&&(this._useKernelBlur=t,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthScale",{get:function(){return this._depthScale!==void 0?this._depthScale:this._light.getDepthScale()},set:function(t){this._depthScale=t},enumerable:!1,configurable:!0}),i.prototype._validateFilter=function(t){return t},Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},set:function(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===i.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===i.FILTER_PCF||t===i.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==i.FILTER_PCF&&t!==i.FILTER_PCSS||this._scene.getEngine().webGLVersion!==1?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePoissonSampling",{get:function(){return this.filter===i.FILTER_POISSONSAMPLING},set:function(t){var e=this._validateFilter(i.FILTER_POISSONSAMPLING);(t||this.filter===i.FILTER_POISSONSAMPLING)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useExponentialShadowMap",{get:function(){return this.filter===i.FILTER_EXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){var e=this._validateFilter(i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===i.FILTER_PCF},set:function(t){var e=this._validateFilter(i.FILTER_PCF);(t||this.filter===i.FILTER_PCF)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(t){this._filteringQuality!==t&&(this._filteringQuality=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useContactHardeningShadow",{get:function(){return this.filter===i.FILTER_PCSS},set:function(t){var e=this._validateFilter(i.FILTER_PCSS);(t||this.filter===i.FILTER_PCSS)&&(this.filter=t?e:i.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(t){this._contactHardeningLightSizeUVRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"darkness",{get:function(){return this._darkness},set:function(t){this.setDarkness(t)},enumerable:!1,configurable:!0}),i.prototype.getDarkness=function(){return this._darkness},i.prototype.setDarkness=function(t){return this._darkness=t>=1?1:t<=0?0:t,this},Object.defineProperty(i.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(t){this.setTransparencyShadow(t)},enumerable:!1,configurable:!0}),i.prototype.setTransparencyShadow=function(t){return this._transparencyShadow=t,this},i.prototype.getShadowMap=function(){return this._shadowMap},i.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},i.prototype.getClassName=function(){return i.CLASSNAME},i.prototype.addShadowCaster=function(t,e){var n;return e===void 0&&(e=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(t),e&&(n=this._shadowMap.renderList).push.apply(n,t.getChildMeshes()),this):this},i.prototype.removeShadowCaster=function(t,e){if(e===void 0&&(e=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var n=this._shadowMap.renderList.indexOf(t);if(n!==-1&&this._shadowMap.renderList.splice(n,1),e)for(var r=0,o=t.getChildren();r<o.length;r++){var l=o[r];this.removeShadowCaster(l)}return this},i.prototype.getLight=function(){return this._light},Object.defineProperty(i.prototype,"mapSize",{get:function(){return this._mapSize},set:function(t){this._mapSize=t,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()},enumerable:!1,configurable:!0}),i.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},i.prototype._createTargetRenderTexture=function(){this._scene.getEngine().webGLVersion>1?(this._shadowMap=new Un(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)):this._shadowMap=new Un(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},i.prototype._initializeShadowMap=function(){var t=this;if(this._createTargetRenderTexture(),this._shadowMap!==null){this._shadowMap.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.customIsReadyFunction=function(l,h){return!0};var e=this._scene.getEngine();this._shadowMap.onBeforeRenderObservable.add(function(l){if(t._currentFaceIndex=l,t._filter===i.FILTER_PCF&&e.setColorWrite(!1),t._scene.getSceneUniformBuffer().useUbo){var h=t._scene.getSceneUniformBuffer();h.updateMatrix("viewProjection",t.getTransformMatrix()),h.updateMatrix("view",t._viewMatrix),h.update()}}),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._scene.getSceneUniformBuffer().useUbo){var l=t._scene.getSceneUniformBuffer();l.updateMatrix("viewProjection",t._scene.getTransformMatrix()),l.updateMatrix("view",t._scene.getViewMatrix()),l.update()}if(t._filter===i.FILTER_PCF&&e.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var h=t.getShadowMapForRendering();if(h){var v=h.getInternalTexture();t._scene.postProcessManager.directRender(t._blurPostProcesses,v,!0),e.unBindFramebuffer(v,!0)}}});var n=new x.b(0,0,0,0),r=new x.b(1,1,1,1);this._shadowMap.onClearObservable.add(function(l){t._filter===i.FILTER_PCF?l.clear(r,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?l.clear(n,!0,!0,!1):l.clear(r,!0,!0,!1)}),this._shadowMap.onResizeObservable.add(function(l){t._storedUniqueId=t._shadowMap.uniqueId,t._mapSize=l.getRenderSize(),t._light._markMeshesAsLightDirty(),t.recreateShadowMap()});for(var o=Xc.b.MIN_RENDERINGGROUPS;o<Xc.b.MAX_RENDERINGGROUPS;o++)this._shadowMap.setRenderingAutoClearDepthStencil(o,!1)}},i.prototype._initializeBlurRTTAndPostProcesses=function(){var t=this,e=this._scene.getEngine(),n=this._mapSize/this.blurScale;this.useKernelBlur&&this.blurScale===1||(this._shadowMap2=new Un(this._light.name+"_shadowMap2",n,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new Yn(this._light.name+"KernelBlurX",new d.d(1,0),this.blurKernel,1,null,Ve.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.width=n,this._kernelBlurXPostprocess.height=n,this._kernelBlurXPostprocess.onApplyObservable.add(function(r){r.setTexture("textureSampler",t._shadowMap)}),this._kernelBlurYPostprocess=new Yn(this._light.name+"KernelBlurY",new d.d(0,1),this.blurKernel,1,null,Ve.a.BILINEAR_SAMPLINGMODE,e,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===g.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new bt(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Ve.a.BILINEAR_SAMPLINGMODE,e,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(r){r.setFloat2("screenSize",n,n),r.setTexture("textureSampler",t._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},i.prototype._renderForShadowMap=function(t,e,n,r){var o,l=this._scene.getEngine(),h=l.getColorWrite();if(r.length){for(l.setColorWrite(!1),o=0;o<r.length;o++)this._renderSubMeshForShadowMap(r.data[o]);l.setColorWrite(h)}for(o=0;o<t.length;o++)this._renderSubMeshForShadowMap(t.data[o]);for(o=0;o<e.length;o++)this._renderSubMeshForShadowMap(e.data[o]);if(this._transparencyShadow)for(o=0;o<n.length;o++)this._renderSubMeshForShadowMap(n.data[o],!0);else for(o=0;o<n.length;o++)n.data[o].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1},i.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(t,e,n,r){var o,l,h,v,b,A;e.setMatrix((o=n==null?void 0:n.viewProjection)!==null&&o!==void 0?o:"viewProjection",this.getTransformMatrix()),e.setMatrix((l=n==null?void 0:n.view)!==null&&l!==void 0?l:"view",this._viewMatrix),e.setMatrix((h=n==null?void 0:n.projection)!==null&&h!==void 0?h:"projection",this._projectionMatrix);var D=r.getWorldMatrix();e.setMatrix((v=n==null?void 0:n.world)!==null&&v!==void 0?v:"world",D),D.multiplyToRef(this.getTransformMatrix(),n0),e.setMatrix((b=n==null?void 0:n.worldViewProjection)!==null&&b!==void 0?b:"worldViewProjection",n0),D.multiplyToRef(this._viewMatrix,r0),e.setMatrix((A=n==null?void 0:n.worldView)!==null&&A!==void 0?A:"worldView",r0)},i.prototype._renderSubMeshForShadowMap=function(t,e){var n,r;e===void 0&&(e=!1);var o=t.getRenderingMesh(),l=t.getEffectiveMesh(),h=this._scene,v=h.getEngine(),b=t.getMaterial();if(l._internalAbstractMeshDataInfo._isActiveIntermediate=!1,b&&t.verticesCount!==0&&t._renderId!==h.getRenderId()){v.setState(b.backFaceCulling);var A=o._getInstancesRenderList(t._id,!!t.getReplacementMesh());if(!A.mustReturn){var D=v.getCaps().instancedArrays&&(A.visibleInstances[t._id]!==null&&A.visibleInstances[t._id]!==void 0||o.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(t))if(this.isReady(t,D,e)){t._renderId=h.getRenderId();var N=(n=o.material)===null||n===void 0?void 0:n.shadowDepthWrapper,j=(r=N==null?void 0:N.getEffect(t,this))!==null&&r!==void 0?r:this._effect;if(v.enableEffect(j),o._bind(t,j,b.fillMode),this.getTransformMatrix(),j.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===ro.a.LIGHTTYPEID_DIRECTIONALLIGHT?j.setVector3("lightDataSM",this._cachedDirection):j.setVector3("lightDataSM",this._cachedPosition),h.activeCamera&&j.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(h.activeCamera),this.getLight().getDepthMinZ(h.activeCamera)+this.getLight().getDepthMaxZ(h.activeCamera)),e&&this.enableSoftTransparentShadow&&j.setFloat("softTransparentShadowSM",l.visibility),N)t._effectOverride=j,N.standalone?N.baseMaterial.bindForSubMesh(l.getWorldMatrix(),o,t):b.bindForSubMesh(l.getWorldMatrix(),o,t),t._effectOverride=null;else{if(j.setMatrix("viewProjection",this.getTransformMatrix()),b&&b.needAlphaTesting()){var k=b.getAlphaTestTexture();k&&(j.setTexture("diffuseSampler",k),j.setMatrix("diffuseMatrix",k.getTextureMatrix()||this._defaultTextureMatrix))}if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){var H=o.skeleton;if(H.isUsingTextureForMatrices){var J=H.getTransformMatrixTexture(o);if(!J)return;j.setTexture("boneSampler",J),j.setFloat("boneTextureWidth",4*(H.bones.length+1))}else j.setMatrices("mBones",H.getTransformMatrices(o))}ot.a.BindMorphTargetParameters(o,j),ot.a.BindClipPlane(j,h)}this._bindCustomEffectForRenderSubMeshForShadowMap(t,j,N==null?void 0:N._matriceNames,l),this.forceBackFacesOnly&&v.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(o),this.onBeforeShadowMapRenderObservable.notifyObservers(j),o._processRendering(l,t,j,b.fillMode,A,D,function(te,oe){return j.setMatrix("world",oe)}),this.forceBackFacesOnly&&v.setState(!0,0,!1,!1),this.onAfterShadowMapRenderObservable.notifyObservers(j),this.onAfterShadowMapRenderMeshObservable.notifyObservers(o)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},i.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===i.FILTER_NONE||this.filter===i.FILTER_PCSS?this._shadowMap.updateSamplingMode(Ve.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(Ve.a.BILINEAR_SAMPLINGMODE))},i.prototype.forceCompilation=function(t,e){var n=this,r=Object(_.a)({useInstances:!1},e),o=this.getShadowMap();if(o){var l=o.renderList;if(l){for(var h=new Array,v=0,b=l;v<b.length;v++){var A=b[v];h.push.apply(h,A.subMeshes)}if(h.length!==0){var D=0,N=function(){var j,k;if(n._scene&&n._scene.getEngine()){for(;n.isReady(h[D],r.useInstances,(k=(j=h[D].getMaterial())===null||j===void 0?void 0:j.needAlphaBlendingForMesh(h[D].getMesh()))!==null&&k!==void 0&&k);)if(++D>=h.length)return void(t&&t(n));setTimeout(N,16)}};N()}else t&&t(this)}else t&&t(this)}else t&&t(this)},i.prototype.forceCompilationAsync=function(t){var e=this;return new Promise(function(n){e.forceCompilation(function(){n()},t)})},i.prototype._isReadyCustomDefines=function(t,e,n){},i.prototype._prepareShadowDefines=function(t,e,n,r){n.push("#define SM_FLOAT "+(this._textureType!==g.a.TEXTURETYPE_UNSIGNED_INT?"1":"0")),n.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),n.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));var o=t.getMesh();return n.push("#define SM_NORMALBIAS "+(this.normalBias&&o.isVerticesDataPresent(Me.b.NormalKind)?"1":"0")),n.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===ro.a.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),n.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),n.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&r?"1":"0")),this._isReadyCustomDefines(n,t,e),n},i.prototype.isReady=function(t,e,n){var r=t.getMaterial(),o=r==null?void 0:r.shadowDepthWrapper,l=[];if(this._prepareShadowDefines(t,e,l,n),o){if(!o.isReadyForSubMesh(t,l,this,e))return!1}else{var h=[Me.b.PositionKind],v=t.getMesh();if(this.normalBias&&v.isVerticesDataPresent(Me.b.NormalKind)&&(h.push(Me.b.NormalKind),l.push("#define NORMAL"),v.nonUniformScaling&&l.push("#define NONUNIFORMSCALING")),r&&r.needAlphaTesting()){var b=r.getAlphaTestTexture();if(b){if(!b.isReady())return!1;l.push("#define ALPHATEST"),v.isVerticesDataPresent(Me.b.UVKind)&&(h.push(Me.b.UVKind),l.push("#define UV1")),v.isVerticesDataPresent(Me.b.UV2Kind)&&b.coordinatesIndex===1&&(h.push(Me.b.UV2Kind),l.push("#define UV2"))}}var A=new ms.a;if(v.useBones&&v.computeBonesUsingShaders&&v.skeleton){h.push(Me.b.MatricesIndicesKind),h.push(Me.b.MatricesWeightsKind),v.numBoneInfluencers>4&&(h.push(Me.b.MatricesIndicesExtraKind),h.push(Me.b.MatricesWeightsExtraKind));var D=v.skeleton;l.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),v.numBoneInfluencers>0&&A.addCPUSkinningFallback(0,v),D.isUsingTextureForMatrices?l.push("#define BONETEXTURE"):l.push("#define BonesPerMesh "+(D.bones.length+1))}else l.push("#define NUM_BONE_INFLUENCERS 0");var N=v.morphTargetManager,j=0;N&&N.numInfluencers>0&&(l.push("#define MORPHTARGETS"),j=N.numInfluencers,l.push("#define NUM_MORPH_INFLUENCERS "+j),ot.a.PrepareAttributesForMorphTargetsInfluencers(h,v,j));var k=this._scene;if(k.clipPlane&&l.push("#define CLIPPLANE"),k.clipPlane2&&l.push("#define CLIPPLANE2"),k.clipPlane3&&l.push("#define CLIPPLANE3"),k.clipPlane4&&l.push("#define CLIPPLANE4"),k.clipPlane5&&l.push("#define CLIPPLANE5"),k.clipPlane6&&l.push("#define CLIPPLANE6"),e&&(l.push("#define INSTANCES"),ot.a.PushAttributesForInstances(h),t.getRenderingMesh().hasThinInstances&&l.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(var H=0,J=this.customShaderOptions.defines;H<J.length;H++){var te=J[H];l.indexOf(te)===-1&&l.push(te)}var oe=l.join(`
`);if(this._cachedDefines!==oe){this._cachedDefines=oe;var ce="shadowMap",he=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","softTransparentShadowSM"],_e=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(ce=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var ye=0,Ee=this.customShaderOptions.attributes;ye<Ee.length;ye++){var Oe=Ee[ye];h.indexOf(Oe)===-1&&h.push(Oe)}if(this.customShaderOptions.uniforms)for(var Ae=0,xe=this.customShaderOptions.uniforms;Ae<xe.length;Ae++){var Pe=xe[Ae];he.indexOf(Pe)===-1&&he.push(Pe)}if(this.customShaderOptions.samplers)for(var Be=0,Ce=this.customShaderOptions.samplers;Be<Ce.length;Be++){var Ue=Ce[Be];_e.indexOf(Ue)===-1&&_e.push(Ue)}}this._effect=this._scene.getEngine().createEffect(ce,h,he,_e,oe,A,void 0,void 0,{maxSimultaneousMorphTargets:j})}if(!this._effect.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())},i.prototype.prepareDefines=function(t,e){var n=this._scene,r=this._light;n.shadowsEnabled&&r.shadowEnabled&&(t["SHADOW"+e]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+e]=!0,this._filteringQuality===i.QUALITY_LOW?t["SHADOWLOWQUALITY"+e]=!0:this._filteringQuality===i.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+e]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+e]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+e]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+e]=!0),r.needCube()&&(t["SHADOWCUBE"+e]=!0))},i.prototype.bindShadowLight=function(t,e){var n=this._light,r=this._scene;if(r.shadowsEnabled&&n.shadowEnabled){var o=r.activeCamera;if(o){var l=this.getShadowMap();l&&(n.needCube()||e.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===i.FILTER_PCF?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),l.getSize().width,1/l.getSize().width,this.frustumEdgeFalloff,t)):this._filter===i.FILTER_PCSS?(e.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),e.setTexture("depthSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/l.getSize().width,this._contactHardeningLightSizeUVRatio*l.getSize().width,this.frustumEdgeFalloff,t)):(e.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),n._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/l.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),n._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},i.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var e=this._light.position;if(this._light.computeTransformedInformation()&&(e=this._light.transformedPosition),d.e.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),Math.abs(d.e.Dot(this._lightDirection,d.e.Up()))===1&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!e.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(e),this._cachedDirection.copyFrom(this._lightDirection),d.a.LookAtLHToRef(e,e.add(this._lightDirection),d.e.Up(),this._viewMatrix);var n=this.getShadowMap();if(n){var r=n.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},i.prototype.recreateShadowMap=function(){var t=this._shadowMap;if(t){var e=t.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=e}},i.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},i.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},i.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},i.prototype.serialize=function(){var t={},e=this.getShadowMap();if(!e)return t;if(t.className=this.getClassName(),t.lightId=this._light.id,t.id=this._light.id,t.mapSize=e.getRenderSize(),t.forceBackFacesOnly=this.forceBackFacesOnly,t.darkness=this.getDarkness(),t.transparencyShadow=this._transparencyShadow,t.frustumEdgeFalloff=this.frustumEdgeFalloff,t.bias=this.bias,t.normalBias=this.normalBias,t.usePercentageCloserFiltering=this.usePercentageCloserFiltering,t.useContactHardeningShadow=this.useContactHardeningShadow,t.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,t.filteringQuality=this.filteringQuality,t.useExponentialShadowMap=this.useExponentialShadowMap,t.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,t.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,t.usePoissonSampling=this.usePoissonSampling,t.depthScale=this.depthScale,t.blurBoxOffset=this.blurBoxOffset,t.blurKernel=this.blurKernel,t.blurScale=this.blurScale,t.useKernelBlur=this.useKernelBlur,t.renderList=[],e.renderList)for(var n=0;n<e.renderList.length;n++){var r=e.renderList[n];t.renderList.push(r.id)}return t},i.Parse=function(t,e,n){for(var r=e.getLightByID(t.lightId),o=n?n(t.mapSize,r):new i(t.mapSize,r),l=o.getShadowMap(),h=0;h<t.renderList.length;h++)e.getMeshesByID(t.renderList[h]).forEach(function(v){l&&(l.renderList||(l.renderList=[]),l.renderList.push(v))});return t.id!==void 0&&(o.id=t.id),o.forceBackFacesOnly=!!t.forceBackFacesOnly,t.darkness!==void 0&&o.setDarkness(t.darkness),t.transparencyShadow&&o.setTransparencyShadow(!0),t.frustumEdgeFalloff!==void 0&&(o.frustumEdgeFalloff=t.frustumEdgeFalloff),t.bias!==void 0&&(o.bias=t.bias),t.normalBias!==void 0&&(o.normalBias=t.normalBias),t.usePercentageCloserFiltering?o.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?o.useContactHardeningShadow=!0:t.usePoissonSampling?o.usePoissonSampling=!0:t.useExponentialShadowMap?o.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?o.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?o.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?o.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?o.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(o.useBlurExponentialShadowMap=!0),t.contactHardeningLightSizeUVRatio!==void 0&&(o.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),t.filteringQuality!==void 0&&(o.filteringQuality=t.filteringQuality),t.depthScale&&(o.depthScale=t.depthScale),t.blurScale&&(o.blurScale=t.blurScale),t.blurBoxOffset&&(o.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(o.useKernelBlur=t.useKernelBlur),t.blurKernel&&(o.blurKernel=t.blurKernel),o},i.CLASSNAME="ShadowGenerator",i.FILTER_NONE=0,i.FILTER_EXPONENTIALSHADOWMAP=1,i.FILTER_POISSONSAMPLING=2,i.FILTER_BLUREXPONENTIALSHADOWMAP=3,i.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,i.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,i.FILTER_PCF=6,i.FILTER_PCSS=7,i.QUALITY_HIGH=0,i.QUALITY_MEDIUM=1,i.QUALITY_LOW=2,i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("ShadowGeneratorSceneComponent")},i}(),GD=`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
#ifdef PACKED
#include<packingFunctions>
#endif
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#ifdef NONLINEARDEPTH
#ifdef PACKED
gl_FragColor=pack(gl_FragCoord.z);
#else
gl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);
#endif
#else
#ifdef PACKED
gl_FragColor=pack(vDepthMetric);
#else
gl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);
#endif
#endif
}`;We.a.ShadersStore.depthPixelShader=GD;var WD=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
vec3 positionUpdated=position;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;We.a.ShadersStore.depthVertexShader=WD;var fh=function(){function i(t,e,n,r){var o=this;e===void 0&&(e=g.a.TEXTURETYPE_FLOAT),n===void 0&&(n=null),r===void 0&&(r=!1),this.enabled=!0,this.useOnlyInActiveCamera=!1,this._scene=t,this._storeNonLinearDepth=r,this.isPacked=e===g.a.TEXTURETYPE_UNSIGNED_BYTE,this.isPacked?this._clearColor=new x.b(1,1,1,1):this._clearColor=new x.b(1,0,0,1),i._SceneComponentInitialization(this._scene),this._camera=n;var l=t.getEngine(),h=this.isPacked||l.webGLVersion===1?g.a.TEXTUREFORMAT_RGBA:g.a.TEXTUREFORMAT_R;this._depthMap=new Un("depthMap",{width:l.getRenderWidth(),height:l.getRenderHeight()},this._scene,!1,!0,e,!1,void 0,void 0,void 0,void 0,h),this._depthMap.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(b){b.clear(o._clearColor,!0,!0,!0)});var v=function(b){var A=b.getRenderingMesh(),D=b.getEffectiveMesh(),N=o._scene,j=N.getEngine(),k=b.getMaterial();if(D._internalAbstractMeshDataInfo._isActiveIntermediate=!1,k&&b.verticesCount!==0&&b._renderId!==N.getRenderId()){j.setState(k.backFaceCulling,0,!1,N.useRightHandedSystem);var H=A._getInstancesRenderList(b._id,!!b.getReplacementMesh());if(!H.mustReturn){var J=j.getCaps().instancedArrays&&(H.visibleInstances[b._id]!==null&&H.visibleInstances[b._id]!==void 0||A.hasThinInstances),te=o._camera||N.activeCamera;if(o.isReady(b,J)&&te){if(b._renderId=N.getRenderId(),j.enableEffect(o._effect),A._bind(b,o._effect,k.fillMode),o._effect.setMatrix("viewProjection",N.getTransformMatrix()),o._effect.setFloat2("depthValues",te.minZ,te.minZ+te.maxZ),k&&k.needAlphaTesting()){var oe=k.getAlphaTestTexture();oe&&(o._effect.setTexture("diffuseSampler",oe),o._effect.setMatrix("diffuseMatrix",oe.getTextureMatrix()))}A.useBones&&A.computeBonesUsingShaders&&A.skeleton&&o._effect.setMatrices("mBones",A.skeleton.getTransformMatrices(A)),ot.a.BindMorphTargetParameters(A,o._effect),A._processRendering(D,b,o._effect,k.fillMode,H,J,function(ce,he){return o._effect.setMatrix("world",he)})}}}};this._depthMap.customRenderFunction=function(b,A,D,N){var j;if(N.length){for(l.setColorWrite(!1),j=0;j<N.length;j++)v(N.data[j]);l.setColorWrite(!0)}for(j=0;j<b.length;j++)v(b.data[j]);for(j=0;j<A.length;j++)v(A.data[j])}}return i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n.disableDepthWrite)return!1;var r=[],o=[Me.b.PositionKind],l=t.getMesh();n&&n.needAlphaTesting()&&n.getAlphaTestTexture()&&(r.push("#define ALPHATEST"),l.isVerticesDataPresent(Me.b.UVKind)&&(o.push(Me.b.UVKind),r.push("#define UV1")),l.isVerticesDataPresent(Me.b.UV2Kind)&&(o.push(Me.b.UV2Kind),r.push("#define UV2"))),l.useBones&&l.computeBonesUsingShaders?(o.push(Me.b.MatricesIndicesKind),o.push(Me.b.MatricesWeightsKind),l.numBoneInfluencers>4&&(o.push(Me.b.MatricesIndicesExtraKind),o.push(Me.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+l.numBoneInfluencers),r.push("#define BonesPerMesh "+(l.skeleton?l.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var h=l.morphTargetManager,v=0;h&&h.numInfluencers>0&&(v=h.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+v),ot.a.PrepareAttributesForMorphTargetsInfluencers(o,l,v)),e&&(r.push("#define INSTANCES"),ot.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._storeNonLinearDepth&&r.push("#define NONLINEARDEPTH"),this.isPacked&&r.push("#define PACKED");var b=r.join(`
`);return this._cachedDefines!==b&&(this._cachedDefines=b,this._effect=this._scene.getEngine().createEffect("depth",o,["world","mBones","viewProjection","diffuseMatrix","depthValues","morphTargetInfluences"],["diffuseSampler"],b,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype.getDepthMap=function(){return this._depthMap},i.prototype.dispose=function(){this._depthMap.dispose()},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("DepthRendererSceneComponent")},i}(),HD=`attribute vec2 vUV;
uniform sampler2D textureSampler;
#if defined(INITIAL)
uniform sampler2D sourceTexture;
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
float f1=texelFetch(sourceTexture,coord,0).r;
float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;
float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;
float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;
float minz=min(min(min(f1,f2),f3),f4);
#ifdef DEPTH_REDUX
float maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);
#else
float maxz=max(max(max(f1,f2),f3),f4);
#endif
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(MAIN)
uniform vec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*(texSize-1.0));
vec2 f1=texelFetch(textureSampler,coord,0).rg;
vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;
vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;
vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;
float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);
float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(ONEBEFORELAST)
uniform ivec2 texSize;
void main(void)
{
ivec2 coord=ivec2(vUV*vec2(texSize-1));
vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;
vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;
vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;
vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;
float minz=min(f1.x,f2.x);
float maxz=max(f1.y,f2.y);
glFragColor=vec4(minz,maxz,0.,0.);
}
#elif defined(LAST)
void main(void)
{
discard;
glFragColor=vec4(0.);
}
#endif
`;We.a.ShadersStore.minmaxReduxPixelShader=HD;var i0=function(){function i(t){this.onAfterReductionPerformed=new E.c,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=t,this._postProcessManager=new vp.a(t.getScene())}return Object.defineProperty(i.prototype,"sourceTexture",{get:function(){return this._sourceTexture},enumerable:!1,configurable:!0}),i.prototype.setSourceTexture=function(t,e,n,r){var o=this;if(n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0),t!==this._sourceTexture){this.dispose(!1),this._sourceTexture=t,this._reductionSteps=[],this._forceFullscreenViewport=r;var l=this._camera.getScene(),h=new bt("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,g.a.TEXTURE_NEAREST_NEAREST,l.getEngine(),!1,"#define INITIAL"+(e?`
#define DEPTH_REDUX`:""),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);h.autoClear=!1,h.forceFullscreenViewport=r;var v=this._sourceTexture.getRenderWidth(),b=this._sourceTexture.getRenderHeight();h.onApply=function(N,j){return function(k){k.setTexture("sourceTexture",o._sourceTexture),k.setFloatArray2("texSize",new Float32Array([N,j]))}}(v,b),this._reductionSteps.push(h);for(var A=1;v>1||b>1;){v=Math.max(Math.round(v/2),1),b=Math.max(Math.round(b/2),1);var D=new bt("Reduction phase "+A,"minmaxRedux",["texSize"],null,{width:v,height:b},null,g.a.TEXTURE_NEAREST_NEAREST,l.getEngine(),!1,"#define "+(v==1&&b==1?"LAST":v==1||b==1?"ONEBEFORELAST":"MAIN"),n,void 0,void 0,void 0,g.a.TEXTUREFORMAT_RG);D.autoClear=!1,D.forceFullscreenViewport=r,D.onApply=function(N,j){return function(k){N==1||j==1?k.setIntArray2("texSize",new Int32Array([N,j])):k.setFloatArray2("texSize",new Float32Array([N,j]))}}(v,b),this._reductionSteps.push(D),A++,v==1&&b==1&&D.onAfterRenderObservable.add(function(N,j,k){var H=new Float32Array(4*N*j),J={min:0,max:0};return function(){l.getEngine()._readTexturePixels(k.inputTexture,N,j,-1,0,H),J.min=H[0],J.max=H[1],o.onAfterReductionPerformed.notifyObservers(J)}}(v,b,D))}}},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._sourceTexture?this._sourceTexture.refreshRate:-1},set:function(t){this._sourceTexture&&(this._sourceTexture.refreshRate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activated",{get:function(){return this._activated},enumerable:!1,configurable:!0}),i.prototype.activate=function(){var t=this;!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add(function(){t._reductionSteps[0].activate(t._camera),t._postProcessManager.directRender(t._reductionSteps,t._reductionSteps[0].inputTexture,t._forceFullscreenViewport),t._camera.getScene().getEngine().unBindFramebuffer(t._reductionSteps[0].inputTexture,!1)}),this._activated=!0)},i.prototype.deactivate=function(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)},i.prototype.dispose=function(t){if(t===void 0&&(t=!0),t&&this.onAfterReductionPerformed.clear(),this.deactivate(),this._reductionSteps){for(var e=0;e<this._reductionSteps.length;++e)this._reductionSteps[e].dispose();this._reductionSteps=null}this._postProcessManager&&t&&this._postProcessManager.dispose(),this._sourceTexture=null},i}(),o0=function(i){function t(e){return i.call(this,e)||this}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"depthRenderer",{get:function(){return this._depthRenderer},enumerable:!1,configurable:!0}),t.prototype.setDepthRenderer=function(e,n,r){e===void 0&&(e=null),n===void 0&&(n=g.a.TEXTURETYPE_HALF_FLOAT),r===void 0&&(r=!0);var o=this._camera.getScene();this._depthRenderer&&(delete o._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),e===null&&(o._depthRenderer||(o._depthRenderer={}),(e=this._depthRenderer=new fh(o,n,this._camera,!1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,o._depthRenderer[this._depthRendererId]=e),i.prototype.setSourceTexture.call(this,e.getDepthMap(),!0,n,r)},t.prototype.setSourceTexture=function(e,n,r,o){r===void 0&&(r=g.a.TEXTURETYPE_HALF_FLOAT),o===void 0&&(o=!0),i.prototype.setSourceTexture.call(this,e,n,r,o)},t.prototype.activate=function(){this._depthRenderer&&(this._depthRenderer.enabled=!0),i.prototype.activate.call(this)},t.prototype.deactivate=function(){i.prototype.deactivate.call(this),this._depthRenderer&&(this._depthRenderer.enabled=!1)},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),i.prototype.dispose.call(this,e),this._depthRenderer&&e){var n=this._depthRenderer.getDepthMap().getScene();n&&delete n._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}},t}(i0),a0=d.e.Up(),XD=d.e.Zero(),Kn=new d.e,Ts=new d.e,Es=new d.a,s0=new d.a,qp=function(i){function t(e,n,r){var o=this;if(t.IsSupported)return(o=i.call(this,e,n,r)||this).usePercentageCloserFiltering=!0,o;p.a.Error("CascadedShadowMap needs WebGL 2 support.")}return Object(_.d)(t,i),t.prototype._validateFilter=function(e){return e===Dr.FILTER_NONE||e===Dr.FILTER_PCF||e===Dr.FILTER_PCSS?e:(console.error('Unsupported filter "'+e+'"!'),Dr.FILTER_NONE)},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(e){(e=Math.min(Math.max(e,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()},enumerable:!1,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var e=this._shadowMap.renderList,n=0;n<e.length;n++)if(l=e[n]){var r=l.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld)}var o=this._scene.meshes;for(n=0;n<o.length;n++){var l;(l=o[n])&&l.isVisible&&l.isEnabled&&l.receiveShadows&&(r=l.getBoundingInfo().boundingBox,this._scbiMin.minimizeInPlace(r.minimumWorld),this._scbiMax.maximizeInPlace(r.maximumWorld))}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(e){this._shadowCastersBoundingInfo=e},enumerable:!1,configurable:!0}),t.prototype.setMinMaxDistance=function(e,n){this._minDistance===e&&this._maxDistance===n||(e>n&&(e=0,n=1),e<0&&(e=0),n>1&&(n=1),this._minDistance=e,this._maxDistance=n,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null},t.prototype.getCascadeMaxExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(e){this._scene&&this._scene.activeCamera?this._shadowMaxZ===e||e<this._scene.activeCamera.minZ||e>this._scene.activeCamera.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(e){this._depthClamp=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(e){var n=Math.min(Math.max(e,0),1);this._lambda!=n&&(this._lambda=n,this._breaksAreDirty=!0)},enumerable:!1,configurable:!0}),t.prototype.getCascadeViewMatrix=function(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null},t.prototype.getCascadeProjectionMatrix=function(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null},t.prototype.getCascadeTransformMatrix=function(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null},t.prototype.setDepthRenderer=function(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(e){var n=this,r=this._scene.activeCamera;if(r){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new o0(r),this._depthReducer.onAfterReductionPerformed.add(function(o){var l=o.min,h=o.max;l>=h&&(l=0,h=1),l==n._minDistance&&h==n._maxDistance||n.setMinMaxDistance(l,h)}),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var e,n,r;return(r=(n=(e=this._depthReducer)===null||e===void 0?void 0:e.depthRenderer)===null||n===void 0?void 0:n.getDepthMap().refreshRate)!==null&&r!==void 0?r:-1},set:function(e){var n;((n=this._depthReducer)===null||n===void 0?void 0:n.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)},enumerable:!1,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var e=this._scene.activeCamera;if(e){for(var n=e.minZ,r=e.maxZ,o=r-n,l=this._minDistance,h=n+l*o,v=n+(this._shadowMaxZ<r&&this._shadowMaxZ>=n?Math.min((this._shadowMaxZ-n)/(r-n),this._maxDistance):this._maxDistance)*o,b=v-h,A=v/h,D=0;D<this._cascades.length;++D){var N=(D+1)/this._numCascades,j=h*Math.pow(A,N),k=h+b*N,H=this._lambda*(j-k)+k;this._cascades[D].prevBreakDistance=D===0?l:this._cascades[D-1].breakDistance,this._cascades[D].breakDistance=(H-n)/o,this._viewSpaceFrustumsZ[D]=n+this._cascades[D].breakDistance*o,this._frustumLengths[D]=(this._cascades[D].breakDistance-this._cascades[D].prevBreakDistance)*o}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){if(this._scene.activeCamera){d.e.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),Math.abs(d.e.Dot(this._lightDirection,d.e.Up()))===1&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var e=0;e<this._numCascades;++e){this._computeFrustumInWorldSpace(e),this._computeCascadeFrustum(e),this._cascadeMaxExtents[e].subtractToRef(this._cascadeMinExtents[e],Kn),this._frustumCenter[e].addToRef(this._lightDirection.scale(this._cascadeMinExtents[e].z),this._shadowCameraPos[e]),d.a.LookAtLHToRef(this._shadowCameraPos[e],this._frustumCenter[e],a0,this._viewMatrices[e]);var n=0,r=Kn.z,o=this._shadowCastersBoundingInfo;o.update(this._viewMatrices[e]),r=Math.min(r,o.boundingBox.maximumWorld.z),n=this._depthClamp&&this.filter!==Dr.FILTER_PCSS?Math.max(n,o.boundingBox.minimumWorld.z):Math.min(n,o.boundingBox.minimumWorld.z),d.a.OrthoOffCenterLHToRef(this._cascadeMinExtents[e].x,this._cascadeMaxExtents[e].x,this._cascadeMinExtents[e].y,this._cascadeMaxExtents[e].y,n,r,this._projectionMatrices[e]),this._cascadeMinExtents[e].z=n,this._cascadeMaxExtents[e].z=r,this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),d.e.TransformCoordinatesToRef(XD,this._transformMatrices[e],Kn),Kn.scaleInPlace(this._mapSize/2),Ts.copyFromFloats(Math.round(Kn.x),Math.round(Kn.y),Math.round(Kn.z)),Ts.subtractInPlace(Kn).scaleInPlace(2/this._mapSize),d.a.TranslationToRef(Ts.x,Ts.y,0,Es),this._projectionMatrices[e].multiplyToRef(Es,this._projectionMatrices[e]),this._viewMatrices[e].multiplyToRef(this._projectionMatrices[e],this._transformMatrices[e]),this._transformMatrices[e].copyToArray(this._transformMatricesAsArray,16*e)}}},t.prototype._computeFrustumInWorldSpace=function(e){if(this._scene.activeCamera){var n=this._cascades[e].prevBreakDistance,r=this._cascades[e].breakDistance;this._scene.activeCamera.getViewMatrix();for(var o=d.a.Invert(this._scene.activeCamera.getTransformationMatrix()),l=0;l<t.frustumCornersNDCSpace.length;++l)d.e.TransformCoordinatesToRef(t.frustumCornersNDCSpace[l],o,this._frustumCornersWorldSpace[e][l]);for(l=0;l<t.frustumCornersNDCSpace.length/2;++l)Kn.copyFrom(this._frustumCornersWorldSpace[e][l+4]).subtractInPlace(this._frustumCornersWorldSpace[e][l]),Ts.copyFrom(Kn).scaleInPlace(n),Kn.scaleInPlace(r),Kn.addInPlace(this._frustumCornersWorldSpace[e][l]),this._frustumCornersWorldSpace[e][l+4].copyFrom(Kn),this._frustumCornersWorldSpace[e][l].addInPlace(Ts)}},t.prototype._computeCascadeFrustum=function(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._scene.activeCamera){for(var n=0;n<this._frustumCornersWorldSpace[e].length;++n)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][n]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){var r=0;for(n=0;n<this._frustumCornersWorldSpace[e].length;++n){var o=this._frustumCornersWorldSpace[e][n].subtractToRef(this._frustumCenter[e],Kn).length();r=Math.max(r,o)}r=Math.ceil(16*r)/16,this._cascadeMaxExtents[e].copyFromFloats(r,r,r),this._cascadeMinExtents[e].copyFromFloats(-r,-r,-r)}else{var l=this._frustumCenter[e];for(this._frustumCenter[e].addToRef(this._lightDirection,Kn),d.a.LookAtLHToRef(l,Kn,a0,Es),n=0;n<this._frustumCornersWorldSpace[e].length;++n)d.e.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][n],Es,Kn),this._cascadeMinExtents[e].minimizeInPlace(Kn),this._cascadeMaxExtents[e].maximizeInPlace(Kn)}}},Object.defineProperty(t,"IsSupported",{get:function(){var e=$.a.LastCreatedEngine;return!!e&&e.webGLVersion!=1},enumerable:!1,configurable:!0}),t.prototype._initializeGenerator=function(){var e,n,r,o,l,h,v,b,A,D,N,j,k,H,J,te,oe,ce,he,_e;this.penumbraDarkness=(e=this.penumbraDarkness)!==null&&e!==void 0?e:1,this._numCascades=(n=this._numCascades)!==null&&n!==void 0?n:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=(r=this.stabilizeCascades)!==null&&r!==void 0&&r,this._freezeShadowCastersBoundingInfoObservable=(o=this._freezeShadowCastersBoundingInfoObservable)!==null&&o!==void 0?o:null,this.freezeShadowCastersBoundingInfo=(l=this.freezeShadowCastersBoundingInfo)!==null&&l!==void 0&&l,this._scbiMin=(h=this._scbiMin)!==null&&h!==void 0?h:new d.e(0,0,0),this._scbiMax=(v=this._scbiMax)!==null&&v!==void 0?v:new d.e(0,0,0),this._shadowCastersBoundingInfo=(b=this._shadowCastersBoundingInfo)!==null&&b!==void 0?b:new Fo.a(new d.e(0,0,0),new d.e(0,0,0)),this._breaksAreDirty=(A=this._breaksAreDirty)===null||A===void 0||A,this._minDistance=(D=this._minDistance)!==null&&D!==void 0?D:0,this._maxDistance=(N=this._maxDistance)!==null&&N!==void 0?N:1,this._currentLayer=(j=this._currentLayer)!==null&&j!==void 0?j:0,this._shadowMaxZ=(J=(k=this._shadowMaxZ)!==null&&k!==void 0?k:(H=this._scene.activeCamera)===null||H===void 0?void 0:H.maxZ)!==null&&J!==void 0?J:1e4,this._debug=(te=this._debug)!==null&&te!==void 0&&te,this._depthClamp=(oe=this._depthClamp)===null||oe===void 0||oe,this._cascadeBlendPercentage=(ce=this._cascadeBlendPercentage)!==null&&ce!==void 0?ce:.1,this._lambda=(he=this._lambda)!==null&&he!==void 0?he:.5,this._autoCalcDepthBounds=(_e=this._autoCalcDepthBounds)!==null&&_e!==void 0&&_e,i.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var e={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new Un(this._light.name+"_shadowMap",e,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)},t.prototype._initializeShadowMap=function(){var e=this;if(i.prototype._initializeShadowMap.call(this),this._shadowMap!==null){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var n=0;n<this._numCascades;++n){this._cascades[n]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[n]=d.a.Zero(),this._projectionMatrices[n]=d.a.Zero(),this._transformMatrices[n]=d.a.Zero(),this._cascadeMinExtents[n]=new d.e,this._cascadeMaxExtents[n]=new d.e,this._frustumCenter[n]=new d.e,this._shadowCameraPos[n]=new d.e,this._frustumCornersWorldSpace[n]=new Array(t.frustumCornersNDCSpace.length);for(var r=0;r<t.frustumCornersNDCSpace.length;++r)this._frustumCornersWorldSpace[n][r]=new d.e}this._shadowMap.onBeforeRenderObservable.add(function(o){if(e._currentLayer=o,e._scene.getSceneUniformBuffer().useUbo){var l=e._scene.getSceneUniformBuffer();l.updateMatrix("viewProjection",e.getCascadeTransformMatrix(o)),l.updateMatrix("view",e.getCascadeViewMatrix(o)),l.update()}}),this._shadowMap.onBeforeBindObservable.add(function(){e._breaksAreDirty&&e._splitFrustum(),e._computeMatrices()}),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,n,r,o){var l,h,v,b,A,D;n.setMatrix((l=r==null?void 0:r.viewProjection)!==null&&l!==void 0?l:"viewProjection",this.getCascadeTransformMatrix(this._currentLayer)),n.setMatrix((h=r==null?void 0:r.view)!==null&&h!==void 0?h:"view",this.getCascadeViewMatrix(this._currentLayer)),n.setMatrix((v=r==null?void 0:r.projection)!==null&&v!==void 0?v:"projection",this.getCascadeProjectionMatrix(this._currentLayer));var N=o.getWorldMatrix();n.setMatrix((b=r==null?void 0:r.world)!==null&&b!==void 0?b:"world",N),N.multiplyToRef(this.getCascadeTransformMatrix(this._currentLayer),Es),n.setMatrix((A=r==null?void 0:r.worldViewProjection)!==null&&A!==void 0?A:"worldViewProjection",Es),N.multiplyToRef(this.getCascadeViewMatrix(this._currentLayer),s0),n.setMatrix((D=r==null?void 0:r.worldView)!==null&&D!==void 0?D:"worldView",s0)},t.prototype._isReadyCustomDefines=function(e,n,r){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==Dr.FILTER_PCSS?"1":"0"))},t.prototype.prepareDefines=function(e,n){i.prototype.prepareDefines.call(this,e,n);var r=this._scene,o=this._light;if(r.shadowsEnabled&&o.shadowEnabled){e["SHADOWCSM"+n]=!0,e["SHADOWCSMDEBUG"+n]=this.debug,e["SHADOWCSMNUM_CASCADES"+n]=this.numCascades,e["SHADOWCSM_RIGHTHANDED"+n]=r.useRightHandedSystem;var l=r.activeCamera;l&&this._shadowMaxZ<l.maxZ&&(e["SHADOWCSMUSESHADOWMAXZ"+n]=!0),this.cascadeBlendPercentage===0&&(e["SHADOWCSMNOBLEND"+n]=!0)}},t.prototype.bindShadowLight=function(e,n){var r=this._light,o=this._scene;if(o.shadowsEnabled&&r.shadowEnabled){var l=o.activeCamera;if(l){var h=this.getShadowMap();if(h){var v=h.getSize().width;if(n.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),n.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),n.setFloat("cascadeBlendFactor"+e,this.cascadeBlendPercentage===0?1e4:1/this.cascadeBlendPercentage),n.setArray("frustumLengths"+e,this._frustumLengths),this._filter===Dr.FILTER_PCF)n.setDepthStencilTexture("shadowSampler"+e,h),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);else if(this._filter===Dr.FILTER_PCSS){for(var b=0;b<this._numCascades;++b)this._lightSizeUVCorrection[2*b+0]=b===0?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[b].x-this._cascadeMinExtents[b].x),this._lightSizeUVCorrection[2*b+1]=b===0?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[b].y-this._cascadeMinExtents[b].y),this._depthCorrection[b]=b===0?1:(this._cascadeMaxExtents[b].z-this._cascadeMinExtents[b].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);n.setDepthStencilTexture("shadowSampler"+e,h),n.setTexture("depthSampler"+e,h),n.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),n.setArray("depthCorrection"+e,this._depthCorrection),n.setFloat("penumbraDarkness"+e,this.penumbraDarkness),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/v,this._contactHardeningLightSizeUVRatio*v,this.frustumEdgeFalloff,e)}else n.setTexture("shadowSampler"+e,h),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),v,1/v,this.frustumEdgeFalloff,e);r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(l),this.getLight().getDepthMinZ(l)+this.getLight().getDepthMaxZ(l),e)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this),n=this.getShadowMap();if(!n)return e;if(e.numCascades=this._numCascades,e.debug=this._debug,e.stabilizeCascades=this.stabilizeCascades,e.lambda=this._lambda,e.cascadeBlendPercentage=this.cascadeBlendPercentage,e.depthClamp=this._depthClamp,e.autoCalcDepthBounds=this.autoCalcDepthBounds,e.shadowMaxZ=this._shadowMaxZ,e.penumbraDarkness=this.penumbraDarkness,e.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,e.minDistance=this.minDistance,e.maxDistance=this.maxDistance,e.renderList=[],n.renderList)for(var r=0;r<n.renderList.length;r++){var o=n.renderList[r];e.renderList.push(o.id)}return e},t.Parse=function(e,n){var r=Dr.Parse(e,n,function(o,l){return new t(o,l)});return e.numCascades!==void 0&&(r.numCascades=e.numCascades),e.debug!==void 0&&(r.debug=e.debug),e.stabilizeCascades!==void 0&&(r.stabilizeCascades=e.stabilizeCascades),e.lambda!==void 0&&(r.lambda=e.lambda),e.cascadeBlendPercentage!==void 0&&(r.cascadeBlendPercentage=e.cascadeBlendPercentage),e.depthClamp!==void 0&&(r.depthClamp=e.depthClamp),e.autoCalcDepthBounds!==void 0&&(r.autoCalcDepthBounds=e.autoCalcDepthBounds),e.shadowMaxZ!==void 0&&(r.shadowMaxZ=e.shadowMaxZ),e.penumbraDarkness!==void 0&&(r.penumbraDarkness=e.penumbraDarkness),e.freezeShadowCastersBoundingInfo!==void 0&&(r.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),e.minDistance!==void 0&&e.maxDistance!==void 0&&r.setMinMaxDistance(e.minDistance,e.maxDistance),r},t.frustumCornersNDCSpace=[new d.e(-1,1,-1),new d.e(1,1,-1),new d.e(1,-1,-1),new d.e(-1,-1,-1),new d.e(-1,1,1),new d.e(1,1,1),new d.e(1,-1,1),new d.e(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(e){throw rr.a.WarnImport("ShadowGeneratorSceneComponent")},t}(Dr);T.a.AddParser(ct.a.NAME_SHADOWGENERATOR,function(i,t){if(i.shadowGenerators!==void 0&&i.shadowGenerators!==null)for(var e=0,n=i.shadowGenerators.length;e<n;e++){var r=i.shadowGenerators[e];r.className===qp.CLASSNAME?qp.Parse(r,t):Dr.Parse(r,t)}});var c0=function(){function i(t){this.name=ct.a.NAME_SHADOWGENERATOR,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(ct.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.serialize=function(t){t.shadowGenerators=[];for(var e=0,n=this.scene.lights;e<n.length;e++){var r=n[e].getShadowGenerator();r&&t.shadowGenerators.push(r.serialize())}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){var e=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<e.lights.length;n++){var r=e.lights[n],o=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&o){var l=o.getShadowMap();e.textures.indexOf(l)!==-1&&t.push(l)}}},i}();Dr._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_SHADOWGENERATOR);t||(t=new c0(i),i._addComponent(t))},Z.a.AddNodeConstructor("Light_Type_0",function(i,t){return function(){return new Zp(i,d.e.Zero(),t)}});var Zp=function(i){function t(e,n,r){var o=i.call(this,e,r)||this;return o._shadowAngle=Math.PI/2,o.position=n,o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var n=this.needCube();this._direction=e,this.needCube()!==n&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return ro.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(e){if(this.direction)return i.prototype.getShadowDirection.call(this,e);switch(e){case 0:return new d.e(1,0,0);case 1:return new d.e(-1,0,0);case 2:return new d.e(0,-1,0);case 3:return new d.e(0,1,0);case 4:return new d.e(0,0,1);case 5:return new d.e(0,0,-1)}return d.e.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,n,r){var o=this.getScene().activeCamera;o&&d.a.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,n){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,n):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,n),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,n),this},t.prototype.transferToNodeMaterialEffect=function(e,n){return this.computeTransformedInformation()?e.setFloat3(n,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(n,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(e,n){e["POINTLIGHT"+n]=!0},Object(_.c)([Object(V.c)()],t.prototype,"shadowAngle",null),t}(ih),l0=function(){function i(t,e,n){var r=this;e===void 0&&(e=""),n===void 0&&(n="black"),this._renderingCanvas=t,this._loadingText=e,this._loadingDivBackgroundColor=n,this._resizeLoadingUI=function(){var o=r._renderingCanvas.getBoundingClientRect(),l=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position=l==="fixed"?"fixed":"absolute",r._loadingDiv.style.left=o.left+"px",r._loadingDiv.style.top=o.top+"px",r._loadingDiv.style.width=o.width+"px",r._loadingDiv.style.height=o.height+"px")}}return i.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=document.createElement("style");t.type="text/css",t.innerHTML=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`,document.getElementsByTagName("head")[0].appendChild(t);var e=!!window.SVGSVGElement,n=new Image;i.DefaultLogoUrl?n.src=i.DefaultLogoUrl:n.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",n.style.width="150px",n.style.gridColumn="1",n.style.gridRow="1",n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.position="absolute";var r=document.createElement("div");r.style.width="300px",r.style.gridColumn="1",r.style.gridRow="1",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.position="absolute";var o=new Image;if(i.DefaultSpinnerUrl?o.src=i.DefaultSpinnerUrl:o.src=e?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",o.style.animation="spin1 0.75s infinite linear",o.style.webkitAnimation="spin1 0.75s infinite linear",o.style.transformOrigin="50% 50%",o.style.webkitTransformOrigin="50% 50%",!e){var l={w:16,h:18.5},h={w:30,h:30};n.style.width=l.w+"vh",n.style.height=l.h+"vh",n.style.left="calc(50% - "+l.w/2+"vh)",n.style.top="calc(50% - "+l.h/2+"vh)",o.style.width=h.w+"vh",o.style.height=h.h+"vh",o.style.left="calc(50% - "+h.w/2+"vh)",o.style.top="calc(50% - "+h.h/2+"vh)"}r.appendChild(o),this._loadingDiv.appendChild(n),this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},i.prototype.hideLoadingUI=function(){var t=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){t._loadingDiv&&(t._loadingDiv.parentElement&&t._loadingDiv.parentElement.removeChild(t._loadingDiv),window.removeEventListener("resize",t._resizeLoadingUI),t._loadingDiv=null)}))},Object.defineProperty(i.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(t){this._loadingText=t,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(t){this._loadingDivBackgroundColor=t,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!1,configurable:!0}),i.DefaultLogoUrl="",i.DefaultSpinnerUrl="",i}();Xe.a.DefaultLoadingScreenFactory=function(i){return new l0(i)};var $p=c(71),Aa=c(68),Jp=function(){function i(){}return i.ConvertPanoramaToCubemap=function(t,e,n,r){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*n*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(r,this.FACE_FRONT,t,e,n),back:this.CreateCubemapTexture(r,this.FACE_BACK,t,e,n),left:this.CreateCubemapTexture(r,this.FACE_LEFT,t,e,n),right:this.CreateCubemapTexture(r,this.FACE_RIGHT,t,e,n),up:this.CreateCubemapTexture(r,this.FACE_UP,t,e,n),down:this.CreateCubemapTexture(r,this.FACE_DOWN,t,e,n),size:r,type:g.a.TEXTURETYPE_FLOAT,format:g.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},i.CreateCubemapTexture=function(t,e,n,r,o){for(var l=new ArrayBuffer(t*t*4*3),h=new Float32Array(l),v=e[1].subtract(e[0]).scale(1/t),b=e[3].subtract(e[2]).scale(1/t),A=1/t,D=0,N=0;N<t;N++){for(var j=e[0],k=e[2],H=0;H<t;H++){var J=k.subtract(j).scale(D).add(j);J.normalize();var te=this.CalcProjectionSpherical(J,n,r,o);h[N*t*3+3*H+0]=te.r,h[N*t*3+3*H+1]=te.g,h[N*t*3+3*H+2]=te.b,j=j.add(v),k=k.add(b)}D+=A}return h},i.CalcProjectionSpherical=function(t,e,n,r){for(var o=Math.atan2(t.z,t.x),l=Math.acos(t.y);o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;var h=o/Math.PI,v=l/Math.PI;h=.5*h+.5;var b=Math.round(h*n);b<0?b=0:b>=n&&(b=n-1);var A=Math.round(v*r);A<0?A=0:A>=r&&(A=r-1);var D=r-A-1;return{r:e[D*n*3+3*b+0],g:e[D*n*3+3*b+1],b:e[D*n*3+3*b+2]}},i.FACE_LEFT=[new d.e(-1,-1,-1),new d.e(1,-1,-1),new d.e(-1,1,-1),new d.e(1,1,-1)],i.FACE_RIGHT=[new d.e(1,-1,1),new d.e(-1,-1,1),new d.e(1,1,1),new d.e(-1,1,1)],i.FACE_FRONT=[new d.e(1,-1,-1),new d.e(1,-1,1),new d.e(1,1,-1),new d.e(1,1,1)],i.FACE_BACK=[new d.e(-1,-1,1),new d.e(-1,-1,-1),new d.e(-1,1,1),new d.e(-1,1,-1)],i.FACE_DOWN=[new d.e(1,1,-1),new d.e(1,1,1),new d.e(-1,1,-1),new d.e(-1,1,1)],i.FACE_UP=[new d.e(-1,-1,-1),new d.e(-1,-1,1),new d.e(1,-1,-1),new d.e(1,-1,1)],i}(),u0=function(){function i(){}return i.Ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},i.Rgbe2float=function(t,e,n,r,o,l){o>0?(o=this.Ldexp(1,o-136),t[l+0]=e*o,t[l+1]=n*o,t[l+2]=r*o):(t[l+0]=0,t[l+1]=0,t[l+2]=0)},i.readStringLine=function(t,e){for(var n="",r="",o=e;o<t.length-e&&(r=String.fromCharCode(t[o]))!=`
`;o++)n+=r;return n},i.RGBE_ReadHeader=function(t){var e,n,r=this.readStringLine(t,0);if(r[0]!="#"||r[1]!="?")throw"Bad HDR Format.";var o=!1,l=!1,h=0;do h+=r.length+1,(r=this.readStringLine(t,h))=="FORMAT=32-bit_rle_rgbe"?l=!0:r.length==0&&(o=!0);while(!o);if(!l)throw"HDR Bad header format, unsupported FORMAT";h+=r.length+1,r=this.readStringLine(t,h);var v=/^\-Y (.*) \+X (.*)$/g.exec(r);if(!v||v.length<3)throw"HDR Bad header format, no size";if(n=parseInt(v[2]),e=parseInt(v[1]),n<8||n>32767)throw"HDR Bad header format, unsupported size";return{height:e,width:n,dataPosition:h+=r.length+1}},i.GetCubeMapTextureData=function(t,e){var n=new Uint8Array(t),r=this.RGBE_ReadHeader(n),o=this.RGBE_ReadPixels(n,r);return Jp.ConvertPanoramaToCubemap(o,r.width,r.height,e)},i.RGBE_ReadPixels=function(t,e){return this.RGBE_ReadPixels_RLE(t,e)},i.RGBE_ReadPixels_RLE=function(t,e){for(var n,r,o,l,h,v=e.height,b=e.width,A=e.dataPosition,D=0,N=0,j=0,k=new ArrayBuffer(4*b),H=new Uint8Array(k),J=new ArrayBuffer(e.width*e.height*4*3),te=new Float32Array(J);v>0;){if(n=t[A++],r=t[A++],o=t[A++],l=t[A++],n!=2||r!=2||128&o||e.width<8||e.width>32767)return this.RGBE_ReadPixels_NOT_RLE(t,e);if((o<<8|l)!=b)throw"HDR Bad header format, wrong scan line width";for(D=0,j=0;j<4;j++)for(N=(j+1)*b;D<N;)if(n=t[A++],r=t[A++],n>128){if((h=n-128)==0||h>N-D)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)H[D++]=r}else{if((h=n)==0||h>N-D)throw"HDR Bad Format, bad scanline data (non-run)";if(H[D++]=r,--h>0)for(var oe=0;oe<h;oe++)H[D++]=t[A++]}for(j=0;j<b;j++)n=H[j],r=H[j+b],o=H[j+2*b],l=H[j+3*b],this.Rgbe2float(te,n,r,o,l,(e.height-v)*b*3+3*j);v--}return te},i.RGBE_ReadPixels_NOT_RLE=function(t,e){for(var n,r,o,l,h,v=e.height,b=e.width,A=e.dataPosition,D=new ArrayBuffer(e.width*e.height*4*3),N=new Float32Array(D);v>0;){for(h=0;h<e.width;h++)n=t[A++],r=t[A++],o=t[A++],l=t[A++],this.Rgbe2float(N,n,r,o,l,(e.height-v)*b*3+3*h);v--}return N},i}(),h0=function(){function i(t,e){var n;e===void 0&&(e=i._DefaultOptions),this.engine=t,this._fullscreenViewport=new $r.a(0,0,1,1),e=Object(_.a)(Object(_.a)({},i._DefaultOptions),e),this._vertexBuffers=((n={})[Me.b.PositionKind]=new Me.b(t,e.positions,Me.b.PositionKind,!1,!1,2),n),this._indexBuffer=t.createIndexBuffer(e.indices)}return i.prototype.setViewport=function(t){t===void 0&&(t=this._fullscreenViewport),this.engine.setViewport(t)},i.prototype.bindBuffers=function(t){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,t)},i.prototype.applyEffectWrapper=function(t){this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(t.effect),this.bindBuffers(t.effect),t.onApplyObservable.notifyObservers({})},i.prototype.restoreStates=function(){this.engine.depthCullingState.depthTest=!0,this.engine.stencilState.stencilTest=!0},i.prototype.draw=function(){this.engine.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6)},i.prototype.isRenderTargetTexture=function(t){return t.renderList!==void 0},i.prototype.render=function(t,e){if(e===void 0&&(e=null),t.effect.isReady()){this.setViewport();var n=e===null?null:this.isRenderTargetTexture(e)?e.getInternalTexture():e;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(t),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}},i.prototype.dispose=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&(t.dispose(),delete this._vertexBuffers[Me.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},i._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},i}(),d0=function(){function i(t){var e,n=this;this.onApplyObservable=new E.c;var r=t.uniformNames||[];t.vertexShader?e={fragmentSource:t.fragmentShader,vertexSource:t.vertexShader,spectorName:t.name||"effectWrapper"}:(r.push("scale"),e={fragmentSource:t.fragmentShader,vertex:"postprocess",spectorName:t.name||"effectWrapper"},this.onApplyObservable.add(function(){n.effect.setFloat2("scale",1,1)}));var o=t.defines?t.defines.join(`
`):"";t.useShaderStore?(e.fragment=e.fragmentSource,e.vertex||(e.vertex=e.vertexSource),delete e.fragmentSource,delete e.vertexSource,this.effect=t.engine.createEffect(e.spectorName,t.attributeNames||["position"],r,t.samplerNames,o,void 0,t.onCompiled)):this.effect=new We.a(e,t.attributeNames||["position"],r,t.samplerNames,t.engine,o,void 0,t.onCompiled)}return i.prototype.dispose=function(){this.effect.dispose()},i}(),YD=`
attribute vec2 position;

varying vec3 direction;

uniform vec3 up;
uniform vec3 right;
uniform vec3 front;
void main(void) {
mat3 view=mat3(up,right,front);
direction=view*vec3(position,1.0);
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.hdrFilteringVertexShader=YD;var KD=`#include<helperFunctions>
#include<importanceSampling>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
uniform float alphaG;
uniform samplerCube inputTexture;
uniform vec2 vFilteringInfo;
uniform float hdrScale;
varying vec3 direction;
void main() {
vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);
gl_FragColor=vec4(color*hdrScale,1.0);
}`;We.a.ShadersStore.hdrFilteringPixelShader=KD;var f0=function(){function i(t,e){e===void 0&&(e={}),this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=g.a.TEXTURE_FILTERING_QUALITY_OFFLINE,this.hdrScale=1,this._engine=t,this.hdrScale=e.hdrScale||this.hdrScale,this.quality=e.hdrScale||this.quality}return i.prototype._createRenderTarget=function(t){var e=g.a.TEXTURETYPE_UNSIGNED_BYTE;this._engine.getCaps().textureHalfFloatRender?e=g.a.TEXTURETYPE_HALF_FLOAT:this._engine.getCaps().textureFloatRender&&(e=g.a.TEXTURETYPE_FLOAT);var n=this._engine.createRenderTargetCubeTexture(t,{format:g.a.TEXTUREFORMAT_RGBA,type:e,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_NEAREST_SAMPLINGMODE});return this._engine.updateTextureWrappingMode(n,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE,g.a.TEXTURE_CLAMP_ADDRESSMODE),this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!0),n},i.prototype._prefilterInternal=function(t){var e=t.getSize().width,n=Math.round(se.a.Log2(e))+1,r=this._effectWrapper.effect,o=this._createRenderTarget(e);this._effectRenderer.setViewport();var l=t.getInternalTexture();l&&this._engine.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,l,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var h=[[new d.e(0,0,-1),new d.e(0,-1,0),new d.e(1,0,0)],[new d.e(0,0,1),new d.e(0,-1,0),new d.e(-1,0,0)],[new d.e(1,0,0),new d.e(0,0,1),new d.e(0,1,0)],[new d.e(1,0,0),new d.e(0,0,-1),new d.e(0,-1,0)],[new d.e(1,0,0),new d.e(0,-1,0),new d.e(0,0,1)],[new d.e(-1,0,0),new d.e(0,-1,0),new d.e(0,0,-1)]];r.setFloat("hdrScale",this.hdrScale),r.setFloat2("vFilteringInfo",t.getSize().width,n),r.setTexture("inputTexture",t);for(var v=0;v<6;v++){r.setVector3("up",h[v][0]),r.setVector3("right",h[v][1]),r.setVector3("front",h[v][2]);for(var b=0;b<n;b++){this._engine.bindFramebuffer(o,v,void 0,void 0,!0,b),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var A=Math.pow(2,(b-this._lodGenerationOffset)/this._lodGenerationScale)/e;b===0&&(A=0),r.setFloat("alphaG",A),this._effectRenderer.draw()}}return this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseFramebufferObjects(o),this._engine._releaseTexture(t._texture),o._swapAndDie(t._texture),t._prefiltered=!0,t},i.prototype._createEffect=function(t,e){var n=[];return t.gammaSpace&&n.push("#define GAMMA_INPUT"),n.push("#define NUM_SAMPLES "+this.quality+"u"),new d0({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:n,onCompiled:e})},i.prototype.isReady=function(t){return t.isReady()&&this._effectWrapper.effect.isReady()},i.prototype.prefilter=function(t,e){var n=this;if(e===void 0&&(e=null),this._engine.webGLVersion!==1)return new Promise(function(r){n._effectRenderer=new h0(n._engine),n._effectWrapper=n._createEffect(t),n._effectWrapper.effect.executeWhenCompiled(function(){n._prefilterInternal(t),n._effectRenderer.dispose(),n._effectWrapper.dispose(),r(),e&&e()})});p.a.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead.")},i}(),ph=function(i){function t(e,n,r,o,l,h,v,b,A){var D;o===void 0&&(o=!1),l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=!1),b===void 0&&(b=null),A===void 0&&(A=null);var N=i.call(this,n)||this;return N._generateHarmonics=!0,N._onLoad=null,N._onError=null,N._isBlocking=!0,N._rotationY=0,N.boundingBoxPosition=d.e.Zero(),e&&(N._coordinatesMode=Ve.a.CUBIC_MODE,N.name=e,N.url=e,N.hasAlpha=!1,N.isCube=!0,N._textureMatrix=d.a.Identity(),N._prefilterOnLoad=v,N._onLoad=b,N._onError=A,N.gammaSpace=h,N._noMipmap=o,N._size=r,N._generateHarmonics=l,N._texture=N._getFromCache(e,N._noMipmap),N._texture?b&&(N._texture.isReady?Qe.b.SetImmediate(function(){return b()}):N._texture.onLoadedObservable.add(b)):((D=N.getScene())===null||D===void 0?void 0:D.useDelayedTextureLoading)?N.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:N.loadTexture()),N}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(d.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var n=this.getScene();n&&n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var e=this,n=this._getEngine();if(this._getEngine().webGLVersion>=2&&this._prefilterOnLoad){var r=this._onLoad,o=new f0(n);this._onLoad=function(){o.prefilter(e,r)}}this._texture=n.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,g.a.TEXTUREFORMAT_RGB,n.getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(l){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var h=u0.GetCubeMapTextureData(l,e._size);if(e._generateHarmonics){var v=Zu.ConvertCubeMapToSphericalPolynomial(h);e.sphericalPolynomial=v}for(var b=[],A=null,D=0;D<6;D++){if(!n.getCaps().textureFloat){var N=new ArrayBuffer(e._size*e._size*3);A=new Uint8Array(N)}var j=h[t._facesMapping[D]];if(e.gammaSpace||A){for(var k=0;k<e._size*e._size;k++)if(e.gammaSpace&&(j[3*k+0]=Math.pow(j[3*k+0],Gt.b),j[3*k+1]=Math.pow(j[3*k+1],Gt.b),j[3*k+2]=Math.pow(j[3*k+2],Gt.b)),A){var H=Math.max(255*j[3*k+0],0),J=Math.max(255*j[3*k+1],0),te=Math.max(255*j[3*k+2],0),oe=Math.max(Math.max(H,J),te);if(oe>255){var ce=255/oe;H*=ce,J*=ce,te*=ce}A[3*k+0]=H,A[3*k+1]=J,A[3*k+2]=te}}A?b.push(A):b.push(j)}return b},null,this._onLoad,this._onError)},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var n,r=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&((n=this.getScene())===null||n===void 0||n.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(o){return o.getActiveTextures().indexOf(r)!==-1}))},t.Parse=function(e,n,r){var o=null;return e.name&&!e.isRenderTarget&&((o=new t(r+e.name,n,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,o.hasAlpha=e.hasAlpha,o.level=e.level,o.coordinatesMode=e.coordinatesMode,o.isBlocking=e.isBlocking),o&&(e.boundingBoxPosition&&(o.boundingBoxPosition=d.e.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=d.e.FromArray(e.boundingBoxSize)),e.rotationY&&(o.rotationY=e.rotationY)),o},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._facesMapping=["right","left","up","down","front","back"],t}(jr.a);M.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=ph;var p0=function(){function i(t,e,n){e===void 0&&(e=0),n===void 0&&(n=null),this.name=t,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new E.c,this._onDataLayoutChanged=new E.c,this._animationPropertiesOverride=null,this._scene=n||$.a.LastCreatedScene,this.influence=e,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"influence",{get:function(){return this._influence},set:function(t){if(this._influence!==t){var e=this._influence;this._influence=t,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(e===0||t===0)}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),i.prototype.setPositions=function(t){var e=this.hasPositions;this._positions=t,e!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getPositions=function(){return this._positions},i.prototype.setNormals=function(t){var e=this.hasNormals;this._normals=t,e!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getNormals=function(){return this._normals},i.prototype.setTangents=function(t){var e=this.hasTangents;this._tangents=t,e!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getTangents=function(){return this._tangents},i.prototype.setUVs=function(t){var e=this.hasUVs;this._uvs=t,e!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},i.prototype.getUVs=function(){return this._uvs},i.prototype.clone=function(){var t=this,e=V.a.Clone(function(){return new i(t.name,t.influence,t._scene)},this);return e._positions=this._positions,e._normals=this._normals,e._tangents=this._tangents,e._uvs=this._uvs,e},i.prototype.serialize=function(){var t={};return t.name=this.name,t.influence=this.influence,t.positions=Array.prototype.slice.call(this.getPositions()),this.id!=null&&(t.id=this.id),this.hasNormals&&(t.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(t.uvs=Array.prototype.slice.call(this.getUVs())),V.a.AppendSerializedAnimations(this,t),t},i.prototype.getClassName=function(){return"MorphTarget"},i.Parse=function(t){var e=new i(t.name,t.influence);if(e.setPositions(t.positions),t.id!=null&&(e.id=t.id),t.normals&&e.setNormals(t.normals),t.tangents&&e.setTangents(t.tangents),t.uvs&&e.setUVs(t.uvs),t.animations)for(var n=0;n<t.animations.length;n++){var r=t.animations[n],o=M.a.GetClass("BABYLON.Animation");o&&e.animations.push(o.Parse(r))}return e},i.FromMesh=function(t,e,n){e||(e=t.name);var r=new i(e,n,t.getScene());return r.setPositions(t.getVerticesData(Me.b.PositionKind)),t.isVerticesDataPresent(Me.b.NormalKind)&&r.setNormals(t.getVerticesData(Me.b.NormalKind)),t.isVerticesDataPresent(Me.b.TangentKind)&&r.setTangents(t.getVerticesData(Me.b.TangentKind)),t.isVerticesDataPresent(Me.b.UVKind)&&r.setUVs(t.getVerticesData(Me.b.UVKind)),r},Object(_.c)([Object(V.c)()],i.prototype,"id",void 0),i}(),mh=function(){function i(t){t===void 0&&(t=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new In.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,t||(t=$.a.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),i.prototype.getActiveTarget=function(t){return this._activeTargets.data[t]},i.prototype.getTarget=function(t){return this._targets[t]},i.prototype.addTarget=function(t){var e=this;this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add(function(n){e._syncActiveTargets(n)})),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add(function(){e._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},i.prototype.removeTarget=function(t){var e=this._targets.indexOf(t);e>=0&&(this._targets.splice(e,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(e,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(e,1)[0]),this._syncActiveTargets(!0))},i.prototype.clone=function(){for(var t=new i(this._scene),e=0,n=this._targets;e<n.length;e++){var r=n[e];t.addTarget(r.clone())}return t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t},i.prototype.serialize=function(){var t={};t.id=this.uniqueId,t.targets=[];for(var e=0,n=this._targets;e<n.length;e++){var r=n[e];t.targets.push(r.serialize())}return t},i.prototype._syncActiveTargets=function(t){var e=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0;for(var n=0,r=this._targets;n<r.length;n++){var o=r[n];if(o.influence!==0){this._activeTargets.push(o),this._tempInfluences[e++]=o.influence,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs;var l=o.getPositions();if(l){var h=l.length/3;if(this._vertexCount===0)this._vertexCount=h;else if(this._vertexCount!==h)return void p.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(var v=0;v<e;v++)this._influences[v]=this._tempInfluences[v];t&&this.synchronize()},i.prototype.synchronize=function(){if(this._scene)for(var t=0,e=this._scene.meshes;t<e.length;t++){var n=e[t];n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}},i.Parse=function(t,e){var n=new i(e);n._uniqueId=t.id;for(var r=0,o=t.targets;r<o.length;r++){var l=o[r];n.addTarget(p0.Parse(l))}return n},i}(),Dt=c(32),Pn=c(50),Ss=function(){function i(t,e){if(e===void 0&&(e=i.DefaultPluginFactory()),this._physicsPlugin=e,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new d.e(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return i.DefaultPluginFactory=function(){throw rr.a.WarnImport("CannonJSPlugin")},i.prototype.setGravity=function(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)},i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._physicsPlugin.setTimeStep(t)},i.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},i.prototype.setSubTimeStep=function(t){t===void 0&&(t=0),this._subTimeStep=t},i.prototype.getSubTimeStep=function(){return this._subTimeStep},i.prototype.dispose=function(){this._impostors.forEach(function(t){t.dispose()}),this._physicsPlugin.dispose()},i.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},i.prototype.addImpostor=function(t){t.uniqueId=this._impostors.push(t),t.parent||this._physicsPlugin.generatePhysicsBody(t)},i.prototype.removeImpostor=function(t){var e=this._impostors.indexOf(t);e>-1&&this._impostors.splice(e,1).length&&this.getPhysicsPlugin().removePhysicsBody(t)},i.prototype.addJoint=function(t,e,n){var r={mainImpostor:t,connectedImpostor:e,joint:n};n.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},i.prototype.removeJoint=function(t,e,n){var r=this._joints.filter(function(o){return o.connectedImpostor===e&&o.joint===n&&o.mainImpostor===t});r.length&&this._physicsPlugin.removeJoint(r[0])},i.prototype._step=function(t){var e=this;this._impostors.forEach(function(n){n.isBodyInitRequired()&&e._physicsPlugin.generatePhysicsBody(n)}),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)},i.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},i.prototype.getImpostors=function(){return this._impostors},i.prototype.getImpostorForPhysicsObject=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].object===t)return this._impostors[e];return null},i.prototype.getImpostorWithPhysicsBody=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].physicsBody===t)return this._impostors[e];return null},i.prototype.raycast=function(t,e){return this._physicsPlugin.raycast(t,e)},i.Epsilon=.001,i}(),em=function(){function i(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=d.e.Zero(),this._hitPointWorld=d.e.Zero(),this._rayFromWorld=d.e.Zero(),this._rayToWorld=d.e.Zero()}return Object.defineProperty(i.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0}),i.prototype.setHitData=function(t,e){this._hasHit=!0,this._hitNormalWorld=new d.e(t.x,t.y,t.z),this._hitPointWorld=new d.e(e.x,e.y,e.z)},i.prototype.setHitDistance=function(t){this._hitDistance=t},i.prototype.calculateHitDistance=function(){this._hitDistance=d.e.Distance(this._rayFromWorld,this._hitPointWorld)},i.prototype.reset=function(t,e){t===void 0&&(t=d.e.Zero()),e===void 0&&(e=d.e.Zero()),this._rayFromWorld=t,this._rayToWorld=e,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=d.e.Zero(),this._hitPointWorld=d.e.Zero()},i}(),tm=function(){function i(t,e,n){t===void 0&&(t=!0),e===void 0&&(e=10),n===void 0&&(n=CANNON),this._useDeltaForWorldStep=t,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._firstFrame=!0,this._minus90X=new d.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new d.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=d.e.Zero(),this._tmpDeltaPosition=d.e.Zero(),this._tmpUnityRotation=new d.b,this.BJSCANNON=n,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=e,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new em):p.a.Error("CannonJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){var e=t;this.world.gravity.set(e.x,e.y,e.z)},i.prototype.setTimeStep=function(t){this._fixedTimeStep=t},i.prototype.getTimeStep=function(){return this._fixedTimeStep},i.prototype.executeStep=function(t,e){if(this._firstFrame){this._firstFrame=!1;for(var n=0,r=e;n<r.length;n++){var o=r[n];o.type!=Dt.a.HeightmapImpostor&&o.type!==Dt.a.PlaneImpostor&&o.beforeStep()}}this.world.step(this._useDeltaForWorldStep?t:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()},i.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var t=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach(function(e){t.world.remove(e)}),this._physicsBodysToRemoveAfterStep=[])},i.prototype.applyImpulse=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyImpulse(o,r)},i.prototype.applyForce=function(t,e,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),o=new this.BJSCANNON.Vec3(e.x,e.y,e.z);t.physicsBody.applyForce(o,r)},i.prototype.generatePhysicsBody=function(t){if(this._removeMarkedPhysicsBodiesFromWorld(),t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.physicsBody;n&&this.removePhysicsBody(t);var r=this._addMaterial("mat-"+t.uniqueId,t.getParam("friction"),t.getParam("restitution")),o={mass:t.getParam("mass"),material:r},l=t.getParam("nativeOptions");for(var h in l)l.hasOwnProperty(h)&&(o[h]=l[h]);t.physicsBody=new this.BJSCANNON.Body(o),t.physicsBody.addEventListener("collide",t.onCollide),this.world.addEventListener("preStep",t.beforeStep),this.world.addEventListener("postStep",t.afterStep),t.physicsBody.addShape(e),this.world.add(t.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(v){var b=n[v];t.physicsBody[v].set(b.x,b.y,b.z)}),this._processChildMeshes(t)}this._updatePhysicsBodyTransformation(t)}},i.prototype._processChildMeshes=function(t){var e=this,n=t.object.getChildMeshes?t.object.getChildMeshes(!0):[],r=t.object.rotationQuaternion;if(n.length){var o=function(l){if(r&&l.rotationQuaternion){var h=l.getPhysicsImpostor();if(h&&h.parent!==t){var v=l.getAbsolutePosition().subtract(l.parent.getAbsolutePosition()),b=l.rotationQuaternion;h.physicsBody&&(e.removePhysicsBody(h),h.physicsBody=null),h.parent=t,h.resetUpdateFlags(),t.physicsBody.addShape(e._createShape(h),new e.BJSCANNON.Vec3(v.x,v.y,v.z),new e.BJSCANNON.Quaternion(b.x,b.y,b.z,b.w)),t.physicsBody.mass+=h.getParam("mass")}r.multiplyInPlace(l.rotationQuaternion),l.getChildMeshes(!0).filter(function(A){return!!A.physicsImpostor}).forEach(o)}};n.filter(function(l){return!!l.physicsImpostor}).forEach(o)}},i.prototype.removePhysicsBody=function(t){t.physicsBody.removeEventListener("collide",t.onCollide),this.world.removeEventListener("preStep",t.beforeStep),this.world.removeEventListener("postStep",t.afterStep),this._physicsBodysToRemoveAfterStep.indexOf(t.physicsBody)===-1&&this._physicsBodysToRemoveAfterStep.push(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,l={pivotA:o.mainPivot?new this.BJSCANNON.Vec3().set(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z):null,pivotB:o.connectedPivot?new this.BJSCANNON.Vec3().set(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z):null,axisA:o.mainAxis?new this.BJSCANNON.Vec3().set(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z):null,axisB:o.connectedAxis?new this.BJSCANNON.Vec3().set(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(t.joint.type){case Pn.e.HingeJoint:case Pn.e.Hinge2Joint:r=new this.BJSCANNON.HingeConstraint(e,n,l);break;case Pn.e.DistanceJoint:r=new this.BJSCANNON.DistanceConstraint(e,n,o.maxDistance||2);break;case Pn.e.SpringJoint:var h=o;r=new this.BJSCANNON.Spring(e,n,{restLength:h.length,stiffness:h.stiffness,damping:h.damping,localAnchorA:l.pivotA,localAnchorB:l.pivotB});break;case Pn.e.LockJoint:r=new this.BJSCANNON.LockConstraint(e,n,l);break;case Pn.e.PointToPointJoint:case Pn.e.BallAndSocketJoint:default:r=new this.BJSCANNON.PointToPointConstraint(e,l.pivotA,n,l.pivotB,l.maxForce)}r.collideConnected=!!o.collision,t.joint.physicsJoint=r,t.joint.type!==Pn.e.SpringJoint?this.world.addConstraint(r):(t.joint.jointData.forceApplicationCallback=t.joint.jointData.forceApplicationCallback||function(){r.applyForce()},t.mainImpostor.registerAfterPhysicsStep(t.joint.jointData.forceApplicationCallback))}},i.prototype.removeJoint=function(t){t.joint.type!==Pn.e.SpringJoint?this.world.removeConstraint(t.joint.physicsJoint):t.mainImpostor.unregisterAfterPhysicsStep(t.joint.jointData.forceApplicationCallback)},i.prototype._addMaterial=function(t,e,n){var r,o;for(r=0;r<this._physicsMaterials.length;r++)if((o=this._physicsMaterials[r]).friction===e&&o.restitution===n)return o;var l=new this.BJSCANNON.Material(t);return l.friction=e,l.restitution=n,this._physicsMaterials.push(l),l},i.prototype._checkWithEpsilon=function(t){return t<Ss.Epsilon?Ss.Epsilon:t},i.prototype._createShape=function(t){var e,n=t.object,r=t.getObjectExtendSize();switch(t.type){case Dt.a.SphereImpostor:var o=r.x,l=r.y,h=r.z;e=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(l),this._checkWithEpsilon(h))/2);break;case Dt.a.CylinderImpostor:var v=t.getParam("nativeOptions");v||(v={});var b=v.radiusTop!==void 0?v.radiusTop:this._checkWithEpsilon(r.x)/2,A=v.radiusBottom!==void 0?v.radiusBottom:this._checkWithEpsilon(r.x)/2,D=v.height!==void 0?v.height:this._checkWithEpsilon(r.y),N=v.numSegments!==void 0?v.numSegments:16;e=new this.BJSCANNON.Cylinder(b,A,D,N);var j=new this.BJSCANNON.Quaternion;j.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var k=new this.BJSCANNON.Vec3(0,0,0);e.transformAllPoints(k,j);break;case Dt.a.BoxImpostor:var H=r.scale(.5);e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(H.x),this._checkWithEpsilon(H.y),this._checkWithEpsilon(H.z)));break;case Dt.a.PlaneImpostor:p.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),e=new this.BJSCANNON.Plane;break;case Dt.a.MeshImpostor:var J=n.getVerticesData?n.getVerticesData(Me.b.PositionKind):[],te=n.getIndices?n.getIndices():[];if(!J)return;var oe=n.position.clone(),ce=n.rotation&&n.rotation.clone(),he=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace();var _e,ye=n.computeWorldMatrix(!0),Ee=new Array;for(_e=0;_e<J.length;_e+=3)d.e.TransformCoordinates(d.e.FromArray(J,_e),ye).toArray(Ee,_e);p.a.Warn("MeshImpostor only collides against spheres."),e=new this.BJSCANNON.Trimesh(Ee,te),n.position.copyFrom(oe),ce&&n.rotation&&n.rotation.copyFrom(ce),he&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(he);break;case Dt.a.HeightmapImpostor:var Oe=n.position.clone(),Ae=n.rotation&&n.rotation.clone(),xe=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(t.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace(),n.rotationQuaternion&&n.rotationQuaternion.multiplyInPlace(this._minus90X),e=this._createHeightmap(n),n.position.copyFrom(Oe),Ae&&n.rotation&&n.rotation.copyFrom(Ae),xe&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(xe),n.computeWorldMatrix(!0);break;case Dt.a.ParticleImpostor:e=new this.BJSCANNON.Particle;break;case Dt.a.NoImpostor:e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return e},i.prototype._createHeightmap=function(t,e){var n,r=t.getVerticesData(Me.b.PositionKind),o=t.computeWorldMatrix(!0),l=new Array;for(n=0;n<r.length;n+=3)d.e.TransformCoordinates(d.e.FromArray(r,n),o).toArray(l,n);r=l;for(var h=new Array,v=e||~~(Math.sqrt(r.length/3)-1),b=t.getBoundingInfo(),A=Math.min(b.boundingBox.extendSizeWorld.x,b.boundingBox.extendSizeWorld.y),D=b.boundingBox.extendSizeWorld.z,N=2*A/v,j=0;j<r.length;j+=3){var k=Math.round(r[j+0]/N+v/2),H=Math.round(-1*(r[j+1]/N-v/2)),J=-r[j+2]+D;h[k]||(h[k]=[]),h[k][H]||(h[k][H]=J),h[k][H]=Math.max(J,h[k][H])}for(k=0;k<=v;++k){if(!h[k]){for(var te=1;!h[(k+te)%v];)te++;h[k]=h[(k+te)%v].slice()}for(H=0;H<=v;++H)if(!h[k][H]){var oe;for(te=1;oe===void 0;)oe=h[k][(H+te++)%v];h[k][H]=oe}}var ce=new this.BJSCANNON.Heightfield(h,{elementSize:N});return ce.minY=D,ce},i.prototype._updatePhysicsBodyTransformation=function(t){var e=t.object;if(e.computeWorldMatrix&&e.computeWorldMatrix(!0),e.getBoundingInfo()){var n=t.getObjectCenter();this._tmpDeltaPosition.copyFrom(e.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(t.object.scaling),this._tmpPosition.copyFrom(n);var r=e.rotationQuaternion;if(r){if(t.type!==Dt.a.PlaneImpostor&&t.type!==Dt.a.HeightmapImpostor||(r=r.multiply(this._minus90X),t.setDeltaRotation(this._plus90X)),t.type===Dt.a.HeightmapImpostor){var o=e,l=o.getBoundingInfo(),h=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var v=n.clone(),b=o.getPivotMatrix();b=b?b.clone():d.a.Identity();var A=d.a.Translation(l.boundingBox.extendSizeWorld.x,0,-l.boundingBox.extendSizeWorld.z);o.setPreTransformMatrix(A),o.computeWorldMatrix(!0);var D=l.boundingBox.centerWorld.subtract(n).subtract(o.position).negate();this._tmpPosition.copyFromFloats(D.x,D.y-l.boundingBox.extendSizeWorld.y,D.z),this._tmpDeltaPosition.copyFrom(l.boundingBox.centerWorld.subtract(v)),this._tmpDeltaPosition.y+=l.boundingBox.extendSizeWorld.y,o.rotationQuaternion=h,o.setPreTransformMatrix(b),o.computeWorldMatrix(!0)}else t.type===Dt.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpDeltaPosition),t.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),t.physicsBody.quaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setTransformationFromPhysicsBody=function(t){if(t.object.position.set(t.physicsBody.position.x,t.physicsBody.position.y,t.physicsBody.position.z),t.object.rotationQuaternion){var e=t.physicsBody.quaternion;t.object.rotationQuaternion.set(e.x,e.y,e.z,e.w)}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){t.physicsBody.position.set(e.x,e.y,e.z),t.physicsBody.quaternion.set(n.x,n.y,n.z,n.w)},i.prototype.isSupported=function(){return this.BJSCANNON!==void 0},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.velocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.velocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){t.physicsBody.mass=e,t.physicsBody.updateMassProperties()},i.prototype.getBodyMass=function(t){return t.physicsBody.mass},i.prototype.getBodyFriction=function(t){return t.physicsBody.material.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.material.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.material.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.material.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.wakeUp()},i.prototype.updateDistanceJoint=function(t,e){t.physicsJoint.distance=e},i.prototype.setMotor=function(t,e,n,r){r||(t.physicsJoint.enableMotor(),t.physicsJoint.setMotorSpeed(e),n&&this.setLimit(t,n))},i.prototype.setLimit=function(t,e,n){t.physicsJoint.motorEquation.maxForce=e,t.physicsJoint.motorEquation.minForce=n===void 0?-e:n},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.quaternion.x,t.rotationQuaternion.y=n.quaternion.y,t.rotationQuaternion.z=n.quaternion.z,t.rotationQuaternion.w=n.quaternion.w)},i.prototype.getRadius=function(t){return t.physicsBody.shapes[0].boundingSphereRadius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes[0];e.x=2*n.halfExtents.x,e.y=2*n.halfExtents.y,e.z=2*n.halfExtents.z},i.prototype.dispose=function(){},i.prototype._extendNamespace=function(){var t=new this.BJSCANNON.Vec3,e=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,r,o){if(o=o||10,(r=r||0)===0)this.internalStep(n),this.time+=n;else{var l=Math.floor((this.time+r)/n)-Math.floor(this.time/n);l=Math.min(l,o)||1;for(var h=performance.now(),v=0;v!==l&&(this.internalStep(n),!(performance.now()-h>1e3*n));v++);this.time+=r;for(var b=this.time%n/n,A=t,D=this.bodies,N=0;N!==D.length;N++){var j=D[N];j.type!==e.Body.STATIC&&j.sleepState!==e.Body.SLEEPING?(j.position.vsub(j.previousPosition,A),A.scale(b,A),j.position.vadd(A,j.interpolatedPosition)):(j.interpolatedPosition.set(j.position.x,j.position.y,j.position.z),j.interpolatedQuaternion.set(j.quaternion.x,j.quaternion.y,j.quaternion.z,j.quaternion.w))}}}},i.prototype.raycast=function(t,e){return this._cannonRaycastResult.reset(),this.world.raycastClosest(t,e,{},this._cannonRaycastResult),this._raycastResult.reset(t,e),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},i}();Ss.DefaultPluginFactory=function(){return new tm};var m0=function(){function i(t,e,n){t===void 0&&(t=!0),n===void 0&&(n=OIMO),this._useDeltaForWorldStep=t,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=d.e.Zero(),this.BJSOIMO=n,this.world=new this.BJSOIMO.World({iterations:e}),this.world.clear(),this._raycastResult=new em}return i.prototype.setGravity=function(t){this.world.gravity.set(t.x,t.y,t.z)},i.prototype.setTimeStep=function(t){this.world.timeStep=t},i.prototype.getTimeStep=function(){return this.world.timeStep},i.prototype.executeStep=function(t,e){var n=this;e.forEach(function(h){h.beforeStep()}),this.world.timeStep=this._useDeltaForWorldStep?t:this._fixedTimeStep,this.world.step(),e.forEach(function(h){h.afterStep(),n._tmpImpostorsArray[h.uniqueId]=h});for(var r=this.world.contacts;r!==null;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var o=this._tmpImpostorsArray[+r.body1.name],l=this._tmpImpostorsArray[+r.body2.name];o&&l&&(o.onCollide({body:l.physicsBody,point:null}),l.onCollide({body:o.physicsBody,point:null})),r=r.next}else r=r.next},i.prototype.applyImpulse=function(t,e,n){var r=t.physicsBody.mass;t.physicsBody.applyImpulse(n.scale(this.world.invScale),e.scale(this.world.invScale*r))},i.prototype.applyForce=function(t,e,n){p.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,e,n)},i.prototype.generatePhysicsBody=function(t){var e=this;if(t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var n={name:t.uniqueId,config:[t.getParam("mass")||.001,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:t.getParam("mass")!==0,density:t.getParam("mass"),friction:t.getParam("friction"),restitution:t.getParam("restitution"),world:this.world},r=[t];(h=t.object).getChildMeshes&&h.getChildMeshes().forEach(function(v){v.physicsImpostor&&r.push(v.physicsImpostor)});var o=function(v){return Math.max(v,Ss.Epsilon)},l=new d.b;r.forEach(function(v){if(v.object.rotationQuaternion){var b=v.object.rotationQuaternion;l.copyFrom(b),v.object.rotationQuaternion.set(0,0,0,1),v.object.computeWorldMatrix(!0);var A=l.toEulerAngles(),D=v.getObjectExtendSize();if(v===t){var N=t.getObjectCenter();t.object.getAbsolutePivotPoint().subtractToRef(N,e._tmpPositionVector),e._tmpPositionVector.divideInPlace(t.object.scaling),n.pos.push(N.x),n.pos.push(N.y),n.pos.push(N.z),n.posShape.push(0,0,0),n.rotShape.push(0,0,0)}else{var j=v.object.position.clone();n.posShape.push(j.x),n.posShape.push(j.y),n.posShape.push(j.z),n.rotShape.push(57.29577951308232*A.x,57.29577951308232*A.y,57.29577951308232*A.z)}switch(v.object.rotationQuaternion.copyFrom(l),v.type){case Dt.a.ParticleImpostor:p.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case Dt.a.SphereImpostor:var k=D.x,H=D.y,J=D.z,te=Math.max(o(k),o(H),o(J))/2;n.type.push("sphere"),n.size.push(te),n.size.push(te),n.size.push(te);break;case Dt.a.CylinderImpostor:var oe=o(D.x)/2,ce=o(D.y);n.type.push("cylinder"),n.size.push(oe),n.size.push(ce),n.size.push(ce);break;case Dt.a.PlaneImpostor:case Dt.a.BoxImpostor:default:oe=o(D.x),ce=o(D.y);var he=o(D.z);n.type.push("box"),n.size.push(oe),n.size.push(ce),n.size.push(he)}v.object.rotationQuaternion=b}}),t.physicsBody=this.world.add(n),t.physicsBody.resetQuaternion(l),t.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var h;t.setDeltaPosition(this._tmpPositionVector)}},i.prototype.removePhysicsBody=function(t){this.world.removeRigidBody(t.physicsBody)},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData,l=o.nativeParams||{},h={body1:e,body2:n,axe1:l.axe1||(o.mainAxis?o.mainAxis.asArray():null),axe2:l.axe2||(o.connectedAxis?o.connectedAxis.asArray():null),pos1:l.pos1||(o.mainPivot?o.mainPivot.asArray():null),pos2:l.pos2||(o.connectedPivot?o.connectedPivot.asArray():null),min:l.min,max:l.max,collision:l.collision||o.collision,spring:l.spring,world:this.world};switch(t.joint.type){case Pn.e.BallAndSocketJoint:r="jointBall";break;case Pn.e.SpringJoint:p.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var v=o;h.min=v.length||h.min,h.max=Math.max(h.min,h.max);case Pn.e.DistanceJoint:r="jointDistance",h.max=o.maxDistance;break;case Pn.e.PrismaticJoint:r="jointPrisme";break;case Pn.e.SliderJoint:r="jointSlide";break;case Pn.e.WheelJoint:r="jointWheel";break;case Pn.e.HingeJoint:default:r="jointHinge"}h.type=r,t.joint.physicsJoint=this.world.add(h)}},i.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(e){p.a.Warn(e)}},i.prototype.isSupported=function(){return this.BJSOIMO!==void 0},i.prototype.setTransformationFromPhysicsBody=function(t){if(!t.physicsBody.sleeping){if(t.physicsBody.shapes.next){for(var e=t.physicsBody.shapes;e.next;)e=e.next;t.object.position.set(e.position.x,e.position.y,e.position.z)}else{var n=t.physicsBody.getPosition();t.object.position.set(n.x,n.y,n.z)}if(t.object.rotationQuaternion){var r=t.physicsBody.getQuaternion();t.object.rotationQuaternion.set(r.x,r.y,r.z,r.w)}}},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody;t.physicsBody.shapes.next||(r.position.set(e.x,e.y,e.z),r.orientation.set(n.x,n.y,n.z,n.w),r.syncShapes(),r.awake())},i.prototype.setLinearVelocity=function(t,e){t.physicsBody.linearVelocity.set(e.x,e.y,e.z)},i.prototype.setAngularVelocity=function(t,e){t.physicsBody.angularVelocity.set(e.x,e.y,e.z)},i.prototype.getLinearVelocity=function(t){var e=t.physicsBody.linearVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.getAngularVelocity=function(t){var e=t.physicsBody.angularVelocity;return e?new d.e(e.x,e.y,e.z):null},i.prototype.setBodyMass=function(t,e){var n=e===0;t.physicsBody.shapes.density=n?1:e,t.physicsBody.setupMass(n?2:1)},i.prototype.getBodyMass=function(t){return t.physicsBody.shapes.density},i.prototype.getBodyFriction=function(t){return t.physicsBody.shapes.friction},i.prototype.setBodyFriction=function(t,e){t.physicsBody.shapes.friction=e},i.prototype.getBodyRestitution=function(t){return t.physicsBody.shapes.restitution},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.shapes.restitution=e},i.prototype.sleepBody=function(t){t.physicsBody.sleep()},i.prototype.wakeUpBody=function(t){t.physicsBody.awake()},i.prototype.updateDistanceJoint=function(t,e,n){t.physicsJoint.limitMotor.upperLimit=e,n!==void 0&&(t.physicsJoint.limitMotor.lowerLimit=n)},i.prototype.setMotor=function(t,e,n,r){n!==void 0?p.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):n=1e6,e*=-1;var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setMotor(e,n)},i.prototype.setLimit=function(t,e,n,r){var o=r?t.physicsJoint.rotationalLimitMotor2:t.physicsJoint.rotationalLimitMotor1||t.physicsJoint.rotationalLimitMotor||t.physicsJoint.limitMotor;o&&o.setLimit(e,n===void 0?-e:n)},i.prototype.syncMeshWithImpostor=function(t,e){var n=e.physicsBody;t.position.x=n.position.x,t.position.y=n.position.y,t.position.z=n.position.z,t.rotationQuaternion&&(t.rotationQuaternion.x=n.orientation.x,t.rotationQuaternion.y=n.orientation.y,t.rotationQuaternion.z=n.orientation.z,t.rotationQuaternion.w=n.orientation.s)},i.prototype.getRadius=function(t){return t.physicsBody.shapes.radius},i.prototype.getBoxSizeToRef=function(t,e){var n=t.physicsBody.shapes;e.x=2*n.halfWidth,e.y=2*n.halfHeight,e.z=2*n.halfDepth},i.prototype.dispose=function(){this.world.clear()},i.prototype.raycast=function(t,e){return p.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(t,e),this._raycastResult},i}(),_h=c(97),_0=function(){function i(t,e,n){var r=this;t===void 0&&(t=!0),e===void 0&&(e=Ammo),n===void 0&&(n=null),this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new d.b,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new d.e,this._tmpMatrix=new d.a,typeof e=="function"?e(this.bjsAMMO):this.bjsAMMO=e,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=n||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(o,l,h,v){var b=(o=r.bjsAMMO.wrapPointer(o,Ammo.btManifoldPoint)).getPositionWorldOnA();r._tmpContactPoint.x=b.x(),r._tmpContactPoint.y=b.y(),r._tmpContactPoint.z=b.z(),r._tmpContactCallbackResult=!0},this._raycastResult=new em,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):p.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},i.prototype.setTimeStep=function(t){this._timeStep=t},i.prototype.setFixedTimeStep=function(t){this._fixedTimeStep=t},i.prototype.setMaxSteps=function(t){this._maxSteps=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype._isImpostorInContact=function(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._isImpostorPairInContact=function(t,e){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},i.prototype._stepSimulation=function(t,e,n){if(t===void 0&&(t=1/60),e===void 0&&(e=10),n===void 0&&(n=1/60),e==0)this.world.stepSimulation(t,0);else for(;e>0&&t>0;)t-n<n?(this.world.stepSimulation(t,0),t=0):(t-=n,this.world.stepSimulation(n,0)),e--},i.prototype.executeStep=function(t,e){for(var n=0,r=e;n<r.length;n++){var o=r[n];o.soft||o.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var l=0,h=e;l<h.length;l++){var v=h[l];if(v.soft?this._afterSoftStep(v):v.afterStep(),v._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(v))for(var b=0,A=v._onPhysicsCollideCallbacks;b<A.length;b++)for(var D=0,N=A[b].otherImpostors;D<N.length;D++){var j=N[D];(v.physicsBody.isActive()||j.physicsBody.isActive())&&this._isImpostorPairInContact(v,j)&&(v.onCollide({body:j.physicsBody,point:this._tmpContactPoint}),j.onCollide({body:v.physicsBody,point:this._tmpContactPoint}))}}},i.prototype._afterSoftStep=function(t){t.type===Dt.a.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)},i.prototype._ropeStep=function(t){for(var e,n,r,o,l=t.physicsBody.get_m_nodes(),h=l.size(),v=new Array,b=0;b<h;b++)n=(e=l.at(b).get_m_x()).x(),r=e.y(),o=e.z(),v.push(new d.e(n,r,o));var A=t.object,D=t.getParam("shape");t._isFromLine?t.object=kn.a.CreateLines("lines",{points:v,instance:A}):t.object=_h.a.ExtrudeShape("ext",{shape:D,path:v,instance:A})},i.prototype._softbodyOrClothStep=function(t){var e=t.type===Dt.a.ClothImpostor?1:-1,n=t.object,r=n.getVerticesData(Me.b.PositionKind);r||(r=[]);var o=n.getVerticesData(Me.b.NormalKind);o||(o=[]);for(var l,h,v,b,A,D,N,j,k=r.length/3,H=t.physicsBody.get_m_nodes(),J=0;J<k;J++){var te;v=(h=(l=H.at(J)).get_m_x()).x(),b=h.y(),A=h.z()*e,D=(te=l.get_m_n()).x(),N=te.y(),j=te.z()*e,r[3*J]=v,r[3*J+1]=b,r[3*J+2]=A,o[3*J]=D,o[3*J+1]=N,o[3*J+2]=j}var oe=new _t.a;oe.positions=r,oe.normals=o,oe.uvs=n.getVerticesData(Me.b.UVKind),oe.colors=n.getVerticesData(Me.b.ColorKind),n&&n.getIndices&&(oe.indices=n.getIndices()),oe.applyToMesh(n)},i.prototype.applyImpulse=function(t,e,n){if(t.soft)p.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyImpulse(o,r)}},i.prototype.applyForce=function(t,e,n){if(t.soft)p.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var r=this._tmpAmmoVectorA,o=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&n.subtractInPlace(t.object.getWorldMatrix().getTranslation()),r.setValue(n.x,n.y,n.z),o.setValue(e.x,e.y,e.z),t.physicsBody.applyForce(o,r)}},i.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){var e=this._createShape(t),n=t.getParam("mass");if(t._pluginData.mass=n,t.soft)e.get_m_cfg().set_collisions(17),e.get_m_cfg().set_kDP(t.getParam("damping")),this.bjsAMMO.castObject(e,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),e.setActivationState(i.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(e,1,-1),t.physicsBody=e,t._pluginData.toDispose.push(e),this.setBodyPressure(t,0),t.type===Dt.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var r=new this.bjsAMMO.btVector3(0,0,0),o=new this.bjsAMMO.btTransform;o.setIdentity(),n!==0&&e.calculateLocalInertia(n,r),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),o.setOrigin(this._tmpAmmoVectorA),o.setRotation(this._tmpAmmoQuaternion);var l=new this.bjsAMMO.btDefaultMotionState(o),h=new this.bjsAMMO.btRigidBodyConstructionInfo(n,l,e,r),v=new this.bjsAMMO.btRigidBody(h);n===0&&(v.setCollisionFlags(v.getCollisionFlags()|i.KINEMATIC_FLAG),v.setActivationState(i.DISABLE_DEACTIVATION_FLAG)),t.type!=Dt.a.NoImpostor||e.getChildShape||v.setCollisionFlags(v.getCollisionFlags()|i.DISABLE_COLLISION_FLAG);var b=t.getParam("group"),A=t.getParam("mask");b&&A?this.world.addRigidBody(v,b,A):this.world.addRigidBody(v),t.physicsBody=v,t._pluginData.toDispose=t._pluginData.toDispose.concat([v,h,l,o,r,e])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},i.prototype.removePhysicsBody=function(t){var e=this;this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach(function(n){e.bjsAMMO.destroy(n)}),t._pluginData.toDispose=[]))},i.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(e&&n){var r,o=t.joint.jointData;switch(o.mainPivot||(o.mainPivot=new d.e(0,0,0)),o.connectedPivot||(o.connectedPivot=new d.e(0,0,0)),t.joint.type){case Pn.e.DistanceJoint:var l=o.maxDistance;l&&(o.mainPivot=new d.e(0,-l/2,0),o.connectedPivot=new d.e(0,l/2,0)),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;case Pn.e.HingeJoint:o.mainAxis||(o.mainAxis=new d.e(0,0,0)),o.connectedAxis||(o.connectedAxis=new d.e(0,0,0));var h=new this.bjsAMMO.btVector3(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z),v=new this.bjsAMMO.btVector3(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z);r=new this.bjsAMMO.btHingeConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z),h,v);break;case Pn.e.BallAndSocketJoint:r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z));break;default:p.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),r=new this.bjsAMMO.btPoint2PointConstraint(e,n,new this.bjsAMMO.btVector3(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z),new this.bjsAMMO.btVector3(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z))}this.world.addConstraint(r,!t.joint.jointData.collision),t.joint.physicsJoint=r}},i.prototype.removeJoint=function(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)},i.prototype._addMeshVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var l=n.getIndices();l||(l=[]);var h=n.getVerticesData(Me.b.PositionKind);h||(h=[]),n.computeWorldMatrix(!1);for(var v=l.length/3,b=0;b<v;b++){for(var A=[],D=0;D<3;D++){var N,j=new d.e(h[3*l[3*b+D]+0],h[3*l[3*b+D]+1],h[3*l[3*b+D]+2]);d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),j=d.e.TransformCoordinates(j,this._tmpMatrix),(N=D==0?this._tmpAmmoVectorA:D==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(j.x,j.y,j.z),A.push(N)}t.addTriangle(A[0],A[1],A[2]),o++}n.getChildMeshes().forEach(function(k){o+=r._addMeshVerts(t,e,k)})}return o},i.prototype._softVertexData=function(t){var e=t.object;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){e.getIndices();var n=e.getVerticesData(Me.b.PositionKind);n||(n=[]);var r=e.getVerticesData(Me.b.NormalKind);r||(r=[]),e.computeWorldMatrix(!1);for(var o=[],l=[],h=0;h<n.length;h+=3){var v=new d.e(n[h],n[h+1],n[h+2]),b=new d.e(r[h],r[h+1],r[h+2]);v=d.e.TransformCoordinates(v,e.getWorldMatrix()),b=d.e.TransformNormal(b,e.getWorldMatrix()),o.push(v.x,v.y,v.z),l.push(b.x,b.y,b.z)}var A=new _t.a;return A.positions=o,A.normals=l,A.uvs=e.getVerticesData(Me.b.UVKind),A.colors=e.getVerticesData(Me.b.ColorKind),e&&e.getIndices&&(A.indices=e.getIndices()),A.applyToMesh(e),e.position=d.e.Zero(),e.rotationQuaternion=null,e.rotation=d.e.Zero(),e.computeWorldMatrix(!0),A}return _t.a.ExtractFromMesh(e)},i.prototype._createSoftbody=function(t){var e=t.object;if(e&&e.getIndices){var n=e.getIndices();n||(n=[]);var r=this._softVertexData(t),o=r.positions,l=r.normals;if(o===null||l===null)return new this.bjsAMMO.btCompoundShape;for(var h=[],v=[],b=0;b<o.length;b+=3){var A=new d.e(o[b],o[b+1],o[b+2]),D=new d.e(l[b],l[b+1],l[b+2]);h.push(A.x,A.y,-A.z),v.push(D.x,D.y,-D.z)}var N=new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),h,e.getIndices(),n.length/3,!0),j=o.length/3,k=N.get_m_nodes();for(b=0;b<j;b++){var H;(H=k.at(b).get_m_n()).setX(v[3*b]),H.setY(v[3*b+1]),H.setZ(v[3*b+2])}return N}},i.prototype._createCloth=function(t){var e=t.object;if(e&&e.getIndices){e.getIndices();var n=this._softVertexData(t),r=n.positions,o=n.normals;if(r===null||o===null)return new this.bjsAMMO.btCompoundShape;var l=r.length,h=Math.sqrt(l/3);t.segments=h;var v=h-1;return this._tmpAmmoVectorA.setValue(r[0],r[1],r[2]),this._tmpAmmoVectorB.setValue(r[3*v],r[3*v+1],r[3*v+2]),this._tmpAmmoVectorD.setValue(r[l-3],r[l-2],r[l-1]),this._tmpAmmoVectorC.setValue(r[l-3-3*v],r[l-2-3*v],r[l-1-3*v]),new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,h,h,t.getParam("fixedPoints"),!0)}},i.prototype._createRope=function(t){var e,n,r=this._softVertexData(t),o=r.positions,l=r.normals;if(o===null||l===null)return new this.bjsAMMO.btCompoundShape;if(r.applyToMesh(t.object,!0),t._isFromLine=!0,l.map(function(A){return A*A}).reduce(function(A,D){return A+D})===0)n=(e=o.length)/3-1,this._tmpAmmoVectorA.setValue(o[0],o[1],o[2]),this._tmpAmmoVectorB.setValue(o[e-3],o[e-2],o[e-1]);else{t._isFromLine=!1;var h=t.getParam("path");if(t.getParam("shape")===null)return p.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;if(o.length%(3*h.length)!=0)return p.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;n=(e=h.length)-1,this._tmpAmmoVectorA.setValue(h[0].x,h[0].y,h[0].z),this._tmpAmmoVectorB.setValue(h[e-1].x,h[e-1].y,h[e-1].z)}t.segments=n;var v=t.getParam("fixedPoints");v=v>3?3:v;var b=new this.bjsAMMO.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,n-1,v);return b.get_m_cfg().set_collisions(17),b},i.prototype._createCustom=function(t){var e=null;return this.onCreateCustomShape&&(e=this.onCreateCustomShape(t)),e==null&&(e=new this.bjsAMMO.btCompoundShape),e},i.prototype._addHullVerts=function(t,e,n){var r=this,o=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var l=n.getIndices();l||(l=[]);var h=n.getVerticesData(Me.b.PositionKind);h||(h=[]),n.computeWorldMatrix(!1);for(var v=l.length/3,b=0;b<v;b++){for(var A=[],D=0;D<3;D++){var N,j=new d.e(h[3*l[3*b+D]+0],h[3*l[3*b+D]+1],h[3*l[3*b+D]+2]);d.a.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),j=d.e.TransformCoordinates(j,this._tmpMatrix),(N=D==0?this._tmpAmmoVectorA:D==1?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(j.x,j.y,j.z),A.push(N)}t.addPoint(A[0],!0),t.addPoint(A[1],!0),t.addPoint(A[2],!0),o++}n.getChildMeshes().forEach(function(k){o+=r._addHullVerts(t,e,k)})}return o},i.prototype._createShape=function(t,e){var n=this;e===void 0&&(e=!1);var r,o=t.object,l=t.getObjectExtendSize();if(!e){var h=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];r=new this.bjsAMMO.btCompoundShape;var v=0;if(h.forEach(function(k){var H=k.getPhysicsImpostor();if(H){if(H.type==Dt.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var J=n._createShape(H),te=k.parent.getWorldMatrix().clone(),oe=new d.e;te.decompose(oe),n._tmpAmmoTransform.getOrigin().setValue(k.position.x*oe.x,k.position.y*oe.y,k.position.z*oe.z),n._tmpAmmoQuaternion.setValue(k.rotationQuaternion.x,k.rotationQuaternion.y,k.rotationQuaternion.z,k.rotationQuaternion.w),n._tmpAmmoTransform.setRotation(n._tmpAmmoQuaternion),r.addChildShape(n._tmpAmmoTransform,J),H.dispose(),v++}}),v>0){if(t.type!=Dt.a.NoImpostor){var b=this._createShape(t,!0);b&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,b))}return r}this.bjsAMMO.destroy(r),r=null}switch(t.type){case Dt.a.SphereImpostor:if(se.a.WithinEpsilon(l.x,l.y,1e-4)&&se.a.WithinEpsilon(l.x,l.z,1e-4))r=new this.bjsAMMO.btSphereShape(l.x/2);else{var A=[new this.bjsAMMO.btVector3(0,0,0)];(r=new this.bjsAMMO.btMultiSphereShape(A,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(l.x/2,l.y/2,l.z/2))}break;case Dt.a.CapsuleImpostor:r=new this.bjsAMMO.btCapsuleShape(l.x/2,l.y/2);break;case Dt.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(l.x/2,l.y/2,l.z/2),r=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case Dt.a.PlaneImpostor:case Dt.a.BoxImpostor:this._tmpAmmoVectorA.setValue(l.x/2,l.y/2,l.z/2),r=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case Dt.a.MeshImpostor:if(t.getParam("mass")==0){var D=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(D);var N=this._addMeshVerts(D,o,o);r=N==0?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(D);break}case Dt.a.ConvexHullImpostor:var j=new this.bjsAMMO.btConvexHullShape;(N=this._addHullVerts(j,o,o))==0?(t._pluginData.toDispose.push(j),r=new this.bjsAMMO.btCompoundShape):r=j;break;case Dt.a.NoImpostor:r=new this.bjsAMMO.btSphereShape(l.x/2);break;case Dt.a.CustomImpostor:r=this._createCustom(t);break;case Dt.a.SoftbodyImpostor:r=this._createSoftbody(t);break;case Dt.a.ClothImpostor:r=this._createCloth(t);break;case Dt.a.RopeImpostor:r=this._createRope(t);break;default:p.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return r},i.prototype.setTransformationFromPhysicsBody=function(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))},i.prototype.setPhysicsBodyTransformation=function(t,e,n){var r=t.physicsBody.getWorldTransform();if(Math.abs(r.getOrigin().x()-e.x)>Gt.a||Math.abs(r.getOrigin().y()-e.y)>Gt.a||Math.abs(r.getOrigin().z()-e.z)>Gt.a||Math.abs(r.getRotation().x()-n.x)>Gt.a||Math.abs(r.getRotation().y()-n.y)>Gt.a||Math.abs(r.getRotation().z()-n.z)>Gt.a||Math.abs(r.getRotation().w()-n.w)>Gt.a)if(this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),r.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(n.x,n.y,n.z,n.w),r.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(r),t.mass==0){var o=t.physicsBody.getMotionState();o&&o.setWorldTransform(r)}else t.physicsBody.activate()},i.prototype.isSupported=function(){return this.bjsAMMO!==void 0},i.prototype.setLinearVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},i.prototype.setAngularVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},i.prototype.getLinearVelocity=function(t){if(t.soft)var e=t.physicsBody.linearVelocity();else e=t.physicsBody.getLinearVelocity();if(!e)return null;var n=new d.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.getAngularVelocity=function(t){if(t.soft)var e=t.physicsBody.angularVelocity();else e=t.physicsBody.getAngularVelocity();if(!e)return null;var n=new d.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),n},i.prototype.setBodyMass=function(t,e){t.soft?t.physicsBody.setTotalMass(e,!1):t.physicsBody.setMassProps(e),t._pluginData.mass=e},i.prototype.getBodyMass=function(t){return t._pluginData.mass||0},i.prototype.getBodyFriction=function(t){return t._pluginData.friction||0},i.prototype.setBodyFriction=function(t,e){t.soft?t.physicsBody.get_m_cfg().set_kDF(e):t.physicsBody.setFriction(e),t._pluginData.friction=e},i.prototype.getBodyRestitution=function(t){return t._pluginData.restitution||0},i.prototype.setBodyRestitution=function(t,e){t.physicsBody.setRestitution(e),t._pluginData.restitution=e},i.prototype.getBodyPressure=function(t){return t.soft?t._pluginData.pressure||0:(p.a.Warn("Pressure is not a property of a rigid body"),0)},i.prototype.setBodyPressure=function(t,e){t.soft?t.type===Dt.a.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(e),t._pluginData.pressure=e):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):p.a.Warn("Pressure can only be applied to a softbody")},i.prototype.getBodyStiffness=function(t){return t.soft?t._pluginData.stiffness||0:(p.a.Warn("Stiffness is not a property of a rigid body"),0)},i.prototype.setBodyStiffness=function(t,e){t.soft?(e=(e=e<0?0:e)>1?1:e,t.physicsBody.get_m_materials().at(0).set_m_kLST(e),t._pluginData.stiffness=e):p.a.Warn("Stiffness cannot be applied to a rigid body")},i.prototype.getBodyVelocityIterations=function(t){return t.soft?t._pluginData.velocityIterations||0:(p.a.Warn("Velocity iterations is not a property of a rigid body"),0)},i.prototype.setBodyVelocityIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_viterations(e),t._pluginData.velocityIterations=e):p.a.Warn("Velocity iterations cannot be applied to a rigid body")},i.prototype.getBodyPositionIterations=function(t){return t.soft?t._pluginData.positionIterations||0:(p.a.Warn("Position iterations is not a property of a rigid body"),0)},i.prototype.setBodyPositionIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_piterations(e),t._pluginData.positionIterations=e):p.a.Warn("Position iterations cannot be applied to a rigid body")},i.prototype.appendAnchor=function(t,e,n,r,o,l){o===void 0&&(o=1),l===void 0&&(l=!1);var h=t.segments,v=Math.round((h-1)*n)+h*(h-1-Math.round((h-1)*r));t.physicsBody.appendAnchor(v,e.physicsBody,l,o)},i.prototype.appendHook=function(t,e,n,r,o){r===void 0&&(r=1),o===void 0&&(o=!1);var l=Math.round(t.segments*n);t.physicsBody.appendAnchor(l,e.physicsBody,o,r)},i.prototype.sleepBody=function(t){p.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},i.prototype.wakeUpBody=function(t){t.physicsBody.activate()},i.prototype.updateDistanceJoint=function(t,e,n){p.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},i.prototype.setMotor=function(t,e,n,r){t.physicsJoint.enableAngularMotor(!0,e,n)},i.prototype.setLimit=function(t,e,n){p.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},i.prototype.syncMeshWithImpostor=function(t,e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},i.prototype.getRadius=function(t){return t.getObjectExtendSize().x/2},i.prototype.getBoxSizeToRef=function(t,e){var n=t.getObjectExtendSize();e.x=n.x,e.y=n.y,e.z=n.z},i.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},i.prototype.raycast=function(t,e){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(e.x,e.y,e.z);var n=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,n),this._raycastResult.reset(t,e),n.hasHit()&&(this._raycastResult.setHitData({x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()},{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(n),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},i.DISABLE_COLLISION_FLAG=4,i.KINEMATIC_FLAG=2,i.DISABLE_DEACTIVATION_FLAG=4,i}();T.a.prototype.removeReflectionProbe=function(i){if(!this.reflectionProbes)return-1;var t=this.reflectionProbes.indexOf(i);return t!==-1&&this.reflectionProbes.splice(t,1),t},T.a.prototype.addReflectionProbe=function(i){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(i)};var g0=function(){function i(t,e,n,r,o){var l=this;r===void 0&&(r=!0),o===void 0&&(o=!1),this.name=t,this._viewMatrix=d.a.Identity(),this._target=d.e.Zero(),this._add=d.e.Zero(),this._invertYAxis=!1,this.position=d.e.Zero(),this._scene=n,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this);var h=g.a.TEXTURETYPE_UNSIGNED_BYTE;if(o){var v=this._scene.getEngine().getCaps();v.textureHalfFloatRender?h=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(h=g.a.TEXTURETYPE_FLOAT)}this._renderTargetTexture=new Un(t,e,n,r,!0,h,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(b){switch(b){case 0:l._add.copyFromFloats(1,0,0);break;case 1:l._add.copyFromFloats(-1,0,0);break;case 2:l._add.copyFromFloats(0,l._invertYAxis?1:-1,0);break;case 3:l._add.copyFromFloats(0,l._invertYAxis?-1:1,0);break;case 4:l._add.copyFromFloats(0,0,1);break;case 5:l._add.copyFromFloats(0,0,-1)}l._attachedMesh&&l.position.copyFrom(l._attachedMesh.getAbsolutePosition()),l.position.addToRef(l._add,l._target),d.a.LookAtLHToRef(l.position,l._target,d.e.Up(),l._viewMatrix),n.activeCamera&&(l._projectionMatrix=d.a.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ),n.setTransformMatrix(l._viewMatrix,l._projectionMatrix)),n._forcedViewPosition=l.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n._forcedViewPosition=null,n.updateTransformMatrix(!0)})}return Object.defineProperty(i.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(t){this._renderTargetTexture.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(t){this._renderTargetTexture.refreshRate=t},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},Object.defineProperty(i.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!1,configurable:!0}),i.prototype.attachToMesh=function(t){this._attachedMesh=t},i.prototype.setRenderingAutoClearDepthStencil=function(t,e){this._renderTargetTexture.setRenderingAutoClearDepthStencil(t,e)},i.prototype.dispose=function(){var t=this._scene.reflectionProbes.indexOf(this);t!==-1&&this._scene.reflectionProbes.splice(t,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},i.prototype.toString=function(t){var e="Name: "+this.name;return t&&(e+=", position: "+this.position.toString(),this._attachedMesh&&(e+=", attached mesh: "+this._attachedMesh.name)),e},i.prototype.getClassName=function(){return"ReflectionProbe"},i.prototype.serialize=function(){var t=V.a.Serialize(this,this._renderTargetTexture.serialize());return t.isReflectionProbe=!0,t},i.Parse=function(t,e,n){var r=null;if(e.reflectionProbes)for(var o=0;o<e.reflectionProbes.length;o++){var l=e.reflectionProbes[o];if(l.name===t.name){r=l;break}}return(r=V.a.Parse(function(){return r||new i(t.name,t.renderTargetSize,e,t._generateMipMaps)},t,e,n)).cubeTexture._waitingRenderList=t.renderList,t._attachedMesh&&r.attachToMesh(e.getMeshByID(t._attachedMesh)),r},Object(_.c)([Object(V.k)()],i.prototype,"_attachedMesh",void 0),Object(_.c)([Object(V.o)()],i.prototype,"position",void 0),i}(),QD=!0,gh=function(){function i(){}return i.LoaderInjectedPhysicsEngine=void 0,i}(),v0=function(i,t,e,n){for(var r=0,o=t.materials.length;r<o;r++){var l=t.materials[r];if(l.id===i)return nn.a.Parse(l,e,n)}return null},qD=function(i,t,e){for(var n in t)if(i.name===t[n])return e.push(i.id),!0;return!(!i.parentId||e.indexOf(i.parentId)===-1)&&(e.push(i.id),!0)},xs=function(i,t){return i+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},b0=function(i,t){var e=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var n=t._waitingData.lods.ids,r=e.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=n.length){var l=o.length>n.length?o[o.length-1]:0;e.setEnabled(!1);for(var h=0;h<n.length;h++){var v=n[h],b=i.getMeshByID(v);b!=null&&e.addLODLevel(o[h],b)}l>0&&e.addLODLevel(l,null),r===!0&&e.setEnabled(!0)}else Qe.b.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},y0=function(i,t,e,n,r){r===void 0&&(r=!1);var o=new Oi(i),l="importScene has failed JSON parse";try{var h=JSON.parse(t);l="";var v,b,A=Zt.loggingLevel===Zt.DETAILED_LOGGING;if(h.environmentTexture!==void 0&&h.environmentTexture!==null){var D=h.isPBR===void 0||h.isPBR;if(h.environmentTextureType&&h.environmentTextureType==="BABYLON.HDRCubeTexture"){var N=h.environmentTextureSize?h.environmentTextureSize:128,j=new ph((h.environmentTexture.match(/https?:\/\//g)?"":e)+h.environmentTexture,i,N,!0,!D);h.environmentTextureRotationY&&(j.rotationY=h.environmentTextureRotationY),i.environmentTexture=j}else if(Jr.a.EndsWith(h.environmentTexture,".env")){var k=new di((h.environmentTexture.match(/https?:\/\//g)?"":e)+h.environmentTexture,i);h.environmentTextureRotationY&&(k.rotationY=h.environmentTextureRotationY),i.environmentTexture=k}else{var H=di.CreateFromPrefilteredData((h.environmentTexture.match(/https?:\/\//g)?"":e)+h.environmentTexture,i);h.environmentTextureRotationY&&(H.rotationY=h.environmentTextureRotationY),i.environmentTexture=H}if(h.createDefaultSkybox===!0){var J=i.activeCamera!==void 0&&i.activeCamera!==null?(i.activeCamera.maxZ-i.activeCamera.minZ)/2:1e3,te=h.skyboxBlurLevel||0;i.createDefaultSkybox(i.environmentTexture,D,J,te)}o.environmentTexture=i.environmentTexture}if(h.environmentIntensity!==void 0&&h.environmentIntensity!==null&&(i.environmentIntensity=h.environmentIntensity),h.lights!==void 0&&h.lights!==null)for(v=0,b=h.lights.length;v<b;v++){var oe=h.lights[v],ce=ro.a.Parse(oe,i);ce&&(o.lights.push(ce),l+=v===0?`
	Lights:`:"",l+=`
		`+ce.toString(A))}if(h.reflectionProbes!==void 0&&h.reflectionProbes!==null)for(v=0,b=h.reflectionProbes.length;v<b;v++){var he=h.reflectionProbes[v],_e=g0.Parse(he,i,e);_e&&(o.reflectionProbes.push(_e),l+=v===0?`
	Reflection Probes:`:"",l+=`
		`+_e.toString(A))}if(h.animations!==void 0&&h.animations!==null)for(v=0,b=h.animations.length;v<b;v++){var ye=h.animations[v],Ee=M.a.GetClass("BABYLON.Animation");if(Ee){var Oe=Ee.Parse(ye);i.animations.push(Oe),o.animations.push(Oe),l+=v===0?`
	Animations:`:"",l+=`
		`+Oe.toString(A)}}if(h.materials!==void 0&&h.materials!==null)for(v=0,b=h.materials.length;v<b;v++){var Ae=h.materials[v],xe=nn.a.Parse(Ae,i,e);xe&&(o.materials.push(xe),l+=v===0?`
	Materials:`:"",l+=`
		`+xe.toString(A),xe.getActiveTextures().forEach(function(pn){o.textures.indexOf(pn)==-1&&o.textures.push(pn)}))}if(h.multiMaterials!==void 0&&h.multiMaterials!==null)for(v=0,b=h.multiMaterials.length;v<b;v++){var Pe=h.multiMaterials[v],Be=Aa.a.ParseMultiMaterial(Pe,i);o.multiMaterials.push(Be),l+=v===0?`
	MultiMaterials:`:"",l+=`
		`+Be.toString(A),Be.getActiveTextures().forEach(function(pn){o.textures.indexOf(pn)==-1&&o.textures.push(pn)})}if(h.morphTargetManagers!==void 0&&h.morphTargetManagers!==null)for(var Ce=0,Ue=h.morphTargetManagers;Ce<Ue.length;Ce++){var Le=Ue[Ce];o.morphTargetManagers.push(mh.Parse(Le,i))}if(h.skeletons!==void 0&&h.skeletons!==null)for(v=0,b=h.skeletons.length;v<b;v++){var ke=h.skeletons[v],qe=ga.Parse(ke,i);o.skeletons.push(qe),l+=v===0?`
	Skeletons:`:"",l+=`
		`+qe.toString(A)}var at=h.geometries;if(at!=null){var lt=new Array,ft=at.vertexData;if(ft!=null)for(v=0,b=ft.length;v<b;v++){var Je=ft[v];lt.push($p.a.Parse(Je,i,e))}lt.forEach(function(pn){pn&&o.geometries.push(pn)})}if(h.transformNodes!==void 0&&h.transformNodes!==null)for(v=0,b=h.transformNodes.length;v<b;v++){var dt=h.transformNodes[v],ut=ps.a.Parse(dt,i,e);o.transformNodes.push(ut)}if(h.meshes!==void 0&&h.meshes!==null)for(v=0,b=h.meshes.length;v<b;v++){var tt=h.meshes[v],mt=Ne.a.Parse(tt,i,e);if(o.meshes.push(mt),mt.hasInstances)for(var ze=0,rt=mt.instances;ze<rt.length;ze++){var At=rt[ze];o.meshes.push(At)}l+=v===0?`
	Meshes:`:"",l+=`
		`+mt.toString(A)}if(h.cameras!==void 0&&h.cameras!==null)for(v=0,b=h.cameras.length;v<b;v++){var sn=h.cameras[v],Ht=Tt.a.Parse(sn,i);o.cameras.push(Ht),l+=v===0?`
	Cameras:`:"",l+=`
		`+Ht.toString(A)}if(h.postProcesses!==void 0&&h.postProcesses!==null)for(v=0,b=h.postProcesses.length;v<b;v++){var fn=h.postProcesses[v],St=bt.Parse(fn,i,e);St&&(o.postProcesses.push(St),l+=v===0?`
Postprocesses:`:"",l+=`
		`+St.toString())}if(h.animationGroups!==void 0&&h.animationGroups!==null)for(v=0,b=h.animationGroups.length;v<b;v++){var bn=h.animationGroups[v],cn=et.Parse(bn,i);o.animationGroups.push(cn),l+=v===0?`
	AnimationGroups:`:"",l+=`
		`+cn.toString(A)}for(v=0,b=i.cameras.length;v<b;v++)(Ht=i.cameras[v])._waitingParentId&&(Ht.parent=i.getLastEntryByID(Ht._waitingParentId),Ht._waitingParentId=null);for(v=0,b=i.lights.length;v<b;v++){var en=i.lights[v];en&&en._waitingParentId&&(en.parent=i.getLastEntryByID(en._waitingParentId),en._waitingParentId=null)}for(v=0,b=i.transformNodes.length;v<b;v++){var ln=i.transformNodes[v];ln._waitingParentId&&(ln.parent=i.getLastEntryByID(ln._waitingParentId),ln._waitingParentId=null)}for(v=0,b=i.meshes.length;v<b;v++)(mt=i.meshes[v])._waitingParentId&&(mt.parent=i.getLastEntryByID(mt._waitingParentId),mt._waitingParentId=null),mt._waitingData.lods&&b0(i,mt);for(v=0,b=i.skeletons.length;v<b;v++)(qe=i.skeletons[v])._hasWaitingData&&(qe.bones!=null&&qe.bones.forEach(function(pn){if(pn._waitingTransformNodeId){var gi=i.getLastEntryByID(pn._waitingTransformNodeId);gi&&pn.linkTransformNode(gi),pn._waitingTransformNodeId=null}}),qe._waitingOverrideMeshId&&(qe.overrideMesh=i.getMeshByID(qe._waitingOverrideMeshId),qe._waitingOverrideMeshId=null),qe._hasWaitingData=null);for(v=0,b=i.meshes.length;v<b;v++){var Ot=i.meshes[v];Ot._waitingData.freezeWorldMatrix?(Ot.freezeWorldMatrix(),Ot._waitingData.freezeWorldMatrix=null):Ot.computeWorldMatrix(!0)}for(v=0,b=i.lights.length;v<b;v++){var kt=i.lights[v];if(kt._excludedMeshesIds.length>0){for(var Tn=0;Tn<kt._excludedMeshesIds.length;Tn++){var Er=i.getMeshByID(kt._excludedMeshesIds[Tn]);Er&&kt.excludedMeshes.push(Er)}kt._excludedMeshesIds=[]}if(kt._includedOnlyMeshesIds.length>0){for(var wr=0;wr<kt._includedOnlyMeshesIds.length;wr++){var ri=i.getMeshByID(kt._includedOnlyMeshesIds[wr]);ri&&kt.includedOnlyMeshes.push(ri)}kt._includedOnlyMeshesIds=[]}}for(T.a.Parse(h,i,o,e),v=0,b=i.meshes.length;v<b;v++)(mt=i.meshes[v])._waitingData.actions&&(me.Parse(mt._waitingData.actions,mt,i),mt._waitingData.actions=null);h.actions!==void 0&&h.actions!==null&&me.Parse(h.actions,null,i)}catch(pn){var Sr=xs("loadAssets",h?h.producer:"Unknown")+l;if(!n)throw p.a.Log(Sr),pn;n(Sr,pn)}finally{r||o.removeAllFromScene(),l!==null&&Zt.loggingLevel!==Zt.NO_LOGGING&&p.a.Log(xs("loadAssets",h?h.producer:"Unknown")+(Zt.loggingLevel!==Zt.MINIMAL_LOGGING?l:""))}return o};Zt.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(i){return i.indexOf("babylon")!==-1},importMesh:function(i,t,e,n,r,o,l,h){var v="importMesh has failed JSON parse";try{var b=JSON.parse(e);v="";var A=Zt.loggingLevel===Zt.DETAILED_LOGGING;i?Array.isArray(i)||(i=[i]):i=null;var D=new Array;if(b.meshes!==void 0&&b.meshes!==null){var N,j,k,H=[],J=[];for(N=0,j=b.meshes.length;N<j;N++){var te=b.meshes[N];if(i===null||qD(te,i,D)){if(i!==null&&delete i[i.indexOf(te.name)],te.geometryId!==void 0&&te.geometryId!==null&&b.geometries!==void 0&&b.geometries!==null){var oe=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(ut){oe!==!0&&b.geometries[ut]&&Array.isArray(b.geometries[ut])&&b.geometries[ut].forEach(function(tt){if(tt.id===te.geometryId){switch(ut){case"vertexData":$p.a.Parse(tt,t,n)}oe=!0}})}),oe===!1&&p.a.Warn("Geometry not found for mesh "+te.id)}if(te.materialId){var ce=J.indexOf(te.materialId)!==-1;if(ce===!1&&b.multiMaterials!==void 0&&b.multiMaterials!==null)for(var he=0,_e=b.multiMaterials.length;he<_e;he++){var ye=b.multiMaterials[he];if(ye.id===te.materialId){for(var Ee=0,Oe=ye.materials.length;Ee<Oe;Ee++){var Ae,xe=ye.materials[Ee];J.push(xe),(Ae=v0(xe,b,t,n))&&(v+=`
	Material `+Ae.toString(A))}J.push(ye.id);var Pe=Aa.a.ParseMultiMaterial(ye,t);Pe&&(ce=!0,v+=`
	Multi-Material `+Pe.toString(A));break}}ce===!1&&(J.push(te.materialId),(Ae=v0(te.materialId,b,t,n))?v+=`
	Material `+Ae.toString(A):p.a.Warn("Material not found for mesh "+te.id))}if(te.skeletonId>-1&&b.skeletons!==void 0&&b.skeletons!==null&&!(H.indexOf(te.skeletonId)>-1))for(var Be=0,Ce=b.skeletons.length;Be<Ce;Be++){var Ue=b.skeletons[Be];if(Ue.id===te.skeletonId){var Le=ga.Parse(Ue,t);l.push(Le),H.push(Ue.id),v+=`
	Skeleton `+Le.toString(A)}}if(b.morphTargetManagers!==void 0&&b.morphTargetManagers!==null)for(var ke=0,qe=b.morphTargetManagers;ke<qe.length;ke++){var at=qe[ke];mh.Parse(at,t)}var lt=Ne.a.Parse(te,t,n);r.push(lt),v+=`
	Mesh `+lt.toString(A)}}for(N=0,j=t.meshes.length;N<j;N++)(k=t.meshes[N])._waitingParentId&&(k.parent=t.getLastEntryByID(k._waitingParentId),k._waitingParentId=null),k._waitingData.lods&&b0(t,k);for(N=0,j=t.skeletons.length;N<j;N++)(Le=t.skeletons[N])._hasWaitingData&&(Le.bones!=null&&Le.bones.forEach(function(ut){if(ut._waitingTransformNodeId){var tt=t.getLastEntryByID(ut._waitingTransformNodeId);tt&&ut.linkTransformNode(tt),ut._waitingTransformNodeId=null}}),Le._waitingOverrideMeshId&&(Le.overrideMesh=t.getMeshByID(Le._waitingOverrideMeshId),Le._waitingOverrideMeshId=null),Le._hasWaitingData=null);for(N=0,j=t.meshes.length;N<j;N++)(k=t.meshes[N])._waitingData.freezeWorldMatrix?(k.freezeWorldMatrix(),k._waitingData.freezeWorldMatrix=null):k.computeWorldMatrix(!0)}if(b.particleSystems!==void 0&&b.particleSystems!==null){var ft=T.a.GetIndividualParser(ct.a.NAME_PARTICLESYSTEM);if(ft)for(N=0,j=b.particleSystems.length;N<j;N++){var Je=b.particleSystems[N];D.indexOf(Je.emitterId)!==-1&&o.push(ft(Je,t,n))}}return!0}catch(ut){var dt=xs("importMesh",b?b.producer:"Unknown")+v;if(!h)throw p.a.Log(dt),ut;h(dt,ut)}finally{v!==null&&Zt.loggingLevel!==Zt.NO_LOGGING&&p.a.Log(xs("importMesh",b?b.producer:"Unknown")+(Zt.loggingLevel!==Zt.MINIMAL_LOGGING?v:""))}return!1},load:function(i,t,e,n){var r="importScene has failed JSON parse";try{var o=JSON.parse(t);if(r="",o.useDelayedTextureLoading!==void 0&&o.useDelayedTextureLoading!==null&&(i.useDelayedTextureLoading=o.useDelayedTextureLoading&&!Zt.ForceFullSceneLoadingForIncremental),o.autoClear!==void 0&&o.autoClear!==null&&(i.autoClear=o.autoClear),o.clearColor!==void 0&&o.clearColor!==null&&(i.clearColor=x.b.FromArray(o.clearColor)),o.ambientColor!==void 0&&o.ambientColor!==null&&(i.ambientColor=x.a.FromArray(o.ambientColor)),o.gravity!==void 0&&o.gravity!==null&&(i.gravity=d.e.FromArray(o.gravity)),o.fogMode&&o.fogMode!==0)switch(i.fogMode=o.fogMode,i.fogColor=x.a.FromArray(o.fogColor),i.fogStart=o.fogStart,i.fogEnd=o.fogEnd,i.fogDensity=o.fogDensity,r+="	Fog mode for scene:  ",i.fogMode){case 1:r+=`exp
`;break;case 2:r+=`exp2
`;break;case 3:r+=`linear
`}if(o.physicsEnabled){var l;o.physicsEngine==="cannon"?l=new tm(void 0,void 0,gh.LoaderInjectedPhysicsEngine):o.physicsEngine==="oimo"?l=new m0(void 0,gh.LoaderInjectedPhysicsEngine):o.physicsEngine==="ammo"&&(l=new _0(void 0,gh.LoaderInjectedPhysicsEngine,void 0)),r="	Physics engine "+(o.physicsEngine?o.physicsEngine:"oimo")+` enabled
`;var h=o.physicsGravity?d.e.FromArray(o.physicsGravity):null;i.enablePhysics(h,l)}return o.metadata!==void 0&&o.metadata!==null&&(i.metadata=o.metadata),o.collisionsEnabled!==void 0&&o.collisionsEnabled!==null&&(i.collisionsEnabled=o.collisionsEnabled),!!y0(i,t,e,n,!0)&&(o.autoAnimate&&i.beginAnimation(i,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),o.activeCameraID!==void 0&&o.activeCameraID!==null&&i.setActiveCameraByID(o.activeCameraID),!0)}catch(b){var v=xs("importScene",o?o.producer:"Unknown")+r;if(!n)throw p.a.Log(v),b;n(v,b)}finally{r!==null&&Zt.loggingLevel!==Zt.NO_LOGGING&&p.a.Log(xs("importScene",o?o.producer:"Unknown")+(Zt.loggingLevel!==Zt.MINIMAL_LOGGING?r:""))}return!1},loadAssetContainer:function(i,t,e,n){return y0(i,t,e,n)}});var ZD=c(121),T0=function(){function i(t){t===void 0&&(t={}),this._isEnabled=!0,this.bias=t.bias===void 0?0:t.bias,this.power=t.power===void 0?1:t.power,this.leftColor=t.leftColor||x.a.White(),this.rightColor=t.rightColor||x.a.Black(),t.isEnabled===!1&&(this.isEnabled=!1)}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,Xe.a.MarkAllMaterialsAsDirty(g.a.MATERIAL_FresnelDirtyFlag|g.a.MATERIAL_MiscDirtyFlag))},enumerable:!1,configurable:!0}),i.prototype.clone=function(){var t=new i;return fe.a.DeepCopy(this,t),t},i.prototype.equals=function(t){return t&&this.bias===t.bias&&this.power===t.power&&this.leftColor.equals(t.leftColor)&&this.rightColor.equals(t.rightColor)&&this.isEnabled===t.isEnabled},i.prototype.serialize=function(){return{isEnabled:this.isEnabled,leftColor:this.leftColor.asArray(),rightColor:this.rightColor.asArray(),bias:this.bias,power:this.power}},i.Parse=function(t){return new i({isEnabled:t.isEnabled,leftColor:x.a.FromArray(t.leftColor),rightColor:x.a.FromArray(t.rightColor),bias:t.bias,power:t.power||1})},i}();V.a._FresnelParametersParser=T0.Parse;var E0=c(119),nm=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r.maxSimultaneousLights=4,r.disableLighting=!1,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.emissiveColor=new x.a(0,0,0),r.occlusionStrength=1,r.useLightmapAsShadowmap=!1,r._useAlphaFromAlbedoTexture=!0,r._useAmbientInGrayScale=!0,r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),Object(_.c)([Object(V.e)("emissive"),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),Object(_.c)([Object(V.c)()],t.prototype,"doubleSided",null),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(Gn),S0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r.metallic=1,r.roughness=1,r}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var n=this,r=V.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=V.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(_.c)([Object(V.e)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(nm);M.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=S0;var x0=function(i){function t(e,n){var r=i.call(this,e,n)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var n=this,r=V.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),this.subSurface.copyTo(r.subSurface),r},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e},t.Parse=function(e,n,r){var o=V.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&o.clearCoat.parse(e.clearCoat,n,r),e.anisotropy&&o.anisotropy.parse(e.anisotropy,n,r),e.brdf&&o.brdf.parse(e.brdf,n,r),e.sheen&&o.sheen.parse(e.sheen,n,r),e.subSurface&&o.subSurface.parse(e.subSurface,n,r),o},Object(_.c)([Object(V.e)("diffuse"),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),Object(_.c)([Object(V.e)("specular"),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),Object(_.c)([Object(V.c)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),Object(_.c)([Object(V.m)(),Object(V.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(nm);M.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=x0;var vh=c(73),P0=function(i){function t(e,n,r){r===void 0&&(r=null);var o=i.call(this,n)||this;if(!e)return o;if(o._textureMatrix=d.a.Identity(),o.name=e,o.url=e,o._onLoad=r,o._texture=o._getFromCache(e,!0),o._texture)o._triggerOnLoad();else{var l=o.getScene();l&&l.useDelayedTextureLoading?o.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:o.loadTexture()}return o}return Object(_.d)(t,i),t.prototype._triggerOnLoad=function(){this._onLoad&&this._onLoad()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var e,n=this,r=this._getEngine();e=r.webGLVersion===1?r.createRawTexture(null,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT):r.createRawTexture3D(null,1,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,null,g.a.TEXTURETYPE_UNSIGNED_INT),this._texture=e,this._texture.isReady=!1,this.isCube=!1,this.is3D=r.webGLVersion>1,this.wrapU=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapV=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.wrapR=g.a.TEXTURE_CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1;var o=function(h){if(typeof h=="string"){for(var v,b=null,A=null,D=h.split(`
`),N=0,j=0,k=0,H=0,J=0,te=0;te<D.length;te++)if(v=D[te],t._noneEmptyLineRegex.test(v)&&v.indexOf("#")!==0){var oe=v.split(" ");if(N!==0){if(N!=0){var ce=Math.max(parseInt(oe[0]),0),he=Math.max(parseInt(oe[1]),0),_e=Math.max(parseInt(oe[2]),0);J=Math.max(ce,J),J=Math.max(he,J),J=Math.max(_e,J);var ye=4*(j+H*N+k*N*N);A&&(A[ye+0]=ce,A[ye+1]=he,A[ye+2]=_e),++k%N==0&&(k=0,++H%N==0&&(j++,H=0))}}else N=oe.length,b=new Uint8Array(N*N*N*4),A=new Float32Array(N*N*N*4)}if(A&&b)for(te=0;te<A.length;te++)if(te>0&&(te+1)%4==0)b[te]=255;else{var Ee=A[te];b[te]=Ee/J*255}e.is3D?(e.updateSize(N,N,N),r.updateRawTexture3D(e,b,g.a.TEXTUREFORMAT_RGBA,!1)):(e.updateSize(N*N,N),r.updateRawTexture(e,b,g.a.TEXTUREFORMAT_RGBA,!1)),e.isReady=!0,n._triggerOnLoad()}},l=this.getScene();return l?l._loadFile(this.url,o):r._loadFile(this.url,o),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine());return e.level=this.level,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(e,n){var r=null;return e.name&&!e.isRenderTarget&&((r=new t(e.name,n)).name=e.name,r.level=e.level),r},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._noneEmptyLineRegex=/\S+/,t}(jr.a);M.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=P0;var A0=function(i){function t(e,n,r,o,l,h,v){o===void 0&&(o=!1),l===void 0&&(l=!0),h===void 0&&(h=null),v===void 0&&(v=null);var b=i.call(this,n)||this;if(b._onLoad=null,b._onError=null,!e)throw new Error("Image url is not set");return b._coordinatesMode=Ve.a.CUBIC_MODE,b.name=e,b.url=e,b._size=r,b._noMipmap=o,b.gammaSpace=l,b._onLoad=h,b._onError=v,b.hasAlpha=!1,b.isCube=!0,b._texture=b._getFromCache(e,b._noMipmap),b._texture?h&&(b._texture.isReady?Qe.b.SetImmediate(function(){return h()}):b._texture.onLoadedObservable.add(h)):n.useDelayedTextureLoading?b.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:b.loadImage(b.loadTexture.bind(b),b._onError),b}return Object(_.d)(t,i),t.prototype.loadImage=function(e,n){var r=this,o=document.createElement("canvas"),l=new Image;l.addEventListener("load",function(){r._width=l.width,r._height=l.height,o.width=r._width,o.height=r._height;var h=o.getContext("2d");h.drawImage(l,0,0);var v=h.getImageData(0,0,l.width,l.height);r._buffer=v.data.buffer,o.remove(),e()}),l.addEventListener("error",function(h){n&&n(r.getClassName()+" could not be loaded",h)}),l.src=this.url},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,g.a.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var r=e.getFloat32ArrayFromArrayBuffer(e._buffer),o=Jp.ConvertPanoramaToCubemap(r,e._width,e._height,e._size),l=[],h=0;h<6;h++){var v=o[t._FacesMapping[h]];l.push(v)}return l},null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(e){for(var n=new DataView(e),r=new Float32Array(3*e.byteLength/4),o=0,l=0;l<e.byteLength;l++)(l+1)%4!=0&&(r[o++]=n.getUint8(l)/255);return r},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t._FacesMapping=["right","left","up","down","front","back"],t}(jr.a),$D=function(i){function t(e,n,r){var o=i.call(this,r.scene||r.engine)||this;return n&&(r.engine||r.scene)&&(r=Object(_.a)(Object(_.a)({},t.DefaultOptions),r),o._generateMipMaps=r.generateMipMaps,o._samplingMode=r.samplingMode,o._textureMatrix=d.a.Identity(),o.name=e,o.element=n,o._isVideo=n instanceof HTMLVideoElement,o.anisotropicFilteringLevel=1,o._createInternalTexture()),o}return Object(_.d)(t,i),t.prototype._createInternalTexture=function(){var e=0,n=0;this._isVideo?(e=this.element.videoWidth,n=this.element.videoHeight):(e=this.element.width,n=this.element.height);var r=this._getEngine();r&&(this._texture=r.createDynamicTexture(e,n,this._generateMipMaps,this._samplingMode)),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){e===void 0&&(e=null);var n=this._getEngine();if(this._texture!=null&&n!=null)if(this._isVideo){var r=this.element;if(r.readyState<r.HAVE_CURRENT_DATA)return;n.updateVideoTexture(this._texture,r,e===null||e)}else{var o=this.element;n.updateDynamicTexture(this._texture,o,e===null||e,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:g.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(jr.a),bh=function(){function i(){}return i.GetTGAHeader=function(t){var e=0;return{id_length:t[e++],colormap_type:t[e++],image_type:t[e++],colormap_index:t[e++]|t[e++]<<8,colormap_length:t[e++]|t[e++]<<8,colormap_size:t[e++],origin:[t[e++]|t[e++]<<8,t[e++]|t[e++]<<8],width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixel_size:t[e++],flags:t[e++]}},i.UploadContent=function(t,e){if(e.length<19)p.a.Error("Unable to load TGA file - Not enough data to contain header");else{var n=18,r=i.GetTGAHeader(e);if(r.id_length+n>e.length)p.a.Error("Unable to load TGA file - Not enough data");else{n+=r.id_length;var o,l=!1,h=!1,v=!1;switch(r.image_type){case i._TYPE_RLE_INDEXED:l=!0;case i._TYPE_INDEXED:h=!0;break;case i._TYPE_RLE_RGB:l=!0;case i._TYPE_RGB:break;case i._TYPE_RLE_GREY:l=!0;case i._TYPE_GREY:v=!0}var b,A,D,N,j,k,H,J=r.pixel_size>>3,te=r.width*r.height*J;if(h&&(b=e.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),l){var oe,ce,he;o=new Uint8Array(te);for(var _e=0,ye=new Uint8Array(J);n<te&&_e<te;)if(ce=1+(127&(oe=e[n++])),128&oe){for(he=0;he<J;++he)ye[he]=e[n++];for(he=0;he<ce;++he)o.set(ye,_e+he*J);_e+=J*ce}else{for(ce*=J,he=0;he<ce;++he)o[_e+he]=e[n++];_e+=ce}}else o=e.subarray(n,n+=h?r.width*r.height:te);switch((r.flags&i._ORIGIN_MASK)>>i._ORIGIN_SHIFT){default:case i._ORIGIN_UL:A=0,N=1,H=r.width,D=0,j=1,k=r.height;break;case i._ORIGIN_BL:A=0,N=1,H=r.width,D=r.height-1,j=-1,k=-1;break;case i._ORIGIN_UR:A=r.width-1,N=-1,H=-1,D=0,j=1,k=r.height;break;case i._ORIGIN_BR:A=r.width-1,N=-1,H=-1,D=r.height-1,j=-1,k=-1}var Ee=i["_getImageData"+(v?"Grey":"")+r.pixel_size+"bits"](r,b,o,D,j,k,A,N,H);t.getEngine()._uploadDataToTextureDirectly(t,Ee)}}},i._getImageData8bits=function(t,e,n,r,o,l,h,v,b){var A,D,N,j=n,k=e,H=t.width,J=t.height,te=0,oe=new Uint8Array(H*J*4);for(N=r;N!==l;N+=o)for(D=h;D!==b;D+=v,te++)A=j[te],oe[4*(D+H*N)+3]=255,oe[4*(D+H*N)+2]=k[3*A+0],oe[4*(D+H*N)+1]=k[3*A+1],oe[4*(D+H*N)+0]=k[3*A+2];return oe},i._getImageData16bits=function(t,e,n,r,o,l,h,v,b){var A,D,N,j=n,k=t.width,H=t.height,J=0,te=new Uint8Array(k*H*4);for(N=r;N!==l;N+=o)for(D=h;D!==b;D+=v,J+=2){var oe=255*((31744&(A=j[J+0]+(j[J+1]<<8)))>>10)/31|0,ce=255*((992&A)>>5)/31|0,he=255*(31&A)/31|0;te[4*(D+k*N)+0]=oe,te[4*(D+k*N)+1]=ce,te[4*(D+k*N)+2]=he,te[4*(D+k*N)+3]=32768&A?0:255}return te},i._getImageData24bits=function(t,e,n,r,o,l,h,v,b){var A,D,N=n,j=t.width,k=t.height,H=0,J=new Uint8Array(j*k*4);for(D=r;D!==l;D+=o)for(A=h;A!==b;A+=v,H+=3)J[4*(A+j*D)+3]=255,J[4*(A+j*D)+2]=N[H+0],J[4*(A+j*D)+1]=N[H+1],J[4*(A+j*D)+0]=N[H+2];return J},i._getImageData32bits=function(t,e,n,r,o,l,h,v,b){var A,D,N=n,j=t.width,k=t.height,H=0,J=new Uint8Array(j*k*4);for(D=r;D!==l;D+=o)for(A=h;A!==b;A+=v,H+=4)J[4*(A+j*D)+2]=N[H+0],J[4*(A+j*D)+1]=N[H+1],J[4*(A+j*D)+0]=N[H+2],J[4*(A+j*D)+3]=N[H+3];return J},i._getImageDataGrey8bits=function(t,e,n,r,o,l,h,v,b){var A,D,N,j=n,k=t.width,H=t.height,J=0,te=new Uint8Array(k*H*4);for(N=r;N!==l;N+=o)for(D=h;D!==b;D+=v,J++)A=j[J],te[4*(D+k*N)+0]=A,te[4*(D+k*N)+1]=A,te[4*(D+k*N)+2]=A,te[4*(D+k*N)+3]=255;return te},i._getImageDataGrey16bits=function(t,e,n,r,o,l,h,v,b){var A,D,N=n,j=t.width,k=t.height,H=0,J=new Uint8Array(j*k*4);for(D=r;D!==l;D+=o)for(A=h;A!==b;A+=v,H+=2)J[4*(A+j*D)+0]=N[H+0],J[4*(A+j*D)+1]=N[H+0],J[4*(A+j*D)+2]=N[H+0],J[4*(A+j*D)+3]=N[H+1];return J},i._TYPE_INDEXED=1,i._TYPE_RGB=2,i._TYPE_GREY=3,i._TYPE_RLE_INDEXED=9,i._TYPE_RLE_RGB=10,i._TYPE_RLE_GREY=11,i._ORIGIN_MASK=48,i._ORIGIN_SHIFT=4,i._ORIGIN_BL=0,i._ORIGIN_BR=1,i._ORIGIN_UL=2,i._ORIGIN_UR=3,i}(),C0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return Jr.a.EndsWith(t,".tga")},i.prototype.loadCubeData=function(t,e,n,r,o){throw".env not supported in Cube."},i.prototype.loadData=function(t,e,n){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o=bh.GetTGAHeader(r);n(o.width,o.height,e.generateMipMaps,!1,function(){bh.UploadContent(e,r)})},i}();Xe.a._TextureLoaders.push(new C0);var ol,JD=function(){};(function(i){i[i.cTFETC1=0]="cTFETC1",i[i.cTFBC1=1]="cTFBC1",i[i.cTFBC4=2]="cTFBC4",i[i.cTFPVRTC1_4_OPAQUE_ONLY=3]="cTFPVRTC1_4_OPAQUE_ONLY",i[i.cTFBC7_M6_OPAQUE_ONLY=4]="cTFBC7_M6_OPAQUE_ONLY",i[i.cTFETC2=5]="cTFETC2",i[i.cTFBC3=6]="cTFBC3",i[i.cTFBC5=7]="cTFBC5"})(ol||(ol={}));var al=function(){function i(){}return i.GetInternalFormatFromBasisFormat=function(t){if(t===ol.cTFETC1)return 36196;if(t===ol.cTFBC1)return 33776;if(t===ol.cTFBC3)return 33779;throw"The chosen Basis transcoder format is not currently supported"},i._CreateWorkerAsync=function(){var t=this;return this._WorkerPromise||(this._WorkerPromise=new Promise(function(e){t._Worker?e(t._Worker):Qe.b.LoadFileAsync(i.WasmModuleURL).then(function(n){var r=URL.createObjectURL(new Blob(["("+ew+")()"],{type:"application/javascript"}));t._Worker=new Worker(r);var o=function(l){l.data.action==="init"&&(t._Worker.removeEventListener("message",o),e(t._Worker))};t._Worker.addEventListener("message",o),t._Worker.postMessage({action:"init",url:i.JSModuleURL,wasmBinary:n})})})),this._WorkerPromise},i.TranscodeAsync=function(t,e){var n=this,r=t instanceof ArrayBuffer?new Uint8Array(t):t;return new Promise(function(o,l){n._CreateWorkerAsync().then(function(){var h=n._actionId++,v=function(A){A.data.action==="transcode"&&A.data.id===h&&(n._Worker.removeEventListener("message",v),A.data.success?o(A.data):l("Transcode is not supported on this device"))};n._Worker.addEventListener("message",v);var b=new Uint8Array(r.byteLength);b.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),n._Worker.postMessage({action:"transcode",id:h,imageData:b,config:e,ignoreSupportedFormats:n._IgnoreSupportedFormats},[b.buffer])})})},i.LoadTextureFromTranscodeResult=function(t,e){for(var n,r=t.getEngine(),o=function(){if(n=e.fileInfo.images[l].levels[0],t._invertVScale=t.invertY,e.format===-1)if(t.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,t.format=g.a.TEXTUREFORMAT_RGB,r.webGLVersion<2&&(se.a.Log2(n.width)%1!=0||se.a.Log2(n.height)%1!=0)){var h=new Mt.a(r,Mt.b.Temp);t._invertVScale=t.invertY,h.type=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,h.format=g.a.TEXTUREFORMAT_RGB,h.width=n.width+3&-4,h.height=n.height+3&-4,r._bindTextureDirectly(r._gl.TEXTURE_2D,h,!0),r._uploadDataToTextureDirectly(h,n.transcodedPixels,l,0,g.a.TEXTUREFORMAT_RGB,!0),r._rescaleTexture(h,t,r.scenes[0],r._getInternalFormat(g.a.TEXTUREFORMAT_RGB),function(){r._releaseTexture(h),r._bindTextureDirectly(r._gl.TEXTURE_2D,t,!0)})}else t._invertVScale=!t.invertY,t.width=n.width+3&-4,t.height=n.height+3&-4,r._uploadDataToTextureDirectly(t,n.transcodedPixels,l,0,g.a.TEXTUREFORMAT_RGB,!0);else t.width=n.width,t.height=n.height,e.fileInfo.images[l].levels.forEach(function(v,b){r._uploadCompressedDataToTextureDirectly(t,i.GetInternalFormatFromBasisFormat(e.format),v.width,v.height,v.transcodedPixels,l,b)}),r.webGLVersion<2&&(se.a.Log2(t.width)%1!=0||se.a.Log2(t.height)%1!=0)&&(Qe.b.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),t._cachedWrapU=Ve.a.CLAMP_ADDRESSMODE,t._cachedWrapV=Ve.a.CLAMP_ADDRESSMODE)},l=0;l<e.fileInfo.images.length;l++)o()},i._IgnoreSupportedFormats=!1,i.JSModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js",i.WasmModuleURL="https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm",i._WorkerPromise=null,i._Worker=null,i._actionId=0,i}();function ew(){var i=0,t=1,e=5,n=6,r=null;function o(l,h,v,b,A){var D=l.getImageTranscodedSizeInBytes(h,v,b),N=new Uint8Array(D);return l.transcodeImage(N,h,v,b,1,0)?(A&&(N=function(j,k,H,J){for(var te=new Uint16Array(4),oe=new Uint16Array(H*J),ce=H/4,he=J/4,_e=0;_e<he;_e++)for(var ye=0;ye<ce;ye++){var Ee=k+8*(_e*ce+ye);te[0]=j[Ee]|j[Ee+1]<<8,te[1]=j[Ee+2]|j[Ee+3]<<8,te[2]=(2*(31&te[0])+1*(31&te[1]))/3|(2*(2016&te[0])+1*(2016&te[1]))/3&2016|(2*(63488&te[0])+1*(63488&te[1]))/3&63488,te[3]=(2*(31&te[1])+1*(31&te[0]))/3|(2*(2016&te[1])+1*(2016&te[0]))/3&2016|(2*(63488&te[1])+1*(63488&te[0]))/3&63488;for(var Oe=0;Oe<4;Oe++){var Ae=j[Ee+4+Oe],xe=(4*_e+Oe)*H+4*ye;oe[xe++]=te[3&Ae],oe[xe++]=te[Ae>>2&3],oe[xe++]=te[Ae>>4&3],oe[xe++]=te[Ae>>6&3]}}return oe}(N,0,l.getImageWidth(h,v)+3&-4,l.getImageHeight(h,v)+3&-4)),N):null}onmessage=function(l){if(l.data.action==="init")r||(Module={wasmBinary:l.data.wasmBinary},importScripts(l.data.url),r=new Promise(function(_e){Module.onRuntimeInitialized=function(){Module.initializeBasis(),_e()}})),r.then(function(){postMessage({action:"init"})});else if(l.data.action==="transcode"){var h=l.data.config,v=l.data.imageData,b=new Module.BasisFile(v),A=function(_e){for(var ye=_e.getHasAlpha(),Ee=_e.getNumImages(),Oe=[],Ae=0;Ae<Ee;Ae++){for(var xe={levels:[]},Pe=_e.getNumLevels(Ae),Be=0;Be<Pe;Be++){var Ce={width:_e.getImageWidth(Ae,Be),height:_e.getImageHeight(Ae,Be)};xe.levels.push(Ce)}Oe.push(xe)}return{hasAlpha:ye,images:Oe}}(b),D=l.data.ignoreSupportedFormats?null:function(_e,ye){var Ee=null;return _e.supportedCompressionFormats&&(_e.supportedCompressionFormats.etc1?Ee=i:_e.supportedCompressionFormats.s3tc?Ee=ye.hasAlpha?n:t:_e.supportedCompressionFormats.pvrtc||_e.supportedCompressionFormats.etc2&&(Ee=e)),Ee}(l.data.config,A),N=!1;D===null&&(N=!0,D=A.hasAlpha?n:t);var j=!0;b.startTranscoding()||(j=!1);for(var k=[],H=0;H<A.images.length&&j;H++){var J=A.images[H];if(h.loadSingleImage===void 0||h.loadSingleImage===H){var te=J.levels.length;h.loadMipmapLevels===!1&&(te=1);for(var oe=0;oe<te;oe++){var ce=J.levels[oe],he=o(b,H,oe,D,N);if(!he){j=!1;break}ce.transcodedPixels=he,k.push(ce.transcodedPixels.buffer)}}}b.close(),b.delete(),N&&(D=-1),j?postMessage({action:"transcode",success:j,id:l.data.id,fileInfo:A,format:D},k):postMessage({action:"transcode",success:j,id:l.data.id})}}}var R0=function(){function i(){this.supportCascades=!1}return i.prototype.canLoad=function(t){return Jr.a.EndsWith(t,".basis")},i.prototype.loadCubeData=function(t,e,n,r,o){if(!Array.isArray(t)){var l=e.getEngine().getCaps(),h={supportedCompressionFormats:{etc1:!!l.etc1,s3tc:!!l.s3tc,pvrtc:!!l.pvrtc,etc2:!!l.etc2}};al.TranscodeAsync(t,h).then(function(v){var b=v.fileInfo.images[0].levels.length>1&&e.generateMipMaps;al.LoadTextureFromTranscodeResult(e,v),e.getEngine()._setCubeMapTextureParams(e,b),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),r&&r()}).catch(function(v){Qe.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),e.isReady=!0})}},i.prototype.loadData=function(t,e,n){var r=e.getEngine().getCaps(),o={supportedCompressionFormats:{etc1:!!r.etc1,s3tc:!!r.s3tc,pvrtc:!!r.pvrtc,etc2:!!r.etc2}};al.TranscodeAsync(t,o).then(function(l){var h=l.fileInfo.images[0].levels[0],v=l.fileInfo.images[0].levels.length>1&&e.generateMipMaps;n(h.width,h.height,v,l.format!==-1,function(){al.LoadTextureFromTranscodeResult(e,l)})}).catch(function(l){Qe.b.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),n(0,0,!1,!1,function(){})})},i}();Xe.a._TextureLoaders.push(new R0);var rm=function(i){function t(e,n,r,o,l){var h=this,v=!(!l||!l.generateMipMaps)&&l.generateMipMaps,b=!(!l||!l.generateDepthTexture)&&l.generateDepthTexture,A=!l||l.doNotChangeAspectRatio===void 0||l.doNotChangeAspectRatio;if((h=i.call(this,e,n,o,v,A)||this).isSupported){var D=[],N=[];h._initTypes(r,D,N,l);var j=!l||l.generateDepthBuffer===void 0||l.generateDepthBuffer,k=!(!l||l.generateStencilBuffer===void 0)&&l.generateStencilBuffer;return h._size=n,h._multiRenderTargetOptions={samplingModes:N,generateMipMaps:v,generateDepthBuffer:j,generateStencilBuffer:k,generateDepthTexture:b,types:D,textureCount:r},h._count=r,h._createInternalTextures(),h._createTextures(),h}h.dispose()}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._getEngine().webGLVersion>1||this._getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var n=0;n<this._textures.length;n++)this._textures[n].wrapV=e},enumerable:!1,configurable:!0}),t.prototype._initTypes=function(e,n,r,o){for(var l=0;l<e;l++)o&&o.types&&o.types[l]!==void 0?n.push(o.types[l]):n.push(o&&o.defaultType?o.defaultType:g.a.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&o.samplingModes[l]!==void 0?r.push(o.samplingModes[l]):r.push(Ve.a.BILINEAR_SAMPLINGMODE)},t.prototype._rebuild=function(e){e===void 0&&(e=!1),this.releaseInternalTextures(),this._createInternalTextures(),e&&this._createTextures();for(var n=0;n<this._internalTextures.length;n++)this._textures[n]._texture=this._internalTextures[n];this._texture=this._internalTextures[0],this.samples!==1&&this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,this.samples)},t.prototype._createInternalTextures=function(){this._internalTextures=this._getEngine().createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var e=0;e<this._internalTextures.length;e++){var n=new Ve.a(null,this.getScene());n._texture=this._internalTextures[e],this._textures.push(n)}this._texture=this._internalTextures[0]},t.prototype.replaceTexture=function(e,n){e._texture&&(this._textures[n]=e,this._internalTextures[n]=e._texture)},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._getEngine().updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!1,configurable:!0}),t.prototype.resize=function(e){this._size=e,this._rebuild()},t.prototype.updateCount=function(e,n){this._multiRenderTargetOptions.textureCount=e,this._count=e;var r=[],o=[];this._initTypes(e,r,o,n),this._multiRenderTargetOptions.types=r,this._multiRenderTargetOptions.samplingModes=o,this._rebuild(!0)},t.prototype.unbindFrameBuffer=function(e,n){var r=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(n)})},t.prototype.dispose=function(){this.releaseInternalTextures(),i.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)this._internalTextures[e]!==void 0&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},t}(Un),im=function(i,t,e){this.id=i,this.scale=t,this.offset=e},tw=function(){function i(t,e,n,r){var o,l,h,v,b,A,D,N,j,k,H,J,te;return this.name=t,this.meshes=e,this.scene=r,this.options=n,this.options.map=(o=this.options.map)!==null&&o!==void 0?o:["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=(l=this.options.uvsIn)!==null&&l!==void 0?l:Me.b.UVKind,this.options.uvsOut=(h=this.options.uvsOut)!==null&&h!==void 0?h:Me.b.UVKind,this.options.layout=(v=this.options.layout)!==null&&v!==void 0?v:i.LAYOUT_STRIP,this.options.layout===i.LAYOUT_COLNUM&&(this.options.colnum=(b=this.options.colnum)!==null&&b!==void 0?b:8),this.options.updateInputMeshes=(A=this.options.updateInputMeshes)===null||A===void 0||A,this.options.disposeSources=(D=this.options.disposeSources)===null||D===void 0||D,this._expecting=0,this.options.fillBlanks=(N=this.options.fillBlanks)===null||N===void 0||N,this.options.fillBlanks===!0&&(this.options.customFillColor=(j=this.options.customFillColor)!==null&&j!==void 0?j:"black"),this.options.frameSize=(k=this.options.frameSize)!==null&&k!==void 0?k:256,this.options.paddingRatio=(H=this.options.paddingRatio)!==null&&H!==void 0?H:.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=(J=this.options.paddingMode)!==null&&J!==void 0?J:i.SUBUV_WRAP,this.options.paddingMode===i.SUBUV_COLOR&&(this.options.paddingColor=(te=this.options.paddingColor)!==null&&te!==void 0?te:new x.b(0,0,0,1)),this.sets={},this.frames=[],this}return i.prototype._createFrames=function(t){for(var e=this,n=this._calculateSize(),r=new d.d(1,1).divide(n),o=0,l=this._expecting,h=this.meshes.length,v=Object.keys(this.sets),b=0;b<v.length;b++){var A=v[b],D=new Zi.a(this.name+".TexturePack."+A+"Set",{width:n.x,height:n.y},this.scene,!0,Ve.a.TRILINEAR_SAMPLINGMODE,Xe.a.TEXTUREFORMAT_RGBA),N=D.getContext();N.fillStyle="rgba(0,0,0,0)",N.fillRect(0,0,n.x,n.y),D.update(!1),this.sets[A]=D}var j=this.options.frameSize||256,k=this._paddingValue,H=j+2*k;for(b=0;b<h;b++)for(var J=this.meshes[b].material,te=function(he){var _e=new Zi.a("temp",H,oe.scene,!0),ye=_e.getContext(),Ee=oe._getFrameOffset(b),Oe=function(){o++,_e.update(!1);var Be=ye.getImageData(0,0,H,H),Ce=e.sets[Ae];if(Ce.getContext().putImageData(Be,n.x*Ee.x,n.y*Ee.y),_e.dispose(),Ce.update(!1),o==l)return e._calculateMeshUVFrames(j,k,n,r,e.options.updateInputMeshes||!1),void t()},Ae=v[he]||"_blank";if(J&&J[Ae]!==null){var xe=J[Ae],Pe=new Image;xe instanceof Zi.a?Pe.src=xe.getContext().canvas.toDataURL("image/png"):Pe.src=xe.url,Qe.b.SetCorsBehavior(Pe.src,Pe),Pe.onload=function(){ye.fillStyle="rgba(0,0,0,0)",ye.fillRect(0,0,H,H),_e.update(!1),ye.setTransform(1,0,0,-1,0,0);var Be=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(e.options.paddingMode){case 0:for(var Ce=0;Ce<9;Ce++)ye.drawImage(Pe,0,0,Pe.width,Pe.height,k+j*Be[Ce],k+j*Be[Ce+1]-H,j,j);break;case 1:for(var Ue=0;Ue<k;Ue++)ye.drawImage(Pe,0,0,Pe.width,Pe.height,Ue+j*Be[0],k-H,j,j),ye.drawImage(Pe,0,0,Pe.width,Pe.height,2*k-Ue,k-H,j,j),ye.drawImage(Pe,0,0,Pe.width,Pe.height,k,Ue-H,j,j),ye.drawImage(Pe,0,0,Pe.width,Pe.height,k,2*k-Ue-H,j,j);ye.drawImage(Pe,0,0,Pe.width,Pe.height,k+j*Be[0],k+j*Be[1]-H,j,j);break;case 2:ye.fillStyle=(e.options.paddingColor||x.a.Black()).toHexString(),ye.fillRect(0,0,H,-H),ye.clearRect(k,k,j,j),ye.drawImage(Pe,0,0,Pe.width,Pe.height,k+j*Be[0],k+j*Be[1]-H,j,j)}ye.setTransform(1,0,0,1,0,0),Oe()}}else ye.fillStyle="rgba(0,0,0,0)",oe.options.fillBlanks&&(ye.fillStyle=oe.options.customFillColor),ye.fillRect(0,0,H,H),Oe()},oe=this,ce=0;ce<v.length;ce++)te(ce)},i.prototype._calculateSize=function(){var t=this.meshes.length||0,e=this.options.frameSize||0,n=this._paddingValue||0;switch(this.options.layout){case 0:return new d.d(e*t+2*n*t,e+2*n);case 1:var r=Math.max(2,Math.ceil(Math.sqrt(t))),o=e*r+2*n*r;return new d.d(o,o);case 2:var l=this.options.colnum||1,h=Math.max(1,Math.ceil(t/l));return new d.d(e*l+2*n*l,e*h+2*n*h)}return d.d.Zero()},i.prototype._calculateMeshUVFrames=function(t,e,n,r,o){for(var l=this.meshes.length,h=0;h<l;h++){var v=this.meshes[h],b=new d.d(t/n.x,t/n.y),A=r.clone().scale(e),D=this._getFrameOffset(h).add(A),N=new im(h,b,D);this.frames.push(N),o&&(this._updateMeshUV(v,h),this._updateTextureReferences(v))}},i.prototype._getFrameOffset=function(t){var e,n,r,o=this.meshes.length;switch(this.options.layout){case 0:return e=1/o,new d.d(t*e,0);case 1:var l=Math.max(2,Math.ceil(Math.sqrt(o)));return r=t-(n=Math.floor(t/l))*l,e=1/l,new d.d(r*e,n*e);case 2:var h=this.options.colnum||1,v=Math.max(1,Math.ceil(o/h));return n=t-(r=Math.floor(t/v))*v,e=new d.d(1/h,1/v),new d.d(r*e.x,n*e.y)}return d.d.Zero()},i.prototype._updateMeshUV=function(t,e){var n=this.frames[e],r=t.getVerticesData(this.options.uvsIn||Me.b.UVKind),o=[],l=0;r.length&&(l=r.length||0);for(var h=0;h<l;h+=2)o.push(r[h]*n.scale.x+n.offset.x,r[h+1]*n.scale.y+n.offset.y);t.setVerticesData(this.options.uvsOut||Me.b.UVKind,o)},i.prototype._updateTextureReferences=function(t,e){e===void 0&&(e=!1);for(var n=t.material,r=Object.keys(this.sets),o=function(v){v.dispose&&v.dispose()},l=0;l<r.length;l++){var h=r[l];if(e)n[h]!==null&&o(n[h]),n[h]=this.sets[h];else{if(!n)return;n[h]!==null&&(o(n[h]),n[h]=this.sets[h])}}},i.prototype.setMeshToFrame=function(t,e,n){n===void 0&&(n=!1),this._updateMeshUV(t,e),n&&this._updateTextureReferences(t,!0)},i.prototype.processAsync=function(){var t=this;return new Promise(function(e,n){try{if(t.meshes.length===0)return void e();for(var r=0,o=function(v){var b=t.meshes[v],A=b.material;if(!A)return++r===t.meshes.length?{value:t._createFrames(e)}:"continue";A.forceCompilationAsync(b).then(function(){(function(D){if(r++,t.options.map){for(var N=0;N<t.options.map.length;N++)D[t.options.map[N]]!==null&&(t.sets[t.options.map[N]]||(t.sets[t.options.map[N]]=!0),t._expecting++);r===t.meshes.length&&t._createFrames(e)}})(A)})},l=0;l<t.meshes.length;l++){var h=o(l);if(typeof h=="object")return h.value}}catch(v){return n(v)}})},i.prototype.dispose=function(){for(var t=Object.keys(this.sets),e=0;e<t.length;e++){var n=t[e];this.sets[n].dispose()}},i.prototype.download=function(t,e){var n=this;t===void 0&&(t="png"),e===void 0&&(e=1),setTimeout(function(){var r={name:n.name,sets:{},options:{},frames:[]},o=Object.keys(n.sets),l=Object.keys(n.options);try{for(var h=0;h<o.length;h++){var v=o[h],b=n.sets[v];r.sets[v]=b.getContext().canvas.toDataURL("image/"+t,e)}for(h=0;h<l.length;h++){var A=l[h];r.options[A]=n.options[A]}for(h=0;h<n.frames.length;h++){var D=n.frames[h];r.frames.push(D.scale.x,D.scale.y,D.offset.x,D.offset.y)}}catch(k){return void p.a.Warn("Unable to download: "+k)}var N="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r,null,4)),j=document.createElement("a");j.setAttribute("href",N),j.setAttribute("download",n.name+"_texurePackage.json"),document.body.appendChild(j),j.click(),j.remove()},0)},i.prototype.updateFromJSON=function(t){try{var e=JSON.parse(t);this.name=e.name;for(var n=Object.keys(e.options),r=0;r<n.length;r++)this.options[n[r]]=e.options[n[r]];for(r=0;r<e.frames.length;r+=4){var o=new im(r/4,new d.d(e.frames[r],e.frames[r+1]),new d.d(e.frames[r+2],e.frames[r+3]));this.frames.push(o)}var l=Object.keys(e.sets);for(r=0;r<l.length;r++){var h=new Ve.a(e.sets[l[r]],this.scene,!1,!1);this.sets[l[r]]=h}}catch(v){p.a.Warn("Unable to update from JSON: "+v)}},i.LAYOUT_STRIP=0,i.LAYOUT_POWER2=1,i.LAYOUT_COLNUM=2,i.SUBUV_WRAP=0,i.SUBUV_EXTEND=1,i.SUBUV_COLOR=2,i}(),O0=function(){function i(t){this.name=ct.a.NAME_PROCEDURALTEXTURE,this.scene=t,this.scene.proceduralTextures=new Array}return i.prototype.register=function(){this.scene._beforeClearStage.registerStep(ct.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){Qe.b.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var t=0;t<this.scene.proceduralTextures.length;t++){var e=this.scene.proceduralTextures[t];e._shouldRender()&&e.render()}Qe.b.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},i}(),nw=`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.proceduralVertexShader=nw;var sl=function(i){function t(e,n,r,o,l,h,v,b){l===void 0&&(l=null),h===void 0&&(h=!0),v===void 0&&(v=!1),b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT);var A=i.call(this,null,o,!h)||this;A.isEnabled=!0,A.autoClear=!0,A.onGeneratedObservable=new E.c,A.onBeforeGenerationObservable=new E.c,A.nodeMaterialSource=null,A._textures={},A._currentRefreshId=-1,A._frameId=-1,A._refreshRate=1,A._vertexBuffers={},A._uniforms=new Array,A._samplers=new Array,A._floats={},A._ints={},A._floatsArrays={},A._colors3={},A._colors4={},A._vectors2={},A._vectors3={},A._matrices={},A._fallbackTextureUsed=!1,A._cachedDefines="",A._contentUpdateId=-1;var D=(o=A.getScene()||$.a.LastCreatedScene)._getComponent(ct.a.NAME_PROCEDURALTEXTURE);D||(D=new O0(o),o._addComponent(D)),o.proceduralTextures.push(A),A._fullEngine=o.getEngine(),A.name=e,A.isRenderTarget=!0,A._size=n,A._generateMipMaps=h,A.setFragment(r),A._fallbackTexture=l,v?(A._texture=A._fullEngine.createRenderTargetCubeTexture(n,{generateMipMaps:h,generateDepthBuffer:!1,generateStencilBuffer:!1,type:b}),A.setFloat("face",0)):A._texture=A._fullEngine.createRenderTargetTexture(n,{generateMipMaps:h,generateDepthBuffer:!1,generateStencilBuffer:!1,type:b});var N=[];return N.push(1,1),N.push(-1,1),N.push(-1,-1),N.push(1,-1),A._vertexBuffers[Me.b.PositionKind]=new Me.b(A._fullEngine,N,Me.b.PositionKind,!1,!1,2),A._createIndexBuffer(),A}return Object(_.d)(t,i),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._frameId),this._contentData},t.prototype._createIndexBuffer=function(){var e=this._fullEngine,n=[];n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),this._indexBuffer=e.createIndexBuffer(n)},t.prototype._rebuild=function(){var e=this._vertexBuffers[Me.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===Un.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=Un.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){this._effect!==void 0&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,n=this,r=this._fullEngine;if(this.nodeMaterialSource)return this._effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var o=this._getDefines();return!(!this._effect||o!==this._cachedDefines||!this._effect.isReady())||(e=this._fragment.fragmentElement!==void 0?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=o,this._effect=r.createEffect(e,[Me.b.PositionKind],this._uniforms,this._samplers,o,void 0,void 0,function(){n.releaseInternalTexture(),n._fallbackTexture&&(n._texture=n._fallbackTexture._texture,n._texture&&n._texture.incrementReferences()),n._fallbackTextureUsed=!0}),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,n){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._fullEngine.createRenderTargetTexture(e,n),this._size=e,this._generateMipMaps=n)},t.prototype._checkUniform=function(e){this._uniforms.indexOf(e)===-1&&this._uniforms.push(e)},t.prototype.setTexture=function(e,n){return this._samplers.indexOf(e)===-1&&this._samplers.push(e),this._textures[e]=n,this},t.prototype.setFloat=function(e,n){return this._checkUniform(e),this._floats[e]=n,this},t.prototype.setInt=function(e,n){return this._checkUniform(e),this._ints[e]=n,this},t.prototype.setFloats=function(e,n){return this._checkUniform(e),this._floatsArrays[e]=n,this},t.prototype.setColor3=function(e,n){return this._checkUniform(e),this._colors3[e]=n,this},t.prototype.setColor4=function(e,n){return this._checkUniform(e),this._colors4[e]=n,this},t.prototype.setVector2=function(e,n){return this._checkUniform(e),this._vectors2[e]=n,this},t.prototype.setVector3=function(e,n){return this._checkUniform(e),this._vectors3[e]=n,this},t.prototype.setMatrix=function(e,n){return this._checkUniform(e),this._matrices[e]=n,this},t.prototype.render=function(e){var n=this.getScene();if(n){var r=this._fullEngine;if(r.enableEffect(this._effect),this.onBeforeGenerationObservable.notifyObservers(this),r.setState(!1),!this.nodeMaterialSource){for(var o in this._textures)this._effect.setTexture(o,this._textures[o]);for(o in this._ints)this._effect.setInt(o,this._ints[o]);for(o in this._floats)this._effect.setFloat(o,this._floats[o]);for(o in this._floatsArrays)this._effect.setArray(o,this._floatsArrays[o]);for(o in this._colors3)this._effect.setColor3(o,this._colors3[o]);for(o in this._colors4){var l=this._colors4[o];this._effect.setFloat4(o,l.r,l.g,l.b,l.a)}for(o in this._vectors2)this._effect.setVector2(o,this._vectors2[o]);for(o in this._vectors3)this._effect.setVector3(o,this._vectors3[o]);for(o in this._matrices)this._effect.setMatrix(o,this._matrices[o])}if(this._texture){if(this.isCube)for(var h=0;h<6;h++)r.bindFramebuffer(this._texture,h,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",h),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(nn.a.TriangleFillMode,0,6),h===5&&r.generateMipMapsForCubemap(this._texture);else r.bindFramebuffer(this._texture,0,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&r.clear(n.clearColor,!0,!1,!1),r.drawElementsType(nn.a.TriangleFillMode,0,6);r.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n},t.prototype.dispose=function(){var e=this.getScene();if(e){var n=e.proceduralTextures.indexOf(this);n>=0&&e.proceduralTextures.splice(n,1);var r=this._vertexBuffers[Me.b.PositionKind];r&&(r.dispose(),this._vertexBuffers[Me.b.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),i.prototype.dispose.call(this)}},Object(_.c)([Object(V.c)()],t.prototype,"isEnabled",void 0),Object(_.c)([Object(V.c)()],t.prototype,"autoClear",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_generateMipMaps",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_size",void 0),Object(_.c)([Object(V.c)()],t.prototype,"refreshRate",null),t}(Ve.a);M.a.RegisteredTypes["BABYLON.ProceduralTexture"]=sl;var rw=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,r,null,o,l,h)||this;return v._animate=!0,v._time=0,v._texturePath=n,v._loadJson(n),v.refreshRate=1,v}return Object(_.d)(t,i),t.prototype._loadJson=function(e){var n=this,r=function(){try{n.setFragment(n._texturePath)}catch(h){p.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},o=e+"/config.json",l=new re.a;l.open("GET",o),l.addEventListener("load",function(){if(l.status===200||l.responseText&&l.responseText.length>0)try{n._config=JSON.parse(l.response),n.updateShaderUniforms(),n.updateTextures(),n.setFragment(n._texturePath+"/custom"),n._animate=n._config.animate,n.refreshRate=n._config.refreshrate}catch(h){r()}else r()},!1),l.addEventListener("error",function(){r()},!1);try{l.send()}catch(h){p.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!i.prototype.isReady.call(this))return!1;for(var e in this._textures)if(!this._textures[e].isReady())return!1;return!0},t.prototype.render=function(e){var n=this.getScene();this._animate&&n&&(this._time+=.03*n.getAnimationRatio(),this.updateShaderUniforms()),i.prototype.render.call(this,e)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new Ve.a(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var n=this._config.uniforms[e];switch(n.type){case"float":this.setFloat(n.name,n.value);break;case"color3":this.setColor3(n.name,new x.a(n.r,n.g,n.b));break;case"color4":this.setColor4(n.name,new x.b(n.r,n.g,n.b,n.a));break;case"vector2":this.setVector2(n.name,new d.d(n.x,n.y));break;case"vector3":this.setVector3(n.name,new d.e(n.x,n.y,n.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!1,configurable:!0}),t}(sl),iw=`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y);
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`;We.a.ShadersStore.noisePixelShader=iw;var M0=function(i){function t(e,n,r,o,l){n===void 0&&(n=256),r===void 0&&(r=$.a.LastCreatedScene);var h=i.call(this,e,n,"noise",r,o,l)||this;return h.time=0,h.brightness=.2,h.octaves=3,h.persistence=.8,h.animationSpeedFactor=1,h.autoClear=!1,h._updateShaderUniforms(),h}return Object(_.d)(t,i),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this.time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this.time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(e){this._updateShaderUniforms(),i.prototype.render.call(this,e)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e.time=this.time,e},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this.getScene(),this._fallbackTexture?this._fallbackTexture:void 0,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n.brightness=this.brightness,n.octaves=this.octaves,n.persistence=this.persistence,n.animationSpeedFactor=this.animationSpeedFactor,n.time=this.time,n},t.Parse=function(e,n){var r,o=new t(e.name,e.size,n,void 0,e.generateMipMaps);return o.brightness=e.brightness,o.octaves=e.octaves,o.persistence=e.persistence,o.animationSpeedFactor=e.animationSpeedFactor,o.time=(r=e.time)!==null&&r!==void 0?r:0,o},t}(sl);M.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=M0;var Re,ue,Qn,Pt,yr,mi,or,ow=function(i){function t(e,n,r,o,l,h,v,b,A){o===void 0&&(o=g.a.TEXTUREFORMAT_RGBA),l===void 0&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=!1),v===void 0&&(v=!1),b===void 0&&(b=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),A===void 0&&(A=null);var D=i.call(this,"",e)||this;return D._texture=e.getEngine().createRawCubeTexture(n,r,o,l,h,v,b,A),D}return Object(_.d)(t,i),t.prototype.update=function(e,n,r,o,l){l===void 0&&(l=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,n,r,o,l)},t.prototype.updateRGBDAsync=function(e,n,r,o){return n===void 0&&(n=null),r===void 0&&(r=.8),o===void 0&&(o=0),t._UpdateRGBDAsync(this._texture,e,n,r,o)},t.prototype.clone=function(){var e=this;return V.a.Clone(function(){var n=e.getScene(),r=e._texture,o=new t(n,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return r.source===Mt.b.CubeRawRGBD&&o.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),o},this)},t._UpdateRGBDAsync=function(e,n,r,o,l){return e._source=Mt.b.CubeRawRGBD,e._bufferViewArrayArray=n,e._lodGenerationScale=o,e._lodGenerationOffset=l,e._sphericalPolynomial=r,eo.UploadLevelsAsync(e,n).then(function(){e.isReady=!0})},t}(di),aw=function(i){function t(e,n,r,o,l,h,v,b,A,D){v===void 0&&(v=!0),b===void 0&&(b=!1),A===void 0&&(A=Ve.a.TRILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var N=i.call(this,null,h,!v,b)||this;return N.format=l,N._texture=h.getEngine().createRawTexture2DArray(e,n,r,o,l,v,b,A,null,D),N.is2DArray=!0,N}return Object(_.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Ve.a),sw=function(i){function t(e,n,r,o,l,h,v,b,A,D){v===void 0&&(v=!0),b===void 0&&(b=!1),A===void 0&&(A=Ve.a.TRILINEAR_SAMPLINGMODE),D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT);var N=i.call(this,null,h,!v,b)||this;return N.format=l,N._texture=h.getEngine().createRawTexture3D(e,n,r,o,l,v,b,A,null,D),N.is3D=!0,N}return Object(_.d)(t,i),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Ve.a),cw=function(i){function t(e,n,r,o){var l=i.call(this,e,n,r,o,!0)||this;return l.refractionPlane=new us.a(0,1,0,1),l.depth=2,l.onBeforeRenderObservable.add(function(){r.clipPlane=l.refractionPlane}),l.onAfterRenderObservable.add(function(){r.clipPlane=null}),l}return Object(_.d)(t,i),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},t.prototype.serialize=function(){if(!this.name)return null;var e=i.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},t}(Un);(function(i){i[i.Vertex=1]="Vertex",i[i.Fragment=2]="Fragment",i[i.Neutral=4]="Neutral",i[i.VertexAndFragment=3]="VertexAndFragment"})(Re||(Re={})),function(i){i[i.Float=1]="Float",i[i.Int=2]="Int",i[i.Vector2=4]="Vector2",i[i.Vector3=8]="Vector3",i[i.Vector4=16]="Vector4",i[i.Color3=32]="Color3",i[i.Color4=64]="Color4",i[i.Matrix=128]="Matrix",i[i.Object=256]="Object",i[i.AutoDetect=1024]="AutoDetect",i[i.BasedOnInput=2048]="BasedOnInput"}(ue||(ue={})),function(i){i[i.Uniform=0]="Uniform",i[i.Attribute=1]="Attribute",i[i.Varying=2]="Varying",i[i.Undefined=3]="Undefined"}(Qn||(Qn={})),function(i){i[i.World=1]="World",i[i.View=2]="View",i[i.Projection=3]="Projection",i[i.ViewProjection=4]="ViewProjection",i[i.WorldView=5]="WorldView",i[i.WorldViewProjection=6]="WorldViewProjection",i[i.CameraPosition=7]="CameraPosition",i[i.FogColor=8]="FogColor",i[i.DeltaTime=9]="DeltaTime"}(Pt||(Pt={})),function(i){i[i.Material=0]="Material",i[i.PostProcess=1]="PostProcess",i[i.Particle=2]="Particle",i[i.ProceduralTexture=3]="ProceduralTexture"}(yr||(yr={})),function(i){i[i.Compatible=0]="Compatible",i[i.TypeIncompatible=1]="TypeIncompatible",i[i.TargetIncompatible=2]="TargetIncompatible"}(mi||(mi={})),function(i){i[i.Input=0]="Input",i[i.Output=1]="Output"}(or||(or={}));var yh=function(){function i(t,e,n){this._connectedPoint=null,this._endpoints=new Array,this._typeConnectionSource=null,this._linkedConnectionSource=null,this._acceptedConnectionPointType=null,this._type=ue.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=new Array,this.excludedConnectionPointTypes=new Array,this.onConnectionObservable=new E.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=Re.VertexAndFragment,this._ownerBlock=e,this.name=t,this._direction=n}return i.AreEquivalentTypes=function(t,e){switch(t){case ue.Vector3:if(e===ue.Color3)return!0;break;case ue.Vector4:if(e===ue.Color4)return!0;break;case ue.Color3:if(e===ue.Vector3)return!0;break;case ue.Color4:if(e===ue.Vector4)return!0}return!1},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(t){this._associatedVariableName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){if(this._type===ue.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===ue.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==Re.VertexAndFragment?this._target:this._ownerBlock.target===Re.Fragment?Re.Fragment:Re.Vertex:this._target},set:function(t){this._target=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnected",{get:function(){return this.connectedPoint!==null||this.hasEndpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedToInputBlock",{get:function(){return this.connectedPoint!==null&&this.connectedPoint.ownerBlock.isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedBlocks",{get:function(){return this._endpoints.length===0?[]:this._endpoints.map(function(t){return t.ownerBlock})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===Re.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Re.Vertex||n.target===Re.Vertex||(n.ownerBlock.target===Re.Neutral||n.ownerBlock.target===Re.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInVertexShader}))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===Re.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var t=0,e=this._endpoints;t<e.length;t++){var n=e[t];if(n.ownerBlock.target===Re.Fragment||(n.ownerBlock.target===Re.Neutral||n.ownerBlock.target===Re.VertexAndFragment)&&n.ownerBlock.outputs.some(function(r){return r.isConnectedInFragmentShader}))return!0}return!1},enumerable:!1,configurable:!0}),i.prototype.createCustomInputBlock=function(){return null},i.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},i.prototype.canConnectTo=function(t){return this.checkCompatibilityState(t)===mi.Compatible},i.prototype.checkCompatibilityState=function(t){if(this._ownerBlock.target===Re.Fragment){var e=t.ownerBlock;if(e.target===Re.Vertex)return mi.TargetIncompatible;for(var n=0,r=e.outputs;n<r.length;n++)if(r[n].isConnectedInVertexShader)return mi.TargetIncompatible}return this.type!==t.type&&t.innerType!==ue.AutoDetect?i.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&t.acceptedConnectionPointTypes.indexOf(this.type)!==-1||t._acceptedConnectionPointType&&i.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?mi.Compatible:mi.TypeIncompatible:t.excludedConnectionPointTypes&&t.excludedConnectionPointTypes.indexOf(this.type)!==-1?1:mi.Compatible},i.prototype.connectTo=function(t,e){if(e===void 0&&(e=!1),!e&&!this.canConnectTo(t))throw"Cannot connect these two connectors.";return this._endpoints.push(t),t._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this},i.prototype.disconnectFrom=function(t){var e=this._endpoints.indexOf(t);return e===-1||(this._endpoints.splice(e,1),t._connectedPoint=null,this._enforceAssociatedVariableName=!1,t._enforceAssociatedVariableName=!1),this},i.prototype.serialize=function(t){t===void 0&&(t=!0);var e={};return e.name=this.name,e.displayName=this.displayName,t&&this.connectedPoint&&(e.inputName=this.name,e.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,e.targetConnectionName=this.connectedPoint.name,e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(e.isExposedOnFrame=!0,e.exposedPortPosition=this.exposedPortPosition),e},i.prototype.dispose=function(){this.onConnectionObservable.clear()},i}(),lw=c(152),vt=function(){function i(t,e,n,r){e===void 0&&(e=Re.Vertex),n===void 0&&(n=!1),r===void 0&&(r=!1),this._isFinalMerger=!1,this._isInput=!1,this._name="",this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this._target=e,this._isFinalMerger=n,this._isInput=r,this._name=t,this.uniqueId=lw.a.UniqueId}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this.validateBlockName(t)&&(this._name=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isInput",{get:function(){return this._isInput},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"buildId",{get:function(){return this._buildId},set:function(t){this._buildId=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(t){(this._target&t)==0&&(this._target=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"inputs",{get:function(){return this._inputs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"outputs",{get:function(){return this._outputs},enumerable:!1,configurable:!0}),i.prototype.getInputByName=function(t){var e=this._inputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.getOutputByName=function(t){var e=this._outputs.filter(function(n){return n.name===t});return e.length?e[0]:null},i.prototype.initialize=function(t){},i.prototype.bind=function(t,e,n,r){},i.prototype._declareOutput=function(t,e){return e._getGLType(t.type)+" "+t.associatedVariableName},i.prototype._writeVariable=function(t){return t.connectedPoint?""+t.associatedVariableName:"0."},i.prototype._writeFloat=function(t){var e=t.toString();return e.indexOf(".")===-1&&(e+=".0"),""+e},i.prototype.getClassName=function(){return"NodeMaterialBlock"},i.prototype.registerInput=function(t,e,n,r,o){return n===void 0&&(n=!1),(o=o??new yh(t,this,or.Input)).type=e,o.isOptional=n,r&&(o.target=r),this._inputs.push(o),this},i.prototype.registerOutput=function(t,e,n,r){return(r=r??new yh(t,this,or.Output)).type=e,n&&(r.target=n),this._outputs.push(r),this},i.prototype.getFirstAvailableInput=function(t){t===void 0&&(t=null);for(var e=0,n=this._inputs;e<n.length;e++){var r=n[e];if(!(r.connectedPoint||t&&t.type!==r.type&&r.type!==ue.AutoDetect))return r}return null},i.prototype.getFirstAvailableOutput=function(t){t===void 0&&(t=null);for(var e=0,n=this._outputs;e<n.length;e++){var r=n[e];if(!t||!t.target||t.target===Re.Neutral||(t.target&r.target)!=0)return r}return null},i.prototype.getSiblingOutput=function(t){var e=this._outputs.indexOf(t);return e===-1||e>=this._outputs.length?null:this._outputs[e+1]},i.prototype.connectTo=function(t,e){if(this._outputs.length!==0){for(var n=e&&e.output?this.getOutputByName(e.output):this.getFirstAvailableOutput(t),r=!0;r;){var o=e&&e.input?t.getInputByName(e.input):t.getFirstAvailableInput(n);if(n&&o&&n.canConnectTo(o))n.connectTo(o),r=!1;else{if(!n)throw"Unable to find a compatible match";n=this.getSiblingOutput(n)}}return this}},i.prototype._buildBlock=function(t){},i.prototype.updateUniformsAndSamples=function(t,e,n,r){},i.prototype.provideFallbacks=function(t,e){},i.prototype.initializeDefines=function(t,e,n,r){},i.prototype.prepareDefines=function(t,e,n,r,o){},i.prototype.autoConfigure=function(t){},i.prototype.replaceRepeatableContent=function(t,e,n,r){},i.prototype.isReady=function(t,e,n,r){return!0},i.prototype._linkConnectionTypes=function(t,e,n){n===void 0&&(n=!1),n?this._inputs[e]._acceptedConnectionPointType=this._inputs[t]:this._inputs[t]._linkedConnectionSource=this._inputs[e],this._inputs[e]._linkedConnectionSource=this._inputs[t]},i.prototype._processBuild=function(t,e,n,r){t.build(e,r);var o=e._vertexState!=null,l=t._buildTarget===Re.Vertex&&t.target!==Re.VertexAndFragment;if(o&&((t.target&t._buildTarget)==0||(t.target&n.target)==0||this.target!==Re.VertexAndFragment&&l)&&(!t.isInput&&e.target!==t._buildTarget||t.isInput&&t.isAttribute&&!t._noContextSwitch)){var h=n.connectedPoint;e._vertexState._emitVaryingFromString("v_"+h.associatedVariableName,e._getGLType(h.type))&&(e._vertexState.compilationString+="v_"+h.associatedVariableName+" = "+h.associatedVariableName+`;\r
`),n.associatedVariableName="v_"+h.associatedVariableName,n._enforceAssociatedVariableName=!0}},i.prototype.validateBlockName=function(t){for(var e=0,n=["position","normal","tangent","particle_positionw","uv","uv2","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];e<n.length;e++)if(t===n[e])return!1;return!0},i.prototype.build=function(t,e){if(this._buildId===t.sharedData.buildId)return!0;if(!this.isInput)for(var n=0,r=this._outputs;n<r.length;n++)(A=r[n]).associatedVariableName||(A.associatedVariableName=t._getFreeVariableName(A.name));for(var o=0,l=this._inputs;o<l.length;o++){var h=l[o];if(h.connectedPoint){if(this.target!==Re.Neutral&&((h.target&this.target)==0||(h.target&t.target)==0))continue;(j=h.connectedPoint.ownerBlock)&&j!==this&&this._processBuild(j,t,h,e)}else h.isOptional||t.sharedData.checks.notConnectedNonOptionalInputs.push(h)}if(this._buildId===t.sharedData.buildId)return!0;if(t.sharedData.verbose&&console.log((t.target===Re.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]"),this.isFinalMerger)switch(t.target){case Re.Vertex:t.sharedData.checks.emitVertex=!0;break;case Re.Fragment:t.sharedData.checks.emitFragment=!0}!this.isInput&&t.sharedData.emitComments&&(t.compilationString+=`\r
//`+this.name+`\r
`),this._buildBlock(t),this._buildId=t.sharedData.buildId,this._buildTarget=t.target;for(var v=0,b=this._outputs;v<b.length;v++){var A;if(((A=b[v]).target&t.target)!=0)for(var D=0,N=A.endpoints;D<N.length;D++){var j,k=N[D];(j=k.ownerBlock)&&(j.target&t.target)!=0&&e.indexOf(j)!==-1&&this._processBuild(j,t,k,e)}}return!1},i.prototype._inputRename=function(t){return t},i.prototype._outputRename=function(t){return t},i.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".visibleInInspector = "+this.visibleInInspector+`;\r
`},i.prototype._dumpCode=function(t,e){var n;e.push(this);var r=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=r||this.getClassName()+"_"+this.uniqueId,t.indexOf(this._codeVariableName)!==-1){var o=0;do o++,this._codeVariableName=r+o;while(t.indexOf(this._codeVariableName)!==-1)}t.push(this._codeVariableName),n=`\r
// `+this.getClassName()+`\r
`,this.comments&&(n+="// "+this.comments+`\r
`),n+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+`");\r
`,n+=this._dumpPropertiesCode();for(var l=0,h=this.inputs;l<h.length;l++){var v=h[l];if(v.isConnected){var b=v.connectedPoint.ownerBlock;e.indexOf(b)===-1&&(n+=b._dumpCode(t,e))}}for(var A=0,D=this.outputs;A<D.length;A++){var N=D[A];if(N.hasEndpoints)for(var j=0,k=N.endpoints;j<k.length;j++)(b=k[j].ownerBlock)&&e.indexOf(b)===-1&&(n+=b._dumpCode(t,e))}return n},i.prototype._dumpCodeForOutputConnections=function(t){var e="";if(t.indexOf(this)!==-1)return e;t.push(this);for(var n=0,r=this.inputs;n<r.length;n++){var o=r[n];if(o.isConnected){var l=o.connectedPoint,h=l.ownerBlock;e+=h._dumpCodeForOutputConnections(t),e+=h._codeVariableName+"."+h._outputRename(l.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(o.name)+`);\r
`}}return e},i.prototype.clone=function(t,e){e===void 0&&(e="");var n=this.serialize(),r=M.a.GetClass(n.customType);if(r){var o=new r;return o._deserialize(n,t,e),o}return null},i.prototype.serialize=function(){var t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.comments=this.comments,t.visibleInInspector=this.visibleInInspector,t.inputs=[],t.outputs=[];for(var e=0,n=this.inputs;e<n.length;e++){var r=n[e];t.inputs.push(r.serialize())}for(var o=0,l=this.outputs;o<l.length;o++){var h=l[o];t.outputs.push(h.serialize(!1))}return t},i.prototype._deserialize=function(t,e,n){this.name=t.name,this.comments=t.comments,this.visibleInInspector=!!t.visibleInInspector,this._deserializePortDisplayNamesAndExposedOnFrame(t)},i.prototype._deserializePortDisplayNamesAndExposedOnFrame=function(t){var e=this,n=t.inputs,r=t.outputs;n&&n.forEach(function(o,l){o.displayName&&(e.inputs[l].displayName=o.displayName),o.isExposedOnFrame&&(e.inputs[l].isExposedOnFrame=o.isExposedOnFrame,e.inputs[l].exposedPortPosition=o.exposedPortPosition)}),r&&r.forEach(function(o,l){o.displayName&&(e.outputs[l].displayName=o.displayName),o.isExposedOnFrame&&(e.outputs[l].isExposedOnFrame=o.isExposedOnFrame,e.outputs[l].exposedPortPosition=o.exposedPortPosition)})},i.prototype.dispose=function(){for(var t=0,e=this.inputs;t<e.length;t++)e[t].dispose();for(var n=0,r=this.outputs;n<r.length;n++)r[n].dispose()},i}(),I0=function(){function i(){this.supportUniformBuffers=!1,this.attributes=new Array,this.uniforms=new Array,this.constants=new Array,this.samplers=new Array,this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return i.prototype.finalize=function(t){var e=t.sharedData.emitComments,n=this.target===Re.Fragment;this.compilationString=`\r
`+(e?`//Entry point\r
`:"")+`void main(void) {\r
`+this.compilationString,this._constantDeclaration&&(this.compilationString=`\r
`+(e?`//Constants\r
`:"")+this._constantDeclaration+`\r
`+this.compilationString);var r="";for(var o in this.functions)r+=this.functions[o]+`\r
`;for(var l in this.compilationString=`\r
`+r+`\r
`+this.compilationString,!n&&this._varyingTransfer&&(this.compilationString=this.compilationString+`\r
`+this._varyingTransfer),this._injectAtEnd&&(this.compilationString=this.compilationString+`\r
`+this._injectAtEnd),this.compilationString=this.compilationString+`\r
}`,this.sharedData.varyingDeclaration&&(this.compilationString=`\r
`+(e?`//Varyings\r
`:"")+this.sharedData.varyingDeclaration+`\r
`+this.compilationString),this._samplerDeclaration&&(this.compilationString=`\r
`+(e?`//Samplers\r
`:"")+this._samplerDeclaration+`\r
`+this.compilationString),this._uniformDeclaration&&(this.compilationString=`\r
`+(e?`//Uniforms\r
`:"")+this._uniformDeclaration+`\r
`+this.compilationString),this._attributeDeclaration&&!n&&(this.compilationString=`\r
`+(e?`//Attributes\r
`:"")+this._attributeDeclaration+`\r
`+this.compilationString),this.compilationString=`precision highp float;\r
`+this.compilationString,this.extensions){var h=this.extensions[l];this.compilationString=`\r
`+h+`\r
`+this.compilationString}this._builtCompilationString=this.compilationString},Object.defineProperty(i.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex+++"___###"},enumerable:!1,configurable:!0}),i.prototype._getFreeVariableName=function(t){return t=t.replace(/[^a-zA-Z_]+/g,""),this.sharedData.variableNames[t]===void 0?(this.sharedData.variableNames[t]=0,t==="output"||t==="texture"?t+this.sharedData.variableNames[t]:t):(this.sharedData.variableNames[t]++,t+this.sharedData.variableNames[t])},i.prototype._getFreeDefineName=function(t){return this.sharedData.defineNames[t]===void 0?this.sharedData.defineNames[t]=0:this.sharedData.defineNames[t]++,t+this.sharedData.defineNames[t]},i.prototype._excludeVariableName=function(t){this.sharedData.variableNames[t]=0},i.prototype._emit2DSampler=function(t){this.samplers.indexOf(t)<0&&(this._samplerDeclaration+="uniform sampler2D "+t+`;\r
`,this.samplers.push(t))},i.prototype._getGLType=function(t){switch(t){case ue.Float:return"float";case ue.Int:return"int";case ue.Vector2:return"vec2";case ue.Color3:case ue.Vector3:return"vec3";case ue.Color4:case ue.Vector4:return"vec4";case ue.Matrix:return"mat4"}return""},i.prototype._emitExtension=function(t,e,n){n===void 0&&(n=""),this.extensions[t]||(n&&(e="#if "+n+`\r
`+e+`\r
#endif`),this.extensions[t]=e)},i.prototype._emitFunction=function(t,e,n){this.functions[t]||(this.sharedData.emitComments&&(e=n+`\r
`+e),this.functions[t]=e)},i.prototype._emitCodeFromInclude=function(t,e,n){if(n&&n.repeatKey)return"#include<"+t+">[0.."+n.repeatKey+`]\r
`;var r=We.a.IncludesShadersStore[t]+`\r
`;if(this.sharedData.emitComments&&(r=e+`\r
`+r),!n)return r;if(n.replaceStrings)for(var o=0;o<n.replaceStrings.length;o++){var l=n.replaceStrings[o];r=r.replace(l.search,l.replace)}return r},i.prototype._emitFunctionFromInclude=function(t,e,n,r){r===void 0&&(r="");var o=t+r;if(!this.functions[o]){if(!(n&&(n.removeAttributes||n.removeUniforms||n.removeVaryings||n.removeIfDef||n.replaceStrings)))return n&&n.repeatKey?this.functions[o]="#include<"+t+">[0.."+n.repeatKey+`]\r
`:this.functions[o]="#include<"+t+`>\r
`,void(this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]));if(this.functions[o]=We.a.IncludesShadersStore[t],this.sharedData.emitComments&&(this.functions[o]=e+`\r
`+this.functions[o]),n.removeIfDef&&(this.functions[o]=this.functions[o].replace(/^\s*?#ifdef.+$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#endif.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#else.*$/gm,""),this.functions[o]=this.functions[o].replace(/^\s*?#elif.*$/gm,"")),n.removeAttributes&&(this.functions[o]=this.functions[o].replace(/^\s*?attribute.+$/gm,"")),n.removeUniforms&&(this.functions[o]=this.functions[o].replace(/^\s*?uniform.+$/gm,"")),n.removeVaryings&&(this.functions[o]=this.functions[o].replace(/^\s*?varying.+$/gm,"")),n.replaceStrings)for(var l=0;l<n.replaceStrings.length;l++){var h=n.replaceStrings[l];this.functions[o]=this.functions[o].replace(h.search,h.replace)}}},i.prototype._registerTempVariable=function(t){return this.sharedData.temps.indexOf(t)===-1&&(this.sharedData.temps.push(t),!0)},i.prototype._emitVaryingFromString=function(t,e,n,r){return n===void 0&&(n=""),r===void 0&&(r=!1),this.sharedData.varyings.indexOf(t)===-1&&(this.sharedData.varyings.push(t),n&&(Jr.a.StartsWith(n,"defined(")?this.sharedData.varyingDeclaration+="#if "+n+`\r
`:this.sharedData.varyingDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this.sharedData.varyingDeclaration+="varying "+e+" "+t+`;\r
`,n&&(this.sharedData.varyingDeclaration+=`#endif\r
`),!0)},i.prototype._emitUniformFromString=function(t,e,n,r){n===void 0&&(n=""),r===void 0&&(r=!1),this.uniforms.indexOf(t)===-1&&(this.uniforms.push(t),n&&(Jr.a.StartsWith(n,"defined(")?this._uniformDeclaration+="#if "+n+`\r
`:this._uniformDeclaration+=(r?"#ifndef":"#ifdef")+" "+n+`\r
`),this._uniformDeclaration+="uniform "+e+" "+t+`;\r
`,n&&(this._uniformDeclaration+=`#endif\r
`))},i.prototype._emitFloat=function(t){return t.toString()===t.toFixed(0)?t+".0":t.toString()},i}(),uw=function(){function i(){this.temps=new Array,this.varyings=new Array,this.varyingDeclaration="",this.inputBlocks=new Array,this.textureBlocks=new Array,this.bindableBlocks=new Array,this.blocksWithFallbacks=new Array,this.blocksWithDefines=new Array,this.repeatableContentBlocks=new Array,this.dynamicUniformBlocks=new Array,this.blockingBlocks=new Array,this.animatedInputs=new Array,this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return i.prototype.emitErrors=function(){var t="";this.checks.emitVertex||this.allowEmptyVertexProgram||(t+=`NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r
`),this.checks.emitFragment||(t+=`NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r
`);for(var e=0,n=this.checks.notConnectedNonOptionalInputs;e<n.length;e++){var r=n[e];t+="input "+r.name+" from block "+r.ownerBlock.name+"["+r.ownerBlock.getClassName()+`] is not connected and is not optional.\r
`}if(t)throw`Build of NodeMaterial failed:\r
`+t},i}(),Th=function(i){function t(e){var n=i.call(this,e,Re.Vertex)||this;return n.complementW=1,n.complementZ=0,n.registerInput("vector",ue.AutoDetect),n.registerInput("transform",ue.Matrix),n.registerOutput("output",ue.Vector4),n.registerOutput("xyz",ue.Vector3),n._inputs[0].onConnectionObservable.add(function(r){if(r.ownerBlock.isInput){var o=r.ownerBlock;o.name!=="normal"&&o.name!=="tangent"||(n.complementW=0)}}),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector,r=this.transform;if(n.connectedPoint){if(this.complementW===0){var o="//"+this.name;e._emitFunctionFromInclude("helperFunctions",o),e.sharedData.blocksWithDefines.push(this);var l=e._getFreeVariableName(r.associatedVariableName+"_NUS");switch(e.compilationString+="mat3 "+l+" = mat3("+r.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef NONUNIFORMSCALING\r
`,e.compilationString+=l+" = transposeMat3(inverseMat3("+l+`));\r
`,e.compilationString+=`#endif\r
`,n.connectedPoint.type){case ue.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * vec3("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+"), "+this._writeFloat(this.complementW)+`);\r
`;break;case ue.Vector3:case ue.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * "+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = vec4("+l+" * "+n.associatedVariableName+".xyz, "+this._writeFloat(this.complementW)+`);\r
`}}else switch(l=r.associatedVariableName,n.connectedPoint.type){case ue.Vector2:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementZ)+", "+this._writeFloat(this.complementW)+`);\r
`;break;case ue.Vector3:case ue.Color3:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * vec4("+n.associatedVariableName+", "+this._writeFloat(this.complementW)+`);\r
`;break;default:e.compilationString+=this._declareOutput(this.output,e)+" = "+l+" * "+n.associatedVariableName+`;\r
`}this.xyz.hasEndpoints&&(e.compilationString+=this._declareOutput(this.xyz,e)+" = "+this.output.associatedVariableName+`.xyz;\r
`)}return this},t.prototype.prepareDefines=function(e,n,r,o,l){e.nonUniformScaling&&r.setValue("NONUNIFORMSCALING",!0)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.complementZ=this.complementZ,e.complementW=this.complementW,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.complementZ=e.complementZ!==void 0?e.complementZ:0,this.complementW=e.complementW!==void 0?e.complementW:1},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".complementZ = "+this.complementZ+`;\r
`;return e+=this._codeVariableName+".complementW = "+this.complementW+`;\r
`},t}(vt);M.a.RegisteredTypes["BABYLON.TransformBlock"]=Th;var cl=function(i){function t(e){var n=i.call(this,e,Re.Vertex,!0)||this;return n.registerInput("vector",ue.Vector4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.vector;return e.compilationString+="gl_Position = "+n.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=cl;var ko,Ps=function(i){function t(e){var n=i.call(this,e,Re.Fragment,!0)||this;return n.registerInput("rgba",ue.Color4,!0),n.registerInput("rgb",ue.Color3,!0),n.registerInput("a",ue.Float,!0),n.rgb.acceptedConnectionPointTypes.push(ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FragmentOutputBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba,r=this.rgb,o=this.a;if(e.sharedData.hints.needAlphaBlending=n.isConnected||o.isConnected,n.connectedPoint)o.isConnected?e.compilationString+="gl_FragColor = vec4("+n.associatedVariableName+".rgb, "+o.associatedVariableName+`);\r
`:e.compilationString+="gl_FragColor = "+n.associatedVariableName+`;\r
`;else if(r.connectedPoint){var l="1.0";o.connectedPoint&&(l=o.associatedVariableName),r.connectedPoint.type===ue.Float?e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+r.associatedVariableName+", "+r.associatedVariableName+", "+l+`);\r
`:e.compilationString+="gl_FragColor = vec4("+r.associatedVariableName+", "+l+`);\r
`}else e.sharedData.checks.notConnectedNonOptionalInputs.push(n);return this},t}(vt);M.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=Ps,function(i){i[i.None=0]="None",i[i.Time=1]="Time"}(ko||(ko={}));var hw={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},om={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},D0={particle_texturemask:!0},It=function(i){function t(e,n,r){n===void 0&&(n=Re.Vertex),r===void 0&&(r=ue.AutoDetect);var o=i.call(this,e,n,!1,!0)||this;return o._mode=Qn.Undefined,o._animationType=ko.None,o.min=0,o.max=0,o.isBoolean=!1,o.matrixMode=0,o._systemValue=null,o.isConstant=!1,o.groupInInspector="",o.onValueChangedObservable=new E.c,o.convertToGammaSpace=!1,o.convertToLinearSpace=!1,o._type=r,o.setDefaultValue(),o.registerOutput("output",r),o}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"type",{get:function(){if(this._type===ue.AutoDetect){if(this.isUniform&&this.value!=null){if(!isNaN(this.value))return this._type=ue.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=ue.Vector2,this._type;case"Vector3":return this._type=ue.Vector3,this._type;case"Vector4":return this._type=ue.Vector4,this._type;case"Color3":return this._type=ue.Color3,this._type;case"Color4":return this._type=ue.Color4,this._type;case"Matrix":return this._type=ue.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"tangent":case"particle_positionw":return this._type=ue.Vector3,this._type;case"uv":case"uv2":case"position2d":case"particle_uv":return this._type=ue.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":return this._type=ue.Vector4,this._type;case"color":case"particle_color":case"particle_texturemask":return this._type=ue.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case Pt.World:case Pt.WorldView:case Pt.WorldViewProjection:case Pt.View:case Pt.ViewProjection:case Pt.Projection:return this._type=ue.Matrix,this._type;case Pt.CameraPosition:return this._type=ue.Vector3,this._type;case Pt.FogColor:return this._type=ue.Color3,this._type;case Pt.DeltaTime:return this._type=ue.Float,this._type}}return this._type},enumerable:!1,configurable:!0}),t.prototype.validateBlockName=function(e){return!!this.isAttribute||i.prototype.validateBlockName.call(this,e)},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.setAsAttribute=function(e){return this._mode=Qn.Attribute,e&&(this.name=e),this},t.prototype.setAsSystemValue=function(e){return this.systemValue=e,this},Object.defineProperty(t.prototype,"value",{get:function(){return this._storedValue},set:function(e){this.type===ue.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=Qn.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(e){this._valueCallback=e,this._mode=Qn.Uniform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(e){this._associatedVariableName=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationType",{get:function(){return this._animationType},set:function(e){this._animationType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUndefined",{get:function(){return this._mode===Qn.Undefined},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUniform",{get:function(){return this._mode===Qn.Uniform},set:function(e){this._mode=e?Qn.Uniform:Qn.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAttribute",{get:function(){return this._mode===Qn.Attribute},set:function(e){this._mode=e?Qn.Attribute:Qn.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVarying",{get:function(){return this._mode===Qn.Varying},set:function(e){this._mode=e?Qn.Varying:Qn.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSystemValue",{get:function(){return this._systemValue!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"systemValue",{get:function(){return this._systemValue},set:function(e){this._mode=Qn.Uniform,this.associatedVariableName="",this._systemValue=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"InputBlock"},t.prototype.animate=function(e){switch(this._animationType){case ko.Time:this.type===ue.Float&&(this.value+=.01*e.getAnimationRatio())}},t.prototype._emitDefine=function(e){return e[0]==="!"?"#ifndef "+e.substring(1)+`\r
`:"#ifdef "+e+`\r
`},t.prototype.initialize=function(e){this.associatedVariableName=""},t.prototype.setDefaultValue=function(){switch(this.type){case ue.Float:this.value=0;break;case ue.Vector2:this.value=d.d.Zero();break;case ue.Vector3:this.value=d.e.Zero();break;case ue.Vector4:this.value=d.f.Zero();break;case ue.Color3:this.value=x.a.White();break;case ue.Color4:this.value=new x.b(1,1,1,1);break;case ue.Matrix:this.value=d.a.Identity()}},t.prototype._emitConstant=function(e){switch(this.type){case ue.Float:return""+e._emitFloat(this.value);case ue.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case ue.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case ue.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case ue.Color3:return x.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&x.c.Color3[0].toGammaSpaceToRef(x.c.Color3[0]),this.convertToLinearSpace&&x.c.Color3[0].toLinearSpaceToRef(x.c.Color3[0]),"vec3("+x.c.Color3[0].r+", "+x.c.Color3[0].g+", "+x.c.Color3[0].b+")";case ue.Color4:return x.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&x.c.Color4[0].toGammaSpaceToRef(x.c.Color4[0]),this.convertToLinearSpace&&x.c.Color4[0].toLinearSpaceToRef(x.c.Color4[0]),"vec4("+x.c.Color4[0].r+", "+x.c.Color4[0].g+", "+x.c.Color4[0].b+", "+x.c.Color4[0].a+")"}return""},Object.defineProperty(t.prototype,"_noContextSwitch",{get:function(){return om[this.name]},enumerable:!1,configurable:!0}),t.prototype._emit=function(e,n){var r;if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant)return e.constants.indexOf(this.associatedVariableName)!==-1?void 0:(e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=this._declareOutput(this.output,e)+" = "+this._emitConstant(e)+`;\r
`));if(e.uniforms.indexOf(this.associatedVariableName)!==-1)return;e.uniforms.push(this.associatedVariableName),n&&(e._uniformDeclaration+=this._emitDefine(n)),e._uniformDeclaration+="uniform "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._uniformDeclaration+=`#endif\r
`);var o=e.sharedData.hints;if(this._systemValue!==null&&this._systemValue!==void 0)switch(this._systemValue){case Pt.WorldView:o.needWorldViewMatrix=!0;break;case Pt.WorldViewProjection:o.needWorldViewProjectionMatrix=!0}else this._animationType!==ko.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=(r=hw[this.name])!==null&&r!==void 0?r:this.name,this.target===Re.Vertex&&e._vertexState)return void(om[this.name]?D0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):this._emit(e._vertexState,n));if(e.attributes.indexOf(this.associatedVariableName)!==-1)return;e.attributes.push(this.associatedVariableName),om[this.name]?D0[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),n):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),n):(n&&(e._attributeDeclaration+=this._emitDefine(n)),e._attributeDeclaration+="attribute "+e._getGLType(this.type)+" "+this.associatedVariableName+`;\r
`,n&&(e._attributeDeclaration+=`#endif\r
`))}},t.prototype._transmitWorld=function(e,n,r,o){if(this._systemValue){var l=this.associatedVariableName;switch(this._systemValue){case Pt.World:e.setMatrix(l,n);break;case Pt.WorldView:e.setMatrix(l,r);break;case Pt.WorldViewProjection:e.setMatrix(l,o)}}},t.prototype._transmit=function(e,n){if(!this.isAttribute){var r=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case Pt.World:case Pt.WorldView:case Pt.WorldViewProjection:return;case Pt.View:e.setMatrix(r,n.getViewMatrix());break;case Pt.Projection:e.setMatrix(r,n.getProjectionMatrix());break;case Pt.ViewProjection:e.setMatrix(r,n.getTransformMatrix());break;case Pt.CameraPosition:ot.a.BindEyePosition(e,n,r);break;case Pt.FogColor:e.setColor3(r,n.fogColor);break;case Pt.DeltaTime:e.setFloat(r,n.deltaTime/1e3)}else{var o=this._valueCallback?this._valueCallback():this._storedValue;if(o!==null)switch(this.type){case ue.Float:e.setFloat(r,o);break;case ue.Int:e.setInt(r,o);break;case ue.Color3:x.c.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&x.c.Color3[0].toGammaSpaceToRef(x.c.Color3[0]),this.convertToLinearSpace&&x.c.Color3[0].toLinearSpaceToRef(x.c.Color3[0]),e.setColor3(r,x.c.Color3[0]);break;case ue.Color4:x.c.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&x.c.Color4[0].toGammaSpaceToRef(x.c.Color4[0]),this.convertToLinearSpace&&x.c.Color4[0].toLinearSpaceToRef(x.c.Color4[0]),e.setDirectColor4(r,x.c.Color4[0]);break;case ue.Vector2:e.setVector2(r,o);break;case ue.Vector3:e.setVector3(r,o);break;case ue.Vector4:e.setVector4(r,o);break;case ue.Matrix:e.setMatrix(r,o)}}}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),(this.isUniform||this.isSystemValue)&&e.sharedData.inputBlocks.push(this),this._emit(e)},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName;if(this.isAttribute)return e+'.setAsAttribute("'+this.name+`");\r
`;if(this.isSystemValue)return e+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+Pt[this._systemValue]+`);\r
`;if(this.isUniform){var n=[],r="";switch(this.type){case ue.Float:r=""+this.value;break;case ue.Vector2:r="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case ue.Vector3:r="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case ue.Vector4:r="new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case ue.Color3:r="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case ue.Color4:r="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case ue.Matrix:r="BABYLON.Matrix.FromArray(["+this.value.m+"])"}return n.push(e+".value = "+r),this.type===ue.Float&&n.push(e+".min = "+this.min,e+".max = "+this.max,e+".isBoolean = "+this.isBoolean,e+".matrixMode = "+this.matrixMode,e+".animationType = BABYLON.AnimatedInputBlockTypes."+ko[this.animationType]),n.push(e+".isConstant = "+this.isConstant),n.push(""),n.join(`;\r
`)}return""},t.prototype.dispose=function(){this.onValueChangedObservable.clear(),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.type=this.type,e.mode=this._mode,e.systemValue=this._systemValue,e.animationType=this._animationType,e.min=this.min,e.max=this.max,e.isBoolean=this.isBoolean,e.matrixMode=this.matrixMode,e.isConstant=this.isConstant,e.groupInInspector=this.groupInInspector,e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this._storedValue!=null&&this._mode===Qn.Uniform&&(this._storedValue.asArray?(e.valueType="BABYLON."+this._storedValue.getClassName(),e.value=this._storedValue.asArray()):(e.valueType="number",e.value=this._storedValue)),e},t.prototype._deserialize=function(e,n,r){if(this._mode=e.mode,i.prototype._deserialize.call(this,e,n,r),this._type=e.type,this._systemValue=e.systemValue||e.wellKnownValue,this._animationType=e.animationType,this.min=e.min||0,this.max=e.max||0,this.isBoolean=!!e.isBoolean,this.matrixMode=e.matrixMode||0,this.isConstant=!!e.isConstant,this.groupInInspector=e.groupInInspector||"",this.convertToGammaSpace=!!e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.valueType)if(e.valueType==="number")this._storedValue=e.value;else{var o=M.a.GetClass(e.valueType);o&&(this._storedValue=o.FromArray(e.value))}},t}(vt);M.a.RegisteredTypes["BABYLON.InputBlock"]=It;var am=function(i){function t(e){var n=i.call(this,e,Re.VertexAndFragment)||this;return n._samplerName="textureSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",ue.Vector2,!1,Re.VertexAndFragment),n.registerOutput("rgba",ue.Color4,Re.Neutral),n.registerOutput("rgb",ue.Color3,Re.Neutral),n.registerOutput("r",ue.Float,Re.Neutral),n.registerOutput("g",ue.Float,Re.Neutral),n.registerOutput("b",ue.Float,Re.Neutral),n.registerOutput("a",ue.Float,Re.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[0]._prioritizeVertex=!1,n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"CurrentScreenBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("textureSampler")},Object.defineProperty(t.prototype,"target",{get:function(){return this.uv.isConnected?this.uv.sourceBlock.isInput?Re.VertexAndFragment:Re.Fragment:Re.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._injectVertexCode=function(e){var n=this.uv;if(n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,this._outputs.some(function(h){return h.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Re.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Re.Fragment?e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`:e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Re.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else this.uv.ownerBlock.target!==Re.Fragment?(e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e.sharedData.blockingBlocks.indexOf(this)<0&&e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.indexOf(this)<0&&e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.indexOf(this)<0&&e.sharedData.blocksWithDefines.push(this),e.target!==Re.Fragment)return e._emit2DSampler(this._samplerName),void this._injectVertexCode(e);if(this._outputs.some(function(h){return h.isConnectedInFragmentShader})){e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=Ve.a.Parse(e.texture,n,r))},t}(vt);M.a.RegisteredTypes["BABYLON.CurrentScreenBlock"]=am;var sm=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._samplerName="diffuseSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",ue.Vector2,!1,Re.VertexAndFragment),n.registerOutput("rgba",ue.Color4,Re.Neutral),n.registerOutput("rgb",ue.Color3,Re.Neutral),n.registerOutput("r",ue.Float,Re.Neutral),n.registerOutput("g",ue.Float,Re.Neutral),n.registerOutput("b",ue.Float,Re.Neutral),n.registerOutput("a",ue.Float,Re.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ParticleTextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("diffuseSampler")},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.isAttribute&&r.name==="particle_uv"});n||(n=new It("uv")).setAsAttribute("particle_uv"),n.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r.setValue(this._linearDefineName,this.convertToGammaSpace,!0),r.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._writeOutput=function(e,n,r){e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`,e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Re.Vertex){this._tempTextureRead=e._getFreeVariableName("tempTextureRead"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this.uv.associatedVariableName+`);\r
`;for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=Ve.a.Parse(e.texture,n,r))},t}(vt);M.a.RegisteredTypes["BABYLON.ParticleTextureBlock"]=sm;var cm=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._isUnique=!0,n.registerInput("color",ue.Color4,!1,Re.Fragment),n.registerOutput("rampColor",ue.Color4,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ParticleRampGradientBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rampColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor"),e._excludeVariableName("finalAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Re.Vertex)return e._emit2DSampler("rampSampler"),e._emitVaryingFromString("remapRanges","vec4","RAMPGRADIENT"),e.compilationString+=`
            #ifdef RAMPGRADIENT
                vec4 baseColor = `+this.color.associatedVariableName+`;
                float alpha = `+this.color.associatedVariableName+`.a;

                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);

                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));
                baseColor.rgb *= rampColor.rgb;

                // Remapped alpha
                float finalAlpha = baseColor.a;
                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);

                `+this._declareOutput(this.rampColor,e)+` = baseColor;
            #else
                `+this._declareOutput(this.rampColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(vt);M.a.RegisteredTypes["BABYLON.ParticleRampGradientBlock"]=cm;var lm=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._isUnique=!0,n.registerInput("color",ue.Color4,!1,Re.Fragment),n.registerInput("alphaTexture",ue.Float,!1,Re.Fragment),n.registerInput("alphaColor",ue.Float,!1,Re.Fragment),n.registerOutput("blendColor",ue.Color4,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ParticleBlendMultiplyBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaTexture",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaColor",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("sourceAlpha")},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target!==Re.Vertex)return e.compilationString+=`
            #ifdef BLENDMULTIPLYMODE
                `+this._declareOutput(this.blendColor,e)+`;
                float sourceAlpha = `+this.alphaColor.associatedVariableName+" * "+this.alphaTexture.associatedVariableName+`;
                `+this.blendColor.associatedVariableName+".rgb = "+this.color.associatedVariableName+`.rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);
                `+this.blendColor.associatedVariableName+".a = "+this.color.associatedVariableName+`.a;
            #else
                `+this._declareOutput(this.blendColor,e)+" = "+this.color.associatedVariableName+`;
            #endif
        `,this},t}(vt);M.a.RegisteredTypes["BABYLON.ParticleBlendMultiplyBlock"]=lm;var Wt,ll=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("xyz ",ue.Vector3,!0),n.registerInput("xy ",ue.Vector2,!0),n.registerInput("x",ue.Float,!0),n.registerInput("y",ue.Float,!0),n.registerInput("z",ue.Float,!0),n.registerInput("w",ue.Float,!0),n.registerOutput("xyzw",ue.Vector4),n.registerOutput("xyz",ue.Vector3),n.registerOutput("xy",ue.Vector2),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return this.xyOut},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.x,r=this.y,o=this.z,l=this.w,h=this.xyIn,v=this.xyzIn,b=this._outputs[0],A=this._outputs[1],D=this._outputs[2];return v.isConnected?b.hasEndpoints?e.compilationString+=this._declareOutput(b,e)+" = vec4("+v.associatedVariableName+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:A.hasEndpoints?e.compilationString+=this._declareOutput(A,e)+" = "+v.associatedVariableName+`;\r
`:D.hasEndpoints&&(e.compilationString+=this._declareOutput(D,e)+" = "+v.associatedVariableName+`.xy;\r
`):h.isConnected?b.hasEndpoints?e.compilationString+=this._declareOutput(b,e)+" = vec4("+h.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:A.hasEndpoints?e.compilationString+=this._declareOutput(A,e)+" = vec3("+h.associatedVariableName+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:D.hasEndpoints&&(e.compilationString+=this._declareOutput(D,e)+" = "+h.associatedVariableName+`;\r
`):b.hasEndpoints?e.compilationString+=this._declareOutput(b,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:A.hasEndpoints?e.compilationString+=this._declareOutput(A,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`:D.hasEndpoints&&(e.compilationString+=this._declareOutput(D,e)+" = vec2("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+`);\r
`),this},t}(vt);function $t(i,t,e,n){return t===void 0&&(t=Wt.Boolean),e===void 0&&(e="PROPERTIES"),function(r,o){var l=r._propStore;l||(l=[],r._propStore=l),l.push({propertyName:o,displayName:i,type:t,groupName:e,options:n??{}})}}M.a.RegisteredTypes["BABYLON.VectorMergerBlock"]=ll,function(i){i[i.Boolean=0]="Boolean",i[i.Float=1]="Float",i[i.Vector2=2]="Vector2",i[i.List=3]="List"}(Wt||(Wt={}));var um=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.sourceRange=new d.d(-1,1),n.targetRange=new d.d(0,1),n.registerInput("input",ue.AutoDetect),n.registerInput("sourceMin",ue.Float,!0),n.registerInput("sourceMax",ue.Float,!0),n.registerInput("targetMin",ue.Float,!0),n.registerInput("targetMax",ue.Float,!0),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),o=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),l=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),h=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return e.compilationString+=this._declareOutput(n,e)+" = "+l+" + ("+this._inputs[0].associatedVariableName+" - "+r+") * ("+h+" - "+l+") / ("+o+" - "+r+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".sourceRange = new BABYLON.Vector2("+this.sourceRange.x+", "+this.sourceRange.y+`);\r
`;return e+=this._codeVariableName+".targetRange = new BABYLON.Vector2("+this.targetRange.x+", "+this.targetRange.y+`);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.sourceRange=this.sourceRange.asArray(),e.targetRange=this.targetRange.asArray(),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.sourceRange=d.d.FromArray(e.sourceRange),this.targetRange=d.d.FromArray(e.targetRange)},Object(_.c)([$t("From",Wt.Vector2)],t.prototype,"sourceRange",void 0),Object(_.c)([$t("To",Wt.Vector2)],t.prototype,"targetRange",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.RemapBlock"]=um;var Eh=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" * "+this.right.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.MultiplyBlock"]=Eh;var As=function(){function i(){this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0),this.minEmitBox=new d.e(-.5,-.5,-.5),this.maxEmitBox=new d.e(.5,.5,.5)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=se.a.RandomRange(this.direction1.x,this.direction2.x),l=se.a.RandomRange(this.direction1.y,this.direction2.y),h=se.a.RandomRange(this.direction1.z,this.direction2.z);if(r)return e.x=o,e.y=l,void(e.z=h);d.e.TransformNormalFromFloatsToRef(o,l,h,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=se.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),l=se.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),h=se.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);if(r)return e.x=o,e.y=l,void(e.z=h);d.e.TransformCoordinatesFromFloatsToRef(o,l,h,t,e)},i.prototype.clone=function(){var t=new i;return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)},i.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},i.prototype.getClassName=function(){return"BoxParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t},i.prototype.parse=function(t){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2),d.e.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),d.e.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)},i}(),hm=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=Math.PI),n===void 0&&(n=0),this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=e,this.radius=t}return Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._buildHeight()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._buildHeight()},enumerable:!1,configurable:!0}),i.prototype._buildHeight=function(){this._angle!==0?this._height=this._radius/Math.tan(this._angle/2):this._height=1},i.prototype.startDirectionFunction=function(t,e,n,r){r?d.c.Vector3[0].copyFrom(n._localPosition).normalize():n.position.subtractToRef(t.getTranslation(),d.c.Vector3[0]).normalize();var o=se.a.RandomRange(0,this.directionRandomizer),l=se.a.RandomRange(0,this.directionRandomizer),h=se.a.RandomRange(0,this.directionRandomizer);e.x=d.c.Vector3[0].x+o,e.y=d.c.Vector3[0].y+l,e.z=d.c.Vector3[0].z+h,e.normalize()},i.prototype.startPositionFunction=function(t,e,n,r){var o,l=se.a.RandomRange(0,2*Math.PI);o=this.emitFromSpawnPointOnly?1e-4:1-(o=se.a.RandomRange(0,this.heightRange))*o;var h=this._radius-se.a.RandomRange(0,this._radius*this.radiusRange),v=(h*=o)*Math.sin(l),b=h*Math.cos(l),A=o*this._height;if(r)return e.x=v,e.y=A,void(e.z=b);d.e.TransformCoordinatesFromFloatsToRef(v,A,b,t,e)},i.prototype.clone=function(){var t=new i(this._radius,this._angle,this.directionRandomizer);return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){var t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+=`
#define CONEEMITTERSPAWNPOINT`),t},i.prototype.getClassName=function(){return"ConeParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t},i.prototype.parse=function(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=t.radiusRange!==void 0?t.radiusRange:1,this.heightRange=t.radiusRange!==void 0?t.heightRange:1,this.emitFromSpawnPointOnly=t.emitFromSpawnPointOnly!==void 0&&t.emitFromSpawnPointOnly},i}(),Sh=function(){function i(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0),this.radius=t,this.height=e,this.radiusRange=n,this.directionRandomizer=r}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=se.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),h=Math.atan2(o.x,o.z);h+=se.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,o.y=l,o.x=Math.sin(h),o.z=Math.cos(h),o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=se.a.RandomRange(-this.height/2,this.height/2),l=se.a.RandomRange(0,2*Math.PI),h=se.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),v=Math.sqrt(h)*this.radius,b=v*Math.cos(l),A=v*Math.sin(l);r?e.copyFromFloats(b,o,A):d.e.TransformCoordinatesFromFloatsToRef(b,o,A,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},i.prototype.getClassName=function(){return"CylinderParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),dm=function(i){function t(e,n,r,o,l){e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=new d.e(0,1,0)),l===void 0&&(l=new d.e(0,1,0));var h=i.call(this,e,n,r)||this;return h.direction1=o,h.direction2=l,h}return Object(_.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=se.a.RandomRange(this.direction1.x,this.direction2.x),l=se.a.RandomRange(this.direction1.y,this.direction2.y),h=se.a.RandomRange(this.direction1.z,this.direction2.z);d.e.TransformNormalFromFloatsToRef(o,l,h,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return fe.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(Sh),fm=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=se.a.RandomRange(0,this.directionRandomizer),h=se.a.RandomRange(0,this.directionRandomizer),v=se.a.RandomRange(0,this.directionRandomizer);o.x+=l,o.y+=h,o.z+=v,o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-se.a.RandomRange(0,this.radius*this.radiusRange),l=se.a.RandomRange(0,1),h=se.a.RandomRange(0,2*Math.PI),v=Math.acos(2*l-1),b=o*Math.cos(h)*Math.sin(v),A=o*Math.cos(v),D=o*Math.sin(h)*Math.sin(v);r?e.copyFromFloats(b,Math.abs(A),D):d.e.TransformCoordinatesFromFloatsToRef(b,Math.abs(A),D,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},i.prototype.getClassName=function(){return"HemisphericParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),pm=function(){function i(){this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0)}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=se.a.RandomRange(this.direction1.x,this.direction2.x),l=se.a.RandomRange(this.direction1.y,this.direction2.y),h=se.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,l,h):d.e.TransformNormalFromFloatsToRef(o,l,h,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){r?e.copyFromFloats(0,0,0):d.e.TransformCoordinatesFromFloatsToRef(0,0,0,t,e)},i.prototype.clone=function(){var t=new i;return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},i.prototype.getClassName=function(){return"PointParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},i.prototype.parse=function(t){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2)},i}(),xh=function(){function i(t,e,n){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=0),this.radius=t,this.radiusRange=e,this.directionRandomizer=n}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=n.position.subtract(t.getTranslation()).normalize(),l=se.a.RandomRange(0,this.directionRandomizer),h=se.a.RandomRange(0,this.directionRandomizer),v=se.a.RandomRange(0,this.directionRandomizer);o.x+=l,o.y+=h,o.z+=v,o.normalize(),r?e.copyFrom(o):d.e.TransformNormalFromFloatsToRef(o.x,o.y,o.z,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=this.radius-se.a.RandomRange(0,this.radius*this.radiusRange),l=se.a.RandomRange(0,1),h=se.a.RandomRange(0,2*Math.PI),v=Math.acos(2*l-1),b=o*Math.cos(h)*Math.sin(v),A=o*Math.cos(v),D=o*Math.sin(h)*Math.sin(v);r?e.copyFromFloats(b,A,D):d.e.TransformCoordinatesFromFloatsToRef(b,A,D,t,e)},i.prototype.clone=function(){var t=new i(this.radius,this.directionRandomizer);return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)},i.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},i.prototype.getClassName=function(){return"SphereParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t},i.prototype.parse=function(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer},i}(),mm=function(i){function t(e,n,r){e===void 0&&(e=1),n===void 0&&(n=new d.e(0,1,0)),r===void 0&&(r=new d.e(0,1,0));var o=i.call(this,e)||this;return o.direction1=n,o.direction2=r,o}return Object(_.d)(t,i),t.prototype.startDirectionFunction=function(e,n,r){var o=se.a.RandomRange(this.direction1.x,this.direction2.x),l=se.a.RandomRange(this.direction1.y,this.direction2.y),h=se.a.RandomRange(this.direction1.z,this.direction2.z);d.e.TransformNormalFromFloatsToRef(o,l,h,e,n)},t.prototype.clone=function(){var e=new t(this.radius,this.direction1,this.direction2);return fe.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(e){i.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},t}(xh),Cs=function(){function i(){this.particlePositionGenerator=function(){},this.particleDestinationGenerator=function(){}}return i.prototype.startDirectionFunction=function(t,e,n,r){var o=d.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,o);var l=d.c.Vector3[1];o.subtractToRef(n.position,l),l.scaleToRef(1/n.lifeTime,o)}else o.set(0,0,0);r?e.copyFrom(o):d.e.TransformNormalToRef(o,t,e)},i.prototype.startPositionFunction=function(t,e,n,r){var o=d.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,o):o.set(0,0,0),r?e.copyFrom(o):d.e.TransformCoordinatesToRef(o,t,e)},i.prototype.clone=function(){var t=new i;return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){},i.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"},i.prototype.getClassName=function(){return"CustomParticleEmitter"},i.prototype.serialize=function(){var t={};return t.type=this.getClassName(),t},i.prototype.parse=function(t){},i}(),w0=function(){function i(t){t===void 0&&(t=null),this._indices=null,this._positions=null,this._normals=null,this._storedNormal=d.e.Zero(),this._mesh=null,this.direction1=new d.e(0,1,0),this.direction2=new d.e(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}return Object.defineProperty(i.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.getIndices(),this._positions=t.getVerticesData(Me.b.PositionKind),this._normals=t.getVerticesData(Me.b.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))},enumerable:!1,configurable:!0}),i.prototype.startDirectionFunction=function(t,e,n,r){if(this.useMeshNormalsForDirection&&this._normals)d.e.TransformNormalToRef(this._storedNormal,t,e);else{var o=se.a.RandomRange(this.direction1.x,this.direction2.x),l=se.a.RandomRange(this.direction1.y,this.direction2.y),h=se.a.RandomRange(this.direction1.z,this.direction2.z);r?e.copyFromFloats(o,l,h):d.e.TransformNormalFromFloatsToRef(o,l,h,t,e)}},i.prototype.startPositionFunction=function(t,e,n,r){if(this._indices&&this._positions){var o=3*Math.random()*(this._indices.length/3)|0,l=Math.random(),h=Math.random()*(1-l),v=1-l-h,b=this._indices[o],A=this._indices[o+1],D=this._indices[o+2],N=d.c.Vector3[0],j=d.c.Vector3[1],k=d.c.Vector3[2],H=d.c.Vector3[3];d.e.FromArrayToRef(this._positions,3*b,N),d.e.FromArrayToRef(this._positions,3*A,j),d.e.FromArrayToRef(this._positions,3*D,k),H.x=l*N.x+h*j.x+v*k.x,H.y=l*N.y+h*j.y+v*k.y,H.z=l*N.z+h*j.z+v*k.z,r?e.copyFromFloats(H.x,H.y,H.z):d.e.TransformCoordinatesFromFloatsToRef(H.x,H.y,H.z,t,e),this.useMeshNormalsForDirection&&this._normals&&(d.e.FromArrayToRef(this._normals,3*b,N),d.e.FromArrayToRef(this._normals,3*A,j),d.e.FromArrayToRef(this._normals,3*D,k),this._storedNormal.x=l*N.x+h*j.x+v*k.x,this._storedNormal.y=l*N.y+h*j.y+v*k.y,this._storedNormal.z=l*N.z+h*j.z+v*k.z)}},i.prototype.clone=function(){var t=new i(this.mesh);return fe.a.DeepCopy(this,t),t},i.prototype.applyToShader=function(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return""},i.prototype.getClassName=function(){return"MeshParticleEmitter"},i.prototype.serialize=function(){var t,e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.meshId=(t=this.mesh)===null||t===void 0?void 0:t.id,e.useMeshNormalsForDirection=this.useMeshNormalsForDirection,e},i.prototype.parse=function(t,e){d.e.FromArrayToRef(t.direction1,0,this.direction1),d.e.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&e&&(this.mesh=e.getLastMeshByID(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection},i}(),ul=function(){function i(t){this.animations=[],this.renderingGroupId=0,this.emitter=d.e.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new d.e(10,10,10),this.onAnimationEnd=null,this.blendMode=i.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new d.d(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new d.e(0,0,0),this.gravity=d.e.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new x.b(1,1,1,1),this.color2=new x.b(1,1,1,1),this.colorDead=new x.b(0,0,0,1),this.textureMask=new x.b(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=g.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Jn.b,this.id=t,this.name=t}return Object.defineProperty(i.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},i.prototype.getDragGradients=function(){return this._dragGradients},i.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},i.prototype.getColorGradients=function(){return this._colorGradients},i.prototype.getSizeGradients=function(){return this._sizeGradients},i.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},i.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},i.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},i.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},i.prototype.getVelocityGradients=function(){return this._velocityGradients},i.prototype.getStartSizeGradients=function(){return this._startSizeGradients},i.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(i.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:d.e.Zero()},set:function(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:d.e.Zero()},set:function(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:d.e.Zero()},set:function(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:d.e.Zero()},set:function(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(t){this._attachImageProcessingConfiguration(t)},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)},i.prototype._reset=function(){},i.prototype._removeGradientAndTexture=function(t,e,n){if(!e)return this;for(var r=0,o=0,l=e;o<l.length;o++){if(l[o].gradient===t){e.splice(r,1);break}r++}return n&&n.dispose(),this},i.prototype.createPointEmitter=function(t,e){var n=new pm;return n.direction1=t,n.direction2=e,this.particleEmitterType=n,n},i.prototype.createHemisphericEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new fm(t,e);return this.particleEmitterType=n,n},i.prototype.createSphereEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=1);var n=new xh(t,e);return this.particleEmitterType=n,n},i.prototype.createDirectedSphereEmitter=function(t,e,n){t===void 0&&(t=1),e===void 0&&(e=new d.e(0,1,0)),n===void 0&&(n=new d.e(0,1,0));var r=new mm(t,e,n);return this.particleEmitterType=r,r},i.prototype.createCylinderEmitter=function(t,e,n,r){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=0);var o=new Sh(t,e,n,r);return this.particleEmitterType=o,o},i.prototype.createDirectedCylinderEmitter=function(t,e,n,r,o){t===void 0&&(t=1),e===void 0&&(e=1),n===void 0&&(n=1),r===void 0&&(r=new d.e(0,1,0)),o===void 0&&(o=new d.e(0,1,0));var l=new dm(t,e,n,r,o);return this.particleEmitterType=l,l},i.prototype.createConeEmitter=function(t,e){t===void 0&&(t=1),e===void 0&&(e=Math.PI/4);var n=new hm(t,e);return this.particleEmitterType=n,n},i.prototype.createBoxEmitter=function(t,e,n,r){var o=new As;return this.particleEmitterType=o,this.direction1=t,this.direction2=e,this.minEmitBox=n,this.maxEmitBox=r,o},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i.BLENDMODE_ADD=2,i.BLENDMODE_MULTIPLY=3,i.BLENDMODE_MULTIPLYADD=4,i}(),_m=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("rgba",ue.Color4,!0),n.registerInput("rgb ",ue.Color3,!0),n.registerOutput("rgb",ue.Color3),n.registerOutput("r",ue.Float),n.registerOutput("g",ue.Float),n.registerOutput("b",ue.Float),n.registerOutput("a",ue.Float),n.inputsAreExclusive=!0,n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return e==="rgb "?"rgbIn":e},t.prototype._outputRename=function(e){return e==="rgb"?"rgbOut":e},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.rgba.isConnected?this.rgba:this.rgbIn;if(n.isConnected){var r=this._outputs[0],o=this._outputs[1],l=this._outputs[2],h=this._outputs[3],v=this._outputs[4];return r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.rgb;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.r;\r
`),l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = "+n.associatedVariableName+`.g;\r
`),h.hasEndpoints&&(e.compilationString+=this._declareOutput(h,e)+" = "+n.associatedVariableName+`.b;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.a;\r
`),this}},t}(vt);M.a.RegisteredTypes["BABYLON.ColorSplitterBlock"]=_m;var Cn,L0=c(104);(function(i){i[i.Cos=0]="Cos",i[i.Sin=1]="Sin",i[i.Abs=2]="Abs",i[i.Exp=3]="Exp",i[i.Exp2=4]="Exp2",i[i.Round=5]="Round",i[i.Floor=6]="Floor",i[i.Ceiling=7]="Ceiling",i[i.Sqrt=8]="Sqrt",i[i.Log=9]="Log",i[i.Tan=10]="Tan",i[i.ArcTan=11]="ArcTan",i[i.ArcCos=12]="ArcCos",i[i.ArcSin=13]="ArcSin",i[i.Fract=14]="Fract",i[i.Sign=15]="Sign",i[i.Radians=16]="Radians",i[i.Degrees=17]="Degrees"})(Cn||(Cn={}));var gm=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.operation=Cn.Cos,n.registerInput("input",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="";switch(this.operation){case Cn.Cos:r="cos";break;case Cn.Sin:r="sin";break;case Cn.Abs:r="abs";break;case Cn.Exp:r="exp";break;case Cn.Exp2:r="exp2";break;case Cn.Round:r="round";break;case Cn.Floor:r="floor";break;case Cn.Ceiling:r="ceil";break;case Cn.Sqrt:r="sqrt";break;case Cn.Log:r="log";break;case Cn.Tan:r="tan";break;case Cn.ArcTan:r="atan";break;case Cn.ArcCos:r="acos";break;case Cn.ArcSin:r="asin";break;case Cn.Fract:r="fract";break;case Cn.Sign:r="sign";break;case Cn.Radians:r="radians";break;case Cn.Degrees:r="degrees"}return e.compilationString+=this._declareOutput(n,e)+" = "+r+"("+this.input.associatedVariableName+`);\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.operation=this.operation,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.operation=e.operation},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".operation = BABYLON.TrigonometryBlockOperations."+Cn[this.operation]+`;\r
`},t}(vt);M.a.RegisteredTypes["BABYLON.TrigonometryBlock"]=gm;var vm={effect:null,subMesh:null},hl=function(i){function t(){var e=i.call(this)||this;return e.NORMAL=!1,e.TANGENT=!1,e.UV1=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_UV=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.BUMPDIRECTUV=0,e.rebuild(),e}return Object(_.d)(t,i),t.prototype.setValue=function(e,n,r){r===void 0&&(r=!1),this[e]===void 0&&this._keys.push(e),r&&this[e]!==n&&this.markAsUnprocessed(),this[e]=n},t}(ah.a),Ph=function(i){function t(e,n,r){r===void 0&&(r={});var o=i.call(this,e,n||Xe.a.LastCreatedScene)||this;return o._buildId=t._BuildIdGenerator++,o._buildWasSuccessful=!1,o._cachedWorldViewMatrix=new d.a,o._cachedWorldViewProjectionMatrix=new d.a,o._optimizers=new Array,o._animationFrame=-1,o.BJSNODEMATERIALEDITOR=o._getGlobalNodeMaterialEditor(),o.editorData=null,o.ignoreAlpha=!1,o.maxSimultaneousLights=4,o.onBuildObservable=new E.c,o._vertexOutputNodes=new Array,o._fragmentOutputNodes=new Array,o.attachedBlocks=new Array,o._mode=yr.Material,o._options=Object(_.a)({emitComments:!1},r),o._attachImageProcessingConfiguration(null),o}return Object(_.d)(t,i),t.prototype._getGlobalNodeMaterialEditor=function(){return typeof NODEEDITOR!="undefined"?NODEEDITOR:typeof BABYLON!="undefined"&&BABYLON.NodeEditor!==void 0?BABYLON:void 0},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"NodeMaterial"},t.prototype._attachImageProcessingConfiguration=function(e){var n=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._markAllSubMeshesAsImageProcessingDirty()})))},t.prototype.getBlockByName=function(e){for(var n=null,r=0,o=this.attachedBlocks;r<o.length;r++){var l=o[r];if(l.name===e){if(n)return Qe.b.Warn("More than one block was found with the name `"+e+"`"),n;n=l}}return n},t.prototype.getBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(e(o))return o}return null},t.prototype.getInputBlockByPredicate=function(e){for(var n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];if(o.isInput&&e(o))return o}return null},t.prototype.getInputBlocks=function(){for(var e=[],n=0,r=this.attachedBlocks;n<r.length;n++){var o=r[n];o.isInput&&e.push(o)}return e},t.prototype.registerOptimizer=function(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this},t.prototype.unregisterOptimizer=function(e){var n=this._optimizers.indexOf(e);if(n!==-1)return this._optimizers.splice(n,1),this},t.prototype.addOutputNode=function(e){if(e.target===null)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return(e.target&Re.Vertex)!=0&&this._addVertexOutputNode(e),(e.target&Re.Fragment)!=0&&this._addFragmentOutputNode(e),this},t.prototype.removeOutputNode=function(e){return e.target===null||((e.target&Re.Vertex)!=0&&this._removeVertexOutputNode(e),(e.target&Re.Fragment)!=0&&this._removeFragmentOutputNode(e)),this},t.prototype._addVertexOutputNode=function(e){if(this._vertexOutputNodes.indexOf(e)===-1)return e.target=Re.Vertex,this._vertexOutputNodes.push(e),this},t.prototype._removeVertexOutputNode=function(e){var n=this._vertexOutputNodes.indexOf(e);if(n!==-1)return this._vertexOutputNodes.splice(n,1),this},t.prototype._addFragmentOutputNode=function(e){if(this._fragmentOutputNodes.indexOf(e)===-1)return e.target=Re.Fragment,this._fragmentOutputNodes.push(e),this},t.prototype._removeFragmentOutputNode=function(e){var n=this._fragmentOutputNodes.indexOf(e);if(n!==-1)return this._fragmentOutputNodes.splice(n,1),this},t.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},t.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},t.prototype._initializeBlock=function(e,n,r){if(e.initialize(n),e.autoConfigure(this),e._preparationId=this._buildId,this.attachedBlocks.indexOf(e)===-1){if(e.isUnique){for(var o=e.getClassName(),l=0,h=this.attachedBlocks;l<h.length;l++)if(h[l].getClassName()===o)throw"Cannot have multiple blocks of type "+o+" in the same NodeMaterial"}this.attachedBlocks.push(e)}for(var v=0,b=e.inputs;v<b.length;v++){var A=b[v];A.associatedVariableName="";var D=A.connectedPoint;if(D){var N=D.ownerBlock;N!==e&&((N.target===Re.VertexAndFragment||n.target===Re.Fragment&&N.target===Re.Vertex&&N._preparationId!==this._buildId)&&r.push(N),this._initializeBlock(N,n,r))}}for(var j=0,k=e.outputs;j<k.length;j++)k[j].associatedVariableName=""},t.prototype._resetDualBlocks=function(e,n){e.target===Re.VertexAndFragment&&(e.buildId=n);for(var r=0,o=e.inputs;r<o.length;r++){var l=o[r].connectedPoint;if(l){var h=l.ownerBlock;h!==e&&this._resetDualBlocks(h,n)}}},t.prototype.removeBlock=function(e){var n=this.attachedBlocks.indexOf(e);n>-1&&this.attachedBlocks.splice(n,1),e.isFinalMerger&&this.removeOutputNode(e)},t.prototype.build=function(e){e===void 0&&(e=!1),this._buildWasSuccessful=!1;var n=this.getScene().getEngine(),r=this._mode===yr.Particle;if(this._vertexOutputNodes.length===0&&!r)throw"You must define at least one vertexOutputNode";if(this._fragmentOutputNodes.length===0)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new I0,this._vertexCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._vertexCompilationState.target=Re.Vertex,this._fragmentCompilationState=new I0,this._fragmentCompilationState.supportUniformBuffers=n.supportsUniformBuffers,this._fragmentCompilationState.target=Re.Fragment,this._sharedData=new uw,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=r;for(var o=[],l=[],h=0,v=this._vertexOutputNodes;h<v.length;h++){var b=v[h];o.push(b),this._initializeBlock(b,this._vertexCompilationState,l)}for(var A=0,D=this._fragmentOutputNodes;A<D.length;A++){var N=D[A];l.push(N),this._initializeBlock(N,this._fragmentCompilationState,o)}this.optimize();for(var j=0,k=o;j<k.length;j++)(b=k[j]).build(this._vertexCompilationState,o);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var H=0,J=l;H<J.length;H++)N=J[H],this._resetDualBlocks(N,this._buildId-1);for(var te=0,oe=l;te<oe.length;te++)(N=oe[te]).build(this._fragmentCompilationState,l);this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),this._buildId=t._BuildIdGenerator++,this._sharedData.emitErrors(),e&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString)),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var ce=0,he=this.getScene().meshes;ce<he.length;ce++){var _e=he[ce];if(_e.subMeshes)for(var ye=0,Ee=_e.subMeshes;ye<Ee.length;ye++){var Oe=Ee[ye];if(Oe.getMaterial()===this&&Oe._materialDefines){var Ae=Oe._materialDefines;Ae.markAllAsDirty(),Ae.reset()}}}},t.prototype.optimize=function(){for(var e=0,n=this._optimizers;e<n.length;e++)n[e].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)},t.prototype._prepareDefinesForAttributes=function(e,n){var r=n.NORMAL,o=n.TANGENT,l=n.UV1;n.NORMAL=e.isVerticesDataPresent(Me.b.NormalKind),n.TANGENT=e.isVerticesDataPresent(Me.b.TangentKind),n.UV1=e.isVerticesDataPresent(Me.b.UVKind),r===n.NORMAL&&o===n.TANGENT&&l===n.UV1||n.markAsAttributesDirty()},t.prototype.createPostProcess=function(e,n,r,o,l,h,v){return n===void 0&&(n=1),r===void 0&&(r=g.a.TEXTURE_NEAREST_SAMPLINGMODE),h===void 0&&(h=g.a.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=g.a.TEXTUREFORMAT_RGBA),this.mode!==yr.PostProcess?(console.log("Incompatible material mode"),null):this._createEffectForPostProcess(null,e,n,r,o,l,h,v)},t.prototype.createEffectForPostProcess=function(e){this._createEffectForPostProcess(e)},t.prototype._createEffectForPostProcess=function(e,n,r,o,l,h,v,b){var A=this;r===void 0&&(r=1),o===void 0&&(o=g.a.TEXTURE_NEAREST_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=g.a.TEXTUREFORMAT_RGBA);var D=this.name+this._buildId,N=new hl,j=new Lt.a(D+"PostProcess",this.getScene()),k=this._buildId;return this._processDefines(j,N),We.a.RegisterShader(D,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),e?e.updateEffect(N.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,D,D):e=new bt(this.name+"PostProcess",D,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,r,n,o,l,h,N.toString(),v,D,{maxSimultaneousLights:this.maxSimultaneousLights},!1,b),e.nodeMaterialSource=this,e.onApplyObservable.add(function(H){k!==A._buildId&&(delete We.a.ShadersStore[D+"VertexShader"],delete We.a.ShadersStore[D+"PixelShader"],D=A.name+A._buildId,N.markAsUnprocessed(),k=A._buildId),A._processDefines(j,N)&&(We.a.RegisterShader(D,A._fragmentCompilationState._builtCompilationString,A._vertexCompilationState._builtCompilationString),L0.a.SetImmediate(function(){return e.updateEffect(N.toString(),A._fragmentCompilationState.uniforms,A._fragmentCompilationState.samplers,{maxSimultaneousLights:A.maxSimultaneousLights},void 0,void 0,D,D)})),A._checkInternals(H)}),e},t.prototype.createProceduralTexture=function(e,n){var r=this;if(this.mode!==yr.ProceduralTexture)return console.log("Incompatible material mode"),null;var o=this.name+this._buildId,l=new sl(o,e,null,n),h=new Lt.a(o+"Procedural",this.getScene());h.reservedDataStore={hidden:!0};var v=new hl,b=this._processDefines(h,v);We.a.RegisterShader(o,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);var A=this.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[Me.b.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,v.toString(),b==null?void 0:b.fallbacks,void 0);l.nodeMaterialSource=this,l._effect=A;var D=this._buildId;return l.onBeforeGenerationObservable.add(function(){D!==r._buildId&&(delete We.a.ShadersStore[o+"VertexShader"],delete We.a.ShadersStore[o+"PixelShader"],o=r.name+r._buildId,v.markAsUnprocessed(),D=r._buildId);var N=r._processDefines(h,v);N&&(We.a.RegisterShader(o,r._fragmentCompilationState._builtCompilationString,r._vertexCompilationState._builtCompilationString),L0.a.SetImmediate(function(){A=r.getScene().getEngine().createEffect({vertexElement:o,fragmentElement:o},[Me.b.PositionKind],r._fragmentCompilationState.uniforms,r._fragmentCompilationState.samplers,v.toString(),N==null?void 0:N.fallbacks,void 0),l._effect=A})),r._checkInternals(A)}),l},t.prototype._createEffectForParticles=function(e,n,r,o,l,h,v,b){var A=this;b===void 0&&(b="");var D=this.name+this._buildId+"_"+n;h||(h=new hl),v||(v=this.getScene().getMeshByName(this.name+"Particle"))||((v=new Lt.a(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});var N=this._buildId,j=[],k=b;if(!l){var H=this._processDefines(v,h);We.a.RegisterShader(D,this._fragmentCompilationState._builtCompilationString),e.fillDefines(j,n),k=j.join(`
`),l=this.getScene().getEngine().createEffectForParticles(D,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,h.toString()+`
`+k,H==null?void 0:H.fallbacks,r,o,e),e.setCustomEffect(l,n)}l.onBindObservable.add(function(J){N!==A._buildId&&(delete We.a.ShadersStore[D+"PixelShader"],D=A.name+A._buildId+"_"+n,h.markAsUnprocessed(),N=A._buildId),j.length=0,e.fillDefines(j,n);var te=j.join(`
`);te!==k&&(h.markAsUnprocessed(),k=te);var oe=A._processDefines(v,h);if(oe)return We.a.RegisterShader(D,A._fragmentCompilationState._builtCompilationString),J=A.getScene().getEngine().createEffectForParticles(D,A._fragmentCompilationState.uniforms,A._fragmentCompilationState.samplers,h.toString()+`
`+k,oe==null?void 0:oe.fallbacks,r,o,e),e.setCustomEffect(J,n),void A._createEffectForParticles(e,n,r,o,J,h,v,k);A._checkInternals(J)})},t.prototype._checkInternals=function(e){if(this._sharedData.animatedInputs){var n=this.getScene(),r=n.getFrameId();if(this._animationFrame!==r){for(var o=0,l=this._sharedData.animatedInputs;o<l.length;o++)l[o].animate(n);this._animationFrame=r}}for(var h=0,v=this._sharedData.bindableBlocks;h<v.length;h++)v[h].bind(e,this);for(var b=0,A=this._sharedData.inputBlocks;b<A.length;b++)A[b]._transmit(e,this.getScene())},t.prototype.createEffectForParticles=function(e,n,r){this.mode===yr.Particle?(this._createEffectForParticles(e,ul.BLENDMODE_ONEONE,n,r),this._createEffectForParticles(e,ul.BLENDMODE_MULTIPLY,n,r)):console.log("Incompatible material mode")},t.prototype._processDefines=function(e,n,r,o){var l=this;r===void 0&&(r=!1);var h=null;if(this._sharedData.blocksWithDefines.forEach(function(j){j.initializeDefines(e,l,n,r)}),this._sharedData.blocksWithDefines.forEach(function(j){j.prepareDefines(e,l,n,r,o)}),n.isDirty){var v=n._areLightsDisposed;n.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach(function(j){j.replaceRepeatableContent(l._vertexCompilationState,l._fragmentCompilationState,e,n)});var b=[];this._sharedData.dynamicUniformBlocks.forEach(function(j){j.updateUniformsAndSamples(l._vertexCompilationState,l,n,b)});var A=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach(function(j){A.indexOf(j)===-1&&A.push(j)});var D=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach(function(j){D.indexOf(j)===-1&&D.push(j)});var N=new ms.a;this._sharedData.blocksWithFallbacks.forEach(function(j){j.provideFallbacks(e,N)}),h={lightDisposed:v,uniformBuffers:b,mergedUniforms:A,mergedSamplers:D,fallbacks:N}}return h},t.prototype.isReadyForSubMesh=function(e,n,r){var o=this;if(r===void 0&&(r=!1),!this._buildWasSuccessful)return!1;var l=this.getScene();if(this._sharedData.animatedInputs){var h=l.getFrameId();if(this._animationFrame!==h){for(var v=0,b=this._sharedData.animatedInputs;v<b.length;v++)b[v].animate(l);this._animationFrame=h}}if(n.effect&&this.isFrozen&&n.effect._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new hl);var A=n._materialDefines;if(this._isReadyForSubMesh(n))return!0;var D=l.getEngine();if(this._prepareDefinesForAttributes(e,A),this._sharedData.blockingBlocks.some(function(J){return!J.isReady(e,o,A,r)}))return!1;var N=this._processDefines(e,A,r,n);if(N){var j=n.effect,k=A.toString(),H=D.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:N.mergedUniforms,uniformBuffersNames:N.uniformBuffers,samplers:N.mergedSamplers,defines:k,fallbacks:N.fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:A.NUM_MORPH_INFLUENCERS}},D);if(H)if(this._onEffectCreatedObservable&&(vm.effect=H,vm.subMesh=n,this._onEffectCreatedObservable.notifyObservers(vm)),this.allowShaderHotSwapping&&j&&!H.isReady()){if(H=j,A.markAsUnprocessed(),N.lightDisposed)return A._areLightsDisposed=!0,!1}else l.resetCachedMaterial(),n.setEffect(H,A)}return!(!n.effect||!n.effect.isReady())&&(A._renderId=l.getRenderId(),n.effect._wasPreviouslyReady=!0,!0)},Object.defineProperty(t.prototype,"compiledShaders",{get:function(){return`// Vertex shader\r
`+this._vertexCompilationState.compilationString+`\r
\r
// Fragment shader\r
`+this._fragmentCompilationState.compilationString},enumerable:!1,configurable:!0}),t.prototype.bindOnlyWorldMatrix=function(e){var n=this.getScene();if(this._activeEffect){var r=this._sharedData.hints;r.needWorldViewMatrix&&e.multiplyToRef(n.getViewMatrix(),this._cachedWorldViewMatrix),r.needWorldViewProjectionMatrix&&e.multiplyToRef(n.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var o=0,l=this._sharedData.inputBlocks;o<l.length;o++)l[o]._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}},t.prototype.bindForSubMesh=function(e,n,r){var o=this.getScene(),l=r.effect;if(l){if(this._activeEffect=l,this.bindOnlyWorldMatrix(e),this._mustRebind(o,l,n.visibility)){var h=this._sharedData;if(l&&o.getCachedEffect()!==l){for(var v=0,b=h.bindableBlocks;v<b.length;v++)b[v].bind(l,this,n,r);for(var A=0,D=h.inputBlocks;A<D.length;A++)D[A]._transmit(l,o)}}this._afterBind(n,this._activeEffect)}},t.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._sharedData&&e.push.apply(e,this._sharedData.textureBlocks.filter(function(n){return n.texture}).map(function(n){return n.texture})),e},t.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},t.prototype.hasTexture=function(e){if(i.prototype.hasTexture.call(this,e))return!0;if(!this._sharedData)return!1;for(var n=0,r=this._sharedData.textureBlocks;n<r.length;n++)if(r[n].texture===e)return!0;return!1},t.prototype.dispose=function(e,n,r){if(n)for(var o=0,l=this._sharedData.textureBlocks.filter(function(b){return b.texture}).map(function(b){return b.texture});o<l.length;o++)l[o].dispose();for(var h=0,v=this.attachedBlocks;h<v.length;h++)v[h].dispose();this.onBuildObservable.clear(),i.prototype.dispose.call(this,e,n,r)},t.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor(),this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},t.prototype.edit=function(e){var n=this;return new Promise(function(r,o){if(n.BJSNODEMATERIALEDITOR===void 0){var l=e&&e.editorURL?e.editorURL:t.EditorURL;Qe.b.LoadScript(l,function(){n._createNodeEditor(),r()})}else n._createNodeEditor(),r()})},t.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},t.prototype.setToDefault=function(){this.clear(),this.editorData=null;var e=new It("Position");e.setAsAttribute("position");var n=new It("World");n.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var r=new Th("WorldPos");e.connectTo(r),n.connectTo(r);var o=new It("ViewProjection");o.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);var l=new Th("WorldPos * ViewProjectionTransform");r.connectTo(l),o.connectTo(l);var h=new cl("VertexOutput");l.connectTo(h);var v=new It("color");v.value=new x.b(.8,.8,.8,1);var b=new Ps("FragmentOutput");v.connectTo(b),this.addOutputNode(h),this.addOutputNode(b),this._mode=yr.Material},t.prototype.setToDefaultPostProcess=function(){this.clear(),this.editorData=null;var e=new It("Position");e.setAsAttribute("position2d");var n=new It("Constant1");n.isConstant=!0,n.value=1;var r=new ll("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new cl("VertexOutput");r.connectTo(o);var l=new It("Scale");l.visibleInInspector=!0,l.value=new d.d(1,1);var h=new um("uv0");e.connectTo(h);var v=new Eh("UV scale");h.connectTo(v),l.connectTo(v);var b=new am("CurrentScreen");v.connectTo(b),b.texture=new Ve.a("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());var A=new Ps("FragmentOutput");b.connectTo(A,{output:"rgba"}),this.addOutputNode(o),this.addOutputNode(A),this._mode=yr.PostProcess},t.prototype.setToDefaultProceduralTexture=function(){this.clear(),this.editorData=null;var e=new It("Position");e.setAsAttribute("position2d");var n=new It("Constant1");n.isConstant=!0,n.value=1;var r=new ll("Position3D");e.connectTo(r),n.connectTo(r,{input:"w"});var o=new cl("VertexOutput");r.connectTo(o);var l=new It("Time");l.value=0,l.min=0,l.max=0,l.isBoolean=!1,l.matrixMode=0,l.animationType=ko.Time,l.isConstant=!1;var h=new It("Color3");h.value=new x.a(1,1,1),h.isConstant=!1;var v=new Ps("FragmentOutput"),b=new ll("VectorMerger");b.visibleInInspector=!1;var A=new gm("Cos");A.operation=Cn.Cos,e.connectTo(b),l.output.connectTo(A.input),A.output.connectTo(b.z),b.xyzOut.connectTo(v.rgb),this.addOutputNode(o),this.addOutputNode(v),this._mode=yr.ProceduralTexture},t.prototype.setToDefaultParticle=function(){this.clear(),this.editorData=null;var e=new It("uv");e.setAsAttribute("particle_uv");var n=new sm("ParticleTexture");e.connectTo(n);var r=new It("Color");r.setAsAttribute("particle_color");var o=new Eh("Texture * Color");n.connectTo(o),r.connectTo(o);var l=new cm("ParticleRampGradient");o.connectTo(l);var h=new _m("ColorSplitter");r.connectTo(h);var v=new lm("ParticleBlendMultiply");l.connectTo(v),n.connectTo(v,{output:"a"}),h.connectTo(v,{output:"a"});var b=new Ps("FragmentOutput");v.connectTo(b),this.addOutputNode(b),this._mode=yr.Particle},t.prototype.loadAsync=function(e){var n=this;return this.getScene()._loadFileAsync(e).then(function(r){var o=JSON.parse(r);n.loadFromSerialization(o,"")})},t.prototype._gatherBlocks=function(e,n){if(n.indexOf(e)===-1){n.push(e);for(var r=0,o=e.inputs;r<o.length;r++){var l=o[r].connectedPoint;if(l){var h=l.ownerBlock;h!==e&&this._gatherBlocks(h,n)}}}},t.prototype.generateCode=function(){for(var e=[],n=[],r=[],o=0,l=this._vertexOutputNodes;o<l.length;o++){var h=l[o];this._gatherBlocks(h,n)}for(var v=[],b=0,A=this._fragmentOutputNodes;b<A.length;b++)h=A[b],this._gatherBlocks(h,v);for(var D='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+`");\r
`,N=0,j=n;N<j.length;N++)(Oe=j[N]).isInput&&e.indexOf(Oe)===-1&&(D+=Oe._dumpCode(r,e));for(var k=0,H=v;k<H.length;k++)(Oe=H[k]).isInput&&e.indexOf(Oe)===-1&&(D+=Oe._dumpCode(r,e));e=[],D+=`\r
// Connections\r
`;for(var J=0,te=this._vertexOutputNodes;J<te.length;J++)D+=(Oe=te[J])._dumpCodeForOutputConnections(e);for(var oe=0,ce=this._fragmentOutputNodes;oe<ce.length;oe++)D+=(Oe=ce[oe])._dumpCodeForOutputConnections(e);D+=`\r
// Output nodes\r
`;for(var he=0,_e=this._vertexOutputNodes;he<_e.length;he++)D+="nodeMaterial.addOutputNode("+(Oe=_e[he])._codeVariableName+`);\r
`;for(var ye=0,Ee=this._fragmentOutputNodes;ye<Ee.length;ye++){var Oe;D+="nodeMaterial.addOutputNode("+(Oe=Ee[ye])._codeVariableName+`);\r
`}return D+=`nodeMaterial.build();\r
`},t.prototype.serialize=function(e){var n=e?{}:V.a.Serialize(this);n.editorData=JSON.parse(JSON.stringify(this.editorData));var r=[];if(e)r=e;else{n.customType="BABYLON.NodeMaterial",n.outputNodes=[];for(var o=0,l=this._vertexOutputNodes;o<l.length;o++){var h=l[o];this._gatherBlocks(h,r),n.outputNodes.push(h.uniqueId)}for(var v=0,b=this._fragmentOutputNodes;v<b.length;v++)h=b[v],this._gatherBlocks(h,r),n.outputNodes.indexOf(h.uniqueId)===-1&&n.outputNodes.push(h.uniqueId)}n.blocks=[];for(var A=0,D=r;A<D.length;A++){var N=D[A];n.blocks.push(N.serialize())}if(!e)for(var j=0,k=this.attachedBlocks;j<k.length;j++)N=k[j],r.indexOf(N)===-1&&n.blocks.push(N.serialize());return n},t.prototype._restoreConnections=function(e,n,r){for(var o=0,l=e.outputs;o<l.length;o++)for(var h=l[o],v=0,b=n.blocks;v<b.length;v++){var A=b[v],D=r[A.id];if(D)for(var N=0,j=A.inputs;N<j.length;N++){var k=j[N];if(!(r[k.targetBlockId]!==e||k.targetConnectionName!==h.name)){var H=D.getInputByName(k.inputName);if(!H||H.isConnected)continue;h.connectTo(H,!0),this._restoreConnections(D,n,r)}}}},t.prototype.loadFromSerialization=function(e,n,r){var o;n===void 0&&(n=""),r===void 0&&(r=!1),r||this.clear();for(var l={},h=0,v=e.blocks;h<v.length;h++){var b=v[h],A=M.a.GetClass(b.customType);A&&((N=new A)._deserialize(b,this.getScene(),n),l[b.id]=N,this.attachedBlocks.push(N))}for(var D=0;D<e.blocks.length;D++){var N;(N=l[e.blocks[D].id])&&(N.inputs.length&&!r||this._restoreConnections(N,e,l))}if(e.outputNodes)for(var j=0,k=e.outputNodes;j<k.length;j++){var H=k[j];this.addOutputNode(l[H])}if(e.locations||e.editorData&&e.editorData.locations){for(var J=e.locations||e.editorData.locations,te=0,oe=J;te<oe.length;te++){var ce=oe[te];l[ce.blockId]&&(ce.blockId=l[ce.blockId].uniqueId)}r&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),e.locations?this.editorData={locations:J}:(this.editorData=e.editorData,this.editorData.locations=J);var he=[];for(var _e in l)he[_e]=l[_e].uniqueId;this.editorData.map=he}this.comment=e.comment,r||(this._mode=(o=e.mode)!==null&&o!==void 0?o:yr.Material)},t.prototype.clone=function(e){var n=this,r=this.serialize(),o=V.a.Clone(function(){return new t(e,n.getScene(),n.options)},this);return o.id=e,o.name=e,o.loadFromSerialization(r),o.build(),o},t.Parse=function(e,n,r){r===void 0&&(r="");var o=V.a.Parse(function(){return new t(e.name,n)},e,n,r);return o.loadFromSerialization(e,r),o.build(),o},t.ParseFromFileAsync=function(e,n,r){var o=new t(e,r);return new Promise(function(l,h){return o.loadAsync(n).then(function(){o.build(),l(o)}).catch(h)})},t.ParseFromSnippetAsync=function(e,n,r,o){var l=this;return r===void 0&&(r=""),e==="_BLANK"?Promise.resolve(this.CreateDefault("blank",n)):new Promise(function(h,v){var b=new re.a;b.addEventListener("readystatechange",function(){if(b.readyState==4)if(b.status==200){var A=JSON.parse(JSON.parse(b.responseText).jsonPayload),D=JSON.parse(A.nodeMaterial);o||((o=V.a.Parse(function(){return new t(e,n)},D,n,r)).uniqueId=n.getUniqueId()),o.loadFromSerialization(D),o.snippetId=e;try{o.build(),h(o)}catch(N){v(N)}}else v("Unable to load the snippet "+e)}),b.open("GET",l.SnippetUrl+"/"+e.replace(/#/g,"/")),b.send()})},t.CreateDefault=function(e,n){var r=new t(e,n);return r.setToDefault(),r.build(),r},t._BuildIdGenerator=0,t.EditorURL="https://unpkg.com/babylonjs-node-editor@"+Xe.a.Version+"/babylon.nodeEditor.js",t.SnippetUrl="https://snippet.babylonjs.com",t.IgnoreTexturesAtLoadTime=!1,Object(_.c)([Object(V.c)("mode")],t.prototype,"_mode",void 0),Object(_.c)([Object(V.c)("comment")],t.prototype,"comment",void 0),t}(sh.a);M.a.RegisteredTypes["BABYLON.NodeMaterial"]=Ph;var N0=function(i){function t(e){var n=i.call(this,e,Re.Vertex)||this;return n.registerInput("matricesIndices",ue.Vector4),n.registerInput("matricesWeights",ue.Vector4),n.registerInput("matricesIndicesExtra",ue.Vector4,!0),n.registerInput("matricesWeightsExtra",ue.Vector4,!0),n.registerInput("world",ue.Matrix),n.registerOutput("output",ue.Matrix),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh")},t.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(t.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.matricesIndices.isConnected){var n=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="matricesIndices"});n||(n=new It("matricesIndices")).setAsAttribute("matricesIndices"),n.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var r=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="matricesWeights"});r||(r=new It("matricesWeights")).setAsAttribute("matricesWeights"),r.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var o=e.getInputBlockByPredicate(function(l){return l.systemValue===Pt.World});o||(o=new It("world")).setAsSystemValue(Pt.World),o.output.connectTo(this.world)}},t.prototype.provideFallbacks=function(e,n){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&n.addCPUSkinningFallback(0,e)},t.prototype.bind=function(e,n,r){ot.a.BindBonesParameters(r,e)},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&ot.a.PrepareDefinesForBones(e,r)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithFallbacks.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.uniforms.push("boneTextureWidth"),e.uniforms.push("mBones"),e.samplers.push("boneSampler");var n="//"+this.name;e._emitFunctionFromInclude("bonesDeclaration",n,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var r=e._getFreeVariableName("influence");e.compilationString+=e._emitCodeFromInclude("bonesVertex",n,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:r}]});var o=this._outputs[0],l=this.world;return e.compilationString+=`#if NUM_BONE_INFLUENCERS>0\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+l.associatedVariableName+" * "+r+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+l.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.BonesBlock"]=N0;var F0=function(i){function t(e){var n=i.call(this,e,Re.Vertex)||this;return n.registerInput("world0",ue.Vector4),n.registerInput("world1",ue.Vector4),n.registerInput("world2",ue.Vector4),n.registerInput("world3",ue.Vector4),n.registerInput("world",ue.Matrix,!0),n.registerOutput("output",ue.Matrix),n.registerOutput("instanceID",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(t.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.world0.connectedPoint){var n=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world0"});n||(n=new It("world0")).setAsAttribute("world0"),n.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var r=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world1"});r||(r=new It("world1")).setAsAttribute("world1"),r.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var o=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world2"});o||(o=new It("world2")).setAsAttribute("world2"),o.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var l=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world3"});l||(l=new It("world3")).setAsAttribute("world3"),l.output.connectTo(this.world3)}if(!this.world.connectedPoint){var h=e.getInputBlockByPredicate(function(v){return v.isAttribute&&v.name==="world"});h||(h=new It("world")).setAsSystemValue(Pt.World),h.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"},t.prototype.prepareDefines=function(e,n,r,o,l){o===void 0&&(o=!1);var h=!1;r.INSTANCES!==o&&(r.setValue("INSTANCES",o),h=!0),l&&r.THIN_INSTANCES!==!!(l==null?void 0:l.getRenderingMesh().hasThinInstances)&&(r.setValue("THIN_INSTANCES",!!(l==null?void 0:l.getRenderingMesh().hasThinInstances)),h=!0),h&&r.markAsUnprocessed()},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this);var n=this._outputs[0],r=this._outputs[1],o=this.world0,l=this.world1,h=this.world2,v=this.world3;return e.compilationString+=`#ifdef INSTANCES\r
`,e.compilationString+=this._declareOutput(n,e)+" = mat4("+o.associatedVariableName+", "+l.associatedVariableName+", "+h.associatedVariableName+", "+v.associatedVariableName+`);\r
`,e.compilationString+=`#ifdef THIN_INSTANCES\r
`,e.compilationString+=n.associatedVariableName+" = "+this.world.associatedVariableName+" * "+n.associatedVariableName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+` = float(gl_InstanceID);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this.world.associatedVariableName+`;\r
`,e.compilationString+=this._declareOutput(r,e)+` = 0.0;\r
`,e.compilationString+=`#endif\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.InstancesBlock"]=F0;var B0=function(i){function t(e){var n=i.call(this,e,Re.Vertex)||this;return n.registerInput("position",ue.Vector3),n.registerInput("normal",ue.Vector3),n.registerInput("tangent",ue.Vector3),n.registerInput("uv",ue.Vector2),n.registerOutput("positionOutput",ue.Vector3),n.registerOutput("normalOutput",ue.Vector3),n.registerOutput("tangentOutput",ue.Vector3),n.registerOutput("uvOutput",ue.Vector2),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("morphTargetInfluences")},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(h){return h.isAttribute&&h.name==="position"});n||(n=new It("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.normal.isConnected){var r=e.getInputBlockByPredicate(function(h){return h.isAttribute&&h.name==="normal"});r||(r=new It("normal")).setAsAttribute("normal"),r.output.connectTo(this.normal)}if(!this.tangent.isConnected){var o=e.getInputBlockByPredicate(function(h){return h.isAttribute&&h.name==="tangent"});o||(o=new It("tangent")).setAsAttribute("tangent"),o.output.connectTo(this.tangent)}if(!this.uv.isConnected){var l=e.getInputBlockByPredicate(function(h){return h.isAttribute&&h.name==="uv"});l||(l=new It("uv")).setAsAttribute("uv"),l.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,n,r){r._areAttributesDirty&&ot.a.PrepareDefinesForMorphTargets(e,r)},t.prototype.bind=function(e,n,r){r&&r.morphTargetManager&&r.morphTargetManager.numInfluencers>0&&ot.a.BindMorphTargetParameters(r,e)},t.prototype.replaceRepeatableContent=function(e,n,r,o){for(var l=this.position,h=this.normal,v=this.tangent,b=this.uv,A=this.positionOutput,D=this.normalOutput,N=this.tangentOutput,j=this.uvOutput,k=e,H=o.NUM_MORPH_INFLUENCERS,J=r.morphTargetManager,te=J&&J.supportsNormals&&o.NORMAL,oe=J&&J.supportsTangents&&o.TANGENT,ce=J&&J.supportsUVs&&o.UV1,he="",_e=0;_e<H;_e++)he+=`#ifdef MORPHTARGETS\r
`,he+=A.associatedVariableName+" += (position"+_e+" - "+l.associatedVariableName+") * morphTargetInfluences["+_e+`];\r
`,te&&(he+=`#ifdef MORPHTARGETS_NORMAL\r
`,he+=D.associatedVariableName+" += (normal"+_e+" - "+h.associatedVariableName+") * morphTargetInfluences["+_e+`];\r
`,he+=`#endif\r
`),oe&&(he+=`#ifdef MORPHTARGETS_TANGENT\r
`,he+=N.associatedVariableName+".xyz += (tangent"+_e+" - "+v.associatedVariableName+".xyz) * morphTargetInfluences["+_e+`];\r
`,he+=`#endif\r
`),ce&&(he+=`#ifdef MORPHTARGETS_UV\r
`,he+=j.associatedVariableName+".xy += (uv_"+_e+" - "+b.associatedVariableName+".xy) * morphTargetInfluences["+_e+`];\r
`,he+=`#endif\r
`),he+=`#endif\r
`;if(k.compilationString=k.compilationString.replace(this._repeatableContentAnchor,he),H>0)for(_e=0;_e<H;_e++)k.attributes.push(Me.b.PositionKind+_e),te&&k.attributes.push(Me.b.NormalKind+_e),oe&&k.attributes.push(Me.b.TangentKind+_e),ce&&k.attributes.push(Me.b.UVKind+"_"+_e)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e.sharedData.repeatableContentBlocks.push(this);var n=this.position,r=this.normal,o=this.tangent,l=this.uv,h=this.positionOutput,v=this.normalOutput,b=this.tangentOutput,A=this.uvOutput,D="//"+this.name;return e.uniforms.push("morphTargetInfluences"),e._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",D),e._emitFunctionFromInclude("morphTargetsVertexDeclaration",D,{repeatKey:"maxSimultaneousMorphTargets"}),e.compilationString+=this._declareOutput(h,e)+" = "+n.associatedVariableName+`;\r
`,e.compilationString+=`#ifdef NORMAL\r
`,e.compilationString+=this._declareOutput(v,e)+" = "+r.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(v,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef TANGENT\r
`,e.compilationString+=this._declareOutput(b,e)+" = "+o.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(b,e)+` = vec3(0., 0., 0.);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#ifdef UV1\r
`,e.compilationString+=this._declareOutput(A,e)+" = "+l.associatedVariableName+`;\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(A,e)+` = vec2(0., 0.);\r
`,e.compilationString+=`#endif\r
`,this._repeatableContentAnchor=e._repeatableContentAnchor,e.compilationString+=this._repeatableContentAnchor,this},t}(vt);M.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=B0;var U0=function(i){function t(e){var n=i.call(this,e,Re.Vertex)||this;return n.registerInput("worldPosition",ue.Vector4,!1,Re.Vertex),n.registerOutput("direction",ue.Vector3),n.registerOutput("color",ue.Color3),n.registerOutput("intensity",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){if(r){this.light&&this.light.isDisposed&&(this.light=null);var o=this.light,l=n.getScene();if(!o&&l.lights.length&&(o=l.lights[0]),!o||!o.isEnabled)return e.setFloat3(this._lightDataUniformName,0,0,0),void e.setFloat4(this._lightColorUniformName,0,0,0,0);o.transferToNodeMaterialEffect(e,this._lightDataUniformName),e.setColor4(this._lightColorUniformName,o.diffuse,o.intensity)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=this.light;r.setValue(this._lightTypeDefineName,!!(o&&o instanceof Zp))}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n=this.direction,r=this.color,o=this.intensity;return this._lightDataUniformName=e._getFreeVariableName("lightData"),this._lightColorUniformName=e._getFreeVariableName("lightColor"),this._lightTypeDefineName=e._getFreeDefineName("LIGHTPOINTTYPE"),e._emitUniformFromString(this._lightDataUniformName,"vec3"),e._emitUniformFromString(this._lightColorUniformName,"vec4"),e.compilationString+="#ifdef "+this._lightTypeDefineName+`\r
`,e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+`);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(n,e)+" = "+this._lightDataUniformName+`;\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=this._declareOutput(r,e)+" = "+this._lightColorUniformName+`.rgb;\r
`,e.compilationString+=this._declareOutput(o,e)+" = "+this._lightColorUniformName+`.a;\r
`,this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(vt);M.a.RegisteredTypes["BABYLON.LightInformationBlock"]=U0;var V0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.registerInput("color",ue.Color4),n.registerOutput("output",ue.Color4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("exposureLinear"),e._excludeVariableName("contrast"),e._excludeVariableName("vInverseScreenSize"),e._excludeVariableName("vignetteSettings1"),e._excludeVariableName("vignetteSettings2"),e._excludeVariableName("vCameraColorCurveNegative"),e._excludeVariableName("vCameraColorCurveNeutral"),e._excludeVariableName("vCameraColorCurvePositive"),e._excludeVariableName("txColorTransform"),e._excludeVariableName("colorTransformSettings")},t.prototype.isReady=function(e,n,r){return!(r._areImageProcessingDirty&&n.imageProcessingConfiguration&&!n.imageProcessingConfiguration.isReady())},t.prototype.prepareDefines=function(e,n,r){r._areImageProcessingDirty&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.prepareDefines(r)},t.prototype.bind=function(e,n,r){r&&n.imageProcessingConfiguration&&n.imageProcessingConfiguration.bind(e)},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e),e.sharedData.blocksWithDefines.push(this),e.sharedData.blockingBlocks.push(this),e.sharedData.bindableBlocks.push(this),e.uniforms.push("exposureLinear"),e.uniforms.push("contrast"),e.uniforms.push("vInverseScreenSize"),e.uniforms.push("vignetteSettings1"),e.uniforms.push("vignetteSettings2"),e.uniforms.push("vCameraColorCurveNegative"),e.uniforms.push("vCameraColorCurveNeutral"),e.uniforms.push("vCameraColorCurvePositive"),e.uniforms.push("txColorTransform"),e.uniforms.push("colorTransformSettings");var n=this.color,r=this._outputs[0],o="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",o),e._emitFunctionFromInclude("imageProcessingDeclaration",o),e._emitFunctionFromInclude("imageProcessingFunctions",o),n.connectedPoint.type===ue.Color4||n.connectedPoint.type===ue.Vector4?e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`;\r
`:e.compilationString+=this._declareOutput(r,e)+" = vec4("+n.associatedVariableName+`, 1.0);\r
`,e.compilationString+=`#ifdef IMAGEPROCESSINGPOSTPROCESS\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=`#else\r
`,e.compilationString+=`#ifdef IMAGEPROCESSING\r
`,e.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+n.associatedVariableName+`.rgb);\r
`,e.compilationString+=r.associatedVariableName+" = applyImageProcessing("+r.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+=`#endif\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=V0;var k0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._tangentSpaceParameterName="",n.invertX=!1,n.invertY=!1,n.registerInput("worldPosition",ue.Vector4,!1),n.registerInput("worldNormal",ue.Vector4,!1),n.registerInput("worldTangent",ue.Vector4,!0),n.registerInput("uv",ue.Vector2,!1),n.registerInput("normalMapColor",ue.Color3,!1),n.registerInput("strength",ue.Float,!1),n.registerOutput("output",ue.Vector4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){r.setValue("BUMP",!0)},t.prototype.bind=function(e,n,r){n.getScene()._mirroredCameraPosition?e.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):e.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name==="uv"});n||(n=new It("uv")).setAsAttribute(),n.output.connectTo(this.uv)}if(!this.strength.isConnected){var r=new It("strength");r.value=1,r.output.connectTo(this.strength)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name,r=this.uv,o=this.worldPosition,l=this.worldNormal,h=this.worldTangent;e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=e._getFreeDefineName("tangentSpaceParameter"),e._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var v=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+e._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var b={search:/defined\(TANGENT\)/g,replace:h.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return h.isConnected&&(e.compilationString+="vec3 tbnNormal = normalize("+l.associatedVariableName+`.xyz);\r
`,e.compilationString+="vec3 tbnTangent = normalize("+h.associatedVariableName+`.xyz);\r
`,e.compilationString+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,e.compilationString+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",n,{replaceStrings:[b]}),e._emitFunctionFromInclude("bumpFragmentFunctions",n,{replaceStrings:[{search:/vBumpInfos.y/g,replace:v},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"}]}),e.compilationString+=this._declareOutput(this.output,e)+` = vec4(0.);\r
`,e.compilationString+=e._emitCodeFromInclude("bumpFragment",n,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:v},{search:/vBumpUV/g,replace:r.associatedVariableName},{search:/vPositionW/g,replace:o.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:l.associatedVariableName+".xyz"},b]}),this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".invertX = "+this.invertX+`;\r
`;return e+=this._codeVariableName+".invertY = "+this.invertY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.invertX=this.invertX,e.invertY=this.invertY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.invertX=e.invertX,this.invertY=e.invertY},Object(_.c)([$t("Invert X axis",Wt.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertX",void 0),Object(_.c)([$t("Invert Y axis",Wt.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertY",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=k0;var j0=function(i){function t(e){var n=i.call(this,e,Re.Fragment,!0)||this;return n.registerInput("value",ue.Float,!0),n.registerInput("cutoff",ue.Float,!0),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.sharedData.hints.needAlphaTesting=!0,this.cutoff.isConnected&&this.value.isConnected)return e.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+`) discard;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.DiscardBlock"]=j0;var z0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.registerOutput("output",ue.Float,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Re.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+` = gl_FrontFacing ? 1.0 : 0.0;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=z0;var G0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.registerInput("input",ue.AutoDetect,!1),n.registerOutput("dx",ue.BasedOnInput),n.registerOutput("dy",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[1]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._outputs[1];return e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),n.hasEndpoints&&(e.compilationString+=this._declareOutput(n,e)+" = dFdx("+this.input.associatedVariableName+`);\r
`),r.hasEndpoints&&(e.compilationString+=this._declareOutput(r,e)+" = dFdy("+this.input.associatedVariableName+`);\r
`),this},t}(vt);M.a.RegisteredTypes["BABYLON.DerivativeBlock"]=G0;var W0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.registerOutput("xy",ue.Vector2,Re.Fragment),n.registerOutput("xyz",ue.Vector3,Re.Fragment),n.registerOutput("xyzw",ue.Vector4,Re.Fragment),n.registerOutput("x",ue.Float,Re.Fragment),n.registerOutput("y",ue.Float,Re.Fragment),n.registerOutput("z",ue.Float,Re.Fragment),n.registerOutput("w",ue.Float,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FragCoordBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),t.prototype.writeOutputs=function(e){for(var n="",r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&(n+=this._declareOutput(l,e)+" = gl_FragCoord."+l.name+`;\r
`)}return n},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Re.Vertex)throw"FragCoordBlock must only be used in a fragment shader";return e.compilationString+=this.writeOutputs(e),this},t}(vt);M.a.RegisteredTypes["BABYLON.FragCoordBlock"]=W0;var H0=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.registerOutput("xy",ue.Vector2,Re.Fragment),n.registerOutput("x",ue.Float,Re.Fragment),n.registerOutput("y",ue.Float,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ScreenSizeBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,n,r){var o=this._scene.getEngine();e.setFloat2(this._varName,o.getRenderWidth(),o.getRenderWidth())},t.prototype.writeOutputs=function(e,n){for(var r="",o=0,l=this._outputs;o<l.length;o++){var h=l[o];h.hasEndpoints&&(r+=this._declareOutput(h,e)+" = "+n+"."+h.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,e.target===Re.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";return e.sharedData.bindableBlocks.push(this),this._varName=e._getFreeVariableName("screenSize"),e._emitUniformFromString(this._varName,"vec2"),e.compilationString+=this.writeOutputs(e,this._varName),this},t}(vt);M.a.RegisteredTypes["BABYLON.ScreenSizeBlock"]=H0;var X0=function(i){function t(e){var n=i.call(this,e,Re.VertexAndFragment,!0)||this;return n.registerInput("worldPosition",ue.Vector4,!1,Re.Vertex),n.registerInput("view",ue.Matrix,!1,Re.Vertex),n.registerInput("input",ue.Color3,!1,Re.Fragment),n.registerInput("fogColor",ue.Color3,!1,Re.Fragment),n.registerOutput("output",ue.Color3,Re.Fragment),n.input.acceptedConnectionPointTypes.push(ue.Color4),n.fogColor.acceptedConnectionPointTypes.push(ue.Color4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.view.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Pt.View});n||(n=new It("view")).setAsSystemValue(Pt.View),n.output.connectTo(this.view)}if(!this.fogColor.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Pt.FogColor});r||(r=new It("fogColor",void 0,ue.Color3)).setAsSystemValue(Pt.FogColor),r.output.connectTo(this.fogColor)}},t.prototype.prepareDefines=function(e,n,r){var o=e.getScene();r.setValue("FOG",n.fogEnabled&&ot.a.GetFogState(e,o))},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();e.setFloat4(this._fogParameters,o.fogMode,o.fogStart,o.fogEnd,o.fogDensity)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Re.Fragment){e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),e._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var n=e._getFreeVariableName("fog"),r=this.input,o=this.fogColor;this._fogParameters=e._getFreeVariableName("fogParameters");var l=this._outputs[0];e._emitUniformFromString(this._fogParameters,"vec4"),e.compilationString+=`#ifdef FOG\r
`,e.compilationString+="float "+n+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+`);\r
`,e.compilationString+=this._declareOutput(l,e)+" = "+n+" * "+r.associatedVariableName+".rgb + (1.0 - "+n+") * "+o.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#else\r
`+this._declareOutput(l,e)+" =  "+r.associatedVariableName+`.rgb;\r
`,e.compilationString+=`#endif\r
`}else{var h=this.worldPosition,v=this.view;this._fogDistanceName=e._getFreeVariableName("vFogDistance"),e._emitVaryingFromString(this._fogDistanceName,"vec3"),e.compilationString+=this._fogDistanceName+" = ("+v.associatedVariableName+" * "+h.associatedVariableName+`).xyz;\r
`}return this},t}(vt);M.a.RegisteredTypes["BABYLON.FogBlock"]=X0;var Y0=function(i){function t(e){var n=i.call(this,e,Re.VertexAndFragment)||this;return n._isUnique=!0,n.registerInput("worldPosition",ue.Vector4,!1,Re.Vertex),n.registerInput("worldNormal",ue.Vector4,!1,Re.Fragment),n.registerInput("cameraPosition",ue.Vector3,!1,Re.Fragment),n.registerInput("glossiness",ue.Float,!0,Re.Fragment),n.registerInput("glossPower",ue.Float,!0,Re.Fragment),n.registerInput("diffuseColor",ue.Color3,!0,Re.Fragment),n.registerInput("specularColor",ue.Color3,!0,Re.Fragment),n.registerInput("view",ue.Matrix,!0),n.registerOutput("diffuseOutput",ue.Color3,Re.Fragment),n.registerOutput("specularOutput",ue.Color3,Re.Fragment),n.registerOutput("shadow",ue.Float,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Pt.CameraPosition});n||(n=new It("cameraPosition")).setAsSystemValue(Pt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype.prepareDefines=function(e,n,r){if(r._areLightsDirty){var o=e.getScene();if(this.light){var l={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};ot.a.PrepareDefinesForLight(o,e,this.light,this._lightId,r,!0,l),l.needRebuild&&r.rebuild()}else ot.a.PrepareDefinesForLights(o,e,r,!0,n.maxSimultaneousLights)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var l=0;l<n.maxSimultaneousLights&&r["LIGHT"+l];l++){var h=e.uniforms.indexOf("vLightData"+l)>=0;ot.a.PrepareUniformsAndSamplersForLight(l,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+l],o,h)}},t.prototype.bind=function(e,n,r){if(r){var o=r.getScene();this.light?ot.a.BindLight(this.light,this._lightId,o,e,!0):ot.a.BindLights(o,r,e,!0,n.maxSimultaneousLights)}},t.prototype._injectVertexCode=function(e){var n=this.worldPosition,r="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",r,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var o="v_"+n.associatedVariableName;e._emitVaryingFromString(o,"vec4")&&(e.compilationString+=o+" = "+n.associatedVariableName+`;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:n.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+n.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{repeatKey:"maxSimultaneousLights"}))},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),e.target===Re.Fragment){e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var n="//"+this.name,r=this.worldPosition;e._emitFunctionFromInclude("helperFunctions",n),e._emitFunctionFromInclude("lightsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),e._emitFunctionFromInclude("shadowsFragmentFunctions",n,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",n,{repeatKey:"maxSimultaneousLights"}),this._lightId===0&&(e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+r.associatedVariableName+`.xyz);\r
`),e.compilationString+=`lightingInfo info;\r
`,e.compilationString+=`float shadow = 1.;\r
`,e.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+`;\r
`,e.compilationString+=`vec3 diffuseBase = vec3(0., 0., 0.);\r
`,e.compilationString+=`vec3 specularBase = vec3(0., 0., 0.);\r
`,e.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+`.xyz;\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",n,{repeatKey:"maxSimultaneousLights"});var o=this.diffuseOutput,l=this.specularOutput;return e.compilationString+=this._declareOutput(o,e)+" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+`;\r
`,l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+`;\r
`),this.shadow.hasEndpoints&&(e.compilationString+=this._declareOutput(this.shadow,e)+` = shadow;\r
`),this}this._injectVertexCode(e)},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId))},t}(vt);M.a.RegisteredTypes["BABYLON.LightBlock"]=Y0;var K0=function(i){function t(e,n){n===void 0&&(n=!1);var r=i.call(this,e,n?Re.Fragment:Re.VertexAndFragment)||this;return r.convertToGammaSpace=!1,r.convertToLinearSpace=!1,r._fragmentOnly=n,r.registerInput("uv",ue.Vector2,!1,Re.VertexAndFragment),r.registerOutput("rgba",ue.Color4,Re.Neutral),r.registerOutput("rgb",ue.Color3,Re.Neutral),r.registerOutput("r",ue.Float,Re.Neutral),r.registerOutput("g",ue.Float,Re.Neutral),r.registerOutput("b",ue.Float,Re.Neutral),r.registerOutput("a",ue.Float,Re.Neutral),r._inputs[0].acceptedConnectionPointTypes.push(ue.Vector3),r._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),r._inputs[0]._prioritizeVertex=!n,r}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){if(this._fragmentOnly)return Re.Fragment;if(!this.uv.isConnected||this.uv.sourceBlock.isInput)return Re.VertexAndFragment;for(var e=this.uv.connectedPoint;e;){if(e.target===Re.Fragment)return Re.Fragment;if(e.target===Re.Vertex)return Re.VertexAndFragment;if(e.target===Re.Neutral||e.target===Re.VertexAndFragment){var n=e.ownerBlock;e=null;for(var r=0,o=n.inputs;r<o.length;r++){var l=o[r];if(l.connectedPoint){e=l.connectedPoint;break}}}}return Re.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.uv.isConnected)if(e.mode===yr.PostProcess)(n=e.getBlockByPredicate(function(o){return o.name==="uv"}))&&n.connectTo(this);else{var n,r=e.mode===yr.Particle?"particle_uv":"uv";(n=e.getInputBlockByPredicate(function(o){return o.isAttribute&&o.name===r}))||(n=new It("uv")).setAsAttribute(r),n.output.connectTo(this.uv)}},t.prototype.initializeDefines=function(e,n,r,o){r._areTexturesDirty&&r.setValue(this._mainUVDefineName,!1)},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){if(!this.texture||!this.texture.getTextureMatrix)return r.setValue(this._defineName,!1),void r.setValue(this._mainUVDefineName,!0);r.setValue(this._linearDefineName,this.convertToGammaSpace),r.setValue(this._gammaDefineName,this.convertToLinearSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(r.setValue(this._defineName,!1),r.setValue(this._mainUVDefineName,!0)):r.setValue(this._defineName,!0))}},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){this.texture&&(this._isMixed&&(e.setFloat(this._textureInfoName,this.texture.level),e.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),e.setTexture(this._samplerName,this.texture))},Object.defineProperty(t.prototype,"_isMixed",{get:function(){return this.target!==Re.Fragment},enumerable:!1,configurable:!0}),t.prototype._injectVertexCode=function(e){var n=this.uv;if(this._defineName=e._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+n.associatedVariableName.toUpperCase(),n.connectedPoint.ownerBlock.isInput&&(n.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(n.associatedVariableName,"vec2")),this._mainUVName="vMain"+n.associatedVariableName,this._transformedUVName=e._getFreeVariableName("transformedUV"),this._textureTransformName=e._getFreeVariableName("textureTransform"),this._textureInfoName=e._getFreeVariableName("textureInfoName"),e._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),e._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),e._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+n.associatedVariableName+`.xy, 1.0, 0.0));\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+=this._mainUVName+" = "+n.associatedVariableName+`.xy;\r
`,e.compilationString+=`#endif\r
`,this._outputs.some(function(h){return h.isConnectedInVertexShader})){this._writeTextureRead(e,!0);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name,!0)}}},t.prototype._writeTextureRead=function(e,n){n===void 0&&(n=!1);var r=this.uv;if(n){if(e.target===Re.Fragment)return;e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`}else this.uv.ownerBlock.target!==Re.Fragment?(e.compilationString+="#ifdef "+this._defineName+`\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+`);\r
`,e.compilationString+="#elif defined("+this._mainUVDefineName+`)\r
`,e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+`);\r
`,e.compilationString+=`#endif\r
`):e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+r.associatedVariableName+`);\r
`},t.prototype._writeOutput=function(e,n,r,o){if(o===void 0&&(o=!1),o){if(e.target===Re.Fragment)return;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`}else if(this.uv.ownerBlock.target!==Re.Fragment){var l=" * "+this._textureInfoName;e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+l+`;\r
`,r!=="a"&&(e.compilationString+="#ifdef "+this._linearDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toGammaSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`,e.compilationString+="#ifdef "+this._gammaDefineName+`\r
`,e.compilationString+=n.associatedVariableName+" = toLinearSpace("+n.associatedVariableName+`);\r
`,e.compilationString+=`#endif\r
`)}else e.compilationString+=this._declareOutput(n,e)+" = "+this._tempTextureRead+"."+r+`;\r
`},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),(e.target===Re.Vertex||this._fragmentOnly)&&(this._tempTextureRead=e._getFreeVariableName("tempTextureRead")),(!this._isMixed&&e.target===Re.Fragment||this._isMixed&&e.target===Re.Vertex)&&(this._samplerName=e._getFreeVariableName(this.name+"Sampler"),e._emit2DSampler(this._samplerName),e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this)),e.target===Re.Fragment){if(this._outputs.some(function(h){return h.isConnectedInFragmentShader})){this._isMixed&&e._emit2DSampler(this._samplerName),this._linearDefineName=e._getFreeDefineName("ISLINEAR"),this._gammaDefineName=e._getFreeDefineName("ISGAMMA");var n="//"+this.name;e._emitFunctionFromInclude("helperFunctions",n),this._isMixed&&e._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(e);for(var r=0,o=this._outputs;r<o.length;r++){var l=o[r];l.hasEndpoints&&this._writeOutput(e,l,l.name)}return this}}else this._injectVertexCode(e)},t.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var e=this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`", null);\r
`;return e+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+`;\r
`,e+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+`;\r
`,e+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+`;\r
`,e+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+`;\r
`,e+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+`;\r
`,e+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+`;\r
`,e+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+`;\r
`,e+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+`;\r
`,e+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+`;\r
`,e+=this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+`;\r
`,e+=this._codeVariableName+".convertToLinearSpace = "+this.convertToLinearSpace+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.convertToGammaSpace=this.convertToGammaSpace,e.convertToLinearSpace=this.convertToLinearSpace,e.fragmentOnly=this._fragmentOnly,this.texture&&!this.texture.isRenderTarget&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.convertToGammaSpace=e.convertToGammaSpace,this.convertToLinearSpace=!!e.convertToLinearSpace,this._fragmentOnly=!!e.fragmentOnly,e.texture&&!Ph.IgnoreTexturesAtLoadTime&&(r=e.texture.url.indexOf("data:")===0?"":r,this.texture=Ve.a.Parse(e.texture,n,r))},t}(vt);M.a.RegisteredTypes["BABYLON.TextureBlock"]=K0;var bm=function(i){function t(e){return i.call(this,e,Re.VertexAndFragment)||this}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBaseBlock"},t.prototype._getTexture=function(){return this.texture},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var n=e.getInputBlockByPredicate(function(l){return l.isAttribute&&l.name==="position"});n||(n=new It("position")).setAsAttribute(),n.output.connectTo(this.position)}if(!this.world.isConnected){var r=e.getInputBlockByPredicate(function(l){return l.systemValue===Pt.World});r||(r=new It("world")).setAsSystemValue(Pt.World),r.output.connectTo(this.world)}if(this.view&&!this.view.isConnected){var o=e.getInputBlockByPredicate(function(l){return l.systemValue===Pt.View});o||(o=new It("view")).setAsSystemValue(Pt.View),o.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){if(r._areTexturesDirty){var o=this._getTexture();o&&o.getTextureMatrix&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLocalCubicName,!!o.boundingBoxSize,!0),r.setValue(this._defineExplicitName,o.coordinatesMode===g.a.TEXTURE_EXPLICIT_MODE,!0),r.setValue(this._defineSkyboxName,o.coordinatesMode===g.a.TEXTURE_SKYBOX_MODE,!0),r.setValue(this._defineCubicName,o.coordinatesMode===g.a.TEXTURE_CUBIC_MODE||o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue("INVERTCUBICMAP",o.coordinatesMode===g.a.TEXTURE_INVCUBIC_MODE,!0),r.setValue(this._defineSphericalName,o.coordinatesMode===g.a.TEXTURE_SPHERICAL_MODE,!0),r.setValue(this._definePlanarName,o.coordinatesMode===g.a.TEXTURE_PLANAR_MODE,!0),r.setValue(this._defineProjectionName,o.coordinatesMode===g.a.TEXTURE_PROJECTION_MODE,!0),r.setValue(this._defineEquirectangularName,o.coordinatesMode===g.a.TEXTURE_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,!0),r.setValue(this._defineMirroredEquirectangularFixedName,o.coordinatesMode===g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,!0))}},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r){var o=this._getTexture();r&&o&&(e.setMatrix(this._reflectionMatrixName,o.getReflectionTextureMatrix()),o.isCube?e.setTexture(this._cubeSamplerName,o):e.setTexture(this._2DSamplerName,o))},t.prototype.handleVertexSide=function(e){this._define3DName=e._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=e._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=e._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=e._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=e._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=e._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=e._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=e._getFreeDefineName("REFLECTIONMAP_SKYBOX"),this._defineOppositeZ=e._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ"),this._reflectionMatrixName=e._getFreeVariableName("reflectionMatrix"),e._emitUniformFromString(this._reflectionMatrixName,"mat4");var n="",r="v_"+this.worldPosition.associatedVariableName;return e._emitVaryingFromString(r,"vec4")&&(n+=r+" = "+this.worldPosition.associatedVariableName+`;\r
`),this._positionUVWName=e._getFreeVariableName("positionUVW"),this._directionWName=e._getFreeVariableName("directionW"),e._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(n+="#ifdef "+this._defineSkyboxName+`\r
`,n+=this._positionUVWName+" = "+this.position.associatedVariableName+`.xyz;\r
`,n+=`#endif\r
`),e._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")")&&(n+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+`)\r
`,n+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+`.xyz, 0.0)));\r
`,n+=`#endif\r
`),n},t.prototype.handleFragmentSideInits=function(e){e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);var n="//"+this.name;e._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),e._emitFunctionFromInclude("reflectionFunction",n,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]}),this._reflectionColorName=e._getFreeVariableName("reflectionColor"),this._reflectionVectorName=e._getFreeVariableName("reflectionUVW"),this._reflectionCoordsName=e._getFreeVariableName("reflectionCoords")},t.prototype.handleFragmentSideCodeReflectionCoords=function(e,n,r){r===void 0&&(r=!1),n||(n="v_"+this.worldPosition.associatedVariableName);var o=this._reflectionMatrixName,l="normalize("+this._directionWName+")",h=""+this._positionUVWName,v=""+this.cameraPosition.associatedVariableName,b=""+this.view.associatedVariableName;e+=".xyz";var A=`
            #ifdef `+this._defineMirroredEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeMirroredFixedEquirectangularCoords("+n+", "+e+", "+l+`);
            #endif

            #ifdef `+this._defineEquirectangularFixedName+`
                vec3 `+this._reflectionVectorName+" = computeFixedEquirectangularCoords("+n+", "+e+", "+l+`);
            #endif

            #ifdef `+this._defineEquirectangularName+`
                vec3 `+this._reflectionVectorName+" = computeEquirectangularCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineSphericalName+`
                vec3 `+this._reflectionVectorName+" = computeSphericalCoords("+n+", "+e+", "+b+", "+o+`);
            #endif

            #ifdef `+this._definePlanarName+`
                vec3 `+this._reflectionVectorName+" = computePlanarCoords("+n+", "+e+", "+v+".xyz, "+o+`);
            #endif

            #ifdef `+this._defineCubicName+`
                #ifdef `+this._defineLocalCubicName+`
                    vec3 `+this._reflectionVectorName+" = computeCubicLocalCoords("+n+", "+e+", "+v+".xyz, "+o+`, vReflectionSize, vReflectionPosition);
                #else
                vec3 `+this._reflectionVectorName+" = computeCubicCoords("+n+", "+e+", "+v+".xyz, "+o+`);
                #endif
            #endif

            #ifdef `+this._defineProjectionName+`
                vec3 `+this._reflectionVectorName+" = computeProjectionCoords("+n+", "+b+", "+o+`);
            #endif

            #ifdef `+this._defineSkyboxName+`
                vec3 `+this._reflectionVectorName+" = computeSkyBoxCoords("+h+", "+o+`);
            #endif

            #ifdef `+this._defineExplicitName+`
                vec3 `+this._reflectionVectorName+` = vec3(0, 0, 0);
            #endif

            #ifdef `+this._defineOppositeZ+`
                `+this._reflectionVectorName+`.z *= -1.0;
            #endif\r
`;return r||(A+=`
                #ifdef `+this._define3DName+`
                    vec3 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`;
                #else
                    vec2 `+this._reflectionCoordsName+" = "+this._reflectionVectorName+`.xy;
                    #ifdef `+this._defineProjectionName+`
                        `+this._reflectionCoordsName+" /= "+this._reflectionVectorName+`.z;
                    #endif
                    `+this._reflectionCoordsName+".y = 1.0 - "+this._reflectionCoordsName+`.y;
                #endif\r
`),A},t.prototype.handleFragmentSideCodeReflectionColor=function(e,n){n===void 0&&(n=".rgb");var r="vec"+(n.length===0?"4":n.length-1)+" "+this._reflectionColorName+`;
            #ifdef `+this._define3DName+`\r
`;return r+=e?this._reflectionColorName+" = textureCubeLodEXT("+this._cubeSamplerName+", "+this._reflectionVectorName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionVectorName+")"+n+`;\r
`,r+=`
            #else\r
`,r+=e?this._reflectionColorName+" = texture2DLodEXT("+this._2DSamplerName+", "+this._reflectionCoordsName+", "+e+")"+n+`;\r
`:this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflectionCoordsName+")"+n+`;\r
`,r+=`#endif\r
`},t.prototype.writeOutputs=function(e,n){var r="";if(e.target===Re.Fragment)for(var o=0,l=this._outputs;o<l.length;o++){var h=l[o];h.hasEndpoints&&(r+=this._declareOutput(h,e)+" = "+n+"."+h.name+`;\r
`)}return r},t.prototype._buildBlock=function(e){return i.prototype._buildBlock.call(this,e),this},t.prototype._dumpPropertiesCode=function(){return this.texture?(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`):"";var e},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=di.Parse(e.texture,n,r):this.texture=Ve.a.Parse(e.texture,n,r))},t}(vt);M.a.RegisteredTypes["BABYLON.ReflectionTextureBaseBlock"]=bm;var Q0=function(i){function t(e){var n=i.call(this,e)||this;return n.registerInput("position",ue.Vector3,!1,Re.Vertex),n.registerInput("worldPosition",ue.Vector4,!1,Re.Vertex),n.registerInput("worldNormal",ue.Vector4,!1,Re.Fragment),n.registerInput("world",ue.Matrix,!1,Re.Vertex),n.registerInput("cameraPosition",ue.Vector3,!1,Re.Fragment),n.registerInput("view",ue.Matrix,!1,Re.Fragment),n.registerOutput("rgb",ue.Color3,Re.Fragment),n.registerOutput("rgba",ue.Color4,Re.Fragment),n.registerOutput("r",ue.Float,Re.Fragment),n.registerOutput("g",ue.Float,Re.Fragment),n.registerOutput("b",ue.Float,Re.Fragment),n.registerOutput("a",ue.Float,Re.Fragment),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(i.prototype.autoConfigure.call(this,e),!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Pt.CameraPosition});n||(n=new It("cameraPosition")).setAsSystemValue(Pt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),!this.texture)return e.compilationString+=this.writeOutputs(e,"vec3(0.)"),this;if(e.target!==Re.Fragment)return e.compilationString+=this.handleVertexSide(e),this;this.handleFragmentSideInits(e);var n=e._getFreeVariableName("normalWUnit");return e.compilationString+="vec4 "+n+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e.compilationString+=this.handleFragmentSideCodeReflectionCoords(n),e.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,""),e.compilationString+=this.writeOutputs(e,this._reflectionColorName),this},t}(bm);M.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=Q0;var q0=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" + "+this.right.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.AddBlock"]=q0;var Z0=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("input",ue.AutoDetect),n.registerInput("factor",ue.Float),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" * "+this.factor.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ScaleBlock"]=Z0;var $0=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.minimum=0,n.maximum=1,n.registerInput("value",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = clamp("+this.value.associatedVariableName+", "+this._writeFloat(this.minimum)+", "+this._writeFloat(this.maximum)+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName+".minimum = "+this.minimum+`;\r
`;return e+=this._codeVariableName+".maximum = "+this.maximum+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.minimum=this.minimum,e.maximum=this.maximum,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.minimum=e.minimum,this.maximum=e.maximum},Object(_.c)([$t("Minimum",Wt.Float)],t.prototype,"minimum",void 0),Object(_.c)([$t("Maximum",Wt.Float)],t.prototype,"maximum",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.ClampBlock"]=$0;var J0=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.Vector3),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[0].excludedConnectionPointTypes.push(ue.Vector2),n._inputs[1].excludedConnectionPointTypes.push(ue.Float),n._inputs[1].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[1].excludedConnectionPointTypes.push(ue.Vector2),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = cross("+this.left.associatedVariableName+".xyz, "+this.right.associatedVariableName+`.xyz);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.CrossBlock"]=J0;var eT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[1].excludedConnectionPointTypes.push(ue.Float),n._inputs[1].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = dot("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.DotBlock"]=eT;var tT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("input",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+r.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.NormalizeBlock"]=tT;var nT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("rgb ",ue.Color3,!0),n.registerInput("r",ue.Float,!0),n.registerInput("g",ue.Float,!0),n.registerInput("b",ue.Float,!0),n.registerInput("a",ue.Float,!0),n.registerOutput("rgba",ue.Color4),n.registerOutput("rgb",ue.Color3),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.r,r=this.g,o=this.b,l=this.a,h=this.rgbIn,v=this._outputs[0],b=this._outputs[1];return h.isConnected?v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+h.associatedVariableName+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:b.hasEndpoints&&(e.compilationString+=this._declareOutput(b,e)+" = "+h.associatedVariableName+`;\r
`):v.hasEndpoints?e.compilationString+=this._declareOutput(v,e)+" = vec4("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+", "+(l.isConnected?this._writeVariable(l):"0.0")+`);\r
`:b.hasEndpoints&&(e.compilationString+=this._declareOutput(b,e)+" = vec3("+(n.isConnected?this._writeVariable(n):"0.0")+", "+(r.isConnected?this._writeVariable(r):"0.0")+", "+(o.isConnected?this._writeVariable(o):"0.0")+`);\r
`),this},t}(vt);M.a.RegisteredTypes["BABYLON.ColorMergerBlock"]=nT;var rT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("xyzw",ue.Vector4,!0),n.registerInput("xyz ",ue.Vector3,!0),n.registerInput("xy ",ue.Vector2,!0),n.registerOutput("xyz",ue.Vector3),n.registerOutput("xy",ue.Vector2),n.registerOutput("x",ue.Float),n.registerOutput("y",ue.Float),n.registerOutput("z",ue.Float),n.registerOutput("w",ue.Float),n.inputsAreExclusive=!0,n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}},t.prototype._outputRename=function(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,r=this._outputs[0],o=this._outputs[1],l=this._outputs[2],h=this._outputs[3],v=this._outputs[4],b=this._outputs[5];return r.hasEndpoints&&(n===this.xyIn?e.compilationString+=this._declareOutput(r,e)+" = vec3("+n.associatedVariableName+`, 0.0);\r
`:e.compilationString+=this._declareOutput(r,e)+" = "+n.associatedVariableName+`.xyz;\r
`),o.hasEndpoints&&(e.compilationString+=this._declareOutput(o,e)+" = "+n.associatedVariableName+`.xy;\r
`),l.hasEndpoints&&(e.compilationString+=this._declareOutput(l,e)+" = "+n.associatedVariableName+`.x;\r
`),h.hasEndpoints&&(e.compilationString+=this._declareOutput(h,e)+" = "+n.associatedVariableName+`.y;\r
`),v.hasEndpoints&&(e.compilationString+=this._declareOutput(v,e)+" = "+n.associatedVariableName+`.z;\r
`),b.hasEndpoints&&(e.compilationString+=this._declareOutput(b,e)+" = "+n.associatedVariableName+`.w;\r
`),this},t}(vt);M.a.RegisteredTypes["BABYLON.VectorSplitterBlock"]=rT;var iT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerInput("gradient",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.LerpBlock"]=iT;var oT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" / "+this.right.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.DivideBlock"]=oT;var aT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = "+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.SubtractBlock"]=aT;var sT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.Float),n.registerInput("edge",ue.Float),n.registerOutput("output",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = step("+this.edge.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.StepBlock"]=sT;var ym=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("input",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. - "+this.input.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.OneMinusBlock"]=ym,M.a.RegisteredTypes["BABYLON.OppositeBlock"]=ym;var Tm=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("worldPosition",ue.Vector4),n.registerInput("cameraPosition",ue.Vector3),n.registerOutput("output",ue.Vector3),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(r){return r.systemValue===Pt.CameraPosition});n||(n=new It("cameraPosition")).setAsSystemValue(Pt.CameraPosition),n.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize("+this.cameraPosition.associatedVariableName+" - "+this.worldPosition.associatedVariableName+`.xyz);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ViewDirectionBlock"]=Tm,c(161);var cT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("worldNormal",ue.Vector4),n.registerInput("viewDirection",ue.Vector3),n.registerInput("bias",ue.Float),n.registerInput("power",ue.Float),n.registerOutput("fresnel",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.viewDirection.isConnected){var n=new Tm("View direction");n.output.connectTo(this.viewDirection),n.autoConfigure(e)}if(!this.bias.isConnected){var r=new It("bias");r.value=0,r.output.connectTo(this.bias)}if(!this.power.isConnected){var o=new It("power");o.value=1,o.output.connectTo(this.power)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n="//"+this.name;return e._emitFunctionFromInclude("fresnelFunction",n,{removeIfDef:!0}),e.compilationString+=this._declareOutput(this.fresnel,e)+" = computeFresnelTerm("+this.viewDirection.associatedVariableName+".xyz, "+this.worldNormal.associatedVariableName+".xyz, "+this.bias.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.FresnelBlock"]=cT;var lT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = max("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.MaxBlock"]=lT;var uT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = min("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.MinBlock"]=uT;var hT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[1].excludedConnectionPointTypes.push(ue.Float),n._inputs[1].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.left.associatedVariableName+" - "+this.right.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.DistanceBlock"]=hT;var dT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerOutput("output",ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = length("+this.value.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.LengthBlock"]=dT;var fT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = -1.0 * "+this.value.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.NegateBlock"]=fT;var pT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerInput("power",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = pow("+this.value.associatedVariableName+", "+this.power.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.PowBlock"]=pT;var mT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("seed",ue.Vector2),n.registerOutput("output",ue.Float),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r="//"+this.name;return e._emitFunctionFromInclude("helperFunctions",r),e.compilationString+=this._declareOutput(n,e)+" = getRand("+this.seed.associatedVariableName+`.xy);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.RandomNumberBlock"]=mT;var _T=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("x",ue.Float),n.registerInput("y",ue.Float),n.registerOutput("output",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = atan("+this.x.associatedVariableName+", "+this.y.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ArcTan2Block"]=_T;var gT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerInput("edge0",ue.Float),n.registerInput("edge1",ue.Float),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = smoothstep("+this.edge0.associatedVariableName+", "+this.edge1.associatedVariableName+", "+this.value.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.SmoothStepBlock"]=gT;var vT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("input",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = 1. / "+this.input.associatedVariableName+`;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ReciprocalBlock"]=vT;var bT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerInput("reference",ue.AutoDetect),n.registerInput("distance",ue.Float),n.registerInput("replacement",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(0,3),n._inputs[0].excludedConnectionPointTypes.push(ue.Float),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[1].excludedConnectionPointTypes.push(ue.Float),n._inputs[1].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[3].excludedConnectionPointTypes.push(ue.Float),n._inputs[3].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+="if (length("+this.value.associatedVariableName+" - "+this.reference.associatedVariableName+") < "+this.distance.associatedVariableName+`) {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.replacement.associatedVariableName+`;\r
`,e.compilationString+=`} else {\r
`,e.compilationString+=n.associatedVariableName+" = "+this.value.associatedVariableName+`;\r
`,e.compilationString+=`}\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ReplaceColorBlock"]=bT;var Ca,yT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("value",ue.AutoDetect),n.registerInput("steps",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n._inputs[1].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = floor("+this.value.associatedVariableName+" / (1.0 / "+this.steps.associatedVariableName+")) * (1.0 / "+this.steps.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.PosterizeBlock"]=yT,function(i){i[i.SawTooth=0]="SawTooth",i[i.Square=1]="Square",i[i.Triangle=2]="Triangle"}(Ca||(Ca={}));var TT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.kind=Ca.SawTooth,n.registerInput("input",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(ue.Matrix),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];switch(this.kind){case Ca.SawTooth:e.compilationString+=this._declareOutput(n,e)+" = "+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`);\r
`;break;case Ca.Square:e.compilationString+=this._declareOutput(n,e)+" = 1.0 - 2.0 * round(fract("+this.input.associatedVariableName+`));\r
`;break;case Ca.Triangle:e.compilationString+=this._declareOutput(n,e)+" = 2.0 * abs(2.0 * ("+this.input.associatedVariableName+" - floor(0.5 + "+this.input.associatedVariableName+`))) - 1.0;\r
`}return this},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.kind=this.kind,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.kind=e.kind},t}(vt);M.a.RegisteredTypes["BABYLON.WaveBlock"]=TT;var Ah=function(){function i(t,e){this.step=t,this.color=e}return Object.defineProperty(i.prototype,"step",{get:function(){return this._step},set:function(t){this._step=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!1,configurable:!0}),i}(),ET=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.colorSteps=[new Ah(0,x.a.Black()),new Ah(1,x.a.White())],n.onValueChangedObservable=new E.c,n.registerInput("gradient",ue.Float),n.registerOutput("output",ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector2),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color4),n}return Object(_.d)(t,i),t.prototype.colorStepsUpdated=function(){this.onValueChangedObservable.notifyObservers(this)},t.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._writeColorConstant=function(e){var n=this.colorSteps[e];return"vec3("+n.color.r+", "+n.color.g+", "+n.color.b+")"},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var r=e._getFreeVariableName("gradientTempColor"),o=e._getFreeVariableName("gradientTempPosition");e.compilationString+="vec3 "+r+" = "+this._writeColorConstant(0)+`;\r
`,e.compilationString+="float "+o+`;\r
`;var l=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==ue.Float&&(l+=".x");for(var h=1;h<this.colorSteps.length;h++){var v=this.colorSteps[h],b=this.colorSteps[h-1];e.compilationString+=o+" = clamp(("+l+" - "+e._emitFloat(b.step)+") / ("+e._emitFloat(v.step)+" -  "+e._emitFloat(b.step)+"), 0.0, 1.0) * step("+e._emitFloat(h)+", "+e._emitFloat(this.colorSteps.length-1)+`);\r
`,e.compilationString+=r+" = mix("+r+", "+this._writeColorConstant(h)+", "+o+`);\r
`}return e.compilationString+=this._declareOutput(n,e)+" = "+r+`;\r
`,this}e.compilationString+=this._declareOutput(n,e)+` = vec3(0., 0., 0.);\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);e.colorSteps=[];for(var n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e.colorSteps.push({step:o.step,color:{r:o.color.r,g:o.color.g,b:o.color.b}})}return e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.colorSteps=[];for(var o=0,l=e.colorSteps;o<l.length;o++){var h=l[o];this.colorSteps.push(new Ah(h.step,new x.a(h.color.r,h.color.g,h.color.b)))}},t.prototype._dumpPropertiesCode=function(){for(var e="",n=0,r=this.colorSteps;n<r.length;n++){var o=r[n];e+=this._codeVariableName+".colorSteps.push(new BABYLON.GradientBlockColorStep("+o.step+", new BABYLON.Color3("+o.color.r+", "+o.color.g+", "+o.color.b+`)));\r
`}return e},t}(vt);M.a.RegisteredTypes["BABYLON.GradientBlock"]=ET;var ST=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerInput("gradient",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = normalize(mix("+this.left.associatedVariableName+" , "+this.right.associatedVariableName+", "+this.gradient.associatedVariableName+`));\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.NLerpBlock"]=ST;var xT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.manhattanDistance=!1,n.registerInput("seed",ue.Vector3),n.registerInput("jitter",ue.Float),n.registerOutput("output",ue.Vector2),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("worley3D",`vec3 permute(vec3 x){\r
    return mod((34.0 * x + 1.0) * x, 289.0);\r
}\r
\r
vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r
    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r
}\r
\r
vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r
    float K = 0.142857142857; // 1/7\r
    float Ko = 0.428571428571; // 1/2-K/2\r
    float  K2 = 0.020408163265306; // 1/(7*7)\r
    float Kz = 0.166666666667; // 1/6\r
    float Kzo = 0.416666666667; // 1/2-1/6*2\r
\r
    vec3 Pi = mod(floor(P), 289.0);\r
    vec3 Pf = fract(P) - 0.5;\r
\r
    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r
    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r
\r
    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r
    vec3 p1 = permute(p + Pi.y - 1.0);\r
    vec3 p2 = permute(p + Pi.y);\r
    vec3 p3 = permute(p + Pi.y + 1.0);\r
\r
    vec3 p11 = permute(p1 + Pi.z - 1.0);\r
    vec3 p12 = permute(p1 + Pi.z);\r
    vec3 p13 = permute(p1 + Pi.z + 1.0);\r
\r
    vec3 p21 = permute(p2 + Pi.z - 1.0);\r
    vec3 p22 = permute(p2 + Pi.z);\r
    vec3 p23 = permute(p2 + Pi.z + 1.0);\r
\r
    vec3 p31 = permute(p3 + Pi.z - 1.0);\r
    vec3 p32 = permute(p3 + Pi.z);\r
    vec3 p33 = permute(p3 + Pi.z + 1.0);\r
\r
    vec3 ox11 = fract(p11*K) - Ko;\r
    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r
    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r
\r
    vec3 ox12 = fract(p12*K) - Ko;\r
    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r
    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r
\r
    vec3 ox13 = fract(p13*K) - Ko;\r
    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r
    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r
\r
    vec3 ox21 = fract(p21*K) - Ko;\r
    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r
    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r
\r
    vec3 ox22 = fract(p22*K) - Ko;\r
    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r
    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r
\r
    vec3 ox23 = fract(p23*K) - Ko;\r
    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r
    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r
\r
    vec3 ox31 = fract(p31*K) - Ko;\r
    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r
    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r
\r
    vec3 ox32 = fract(p32*K) - Ko;\r
    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r
    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r
\r
    vec3 ox33 = fract(p33*K) - Ko;\r
    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r
    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r
\r
    vec3 dx11 = Pfx + jitter*ox11;\r
    vec3 dy11 = Pfy.x + jitter*oy11;\r
    vec3 dz11 = Pfz.x + jitter*oz11;\r
\r
    vec3 dx12 = Pfx + jitter*ox12;\r
    vec3 dy12 = Pfy.x + jitter*oy12;\r
    vec3 dz12 = Pfz.y + jitter*oz12;\r
\r
    vec3 dx13 = Pfx + jitter*ox13;\r
    vec3 dy13 = Pfy.x + jitter*oy13;\r
    vec3 dz13 = Pfz.z + jitter*oz13;\r
\r
    vec3 dx21 = Pfx + jitter*ox21;\r
    vec3 dy21 = Pfy.y + jitter*oy21;\r
    vec3 dz21 = Pfz.x + jitter*oz21;\r
\r
    vec3 dx22 = Pfx + jitter*ox22;\r
    vec3 dy22 = Pfy.y + jitter*oy22;\r
    vec3 dz22 = Pfz.y + jitter*oz22;\r
\r
    vec3 dx23 = Pfx + jitter*ox23;\r
    vec3 dy23 = Pfy.y + jitter*oy23;\r
    vec3 dz23 = Pfz.z + jitter*oz23;\r
\r
    vec3 dx31 = Pfx + jitter*ox31;\r
    vec3 dy31 = Pfy.z + jitter*oy31;\r
    vec3 dz31 = Pfz.x + jitter*oz31;\r
\r
    vec3 dx32 = Pfx + jitter*ox32;\r
    vec3 dy32 = Pfy.z + jitter*oy32;\r
    vec3 dz32 = Pfz.y + jitter*oz32;\r
\r
    vec3 dx33 = Pfx + jitter*ox33;\r
    vec3 dy33 = Pfy.z + jitter*oy33;\r
    vec3 dz33 = Pfz.z + jitter*oz33;\r
\r
    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r
    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r
    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r
    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r
    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r
    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r
    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r
    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r
    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r
\r
    vec3 d1a = min(d11, d12);\r
    d12 = max(d11, d12);\r
    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r
    d13 = max(d1a, d13);\r
    d12 = min(d12, d13); // 2nd smallest now not in d13\r
    vec3 d2a = min(d21, d22);\r
    d22 = max(d21, d22);\r
    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r
    d23 = max(d2a, d23);\r
    d22 = min(d22, d23); // 2nd smallest now not in d23\r
    vec3 d3a = min(d31, d32);\r
    d32 = max(d31, d32);\r
    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r
    d33 = max(d3a, d33);\r
    d32 = min(d32, d33); // 2nd smallest now not in d33\r
    vec3 da = min(d11, d21);\r
    d21 = max(d11, d21);\r
    d11 = min(da, d31); // Smallest now in d11\r
    d31 = max(da, d31); // 2nd smallest now not in d31\r
    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r
    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r
    d12 = min(d12, d21); // 2nd smallest now not in d21\r
    d12 = min(d12, d22); // nor in d22\r
    d12 = min(d12, d31); // nor in d31\r
    d12 = min(d12, d32); // nor in d32\r
    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r
    d11.y = min(d11.y,d12.z); // Only two more to go\r
    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r
    return sqrt(d11.xy); // F1, F2\r
}\r
\r
`,"// Worley3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = worley("+this.seed.associatedVariableName+", "+this.jitter.associatedVariableName+", "+this.manhattanDistance+`);\r
`,this},t.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".manhattanDistance = "+this.manhattanDistance+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.manhattanDistance=this.manhattanDistance,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.manhattanDistance=e.manhattanDistance},Object(_.c)([$t("Use Manhattan Distance",Wt.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"manhattanDistance",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.WorleyNoise3DBlock"]=xT;var PT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("seed",ue.Vector3),n.registerOutput("output",ue.Float),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){if(i.prototype._buildBlock.call(this,e),this.seed.isConnected&&this._outputs[0].hasEndpoints)return e._emitFunction("SimplexPerlin3D",`const float SKEWFACTOR = 1.0/3.0;\r
const float UNSKEWFACTOR = 1.0/6.0;\r
const float SIMPLEX_CORNER_POS = 0.5;\r
const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r
float SimplexPerlin3D( vec3 P ){\r
    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r
    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r
    vec3 g = step(x0.yzx, x0.xyz);\r
    vec3 l = 1.0 - g;\r
    vec3 Pi_1 = min( g.xyz, l.zxy );\r
    vec3 Pi_2 = max( g.xyz, l.zxy );\r
    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r
    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r
    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r
    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r
    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r
    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r
    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r
    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r
    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r
    Pt *= Pt;\r
    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r
    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r
    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r
    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r
    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r
    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r
    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r
    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r
    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r
    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r
    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r
    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r
    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r
    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r
    kernel_weights = max(0.5 - kernel_weights, 0.0);\r
    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r
    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r
}\r
`,"// SimplexPerlin3D"),e.compilationString+=this._declareOutput(this._outputs[0],e)+" = SimplexPerlin3D("+this.seed.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"]=PT;var AT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("normalMap0",ue.Vector3),n.registerInput("normalMap1",ue.Vector3),n.registerOutput("output",ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Vector4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(t.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this._inputs[0],o=this._inputs[1],l=e._getFreeVariableName("stepR"),h=e._getFreeVariableName("stepG");return e.compilationString+="float "+l+" = step(0.5, "+r.associatedVariableName+`.r);\r
`,e.compilationString+="float "+h+" = step(0.5, "+r.associatedVariableName+`.g);\r
`,e.compilationString+=this._declareOutput(n,e)+`;\r
`,e.compilationString+=n.associatedVariableName+".r = (1.0 - "+l+") * "+r.associatedVariableName+".r * "+o.associatedVariableName+".r * 2.0 + "+l+" * (1.0 - "+r.associatedVariableName+".r) * (1.0 - "+o.associatedVariableName+`.r) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".g = (1.0 - "+h+") * "+r.associatedVariableName+".g * "+o.associatedVariableName+".g * 2.0 + "+h+" * (1.0 - "+r.associatedVariableName+".g) * (1.0 - "+o.associatedVariableName+`.g) * 2.0;\r
`,e.compilationString+=n.associatedVariableName+".b = "+r.associatedVariableName+".b * "+o.associatedVariableName+`.b;\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.NormalBlendBlock"]=AT;var CT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("input",ue.Vector2),n.registerInput("angle",ue.Float),n.registerOutput("output",ue.Vector2),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.angle.isConnected){var n=new It("angle");n.value=0,n.output.connectTo(this.angle)}},t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.angle,o=this.input;return e.compilationString+=this._declareOutput(n,e)+" = vec2(cos("+r.associatedVariableName+") * "+o.associatedVariableName+".x - sin("+r.associatedVariableName+") * "+o.associatedVariableName+".y, sin("+r.associatedVariableName+") * "+o.associatedVariableName+".x + cos("+r.associatedVariableName+") * "+o.associatedVariableName+`.y);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.Rotate2dBlock"]=CT;var RT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("incident",ue.Vector3),n.registerInput("normal",ue.Vector3),n.registerOutput("output",ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = reflect("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+`.xyz);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ReflectBlock"]=RT;var OT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("incident",ue.Vector3),n.registerInput("normal",ue.Vector3),n.registerInput("ior",ue.Float),n.registerOutput("output",ue.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[0].acceptedConnectionPointTypes.push(ue.Color4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color3),n._inputs[1].acceptedConnectionPointTypes.push(ue.Color4),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = refract("+this.incident.associatedVariableName+".xyz, "+this.normal.associatedVariableName+".xyz, "+this.ior.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.RefractBlock"]=OT;var MT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("color",ue.Color3),n.registerInput("level",ue.Float),n.registerOutput("output",ue.Color3),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0],r=this.color.associatedVariableName,o=e._getFreeVariableName("colorMin"),l=e._getFreeVariableName("colorMax"),h=e._getFreeVariableName("colorMerge");return e.compilationString+="float "+o+" = min(min("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+l+" = max(max("+r+".x, "+r+".y), "+r+`.z);\r
`,e.compilationString+="float "+h+" = 0.5 * ("+o+" + "+l+`);\r
`,e.compilationString+=this._declareOutput(n,e)+" = mix("+r+", vec3("+h+", "+h+", "+h+"), "+this.level.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.DesaturateBlock"]=MT;var ti=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,n,r)||this;return v._blockType=o,v._blockName=l,v._nameForCheking=h,v._nameForCheking||(v._nameForCheking=e),v.needDualDirectionValidation=!0,v}return Object(_.d)(t,i),t.prototype.checkCompatibilityState=function(e){return e instanceof t&&e.name===this._nameForCheking?mi.Compatible:mi.TypeIncompatible},t.prototype.createCustomInputBlock=function(){return[new this._blockType(this._blockName),this.name]},t}(yh),Em=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.albedoScaling=!1,n.linkSheenWithAlbedo=!1,n._isUnique=!0,n.registerInput("intensity",ue.Float,!0,Re.Fragment),n.registerInput("color",ue.Color3,!0,Re.Fragment),n.registerInput("roughness",ue.Float,!0,Re.Fragment),n.registerOutput("sheen",ue.Object,Re.Fragment,new ti("sheen",n,or.Output,t,"SheenBlock")),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("sheenOut"),e._excludeVariableName("sheenMapData"),e._excludeVariableName("vSheenColor"),e._excludeVariableName("vSheenRoughness")},t.prototype.getClassName=function(){return"SheenBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("SHEEN",!0),r.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("SHEEN_LINKWITHALBEDO",this.linkSheenWithAlbedo,!0),r.setValue("SHEEN_ROUGHNESS",this.roughness.isConnected,!0),r.setValue("SHEEN_ALBEDOSCALING",this.albedoScaling,!0)},t.prototype.getCode=function(e){return`#ifdef SHEEN
            sheenOutParams sheenOut;

            vec4 vSheenColor = vec4(`+(this.color.isConnected?this.color.associatedVariableName:"vec3(1.)")+", "+(this.intensity.isConnected?this.intensity.associatedVariableName:"1.")+`);

            sheenBlock(
                vSheenColor,
            #ifdef SHEEN_ROUGHNESS
                `+(this.roughness.isConnected?this.roughness.associatedVariableName:"0.")+`,
            #endif
                roughness,
            #ifdef SHEEN_TEXTURE
                vec4(0.),
            #endif
                reflectance,
            #ifdef SHEEN_LINKWITHALBEDO
                baseColor,
                surfaceAlbedo,
            #endif
            #ifdef ENVIRONMENTBRDF
                NdotV,
                environmentBrdf,
            #endif
            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)
                AARoughnessFactors,
                `+(e==null?void 0:e._vReflectionMicrosurfaceInfosName)+`,
                `+(e==null?void 0:e._vReflectionInfosName)+`,
                `+(e==null?void 0:e.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(e==null?void 0:e._define3DName)+`
                    `+(e==null?void 0:e._cubeSamplerName)+`,
                #else
                    `+(e==null?void 0:e._2DSamplerName)+`,
                #endif
                reflectionOut.reflectionCoords,
                NdotVUnclamped,
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(e==null?void 0:e._define3DName)+`
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                        `+(e==null?void 0:e._cubeSamplerName)+`,
                    #else
                        `+(e==null?void 0:e._2DSamplerName)+`,
                        `+(e==null?void 0:e._2DSamplerName)+`,
                    #endif
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+`) && defined(RADIANCEOCCLUSION)
                    seo,
                #endif
                #if !defined(`+(e==null?void 0:e._defineSkyboxName)+") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined("+(e==null?void 0:e._define3DName)+`)
                    eho,
                #endif
            #endif
                sheenOut
            );

            #ifdef SHEEN_LINKWITHALBEDO
                surfaceAlbedo = sheenOut.surfaceAlbedo;
            #endif
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Re.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return e+=this._codeVariableName+".albedoScaling = "+this.albedoScaling+`;\r
`,e+=this._codeVariableName+".linkSheenWithAlbedo = "+this.linkSheenWithAlbedo+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.albedoScaling=this.albedoScaling,e.linkSheenWithAlbedo=this.linkSheenWithAlbedo,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.albedoScaling=e.albedoScaling,this.linkSheenWithAlbedo=e.linkSheenWithAlbedo},Object(_.c)([$t("Albedo scaling",Wt.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"albedoScaling",void 0),Object(_.c)([$t("Link sheen with albedo",Wt.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"linkSheenWithAlbedo",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.SheenBlock"]=Em;var Sm=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._isUnique=!0,n.registerInput("intensity",ue.Float,!0,Re.Fragment),n.registerInput("direction",ue.Vector2,!0,Re.Fragment),n.registerInput("uv",ue.Vector2,!0),n.registerInput("worldTangent",ue.Vector4,!0),n.registerOutput("anisotropy",ue.Object,Re.Fragment,new ti("anisotropy",n,or.Output,t,"AnisotropyBlock")),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("anisotropicOut"),e._excludeVariableName("TBN")},t.prototype.getClassName=function(){return"AnisotropyBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._generateTBNSpace=function(e){var n="",r="//"+this.name,o=this.uv,l=this.worldPositionConnectionPoint,h=this.worldNormalConnectionPoint,v=this.worldTangent;o.isConnected||console.error("You must connect the 'uv' input of the Anisotropy block!"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var b={search:/defined\(TANGENT\)/g,replace:v.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return v.isConnected&&(n+="vec3 tbnNormal = normalize("+h.associatedVariableName+`.xyz);\r
`,n+="vec3 tbnTangent = normalize("+v.associatedVariableName+`.xyz);\r
`,n+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,n+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),n+=`
            #if defined(`+(v.isConnected?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                mat3 TBN = vTBN;
            #else
                mat3 TBN = cotangent_frame(`+h.associatedVariableName+".xyz, v_"+l.associatedVariableName+".xyz, "+(o.isConnected?o.associatedVariableName:"vec2(0.)")+`, vec2(1., 1.));
            #endif\r
`,e._emitFunctionFromInclude("bumpFragmentMainFunctions",r,{replaceStrings:[b]}),n},t.prototype.getCode=function(e,n){n===void 0&&(n=!1);var r="";n&&(r+=this._generateTBNSpace(e));var o=this.intensity.isConnected?this.intensity.associatedVariableName:"1.0";return r+=`anisotropicOutParams anisotropicOut;
            anisotropicBlock(
                vec3(`+(this.direction.isConnected?this.direction.associatedVariableName:"vec2(1., 0.)")+", "+o+`),
            #ifdef ANISOTROPIC_TEXTURE
                vec3(0.),
            #endif
                TBN,
                normalW,
                viewDirectionW,
                anisotropicOut
            );\r
`},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("ANISOTROPIC",!0),r.setValue("ANISOTROPIC_TEXTURE",!1,!0)},t.prototype._buildBlock=function(e){return e.target===Re.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(vt);M.a.RegisteredTypes["BABYLON.AnisotropyBlock"]=Sm;var xm=function(i){function t(e){var n=i.call(this,e)||this;return n.useSphericalHarmonics=!0,n.forceIrradianceInFragment=!1,n._isUnique=!0,n.registerInput("position",ue.Vector3,!1,Re.Vertex),n.registerInput("world",ue.Matrix,!1,Re.Vertex),n.registerInput("color",ue.Color3,!0,Re.Fragment),n.registerOutput("reflection",ue.Object,Re.Fragment,new ti("reflection",n,or.Output,t,"ReflectionBlock")),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ReflectionBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this.worldPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this.worldNormalConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this.cameraPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionColor",{get:function(){return this.color.isConnected?this.color.associatedVariableName:"vec3(1., 1., 1.)"},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),l=o&&o.getTextureMatrix;r.setValue("REFLECTION",l,!0),l&&(r.setValue(this._defineLODReflectionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularReflection,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SPHERICAL_HARMONICS",this.useSphericalHarmonics,!0),r.setValue("GAMMAREFLECTION",o.gammaSpace,!0),r.setValue("RGBDREFLECTION",o.isRGBD,!0),o&&o.coordinatesMode!==Ve.a.SKYBOX_MODE&&o.isCube&&(r.setValue("USESPHERICALFROMREFLECTIONMAP",!0),r.setValue("USEIRRADIANCEMAP",!1),this.forceIrradianceInFragment||this._scene.getEngine().getCaps().maxVaryingVectors<=8?r.setValue("USESPHERICALINVERTEX",!1):r.setValue("USESPHERICALINVERTEX",!0)))},t.prototype.bind=function(e,n,r,o){i.prototype.bind.call(this,e,n,r);var l=this._getTexture();if(l&&o){l.isCube?e.setTexture(this._cubeSamplerName,l):e.setTexture(this._2DSamplerName,l);var h=l.getSize().width;e.setFloat3(this._vReflectionMicrosurfaceInfosName,h,l.lodGenerationScale,l.lodGenerationOffset),e.setFloat2(this._vReflectionFilteringInfoName,h,se.a.Log2(h));var v=o._materialDefines,b=l.sphericalPolynomial;if(v.USESPHERICALFROMREFLECTIONMAP&&b)if(v.SPHERICAL_HARMONICS){var A=b.preScaledHarmonics;e.setVector3("vSphericalL00",A.l00),e.setVector3("vSphericalL1_1",A.l1_1),e.setVector3("vSphericalL10",A.l10),e.setVector3("vSphericalL11",A.l11),e.setVector3("vSphericalL2_2",A.l2_2),e.setVector3("vSphericalL2_1",A.l2_1),e.setVector3("vSphericalL20",A.l20),e.setVector3("vSphericalL21",A.l21),e.setVector3("vSphericalL22",A.l22)}else e.setFloat3("vSphericalX",b.x.x,b.x.y,b.x.z),e.setFloat3("vSphericalY",b.y.x,b.y.y,b.y.z),e.setFloat3("vSphericalZ",b.z.x,b.z.y,b.z.z),e.setFloat3("vSphericalXX_ZZ",b.xx.x-b.zz.x,b.xx.y-b.zz.y,b.xx.z-b.zz.z),e.setFloat3("vSphericalYY_ZZ",b.yy.x-b.zz.x,b.yy.y-b.zz.y,b.yy.z-b.zz.z),e.setFloat3("vSphericalZZ",b.zz.x,b.zz.y,b.zz.z),e.setFloat3("vSphericalXY",b.xy.x,b.xy.y,b.xy.z),e.setFloat3("vSphericalYZ",b.yz.x,b.yz.y,b.yz.z),e.setFloat3("vSphericalZX",b.zx.x,b.zx.y,b.zx.z)}},t.prototype.handleVertexSide=function(e){var n=i.prototype.handleVertexSide.call(this,e);e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});var r=e._getFreeVariableName("reflectionVector");return this._vEnvironmentIrradianceName=e._getFreeVariableName("vEnvironmentIrradiance"),e._emitVaryingFromString(this._vEnvironmentIrradianceName,"vec3","defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)"),e._emitUniformFromString("vSphericalL00","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL1_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL10","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL11","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_2","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL2_1","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL20","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL21","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalL22","vec3","SPHERICAL_HARMONICS"),e._emitUniformFromString("vSphericalX","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXX_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYY_ZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalXY","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalYZ","vec3","SPHERICAL_HARMONICS",!0),e._emitUniformFromString("vSphericalZX","vec3","SPHERICAL_HARMONICS",!0),n+=`#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
                vec3 `+r+" = vec3("+this._reflectionMatrixName+" * vec4(normalize("+this.worldNormal.associatedVariableName+`).xyz, 0)).xyz;
                #ifdef `+this._defineOppositeZ+`
                    `+r+`.z *= -1.0;
                #endif
                `+this._vEnvironmentIrradianceName+" = computeEnvironmentIrradiance("+r+`);
            #endif\r
`},t.prototype.getCode=function(e,n){var r="";this.handleFragmentSideInits(e),e._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]}),e._emitFunction("sampleReflection",`
            #ifdef `+this._define3DName+`
                #define sampleReflection(s, c) textureCube(s, c)
            #else
                #define sampleReflection(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleReflectionLod",`
            #ifdef `+this._define3DName+`
                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name);var o=`
            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {
                `+this.handleFragmentSideCodeReflectionCoords("worldNormal","worldPos",!0)+`
                return `+this._reflectionVectorName+`;
            }\r
`;return e._emitFunction("computeReflectionCoordsPBR",o,"//"+this.name),this._vReflectionMicrosurfaceInfosName=e._getFreeVariableName("vReflectionMicrosurfaceInfos"),e._emitUniformFromString(this._vReflectionMicrosurfaceInfosName,"vec3"),this._vReflectionInfosName=e._getFreeVariableName("vReflectionInfos"),this._vReflectionFilteringInfoName=e._getFreeVariableName("vReflectionFilteringInfo"),e._emitUniformFromString(this._vReflectionFilteringInfoName,"vec2"),r+=`#ifdef REFLECTION
            vec2 `+this._vReflectionInfosName+` = vec2(1., 0.);

            reflectionOutParams reflectionOut;

            reflectionBlock(
                v_`+this.worldPosition.associatedVariableName+`.xyz,
                `+n+`,
                alphaG,
                `+this._vReflectionMicrosurfaceInfosName+`,
                `+this._vReflectionInfosName+`,
                `+this.reflectionColor+`,
            #ifdef ANISOTROPIC
                anisotropicOut,
            #endif
            #if defined(`+this._defineLODReflectionAlpha+") && !defined("+this._defineSkyboxName+`)
                NdotVUnclamped,
            #endif
            #ifdef `+this._defineLinearSpecularReflection+`
                roughness,
            #endif
            #ifdef `+this._define3DName+`
                `+this._cubeSamplerName+`,
            #else
                `+this._2DSamplerName+`,
            #endif
            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)
                `+this._vEnvironmentIrradianceName+`,
            #endif
            #ifdef USESPHERICALFROMREFLECTIONMAP
                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                    `+this._reflectionMatrixName+`,
                #endif
            #endif
            #ifdef USEIRRADIANCEMAP
                irradianceSampler, // ** not handled **
            #endif
            #ifndef LODBASEDMICROSFURACE
                #ifdef `+this._define3DName+`
                    `+this._cubeSamplerName+`,
                    `+this._cubeSamplerName+`,
                #else
                    `+this._2DSamplerName+`,
                    `+this._2DSamplerName+`,
                #endif
            #endif
            #ifdef REALTIME_FILTERING
                `+this._vReflectionFilteringInfoName+`,
            #endif
                reflectionOut
            );
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target!==Re.Fragment&&(this._defineLODReflectionAlpha=e._getFreeDefineName("LODINREFLECTIONALPHA"),this._defineLinearSpecularReflection=e._getFreeDefineName("LINEARSPECULARREFLECTION")),this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e+=this._codeVariableName+".texture.gammaSpace = "+this.texture.gammaSpace+`);\r
`),e+=this._codeVariableName+".useSphericalHarmonics = "+this.useSphericalHarmonics+`;\r
`,e+=this._codeVariableName+".forceIrradianceInFragment = "+this.forceIrradianceInFragment+`;\r
`},t.prototype.serialize=function(){var e,n,r=i.prototype.serialize.call(this);return r.useSphericalHarmonics=this.useSphericalHarmonics,r.forceIrradianceInFragment=this.forceIrradianceInFragment,r.gammaSpace=(n=(e=this.texture)===null||e===void 0?void 0:e.gammaSpace)===null||n===void 0||n,r},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),this.useSphericalHarmonics=e.useSphericalHarmonics,this.forceIrradianceInFragment=e.forceIrradianceInFragment,this.texture&&(this.texture.gammaSpace=e.gammaSpace)},Object(_.c)([$t("Spherical Harmonics",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useSphericalHarmonics",void 0),Object(_.c)([$t("Force irradiance in fragment",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceIrradianceInFragment",void 0),t}(bm);M.a.RegisteredTypes["BABYLON.ReflectionBlock"]=xm;var Ch=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.remapF0OnInterfaceChange=!0,n._isUnique=!0,n.registerInput("intensity",ue.Float,!1,Re.Fragment),n.registerInput("roughness",ue.Float,!0,Re.Fragment),n.registerInput("indexOfRefraction",ue.Float,!0,Re.Fragment),n.registerInput("normalMapColor",ue.Color3,!0,Re.Fragment),n.registerInput("uv",ue.Vector2,!0,Re.Fragment),n.registerInput("tintColor",ue.Color3,!0,Re.Fragment),n.registerInput("tintAtDistance",ue.Float,!0,Re.Fragment),n.registerInput("tintThickness",ue.Float,!0,Re.Fragment),n.registerInput("worldTangent",ue.Vector4,!0),n.registerOutput("clearcoat",ue.Object,Re.Fragment,new ti("clearcoat",n,or.Output,t,"ClearCoatBlock")),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("clearcoatOut"),e._excludeVariableName("vClearCoatParams"),e._excludeVariableName("vClearCoatTintParams"),e._excludeVariableName("vClearCoatRefractionParams"),e._excludeVariableName("vClearCoatTangentSpaceParams")},t.prototype.getClassName=function(){return"ClearCoatBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintThickness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new It("ClearCoat intensity",Re.Fragment,ue.Float);n.value=1,n.output.connectTo(this.intensity)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r),r.setValue("CLEARCOAT",!0),r.setValue("CLEARCOAT_TEXTURE",!1,!0),r.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0),r.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0),r.setValue("CLEARCOAT_DEFAULTIOR",!this.indexOfRefraction.isConnected||this.indexOfRefraction.connectInputBlock.value===_s._DefaultIndexOfRefraction,!0),r.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,!0)},t.prototype.bind=function(e,n,r,o){var l,h;i.prototype.bind.call(this,e,n,r);var v=(h=(l=this.indexOfRefraction.connectInputBlock)===null||l===void 0?void 0:l.value)!==null&&h!==void 0?h:_s._DefaultIndexOfRefraction,b=1-v,A=1+v,D=Math.pow(-b/A,2),N=1/v;e.setFloat4("vClearCoatRefractionParams",D,N,b,A);var j=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null,k=(j==null?void 0:j.perturbedNormal.isConnected)?j.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?1:-1,(k==null?void 0:k.invertY)?1:-1):e.setFloat2("vClearCoatTangentSpaceParams",(k==null?void 0:k.invertX)?-1:1,(k==null?void 0:k.invertY)?-1:1)},t.prototype._generateTBNSpace=function(e,n,r){var o="",l="//"+this.name,h=this.worldTangent;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var v={search:/defined\(TANGENT\)/g,replace:h.isConnected?"defined(TANGENT)":"defined(IGNORE)"};return h.isConnected&&(o+="vec3 tbnNormal = normalize("+r+`.xyz);\r
`,o+="vec3 tbnTangent = normalize("+h.associatedVariableName+`.xyz);\r
`,o+=`vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r
`,o+=`mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r
`),e._emitFunctionFromInclude("bumpFragmentMainFunctions",l,{replaceStrings:[v]}),o},t.GetCode=function(e,n,r,o,l,h,v){var b="",A=(n==null?void 0:n.intensity.isConnected)?n.intensity.associatedVariableName:"1.",D=(n==null?void 0:n.roughness.isConnected)?n.roughness.associatedVariableName:"0.",N=(n==null?void 0:n.normalMapColor.isConnected)?n.normalMapColor.associatedVariableName:"vec3(0.)",j=(n==null?void 0:n.uv.isConnected)?n.uv.associatedVariableName:"vec2(0.)",k=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",H=(n==null?void 0:n.tintThickness.isConnected)?n.tintThickness.associatedVariableName:"1.",J=(n==null?void 0:n.tintAtDistance.isConnected)?n.tintAtDistance.associatedVariableName:"1.";return n&&(e._emitUniformFromString("vClearCoatRefractionParams","vec4"),e._emitUniformFromString("vClearCoatTangentSpaceParams","vec2")),l&&n&&(b+=n._generateTBNSpace(e,o,v),h=n.worldTangent.isConnected),b+=`clearcoatOutParams clearcoatOut;

        #ifdef CLEARCOAT
            vec2 vClearCoatParams = vec2(`+A+", "+D+`);
            vec4 vClearCoatTintParams = vec4(`+k+", "+H+`);

            clearcoatBlock(
                `+o+`.xyz,
                geometricNormalW,
                viewDirectionW,
                vClearCoatParams,
                specularEnvironmentR0,
            #ifdef CLEARCOAT_TEXTURE
                vec2(0.),
            #endif
            #ifdef CLEARCOAT_TINT
                vClearCoatTintParams,
                `+J+`,
                vClearCoatRefractionParams,
                #ifdef CLEARCOAT_TINT_TEXTURE
                    vec4(0.),
                #endif
            #endif
            #ifdef CLEARCOAT_BUMP
                vec2(0., 1.),
                vec4(`+N+`, 0.),
                `+j+`,
                #if defined(`+(h?"TANGENT":"IGNORE")+`) && defined(NORMAL)
                    vTBN,
                #else
                    vClearCoatTangentSpaceParams,
                #endif
                #ifdef OBJECTSPACE_NORMALMAP
                    normalMatrix,
                #endif
            #endif
            #if defined(FORCENORMALFORWARD) && defined(NORMAL)
                faceNormal,
            #endif
            #ifdef REFLECTION
                `+(r==null?void 0:r._vReflectionMicrosurfaceInfosName)+`,
                `+(r==null?void 0:r._vReflectionInfosName)+`,
                `+(r==null?void 0:r.reflectionColor)+`,
                vLightingIntensity,
                #ifdef `+(r==null?void 0:r._define3DName)+`
                    `+(r==null?void 0:r._cubeSamplerName)+`,
                #else
                    `+(r==null?void 0:r._2DSamplerName)+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+(r==null?void 0:r._define3DName)+`
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                        `+(r==null?void 0:r._cubeSamplerName)+`,
                    #else
                        `+(r==null?void 0:r._2DSamplerName)+`,
                        `+(r==null?void 0:r._2DSamplerName)+`,
                    #endif
                #endif
            #endif
            #if defined(ENVIRONMENTBRDF) && !defined(`+(r==null?void 0:r._defineSkyboxName)+`)
                #ifdef RADIANCEOCCLUSION
                    ambientMonochrome,
                #endif
            #endif
                clearcoatOut
            );
        #else
            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;
        #endif\r
`},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target===Re.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this)),this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".remapF0OnInterfaceChange = "+this.remapF0OnInterfaceChange+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange,e},t.prototype._deserialize=function(e,n,r){var o;i.prototype._deserialize.call(this,e,n,r),this.remapF0OnInterfaceChange=(o=e.remapF0OnInterfaceChange)===null||o===void 0||o},Object(_.c)([$t("Remap F0 on interface change",Wt.Boolean,"ADVANCED")],t.prototype,"remapF0OnInterfaceChange",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.ClearCoatBlock"]=Ch;var Pm=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n.linkRefractionWithTransparency=!1,n.invertRefractionY=!1,n._isUnique=!0,n.registerInput("intensity",ue.Float,!1,Re.Fragment),n.registerInput("tintAtDistance",ue.Float,!0,Re.Fragment),n.registerOutput("refraction",ue.Object,Re.Fragment,new ti("refraction",n,or.Output,t,"RefractionBlock")),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"RefractionBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var n=new It("Refraction intensity",Re.Fragment,ue.Float);n.value=1,n.output.connectTo(this.intensity)}if(this.view&&!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Pt.View});r||(r=new It("view")).setAsSystemValue(Pt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this._getTexture(),l=o&&o.getTextureMatrix;r.setValue("SS_REFRACTION",l,!0),l&&(r.setValue(this._define3DName,o.isCube,!0),r.setValue(this._defineLODRefractionAlpha,o.lodLevelInAlpha,!0),r.setValue(this._defineLinearSpecularRefraction,o.linearSpecularLOD,!0),r.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!o.invertZ:o.invertZ,!0),r.setValue("SS_LINKREFRACTIONTOTRANSPARENCY",this.linkRefractionWithTransparency,!0),r.setValue("SS_GAMMAREFRACTION",o.gammaSpace,!0),r.setValue("SS_RGBDREFRACTION",o.isRGBD,!0))},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,n,r,o){var l,h;i.prototype.bind.call(this,e,n,r);var v=this._getTexture();if(v){v.isCube?e.setTexture(this._cubeSamplerName,v):e.setTexture(this._2DSamplerName,v),e.setMatrix(this._refractionMatrixName,v.getReflectionTextureMatrix());var b=1;v.isCube||v.depth&&(b=v.depth);var A=(h=(l=this.indexOfRefractionConnectionPoint.connectInputBlock)===null||l===void 0?void 0:l.value)!==null&&h!==void 0?h:1.5;e.setFloat4(this._vRefractionInfosName,v.level,1/A,b,this.invertRefractionY?-1:1),e.setFloat3(this._vRefractionMicrosurfaceInfosName,v.getSize().width,v.lodGenerationScale,v.lodGenerationOffset);var D=v.getSize().width;e.setFloat2(this._vRefractionFilteringInfoName,D,se.a.Log2(D))}},t.prototype.getCode=function(e){return e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),this._define3DName=e._getFreeDefineName("SS_REFRACTIONMAP_3D"),e._samplerDeclaration+="#ifdef "+this._define3DName+`\r
`,e._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+`;\r
`,e._samplerDeclaration+=`#else\r
`,e._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+`;\r
`,e._samplerDeclaration+=`#endif\r
`,e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._defineLODRefractionAlpha=e._getFreeDefineName("SS_LODINREFRACTIONALPHA"),this._defineLinearSpecularRefraction=e._getFreeDefineName("SS_LINEARSPECULARREFRACTION"),this._defineOppositeZ=e._getFreeDefineName("SS_REFRACTIONMAP_OPPOSITEZ"),this._refractionMatrixName=e._getFreeVariableName("refractionMatrix"),e._emitUniformFromString(this._refractionMatrixName,"mat4"),e._emitFunction("sampleRefraction",`
            #ifdef `+this._define3DName+`
                #define sampleRefraction(s, c) textureCube(s, c)
            #else
                #define sampleRefraction(s, c) texture2D(s, c)
            #endif\r
`,"//"+this.name),e._emitFunction("sampleRefractionLod",`
            #ifdef `+this._define3DName+`
                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)
            #else
                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)
            #endif\r
`,"//"+this.name),this._vRefractionMicrosurfaceInfosName=e._getFreeVariableName("vRefractionMicrosurfaceInfos"),e._emitUniformFromString(this._vRefractionMicrosurfaceInfosName,"vec3"),this._vRefractionInfosName=e._getFreeVariableName("vRefractionInfos"),e._emitUniformFromString(this._vRefractionInfosName,"vec4"),this._vRefractionFilteringInfoName=e._getFreeVariableName("vRefractionFilteringInfo"),e._emitUniformFromString(this._vRefractionFilteringInfoName,"vec2"),""},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,this},t.prototype._dumpPropertiesCode=function(){var e=i.prototype._dumpPropertiesCode.call(this);return this.texture&&(e=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+`");\r
`:this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+`");\r
`,e+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+`;\r
`),e+=this._codeVariableName+".linkRefractionWithTransparency = "+this.linkRefractionWithTransparency+`;\r
`,e+=this._codeVariableName+".invertRefractionY = "+this.invertRefractionY+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.texture&&(e.texture=this.texture.serialize()),e.linkRefractionWithTransparency=this.linkRefractionWithTransparency,e.invertRefractionY=this.invertRefractionY,e},t.prototype._deserialize=function(e,n,r){i.prototype._deserialize.call(this,e,n,r),e.texture&&(r=e.texture.url.indexOf("data:")===0?"":r,e.texture.isCube?this.texture=di.Parse(e.texture,n,r):this.texture=Ve.a.Parse(e.texture,n,r)),this.linkRefractionWithTransparency=e.linkRefractionWithTransparency,this.invertRefractionY=e.invertRefractionY},Object(_.c)([$t("Link refraction to transparency",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"linkRefractionWithTransparency",void 0),Object(_.c)([$t("Invert refraction Y",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"invertRefractionY",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.RefractionBlock"]=Pm;var Rh=function(i){function t(e){var n=i.call(this,e,Re.Fragment)||this;return n._isUnique=!0,n.registerInput("thickness",ue.Float,!1,Re.Fragment),n.registerInput("tintColor",ue.Color3,!0,Re.Fragment),n.registerInput("translucencyIntensity",ue.Float,!0,Re.Fragment),n.registerInput("translucencyDiffusionDist",ue.Color3,!0,Re.Fragment),n.registerInput("refraction",ue.Object,!0,Re.Fragment,new ti("refraction",n,or.Input,Pm,"RefractionBlock")),n.registerOutput("subsurface",ue.Object,Re.Fragment,new ti("subsurface",n,or.Output,t,"SubSurfaceBlock")),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("subSurfaceOut"),e._excludeVariableName("vThicknessParam"),e._excludeVariableName("vTintColor"),e._excludeVariableName("vSubSurfaceIntensity")},t.prototype.getClassName=function(){return"SubSurfaceBlock"},Object.defineProperty(t.prototype,"thickness",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyIntensity",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyDiffusionDist",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.thickness.isConnected){var n=new It("SubSurface thickness",Re.Fragment,ue.Float);n.value=0,n.output.connectTo(this.thickness)}},t.prototype.prepareDefines=function(e,n,r){i.prototype.prepareDefines.call(this,e,n,r);var o=this.translucencyDiffusionDist.isConnected||this.translucencyIntensity.isConnected;r.setValue("SUBSURFACE",o||this.refraction.isConnected,!0),r.setValue("SS_TRANSLUCENCY",o,!0),r.setValue("SS_THICKNESSANDMASK_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE",!1,!0),r.setValue("SS_MASK_FROM_THICKNESS_TEXTURE_GLTF",!1,!0)},t.GetCode=function(e,n,r,o){var l,h,v,b,A,D,N,j,k,H,J,te,oe,ce,he,_e,ye="",Ee=(n==null?void 0:n.thickness.isConnected)?n.thickness.associatedVariableName:"0.",Oe=(n==null?void 0:n.tintColor.isConnected)?n.tintColor.associatedVariableName:"vec3(1.)",Ae=(n==null?void 0:n.translucencyIntensity.isConnected)?n==null?void 0:n.translucencyIntensity.associatedVariableName:"1.",xe=(n==null?void 0:n.translucencyDiffusionDist.isConnected)?n==null?void 0:n.translucencyDiffusionDist.associatedVariableName:"vec3(1.)",Pe=(n==null?void 0:n.refraction.isConnected)?(l=n==null?void 0:n.refraction.connectedPoint)===null||l===void 0?void 0:l.ownerBlock:null,Be=(Pe==null?void 0:Pe.tintAtDistance.isConnected)?Pe.tintAtDistance.associatedVariableName:"1.",Ce=(Pe==null?void 0:Pe.intensity.isConnected)?Pe.intensity.associatedVariableName:"1.",Ue=(Pe==null?void 0:Pe.view.isConnected)?Pe.view.associatedVariableName:"";return ye+=(h=Pe==null?void 0:Pe.getCode(e))!==null&&h!==void 0?h:"",ye+=`subSurfaceOutParams subSurfaceOut;

        #ifdef SUBSURFACE
            vec2 vThicknessParam = vec2(0., `+Ee+`);
            vec4 vTintColor = vec4(`+Oe+", "+Be+`);
            vec3 vSubSurfaceIntensity = vec3(`+Ce+", "+Ae+`, 0.);

            subSurfaceBlock(
                vSubSurfaceIntensity,
                vThicknessParam,
                vTintColor,
                normalW,
                specularEnvironmentReflectance,
            #ifdef SS_THICKNESSANDMASK_TEXTURE
                vec4(0.),
            #endif
            #ifdef REFLECTION
                #ifdef SS_TRANSLUCENCY
                    `+(r==null?void 0:r._reflectionMatrixName)+`,
                    #ifdef USESPHERICALFROMREFLECTIONMAP
                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)
                            reflectionOut.irradianceVector,
                        #endif
                        #if defined(REALTIME_FILTERING)
                            `+(r==null?void 0:r._cubeSamplerName)+`,
                            `+(r==null?void 0:r._vReflectionFilteringInfoName)+`,
                        #endif
                        #endif
                    #ifdef USEIRRADIANCEMAP
                        irradianceSampler,
                    #endif
                #endif
            #endif
            #ifdef SS_REFRACTION
                `+o+`.xyz,
                viewDirectionW,
                `+Ue+`,
                surfaceAlbedo,
                `+((v=Pe==null?void 0:Pe._vRefractionInfosName)!==null&&v!==void 0?v:"")+`,
                `+((b=Pe==null?void 0:Pe._refractionMatrixName)!==null&&b!==void 0?b:"")+`,
                `+((A=Pe==null?void 0:Pe._vRefractionMicrosurfaceInfosName)!==null&&A!==void 0?A:"")+`,
                vLightingIntensity,
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha,
                #endif
                #ifdef `+((D=Pe==null?void 0:Pe._defineLODRefractionAlpha)!==null&&D!==void 0?D:"IGNORE")+`
                    NdotVUnclamped,
                #endif
                #ifdef `+((N=Pe==null?void 0:Pe._defineLinearSpecularRefraction)!==null&&N!==void 0?N:"IGNORE")+`
                    roughness,
                #else
                    alphaG,
                #endif
                #ifdef `+((j=Pe==null?void 0:Pe._define3DName)!==null&&j!==void 0?j:"IGNORE")+`
                    `+((k=Pe==null?void 0:Pe._cubeSamplerName)!==null&&k!==void 0?k:"")+`,
                #else
                    `+((H=Pe==null?void 0:Pe._2DSamplerName)!==null&&H!==void 0?H:"")+`,
                #endif
                #ifndef LODBASEDMICROSFURACE
                    #ifdef `+((J=Pe==null?void 0:Pe._define3DName)!==null&&J!==void 0?J:"IGNORE")+`
                        `+((te=Pe==null?void 0:Pe._cubeSamplerName)!==null&&te!==void 0?te:"")+`,
                        `+((oe=Pe==null?void 0:Pe._cubeSamplerName)!==null&&oe!==void 0?oe:"")+`,
                    #else
                        `+((ce=Pe==null?void 0:Pe._2DSamplerName)!==null&&ce!==void 0?ce:"")+`,
                        `+((he=Pe==null?void 0:Pe._2DSamplerName)!==null&&he!==void 0?he:"")+`,
                    #endif
                #endif
                #ifdef ANISOTROPIC
                    anisotropicOut,
                #endif
                #ifdef REALTIME_FILTERING
                    `+((_e=Pe==null?void 0:Pe._vRefractionFilteringInfoName)!==null&&_e!==void 0?_e:"")+`,
                #endif
            #endif
            #ifdef SS_TRANSLUCENCY
                `+xe+`,
            #endif
                subSurfaceOut
            );

            #ifdef SS_REFRACTION
                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;
                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY
                    alpha = subSurfaceOut.alpha;
                #endif
            #endif
        #else
            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;
        #endif\r
`},t.prototype._buildBlock=function(e){return e.target===Re.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(vt);M.a.RegisteredTypes["BABYLON.SubSurfaceBlock"]=Rh;var dw={ambientClr:["finalAmbient",""],diffuseDir:["finalDiffuse",""],specularDir:["finalSpecularScaled","!defined(UNLIT) && defined(SPECULARTERM)"],clearcoatDir:["finalClearCoatScaled","!defined(UNLIT) && defined(CLEARCOAT)"],sheenDir:["finalSheenScaled","!defined(UNLIT) && defined(SHEEN)"],diffuseInd:["finalIrradiance","!defined(UNLIT) && defined(REFLECTION)"],specularInd:["finalRadianceScaled","!defined(UNLIT) && defined(REFLECTION)"],clearcoatInd:["clearcoatOut.finalClearCoatRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)"],sheenInd:["sheenOut.finalSheenRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)"],refraction:["subSurfaceOut.finalRefraction","!defined(UNLIT) && defined(SS_REFRACTION)"],lighting:["finalColor.rgb",""],shadow:["shadow",""],alpha:["alpha",""]},IT=function(i){function t(e){var n=i.call(this,e,Re.VertexAndFragment)||this;return n._environmentBRDFTexture=null,n._metallicReflectanceColor=x.a.White(),n._metallicF0Factor=1,n.directIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.lightFalloff=0,n.useAlphaTest=!1,n.alphaTestCutoff=.5,n.useAlphaBlending=!1,n.useRadianceOverAlpha=!0,n.useSpecularOverAlpha=!0,n.enableSpecularAntiAliasing=!1,n.realTimeFiltering=!1,n.realTimeFilteringQuality=g.a.TEXTURE_FILTERING_QUALITY_LOW,n.useEnergyConservation=!0,n.useRadianceOcclusion=!0,n.useHorizonOcclusion=!0,n.unlit=!1,n.forceNormalForward=!1,n.debugMode=0,n.debugLimit=0,n.debugFactor=1,n._isUnique=!0,n.registerInput("worldPosition",ue.Vector4,!1,Re.Vertex),n.registerInput("worldNormal",ue.Vector4,!1,Re.Fragment),n.registerInput("view",ue.Matrix,!1),n.registerInput("cameraPosition",ue.Vector3,!1,Re.Fragment),n.registerInput("perturbedNormal",ue.Vector4,!0,Re.Fragment),n.registerInput("baseColor",ue.Color3,!0,Re.Fragment),n.registerInput("metallic",ue.Float,!1,Re.Fragment),n.registerInput("roughness",ue.Float,!1,Re.Fragment),n.registerInput("ambientOcc",ue.Float,!0,Re.Fragment),n.registerInput("opacity",ue.Float,!0,Re.Fragment),n.registerInput("indexOfRefraction",ue.Float,!0,Re.Fragment),n.registerInput("ambientColor",ue.Color3,!0,Re.Fragment),n.registerInput("reflection",ue.Object,!0,Re.Fragment,new ti("reflection",n,or.Input,xm,"ReflectionBlock")),n.registerInput("clearcoat",ue.Object,!0,Re.Fragment,new ti("clearcoat",n,or.Input,Ch,"ClearCoatBlock")),n.registerInput("sheen",ue.Object,!0,Re.Fragment,new ti("sheen",n,or.Input,Em,"SheenBlock")),n.registerInput("subsurface",ue.Object,!0,Re.Fragment,new ti("subsurface",n,or.Input,Rh,"SubSurfaceBlock")),n.registerInput("anisotropy",ue.Object,!0,Re.Fragment,new ti("anisotropy",n,or.Input,Sm,"AnisotropyBlock")),n.registerOutput("ambientClr",ue.Color3,Re.Fragment),n.registerOutput("diffuseDir",ue.Color3,Re.Fragment),n.registerOutput("specularDir",ue.Color3,Re.Fragment),n.registerOutput("clearcoatDir",ue.Color3,Re.Fragment),n.registerOutput("sheenDir",ue.Color3,Re.Fragment),n.registerOutput("diffuseInd",ue.Color3,Re.Fragment),n.registerOutput("specularInd",ue.Color3,Re.Fragment),n.registerOutput("clearcoatInd",ue.Color3,Re.Fragment),n.registerOutput("sheenInd",ue.Color3,Re.Fragment),n.registerOutput("refraction",ue.Color3,Re.Fragment),n.registerOutput("lighting",ue.Color3,Re.Fragment),n.registerOutput("shadow",ue.Float,Re.Fragment),n.registerOutput("alpha",ue.Float,Re.Fragment),n}return Object(_.d)(t,i),t.prototype.initialize=function(e){e._excludeVariableName("vLightingIntensity"),e._excludeVariableName("geometricNormalW"),e._excludeVariableName("normalW"),e._excludeVariableName("faceNormal"),e._excludeVariableName("albedoOpacityOut"),e._excludeVariableName("surfaceAlbedo"),e._excludeVariableName("alpha"),e._excludeVariableName("aoOut"),e._excludeVariableName("baseColor"),e._excludeVariableName("reflectivityOut"),e._excludeVariableName("microSurface"),e._excludeVariableName("roughness"),e._excludeVariableName("NdotVUnclamped"),e._excludeVariableName("NdotV"),e._excludeVariableName("alphaG"),e._excludeVariableName("AARoughnessFactors"),e._excludeVariableName("environmentBrdf"),e._excludeVariableName("ambientMonochrome"),e._excludeVariableName("seo"),e._excludeVariableName("eho"),e._excludeVariableName("environmentRadiance"),e._excludeVariableName("irradianceVector"),e._excludeVariableName("environmentIrradiance"),e._excludeVariableName("diffuseBase"),e._excludeVariableName("specularBase"),e._excludeVariableName("preInfo"),e._excludeVariableName("info"),e._excludeVariableName("shadow"),e._excludeVariableName("finalDiffuse"),e._excludeVariableName("finalAmbient"),e._excludeVariableName("ambientOcclusionForDirectDiffuse"),e._excludeVariableName("finalColor"),e._excludeVariableName("vClipSpacePosition"),e._excludeVariableName("vDebugMode")},t.prototype.getClassName=function(){return"PBRMetallicRoughnessBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perturbedNormal",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metallic",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientOcc",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._inputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._inputs[12]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._inputs[13]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._inputs[14]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._inputs[15]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._inputs[16]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientClr",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseDir",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularDir",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatDir",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenDir",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseIndirect",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularIndirect",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatIndirect",{get:function(){return this._outputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenIndirect",{get:function(){return this._outputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lighting",{get:function(){return this._outputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._outputs[12]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var n=e.getInputBlockByPredicate(function(o){return o.systemValue===Pt.CameraPosition});n||(n=new It("cameraPosition")).setAsSystemValue(Pt.CameraPosition),n.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var r=e.getInputBlockByPredicate(function(o){return o.systemValue===Pt.View});r||(r=new It("view")).setAsSystemValue(Pt.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,n,r){r.setValue("PBR",!0),r.setValue("METALLICWORKFLOW",!0),r.setValue("DEBUGMODE",this.debugMode,!0),r.setValue("NORMALXYSCALE",!0),r.setValue("BUMP",this.perturbedNormal.isConnected,!0),r.setValue("LODBASEDMICROSFURACE",this._scene.getEngine().getCaps().textureLOD),r.setValue("ALBEDO",!1,!0),r.setValue("OPACITY",this.opacity.isConnected,!0),r.setValue("AMBIENT",!0,!0),r.setValue("AMBIENTINGRAYSCALE",!1,!0),r.setValue("REFLECTIVITY",!1,!0),r.setValue("AOSTOREINMETALMAPRED",!1,!0),r.setValue("METALLNESSSTOREINMETALMAPBLUE",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPALPHA",!1,!0),r.setValue("ROUGHNESSSTOREINMETALMAPGREEN",!1,!0),this.lightFalloff===Gn.LIGHTFALLOFF_STANDARD?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!1)):this.lightFalloff===Gn.LIGHTFALLOFF_GLTF?(r.setValue("USEPHYSICALLIGHTFALLOFF",!1),r.setValue("USEGLTFLIGHTFALLOFF",!0)):(r.setValue("USEPHYSICALLIGHTFALLOFF",!0),r.setValue("USEGLTFLIGHTFALLOFF",!1));var o=this.alphaTestCutoff.toString();if(r.setValue("ALPHABLEND",this.useAlphaBlending,!0),r.setValue("ALPHAFROMALBEDO",!1,!0),r.setValue("ALPHATEST",this.useAlphaTest,!0),r.setValue("ALPHATESTVALUE",o.indexOf(".")<0?o+".":o,!0),r.setValue("OPACITYRGB",!1,!0),r.setValue("RADIANCEOVERALPHA",this.useRadianceOverAlpha,!0),r.setValue("SPECULAROVERALPHA",this.useSpecularOverAlpha,!0),r.setValue("SPECULARAA",this._scene.getEngine().getCaps().standardDerivatives&&this.enableSpecularAntiAliasing,!0),r.setValue("REALTIME_FILTERING",this.realTimeFiltering,!0),this._scene.getEngine().webGLVersion>1?r.setValue("NUM_SAMPLES",this.realTimeFilteringQuality+"u",!0):r.setValue("NUM_SAMPLES",""+this.realTimeFilteringQuality,!0),r.setValue("BRDF_V_HEIGHT_CORRELATED",!0),r.setValue("MS_BRDF_ENERGY_CONSERVATION",this.useEnergyConservation,!0),r.setValue("RADIANCEOCCLUSION",this.useRadianceOcclusion,!0),r.setValue("HORIZONOCCLUSION",this.useHorizonOcclusion,!0),r.setValue("UNLIT",this.unlit,!0),r.setValue("FORCENORMALFORWARD",this.forceNormalForward,!0),this._environmentBRDFTexture&&pt.a.ReflectionTextureEnabled?(r.setValue("ENVIRONMENTBRDF",!0),r.setValue("ENVIRONMENTBRDF_RGBD",this._environmentBRDFTexture.isRGBD,!0)):(r.setValue("ENVIRONMENTBRDF",!1),r.setValue("ENVIRONMENTBRDF_RGBD",!1)),r._areLightsDirty){var l=e.getScene();if(this.light){var h={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};ot.a.PrepareDefinesForLight(l,e,this.light,this._lightId,r,!0,h),h.needRebuild&&r.rebuild()}else ot.a.PrepareDefinesForLights(l,e,r,!0,n.maxSimultaneousLights),r._needNormals=!0,ot.a.PrepareDefinesForMultiview(l,r)}},t.prototype.updateUniformsAndSamples=function(e,n,r,o){for(var l=0;l<n.maxSimultaneousLights&&r["LIGHT"+l];l++){var h=e.uniforms.indexOf("vLightData"+l)>=0;ot.a.PrepareUniformsAndSamplersForLight(l,e.uniforms,e.samplers,r["PROJECTEDLIGHTTEXTURE"+l],o,h)}},t.prototype.bind=function(e,n,r){var o,l;if(r){var h=r.getScene();this.light?ot.a.BindLight(this.light,this._lightId,h,e,!0):ot.a.BindLights(h,r,e,!0,n.maxSimultaneousLights),e.setTexture(this._environmentBrdfSamplerName,this._environmentBRDFTexture),e.setFloat2("vDebugMode",this.debugLimit,this.debugFactor);var v=this._scene.ambientColor;v&&e.setColor3("ambientFromScene",v);var b=h.useRightHandedSystem===(h._mirroredCameraPosition!=null);e.setFloat(this._invertNormalName,b?-1:1),e.setFloat4("vLightingIntensity",this.directIntensity,1,this.environmentIntensity*this._scene.environmentIntensity,this.specularIntensity);var A=(l=(o=this.indexOfRefraction.connectInputBlock)===null||o===void 0?void 0:o.value)!==null&&l!==void 0?l:1.5,D=Math.pow((A-1)/(A+1),2);this._metallicReflectanceColor.scaleToRef(D*this._metallicF0Factor,x.c.Color3[0]);var N=this._metallicF0Factor;e.setColor4(this._vMetallicReflectanceFactorsName,x.c.Color3[0],N)}},t.prototype._injectVertexCode=function(e){var n,r,o=this.worldPosition,l="//"+this.name;this.light?(this._lightId=(e.counters.lightCounter!==void 0?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",l,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",l,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var h="v_"+o.associatedVariableName;e._emitVaryingFromString(h,"vec4")&&(e.compilationString+=h+" = "+o.associatedVariableName+`;\r
`);var v=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;v&&(v.viewConnectionPoint=this.view),e.compilationString+=(r=v==null?void 0:v.handleVertexSide(e))!==null&&r!==void 0?r:"",e._emitUniformFromString("vDebugMode","vec2","defined(IGNORE) || DEBUGMODE > 0"),e._emitUniformFromString("ambientFromScene","vec3"),e._emitVaryingFromString("vClipSpacePosition","vec4","defined(IGNORE) || DEBUGMODE > 0")&&(e._injectAtEnd+=`#if DEBUGMODE > 0\r
`,e._injectAtEnd+=`vClipSpacePosition = gl_Position;\r
`,e._injectAtEnd+=`#endif\r
`),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",l,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:o.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = "+o.associatedVariableName+`;\r
`,this.view.isConnected&&(e.compilationString+="mat4 view = "+this.view.associatedVariableName+`;\r
`),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",l,{repeatKey:"maxSimultaneousLights"}))},t.prototype._getAlbedoOpacityCode=function(){var e=`albedoOpacityOutParams albedoOpacityOut;\r
`;return e+=`albedoOpacityBlock(
                vec4(`+(this.baseColor.isConnected?this.baseColor.associatedVariableName:"vec3(1.)")+`, 1.),
            #ifdef ALBEDO
                vec4(1.),
                vec2(1., 1.),
            #endif
            #ifdef OPACITY
                vec4(`+(this.opacity.isConnected?this.opacity.associatedVariableName:"1.")+`),
                vec2(1., 1.),
            #endif
                albedoOpacityOut
            );

            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;
            float alpha = albedoOpacityOut.alpha;\r
`},t.prototype._getAmbientOcclusionCode=function(){var e=`ambientOcclusionOutParams aoOut;\r
`;return e+=`ambientOcclusionBlock(
            #ifdef AMBIENT
                vec3(`+(this.ambientOcc.isConnected?this.ambientOcc.associatedVariableName:"1.")+`),
                vec4(0., 1.0, 1.0, 0.),
            #endif
                aoOut
            );\r
`},t.prototype._getReflectivityCode=function(e){var n=`reflectivityOutParams reflectivityOut;\r
`;return this._vMetallicReflectanceFactorsName=e._getFreeVariableName("vMetallicReflectanceFactors"),e._emitUniformFromString(this._vMetallicReflectanceFactorsName,"vec4"),n+=`vec3 baseColor = surfaceAlbedo;

            reflectivityBlock(
                vec4(`+this.metallic.associatedVariableName+", "+this.roughness.associatedVariableName+`, 0., 0.),
            #ifdef METALLICWORKFLOW
                surfaceAlbedo,
                `+this._vMetallicReflectanceFactorsName+`,
            #endif
            #ifdef REFLECTIVITY
                vec3(0., 0., 1.),
                vec4(1.),
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor,
            #endif
            #ifdef MICROSURFACEMAP
                microSurfaceTexel, <== not handled!
            #endif
                reflectivityOut
            );

            float microSurface = reflectivityOut.microSurface;
            float roughness = reflectivityOut.roughness;

            #ifdef METALLICWORKFLOW
                surfaceAlbedo = reflectivityOut.surfaceAlbedo;
            #endif
            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)
                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;
            #endif\r
`},t.prototype._buildBlock=function(e){var n,r,o,l,h,v,b,A,D,N,j,k,H,J,te,oe,ce,he,_e,ye,Ee,Oe,Ae,xe,Pe,Be,Ce,Ue,Le,ke,qe,at,lt,ft,Je,dt,ut,tt,mt;i.prototype._buildBlock.call(this,e),this._scene=e.sharedData.scene,this._environmentBRDFTexture||(this._environmentBRDFTexture=ch.GetEnvironmentBRDFTexture(this._scene));var ze=this.reflection.isConnected?(n=this.reflection.connectedPoint)===null||n===void 0?void 0:n.ownerBlock:null;if(ze&&(ze.worldPositionConnectionPoint=this.worldPosition,ze.cameraPositionConnectionPoint=this.cameraPosition,ze.worldNormalConnectionPoint=this.worldNormal),e.target!==Re.Fragment)return this._injectVertexCode(e),this;e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this);var rt="//"+this.name,At="v_"+this.worldPosition.associatedVariableName,sn=this.perturbedNormal;this._environmentBrdfSamplerName=e._getFreeVariableName("environmentBrdfSampler"),e._emit2DSampler(this._environmentBrdfSamplerName),e.sharedData.hints.needAlphaBlending=e.sharedData.hints.needAlphaBlending||this.useAlphaBlending,e.sharedData.hints.needAlphaTesting=e.sharedData.hints.needAlphaTesting||this.useAlphaTest,e._emitExtension("lod","#extension GL_EXT_shader_texture_lod : enable","defined(LODBASEDMICROSFURACE)"),e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),this.light?e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",rt,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):e._emitFunctionFromInclude(e.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",rt,{repeatKey:"maxSimultaneousLights"}),e._emitFunctionFromInclude("helperFunctions",rt),e._emitFunctionFromInclude("importanceSampling",rt),e._emitFunctionFromInclude("pbrHelperFunctions",rt),e._emitFunctionFromInclude("imageProcessingFunctions",rt),e._emitFunctionFromInclude("shadowsFragmentFunctions",rt,{replaceStrings:[{search:/vPositionW/g,replace:At+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingSetupFunctions",rt,{replaceStrings:[{search:/vPositionW/g,replace:At+".xyz"}]}),e._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions",rt),e._emitFunctionFromInclude("pbrBRDFFunctions",rt,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(r=ze==null?void 0:ze._defineSkyboxName)!==null&&r!==void 0?r:"REFLECTIONMAP_SKYBOX"}]}),e._emitFunctionFromInclude("hdrFilteringFunctions",rt),e._emitFunctionFromInclude("pbrDirectLightingFunctions",rt,{replaceStrings:[{search:/vPositionW/g,replace:At+".xyz"}]}),e._emitFunctionFromInclude("pbrIBLFunctions",rt),e._emitFunctionFromInclude("pbrBlockAlbedoOpacity",rt),e._emitFunctionFromInclude("pbrBlockReflectivity",rt),e._emitFunctionFromInclude("pbrBlockAmbientOcclusion",rt),e._emitFunctionFromInclude("pbrBlockAlphaFresnel",rt),e._emitFunctionFromInclude("pbrBlockAnisotropic",rt),e._emitUniformFromString("vLightingIntensity","vec4"),this._vNormalWName=e._getFreeVariableName("vNormalW"),e.compilationString+="vec4 "+this._vNormalWName+" = normalize("+this.worldNormal.associatedVariableName+`);\r
`,e._registerTempVariable("viewDirectionW")&&(e.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - "+At+`.xyz);\r
`),e.compilationString+="vec3 geometricNormalW = "+this._vNormalWName+`.xyz;\r
`,e.compilationString+="vec3 normalW = "+(sn.isConnected?"normalize("+sn.associatedVariableName+".xyz)":"geometricNormalW")+`;\r
`,this._invertNormalName=e._getFreeVariableName("invertNormal"),e._emitUniformFromString(this._invertNormalName,"float"),e.compilationString+=e._emitCodeFromInclude("pbrBlockNormalFinal",rt,{replaceStrings:[{search:/vPositionW/g,replace:At+".xyz"},{search:/vEyePosition.w/g,replace:this._invertNormalName}]}),e.compilationString+=this._getAlbedoOpacityCode(),e.compilationString+=e._emitCodeFromInclude("depthPrePass",rt),e.compilationString+=this._getAmbientOcclusionCode(),e.compilationString+=e._emitCodeFromInclude("pbrBlockLightmapInit",rt),e.compilationString+=`#ifdef UNLIT
                vec3 diffuseBase = vec3(1., 1., 1.);
            #else\r
`,e.compilationString+=this._getReflectivityCode(e),e.compilationString+=e._emitCodeFromInclude("pbrBlockGeometryInfo",rt,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(o=ze==null?void 0:ze._defineSkyboxName)!==null&&o!==void 0?o:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(l=ze==null?void 0:ze._define3DName)!==null&&l!==void 0?l:"REFLECTIONMAP_3D"}]});var Ht=this.anisotropy.isConnected?(h=this.anisotropy.connectedPoint)===null||h===void 0?void 0:h.ownerBlock:null;Ht&&(Ht.worldPositionConnectionPoint=this.worldPosition,Ht.worldNormalConnectionPoint=this.worldNormal,e.compilationString+=Ht.getCode(e,!this.perturbedNormal.isConnected)),ze&&ze.hasTexture&&(e.compilationString+=ze.getCode(e,Ht?"anisotropicOut.anisotropicNormal":"normalW")),e._emitFunctionFromInclude("pbrBlockReflection",rt,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(v=ze==null?void 0:ze._define3DName)!==null&&v!==void 0?v:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(b=ze==null?void 0:ze._defineOppositeZ)!==null&&b!==void 0?b:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(A=ze==null?void 0:ze._defineProjectionName)!==null&&A!==void 0?A:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(D=ze==null?void 0:ze._defineSkyboxName)!==null&&D!==void 0?D:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(N=ze==null?void 0:ze._defineLODReflectionAlpha)!==null&&N!==void 0?N:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(j=ze==null?void 0:ze._defineLinearSpecularReflection)!==null&&j!==void 0?j:"LINEARSPECULARREFLECTION"},{search:/vReflectionFilteringInfo/g,replace:(k=ze==null?void 0:ze._vReflectionFilteringInfoName)!==null&&k!==void 0?k:"vReflectionFilteringInfo"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance0",rt,{replaceStrings:[{search:/metallicReflectanceFactors/g,replace:this._vMetallicReflectanceFactorsName}]});var fn=this.sheen.isConnected?(H=this.sheen.connectedPoint)===null||H===void 0?void 0:H.ownerBlock:null;fn&&(e.compilationString+=fn.getCode(ze)),e._emitFunctionFromInclude("pbrBlockSheen",rt,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(J=ze==null?void 0:ze._define3DName)!==null&&J!==void 0?J:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(te=ze==null?void 0:ze._defineSkyboxName)!==null&&te!==void 0?te:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(oe=ze==null?void 0:ze._defineLODReflectionAlpha)!==null&&oe!==void 0?oe:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(ce=ze==null?void 0:ze._defineLinearSpecularReflection)!==null&&ce!==void 0?ce:"LINEARSPECULARREFLECTION"}]});var St=this.clearcoat.isConnected?(he=this.clearcoat.connectedPoint)===null||he===void 0?void 0:he.ownerBlock:null,bn=!this.perturbedNormal.isConnected&&!this.anisotropy.isConnected,cn=this.perturbedNormal.isConnected&&((_e=this.perturbedNormal.connectedPoint)===null||_e===void 0?void 0:_e.ownerBlock).worldTangent.isConnected,en=this.anisotropy.isConnected&&((ye=this.anisotropy.connectedPoint)===null||ye===void 0?void 0:ye.ownerBlock).worldTangent.isConnected,ln=cn||!this.perturbedNormal.isConnected&&en;e.compilationString+=Ch.GetCode(e,St,ze,At,bn,ln,this.worldNormal.associatedVariableName),bn&&(ln=(Ee=St==null?void 0:St.worldTangent.isConnected)!==null&&Ee!==void 0&&Ee),e._emitFunctionFromInclude("pbrBlockClearcoat",rt,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:(Oe=ze==null?void 0:ze._define3DName)!==null&&Oe!==void 0?Oe:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(Ae=ze==null?void 0:ze._defineOppositeZ)!==null&&Ae!==void 0?Ae:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(xe=ze==null?void 0:ze._defineProjectionName)!==null&&xe!==void 0?xe:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:(Pe=ze==null?void 0:ze._defineSkyboxName)!==null&&Pe!==void 0?Pe:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:(Be=ze==null?void 0:ze._defineLODReflectionAlpha)!==null&&Be!==void 0?Be:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:(Ce=ze==null?void 0:ze._defineLinearSpecularReflection)!==null&&Ce!==void 0?Ce:"LINEARSPECULARREFLECTION"},{search:/defined\(TANGENT\)/g,replace:ln?"defined(TANGENT)":"defined(IGNORE)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockReflectance",rt,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:(Ue=ze==null?void 0:ze._defineSkyboxName)!==null&&Ue!==void 0?Ue:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:(Le=ze==null?void 0:ze._define3DName)!==null&&Le!==void 0?Le:"REFLECTIONMAP_3D"}]});var Ot=this.subsurface.isConnected?(ke=this.subsurface.connectedPoint)===null||ke===void 0?void 0:ke.ownerBlock:null,kt=this.subsurface.isConnected?(at=((qe=this.subsurface.connectedPoint)===null||qe===void 0?void 0:qe.ownerBlock).refraction.connectedPoint)===null||at===void 0?void 0:at.ownerBlock:null;kt&&(kt.viewConnectionPoint=this.view,kt.indexOfRefractionConnectionPoint=this.indexOfRefraction),e.compilationString+=Rh.GetCode(e,Ot,ze,At),e._emitFunctionFromInclude("pbrBlockSubSurface",rt,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:(lt=ze==null?void 0:ze._define3DName)!==null&&lt!==void 0?lt:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:(ft=ze==null?void 0:ze._defineOppositeZ)!==null&&ft!==void 0?ft:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:(Je=ze==null?void 0:ze._defineProjectionName)!==null&&Je!==void 0?Je:"REFLECTIONMAP_PROJECTION"},{search:/SS_REFRACTIONMAP_3D/g,replace:(dt=kt==null?void 0:kt._define3DName)!==null&&dt!==void 0?dt:"SS_REFRACTIONMAP_3D"},{search:/SS_LODINREFRACTIONALPHA/g,replace:(ut=kt==null?void 0:kt._defineLODRefractionAlpha)!==null&&ut!==void 0?ut:"SS_LODINREFRACTIONALPHA"},{search:/SS_LINEARSPECULARREFRACTION/g,replace:(tt=kt==null?void 0:kt._defineLinearSpecularRefraction)!==null&&tt!==void 0?tt:"SS_LINEARSPECULARREFRACTION"},{search:/SS_REFRACTIONMAP_OPPOSITEZ/g,replace:(mt=kt==null?void 0:kt._defineOppositeZ)!==null&&mt!==void 0?mt:"SS_REFRACTIONMAP_OPPOSITEZ"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockDirectLighting",rt),this.light?e.compilationString+=e._emitCodeFromInclude("lightFragment",rt,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):e.compilationString+=e._emitCodeFromInclude("lightFragment",rt,{repeatKey:"maxSimultaneousLights"}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalLitComponents",rt),e.compilationString+=`#endif\r
`;var Tn=this.ambientColor.isConnected?this.ambientColor.associatedVariableName:"vec3(0., 0., 0.)",Er=Gn.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();Er.indexOf(".")===-1&&(Er+="."),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalUnlitComponents",rt,{replaceStrings:[{search:/vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,replace:""},{search:/vAmbientColor/g,replace:Tn+" * ambientFromScene"},{search:/vAmbientInfos\.w/g,replace:Er}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockFinalColorComposition",rt,{replaceStrings:[{search:/finalEmissive/g,replace:"vec3(0.)"}]}),e.compilationString+=e._emitCodeFromInclude("pbrBlockImageProcessing",rt,{replaceStrings:[{search:/visibility/g,replace:"1."}]}),e.compilationString+=e._emitCodeFromInclude("pbrDebug",rt,{replaceStrings:[{search:/vNormalW/g,replace:this._vNormalWName},{search:/vPositionW/g,replace:At},{search:/albedoTexture\.rgb;/g,replace:`vec3(1.);\r
gl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r
`}]});for(var wr=0,ri=this._outputs;wr<ri.length;wr++){var Sr=ri[wr];if(Sr.hasEndpoints){var pn=dw[Sr.name];if(pn){var gi=pn[0],io=pn[1];io&&(e.compilationString+="#if "+io+`\r
`),e.compilationString+=this._declareOutput(Sr,e)+" = "+gi+`;\r
`,io&&(e.compilationString+=`#else\r
`,e.compilationString+=this._declareOutput(Sr,e)+` = vec3(0.);\r
`,e.compilationString+=`#endif\r
`)}else console.error("There's no remapping for the "+Sr.name+" end point! No code generated")}}return this},t.prototype._dumpPropertiesCode=function(){var e="";return e+=this._codeVariableName+".lightFalloff = "+this.lightFalloff+`;\r
`,e+=this._codeVariableName+".useAlphaTest = "+this.useAlphaTest+`;\r
`,e+=this._codeVariableName+".alphaTestCutoff = "+this.alphaTestCutoff+`;\r
`,e+=this._codeVariableName+".useAlphaBlending = "+this.useAlphaBlending+`;\r
`,e+=this._codeVariableName+".useRadianceOverAlpha = "+this.useRadianceOverAlpha+`;\r
`,e+=this._codeVariableName+".useSpecularOverAlpha = "+this.useSpecularOverAlpha+`;\r
`,e+=this._codeVariableName+".enableSpecularAntiAliasing = "+this.enableSpecularAntiAliasing+`;\r
`,e+=this._codeVariableName+".realTimeFiltering = "+this.realTimeFiltering+`;\r
`,e+=this._codeVariableName+".realTimeFilteringQuality = "+this.realTimeFilteringQuality+`;\r
`,e+=this._codeVariableName+".useEnergyConservation = "+this.useEnergyConservation+`;\r
`,e+=this._codeVariableName+".useRadianceOcclusion = "+this.useRadianceOcclusion+`;\r
`,e+=this._codeVariableName+".useHorizonOcclusion = "+this.useHorizonOcclusion+`;\r
`,e+=this._codeVariableName+".unlit = "+this.unlit+`;\r
`,e+=this._codeVariableName+".forceNormalForward = "+this.forceNormalForward+`;\r
`,e+=this._codeVariableName+".debugMode = "+this.debugMode+`;\r
`,e+=this._codeVariableName+".debugLimit = "+this.debugLimit+`;\r
`,e+=this._codeVariableName+".debugFactor = "+this.debugFactor+`;\r
`},t.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return this.light&&(e.lightId=this.light.id),e.lightFalloff=this.lightFalloff,e.useAlphaTest=this.useAlphaTest,e.alphaTestCutoff=this.alphaTestCutoff,e.useAlphaBlending=this.useAlphaBlending,e.useRadianceOverAlpha=this.useRadianceOverAlpha,e.useSpecularOverAlpha=this.useSpecularOverAlpha,e.enableSpecularAntiAliasing=this.enableSpecularAntiAliasing,e.realTimeFiltering=this.realTimeFiltering,e.realTimeFilteringQuality=this.realTimeFilteringQuality,e.useEnergyConservation=this.useEnergyConservation,e.useRadianceOcclusion=this.useRadianceOcclusion,e.useHorizonOcclusion=this.useHorizonOcclusion,e.unlit=this.unlit,e.forceNormalForward=this.forceNormalForward,e.debugMode=this.debugMode,e.debugLimit=this.debugLimit,e.debugFactor=this.debugFactor,e},t.prototype._deserialize=function(e,n,r){var o,l;i.prototype._deserialize.call(this,e,n,r),e.lightId&&(this.light=n.getLightByID(e.lightId)),this.lightFalloff=(o=e.lightFalloff)!==null&&o!==void 0?o:0,this.useAlphaTest=e.useAlphaTest,this.alphaTestCutoff=e.alphaTestCutoff,this.useAlphaBlending=e.useAlphaBlending,this.useRadianceOverAlpha=e.useRadianceOverAlpha,this.useSpecularOverAlpha=e.useSpecularOverAlpha,this.enableSpecularAntiAliasing=e.enableSpecularAntiAliasing,this.realTimeFiltering=!!e.realTimeFiltering,this.realTimeFilteringQuality=(l=e.realTimeFilteringQuality)!==null&&l!==void 0?l:g.a.TEXTURE_FILTERING_QUALITY_LOW,this.useEnergyConservation=e.useEnergyConservation,this.useRadianceOcclusion=e.useRadianceOcclusion,this.useHorizonOcclusion=e.useHorizonOcclusion,this.unlit=e.unlit,this.forceNormalForward=!!e.forceNormalForward,this.debugMode=e.debugMode,this.debugLimit=e.debugLimit,this.debugFactor=e.debugFactor},Object(_.c)([$t("Direct lights",Wt.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"directIntensity",void 0),Object(_.c)([$t("Environment lights",Wt.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"environmentIntensity",void 0),Object(_.c)([$t("Specular highlights",Wt.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"specularIntensity",void 0),Object(_.c)([$t("Light falloff",Wt.List,"LIGHTING & COLORS",{notifiers:{update:!0},options:[{label:"Physical",value:Gn.LIGHTFALLOFF_PHYSICAL},{label:"GLTF",value:Gn.LIGHTFALLOFF_GLTF},{label:"Standard",value:Gn.LIGHTFALLOFF_STANDARD}]})],t.prototype,"lightFalloff",void 0),Object(_.c)([$t("Alpha Testing",Wt.Boolean,"OPACITY")],t.prototype,"useAlphaTest",void 0),Object(_.c)([$t("Alpha CutOff",Wt.Float,"OPACITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"alphaTestCutoff",void 0),Object(_.c)([$t("Alpha blending",Wt.Boolean,"OPACITY")],t.prototype,"useAlphaBlending",void 0),Object(_.c)([$t("Radiance over alpha",Wt.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useRadianceOverAlpha",void 0),Object(_.c)([$t("Specular over alpha",Wt.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useSpecularOverAlpha",void 0),Object(_.c)([$t("Specular anti-aliasing",Wt.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"enableSpecularAntiAliasing",void 0),Object(_.c)([$t("Realtime filtering",Wt.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"realTimeFiltering",void 0),Object(_.c)([$t("Realtime filtering quality",Wt.List,"RENDERING",{notifiers:{update:!0},options:[{label:"Low",value:g.a.TEXTURE_FILTERING_QUALITY_LOW},{label:"Medium",value:g.a.TEXTURE_FILTERING_QUALITY_MEDIUM},{label:"High",value:g.a.TEXTURE_FILTERING_QUALITY_HIGH}]})],t.prototype,"realTimeFilteringQuality",void 0),Object(_.c)([$t("Energy Conservation",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useEnergyConservation",void 0),Object(_.c)([$t("Radiance occlusion",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useRadianceOcclusion",void 0),Object(_.c)([$t("Horizon occlusion",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useHorizonOcclusion",void 0),Object(_.c)([$t("Unlit",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"unlit",void 0),Object(_.c)([$t("Force normal forward",Wt.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceNormalForward",void 0),Object(_.c)([$t("Debug mode",Wt.List,"DEBUG",{notifiers:{update:!0},options:[{label:"None",value:0},{label:"Normalized position",value:1},{label:"Normals",value:2},{label:"Tangents",value:3},{label:"Bitangents",value:4},{label:"Bump Normals",value:5},{label:"ClearCoat Normals",value:8},{label:"ClearCoat Tangents",value:9},{label:"ClearCoat Bitangents",value:10},{label:"Anisotropic Normals",value:11},{label:"Anisotropic Tangents",value:12},{label:"Anisotropic Bitangents",value:13},{label:"Env Refraction",value:40},{label:"Env Reflection",value:41},{label:"Env Clear Coat",value:42},{label:"Direct Diffuse",value:50},{label:"Direct Specular",value:51},{label:"Direct Clear Coat",value:52},{label:"Direct Sheen",value:53},{label:"Env Irradiance",value:54},{label:"Surface Albedo",value:60},{label:"Reflectance 0",value:61},{label:"Metallic",value:62},{label:"Metallic F0",value:71},{label:"Roughness",value:63},{label:"AlphaG",value:64},{label:"NdotV",value:65},{label:"ClearCoat Color",value:66},{label:"ClearCoat Roughness",value:67},{label:"ClearCoat NdotV",value:68},{label:"Transmittance",value:69},{label:"Refraction Transmittance",value:70},{label:"SEO",value:80},{label:"EHO",value:81},{label:"Energy Factor",value:82},{label:"Specular Reflectance",value:83},{label:"Clear Coat Reflectance",value:84},{label:"Sheen Reflectance",value:85},{label:"Luminance Over Alpha",value:86},{label:"Alpha",value:87}]})],t.prototype,"debugMode",void 0),Object(_.c)([$t("Split position",Wt.Float,"DEBUG",{min:-1,max:1,notifiers:{update:!0}})],t.prototype,"debugLimit",void 0),Object(_.c)([$t("Output factor",Wt.Float,"DEBUG",{min:0,max:5,notifiers:{update:!0}})],t.prototype,"debugFactor",void 0),t}(vt);M.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessBlock"]=IT;var DT=function(i){function t(e){var n=i.call(this,e,Re.Neutral)||this;return n.registerInput("left",ue.AutoDetect),n.registerInput("right",ue.AutoDetect),n.registerOutput("output",ue.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ModBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(e){i.prototype._buildBlock.call(this,e);var n=this._outputs[0];return e.compilationString+=this._declareOutput(n,e)+" = mod("+this.left.associatedVariableName+", "+this.right.associatedVariableName+`);\r
`,this},t}(vt);M.a.RegisteredTypes["BABYLON.ModBlock"]=DT;var fw=function(){function i(){}return i.prototype.optimize=function(t,e){},i}(),pw=c(120),mw=function(){function i(){this.mm=new Map}return i.prototype.get=function(t,e){var n=this.mm.get(t);if(n!==void 0)return n.get(e)},i.prototype.set=function(t,e,n){var r=this.mm.get(t);r===void 0&&this.mm.set(t,r=new Map),r.set(e,n)},i}(),_w=function(){function i(t,e,n){var r=this;this._baseMaterial=t,this._scene=e,this._options=n,this._subMeshToEffect=new Map,this._subMeshToDepthEffect=new mw,this._meshes=new Map;var o=t.getClassName()==="NodeMaterial"?"u_":"";if(o){this._matriceNames={world:o+"World",view:o+"View",projection:o+"Projection",viewProjection:o+"ViewProjection",worldView:o+"WorldxView",worldViewProjection:o+"WorldxViewxProjection"};for(var l=t.getInputBlocks(),h=0;h<l.length;++h)switch(l[h]._systemValue){case Pt.World:this._matriceNames.world=l[h].associatedVariableName;break;case Pt.View:this._matriceNames.view=l[h].associatedVariableName;break;case Pt.Projection:this._matriceNames.projection=l[h].associatedVariableName;break;case Pt.ViewProjection:this._matriceNames.viewProjection=l[h].associatedVariableName;break;case Pt.WorldView:this._matriceNames.worldView=l[h].associatedVariableName;break;case Pt.WorldViewProjection:this._matriceNames.worldViewProjection=l[h].associatedVariableName}}else this._matriceNames={world:o+"world",view:o+"view",projection:o+"projection",viewProjection:o+"viewProjection",worldView:o+"worldView",worldViewProjection:o+"worldViewProjection"};this._onEffectCreatedObserver=this._baseMaterial.onEffectCreatedObservable.add(function(v){var b,A=(b=v.subMesh)===null||b===void 0?void 0:b.getMesh();A&&!r._meshes.has(A)&&r._meshes.set(A,A.onDisposeObservable.add(function(D){for(var N=r._subMeshToEffect.keys(),j=N.next();j.done!==!0;j=N.next()){var k=j.value;(k==null?void 0:k.getMesh())===D&&(r._subMeshToEffect.delete(k),r._subMeshToDepthEffect.mm.delete(k))}})),r._subMeshToEffect.set(v.subMesh,v.effect),r._subMeshToDepthEffect.mm.delete(v.subMesh)})}return Object.defineProperty(i.prototype,"standalone",{get:function(){var t,e;return(e=(t=this._options)===null||t===void 0?void 0:t.standalone)!==null&&e!==void 0&&e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseMaterial",{get:function(){return this._baseMaterial},enumerable:!1,configurable:!0}),i.prototype.getEffect=function(t,e){var n,r,o,l,h,v;return(v=(o=(r=(n=this._subMeshToDepthEffect.mm.get(t))===null||n===void 0?void 0:n.get(e))===null||r===void 0?void 0:r.depthEffect)!==null&&o!==void 0?o:(h=(l=this._subMeshToDepthEffect.mm.get(null))===null||l===void 0?void 0:l.get(e))===null||h===void 0?void 0:h.depthEffect)!==null&&v!==void 0?v:null},i.prototype.isReadyForSubMesh=function(t,e,n,r){var o,l;return this.standalone&&this._baseMaterial.isReadyForSubMesh(t.getMesh(),t,r),(l=(o=this._makeEffect(t,e,n))===null||o===void 0?void 0:o.isReady())!==null&&l!==void 0&&l},i.prototype.dispose=function(){this._baseMaterial.onEffectCreatedObservable.remove(this._onEffectCreatedObserver),this._onEffectCreatedObserver=null;for(var t=this._meshes.entries(),e=t.next();e.done!==!0;e=t.next()){var n=e.value,r=n[0],o=n[1];r.onDisposeObservable.remove(o)}},i.prototype._makeEffect=function(t,e,n){var r,o=(r=this._subMeshToEffect.get(t))!==null&&r!==void 0?r:this._subMeshToEffect.get(null);if(!o)return null;var l=this._subMeshToDepthEffect.get(t,n);l||(l={depthEffect:null,depthDefines:"",token:pw.a.RandomId()},this._subMeshToDepthEffect.set(t,n,l));var h=e.join(`
`);if(l.depthEffect&&h===l.depthDefines)return l.depthEffect;l.depthDefines=h;var v=o.rawVertexSourceCode,b=o.rawFragmentSourceCode,A=this._options&&this._options.remappedVariables?"#include<shadowMapVertexNormalBias>("+this._options.remappedVariables.join(",")+")":We.a.IncludesShadersStore.shadowMapVertexNormalBias,D=this._options&&this._options.remappedVariables?"#include<shadowMapVertexMetric>("+this._options.remappedVariables.join(",")+")":We.a.IncludesShadersStore.shadowMapVertexMetric,N=this._options&&this._options.remappedVariables?"#include<shadowMapFragmentSoftTransparentShadow>("+this._options.remappedVariables.join(",")+")":We.a.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow,j=We.a.IncludesShadersStore.shadowMapFragment;v=(v=(v=(v=v.replace(/void\s+?main/g,We.a.IncludesShadersStore.shadowMapVertexDeclaration+`\r
void main`)).replace(/#define SHADOWDEPTH_NORMALBIAS|#define CUSTOM_VERTEX_UPDATE_WORLDPOS/g,A)).indexOf("#define SHADOWDEPTH_METRIC")!==-1?v.replace(/#define SHADOWDEPTH_METRIC/g,D):v.replace(/}\s*$/g,D+`\r
}`)).replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var k=b.indexOf("#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW")>=0||b.indexOf("#define CUSTOM_FRAGMENT_BEFORE_FOG")>=0,H=b.indexOf("#define SHADOWDEPTH_FRAGMENT")!==-1,J="";k?b=b.replace(/#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW|#define CUSTOM_FRAGMENT_BEFORE_FOG/g,N):J=N+`\r
`,b=b.replace(/void\s+?main/g,We.a.IncludesShadersStore.shadowMapFragmentDeclaration+`\r
void main`),H?b=b.replace(/#define SHADOWDEPTH_FRAGMENT/g,j):J+=j+`\r
`,J&&(b=b.replace(/}\s*$/g,J+"}")),b=b.replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var te=o.getUniformNames().slice();return te.push("biasAndScaleSM","depthValuesSM","lightDataSM","softTransparentShadowSM"),l.depthEffect=this._scene.getEngine().createEffect({vertexSource:v,fragmentSource:b,vertexToken:l.token,fragmentToken:l.token},{attributes:o.getAttributesNames(),uniformsNames:te,uniformBuffersNames:o.getUniformBuffersNames(),samplers:o.getSamplers(),defines:h+`
`+o.defines.replace("#define SHADOWS","").replace(/#define SHADOW\d/g,""),indexParameters:o.getIndexParameters()},this._scene.getEngine()),l.depthEffect},i}(),wT=c(101);function Am(i,t,e,n,r){var o=new i.DecoderBuffer;o.Init(t,t.byteLength);var l,h,v=new i.Decoder;try{var b=v.GetEncodedGeometryType(o);switch(b){case i.TRIANGULAR_MESH:l=new i.Mesh,h=v.DecodeBufferToMesh(o,l);break;case i.POINT_CLOUD:l=new i.PointCloud,h=v.DecodeBufferToPointCloud(o,l);break;default:throw new Error("Invalid geometry type "+b)}if(!h.ok()||!l.ptr)throw new Error(h.error_msg());if(b===i.TRIANGULAR_MESH){var A=3*l.num_faces(),D=4*A,N=i._malloc(D);try{v.GetTrianglesUInt32Array(l,D,N);var j=new Uint32Array(A);j.set(new Uint32Array(i.HEAPF32.buffer,N,A)),n(j)}finally{i._free(N)}}var k=function(oe,ce){var he=ce.num_components(),_e=l.num_points(),ye=_e*he,Ee=ye*Float32Array.BYTES_PER_ELEMENT,Oe=i._malloc(Ee);try{v.GetAttributeDataArrayForAllPoints(l,ce,i.DT_FLOAT32,Ee,Oe);var Ae=new Float32Array(i.HEAPF32.buffer,Oe,ye);if(oe==="color"&&he===3){for(var xe=new Float32Array(4*_e),Pe=0,Be=0;Pe<xe.length;Pe+=4,Be+=he)xe[Pe+0]=Ae[Be+0],xe[Pe+1]=Ae[Be+1],xe[Pe+2]=Ae[Be+2],xe[Pe+3]=1;r(oe,xe)}else(xe=new Float32Array(ye)).set(new Float32Array(i.HEAPF32.buffer,Oe,ye)),r(oe,xe)}finally{i._free(Oe)}};if(e)for(var H in e){var J=e[H];k(H,v.GetAttributeByUniqueId(l,J))}else{var te={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var H in te)(J=v.GetAttributeId(l,i[te[H]]))!==-1&&k(H,v.GetAttribute(l,J))}}finally{l&&i.destroy(l),i.destroy(v),i.destroy(o)}}function gw(){var i;onmessage=function(t){var e=t.data;switch(e.id){case"init":var n=e.decoder;n.url&&(importScripts(n.url),i=DracoDecoderModule({wasmBinary:n.wasmBinary})),postMessage("done");break;case"decodeMesh":if(!i)throw new Error("Draco decoder module is not available");i.then(function(r){Am(r,e.dataView,e.attributes,function(o){postMessage({id:"indices",value:o},[o.buffer])},function(o,l){postMessage({id:o,value:l},[l.buffer])}),postMessage("done")})}}}function LT(i){return typeof document!="object"||typeof i!="string"?i:Qe.b.GetAbsoluteUrl(i)}var vw=function(){function i(t){t===void 0&&(t=i.DefaultNumWorkers);var e=i.Configuration.decoder,n=e.wasmUrl&&e.wasmBinaryUrl&&typeof WebAssembly=="object"?{url:e.wasmUrl,wasmBinaryPromise:Qe.b.LoadFileAsync(LT(e.wasmBinaryUrl))}:{url:e.fallbackUrl,wasmBinaryPromise:Promise.resolve(void 0)};t&&typeof Worker=="function"?this._workerPoolPromise=n.wasmBinaryPromise.then(function(r){for(var o=Am+"("+gw+")()",l=URL.createObjectURL(new Blob([o],{type:"application/javascript"})),h=new Array(t),v=0;v<h.length;v++)h[v]=new Promise(function(b,A){var D=new Worker(l),N=function(k){D.removeEventListener("error",N),D.removeEventListener("message",j),A(k)},j=function(k){k.data==="done"&&(D.removeEventListener("error",N),D.removeEventListener("message",j),b(D))};D.addEventListener("error",N),D.addEventListener("message",j),D.postMessage({id:"init",decoder:{url:LT(n.url),wasmBinary:r}})});return Promise.all(h).then(function(b){return new Wp(b)})}):this._decoderModulePromise=n.wasmBinaryPromise.then(function(r){if(!n.url)throw new Error("Draco decoder module is not available");return Qe.b.LoadScriptAsync(n.url).then(function(){return o=r,new Promise(function(l){DracoDecoderModule({wasmBinary:o}).then(function(h){l({module:h})})});var o})})}return Object.defineProperty(i,"DecoderAvailable",{get:function(){var t=i.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&typeof WebAssembly=="object"||t.fallbackUrl)},enumerable:!1,configurable:!0}),i.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(i,"Default",{get:function(){return i._Default||(i._Default=new i),i._Default},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(t){t.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},i.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},i.prototype.decodeMeshAsync=function(t,e){var n=t instanceof ArrayBuffer?new Uint8Array(t):t;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(r){return new Promise(function(o,l){r.push(function(h,v){var b=new _t.a,A=function(j){h.removeEventListener("error",A),h.removeEventListener("message",D),l(j),v()},D=function(j){j.data==="done"?(h.removeEventListener("error",A),h.removeEventListener("message",D),o(b),v()):j.data.id==="indices"?b.indices=j.data.value:b.set(j.data.value,j.data.id)};h.addEventListener("error",A),h.addEventListener("message",D);var N=new Uint8Array(n.byteLength);N.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),h.postMessage({id:"decodeMesh",dataView:N,attributes:e},[N.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(r){var o=new _t.a;return Am(r.module,n,e,function(l){o.indices=l},function(l,h){o.set(h,l)}),o});throw new Error("Draco decoder module is not available")},i.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i._Default=null,i}(),dl=c(61),NT=0,bw=function(){function i(t,e,n,r){this.pos=t,this.normal=e,this.uv=n,this.vertColor=r}return i.prototype.clone=function(){var t,e;return new i(this.pos.clone(),this.normal.clone(),(t=this.uv)===null||t===void 0?void 0:t.clone(),(e=this.vertColor)===null||e===void 0?void 0:e.clone())},i.prototype.flip=function(){this.normal=this.normal.scale(-1)},i.prototype.interpolate=function(t,e){return new i(d.e.Lerp(this.pos,t.pos,e),d.e.Lerp(this.normal,t.normal,e),this.uv&&t.uv?d.d.Lerp(this.uv,t.uv,e):void 0,this.vertColor&&t.vertColor?x.b.Lerp(this.vertColor,t.vertColor,e):void 0)},i}(),yw=function(){function i(t,e){this.normal=t,this.w=e}return i.FromPoints=function(t,e,n){var r=n.subtract(t),o=e.subtract(t);if(r.lengthSquared()===0||o.lengthSquared()===0)return null;var l=d.e.Normalize(d.e.Cross(r,o));return new i(l,d.e.Dot(l,t))},i.prototype.clone=function(){return new i(this.normal.clone(),this.w)},i.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},i.prototype.splitPolygon=function(t,e,n,r,o){var l,h,v=0,b=[];for(l=0;l<t.vertices.length;l++){var A=(h=d.e.Dot(this.normal,t.vertices[l].pos)-this.w)<-i.EPSILON?2:h>i.EPSILON?1:0;v|=A,b.push(A)}switch(v){case 0:(d.e.Dot(this.normal,t.plane.normal)>0?e:n).push(t);break;case 1:r.push(t);break;case 2:o.push(t);break;case 3:var D,N=[],j=[];for(l=0;l<t.vertices.length;l++){var k=(l+1)%t.vertices.length,H=b[l],J=b[k],te=t.vertices[l],oe=t.vertices[k];if(H!==2&&N.push(te),H!==1&&j.push(H!==2?te.clone():te),(H|J)==3){h=(this.w-d.e.Dot(this.normal,te.pos))/d.e.Dot(this.normal,oe.pos.subtract(te.pos));var ce=te.interpolate(oe,h);N.push(ce),j.push(ce.clone())}}N.length>=3&&(D=new Cm(N,t.shared)).plane&&r.push(D),j.length>=3&&(D=new Cm(j,t.shared)).plane&&o.push(D)}},i.EPSILON=1e-5,i}(),Cm=function(){function i(t,e){this.vertices=t,this.shared=e,this.plane=yw.FromPoints(t[0].pos,t[1].pos,t[2].pos)}return i.prototype.clone=function(){return new i(this.vertices.map(function(t){return t.clone()}),this.shared)},i.prototype.flip=function(){this.vertices.reverse().map(function(t){t.flip()}),this.plane.flip()},i}(),ni=function(){function i(t){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,t&&this.build(t)}return i.prototype.clone=function(){var t=new i;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},i.prototype.invert=function(){for(var t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var e=this.front;this.front=this.back,this.back=e},i.prototype.clipPolygons=function(t){if(!this.plane)return t.slice();for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],e,n,e,n);return this.front&&(e=this.front.clipPolygons(e)),n=this.back?this.back.clipPolygons(n):[],e.concat(n)},i.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},i.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},i.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var e=new Array,n=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,e,n);e.length&&(this.front||(this.front=new i),this.front.build(e)),n.length&&(this.back||(this.back=new i),this.back.build(n))}},i}(),Tw=function(){function i(){this.polygons=new Array}return i.FromMesh=function(t){var e,n,r,o,l,h,v,b,A,D=void 0,N=void 0,j=new Array,k=null;if(!(t instanceof Ne.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),h=t.getWorldMatrix(),v=t.position.clone(),b=t.rotation.clone(),t.rotationQuaternion&&(k=t.rotationQuaternion.clone()),A=t.scaling.clone();for(var H=t.getIndices(),J=t.getVerticesData(Me.b.PositionKind),te=t.getVerticesData(Me.b.NormalKind),oe=t.getVerticesData(Me.b.UVKind),ce=t.getVerticesData(Me.b.ColorKind),he=t.subMeshes,_e=0,ye=he.length;_e<ye;_e++)for(var Ee=he[_e].indexStart,Oe=he[_e].indexCount+he[_e].indexStart;Ee<Oe;Ee+=3){l=[];for(var Ae=0;Ae<3;Ae++){var xe=new d.e(te[3*H[Ee+Ae]],te[3*H[Ee+Ae]+1],te[3*H[Ee+Ae]+2]);oe&&(D=new d.d(oe[2*H[Ee+Ae]],oe[2*H[Ee+Ae]+1])),ce&&(N=new x.b(ce[4*H[Ee+Ae]],ce[4*H[Ee+Ae]+1],ce[4*H[Ee+Ae]+2],ce[4*H[Ee+Ae]+3]));var Pe=new d.e(J[3*H[Ee+Ae]],J[3*H[Ee+Ae]+1],J[3*H[Ee+Ae]+2]);r=d.e.TransformCoordinates(Pe,h),n=d.e.TransformNormal(xe,h),e=new bw(r,n,D,N),l.push(e)}(o=new Cm(l,{subMeshId:_e,meshId:NT,materialIndex:he[_e].materialIndex})).plane&&j.push(o)}var Be=i.FromPolygons(j);return Be.matrix=h,Be.position=v,Be.rotation=b,Be.scaling=A,Be.rotationQuaternion=k,NT++,Be},i.FromPolygons=function(t){var e=new i;return e.polygons=t,e},i.prototype.clone=function(){var t=new i;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},i.prototype.union=function(t){var e=new ni(this.clone().polygons),n=new ni(t.clone().polygons);return e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.unionInPlace=function(t){var e=new ni(this.polygons),n=new ni(t.polygons);e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),this.polygons=e.allPolygons()},i.prototype.subtract=function(t){var e=new ni(this.clone().polygons),n=new ni(t.clone().polygons);return e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.subtractInPlace=function(t){var e=new ni(this.polygons),n=new ni(t.polygons);e.invert(),e.clipTo(n),n.clipTo(e),n.invert(),n.clipTo(e),n.invert(),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.intersect=function(t){var e=new ni(this.clone().polygons),n=new ni(t.clone().polygons);return e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),i.FromPolygons(e.allPolygons()).copyTransformAttributes(this)},i.prototype.intersectInPlace=function(t){var e=new ni(this.polygons),n=new ni(t.polygons);e.invert(),n.clipTo(e),n.invert(),e.clipTo(n),n.clipTo(e),e.build(n.allPolygons()),e.invert(),this.polygons=e.allPolygons()},i.prototype.inverse=function(){var t=this.clone();return t.inverseInPlace(),t},i.prototype.inverseInPlace=function(){this.polygons.map(function(t){t.flip()})},i.prototype.copyTransformAttributes=function(t){return this.matrix=t.matrix,this.position=t.position,this.rotation=t.rotation,this.scaling=t.scaling,this.rotationQuaternion=t.rotationQuaternion,this},i.prototype.buildMeshGeometry=function(t,e,n){var r=this.matrix.clone();r.invert();var o,l,h,v=new Ne.a(t,e),b=[],A=[],D=[],N=null,j=null,k=d.e.Zero(),H=d.e.Zero(),J=d.d.Zero(),te=new x.b(0,0,0,0),oe=this.polygons,ce=[0,0,0],he={},_e=0,ye={};n&&oe.sort(function(ft,Je){return ft.shared.meshId===Je.shared.meshId?ft.shared.subMeshId-Je.shared.subMeshId:ft.shared.meshId-Je.shared.meshId});for(var Ee=0,Oe=oe.length;Ee<Oe;Ee++){ye[(o=oe[Ee]).shared.meshId]||(ye[o.shared.meshId]={}),ye[o.shared.meshId][o.shared.subMeshId]||(ye[o.shared.meshId][o.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:o.shared.materialIndex}),h=ye[o.shared.meshId][o.shared.subMeshId];for(var Ae=2,xe=o.vertices.length;Ae<xe;Ae++){ce[0]=0,ce[1]=Ae-1,ce[2]=Ae;for(var Pe=0;Pe<3;Pe++){k.copyFrom(o.vertices[ce[Pe]].pos),H.copyFrom(o.vertices[ce[Pe]].normal),o.vertices[ce[Pe]].uv&&(N||(N=[]),J.copyFrom(o.vertices[ce[Pe]].uv)),o.vertices[ce[Pe]].vertColor&&(j||(j=[]),te.copyFrom(o.vertices[ce[Pe]].vertColor));var Be=d.e.TransformCoordinates(k,r),Ce=d.e.TransformNormal(H,r);l=he[Be.x+","+Be.y+","+Be.z];var Ue=!1;N&&N[2*l]!==J.x&&N[2*l+1]!==J.y&&(Ue=!0);var Le=!1;j&&j[4*l]!==te.r&&j[4*l+1]!==te.g&&j[4*l+2]!==te.b&&j[4*l+3]!==te.a&&(Le=!0),(l===void 0||D[3*l]!==Ce.x||D[3*l+1]!==Ce.y||D[3*l+2]!==Ce.z||Ue||Le)&&(b.push(Be.x,Be.y,Be.z),N&&N.push(J.x,J.y),D.push(H.x,H.y,H.z),j&&j.push(te.r,te.g,te.b,te.a),l=he[Be.x+","+Be.y+","+Be.z]=b.length/3-1),A.push(l),h.indexStart=Math.min(_e,h.indexStart),h.indexEnd=Math.max(_e,h.indexEnd),_e++}}}if(v.setVerticesData(Me.b.PositionKind,b),v.setVerticesData(Me.b.NormalKind,D),N&&v.setVerticesData(Me.b.UVKind,N),j&&v.setVerticesData(Me.b.ColorKind,j),v.setIndices(A,null),n){var ke,qe=0;for(var at in v.subMeshes=new Array,ye){for(var lt in ke=-1,ye[at])h=ye[at][lt],dl.a.CreateFromIndices(h.materialIndex+qe,h.indexStart,h.indexEnd-h.indexStart+1,v),ke=Math.max(h.materialIndex,ke);qe+=++ke}}return v},i.prototype.toMesh=function(t,e,n,r){e===void 0&&(e=null);var o=this.buildMeshGeometry(t,n,r);return o.material=e,o.position.copyFrom(this.position),o.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(o.rotationQuaternion=this.rotationQuaternion.clone()),o.scaling.copyFrom(this.scaling),o.computeWorldMatrix(!0),o},i}(),Ew=function(i){function t(e,n,r,o,l,h){o===void 0&&(o=1),l===void 0&&(l=60),h===void 0&&(h=!0);var v=i.call(this,e,r)||this;v._sectionPolygonPointsCount=4,v._running=!1,v._autoStart=h,v._generator=n,v._diameter=o,v._length=l,v._sectionVectors=[],v._sectionNormalVectors=[];for(var b=0;b<v._sectionPolygonPointsCount;b++)v._sectionVectors[b]=d.e.Zero(),v._sectionNormalVectors[b]=d.e.Zero();return v._createMesh(),v}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new _t.a,n=[],r=[],o=[],l=d.e.Zero();l=this._generator instanceof Lt.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var h=2*Math.PI/this._sectionPolygonPointsCount,v=0;v<this._sectionPolygonPointsCount;v++)n.push(l.x+Math.cos(v*h)*this._diameter,l.y+Math.sin(v*h)*this._diameter,l.z);for(v=1;v<=this._length;v++){for(var b=0;b<this._sectionPolygonPointsCount;b++)n.push(l.x+Math.cos(b*h)*this._diameter,l.y+Math.sin(b*h)*this._diameter,l.z);var A=n.length/3-2*this._sectionPolygonPointsCount;for(b=0;b<this._sectionPolygonPointsCount-1;b++)o.push(A+b,A+b+this._sectionPolygonPointsCount,A+b+this._sectionPolygonPointsCount+1),o.push(A+b,A+b+this._sectionPolygonPointsCount+1,A+b+1);o.push(A+this._sectionPolygonPointsCount-1,A+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,A+this._sectionPolygonPointsCount),o.push(A+this._sectionPolygonPointsCount-1,A+this._sectionPolygonPointsCount,A)}_t.a.ComputeNormals(n,o,r),e.positions=n,e.normals=r,e.indices=o,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(Me.b.PositionKind),n=this.getVerticesData(Me.b.NormalKind),r=this._generator.getWorldMatrix();if(e&&n){for(var o=3*this._sectionPolygonPointsCount;o<e.length;o++)e[o-3*this._sectionPolygonPointsCount]=e[o]-n[o]/this._length*this._diameter;for(o=3*this._sectionPolygonPointsCount;o<n.length;o++)n[o-3*this._sectionPolygonPointsCount]=n[o];var l=e.length-3*this._sectionPolygonPointsCount,h=2*Math.PI/this._sectionPolygonPointsCount;for(o=0;o<this._sectionPolygonPointsCount;o++)this._sectionVectors[o].copyFromFloats(Math.cos(o*h)*this._diameter,Math.sin(o*h)*this._diameter,0),this._sectionNormalVectors[o].copyFromFloats(Math.cos(o*h),Math.sin(o*h),0),d.e.TransformCoordinatesToRef(this._sectionVectors[o],r,this._sectionVectors[o]),d.e.TransformNormalToRef(this._sectionNormalVectors[o],r,this._sectionNormalVectors[o]);for(o=0;o<this._sectionPolygonPointsCount;o++)e[l+3*o]=this._sectionVectors[o].x,e[l+3*o+1]=this._sectionVectors[o].y,e[l+3*o+2]=this._sectionVectors[o].z,n[l+3*o]=this._sectionNormalVectors[o].x,n[l+3*o+1]=this._sectionNormalVectors[o].y,n[l+3*o+2]=this._sectionNormalVectors[o].z;this.updateVerticesData(Me.b.PositionKind,e,!0,!1),this.updateVerticesData(Me.b.NormalKind,n,!0,!1)}},t.prototype.clone=function(e,n){return e===void 0&&(e=""),new t(e,n===void 0?this._generator:n,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(e){i.prototype.serialize.call(this,e)},t.Parse=function(e,n){return new t(e.name,e._generator,n,e._diameter,e._length,e._autoStart)},t}(Ne.a),Sw=c(151),fl=c(98),pl=c(82);_t.a.CreateDisc=function(i){var t=new Array,e=new Array,n=new Array,r=new Array,o=i.radius||.5,l=i.tessellation||64,h=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,v=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);for(var b=2*Math.PI*h,A=h===1?b/l:b/(l-1),D=0,N=0;N<l;N++){var j=Math.cos(D),k=Math.sin(D),H=(j+1)/2,J=(1-k)/2;t.push(o*j,o*k,0),r.push(H,J),D+=A}h===1&&(t.push(t[3],t[4],t[5]),r.push(r[2],r[3]));for(var te=t.length/3,oe=1;oe<te-1;oe++)e.push(oe+1,0,oe);_t.a.ComputeNormals(t,e,n),_t.a._ComputeSides(v,t,e,n,r,i.frontUVs,i.backUVs);var ce=new _t.a;return ce.indices=e,ce.positions=t,ce.normals=n,ce.uvs=r,ce},Ne.a.CreateDisc=function(i,t,e,n,r,o){n===void 0&&(n=null);var l={radius:t,tessellation:e,sideOrientation:o,updatable:r};return Oh.CreateDisc(i,l,n)};var Oh=function(){function i(){}return i.CreateDisc=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateDisc(e).applyToMesh(r,e.updatable),r},i}();_t.a.CreateTiledBox=function(i){for(var t=i.faceUV||new Array(6),e=i.faceColors,n=i.pattern||Ne.a.NO_FLIP,r=i.width||i.size||1,o=i.height||i.size||1,l=i.depth||i.size||1,h=i.tileWidth||i.tileSize||1,v=i.tileHeight||i.tileSize||1,b=i.alignHorizontal||0,A=i.alignVertical||0,D=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE,N=0;N<6;N++)t[N]===void 0&&(t[N]=new d.f(0,0,1,1)),e&&e[N]===void 0&&(e[N]=new x.b(1,1,1,1));var j=r/2,k=o/2,H=l/2,J=[];for(N=0;N<2;N++)J[N]=_t.a.CreateTiledPlane({pattern:n,tileWidth:h,tileHeight:v,width:r,height:o,alignVertical:A,alignHorizontal:b,sideOrientation:D});for(N=2;N<4;N++)J[N]=_t.a.CreateTiledPlane({pattern:n,tileWidth:h,tileHeight:v,width:l,height:o,alignVertical:A,alignHorizontal:b,sideOrientation:D});var te=A;for(A===Ne.a.BOTTOM?te=Ne.a.TOP:A===Ne.a.TOP&&(te=Ne.a.BOTTOM),N=4;N<6;N++)J[N]=_t.a.CreateTiledPlane({pattern:n,tileWidth:h,tileHeight:v,width:r,height:l,alignVertical:te,alignHorizontal:b,sideOrientation:D});var oe=[],ce=[],he=[],_e=[],ye=[],Ee=[],Oe=[],Ae=[],xe=0,Pe=0,Be=0;for(N=0;N<6;N++){xe=J[N].positions.length,Ee[N]=[],Oe[N]=[];for(var Ce=0;Ce<xe/3;Ce++)Ee[N].push(new d.e(J[N].positions[3*Ce],J[N].positions[3*Ce+1],J[N].positions[3*Ce+2])),Oe[N].push(new d.e(J[N].normals[3*Ce],J[N].normals[3*Ce+1],J[N].normals[3*Ce+2]));Pe=J[N].uvs.length,Ae[N]=[];for(var Ue=0;Ue<Pe;Ue+=2)Ae[N][Ue]=t[N].x+(t[N].z-t[N].x)*J[N].uvs[Ue],Ae[N][Ue+1]=t[N].y+(t[N].w-t[N].y)*J[N].uvs[Ue+1];if(he=he.concat(Ae[N]),_e=_e.concat(J[N].indices.map(function(ze){return ze+Be})),Be+=Ee[N].length,e)for(var Le=0;Le<4;Le++)ye.push(e[N].r,e[N].g,e[N].b,e[N].a)}var ke=new d.e(0,0,H),qe=d.a.RotationY(Math.PI);oe=Ee[0].map(function(ze){return d.e.TransformNormal(ze,qe).add(ke)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]),ce=Oe[0].map(function(ze){return d.e.TransformNormal(ze,qe)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]),oe=oe.concat(Ee[1].map(function(ze){return ze.subtract(ke)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),ce=ce.concat(Oe[1].map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]));var at=new d.e(j,0,0),lt=d.a.RotationY(-Math.PI/2);oe=oe.concat(Ee[2].map(function(ze){return d.e.TransformNormal(ze,lt).add(at)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),ce=ce.concat(Oe[2].map(function(ze){return d.e.TransformNormal(ze,lt)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]));var ft=d.a.RotationY(Math.PI/2);oe=oe.concat(Ee[3].map(function(ze){return d.e.TransformNormal(ze,ft).subtract(at)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),ce=ce.concat(Oe[3].map(function(ze){return d.e.TransformNormal(ze,ft)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]));var Je=new d.e(0,k,0),dt=d.a.RotationX(Math.PI/2);oe=oe.concat(Ee[4].map(function(ze){return d.e.TransformNormal(ze,dt).add(Je)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),ce=ce.concat(Oe[4].map(function(ze){return d.e.TransformNormal(ze,dt)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[]));var ut=d.a.RotationX(-Math.PI/2);oe=oe.concat(Ee[5].map(function(ze){return d.e.TransformNormal(ze,ut).subtract(Je)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),ce=ce.concat(Oe[5].map(function(ze){return d.e.TransformNormal(ze,ut)}).map(function(ze){return[ze.x,ze.y,ze.z]}).reduce(function(ze,rt){return ze.concat(rt)},[])),_t.a._ComputeSides(D,oe,_e,ce,he);var tt=new _t.a;if(tt.indices=_e,tt.positions=oe,tt.normals=ce,tt.uvs=he,e){var mt=D===_t.a.DOUBLESIDE?ye.concat(ye):ye;tt.colors=mt}return tt};var FT=function(){function i(){}return i.CreateTiledBox=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateTiledBox(e).applyToMesh(r,e.updatable),r},i}();_t.a.CreateTorusKnot=function(i){var t,e,n=new Array,r=new Array,o=new Array,l=new Array,h=i.radius||2,v=i.tube||.5,b=i.radialSegments||32,A=i.tubularSegments||32,D=i.p||2,N=i.q||3,j=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE,k=function(Ue){var Le=Math.cos(Ue),ke=Math.sin(Ue),qe=N/D*Ue,at=Math.cos(qe),lt=h*(2+at)*.5*Le,ft=h*(2+at)*ke*.5,Je=h*Math.sin(qe)*.5;return new d.e(lt,ft,Je)};for(t=0;t<=b;t++){var H=t%b/b*2*D*Math.PI,J=k(H),te=k(H+.01),oe=te.subtract(J),ce=te.add(J),he=d.e.Cross(oe,ce);for(ce=d.e.Cross(he,oe),he.normalize(),ce.normalize(),e=0;e<A;e++){var _e=e%A/A*2*Math.PI,ye=-v*Math.cos(_e),Ee=v*Math.sin(_e);r.push(J.x+ye*ce.x+Ee*he.x),r.push(J.y+ye*ce.y+Ee*he.y),r.push(J.z+ye*ce.z+Ee*he.z),l.push(t/b),l.push(e/A)}}for(t=0;t<b;t++)for(e=0;e<A;e++){var Oe=(e+1)%A,Ae=t*A+e,xe=(t+1)*A+e,Pe=(t+1)*A+Oe,Be=t*A+Oe;n.push(Be),n.push(xe),n.push(Ae),n.push(Be),n.push(Pe),n.push(xe)}_t.a.ComputeNormals(r,n,o),_t.a._ComputeSides(j,r,n,o,l,i.frontUVs,i.backUVs);var Ce=new _t.a;return Ce.indices=n,Ce.positions=r,Ce.normals=o,Ce.uvs=l,Ce},Ne.a.CreateTorusKnot=function(i,t,e,n,r,o,l,h,v,b){var A={radius:t,tube:e,radialSegments:n,tubularSegments:r,p:o,q:l,sideOrientation:b,updatable:v};return Rm.CreateTorusKnot(i,A,h)};var Rm=function(){function i(){}return i.CreateTorusKnot=function(t,e,n){var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateTorusKnot(e).applyToMesh(r,e.updatable),r},i}(),xw=function(i){function t(e,n){var r=i.call(this,e.x,e.y)||this;return r.index=n,r}return Object(_.d)(t,i),t}(d.d),Om=function(){function i(){this.elements=new Array}return i.prototype.add=function(t){var e=this,n=new Array;return t.forEach(function(r){var o=new xw(r,e.elements.length);n.push(o),e.elements.push(o)}),n},i.prototype.computeBounds=function(){var t=new d.d(this.elements[0].x,this.elements[0].y),e=new d.d(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<t.x?t.x=n.x:n.x>e.x&&(e.x=n.x),n.y<t.y?t.y=n.y:n.y>e.y&&(e.y=n.y)}),{min:t,max:e,width:e.x-t.x,height:e.y-t.y}},i}(),Pw=function(){function i(){}return i.Rectangle=function(t,e,n,r){return[new d.d(t,e),new d.d(n,e),new d.d(n,r),new d.d(t,r)]},i.Circle=function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=32);for(var o=new Array,l=0,h=2*Math.PI/r,v=0;v<r;v++)o.push(new d.d(e+Math.cos(l)*t,n+Math.sin(l)*t)),l-=h;return o},i.Parse=function(t){var e,n=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(o){return!isNaN(o)}),r=[];for(e=0;e<(2147483646&n.length);e+=2)r.push(new d.d(n[e],n[e+1]));return r},i.StartingAt=function(t,e){return ht.f.StartingAt(t,e)},i}(),BT=function(){function i(t,e,n,r){var o;r===void 0&&(r=earcut),this._points=new Om,this._outlinepoints=new Om,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=t,this._scene=n||Xe.a.LastCreatedScene,o=e instanceof ht.f?e.getPoints():e,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),this.bjsEarcut===void 0&&p.a.Warn("Earcut was not found, the polygon will not be built.")}return i.prototype._addToepoint=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this._epoints.push(r.x,r.y)}},i.prototype.addHole=function(t){this._points.add(t);var e=new Om;return e.add(t),this._holes.push(e),this._eholes.push(this._epoints.length/2),this._addToepoint(t),this},i.prototype.build=function(t,e){t===void 0&&(t=!1),e===void 0&&(e=0);var n=new Ne.a(this._name,this._scene),r=this.buildVertexData(e);return n.setVerticesData(Me.b.PositionKind,r.positions,t),n.setVerticesData(Me.b.NormalKind,r.normals,t),n.setVerticesData(Me.b.UVKind,r.uvs,t),n.setIndices(r.indices),n},i.prototype.buildVertexData=function(t){var e=this;t===void 0&&(t=0);var n=new _t.a,r=new Array,o=new Array,l=new Array,h=this._points.computeBounds();this._points.elements.forEach(function(J){r.push(0,1,0),o.push(J.x,0,J.y),l.push((J.x-h.min.x)/h.width,(J.y-h.min.y)/h.height)});for(var v=new Array,b=this.bjsEarcut(this._epoints,this._eholes,2),A=0;A<b.length;A++)v.push(b[A]);if(t>0){var D=o.length/3;this._points.elements.forEach(function(J){r.push(0,-1,0),o.push(J.x,-t,J.y),l.push(1-(J.x-h.min.x)/h.width,1-(J.y-h.min.y)/h.height)});var N=v.length;for(A=0;A<N;A+=3){var j=v[A+0],k=v[A+1],H=v[A+2];v.push(H+D),v.push(k+D),v.push(j+D)}this.addSide(o,r,l,v,h,this._outlinepoints,t,!1),this._holes.forEach(function(J){e.addSide(o,r,l,v,h,J,t,!0)})}return n.indices=v,n.positions=o,n.normals=r,n.uvs=l,n},i.prototype.addSide=function(t,e,n,r,o,l,h,v){for(var b=t.length/3,A=0,D=0;D<l.elements.length;D++){var N,j=l.elements[D];N=D+1>l.elements.length-1?l.elements[0]:l.elements[D+1],t.push(j.x,0,j.y),t.push(j.x,-h,j.y),t.push(N.x,0,N.y),t.push(N.x,-h,N.y);var k=new d.e(j.x,0,j.y),H=new d.e(N.x,0,N.y).subtract(k),J=new d.e(0,1,0),te=d.e.Cross(H,J);te=te.normalize(),n.push(A/o.width,0),n.push(A/o.width,1),A+=H.length(),n.push(A/o.width,0),n.push(A/o.width,1),v?(e.push(te.x,te.y,te.z),e.push(te.x,te.y,te.z),e.push(te.x,te.y,te.z),e.push(te.x,te.y,te.z),r.push(b),r.push(b+2),r.push(b+1),r.push(b+1),r.push(b+2),r.push(b+3)):(e.push(-te.x,-te.y,-te.z),e.push(-te.x,-te.y,-te.z),e.push(-te.x,-te.y,-te.z),e.push(-te.x,-te.y,-te.z),r.push(b),r.push(b+1),r.push(b+2),r.push(b+1),r.push(b+3),r.push(b+2)),b+=4}},i}();_t.a.CreatePolygon=function(i,t,e,n,r,o,l){for(var h=e||new Array(3),v=n,b=[],A=l||!1,D=0;D<3;D++)h[D]===void 0&&(h[D]=new d.f(0,0,1,1)),v&&v[D]===void 0&&(v[D]=new x.b(1,1,1,1));var N=i.getVerticesData(Me.b.PositionKind),j=i.getVerticesData(Me.b.NormalKind),k=i.getVerticesData(Me.b.UVKind),H=i.getIndices(),J=N.length/9,te=0,oe=0,ce=0,he=0,_e=[0];if(A)for(var ye=J;ye<N.length/3;ye+=4)oe=N[3*(ye+2)]-N[3*ye],ce=N[3*(ye+2)+2]-N[3*ye+2],he+=Math.sqrt(oe*oe+ce*ce),_e.push(he);ye=0;for(var Ee=0,Oe=0;Oe<j.length;Oe+=3)Math.abs(j[Oe+1])<.001&&(Ee=1),Math.abs(j[Oe+1]-1)<.001&&(Ee=0),Math.abs(j[Oe+1]+1)<.001&&(Ee=2),ye=Oe/3,Ee===1?(te=ye-J,k[2*ye]=te%4<1.5?A?h[Ee].x+(h[Ee].z-h[Ee].x)*_e[Math.floor(te/4)]/he:h[Ee].x:A?h[Ee].x+(h[Ee].z-h[Ee].x)*_e[Math.floor(te/4)+1]/he:h[Ee].z,k[2*ye+1]=te%2==0?h[Ee].w:h[Ee].y):(k[2*ye]=(1-k[2*ye])*h[Ee].x+k[2*ye]*h[Ee].z,k[2*ye+1]=(1-k[2*ye+1])*h[Ee].y+k[2*ye+1]*h[Ee].w),v&&b.push(v[Ee].r,v[Ee].g,v[Ee].b,v[Ee].a);_t.a._ComputeSides(t,N,H,j,k,r,o);var Ae=new _t.a;if(Ae.indices=H,Ae.positions=N,Ae.normals=j,Ae.uvs=k,v){var xe=t===_t.a.DOUBLESIDE?b.concat(b):b;Ae.colors=xe}return Ae},Ne.a.CreatePolygon=function(i,t,e,n,r,o,l){l===void 0&&(l=earcut);var h={shape:t,holes:n,updatable:r,sideOrientation:o};return ml.CreatePolygon(i,h,e,l)},Ne.a.ExtrudePolygon=function(i,t,e,n,r,o,l,h){h===void 0&&(h=earcut);var v={shape:t,holes:r,depth:e,updatable:o,sideOrientation:l};return ml.ExtrudePolygon(i,v,n,h)};var ml=function(){function i(){}return i.CreatePolygon=function(t,e,n,r){n===void 0&&(n=null),r===void 0&&(r=earcut),e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation);for(var o=e.shape,l=e.holes||[],h=e.depth||0,v=[],b=[],A=0;A<o.length;A++)v[A]=new d.d(o[A].x,o[A].z);v[0].equalsWithEpsilon(v[v.length-1],1e-8)&&v.pop();for(var D=new BT(t,v,n||$.a.LastCreatedScene,r),N=0;N<l.length;N++){b=[];for(var j=0;j<l[N].length;j++)b.push(new d.d(l[N][j].x,l[N][j].z));D.addHole(b)}var k=D.build(e.updatable,h);return k._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreatePolygon(k,e.sideOrientation,e.faceUV,e.faceColors,e.frontUVs,e.backUVs,e.wrap).applyToMesh(k,e.updatable),k},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),i.CreatePolygon(t,e,n,r)},i}();Ne.a.CreateLathe=function(i,t,e,n,r,o,l){var h={shape:t,radius:e,tessellation:n,sideOrientation:l,updatable:o};return Mm.CreateLathe(i,h,r)};var Mm=function(){function i(){}return i.CreateLathe=function(t,e,n){n===void 0&&(n=null);var r,o=e.arc?e.arc<=0||e.arc>1?1:e.arc:1,l=e.closed===void 0||e.closed,h=e.shape,v=e.radius||1,b=e.tessellation||64,A=e.clip||0,D=e.updatable,N=Ne.a._GetDefaultSideOrientation(e.sideOrientation),j=e.cap||Ne.a.NO_CAP,k=2*Math.PI,H=new Array,J=e.invertUV||!1,te=0,oe=0,ce=k/b*o,he=new Array;for(te=0;te<=b-A;te++){for(he=[],j!=Ne.a.CAP_START&&j!=Ne.a.CAP_ALL||(he.push(new d.e(0,h[0].y,0)),he.push(new d.e(Math.cos(te*ce)*h[0].x*v,h[0].y,Math.sin(te*ce)*h[0].x*v))),oe=0;oe<h.length;oe++)r=new d.e(Math.cos(te*ce)*h[oe].x*v,h[oe].y,Math.sin(te*ce)*h[oe].x*v),he.push(r);j!=Ne.a.CAP_END&&j!=Ne.a.CAP_ALL||(he.push(new d.e(Math.cos(te*ce)*h[h.length-1].x*v,h[h.length-1].y,Math.sin(te*ce)*h[h.length-1].x*v)),he.push(new d.e(0,h[h.length-1].y,0))),H.push(he)}return pl.a.CreateRibbon(t,{pathArray:H,closeArray:l,sideOrientation:N,updatable:D,invertUV:J,frontUVs:e.frontUVs,backUVs:e.backUVs},n)},i}();_t.a.CreateTiledPlane=function(i){var t=i.pattern||Ne.a.NO_FLIP,e=i.tileWidth||i.tileSize||1,n=i.tileHeight||i.tileSize||1,r=i.alignHorizontal||0,o=i.alignVertical||0,l=i.width||i.size||1,h=Math.floor(l/e),v=l-h*e,b=i.height||i.size||1,A=Math.floor(b/n),D=b-A*n,N=e*h/2,j=n*A/2,k=0,H=0,J=0,te=0,oe=0,ce=0;if(v>0||D>0){switch(J=-N,te=-j,oe=N,ce=j,r){case Ne.a.CENTER:J-=v/=2,oe+=v;break;case Ne.a.LEFT:oe+=v,k=-v/2;break;case Ne.a.RIGHT:J-=v,k=v/2}switch(o){case Ne.a.CENTER:te-=D/=2,ce+=D;break;case Ne.a.BOTTOM:ce+=D,H=-D/2;break;case Ne.a.TOP:te-=D,H=D/2}}var he=[],_e=[],ye=[];ye[0]=[0,0,1,0,1,1,0,1],ye[1]=[0,0,1,0,1,1,0,1],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(ye[1]=[1,1,0,1,0,0,1,0]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(ye[1]=[1,0,0,0,0,1,1,1]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(ye[1]=[0,1,1,1,1,0,0,0]);for(var Ee=[],Oe=[],Ae=[],xe=0,Pe=0;Pe<A;Pe++)for(var Be=0;Be<h;Be++)he.push(Be*e-N+k,Pe*n-j+H,0),he.push((Be+1)*e-N+k,Pe*n-j+H,0),he.push((Be+1)*e-N+k,(Pe+1)*n-j+H,0),he.push(Be*e-N+k,(Pe+1)*n-j+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),Ee=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ee.concat(ye[(Be%2+Pe%2)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ee.concat(ye[Pe%2]):Ee.concat(ye[0]),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),xe+=4;if(v>0||D>0){var Ce,Ue,Le,ke,qe=D>0&&(o===Ne.a.CENTER||o===Ne.a.TOP),at=D>0&&(o===Ne.a.CENTER||o===Ne.a.BOTTOM),lt=v>0&&(r===Ne.a.CENTER||r===Ne.a.RIGHT),ft=v>0&&(r===Ne.a.CENTER||r===Ne.a.LEFT),Je=[];if(qe&&lt&&(he.push(J+k,te+H,0),he.push(-N+k,te+H,0),he.push(-N+k,te+D+H,0),he.push(J+k,te+D+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Je=[Ce=1-v/e,Ue=1-D/n,Le=1,Ue,Le,ke=1,Ce,ke],t===Ne.a.ROTATE_ROW&&(Je=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),t===Ne.a.FLIP_ROW&&(Je=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),t===Ne.a.FLIP_N_ROTATE_ROW&&(Je=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Ee=Ee.concat(Je),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),qe&&ft&&(he.push(N+k,te+H,0),he.push(oe+k,te+H,0),he.push(oe+k,te+D+H,0),he.push(N+k,te+D+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Je=[Ce=0,Ue=1-D/n,Le=v/e,Ue,Le,ke=1,Ce,ke],(t===Ne.a.ROTATE_ROW||t===Ne.a.ROTATE_TILE&&h%2==0)&&(Je=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),(t===Ne.a.FLIP_ROW||t===Ne.a.FLIP_TILE&&h%2==0)&&(Je=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),(t===Ne.a.FLIP_N_ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_TILE&&h%2==0)&&(Je=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Ee=Ee.concat(Je),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),at&&lt&&(he.push(J+k,j+H,0),he.push(-N+k,j+H,0),he.push(-N+k,ce+H,0),he.push(J+k,ce+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Je=[Ce=1-v/e,Ue=0,Le=1,Ue,Le,ke=D/n,Ce,ke],(t===Ne.a.ROTATE_ROW&&A%2==1||t===Ne.a.ROTATE_TILE&&A%1==0)&&(Je=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),(t===Ne.a.FLIP_ROW&&A%2==1||t===Ne.a.FLIP_TILE&&A%2==0)&&(Je=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),(t===Ne.a.FLIP_N_ROTATE_ROW&&A%2==1||t===Ne.a.FLIP_N_ROTATE_TILE&&A%2==0)&&(Je=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Ee=Ee.concat(Je),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),at&&ft&&(he.push(N+k,j+H,0),he.push(oe+k,j+H,0),he.push(oe+k,ce+H,0),he.push(N+k,ce+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Je=[Ce=0,Ue=0,Le=v/e,Ue,Le,ke=D/n,Ce,ke],(t===Ne.a.ROTATE_ROW&&A%2==1||t===Ne.a.ROTATE_TILE&&(A+h)%2==1)&&(Je=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),(t===Ne.a.FLIP_ROW&&A%2==1||t===Ne.a.FLIP_TILE&&(A+h)%2==1)&&(Je=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),(t===Ne.a.FLIP_N_ROTATE_ROW&&A%2==1||t===Ne.a.FLIP_N_ROTATE_TILE&&(A+h)%2==1)&&(Je=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Ee=Ee.concat(Je),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),qe){var dt=[];for(Ce=0,Ue=1-D/n,Le=1,ke=1,dt[0]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],dt[1]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(dt[1]=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(dt[1]=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(dt[1]=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Be=0;Be<h;Be++)he.push(Be*e-N+k,te+H,0),he.push((Be+1)*e-N+k,te+H,0),he.push((Be+1)*e-N+k,te+D+H,0),he.push(Be*e-N+k,te+D+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Ee=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ee.concat(dt[(Be+1)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ee.concat(dt[1]):Ee.concat(dt[0]),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(at){var ut=[];for(Ce=0,Ue=0,Le=1,ke=D/n,ut[0]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],ut[1]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(ut[1]=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(ut[1]=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(ut[1]=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Be=0;Be<h;Be++)he.push(Be*e-N+k,ce-D+H,0),he.push((Be+1)*e-N+k,ce-D+H,0),he.push((Be+1)*e-N+k,ce+H,0),he.push(Be*e-N+k,ce+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Ee=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ee.concat(ut[(Be+A)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ee.concat(ut[A%2]):Ee.concat(ut[0]),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(lt){var tt=[];for(Ce=1-v/e,Ue=0,Le=1,ke=1,tt[0]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],tt[1]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(tt[1]=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(tt[1]=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(tt[1]=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Pe=0;Pe<A;Pe++)he.push(J+k,Pe*n-j+H,0),he.push(J+v+k,Pe*n-j+H,0),he.push(J+v+k,(Pe+1)*n-j+H,0),he.push(J+k,(Pe+1)*n-j+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Ee=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ee.concat(tt[(Pe+1)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ee.concat(tt[Pe%2]):Ee.concat(tt[0]),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(ft){var mt=[];for(Ce=0,Ue=0,Le=v/n,ke=1,mt[0]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],mt[1]=[Ce,Ue,Le,Ue,Le,ke,Ce,ke],t!==Ne.a.ROTATE_TILE&&t!==Ne.a.ROTATE_ROW||(mt[1]=[1-Ce,1-Ue,1-Le,1-Ue,1-Le,1-ke,1-Ce,1-ke]),t!==Ne.a.FLIP_TILE&&t!==Ne.a.FLIP_ROW||(mt[1]=[1-Ce,Ue,1-Le,Ue,1-Le,ke,1-Ce,ke]),t!==Ne.a.FLIP_N_ROTATE_TILE&&t!==Ne.a.FLIP_N_ROTATE_ROW||(mt[1]=[Ce,1-Ue,Le,1-Ue,Le,1-ke,Ce,1-ke]),Pe=0;Pe<A;Pe++)he.push(oe-v+k,Pe*n-j+H,0),he.push(oe+k,Pe*n-j+H,0),he.push(oe+k,(Pe+1)*n-j+H,0),he.push(oe-v+k,(Pe+1)*n-j+H,0),Ae.push(xe,xe+1,xe+3,xe+1,xe+2,xe+3),xe+=4,Ee=t===Ne.a.FLIP_TILE||t===Ne.a.ROTATE_TILE||t===Ne.a.FLIP_N_ROTATE_TILE?Ee.concat(mt[(Pe+h)%2]):t===Ne.a.FLIP_ROW||t===Ne.a.ROTATE_ROW||t===Ne.a.FLIP_N_ROTATE_ROW?Ee.concat(mt[Pe%2]):Ee.concat(mt[0]),Oe.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),_e.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var ze=i.sideOrientation===0?0:i.sideOrientation||_t.a.DEFAULTSIDE;_t.a._ComputeSides(ze,he,Ae,_e,Ee,i.frontUVs,i.backUVs);var rt=new _t.a;rt.indices=Ae,rt.positions=he,rt.normals=_e,rt.uvs=Ee;var At=ze===_t.a.DOUBLESIDE?Oe.concat(Oe):Oe;return rt.colors=At,rt};var UT=function(){function i(){}return i.CreateTiledPlane=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateTiledPlane(e).applyToMesh(r,e.updatable),r},i}();Ne.a.CreateTube=function(i,t,e,n,r,o,l,h,v,b){var A={path:t,radius:e,tessellation:n,radiusFunction:r,arc:1,cap:o,updatable:h,sideOrientation:v,instance:b};return Im.CreateTube(i,A,l)};var Im=function(){function i(){}return i.CreateTube=function(t,e,n){n===void 0&&(n=null);var r=e.path,o=e.instance,l=1;e.radius!==void 0?l=e.radius:o&&(l=o._creationDataStorage.radius);var h=e.tessellation||64,v=e.radiusFunction||null,b=e.cap||Ne.a.NO_CAP,A=e.invertUV||!1,D=e.updatable,N=Ne.a._GetDefaultSideOrientation(e.sideOrientation);e.arc=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1;var j,k,H=function(ce,he,_e,ye,Ee,Oe,Ae,xe){for(var Pe,Be,Ce,Ue,Le=he.getTangents(),ke=he.getNormals(),qe=he.getDistances(),at=2*Math.PI/Ee*xe,lt=Oe||function(){return ye},ft=d.c.Matrix[0],Je=Ae===Ne.a.NO_CAP||Ae===Ne.a.CAP_END?0:2,dt=0;dt<ce.length;dt++){Be=lt(dt,qe[dt]),Pe=Array(),Ce=ke[dt];for(var ut=0;ut<Ee;ut++)d.a.RotationAxisToRef(Le[dt],at*ut,ft),Ue=Pe[ut]?Pe[ut]:d.e.Zero(),d.e.TransformCoordinatesToRef(Ce,ft,Ue),Ue.scaleInPlace(Be).addInPlace(ce[dt]),Pe[ut]=Ue;_e[Je]=Pe,Je++}var tt=function(mt,ze){for(var rt=Array(),At=0;At<mt;At++)rt.push(ce[ze]);return rt};switch(Ae){case Ne.a.NO_CAP:break;case Ne.a.CAP_START:_e[0]=tt(Ee,0),_e[1]=_e[2].slice(0);break;case Ne.a.CAP_END:_e[Je]=_e[Je-1].slice(0),_e[Je+1]=tt(Ee,ce.length-1);break;case Ne.a.CAP_ALL:_e[0]=tt(Ee,0),_e[1]=_e[2].slice(0),_e[Je]=_e[Je-1].slice(0),_e[Je+1]=tt(Ee,ce.length-1)}return _e};if(o){var J=o._creationDataStorage,te=e.arc||J.arc;return k=H(r,j=J.path3D.update(r),J.pathArray,l,J.tessellation,v,J.cap,te),o=pl.a.CreateRibbon("",{pathArray:k,instance:o}),J.path3D=j,J.pathArray=k,J.arc=te,J.radius=l,o}k=H(r,j=new ht.g(r),new Array,l,h,v,b=b<0||b>3?0:b,e.arc);var oe=pl.a.CreateRibbon(t,{pathArray:k,closePath:!0,closeArray:!1,updatable:D,sideOrientation:N,invertUV:A,frontUVs:e.frontUVs,backUVs:e.backUVs},n);return oe._creationDataStorage.pathArray=k,oe._creationDataStorage.path3D=j,oe._creationDataStorage.tessellation=h,oe._creationDataStorage.cap=b,oe._creationDataStorage.arc=e.arc,oe._creationDataStorage.radius=l,oe},i}();_t.a.CreateIcoSphere=function(i){var t,e=i.sideOrientation||_t.a.DEFAULTSIDE,n=i.radius||1,r=i.flat===void 0||i.flat,o=i.subdivisions||4,l=i.radiusX||n,h=i.radiusY||n,v=i.radiusZ||n,b=(1+Math.sqrt(5))/2,A=[-1,b,-0,1,b,0,-1,-b,0,1,-b,0,0,-1,-b,0,1,-b,0,-1,b,0,1,b,b,0,1,b,0,-1,-b,0,1,-b,0,-1],D=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],N=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],j=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],H=new Array,J=new Array,te=new Array,oe=new Array,ce=0,he=new Array(3),_e=new Array(3);for(t=0;t<3;t++)he[t]=d.e.Zero(),_e[t]=d.d.Zero();for(var ye=0;ye<20;ye++){for(t=0;t<3;t++){var Ee=D[3*ye+t];he[t].copyFromFloats(A[3*N[Ee]],A[3*N[Ee]+1],A[3*N[Ee]+2]),he[t].normalize().scaleInPlace(n),_e[t].copyFromFloats(j[2*Ee]*(138/1024)+60/1024+k[ye]*(-40/1024),j[2*Ee+1]*(239/1024)+26/1024+k[ye]*(20/1024))}for(var Oe=function(Be,Ce,Ue,Le){var ke,qe=d.e.Lerp(he[0],he[2],Ce/o),at=d.e.Lerp(he[1],he[2],Ce/o),lt=o===Ce?he[2]:d.e.Lerp(qe,at,Be/(o-Ce));if(lt.normalize(),r){var ft=d.e.Lerp(he[0],he[2],Le/o),Je=d.e.Lerp(he[1],he[2],Le/o);ke=d.e.Lerp(ft,Je,Ue/(o-Le))}else ke=new d.e(lt.x,lt.y,lt.z);ke.x/=l,ke.y/=h,ke.z/=v,ke.normalize();var dt=d.d.Lerp(_e[0],_e[2],Ce/o),ut=d.d.Lerp(_e[1],_e[2],Ce/o),tt=o===Ce?_e[2]:d.d.Lerp(dt,ut,Be/(o-Ce));J.push(lt.x*l,lt.y*h,lt.z*v),te.push(ke.x,ke.y,ke.z),oe.push(tt.x,tt.y),H.push(ce),ce++},Ae=0;Ae<o;Ae++)for(var xe=0;xe+Ae<o;xe++)Oe(xe,Ae,xe+1/3,Ae+1/3),Oe(xe+1,Ae,xe+1/3,Ae+1/3),Oe(xe,Ae+1,xe+1/3,Ae+1/3),xe+Ae+1<o&&(Oe(xe+1,Ae,xe+2/3,Ae+2/3),Oe(xe+1,Ae+1,xe+2/3,Ae+2/3),Oe(xe,Ae+1,xe+2/3,Ae+2/3))}_t.a._ComputeSides(e,J,H,te,oe,i.frontUVs,i.backUVs);var Pe=new _t.a;return Pe.indices=H,Pe.positions=J,Pe.normals=te,Pe.uvs=oe,Pe},Ne.a.CreateIcoSphere=function(i,t,e){return Dm.CreateIcoSphere(i,t,e)};var Dm=function(){function i(){}return i.CreateIcoSphere=function(t,e,n){n===void 0&&(n=null);var r=new Ne.a(t,n);return e.sideOrientation=Ne.a._GetDefaultSideOrientation(e.sideOrientation),r._originalBuilderSideOrientation=e.sideOrientation,_t.a.CreateIcoSphere(e).applyToMesh(r,e.updatable),r},i}();Ne.a.CreateDecal=function(i,t,e,n,r,o){var l={position:e,normal:n,size:r,angle:o};return wm.CreateDecal(i,t,l)};var wm=function(){function i(){}return i.CreateDecal=function(t,e,n){var r=e.getIndices(),o=e.getVerticesData(Me.b.PositionKind),l=e.getVerticesData(Me.b.NormalKind),h=n.position||d.e.Zero(),v=n.normal||d.e.Up(),b=n.size||d.e.One(),A=n.angle||0;if(!v){var D=new d.e(0,0,1),N=e.getScene().activeCamera,j=d.e.TransformCoordinates(D,N.getWorldMatrix());v=N.globalPosition.subtract(j)}var k=-Math.atan2(v.z,v.x)-Math.PI/2,H=Math.sqrt(v.x*v.x+v.z*v.z),J=Math.atan2(v.y,H),te=d.a.RotationYawPitchRoll(k,J,A).multiply(d.a.Translation(h.x,h.y,h.z)),oe=d.a.Invert(te),ce=e.getWorldMatrix().multiply(oe),he=new _t.a;he.indices=[],he.positions=[],he.normals=[],he.uvs=[];for(var _e=0,ye=function(Ce){var Ue=new Up;if(!r||!o||!l)return Ue;var Le=r[Ce];return Ue.position=new d.e(o[3*Le],o[3*Le+1],o[3*Le+2]),Ue.position=d.e.TransformCoordinates(Ue.position,ce),Ue.normal=new d.e(l[3*Le],l[3*Le+1],l[3*Le+2]),Ue.normal=d.e.TransformNormal(Ue.normal,ce),Ue},Ee=function(Ce,Ue){if(Ce.length===0)return Ce;for(var Le=.5*Math.abs(d.e.Dot(b,Ue)),ke=function(ze,rt){var At=d.e.GetClipFactor(ze.position,rt.position,Ue,Le);return new Up(d.e.Lerp(ze.position,rt.position,At),d.e.Lerp(ze.normal,rt.normal,At))},qe=new Array,at=0;at<Ce.length;at+=3){var lt,ft,Je,dt=null,ut=null,tt=null,mt=null;switch(((lt=d.e.Dot(Ce[at].position,Ue)-Le>0)?1:0)+((ft=d.e.Dot(Ce[at+1].position,Ue)-Le>0)?1:0)+((Je=d.e.Dot(Ce[at+2].position,Ue)-Le>0)?1:0)){case 0:qe.push(Ce[at]),qe.push(Ce[at+1]),qe.push(Ce[at+2]);break;case 1:if(lt&&(dt=Ce[at+1],ut=Ce[at+2],tt=ke(Ce[at],dt),mt=ke(Ce[at],ut)),ft){dt=Ce[at],ut=Ce[at+2],tt=ke(Ce[at+1],dt),mt=ke(Ce[at+1],ut),qe.push(tt),qe.push(ut.clone()),qe.push(dt.clone()),qe.push(ut.clone()),qe.push(tt.clone()),qe.push(mt);break}Je&&(dt=Ce[at],ut=Ce[at+1],tt=ke(Ce[at+2],dt),mt=ke(Ce[at+2],ut)),dt&&ut&&tt&&mt&&(qe.push(dt.clone()),qe.push(ut.clone()),qe.push(tt),qe.push(mt),qe.push(tt.clone()),qe.push(ut.clone()));break;case 2:lt||(ut=ke(dt=Ce[at].clone(),Ce[at+1]),tt=ke(dt,Ce[at+2]),qe.push(dt),qe.push(ut),qe.push(tt)),ft||(ut=ke(dt=Ce[at+1].clone(),Ce[at+2]),tt=ke(dt,Ce[at]),qe.push(dt),qe.push(ut),qe.push(tt)),Je||(ut=ke(dt=Ce[at+2].clone(),Ce[at]),tt=ke(dt,Ce[at+1]),qe.push(dt),qe.push(ut),qe.push(tt))}}return qe},Oe=0;Oe<r.length;Oe+=3){var Ae=new Array;if(Ae.push(ye(Oe)),Ae.push(ye(Oe+1)),Ae.push(ye(Oe+2)),Ae=Ee(Ae,new d.e(1,0,0)),Ae=Ee(Ae,new d.e(-1,0,0)),Ae=Ee(Ae,new d.e(0,1,0)),Ae=Ee(Ae,new d.e(0,-1,0)),Ae=Ee(Ae,new d.e(0,0,1)),(Ae=Ee(Ae,new d.e(0,0,-1))).length!==0)for(var xe=0;xe<Ae.length;xe++){var Pe=Ae[xe];he.indices.push(_e),Pe.position.toArray(he.positions,3*_e),Pe.normal.toArray(he.normals,3*_e),he.uvs.push(.5+Pe.position.x/b.x),he.uvs.push(.5+Pe.position.y/b.y),_e++}}var Be=new Ne.a(t,e.getScene());return he.applyToMesh(Be),Be.position=h.clone(),Be.rotation=new d.e(J,k,A),Be},i}();_t.a.CreateCapsule=function(i){i===void 0&&(i={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var t,e,n=Math.max(i.subdivisions?i.subdivisions:2,1),r=Math.max(i.tessellation?i.tessellation:16,3),o=Math.max(i.height?i.height:1,0),l=Math.max(i.radius?i.radius:.25,0),h=Math.max(i.capSubdivisions?i.capSubdivisions:6,1),v=r,b=n,A=Math.max(i.radiusTop?i.radiusTop:l,0),D=Math.max(i.radiusBottom?i.radiusBottom:l,0),N=o-(A+D),j=2*Math.PI,k=Math.max(i.topCapSubdivisions?i.topCapSubdivisions:h,1),H=Math.max(i.bottomCapSubdivisions?i.bottomCapSubdivisions:h,1),J=Math.acos((D-A)/o),te=[],oe=[],ce=[],he=[],_e=0,ye=[],Ee=.5*N,Oe=.5*Math.PI,Ae=d.e.Zero(),xe=d.e.Zero(),Pe=Math.cos(J),Be=Math.sin(J),Ce=new d.d(A*Be,Ee+A*Pe).subtract(new d.d(D*Be,D*Pe-Ee)).length(),Ue=A*J+Ce+D*(Oe-J),Le=0;for(e=0;e<=k;e++){var ke=[],qe=Oe-J*(e/k);Le+=A*J/k;var at=Math.cos(qe),lt=Math.sin(qe),ft=at*A;for(t=0;t<=v;t++){var Je=(ze=t/v)*j+0,dt=Math.sin(Je),ut=Math.cos(Je);xe.x=ft*dt,xe.y=Ee+lt*A,xe.z=ft*ut,oe.push(xe.x,xe.y,xe.z),Ae.set(at*dt,lt,at*ut),ce.push(Ae.x,Ae.y,Ae.z),he.push(ze,1-Le/Ue),ke.push(_e),_e++}ye.push(ke)}var tt=o-A-D+Pe*A-Pe*D,mt=Be*(D-A)/tt;for(e=1;e<=b;e++){for(ke=[],Le+=Ce/b,ft=Be*(e*(D-A)/b+A),t=0;t<=v;t++)Je=(ze=t/v)*j+0,dt=Math.sin(Je),ut=Math.cos(Je),xe.x=ft*dt,xe.y=Ee+Pe*A-e*tt/b,xe.z=ft*ut,oe.push(xe.x,xe.y,xe.z),Ae.set(dt,mt,ut).normalize(),ce.push(Ae.x,Ae.y,Ae.z),he.push(ze,1-Le/Ue),ke.push(_e),_e++;ye.push(ke)}for(e=1;e<=H;e++){for(ke=[],qe=Oe-J-(Math.PI-J)*(e/H),Le+=D*J/H,at=Math.cos(qe),lt=Math.sin(qe),ft=at*D,t=0;t<=v;t++){var ze;Je=(ze=t/v)*j+0,dt=Math.sin(Je),ut=Math.cos(Je),xe.x=ft*dt,xe.y=lt*D-Ee,xe.z=ft*ut,oe.push(xe.x,xe.y,xe.z),Ae.set(at*dt,lt,at*ut),ce.push(Ae.x,Ae.y,Ae.z),he.push(ze,1-Le/Ue),ke.push(_e),_e++}ye.push(ke)}for(t=0;t<v;t++)for(e=0;e<k+b+H;e++){var rt=ye[e][t],At=ye[e+1][t],sn=ye[e+1][t+1],Ht=ye[e][t+1];te.push(rt),te.push(At),te.push(Ht),te.push(At),te.push(sn),te.push(Ht)}if(te=te.reverse(),i.orientation&&!i.orientation.equals(d.e.Up())){var fn=new d.a;i.orientation.clone().scale(.5*Math.PI).cross(d.e.Up()).toQuaternion().toRotationMatrix(fn);for(var St=d.e.Zero(),bn=0;bn<oe.length;bn+=3)St.set(oe[bn],oe[bn+1],oe[bn+2]),d.e.TransformCoordinatesToRef(St.clone(),fn,St),oe[bn]=St.x,oe[bn+1]=St.y,oe[bn+2]=St.z}var cn=new _t.a;return cn.positions=oe,cn.normals=ce,cn.uvs=he,cn.indices=te,cn},Ne.a.CreateCapsule=function(i,t,e){return Lm.CreateCapsule(i,t,e)};var _l,Lm=function(){function i(){}return i.CreateCapsule=function(t,e,n){e===void 0&&(e={orientation:d.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var r=new Ne.a(t,n);return _t.a.CreateCapsule(e).applyToMesh(r),r},i}(),Aw=function(){function i(){}return i.CreateBox=function(t,e,n){return n===void 0&&(n=null),fs.a.CreateBox(t,e,n)},i.CreateTiledBox=function(t,e,n){return n===void 0&&(n=null),FT.CreateTiledBox(t,e,n)},i.CreateSphere=function(t,e,n){return n===void 0&&(n=null),Mr.a.CreateSphere(t,e,n)},i.CreateDisc=function(t,e,n){return n===void 0&&(n=null),Oh.CreateDisc(t,e,n)},i.CreateIcoSphere=function(t,e,n){return n===void 0&&(n=null),Dm.CreateIcoSphere(t,e,n)},i.CreateRibbon=function(t,e,n){return n===void 0&&(n=null),pl.a.CreateRibbon(t,e,n)},i.CreateCylinder=function(t,e,n){return n===void 0&&(n=null),wi.a.CreateCylinder(t,e,n)},i.CreateTorus=function(t,e,n){return n===void 0&&(n=null),ls.CreateTorus(t,e,n)},i.CreateTorusKnot=function(t,e,n){return n===void 0&&(n=null),Rm.CreateTorusKnot(t,e,n)},i.CreateLineSystem=function(t,e,n){return kn.a.CreateLineSystem(t,e,n)},i.CreateLines=function(t,e,n){return n===void 0&&(n=null),kn.a.CreateLines(t,e,n)},i.CreateDashedLines=function(t,e,n){return n===void 0&&(n=null),kn.a.CreateDashedLines(t,e,n)},i.ExtrudeShape=function(t,e,n){return n===void 0&&(n=null),_h.a.ExtrudeShape(t,e,n)},i.ExtrudeShapeCustom=function(t,e,n){return n===void 0&&(n=null),_h.a.ExtrudeShapeCustom(t,e,n)},i.CreateLathe=function(t,e,n){return n===void 0&&(n=null),Mm.CreateLathe(t,e,n)},i.CreateTiledPlane=function(t,e,n){return n===void 0&&(n=null),UT.CreateTiledPlane(t,e,n)},i.CreatePlane=function(t,e,n){return n===void 0&&(n=null),Np.a.CreatePlane(t,e,n)},i.CreateGround=function(t,e,n){return n===void 0&&(n=null),No.CreateGround(t,e,n)},i.CreateTiledGround=function(t,e,n){return n===void 0&&(n=null),No.CreateTiledGround(t,e,n)},i.CreateGroundFromHeightMap=function(t,e,n,r){return r===void 0&&(r=null),No.CreateGroundFromHeightMap(t,e,n,r)},i.CreatePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),ml.CreatePolygon(t,e,n,r)},i.ExtrudePolygon=function(t,e,n,r){return n===void 0&&(n=null),r===void 0&&(r=earcut),ml.ExtrudePolygon(t,e,n,r)},i.CreateTube=function(t,e,n){return n===void 0&&(n=null),Im.CreateTube(t,e,n)},i.CreatePolyhedron=function(t,e,n){return n===void 0&&(n=null),Zc.CreatePolyhedron(t,e,n)},i.CreateDecal=function(t,e,n){return wm.CreateDecal(t,e,n)},i.CreateCapsule=function(t,e,n){return e===void 0&&(e={orientation:d.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),n===void 0&&(n=null),Lm.CreateCapsule(t,e,n)},i}(),Cw=function(i,t,e){this.quality=i,this.distance=t,this.optimizeMesh=e},VT=function(){function i(){this.running=!1,this._simplificationArray=[]}return i.prototype.addTask=function(t){this._simplificationArray.push(t)},i.prototype.executeNext=function(){var t=this._simplificationArray.pop();t?(this.running=!0,this.runSimplification(t)):this.running=!1},i.prototype.runSimplification=function(t){var e=this;if(t.parallelProcessing)t.settings.forEach(function(r){e.getSimplifier(t).simplify(r,function(o){r.distance!==void 0&&t.mesh.addLODLevel(r.distance,o),o.isVisible=!0,r.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),e.executeNext()})});else{var n=this.getSimplifier(t);Qe.a.Run(t.settings.length,function(r){var o,l;o=t.settings[r.index],l=function(){r.executeNext()},n.simplify(o,function(h){o.distance!==void 0&&t.mesh.addLODLevel(o.distance,h),h.isVisible=!0,l()})},function(){t.successCallback&&t.successCallback(),e.executeNext()})}},i.prototype.getSimplifier=function(t){switch(t.simplificationType){case _l.QUADRATIC:default:return new jT(t.mesh)}},i}();(function(i){i[i.QUADRATIC=0]="QUADRATIC"})(_l||(_l={}));var Rw=function(i){this.vertices=i,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},Ow=function(){function i(t,e){this.position=t,this.id=e,this.isBorder=!0,this.q=new kT,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return i.prototype.updatePosition=function(t){this.position.copyFrom(t)},i}(),kT=function(){function i(t){this.data=new Array(10);for(var e=0;e<10;++e)t&&t[e]?this.data[e]=t[e]:this.data[e]=0}return i.prototype.det=function(t,e,n,r,o,l,h,v,b){return this.data[t]*this.data[o]*this.data[b]+this.data[n]*this.data[r]*this.data[v]+this.data[e]*this.data[l]*this.data[h]-this.data[n]*this.data[o]*this.data[h]-this.data[t]*this.data[l]*this.data[v]-this.data[e]*this.data[r]*this.data[b]},i.prototype.addInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t.data[e]},i.prototype.addArrayInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t[e]},i.prototype.add=function(t){for(var e=new i,n=0;n<10;++n)e.data[n]=this.data[n]+t.data[n];return e},i.FromData=function(t,e,n,r){return new i(i.DataFromNumbers(t,e,n,r))},i.DataFromNumbers=function(t,e,n,r){return[t*t,t*e,t*n,t*r,e*e,e*n,e*r,n*n,n*r,r*r]},i}(),Mw=function(i,t){this.vertexId=i,this.triangleId=t},jT=function(){function i(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=Gt.a}return i.prototype.simplify=function(t,e){var n=this;this.initDecimatedMesh(),Qe.a.Run(this._mesh.subMeshes.length,function(r){n.initWithMesh(r.index,function(){n.runDecimation(t,r.index,function(){r.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){e(n._reconstructedMesh)},0)})},i.prototype.runDecimation=function(t,e,n){var r=this,o=~~(this.triangles.length*t.quality),l=0,h=this.triangles.length;Qe.a.Run(this.decimationIterations,function(v){var b,A;h-l<=o?v.breakLoop():(b=v.index,A=function(){v.executeNext()},setTimeout(function(){b%5==0&&r.updateMesh(b===0);for(var D=0;D<r.triangles.length;++D)r.triangles[D].isDirty=!1;var N=1e-9*Math.pow(b+3,r.aggressiveness);Qe.a.SyncAsyncForLoop(r.triangles.length,r.syncIterations,function(j){var k=~~((r.triangles.length/2+j)%r.triangles.length),H=r.triangles[k];if(H&&!(H.error[3]>N||H.deleted||H.isDirty)){for(var J=0;J<3;++J)if(H.error[J]<N){var te=[],oe=[],ce=H.vertices[J],he=H.vertices[(J+1)%3];if(ce.isBorder||he.isBorder)continue;var _e=d.e.Zero();r.calculateError(ce,he,_e);var ye=new Array;if(r.isFlipped(ce,he,_e,te,ye)||r.isFlipped(he,ce,_e,oe,ye)||te.indexOf(!0)<0||oe.indexOf(!0)<0)continue;var Ee=new Array;if(ye.forEach(function(Pe){Ee.indexOf(Pe)===-1&&(Pe.deletePending=!0,Ee.push(Pe))}),Ee.length%2!=0)continue;ce.q=he.q.add(ce.q),ce.updatePosition(_e);var Oe=r.references.length;l=r.updateTriangles(ce,ce,te,l),l=r.updateTriangles(ce,he,oe,l);var Ae=r.references.length-Oe;if(Ae<=ce.triangleCount){if(Ae)for(var xe=0;xe<Ae;xe++)r.references[ce.triangleStart+xe]=r.references[Oe+xe]}else ce.triangleStart=Oe;ce.triangleCount=Ae;break}}},A,function(){return h-l<=o})},0))},function(){setTimeout(function(){r.reconstructMesh(e),n()},0)})},i.prototype.initWithMesh=function(t,e,n){var r=this;this.vertices=[],this.triangles=[];var o=this._mesh.getVerticesData(Me.b.PositionKind),l=this._mesh.getIndices(),h=this._mesh.subMeshes[t],v=[],b=h.verticesCount;Qe.a.SyncAsyncForLoop(b,this.syncIterations/4>>0,function(A){if(o){var D=A+h.verticesStart,N=d.e.FromArray(o,3*D),j=function(k){if(n){for(var H=0;H<r.vertices.length;++H)if(r.vertices[H].position.equalsWithEpsilon(k,1e-4))return r.vertices[H]}return null}(N)||new Ow(N,r.vertices.length);j.originalOffsets.push(D),j.id===r.vertices.length&&r.vertices.push(j),v.push(j.id)}},function(){Qe.a.SyncAsyncForLoop(h.indexCount/3,r.syncIterations,function(A){if(l){var D=3*(h.indexStart/3+A),N=l[D+0],j=l[D+1],k=l[D+2],H=r.vertices[v[N-h.verticesStart]],J=r.vertices[v[j-h.verticesStart]],te=r.vertices[v[k-h.verticesStart]],oe=new Rw([H,J,te]);oe.originalOffset=D,r.triangles.push(oe)}},function(){r.init(e)})})},i.prototype.init=function(t){var e=this;Qe.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(n){var r=e.triangles[n];r.normal=d.e.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var o=0;o<3;o++)r.vertices[o].q.addArrayInPlace(kT.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-d.e.Dot(r.normal,r.vertices[0].position)))},function(){Qe.a.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(n){for(var r=e.triangles[n],o=0;o<3;++o)r.error[o]=e.calculateError(r.vertices[o],r.vertices[(o+1)%3]);r.error[3]=Math.min(r.error[0],r.error[1],r.error[2])},function(){t()})})},i.prototype.reconstructMesh=function(t){var e,n,r,o=[];for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0;for(e=0;e<this.triangles.length;++e)if(!this.triangles[e].deleted){for(n=this.triangles[e],r=0;r<3;++r)n.vertices[r].triangleCount=1;o.push(n)}var l=this._reconstructedMesh.getVerticesData(Me.b.PositionKind)||[],h=this._reconstructedMesh.getVerticesData(Me.b.NormalKind)||[],v=this._reconstructedMesh.getVerticesData(Me.b.UVKind)||[],b=this._reconstructedMesh.getVerticesData(Me.b.ColorKind)||[],A=this._mesh.getVerticesData(Me.b.NormalKind),D=this._mesh.getVerticesData(Me.b.UVKind),N=this._mesh.getVerticesData(Me.b.ColorKind),j=0;for(e=0;e<this.vertices.length;++e){var k=this.vertices[e];k.id=j,k.triangleCount&&k.originalOffsets.forEach(function(_e){l.push(k.position.x),l.push(k.position.y),l.push(k.position.z),A&&A.length&&(h.push(A[3*_e]),h.push(A[3*_e+1]),h.push(A[3*_e+2])),D&&D.length&&(v.push(D[2*_e]),v.push(D[2*_e+1])),N&&N.length&&(b.push(N[4*_e]),b.push(N[4*_e+1]),b.push(N[4*_e+2]),b.push(N[4*_e+3])),++j})}var H=this._reconstructedMesh.getTotalIndices(),J=this._reconstructedMesh.getTotalVertices(),te=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var oe=this._reconstructedMesh.getIndices(),ce=this._mesh.getIndices();for(e=0;e<o.length;++e)n=o[e],[0,1,2].forEach(function(_e){var ye=ce[n.originalOffset+_e],Ee=n.vertices[_e].originalOffsets.indexOf(ye);Ee<0&&(Ee=0),oe.push(n.vertices[_e].id+Ee+J)});this._reconstructedMesh.setIndices(oe),this._reconstructedMesh.setVerticesData(Me.b.PositionKind,l),h.length>0&&this._reconstructedMesh.setVerticesData(Me.b.NormalKind,h),v.length>0&&this._reconstructedMesh.setVerticesData(Me.b.UVKind,v),b.length>0&&this._reconstructedMesh.setVerticesData(Me.b.ColorKind,b);var he=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],te.forEach(function(_e){dl.a.AddToMesh(_e.materialIndex,_e.verticesStart,_e.verticesCount,_e.indexStart,_e.indexCount,_e.getMesh())}),dl.a.AddToMesh(he.materialIndex,J,j,H,3*o.length,this._reconstructedMesh))},i.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new Ne.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},i.prototype.isFlipped=function(t,e,n,r,o){for(var l=0;l<t.triangleCount;++l){var h=this.triangles[this.references[t.triangleStart+l].triangleId];if(!h.deleted){var v=this.references[t.triangleStart+l].vertexId,b=h.vertices[(v+1)%3],A=h.vertices[(v+2)%3];if(b!==e&&A!==e){var D=b.position.subtract(n);D=D.normalize();var N=A.position.subtract(n);if(N=N.normalize(),Math.abs(d.e.Dot(D,N))>.999)return!0;var j=d.e.Cross(D,N).normalize();if(r[l]=!1,d.e.Dot(j,h.normal)<.2)return!0}else r[l]=!0,o.push(h)}}return!1},i.prototype.updateTriangles=function(t,e,n,r){for(var o=r,l=0;l<e.triangleCount;++l){var h=this.references[e.triangleStart+l],v=this.triangles[h.triangleId];v.deleted||(n[l]&&v.deletePending?(v.deleted=!0,o++):(v.vertices[h.vertexId]=t,v.isDirty=!0,v.error[0]=this.calculateError(v.vertices[0],v.vertices[1])+v.borderFactor/2,v.error[1]=this.calculateError(v.vertices[1],v.vertices[2])+v.borderFactor/2,v.error[2]=this.calculateError(v.vertices[2],v.vertices[0])+v.borderFactor/2,v.error[3]=Math.min(v.error[0],v.error[1],v.error[2]),this.references.push(h)))}return o},i.prototype.identifyBorder=function(){for(var t=0;t<this.vertices.length;++t){var e,n=[],r=[],o=this.vertices[t];for(e=0;e<o.triangleCount;++e)for(var l=this.triangles[this.references[o.triangleStart+e].triangleId],h=0;h<3;h++){for(var v=0,b=l.vertices[h];v<n.length&&r[v]!==b.id;)++v;v===n.length?(n.push(1),r.push(b.id)):n[v]++}for(e=0;e<n.length;++e)n[e]===1?this.vertices[r[e]].isBorder=!0:this.vertices[r[e]].isBorder=!1}},i.prototype.updateMesh=function(t){var e,n,r,o;if(t===void 0&&(t=!1),!t){var l=[];for(e=0;e<this.triangles.length;++e)this.triangles[e].deleted||l.push(this.triangles[e]);this.triangles=l}for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0,this.vertices[e].triangleStart=0;for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)(o=n.vertices[r]).triangleCount++;var h=0;for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleStart=h,h+=this.vertices[e].triangleCount,this.vertices[e].triangleCount=0;var v=new Array(3*this.triangles.length);for(e=0;e<this.triangles.length;++e)for(n=this.triangles[e],r=0;r<3;++r)v[(o=n.vertices[r]).triangleStart+o.triangleCount]=new Mw(r,e),o.triangleCount++;this.references=v,t&&this.identifyBorder()},i.prototype.vertexError=function(t,e){var n=e.x,r=e.y,o=e.z;return t.data[0]*n*n+2*t.data[1]*n*r+2*t.data[2]*n*o+2*t.data[3]*n+t.data[4]*r*r+2*t.data[5]*r*o+2*t.data[6]*r+t.data[7]*o*o+2*t.data[8]*o+t.data[9]},i.prototype.calculateError=function(t,e,n){var r=t.q.add(e.q),o=t.isBorder&&e.isBorder,l=0,h=r.det(0,1,2,1,4,5,2,5,7);if(h===0||o){var v=t.position.add(e.position).divide(new d.e(2,2,2)),b=this.vertexError(r,t.position),A=this.vertexError(r,e.position),D=this.vertexError(r,v);(l=Math.min(b,A,D))===b?n&&n.copyFrom(t.position):l===A?n&&n.copyFrom(e.position):n&&n.copyFrom(v)}else n||(n=d.e.Zero()),n.x=-1/h*r.det(1,2,3,4,5,6,5,7,8),n.y=1/h*r.det(0,2,3,1,5,6,2,7,8),n.z=-1/h*r.det(0,1,3,1,4,6,2,5,8),l=this.vertexError(r,n);return l},i}();Object.defineProperty(ne.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new VT;var i=this._getComponent(ct.a.NAME_SIMPLIFICATIONQUEUE);i||(i=new zT(this),this._addComponent(i))}return this._simplificationQueue},set:function(i){this._simplificationQueue=i},enumerable:!0,configurable:!0}),Ne.a.prototype.simplify=function(i,t,e,n){return t===void 0&&(t=!0),e===void 0&&(e=_l.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:i,parallelProcessing:t,mesh:this,simplificationType:e,successCallback:n}),this};var zT=function(){function i(t){this.name=ct.a.NAME_SIMPLIFICATIONQUEUE,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(ct.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},i}(),Iw=c(149),Dw=c(88);Ne.a.prototype.thinInstanceAdd=function(i,t){t===void 0&&(t=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(i)?i.length:1);var e=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(i))for(var n=0;n<i.length;++n)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i[n],n===i.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,i,t);return e},Ne.a.prototype.thinInstanceAddSelf=function(i){return i===void 0&&(i=!0),this.thinInstanceAdd(d.a.IdentityReadOnly,i)},Ne.a.prototype.thinInstanceRegisterAttribute=function(i,t){this.removeVerticesData(i),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[i]=t,this._userThinInstanceBuffersStorage.sizes[i]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[i]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[i]),this._userThinInstanceBuffersStorage.vertexBuffers[i]=new Me.b(this.getEngine(),this._userThinInstanceBuffersStorage.data[i],i,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])},Ne.a.prototype.thinInstanceSetMatrixAt=function(i,t,e){if(e===void 0&&(e=!0),!this._thinInstanceDataStorage.matrixData||i>=this._thinInstanceDataStorage.instancesCount)return!1;var n=this._thinInstanceDataStorage.matrixData;return t.copyToArray(n,16*i),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[i]=t),e&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},Ne.a.prototype.thinInstanceSetAttributeAt=function(i,t,e,n){return n===void 0&&(n=!0),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[i]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(i,0),this._userThinInstanceBuffersStorage.data[i].set(e,t*this._userThinInstanceBuffersStorage.strides[i]),n&&this.thinInstanceBufferUpdated(i),!0)},Object.defineProperty(Ne.a.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(i){var t,e;i<=((e=(t=this._thinInstanceDataStorage.matrixData)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0)/16&&(this._thinInstanceDataStorage.instancesCount=i)},enumerable:!0,configurable:!0}),Ne.a.prototype.thinInstanceSetBuffer=function(i,t,e,n){var r,o;if(e===void 0&&(e=0),n===void 0&&(n=!1),e=e||16,i==="matrix")if((r=this._thinInstanceDataStorage.matrixBuffer)===null||r===void 0||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*e,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,t!==null){this._thinInstanceDataStorage.instancesCount=t.length/e;var l=new Me.a(this.getEngine(),t,!n,e,!1,!0);this._thinInstanceDataStorage.matrixBuffer=l,this.setVerticesBuffer(l.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(l.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(l.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(l.createVertexBuffer("world3",12,4)),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)}else this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo(!0);else t===null?((o=this._userThinInstanceBuffersStorage)===null||o===void 0?void 0:o.data[i])&&(this.removeVerticesData(i),delete this._userThinInstanceBuffersStorage.data[i],delete this._userThinInstanceBuffersStorage.strides[i],delete this._userThinInstanceBuffersStorage.sizes[i],delete this._userThinInstanceBuffersStorage.vertexBuffers[i]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[i]=t,this._userThinInstanceBuffersStorage.strides[i]=e,this._userThinInstanceBuffersStorage.sizes[i]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new Me.b(this.getEngine(),t,i,!n,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i]))},Ne.a.prototype.thinInstanceBufferUpdated=function(i){var t;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):((t=this._userThinInstanceBuffersStorage)===null||t===void 0?void 0:t.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(this._userThinInstanceBuffersStorage.data[i],0)},Ne.a.prototype.thinInstancePartialBufferUpdate=function(i,t,e){var n;i==="matrix"?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,e):((n=this._userThinInstanceBuffersStorage)===null||n===void 0?void 0:n.vertexBuffers[i])&&this._userThinInstanceBuffersStorage.vertexBuffers[i].updateDirectly(t,e)},Ne.a.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var i=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=d.a.FromArray(i,16*t)}return this._thinInstanceDataStorage.worldMatrices},Ne.a.prototype.thinInstanceRefreshBoundingInfo=function(i){if(i===void 0&&(i=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var t=this._thinInstanceDataStorage.boundingVectors;i&&(t.length=0,this.refreshBoundingInfo(!0));var e=this.getBoundingInfo(),n=this._thinInstanceDataStorage.matrixData;if(t.length===0)for(var r=0;r<e.boundingBox.vectors.length;++r)t.push(e.boundingBox.vectors[r].clone());d.c.Vector3[0].setAll(Number.POSITIVE_INFINITY),d.c.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var o=0;o<this._thinInstanceDataStorage.instancesCount;++o)for(d.a.FromArrayToRef(n,16*o,d.c.Matrix[0]),r=0;r<t.length;++r)d.e.TransformCoordinatesToRef(t[r],d.c.Matrix[0],d.c.Vector3[2]),d.c.Vector3[0].minimizeInPlace(d.c.Vector3[2]),d.c.Vector3[1].maximizeInPlace(d.c.Vector3[2]);e.reConstruct(d.c.Vector3[0],d.c.Vector3[1]),this._updateBoundingInfo()}},Ne.a.prototype._thinInstanceUpdateBufferSize=function(i,t){var e,n;t===void 0&&(t=1);var r=i==="matrix";if(r||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[i]){for(var o=r?16:this._userThinInstanceBuffersStorage.strides[i],l=r?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[i],h=r?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[i],v=(this._thinInstanceDataStorage.instancesCount+t)*o,b=l;b<v;)b*=2;if(!h||l!=b){if(h){var A=new Float32Array(b);A.set(h,0),h=A}else h=new Float32Array(b);if(r){(e=this._thinInstanceDataStorage.matrixBuffer)===null||e===void 0||e.dispose();var D=new Me.a(this.getEngine(),h,!0,o,!1,!0);this._thinInstanceDataStorage.matrixBuffer=D,this._thinInstanceDataStorage.matrixData=h,this._thinInstanceDataStorage.matrixBufferSize=b,this.setVerticesBuffer(D.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(D.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(D.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(D.createVertexBuffer("world3",12,4))}else(n=this._userThinInstanceBuffersStorage.vertexBuffers[i])===null||n===void 0||n.dispose(),this._userThinInstanceBuffersStorage.data[i]=h,this._userThinInstanceBuffersStorage.sizes[i]=b,this._userThinInstanceBuffersStorage.vertexBuffers[i]=new Me.b(this.getEngine(),h,i,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[i])}}},Ne.a.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},Ne.a.prototype._disposeThinInstanceSpecificData=function(){var i;((i=this._thinInstanceDataStorage)===null||i===void 0?void 0:i.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)};var ww=function(){function i(t){t===void 0&&(t=Recast),this.bjsRECAST={},this.name="RecastJSPlugin",this._maximumSubStepCount=10,this._timeStep=1/60,typeof t=="function"?t(this.bjsRECAST):this.bjsRECAST=t,this.isSupported()?this.setTimeStep():p.a.Error("RecastJS is not available. Please make sure you included the js file.")}return i.prototype.setTimeStep=function(t){t===void 0&&(t=1/60),this._timeStep=t},i.prototype.getTimeStep=function(){return this._timeStep},i.prototype.setMaximumSubStepCount=function(t){t===void 0&&(t=10),this._maximumSubStepCount=t},i.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount},i.prototype.createNavMesh=function(t,e){var n,r,o,l=new this.bjsRECAST.rcConfig;l.cs=e.cs,l.ch=e.ch,l.borderSize=0,l.tileSize=0,l.walkableSlopeAngle=e.walkableSlopeAngle,l.walkableHeight=e.walkableHeight,l.walkableClimb=e.walkableClimb,l.walkableRadius=e.walkableRadius,l.maxEdgeLen=e.maxEdgeLen,l.maxSimplificationError=e.maxSimplificationError,l.minRegionArea=e.minRegionArea,l.mergeRegionArea=e.mergeRegionArea,l.maxVertsPerPoly=e.maxVertsPerPoly,l.detailSampleDist=e.detailSampleDist,l.detailSampleMaxError=e.detailSampleMaxError,this.navMesh=new this.bjsRECAST.NavMesh;var h=[],v=[],b=0;for(n=0;n<t.length;n++)if(t[n]){var A=t[n],D=A.getIndices();if(!D)continue;var N=A.getVerticesData(Me.b.PositionKind,!1,!1);if(!N)continue;var j=A.computeWorldMatrix(!0);for(r=0;r<D.length;r++)h.push(D[r]+b);var k=d.e.Zero(),H=d.e.Zero();for(o=0;o<N.length;o+=3)d.e.FromArrayToRef(N,o,H),d.e.TransformCoordinatesToRef(H,j,k),v.push(k.x,k.y,k.z);b+=N.length/3}this.navMesh.build(v,b,h,h.length,l)},i.prototype.createDebugNavMesh=function(t){var e,n,r=this.navMesh.getDebugNavMesh(),o=r.getTriangleCount(),l=[],h=[];for(e=0;e<3*o;e++)l.push(e);for(e=0;e<o;e++)for(n=0;n<3;n++){var v=r.getTriangle(e).getPoint(n);h.push(v.x,v.y,v.z)}var b=new Ne.a("NavMeshDebug",t),A=new _t.a;return A.indices=l,A.positions=h,A.applyToMesh(b,!1),b},i.prototype.getClosestPoint=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z),n=this.navMesh.getClosestPoint(e);return new d.e(n.x,n.y,n.z)},i.prototype.getClosestPointToRef=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getClosestPoint(n);e.set(r.x,r.y,r.z)},i.prototype.getRandomPointAround=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=this.navMesh.getRandomPointAround(n,e);return new d.e(r.x,r.y,r.z)},i.prototype.getRandomPointAroundToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=this.navMesh.getRandomPointAround(r,e);n.set(o.x,o.y,o.z)},i.prototype.moveAlong=function(t,e){var n=new this.bjsRECAST.Vec3(t.x,t.y,t.z),r=new this.bjsRECAST.Vec3(e.x,e.y,e.z),o=this.navMesh.moveAlong(n,r);return new d.e(o.x,o.y,o.z)},i.prototype.moveAlongToRef=function(t,e,n){var r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),l=this.navMesh.moveAlong(r,o);n.set(l.x,l.y,l.z)},i.prototype.computePath=function(t,e){var n,r=new this.bjsRECAST.Vec3(t.x,t.y,t.z),o=new this.bjsRECAST.Vec3(e.x,e.y,e.z),l=this.navMesh.computePath(r,o),h=l.getPointCount(),v=[];for(n=0;n<h;n++){var b=l.getPoint(n);v.push(new d.e(b.x,b.y,b.z))}return v},i.prototype.createCrowd=function(t,e,n){return new GT(this,t,e,n)},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECAST.Vec3(t.x,t.y,t.z);this.navMesh.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.navMesh.getDefaultQueryExtent();return new d.e(t.x,t.y,t.z)},i.prototype.buildFromNavmeshData=function(t){var e=t.length*t.BYTES_PER_ELEMENT,n=this.bjsRECAST._malloc(e),r=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,n,e);r.set(t);var o=new this.bjsRECAST.NavmeshData;o.dataPointer=r.byteOffset,o.size=t.length,this.navMesh=new this.bjsRECAST.NavMesh,this.navMesh.buildFromNavmeshData(o),this.bjsRECAST._free(r.byteOffset)},i.prototype.getNavmeshData=function(){var t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,t.dataPointer,t.size),n=new Uint8Array(t.size);return n.set(e),this.navMesh.freeNavmeshData(t),n},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){},i.prototype.isSupported=function(){return this.bjsRECAST!==void 0},i}(),GT=function(){function i(t,e,n,r){var o=this;this.recastCrowd={},this.transforms=new Array,this.agents=new Array,this._onBeforeAnimationsObserver=null,this.bjsRECASTPlugin=t,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(e,n,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=r,this._onBeforeAnimationsObserver=r.onBeforeAnimationsObservable.add(function(){o.update(.001*r.getEngine().getDeltaTime())})}return i.prototype.addAgent=function(t,e,n){var r=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;var o=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z),r);return this.transforms.push(n),this.agents.push(o),o},i.prototype.getAgentPosition=function(t){var e=this.recastCrowd.getAgentPosition(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentPositionToRef=function(t,e){var n=this.recastCrowd.getAgentPosition(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentVelocity=function(t){var e=this.recastCrowd.getAgentVelocity(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentVelocityToRef=function(t,e){var n=this.recastCrowd.getAgentVelocity(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentNextTargetPath=function(t){var e=this.recastCrowd.getAgentNextTargetPath(t);return new d.e(e.x,e.y,e.z)},i.prototype.getAgentNextTargetPathToRef=function(t,e){var n=this.recastCrowd.getAgentNextTargetPath(t);e.set(n.x,n.y,n.z)},i.prototype.getAgentState=function(t){return this.recastCrowd.getAgentState(t)},i.prototype.overOffmeshConnection=function(t){return this.recastCrowd.overOffmeshConnection(t)},i.prototype.agentGoto=function(t,e){this.recastCrowd.agentGoto(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.agentTeleport=function(t,e){this.recastCrowd.agentTeleport(t,new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z))},i.prototype.updateAgentParameters=function(t,e){var n=this.recastCrowd.getAgentParameters(t);e.radius!==void 0&&(n.radius=e.radius),e.height!==void 0&&(n.height=e.height),e.maxAcceleration!==void 0&&(n.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(n.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(n.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(n.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(n.separationWeight=e.separationWeight),this.recastCrowd.setAgentParameters(t,n)},i.prototype.removeAgent=function(t){this.recastCrowd.removeAgent(t);var e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1))},i.prototype.getAgents=function(){return this.agents},i.prototype.update=function(t){var e=this.bjsRECASTPlugin.getTimeStep(),n=this.bjsRECASTPlugin.getMaximumSubStepCount();if(e<=Gt.a)this.recastCrowd.update(t);else{var r=t/e;n&&r>n&&(r=n),r<1&&(r=1);for(var o=0;o<r;o++)this.recastCrowd.update(e)}for(var l=0;l<this.agents.length;l++)this.transforms[l].position=this.getAgentPosition(this.agents[l])},i.prototype.setDefaultQueryExtent=function(t){var e=new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z);this.recastCrowd.setDefaultQueryExtent(e)},i.prototype.getDefaultQueryExtent=function(){var t=this.recastCrowd.getDefaultQueryExtent();return new d.e(t.x,t.y,t.z)},i.prototype.getDefaultQueryExtentToRef=function(t){var e=this.recastCrowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)},i.prototype.dispose=function(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null},i}();Xe.a.OfflineProviderFactory=function(i,t,e){return e===void 0&&(e=!1),new WT(i,t,e)};var Rs,WT=function(){function i(t,e,n){var r=this;n===void 0&&(n=!1),this._idbFactory=typeof window!="undefined"?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB,this._callbackManifestChecked=e,this._currentSceneUrl=i._ReturnFullUrlLocation(t),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,i.IDBStorageEnabled?n?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,Qe.b.SetImmediate(function(){r._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(i.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!1,configurable:!0}),i.prototype._checkManifestFile=function(){var t=this,e=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t._callbackManifestChecked(!1)},n=!1,r=this._currentSceneUrl+".manifest",o=new re.a;navigator.onLine&&(n=!0,r=r+(r.match(/\?/)==null?"?":"&")+Date.now()),o.open("GET",r),o.addEventListener("load",function(){if(o.status===200||i._ValidateXHRData(o,1))try{var l=JSON.parse(o.response);t._enableSceneOffline=l.enableSceneOffline,t._enableTexturesOffline=l.enableTexturesOffline&&i.IsUASupportingBlobStorage,l.version&&!isNaN(parseInt(l.version))&&(t._manifestVersionFound=l.version),t._callbackManifestChecked&&t._callbackManifestChecked(!0)}catch(h){e()}else e()},!1),o.addEventListener("error",function(){if(n){n=!1;var l=t._currentSceneUrl+".manifest";o.open("GET",l),o.send()}else e()},!1);try{o.send()}catch(l){p.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},i.prototype.open=function(t,e){var n=this,r=function(){n._isSupported=!1,e&&e()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)t&&t();else{this._hasReachedQuota=!1,this._isSupported=!0;var o=this._idbFactory.open("babylonjs",1);o.onerror=function(){r()},o.onblocked=function(){p.a.Error("IDB request blocked. Please reload the page."),r()},o.onsuccess=function(){n._db=o.result,t()},o.onupgradeneeded=function(l){if(n._db=l.target.result,n._db)try{n._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),n._db.createObjectStore("versions",{keyPath:"sceneUrl"}),n._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(h){p.a.Error("Error while creating object stores. Exception: "+h.message),r()}}}else this._isSupported=!1,e&&e()},i.prototype.loadImage=function(t,e){var n=this,r=i._ReturnFullUrlLocation(t),o=function(){n._hasReachedQuota||n._db===null?e.src=t:n._saveImageIntoDBAsync(r,e)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(r,e,o)},i.prototype._loadImageFromDBAsync=function(t,e,n){if(this._isSupported&&this._db!==null){var r,o=this._db.transaction(["textures"]);o.onabort=function(){e.src=t},o.oncomplete=function(){var h;if(r){var v=window.URL||window.webkitURL;h=v.createObjectURL(r.data),e.onerror=function(){p.a.Error("Error loading image from blob URL: "+h+" switching back to web url: "+t),e.src=t},e.src=h}else n()};var l=o.objectStore("textures").get(t);l.onsuccess=function(h){r=h.target.result},l.onerror=function(){p.a.Error("Error loading texture "+t+" from DB."),e.src=t}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e.src=t},i.prototype._saveImageIntoDBAsync=function(t,e){var n=this;if(this._isSupported){var r=function(){var h;if(o){var v=window.URL||window.webkitURL;try{h=v.createObjectURL(o)}catch(b){h=v.createObjectURL(o)}}h&&(e.src=h)};if(i.IsUASupportingBlobStorage){var o,l=new re.a;l.open("GET",t),l.responseType="blob",l.addEventListener("load",function(){if(l.status===200&&n._db){o=l.response;var h=n._db.transaction(["textures"],"readwrite");h.onabort=function(A){try{var D=(A.srcElement||A.target).error;D&&D.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(N){}r()},h.oncomplete=function(){r()};var v={textureUrl:t,data:o};try{var b=h.objectStore("textures").put(v);b.onsuccess=function(){},b.onerror=function(){r()}}catch(A){A.code===25&&(i.IsUASupportingBlobStorage=!1,n._enableTexturesOffline=!1),e.src=t}}else e.src=t},!1),l.addEventListener("error",function(){p.a.Error("Error in XHR request in BABYLON.Database."),e.src=t},!1),l.send()}else e.src=t}else p.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e.src=t},i.prototype._checkVersionFromDB=function(t,e){var n=this;this._loadVersionFromDBAsync(t,e,function(){n._saveVersionIntoDBAsync(t,e)})},i.prototype._loadVersionFromDBAsync=function(t,e,n){var r,o=this;if(this._isSupported&&this._db)try{var l=this._db.transaction(["versions"]);l.oncomplete=function(){r?o._manifestVersionFound!==r.data?(o._mustUpdateRessources=!0,n()):e(r.data):(o._mustUpdateRessources=!0,n())},l.onabort=function(){e(-1)};var h=l.objectStore("versions").get(t);h.onsuccess=function(v){r=v.target.result},h.onerror=function(){p.a.Error("Error loading version for scene "+t+" from DB."),e(-1)}}catch(v){p.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+v.message),e(-1)}else p.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e(-1)},i.prototype._saveVersionIntoDBAsync=function(t,e){var n=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var r=this._db.transaction(["versions"],"readwrite");r.onabort=function(h){try{var v=h.srcElement.error;v&&v.name==="QuotaExceededError"&&(n._hasReachedQuota=!0)}catch(b){}e(-1)},r.oncomplete=function(){e(n._manifestVersionFound)};var o={sceneUrl:t,data:this._manifestVersionFound},l=r.objectStore("versions").put(o);l.onsuccess=function(){},l.onerror=function(){p.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(h){p.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+h.message),e(-1)}else e(-1)},i.prototype.loadFile=function(t,e,n,r,o){var l=this,h=i._ReturnFullUrlLocation(t),v=function(){l._saveFileAsync(h,e,n,o,r)};this._checkVersionFromDB(h,function(b){b!==-1?l._mustUpdateRessources?l._saveFileAsync(h,e,n,o,r):l._loadFileAsync(h,e,v):r&&r()})},i.prototype._loadFileAsync=function(t,e,n){if(this._isSupported&&this._db){var r,o;r=t.indexOf(".babylon")!==-1?"scenes":"textures";var l=this._db.transaction([r]);l.oncomplete=function(){o?e(o.data):n()},l.onabort=function(){n()};var h=l.objectStore(r).get(t);h.onsuccess=function(v){o=v.target.result},h.onerror=function(){p.a.Error("Error loading file "+t+" from DB."),n()}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),e()},i.prototype._saveFileAsync=function(t,e,n,r,o){var l=this;if(this._isSupported){var h;h=t.indexOf(".babylon")!==-1?"scenes":"textures";var v,b=new re.a;b.open("GET",t+"?"+Date.now()),r&&(b.responseType="arraybuffer"),n&&(b.onprogress=n),b.addEventListener("load",function(){if(b.status===200||b.status<400&&i._ValidateXHRData(b,r?6:1))if(v=r?b.response:b.responseText,!l._hasReachedQuota&&l._db){var A,D=l._db.transaction([h],"readwrite");D.onabort=function(j){try{var k=j.srcElement.error;k&&k.name==="QuotaExceededError"&&(l._hasReachedQuota=!0)}catch(H){}e(v)},D.oncomplete=function(){e(v)},A=h==="scenes"?{sceneUrl:t,data:v,version:l._manifestVersionFound}:{textureUrl:t,data:v};try{var N=D.objectStore(h).put(A);N.onsuccess=function(){},N.onerror=function(){p.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(j){e(v)}}else e(v);else b.status>=400&&o?o(b):e()},!1),b.addEventListener("error",function(){p.a.Error("error on XHR request."),e()},!1),b.send()}else p.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),e()},i._ValidateXHRData=function(t,e){e===void 0&&(e=7);try{if(1&e){if(t.responseText&&t.responseText.length>0)return!0;if(e===1)return!1}if(2&e){var n=bh.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(e===2)return!1}if(4&e){var r=new Uint8Array(t.response,0,3);return r[0]===68&&r[1]===68&&r[2]===83}}catch(o){}return!1},i.IsUASupportingBlobStorage=!0,i.IDBStorageEnabled=!1,i._ParseURL=function(t){document.createElement("a").href=t;var e=t.substring(0,t.lastIndexOf("#")),n=t.substring(e.lastIndexOf("/")+1,t.length);return t.substring(0,t.indexOf(n,0))},i._ReturnFullUrlLocation=function(t){return t.indexOf("http:/")===-1&&t.indexOf("https:/")===-1&&typeof window!="undefined"?i._ParseURL(window.location.href)+t:t},i}(),Nm=function(){function i(t,e,n){this.gradient=t,this.color1=e,this.color2=n}return i.prototype.getColorToRef=function(t){this.color2?x.b.LerpToRef(this.color1,this.color2,Math.random(),t):t.copyFrom(this.color1)},i}(),HT=function(i,t){this.gradient=i,this.color=t},Fm=function(){function i(t,e,n){this.gradient=t,this.factor1=e,this.factor2=n}return i.prototype.getFactor=function(){return this.factor2===void 0||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()},i}(),Tr=function(){function i(){}return i.GetCurrentGradient=function(t,e,n){if(e[0].gradient>t)n(e[0],e[0],1);else{for(var r=0;r<e.length-1;r++){var o=e[r],l=e[r+1];if(t>=o.gradient&&t<=l.gradient)return void n(o,l,(t-o.gradient)/(l.gradient-o.gradient))}var h=e.length-1;n(e[h],e[h],1)}},i}(),XT=function(){function i(t){this.particleSystem=t,this.position=d.e.Zero(),this.direction=d.e.Zero(),this.color=new x.b(0,0,0,0),this.colorStep=new x.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new d.d(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new x.b(0,0,0,0),this._currentColor2=new x.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=i._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return i.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},i.prototype.updateCellIndex=function(){var t=this.age,e=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(this._randomCellOffset===void 0&&(this._randomCellOffset=Math.random()*this.lifeTime),e===0?(e=1,t=this._randomCellOffset):t+=this._randomCellOffset);var n=this._initialEndSpriteCellID-this._initialStartSpriteCellID,r=se.a.Clamp(t*e%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+r*n|0},i.prototype._inheritParticleInfoToSubEmitter=function(t){if(t.particleSystem.emitter.position){var e=t.particleSystem.emitter;if(e.position.copyFrom(this.position),t.inheritDirection){var n=d.c.Vector3[0];this.direction.normalizeToRef(n),e.setDirection(n,0,Math.PI/2)}}else t.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(t.inheritedVelocityAmount/2,d.c.Vector3[0]),t.particleSystem._inheritedVelocityOffset.copyFrom(d.c.Vector3[0])},i.prototype._inheritParticleInfoToSubEmitters=function(){var t=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(e){t._inheritParticleInfoToSubEmitter(e)})},i.prototype._reset=function(){this.age=0,this.id=i._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},i.prototype.copyTo=function(t){t.position.copyFrom(this.position),this._initialDirection?t._initialDirection?t._initialDirection.copyFrom(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.copyFrom(this.direction),this._localPosition&&(t._localPosition?t._localPosition.copyFrom(this._localPosition):t._localPosition=this._localPosition.clone()),t.color.copyFrom(this.color),t.colorStep.copyFrom(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.copyFrom(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.copyFrom(this._currentColor1),t._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this._initialStartSpriteCellID,t._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.copyFrom(this.remapData):t.remapData=new d.f(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},i._Count=0,i}();(function(i){i[i.ATTACHED=0]="ATTACHED",i[i.END=1]="END"})(Rs||(Rs={}));var gl=function(){function i(t){if(this.particleSystem=t,this.type=Rs.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.emitter||!t.emitter.dispose){var e=M.a.GetClass("BABYLON.AbstractMesh");t.emitter=new e("SubemitterSystemEmitter",t.getScene())}t.onDisposeObservable.add(function(){t.emitter&&t.emitter.dispose&&t.emitter.dispose()})}return i.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof d.e?t=t.clone():t.getClassName().indexOf("Mesh")!==-1&&((t=new(M.a.GetClass("BABYLON.Mesh"))("",t.getScene())).isVisible=!1):t=new d.e;var e=new i(this.particleSystem.clone("",t));return e.particleSystem.name+="Clone",e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem._disposeEmitterOnDispose=!0,e.particleSystem.disposeOnStop=!0,e},i.prototype.serialize=function(){var t={};return t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem=this.particleSystem.serialize(),t},i._ParseParticleSystem=function(t,e,n){throw rr.a.WarnImport("ParseParticle")},i.Parse=function(t,e,n){var r=t.particleSystem,o=new i(i._ParseParticleSystem(r,e,n));return o.type=t.type,o.inheritDirection=t.inheritDirection,o.inheritedVelocityAmount=t.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},i.prototype.dispose=function(){this.particleSystem.dispose()},i}(),Lw=`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`;We.a.ShadersStore.particlesPixelShader=Lw;var Nw=`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET
attribute float cellIndex;
#endif
#ifndef BILLBOARD
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction;
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET
uniform vec3 particlesInfos;
#endif

varying vec2 vUV;
varying vec4 vColor;
varying vec3 vPositionW;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#endif
void main(void) {
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD

vec3 rotatedCorner;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;
vPositionW=(invView*vec4(viewPos,1)).xyz;
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0);
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vPositionW=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(vPositionW,1.0);
#endif
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex*particlesInfos.z);
float columnOffset=cellIndex-rowOffset/particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;We.a.ShadersStore.particlesVertexShader=Nw;var jn=function(i){function t(e,n,r,o,l,h){o===void 0&&(o=null),l===void 0&&(l=!1),h===void 0&&(h=.01);var v=i.call(this,e)||this;return v._inheritedVelocityOffset=new d.e,v.onDisposeObservable=new E.c,v.onStoppedObservable=new E.c,v._particles=new Array,v._stockParticles=new Array,v._newPartsExcess=0,v._vertexBuffers={},v._scaledColorStep=new x.b(0,0,0,0),v._colorDiff=new x.b(0,0,0,0),v._scaledDirection=d.e.Zero(),v._scaledGravity=d.e.Zero(),v._currentRenderId=-1,v._useInstancing=!1,v._started=!1,v._stopped=!1,v._actualFrame=0,v._currentEmitRate1=0,v._currentEmitRate2=0,v._currentStartSize1=0,v._currentStartSize2=0,v._rawTextureWidth=256,v._useRampGradients=!1,v._disposeEmitterOnDispose=!1,v.isLocal=!1,v._onBeforeDrawParticlesObservable=null,v.recycleParticle=function(b){var A=v._particles.pop();A!==b&&A.copyTo(b),v._stockParticles.push(A)},v._createParticle=function(){var b;if(v._stockParticles.length!==0?(b=v._stockParticles.pop())._reset():b=new XT(v),v._subEmitters&&v._subEmitters.length>0){var A=v._subEmitters[Math.floor(Math.random()*v._subEmitters.length)];b._attachedSubEmitters=[],A.forEach(function(D){if(D.type===Rs.ATTACHED){var N=D.clone();b._attachedSubEmitters.push(N),N.particleSystem.start()}})}return b},v._emitFromParticle=function(b){if(v._subEmitters&&v._subEmitters.length!==0){var A=Math.floor(Math.random()*v._subEmitters.length);v._subEmitters[A].forEach(function(D){if(D.type===Rs.END){var N=D.clone();b._inheritParticleInfoToSubEmitter(N),N.particleSystem._rootParticleSystem=v,v.activeSubSystems.push(N.particleSystem),N.particleSystem.start()}})}},v._capacity=n,v._epsilon=h,v._isAnimationSheetEnabled=l,r&&r.getClassName()!=="Scene"?(v._engine=r,v.defaultProjectionMatrix=d.a.PerspectiveFovLH(.8,1,.1,100)):(v._scene=r||$.a.LastCreatedScene,v._engine=v._scene.getEngine(),v.uniqueId=v._scene.getUniqueId(),v._scene.particleSystems.push(v)),v._engine.getCaps().vertexArrayObject&&(v._vertexArrayObject=null),v._attachImageProcessingConfiguration(null),v._customEffect={0:o},v._useInstancing=v._engine.getCaps().instancedArrays,v._createIndexBuffer(),v._createVertexBuffers(),v.particleEmitterType=new As,v.updateFunction=function(b){var A=null,D=null;v.noiseTexture&&(A=v.noiseTexture.getSize(),D=v.noiseTexture.getContent());for(var N,j=function(){N=b[k];var H=v._scaledUpdateSpeed,J=N.age;if(N.age+=H,N.age>N.lifeTime){var te=N.age-J;H=(N.lifeTime-J)*H/te,N.age=N.lifeTime}var oe=N.age/N.lifeTime;v._colorGradients&&v._colorGradients.length>0?Tr.GetCurrentGradient(oe,v._colorGradients,function(Ae,xe,Pe){Ae!==N._currentColorGradient&&(N._currentColor1.copyFrom(N._currentColor2),xe.getColorToRef(N._currentColor2),N._currentColorGradient=Ae),x.b.LerpToRef(N._currentColor1,N._currentColor2,Pe,N.color)}):(N.colorStep.scaleToRef(H,v._scaledColorStep),N.color.addInPlace(v._scaledColorStep),N.color.a<0&&(N.color.a=0)),v._angularSpeedGradients&&v._angularSpeedGradients.length>0&&Tr.GetCurrentGradient(oe,v._angularSpeedGradients,function(Ae,xe,Pe){Ae!==N._currentAngularSpeedGradient&&(N._currentAngularSpeed1=N._currentAngularSpeed2,N._currentAngularSpeed2=xe.getFactor(),N._currentAngularSpeedGradient=Ae),N.angularSpeed=se.a.Lerp(N._currentAngularSpeed1,N._currentAngularSpeed2,Pe)}),N.angle+=N.angularSpeed*H;var ce=H;if(v._velocityGradients&&v._velocityGradients.length>0&&Tr.GetCurrentGradient(oe,v._velocityGradients,function(Ae,xe,Pe){Ae!==N._currentVelocityGradient&&(N._currentVelocity1=N._currentVelocity2,N._currentVelocity2=xe.getFactor(),N._currentVelocityGradient=Ae),ce*=se.a.Lerp(N._currentVelocity1,N._currentVelocity2,Pe)}),N.direction.scaleToRef(ce,v._scaledDirection),v._limitVelocityGradients&&v._limitVelocityGradients.length>0&&Tr.GetCurrentGradient(oe,v._limitVelocityGradients,function(Ae,xe,Pe){Ae!==N._currentLimitVelocityGradient&&(N._currentLimitVelocity1=N._currentLimitVelocity2,N._currentLimitVelocity2=xe.getFactor(),N._currentLimitVelocityGradient=Ae);var Be=se.a.Lerp(N._currentLimitVelocity1,N._currentLimitVelocity2,Pe);N.direction.length()>Be&&N.direction.scaleInPlace(v.limitVelocityDamping)}),v._dragGradients&&v._dragGradients.length>0&&Tr.GetCurrentGradient(oe,v._dragGradients,function(Ae,xe,Pe){Ae!==N._currentDragGradient&&(N._currentDrag1=N._currentDrag2,N._currentDrag2=xe.getFactor(),N._currentDragGradient=Ae);var Be=se.a.Lerp(N._currentDrag1,N._currentDrag2,Pe);v._scaledDirection.scaleInPlace(1-Be)}),v.isLocal&&N._localPosition?(N._localPosition.addInPlace(v._scaledDirection),d.e.TransformCoordinatesToRef(N._localPosition,v._emitterWorldMatrix,N.position)):N.position.addInPlace(v._scaledDirection),D&&A&&N._randomNoiseCoordinates1){var he=v._fetchR(N._randomNoiseCoordinates1.x,N._randomNoiseCoordinates1.y,A.width,A.height,D),_e=v._fetchR(N._randomNoiseCoordinates1.z,N._randomNoiseCoordinates2.x,A.width,A.height,D),ye=v._fetchR(N._randomNoiseCoordinates2.y,N._randomNoiseCoordinates2.z,A.width,A.height,D),Ee=d.c.Vector3[0],Oe=d.c.Vector3[1];Ee.copyFromFloats((2*he-1)*v.noiseStrength.x,(2*_e-1)*v.noiseStrength.y,(2*ye-1)*v.noiseStrength.z),Ee.scaleToRef(H,Oe),N.direction.addInPlace(Oe)}if(v.gravity.scaleToRef(H,v._scaledGravity),N.direction.addInPlace(v._scaledGravity),v._sizeGradients&&v._sizeGradients.length>0&&Tr.GetCurrentGradient(oe,v._sizeGradients,function(Ae,xe,Pe){Ae!==N._currentSizeGradient&&(N._currentSize1=N._currentSize2,N._currentSize2=xe.getFactor(),N._currentSizeGradient=Ae),N.size=se.a.Lerp(N._currentSize1,N._currentSize2,Pe)}),v._useRampGradients&&(v._colorRemapGradients&&v._colorRemapGradients.length>0&&Tr.GetCurrentGradient(oe,v._colorRemapGradients,function(Ae,xe,Pe){var Be=se.a.Lerp(Ae.factor1,xe.factor1,Pe),Ce=se.a.Lerp(Ae.factor2,xe.factor2,Pe);N.remapData.x=Be,N.remapData.y=Ce-Be}),v._alphaRemapGradients&&v._alphaRemapGradients.length>0&&Tr.GetCurrentGradient(oe,v._alphaRemapGradients,function(Ae,xe,Pe){var Be=se.a.Lerp(Ae.factor1,xe.factor1,Pe),Ce=se.a.Lerp(Ae.factor2,xe.factor2,Pe);N.remapData.z=Be,N.remapData.w=Ce-Be})),v._isAnimationSheetEnabled&&N.updateCellIndex(),N._inheritParticleInfoToSubEmitters(),N.age>=N.lifeTime)return v._emitFromParticle(N),N._attachedSubEmitters&&(N._attachedSubEmitters.forEach(function(Ae){Ae.particleSystem.disposeOnStop=!0,Ae.particleSystem.stop()}),N._attachedSubEmitters=null),v.recycleParticle(N),k--,"continue"},k=0;k<b.length;k++)j()},v}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0}),t.prototype.getActiveCount=function(){return this._particles.length},t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype.isStopping=function(){return this._stopped&&this.isAlive()},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new E.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"particles"},enumerable:!1,configurable:!0}),t.prototype._addFactorGradient=function(e,n,r,o){var l=new Fm(n,r,o);e.push(l),e.sort(function(h,v){return h.gradient<v.gradient?-1:h.gradient>v.gradient?1:0})},t.prototype._removeFactorGradient=function(e,n){if(e)for(var r=0,o=0,l=e;o<l.length;o++){if(l[o].gradient===n){e.splice(r,1);break}r++}},t.prototype.addLifeTimeGradient=function(e,n,r){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,n,r),this},t.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},t.prototype.addSizeGradient=function(e,n,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n,r),this},t.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},t.prototype.addColorRemapGradient=function(e,n,r){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,n,r),this},t.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,n,r),this},t.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},t.prototype.addAngularSpeedGradient=function(e,n,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n,r),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},t.prototype.addVelocityGradient=function(e,n,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n,r),this},t.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},t.prototype.addLimitVelocityGradient=function(e,n,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n,r),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},t.prototype.addDragGradient=function(e,n,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n,r),this},t.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},t.prototype.addEmitRateGradient=function(e,n,r){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,n,r),this},t.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype.addStartSizeGradient=function(e,n,r){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,n,r),this},t.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._startSizeGradients,e),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var e=new Uint8Array(4*this._rawTextureWidth),n=x.c.Color3[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;Tr.GetCurrentGradient(o,this._rampGradients,function(l,h,v){x.a.LerpToRef(l.color,h.color,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255})}this._rampGradientsTexture=hr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()},t.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort(function(e,n){return e.gradient<n.gradient?-1:e.gradient>n.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())},t.prototype.addRampGradient=function(e,n){this._rampGradients||(this._rampGradients=[]);var r=new HT(e,n);return this._rampGradients.push(r),this._syncRampGradientTexture(),this},t.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Nm(e,n,r);return this._colorGradients.push(o),this._colorGradients.sort(function(l,h){return l.gradient<h.gradient?-1:l.gradient>h.gradient?1:0}),this},t.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var n=0,r=0,o=this._colorGradients;r<o.length;r++){if(o[r].gradient===e){this._colorGradients.splice(n,1);break}n++}return this},t.prototype._fetchR=function(e,n,r,o,l){return l[4*(((e=.5*Math.abs(e)+.5)*r%r|0)+((n=.5*Math.abs(n)+.5)*o%o|0)*r)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._engine;this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new Me.a(e,this._vertexData,!0,this._vertexBufferSize);var n=0,r=this._vertexBuffer.createVertexBuffer(Me.b.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Me.b.PositionKind]=r,n+=3;var o=this._vertexBuffer.createVertexBuffer(Me.b.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Me.b.ColorKind]=o,n+=4;var l=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=l,n+=1;var h,v=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,n+=2,this._isAnimationSheetEnabled){var b=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=b,n+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var A=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=A,n+=3}if(this._useRampGradients){var D=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=D,n+=4}if(this._useInstancing){var N=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new Me.a(e,N,!1,2),h=this._spriteBuffer.createVertexBuffer("offset",0,2)}else h=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=h},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],n=0,r=0;r<this._capacity;r++)e.push(n),e.push(n+1),e.push(n+2),e.push(n),e.push(n+2),e.push(n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(e)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(n){n instanceof t?e._subEmitters.push([new gl(n)]):n instanceof gl?e._subEmitters.push([n]):n instanceof Array&&e._subEmitters.push(n)})},t.prototype.start=function(e){var n,r=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){r.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&this._subEmitters.length!=0&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){((n=this.emitter)===null||n===void 0?void 0:n.getClassName().indexOf("Mesh"))!==-1&&this.emitter.computeWorldMatrix(!0);var o=this.noiseTexture;if(o&&o.onGeneratedObservable)o.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var h=0;h<r.preWarmCycles;h++)r.animate(!0),o.render()})});else for(var l=0;l<this.preWarmCycles;l++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(e){e===void 0&&(e=!0),this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,e&&this._stopSubEmitters())},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(e,n,r,o){var l=e*this._vertexBufferSize;if(this._vertexData[l++]=n.position.x+this.worldOffset.x,this._vertexData[l++]=n.position.y+this.worldOffset.y,this._vertexData[l++]=n.position.z+this.worldOffset.z,this._vertexData[l++]=n.color.r,this._vertexData[l++]=n.color.g,this._vertexData[l++]=n.color.b,this._vertexData[l++]=n.color.a,this._vertexData[l++]=n.angle,this._vertexData[l++]=n.scale.x*n.size,this._vertexData[l++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[l++]=n.cellIndex),this._isBillboardBased)this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[l++]=n.direction.x,this._vertexData[l++]=n.direction.y,this._vertexData[l++]=n.direction.z);else if(n._initialDirection){var h=n._initialDirection;this.isLocal&&(d.e.TransformNormalToRef(h,this._emitterWorldMatrix,d.c.Vector3[0]),h=d.c.Vector3[0]),h.x===0&&h.z===0&&(h.x=.001),this._vertexData[l++]=h.x,this._vertexData[l++]=h.y,this._vertexData[l++]=h.z}else{var v=n.direction;this.isLocal&&(d.e.TransformNormalToRef(v,this._emitterWorldMatrix,d.c.Vector3[0]),v=d.c.Vector3[0]),v.x===0&&v.z===0&&(v.x=.001),this._vertexData[l++]=v.x,this._vertexData[l++]=v.y,this._vertexData[l++]=v.z}this._useRampGradients&&n.remapData&&(this._vertexData[l++]=n.remapData.x,this._vertexData[l++]=n.remapData.y,this._vertexData[l++]=n.remapData.z,this._vertexData[l++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),o===0?o=this._epsilon:o===1&&(o=1-this._epsilon)),this._vertexData[l++]=r,this._vertexData[l++]=o)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);e!==-1&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},t.prototype._update=function(e){var n,r=this;if(this._alive=this._particles.length>0,this.emitter.position){var o=this.emitter;this._emitterWorldMatrix=o.getWorldMatrix()}else{var l=this.emitter;this._emitterWorldMatrix=d.a.Translation(l.x,l.y,l.z)}this.updateFunction(this._particles);for(var h,v=function(){if(b._particles.length===b._capacity)return"break";if(n=b._createParticle(),b._particles.push(n),b.targetStopDuration&&b._lifeTimeGradients&&b._lifeTimeGradients.length>0){var D=se.a.Clamp(b._actualFrame/b.targetStopDuration);Tr.GetCurrentGradient(D,b._lifeTimeGradients,function(k,H){var J=k,te=H,oe=J.getFactor(),ce=te.getFactor(),he=(D-J.gradient)/(te.gradient-J.gradient);n.lifeTime=se.a.Lerp(oe,ce,he)})}else n.lifeTime=se.a.RandomRange(b.minLifeTime,b.maxLifeTime);var N=se.a.RandomRange(b.minEmitPower,b.maxEmitPower);if(b.startPositionFunction?b.startPositionFunction(b._emitterWorldMatrix,n.position,n,b.isLocal):b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,n.position,n,b.isLocal),b.isLocal&&(n._localPosition?n._localPosition.copyFrom(n.position):n._localPosition=n.position.clone(),d.e.TransformCoordinatesToRef(n._localPosition,b._emitterWorldMatrix,n.position)),b.startDirectionFunction?b.startDirectionFunction(b._emitterWorldMatrix,n.direction,n,b.isLocal):b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,n.direction,n,b.isLocal),N===0?n._initialDirection?n._initialDirection.copyFrom(n.direction):n._initialDirection=n.direction.clone():n._initialDirection=null,n.direction.scaleInPlace(N),b._sizeGradients&&b._sizeGradients.length!==0?(n._currentSizeGradient=b._sizeGradients[0],n._currentSize1=n._currentSizeGradient.getFactor(),n.size=n._currentSize1,b._sizeGradients.length>1?n._currentSize2=b._sizeGradients[1].getFactor():n._currentSize2=n._currentSize1):n.size=se.a.RandomRange(b.minSize,b.maxSize),n.scale.copyFromFloats(se.a.RandomRange(b.minScaleX,b.maxScaleX),se.a.RandomRange(b.minScaleY,b.maxScaleY)),b._startSizeGradients&&b._startSizeGradients[0]&&b.targetStopDuration){var j=b._actualFrame/b.targetStopDuration;Tr.GetCurrentGradient(j,b._startSizeGradients,function(k,H,J){k!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=H.getFactor(),r._currentStartSizeGradient=k);var te=se.a.Lerp(r._currentStartSize1,r._currentStartSize2,J);n.scale.scaleInPlace(te)})}b._angularSpeedGradients&&b._angularSpeedGradients.length!==0?(n._currentAngularSpeedGradient=b._angularSpeedGradients[0],n.angularSpeed=n._currentAngularSpeedGradient.getFactor(),n._currentAngularSpeed1=n.angularSpeed,b._angularSpeedGradients.length>1?n._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():n._currentAngularSpeed2=n._currentAngularSpeed1):n.angularSpeed=se.a.RandomRange(b.minAngularSpeed,b.maxAngularSpeed),n.angle=se.a.RandomRange(b.minInitialRotation,b.maxInitialRotation),b._velocityGradients&&b._velocityGradients.length>0&&(n._currentVelocityGradient=b._velocityGradients[0],n._currentVelocity1=n._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?n._currentVelocity2=b._velocityGradients[1].getFactor():n._currentVelocity2=n._currentVelocity1),b._limitVelocityGradients&&b._limitVelocityGradients.length>0&&(n._currentLimitVelocityGradient=b._limitVelocityGradients[0],n._currentLimitVelocity1=n._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?n._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():n._currentLimitVelocity2=n._currentLimitVelocity1),b._dragGradients&&b._dragGradients.length>0&&(n._currentDragGradient=b._dragGradients[0],n._currentDrag1=n._currentDragGradient.getFactor(),b._dragGradients.length>1?n._currentDrag2=b._dragGradients[1].getFactor():n._currentDrag2=n._currentDrag1),b._colorGradients&&b._colorGradients.length!==0?(n._currentColorGradient=b._colorGradients[0],n._currentColorGradient.getColorToRef(n.color),n._currentColor1.copyFrom(n.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(n._currentColor2):n._currentColor2.copyFrom(n.color)):(h=se.a.RandomRange(0,1),x.b.LerpToRef(b.color1,b.color2,h,n.color),b.colorDead.subtractToRef(n.color,b._colorDiff),b._colorDiff.scaleToRef(1/n.lifeTime,n.colorStep)),b._isAnimationSheetEnabled&&(n._initialStartSpriteCellID=b.startSpriteCellID,n._initialEndSpriteCellID=b.endSpriteCellID),n.direction.addInPlace(b._inheritedVelocityOffset),b._useRampGradients&&(n.remapData=new d.f(0,1,0,1)),b.noiseTexture&&(n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(n._randomNoiseCoordinates1=new d.e(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2=new d.e(Math.random(),Math.random(),Math.random()))),n._inheritParticleInfoToSubEmitters()},b=this,A=0;A<e&&v()!=="break";A++);},t._GetAttributeNamesOrOptions=function(e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=[Me.b.PositionKind,Me.b.ColorKind,"angle","offset","size"];return e&&o.push("cellIndex"),n||o.push("direction"),r&&o.push("remapData"),o},t._GetEffectCreationOptions=function(e){e===void 0&&(e=!1);var n=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMask","translationPivot","eyePosition"];return e&&n.push("particlesInfos"),n},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this._isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),n===t.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&e.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case t.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push.apply(n,t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients)),e.push.apply(e,t._GetEffectCreationOptions(this._isAnimationSheetEnabled)),r.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&(Jn.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),Jn.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._getEffect=function(e){var n=this.getCustomEffect(e);if(n)return n;var r=[];this.fillDefines(r,e);var o=r.join(`
`);if(this._cachedDefines!==o){this._cachedDefines=o;var l=[],h=[],v=[];this.fillUniformsAttributesAndSamplerNames(h,l,v),this._effect=this._engine.createEffect("particles",l,h,v,o)}return this._effect},t.prototype.animate=function(e){var n,r=this;if(e===void 0&&(e=!1),this._started){if(!e&&this._scene){if(!this.isReady()||this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var o;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this.manualEmitCount>-1)o=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var l=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var h=this._actualFrame/this.targetStopDuration;Tr.GetCurrentGradient(h,this._emitRateGradients,function(D,N,j){D!==r._currentEmitRateGradient&&(r._currentEmitRate1=r._currentEmitRate2,r._currentEmitRate2=N.getFactor(),r._currentEmitRateGradient=D),l=se.a.Lerp(r._currentEmitRate1,r._currentEmitRate2,j)})}o=l*this._scaledUpdateSpeed>>0,this._newPartsExcess+=l*this._scaledUpdateSpeed-o}if(this._newPartsExcess>1&&(o+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?o=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(o),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){for(var v=0,b=0;b<this._particles.length;b++){var A=this._particles[b];this._appendParticleVertices(v,A),v+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}this.manualEmitCount===0&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(e,n){this._appendParticleVertex(e++,n,0,0),this._useInstancing||(this._appendParticleVertex(e++,n,1,0),this._appendParticleVertex(e++,n,1,1),this._appendParticleVertex(e++,n,0,1))},t.prototype.rebuild=function(){for(var e in this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild(),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},t.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady()||!this._getEffect(t.BLENDMODE_ADD).isReady())return!1;return!0},t.prototype._render=function(e){var n,r,o=this._getEffect(e),l=this._engine;l.enableEffect(o);var h=(n=this.defaultViewMatrix)!==null&&n!==void 0?n:this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",h),o.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var v=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/v.width,this.spriteCellHeight/v.height,this.spriteCellWidth/v.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){var b=this._scene.activeCamera;o.setVector3("eyePosition",b.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));var A=o.defines;switch(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&E0.a.BindClipPlane(o,this._scene),A.indexOf("#define BILLBOARDMODE_ALL")>=0&&(h.invertToRef(d.c.Matrix[0]),o.setMatrix("invView",d.c.Matrix[0])),this._vertexArrayObject!==void 0?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):l.bindBuffers(this._vertexBuffers,this._indexBuffer,o),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),e){case t.BLENDMODE_ADD:l.setAlphaMode(g.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:l.setAlphaMode(g.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:l.setAlphaMode(g.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:l.setAlphaMode(g.a.ALPHA_MULTIPLY)}return this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing?l.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._particles.length):l.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._engine;e.setState&&(e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0));var n=0;return n=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(g.a.ALPHA_DISABLE),n},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var n=0;n<this._subEmitters.length;n++)for(var r=0,o=this._subEmitters[n];r<o.length;r++)o[r].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene&&((n=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(n,1),this._scene._activeParticleSystems.dispose()),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onStoppedObservable.clear(),this.reset()},t.prototype.clone=function(e,n){var r=Object(_.a)({},this._customEffect),o=null,l=this._engine;if(l.createEffectForParticles&&this.customShader!=null){var h=(o=this.customShader).shaderOptions.defines.length>0?o.shaderOptions.defines.join(`
`):"";r[0]=l.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,h)}var v=this.serialize(),b=t.Parse(v,this._scene||this._engine,"");return b.name=e,b.customShader=o,b._customEffect=r,n===void 0&&(n=this.emitter),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.emitter=n,this.preventAutoStart||b.start(),b},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};if(t._Serialize(n,this,e),n.textureMask=this.textureMask.asArray(),n.customShader=this.customShader,n.preventAutoStart=this.preventAutoStart,this.subEmitters){n.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var r=0,o=this._subEmitters;r<o.length;r++){for(var l=[],h=0,v=o[r];h<v.length;h++){var b=v[h];l.push(b.serialize())}n.subEmitters.push(l)}}return n},t._Serialize=function(e,n,r){if(e.name=n.name,e.id=n.id,e.capacity=n.getCapacity(),n.emitter.position){var o=n.emitter;e.emitterId=o.id}else{var l=n.emitter;e.emitter=l.asArray()}n.particleEmitterType&&(e.particleEmitterType=n.particleEmitterType.serialize()),n.particleTexture&&(r?e.texture=n.particleTexture.serialize():(e.textureName=n.particleTexture.name,e.invertY=!!n.particleTexture._invertY)),e.isLocal=n.isLocal,V.a.AppendSerializedAnimations(n,e),e.beginAnimationOnStart=n.beginAnimationOnStart,e.beginAnimationFrom=n.beginAnimationFrom,e.beginAnimationTo=n.beginAnimationTo,e.beginAnimationLoop=n.beginAnimationLoop,e.startDelay=n.startDelay,e.renderingGroupId=n.renderingGroupId,e.isBillboardBased=n.isBillboardBased,e.billboardMode=n.billboardMode,e.minAngularSpeed=n.minAngularSpeed,e.maxAngularSpeed=n.maxAngularSpeed,e.minSize=n.minSize,e.maxSize=n.maxSize,e.minScaleX=n.minScaleX,e.maxScaleX=n.maxScaleX,e.minScaleY=n.minScaleY,e.maxScaleY=n.maxScaleY,e.minEmitPower=n.minEmitPower,e.maxEmitPower=n.maxEmitPower,e.minLifeTime=n.minLifeTime,e.maxLifeTime=n.maxLifeTime,e.emitRate=n.emitRate,e.gravity=n.gravity.asArray(),e.noiseStrength=n.noiseStrength.asArray(),e.color1=n.color1.asArray(),e.color2=n.color2.asArray(),e.colorDead=n.colorDead.asArray(),e.updateSpeed=n.updateSpeed,e.targetStopDuration=n.targetStopDuration,e.blendMode=n.blendMode,e.preWarmCycles=n.preWarmCycles,e.preWarmStepOffset=n.preWarmStepOffset,e.minInitialRotation=n.minInitialRotation,e.maxInitialRotation=n.maxInitialRotation,e.startSpriteCellID=n.startSpriteCellID,e.endSpriteCellID=n.endSpriteCellID,e.spriteCellChangeSpeed=n.spriteCellChangeSpeed,e.spriteCellWidth=n.spriteCellWidth,e.spriteCellHeight=n.spriteCellHeight,e.spriteRandomStartCell=n.spriteRandomStartCell,e.isAnimationSheetEnabled=n.isAnimationSheetEnabled;var h=n.getColorGradients();if(h){e.colorGradients=[];for(var v=0,b=h;v<b.length;v++){var A=b[v],D={gradient:A.gradient,color1:A.color1.asArray()};A.color2?D.color2=A.color2.asArray():D.color2=A.color1.asArray(),e.colorGradients.push(D)}}var N=n.getRampGradients();if(N){e.rampGradients=[];for(var j=0,k=N;j<k.length;j++){var H=k[j];D={gradient:H.gradient,color:H.color.asArray()},e.rampGradients.push(D)}e.useRampGradients=n.useRampGradients}var J=n.getColorRemapGradients();if(J){e.colorRemapGradients=[];for(var te=0,oe=J;te<oe.length;te++){var ce=oe[te];D={gradient:ce.gradient,factor1:ce.factor1},ce.factor2!==void 0?D.factor2=ce.factor2:D.factor2=ce.factor1,e.colorRemapGradients.push(D)}}var he=n.getAlphaRemapGradients();if(he){e.alphaRemapGradients=[];for(var _e=0,ye=he;_e<ye.length;_e++){var Ee=ye[_e];D={gradient:Ee.gradient,factor1:Ee.factor1},Ee.factor2!==void 0?D.factor2=Ee.factor2:D.factor2=Ee.factor1,e.alphaRemapGradients.push(D)}}var Oe=n.getSizeGradients();if(Oe){e.sizeGradients=[];for(var Ae=0,xe=Oe;Ae<xe.length;Ae++){var Pe=xe[Ae];D={gradient:Pe.gradient,factor1:Pe.factor1},Pe.factor2!==void 0?D.factor2=Pe.factor2:D.factor2=Pe.factor1,e.sizeGradients.push(D)}}var Be=n.getAngularSpeedGradients();if(Be){e.angularSpeedGradients=[];for(var Ce=0,Ue=Be;Ce<Ue.length;Ce++){var Le=Ue[Ce];D={gradient:Le.gradient,factor1:Le.factor1},Le.factor2!==void 0?D.factor2=Le.factor2:D.factor2=Le.factor1,e.angularSpeedGradients.push(D)}}var ke=n.getVelocityGradients();if(ke){e.velocityGradients=[];for(var qe=0,at=ke;qe<at.length;qe++){var lt=at[qe];D={gradient:lt.gradient,factor1:lt.factor1},lt.factor2!==void 0?D.factor2=lt.factor2:D.factor2=lt.factor1,e.velocityGradients.push(D)}}var ft=n.getDragGradients();if(ft){e.dragGradients=[];for(var Je=0,dt=ft;Je<dt.length;Je++){var ut=dt[Je];D={gradient:ut.gradient,factor1:ut.factor1},ut.factor2!==void 0?D.factor2=ut.factor2:D.factor2=ut.factor1,e.dragGradients.push(D)}}var tt=n.getEmitRateGradients();if(tt){e.emitRateGradients=[];for(var mt=0,ze=tt;mt<ze.length;mt++){var rt=ze[mt];D={gradient:rt.gradient,factor1:rt.factor1},rt.factor2!==void 0?D.factor2=rt.factor2:D.factor2=rt.factor1,e.emitRateGradients.push(D)}}var At=n.getStartSizeGradients();if(At){e.startSizeGradients=[];for(var sn=0,Ht=At;sn<Ht.length;sn++){var fn=Ht[sn];D={gradient:fn.gradient,factor1:fn.factor1},fn.factor2!==void 0?D.factor2=fn.factor2:D.factor2=fn.factor1,e.startSizeGradients.push(D)}}var St=n.getLifeTimeGradients();if(St){e.lifeTimeGradients=[];for(var bn=0,cn=St;bn<cn.length;bn++){var en=cn[bn];D={gradient:en.gradient,factor1:en.factor1},en.factor2!==void 0?D.factor2=en.factor2:D.factor2=en.factor1,e.lifeTimeGradients.push(D)}}var ln=n.getLimitVelocityGradients();if(ln){e.limitVelocityGradients=[];for(var Ot=0,kt=ln;Ot<kt.length;Ot++){var Tn=kt[Ot];D={gradient:Tn.gradient,factor1:Tn.factor1},Tn.factor2!==void 0?D.factor2=Tn.factor2:D.factor2=Tn.factor1,e.limitVelocityGradients.push(D)}e.limitVelocityDamping=n.limitVelocityDamping}n.noiseTexture&&(e.noiseTexture=n.noiseTexture.serialize())},t._Parse=function(e,n,r,o){var l;l=r instanceof Xt.a?null:r;var h,v=M.a.GetClass("BABYLON.Texture");if(v&&l&&(e.texture?n.particleTexture=v.Parse(e.texture,l,o):e.textureName&&(n.particleTexture=new v(o+e.textureName,l,!1,e.invertY===void 0||e.invertY),n.particleTexture.name=e.textureName)),e.emitterId||e.emitterId===0||e.emitter!==void 0?e.emitterId&&l?n.emitter=l.getLastMeshByID(e.emitterId):n.emitter=d.e.FromArray(e.emitter):n.emitter=d.e.Zero(),n.isLocal=!!e.isLocal,e.renderingGroupId!==void 0&&(n.renderingGroupId=e.renderingGroupId),e.isBillboardBased!==void 0&&(n.isBillboardBased=e.isBillboardBased),e.billboardMode!==void 0&&(n.billboardMode=e.billboardMode),e.animations){for(var b=0;b<e.animations.length;b++){var A=e.animations[b],D=M.a.GetClass("BABYLON.Animation");D&&n.animations.push(D.Parse(A))}n.beginAnimationOnStart=e.beginAnimationOnStart,n.beginAnimationFrom=e.beginAnimationFrom,n.beginAnimationTo=e.beginAnimationTo,n.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&l&&l.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),n.startDelay=0|e.startDelay,n.minAngularSpeed=e.minAngularSpeed,n.maxAngularSpeed=e.maxAngularSpeed,n.minSize=e.minSize,n.maxSize=e.maxSize,e.minScaleX&&(n.minScaleX=e.minScaleX,n.maxScaleX=e.maxScaleX,n.minScaleY=e.minScaleY,n.maxScaleY=e.maxScaleY),e.preWarmCycles!==void 0&&(n.preWarmCycles=e.preWarmCycles,n.preWarmStepOffset=e.preWarmStepOffset),e.minInitialRotation!==void 0&&(n.minInitialRotation=e.minInitialRotation,n.maxInitialRotation=e.maxInitialRotation),n.minLifeTime=e.minLifeTime,n.maxLifeTime=e.maxLifeTime,n.minEmitPower=e.minEmitPower,n.maxEmitPower=e.maxEmitPower,n.emitRate=e.emitRate,n.gravity=d.e.FromArray(e.gravity),e.noiseStrength&&(n.noiseStrength=d.e.FromArray(e.noiseStrength)),n.color1=x.b.FromArray(e.color1),n.color2=x.b.FromArray(e.color2),n.colorDead=x.b.FromArray(e.colorDead),n.updateSpeed=e.updateSpeed,n.targetStopDuration=e.targetStopDuration,n.blendMode=e.blendMode,e.colorGradients)for(var N=0,j=e.colorGradients;N<j.length;N++){var k=j[N];n.addColorGradient(k.gradient,x.b.FromArray(k.color1),k.color2?x.b.FromArray(k.color2):void 0)}if(e.rampGradients){for(var H=0,J=e.rampGradients;H<J.length;H++){var te=J[H];n.addRampGradient(te.gradient,x.a.FromArray(te.color))}n.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var oe=0,ce=e.colorRemapGradients;oe<ce.length;oe++){var he=ce[oe];n.addColorRemapGradient(he.gradient,he.factor1!==void 0?he.factor1:he.factor,he.factor2)}if(e.alphaRemapGradients)for(var _e=0,ye=e.alphaRemapGradients;_e<ye.length;_e++){var Ee=ye[_e];n.addAlphaRemapGradient(Ee.gradient,Ee.factor1!==void 0?Ee.factor1:Ee.factor,Ee.factor2)}if(e.sizeGradients)for(var Oe=0,Ae=e.sizeGradients;Oe<Ae.length;Oe++){var xe=Ae[Oe];n.addSizeGradient(xe.gradient,xe.factor1!==void 0?xe.factor1:xe.factor,xe.factor2)}if(e.angularSpeedGradients)for(var Pe=0,Be=e.angularSpeedGradients;Pe<Be.length;Pe++){var Ce=Be[Pe];n.addAngularSpeedGradient(Ce.gradient,Ce.factor1!==void 0?Ce.factor1:Ce.factor,Ce.factor2)}if(e.velocityGradients)for(var Ue=0,Le=e.velocityGradients;Ue<Le.length;Ue++){var ke=Le[Ue];n.addVelocityGradient(ke.gradient,ke.factor1!==void 0?ke.factor1:ke.factor,ke.factor2)}if(e.dragGradients)for(var qe=0,at=e.dragGradients;qe<at.length;qe++){var lt=at[qe];n.addDragGradient(lt.gradient,lt.factor1!==void 0?lt.factor1:lt.factor,lt.factor2)}if(e.emitRateGradients)for(var ft=0,Je=e.emitRateGradients;ft<Je.length;ft++){var dt=Je[ft];n.addEmitRateGradient(dt.gradient,dt.factor1!==void 0?dt.factor1:dt.factor,dt.factor2)}if(e.startSizeGradients)for(var ut=0,tt=e.startSizeGradients;ut<tt.length;ut++){var mt=tt[ut];n.addStartSizeGradient(mt.gradient,mt.factor1!==void 0?mt.factor1:mt.factor,mt.factor2)}if(e.lifeTimeGradients)for(var ze=0,rt=e.lifeTimeGradients;ze<rt.length;ze++){var At=rt[ze];n.addLifeTimeGradient(At.gradient,At.factor1!==void 0?At.factor1:At.factor,At.factor2)}if(e.limitVelocityGradients){for(var sn=0,Ht=e.limitVelocityGradients;sn<Ht.length;sn++){var fn=Ht[sn];n.addLimitVelocityGradient(fn.gradient,fn.factor1!==void 0?fn.factor1:fn.factor,fn.factor2)}n.limitVelocityDamping=e.limitVelocityDamping}if(e.noiseTexture&&l){var St=M.a.GetClass("BABYLON.ProceduralTexture");n.noiseTexture=St.Parse(e.noiseTexture,l,o)}if(e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":h=new xh;break;case"SphereDirectedParticleEmitter":h=new mm;break;case"ConeEmitter":case"ConeParticleEmitter":h=new hm;break;case"CylinderParticleEmitter":h=new Sh;break;case"CylinderDirectedParticleEmitter":h=new dm;break;case"HemisphericParticleEmitter":h=new fm;break;case"PointParticleEmitter":h=new pm;break;case"MeshParticleEmitter":h=new w0;break;case"BoxEmitter":case"BoxParticleEmitter":default:h=new As}h.parse(e.particleEmitterType,l)}else(h=new As).parse(e,l);n.particleEmitterType=h,n.startSpriteCellID=e.startSpriteCellID,n.endSpriteCellID=e.endSpriteCellID,n.spriteCellWidth=e.spriteCellWidth,n.spriteCellHeight=e.spriteCellHeight,n.spriteCellChangeSpeed=e.spriteCellChangeSpeed,n.spriteRandomStartCell=e.spriteRandomStartCell},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var l,h=e.name,v=null,b=null;if(l=n instanceof Xt.a?n:n.getEngine(),e.customShader&&l.createEffectForParticles){var A=(b=e.customShader).shaderOptions.defines.length>0?b.shaderOptions.defines.join(`
`):"";v=l.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,A)}var D=new t(h,e.capacity,n,v,e.isAnimationSheetEnabled);if(D.customShader=b,e.id&&(D.id=e.id),e.subEmitters){D.subEmitters=[];for(var N=0,j=e.subEmitters;N<j.length;N++){for(var k=[],H=0,J=j[N];H<J.length;H++){var te=J[H];k.push(gl.Parse(te,n,r))}D.subEmitters.push(k)}}return t._Parse(e,D,n,r),e.textureMask&&(D.textureMask=x.b.FromArray(e.textureMask)),e.preventAutoStart&&(D.preventAutoStart=e.preventAutoStart),o||D.preventAutoStart||D.start(),D},t.BILLBOARDMODE_Y=g.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=g.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=g.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(ul);gl._ParseParticleSystem=jn.Parse,We.a.ShadersStore.gpuUpdateParticlesPixelShader=`#version 300 es
void main() {
discard;
}
`;var Fw=`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
#ifndef LOCAL
uniform mat4 emitterWM;
#endif
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
#ifdef CUSTOMEMITTER
in vec3 initialPosition;
#endif
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
#ifdef CUSTOMEMITTER
out vec3 outInitialPosition;
#endif
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta;

if (newAge>=life && stopFactor != 0.) {
vec3 newPosition;
vec3 newDirection;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=newAge-life;

outSeed=seed;

#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=vec3(0,0,0);
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
newDirection=direction1+(direction2-direction1)*randoms3;
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
newDirection=newPosition+directionRandomizer*randoms3;
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

newDirection=newPosition+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
newPosition=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
newDirection=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
newDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));
newDirection=normalize(newDirection);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.0001;
#else
float h=randoms2.y*height.y;

h=1.-h*h;
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
newPosition=vec3(randX,randY,randZ);

if (abs(cos(coneAngle)) == 1.0) {
newDirection=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
newDirection=normalize(newPosition+directionRandomizer*randoms3);
}
#elif defined(CUSTOMEMITTER)
newPosition=initialPosition;
outInitialPosition=initialPosition;
#else

newPosition=vec3(0.,0.,0.);

newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
#ifdef LOCAL
outPosition=newPosition;
#else
outPosition=(emitterWM*vec4(newPosition,1.)).xyz;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#ifndef BILLBOARD
outInitialDirection=direction;
#endif
#else
#ifdef LOCAL
vec3 initial=newDirection;
#else
vec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;
#endif
outDirection=initial*power;
#ifndef BILLBOARD
outInitialDirection=initial;
#endif
#endif
#ifdef ANIMATESHEET
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
#if defined(CUSTOMEMITTER)
outPosition=position+(direction-position)*ageGradient;
outInitialPosition=initialPosition;
#else
outPosition=position+direction*directionScale;
#endif
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif
#ifndef BILLBOARD
outInitialDirection=initialDirection;
#endif
#ifdef CUSTOMEMITTER
outDirection=direction;
#else
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
#endif
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#else
float cellStartOffset=0.;
#endif
float ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`;We.a.ShadersStore.gpuUpdateParticlesVertexShader=Fw;var Bw=`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif
#ifdef CLIPPLANE5
in float fClipDistance5;
#endif
#ifdef CLIPPLANE6
in float fClipDistance6;
#endif`;We.a.IncludesShadersStore.clipPlaneFragmentDeclaration2=Bw;var Uw=`#version 300 es
uniform sampler2D diffuseSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment>
vec4 textureColor=texture(diffuseSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`;We.a.ShadersStore.gpuRenderParticlesPixelShader=Uw;var Vw=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
out float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
out float fClipDistance6;
#endif`;We.a.IncludesShadersStore.clipPlaneVertexDeclaration2=Vw;var kw=`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
uniform vec3 worldOffset;
#ifdef LOCAL
uniform mat4 emitterWM;
#endif

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
out vec3 vPositionW;
#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition;
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
#ifdef LOCAL
return ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;
#else
return (position+worldOffset)+alignedCorner;
#endif
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=(position+worldOffset)-eyePosition;
yaxis.y=0.;
vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=(position+worldOffset)-eyePosition;
vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(vPositionW,1.0));
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

#ifdef LOCAL
vec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;
#else
vec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;
#endif
vPositionW=(invView*viewPosition).xyz;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vPositionW=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(vPositionW,1.0);
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
vec4 worldPos=vec4(vPositionW,1.0);
#endif
#include<clipPlaneVertex>
}`;We.a.ShadersStore.gpuRenderParticlesVertexShader=kw;var Ra=function(i){function t(e,n,r,o,l){o===void 0&&(o=!1),l===void 0&&(l=null);var h=i.call(this,e)||this;h.layerMask=268435455,h._accumulatedCount=0,h._targetIndex=0,h._currentRenderId=-1,h._started=!1,h._stopped=!1,h._timeDelta=0,h._actualFrame=0,h._rawTextureWidth=256,h.onDisposeObservable=new E.c,h.onStoppedObservable=new E.c,h.forceDepthWrite=!1,h._preWarmDone=!1,h.isLocal=!1,h._onBeforeDrawParticlesObservable=null,r&&r.getClassName()!=="Scene"?(h._engine=r,h.defaultProjectionMatrix=d.a.PerspectiveFovLH(.8,1,.1,100)):(h._scene=r||$.a.LastCreatedScene,h._engine=h._scene.getEngine(),h.uniqueId=h._scene.getUniqueId(),h._scene.particleSystems.push(h)),h._customEffect={0:l},h._attachImageProcessingConfiguration(null),n.randomTextureSize||delete n.randomTextureSize;var v=Object(_.a)({capacity:5e4,randomTextureSize:h._engine.getCaps().maxTextureSize},n),b=n;isFinite(b)&&(v.capacity=b),h._capacity=v.capacity,h._activeCount=v.capacity,h._currentActiveCount=0,h._isAnimationSheetEnabled=o,h._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},h.particleEmitterType=new As;for(var A=Math.min(h._engine.getCaps().maxTextureSize,v.randomTextureSize),D=[],N=0;N<A;++N)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());for(h._randomTexture=new hr(new Float32Array(D),A,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),h._randomTexture.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,h._randomTexture.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,D=[],N=0;N<A;++N)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());return h._randomTexture2=new hr(new Float32Array(D),A,1,g.a.TEXTUREFORMAT_RGBA,r,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),h._randomTexture2.wrapU=g.a.TEXTURE_WRAP_ADDRESSMODE,h._randomTexture2.wrapV=g.a.TEXTURE_WRAP_ADDRESSMODE,h._randomTextureSize=A,h}return Object(_.d)(t,i),Object.defineProperty(t,"IsSupported",{get:function(){return!!$.a.LastCreatedEngine&&$.a.LastCreatedEngine.webGLVersion>1},enumerable:!1,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&(!this._imageProcessingConfiguration||this._imageProcessingConfiguration.isReady())&&this._getEffect().isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.isStopped=function(){return this._stopped},t.prototype.isStopping=function(){return!1},t.prototype.getActiveCount=function(){return this._currentActiveCount},t.prototype.start=function(e){var n=this;if(e===void 0&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout(function(){n.start(0)},e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped||(this._stopped=!0)},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype.getCustomEffect=function(e){var n;return e===void 0&&(e=0),(n=this._customEffect[e])!==null&&n!==void 0?n:this._customEffect[0]},t.prototype.setCustomEffect=function(e,n){n===void 0&&(n=0),this._customEffect[n]=e},Object.defineProperty(t.prototype,"onBeforeDrawParticlesObservable",{get:function(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new E.c),this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0}),t.prototype._removeGradientAndTexture=function(e,n,r){return i.prototype._removeGradientAndTexture.call(this,e,n,r),this._releaseBuffers(),this},t.prototype.addColorGradient=function(e,n,r){this._colorGradients||(this._colorGradients=[]);var o=new Nm(e,n);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this},t.prototype._refreshColorGradient=function(e){e===void 0&&(e=!1),this._colorGradients&&(e&&this._colorGradients.sort(function(n,r){return n.gradient<r.gradient?-1:n.gradient>r.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))},t.prototype.forceRefreshGradients=function(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()},t.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(e,n,r){var o=new Fm(n,r);e.push(o),this._releaseBuffers()},t.prototype.addSizeGradient=function(e,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,n),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype._refreshFactorGradient=function(e,n,r){r===void 0&&(r=!1),e&&(r&&e.sort(function(o,l){return o.gradient<l.gradient?-1:o.gradient>l.gradient?1:0}),this[n]&&(this[n].dispose(),this[n]=null))},t.prototype.addAngularSpeedGradient=function(e,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,n),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(e,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,n),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(e,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,n),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(e,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,n),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(e,n,r){return this},t.prototype.removeEmitRateGradient=function(e){return this},t.prototype.addStartSizeGradient=function(e,n,r){return this},t.prototype.removeStartSizeGradient=function(e){return this},t.prototype.addColorRemapGradient=function(e,n,r){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(e,n,r){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(e,n){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.addLifeTimeGradient=function(e,n,r){return this},t.prototype.removeLifeTimeGradient=function(e){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(e){var n={};n.position=e.createVertexBuffer("position",0,3);var r=3;this.particleEmitterType instanceof Cs&&(n.initialPosition=e.createVertexBuffer("initialPosition",r,3),r+=3),n.age=e.createVertexBuffer("age",r,1),r+=1,n.life=e.createVertexBuffer("life",r,1),r+=1,n.seed=e.createVertexBuffer("seed",r,4),r+=4,n.size=e.createVertexBuffer("size",r,3),r+=3,this._colorGradientsTexture||(n.color=e.createVertexBuffer("color",r,4),r+=4),n.direction=e.createVertexBuffer("direction",r,3),r+=3,this._isBillboardBased||(n.initialDirection=e.createVertexBuffer("initialDirection",r,3),r+=3),this._angularSpeedGradientsTexture?(n.angle=e.createVertexBuffer("angle",r,1),r+=1):(n.angle=e.createVertexBuffer("angle",r,2),r+=2),this._isAnimationSheetEnabled&&(n.cellIndex=e.createVertexBuffer("cellIndex",r,1),r+=1,this.spriteRandomStartCell&&(n.cellStartOffset=e.createVertexBuffer("cellStartOffset",r,1),r+=1)),this.noiseTexture&&(n.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",r,3),r+=3,n.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",r,3),r+=3);var o=this._engine.recordVertexArrayObject(n,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o},t.prototype._createRenderVAO=function(e,n){var r={};r.position=e.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var o=3;this.particleEmitterType instanceof Cs&&(o+=3),r.age=e.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,r.life=e.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=5,r.size=e.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,this._colorGradientsTexture||(r.color=e.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this.billboardMode===jn.BILLBOARDMODE_STRETCHED&&(r.direction=e.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._isBillboardBased||(r.initialDirection=e.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3),r.angle=e.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(r.cellIndex=e.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(r.cellStartOffset=e.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),this.noiseTexture&&(r.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,r.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3),r.offset=n.createVertexBuffer("offset",0,2),r.uv=n.createVertexBuffer("uv",2,2);var l=this._engine.recordVertexArrayObject(r,null,this._getEffect());return this._engine.bindArrayBuffer(null),l},t.prototype._initialize=function(e){if(e===void 0&&(e=!1),!this._buffer0||e){var n=this._engine,r=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.particleEmitterType instanceof Cs&&(this._attributesStrideSize+=3),this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var o=this.particleEmitterType instanceof Cs,l=d.c.Vector3[0],h=0;h<this._capacity;h++)r.push(0),r.push(0),r.push(0),o&&(this.particleEmitterType.particlePositionGenerator(h,null,l),r.push(l.x),r.push(l.y),r.push(l.z)),r.push(0),r.push(0),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(0),r.push(0),r.push(0),this._colorGradientsTexture||(r.push(0),r.push(0),r.push(0),r.push(0)),o?(this.particleEmitterType.particleDestinationGenerator(h,null,l),r.push(l.x),r.push(l.y),r.push(l.z)):(r.push(0),r.push(0),r.push(0)),this.isBillboardBased||(r.push(0),r.push(0),r.push(0)),r.push(0),this._angularSpeedGradientsTexture||r.push(0),this._isAnimationSheetEnabled&&(r.push(0),this.spriteRandomStartCell&&r.push(0)),this.noiseTexture&&(r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()));var v=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new Me.a(n,r,!1,this._attributesStrideSize),this._buffer1=new Me.a(n,r,!1,this._attributesStrideSize),this._spriteBuffer=new Me.a(n,v,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(e+=`
#define BILLBOARD`),this._colorGradientsTexture&&(e+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(e+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(e+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(e+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(e+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(e+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(e+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(e+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(e+=`
#define NOISE`),this.isLocal&&(e+=`
#define LOCAL`),this._updateEffect&&this._updateEffectOptions.defines===e||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof Cs&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=e,this._updateEffect=new We.a("gpuUpdateParticles",this._updateEffectOptions,this._engine))},t.prototype._getEffect=function(){var e;return(e=this.getCustomEffect())!==null&&e!==void 0?e:this._renderEffect},t.prototype.fillDefines=function(e,n){if(this._scene&&(this._scene.clipPlane&&e.push("#define CLIPPLANE"),this._scene.clipPlane2&&e.push("#define CLIPPLANE2"),this._scene.clipPlane3&&e.push("#define CLIPPLANE3"),this._scene.clipPlane4&&e.push("#define CLIPPLANE4"),this._scene.clipPlane5&&e.push("#define CLIPPLANE5"),this._scene.clipPlane6&&e.push("#define CLIPPLANE6")),this.blendMode===jn.BLENDMODE_MULTIPLY&&e.push("#define BLENDMULTIPLYMODE"),this.isLocal&&e.push("#define LOCAL"),this._isBillboardBased)switch(e.push("#define BILLBOARD"),this.billboardMode){case jn.BILLBOARDMODE_Y:e.push("#define BILLBOARDY");break;case jn.BILLBOARDMODE_STRETCHED:e.push("#define BILLBOARDSTRETCHED");break;case jn.BILLBOARDMODE_ALL:e.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&e.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&e.push("#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e.push(""+this._imageProcessingConfigurationDefines.toString()))},t.prototype.fillUniformsAttributesAndSamplerNames=function(e,n,r){n.push("position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"),e.push("emitterWM","worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition"),r.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Jn.a.PrepareUniforms(e,this._imageProcessingConfigurationDefines),Jn.a.PrepareSamplers(r,this._imageProcessingConfigurationDefines))},t.prototype._recreateRenderEffect=function(){var e=this.getCustomEffect();if(e)return e;var n=[];this.fillDefines(n);var r=n.join(`
`);if(this._renderEffect&&this._renderEffect.defines===r)return this._renderEffect;var o=[],l=[],h=[];return this.fillUniformsAttributesAndSamplerNames(l,o,h),this._renderEffect=new We.a("gpuRenderParticles",o,l,h,this._engine,r),this._renderEffect},t.prototype.animate=function(e){var n;e===void 0&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:((n=this._scene)===null||n===void 0?void 0:n.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(e,n){var r=this[n];if(e&&e.length&&!r){for(var o=new Float32Array(this._rawTextureWidth),l=0;l<this._rawTextureWidth;l++){var h=l/this._rawTextureWidth;Tr.GetCurrentGradient(h,e,function(v,b,A){o[l]=se.a.Lerp(v.factor1,b.factor1,A)})}this[n]=hr.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),n=x.c.Color4[0],r=0;r<this._rawTextureWidth;r++){var o=r/this._rawTextureWidth;Tr.GetCurrentGradient(o,this._colorGradients,function(l,h,v){x.b.LerpToRef(l.color1,h.color1,v,n),e[4*r]=255*n.r,e[4*r+1]=255*n.g,e[4*r+2]=255*n.b,e[4*r+3]=255*n.a})}this._colorGradientsTexture=hr.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE)}},t.prototype.render=function(e){var n,r;if(e===void 0&&(e=!1),!this._started||(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady()))return 0;if(!e&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var o=0;o<this.preWarmCycles;o++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var l=0|this._accumulatedCount;this._accumulatedCount-=l,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+l)}if(!this._currentActiveCount)return 0;this._engine.enableEffect(this._updateEffect);var h,v=this._engine;if(!v.setState)throw new Error("GPU particles cannot work with a full Engine. ThinEngine is not supported");if(this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)h=this.emitter.getWorldMatrix();else{var b=this.emitter;h=d.a.Translation(b.x,b.y,b.z)}if(this.isLocal||this._updateEffect.setMatrix("emitterWM",h),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),v.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),v.setRasterizerState(!1),v.beginTransformFeedback(!0),v.drawArraysType(g.a.MATERIAL_PointListDrawMode,0,this._currentActiveCount),v.endTransformFeedback(),v.setRasterizerState(!0),v.bindTransformFeedbackBuffer(null),!e){var A=this._getEffect();this._engine.enableEffect(A);var D=((n=this._scene)===null||n===void 0?void 0:n.getViewMatrix())||d.a.IdentityReadOnly;if(A.setMatrix("view",D),A.setMatrix("projection",(r=this.defaultProjectionMatrix)!==null&&r!==void 0?r:this._scene.getProjectionMatrix()),A.setTexture("diffuseSampler",this.particleTexture),A.setVector2("translationPivot",this.translationPivot),A.setVector3("worldOffset",this.worldOffset),this.isLocal&&A.setMatrix("emitterWM",h),this._colorGradientsTexture?A.setTexture("colorGradientSampler",this._colorGradientsTexture):A.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var N=this.particleTexture.getBaseSize();A.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){var j=this._scene.activeCamera;A.setVector3("eyePosition",j.globalPosition)}var k=A.defines;if(this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&ot.a.BindClipPlane(A,this._scene),k.indexOf("#define BILLBOARDMODE_ALL")>=0){var H=D.clone();H.invert(),A.setMatrix("invView",H)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),this.blendMode){case jn.BLENDMODE_ADD:this._engine.setAlphaMode(g.a.ALPHA_ADD);break;case jn.BLENDMODE_ONEONE:this._engine.setAlphaMode(g.a.ALPHA_ONEONE);break;case jn.BLENDMODE_STANDARD:this._engine.setAlphaMode(g.a.ALPHA_COMBINE);break;case jn.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(g.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&v.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),this._engine.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(g.a.ALPHA_DISABLE)}this._targetIndex++,this._targetIndex===2&&(this._targetIndex=0);var J=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=J,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);for(this._updateVAO=[],e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO=[]}},t.prototype.dispose=function(e){if(e===void 0&&(e=!0),this._scene){var n=this._scene.particleSystems.indexOf(this);n>-1&&this._scene.particleSystems.splice(n,1)}this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,n){var r=this.serialize(),o=t.Parse(r,this._scene||this._engine,""),l=Object(_.a)({},this._customEffect);return o.name=e,o._customEffect=l,n===void 0&&(n=this.emitter),o.emitter=n,o.noiseTexture=this.noiseTexture,o},t.prototype.serialize=function(e){e===void 0&&(e=!1);var n={};return jn._Serialize(n,this,e),n.activeParticleCount=this.activeParticleCount,n.randomTextureSize=this._randomTextureSize,n},t.Parse=function(e,n,r,o){o===void 0&&(o=!1);var l=new t(e.name,{capacity:e.capacity,randomTextureSize:e.randomTextureSize},n);return e.activeParticleCount&&(l.activeParticleCount=e.activeParticleCount),jn._Parse(e,l,n,r),e.preventAutoStart&&(l.preventAutoStart=e.preventAutoStart),o||l.preventAutoStart||l.start(),l},t}(ul),Mh=function(){function i(){this.systems=new Array}return Object.defineProperty(i.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!1,configurable:!0}),i.prototype.setEmitterAsSphere=function(t,e,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:e};var r=Mr.a.CreateSphere("emitterSphere",{diameter:t.diameter,segments:t.segments},n);r.renderingGroupId=e;var o=new Qt.a("emitterSphereMaterial",n);o.emissiveColor=t.color,r.material=o;for(var l=0,h=this.systems;l<h.length;l++)h[l].emitter=r;this._emitterNode=r},i.prototype.start=function(t){for(var e=0,n=this.systems;e<n.length;e++){var r=n[e];t&&(r.emitter=t),r.start()}},i.prototype.dispose=function(){for(var t=0,e=this.systems;t<e.length;t++)e[t].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},i.prototype.serialize=function(t){t===void 0&&(t=!1);for(var e={systems:[]},n=0,r=this.systems;n<r.length;n++){var o=r[n];e.systems.push(o.serialize(t))}return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},i.Parse=function(t,e,n){n===void 0&&(n=!1);var r=new i,o=this.BaseAssetsUrl+"/textures/";e=e||$.a.LastCreatedScene;for(var l=0,h=t.systems;l<h.length;l++){var v=h[l];r.systems.push(n?Ra.Parse(v,e,o,!0):jn.Parse(v,e,o,!0))}if(t.emitter){var b=t.emitter.options;switch(t.emitter.kind){case"Sphere":r.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:x.a.FromArray(b.color)},t.emitter.renderingGroupId,e)}}return r},i.BaseAssetsUrl="https://assets.babylonjs.com/particles",i}(),jw=function(){function i(){}return i.CreateDefault=function(t,e,n,r){var o;return e===void 0&&(e=500),r===void 0&&(r=!1),(o=r?new Ra("default system",{capacity:e},n):new jn("default system",e,n)).emitter=t,o.particleTexture=new Ve.a("https://www.babylonjs.com/assets/Flare.png",o.getScene()),o.createConeEmitter(.1,Math.PI/4),o.color1=new x.b(1,1,1,1),o.color2=new x.b(1,1,1,1),o.colorDead=new x.b(1,1,1,0),o.minSize=.1,o.maxSize=.1,o.minEmitPower=2,o.maxEmitPower=2,o.updateSpeed=1/60,o.emitRate=30,o},i.CreateAsync=function(t,e,n){n===void 0&&(n=!1),e||(e=$.a.LastCreatedScene);var r={};return e._addPendingData(r),new Promise(function(o,l){if(n&&!Ra.IsSupported)return e._removePendingData(r),l("Particle system with GPU is not supported.");Qe.b.LoadFile(i.BaseAssetsUrl+"/systems/"+t+".json",function(h){e._removePendingData(r);var v=JSON.parse(h.toString());return o(Mh.Parse(v,e,n))},void 0,void 0,void 0,function(){return e._removePendingData(r),l("An error occured while the creation of your particle system. Check if your type '"+t+"' exists.")})})},i.ExportSet=function(t){for(var e=new Mh,n=0,r=t;n<r.length;n++){var o=r[n];e.systems.push(o)}return e},i.ParseFromFileAsync=function(t,e,n,r,o){return r===void 0&&(r=!1),o===void 0&&(o=""),new Promise(function(l,h){var v=new re.a;v.addEventListener("readystatechange",function(){if(v.readyState==4)if(v.status==200){var b=JSON.parse(v.responseText),A=void 0;A=r?Ra.Parse(b,n,o):jn.Parse(b,n,o),t&&(A.name=t),l(A)}else h("Unable to load the particle system")}),v.open("GET",e),v.send()})},i.CreateFromSnippetAsync=function(t,e,n,r){var o=this;if(n===void 0&&(n=!1),r===void 0&&(r=""),t==="_BLANK"){var l=this.CreateDefault(null);return l.start(),Promise.resolve(l)}return new Promise(function(h,v){var b=new re.a;b.addEventListener("readystatechange",function(){if(b.readyState==4)if(b.status==200){var A=JSON.parse(JSON.parse(b.responseText).jsonPayload),D=JSON.parse(A.particleSystem),N=void 0;(N=n?Ra.Parse(D,e,r):jn.Parse(D,e,r)).snippetId=t,h(N)}else v("Unable to load the snippet "+t)}),b.open("GET",o.SnippetUrl+"/"+t.replace(/#/g,"/")),b.send()})},i.BaseAssetsUrl=Mh.BaseAssetsUrl,i.SnippetUrl="https://snippet.babylonjs.com",i}();T.a.AddParser(ct.a.NAME_PARTICLESYSTEM,function(i,t,e,n){var r=T.a.GetIndividualParser(ct.a.NAME_PARTICLESYSTEM);if(r&&i.particleSystems!==void 0&&i.particleSystems!==null)for(var o=0,l=i.particleSystems.length;o<l;o++){var h=i.particleSystems[o];e.particleSystems.push(r(h,t,n))}}),T.a.AddIndividualParser(ct.a.NAME_PARTICLESYSTEM,function(i,t,e){return i.activeParticleCount?Ra.Parse(i,t,e):jn.Parse(i,t,e)}),Xe.a.prototype.createEffectForParticles=function(i,t,e,n,r,o,l,h){var v;t===void 0&&(t=[]),e===void 0&&(e=[]),n===void 0&&(n="");var b=[],A=[],D=[];return h?h.fillUniformsAttributesAndSamplerNames(A,b,D):(b=jn._GetAttributeNamesOrOptions(),A=jn._GetEffectCreationOptions()),n.indexOf(" BILLBOARD")===-1&&(n+=`
#define BILLBOARD
`),e.indexOf("diffuseSampler")===-1&&e.push("diffuseSampler"),this.createEffect({vertex:(v=h==null?void 0:h.vertexShaderName)!==null&&v!==void 0?v:"particles",fragmentElement:i},b,A.concat(t),D.concat(e),n,r,o,l)},Ne.a.prototype.getEmittedParticleSystems=function(){for(var i=new Array,t=0;t<this.getScene().particleSystems.length;t++){var e=this.getScene().particleSystems[t];e.emitter===this&&i.push(e)}return i},Ne.a.prototype.getHierarchyEmittedParticleSystems=function(){var i=new Array,t=this.getDescendants();t.push(this);for(var e=0;e<this.getScene().particleSystems.length;e++){var n=this.getScene().particleSystems[e],r=n.emitter;r.position&&t.indexOf(r)!==-1&&i.push(n)}return i};var ar,Bm=function(){function i(t,e,n,r,o,l,h,v,b,A){b===void 0&&(b=null),A===void 0&&(A=null),this.idx=0,this.id=0,this.color=new x.b(1,1,1,1),this.position=d.e.Zero(),this.rotation=d.e.Zero(),this.scaling=d.e.One(),this.uvs=new d.f(0,0,1,1),this.velocity=d.e.Zero(),this.pivot=d.e.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.materialIndex=null,this.props=null,this.cullingStrategy=Lt.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=d.e.Zero(),this.idx=t,this.id=e,this._pos=n,this._ind=r,this._model=o,this.shapeId=l,this.idxInShape=h,this._sps=v,b&&(this._modelBoundingInfo=b,this._boundingInfo=new Fo.a(b.minimum,b.maximum)),A!==null&&(this.materialIndex=A)}return i.prototype.copyToRef=function(t){return t.position.copyFrom(this.position),t.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(t.rotationQuaternion?t.rotationQuaternion.copyFrom(this.rotationQuaternion):t.rotationQuaternion=this.rotationQuaternion.clone()),t.scaling.copyFrom(this.scaling),this.color&&(t.color?t.color.copyFrom(this.color):t.color=this.color.clone()),t.uvs.copyFrom(this.uvs),t.velocity.copyFrom(this.velocity),t.pivot.copyFrom(this.pivot),t.translateFromPivot=this.translateFromPivot,t.alive=this.alive,t.isVisible=this.isVisible,t.parentId=this.parentId,t.cullingStrategy=this.cullingStrategy,this.materialIndex!==null&&(t.materialIndex=this.materialIndex),this},Object.defineProperty(i.prototype,"scale",{get:function(){return this.scaling},set:function(t){this.scaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t){return!(!this._boundingInfo||!t._boundingInfo)&&(this._sps._bSphereOnly?by.a.Intersects(this._boundingInfo.boundingSphere,t._boundingInfo.boundingSphere):this._boundingInfo.intersects(t._boundingInfo,!1))},i.prototype.isInFrustum=function(t){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=d.c.Quaternion[0];var n=this.rotation;d.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),Um=function(i,t,e,n,r,o,l,h,v){this._indicesLength=0,this.shapeID=i,this._shape=t,this._indices=e,this._indicesLength=e.length,this._shapeUV=o,this._shapeColors=r,this._normals=n,this._positionFunction=l,this._vertexFunction=h,this._material=v},YT=function(i,t,e,n){this.idx=0,this.ind=0,this.indicesLength=0,this.sqDistance=0,this.materialIndex=0,this.idx=i,this.ind=t,this.indicesLength=e,this.materialIndex=n},KT=function(){function i(){this.position=d.e.Zero(),this.color=new x.b(1,1,1,1),this.uv=d.d.Zero()}return Object.defineProperty(i.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this.position.z},set:function(t){this.position.z=t},enumerable:!1,configurable:!0}),i}(),zw=function(){function i(t,e,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!1,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._expandable=!1,this._shapeCounter=0,this._copy=new Bm(0,0,0,0,null,0,0,this),this._color=new x.b(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this._isNotBuilt=!0,this._lastParticleId=0,this._idxOfId=[],this._multimaterialEnabled=!1,this._useModelMaterial=!1,this._depthSortFunction=function(r,o){return o.sqDistance-r.sqDistance},this._materialSortFunction=function(r,o){return r.materialIndex-o.materialIndex},this._autoUpdateSubMeshes=!1,this.name=t,this._scene=e||$.a.LastCreatedScene,this._camera=e.activeCamera,this._pickable=!!n&&n.isPickable,this._depthSort=!!n&&n.enableDepthSort,this._multimaterialEnabled=!!n&&n.enableMultiMaterial,this._useModelMaterial=!!n&&n.useModelMaterial,this._multimaterialEnabled=!!this._useModelMaterial||this._multimaterialEnabled,this._expandable=!!n&&n.expandable,this._particlesIntersect=!!n&&n.particleIntersection,this._bSphereOnly=!!n&&n.boundingSphereOnly,this._bSphereRadiusFactor=n&&n.bSphereRadiusFactor?n.bSphereRadiusFactor:1,n&&n.updatable!==void 0?this._updatable=n.updatable:this._updatable=!0,this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]),(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]),this._multimaterialEnabled&&(this._multimaterial=new Aa.a(this.name+"MultiMaterial",this._scene),this._materials=[],this._materialIndexesById={}),this._tmpVertex=new KT}return i.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(this.nbParticles===0&&!this.mesh){var t=Oh.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}if(this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),!this.mesh){var e=new Ne.a(this.name,this._scene);this.mesh=e}!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial(),this.recomputeNormals&&_t.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var n=new _t.a;if(n.indices=this._depthSort?this._indices:this._indices32,n.set(this._positions32,Me.b.PositionKind),n.set(this._normals32,Me.b.NormalKind),this._uvs32.length>0&&n.set(this._uvs32,Me.b.UVKind),this._colors32.length>0&&n.set(this._colors32,Me.b.ColorKind),n.applyToMesh(this.mesh,this._updatable),this.mesh.isPickable=this._pickable,this._pickable){for(var r=0,o=0;o<this.nbParticles;o++)for(var l=this.particles[o],h=l._model._indicesLength,v=0;v<h;v++)if(v%3==0){var b={idx:l.idx,faceId:r};this.pickedParticles[r]=b,r++}}return this._multimaterialEnabled&&this.setMultiMaterial(this._materials),this._expandable||(this._depthSort||this._multimaterialEnabled||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0)),this._isNotBuilt=!1,this.recomputeNormals=!1,this.mesh},i.prototype.digest=function(t,e){var n=e&&e.facetNb||1,r=e&&e.number||0,o=e&&e.delta||0,l=t.getVerticesData(Me.b.PositionKind),h=t.getIndices(),v=t.getVerticesData(Me.b.UVKind),b=t.getVerticesData(Me.b.ColorKind),A=t.getVerticesData(Me.b.NormalKind),D=e&&e.storage?e.storage:null,N=0,j=h.length/3;r?(r=r>j?j:r,n=Math.round(j/r),o=0):n=n>j?j:n;for(var k=[],H=[],J=[],te=[],oe=[],ce=d.e.Zero(),he=n;N<j;){N>j-(n=he+Math.floor((1+o)*Math.random()))&&(n=j-N),k.length=0,H.length=0,J.length=0,te.length=0,oe.length=0;for(var _e=0,ye=3*N;ye<3*(N+n);ye++){J.push(_e);var Ee=h[ye],Oe=3*Ee;if(k.push(l[Oe],l[Oe+1],l[Oe+2]),H.push(A[Oe],A[Oe+1],A[Oe+2]),v){var Ae=2*Ee;te.push(v[Ae],v[Ae+1])}if(b){var xe=4*Ee;oe.push(b[xe],b[xe+1],b[xe+2],b[xe+3])}_e++}var Pe,Be=this.nbParticles,Ce=this._posToShape(k),Ue=this._uvsToShapeUV(te),Le=Qe.b.Slice(J),ke=Qe.b.Slice(oe),qe=Qe.b.Slice(H);for(ce.copyFromFloats(0,0,0),Pe=0;Pe<Ce.length;Pe++)ce.addInPlace(Ce[Pe]);ce.scaleInPlace(1/Ce.length);var at,lt=new d.e(1/0,1/0,1/0),ft=new d.e(-1/0,-1/0,-1/0);for(Pe=0;Pe<Ce.length;Pe++)Ce[Pe].subtractInPlace(ce),lt.minimizeInPlaceFromFloats(Ce[Pe].x,Ce[Pe].y,Ce[Pe].z),ft.maximizeInPlaceFromFloats(Ce[Pe].x,Ce[Pe].y,Ce[Pe].z);this._particlesIntersect&&(at=new Fo.a(lt,ft));var Je=null;this._useModelMaterial&&(Je=t.material?t.material:this._setDefaultMaterial());var dt=new Um(this._shapeCounter,Ce,Le,qe,ke,Ue,null,null,Je),ut=this._positions.length,tt=this._indices.length;this._meshBuilder(this._index,tt,Ce,this._positions,Le,this._indices,te,this._uvs,ke,this._colors,qe,this._normals,Be,0,null,dt),this._addParticle(Be,this._lastParticleId,ut,tt,dt,this._shapeCounter,0,at,D),this.particles[this.nbParticles].position.addInPlace(ce),D||(this._index+=Ce.length,Be++,this.nbParticles++,this._lastParticleId++),this._shapeCounter++,N+=n}return this._isNotBuilt=!0,this},i.prototype._unrotateFixedNormals=function(){for(var t=0,e=0,n=d.c.Vector3[0],r=d.c.Quaternion[0],o=d.c.Matrix[0],l=0;l<this.particles.length;l++){var h=this.particles[l],v=h._model._shape;if(h.rotationQuaternion)h.rotationQuaternion.conjugateToRef(r);else{var b=h.rotation;d.b.RotationYawPitchRollToRef(b.y,b.x,b.z,r),r.conjugateInPlace()}r.toRotationMatrix(o);for(var A=0;A<v.length;A++)e=t+3*A,d.e.TransformNormalFromFloatsToRef(this._normals32[e],this._normals32[e+1],this._normals32[e+2],o,n),n.toArray(this._fixedNormal32,e);t=e+3}},i.prototype._resetCopy=function(){var t=this._copy;t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.copyFromFloats(0,0,1,1),t.color=null,t.translateFromPivot=!1,t.shapeId=0,t.materialIndex=null},i.prototype._meshBuilder=function(t,e,n,r,o,l,h,v,b,A,D,N,j,k,H,J){var te,oe=0,ce=0,he=0;this._resetCopy();var _e=this._copy,ye=!(!H||!H.storage);if(_e.idx=j,_e.idxInShape=k,_e.shapeId=J.shapeID,this._useModelMaterial){var Ee=J._material.uniqueId,Oe=this._materialIndexesById;Oe.hasOwnProperty(Ee)||(Oe[Ee]=this._materials.length,this._materials.push(J._material));var Ae=Oe[Ee];_e.materialIndex=Ae}if(H&&H.positionFunction&&(H.positionFunction(_e,j,k),this._mustUnrotateFixedNormals=!0),ye)return _e;var xe=d.c.Matrix[0],Pe=this._tmpVertex,Be=Pe.position,Ce=Pe.color,Ue=Pe.uv,Le=d.c.Vector3[1],ke=d.c.Vector3[2],qe=d.c.Vector3[3];d.a.IdentityToRef(xe),_e.getRotationMatrix(xe),_e.pivot.multiplyToRef(_e.scaling,qe),_e.translateFromPivot?ke.setAll(0):ke.copyFrom(qe);var at=H&&H.vertexFunction;for(te=0;te<n.length;te++){if(Be.copyFrom(n[te]),_e.color&&Ce.copyFrom(_e.color),h&&Ue.copyFromFloats(h[oe],h[oe+1]),at&&H.vertexFunction(_e,Pe,te),Be.multiplyInPlace(_e.scaling).subtractInPlace(qe),d.e.TransformCoordinatesToRef(Be,xe,Le),Le.addInPlace(ke).addInPlace(_e.position),r.push(Le.x,Le.y,Le.z),h){var lt=_e.uvs;v.push((lt.z-lt.x)*Ue.x+lt.x,(lt.w-lt.y)*Ue.y+lt.y),oe+=2}if(_e.color)this._color.copyFrom(Ce);else{var ft=this._color;b&&b[ce]!==void 0?(ft.r=b[ce],ft.g=b[ce+1],ft.b=b[ce+2],ft.a=b[ce+3]):(ft.r=1,ft.g=1,ft.b=1,ft.a=1)}A.push(this._color.r,this._color.g,this._color.b,this._color.a),ce+=4,!this.recomputeNormals&&D&&(d.e.TransformNormalFromFloatsToRef(D[he],D[he+1],D[he+2],xe,Be),N.push(Be.x,Be.y,Be.z),he+=3)}for(te=0;te<o.length;te++){var Je=t+o[te];l.push(Je),Je>65535&&(this._needs32Bits=!0)}if(this._depthSort||this._multimaterialEnabled){var dt=_e.materialIndex!==null?_e.materialIndex:0;this.depthSortedParticles.push(new YT(j,e,o.length,dt))}return _e},i.prototype._posToShape=function(t){for(var e=[],n=0;n<t.length;n+=3)e.push(d.e.FromArray(t,n));return e},i.prototype._uvsToShapeUV=function(t){var e=[];if(t)for(var n=0;n<t.length;n++)e.push(t[n]);return e},i.prototype._addParticle=function(t,e,n,r,o,l,h,v,b){v===void 0&&(v=null),b===void 0&&(b=null);var A=new Bm(t,e,n,r,o,l,h,this,v);return(b||this.particles).push(A),A},i.prototype.addShape=function(t,e,n){var r=t.getVerticesData(Me.b.PositionKind),o=t.getIndices(),l=t.getVerticesData(Me.b.UVKind),h=t.getVerticesData(Me.b.ColorKind),v=t.getVerticesData(Me.b.NormalKind);this.recomputeNormals=!v;var b=Qe.b.SliceToArray(o),A=Qe.b.SliceToArray(v),D=h?Qe.b.SliceToArray(h):[],N=n&&n.storage?n.storage:null,j=null;this._particlesIntersect&&(j=t.getBoundingInfo());var k=this._posToShape(r),H=this._uvsToShapeUV(l),J=n?n.positionFunction:null,te=n?n.vertexFunction:null,oe=null;this._useModelMaterial&&(oe=t.material?t.material:this._setDefaultMaterial());for(var ce=new Um(this._shapeCounter,k,b,A,D,H,J,te,oe),he=0;he<e;he++)this._insertNewParticle(this.nbParticles,he,ce,k,o,l,h,v,j,N,n);return this._shapeCounter++,this._isNotBuilt=!0,this._shapeCounter-1},i.prototype._rebuildParticle=function(t,e){e===void 0&&(e=!1),this._resetCopy();var n=this._copy;t._model._positionFunction&&t._model._positionFunction(n,t.idx,t.idxInShape);var r=d.c.Matrix[0],o=d.c.Vector3[0],l=d.c.Vector3[1],h=d.c.Vector3[2],v=d.c.Vector3[3];n.getRotationMatrix(r),t.pivot.multiplyToRef(t.scaling,v),n.translateFromPivot?h.copyFromFloats(0,0,0):h.copyFrom(v);for(var b=t._model._shape,A=0;A<b.length;A++)o.copyFrom(b[A]),t._model._vertexFunction&&t._model._vertexFunction(n,o,A),o.multiplyInPlace(n.scaling).subtractInPlace(v),d.e.TransformCoordinatesToRef(o,r,l),l.addInPlace(h).addInPlace(n.position).toArray(this._positions32,t._pos+3*A);e&&(t.position.setAll(0),t.rotation.setAll(0),t.rotationQuaternion=null,t.scaling.setAll(1),t.uvs.setAll(0),t.pivot.setAll(0),t.translateFromPivot=!1,t.parentId=null)},i.prototype.rebuildMesh=function(t){t===void 0&&(t=!1);for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e],t);return this.mesh.updateVerticesData(Me.b.PositionKind,this._positions32,!1,!1),this},i.prototype.removeParticles=function(t,e){var n=e-t+1;if(!this._expandable||n<=0||n>=this.nbParticles||!this._updatable)return[];var r=this.particles,o=this.nbParticles;if(e<o-1)for(var l=e+1,h=r[l]._pos-r[t]._pos,v=r[l]._ind-r[t]._ind,b=l;b<o;b++){var A=r[b];A._pos-=h,A._ind-=v}var D=r.splice(t,n);this._positions.length=0,this._indices.length=0,this._colors.length=0,this._uvs.length=0,this._normals.length=0,this._index=0,this._idxOfId.length=0,(this._depthSort||this._multimaterialEnabled)&&(this.depthSortedParticles=[]);for(var N=0,j=r.length,k=0;k<j;k++){var H=r[k],J=H._model,te=J._shape,oe=J._indices,ce=J._normals,he=J._shapeColors,_e=J._shapeUV;H.idx=k,this._idxOfId[H.id]=k,this._meshBuilder(this._index,N,te,this._positions,oe,this._indices,_e,this._uvs,he,this._colors,ce,this._normals,H.idx,H.idxInShape,null,J),this._index+=te.length,N+=oe.length}return this.nbParticles-=n,this._isNotBuilt=!0,D},i.prototype.insertParticlesFromArray=function(t){if(!this._expandable)return this;for(var e=0,n=t[0].shapeId,r=t.length,o=0;o<r;o++){var l=t[o],h=l._model,v=h._shape,b=h._indices,A=h._shapeUV,D=h._shapeColors,N=h._normals,j=!N;this.recomputeNormals=j||this.recomputeNormals;var k=l._boundingInfo,H=this._insertNewParticle(this.nbParticles,e,h,v,b,A,D,N,k,null,null);l.copyToRef(H),e++,n!=l.shapeId&&(n=l.shapeId,e=0)}return this._isNotBuilt=!0,this},i.prototype._insertNewParticle=function(t,e,n,r,o,l,h,v,b,A,D){var N=this._positions.length,j=this._indices.length,k=this._meshBuilder(this._index,j,r,this._positions,o,this._indices,l,this._uvs,h,this._colors,v,this._normals,t,e,D,n),H=null;return this._updatable&&((H=this._addParticle(this.nbParticles,this._lastParticleId,N,j,n,this._shapeCounter,e,b,A)).position.copyFrom(k.position),H.rotation.copyFrom(k.rotation),k.rotationQuaternion&&(H.rotationQuaternion?H.rotationQuaternion.copyFrom(k.rotationQuaternion):H.rotationQuaternion=k.rotationQuaternion.clone()),k.color&&(H.color?H.color.copyFrom(k.color):H.color=k.color.clone()),H.scaling.copyFrom(k.scaling),H.uvs.copyFrom(k.uvs),k.materialIndex!==null&&(H.materialIndex=k.materialIndex),this.expandable&&(this._idxOfId[H.id]=H.idx)),A||(this._index+=r.length,this.nbParticles++,this._lastParticleId++),H},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(t,e,n);var r=d.c.Matrix[0],o=d.c.Matrix[1],l=this.mesh,h=this._colors32,v=this._positions32,b=this._normals32,A=this._uvs32,D=this._indices32,N=this._indices,j=this._fixedNormal32,k=d.c.Vector3,H=k[5].copyFromFloats(1,0,0),J=k[6].copyFromFloats(0,1,0),te=k[7].copyFromFloats(0,0,1),oe=k[8].setAll(Number.MAX_VALUE),ce=k[9].setAll(-Number.MAX_VALUE),he=k[10].setAll(0),_e=this._tmpVertex,ye=_e.position,Ee=_e.color,Oe=_e.uv;if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(o)),this.billboard){var Ae=k[0];this._camera.getDirectionToRef(Se.a.Z,Ae),d.e.TransformNormalToRef(Ae,o,te),te.normalize();var xe=this._camera.getViewMatrix(!0);d.e.TransformNormalFromFloatsToRef(xe.m[1],xe.m[5],xe.m[9],o,J),d.e.CrossToRef(J,te,H),J.normalize(),H.normalize()}this._depthSort&&d.e.TransformCoordinatesToRef(this._camera.globalPosition,o,he),d.a.IdentityToRef(r);var Pe=0,Be=0,Ce=0,Ue=0,Le=0,ke=0,qe=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var at=this.mesh._boundingInfo;at&&(oe.copyFrom(at.minimum),ce.copyFrom(at.maximum))}var lt=(Be=this.particles[t]._pos)/3|0;Ue=4*lt,ke=2*lt;for(var ft=t;ft<=e;ft++){var Je=this.particles[ft];this.updateParticle(Je);var dt=Je._model._shape,ut=Je._model._shapeUV,tt=Je._rotationMatrix,mt=Je.position,ze=Je.rotation,rt=Je.scaling,At=Je._globalPosition;if(this._depthSort&&this._depthSortParticles){var sn=this.depthSortedParticles[ft];sn.idx=Je.idx,sn.ind=Je._ind,sn.indicesLength=Je._model._indicesLength,sn.sqDistance=d.e.DistanceSquared(Je.position,he)}if(!Je.alive||Je._stillInvisible&&!Je.isVisible)Be+=3*(qe=dt.length),Ue+=4*qe,ke+=2*qe;else{if(Je.isVisible){Je._stillInvisible=!1;var Ht=k[12];if(Je.pivot.multiplyToRef(rt,Ht),this.billboard&&(ze.x=0,ze.y=0),(this._computeParticleRotation||this.billboard)&&Je.getRotationMatrix(r),Je.parentId!==null){var fn=this.getParticleById(Je.parentId);if(fn){var St=fn._rotationMatrix,bn=fn._globalPosition,cn=mt.x*St[1]+mt.y*St[4]+mt.z*St[7],en=mt.x*St[0]+mt.y*St[3]+mt.z*St[6],ln=mt.x*St[2]+mt.y*St[5]+mt.z*St[8];if(At.x=bn.x+en,At.y=bn.y+cn,At.z=bn.z+ln,this._computeParticleRotation||this.billboard){var Ot=r.m;tt[0]=Ot[0]*St[0]+Ot[1]*St[3]+Ot[2]*St[6],tt[1]=Ot[0]*St[1]+Ot[1]*St[4]+Ot[2]*St[7],tt[2]=Ot[0]*St[2]+Ot[1]*St[5]+Ot[2]*St[8],tt[3]=Ot[4]*St[0]+Ot[5]*St[3]+Ot[6]*St[6],tt[4]=Ot[4]*St[1]+Ot[5]*St[4]+Ot[6]*St[7],tt[5]=Ot[4]*St[2]+Ot[5]*St[5]+Ot[6]*St[8],tt[6]=Ot[8]*St[0]+Ot[9]*St[3]+Ot[10]*St[6],tt[7]=Ot[8]*St[1]+Ot[9]*St[4]+Ot[10]*St[7],tt[8]=Ot[8]*St[2]+Ot[9]*St[5]+Ot[10]*St[8]}}else Je.parentId=null}else At.x=mt.x,At.y=mt.y,At.z=mt.z,(this._computeParticleRotation||this.billboard)&&(Ot=r.m,tt[0]=Ot[0],tt[1]=Ot[1],tt[2]=Ot[2],tt[3]=Ot[4],tt[4]=Ot[5],tt[5]=Ot[6],tt[6]=Ot[8],tt[7]=Ot[9],tt[8]=Ot[10]);var kt=k[11];for(Je.translateFromPivot?kt.setAll(0):kt.copyFrom(Ht),qe=0;qe<dt.length;qe++){Pe=Be+3*qe,Ce=Ue+4*qe,Le=ke+2*qe;var Tn=2*qe,Er=Tn+1;ye.copyFrom(dt[qe]),this._computeParticleColor&&Je.color&&Ee.copyFrom(Je.color),this._computeParticleTexture&&Oe.copyFromFloats(ut[Tn],ut[Er]),this._computeParticleVertex&&this.updateParticleVertex(Je,_e,qe);var wr=ye.x*rt.x-Ht.x,ri=ye.y*rt.y-Ht.y,Sr=ye.z*rt.z-Ht.z;en=wr*tt[0]+ri*tt[3]+Sr*tt[6],cn=wr*tt[1]+ri*tt[4]+Sr*tt[7],ln=wr*tt[2]+ri*tt[5]+Sr*tt[8],en+=kt.x,cn+=kt.y,ln+=kt.z;var pn=v[Pe]=At.x+H.x*en+J.x*cn+te.x*ln,gi=v[Pe+1]=At.y+H.y*en+J.y*cn+te.y*ln,io=v[Pe+2]=At.z+H.z*en+J.z*cn+te.z*ln;if(this._computeBoundingBox&&(oe.minimizeInPlaceFromFloats(pn,gi,io),ce.maximizeInPlaceFromFloats(pn,gi,io)),!this._computeParticleVertex){var ws=j[Pe],Ls=j[Pe+1],vi=j[Pe+2],jo=ws*tt[0]+Ls*tt[3]+vi*tt[6],Ns=ws*tt[1]+Ls*tt[4]+vi*tt[7],tn=ws*tt[2]+Ls*tt[5]+vi*tt[8];b[Pe]=H.x*jo+J.x*Ns+te.x*tn,b[Pe+1]=H.y*jo+J.y*Ns+te.y*tn,b[Pe+2]=H.z*jo+J.z*Ns+te.z*tn}if(this._computeParticleColor&&Je.color){var zo=this._colors32;zo[Ce]=Ee.r,zo[Ce+1]=Ee.g,zo[Ce+2]=Ee.b,zo[Ce+3]=Ee.a}if(this._computeParticleTexture){var sr=Je.uvs;A[Le]=Oe.x*(sr.z-sr.x)+sr.x,A[Le+1]=Oe.y*(sr.w-sr.y)+sr.y}}}else for(Je._stillInvisible=!0,qe=0;qe<dt.length;qe++){if(Ce=Ue+4*qe,Le=ke+2*qe,v[Pe=Be+3*qe]=v[Pe+1]=v[Pe+2]=0,b[Pe]=b[Pe+1]=b[Pe+2]=0,this._computeParticleColor&&Je.color){var Ia=Je.color;h[Ce]=Ia.r,h[Ce+1]=Ia.g,h[Ce+2]=Ia.b,h[Ce+3]=Ia.a}this._computeParticleTexture&&(sr=Je.uvs,A[Le]=ut[2*qe]*(sr.z-sr.x)+sr.x,A[Le+1]=ut[2*qe+1]*(sr.w-sr.y)+sr.y)}if(this._particlesIntersect){var oo=Je._boundingInfo,Kh=oo.boundingBox,Qh=oo.boundingSphere,Fs=Je._modelBoundingInfo;if(!this._bSphereOnly){var Go=Fs.boundingBox.vectors,Wo=k[1],Da=k[2];Wo.setAll(Number.MAX_VALUE),Da.setAll(-Number.MAX_VALUE);for(var Ho=0;Ho<8;Ho++){var Bs=Go[Ho].x*rt.x,Us=Go[Ho].y*rt.y,Vs=Go[Ho].z*rt.z,Xo=(en=Bs*tt[0]+Us*tt[3]+Vs*tt[6],cn=Bs*tt[1]+Us*tt[4]+Vs*tt[7],ln=Bs*tt[2]+Us*tt[5]+Vs*tt[8],mt.x+H.x*en+J.x*cn+te.x*ln),Yo=mt.y+H.y*en+J.y*cn+te.y*ln,ks=mt.z+H.z*en+J.z*cn+te.z*ln;Wo.minimizeInPlaceFromFloats(Xo,Yo,ks),Da.maximizeInPlaceFromFloats(Xo,Yo,ks)}Kh.reConstruct(Wo,Da,l._worldMatrix)}var ao=Fs.minimum.multiplyToRef(rt,k[1]),xr=Fs.maximum.multiplyToRef(rt,k[2]),Tl=xr.addToRef(ao,k[3]).scaleInPlace(.5).addInPlace(At),wa=xr.subtractToRef(ao,k[4]).scaleInPlace(.5*this._bSphereRadiusFactor),El=Tl.subtractToRef(wa,k[1]),xN=Tl.addToRef(wa,k[2]);Qh.reConstruct(El,xN,l._worldMatrix)}Be=Pe+3,Ue=Ce+4,ke=Le+2}}if(n){if(this._computeParticleColor&&l.updateVerticesData(Me.b.ColorKind,h,!1,!1),this._computeParticleTexture&&l.updateVerticesData(Me.b.UVKind,A,!1,!1),l.updateVerticesData(Me.b.PositionKind,v,!1,!1),!l.areNormalsFrozen||l.isFacetDataEnabled){if(this._computeParticleVertex||l.isFacetDataEnabled){var PN=l.isFacetDataEnabled?l.getFacetDataParameters():null;_t.a.ComputeNormals(v,D,b,PN);for(var so=0;so<b.length;so++)j[so]=b[so]}l.areNormalsFrozen||l.updateVerticesData(Me.b.NormalKind,b,!1,!1)}if(this._depthSort&&this._depthSortParticles){var s_=this.depthSortedParticles;s_.sort(this._depthSortFunction);for(var AN=s_.length,jE=0,c_=0,l_=0;l_<AN;l_++){var u_=s_[l_],CN=u_.indicesLength,RN=u_.ind;for(so=0;so<CN;so++)if(D[jE]=N[RN+so],jE++,this._pickable&&so%3==0){var zE=this.pickedParticles[c_];zE.idx=u_.idx,zE.faceId=c_,c_++}}l.updateIndices(D)}}return this._computeBoundingBox&&(l._boundingInfo?l._boundingInfo.reConstruct(oe,ce,l._worldMatrix):l._boundingInfo=new Fo.a(oe,ce,l._worldMatrix)),this._autoUpdateSubMeshes&&this.computeSubMeshes(),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null,this.pickedBySubMesh=null,this._materials=null,this._materialIndexes=null,this._indicesByMaterial=null,this._idxOfId=null},i.prototype.pickedParticle=function(t){if(t.hit){var e=t.subMeshId,n=t.faceId,r=this.pickedBySubMesh;if(r[e]&&r[e][n])return r[e][n]}return null},i.prototype.getParticleById=function(t){var e=this.particles[t];if(e&&e.id==t)return e;var n=this.particles,r=this._idxOfId[t];if(r!==void 0)return n[r];for(var o=0,l=this.nbParticles;o<l;){var h=n[o];if(h.id==t)return h;o++}return null},i.prototype.getParticlesByShapeId=function(t){var e=[];return this.getParticlesByShapeIdToRef(t,e),e},i.prototype.getParticlesByShapeIdToRef=function(t,e){e.length=0;for(var n=0;n<this.nbParticles;n++){var r=this.particles[n];r.shapeId==t&&e.push(r)}return this},i.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var t=this.depthSortedParticles;if(this.particles.length>0)for(var e=0;e<this.particles.length;e++){var n=this.particles[e];n.materialIndex||(n.materialIndex=0);var r=t[e];r.materialIndex=n.materialIndex,r.ind=n._ind,r.indicesLength=n._model._indicesLength,r.idx=n.idx}this._sortParticlesByMaterial();var o=this._indicesByMaterial,l=this._materialIndexes,h=this.mesh;h.subMeshes=[];for(var v=h.getTotalVertices(),b=0;b<l.length;b++){var A=o[b],D=o[b+1]-A,N=l[b];new dl.a(N,0,v,A,D,h)}return this},i.prototype._sortParticlesByMaterial=function(){var t=[0];this._indicesByMaterial=t;var e=[];this._materialIndexes=e;var n=this.depthSortedParticles;n.sort(this._materialSortFunction);var r=n.length,o=this._indices32,l=this._indices,h=0,v=0,b=0,A=n[0].materialIndex;e.push(A),this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var D=0;D<r;D++){var N=n[D],j=N.indicesLength,k=N.ind;N.materialIndex!==A&&(A=N.materialIndex,t.push(b),e.push(A),this._pickable&&(h++,this.pickedBySubMesh[h]=[],v=0));for(var H=0,J=0;J<j;J++){if(o[b]=l[k+J],this._pickable&&J%3==0){var te=this.pickedBySubMesh[h][v];te?(te.idx=N.idx,te.faceId=H):this.pickedBySubMesh[h][v]={idx:N.idx,faceId:H},v++,H++}b++}}return t.push(o.length),this._updatable&&this.mesh.updateIndices(o),this},i.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var t=0;t<this._materials.length;t++){var e=this._materials[t].uniqueId;this._materialIndexesById[e]=t}},i.prototype._filterUniqueMaterialId=function(t){return t.filter(function(e,n,r){return r.indexOf(e)===n})},i.prototype._setDefaultMaterial=function(){return this._defaultMaterial||(this._defaultMaterial=new Qt.a(this.name+"DefaultMaterial",this._scene)),this._defaultMaterial},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new Fo.a(new d.e(-e,-e,-e),new d.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(t){this._isVisibilityBoxLocked=t,this.mesh.getBoundingInfo().isLocked=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(t){this._computeParticleVertex=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(t){this._depthSortParticles=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0}),i.prototype.setMultiMaterial=function(t){this._materials=this._filterUniqueMaterialId(t),this._setMaterialIndexesById(),this._multimaterial&&this._multimaterial.dispose(),this._multimaterial=new Aa.a(this.name+"MultiMaterial",this._scene);for(var e=0;e<this._materials.length;e++)this._multimaterial.subMaterials.push(this._materials[e]);this.computeSubMeshes(),this.mesh.material=this._multimaterial},Object.defineProperty(i.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(t){this._multimaterial=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(t){this._autoUpdateSubMeshes=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.updateParticleVertex=function(t,e,n){return this},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}(),QT=function(){function i(t,e,n,r,o){this.idx=0,this.color=new x.b(1,1,1,1),this.position=d.e.Zero(),this.rotation=d.e.Zero(),this.uv=new d.d(0,0),this.velocity=d.e.Zero(),this.pivot=d.e.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=d.e.Zero(),this.idx=t,this._group=e,this.groupId=n,this.idxInGroup=r,this._pcs=o}return Object.defineProperty(i.prototype,"size",{get:function(){return this.size},set:function(t){this.size=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(t){this.rotationQuaternion=t},enumerable:!1,configurable:!0}),i.prototype.intersectsMesh=function(t,e){if(!t._boundingInfo)return!1;if(e=e||!1)return t.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var n,r,o,l,h,v;n=t.getBoundingInfo().boundingBox.maximumWorld.x,r=t.getBoundingInfo().boundingBox.minimumWorld.x,o=t.getBoundingInfo().boundingBox.maximumWorld.y,l=t.getBoundingInfo().boundingBox.minimumWorld.y,h=t.getBoundingInfo().boundingBox.maximumWorld.z,v=t.getBoundingInfo().boundingBox.minimumWorld.z;var b=this.position.x+this._pcs.mesh.position.x,A=this.position.y+this._pcs.mesh.position.y,D=this.position.z+this._pcs.mesh.position.z;return r<=b&&b<=n&&l<=A&&A<=o&&v<=D&&D<=h},i.prototype.getRotationMatrix=function(t){var e;if(this.rotationQuaternion)e=this.rotationQuaternion;else{e=d.c.Quaternion[0];var n=this.rotation;d.b.RotationYawPitchRollToRef(n.y,n.x,n.z,e)}e.toRotationMatrix(t)},i}(),Ih=function(i,t){this.groupID=i,this._positionFunction=t};(function(i){i[i.Color=2]="Color",i[i.UV=1]="UV",i[i.Random=0]="Random",i[i.Stated=3]="Stated"})(ar||(ar={}));var Gw=function(){function i(t,e,n,r){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=t,this._size=e,this._scene=n||$.a.LastCreatedScene,r&&r.updatable!==void 0?this._updatable=r.updatable:this._updatable=!0}return i.prototype.buildMeshAsync=function(){var t=this;return Promise.all(this._promises).then(function(){return t._isReady=!0,t._buildMesh()})},i.prototype._buildMesh=function(){this.nbParticles===0&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var t=new _t.a;t.set(this._positions32,Me.b.PositionKind),this._uvs32.length>0&&t.set(this._uvs32,Me.b.UVKind);var e=0;this._colors32.length>0&&(e=1,t.set(this._colors32,Me.b.ColorKind));var n=new Ne.a(this.name,this._scene);t.applyToMesh(n,this._updatable),this.mesh=n,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var r=new Qt.a("point cloud material",this._scene);return r.emissiveColor=new x.a(e,e,e),r.disableLighting=!0,r.pointsCloud=!0,r.pointSize=this._size,n.material=r,new Promise(function(o){return o(n)})},i.prototype._addParticle=function(t,e,n,r){var o=new QT(t,e,n,r,this);return this.particles.push(o),o},i.prototype._randomUnitVector=function(t){t.position=new d.e(Math.random(),Math.random(),Math.random()),t.color=new x.b(1,1,1,1)},i.prototype._getColorIndicesForCoord=function(t,e,n,r){var o=t._groupImageData,l=n*(4*r)+4*e,h=[l,l+1,l+2,l+3],v=h[1],b=h[2],A=h[3],D=o[h[0]],N=o[v],j=o[b],k=o[A];return new x.b(D/255,N/255,j/255,k)},i.prototype._setPointsColorOrUV=function(t,e,n,r,o,l,h){n&&t.updateFacetData();var v=2*t.getBoundingInfo().boundingSphere.radius,b=t.getVerticesData(Me.b.PositionKind),A=t.getIndices(),D=t.getVerticesData(Me.b.UVKind),N=t.getVerticesData(Me.b.ColorKind),j=d.e.Zero();t.computeWorldMatrix();var k=t.getWorldMatrix();if(!k.isIdentity())for(var H=0;H<b.length/3;H++)d.e.TransformCoordinatesFromFloatsToRef(b[3*H],b[3*H+1],b[3*H+2],k,j),b[3*H]=j.x,b[3*H+1]=j.y,b[3*H+2]=j.z;var J,te,oe=0,ce=0,he=0,_e=0,ye=0,Ee=0,Oe=0,Ae=0,xe=0,Pe=0,Be=0,Ce=0,Ue=0,Le=0,ke=d.e.Zero(),qe=d.e.Zero(),at=d.e.Zero(),lt=d.e.Zero(),ft=d.e.Zero(),Je=0,dt=0,ut=0,tt=0,mt=0,ze=0,rt=d.d.Zero(),At=d.d.Zero(),sn=d.d.Zero(),Ht=d.d.Zero(),fn=d.d.Zero(),St=0,bn=0,cn=0,en=0,ln=0,Ot=0,kt=0,Tn=0,Er=0,wr=0,ri=0,Sr=0,pn=d.f.Zero(),gi=d.f.Zero(),io=d.f.Zero(),ws=d.f.Zero(),Ls=d.f.Zero(),vi=0,jo=0;h=h||0;var Ns,tn=new d.f(0,0,0,0),zo=d.e.Zero(),sr=d.e.Zero(),Ia=d.e.Zero(),oo=0,Kh=d.e.Zero(),Qh=0,Fs=0,Go=new Bn.a(d.e.Zero(),new d.e(1,0,0)),Wo=d.e.Zero();for(ce=0;ce<A.length/3;ce++){var Da,Ho,Bs,Us,Vs,Xo,Yo,ks;he=A[3*ce],_e=A[3*ce+1],ye=A[3*ce+2],Ee=b[3*he],Oe=b[3*he+1],Ae=b[3*he+2],xe=b[3*_e],Pe=b[3*_e+1],Be=b[3*_e+2],Ce=b[3*ye],Ue=b[3*ye+1],Le=b[3*ye+2],ke.set(Ee,Oe,Ae),qe.set(xe,Pe,Be),at.set(Ce,Ue,Le),qe.subtractToRef(ke,lt),at.subtractToRef(qe,ft),D&&(Je=D[2*he],dt=D[2*he+1],ut=D[2*_e],tt=D[2*_e+1],mt=D[2*ye],ze=D[2*ye+1],rt.set(Je,dt),At.set(ut,tt),sn.set(mt,ze),At.subtractToRef(rt,Ht),sn.subtractToRef(At,fn)),N&&r&&(St=N[4*he],bn=N[4*he+1],cn=N[4*he+2],en=N[4*he+3],ln=N[4*_e],Ot=N[4*_e+1],kt=N[4*_e+2],Tn=N[4*_e+3],Er=N[4*ye],wr=N[4*ye+1],ri=N[4*ye+2],Sr=N[4*ye+3],pn.set(St,bn,cn,en),gi.set(ln,Ot,kt,Tn),io.set(Er,wr,ri,Sr),gi.subtractToRef(pn,ws),io.subtractToRef(gi,Ls));for(var ao,xr,Tl=new x.a(0,0,0),wa=new x.a(0,0,0),El=0;El<e._groupDensity[ce];El++)oe=this.particles.length,this._addParticle(oe,e,this._groupCounter,ce+El),xr=this.particles[oe],vi=se.a.RandomRange(0,1),jo=se.a.RandomRange(0,1),J=ke.add(lt.scale(vi)).add(ft.scale(vi*jo)),n&&(zo=t.getFacetNormal(ce).normalize().scale(-1),sr=lt.clone().normalize(),Ia=d.e.Cross(zo,sr),oo=se.a.RandomRange(0,2*Math.PI),Kh=sr.scale(Math.cos(oo)).add(Ia.scale(Math.sin(oo))),oo=se.a.RandomRange(.1,Math.PI/2),Wo=Kh.scale(Math.cos(oo)).add(zo.scale(Math.sin(oo))),Go.origin=J.add(Wo.scale(1e-5)),Go.direction=Wo,Go.length=v,(Ns=Go.intersectsMesh(t)).hit&&(Fs=Ns.pickedPoint.subtract(J).length(),Qh=se.a.RandomRange(0,1)*Fs,J.addInPlace(Wo.scale(Qh)))),xr.position=J.clone(),this._positions.push(xr.position.x,xr.position.y,xr.position.z),r!==void 0?D&&(te=rt.add(Ht.scale(vi)).add(fn.scale(vi*jo)),r?o&&e._groupImageData!==null?(Da=e._groupImgWidth,Ho=e._groupImgHeight,ao=this._getColorIndicesForCoord(e,Math.round(te.x*Da),Math.round(te.y*Ho),Da),xr.color=ao,this._colors.push(ao.r,ao.g,ao.b,ao.a)):N?(tn=pn.add(ws.scale(vi)).add(Ls.scale(vi*jo)),xr.color=new x.b(tn.x,tn.y,tn.z,tn.w),this._colors.push(tn.x,tn.y,tn.z,tn.w)):(tn=pn.set(Math.random(),Math.random(),Math.random(),1),xr.color=new x.b(tn.x,tn.y,tn.z,tn.w),this._colors.push(tn.x,tn.y,tn.z,tn.w)):(xr.uv=te.clone(),this._uvs.push(xr.uv.x,xr.uv.y))):(l?(Tl.set(l.r,l.g,l.b),Bs=se.a.RandomRange(-h,h),Us=se.a.RandomRange(-h,h),Vs=(ks=Tl.toHSV()).r,(Xo=ks.g+Bs)<0&&(Xo=0),Xo>1&&(Xo=1),(Yo=ks.b+Us)<0&&(Yo=0),Yo>1&&(Yo=1),x.a.HSVtoRGBToRef(Vs,Xo,Yo,wa),tn.set(wa.r,wa.g,wa.b,1)):tn=pn.set(Math.random(),Math.random(),Math.random(),1),xr.color=new x.b(tn.x,tn.y,tn.z,tn.w),this._colors.push(tn.x,tn.y,tn.z,tn.w))}},i.prototype._colorFromTexture=function(t,e,n){var r=this;if(t.material===null)return p.a.Warn(t.name+"has no material."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var o=t.material.getActiveTextures();if(o.length===0)return p.a.Warn(t.name+"has no useable texture."),e._groupImageData=null,void this._setPointsColorOrUV(t,e,n,!0,!1);var l=t.clone();l.setEnabled(!1),this._promises.push(new Promise(function(h){jr.a.WhenAllReady(o,function(){var v=e._textureNb;return v<0&&(v=0),v>o.length-1&&(v=o.length-1),e._groupImageData=o[v].readPixels(),e._groupImgWidth=o[v].getSize().width,e._groupImgHeight=o[v].getSize().height,r._setPointsColorOrUV(l,e,n,!0,!0),l.dispose(),h()})}))},i.prototype._calculateDensity=function(t,e,n){for(var r,o,l,h,v,b,A,D,N,j,k,H,J,te,oe,ce,he,_e=new Array,ye=d.e.Zero(),Ee=d.e.Zero(),Oe=d.e.Zero(),Ae=d.e.Zero(),xe=d.e.Zero(),Pe=d.e.Zero(),Be=new Array,Ce=0,Ue=n.length/3,Le=0;Le<Ue;Le++)r=n[3*Le],o=n[3*Le+1],l=n[3*Le+2],h=e[3*r],v=e[3*r+1],b=e[3*r+2],A=e[3*o],D=e[3*o+1],N=e[3*o+2],j=e[3*l],k=e[3*l+1],H=e[3*l+2],ye.set(h,v,b),Ee.set(A,D,N),Oe.set(j,k,H),Ee.subtractToRef(ye,Ae),Oe.subtractToRef(Ee,xe),Oe.subtractToRef(ye,Pe),ce=((J=Ae.length())+(te=xe.length())+(oe=Pe.length()))/2,Ce+=he=Math.sqrt(ce*(ce-J)*(ce-te)*(ce-oe)),Be[Le]=he;var ke=0;for(Le=0;Le<Ue;Le++)_e[Le]=Math.floor(t*Be[Le]/Ce),ke+=_e[Le];var qe=t-ke,at=Math.floor(qe/Ue),lt=qe%Ue;for(at>0&&(_e=_e.map(function(ft){return ft+at})),Le=0;Le<lt;Le++)_e[Le]+=1;return _e},i.prototype.addPoints=function(t,e){e===void 0&&(e=this._randomUnitVector);for(var n,r=new Ih(this._groupCounter,e),o=this.nbParticles,l=0;l<t;l++)n=this._addParticle(o,r,this._groupCounter,l),r&&r._positionFunction&&r._positionFunction(n,o,l),this._positions.push(n.position.x,n.position.y,n.position.z),n.color&&this._colors.push(n.color.r,n.color.g,n.color.b,n.color.a),n.uv&&this._uvs.push(n.uv.x,n.uv.y),o++;return this.nbParticles+=t,this._groupCounter++,this._groupCounter},i.prototype.addSurfacePoints=function(t,e,n,r,o){var l=n||ar.Random;(isNaN(l)||l<0||l>3)&&(l=ar.Random);var h=t.getVerticesData(Me.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var b=new Ih(this._groupCounter,null);switch(b._groupDensity=this._calculateDensity(e,h,v),l===ar.Color?b._textureNb=r||0:r=r||new x.b(1,1,1,1),l){case ar.Color:this._colorFromTexture(t,b,!1);break;case ar.UV:this._setPointsColorOrUV(t,b,!1,!1,!1);break;case ar.Random:this._setPointsColorOrUV(t,b,!1);break;case ar.Stated:this._setPointsColorOrUV(t,b,!1,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.addVolumePoints=function(t,e,n,r,o){var l=n||ar.Random;(isNaN(l)||l<0||l>3)&&(l=ar.Random);var h=t.getVerticesData(Me.b.PositionKind),v=t.getIndices();this._groups.push(this._groupCounter);var b=new Ih(this._groupCounter,null);switch(b._groupDensity=this._calculateDensity(e,h,v),l===ar.Color?b._textureNb=r||0:r=r||new x.b(1,1,1,1),l){case ar.Color:this._colorFromTexture(t,b,!0);break;case ar.UV:this._setPointsColorOrUV(t,b,!0,!1,!1);break;case ar.Random:this._setPointsColorOrUV(t,b,!0);break;case ar.Stated:this._setPointsColorOrUV(t,b,!0,void 0,void 0,r,o)}return this.nbParticles+=e,this._groupCounter++,this._groupCounter-1},i.prototype.setParticles=function(t,e,n){if(t===void 0&&(t=0),e===void 0&&(e=this.nbParticles-1),n===void 0&&(n=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(t,e,n);var r=d.c.Matrix[0],o=this.mesh,l=this._colors32,h=this._positions32,v=this._uvs32,b=d.c.Vector3,A=b[5].copyFromFloats(1,0,0),D=b[6].copyFromFloats(0,1,0),N=b[7].copyFromFloats(0,0,1),j=b[8].setAll(Number.MAX_VALUE),k=b[9].setAll(-Number.MAX_VALUE);d.a.IdentityToRef(r);var H=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),e=e>=this.nbParticles?this.nbParticles-1:e,this._computeBoundingBox&&(t!=0||e!=this.nbParticles-1)){var J=this.mesh._boundingInfo;J&&(j.copyFrom(J.minimum),k.copyFrom(J.maximum))}H=0;for(var te=0,oe=0,ce=0,he=t;he<=e;he++){var _e=this.particles[he];te=3*(H=_e.idx),oe=4*H,ce=2*H,this.updateParticle(_e);var ye=_e._rotationMatrix,Ee=_e.position,Oe=_e._globalPosition;if(this._computeParticleRotation&&_e.getRotationMatrix(r),_e.parentId!==null){var Ae=this.particles[_e.parentId],xe=Ae._rotationMatrix,Pe=Ae._globalPosition,Be=Ee.x*xe[1]+Ee.y*xe[4]+Ee.z*xe[7],Ce=Ee.x*xe[0]+Ee.y*xe[3]+Ee.z*xe[6],Ue=Ee.x*xe[2]+Ee.y*xe[5]+Ee.z*xe[8];if(Oe.x=Pe.x+Ce,Oe.y=Pe.y+Be,Oe.z=Pe.z+Ue,this._computeParticleRotation){var Le=r.m;ye[0]=Le[0]*xe[0]+Le[1]*xe[3]+Le[2]*xe[6],ye[1]=Le[0]*xe[1]+Le[1]*xe[4]+Le[2]*xe[7],ye[2]=Le[0]*xe[2]+Le[1]*xe[5]+Le[2]*xe[8],ye[3]=Le[4]*xe[0]+Le[5]*xe[3]+Le[6]*xe[6],ye[4]=Le[4]*xe[1]+Le[5]*xe[4]+Le[6]*xe[7],ye[5]=Le[4]*xe[2]+Le[5]*xe[5]+Le[6]*xe[8],ye[6]=Le[8]*xe[0]+Le[9]*xe[3]+Le[10]*xe[6],ye[7]=Le[8]*xe[1]+Le[9]*xe[4]+Le[10]*xe[7],ye[8]=Le[8]*xe[2]+Le[9]*xe[5]+Le[10]*xe[8]}}else Oe.x=0,Oe.y=0,Oe.z=0,this._computeParticleRotation&&(Le=r.m,ye[0]=Le[0],ye[1]=Le[1],ye[2]=Le[2],ye[3]=Le[4],ye[4]=Le[5],ye[5]=Le[6],ye[6]=Le[8],ye[7]=Le[9],ye[8]=Le[10]);var ke=b[11];_e.translateFromPivot?ke.setAll(0):ke.copyFrom(_e.pivot);var qe=b[0];qe.copyFrom(_e.position);var at=qe.x-_e.pivot.x,lt=qe.y-_e.pivot.y,ft=qe.z-_e.pivot.z,Je=at*ye[0]+lt*ye[3]+ft*ye[6],dt=at*ye[1]+lt*ye[4]+ft*ye[7],ut=at*ye[2]+lt*ye[5]+ft*ye[8];Je+=ke.x,dt+=ke.y,ut+=ke.z;var tt=h[te]=Oe.x+A.x*Je+D.x*dt+N.x*ut,mt=h[te+1]=Oe.y+A.y*Je+D.y*dt+N.y*ut,ze=h[te+2]=Oe.z+A.z*Je+D.z*dt+N.z*ut;if(this._computeBoundingBox&&(j.minimizeInPlaceFromFloats(tt,mt,ze),k.maximizeInPlaceFromFloats(tt,mt,ze)),this._computeParticleColor&&_e.color){var rt=_e.color,At=this._colors32;At[oe]=rt.r,At[oe+1]=rt.g,At[oe+2]=rt.b,At[oe+3]=rt.a}if(this._computeParticleTexture&&_e.uv){var sn=_e.uv,Ht=this._uvs32;Ht[ce]=sn.x,Ht[ce+1]=sn.y}}return n&&(this._computeParticleColor&&o.updateVerticesData(Me.b.ColorKind,l,!1,!1),this._computeParticleTexture&&o.updateVerticesData(Me.b.UVKind,v,!1,!1),o.updateVerticesData(Me.b.PositionKind,h,!1,!1)),this._computeBoundingBox&&(o._boundingInfo?o._boundingInfo.reConstruct(j,k,o._worldMatrix):o._boundingInfo=new Fo.a(j,k,o._worldMatrix)),this.afterUpdateParticles(t,e,n),this},i.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},i.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},i.prototype.setVisibilityBox=function(t){var e=t/2;this.mesh._boundingInfo=new Fo.a(new d.e(-e,-e,-e),new d.e(e,e,e))},Object.defineProperty(i.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(t){this._alwaysVisible=t,this.mesh.alwaysSelectAsActiveMesh=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleRotation",{set:function(t){this._computeParticleRotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(t){this._computeParticleColor=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(t){this._computeParticleTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(t){this._computeBoundingBox=t},enumerable:!1,configurable:!0}),i.prototype.initParticles=function(){},i.prototype.recycleParticle=function(t){return t},i.prototype.updateParticle=function(t){return t},i.prototype.beforeUpdateParticles=function(t,e,n){},i.prototype.afterUpdateParticles=function(t,e,n){},i}();ne.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},ne.a.prototype.enablePhysics=function(i,t){if(i===void 0&&(i=null),this._physicsEngine)return!0;var e=this._getComponent(ct.a.NAME_PHYSICSENGINE);e||(e=new qT(this),this._addComponent(e));try{return this._physicsEngine=new Ss(i,t),this._physicsTimeAccumulator=0,!0}catch(n){return p.a.Error(n.message),!1}},ne.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},ne.a.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0},ne.a.prototype.deleteCompoundImpostor=function(i){var t=i.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},ne.a.prototype._advancePhysicsEngineStep=function(i){if(this._physicsEngine){var t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=i;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(i/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(Lt.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(i){var t=this;this._physicsImpostor!==i&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=i,i&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),Lt.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},Lt.a.prototype.applyImpulse=function(i,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(i,t),this):this},Lt.a.prototype.setPhysicsLinkWith=function(i,t,e,n){return this.physicsImpostor&&i.physicsImpostor?(this.physicsImpostor.createJoint(i.physicsImpostor,Pn.e.HingeJoint,{mainPivot:t,connectedPivot:e,nativeParams:n}),this):this};var vl,Os,qT=function(){function i(t){var e=this;this.name=ct.a.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new E.c,this.scene.onAfterPhysicsObservable=new E.c,this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1e3*e.scene._physicsEngine.getTimeStep():1e3/60}}return i.prototype.register=function(){},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},i}(),Ww=function(){function i(t){this._scene=t,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||p.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return i.prototype.applyRadialExplosionImpulse=function(t,e,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Ms).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var l=new ZT(this._scene,e),h=Array();return o.forEach(function(v){var b=l.getImpostorHitData(v,t);b&&(v.applyImpulse(b.force,b.contactPoint),h.push({impostor:v,hitData:b}))}),l.triggerAffectedImpostorsCallback(h),l.dispose(!1),l},i.prototype.applyRadialExplosionForce=function(t,e,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var o=this._physicsEngine.getImpostors();if(o.length===0)return null;typeof e=="number"&&((e=new Ms).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var l=new ZT(this._scene,e),h=Array();return o.forEach(function(v){var b=l.getImpostorHitData(v,t);b&&(v.applyForce(b.force,b.contactPoint),h.push({impostor:v,hitData:b}))}),l.triggerAffectedImpostorsCallback(h),l.dispose(!1),l},i.prototype.gravitationalField=function(t,e,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Ms).radius=e,e.strength=n||e.strength,e.falloff=r||e.falloff);var o=new Hw(this,this._scene,t,e);return o.dispose(!1),o},i.prototype.updraft=function(t,e,n,r,o){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new Vm).radius=e,e.strength=n||e.strength,e.height=r||e.height,e.updraftMode=o||e.updraftMode);var l=new Xw(this._scene,t,e);return l.dispose(!1),l},i.prototype.vortex=function(t,e,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;typeof e=="number"&&((e=new km).radius=e,e.strength=n||e.strength,e.height=r||e.height);var o=new Yw(this._scene,t,e);return o.dispose(!1),o},i}(),ZT=function(){function i(t,e){this._scene=t,this._options=e,this._dataFetched=!1,this._options=Object(_.a)(Object(_.a)({},new Ms),this._options)}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.getImpostorHitData=function(t,e){if(t.mass===0||!this._intersectsWithSphere(t,e,this._options.radius)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var n=t.getObjectCenter().subtract(e),r=new Bn.a(e,n,this._options.radius).intersectsMesh(t.object).pickedPoint;if(!r)return null;var o=d.e.Distance(e,r);if(o>this._options.radius)return null;var l=this._options.falloff===vl.Constant?this._options.strength:this._options.strength*(1-o/this._options.radius);return{force:n.multiplyByFloats(l,l,l),contactPoint:r,distanceFromOrigin:o}},i.prototype.triggerAffectedImpostorsCallback=function(t){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(t)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._prepareSphere=function(){this._sphere||(this._sphere=Mr.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},i.prototype._intersectsWithSphere=function(t,e,n){var r=t.object;return this._prepareSphere(),this._sphere.position=e,this._sphere.scaling=new d.e(2*n,2*n,2*n),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(r,!0)},i}(),Hw=function(){function i(t,e,n,r){this._physicsHelper=t,this._scene=e,this._origin=n,this._options=r,this._dataFetched=!1,this._options=Object(_.a)(Object(_.a)({},new Ms),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._sphere.dispose():setTimeout(function(){e._dataFetched||e._sphere.dispose()},0)},i.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var t=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);t&&(this._sphere=t.getData().sphere.clone("radialExplosionEventSphereClone"))}},i}(),Xw=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=d.e.Zero(),this._originDirection=d.e.Zero(),this._cylinderPosition=d.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(_.a)(Object(_.a)({},new Vm),this._options),this._origin.addToRef(new d.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new d.e(0,this._options.height,0),this._originTop),this._options.updraftMode===Os.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),this._cylinder&&(t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0))},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t))return null;var e=t.getObjectCenter();if(this._options.updraftMode===Os.Perpendicular)var n=this._originDirection;else n=e.subtract(this._originTop);var r=d.e.Distance(this._origin,e),o=-1*this._options.strength;return{force:n.multiplyByFloats(o,o,o),contactPoint:e,distanceFromOrigin:r}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=wi.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),Yw=function(){function i(t,e,n){this._scene=t,this._origin=e,this._options=n,this._originTop=d.e.Zero(),this._cylinderPosition=d.e.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=Object(_.a)(Object(_.a)({},new km),this._options),this._origin.addToRef(new d.e(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new d.e(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return i.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},i.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},i.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},i.prototype.dispose=function(t){var e=this;t===void 0&&(t=!0),t?this._cylinder.dispose():setTimeout(function(){e._dataFetched||e._cylinder.dispose()},0)},i.prototype.getImpostorHitData=function(t){if(t.mass===0||!this._intersectsWithCylinder(t)||t.object.getClassName()!=="Mesh"&&t.object.getClassName()!=="InstancedMesh")return null;var e=t.getObjectCenter(),n=new d.e(this._origin.x,e.y,this._origin.z),r=e.subtract(n),o=new Bn.a(n,r,this._options.radius).intersectsMesh(t.object),l=o.pickedPoint;if(!l)return null;var h=o.distance/this._options.radius,v=l.normalize();if(h>this._options.centripetalForceThreshold&&(v=v.negate()),h>this._options.centripetalForceThreshold)var b=v.x*this._options.centripetalForceMultiplier,A=v.y*this._options.updraftForceMultiplier,D=v.z*this._options.centripetalForceMultiplier;else{var N=d.e.Cross(n,e).normalize();b=(N.x+v.x)*this._options.centrifugalForceMultiplier,A=this._originTop.y*this._options.updraftForceMultiplier,D=(N.z+v.z)*this._options.centrifugalForceMultiplier}var j=new d.e(b,A,D);return{force:j=j.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:e,distanceFromOrigin:h}},i.prototype._tick=function(){var t=this;this._physicsEngine.getImpostors().forEach(function(e){var n=t.getImpostorHitData(e);n&&e.applyForce(n.force,n.contactPoint)})},i.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=wi.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},i.prototype._intersectsWithCylinder=function(t){var e=t.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(e,!0)},i}(),Ms=function(){this.radius=5,this.strength=10,this.falloff=vl.Constant,this.sphere={segments:32,diameter:1}},Vm=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Os.Center},km=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};(function(i){i[i.Constant=0]="Constant",i[i.Linear=1]="Linear"})(vl||(vl={})),function(i){i[i.Center=0]="Center",i[i.Perpendicular=1]="Perpendicular"}(Os||(Os={}));var Kw=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void)
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11));
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`;We.a.ShadersStore.blackAndWhitePixelShader=Kw;var $T=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,"blackAndWhite",["degree"],null,n,r,o,l,h)||this;return v.degree=1,v.onApplyObservable.add(function(b){b.setFloat("degree",v.degree)}),v}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"BlackAndWhitePostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"degree",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.BlackAndWhitePostProcess"]=$T;var Bt=function(){function i(t,e,n,r){this._name=e,this._singleInstance=r||!0,this._getPostProcesses=n,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._postProcesses)if(this._postProcesses.hasOwnProperty(t)){for(var e=this._postProcesses[t],n=0;n<e.length;n++)if(!e[n].isSupported)return!1}return!0},enumerable:!1,configurable:!0}),i.prototype._update=function(){},i.prototype._attachCameras=function(t){var e,n=this,r=Qe.b.MakeArray(t||this._cameras);if(r)for(var o=0;o<r.length;o++){var l=r[o];if(l){var h=l.name;if(e=this._singleInstance?0:h,!this._postProcesses[e]){var v=this._getPostProcesses();v&&(this._postProcesses[e]=Array.isArray(v)?v:[v])}this._indicesForCamera[h]||(this._indicesForCamera[h]=[]),this._postProcesses[e].forEach(function(b){var A=l.attachPostProcess(b);n._indicesForCamera[h].push(A)}),this._cameras[h]||(this._cameras[h]=l)}}},i.prototype._detachCameras=function(t){var e=Qe.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name,l=this._postProcesses[this._singleInstance?0:o];l&&l.forEach(function(h){r.detachPostProcess(h)}),this._cameras[o]&&(this._cameras[o]=null)}},i.prototype._enable=function(t){var e=this,n=Qe.b.MakeArray(t||this._cameras);if(n)for(var r=0;r<n.length;r++)for(var o=n[r],l=o.name,h=0;h<this._indicesForCamera[l].length;h++)o._postProcesses[this._indicesForCamera[l][h]]!==void 0&&o._postProcesses[this._indicesForCamera[l][h]]!==null||this._postProcesses[this._singleInstance?0:l].forEach(function(v){n[r].attachPostProcess(v,e._indicesForCamera[l][h])})},i.prototype._disable=function(t){var e=Qe.b.MakeArray(t||this._cameras);if(e)for(var n=0;n<e.length;n++){var r=e[n],o=r.name;this._postProcesses[this._singleInstance?0:o].forEach(function(l){r.detachPostProcess(l)})}},i.prototype.getPostProcesses=function(t){return this._singleInstance?this._postProcesses[0]:t?this._postProcesses[t.name]:null},i}(),Qw=`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`;We.a.ShadersStore.extractHighlightsPixelShader=Qw;var jm=function(i){function t(e,n,r,o,l,h,v,b){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=!1);var A=i.call(this,e,"extractHighlights",["threshold","exposure"],null,n,r,o,l,h,null,v,void 0,null,b)||this;return A.threshold=.9,A._exposure=1,A._inputPostProcess=null,A.onApplyObservable.add(function(D){A._inputPostProcess&&D.setTextureFromPostProcess("textureSampler",A._inputPostProcess),D.setFloat("threshold",Math.pow(A.threshold,Gt.b)),D.setFloat("exposure",A._exposure)}),A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ExtractHighlightsPostProcess"},Object(_.c)([Object(V.c)()],t.prototype,"threshold",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.ExtractHighlightsPostProcess"]=jm;var qw=`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);
}
`;We.a.ShadersStore.bloomMergePixelShader=qw;var zm=function(i){function t(e,n,r,o,l,h,v,b,A,D,N){D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),N===void 0&&(N=!1);var j=i.call(this,e,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],l,h,v,b,A,null,D,void 0,null,!0)||this;return j.weight=1,j.weight=o,j.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("bloomBlur",r),k.setFloat("bloomWeight",j.weight)}),N||j.updateEffect(),j}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"BloomMergePostProcess"},Object(_.c)([Object(V.c)()],t.prototype,"weight",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.BloomMergePostProcess"]=zm;var Gm=function(i){function t(e,n,r,o,l,h){l===void 0&&(l=0),h===void 0&&(h=!1);var v=i.call(this,e.getEngine(),"bloom",function(){return v._effects},!0)||this;return v.bloomScale=n,v._effects=[],v._downscale=new jm("highlights",1,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,h),v._blurX=new Yn("horizontal blur",new d.d(1,0),10,n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,void 0,h),v._blurX.alwaysForcePOT=!0,v._blurX.autoClear=!1,v._blurY=new Yn("vertical blur",new d.d(0,1),10,n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,void 0,h),v._blurY.alwaysForcePOT=!0,v._blurY.autoClear=!1,v.kernel=o,v._effects=[v._downscale,v._blurX,v._blurY],v._merge=new zm("bloomMerge",v._downscale,v._blurY,r,n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,h),v._merge.autoClear=!1,v._effects.push(v._merge),v}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Bt),Zw=`
uniform sampler2D textureSampler;

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`;We.a.ShadersStore.chromaticAberrationPixelShader=Zw;var Wm=function(i){function t(e,n,r,o,l,h,v,b,A,D){A===void 0&&(A=g.a.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D=!1);var N=i.call(this,e,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],o,l,h,v,b,null,A,void 0,null,D)||this;return N.aberrationAmount=30,N.radialIntensity=0,N.direction=new d.d(.707,.707),N.centerPosition=new d.d(.5,.5),N.screenWidth=n,N.screenHeight=r,N.onApplyObservable.add(function(j){j.setFloat("chromatic_aberration",N.aberrationAmount),j.setFloat("screen_width",n),j.setFloat("screen_height",r),j.setFloat("radialIntensity",N.radialIntensity),j.setFloat2("direction",N.direction.x,N.direction.y),j.setFloat2("centerPosition",N.centerPosition.x,N.centerPosition.y)}),N}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ChromaticAberrationPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.screenWidth,e.screenHeight,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"aberrationAmount",void 0),Object(_.c)([Object(V.c)()],t.prototype,"radialIntensity",void 0),Object(_.c)([Object(V.c)()],t.prototype,"direction",void 0),Object(_.c)([Object(V.c)()],t.prototype,"centerPosition",void 0),Object(_.c)([Object(V.c)()],t.prototype,"screenWidth",void 0),Object(_.c)([Object(V.c)()],t.prototype,"screenHeight",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.ChromaticAberrationPostProcess"]=Wm;var $w=`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`;We.a.ShadersStore.circleOfConfusionPixelShader=$w;var Hm=function(i){function t(e,n,r,o,l,h,v,b,A){b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),A===void 0&&(A=!1);var D=i.call(this,e,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],r,o,l,h,v,null,b,void 0,null,A)||this;return D.lensSize=50,D.fStop=1.4,D.focusDistance=2e3,D.focalLength=50,D._depthTexture=null,D._depthTexture=n,D.onApplyObservable.add(function(N){if(D._depthTexture){N.setTexture("depthSampler",D._depthTexture);var j=D.lensSize/D.fStop*D.focalLength/(D.focusDistance-D.focalLength);N.setFloat("focusDistance",D.focusDistance),N.setFloat("cocPrecalculation",j),N.setFloat2("cameraMinMaxZ",D._depthTexture.activeCamera.minZ,D._depthTexture.activeCamera.maxZ)}else p.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),D}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"CircleOfConfusionPostProcess"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!1,configurable:!0}),Object(_.c)([Object(V.c)()],t.prototype,"lensSize",void 0),Object(_.c)([Object(V.c)()],t.prototype,"fStop",void 0),Object(_.c)([Object(V.c)()],t.prototype,"focusDistance",void 0),Object(_.c)([Object(V.c)()],t.prototype,"focalLength",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.CircleOfConfusionPostProcess"]=Hm;var Jw=`
uniform sampler2D textureSampler;
uniform sampler2D colorTable;

varying vec2 vUV;

const float SLICE_COUNT=16.0;

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width;
float slicePixelSize=sliceSize/width;
float sliceInnerSize=slicePixelSize*(width-1.0);
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`;We.a.ShadersStore.colorCorrectionPixelShader=Jw;var JT=function(i){function t(e,n,r,o,l,h,v){var b=i.call(this,e,"colorCorrection",null,["colorTable"],r,o,l,h,v)||this;return b._colorTableTexture=new Ve.a(n,o.getScene(),!0,!1,Ve.a.TRILINEAR_SAMPLINGMODE),b._colorTableTexture.anisotropicFilteringLevel=1,b._colorTableTexture.wrapU=Ve.a.CLAMP_ADDRESSMODE,b._colorTableTexture.wrapV=Ve.a.CLAMP_ADDRESSMODE,b.colorTableUrl=n,b.onApply=function(A){A.setTexture("colorTable",b._colorTableTexture)},b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ColorCorrectionPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.colorTableUrl,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"colorTableUrl",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.ColorCorrectionPostProcess"]=JT;var eL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`;We.a.ShadersStore.convolutionPixelShader=eL;var eE=function(i){function t(e,n,r,o,l,h,v,b){b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT);var A=i.call(this,e,"convolution",["kernel","screenSize"],null,r,o,l,h,v,null,b)||this;return A.kernel=n,A.onApply=function(D){D.setFloat2("screenSize",A.width,A.height),D.setArray("kernel",A.kernel)},A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ConvolutionPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.kernel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType)},e,r,o)},t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],Object(_.c)([Object(V.c)()],t.prototype,"kernel",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.ConvolutionPostProcess"]=eE;var Dh=function(i){function t(e,n,r,o,l,h,v,b,A,D,N,j,k){b===void 0&&(b=null),A===void 0&&(A=Ve.a.BILINEAR_SAMPLINGMODE),j===void 0&&(j=g.a.TEXTURETYPE_UNSIGNED_INT),k===void 0&&(k=!1);var H=i.call(this,e,r,o,l,h,A=g.a.TEXTURE_BILINEAR_SAMPLINGMODE,D,N,j=g.a.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,k)||this;return H.direction=r,H.onApplyObservable.add(function(J){b!=null&&J.setTextureFromPostProcess("textureSampler",b),J.setTextureFromPostProcessOutput("circleOfConfusionSampler",v),n.activeCamera&&J.setFloat2("cameraMinMaxZ",n.activeCamera.minZ,n.activeCamera.maxZ)}),H}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldBlurPostProcess"},Object(_.c)([Object(V.c)()],t.prototype,"direction",void 0),t}(Yn);M.a.RegisteredTypes["BABYLON.DepthOfFieldBlurPostProcess"]=Dh;var tL=`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`;We.a.ShadersStore.depthOfFieldMergePixelShader=tL;var Oa,nL=function(){},tE=function(i){function t(e,n,r,o,l,h,v,b,A,D,N){D===void 0&&(D=g.a.TEXTURETYPE_UNSIGNED_INT),N===void 0&&(N=!1);var j=i.call(this,e,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],l,h,v,b,A,null,D,void 0,null,!0)||this;return j.blurSteps=o,j.onApplyObservable.add(function(k){k.setTextureFromPostProcess("textureSampler",n),k.setTextureFromPostProcessOutput("circleOfConfusionSampler",r),o.forEach(function(H,J){k.setTextureFromPostProcessOutput("blurStep"+(o.length-J-1),H)})}),N||j.updateEffect(),j}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DepthOfFieldMergePostProcess"},t.prototype.updateEffect=function(e,n,r,o,l,h){e===void 0&&(e=null),n===void 0&&(n=null),r===void 0&&(r=null),e||(e="",e+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),i.prototype.updateEffect.call(this,e,n,r,o,l,h)},t}(bt);(function(i){i[i.Low=0]="Low",i[i.Medium=1]="Medium",i[i.High=2]="High"})(Oa||(Oa={}));var Xm=function(i){function t(e,n,r,o,l){r===void 0&&(r=Oa.Low),o===void 0&&(o=0),l===void 0&&(l=!1);var h=i.call(this,e.getEngine(),"depth of field",function(){return h._effects},!0)||this;h._effects=[],h._circleOfConfusion=new Hm("circleOfConfusion",n,1,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l),h._depthOfFieldBlurY=[],h._depthOfFieldBlurX=[];var v=1,b=15;switch(r){case Oa.High:v=3,b=51;break;case Oa.Medium:v=2,b=31;break;default:b=15,v=1}for(var A=b/Math.pow(2,v-1),D=1,N=0;N<v;N++){var j=new Dh("verticle blur",e,new d.d(0,1),A,D,null,h._circleOfConfusion,N==0?h._circleOfConfusion:null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l);j.autoClear=!1,D=.75/Math.pow(2,N);var k=new Dh("horizontal blur",e,new d.d(1,0),A,D,null,h._circleOfConfusion,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l);k.autoClear=!1,h._depthOfFieldBlurY.push(j),h._depthOfFieldBlurX.push(k)}for(h._effects=[h._circleOfConfusion],N=0;N<h._depthOfFieldBlurX.length;N++)h._effects.push(h._depthOfFieldBlurY[N]),h._effects.push(h._depthOfFieldBlurX[N]);return h._dofMerge=new tE("dofMerge",h._circleOfConfusion,h._circleOfConfusion,h._depthOfFieldBlurX,D,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o,l),h._dofMerge.autoClear=!1,h._effects.push(h._dofMerge),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Bt),rL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`;We.a.ShadersStore.displayPassPixelShader=rL;var nE=function(i){function t(e,n,r,o,l,h){return i.call(this,e,"displayPass",["passSampler"],["passSampler"],n,r,o,l,h)||this}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"DisplayPassPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(bt);M.a.RegisteredTypes["BABYLON.DisplayPassPostProcess"]=nE;var iL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`;We.a.ShadersStore.filterPixelShader=iL;var rE=function(i){function t(e,n,r,o,l,h,v){var b=i.call(this,e,"filter",["kernelMatrix"],null,r,o,l,h,v)||this;return b.kernelMatrix=n,b.onApply=function(A){A.setMatrix("kernelMatrix",b.kernelMatrix)},b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FilterPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.kernelMatrix,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(_.c)([Object(V.j)()],t.prototype,"kernelMatrix",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.FilterPostProcess"]=rE;var oL=`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan)
{
lumaS=lumaE;
}
if (horzSpan)
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan)
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN)
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)
{
posN.x-=offNP.x*3.0;
}
if (!doneN)
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP)
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan)
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped)
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`;We.a.ShadersStore.fxaaPixelShader=oL;var aL=`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`;We.a.ShadersStore.fxaaVertexShader=aL;var bl=function(i){function t(e,n,r,o,l,h,v){r===void 0&&(r=null),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var b=i.call(this,e,"fxaa",["texelSize"],null,n,r,o||Ve.a.BILINEAR_SAMPLINGMODE,l,h,null,v,"fxaa",void 0,!0)||this,A=b._getDefines();return b.updateEffect(A),b.onApplyObservable.add(function(D){var N=b.texelSize;D.setFloat2("texelSize",N.x,N.y)}),b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"FxaaPostProcess"},t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var n=e.getGlInfo();return n&&n.renderer&&n.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},t}(bt);M.a.RegisteredTypes["BABYLON.FxaaPostProcess"]=bl;var sL=`#include<helperFunctions>

uniform sampler2D textureSampler;

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`;We.a.ShadersStore.grainPixelShader=sL;var Ym=function(i){function t(e,n,r,o,l,h,v,b){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=!1);var A=i.call(this,e,"grain",["intensity","animatedSeed"],[],n,r,o,l,h,null,v,void 0,null,b)||this;return A.intensity=30,A.animated=!1,A.onApplyObservable.add(function(D){D.setFloat("intensity",A.intensity),D.setFloat("animatedSeed",A.animated?Math.random()+1:1)}),A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"GrainPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"intensity",void 0),Object(_.c)([Object(V.c)()],t.prototype,"animated",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.GrainPostProcess"]=Ym;var cL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void)
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);
}`;We.a.ShadersStore.highlightsPixelShader=cL;var lL=function(i){function t(e,n,r,o,l,h,v){return v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),i.call(this,e,"highlights",null,null,n,r,o,l,h,null,v)||this}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"HighlightsPostProcess"},t}(bt);We.a.IncludesShadersStore.mrtFragmentDeclaration=`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`;var uL=`#extension GL_EXT_draw_buffers : require
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
precision highp float;
precision highp int;
#ifdef BUMP
varying mat4 vWorldView;
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#ifdef NEED_UV
varying vec2 vUV;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef REFLECTIVITY
varying vec2 vReflectivityUV;
uniform sampler2D reflectivitySampler;
#endif
#ifdef ALPHATEST
uniform sampler2D diffuseSampler;
#endif
#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
vec3 normalOutput;
#ifdef BUMP
vec3 normalW=normalize(vNormalW);
#include<bumpFragment>
normalOutput=normalize(vec3(vWorldView*vec4(normalW,0.0)));
#else
normalOutput=normalize(vNormalV);
#endif
#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[DEPTHNORMAL_INDEX]=vec4(vViewPos.z/vViewPos.w,normalOutput);
#endif
#else
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);
gl_FragData[1]=vec4(normalOutput,1.0);
#endif
#ifdef POSITION
gl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef REFLECTIVITY
#ifdef HAS_SPECULAR

vec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);
#elif HAS_REFLECTIVITY

vec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);
#else
vec4 reflectivity=vec4(0.0,0.0,0.0,1.0);
#endif
gl_FragData[REFLECTIVITY_INDEX]=reflectivity;
#endif
}`;We.a.ShadersStore.geometryPixelShader=uL;var hL=`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#ifdef NEED_UV
varying vec2 vUV;
#ifdef ALPHATEST
uniform mat4 diffuseMatrix;
#endif
#ifdef BUMP
uniform mat4 bumpMatrix;
varying vec2 vBumpUV;
#endif
#ifdef REFLECTIVITY
uniform mat4 reflectivityMatrix;
varying vec2 vReflectivityUV;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
#ifdef BUMP
varying mat4 vWorldView;
#endif
#ifdef BUMP
varying vec3 vNormalW;
#else
varying vec3 vNormalV;
#endif
varying vec4 vViewPos;
#if defined(POSITION) || defined(BUMP)
varying vec3 vPositionW;
#endif
#ifdef VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
#ifdef BONES_VELOCITY_ENABLED
#if NUM_BONE_INFLUENCERS>0
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));
#ifdef BUMP
vWorldView=view*finalWorld;
vNormalW=normalUpdated;
#else
vNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));
#endif
vViewPos=view*pos;
#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif
#if defined(POSITION) || defined(BUMP)
vPositionW=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#ifdef NEED_UV
#ifdef UV1
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#else
vUV=uv;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#endif
#ifdef UV2
#ifdef ALPHATEST
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#else
vUV=uv2;
#endif
#ifdef BUMP
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
#endif
#ifdef REFLECTIVITY
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#endif
#include<bumpVertex>
}
`;We.a.ShadersStore.geometryVertexShader=hL;var _i=function(){function i(t,e){e===void 0&&(e=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this.renderTransparentMeshes=!0,this._resizeObserver=null,this._enablePosition=!1,this._enableVelocity=!1,this._enableReflectivity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._reflectivityIndex=-1,this._depthNormalIndex=-1,this._linkedWithPrePass=!1,this._scene=t,this._ratio=e,i._SceneComponentInitialization(this._scene),this._createRenderTargets()}return i.prototype._linkPrePassRenderer=function(t){this._linkedWithPrePass=!0,this._prePassRenderer=t,this._multiRenderTarget&&(this._multiRenderTarget.onClearObservable.clear(),this._multiRenderTarget.onClearObservable.add(function(e){}))},i.prototype._unlinkPrePassRenderer=function(){this._linkedWithPrePass=!1,this._createRenderTargets()},i.prototype._resetLayout=function(){this._enablePosition=!1,this._enableReflectivity=!1,this._enableVelocity=!1,this._attachments=[]},i.prototype._forceTextureType=function(t,e){t===i.POSITION_TEXTURE_TYPE?(this._positionIndex=e,this._enablePosition=!0):t===i.VELOCITY_TEXTURE_TYPE?(this._velocityIndex=e,this._enableVelocity=!0):t===i.REFLECTIVITY_TEXTURE_TYPE?(this._reflectivityIndex=e,this._enableReflectivity=!0):t===i.DEPTHNORMAL_TEXTURE_TYPE&&(this._depthNormalIndex=e)},i.prototype._setAttachments=function(t){this._attachments=t},i.prototype._linkInternalTexture=function(t){this._multiRenderTarget._texture=t},Object.defineProperty(i.prototype,"renderList",{get:function(){return this._multiRenderTarget.renderList},set:function(t){this._multiRenderTarget.renderList=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!1,configurable:!0}),i.prototype.getTextureIndex=function(t){switch(t){case i.POSITION_TEXTURE_TYPE:return this._positionIndex;case i.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case i.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;default:return-1}},Object.defineProperty(i.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(t){this._enablePosition=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(t){this._enableVelocity=t,t||(this._previousTransformationMatrices={}),this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(t){this._enableReflectivity=t,this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this._ratio},enumerable:!1,configurable:!0}),i.prototype.isReady=function(t,e){var n=t.getMaterial();if(n&&n.disableDepthWrite)return!1;var r=[],o=[Me.b.PositionKind,Me.b.NormalKind],l=t.getMesh();if(n){var h=!1;n.needAlphaTesting()&&(r.push("#define ALPHATEST"),h=!0),n.bumpTexture&&Qt.a.BumpTextureEnabled&&(r.push("#define BUMP"),r.push("#define BUMPDIRECTUV 0"),h=!0),this._enableReflectivity&&(n instanceof Qt.a&&n.specularTexture?(r.push("#define HAS_SPECULAR"),h=!0):n instanceof tl&&n.reflectivityTexture&&(r.push("#define HAS_REFLECTIVITY"),h=!0)),h&&(r.push("#define NEED_UV"),l.isVerticesDataPresent(Me.b.UVKind)&&(o.push(Me.b.UVKind),r.push("#define UV1")),l.isVerticesDataPresent(Me.b.UV2Kind)&&(o.push(Me.b.UV2Kind),r.push("#define UV2")))}this._linkedWithPrePass&&(r.push("#define PREPASS"),this._depthNormalIndex!==-1&&(r.push("#define DEPTHNORMAL_INDEX "+this._depthNormalIndex),r.push("#define PREPASS_DEPTHNORMAL"))),this._enablePosition&&(r.push("#define POSITION"),r.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(r.push("#define VELOCITY"),r.push("#define VELOCITY_INDEX "+this._velocityIndex),this.excludedSkinnedMeshesFromVelocity.indexOf(l)===-1&&r.push("#define BONES_VELOCITY_ENABLED")),this._enableReflectivity&&(r.push("#define REFLECTIVITY"),r.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex)),l.useBones&&l.computeBonesUsingShaders?(o.push(Me.b.MatricesIndicesKind),o.push(Me.b.MatricesWeightsKind),l.numBoneInfluencers>4&&(o.push(Me.b.MatricesIndicesExtraKind),o.push(Me.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+l.numBoneInfluencers),r.push("#define BonesPerMesh "+(l.skeleton?l.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var v=l.morphTargetManager,b=0;v&&v.numInfluencers>0&&(b=v.numInfluencers,r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+b),ot.a.PrepareAttributesForMorphTargetsInfluencers(o,l,b)),e&&(r.push("#define INSTANCES"),ot.a.PushAttributesForInstances(o),t.getRenderingMesh().hasThinInstances&&r.push("#define THIN_INSTANCES")),this._linkedWithPrePass?r.push("#define RENDER_TARGET_COUNT "+this._attachments.length):r.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var A=r.join(`
`);return this._cachedDefines!==A&&(this._cachedDefines=A,this._effect=this._scene.getEngine().createEffect("geometry",o,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones","morphTargetInfluences","bumpMatrix","reflectivityMatrix","vTangentSpaceParams","vBumpInfos"],["diffuseSampler","bumpSampler","reflectivitySampler"],A,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:b})),this._effect.isReady()},i.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(i.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(t){this._multiRenderTarget.samples=t},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.getGBuffer().dispose()},i.prototype._assignRenderTargetIndices=function(){var t=2;return this._enablePosition&&(this._positionIndex=t,t++),this._enableVelocity&&(this._velocityIndex=t,t++),this._enableReflectivity&&(this._reflectivityIndex=t,t++),t},i.prototype._createRenderTargets=function(){var t=this,e=this._scene.getEngine(),n=this._assignRenderTargetIndices();if(this._multiRenderTarget=new rm("gBuffer",{width:e.getRenderWidth()*this._ratio,height:e.getRenderHeight()*this._ratio},n,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(o){o.clear(new x.b(0,0,0,1),!0,!0,!0)}),this._resizeObserver=e.onResizeObservable.add(function(){t._multiRenderTarget&&t._multiRenderTarget.resize({width:e.getRenderWidth()*t._ratio,height:e.getRenderHeight()*t._ratio})});var r=function(o){var l=o.getRenderingMesh(),h=o.getEffectiveMesh(),v=t._scene,b=v.getEngine(),A=o.getMaterial();if(A){if(h._internalAbstractMeshDataInfo._isActiveIntermediate=!1,t._enableVelocity&&!t._previousTransformationMatrices[h.uniqueId]&&(t._previousTransformationMatrices[h.uniqueId]={world:d.a.Identity(),viewProjection:v.getTransformMatrix()},l.skeleton)){var D=l.skeleton.getTransformMatrices(l);t._previousBonesTransformationMatrices[l.uniqueId]=t._copyBonesTransformationMatrices(D,new Float32Array(D.length))}var N=l._getInstancesRenderList(o._id,!!o.getReplacementMesh());if(!N.mustReturn){var j=b.getCaps().instancedArrays&&(N.visibleInstances[o._id]!==null||l.hasThinInstances),k=h.getWorldMatrix();if(t.isReady(o,j)){if(b.enableEffect(t._effect),l._bind(o,t._effect,A.fillMode),t._effect.setMatrix("viewProjection",v.getTransformMatrix()),t._effect.setMatrix("view",v.getViewMatrix()),A){var H,J=h._instanceDataStorage;if(J.isFrozen||!A.backFaceCulling&&A.overrideMaterialSideOrientation===null)H=J.sideOrientation;else{var te=h._getWorldMatrixDeterminant();(H=A.overrideMaterialSideOrientation)==null&&(H=A.sideOrientation),te<0&&(H=H===nn.a.ClockWiseSideOrientation?nn.a.CounterClockWiseSideOrientation:nn.a.ClockWiseSideOrientation)}if(A._preBind(t._effect,H),A.needAlphaTesting()){var oe=A.getAlphaTestTexture();oe&&(t._effect.setTexture("diffuseSampler",oe),t._effect.setMatrix("diffuseMatrix",oe.getTextureMatrix()))}A.bumpTexture&&v.getEngine().getCaps().standardDerivatives&&Qt.a.BumpTextureEnabled&&(t._effect.setFloat3("vBumpInfos",A.bumpTexture.coordinatesIndex,1/A.bumpTexture.level,A.parallaxScaleBias),t._effect.setMatrix("bumpMatrix",A.bumpTexture.getTextureMatrix()),t._effect.setTexture("bumpSampler",A.bumpTexture),t._effect.setFloat2("vTangentSpaceParams",A.invertNormalMapX?-1:1,A.invertNormalMapY?-1:1)),t._enableReflectivity&&(A instanceof Qt.a&&A.specularTexture?(t._effect.setMatrix("reflectivityMatrix",A.specularTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",A.specularTexture)):A instanceof tl&&A.reflectivityTexture&&(t._effect.setMatrix("reflectivityMatrix",A.reflectivityTexture.getTextureMatrix()),t._effect.setTexture("reflectivitySampler",A.reflectivityTexture)))}l.useBones&&l.computeBonesUsingShaders&&l.skeleton&&(t._effect.setMatrices("mBones",l.skeleton.getTransformMatrices(l)),t._enableVelocity&&t._effect.setMatrices("mPreviousBones",t._previousBonesTransformationMatrices[l.uniqueId])),ot.a.BindMorphTargetParameters(l,t._effect),t._enableVelocity&&(t._effect.setMatrix("previousWorld",t._previousTransformationMatrices[h.uniqueId].world),t._effect.setMatrix("previousViewProjection",t._previousTransformationMatrices[h.uniqueId].viewProjection)),l._processRendering(h,o,t._effect,A.fillMode,N,j,function(ce,he){return t._effect.setMatrix("world",he)})}t._enableVelocity&&(t._previousTransformationMatrices[h.uniqueId].world=k.clone(),t._previousTransformationMatrices[h.uniqueId].viewProjection=t._scene.getTransformMatrix().clone(),l.skeleton&&t._copyBonesTransformationMatrices(l.skeleton.getTransformMatrices(l),t._previousBonesTransformationMatrices[h.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(o,l,h,v){var b;if(t._linkedWithPrePass){if(!t._prePassRenderer.enabled)return;t._scene.getEngine().bindAttachments(t._attachments)}if(v.length){for(e.setColorWrite(!1),b=0;b<v.length;b++)r(v.data[b]);e.setColorWrite(!0)}for(b=0;b<o.length;b++)r(o.data[b]);for(b=0;b<l.length;b++)r(l.data[b]);if(t.renderTransparentMeshes)for(b=0;b<h.length;b++)r(h.data[b])}}},i.prototype._copyBonesTransformationMatrices=function(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e},i.DEPTHNORMAL_TEXTURE_TYPE=0,i.POSITION_TEXTURE_TYPE=1,i.VELOCITY_TEXTURE_TYPE=2,i.REFLECTIVITY_TEXTURE_TYPE=3,i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("GeometryBufferRendererSceneComponent")},i}(),dL=function(){this.enabled=!1,this.name="motionBlur",this.texturesRequired=[g.a.PREPASS_VELOCITY_TEXTURE_TYPE]};Object.defineProperty(ne.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(i){i&&i.isSupported&&(this._geometryBufferRenderer=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enableGeometryBufferRenderer=function(i){return i===void 0&&(i=1),this._geometryBufferRenderer||(this._geometryBufferRenderer=new _i(this,i),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null)),this._geometryBufferRenderer},ne.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var iE=function(){function i(t){this.name=ct.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(ct.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype._gatherRenderTargets=function(t){this.scene._geometryBufferRenderer&&t.push(this.scene._geometryBufferRenderer.getGBuffer())},i}();_i._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_GEOMETRYBUFFERRENDERER);t||(t=new iE(i),i._addComponent(t))};var fL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float motionStrength;
uniform float motionScale;
uniform vec2 screenSize;
#ifdef OBJECT_BASED
uniform sampler2D velocitySampler;
#else
uniform sampler2D depthSampler;
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
#endif
void main(void)
{
#ifdef GEOMETRY_SUPPORTED
#ifdef OBJECT_BASED
vec2 texelSize=1.0/screenSize;
vec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;
vec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));
velocity*=motionScale*motionStrength;
float speed=length(velocity/texelSize);
int samplesCount=int(clamp(speed,1.0,SAMPLES));
velocity=normalize(velocity)*texelSize;
float hlim=float(-samplesCount)*0.5+0.5;
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i)
{
if (i>=samplesCount)
break;
vec2 offset=vUV+velocity*(hlim+float(i));
result+=texture2D(textureSampler,offset);
}
gl_FragColor=result/float(samplesCount);
gl_FragColor.a=1.0;
#else
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
#endif
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;We.a.ShadersStore.motionBlurPixelShader=fL;var Km=function(i){function t(e,n,r,o,l,h,v,b,A,D){b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),A===void 0&&(A=!1),D===void 0&&(D=!0);var N=i.call(this,e,"motionBlur",["motionStrength","motionScale","screenSize","inverseViewProjection","prevViewProjection"],["velocitySampler"],r,o,l,h,v,`#define GEOMETRY_SUPPORTED
#define SAMPLES 64.0
#define OBJECT_BASED`,b,void 0,null,A)||this;return N.motionStrength=1,N._motionBlurSamples=32,N._isObjectBased=!0,N._forceGeometryBuffer=!1,N._geometryBufferRenderer=null,N._prePassRenderer=null,N._invViewProjection=null,N._previousViewProjection=null,N._forceGeometryBuffer=D,N._forceGeometryBuffer?(N._geometryBufferRenderer=n.enableGeometryBufferRenderer(),N._geometryBufferRenderer&&(N._geometryBufferRenderer.enableVelocity=!0)):(N._prePassRenderer=n.enablePrePassRenderer(),N._prePassRenderer&&(N._prePassRenderer.markAsDirty(),N._prePassEffectConfiguration=new dL)),N._applyMode(),N}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._updateEffect()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isObjectBased",{get:function(){return this._isObjectBased},set:function(e){this._isObjectBased!==e&&(this._isObjectBased=e,this._applyMode())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"MotionBlurPostProcess"},t.prototype.excludeSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}n.push(e)}},t.prototype.removeExcludedSkinnedMesh=function(e){if(e.skeleton){var n=void 0;if(this._geometryBufferRenderer)n=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;n=this._prePassRenderer.excludedSkinnedMesh}var r=n.indexOf(e);r!==-1&&n.splice(r,1)}},t.prototype.dispose=function(e){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),i.prototype.dispose.call(this,e)},t.prototype._applyMode=function(){var e=this;if(!this._geometryBufferRenderer&&!this._prePassRenderer)return p.a.Warn("Multiple Render Target support needed to compute object based motion blur"),this.updateEffect();this._updateEffect(),this._invViewProjection=null,this._previousViewProjection=null,this.isObjectBased?(this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_VELOCITY_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyObjectBased(n)}):(this._invViewProjection=d.a.Identity(),this._previousViewProjection=d.a.Identity(),this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),this.onApply=function(n){return e._onApplyScreenBased(n)})},t.prototype._onApplyObjectBased=function(e){if(e.setVector2("screenSize",new d.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var n=this._geometryBufferRenderer.getTextureIndex(_i.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",this._geometryBufferRenderer.getGBuffer().textures[n])}else this._prePassRenderer&&(n=this._prePassRenderer.getIndex(g.a.PREPASS_VELOCITY_TEXTURE_TYPE),e.setTexture("velocitySampler",this._prePassRenderer.prePassRT.textures[n]))},t.prototype._onApplyScreenBased=function(e){var n=this._scene.getProjectionMatrix().multiply(this._scene.getViewMatrix());if(n.invertToRef(this._invViewProjection),e.setMatrix("inverseViewProjection",this._invViewProjection),e.setMatrix("prevViewProjection",this._previousViewProjection),this._previousViewProjection=n,e.setVector2("screenSize",new d.d(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var r=this._geometryBufferRenderer.getTextureIndex(_i.DEPTHNORMAL_TEXTURE_TYPE);e.setTexture("depthSampler",this._geometryBufferRenderer.getGBuffer().textures[r])}else this._prePassRenderer&&(r=this._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE),e.setTexture("depthSampler",this._prePassRenderer.prePassRT.textures[r]))},t.prototype._updateEffect=function(){if(this._geometryBufferRenderer||this._prePassRenderer){var e=["#define GEOMETRY_SUPPORTED","#define SAMPLES "+this._motionBlurSamples.toFixed(1),this._isObjectBased?"#define OBJECT_BASED":"#define SCREEN_BASED"];this.updateEffect(e.join(`
`))}},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable,e.textureType,!1)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"motionStrength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"motionBlurSamples",null),Object(_.c)([Object(V.c)()],t.prototype,"isObjectBased",null),t}(bt);M.a.RegisteredTypes["BABYLON.MotionBlurPostProcess"]=Km;var pL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`;We.a.ShadersStore.refractionPixelShader=pL;var oE=function(i){function t(e,n,r,o,l,h,v,b,A,D){var N=i.call(this,e,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],h,v,b,A,D)||this;return N._ownRefractionTexture=!0,N.color=r,N.depth=o,N.colorLevel=l,N.refractionTextureUrl=n,N.onActivateObservable.add(function(j){N._refTexture=N._refTexture||new Ve.a(n,j.getScene())}),N.onApplyObservable.add(function(j){j.setColor3("baseColor",N.color),j.setFloat("depth",N.depth),j.setFloat("colorLevel",N.colorLevel),j.setTexture("refractionSampler",N._refTexture)}),N}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"RefractionPostProcess"},t.prototype.dispose=function(e){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),i.prototype.dispose.call(this,e)},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.refractionTextureUrl,e.color,e.depth,e.colorLevel,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"color",void 0),Object(_.c)([Object(V.c)()],t.prototype,"depth",void 0),Object(_.c)([Object(V.c)()],t.prototype,"colorLevel",void 0),Object(_.c)([Object(V.c)()],t.prototype,"refractionTextureUrl",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.RefractionPostProcess"]=oE;var mL=`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`;We.a.ShadersStore.sharpenPixelShader=mL;var Qm=function(i){function t(e,n,r,o,l,h,v,b){v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT),b===void 0&&(b=!1);var A=i.call(this,e,"sharpen",["sharpnessAmounts","screenSize"],null,n,r,o,l,h,null,v,void 0,null,b)||this;return A.colorAmount=1,A.edgeAmount=.3,A.onApply=function(D){D.setFloat2("screenSize",A.width,A.height),D.setFloat2("sharpnessAmounts",A.edgeAmount,A.colorAmount)},A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"SharpenPostProcess"},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"colorAmount",void 0),Object(_.c)([Object(V.c)()],t.prototype,"edgeAmount",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.SharpenPostProcess"]=Qm;var Is=function(){function i(t,e){this.engine=t,this._name=e,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameras",{get:function(){return this._cameras},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(i.prototype,"isSupported",{get:function(){for(var t in this._renderEffects)if(this._renderEffects.hasOwnProperty(t)&&!this._renderEffects[t].isSupported)return!1;return!0},enumerable:!1,configurable:!0}),i.prototype.addEffect=function(t){this._renderEffects[t._name]=t},i.prototype._rebuild=function(){},i.prototype._enableEffect=function(t,e){var n=this._renderEffects[t];n&&n._enable(Qe.b.MakeArray(e||this._cameras))},i.prototype._disableEffect=function(t,e){var n=this._renderEffects[t];n&&n._disable(Qe.b.MakeArray(e||this._cameras))},i.prototype._attachCameras=function(t,e){var n=Qe.b.MakeArray(t||this._cameras);if(n){var r,o=[];for(r=0;r<n.length;r++){var l=n[r];if(l){var h=l.name;this._cameras.indexOf(l)===-1?this._cameras[h]=l:e&&o.push(r)}}for(r=0;r<o.length;r++)t.splice(o[r],1);for(var v in this._renderEffects)this._renderEffects.hasOwnProperty(v)&&this._renderEffects[v]._attachCameras(n)}},i.prototype._detachCameras=function(t){var e=Qe.b.MakeArray(t||this._cameras);if(e){for(var n in this._renderEffects)this._renderEffects.hasOwnProperty(n)&&this._renderEffects[n]._detachCameras(e);for(var r=0;r<e.length;r++)this._cameras.splice(this._cameras.indexOf(e[r]),1)}},i.prototype._update=function(){for(var t in this._renderEffects)this._renderEffects.hasOwnProperty(t)&&this._renderEffects[t]._update();for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]){var n=this._cameras[e].name;this._renderEffectsForIsolatedPass[n]&&this._renderEffectsForIsolatedPass[n]._update()}},i.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},i.prototype._enableMSAAOnFirstPostProcess=function(t){if(this.engine.webGLVersion===1)return!1;var e=Object.keys(this._renderEffects);if(e.length>0){var n=this._renderEffects[e[0]].getPostProcesses();n&&(n[0].samples=t)}return!0},i.prototype.setPrePassRenderer=function(t){return!1},i.prototype.dispose=function(){},Object(_.c)([Object(V.c)()],i.prototype,"_name",void 0),i}(),aE=function(){function i(){this._renderPipelines={}}return Object.defineProperty(i.prototype,"supportedPipelines",{get:function(){var t=[];for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var n=this._renderPipelines[e];n.isSupported&&t.push(n)}return t},enumerable:!1,configurable:!0}),i.prototype.addPipeline=function(t){this._renderPipelines[t._name]=t},i.prototype.attachCamerasToRenderPipeline=function(t,e,n){n===void 0&&(n=!1);var r=this._renderPipelines[t];r&&r._attachCameras(e,n)},i.prototype.detachCamerasFromRenderPipeline=function(t,e){var n=this._renderPipelines[t];n&&n._detachCameras(e)},i.prototype.enableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._enableEffect(e,n)},i.prototype.disableEffectInPipeline=function(t,e,n){var r=this._renderPipelines[t];r&&r._disableEffect(e,n)},i.prototype.update=function(){for(var t in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(t)){var e=this._renderPipelines[t];e.isSupported?e._update():(e.dispose(),delete this._renderPipelines[t])}},i.prototype._rebuild=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t]._rebuild()},i.prototype.dispose=function(){for(var t in this._renderPipelines)this._renderPipelines.hasOwnProperty(t)&&this._renderPipelines[t].dispose()},i}();Object.defineProperty(ne.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var i=this._getComponent(ct.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);i||(i=new sE(this),this._addComponent(i)),this._postProcessRenderPipelineManager=new aE}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var sE=function(){function i(t){this.name=ct.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(ct.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},i.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},i.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},i.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},i}(),cE=function(i){function t(e,n,r,o,l){e===void 0&&(e=""),n===void 0&&(n=!0),r===void 0&&(r=$.a.LastCreatedScene),l===void 0&&(l=!0);var h=i.call(this,r.getEngine(),e)||this;h._camerasToBeAttached=[],h.SharpenPostProcessId="SharpenPostProcessEffect",h.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",h.FxaaPostProcessId="FxaaPostProcessEffect",h.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",h.GrainPostProcessId="GrainPostProcessEffect",h._glowLayer=null,h.animations=[],h._imageProcessingConfigurationObserver=null,h._sharpenEnabled=!1,h._bloomEnabled=!1,h._depthOfFieldEnabled=!1,h._depthOfFieldBlurLevel=Oa.Low,h._fxaaEnabled=!1,h._imageProcessingEnabled=!0,h._bloomScale=.5,h._chromaticAberrationEnabled=!1,h._grainEnabled=!1,h._buildAllowed=!0,h.onBuildObservable=new E.c,h._resizeObserver=null,h._hardwareScaleLevel=1,h._bloomKernel=64,h._bloomWeight=.15,h._bloomThreshold=.9,h._samples=1,h._hasCleared=!1,h._prevPostProcess=null,h._prevPrevPostProcess=null,h._depthOfFieldSceneObserver=null,h._cameras=o||r.cameras,h._cameras=h._cameras.slice(),h._camerasToBeAttached=h._cameras.slice(),h._buildAllowed=l,h._scene=r;var v=h._scene.getEngine().getCaps();h._hdr=n&&(v.textureHalfFloatRender||v.textureFloatRender),h._hdr?v.textureHalfFloatRender?h._defaultPipelineTextureType=g.a.TEXTURETYPE_HALF_FLOAT:v.textureFloatRender&&(h._defaultPipelineTextureType=g.a.TEXTURETYPE_FLOAT):h._defaultPipelineTextureType=g.a.TEXTURETYPE_UNSIGNED_INT,r.postProcessRenderPipelineManager.addPipeline(h);var b=h._scene.getEngine();return h.sharpen=new Qm("sharpen",1,null,Ve.a.BILINEAR_SAMPLINGMODE,b,!1,h._defaultPipelineTextureType,!0),h._sharpenEffect=new Bt(b,h.SharpenPostProcessId,function(){return h.sharpen},!0),h.depthOfField=new Xm(h._scene,null,h._depthOfFieldBlurLevel,h._defaultPipelineTextureType,!0),h.bloom=new Gm(h._scene,h._bloomScale,h._bloomWeight,h.bloomKernel,h._defaultPipelineTextureType,!0),h.chromaticAberration=new Wm("ChromaticAberration",b.getRenderWidth(),b.getRenderHeight(),1,null,Ve.a.BILINEAR_SAMPLINGMODE,b,!1,h._defaultPipelineTextureType,!0),h._chromaticAberrationEffect=new Bt(b,h.ChromaticAberrationPostProcessId,function(){return h.chromaticAberration},!0),h.grain=new Ym("Grain",1,null,Ve.a.BILINEAR_SAMPLINGMODE,b,!1,h._defaultPipelineTextureType,!0),h._grainEffect=new Bt(b,h.GrainPostProcessId,function(){return h.grain},!0),h._resizeObserver=b.onResizeObservable.add(function(){h._hardwareScaleLevel=b.getHardwareScalingLevel(),h.bloomKernel=h.bloomKernel}),h._imageProcessingConfigurationObserver=h._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){h.bloom._downscale._exposure=h._scene.imageProcessingConfiguration.exposure,h.imageProcessingEnabled!==h._scene.imageProcessingConfiguration.isEnabled&&(h._imageProcessingEnabled=h._scene.imageProcessingConfiguration.isEnabled,h._buildPipeline())}),h._buildPipeline(),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new Gm(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var n=0;n<this._cameras.length;n++)e.disposeEffects(this._cameras[n])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var n=this.depthOfField;this.depthOfField=new Xm(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=n.focalLength,this.depthOfField.focusDistance=n.focusDistance,this.depthOfField.fStop=n.fStop,this.depthOfField.lensSize=n.lensSize;for(var r=0;r<this._cameras.length;r++)n.disposeEffects(this._cameras[r]);this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._scene.imageProcessingConfiguration.isEnabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return this._glowLayer!=null},set:function(e){e&&!this._glowLayer?this._glowLayer=new dh("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,n){n===void 0&&(n=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),n||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var n=this._scene.getEngine();if(this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var r=0,o=this._cameras;r<o.length;r++){var l=o[r];(h=this._scene.enableDepthRenderer(l)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(v){e._cameras.indexOf(v.activeCamera)>-1&&(e.depthOfField.depthTexture=v.enableDepthRenderer(v.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var h=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=h.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new Qu("imageProcessing",1,null,Ve.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new Bt(n,this.ImageProcessingPostProcessId,function(){return e.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1,this.cameras&&this.cameras.length!==0||(this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.imageProcessing.getEffect()||this.imageProcessing._updateParameters()),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new bl("fxaa",1,null,Ve.a.BILINEAR_SAMPLINGMODE,n,!1,this._defaultPipelineTextureType),this.addEffect(new Bt(n,this.FxaaPostProcessId,function(){return e.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"),this.onBuildObservable.notifyObservers(this)}},t.prototype._disposePostProcesses=function(e){e===void 0&&(e=!1);for(var n=0;n<this._cameras.length;n++){var r=this._cameras[n];this.imageProcessing&&this.imageProcessing.dispose(r),this.fxaa&&this.fxaa.dispose(r),e&&(this.sharpen&&this.sharpen.dispose(r),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(r)),this.bloom&&this.bloom.disposeEffects(r),this.chromaticAberration&&this.chromaticAberration.dispose(r),this.grain&&this.grain.dispose(r),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var n=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(n,1),this._buildPipeline()},t.prototype.dispose=function(){this.onBuildObservable.clear(),this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,n,r){return V.a.Parse(function(){return new t(e._name,e._name._hdr,n)},e,n,r)},Object(_.c)([Object(V.c)()],t.prototype,"sharpenEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"bloomKernel",null),Object(_.c)([Object(V.c)()],t.prototype,"_bloomWeight",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_bloomThreshold",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_hdr",void 0),Object(_.c)([Object(V.c)()],t.prototype,"bloomWeight",null),Object(_.c)([Object(V.c)()],t.prototype,"bloomThreshold",null),Object(_.c)([Object(V.c)()],t.prototype,"bloomScale",null),Object(_.c)([Object(V.c)()],t.prototype,"bloomEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"depthOfFieldEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"depthOfFieldBlurLevel",null),Object(_.c)([Object(V.c)()],t.prototype,"fxaaEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"samples",null),Object(_.c)([Object(V.c)()],t.prototype,"imageProcessingEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"glowLayerEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"chromaticAberrationEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"grainEnabled",null),t}(Is);M.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=cE;var _L=`
uniform sampler2D textureSampler;

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`;We.a.ShadersStore.lensHighlightsPixelShader=_L;var gL=`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance;
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight;

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV);
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);
float depth=texture2D(depthSampler,distorted_coords).r;
float distance=near+(far-near)*depth;
vec4 color=texture2D(textureSampler,vUV);


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`;We.a.ShadersStore.depthOfFieldPixelShader=gL;var vL=function(i){function t(e,n,r,o,l){o===void 0&&(o=1);var h=i.call(this,r.getEngine(),e)||this;return h.LensChromaticAberrationEffect="LensChromaticAberrationEffect",h.HighlightsEnhancingEffect="HighlightsEnhancingEffect",h.LensDepthOfFieldEffect="LensDepthOfFieldEffect",h._pentagonBokehIsEnabled=!1,h._scene=r,h._depthTexture=r.enableDepthRenderer().getDepthMap(),n.grain_texture?h._grainTexture=n.grain_texture:h._createGrainTexture(),h._edgeBlur=n.edge_blur?n.edge_blur:0,h._grainAmount=n.grain_amount?n.grain_amount:0,h._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,h._distortion=n.distortion?n.distortion:0,h._highlightsGain=n.dof_gain!==void 0?n.dof_gain:-1,h._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,h._dofDistance=n.dof_focus_distance!==void 0?n.dof_focus_distance:-1,h._dofAperture=n.dof_aperture?n.dof_aperture:1,h._dofDarken=n.dof_darken?n.dof_darken:0,h._dofPentagon=n.dof_pentagon===void 0||n.dof_pentagon,h._blurNoise=n.blur_noise===void 0||n.blur_noise,h._createChromaticAberrationPostProcess(o),h._createHighlightsPostProcess(o),h._createDepthOfFieldPostProcess(o/4),h.addEffect(new Bt(r.getEngine(),h.LensChromaticAberrationEffect,function(){return h._chromaticAberrationPostProcess},!0)),h.addEffect(new Bt(r.getEngine(),h.HighlightsEnhancingEffect,function(){return h._highlightsPostProcess},!0)),h.addEffect(new Bt(r.getEngine(),h.LensDepthOfFieldEffect,function(){return h._depthOfFieldPostProcess},!0)),h._highlightsGain===-1&&h._disableEffect(h.HighlightsEnhancingEffect,null),r.postProcessRenderPipelineManager.addPipeline(h),l&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,l),h}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!1,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){this._highlightsGain===-1&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){e===void 0&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var n=this;this._chromaticAberrationPostProcess=new bt("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,Ve.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(r){r.setFloat("chromatic_aberration",n._chromaticAberration),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("radialIntensity",1),r.setFloat2("direction",17,17),r.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var n=this;this._highlightsPostProcess=new bt("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,Ve.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(r){r.setFloat("gain",n._highlightsGain),r.setFloat("threshold",n._highlightsThreshold),r.setTextureFromPostProcess("textureSampler",n._chromaticAberrationPostProcess),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var n=this;this._depthOfFieldPostProcess=new bt("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,Ve.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(r){r.setTexture("depthSampler",n._depthTexture),r.setTexture("grainSampler",n._grainTexture),r.setTextureFromPostProcess("textureSampler",n._highlightsPostProcess),r.setTextureFromPostProcess("highlightsSampler",n._depthOfFieldPostProcess),r.setFloat("grain_amount",n._grainAmount),r.setBool("blur_noise",n._blurNoise),r.setFloat("screen_width",n._scene.getEngine().getRenderWidth()),r.setFloat("screen_height",n._scene.getEngine().getRenderHeight()),r.setFloat("distortion",n._distortion),r.setBool("dof_enabled",n._dofDistance!==-1),r.setFloat("screen_distance",1/(.1-1/n._dofDistance)),r.setFloat("aperture",n._dofAperture),r.setFloat("darken",n._dofDarken),r.setFloat("edge_blur",n._edgeBlur),r.setBool("highlights",n._highlightsGain!==-1),n._scene.activeCamera&&(r.setFloat("near",n._scene.activeCamera.minZ),r.setFloat("far",n._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new Zi.a("LensNoiseTexture",512,this._scene,!1,Ve.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=Ve.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=Ve.a.WRAP_ADDRESSMODE;for(var e,n,r,o=this._grainTexture.getContext(),l=0;l<512;l++)for(var h=0;h<512;h++)e=Math.floor(255*(n=.42,r=.58,Math.random()*(r-n)+n)),o.fillStyle="rgb("+e+", "+e+", "+e+")",o.fillRect(l,h,1,1);this._grainTexture.update(!1)},t}(Is),bL=function(){this.enabled=!1,this.name="ssao2",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE]},yL=`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
#ifndef GEOMETRYBUFFER
uniform sampler2D depthNormalSampler;
#else
uniform sampler2D depthSampler;
uniform sampler2D normalSampler;
#endif
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
#ifndef GEOMETRYBUFFER
float depth=texture2D(depthNormalSampler,vUV).r;
#else
float depth=texture2D(depthSampler,vUV).r;
#endif
float depthSign=depth/abs(depth);
depth=depth*depthSign;
#ifndef GEOMETRYBUFFER
vec3 normal=texture2D(depthNormalSampler,vUV).gba;
#else
vec3 normal=texture2D(normalSampler,vUV).rgb;
#endif
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

#ifndef GEOMETRYBUFFER
float sampleDepth=abs(texture2D(depthNormalSampler,offset.xy).r);
#else
float sampleDepth=abs(texture2D(depthSampler,offset.xy).r);
#endif

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthNormalSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthNormalSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthNormalSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthNormalSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthNormalSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`;We.a.ShadersStore.ssao2PixelShader=yL;var TL=`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`;We.a.ShadersStore.ssaoCombinePixelShader=TL;var lE=function(i){function t(e,n,r,o,l){l===void 0&&(l=!0);var h=i.call(this,n.getEngine(),e)||this;if(h.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",h.SSAORenderEffect="SSAORenderEffect",h.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",h.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",h.SSAOCombineRenderEffect="SSAOCombineRenderEffect",h.totalStrength=1,h.maxZ=100,h.minZAspect=.2,h._samples=8,h._textureSamples=1,h._forceGeometryBuffer=!1,h._expensiveBlur=!0,h.radius=2,h.base=0,h._bits=new Uint32Array(1),h._scene=n,h._ratio=r,h._forceGeometryBuffer=l,!h.isSupported)return p.a.Error("SSAO 2 needs WebGL 2 support."),h;var v=h._ratio.ssaoRatio||r,b=h._ratio.blurRatio||r;return h._forceGeometryBuffer?n.enableGeometryBufferRenderer():h._prePassRenderer=n.enablePrePassRenderer(),h._createRandomTexture(),h._originalColorPostProcess=new wo("SSAOOriginalSceneColor",1,null,Ve.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),h._originalColorPostProcess.samples=h.textureSamples,h._createSSAOPostProcess(1),h._createBlurPostProcess(v,b),h._createSSAOCombinePostProcess(b),h.addEffect(new Bt(n.getEngine(),h.SSAOOriginalSceneColorEffect,function(){return h._originalColorPostProcess},!0)),h.addEffect(new Bt(n.getEngine(),h.SSAORenderEffect,function(){return h._ssaoPostProcess},!0)),h.addEffect(new Bt(n.getEngine(),h.SSAOBlurHRenderEffect,function(){return h._blurHPostProcess},!0)),h.addEffect(new Bt(n.getEngine(),h.SSAOBlurVRenderEffect,function(){return h._blurVPostProcess},!0)),h.addEffect(new Bt(n.getEngine(),h.SSAOCombineRenderEffect,function(){return h._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(h),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO()),this._sampleSphere=this._generateHemisphere()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(e?"1":"0")+`
`,null,["textureSampler","depthNormalSampler"]),this._expensiveBlur=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=$.a.LastCreatedEngine;return!!e&&e.webGLVersion>=2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,n){var r=this;this._samplerOffsets=[];for(var o=this.expensiveBlur,l=-8;l<8;l++)this._samplerOffsets.push(2*l+.5);this._blurHPostProcess=new bt("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],e,null,Ve.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurHPostProcess.onApply=function(h){r._scene.activeCamera&&(h.setFloat("outSize",r._ssaoCombinePostProcess.width>0?r._ssaoCombinePostProcess.width:r._originalColorPostProcess.width),h.setFloat("near",r._scene.activeCamera.minZ),h.setFloat("far",r._scene.activeCamera.maxZ),h.setFloat("radius",r.radius),r._forceGeometryBuffer?h.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):h.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),h.setArray("samplerOffsets",r._samplerOffsets))},this._blurVPostProcess=new bt("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],n,null,Ve.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(o?"1":"0")+`
`),this._blurVPostProcess.onApply=function(h){r._scene.activeCamera&&(h.setFloat("outSize",r._ssaoCombinePostProcess.height>0?r._ssaoCombinePostProcess.height:r._originalColorPostProcess.height),h.setFloat("near",r._scene.activeCamera.minZ),h.setFloat("far",r._scene.activeCamera.maxZ),h.setFloat("radius",r.radius),r._forceGeometryBuffer?h.setTexture("depthNormalSampler",r._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):h.setTexture("depthNormalSampler",r._prePassRenderer.prePassRT.textures[r._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),h.setArray("samplerOffsets",r._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){i.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,23283064365386963e-26*this._bits[0]},t.prototype._hammersley=function(e,n){return[e/n,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,n){var r=2*n*Math.PI,o=1-(.85*e+.15),l=Math.sqrt(1-o*o);return new d.e(Math.cos(r)*l,Math.sin(r)*l,o)},t.prototype._generateHemisphere=function(){for(var e,n=this.samples,r=[],o=0;o<n;){if(n<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var l=this._hammersley(o,n);e=this._hemisphereSample_uniform(l[0],l[1])}r.push(e.x,e.y,e.z),o++}return r},t.prototype._getDefinesForSSAO=function(){var e="#define SAMPLES "+this.samples+`
#define SSAO`;return this._forceGeometryBuffer&&(e+=`
#define GEOMETRYBUFFER`),e},t.prototype._createSSAOPostProcess=function(e){var n=this;this._sampleSphere=this._generateHemisphere();var r,o=this._getDefinesForSSAO();r=this._forceGeometryBuffer?["randomSampler","depthSampler","normalSampler"]:["randomSampler","depthNormalSampler"],this._ssaoPostProcess=new bt("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],r,e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._ssaoPostProcess.onApply=function(l){n._scene.activeCamera&&(l.setArray3("sampleSphere",n._sampleSphere),l.setFloat("randTextureTiles",32),l.setFloat("samplesFactor",1/n.samples),l.setFloat("totalStrength",n.totalStrength),l.setFloat2("texelSize",1/n._ssaoPostProcess.width,1/n._ssaoPostProcess.height),l.setFloat("radius",n.radius),l.setFloat("maxZ",n.maxZ),l.setFloat("minZAspect",n.minZAspect),l.setFloat("base",n.base),l.setFloat("near",n._scene.activeCamera.minZ),l.setFloat("far",n._scene.activeCamera.maxZ),l.setFloat("xViewport",Math.tan(n._scene.activeCamera.fov/2)*n._scene.getEngine().getAspectRatio(n._scene.activeCamera,!0)),l.setFloat("yViewport",Math.tan(n._scene.activeCamera.fov/2)),l.setMatrix("projection",n._scene.getProjectionMatrix()),n._forceGeometryBuffer?(l.setTexture("depthSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]),l.setTexture("normalSampler",n._scene.enableGeometryBufferRenderer().getGBuffer().textures[1])):l.setTexture("depthNormalSampler",n._prePassRenderer.prePassRT.textures[n._prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),l.setTexture("randomSampler",n._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new bt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){var o=n._scene.activeCamera.viewport;r.setVector4("viewport",d.c.Vector4[0].copyFromFloats(o.x,o.y,o.width,o.height)),r.setTextureFromPostProcessOutput("originalColor",n._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples,this._forceGeometryBuffer||(this._ssaoCombinePostProcess._prePassEffectConfiguration=new bL)},t.prototype._createRandomTexture=function(){this._randomTexture=new Zi.a("SSAORandomTexture",128,this._scene,!1,Ve.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ve.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ve.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(h,v){return Math.random()*(v-h)+h},r=d.e.Zero(),o=0;o<128;o++)for(var l=0;l<128;l++)r.x=n(0,1),r.y=n(0,1),r.z=0,r.normalize(),r.scaleInPlace(255),r.x=Math.floor(r.x),r.y=Math.floor(r.y),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,l,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=V.a.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,n,r){return V.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r)},Object(_.c)([Object(V.c)()],t.prototype,"totalStrength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"maxZ",void 0),Object(_.c)([Object(V.c)()],t.prototype,"minZAspect",void 0),Object(_.c)([Object(V.c)("samples")],t.prototype,"_samples",void 0),Object(_.c)([Object(V.c)("textureSamples")],t.prototype,"_textureSamples",void 0),Object(_.c)([Object(V.c)()],t.prototype,"_ratio",void 0),Object(_.c)([Object(V.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),Object(_.c)([Object(V.c)()],t.prototype,"radius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"base",void 0),t}(Is);M.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=lE;var EL=`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`;We.a.ShadersStore.ssaoPixelShader=EL;var SL=function(i){function t(e,n,r,o){var l=i.call(this,n.getEngine(),e)||this;l.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",l.SSAORenderEffect="SSAORenderEffect",l.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",l.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",l.SSAOCombineRenderEffect="SSAOCombineRenderEffect",l.totalStrength=1,l.radius=1e-4,l.area=.0075,l.fallOff=1e-6,l.base=.5,l._firstUpdate=!0,l._scene=n,l._createRandomTexture(),l._depthTexture=n.enableDepthRenderer().getDepthMap();var h=r.ssaoRatio||r,v=r.combineRatio||r;return l._originalColorPostProcess=new wo("SSAOOriginalSceneColor",v,null,Ve.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),l._createSSAOPostProcess(h),l._createBlurPostProcess(h),l._createSSAOCombinePostProcess(v),l.addEffect(new Bt(n.getEngine(),l.SSAOOriginalSceneColorEffect,function(){return l._originalColorPostProcess},!0)),l.addEffect(new Bt(n.getEngine(),l.SSAORenderEffect,function(){return l._ssaoPostProcess},!0)),l.addEffect(new Bt(n.getEngine(),l.SSAOBlurHRenderEffect,function(){return l._blurHPostProcess},!0)),l.addEffect(new Bt(n.getEngine(),l.SSAOBlurVRenderEffect,function(){return l._blurVPostProcess},!0)),l.addEffect(new Bt(n.getEngine(),l.SSAOCombineRenderEffect,function(){return l._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(l),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(e,o),l}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(e){e===void 0&&(e=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),i.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var n=this;this._blurHPostProcess=new Yn("BlurH",new d.d(1,0),16,e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new Yn("BlurV",new d.d(0,1),16,e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var r=n._blurHPostProcess.width/n._scene.getEngine().getRenderWidth();n._blurHPostProcess.kernel=16*r}),this._blurVPostProcess.onActivateObservable.add(function(){var r=n._blurVPostProcess.height/n._scene.getEngine().getRenderHeight();n._blurVPostProcess.kernel=16*r})},t.prototype._rebuild=function(){this._firstUpdate=!0,i.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var n=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new bt("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define SAMPLES 16
#define SSAO`),this._ssaoPostProcess.onApply=function(o){n._firstUpdate&&(o.setArray3("sampleSphere",r),o.setFloat("samplesFactor",1/16),o.setFloat("randTextureTiles",4)),o.setFloat("totalStrength",n.totalStrength),o.setFloat("radius",n.radius),o.setFloat("area",n.area),o.setFloat("fallOff",n.fallOff),o.setFloat("base",n.base),o.setTexture("textureSampler",n._depthTexture),o.setTexture("randomSampler",n._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var n=this;this._ssaoCombinePostProcess=new bt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ve.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(r){r.setVector4("viewport",d.c.Vector4[0].copyFromFloats(0,0,1,1)),r.setTextureFromPostProcess("originalColor",n._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new Zi.a("SSAORandomTexture",512,this._scene,!1,Ve.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ve.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ve.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),n=function(h,v){return Math.random()*(v-h)+h},r=d.e.Zero(),o=0;o<512;o++)for(var l=0;l<512;l++)r.x=Math.floor(255*n(-1,1)),r.y=Math.floor(255*n(-1,1)),r.z=Math.floor(255*n(-1,1)),e.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",e.fillRect(o,l,1,1);this._randomTexture.update(!1)},Object(_.c)([Object(V.c)()],t.prototype,"totalStrength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"radius",void 0),Object(_.c)([Object(V.c)()],t.prototype,"area",void 0),Object(_.c)([Object(V.c)()],t.prototype,"fallOff",void 0),Object(_.c)([Object(V.c)()],t.prototype,"base",void 0),t}(Is),xL=function(){this.enabled=!1,this.name="screenSpaceReflections",this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,g.a.PREPASS_POSITION_TEXTURE_TYPE]},PL=`

uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform sampler2D positionSampler;
uniform sampler2D reflectivitySampler;
uniform mat4 view;
uniform mat4 projection;
uniform float step;
uniform float strength;
uniform float threshold;
uniform float roughnessFactor;
uniform float reflectionSpecularFalloffExponent;

varying vec2 vUV;

struct ReflectionInfo {
vec3 color;
vec4 coords;
};

vec3 fresnelSchlick(float cosTheta,vec3 F0)
{
return F0+(1.0-F0)*pow(1.0-cosTheta,5.0);
}

ReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
info.color=vec3(0.0);
vec4 projectedCoord;
float sampledDepth;
for(int i=0; i<SMOOTH_STEPS; i++)
{
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
dir*=0.5;
if(depth>0.0)
hitCoord-=dir;
else
hitCoord+=dir;
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
}
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);

info.coords=vec4(projectedCoord.xy,sampledDepth,1.0);
info.color+=texture2D(textureSampler,projectedCoord.xy).rgb;
info.color/=float(SMOOTH_STEPS+1);
return info;
}

ReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)
{
ReflectionInfo info;
vec4 projectedCoord;
float sampledDepth;
dir*=step;
for(int i=0; i<REFLECTION_SAMPLES; i++)
{
hitCoord+=dir;
projectedCoord=projection*vec4(hitCoord,1.0);
projectedCoord.xy/=projectedCoord.w;
projectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);
sampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;
float depth=sampledDepth-hitCoord.z;
if(((depth-dir.z)<threshold) && depth<=0.0)
{
#ifdef ENABLE_SMOOTH_REFLECTIONS
return smoothReflectionInfo(dir,hitCoord);
#else
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
#endif
}
}
info.color=texture2D(textureSampler,projectedCoord.xy).rgb;
info.coords=vec4(projectedCoord.xy,sampledDepth,0.0);
return info;
}
vec3 hash(vec3 a)
{
a=fract(a*0.8);
a+=dot(a,a.yxz+19.19);
return fract((a.xxy+a.yxx)*a.zyx);
}
void main()
{
#ifdef SSR_SUPPORTED

vec4 albedoFull=texture2D(textureSampler,vUV);
vec3 albedo=albedoFull.rgb;
float spec=texture2D(reflectivitySampler,vUV).r;
if (spec == 0.0) {
gl_FragColor=albedoFull;
return;
}

#ifdef PREPASS_LAYOUT
vec3 normal=(texture2D(normalSampler,vUV)).gba;
#else
vec3 normal=(texture2D(normalSampler,vUV)).xyz;
#endif
vec3 position=(view*texture2D(positionSampler,vUV)).xyz;
vec3 reflected=normalize(reflect(normalize(position),normalize(normal)));
float roughness=1.0-texture2D(reflectivitySampler,vUV).a;
vec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;
ReflectionInfo info=getReflectionInfo(jitt+reflected,position);

vec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));
float screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);

vec3 F0=vec3(0.04);
F0=mix(F0,albedo,spec);
vec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);

float reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);
float albedoMultiplier=1.0-reflectionMultiplier;
vec3 SSR=info.color*fresnel;
gl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),albedoFull.a);
#else
gl_FragColor=texture2D(textureSampler,vUV);
#endif
}
`;We.a.ShadersStore.screenSpaceReflectionPixelShader=PL;var qm=function(i){function t(e,n,r,o,l,h,v,b,A,D){b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),A===void 0&&(A=!1),D===void 0&&(D=!0);var N=i.call(this,e,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","step","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],r,o,l,h,v,`#define SSR_SUPPORTED
#define REFLECTION_SAMPLES 64
#define SMOOTH_STEPS 5
`,b,void 0,null,A)||this;if(N.threshold=1.2,N.strength=1,N.reflectionSpecularFalloffExponent=3,N.step=1,N.roughnessFactor=.2,N._forceGeometryBuffer=!1,N._enableSmoothReflections=!1,N._reflectionSamples=64,N._smoothSteps=5,N._forceGeometryBuffer=D,N._forceGeometryBuffer){var j=n.enableGeometryBufferRenderer();j&&j.isSupported&&(j.enablePosition=!0,j.enableReflectivity=!0,N._geometryBufferRenderer=j)}else N._prePassRenderer=n.enablePrePassRenderer(),N._prePassRenderer.markAsDirty(),N._prePassEffectConfiguration=new xL;return N._updateEffectDefines(),N.onApply=function(k){var H=N._geometryBufferRenderer,J=N._prePassRenderer;if(J||H){if(H){var te=H.getTextureIndex(_i.POSITION_TEXTURE_TYPE),oe=H.getTextureIndex(_i.REFLECTIVITY_TEXTURE_TYPE);k.setTexture("normalSampler",H.getGBuffer().textures[1]),k.setTexture("positionSampler",H.getGBuffer().textures[te]),k.setTexture("reflectivitySampler",H.getGBuffer().textures[oe])}else{te=J.getIndex(g.a.PREPASS_POSITION_TEXTURE_TYPE),oe=J.getIndex(g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE);var ce=J.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE);k.setTexture("normalSampler",J.prePassRT.textures[ce]),k.setTexture("positionSampler",J.prePassRT.textures[te]),k.setTexture("reflectivitySampler",J.prePassRT.textures[oe])}var he=n.activeCamera;if(he){var _e=he.getViewMatrix(),ye=he.getProjectionMatrix();k.setMatrix("projection",ye),k.setMatrix("view",_e),k.setFloat("threshold",N.threshold),k.setFloat("reflectionSpecularFalloffExponent",N.reflectionSpecularFalloffExponent),k.setFloat("strength",N.strength),k.setFloat("step",N.step),k.setFloat("roughnessFactor",N.roughnessFactor)}}},N}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceReflectionPostProcess"},Object.defineProperty(t.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(e){e!==this._enableSmoothReflections&&(this._enableSmoothReflections=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(e){e!==this._reflectionSamples&&(this._reflectionSamples=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(e){e!==this._smoothSteps&&(this._smoothSteps=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),t.prototype._updateEffectDefines=function(){var e=[];(this._geometryBufferRenderer||this._prePassRenderer)&&(e.push("#define SSR_SUPPORTED"),this._prePassRenderer&&e.push("#define PREPASS_LAYOUT")),this._enableSmoothReflections&&e.push("#define ENABLE_SMOOTH_REFLECTIONS"),e.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),e.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(e.join(`
`))},t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"threshold",void 0),Object(_.c)([Object(V.c)()],t.prototype,"strength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"reflectionSpecularFalloffExponent",void 0),Object(_.c)([Object(V.c)()],t.prototype,"step",void 0),Object(_.c)([Object(V.c)()],t.prototype,"roughnessFactor",void 0),Object(_.c)([Object(V.c)()],t.prototype,"enableSmoothReflections",null),Object(_.c)([Object(V.c)()],t.prototype,"reflectionSamples",null),Object(_.c)([Object(V.c)()],t.prototype,"smoothSteps",null),t}(bt);M.a.RegisteredTypes["BABYLON.ScreenSpaceReflectionPostProcess"]=qm;var AL=`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
#include<packingFunctions>
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
#ifndef AUTO_EXPOSURE
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
#endif
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`;We.a.ShadersStore.standardPixelShader=AL;var uE=function(i){function t(e,n,r,o,l){o===void 0&&(o=null);var h=i.call(this,n.getEngine(),e)||this;return h.downSampleX4PostProcess=null,h.brightPassPostProcess=null,h.blurHPostProcesses=[],h.blurVPostProcesses=[],h.textureAdderPostProcess=null,h.volumetricLightPostProcess=null,h.volumetricLightSmoothXPostProcess=null,h.volumetricLightSmoothYPostProcess=null,h.volumetricLightMergePostProces=null,h.volumetricLightFinalPostProcess=null,h.luminancePostProcess=null,h.luminanceDownSamplePostProcesses=[],h.hdrPostProcess=null,h.textureAdderFinalPostProcess=null,h.lensFlareFinalPostProcess=null,h.hdrFinalPostProcess=null,h.lensFlarePostProcess=null,h.lensFlareComposePostProcess=null,h.motionBlurPostProcess=null,h.depthOfFieldPostProcess=null,h.fxaaPostProcess=null,h.screenSpaceReflectionPostProcess=null,h.brightThreshold=1,h.blurWidth=512,h.horizontalBlur=!1,h.lensTexture=null,h.volumetricLightCoefficient=.2,h.volumetricLightPower=4,h.volumetricLightBlurScale=64,h.sourceLight=null,h.hdrMinimumLuminance=1,h.hdrDecreaseRate=.5,h.hdrIncreaseRate=.5,h.lensColorTexture=null,h.lensFlareStrength=20,h.lensFlareGhostDispersal=1.4,h.lensFlareHaloWidth=.7,h.lensFlareDistortionStrength=16,h.lensFlareBlurWidth=512,h.lensStarTexture=null,h.lensFlareDirtTexture=null,h.depthOfFieldDistance=10,h.depthOfFieldBlurWidth=64,h.animations=[],h._currentDepthOfFieldSource=null,h._fixedExposure=1,h._currentExposure=1,h._hdrAutoExposure=!1,h._hdrCurrentLuminance=1,h._motionStrength=1,h._isObjectBasedMotionBlur=!1,h._camerasToBeAttached=[],h._bloomEnabled=!1,h._depthOfFieldEnabled=!1,h._vlsEnabled=!1,h._lensFlareEnabled=!1,h._hdrEnabled=!1,h._motionBlurEnabled=!1,h._fxaaEnabled=!1,h._screenSpaceReflectionsEnabled=!1,h._motionBlurSamples=64,h._volumetricLightStepsCount=50,h._samples=1,h._cameras=l||n.cameras,h._cameras=h._cameras.slice(),h._camerasToBeAttached=h._cameras.slice(),h._scene=n,h._basePostProcess=o,h._ratio=r,h._floatTextureType=n.getEngine().getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT,n.postProcessRenderPipelineManager.addPipeline(h),h._buildPipeline(),h}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var n=["#define HDR"];e&&n.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(n.join(`
`))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(e){this._motionStrength=e,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(e){var n=this._isObjectBasedMotionBlur!==e;this._isObjectBasedMotionBlur=e,n&&this._buildPipeline()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e&&!this._scene.enableGeometryBufferRenderer())return void p.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(e){this._screenSpaceReflectionsEnabled!==e&&(this._screenSpaceReflectionsEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=e:this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+e.toFixed(1))),this._motionBlurSamples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,n=this._ratio,r=this._scene;this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new qm("HDRPass",r,n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.screenSpaceReflectionPostProcess}),this.addEffect(new Bt(r.getEngine(),"HDRScreenSpaceReflections",function(){return e.screenSpaceReflectionPostProcess},!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new bt("HDRPass","standard",[],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add(function(){e._currentDepthOfFieldSource=e.originalPostProcess}),this.addEffect(new Bt(r.getEngine(),"HDRPassPostProcess",function(){return e.originalPostProcess},!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(r,n/4),this._createBrightPassPostProcess(r,n/4),this._createBlurPostProcesses(r,n/4,1),this._createTextureAdderPostProcess(r,n),this.textureAdderFinalPostProcess=new bt("HDRDepthOfFieldSource","standard",[],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(r.getEngine(),"HDRBaseDepthOfFieldSource",function(){return e.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(r,n),this.volumetricLightFinalPostProcess=new bt("HDRVLSFinal","standard",[],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(r.getEngine(),"HDRVLSFinal",function(){return e.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(r,n),this.lensFlareFinalPostProcess=new bt("HDRPostLensFlareDepthOfFieldSource","standard",[],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(r.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return e.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(r,this._floatTextureType),this._createHdrPostProcess(r,n),this.hdrFinalPostProcess=new bt("HDRPostHDReDepthOfFieldSource","standard",[],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(r.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return e.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(r,n/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(r,n)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(r,n),this._fxaaEnabled&&(this.fxaaPostProcess=new bl("fxaa",1,null,Ve.a.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(r.getEngine(),"HDRFxaa",function(){return e.fxaaPostProcess},!0))),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,n){var r=this,o=new Array(32);this.downSampleX4PostProcess=new bt("HDRDownSampleX4","standard",["dsOffsets"],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(l){for(var h=0,v=r.downSampleX4PostProcess.width,b=r.downSampleX4PostProcess.height,A=-2;A<2;A++)for(var D=-2;D<2;D++)o[h]=(A+.5)*(1/v),o[h+1]=(D+.5)*(1/b),h+=2;l.setArray2("dsOffsets",o)},this.addEffect(new Bt(e.getEngine(),"HDRDownSampleX4",function(){return r.downSampleX4PostProcess},!0))},t.prototype._createBrightPassPostProcess=function(e,n){var r=this,o=new Array(8);this.brightPassPostProcess=new bt("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(l){var h=1/r.brightPassPostProcess.width,v=1/r.brightPassPostProcess.height;o[0]=-.5*h,o[1]=.5*v,o[2]=.5*h,o[3]=.5*v,o[4]=-.5*h,o[5]=-.5*v,o[6]=.5*h,o[7]=-.5*v,l.setArray2("dsOffsets",o),l.setFloat("brightThreshold",r.brightThreshold)},this.addEffect(new Bt(e.getEngine(),"HDRBrightPass",function(){return r.brightPassPostProcess},!0))},t.prototype._createBlurPostProcesses=function(e,n,r,o){var l=this;o===void 0&&(o="blurWidth");var h=e.getEngine(),v=new Yn("HDRBlurH_"+r,new d.d(1,0),this[o],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType),b=new Yn("HDRBlurV_"+r,new d.d(0,1),this[o],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType);v.onActivateObservable.add(function(){var A=v.width/h.getRenderWidth();v.kernel=l[o]*A}),b.onActivateObservable.add(function(){var A=b.height/h.getRenderHeight();b.kernel=l.horizontalBlur?64*A:l[o]*A}),this.addEffect(new Bt(e.getEngine(),"HDRBlurH"+r,function(){return v},!0)),this.addEffect(new Bt(e.getEngine(),"HDRBlurV"+r,function(){return b},!0)),this.blurHPostProcesses.push(v),this.blurVPostProcesses.push(b)},t.prototype._createTextureAdderPostProcess=function(e,n){var r=this;this.textureAdderPostProcess=new bt("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._vlsEnabled?r._currentDepthOfFieldSource:r.originalPostProcess),o.setTexture("lensSampler",r.lensTexture),o.setFloat("exposure",r._currentExposure),r._currentDepthOfFieldSource=r.textureAdderFinalPostProcess},this.addEffect(new Bt(e.getEngine(),"HDRTextureAdder",function(){return r.textureAdderPostProcess},!0))},t.prototype._createVolumetricLightPostProcess=function(e,n){var r=this,o=e.enableGeometryBufferRenderer();o.enablePosition=!0;var l=o.getGBuffer();this.volumetricLightPostProcess=new bt("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],n/8,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var h=d.d.Zero();this.volumetricLightPostProcess.onApply=function(v){if(r.sourceLight&&r.sourceLight.getShadowGenerator()&&r._scene.activeCamera){var b=r.sourceLight.getShadowGenerator();v.setTexture("shadowMapSampler",b.getShadowMap()),v.setTexture("positionSampler",l.textures[2]),v.setColor3("sunColor",r.sourceLight.diffuse),v.setVector3("sunDirection",r.sourceLight.getShadowDirection()),v.setVector3("cameraPosition",r._scene.activeCamera.globalPosition),v.setMatrix("shadowViewProjection",b.getTransformMatrix()),v.setFloat("scatteringCoefficient",r.volumetricLightCoefficient),v.setFloat("scatteringPower",r.volumetricLightPower),h.x=r.sourceLight.getDepthMinZ(r._scene.activeCamera),h.y=r.sourceLight.getDepthMaxZ(r._scene.activeCamera),v.setVector2("depthValues",h)}},this.addEffect(new Bt(e.getEngine(),"HDRVLS",function(){return r.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(e,n/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new bt("HDRVLSMerge","standard",[],["originalSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(v){v.setTextureFromPostProcess("originalSampler",r._bloomEnabled?r.textureAdderFinalPostProcess:r.originalPostProcess),r._currentDepthOfFieldSource=r.volumetricLightFinalPostProcess},this.addEffect(new Bt(e.getEngine(),"HDRVLSMerge",function(){return r.volumetricLightMergePostProces},!0))},t.prototype._createLuminancePostProcesses=function(e,n){var r=this,o=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new bt("HDRLuminance","standard",["lumOffsets"],[],{width:o,height:o},null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",n);var l=[];this.luminancePostProcess.onApply=function(D){var N=1/r.luminancePostProcess.width,j=1/r.luminancePostProcess.height;l[0]=-.5*N,l[1]=.5*j,l[2]=.5*N,l[3]=.5*j,l[4]=-.5*N,l[5]=-.5*j,l[6]=.5*N,l[7]=-.5*j,D.setArray2("lumOffsets",l)},this.addEffect(new Bt(e.getEngine(),"HDRLuminance",function(){return r.luminancePostProcess},!0));for(var h=t.LuminanceSteps-1;h>=0;h--){o=Math.pow(3,h);var v=`#define LUMINANCE_DOWN_SAMPLE
`;h===0&&(v+="#define FINAL_DOWN_SAMPLER");var b=new bt("HDRLuminanceDownSample"+h,"standard",["dsOffsets","halfDestPixelSize"],[],{width:o,height:o},null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,v,n);this.luminanceDownSamplePostProcesses.push(b)}var A=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(D,N){var j=new Array(18);D.onApply=function(k){if(A){for(var H=0,J=-1;J<2;J++)for(var te=-1;te<2;te++)j[H]=J/A.width,j[H+1]=te/A.height,H+=2;k.setArray2("dsOffsets",j),k.setFloat("halfDestPixelSize",.5/A.width),A=N===r.luminanceDownSamplePostProcesses.length-1?r.luminancePostProcess:D}},N===r.luminanceDownSamplePostProcesses.length-1&&(D.onAfterRender=function(){var k=e.getEngine().readPixels(0,0,1,1),H=new d.f(1/16581375,1/65025,1/255,1);r._hdrCurrentLuminance=(k[0]*H.x+k[1]*H.y+k[2]*H.z+k[3]*H.w)/100}),r.addEffect(new Bt(e.getEngine(),"HDRLuminanceDownSample"+N,function(){return D},!0))})},t.prototype._createHdrPostProcess=function(e,n){var r=this,o=["#define HDR"];this._hdrAutoExposure&&o.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new bt("HDR","standard",["averageLuminance"],["textureAdderSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,o.join(`
`),g.a.TEXTURETYPE_UNSIGNED_INT);var l=1,h=0,v=0;this.hdrPostProcess.onApply=function(b){if(b.setTextureFromPostProcess("textureAdderSampler",r._currentDepthOfFieldSource),h+=e.getEngine().getDeltaTime(),l<0)l=r._hdrCurrentLuminance;else{var A=(v-h)/1e3;r._hdrCurrentLuminance<l+r.hdrDecreaseRate*A?l+=r.hdrDecreaseRate*A:r._hdrCurrentLuminance>l-r.hdrIncreaseRate*A?l-=r.hdrIncreaseRate*A:l=r._hdrCurrentLuminance}r.hdrAutoExposure?r._currentExposure=r._fixedExposure/l:(l=se.a.Clamp(l,r.hdrMinimumLuminance,1e20),b.setFloat("averageLuminance",l)),v=h,r._currentDepthOfFieldSource=r.hdrFinalPostProcess},this.addEffect(new Bt(e.getEngine(),"HDR",function(){return r.hdrPostProcess},!0))},t.prototype._createLensFlarePostProcess=function(e,n){var r=this;this.lensFlarePostProcess=new bt("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],n/2,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(e.getEngine(),"HDRLensFlare",function(){return r.lensFlarePostProcess},!0)),this._createBlurPostProcesses(e,n/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new bt("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Bt(e.getEngine(),"HDRLensFlareCompose",function(){return r.lensFlareComposePostProcess},!0));var o=new d.d(0,0);this.lensFlarePostProcess.onApply=function(v){v.setTextureFromPostProcess("textureSampler",r._bloomEnabled?r.blurHPostProcesses[0]:r.originalPostProcess),v.setTexture("lensColorSampler",r.lensColorTexture),v.setFloat("strength",r.lensFlareStrength),v.setFloat("ghostDispersal",r.lensFlareGhostDispersal),v.setFloat("haloWidth",r.lensFlareHaloWidth),o.x=r.lensFlarePostProcess.width,o.y=r.lensFlarePostProcess.height,v.setVector2("resolution",o),v.setFloat("distortionStrength",r.lensFlareDistortionStrength)};var l=d.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),h=d.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(v){if(r._scene.activeCamera){v.setTextureFromPostProcess("otherSampler",r.lensFlarePostProcess),v.setTexture("lensDirtSampler",r.lensFlareDirtTexture),v.setTexture("lensStarSampler",r.lensStarTexture);var b=r._scene.activeCamera.getViewMatrix().getRow(0),A=r._scene.activeCamera.getViewMatrix().getRow(2),D=d.e.Dot(b.toVector3(),new d.e(1,0,0))+d.e.Dot(A.toVector3(),new d.e(0,0,1));D*=4;var N=d.a.FromValues(.5*Math.cos(D),-Math.sin(D),0,0,Math.sin(D),.5*Math.cos(D),0,0,0,0,1,0,0,0,0,1),j=h.multiply(N).multiply(l);v.setMatrix("lensStarMatrix",j),r._currentDepthOfFieldSource=r.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,n){var r=this;this.depthOfFieldPostProcess=new bt("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",g.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(o){o.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),o.setTexture("depthSampler",r._getDepthTexture()),o.setFloat("distance",r.depthOfFieldDistance)},this.addEffect(new Bt(e.getEngine(),"HDRDepthOfField",function(){return r.depthOfFieldPostProcess},!0))},t.prototype._createMotionBlurPostProcess=function(e,n){var r=this;if(this._isObjectBasedMotionBlur){var o=new Km("HDRMotionBlur",e,n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT);o.motionStrength=this.motionStrength,o.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=o}else{this.motionBlurPostProcess=new bt("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],n,null,Ve.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),g.a.TEXTURETYPE_UNSIGNED_INT);var l=0,h=d.a.Identity(),v=d.a.Identity(),b=d.a.Identity(),A=d.d.Zero();this.motionBlurPostProcess.onApply=function(D){(b=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(v),D.setMatrix("inverseViewProjection",v),D.setMatrix("prevViewProjection",h),h=b,A.x=r.motionBlurPostProcess.width,A.y=r.motionBlurPostProcess.height,D.setVector2("screenSize",A),l=e.getEngine().getFps()/60,D.setFloat("motionScale",l),D.setFloat("motionStrength",r.motionStrength),D.setTexture("depthSampler",r._getDepthTexture())}}this.addEffect(new Bt(e.getEngine(),"HDRMotionBlur",function(){return r.motionBlurPostProcess},!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(n),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(n),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(n),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(n),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(n),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(n),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(n),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(n),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(n),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(n),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(n),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(n);for(var r=0;r<this.luminanceDownSamplePostProcesses.length;r++)this.luminanceDownSamplePostProcesses[r].dispose(n);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(n),this.hdrPostProcess&&this.hdrPostProcess.dispose(n),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(n),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(n),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(n),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(n),r=0;r<this.blurHPostProcesses.length;r++)this.blurHPostProcesses[r].dispose(n);for(r=0;r<this.blurVPostProcesses.length;r++)this.blurVPostProcesses[r].dispose(n)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),i.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=V.a.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(e.screenSpaceReflectionPostProcess=V.a.Serialize(this.screenSpaceReflectionPostProcess)),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,n,r){var o=V.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r);return e.sourceLightId&&(o.sourceLight=n.getLightByID(e.sourceLightId)),e.screenSpaceReflectionPostProcess&&V.a.Parse(function(){return o.screenSpaceReflectionPostProcess},e.screenSpaceReflectionPostProcess,n,r),o},t.LuminanceSteps=6,Object(_.c)([Object(V.c)()],t.prototype,"brightThreshold",void 0),Object(_.c)([Object(V.c)()],t.prototype,"blurWidth",void 0),Object(_.c)([Object(V.c)()],t.prototype,"horizontalBlur",void 0),Object(_.c)([Object(V.c)()],t.prototype,"exposure",null),Object(_.c)([Object(V.m)("lensTexture")],t.prototype,"lensTexture",void 0),Object(_.c)([Object(V.c)()],t.prototype,"volumetricLightCoefficient",void 0),Object(_.c)([Object(V.c)()],t.prototype,"volumetricLightPower",void 0),Object(_.c)([Object(V.c)()],t.prototype,"volumetricLightBlurScale",void 0),Object(_.c)([Object(V.c)()],t.prototype,"hdrMinimumLuminance",void 0),Object(_.c)([Object(V.c)()],t.prototype,"hdrDecreaseRate",void 0),Object(_.c)([Object(V.c)()],t.prototype,"hdrIncreaseRate",void 0),Object(_.c)([Object(V.c)()],t.prototype,"hdrAutoExposure",null),Object(_.c)([Object(V.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lensFlareStrength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lensFlareGhostDispersal",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lensFlareHaloWidth",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lensFlareDistortionStrength",void 0),Object(_.c)([Object(V.c)()],t.prototype,"lensFlareBlurWidth",void 0),Object(_.c)([Object(V.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),Object(_.c)([Object(V.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),Object(_.c)([Object(V.c)()],t.prototype,"depthOfFieldDistance",void 0),Object(_.c)([Object(V.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),Object(_.c)([Object(V.c)()],t.prototype,"motionStrength",null),Object(_.c)([Object(V.c)()],t.prototype,"objectBasedMotionBlur",null),Object(_.c)([Object(V.c)()],t.prototype,"_ratio",void 0),Object(_.c)([Object(V.c)()],t.prototype,"BloomEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"DepthOfFieldEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"LensFlareEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"HDREnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"VLSEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"MotionBlurEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"fxaaEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"screenSpaceReflectionsEnabled",null),Object(_.c)([Object(V.c)()],t.prototype,"volumetricLightStepsCount",null),Object(_.c)([Object(V.c)()],t.prototype,"motionBlurSamples",null),Object(_.c)([Object(V.c)()],t.prototype,"samples",null),t}(Is);M.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=uE;var CL=`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamA;
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
useCamA=!useCamB;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
#ifdef IS_STEREOSCOPIC_INTERLACED
float rowNum=floor(vUV.y/stepSize.y);
useCamA=mod(rowNum,2.0) == 1.0;
useCamB=mod(rowNum,2.0) == 0.0;
texCoord1=vec2(vUV.x,vUV.y);
texCoord2=vec2(vUV.x,vUV.y);
#else
useCamB=vUV.y>0.5;
useCamA=!useCamB;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else if (useCamA){
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}else {
discard;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}
`;We.a.ShadersStore.stereoscopicInterlacePixelShader=CL;var RL=function(i){function t(e,n,r,o,l,h,v){var b=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],l,h,v,o?"#define IS_STEREOSCOPIC_INTERLACED 1":r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return b._passedProcess=n[0]._rigPostProcess,b._stepSize=new d.d(1/b.width,1/b.height),b.onSizeChangedObservable.add(function(){b._stepSize=new d.d(1/b.width,1/b.height)}),b.onApplyObservable.add(function(A){A.setTextureFromPostProcess("camASampler",b._passedProcess),A.setFloat2("stepSize",b._stepSize.x,b._stepSize.y)}),b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcessI"},t}(bt),OL=function(i){function t(e,n,r,o,l,h){var v=i.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],o,l,h,r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return v._passedProcess=n[0]._rigPostProcess,v._stepSize=new d.d(1/v.width,1/v.height),v.onSizeChangedObservable.add(function(){v._stepSize=new d.d(1/v.width,1/v.height)}),v.onApplyObservable.add(function(b){b.setTextureFromPostProcess("camASampler",v._passedProcess),b.setFloat2("stepSize",v._stepSize.x,v._stepSize.y)}),v}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcess"},t}(bt),ML=`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb);
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm);
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`;We.a.ShadersStore.tonemapPixelShader=ML;var Ma;(function(i){i[i.Hable=0]="Hable",i[i.Reinhard=1]="Reinhard",i[i.HejiDawson=2]="HejiDawson",i[i.Photographic=3]="Photographic"})(Ma||(Ma={}));var IL=function(i){function t(e,n,r,o,l,h,v){l===void 0&&(l=g.a.TEXTURE_BILINEAR_SAMPLINGMODE),v===void 0&&(v=g.a.TEXTURETYPE_UNSIGNED_INT);var b=i.call(this,e,"tonemap",["_ExposureAdjustment"],null,1,o,l,h,!0,null,v)||this;b._operator=n,b.exposureAdjustment=r;var A="#define ";return b._operator===Ma.Hable?A+="HABLE_TONEMAPPING":b._operator===Ma.Reinhard?A+="REINHARD_TONEMAPPING":b._operator===Ma.HejiDawson?A+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":b._operator===Ma.Photographic&&(A+="PHOTOGRAPHIC_TONEMAPPING"),b.updateEffect(A),b.onApply=function(D){D.setFloat("_ExposureAdjustment",b.exposureAdjustment)},b}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"TonemapPostProcess"},t}(bt),DL=`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`;We.a.ShadersStore.volumetricLightScatteringPixelShader=DL;var wL=`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}
`;We.a.ShadersStore.volumetricLightScatteringPassVertexShader=wL;var LL=`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`;We.a.ShadersStore.volumetricLightScatteringPassPixelShader=LL;var hE=function(i){function t(e,n,r,o,l,h,v,b,A){l===void 0&&(l=100),h===void 0&&(h=Ve.a.BILINEAR_SAMPLINGMODE);var D=i.call(this,e,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],n.postProcessRatio||n,r,h,v,b,"#define NUM_SAMPLES "+l)||this;return D._screenCoordinates=d.d.Zero(),D.customMeshPosition=d.e.Zero(),D.useCustomMeshPosition=!1,D.invert=!0,D.excludedMeshes=new Array,D.exposure=.3,D.decay=.96815,D.weight=.58767,D.density=.926,v=(A=r===null?A:r.getScene()).getEngine(),D._viewPort=new $r.a(0,0,1,1).toGlobal(v.getRenderWidth(),v.getRenderHeight()),D.mesh=o!==null?o:t.CreateDefaultMesh("VolumetricLightScatteringMesh",A),D._createPass(A,n.passRatio||n),D.onActivate=function(N){D.isSupported||D.dispose(N),D.onActivate=null},D.onApplyObservable.add(function(N){D._updateMeshScreenCoordinates(A),N.setTexture("lightScatteringSampler",D._volumetricLightScatteringRTT),N.setFloat("exposure",D.exposure),N.setFloat("decay",D.decay),N.setFloat("weight",D.weight),N.setFloat("density",D.density),N.setVector2("meshPositionOnScreen",D._screenCoordinates)}),D}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,n){var r=e.getMesh();if(r===this.mesh&&r.material)return r.material.isReady(r);var o=[],l=[Me.b.PositionKind],h=e.getMaterial();h&&(h.needAlphaTesting()&&o.push("#define ALPHATEST"),r.isVerticesDataPresent(Me.b.UVKind)&&(l.push(Me.b.UVKind),o.push("#define UV1")),r.isVerticesDataPresent(Me.b.UV2Kind)&&(l.push(Me.b.UV2Kind),o.push("#define UV2"))),r.useBones&&r.computeBonesUsingShaders?(l.push(Me.b.MatricesIndicesKind),l.push(Me.b.MatricesWeightsKind),o.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),o.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):o.push("#define NUM_BONE_INFLUENCERS 0"),n&&(o.push("#define INSTANCES"),ot.a.PushAttributesForInstances(l),e.getRenderingMesh().hasThinInstances&&o.push("#define THIN_INSTANCES"));var v=o.join(`
`);return this._cachedDefines!==v&&(this._cachedDefines=v,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect("volumetricLightScatteringPass",l,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],v,void 0,void 0,void 0,{maxSimultaneousMorphTargets:r.numBoneInfluencers})),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(e){var n=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);n!==-1&&e.getScene().customRenderTargets.splice(n,1),this._volumetricLightScatteringRTT.dispose(),i.prototype.dispose.call(this,e)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1},t.prototype._createPass=function(e,n){var r=this,o=e.getEngine();this._volumetricLightScatteringRTT=new Un("volumetricLightScatteringMap",{width:o.getRenderWidth()*n,height:o.getRenderHeight()*n},e,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=Ve.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var l=this.getCamera();l?l.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var h,v=function(A){var D=A.getRenderingMesh(),N=A.getEffectiveMesh();if(!r._meshExcluded(D)){N._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var j=A.getMaterial();if(j){var k=D.getScene(),H=k.getEngine();H.setState(j.backFaceCulling);var J=D._getInstancesRenderList(A._id,!!A.getReplacementMesh());if(!J.mustReturn){var te=H.getCaps().instancedArrays&&(J.visibleInstances[A._id]!==null||D.hasThinInstances);if(r._isReady(A,te)){var oe=r._volumetricLightScatteringPass;if(D===r.mesh&&(oe=A.effect?A.effect:j.getEffect()),H.enableEffect(oe),D._bind(A,oe,j.fillMode),D===r.mesh)j.bind(N.getWorldMatrix(),D);else{if(r._volumetricLightScatteringPass.setMatrix("viewProjection",k.getTransformMatrix()),j&&j.needAlphaTesting()){var ce=j.getAlphaTestTexture();r._volumetricLightScatteringPass.setTexture("diffuseSampler",ce),ce&&r._volumetricLightScatteringPass.setMatrix("diffuseMatrix",ce.getTextureMatrix())}D.useBones&&D.computeBonesUsingShaders&&D.skeleton&&r._volumetricLightScatteringPass.setMatrices("mBones",D.skeleton.getTransformMatrices(D))}D._processRendering(N,A,r._volumetricLightScatteringPass,nn.a.TriangleFillMode,J,te,function(he,_e){return oe.setMatrix("world",_e)})}}}}},b=new x.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){h=e.clearColor,e.clearColor=b}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){e.clearColor=h}),this._volumetricLightScatteringRTT.customRenderFunction=function(A,D,N,j){var k,H=e.getEngine();if(j.length){for(H.setColorWrite(!1),k=0;k<j.length;k++)v(j.data[k]);H.setColorWrite(!0)}for(k=0;k<A.length;k++)v(A.data[k]);for(k=0;k<D.length;k++)v(D.data[k]);if(N.length){for(k=0;k<N.length;k++){var J=N.data[k],te=J.getBoundingInfo();te&&e.activeCamera&&(J._alphaIndex=J.getMesh().alphaIndex,J._distanceToCamera=te.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var oe=N.data.slice(0,N.length);for(oe.sort(function(ce,he){return ce._alphaIndex>he._alphaIndex?1:ce._alphaIndex<he._alphaIndex?-1:ce._distanceToCamera<he._distanceToCamera?1:ce._distanceToCamera>he._distanceToCamera?-1:0}),H.setAlphaMode(g.a.ALPHA_COMBINE),k=0;k<oe.length;k++)v(oe[k]);H.setAlphaMode(g.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(e){var n,r=e.getTransformMatrix();n=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var o=d.e.Project(n,d.a.Identity(),r,this._viewPort);this._screenCoordinates.x=o.x/this._viewPort.width,this._screenCoordinates.y=o.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,n){var r=Ne.a.CreatePlane(e,1,n);r.billboardMode=Lt.a.BILLBOARDMODE_ALL;var o=new Qt.a(e+"Material",n);return o.emissiveColor=new x.a(1,1,1),r.material=o,r},Object(_.c)([Object(V.o)()],t.prototype,"customMeshPosition",void 0),Object(_.c)([Object(V.c)()],t.prototype,"useCustomMeshPosition",void 0),Object(_.c)([Object(V.c)()],t.prototype,"invert",void 0),Object(_.c)([Object(V.k)()],t.prototype,"mesh",void 0),Object(_.c)([Object(V.c)()],t.prototype,"excludedMeshes",void 0),Object(_.c)([Object(V.c)()],t.prototype,"exposure",void 0),Object(_.c)([Object(V.c)()],t.prototype,"decay",void 0),Object(_.c)([Object(V.c)()],t.prototype,"weight",void 0),Object(_.c)([Object(V.c)()],t.prototype,"density",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.VolumetricLightScatteringPostProcess"]=hE;var NL=`

precision highp float;

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D normalSampler;
uniform float curvature_ridge;
uniform float curvature_valley;
#ifndef CURVATURE_OFFSET
#define CURVATURE_OFFSET 1
#endif
float curvature_soft_clamp(float curvature,float control)
{
if (curvature<0.5/control)
return curvature*(1.0-curvature*control);
return 0.25/control;
}
float calculate_curvature(ivec2 texel,float ridge,float valley)
{
vec2 normal_up=texelFetchOffset(normalSampler,texel,0,ivec2(0,CURVATURE_OFFSET)).rb;
vec2 normal_down=texelFetchOffset(normalSampler,texel,0,ivec2(0,-CURVATURE_OFFSET)).rb;
vec2 normal_left=texelFetchOffset(normalSampler,texel,0,ivec2(-CURVATURE_OFFSET,0)).rb;
vec2 normal_right=texelFetchOffset(normalSampler,texel,0,ivec2( CURVATURE_OFFSET,0)).rb;
float normal_diff=((normal_up.g-normal_down.g)+(normal_right.r-normal_left.r));
if (normal_diff<0.0)
return -2.0*curvature_soft_clamp(-normal_diff,valley);
return 2.0*curvature_soft_clamp(normal_diff,ridge);
}
void main(void)
{
ivec2 texel=ivec2(gl_FragCoord.xy);
vec4 baseColor=texture2D(textureSampler,vUV);
float curvature=calculate_curvature(texel,curvature_ridge,curvature_valley);
baseColor.rgb*=curvature+1.0;
gl_FragColor=baseColor;
}`;We.a.ShadersStore.screenSpaceCurvaturePixelShader=NL;var dE=function(i){function t(e,n,r,o,l,h,v,b,A){b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT),A===void 0&&(A=!1);var D=i.call(this,e,"screenSpaceCurvature",["curvature_ridge","curvature_valley"],["textureSampler","normalSampler"],r,o,l,h,v,void 0,b,void 0,null,A)||this;return D.ridge=1,D.valley=1,D._geometryBufferRenderer=n.enableGeometryBufferRenderer(),D._geometryBufferRenderer?D.onApply=function(N){N.setFloat("curvature_ridge",.5/Math.max(D.ridge*D.ridge,1e-4)),N.setFloat("curvature_valley",.7/Math.max(D.valley*D.valley,1e-4));var j=D._geometryBufferRenderer.getGBuffer().textures[1];N.setTexture("normalSampler",j)}:p.a.Error("Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first."),D}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"ScreenSpaceCurvaturePostProcess"},Object.defineProperty(t,"IsSupported",{get:function(){var e=$.a.LastCreatedEngine;return!!e&&(e.webGLVersion>1||e.getCaps().drawBuffersExtension)},enumerable:!1,configurable:!0}),t._Parse=function(e,n,r,o){return V.a.Parse(function(){return new t(e.name,r,e.options,n,e.renderTargetSamplingMode,r.getEngine(),e.textureType,e.reusable)},e,r,o)},Object(_.c)([Object(V.c)()],t.prototype,"ridge",void 0),Object(_.c)([Object(V.c)()],t.prototype,"valley",void 0),t}(bt);M.a.RegisteredTypes["BABYLON.ScreenSpaceCurvaturePostProcess"]=dE,c(166),c(167),Object.defineProperty(ne.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(i){this._forceShowBoundingBoxes=i,i&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),ne.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new fE(this)),this._boundingBoxRenderer},Object.defineProperty(Lt.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(i){this._showBoundingBox=i,i&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var fE=function(){function i(t){this.name=ct.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new x.a(1,1,1),this.backColor=new x.a(.1,.1,.1),this.showBackLines=!0,this.onBeforeBoxRenderingObservable=new E.c,this.onAfterBoxRenderingObservable=new E.c,this.onResourcesReadyObservable=new E.c,this.enabled=!0,this.renderList=new In.a(32),this._vertexBuffers={},this._fillIndexBuffer=null,this._fillIndexData=null,this.scene=t,t._addComponent(this)}return i.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(ct.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._preActiveMeshStage.registerStep(ct.a.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh),this.scene._evaluateSubMeshStage.registerStep(ct.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(ct.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},i.prototype._evaluateSubMesh=function(t,e){if(t.showSubMeshesBoundingBox){var n=e.getBoundingInfo();n!=null&&(n.boundingBox._tag=t.renderingGroupId,this.renderList.push(n.boundingBox))}},i.prototype._preActiveMesh=function(t){if(t.showBoundingBox||this.scene.forceShowBoundingBoxes){var e=t.getBoundingInfo();e.boundingBox._tag=t.renderingGroupId,this.renderList.push(e.boundingBox)}},i.prototype._prepareResources=function(){if(!this._colorShader){this._colorShader=new vh.a("colorShader",this.scene,"color",{attributes:[Me.b.PositionKind],uniforms:["world","viewProjection","color"]}),this._colorShader.reservedDataStore={hidden:!0};var t=this.scene.getEngine(),e=_t.a.CreateBox({size:1});this._vertexBuffers[Me.b.PositionKind]=new Me.b(t,e.positions,Me.b.PositionKind,!1),this._createIndexBuffer(),this._fillIndexData=e.indices,this.onResourcesReadyObservable.notifyObservers(this)}},i.prototype._createIndexBuffer=function(){var t=this.scene.getEngine();this._indexBuffer=t.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},i.prototype.rebuild=function(){var t=this._vertexBuffers[Me.b.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.reset=function(){this.renderList.reset()},i.prototype.render=function(t){if(this.renderList.length!==0&&this.enabled&&(this._prepareResources(),this._colorShader.isReady())){var e=this.scene.getEngine();e.setDepthWrite(!1),this._colorShader._preBind();for(var n=0;n<this.renderList.length;n++){var r=this.renderList.data[n];if(r._tag===t){this.onBeforeBoxRenderingObservable.notifyObservers(r);var o=r.minimum,l=r.maximum.subtract(o),h=o.add(l.scale(.5)),v=d.a.Scaling(l.x,l.y,l.z).multiply(d.a.Translation(h.x,h.y,h.z)).multiply(r.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(nn.a.LineListDrawMode,0,24)),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(v),e.drawElementsType(nn.a.LineListDrawMode,0,24),this.onAfterBoxRenderingObservable.notifyObservers(r)}}this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0)}},i.prototype.renderOcclusionBoundingBox=function(t){if(this._prepareResources(),this._colorShader.isReady()&&t._boundingInfo){var e=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=e.createIndexBuffer(this._fillIndexData)),e.setDepthWrite(!1),e.setColorWrite(!1),this._colorShader._preBind();var n=t._boundingInfo.boundingBox,r=n.minimum,o=n.maximum.subtract(r),l=r.add(o.scale(.5)),h=d.a.Scaling(o.x,o.y,o.z).multiply(d.a.Translation(l.x,l.y,l.z)).multiply(n.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect()),e.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(h),e.drawElementsType(nn.a.TriangleFillMode,0,36),this._colorShader.unbind(),e.setDepthFunctionToLessOrEqual(),e.setDepthWrite(!0),e.setColorWrite(!0)}},i.prototype.dispose=function(){if(this._colorShader){this.onBeforeBoxRenderingObservable.clear(),this.onAfterBoxRenderingObservable.clear(),this.onResourcesReadyObservable.clear(),this.renderList.dispose(),this._colorShader.dispose();var t=this._vertexBuffers[Me.b.PositionKind];t&&(t.dispose(),this._vertexBuffers[Me.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer),this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}},i}();ne.a.prototype.enableDepthRenderer=function(i,t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!1),!(i=i||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[i.id]){var n=!!this.getEngine().getCaps().textureFloatRender,r=0;r=!this.getEngine().getCaps().textureHalfFloatRender||e&&n?n?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_BYTE:g.a.TEXTURETYPE_HALF_FLOAT,this._depthRenderer[i.id]=new fh(this,r,i,t)}return this._depthRenderer[i.id]},ne.a.prototype.disableDepthRenderer=function(i){(i=i||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[i.id]&&(this._depthRenderer[i.id].dispose(),delete this._depthRenderer[i.id])};var pE=function(){function i(t){this.name=ct.a.NAME_DEPTHRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(ct.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(ct.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){for(var t in this.scene._depthRenderer)this.scene._depthRenderer[t].dispose()},i.prototype._gatherRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&!n.useOnlyInActiveCamera&&t.push(n.getDepthMap())}},i.prototype._gatherActiveCameraRenderTargets=function(t){if(this.scene._depthRenderer)for(var e in this.scene._depthRenderer){var n=this.scene._depthRenderer[e];n.enabled&&n.useOnlyInActiveCamera&&this.scene.activeCamera.id===e&&t.push(n.getDepthMap())}},i}();fh._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_DEPTHRENDERER);t||(t=new pE(i),i._addComponent(t))},We.a.ShadersStore.linePixelShader=`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`;var FL=`#include<instancesDeclaration>

attribute vec3 position;
attribute vec4 normal;

uniform mat4 viewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
#include<instancesVertex>
mat4 worldViewProjection=viewProjection*finalWorld;
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`;We.a.ShadersStore.lineVertexShader=FL,Lt.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},Lt.a.prototype.enableEdgesRendering=function(i,t,e){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new Zm(this,i,t,!0,e),this},Object.defineProperty(Lt.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),fl.b.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new mE(this,i,t),this},fl.a.prototype.enableEdgesRendering=function(i,t){return i===void 0&&(i=.95),t===void 0&&(t=!1),fl.b.prototype.enableEdgesRendering.apply(this,arguments),this};var BL=function(){this.edges=new Array,this.edgesConnectedCount=0},Zm=function(){function i(t,e,n,r,o){var l,h=this;e===void 0&&(e=.95),n===void 0&&(n=!1),r===void 0&&(r=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._buffersForInstances={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this.customInstances=new In.a(32),this._source=t,this._checkVerticesInsteadOfIndices=n,this._options=o??null,this._epsilon=e,this._prepareRessources(),r&&((l=o==null?void 0:o.useAlternateEdgeFinder)===null||l===void 0||l?this._generateEdgesLinesAlternate():this._generateEdgesLines()),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){h._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){h.dispose()})}return Object.defineProperty(i.prototype,"linesPositions",{get:function(){return this._linesPositions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesNormals",{get:function(){return this._linesNormals},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"linesIndices",{get:function(){return this._linesIndices},enumerable:!1,configurable:!0}),i.GetShader=function(t){if(!t._edgeRenderLineShader){var e=new vh.a("lineShader",t,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"]});e.disableDepthWrite=!0,e.backFaceCulling=!1,t._edgeRenderLineShader=e}return t._edgeRenderLineShader},i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=i.GetShader(this._source.getScene()))},i.prototype._rebuild=function(){var t=this._buffers[Me.b.PositionKind];t&&t._rebuild(),(t=this._buffers[Me.b.NormalKind])&&t._rebuild();var e=this._source.getScene().getEngine();this._ib=e.createIndexBuffer(this._linesIndices)},i.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var t=this._buffers[Me.b.PositionKind];t&&(t.dispose(),this._buffers[Me.b.PositionKind]=null),(t=this._buffers[Me.b.NormalKind])&&(t.dispose(),this._buffers[Me.b.NormalKind]=null),this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(t,e,n,r,o){return t===n&&e===r||t===r&&e===n?0:t===r&&e===o||t===o&&e===r?1:t===o&&e===n||t===n&&e===o?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(t,e,n,r,o){var l=1e-10;return t.equalsWithEpsilon(n,l)&&e.equalsWithEpsilon(r,l)||t.equalsWithEpsilon(r,l)&&e.equalsWithEpsilon(n,l)?0:t.equalsWithEpsilon(r,l)&&e.equalsWithEpsilon(o,l)||t.equalsWithEpsilon(o,l)&&e.equalsWithEpsilon(r,l)?1:t.equalsWithEpsilon(o,l)&&e.equalsWithEpsilon(n,l)||t.equalsWithEpsilon(n,l)&&e.equalsWithEpsilon(o,l)?2:-1},i.prototype._checkEdge=function(t,e,n,r,o){var l;e===void 0?l=!0:l=d.e.Dot(n[t],n[e])<this._epsilon,l&&this.createLine(r,o,this._linesPositions.length/3)},i.prototype.createLine=function(t,e,n){this._linesPositions.push(t.x,t.y,t.z,t.x,t.y,t.z,e.x,e.y,e.z,e.x,e.y,e.z),this._linesNormals.push(e.x,e.y,e.z,-1,e.x,e.y,e.z,1,t.x,t.y,t.z,-1,t.x,t.y,t.z,1),this._linesIndices.push(n,n+1,n+2,n,n+2,n+3)},i.prototype._tessellateTriangle=function(t,e,n,r){var o=function(Ae,xe,Pe){Pe>=0&&xe.push(Pe);for(var Be=0;Be<Ae.length;++Be)xe.push(Ae[Be][0])},l=0;t[1].length>=t[0].length&&t[1].length>=t[2].length?l=1:t[2].length>=t[0].length&&t[2].length>=t[1].length&&(l=2);for(var h=0;h<3;++h)h===l?t[h].sort(function(Ae,xe){return Ae[1]<xe[1]?-1:Ae[1]>xe[1]?1:0}):t[h].sort(function(Ae,xe){return Ae[1]>xe[1]?-1:Ae[1]<xe[1]?1:0});var v=[],b=[];o(t[l],v,-1);for(var A=v.length,D=l+2;D>=l+1;--D)o(t[D%3],b,D!==l+2?r[n[e+(D+1)%3]]:-1);var N=b.length;n.push(r[n[e+l]],v[0],b[0]),n.push(r[n[e+(l+1)%3]],b[N-1],v[A-1]);for(var j=A<=N,k=j?A:N,H=j?N:A,J=j?A-1:N-1,te=j?0:1,oe=A+N-2,ce=0,he=0,_e=j?v:b,ye=j?b:v,Ee=0;oe-- >0;){te?n.push(_e[ce],ye[he]):n.push(ye[he],_e[ce]);var Oe=void 0;(Ee+=k)>=H&&ce<J?(Oe=_e[++ce],Ee-=H):Oe=ye[++he],n.push(Oe)}n[e+0]=n[n.length-3],n[e+1]=n[n.length-2],n[e+2]=n[n.length-1],n.length=n.length-3},i.prototype._generateEdgesLinesAlternate=function(){var t,e,n,r,o,l,h,v,b,A=this._source.getVerticesData(Me.b.PositionKind),D=this._source.getIndices();if(D&&A){Array.isArray(D)||(D=Qe.b.SliceToArray(D));var N=(e=(t=this._options)===null||t===void 0?void 0:t.useFastVertexMerger)===null||e===void 0||e,j=N?Math.round(-Math.log((r=(n=this._options)===null||n===void 0?void 0:n.epsilonVertexMerge)!==null&&r!==void 0?r:1e-6)/Math.log(10)):(l=(o=this._options)===null||o===void 0?void 0:o.epsilonVertexMerge)!==null&&l!==void 0?l:1e-6,k=[],H=[];if(N)for(var J={},te=0;te<A.length;te+=3){var oe=A[te+0],ce=A[te+1],he=A[te+2];if(J[kt=oe.toFixed(j)+"|"+ce.toFixed(j)+"|"+he.toFixed(j)]!==void 0)k.push(J[kt]);else{var _e=te/3;J[kt]=_e,k.push(_e),H.push(_e)}}else for(te=0;te<A.length;te+=3){oe=A[te+0],ce=A[te+1],he=A[te+2];for(var ye=!1,Ee=0;Ee<te&&!ye;Ee+=3){var Oe=A[Ee+0],Ae=A[Ee+1],xe=A[Ee+2];if(Math.abs(oe-Oe)<j&&Math.abs(ce-Ae)<j&&Math.abs(he-xe)<j){k.push(Ee/3),ye=!0;break}}ye||(k.push(te/3),H.push(te/3))}if((h=this._options)===null||h===void 0?void 0:h.applyTessellation){for(var Pe=(b=(v=this._options)===null||v===void 0?void 0:v.epsilonVertexAligned)!==null&&b!==void 0?b:1e-6,Be=[],Ce=0;Ce<D.length;Ce+=3)for(var Ue=void 0,Le=0;Le<3;++Le){var ke=k[D[Ce+Le]],qe=k[D[Ce+(Le+1)%3]],at=k[D[Ce+(Le+2)%3]];if(ke!==qe)for(var lt=A[3*ke+0],ft=A[3*ke+1],Je=A[3*ke+2],dt=A[3*qe+0],ut=A[3*qe+1],tt=A[3*qe+2],mt=Math.sqrt((dt-lt)*(dt-lt)+(ut-ft)*(ut-ft)+(tt-Je)*(tt-Je)),ze=0;ze<H.length-1;ze++){var rt=H[ze];if(rt!==ke&&rt!==qe&&rt!==at){var At=A[3*rt+0],sn=A[3*rt+1],Ht=A[3*rt+2],fn=Math.sqrt((At-lt)*(At-lt)+(sn-ft)*(sn-ft)+(Ht-Je)*(Ht-Je)),St=Math.sqrt((At-dt)*(At-dt)+(sn-ut)*(sn-ut)+(Ht-tt)*(Ht-tt));Math.abs(fn+St-mt)<Pe&&(Ue||(Ue={index:Ce,edgesPoints:[[],[],[]]},Be.push(Ue)),Ue.edgesPoints[Le].push([rt,fn]))}}}for(var bn=0;bn<Be.length;++bn){var cn=Be[bn];this._tessellateTriangle(cn.edgesPoints,cn.index,D,k)}Be=null}var en={};for(Ce=0;Ce<D.length;Ce+=3){var ln=void 0;for(Le=0;Le<3;++Le)if(ke=k[D[Ce+Le]],qe=k[D[Ce+(Le+1)%3]],at=k[D[Ce+(Le+2)%3]],ke!==qe){if(d.c.Vector3[0].copyFromFloats(A[3*ke+0],A[3*ke+1],A[3*ke+2]),d.c.Vector3[1].copyFromFloats(A[3*qe+0],A[3*qe+1],A[3*qe+2]),d.c.Vector3[2].copyFromFloats(A[3*at+0],A[3*at+1],A[3*at+2]),ln||(d.c.Vector3[1].subtractToRef(d.c.Vector3[0],d.c.Vector3[3]),d.c.Vector3[2].subtractToRef(d.c.Vector3[1],d.c.Vector3[4]),(ln=d.e.Cross(d.c.Vector3[3],d.c.Vector3[4])).normalize()),ke>qe){var Ot=ke;ke=qe,qe=Ot}(Tn=en[kt=ke+"_"+qe])?Tn.done||(d.e.Dot(ln,Tn.normal)<this._epsilon&&this.createLine(d.c.Vector3[0],d.c.Vector3[1],this._linesPositions.length/3),Tn.done=!0):en[kt]={normal:ln,done:!1,index:Ce,i:Le}}}for(var kt in en){var Tn;(Tn=en[kt]).done||(ke=k[D[Tn.index+Tn.i]],qe=k[D[Tn.index+(Tn.i+1)%3]],d.c.Vector3[0].copyFromFloats(A[3*ke+0],A[3*ke+1],A[3*ke+2]),d.c.Vector3[1].copyFromFloats(A[3*qe+0],A[3*qe+1],A[3*qe+2]),this.createLine(d.c.Vector3[0],d.c.Vector3[1],this._linesPositions.length/3))}var Er=this._source.getScene().getEngine();this._buffers[Me.b.PositionKind]=new Me.b(Er,this._linesPositions,Me.b.PositionKind,!1),this._buffers[Me.b.NormalKind]=new Me.b(Er,this._linesNormals,Me.b.NormalKind,!1,!1,4),this._buffersForInstances[Me.b.PositionKind]=this._buffers[Me.b.PositionKind],this._buffersForInstances[Me.b.NormalKind]=this._buffers[Me.b.NormalKind],this._ib=Er.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype._generateEdgesLines=function(){var t=this._source.getVerticesData(Me.b.PositionKind),e=this._source.getIndices();if(e&&t){var n,r,o=new Array,l=new Array;for(n=0;n<e.length;n+=3){r=new BL;var h=e[n],v=e[n+1],b=e[n+2];r.p0=new d.e(t[3*h],t[3*h+1],t[3*h+2]),r.p1=new d.e(t[3*v],t[3*v+1],t[3*v+2]),r.p2=new d.e(t[3*b],t[3*b+1],t[3*b+2]);var A=d.e.Cross(r.p1.subtract(r.p0),r.p2.subtract(r.p1));A.normalize(),l.push(A),o.push(r)}for(n=0;n<o.length;n++){r=o[n];for(var D=n+1;D<o.length;D++){var N=o[D];if(r.edgesConnectedCount===3)break;if(N.edgesConnectedCount!==3)for(var j=e[3*D],k=e[3*D+1],H=e[3*D+2],J=0;J<3;J++){var te=0;if(r.edges[J]===void 0){switch(J){case 0:te=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p0,r.p1,N.p0,N.p1,N.p2):this._processEdgeForAdjacencies(e[3*n],e[3*n+1],j,k,H);break;case 1:te=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p1,r.p2,N.p0,N.p1,N.p2):this._processEdgeForAdjacencies(e[3*n+1],e[3*n+2],j,k,H);break;case 2:te=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p2,r.p0,N.p0,N.p1,N.p2):this._processEdgeForAdjacencies(e[3*n+2],e[3*n],j,k,H)}if(te!==-1&&(r.edges[J]=D,N.edges[te]=n,r.edgesConnectedCount++,N.edgesConnectedCount++,r.edgesConnectedCount===3))break}}}}for(n=0;n<o.length;n++){var oe=o[n];this._checkEdge(n,oe.edges[0],l,oe.p0,oe.p1),this._checkEdge(n,oe.edges[1],l,oe.p1,oe.p2),this._checkEdge(n,oe.edges[2],l,oe.p2,oe.p0)}var ce=this._source.getScene().getEngine();this._buffers[Me.b.PositionKind]=new Me.b(ce,this._linesPositions,Me.b.PositionKind,!1),this._buffers[Me.b.NormalKind]=new Me.b(ce,this._linesNormals,Me.b.NormalKind,!1,!1,4),this._buffersForInstances[Me.b.PositionKind]=this._buffers[Me.b.PositionKind],this._buffersForInstances[Me.b.NormalKind]=this._buffers[Me.b.NormalKind],this._ib=ce.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype.isReady=function(){return this._lineShader.isReady(this._source,this._source.hasInstances&&this.customInstances.length>0||this._source.hasThinInstances)},i.prototype.render=function(){var t=this._source.getScene();if(this.isReady()&&t.activeCamera){var e=t.getEngine();this._lineShader._preBind(),this._source.edgesColor.a!==1?e.setAlphaMode(g.a.ALPHA_COMBINE):e.setAlphaMode(g.a.ALPHA_DISABLE);var n=this._source.hasInstances&&this.customInstances.length>0,r=n||this._source.hasThinInstances,o=0;if(r)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),n){var l=this._source._instanceDataStorage;if(o=this.customInstances.length,!l.isFrozen){for(var h=0,v=0;v<o;++v)this.customInstances.data[v].copyToArray(l.instancesData,h),h+=16;l.instancesBuffer.updateDirectly(l.instancesData,0,o)}}else o=this._source.thinInstanceCount;e.bindBuffers(r?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===Tt.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",e.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),e.drawElementsType(nn.a.TriangleFillMode,0,this._indicesCount,o),this._lineShader.unbind(),r&&e.unbindInstanceAttributes(),this._source.getScene()._activeMeshesFrozen||this.customInstances.reset()}},i}(),mE=function(i){function t(e,n,r){n===void 0&&(n=.95),r===void 0&&(r=!1);var o=i.call(this,e,n,r,!1)||this;return o._generateEdgesLines(),o}return Object(_.d)(t,i),t.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(Me.b.PositionKind),n=this._source.getIndices();if(n&&e){for(var r=d.c.Vector3[0],o=d.c.Vector3[1],l=n.length-1,h=0,v=0;h<l;h+=2,v+=4)d.e.FromArrayToRef(e,3*n[h],r),d.e.FromArrayToRef(e,3*n[h+1],o),this.createLine(r,o,v);var b=this._source.getScene().getEngine();this._buffers[Me.b.PositionKind]=new Me.b(b,this._linesPositions,Me.b.PositionKind,!1),this._buffers[Me.b.NormalKind]=new Me.b(b,this._linesNormals,Me.b.NormalKind,!1,!1,4),this._ib=b.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(Zm),$m=function(){function i(t){this._textureFormats=[{type:g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_POSITION_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT},{type:g.a.PREPASS_COLOR_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,format:g.a.TEXTURETYPE_HALF_FLOAT},{type:g.a.PREPASS_ALBEDO_TEXTURE_TYPE,format:g.a.TEXTURETYPE_UNSIGNED_INT}],this.excludedSkinnedMesh=[],this.excludedMaterials=[],this._textureIndices=[],this._isDirty=!1,this.mrtCount=0,this._postProcesses=[],this._clearColor=new x.b(0,0,0,0),this._effectConfigurations=[],this._mrtFormats=[],this._enabled=!1,this._useGeometryBufferFallback=!1,this.disableGammaTransform=!1,this._scene=t,this._engine=t.getEngine(),i._SceneComponentInitialization(this._scene),this._resetLayout()}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"samples",{get:function(){return this.prePassRT.samples},set:function(t){this.imageProcessingPostProcess||this._createCompositionEffect(),this.prePassRT.samples=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"useGeometryBufferFallback",{get:function(){return this._useGeometryBufferFallback},set:function(t){if(this._useGeometryBufferFallback=t,t){if(this._geometryBuffer=this._scene.enableGeometryBufferRenderer(),!this._geometryBuffer)return void(this._useGeometryBufferFallback=!1);this._geometryBuffer.renderList=[],this._geometryBuffer._linkPrePassRenderer(this),this._updateGeometryBufferLayout()}else this._geometryBuffer&&this._geometryBuffer._unlinkPrePassRenderer(),this._geometryBuffer=null,this._scene.disableGeometryBufferRenderer()},enumerable:!1,configurable:!0}),i.prototype._initializeAttachments=function(){for(var t=[],e=[!1],n=[!0],r=0;r<this.mrtCount;r++)t.push(!0),r>0&&(e.push(!0),n.push(!1));this._multiRenderAttachments=this._engine.buildTextureLayout(t),this._clearAttachments=this._engine.buildTextureLayout(e),this._defaultAttachments=this._engine.buildTextureLayout(n)},i.prototype._createCompositionEffect=function(){this.prePassRT=new rm("sceneprePassRT",{width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight()},this.mrtCount,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_UNSIGNED_INT,types:this._mrtFormats}),this.prePassRT.samples=1,this._initializeAttachments(),this._useGeometryBufferFallback&&!this._geometryBuffer&&(this.useGeometryBufferFallback=!0),this.imageProcessingPostProcess=new Qu("sceneCompositionPass",1,null,void 0,this._engine),this.imageProcessingPostProcess.autoClear=!1},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._scene.getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),i.prototype.bindAttachmentsForEffect=function(t,e){if(this.enabled){if(t._multiTarget)this._engine.bindAttachments(this._multiRenderAttachments);else if(this._engine.bindAttachments(this._defaultAttachments),this._geometryBuffer){var n=e.getMaterial();n&&this.excludedMaterials.indexOf(n)===-1&&this._geometryBuffer.renderList.push(e.getRenderingMesh())}}},i.prototype.restoreAttachments=function(){this.enabled&&this._defaultAttachments&&this._engine.bindAttachments(this._defaultAttachments)},i.prototype._beforeCameraDraw=function(){this._isDirty&&this._update(),this._geometryBuffer&&(this._geometryBuffer.renderList.length=0),this._bindFrameBuffer()},i.prototype._afterCameraDraw=function(){if(this._enabled){var t=this._scene.activeCamera&&this._scene.activeCamera._getFirstPostProcess();t&&this._postProcesses.length&&this._scene.postProcessManager._prepareFrame(),this._scene.postProcessManager.directRender(this._postProcesses,t?t.inputTexture:null)}},i.prototype._checkRTSize=function(){var t=this._engine.getRenderWidth(!0),e=this._engine.getRenderHeight(!0),n=this.prePassRT.getRenderWidth(),r=this.prePassRT.getRenderHeight();n===t&&r===e||(this.prePassRT.resize({width:t,height:e}),this._updateGeometryBufferLayout(),this._bindPostProcessChain())},i.prototype._bindFrameBuffer=function(){if(this._enabled){this._checkRTSize();var t=this.prePassRT.getInternalTexture();t&&this._engine.bindFramebuffer(t)}},i.prototype.clear=function(){this._enabled&&(this._bindFrameBuffer(),this._engine.clear(this._scene.clearColor,this._scene.autoClear||this._scene.forceWireframe||this._scene.forcePointsCloud,this._scene.autoClearDepthAndStencil,this._scene.autoClearDepthAndStencil),this._engine.bindAttachments(this._clearAttachments),this._engine.clear(this._clearColor,!0,!1,!1),this._engine.bindAttachments(this._defaultAttachments))},i.prototype._setState=function(t){this._enabled=t,this._scene.prePass=t,this.imageProcessingPostProcess&&(this.imageProcessingPostProcess.imageProcessingConfiguration.applyByPostProcess=t)},i.prototype._updateGeometryBufferLayout=function(){if(this._geometryBuffer){this._geometryBuffer._resetLayout();for(var t=[],e=0;e<this._mrtLayout.length;e++)t.push(!1);this._geometryBuffer._linkInternalTexture(this.prePassRT.getInternalTexture());var n=[{prePassConstant:g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,geometryBufferConstant:_i.DEPTHNORMAL_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_POSITION_TEXTURE_TYPE,geometryBufferConstant:_i.POSITION_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_REFLECTIVITY_TEXTURE_TYPE,geometryBufferConstant:_i.REFLECTIVITY_TEXTURE_TYPE},{prePassConstant:g.a.PREPASS_VELOCITY_TEXTURE_TYPE,geometryBufferConstant:_i.VELOCITY_TEXTURE_TYPE}];for(e=0;e<n.length;e++){var r=this._mrtLayout.indexOf(n[e].prePassConstant);r!==-1&&(this._geometryBuffer._forceTextureType(n[e].geometryBufferConstant,r),t[r]=!0)}this._geometryBuffer._setAttachments(this._engine.buildTextureLayout(t))}},i.prototype.addEffectConfiguration=function(t){for(var e=0;e<this._effectConfigurations.length;e++)if(this._effectConfigurations[e].name===t.name)return this._effectConfigurations[e];return this._effectConfigurations.push(t),t},i.prototype.getIndex=function(t){return this._textureIndices[t]},i.prototype._enable=function(){for(var t,e,n=this.mrtCount,r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&this._enableTextures(this._effectConfigurations[r].texturesRequired);for(this.prePassRT&&this.mrtCount!==n&&this.prePassRT.updateCount(this.mrtCount,{types:this._mrtFormats}),this._updateGeometryBufferLayout(),this._resetPostProcessChain(),r=0;r<this._effectConfigurations.length;r++)this._effectConfigurations[r].enabled&&(!this._effectConfigurations[r].postProcess&&this._effectConfigurations[r].createPostProcess&&this._effectConfigurations[r].createPostProcess(),this._effectConfigurations[r].postProcess&&this._postProcesses.push(this._effectConfigurations[r].postProcess));this._initializeAttachments(),this.imageProcessingPostProcess||this._createCompositionEffect();var o=!1;if((t=this._scene.activeCamera)===null||t===void 0?void 0:t._postProcesses)for(r=0;r<this._scene.activeCamera._postProcesses.length;r++)((e=this._scene.activeCamera._postProcesses[r])===null||e===void 0?void 0:e.getClassName())==="ImageProcessingPostProcess"&&(o=!0);o||this.disableGammaTransform||this._postProcesses.push(this.imageProcessingPostProcess),this._bindPostProcessChain(),this._setState(!0)},i.prototype._disable=function(){this._setState(!1),this._resetLayout();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].enabled=!1},i.prototype._resetLayout=function(){for(var t=0;t<this._textureFormats.length;t++)this._textureIndices[this._textureFormats[t].type]=-1;this._textureIndices[g.a.PREPASS_COLOR_TEXTURE_TYPE]=0,this._mrtLayout=[g.a.PREPASS_COLOR_TEXTURE_TYPE],this._mrtFormats=[g.a.TEXTURETYPE_HALF_FLOAT],this.mrtCount=1},i.prototype._resetPostProcessChain=function(){this._postProcesses=[],this.imageProcessingPostProcess&&this.imageProcessingPostProcess.restoreDefaultInputTexture();for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].postProcess&&this._effectConfigurations[t].postProcess.restoreDefaultInputTexture()},i.prototype._bindPostProcessChain=function(){var t;if(this._postProcesses.length)this._postProcesses[0].inputTexture=this.prePassRT.getInternalTexture();else{var e=(t=this._scene.activeCamera)===null||t===void 0?void 0:t._getFirstPostProcess();e&&(e.inputTexture=this.prePassRT.getInternalTexture())}},i.prototype.markAsDirty=function(){this._isDirty=!0},i.prototype._enableTextures=function(t){for(var e=0;e<t.length;e++){var n=t[e];this._textureIndices[n]===-1&&(this._textureIndices[n]=this._mrtLayout.length,this._mrtLayout.push(n),this._mrtFormats.push(this._textureFormats[n].format),this.mrtCount++)}},i.prototype._update=function(){this._disable();for(var t=!1,e=0;e<this._scene.materials.length;e++)this._scene.materials[e].setPrePassRenderer(this)&&(t=!0);var n=this._scene.activeCamera;if(n){var r=n._postProcesses.filter(function(o){return o!=null});if(r)for(e=0;e<r.length;e++)r[e].setPrePassRenderer(this)&&(t=!0);this._markAllMaterialsAsPrePassDirty(),this._isDirty=!1,t&&this._enable(),this.enabled||(this._engine.restoreDefaultFramebuffer(),this._engine.restoreSingleAttachment())}},i.prototype._markAllMaterialsAsPrePassDirty=function(){for(var t=this._scene.materials,e=0;e<t.length;e++)t[e].markAsDirty(nn.a.PrePassDirtyFlag)},i.prototype.dispose=function(){for(var t=0;t<this._effectConfigurations.length;t++)this._effectConfigurations[t].dispose&&this._effectConfigurations[t].dispose();this.imageProcessingPostProcess.dispose(),this.prePassRT.dispose()},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("PrePassRendererSceneComponent")},i}();Object.defineProperty(ne.a.prototype,"prePassRenderer",{get:function(){return this._prePassRenderer},set:function(i){i&&i.isSupported&&(this._prePassRenderer=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enablePrePassRenderer=function(){return this._prePassRenderer||(this._prePassRenderer=new $m(this),this._prePassRenderer.isSupported||(this._prePassRenderer=null,p.a.Error(`PrePassRenderer needs WebGL 2 support.
Maybe you tried to use the following features that need the PrePassRenderer :
 + Subsurface Scattering`))),this._prePassRenderer},ne.a.prototype.disablePrePassRenderer=function(){this._prePassRenderer&&(this._prePassRenderer.dispose(),this._prePassRenderer=null)};var _E=function(){function i(t){this.name=ct.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(ct.a.STEP_BEFORECAMERADRAW_PREPASS,this,this._beforeCameraDraw),this.scene._afterCameraDrawStage.registerStep(ct.a.STEP_AFTERCAMERADRAW_PREPASS,this,this._afterCameraDraw),this.scene._beforeClearStage.registerStep(ct.a.STEP_BEFORECLEARSTAGE_PREPASS,this,this._beforeClearStage),this.scene._beforeRenderingMeshStage.registerStep(ct.a.STEP_BEFORERENDERINGMESH_PREPASS,this,this._beforeRenderingMeshStage),this.scene._afterRenderingMeshStage.registerStep(ct.a.STEP_AFTERRENDERINGMESH_PREPASS,this,this._afterRenderingMeshStage)},i.prototype._beforeCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._beforeCameraDraw()},i.prototype._afterCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._afterCameraDraw()},i.prototype._beforeClearStage=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer.clear()},i.prototype._beforeRenderingMeshStage=function(t,e,n,r){if(r){var o=t.getScene();o.prePassRenderer&&o.prePassRenderer.bindAttachmentsForEffect(r,e)}},i.prototype._afterRenderingMeshStage=function(t){var e=t.getScene();e.prePassRenderer&&e.prePassRenderer.restoreAttachments()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();$m._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_PREPASSRENDERER);t||(t=new _E(i),i._addComponent(t))};var UL=`#define rcp(x) 1./x
#define GOLDEN_RATIO 1.618033988749895
#define TWO_PI 6.2831855


vec2 Golden2dSeq(int i,float n)
{


return vec2(float(i)/n+(0.5/n),fract(float(i)*rcp(GOLDEN_RATIO)));
}
vec2 SampleDiskGolden(int i,int sampleCount)
{
vec2 f=Golden2dSeq(i,float(sampleCount));
return vec2(sqrt(f.x),TWO_PI*f.y);
}`;We.a.IncludesShadersStore.fibonacci=UL;var VL=`uniform vec3 diffusionS[5];
uniform float diffusionD[5];
uniform float filterRadii[5];`;We.a.IncludesShadersStore.diffusionProfile=VL;var kL=`
#include<fibonacci>
#include<helperFunctions>
#include<subSurfaceScatteringFunctions>
#include<diffusionProfile>
varying vec2 vUV;
uniform vec2 texelSize;
uniform sampler2D textureSampler;
uniform sampler2D irradianceSampler;
uniform sampler2D depthSampler;
uniform sampler2D albedoSampler;
uniform vec2 viewportSize;
uniform float metersPerUnit;
const float LOG2_E=1.4426950408889634;
const float SSS_PIXELS_PER_SAMPLE=4.;
const int _SssSampleBudget=40;
#define rcp(x) 1./x
#define Sq(x) x*x
#define SSS_BILATERAL_FILTER true


vec3 EvalBurleyDiffusionProfile(float r,vec3 S)
{
vec3 exp_13=exp2(((LOG2_E*(-1.0/3.0))*r)*S);
vec3 expSum=exp_13*(1.+exp_13*exp_13);
return (S*rcp(8.*PI))*expSum;
}






vec2 SampleBurleyDiffusionProfile(float u,float rcpS)
{
u=1.-u;
float g=1.+(4.*u)*(2.*u+sqrt(1.+(4.*u)*u));
float n=exp2(log2(g)*(-1.0/3.0));
float p=(g*n)*n;
float c=1.+p+n;
float d=(3./LOG2_E*2.)+(3./LOG2_E)*log2(u);
float x=(3./LOG2_E)*log2(c)-d;






float rcpExp=((c*c)*c)*rcp((4.*u)*((c*c)+(4.*u)*(4.*u)));
float r=x*rcpS;
float rcpPdf=(8.*PI*rcpS)*rcpExp;
return vec2(r,rcpPdf);
}


vec3 ComputeBilateralWeight(float xy2,float z,float mmPerUnit,vec3 S,float rcpPdf)
{
#ifndef SSS_BILATERAL_FILTER
z=0.;
#endif



float r=sqrt(xy2+(z*mmPerUnit)*(z*mmPerUnit));
float area=rcpPdf;
#if SSS_CLAMP_ARTIFACT
return clamp(EvalBurleyDiffusionProfile(r,S)*area,0.0,1.0);
#else
return EvalBurleyDiffusionProfile(r,S)*area;
#endif
}
void EvaluateSample(int i,int n,vec3 S,float d,vec3 centerPosVS,float mmPerUnit,float pixelsPerMm,
float phase,inout vec3 totalIrradiance,inout vec3 totalWeight)
{

float scale=rcp(float(n));
float offset=rcp(float(n))*0.5;

float sinPhase,cosPhase;
sinPhase=sin(phase);
cosPhase=cos(phase);
vec2 bdp=SampleBurleyDiffusionProfile(float(i)*scale+offset,d);
float r=bdp.x;
float rcpPdf=bdp.y;
float phi=SampleDiskGolden(i,n).y;
float sinPhi,cosPhi;
sinPhi=sin(phi);
cosPhi=cos(phi);
float sinPsi=cosPhase*sinPhi+sinPhase*cosPhi;
float cosPsi=cosPhase*cosPhi-sinPhase*sinPhi;
vec2 vec=r*vec2(cosPsi,sinPsi);

vec2 position;
float xy2;
position=vUV+round((pixelsPerMm*r)*vec2(cosPsi,sinPsi))*texelSize;
xy2=r*r;
vec4 textureSample=texture2D(irradianceSampler,position);
float viewZ=texture2D(depthSampler,position).r;
vec3 irradiance=textureSample.rgb;
if (testLightingForSSS(textureSample.a))
{

float relZ=viewZ-centerPosVS.z;
vec3 weight=ComputeBilateralWeight(xy2,relZ,mmPerUnit,S,rcpPdf);
totalIrradiance+=weight*irradiance;
totalWeight+=weight;
}
else
{






}
}
void main(void)
{
vec4 irradianceAndDiffusionProfile=texture2D(irradianceSampler,vUV);
vec3 centerIrradiance=irradianceAndDiffusionProfile.rgb;
int diffusionProfileIndex=int(round(irradianceAndDiffusionProfile.a*255.));
float centerDepth=0.;
vec4 inputColor=texture2D(textureSampler,vUV);
bool passedStencilTest=testLightingForSSS(irradianceAndDiffusionProfile.a);
if (passedStencilTest)
{
centerDepth=texture2D(depthSampler,vUV).r;
}
if (!passedStencilTest) {
gl_FragColor=inputColor;
return;
}
float distScale=1.;
vec3 S=diffusionS[diffusionProfileIndex];
float d=diffusionD[diffusionProfileIndex];
float filterRadius=filterRadii[diffusionProfileIndex];

vec2 centerPosNDC=vUV;
vec2 cornerPosNDC=vUV+0.5*texelSize;
vec3 centerPosVS=vec3(centerPosNDC*viewportSize,1.0)*centerDepth;
vec3 cornerPosVS=vec3(cornerPosNDC*viewportSize,1.0)*centerDepth;

float mmPerUnit=1000.*(metersPerUnit*rcp(distScale));
float unitsPerMm=rcp(mmPerUnit);


float unitsPerPixel=2.*abs(cornerPosVS.x-centerPosVS.x);
float pixelsPerMm=rcp(unitsPerPixel)*unitsPerMm;

float filterArea=PI*Sq(filterRadius*pixelsPerMm);
int sampleCount=int(filterArea*rcp(SSS_PIXELS_PER_SAMPLE));
int sampleBudget=_SssSampleBudget;
int texturingMode=0;
vec3 albedo=texture2D(albedoSampler,vUV).rgb;
if (distScale == 0. || sampleCount<1)
{
#ifdef DEBUG_SSS_SAMPLES
vec3 green=vec3(0.,1.,0.);
gl_FragColor=vec4(green,1.0);
return;
#endif
gl_FragColor=vec4(inputColor.rgb+albedo*centerIrradiance,1.0);
return;
}
#ifdef DEBUG_SSS_SAMPLES
vec3 red=vec3(1.,0.,0.);
vec3 blue=vec3(0.,0.,1.);
gl_FragColor=vec4(mix(blue,red,clamp(float(sampleCount)/float(sampleBudget),0.0,1.0)),1.0);
return;
#endif

float phase=0.;
int n=min(sampleCount,sampleBudget);

vec3 centerWeight=vec3(0.);
vec3 totalIrradiance=vec3(0.);
vec3 totalWeight=vec3(0.);
for (int i=0; i<n; i++)
{

EvaluateSample(i,n,S,d,centerPosVS,mmPerUnit,pixelsPerMm,
phase,totalIrradiance,totalWeight);
}

totalWeight=max(totalWeight,HALF_MIN);
gl_FragColor=vec4(inputColor.rgb+albedo*max(totalIrradiance/totalWeight,vec3(0.0)),1.);
}`;We.a.ShadersStore.subSurfaceScatteringPixelShader=kL;var jL=function(i){function t(e,n,r,o,l,h,v,b){o===void 0&&(o=null),b===void 0&&(b=g.a.TEXTURETYPE_UNSIGNED_INT);var A=i.call(this,e,"subSurfaceScattering",["texelSize","viewportSize","metersPerUnit"],["diffusionS","diffusionD","filterRadii","irradianceSampler","depthSampler","albedoSampler"],r,o,l||Ve.a.BILINEAR_SAMPLINGMODE,h,v,null,b,"postprocess",void 0,!0)||this;return A._scene=n,A.updateEffect(),A.onApplyObservable.add(function(D){if(n.prePassRenderer&&n.subSurfaceConfiguration){var N=A.texelSize;D.setFloat("metersPerUnit",n.subSurfaceConfiguration.metersPerUnit),D.setFloat2("texelSize",N.x,N.y),D.setTexture("irradianceSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE)]),D.setTexture("depthSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE)]),D.setTexture("albedoSampler",n.prePassRenderer.prePassRT.textures[n.prePassRenderer.getIndex(g.a.PREPASS_ALBEDO_TEXTURE_TYPE)]),D.setFloat2("viewportSize",Math.tan(n.activeCamera.fov/2)*n.getEngine().getAspectRatio(n.activeCamera,!0),Math.tan(n.activeCamera.fov/2)),D.setArray3("diffusionS",n.subSurfaceConfiguration.ssDiffusionS),D.setArray("diffusionD",n.subSurfaceConfiguration.ssDiffusionD),D.setArray("filterRadii",n.subSurfaceConfiguration.ssFilterRadii)}else p.a.Error("PrePass and subsurface configuration needs to be enabled for subsurface scattering.")}),A}return Object(_.d)(t,i),t.prototype.getClassName=function(){return"SubSurfaceScatteringPostProcess"},t}(bt),gE=function(){function i(t){this._ssDiffusionS=[],this._ssFilterRadii=[],this._ssDiffusionD=[],this.enabled=!1,this.name=ct.a.NAME_SUBSURFACE,this.ssDiffusionProfileColors=[],this.metersPerUnit=1,this.texturesRequired=[g.a.PREPASS_DEPTHNORMAL_TEXTURE_TYPE,g.a.PREPASS_ALBEDO_TEXTURE_TYPE,g.a.PREPASS_COLOR_TEXTURE_TYPE,g.a.PREPASS_IRRADIANCE_TEXTURE_TYPE],this.addDiffusionProfile(new x.a(1,1,1)),this._scene=t,i._SceneComponentInitialization(this._scene)}return Object.defineProperty(i.prototype,"ssDiffusionS",{get:function(){return this._ssDiffusionS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssDiffusionD",{get:function(){return this._ssDiffusionD},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ssFilterRadii",{get:function(){return this._ssFilterRadii},enumerable:!1,configurable:!0}),i.prototype.addDiffusionProfile=function(t){if(this.ssDiffusionD.length>=5)return p.a.Error("You already reached the maximum number of diffusion profiles."),0;for(var e=0;e<this._ssDiffusionS.length/3;e++)if(this._ssDiffusionS[3*e]===t.r&&this._ssDiffusionS[3*e+1]===t.g&&this._ssDiffusionS[3*e+2]===t.b)return e;return this._ssDiffusionS.push(t.r,t.b,t.g),this._ssDiffusionD.push(Math.max(Math.max(t.r,t.b),t.g)),this._ssFilterRadii.push(this.getDiffusionProfileParameters(t)),this.ssDiffusionProfileColors.push(t),this._ssDiffusionD.length-1},i.prototype.createPostProcess=function(){return this.postProcess=new jL("subSurfaceScattering",this._scene,1,null,void 0,this._scene.getEngine()),this.postProcess.autoClear=!1,this.postProcess},i.prototype.clearAllDiffusionProfiles=function(){this._ssDiffusionD=[],this._ssDiffusionS=[],this._ssFilterRadii=[],this.ssDiffusionProfileColors=[]},i.prototype.dispose=function(){this.clearAllDiffusionProfiles(),this.postProcess.dispose()},i.prototype.getDiffusionProfileParameters=function(t){var e=Math.max(t.r,t.g,t.b);return this._sampleBurleyDiffusionProfile(.997,e)},i.prototype._sampleBurleyDiffusionProfile=function(t,e){var n=1+4*(t=1-t)*(2*t+Math.sqrt(1+4*t*t)),r=Math.pow(n,-1/3),o=1+n*r*r+r;return 3*Math.log(o/(4*t))*e},i._SceneComponentInitialization=function(t){throw rr.a.WarnImport("PrePassRendererSceneComponent")},i}();T.a.AddParser(ct.a.NAME_SUBSURFACE,function(i,t){if(i.ssDiffusionProfileColors!==void 0&&i.ssDiffusionProfileColors!==null&&(t.enableSubSurfaceForPrePass(),t.subSurfaceConfiguration))for(var e=0,n=i.ssDiffusionProfileColors.length;e<n;e++){var r=i.ssDiffusionProfileColors[e];t.subSurfaceConfiguration.addDiffusionProfile(new x.a(r.r,r.g,r.b))}}),Object.defineProperty(ne.a.prototype,"subSurfaceConfiguration",{get:function(){return this._subSurfaceConfiguration},set:function(i){i&&this.enablePrePassRenderer()&&(this._subSurfaceConfiguration=i)},enumerable:!0,configurable:!0}),ne.a.prototype.enableSubSurfaceForPrePass=function(){if(this._subSurfaceConfiguration)return this._subSurfaceConfiguration;var i=this.enablePrePassRenderer();return i?(this._subSurfaceConfiguration=new gE(this),i.addEffectConfiguration(this._subSurfaceConfiguration),this._subSurfaceConfiguration):null},ne.a.prototype.disableSubSurfaceForPrePass=function(){this._subSurfaceConfiguration&&(this._subSurfaceConfiguration.dispose(),this._subSurfaceConfiguration=null)};var vE=function(){function i(t){this.name=ct.a.NAME_PREPASSRENDERER,this.scene=t}return i.prototype.register=function(){},i.prototype.serialize=function(t){if(this.scene.subSurfaceConfiguration){var e=this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;t.ssDiffusionProfileColors=[];for(var n=0;n<e.length;n++)t.ssDiffusionProfileColors.push({r:e[n].r,g:e[n].g,b:e[n].b})}},i.prototype.addFromContainer=function(t){},i.prototype.removeFromContainer=function(t,e){this.scene.prePassRenderer&&this.scene.subSurfaceConfiguration&&this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles()},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i}();gE._SceneComponentInitialization=function(i){var t=i._getComponent(ct.a.NAME_SUBSURFACE);t||(t=new vE(i),i._addComponent(t))};var zL=`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`;We.a.ShadersStore.outlinePixelShader=zL;var GL=`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 positionUpdated=position;
vec3 normalUpdated=normal;
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
vec3 offsetPosition=positionUpdated+(normalUpdated*offset);
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`;We.a.ShadersStore.outlineVertexShader=GL,ne.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new bE(this)),this._outlineRenderer},Object.defineProperty(Ne.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOutline=i},enumerable:!0,configurable:!0}),Object.defineProperty(Ne.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(i){i&&this.getScene().getOutlineRenderer(),this._renderOverlay=i},enumerable:!0,configurable:!0});var bE=function(){function i(t){this.name=ct.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=t,this._engine=t.getEngine(),this.scene._addComponent(this)}return i.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(ct.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(ct.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){},i.prototype.render=function(t,e,n){var r=this;n===void 0&&(n=!1);var o=this.scene,l=o.getEngine(),h=l.getCaps().instancedArrays&&(e.visibleInstances[t._id]!==null&&e.visibleInstances[t._id]!==void 0||t.getRenderingMesh().hasThinInstances);if(this.isReady(t,h)){var v=t.getMesh(),b=v._internalAbstractMeshDataInfo._actAsRegularMesh?v:null,A=t.getRenderingMesh(),D=b||A,N=t.getMaterial();if(N&&o.activeCamera){if(l.enableEffect(this._effect),N.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(o.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",n?0:A.outlineWidth),this._effect.setColor4("color",n?A.overlayColor:A.outlineColor,n?A.overlayAlpha:N.alpha),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),this._effect.setMatrix("world",D.getWorldMatrix()),A.useBones&&A.computeBonesUsingShaders&&A.skeleton&&this._effect.setMatrices("mBones",A.skeleton.getTransformMatrices(A)),ot.a.BindMorphTargetParameters(A,this._effect),A._bind(t,this._effect,N.fillMode),N&&N.needAlphaTesting()){var j=N.getAlphaTestTexture();j&&(this._effect.setTexture("diffuseSampler",j),this._effect.setMatrix("diffuseMatrix",j.getTextureMatrix()))}l.setZOffset(-this.zOffset),A._processRendering(D,t,this._effect,N.fillMode,e,h,function(k,H){r._effect.setMatrix("world",H)}),l.setZOffset(0)}}},i.prototype.isReady=function(t,e){var n=[],r=[Me.b.PositionKind,Me.b.NormalKind],o=t.getMesh(),l=t.getMaterial();l&&(l.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(Me.b.UVKind)&&(r.push(Me.b.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(Me.b.UV2Kind)&&(r.push(Me.b.UV2Kind),n.push("#define UV2"))),l.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH")),o.useBones&&o.computeBonesUsingShaders?(r.push(Me.b.MatricesIndicesKind),r.push(Me.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(Me.b.MatricesIndicesExtraKind),r.push(Me.b.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0");var h=o.morphTargetManager,v=0;h&&h.numInfluencers>0&&(v=h.numInfluencers,n.push("#define MORPHTARGETS"),n.push("#define NUM_MORPH_INFLUENCERS "+v),ot.a.PrepareAttributesForMorphTargetsInfluencers(r,o,v)),e&&(n.push("#define INSTANCES"),ot.a.PushAttributesForInstances(r),t.getRenderingMesh().hasThinInstances&&n.push("#define THIN_INSTANCES"));var b=n.join(`
`);return this._cachedDefines!==b&&(this._cachedDefines=b,this._effect=this.scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant","morphTargetInfluences"],["diffuseSampler"],b,void 0,void 0,void 0,{maxSimultaneousMorphTargets:v})),this._effect.isReady()},i.prototype._beforeRenderingMesh=function(t,e,n){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){var r=e.getMaterial();r&&r.needAlphaBlendingForMesh(t)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(g.a.REPLACE),this._engine.setStencilFunction(g.a.ALWAYS),this._engine.setStencilMask(i._StencilReference),this._engine.setStencilFunctionReference(i._StencilReference),this.render(e,n,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(g.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(e,n),this._engine.setDepthWrite(this._savedDepthWrite),r&&r.needAlphaBlendingForMesh(t)&&this._engine.restoreStencilState()}},i.prototype._afterRenderingMesh=function(t,e,n){if(t.renderOverlay){var r=this._engine.getAlphaMode(),o=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(g.a.ALPHA_COMBINE),this.render(e,n,!0),this._engine.setAlphaMode(r),this._engine.setDepthWrite(this._savedDepthWrite),this._engine.alphaState.alphaBlend=o}t.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(e,n),this._engine.setColorWrite(!0))},i._StencilReference=4,i}(),WL=c(148),yE=function(i){function t(e,n){var r=i.call(this)||this;return r.name=e,r.animations=new Array,r.isPickable=!1,r.useAlphaForPicking=!1,r.onDisposeObservable=new E.c,r._onAnimationEnd=null,r._endAnimation=function(){r._onAnimationEnd&&r._onAnimationEnd(),r.disposeWhenFinishedAnimating&&r.dispose()},r.color=new x.b(1,1,1,1),r.position=d.e.Zero(),r._manager=n,r._manager.sprites.push(r),r.uniqueId=r._manager.scene.getUniqueId(),r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return this._manager},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Sprite"},Object.defineProperty(t.prototype,"fromIndex",{get:function(){return this._fromIndex},set:function(e){this.playAnimation(e,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toIndex",{get:function(){return this._toIndex},set:function(e){this.playAnimation(this._fromIndex,e,this._loopAnimation,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,e,this._delay,this._onAnimationEnd)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"delay",{get:function(){return Math.max(this._delay,1)},set:function(e){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,e,this._onAnimationEnd)},enumerable:!1,configurable:!0}),t.prototype.playAnimation=function(e,n,r,o,l){l===void 0&&(l=null),this._onAnimationEnd=l,i.prototype.playAnimation.call(this,e,n,r,o,this._endAnimation)},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.serialize=function(){var e={};return e.name=this.name,e.position=this.position.asArray(),e.color=this.color.asArray(),e.width=this.width,e.height=this.height,e.angle=this.angle,e.cellIndex=this.cellIndex,e.cellRef=this.cellRef,e.invertU=this.invertU,e.invertV=this.invertV,e.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,e.isPickable=this.isPickable,e.isVisible=this.isVisible,e.useAlphaForPicking=this.useAlphaForPicking,e.animationStarted=this.animationStarted,e.fromIndex=this.fromIndex,e.toIndex=this.toIndex,e.loopAnimation=this.loopAnimation,e.delay=this.delay,e},t.Parse=function(e,n){var r=new t(e.name,n);return r.position=d.e.FromArray(e.position),r.color=x.b.FromArray(e.color),r.width=e.width,r.height=e.height,r.angle=e.angle,r.cellIndex=e.cellIndex,r.cellRef=e.cellRef,r.invertU=e.invertU,r.invertV=e.invertV,r.disposeWhenFinishedAnimating=e.disposeWhenFinishedAnimating,r.isPickable=e.isPickable,r.isVisible=e.isVisible,r.useAlphaForPicking=e.useAlphaForPicking,r.fromIndex=e.fromIndex,r.toIndex=e.toIndex,r.loopAnimation=e.loopAnimation,r.delay=e.delay,e.animationStarted&&r.playAnimation(r.fromIndex,r.toIndex,r.loopAnimation,r.delay),r},t}(function(){function i(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}return Object.defineProperty(i.prototype,"animationStarted",{get:function(){return this._animationStarted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fromIndex",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"toIndex",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loopAnimation",{get:function(){return this._loopAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"delay",{get:function(){return Math.max(this._delay,1)},enumerable:!1,configurable:!0}),i.prototype.playAnimation=function(t,e,n,r,o){this._fromIndex=t,this._toIndex=e,this._loopAnimation=n,this._delay=r||1,this._animationStarted=!0,this._onBaseAnimationEnd=o,t<e?this._direction=1:(this._direction=-1,this._toIndex=t,this._fromIndex=e),this.cellIndex=t,this._time=0},i.prototype.stopAnimation=function(){this._animationStarted=!1},i.prototype._animate=function(t){this._animationStarted&&(this._time+=t,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))},i}());ne.a.prototype._internalPickSprites=function(i,t,e,n){if(!xa.a)return null;var r=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var l=this.spriteManagers[o];if(l.isPickable){var h=l.intersects(i,n,t,e);if(h&&h.hit&&(e||r==null||!(h.distance>=r.distance))&&(r=h,e))break}}return r||new xa.a},ne.a.prototype._internalMultiPickSprites=function(i,t,e){if(!xa.a)return null;var n=new Array;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}if(this.spriteManagers.length>0)for(var r=0;r<this.spriteManagers.length;r++){var o=this.spriteManagers[r];if(o.isPickable){var l=o.multiIntersects(i,e,t);l!==null&&(n=n.concat(l))}}return n},ne.a.prototype.pickSprite=function(i,t,e,n,r){return this._tempSpritePickingRay?(this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,r),this._internalPickSprites(this._tempSpritePickingRay,e,n,r)):null},ne.a.prototype.pickSpriteWithRay=function(i,t,e,n){if(!this._tempSpritePickingRay)return null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}return Bn.a.TransformToRef(i,n.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,t,e,n)},ne.a.prototype.multiPickSprite=function(i,t,e,n){return this.createPickingRayInCameraSpaceToRef(i,t,this._tempSpritePickingRay,n),this._internalMultiPickSprites(this._tempSpritePickingRay,e,n)},ne.a.prototype.multiPickSpriteWithRay=function(i,t,e){if(!this._tempSpritePickingRay)return null;if(!e){if(!this.activeCamera)return null;e=this.activeCamera}return Bn.a.TransformToRef(i,e.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,t,e)},ne.a.prototype.setPointerOverSprite=function(i){this._pointerOverSprite!==i&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOutTrigger,S.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=i,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOverTrigger,S.a.CreateNewFromSprite(this._pointerOverSprite,this)))},ne.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var TE=function(){function i(t){this.name=ct.a.NAME_SPRITE,this.scene=t,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=Bn.a?Bn.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new E.c,this.scene.onAfterSpritesRenderingObservable=new E.c,this._spritePredicate=function(e){return!!e.actionManager&&e.isPickable&&e.actionManager.hasPointerTriggers}}return i.prototype.register=function(){this.scene._pointerMoveStage.registerStep(ct.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(ct.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(ct.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},i.prototype.rebuild=function(){},i.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var t=this.scene.spriteManagers;t.length;)t[0].dispose()},i.prototype._pickSpriteButKeepRay=function(t,e,n,r,o){var l=this.scene.pickSprite(e,n,this._spritePredicate,r,o);return l&&(l.ray=t?t.ray:null),l},i.prototype._pointerMove=function(t,e,n,r,o){var l=this.scene;return r?l.setPointerOverSprite(null):(n=this._pickSpriteButKeepRay(n,t,e,!1,l.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite?(l.setPointerOverSprite(n.pickedSprite),l.doNotHandleCursors||(l._pointerOverSprite&&l._pointerOverSprite.actionManager&&l._pointerOverSprite.actionManager.hoverCursor?o.style.cursor=l._pointerOverSprite.actionManager.hoverCursor:o.style.cursor=l.hoverCursor)):l.setPointerOverSprite(null),n},i.prototype._pointerDown=function(t,e,n,r){var o=this.scene;if(o._pickedDownSprite=null,o.spriteManagers.length>0&&(n=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(o._pickedDownSprite=n.pickedSprite,r.button){case 0:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnLeftPickTrigger,S.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 1:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnCenterPickTrigger,S.a.CreateNewFromSprite(n.pickedSprite,o,r));break;case 2:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnRightPickTrigger,S.a.CreateNewFromSprite(n.pickedSprite,o,r))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickDownTrigger,S.a.CreateNewFromSprite(n.pickedSprite,o,r))}return n},i.prototype._pointerUp=function(t,e,n,r){var o=this.scene;if(o.spriteManagers.length>0){var l=o.pickSprite(t,e,this._spritePredicate,!1,o.cameraToUseForPointers||void 0);l&&(l.hit&&l.pickedSprite&&l.pickedSprite.actionManager&&(l.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickUpTrigger,S.a.CreateNewFromSprite(l.pickedSprite,o,r)),l.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||l.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickTrigger,S.a.CreateNewFromSprite(l.pickedSprite,o,r)))),o._pickedDownSprite&&o._pickedDownSprite.actionManager&&o._pickedDownSprite!==l.pickedSprite&&o._pickedDownSprite.actionManager.processTrigger(g.a.ACTION_OnPickOutTrigger,S.a.CreateNewFromSprite(o._pickedDownSprite,o,r)))}return n},i}();We.a.IncludesShadersStore.imageProcessingCompatibility=`#ifdef IMAGEPROCESSINGPOSTPROCESS
gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));
#endif`;var HL=`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest)
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
#include<imageProcessingCompatibility>
}`;We.a.ShadersStore.spritesPixelShader=HL;var XL=`
attribute vec4 position;
attribute vec2 options;
attribute vec2 offsets;
attribute vec2 inverts;
attribute vec4 cellInfo;
attribute vec4 color;

uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) {
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=offsets.xy;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0);

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));
vec2 uvPlace=cellInfo.xy;
vec2 uvSize=cellInfo.zw;
vUV.x=uvPlace.x+uvSize.x*uvOffset.x;
vUV.y=uvPlace.y+uvSize.y*uvOffset.y;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`;We.a.ShadersStore.spritesVertexShader=XL;var YL=function(){function i(t,e,n,r){if(n===void 0&&(n=.01),r===void 0&&(r=null),this.blendMode=g.a.ALPHA_COMBINE,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this.fogEnabled=!0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._capacity=e,this._epsilon=n,this._engine=t,this._useInstancing=t.getCaps().instancedArrays,this._useVAO=t.getCaps().vertexArrayObject&&!t.disableVertexArrayObjects,this._scene=r,!this._useInstancing){for(var o=[],l=0,h=0;h<e;h++)o.push(l),o.push(l+1),o.push(l+2),o.push(l),o.push(l+2),o.push(l+3),l+=4;this._indexBuffer=t.createIndexBuffer(o)}this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(e*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new Me.a(t,this._vertexData,!0,this._vertexBufferSize);var v,b=this._buffer.createVertexBuffer(Me.b.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),A=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing),D=6;if(this._useInstancing){var N=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new Me.a(t,N,!1,2),v=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else v=this._buffer.createVertexBuffer("offsets",D,2,this._vertexBufferSize,this._useInstancing),D+=2;var j=this._buffer.createVertexBuffer("inverts",D,2,this._vertexBufferSize,this._useInstancing),k=this._buffer.createVertexBuffer("cellInfo",D+2,4,this._vertexBufferSize,this._useInstancing),H=this._buffer.createVertexBuffer(Me.b.ColorKind,D+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Me.b.PositionKind]=b,this._vertexBuffers.options=A,this._vertexBuffers.offsets=v,this._vertexBuffers.inverts=j,this._vertexBuffers.cellInfo=k,this._vertexBuffers[Me.b.ColorKind]=H,this._effectBase=this._engine.createEffect("sprites",[Me.b.PositionKind,"options","offsets","inverts","cellInfo",Me.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._scene&&(this._effectFog=this._scene.getEngine().createEffect("sprites",[Me.b.PositionKind,"options","offsets","inverts","cellInfo",Me.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG"))}return Object.defineProperty(i.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),i.prototype.render=function(t,e,n,r,o){if(o===void 0&&(o=null),this.texture&&this.texture.isReady()&&t.length){var l=this._effectBase,h=!1;if(this.fogEnabled&&this._scene&&this._scene.fogEnabled&&this._scene.fogMode!==0&&(l=this._effectFog,h=!0),l.isReady()){for(var v=this._engine,b=!(!this._scene||!this._scene.useRightHandedSystem),A=this.texture.getBaseSize(),D=Math.min(this._capacity,t.length),N=0,j=!0,k=0;k<D;k++){var H=t[k];H&&H.isVisible&&(j=!1,H._animate(e),this._appendSpriteVertex(N++,H,0,0,A,b,o),this._useInstancing||(this._appendSpriteVertex(N++,H,1,0,A,b,o),this._appendSpriteVertex(N++,H,1,1,A,b,o),this._appendSpriteVertex(N++,H,0,1,A,b,o)))}if(!j){this._buffer.update(this._vertexData);var J=v.depthCullingState.cull||!0,te=v.depthCullingState.zOffset;if(b&&this._scene.getEngine().setState(J,te,!1,!1),v.enableEffect(l),l.setTexture("diffuseSampler",this.texture),l.setMatrix("view",n),l.setMatrix("projection",r),h){var oe=this._scene;l.setFloat4("vFogInfos",oe.fogMode,oe.fogStart,oe.fogEnd,oe.fogDensity),l.setColor3("vFogColor",oe.fogColor)}this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=v.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,l)),v.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):v.bindBuffers(this._vertexBuffers,this._indexBuffer,l),v.depthCullingState.depthFunc=g.a.LEQUAL,this.disableDepthWrite||(l.setBool("alphaTest",!0),v.setColorWrite(!1),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,N):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,N/4*6),v.setColorWrite(!0),l.setBool("alphaTest",!1)),v.setAlphaMode(this.blendMode),this._useInstancing?v.drawArraysType(g.a.MATERIAL_TriangleFanDrawMode,0,4,N):v.drawElementsType(g.a.MATERIAL_TriangleFillMode,0,N/4*6),this.autoResetAlpha&&v.setAlphaMode(g.a.ALPHA_DISABLE),b&&this._scene.getEngine().setState(J,te,!1,!0),v.unbindInstanceAttributes()}}}},i.prototype._appendSpriteVertex=function(t,e,n,r,o,l,h){var v=t*this._vertexBufferSize;if(n===0?n=this._epsilon:n===1&&(n=1-this._epsilon),r===0?r=this._epsilon:r===1&&(r=1-this._epsilon),h)h(e,o);else{e.cellIndex||(e.cellIndex=0);var b=o.width/this.cellWidth,A=e.cellIndex/b>>0;e._xOffset=(e.cellIndex-A*b)*this.cellWidth/o.width,e._yOffset=A*this.cellHeight/o.height,e._xSize=this.cellWidth,e._ySize=this.cellHeight}this._vertexData[v]=e.position.x,this._vertexData[v+1]=e.position.y,this._vertexData[v+2]=e.position.z,this._vertexData[v+3]=e.angle,this._vertexData[v+4]=e.width,this._vertexData[v+5]=e.height,this._useInstancing?v-=2:(this._vertexData[v+6]=n,this._vertexData[v+7]=r),this._vertexData[v+8]=l?e.invertU?0:1:e.invertU?1:0,this._vertexData[v+9]=e.invertV?1:0,this._vertexData[v+10]=e._xOffset,this._vertexData[v+11]=e._yOffset,this._vertexData[v+12]=e._xSize/o.width,this._vertexData[v+13]=e._ySize/o.height,this._vertexData[v+14]=e.color.r,this._vertexData[v+15]=e.color.g,this._vertexData[v+16]=e.color.b,this._vertexData[v+17]=e.color.a},i.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null)},i}(),EE=function(){function i(t,e,n,r,o,l,h,v,b){var A=this;l===void 0&&(l=.01),h===void 0&&(h=Ve.a.TRILINEAR_SAMPLINGMODE),v===void 0&&(v=!1),b===void 0&&(b=null),this.name=t,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.isPickable=!1,this.onDisposeObservable=new E.c,this.disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=function(N,j){N.cellRef||(N.cellIndex=0);var k=N.cellIndex;typeof k=="number"&&isFinite(k)&&Math.floor(k)===k&&(N.cellRef=A._spriteMap[N.cellIndex]),N._xOffset=A._cellData[N.cellRef].frame.x/j.width,N._yOffset=A._cellData[N.cellRef].frame.y/j.height,N._xSize=A._cellData[N.cellRef].frame.w,N._ySize=A._cellData[N.cellRef].frame.h},o||(o=Xe.a.LastCreatedScene),o._getComponent(ct.a.NAME_SPRITE)||o._addComponent(new TE(o)),this._fromPacked=v,this._scene=o;var D=this._scene.getEngine();if(this._spriteRenderer=new YL(D,n,l,o),r.width&&r.height)this.cellWidth=r.width,this.cellHeight=r.height;else{if(r===void 0)return void(this._spriteRenderer=null);this.cellWidth=r,this.cellHeight=r}this._scene.spriteManagers.push(this),this.uniqueId=this.scene.getUniqueId(),e&&(this.texture=new Ve.a(e,o,!0,!1,h)),this._fromPacked&&this._makePacked(e,b)}return Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this.sprites},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"capacity",{get:function(){return this._spriteRenderer.capacity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"texture",{get:function(){return this._spriteRenderer.texture},set:function(t){t.wrapU=Ve.a.CLAMP_ADDRESSMODE,t.wrapV=Ve.a.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=t,this._textureContent=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellWidth",{get:function(){return this._spriteRenderer.cellWidth},set:function(t){this._spriteRenderer.cellWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellHeight",{get:function(){return this._spriteRenderer.cellHeight},set:function(t){this._spriteRenderer.cellHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this._spriteRenderer.fogEnabled},set:function(t){this._spriteRenderer.fogEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._spriteRenderer.blendMode},set:function(t){this._spriteRenderer.blendMode=t},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"SpriteManager"},i.prototype._makePacked=function(t,e){var n=this;if(e!==null)try{var r=void 0;if((r=typeof e=="string"?JSON.parse(e):e).frames.length){for(var o={},l=0;l<r.frames.length;l++){var h=r.frames[l];if(typeof Object.keys(h)[0]!="string")throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");o[h[Object.keys(h)[0]]]=h}r.frames=o}var v=Reflect.ownKeys(r.frames);this._spriteMap=v,this._packedAndReady=!0,this._cellData=r.frames}catch(j){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{var b=/\./g,A=void 0;do A=b.lastIndex,b.test(t);while(b.lastIndex>0);var D=t.substring(0,A-1)+".json",N=new XMLHttpRequest;N.open("GET",D,!0),N.onerror=function(){p.a.Error("JSON ERROR: Unable to load JSON file."),n._fromPacked=!1,n._packedAndReady=!1},N.onload=function(){try{var j=JSON.parse(N.response),k=Reflect.ownKeys(j.frames);n._spriteMap=k,n._packedAndReady=!0,n._cellData=j.frames}catch(H){throw n._fromPacked=!1,n._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}},N.send()}},i.prototype._checkTextureAlpha=function(t,e,n,r,o){if(!t.useAlphaForPicking||!this.texture)return!0;var l=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(l.width*l.height*4),this.texture.readPixels(0,0,this._textureContent));var h=d.c.Vector3[0];h.copyFrom(e.direction),h.normalize(),h.scaleInPlace(n),h.addInPlace(e.origin);var v=(h.x-r.x)/(o.x-r.x)-.5,b=1-(h.y-r.y)/(o.y-r.y)-.5,A=t.angle,D=v*Math.cos(A)-b*Math.sin(A)+.5,N=v*Math.sin(A)+b*Math.cos(A)+.5,j=t._xOffset*l.width+D*t._xSize|0,k=t._yOffset*l.height+N*t._ySize|0;return this._textureContent[4*(j+k*l.width)+3]>.5},i.prototype.intersects=function(t,e,n,r){for(var o=Math.min(this.capacity,this.sprites.length),l=d.e.Zero(),h=d.e.Zero(),v=Number.MAX_VALUE,b=null,A=d.c.Vector3[0],D=d.c.Vector3[1],N=e.getViewMatrix(),j=0;j<o;j++){var k=this.sprites[j];if(k){if(n){if(!n(k))continue}else if(!k.isPickable)continue;if(d.e.TransformCoordinatesToRef(k.position,N,D),l.copyFromFloats(D.x-k.width/2,D.y-k.height/2,D.z),h.copyFromFloats(D.x+k.width/2,D.y+k.height/2,D.z),t.intersectsBoxMinMax(l,h)){var H=d.e.Distance(D,t.origin);if(v>H){if(!this._checkTextureAlpha(k,t,H,l,h))continue;if(v=H,b=k,r)break}}}}if(b){var J=new xa.a;N.invertToRef(d.c.Matrix[0]),J.hit=!0,J.pickedSprite=b,J.distance=v;var te=d.c.Vector3[2];return te.copyFrom(t.direction),te.normalize(),te.scaleInPlace(v),t.origin.addToRef(te,A),J.pickedPoint=d.e.TransformCoordinates(A,d.c.Matrix[0]),J}return null},i.prototype.multiIntersects=function(t,e,n){for(var r,o=Math.min(this.capacity,this.sprites.length),l=d.e.Zero(),h=d.e.Zero(),v=[],b=d.c.Vector3[0].copyFromFloats(0,0,0),A=d.c.Vector3[1].copyFromFloats(0,0,0),D=e.getViewMatrix(),N=0;N<o;N++){var j=this.sprites[N];if(j){if(n){if(!n(j))continue}else if(!j.isPickable)continue;if(d.e.TransformCoordinatesToRef(j.position,D,A),l.copyFromFloats(A.x-j.width/2,A.y-j.height/2,A.z),h.copyFromFloats(A.x+j.width/2,A.y+j.height/2,A.z),t.intersectsBoxMinMax(l,h)){if(r=d.e.Distance(A,t.origin),!this._checkTextureAlpha(j,t,r,l,h))continue;var k=new xa.a;v.push(k),D.invertToRef(d.c.Matrix[0]),k.hit=!0,k.pickedSprite=j,k.distance=r;var H=d.c.Vector3[2];H.copyFrom(t.direction),H.normalize(),H.scaleInPlace(r),t.origin.addToRef(H,b),k.pickedPoint=d.e.TransformCoordinates(b,d.c.Matrix[0])}}}return v},i.prototype.render=function(){if(!this._fromPacked||this._packedAndReady&&this._spriteMap&&this._cellData){var t=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,t,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}},i.prototype.dispose=function(){this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null;var t=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.serialize=function(t){t===void 0&&(t=!1);var e={};e.name=this.name,e.capacity=this.capacity,e.cellWidth=this.cellWidth,e.cellHeight=this.cellHeight,this.texture&&(t?e.texture=this.texture.serialize():(e.textureUrl=this.texture.name,e.invertY=this.texture._invertY)),e.sprites=[];for(var n=0,r=this.sprites;n<r.length;n++){var o=r[n];e.sprites.push(o.serialize())}return e},i.Parse=function(t,e,n){var r=new i(t.name,"",t.capacity,{width:t.cellWidth,height:t.cellHeight},e);t.texture?r.texture=Ve.a.Parse(t.texture,e,n):t.textureName&&(r.texture=new Ve.a(n+t.textureUrl,e,!1,t.invertY===void 0||t.invertY));for(var o=0,l=t.sprites;o<l.length;o++){var h=l[o];yE.Parse(h,r)}return r},i.ParseFromFileAsync=function(t,e,n,r){return r===void 0&&(r=""),new Promise(function(o,l){var h=new re.a;h.addEventListener("readystatechange",function(){if(h.readyState==4)if(h.status==200){var v=JSON.parse(h.responseText),b=i.Parse(v,n||Xe.a.LastCreatedScene,r);t&&(b.name=t),o(b)}else l("Unable to load the sprite manager")}),h.open("GET",e),h.send()})},i.CreateFromSnippetAsync=function(t,e,n){var r=this;return n===void 0&&(n=""),t==="_BLANK"?Promise.resolve(new i("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,e)):new Promise(function(o,l){var h=new re.a;h.addEventListener("readystatechange",function(){if(h.readyState==4)if(h.status==200){var v=JSON.parse(JSON.parse(h.responseText).jsonPayload),b=JSON.parse(v.spriteManager),A=i.Parse(b,e||Xe.a.LastCreatedScene,n);A.snippetId=t,o(A)}else l("Unable to load the snippet "+t)}),h.open("GET",r.SnippetUrl+"/"+t.replace(/#/g,"/")),h.send()})},i.SnippetUrl="https://snippet.babylonjs.com",i}(),KL=`precision highp float;
varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
uniform float time;
uniform float spriteCount;
uniform sampler2D spriteSheet;
uniform vec2 spriteMapSize;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform sampler2D frameMap;
uniform sampler2D tileMaps[LAYERS];
uniform sampler2D animationMap;
uniform vec3 colorMul;
float mt;
const float fdStep=1./4.;
const float aFrameSteps=1./MAX_ANIMATION_FRAMES;
mat4 getFrameData(float frameID){
float fX=frameID/spriteCount;
return mat4(
texture2D(frameMap,vec2(fX,0.),0.),
texture2D(frameMap,vec2(fX,fdStep*1.),0.),
texture2D(frameMap,vec2(fX,fdStep*2.),0.),
vec4(0.)
);
}
void main(){
vec4 color=vec4(0.);
vec2 tileUV=fract(tUV);
#ifdef FLIPU
tileUV.y=1.0-tileUV.y;
#endif
vec2 tileID=floor(tUV);
vec2 sheetUnits=1./spriteMapSize;
float spriteUnits=1./spriteCount;
vec2 stageUnits=1./stageSize;
for(int i=0; i<LAYERS; i++) {
float frameID;
#define LAYER_ID_SWITCH
vec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);
if(animationData.y>0.) {
mt=mod(time*animationData.z,1.0);
for(float f=0.; f<MAX_ANIMATION_FRAMES; f++){
if(animationData.y>mt){
frameID=animationData.x;
break;
}
animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);
}
}

mat4 frameData=getFrameData(frameID+0.5);
vec2 frameSize=(frameData[0].wz)/spriteMapSize;
vec2 offset=frameData[0].xy*sheetUnits;
vec2 ratio=frameData[2].xy/frameData[0].wz;

if (frameData[2].z == 1.){
tileUV.xy=tileUV.yx;
}
if (i == 0){
color=texture2D(spriteSheet,tileUV*frameSize+offset);
} else {
vec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);
float alpha=min(color.a+nc.a,1.0);
vec3 mixed=mix(color.xyz,nc.xyz,nc.a);
color=vec4(mixed,alpha);
}
}
color.xyz*=colorMul;
gl_FragColor=color;
}`;We.a.ShadersStore.spriteMapPixelShader=KL;var QL=`precision highp float;

attribute vec3 position;
attribute vec3 normal;
attribute vec2 uv;

varying vec3 vPosition;
varying vec2 vUV;
varying vec2 tUV;
varying vec2 stageUnits;
varying vec2 levelUnits;
varying vec2 tileID;

uniform float time;
uniform mat4 worldViewProjection;
uniform vec2 outputSize;
uniform vec2 stageSize;
uniform vec2 spriteMapSize;
uniform float stageScale;
void main() {
vec4 p=vec4( position,1. );
vPosition=p.xyz;
vUV=uv;
tUV=uv*stageSize;
gl_Position=worldViewProjection*p;
}`;We.a.ShadersStore.spriteMapVertexShader=QL;var Ni,qL=function(){function i(t,e,n,r,o){var l=this;this.name=t,this.sprites=[],this.atlasJSON=e,this.sprites=this.atlasJSON.frames,this.spriteSheet=n,this.options=r,r.stageSize=r.stageSize||new d.d(1,1),r.outputSize=r.outputSize||r.stageSize,r.outputPosition=r.outputPosition||d.e.Zero(),r.outputRotation=r.outputRotation||d.e.Zero(),r.layerCount=r.layerCount||1,r.maxAnimationFrames=r.maxAnimationFrames||0,r.baseTile=r.baseTile||0,r.flipU=r.flipU||!1,r.colorMultiply=r.colorMultiply||new d.e(1,1,1),this._scene=o,this._frameMap=this._createFrameBuffer(),this._tileMaps=new Array;for(var h=0;h<r.layerCount;h++)this._tileMaps.push(this._createTileBuffer(null,h));this._animationMap=this._createTileAnimationBuffer(null);var v=[];v.push("#define LAYERS "+r.layerCount),r.flipU&&v.push("#define FLIPU"),v.push("#define MAX_ANIMATION_FRAMES "+r.maxAnimationFrames+".0");var b,A=We.a.ShadersStore.spriteMapPixelShader;if(this._scene.getEngine().webGLVersion===1)for(b="",h=0;h<r.layerCount;h++)b+="if ("+h+" == i) { frameID = texture2D(tileMaps["+h+"], (tileID + 0.5) / stageSize, 0.).x; }";else{for(b="switch(i) {",h=0;h<r.layerCount;h++)b+="case "+h+" : frameID = texture(tileMaps["+h+"], (tileID + 0.5) / stageSize, 0.).x;",b+="break;";b+="}"}We.a.ShadersStore["spriteMap"+this.name+"PixelShader"]=A.replace("#define LAYER_ID_SWITCH",b),this._material=new vh.a("spriteMap:"+this.name,this._scene,{vertex:"spriteMap",fragment:"spriteMap"+this.name},{defines:v,attributes:["position","normal","uv"],uniforms:["worldViewProjection","time","stageSize","outputSize","spriteMapSize","spriteCount","time","colorMul","mousePosition","curTile","flipU"],samplers:["spriteSheet","frameMap","tileMaps","animationMap"],needAlphaBlending:!0}),this._time=0,this._material.setFloat("spriteCount",this.spriteCount),this._material.setVector2("stageSize",r.stageSize),this._material.setVector2("outputSize",r.outputSize),this._material.setTexture("spriteSheet",this.spriteSheet),this._material.setVector2("spriteMapSize",new d.d(1,1)),this._material.setVector3("colorMul",r.colorMultiply);var D=0,N=function(){l.spriteSheet&&l.spriteSheet.isReady()&&l.spriteSheet._texture?l._material.setVector2("spriteMapSize",new d.d(l.spriteSheet._texture.baseWidth||1,l.spriteSheet._texture.baseHeight||1)):D<100&&setTimeout(function(){D++,N()},100)};N(),this._material.setVector3("colorMul",r.colorMultiply),this._material.setTexture("frameMap",this._frameMap),this._material.setTextureArray("tileMaps",this._tileMaps),this._material.setTexture("animationMap",this._animationMap),this._material.setFloat("time",this._time),this._output=Ne.a.CreatePlane(t+":output",1,o,!0),this._output.scaling.x=r.outputSize.x,this._output.scaling.y=r.outputSize.y,this.position=r.outputPosition,this.rotation=r.outputRotation,this._scene.onBeforeRenderObservable.add(function(){l._time+=l._scene.getEngine().getDeltaTime(),l._material.setFloat("time",l._time)}),this._output.material=this._material}return Object.defineProperty(i.prototype,"spriteCount",{get:function(){return this.sprites.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._output.position},set:function(t){this._output.position=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._output.rotation},set:function(t){this._output.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationMap",{get:function(){return this._animationMap},set:function(t){var e=t._texture._bufferView,n=this._createTileAnimationBuffer(e);this._animationMap.dispose(),this._animationMap=n,this._material.setTexture("animationMap",this._animationMap)},enumerable:!1,configurable:!0}),i.prototype.getTileID=function(){var t=this.getMousePosition();return t.multiplyInPlace(this.options.stageSize||d.d.Zero()),t.x=Math.floor(t.x),t.y=Math.floor(t.y),t},i.prototype.getMousePosition=function(){var t=this._output,e=this._scene.pick(this._scene.pointerX,this._scene.pointerY,function(r){return r===t});if(!e||!e.hit||!e.getTextureCoordinates)return new d.d(-1,-1);var n=e.getTextureCoordinates();return n||new d.d(-1,-1)},i.prototype._createFrameBuffer=function(){for(var t=new Array,e=0;e<this.spriteCount;e++)t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0),t.push(0,0,0,0);for(e=0;e<this.spriteCount;e++){var n=this.sprites[e].frame,r=this.sprites[e].spriteSourceSize,o=this.sprites[e].sourceSize,l=this.sprites[e].rotated?1:0,h=this.sprites[e].trimmed?1:0;t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.w,t[4*e+3]=n.h,t[4*e+4*this.spriteCount]=r.x,t[4*e+1+4*this.spriteCount]=r.y,t[4*e+3+4*this.spriteCount]=r.h,t[4*e+8*this.spriteCount]=o.w,t[4*e+1+8*this.spriteCount]=o.h,t[4*e+2+8*this.spriteCount]=l,t[4*e+3+8*this.spriteCount]=h}var v=new Float32Array(t);return hr.CreateRGBATexture(v,this.spriteCount,4,this._scene,!1,!1,Ve.a.NEAREST_NEAREST,Xe.a.TEXTURETYPE_FLOAT)},i.prototype._createTileBuffer=function(t,e){e===void 0&&(e=0);var n=new Array,r=this.options.stageSize.y||0,o=this.options.stageSize.x||0;if(t)n=t;else{var l=this.options.baseTile;e!=0&&(l=0);for(var h=0;h<r;h++)for(var v=0;v<4*o;v+=4)n.push(l,0,0,0)}var b=new Float32Array(n);return hr.CreateRGBATexture(b,o,r,this._scene,!1,!1,Ve.a.NEAREST_NEAREST,Xe.a.TEXTURETYPE_FLOAT)},i.prototype.changeTiles=function(t,e,n){var r;if(t===void 0&&(t=0),n===void 0&&(n=0),(r=this._tileMaps[t]._texture._bufferView)!==null){var o=new Array;e instanceof d.d?o.push(e):o=e;for(var l=this.options.stageSize.x||0,h=0;h<o.length;h++){var v=o[h];v.x=Math.floor(v.x),v.y=Math.floor(v.y),r[4*v.x+v.y*(4*l)]=n}var b=this._createTileBuffer(r);this._tileMaps[t].dispose(),this._tileMaps[t]=b,this._material.setTextureArray("tileMap",this._tileMaps)}},i.prototype._createTileAnimationBuffer=function(t){var e,n=new Array;if(t)e=t;else{for(var r=0;r<this.spriteCount;r++){n.push(0,0,0,0);for(var o=1;o<(this.options.maxAnimationFrames||4);)n.push(0,0,0,0),o++}e=new Float32Array(n)}return hr.CreateRGBATexture(e,this.spriteCount,this.options.maxAnimationFrames||4,this._scene,!1,!1,Ve.a.NEAREST_NEAREST,Xe.a.TEXTURETYPE_FLOAT)},i.prototype.addAnimationToTile=function(t,e,n,r,o){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0),r===void 0&&(r=0),o===void 0&&(o=1);var l=this._animationMap._texture._bufferView,h=4*t+4*this.spriteCount*e;if(l){l[h]=n,l[h+1]=r,l[h+2]=o;var v=this._createTileAnimationBuffer(l);this._animationMap.dispose(),this._animationMap=v,this._material.setTexture("animationMap",this._animationMap)}},i.prototype.saveTileMaps=function(){for(var t="",e=0;e<this._tileMaps.length;e++)e>0&&(t+=`
\r`),t+=this._tileMaps[e]._texture._bufferView.toString();var n=document.createElement("a");n.href="data:octet/stream;charset=utf-8,"+encodeURI(t),n.target="_blank",n.download=this.name+".tilemaps",n.click(),n.remove()},i.prototype.loadTileMaps=function(t){var e=this,n=new XMLHttpRequest;n.open("GET",t);var r=this.options.layerCount||0;n.onload=function(){for(var o=n.response.split(`
\r`),l=0;l<r;l++){var h=o[l].split(",").map(Number),v=e._createTileBuffer(h);e._tileMaps[l].dispose(),e._tileMaps[l]=v}e._material.setTextureArray("tileMap",e._tileMaps)},n.send()},i.prototype.dispose=function(){this._output.dispose(),this._material.dispose(),this._animationMap.dispose(),this._tileMaps.forEach(function(t){t.dispose()}),this._frameMap.dispose()},i}(),ZL=function(i){function t(e,n,r,o,l,h,v){l===void 0&&(l=null),h===void 0&&(h=.01),v===void 0&&(v=Ve.a.TRILINEAR_SAMPLINGMODE);var b=i.call(this,e,n,r,64,o,h,v,!0,l)||this;return b.name=e,b}return Object(_.d)(t,i),t}(EE),$L=c(143),JL=c(141),eN=c(142),tN=c(139);(function(i){i[i.INIT=0]="INIT",i[i.RUNNING=1]="RUNNING",i[i.DONE=2]="DONE",i[i.ERROR=3]="ERROR"})(Ni||(Ni={}));var Jm,Fi=function(){function i(t){this.name=t,this._isCompleted=!1,this._taskState=Ni.INIT}return Object.defineProperty(i.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"taskState",{get:function(){return this._taskState},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),i.prototype._setErrorObject=function(t,e){this._errorObject||(this._errorObject={message:t,exception:e})},i.prototype.run=function(t,e,n){var r=this;this._taskState=Ni.RUNNING,this.runTask(t,function(){r.onDoneCallback(e,n)},function(o,l){r.onErrorCallback(n,o,l)})},i.prototype.runTask=function(t,e,n){throw new Error("runTask is not implemented")},i.prototype.reset=function(){this._taskState=Ni.INIT},i.prototype.onErrorCallback=function(t,e,n){this._taskState=Ni.ERROR,this._errorObject={message:e,exception:n},this.onError&&this.onError(this,e,n),t()},i.prototype.onDoneCallback=function(t,e){try{this._taskState=Ni.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),t()}catch(n){this.onErrorCallback(e,"Task is done, error executing success callback(s)",n)}},i}(),SE=function(i,t,e){this.remainingCount=i,this.totalCount=t,this.task=e},xE=function(i){function t(e,n,r,o){var l=i.call(this,e)||this;return l.name=e,l.meshesNames=n,l.rootUrl=r,l.sceneFilename=o,l}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;Zt.LoadAssetContainer(this.rootUrl,this.sceneFilename,e,function(l){o.loadedContainer=l,o.loadedMeshes=l.meshes,o.loadedParticleSystems=l.particleSystems,o.loadedSkeletons=l.skeletons,o.loadedAnimationGroups=l.animationGroups,n()},null,function(l,h,v){r(h,v)})},t}(Fi),PE=function(i){function t(e,n,r,o){var l=i.call(this,e)||this;return l.name=e,l.meshesNames=n,l.rootUrl=r,l.sceneFilename=o,l}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;Zt.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(l,h,v,b){o.loadedMeshes=l,o.loadedParticleSystems=h,o.loadedSkeletons=v,o.loadedAnimationGroups=b,n()},null,function(l,h,v){r(h,v)})},t}(Fi),AE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(l){o.text=l,n()},void 0,!1,!1,function(l,h){l&&r(l.status+" "+l.statusText,h)})},t}(Fi),CE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this;e._loadFile(this.url,function(l){o.data=l,n()},void 0,!0,!0,function(l,h){l&&r(l.status+" "+l.statusText,h)})},t}(Fi),RE=function(i){function t(e,n){var r=i.call(this,e)||this;return r.name=e,r.url=n,r}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){var o=this,l=new Image;Qe.b.SetCorsBehavior(this.url,l),l.onload=function(){o.image=l,n()},l.onerror=function(h){r("Error loading image",h)},l.src=this.url},t}(Fi),OE=function(i){function t(e,n,r,o,l){o===void 0&&(o=!0),l===void 0&&(l=Ve.a.TRILINEAR_SAMPLINGMODE);var h=i.call(this,e)||this;return h.name=e,h.url=n,h.noMipmap=r,h.invertY=o,h.samplingMode=l,h}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new Ve.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){n()},function(o,l){r(o,l)})},t}(Fi),ME=function(i){function t(e,n,r,o,l){var h=i.call(this,e)||this;return h.name=e,h.url=n,h.extensions=r,h.noMipmap=o,h.files=l,h}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new di(this.url,e,this.extensions,this.noMipmap,this.files,function(){n()},function(o,l){r(o,l)})},t}(Fi),IE=function(i){function t(e,n,r,o,l,h,v){o===void 0&&(o=!1),l===void 0&&(l=!0),h===void 0&&(h=!1),v===void 0&&(v=!1);var b=i.call(this,e)||this;return b.name=e,b.url=n,b.size=r,b.noMipmap=o,b.generateHarmonics=l,b.gammaSpace=h,b.reserved=v,b}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new ph(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){n()},function(o,l){r(o,l)})},t}(Fi),DE=function(i){function t(e,n,r,o,l){o===void 0&&(o=!1),l===void 0&&(l=!0);var h=i.call(this,e)||this;return h.name=e,h.url=n,h.size=r,h.noMipmap=o,h.gammaSpace=l,h}return Object(_.d)(t,i),t.prototype.runTask=function(e,n,r){this.texture=new A0(this.url,e,this.size,this.noMipmap,this.gammaSpace,function(){n()},function(o,l){r(o,l)})},t}(Fi),nN=function(){function i(t){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new E.c,this.onTaskErrorObservable=new E.c,this.onTasksDoneObservable=new E.c,this.onProgressObservable=new E.c,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=t}return i.prototype.addContainerTask=function(t,e,n,r){var o=new xE(t,e,n,r);return this._tasks.push(o),o},i.prototype.addMeshTask=function(t,e,n,r){var o=new PE(t,e,n,r);return this._tasks.push(o),o},i.prototype.addTextFileTask=function(t,e){var n=new AE(t,e);return this._tasks.push(n),n},i.prototype.addBinaryFileTask=function(t,e){var n=new CE(t,e);return this._tasks.push(n),n},i.prototype.addImageTask=function(t,e){var n=new RE(t,e);return this._tasks.push(n),n},i.prototype.addTextureTask=function(t,e,n,r,o){o===void 0&&(o=Ve.a.TRILINEAR_SAMPLINGMODE);var l=new OE(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.addCubeTextureTask=function(t,e,n,r,o){var l=new ME(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.addHDRCubeTextureTask=function(t,e,n,r,o,l,h){r===void 0&&(r=!1),o===void 0&&(o=!0),l===void 0&&(l=!1),h===void 0&&(h=!1);var v=new IE(t,e,n,r,o,l,h);return this._tasks.push(v),v},i.prototype.addEquiRectangularCubeTextureAssetTask=function(t,e,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=!0);var l=new DE(t,e,n,r,o);return this._tasks.push(l),l},i.prototype.removeTask=function(t){var e=this._tasks.indexOf(t);e>-1&&this._tasks.splice(e,1)},i.prototype._decreaseWaitingTasksCount=function(t){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,t),this.onProgressObservable.notifyObservers(new SE(this._waitingTasksCount,this._totalTasksCount,t))}catch(l){p.a.Error("Error running progress callbacks."),console.log(l)}if(this._waitingTasksCount===0){try{var e=this._tasks.slice();this.onFinish&&this.onFinish(e);for(var n=0,r=e;n<r.length;n++)if((t=r[n]).taskState===Ni.DONE){var o=this._tasks.indexOf(t);o>-1&&this._tasks.splice(o,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(l){p.a.Error("Error running tasks-done callbacks."),console.log(l)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}},i.prototype._runTask=function(t){var e=this,n=function(r,o){t._setErrorObject(r,o),e.onTaskError&&e.onTaskError(t),e.onTaskErrorObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)};t.run(this._scene,function(){try{e.onTaskSuccess&&e.onTaskSuccess(t),e.onTaskSuccessObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)}catch(r){n("Error executing task success callbacks",r)}},n)},i.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},i.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,this._waitingTasksCount===0)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var t=0;t<this._tasks.length;t++){var e=this._tasks[t];e.taskState===Ni.INIT&&this._runTask(e)}return this},i.prototype.loadAsync=function(){var t=this;return new Promise(function(e,n){t._isLoading?e():(t.onTasksDoneObservable.addOnce(function(r){r&&r.length?n(r):e()}),t.load())})},i}(),rN=function(){function i(){var t=this;this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return Object.defineProperty(i.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),i}(),iN=function(){function i(t,e){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=d.e.Zero(),this._newPosition=d.e.Zero(),this._centerPosition=d.e.Zero(),this._meshes=t.slice(),e?this._centerMesh=e:this._setCenterMesh();var n=this._meshes.indexOf(this._centerMesh);n>=0&&this._meshes.splice(n,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var r=0;r<this._meshes.length;r++)if(this._meshes[r]){var o=this._meshes[r];this._meshesOrigins[r]=o.getAbsolutePosition().clone(),this._toCenterVectors[r]=d.e.Zero(),o._boundingInfo&&this._centerMesh._boundingInfo&&o._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[r])}}return i.prototype._setCenterMesh=function(){for(var t=d.e.Zero(),e=d.e.Zero(),n=Number.MAX_VALUE,r=0;r<this._meshes.length;r++)this._meshes[r]&&(l=(o=this._meshes[r]).getBoundingInfo())&&e.addInPlace(l.boundingBox.centerWorld);for(t=e.scale(1/this._meshes.length),r=0;r<this._meshes.length;r++){var o,l;if(this._meshes[r]&&(l=(o=this._meshes[r]).getBoundingInfo())){var h=l.boundingBox.centerWorld.subtract(t).lengthSquared();h<n&&(this._centerMesh=o,n=h)}}},i.prototype.getClassName=function(){return"MeshExploder"},i.prototype.getMeshes=function(){var t=this._meshes.slice();return t.unshift(this._centerMesh),t},i.prototype.explode=function(t){t===void 0&&(t=1);for(var e=0;e<this._meshes.length;e++)this._meshes[e]&&this._meshesOrigins[e]&&this._toCenterVectors[e]&&(this._toCenterVectors[e].scaleToRef(t,this._scaledDirection),this._meshesOrigins[e].addToRef(this._scaledDirection,this._newPosition),this._meshes[e].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},i}(),oN=function(){function i(t,e,n,r,o,l,h,v,b){this.onProcessFileCallback=function(){return!0},this._engine=t,this._currentScene=e,this._sceneLoadedCallback=n,this._progressCallback=r,this._additionalRenderLoopLogicCallback=o,this._textureLoadingCallback=l,this._startingProcessingFilesCallback=h,this._onReloadCallback=v,this._errorCallback=b}return Object.defineProperty(i,"FilesToLoad",{get:function(){return Ip.a.FilesToLoad},enumerable:!1,configurable:!0}),i.prototype.monitorElementForDragNDrop=function(t){var e=this;t&&(this._elementToMonitor=t,this._dragEnterHandler=function(n){e.drag(n)},this._dragOverHandler=function(n){e.drag(n)},this._dropHandler=function(n){e.drop(n)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},Object.defineProperty(i.prototype,"filesToLoad",{get:function(){return this._filesToLoad},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},i.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var t=this._currentScene.getWaitingItemsCount();t>0&&this._textureLoadingCallback(t)}this._currentScene.render()}},i.prototype.drag=function(t){t.stopPropagation(),t.preventDefault()},i.prototype.drop=function(t){t.stopPropagation(),t.preventDefault(),this.loadFiles(t)},i.prototype._traverseFolder=function(t,e,n,r){var o=this,l=t.createReader(),h=t.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");l.readEntries(function(v){n.count+=v.length;for(var b=0,A=v;b<A.length;b++){var D=A[b];D.isFile?D.file(function(N){N.correctName=h+N.name,e.push(N),--n.count==0&&r()}):D.isDirectory&&o._traverseFolder(D,e,n,r)}--n.count==0&&r()})},i.prototype._processFiles=function(t){for(var e=0;e<t.length;e++){var n=t[e].correctName.toLowerCase(),r=n.split(".").pop();this.onProcessFileCallback(t[e],n,r)&&(Zt.IsPluginForExtensionAvailable("."+r)&&(this._sceneFileToLoad=t[e]),i.FilesToLoad[n]=t[e])}},i.prototype.loadFiles=function(t){var e=this;if(t&&t.dataTransfer&&t.dataTransfer.files&&(this._filesToLoad=t.dataTransfer.files),t&&t.target&&t.target.files&&(this._filesToLoad=t.target.files),this._filesToLoad&&this._filesToLoad.length!==0&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var n=new Array,r=[],o=t.dataTransfer?t.dataTransfer.items:null,l=0;l<this._filesToLoad.length;l++){var h=this._filesToLoad[l],v=h.name.toLowerCase(),b=void 0;if(h.correctName=v,o){var A=o[l];A.getAsEntry?b=A.getAsEntry():A.webkitGetAsEntry&&(b=A.webkitGetAsEntry())}b&&b.isDirectory?r.push(b):n.push(h)}if(r.length===0)this._processFiles(n),this._processReload();else for(var D={count:r.length},N=0,j=r;N<j.length;N++){var k=j[N];this._traverseFolder(k,n,D,function(){e._processFiles(n),D.count===0&&e._processReload()})}}},i.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},i.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(p.a.errorsCount>0&&p.a.ClearLogCache(),this._engine.stopRenderLoop()),Zt.ShowLoadingScreen=!1,this._engine.displayLoadingUI(),Zt.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(e){t._progressCallback&&t._progressCallback(e)}).then(function(e){t._currentScene&&t._currentScene.dispose(),t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady(function(){t._engine.hideLoadingUI(),t._engine.runRenderLoop(function(){t.renderFunction()})})}).catch(function(e){t._engine.hideLoadingUI(),t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,e.message)})):p.a.Error("Please provide a valid .babylon file.")},i}(),wE=c(146),aN=c(145),Bi=function(){function i(t){t===void 0&&(t=0),this.priority=t}return i.prototype.getDescription=function(){return""},i.prototype.apply=function(t,e){return!0},i}(),wh=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=1024),r===void 0&&(r=.5);var o=i.call(this,e)||this;return o.priority=e,o.maximumSize=n,o.step=r,o}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,n){for(var r=!0,o=0;o<e.textures.length;o++){var l=e.textures[o];if(l.canRescale&&!l.getContext){var h=l.getSize();Math.max(h.width,h.height)>this.maximumSize&&(l.scale(this.step),r=!1)}}return r},t}(Bi),e_=function(i){function t(e,n,r){e===void 0&&(e=0),n===void 0&&(n=2),r===void 0&&(r=.25);var o=i.call(this,e)||this;return o.priority=e,o.maximumScale=n,o.step=r,o._currentScale=-1,o._directionOffset=1,o}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,n){return this._currentScale===-1&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),this._directionOffset===1?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(Bi),Lh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,n){return e.shadowsEnabled=n.isInImprovementMode,!0},t}(Bi),Nh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,n){return e.postProcessesEnabled=n.isInImprovementMode,!0},t}(Bi),Fh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,n){return e.lensFlaresEnabled=n.isInImprovementMode,!0},t}(Bi),LE=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,n){return!this.onApply||this.onApply(e,n)},t}(Bi),Bh=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,n){return e.particlesEnabled=n.isInImprovementMode,!0},t}(Bi),t_=function(i){function t(){return i!==null&&i.apply(this,arguments)||this}return Object(_.d)(t,i),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,n){return e.renderTargetsEnabled=n.isInImprovementMode,!0},t}(Bi),Uh=function(i){function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._canBeMerged=function(n){if(!(n instanceof Ne.a))return!1;var r=n;return!r.isDisposed()&&!(!r.isVisible||!r.isEnabled())&&!(r.instances.length>0)&&!r.skeleton&&!r.hasLODLevels},e}return Object(_.d)(t,i),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(e){t._UpdateSelectionTree=e},enumerable:!1,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(e,n,r){for(var o=e.meshes.slice(0),l=o.length,h=0;h<l;h++){var v=new Array,b=o[h];if(this._canBeMerged(b)){v.push(b);for(var A=h+1;A<l;A++){var D=o[A];this._canBeMerged(D)&&D.material===b.material&&D.checkCollisions===b.checkCollisions&&(v.push(D),l--,o.splice(A,1),A--)}v.length<2||Ne.a.MergeMeshes(v,void 0,!0)}}var N=e;return N.createOrUpdateSelectionOctree&&(r!=null?r&&N.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&N.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(Bi),n_=function(){function i(t,e){t===void 0&&(t=60),e===void 0&&(e=2e3),this.targetFrameRate=t,this.trackerDuration=e,this.optimizations=new Array}return i.prototype.addOptimization=function(t){return this.optimizations.push(t),this},i.prototype.addCustomOptimization=function(t,e,n){n===void 0&&(n=0);var r=new LE(n);return r.onApply=t,r.onGetDescription=e,this.optimizations.push(r),this},i.LowDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Uh(n)),e.addOptimization(new Lh(n)),e.addOptimization(new Fh(n)),n++,e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new wh(n,1024)),e},i.ModerateDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Uh(n)),e.addOptimization(new Lh(n)),e.addOptimization(new Fh(n)),n++,e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new wh(n,512)),n++,e.addOptimization(new t_(n)),n++,e.addOptimization(new e_(n,2)),e},i.HighDegradationAllowed=function(t){var e=new i(t),n=0;return e.addOptimization(new Uh(n)),e.addOptimization(new Lh(n)),e.addOptimization(new Fh(n)),n++,e.addOptimization(new Nh(n)),e.addOptimization(new Bh(n)),n++,e.addOptimization(new wh(n,256)),n++,e.addOptimization(new t_(n)),n++,e.addOptimization(new e_(n,4)),e},i}(),sN=function(){function i(t,e,n,r){var o=this;if(n===void 0&&(n=!0),r===void 0&&(r=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new E.c,this.onNewOptimizationAppliedObservable=new E.c,this.onFailureObservable=new E.c,this._options=e||new n_,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),n)for(var l=0,h=0,v=this._options.optimizations;h<v.length;h++)v[h].priority=l++;this._improvementMode=r,this._scene=t||$.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){o._sceneDisposeObserver=null,o.dispose()})}return Object.defineProperty(i.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(t){this._targetFrameRate=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(t){this._trackerDuration=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!1,configurable:!0}),i.prototype.stop=function(){this._isRunning=!1},i.prototype.reset=function(){this._currentPriorityLevel=0},i.prototype.start=function(){var t=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)}))},i.prototype._checkCurrentState=function(){var t=this;if(this._isRunning){var e=this._scene,n=this._options;if(this._currentFrameRate=Math.round(e.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var r=!0,o=!0,l=0;l<n.optimizations.length;l++){var h=n.optimizations[l];h.priority===this._currentPriorityLevel&&(o=!1,r=r&&h.apply(e,this),this.onNewOptimizationAppliedObservable.notifyObservers(h))}if(o)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);r&&this._currentPriorityLevel++,e.executeWhenReady(function(){setTimeout(function(){t._checkCurrentState()},t._trackerDuration)})}},i.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},i.OptimizeAsync=function(t,e,n,r){var o=new i(t,e||n_.ModerateDegradationAllowed(),!1);return n&&o.onSuccessObservable.add(function(){n()}),r&&o.onFailureObservable.add(function(){r()}),o.start(),o},i}(),Vh=[],r_=function(i,t){Vh[i.id]||i.doNotSerialize||(t.vertexData.push(i.serializeVerticeData()),Vh[i.id]=!0)},NE=function(i,t){var e={},n=i._geometry;return n&&(i.getScene().getGeometryByID(n.id)||r_(n,t.geometries)),i.serialize&&i.serialize(e),e},i_=function(){function i(){}return i.ClearCache=function(){Vh=[]},i.Serialize=function(t){var e,n,r,o={};if(i.ClearCache(),o.useDelayedTextureLoading=t.useDelayedTextureLoading,o.autoClear=t.autoClear,o.clearColor=t.clearColor.asArray(),o.ambientColor=t.ambientColor.asArray(),o.gravity=t.gravity.asArray(),o.collisionsEnabled=t.collisionsEnabled,t.fogMode&&t.fogMode!==0&&(o.fogMode=t.fogMode,o.fogColor=t.fogColor.asArray(),o.fogStart=t.fogStart,o.fogEnd=t.fogEnd,o.fogDensity=t.fogDensity),t.isPhysicsEnabled()){var l=t.getPhysicsEngine();l&&(o.physicsEnabled=!0,o.physicsGravity=l.gravity.asArray(),o.physicsEngine=l.getPhysicsPluginName())}t.metadata&&(o.metadata=t.metadata),o.morphTargetManagers=[];for(var h=0,v=t.meshes;h<v.length;h++){var b=(oe=v[h]).morphTargetManager;b&&o.morphTargetManagers.push(b.serialize())}for(o.lights=[],e=0;e<t.lights.length;e++)(n=t.lights[e]).doNotSerialize||o.lights.push(n.serialize());for(o.cameras=[],e=0;e<t.cameras.length;e++){var A=t.cameras[e];A.doNotSerialize||o.cameras.push(A.serialize())}if(t.activeCamera&&(o.activeCameraID=t.activeCamera.id),V.a.AppendSerializedAnimations(t,o),t.animationGroups&&t.animationGroups.length>0){o.animationGroups=[];for(var D=0;D<t.animationGroups.length;D++){var N=t.animationGroups[D];o.animationGroups.push(N.serialize())}}if(t.reflectionProbes&&t.reflectionProbes.length>0)for(o.reflectionProbes=[],e=0;e<t.reflectionProbes.length;e++){var j=t.reflectionProbes[e];o.reflectionProbes.push(j.serialize())}for(o.materials=[],o.multiMaterials=[],e=0;e<t.materials.length;e++)(r=t.materials[e]).doNotSerialize||o.materials.push(r.serialize());for(o.multiMaterials=[],e=0;e<t.multiMaterials.length;e++){var k=t.multiMaterials[e];o.multiMaterials.push(k.serialize())}for(t.environmentTexture&&(o.environmentTexture=t.environmentTexture.name),o.environmentIntensity=t.environmentIntensity,o.skeletons=[],e=0;e<t.skeletons.length;e++){var H=t.skeletons[e];H.doNotSerialize||o.skeletons.push(H.serialize())}for(o.transformNodes=[],e=0;e<t.transformNodes.length;e++)t.transformNodes[e].doNotSerialize||o.transformNodes.push(t.transformNodes[e].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],Vh=[];var J=t.getGeometries();for(e=0;e<J.length;e++){var te=J[e];te.isReady()&&r_(te,o.geometries)}for(o.meshes=[],e=0;e<t.meshes.length;e++){var oe;if((oe=t.meshes[e])instanceof Ne.a){var ce=oe;ce.doNotSerialize||ce.delayLoadState!==g.a.DELAYLOADSTATE_LOADED&&ce.delayLoadState!==g.a.DELAYLOADSTATE_NONE||o.meshes.push(NE(ce,o))}}for(o.particleSystems=[],e=0;e<t.particleSystems.length;e++)o.particleSystems.push(t.particleSystems[e].serialize(!1));for(o.postProcesses=[],e=0;e<t.postProcesses.length;e++)o.postProcesses.push(t.postProcesses[e].serialize());t.actionManager&&(o.actions=t.actionManager.serialize("scene"));for(var he=0,_e=t._serializableComponents;he<_e.length;he++)_e[he].serialize(o);return o},i.SerializeMesh=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r={};if(i.ClearCache(),t=t instanceof Array?t:[t],e||n)for(var o=0;o<t.length;++o)n&&t[o].getDescendants().forEach(function(l){l instanceof Ne.a&&t.indexOf(l)<0&&!l.doNotSerialize&&t.push(l)}),e&&t[o].parent&&t.indexOf(t[o].parent)<0&&!t[o].parent.doNotSerialize&&t.push(t[o].parent);return t.forEach(function(l){(function(h,v){if(h.delayLoadState===g.a.DELAYLOADSTATE_LOADED||h.delayLoadState===g.a.DELAYLOADSTATE_NONE){if(h.material&&!h.material.doNotSerialize)if(h.material instanceof Aa.a){if(v.multiMaterials=v.multiMaterials||[],v.materials=v.materials||[],!v.multiMaterials.some(function(j){return j.id===h.material.id})){v.multiMaterials.push(h.material.serialize());for(var b=function(j){j&&(v.materials.some(function(k){return k.id===j.id})||v.materials.push(j.serialize()))},A=0,D=h.material.subMaterials;A<D.length;A++)b(D[A])}}else v.materials=v.materials||[],v.materials.some(function(j){return j.id===h.material.id})||v.materials.push(h.material.serialize());var N=h._geometry;N&&(v.geometries||(v.geometries={},v.geometries.boxes=[],v.geometries.spheres=[],v.geometries.cylinders=[],v.geometries.toruses=[],v.geometries.grounds=[],v.geometries.planes=[],v.geometries.torusKnots=[],v.geometries.vertexData=[]),r_(N,v.geometries)),h.skeleton&&!h.skeleton.doNotSerialize&&(v.skeletons=v.skeletons||[],v.skeletons.push(h.skeleton.serialize())),v.meshes=v.meshes||[],v.meshes.push(NE(h,v))}})(l,r)}),r},i}(),cN=c(37),lN=function(){function i(){}return i.CreateResizedCopy=function(t,e,n,r){r===void 0&&(r=!0);var o=t.getScene(),l=o.getEngine(),h=new Un("resized"+t.name,{width:e,height:n},o,!t.noMipmap,!0,t._texture.type,!1,t.samplingMode,!1);h.wrapU=t.wrapU,h.wrapV=t.wrapV,h.uOffset=t.uOffset,h.vOffset=t.vOffset,h.uScale=t.uScale,h.vScale=t.vScale,h.uAng=t.uAng,h.vAng=t.vAng,h.wAng=t.wAng,h.coordinatesIndex=t.coordinatesIndex,h.level=t.level,h.anisotropicFilteringLevel=t.anisotropicFilteringLevel,h._texture.isReady=!1,t.wrapU=Ve.a.CLAMP_ADDRESSMODE,t.wrapV=Ve.a.CLAMP_ADDRESSMODE;var v=new wo("pass",1,null,r?Ve.a.BILINEAR_SAMPLINGMODE:Ve.a.NEAREST_SAMPLINGMODE,l,!1,g.a.TEXTURETYPE_UNSIGNED_INT);return v.getEffect().executeWhenCompiled(function(){v.onApply=function(A){A.setTexture("textureSampler",t)};var b=h.getInternalTexture();b&&(o.postProcessManager.directRender([v],b),l.unBindFramebuffer(b),h.disposeFramebufferObjects(),v.dispose(),b.isReady=!0)}),h},i}(),uN=function(){function i(t,e){if(e===void 0&&(e=null),!i.IsSupported(t))throw"Your browser does not support recording so far.";var n=t.getRenderingCanvas();if(!n)throw"The babylon engine must have a canvas to be recorded";this._canvas=n,this._canvas.isRecording=!1,this._options=Object(_.a)(Object(_.a)({},i._defaultOptions),e);var r=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var o=0,l=this._options.audioTracks;o<l.length;o++){var h=l[o];r.addTrack(h)}this._mediaRecorder=new MediaRecorder(r,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return i.IsSupported=function(t){var e=t.getRenderingCanvas();return!!e&&typeof e.captureStream=="function"},Object.defineProperty(i.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!1,configurable:!0}),i.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},i.prototype.startRecording=function(t,e){var n=this;if(t===void 0&&(t="babylonjs.webm"),e===void 0&&(e=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return e>0&&setTimeout(function(){n.stopRecording()},1e3*e),this._fileName=t,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(r,o){n._resolve=r,n._reject=o})},i.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},i.prototype._handleDataAvailable=function(t){t.data.size>0&&this._recordedChunks.push(t.data)},i.prototype._handleError=function(t){if(this.stopRecording(),!this._reject)throw new t.error;this._reject(t.error)},i.prototype._handleStop=function(){this.stopRecording();var t=new Blob(this._recordedChunks);this._resolve&&this._resolve(t),window.URL.createObjectURL(t),this._fileName&&Qe.b.Download(t,this._fileName)},i._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},i}(),yl=function(){function i(){}return i.CreateScreenshot=function(t,e,n,r,o){o===void 0&&(o="image/png");var l=i._getScreenshotSize(t,e,n),h=l.height,v=l.width;if(h&&v){Qe.b._ScreenshotCanvas||(Qe.b._ScreenshotCanvas=document.createElement("canvas")),Qe.b._ScreenshotCanvas.width=v,Qe.b._ScreenshotCanvas.height=h;var b=Qe.b._ScreenshotCanvas.getContext("2d"),A=t.getRenderWidth()/t.getRenderHeight(),D=v,N=D/A;N>h&&(D=(N=h)*A);var j=Math.max(0,v-D)/2,k=Math.max(0,h-N)/2,H=t.getRenderingCanvas();b&&H&&b.drawImage(H,j,k,D,N),Qe.b.EncodeScreenshotCanvasData(r,o)}else p.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotAsync=function(t,e,n,r){return r===void 0&&(r="image/png"),new Promise(function(o,l){i.CreateScreenshot(t,e,n,function(h){h!==void 0?o(h):l(new Error("Data is undefined"))},r)})},i.CreateScreenshotUsingRenderTarget=function(t,e,n,r,o,l,h,v,b,A){o===void 0&&(o="image/png"),l===void 0&&(l=1),h===void 0&&(h=!1),b===void 0&&(b=!1),A===void 0&&(A=!1);var D=i._getScreenshotSize(t,e,n),N=D.height,j=D.width,k={width:j,height:N};if(N&&j){var H=t.getRenderingCanvas();if(H){var J={width:H.width,height:H.height};t.setSize(j,N);var te=e.getScene(),oe=null,ce=te.activeCameras;(te.activeCamera!==e||te.activeCameras&&te.activeCameras.length)&&(oe=te.activeCamera,te.activeCamera=e),te.render();var he=new Un("screenShot",k,te,!1,!1,g.a.TEXTURETYPE_UNSIGNED_INT,!1,Ve.a.NEAREST_SAMPLINGMODE,void 0,A);he.renderList=null,he.samples=l,he.renderSprites=b,he.onAfterRenderObservable.add(function(){Qe.b.DumpFramebuffer(j,N,t,r,o,v)});var _e=function(){te.incrementRenderId(),te.resetCachedMaterial(),he.render(!0),he.dispose(),oe&&(te.activeCamera=oe),te.activeCameras=ce,t.setSize(J.width,J.height),e.getProjectionMatrix(!0)};if(h){var ye=new bl("antialiasing",1,te.activeCamera);he.addPostProcess(ye),ye.getEffect().isReady()?_e():ye.getEffect().onCompiled=function(){_e()}}else _e()}else p.a.Error("No rendering canvas found !")}else p.a.Error("Invalid 'size' parameter !")},i.CreateScreenshotUsingRenderTargetAsync=function(t,e,n,r,o,l,h,v){return r===void 0&&(r="image/png"),o===void 0&&(o=1),l===void 0&&(l=!1),v===void 0&&(v=!1),new Promise(function(b,A){i.CreateScreenshotUsingRenderTarget(t,e,n,function(D){D!==void 0?b(D):A(new Error("Data is undefined"))},r,o,l,h,v)})},i._getScreenshotSize=function(t,e,n){var r=0,o=0;if(typeof n=="object"){var l=n.precision?Math.abs(n.precision):1;n.width&&n.height?(r=n.height*l,o=n.width*l):n.width&&!n.height?(o=n.width*l,r=Math.round(o/t.getAspectRatio(e))):n.height&&!n.width?(r=n.height*l,o=Math.round(r*t.getAspectRatio(e))):(o=Math.round(t.getRenderWidth()*l),r=Math.round(o/t.getAspectRatio(e)))}else isNaN(n)||(r=n,o=n);return o&&(o=Math.floor(o)),r&&(r=Math.floor(r)),{height:0|r,width:0|o}},i}();Qe.b.CreateScreenshot=yl.CreateScreenshot,Qe.b.CreateScreenshotAsync=yl.CreateScreenshotAsync,Qe.b.CreateScreenshotUsingRenderTarget=yl.CreateScreenshotUsingRenderTarget,Qe.b.CreateScreenshotUsingRenderTargetAsync=yl.CreateScreenshotUsingRenderTargetAsync,function(i){i[i.Checkbox=0]="Checkbox",i[i.Slider=1]="Slider",i[i.Vector3=2]="Vector3",i[i.Quaternion=3]="Quaternion",i[i.Color3=4]="Color3",i[i.String=5]="String"}(Jm||(Jm={}));var Ds,hN=c(140),dN=function(){function i(t){this.byteOffset=0,this.buffer=t}return i.prototype.loadAsync=function(t){var e=this;return this.buffer.readAsync(this.byteOffset,t).then(function(n){e._dataView=new DataView(n.buffer,n.byteOffset,n.byteLength),e._dataByteOffset=0})},i.prototype.readUint32=function(){var t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t},i.prototype.readUint8Array=function(t){var e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,e},i.prototype.readString=function(t){return Jr.a.Decode(this.readUint8Array(t))},i.prototype.skipBytes=function(t){this._dataByteOffset+=t,this.byteOffset+=t},i}(),fN=function(){function i(){}return i._GetStorage=function(){try{return localStorage.setItem("test",""),localStorage.removeItem("test"),localStorage}catch(e){var t={};return{getItem:function(n){var r=t[n];return r===void 0?null:r},setItem:function(n,r){t[n]=r}}}},i.ReadString=function(t,e){var n=this._Storage.getItem(t);return n!==null?n:e},i.WriteString=function(t,e){this._Storage.setItem(t,e)},i.ReadBoolean=function(t,e){var n=this._Storage.getItem(t);return n!==null?n==="true":e},i.WriteBoolean=function(t,e){this._Storage.setItem(t,e?"true":"false")},i.ReadNumber=function(t,e){var n=this._Storage.getItem(t);return n!==null?parseFloat(n):e},i.WriteNumber=function(t,e){this._Storage.setItem(t,e.toString())},i._Storage=i._GetStorage(),i}(),pN=function(){function i(){this._trackedScene=null}return i.prototype.track=function(t){this._trackedScene=t,this._savedJSON=i_.Serialize(t)},i.prototype.getDelta=function(){if(!this._trackedScene)return null;var t=i_.Serialize(this._trackedScene),e={};for(var n in t)this._compareCollections(n,this._savedJSON[n],t[n],e);return e},i.prototype._compareArray=function(t,e,n,r){if(e.length===0&&n.length===0)return!0;if(e.length&&!isNaN(e[0])||n.length&&!isNaN(n[0])){if(e.length!==n.length)return!1;if(e.length===0)return!0;for(var o=0;o<e.length;o++)if(e[o]!==n[o])return r[t]=n,!1;return!0}var l=[],h=function(){var D=e[o],N=D.uniqueId;l.push(N);var j=n.filter(function(J){return J.uniqueId===N});if(j.length){var k=j[0],H={};v._compareObjects(D,k,H)||(r[t]||(r[t]=[]),H.__state={id:k.id||k.name},r[t].push(H))}else H={__state:{deleteId:D.id||D.name}},r[t].push(H)},v=this;for(o=0;o<e.length;o++)h();for(o=0;o<n.length;o++){var b=n[o],A=b.uniqueId;l.indexOf(A)===-1&&(r[t]||(r[t]=[]),r[t].push(b))}return!0},i.prototype._compareObjects=function(t,e,n){var r=!1;for(var o in t)if(t.hasOwnProperty(o)){var l=t[o],h=e[o],v=!1;Array.isArray(l)?v=JSON.stringify(l)!==JSON.stringify(h):isNaN(l)&&Object.prototype.toString.call(l)!="[object String]"||(v=l!==h),v&&(r=!0,n[o]=h)}return!r},i.prototype._compareCollections=function(t,e,n,r){if(e!==n&&e&&n){if(Array.isArray(e)&&Array.isArray(n)){if(this._compareArray(t,e,n,r))return}else if(typeof e=="object"&&typeof n=="object"){var o={};return void(this._compareObjects(e,n,o)||(r[t]=o))}}},i.GetShadowGeneratorById=function(t,e){for(var n=0,r=t.lights.map(function(l){return l.getShadowGenerator()});n<r.length;n++){var o=r[n];if(o&&o.id===e)return o}return null},i.ApplyDelta=function(t,e){var n=this;typeof t=="string"&&(t=JSON.parse(t));var r=e;for(var o in t){var l=t[o],h=r[o];if(Array.isArray(h)||o==="shadowGenerators")switch(o){case"cameras":this._ApplyDeltaForEntity(l,e,e.getCameraByID.bind(e),function(v){return Tt.a.Parse(v,e)});break;case"lights":this._ApplyDeltaForEntity(l,e,e.getLightByID.bind(e),function(v){return ro.a.Parse(v,e)});break;case"shadowGenerators":this._ApplyDeltaForEntity(l,e,function(v){return n.GetShadowGeneratorById(e,v)},function(v){return Dr.Parse(v,e)});break;case"meshes":this._ApplyDeltaForEntity(l,e,e.getMeshByID.bind(e),function(v){return Ne.a.Parse(v,e,"")});break;case"skeletons":this._ApplyDeltaForEntity(l,e,e.getSkeletonById.bind(e),function(v){return ga.Parse(v,e)});break;case"materials":this._ApplyDeltaForEntity(l,e,e.getMaterialByID.bind(e),function(v){return nn.a.Parse(v,e,"")});break;case"multiMaterials":this._ApplyDeltaForEntity(l,e,e.getMaterialByID.bind(e),function(v){return Aa.a.Parse(v,e,"")});break;case"transformNodes":this._ApplyDeltaForEntity(l,e,e.getTransformNodeByID.bind(e),function(v){return ps.a.Parse(v,e,"")});break;case"particleSystems":this._ApplyDeltaForEntity(l,e,e.getParticleSystemByID.bind(e),function(v){return jn.Parse(v,e,"")});break;case"morphTargetManagers":this._ApplyDeltaForEntity(l,e,e.getMorphTargetById.bind(e),function(v){return mh.Parse(v,e)});break;case"postProcesses":this._ApplyDeltaForEntity(l,e,e.getPostProcessByName.bind(e),function(v){return bt.Parse(v,e,"")})}else isNaN(h)?h.fromArray&&h.fromArray(l):r[o]=l}},i._ApplyPropertiesToEntity=function(t,e){for(var n in t){var r=t[n],o=e[n];o!==void 0&&(!isNaN(o)||Array.isArray(o)?e[n]=r:o.fromArray&&o.fromArray(r))}},i._ApplyDeltaForEntity=function(t,e,n,r){for(var o=0,l=t;o<l.length;o++){var h=l[o];if(h.__state&&h.__state.id!==void 0){var v=n(h.__state.id);v&&this._ApplyPropertiesToEntity(h,v)}else if(h.__state&&h.__state.deleteId!==void 0){var b=n(h.__state.deleteId);b==null||b.dispose()}else r(h)}},i}();(function(i){var t=function(){function n(r,o,l,h){var v;o===void 0&&(o=null),l===void 0&&(l=null),h===void 0&&(h=null),o=o??function(){return 1},l=l??function(){return 1},h=h??function(D,N){return D===N?0:1},this._characterToIdx=new Map,this._insertionCosts=new Array(r.length),this._deletionCosts=new Array(r.length),this._substitutionCosts=new Array(r.length);for(var b=0;b<r.length;++b){v=r[b],this._characterToIdx.set(v,b),this._insertionCosts[b]=o(v),this._deletionCosts[b]=l(v),this._substitutionCosts[b]=new Array(r.length);for(var A=b;A<r.length;++A)this._substitutionCosts[b][A]=h(v,r[A])}}return n.prototype.serialize=function(){var r={},o=new Array(this._characterToIdx.size);return this._characterToIdx.forEach(function(l,h){o[l]=h}),r.characters=o,r.insertionCosts=this._insertionCosts,r.deletionCosts=this._deletionCosts,r.substitutionCosts=this._substitutionCosts,JSON.stringify(r)},n.Deserialize=function(r){var o=JSON.parse(r),l=new n(o.characters);return l._insertionCosts=o.insertionCosts,l._deletionCosts=o.deletionCosts,l._substitutionCosts=o.substitutionCosts,l},n.prototype.getCharacterIdx=function(r){return this._characterToIdx.get(r)},n.prototype.getInsertionCost=function(r){return this._insertionCosts[r]},n.prototype.getDeletionCost=function(r){return this._deletionCosts[r]},n.prototype.getSubstitutionCost=function(r,o){var l=Math.min(r,o),h=Math.max(r,o);return this._substitutionCosts[l][h]},n}();i.Alphabet=t;var e=function(){function n(r,o){var l=this;if(r.length>n.MAX_SEQUENCE_LENGTH)throw new Error("Sequences longer than "+n.MAX_SEQUENCE_LENGTH+" not supported.");this._alphabet=o,this._characters=r.map(function(h){return l._alphabet.getCharacterIdx(h)})}return n.prototype.serialize=function(){return JSON.stringify(this._characters)},n.Deserialize=function(r,o){var l=new n([],o);return l._characters=JSON.parse(r),l},n.prototype.distance=function(r){return n._distance(this,r)},n._distance=function(r,o){var l=r._alphabet;if(l!==o._alphabet)throw new Error("Cannot Levenshtein compare Sequences built from different alphabets.");var h=r._characters,v=o._characters,b=h.length,A=v.length,D=n._costMatrix;D[0][0]=0;for(var N=0;N<b;++N)D[N+1][0]=D[N][0]+l.getInsertionCost(h[N]);for(N=0;N<A;++N)D[0][N+1]=D[0][N]+l.getInsertionCost(v[N]);for(var j=0;j<b;++j)for(var k=0;k<A;++k)n._insertionCost=D[j+1][k]+l.getInsertionCost(v[k]),n._deletionCost=D[j][k+1]+l.getDeletionCost(h[j]),n._substitutionCost=D[j][k]+l.getSubstitutionCost(h[j],v[k]),D[j+1][k+1]=Math.min(n._insertionCost,n._deletionCost,n._substitutionCost);return D[b][A]},n.MAX_SEQUENCE_LENGTH=256,n._costMatrix=Object(_.f)(Array(n.MAX_SEQUENCE_LENGTH+1)).map(function(r){return new Array(n.MAX_SEQUENCE_LENGTH+1)}),n}();i.Sequence=e})(Ds||(Ds={}));var mN=function(){function i(t){t===void 0&&(t=.01),this._points=[],this._segmentLength=t}return i.prototype.serialize=function(){return JSON.stringify(this)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i(e._segmentLength);return n._points=e._points.map(function(r){return new d.e(r._x,r._y,r._z)}),n},i.prototype.getLength=function(){return this._points.length*this._segmentLength},i.prototype.add=function(t){var e=this,n=this._points.length;if(n===0)this._points.push(t.clone());else for(var r=function(){return e._segmentLength/d.e.Distance(e._points[n-1],t)},o=r();o<=1;o=r()){var l=this._points[n-1].scale(1-o);t.scaleAndAddToRef(o,l),this._points.push(l),++n}},i.prototype.resampleAtTargetResolution=function(t){var e=new i(this.getLength()/t);return this._points.forEach(function(n){e.add(n)}),e},i.prototype.tokenize=function(t){for(var e=[],n=new d.e,r=2;r<this._points.length;++r)i._transformSegmentDirToRef(this._points[r-2],this._points[r-1],this._points[r],n)&&e.push(i._tokenizeSegment(n,t));return e},i._transformSegmentDirToRef=function(t,e,n,r){return e.subtractToRef(t,i._forwardDir),i._forwardDir.normalize(),e.scaleToRef(-1,i._inverseFromVec),i._inverseFromVec.normalize(),!(Math.abs(d.e.Dot(i._forwardDir,i._inverseFromVec))>.98)&&(d.e.CrossToRef(i._forwardDir,i._inverseFromVec,i._upDir),i._upDir.normalize(),d.a.LookAtLHToRef(t,e,i._upDir,i._lookMatrix),n.subtractToRef(e,i._fromToVec),i._fromToVec.normalize(),d.e.TransformNormalToRef(i._fromToVec,i._lookMatrix,r),!0)},i._tokenizeSegment=function(t,e){i._bestMatch=0,i._score=d.e.Dot(t,e[0]),i._bestScore=i._score;for(var n=1;n<e.length;++n)i._score=d.e.Dot(t,e[n]),i._score>i._bestScore&&(i._bestMatch=n,i._bestScore=i._score);return i._bestMatch},i._forwardDir=new d.e,i._inverseFromVec=new d.e,i._upDir=new d.e,i._fromToVec=new d.e,i._lookMatrix=new d.a,i}(),FE=function(){function i(t){this.chars=new Array(t)}return i.Generate=function(t,e,n,r,o){t===void 0&&(t=64),e===void 0&&(e=256),n===void 0&&(n=.1),r===void 0&&(r=.001),o===void 0&&(o=[]);for(var l,h,v=new i(t),b=0;b<t;++b)v.chars[b]=new d.e(Math.random()-.5,Math.random()-.5,Math.random()-.5),v.chars[b].normalize();for(b=0;b<o.length;++b)v.chars[b].copyFrom(o[b]);for(var A,D=new d.e,N=new d.e,j=0;j<e;++j){l=(1-(A=j/(e-1)))*n+A*r;var k=function(H){D.copyFromFloats(0,0,0),v.chars.forEach(function(J){v.chars[H].subtractToRef(J,N),(h=N.lengthSquared())>1e-6&&N.scaleAndAddToRef(1/(N.lengthSquared()*h),D)}),D.scaleInPlace(l),v.chars[H].addInPlace(D),v.chars[H].normalize()};for(b=o.length;b<v.chars.length;++b)k(b)}return v},i.prototype.serialize=function(){return JSON.stringify(this.chars)},i.Deserialize=function(t){for(var e=JSON.parse(t),n=new i(e.length),r=0;r<e.length;++r)n.chars[r]=new d.e(e[r]._x,e[r]._y,e[r]._z);return n},i}(),o_=function(){function i(){this._sequences=[]}return i.prototype.serialize=function(){return JSON.stringify(this._sequences.map(function(t){return t.serialize()}))},i.Deserialize=function(t,e){var n=new i;return n._sequences=JSON.parse(t).map(function(r){return Ds.Sequence.Deserialize(r,e)}),n},i.CreateFromTrajectory=function(t,e,n){return i.CreateFromTokenizationPyramid(i._getTokenizationPyramid(t,e),n)},i.CreateFromTokenizationPyramid=function(t,e){var n=new i;return n._sequences=t.map(function(r){return new Ds.Sequence(r,e)}),n},i._getTokenizationPyramid=function(t,e,n){n===void 0&&(n=i.FINEST_DESCRIPTOR_RESOLUTION);for(var r=[],o=n;o>4;o=Math.floor(o/2))r.push(t.resampleAtTargetResolution(o).tokenize(e.chars));return r},i.prototype.distance=function(t){for(var e=0,n=0;n<this._sequences.length;++n)e+=Math.pow(2,n)*this._sequences[n].distance(t._sequences[n]);return e},i.FINEST_DESCRIPTOR_RESOLUTION=32,i}(),BE=function(){function i(t){t===void 0&&(t=[]),this._descriptors=t,this._centroidIdx=-1,this._averageDistance=0,this._refreshDescription()}return i.prototype.serialize=function(){var t={};return t.descriptors=this._descriptors.map(function(e){return e.serialize()}),t.centroidIdx=this._centroidIdx,t.averageDistance=this._averageDistance,JSON.stringify(t)},i.Deserialize=function(t,e){var n=JSON.parse(t),r=new i;return r._descriptors=n.descriptors.map(function(o){return o_.Deserialize(o,e)}),r._centroidIdx=n.centroidIdx,r._averageDistance=n.averageDistance,r},i.prototype.add=function(t){this._descriptors.push(t),this._refreshDescription()},i.prototype.getMatchCost=function(t){return t.distance(this._descriptors[this._centroidIdx])/this._averageDistance},i.prototype.getMatchMinimumDistance=function(t){return Math.min.apply(Math,this._descriptors.map(function(e){return e.distance(t)}))},i.prototype._refreshDescription=function(){var t,e=this;this._centroidIdx=-1;for(var n=this._descriptors.map(function(o){return t=0,e._descriptors.forEach(function(l){t+=o.distance(l)}),t}),r=0;r<n.length;++r)(this._centroidIdx<0||n[r]<n[this._centroidIdx])&&(this._centroidIdx=r);this._averageDistance=0,this._descriptors.forEach(function(o){e._averageDistance+=o.distance(e._descriptors[e._centroidIdx])}),this._descriptors.length>0&&(this._averageDistance=Math.max(this._averageDistance/this._descriptors.length,i.MIN_AVERAGE_DISTANCE))},i.MIN_AVERAGE_DISTANCE=1,i}(),_N=function(){function i(){this._maximumAllowableMatchCost=4,this._nameToDescribedTrajectory=new Map}return i.prototype.serialize=function(){var t={};return t.maximumAllowableMatchCost=this._maximumAllowableMatchCost,t.vector3Alphabet=this._vector3Alphabet.serialize(),t.levenshteinAlphabet=this._levenshteinAlphabet.serialize(),t.nameToDescribedTrajectory=[],this._nameToDescribedTrajectory.forEach(function(e,n){t.nameToDescribedTrajectory.push(n),t.nameToDescribedTrajectory.push(e.serialize())}),JSON.stringify(t)},i.Deserialize=function(t){var e=JSON.parse(t),n=new i;n._maximumAllowableMatchCost=e.maximumAllowableMatchCost,n._vector3Alphabet=FE.Deserialize(e.vector3Alphabet),n._levenshteinAlphabet=Ds.Alphabet.Deserialize(e.levenshteinAlphabet);for(var r=0;r<e.nameToDescribedTrajectory.length;r+=2)n._nameToDescribedTrajectory.set(e.nameToDescribedTrajectory[r],BE.Deserialize(e.nameToDescribedTrajectory[r+1],n._levenshteinAlphabet));return n},i.Generate=function(){for(var t=FE.Generate(64,256,.1,.001,[d.e.Forward()]),e=new Array(t.chars.length),n=0;n<e.length;++n)e[n]=n;var r=new Ds.Alphabet(e,function(l){return l===0?0:1},function(l){return l===0?0:1},function(l,h){return Math.min(1-d.e.Dot(t.chars[l],t.chars[h]),1)}),o=new i;return o._vector3Alphabet=t,o._levenshteinAlphabet=r,o},i.prototype.addTrajectoryToClassification=function(t,e){this._nameToDescribedTrajectory.has(e)||this._nameToDescribedTrajectory.set(e,new BE),this._nameToDescribedTrajectory.get(e).add(o_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet))},i.prototype.deleteClassification=function(t){return this._nameToDescribedTrajectory.delete(t)},i.prototype.classifyTrajectory=function(t){var e=this,n=o_.CreateFromTrajectory(t,this._vector3Alphabet,this._levenshteinAlphabet),r=[];if(this._nameToDescribedTrajectory.forEach(function(b,A){b.getMatchCost(n)<e._maximumAllowableMatchCost&&r.push(A)}),r.length===0)return null;for(var o,l=0,h=this._nameToDescribedTrajectory.get(r[l]).getMatchMinimumDistance(n),v=0;v<r.length;++v)(o=this._nameToDescribedTrajectory.get(r[v]).getMatchMinimumDistance(n))<h&&(h=o,l=v);return r[l]},i}(),gN=c(150),kh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._direction=new d.e(0,0,-1),r._mat=new d.a,r._onSelectEnabled=!1,r._origin=new d.e(0,0,0),r.lastNativeXRHitResults=[],r.onHitTestResultObservable=new E.c,r._onHitTestResults=function(o){var l=o.map(function(h){var v=d.a.FromArray(h.hitMatrix);return r._xrSessionManager.scene.useRightHandedSystem||v.toggleModelMatrixHandInPlace(),r.options.worldParentNode&&v.multiplyToRef(r.options.worldParentNode.getWorldMatrix(),v),{xrHitResult:h,transformationMatrix:v}});r.lastNativeXRHitResults=o,r.onHitTestResultObservable.notifyObservers(l)},r._onSelect=function(o){r._onSelectEnabled&&t.XRHitTestWithSelectEvent(o,r._xrSessionManager.referenceSpace)},r.xrNativeFeatureName="hit-test",Qe.b.Warn("A newer version of this plugin is available"),r}return Object(_.d)(t,i),t.XRHitTestWithRay=function(e,n,r,o){return e.requestHitTest(n,r).then(function(l){var h=o||function(v){return!!v.hitMatrix};return l.filter(h)})},t.XRHitTestWithSelectEvent=function(e,n){var r=e.frame.getPose(e.inputSource.targetRaySpace,n);if(!r)return Promise.resolve([]);var o=new XRRay(r.transform);return this.XRHitTestWithRay(e.frame.session,o,n)},t.prototype.attach=function(){return!!i.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&!this.options.testOnPointerDownOnly){var n=e.getViewerPose(this._xrSessionManager.referenceSpace);if(n){d.a.FromArrayToRef(n.transform.matrix,0,this._mat),d.e.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),d.e.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var r=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});t.XRHitTestWithRay(this._xrSessionManager.session,r,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},t.Name=fi.HIT_TEST,t.Version=1,t}(pi);ei.AddWebXRFeature(kh.Name,function(i,t){return function(){return new kh(i,t)}},kh.Version,!1);var vN=0,jh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._lastFrameDetected=new Set,r._trackedAnchors=[],r._futureAnchors=[],r.onAnchorAddedObservable=new E.c,r.onAnchorRemovedObservable=new E.c,r.onAnchorUpdatedObservable=new E.c,r._tmpVector=new d.e,r._tmpQuaternion=new d.b,r.xrNativeFeatureName="anchors",r}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"referenceSpaceForFrameAnchors",{set:function(e){this._referenceSpaceForFrameAnchors=e},enumerable:!1,configurable:!0}),t.prototype._populateTmpTransformation=function(e,n){return this._tmpVector.copyFrom(e),this._tmpQuaternion.copyFrom(n),this._xrSessionManager.scene.useRightHandedSystem||(this._tmpVector.z*=-1,this._tmpQuaternion.z*=-1,this._tmpQuaternion.w*=-1),{position:this._tmpVector,rotationQuaternion:this._tmpQuaternion}},t.prototype.addAnchorPointUsingHitTestResultAsync=function(e,n,r){return n===void 0&&(n=new d.e),r===void 0&&(r=new d.b),Object(_.b)(this,void 0,void 0,function(){var o,l,h,v=this;return Object(_.e)(this,function(b){switch(b.label){case 0:if(this._populateTmpTransformation(n,r),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),e.xrHitResult.createAnchor)return[3,1];throw this.detach(),new Error("Anchors not enabled in this environment/browser");case 1:return b.trys.push([1,3,,4]),[4,e.xrHitResult.createAnchor(o)];case 2:return l=b.sent(),[2,new Promise(function(A,D){v._futureAnchors.push({nativeAnchor:l,resolved:!1,submitted:!0,xrTransformation:o,resolve:A,reject:D})})];case 3:throw h=b.sent(),new Error(h);case 4:return[2]}})})},t.prototype.addAnchorAtPositionAndRotationAsync=function(e,n,r){return n===void 0&&(n=new d.b),r===void 0&&(r=!1),Object(_.b)(this,void 0,void 0,function(){var o,l,h,v=this;return Object(_.e)(this,function(b){switch(b.label){case 0:return this._populateTmpTransformation(e,n),o=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),r&&this.attached&&this._xrSessionManager.currentFrame?[4,this._createAnchorAtTransformation(o,this._xrSessionManager.currentFrame)]:[3,2];case 1:return h=b.sent(),[3,3];case 2:h=void 0,b.label=3;case 3:return l=h,[2,new Promise(function(A,D){v._futureAnchors.push({nativeAnchor:l,resolved:!1,submitted:!1,xrTransformation:o,resolve:A,reject:D})})]}})})},Object.defineProperty(t.prototype,"anchors",{get:function(){return this._trackedAnchors},enumerable:!1,configurable:!0}),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemoveAnchorsOnSessionEnded)for(;this._trackedAnchors.length;){var e=this._trackedAnchors.pop();if(e){try{e.remove()}catch(n){}this.onAnchorRemovedObservable.notifyObservers(e)}}return!0},t.prototype.dispose=function(){this._futureAnchors.length=0,i.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&e){var r=e.trackedAnchors;if(r){var o=this._trackedAnchors.filter(function(h){return!r.has(h.xrAnchor)}).map(function(h){return n._trackedAnchors.indexOf(h)}),l=0;o.forEach(function(h){var v=n._trackedAnchors.splice(h-l,1)[0];n.onAnchorRemovedObservable.notifyObservers(v),l++}),r.forEach(function(h){if(n._lastFrameDetected.has(h)){var v=n._findIndexInAnchorArray(h);A=n._trackedAnchors[v];try{n._updateAnchorWithXRFrame(h,A,e),A.attachedNode&&(A.attachedNode.rotationQuaternion=A.attachedNode.rotationQuaternion||new d.b,A.transformationMatrix.decompose(A.attachedNode.scaling,A.attachedNode.rotationQuaternion,A.attachedNode.position)),n.onAnchorUpdatedObservable.notifyObservers(A)}catch(N){Qe.b.Warn("Anchor could not be updated")}}else{var b={id:vN++,xrAnchor:h,remove:h.delete},A=n._updateAnchorWithXRFrame(h,b,e);n._trackedAnchors.push(A),n.onAnchorAddedObservable.notifyObservers(A);var D=n._futureAnchors.filter(function(N){return N.nativeAnchor===h})[0];D&&(D.resolve(A),D.resolved=!0)}}),this._lastFrameDetected=r}this._futureAnchors.forEach(function(h){h.resolved||h.submitted||(n._createAnchorAtTransformation(h.xrTransformation,e).then(function(v){h.nativeAnchor=v},function(v){h.resolved=!0,h.reject(v)}),h.submitted=!0)})}},t.prototype._findIndexInAnchorArray=function(e){for(var n=0;n<this._trackedAnchors.length;++n)if(this._trackedAnchors[n].xrAnchor===e)return n;return-1},t.prototype._updateAnchorWithXRFrame=function(e,n,r){var o=r.getPose(e.anchorSpace,this._xrSessionManager.referenceSpace);if(o){var l=n.transformationMatrix||new d.a;d.a.FromArrayToRef(o.transform.matrix,0,l),this._xrSessionManager.scene.useRightHandedSystem||l.toggleModelMatrixHandInPlace(),n.transformationMatrix=l,this._options.worldParentNode&&l.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),l)}return n},t.prototype._createAnchorAtTransformation=function(e,n){var r;return Object(_.b)(this,void 0,void 0,function(){return Object(_.e)(this,function(o){if(!n.createAnchor)throw this.detach(),new Error("Anchors are not enabled in your browser");try{return[2,n.createAnchor(e,(r=this._referenceSpaceForFrameAnchors)!==null&&r!==void 0?r:this._xrSessionManager.referenceSpace)]}catch(l){throw new Error(l)}return[2]})})},t.Name=fi.ANCHOR_SYSTEM,t.Version=1,t}(pi);ei.AddWebXRFeature(jh.Name,function(i,t){return function(){return new jh(i,t)}},jh.Version);var bN=0,zh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r._options=n,r._detectedPlanes=[],r._enabled=!1,r._lastFrameDetected=new Set,r.onPlaneAddedObservable=new E.c,r.onPlaneRemovedObservable=new E.c,r.onPlaneUpdatedObservable=new E.c,r.xrNativeFeatureName="plane-detection",r._xrSessionManager.session?r._init():r._xrSessionManager.onXRSessionInit.addOnce(function(){r._init()}),r}return Object(_.d)(t,i),t.prototype.detach=function(){if(!i.prototype.detach.call(this))return!1;if(!this._options.doNotRemovePlanesOnSessionEnded)for(;this._detectedPlanes.length;){var e=this._detectedPlanes.pop();e&&this.onPlaneRemovedObservable.notifyObservers(e)}return!0},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},t.prototype.isCompatible=function(){return typeof XRPlane!="undefined"},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&this._enabled&&e){var r=e.worldInformation.detectedPlanes;if(r){var o=this._detectedPlanes.filter(function(h){return!r.has(h.xrPlane)}).map(function(h){return n._detectedPlanes.indexOf(h)}),l=0;o.forEach(function(h){var v=n._detectedPlanes.splice(h-l,1)[0];n.onPlaneRemovedObservable.notifyObservers(v),l++}),r.forEach(function(h){if(n._lastFrameDetected.has(h)){if(h.lastChangedTime===n._xrSessionManager.currentTimestamp){var v=n.findIndexInPlaneArray(h);A=n._detectedPlanes[v],n._updatePlaneWithXRPlane(h,A,e),n.onPlaneUpdatedObservable.notifyObservers(A)}}else{var b={id:bN++,xrPlane:h,polygonDefinition:[]},A=n._updatePlaneWithXRPlane(h,b,e);n._detectedPlanes.push(A),n.onPlaneAddedObservable.notifyObservers(A)}}),this._lastFrameDetected=r}}},t.prototype._init=function(){var e,n,r=this,o=function(){r._enabled=!0,r._detectedPlanes.length&&(r._detectedPlanes.length=0)};this._xrSessionManager.session.updateWorldTrackingState?(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),o()):((n=(e=this._xrSessionManager.session.worldTrackingState)===null||e===void 0?void 0:e.planeDetectionState)===null||n===void 0?void 0:n.enabled)&&o()},t.prototype._updatePlaneWithXRPlane=function(e,n,r){var o=this;n.polygonDefinition=e.polygon.map(function(v){var b=o._xrSessionManager.scene.useRightHandedSystem?1:-1;return new d.e(v.x,v.y,v.z*b)});var l=r.getPose(e.planeSpace,this._xrSessionManager.referenceSpace);if(l){var h=n.transformationMatrix||new d.a;d.a.FromArrayToRef(l.transform.matrix,0,h),this._xrSessionManager.scene.useRightHandedSystem||h.toggleModelMatrixHandInPlace(),n.transformationMatrix=h,this._options.worldParentNode&&h.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),h)}return n},t.prototype.findIndexInPlaneArray=function(e){for(var n=0;n<this._detectedPlanes.length;++n)if(this._detectedPlanes[n].xrPlane===e)return n;return-1},t.Name=fi.PLANE_DETECTION,t.Version=1,t}(pi);ei.AddWebXRFeature(zh.Name,function(i,t){return function(){return new zh(i,t)}},zh.Version);var Gh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r.onBackgroundStateChangedObservable=new E.c,r}return Object(_.d)(t,i),t.prototype.attach=function(){return this._setBackgroundState(!1),i.prototype.attach.call(this)},t.prototype.detach=function(){return this._setBackgroundState(!0),i.prototype.detach.call(this)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},t.prototype._onXRFrame=function(e){},t.prototype._setBackgroundState=function(e){var n=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var r=n.getMeshByName("BackgroundSkybox");r&&r.setEnabled(e)}if(this.options.environmentHelperRemovalFlags.ground){var o=n.getMeshByName("BackgroundPlane");o&&o.setEnabled(e)}}else{var l=n.getMeshByName("BackgroundHelper");l&&l.setEnabled(e)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach(function(h){return h.setEnabled(e)}),this.onBackgroundStateChangedObservable.notifyObservers(e)},t.Name=fi.BACKGROUND_REMOVER,t.Version=1,t}(pi);ei.AddWebXRFeature(Gh.Name,function(i,t){return function(){return new Gh(i,t)}},Gh.Version,!0);var yN=function(){},Wh=function(i){function t(e,n){var r=i.call(this,e)||this;return r._options=n,r._attachController=function(o){if(!r._controllers[o.uniqueId])if(r._xrSessionManager.scene.isPhysicsEnabled()||p.a.Warn("physics engine not enabled, skipped. Please add this controller manually."),r._options.physicsProperties.useControllerMesh&&o.inputSource.gamepad)o.onMotionControllerInitObservable.addOnce(function(D){D.onModelLoadedObservable.addOnce(function(){var N=new Dt.a(D.rootMesh,Dt.a.MeshImpostor,Object(_.a)({mass:0},r._options.physicsProperties)),j=o.grip||o.pointer;r._controllers[o.uniqueId]={xrController:o,impostor:N,oldPos:j.position.clone(),oldRotation:j.rotationQuaternion.clone()}})});else{var l=r._options.physicsProperties.impostorType||Dt.a.SphereImpostor,h=r._options.physicsProperties.impostorSize||.1,v=Mr.a.CreateSphere("impostor-mesh-"+o.uniqueId,{diameterX:typeof h=="number"?h:h.width,diameterY:typeof h=="number"?h:h.height,diameterZ:typeof h=="number"?h:h.depth});v.isVisible=r._debugMode,v.isPickable=!1,v.rotationQuaternion=new d.b;var b=o.grip||o.pointer;v.position.copyFrom(b.position),v.rotationQuaternion.copyFrom(b.rotationQuaternion);var A=new Dt.a(v,l,Object(_.a)({mass:0},r._options.physicsProperties));r._controllers[o.uniqueId]={xrController:o,impostor:A,impostorMesh:v}}},r._controllers={},r._debugMode=!1,r._delta=0,r._lastTimestamp=0,r._tmpQuaternion=new d.b,r._tmpVector=new d.e,r._options.physicsProperties||(r._options.physicsProperties={}),r}return Object(_.d)(t,i),t.prototype._enablePhysicsDebug=function(){var e=this;this._debugMode=!0,Object.keys(this._controllers).forEach(function(n){var r=e._controllers[n];r.impostorMesh&&(r.impostorMesh.isVisible=!0)})},t.prototype.addController=function(e){this._attachController(e)},t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,function(o){e._detachController(o.uniqueId)}),this._options.enableHeadsetImpostor){var n=this._options.headsetImpostorParams||{impostorType:Dt.a.SphereImpostor,restitution:.8,impostorSize:.3},r=n.impostorSize||.3;this._headsetMesh=Mr.a.CreateSphere("headset-mesh",{diameterX:typeof r=="number"?r:r.width,diameterY:typeof r=="number"?r:r.height,diameterZ:typeof r=="number"?r:r.depth}),this._headsetMesh.rotationQuaternion=new d.b,this._headsetMesh.isVisible=!1,this._headsetImpostor=new Dt.a(this._headsetMesh,n.impostorType,Object(_.a)({mass:0},n))}return!0},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach(function(n){e._detachController(n)}),this._headsetMesh&&this._headsetMesh.dispose(),!0)},t.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},t.prototype.getImpostorForController=function(e){var n=typeof e=="string"?e:e.uniqueId;return this._controllers[n]?this._controllers[n].impostor:null},t.prototype.setPhysicsProperties=function(e){this._options.physicsProperties=Object(_.a)(Object(_.a)({},this._options.physicsProperties),e)},t.prototype._onXRFrame=function(e){var n=this;this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.position),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.rotationQuaternion)),Object.keys(this._controllers).forEach(function(r){var o=n._controllers[r],l=o.xrController.grip||o.xrController.pointer,h=o.oldPos||o.impostorMesh.position,v=o.oldRotation||o.impostorMesh.rotationQuaternion;if(l.position.subtractToRef(h,n._tmpVector),n._tmpVector.scaleInPlace(1e3/n._delta),o.impostor.setLinearVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,"linear"),!v.equalsWithEpsilon(l.rotationQuaternion)){v.conjugateInPlace().multiplyToRef(l.rotationQuaternion,n._tmpQuaternion);var b=Math.sqrt(n._tmpQuaternion.x*n._tmpQuaternion.x+n._tmpQuaternion.y*n._tmpQuaternion.y+n._tmpQuaternion.z*n._tmpQuaternion.z);if(n._tmpVector.set(n._tmpQuaternion.x,n._tmpQuaternion.y,n._tmpQuaternion.z),b<.001)n._tmpVector.scaleInPlace(2);else{var A=2*Math.atan2(b,n._tmpQuaternion.w);n._tmpVector.scaleInPlace(A/(b*(n._delta/1e3)))}o.impostor.setAngularVelocity(n._tmpVector),n._debugMode&&console.log(n._tmpVector,n._tmpQuaternion,"angular")}h.copyFrom(l.position),v.copyFrom(l.rotationQuaternion)})},t.prototype._detachController=function(e){var n=this._controllers[e];n&&(n.impostorMesh&&n.impostorMesh.dispose(),delete this._controllers[e])},t.Name=fi.PHYSICS_CONTROLLERS,t.Version=1,t}(pi);ei.AddWebXRFeature(Wh.Name,function(i,t){return function(){return new Wh(i,t)}},Wh.Version,!0);var Hh=function(i){function t(e,n){n===void 0&&(n={});var r=i.call(this,e)||this;return r.options=n,r._tmpMat=new d.a,r._tmpPos=new d.e,r._tmpQuat=new d.b,r.initHitTestSource=function(o){if(o){var l=new XRRay(r.options.offsetRay||{}),h={space:r.options.useReferenceSpace?o:r._xrSessionManager.viewerReferenceSpace,offsetRay:l};r.options.entityTypes&&(h.entityTypes=r.options.entityTypes),h.space?r._xrSessionManager.session.requestHitTestSource(h).then(function(v){r._xrHitTestSource&&r._xrHitTestSource.cancel(),r._xrHitTestSource=v}):Qe.b.Warn("waiting for viewer reference space to initialize")}},r.autoCloneTransformation=!1,r.onHitTestResultObservable=new E.c,r.paused=!1,r.xrNativeFeatureName="hit-test",Qe.b.Warn("Hit test is an experimental and unstable feature."),r}return Object(_.d)(t,i),t.prototype.attach=function(){var e=this;if(!i.prototype.attach.call(this)||!this._xrSessionManager.session.requestHitTestSource)return!1;if(this.options.disablePermanentHitTest||(this._xrSessionManager.referenceSpace&&this.initHitTestSource(this._xrSessionManager.referenceSpace),this._xrSessionManager.onXRReferenceSpaceChanged.add(this.initHitTestSource)),this.options.enableTransientHitTest){var n=new XRRay(this.options.transientOffsetRay||{});this._xrSessionManager.session.requestHitTestSourceForTransientInput({profile:"generic-touchscreen",offsetRay:n,entityTypes:this.options.entityTypes}).then(function(r){e._transientXrHitTestSource=r})}return!0},t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this._xrHitTestSource&&(this._xrHitTestSource.cancel(),this._xrHitTestSource=null),this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(this.initHitTestSource),this._transientXrHitTestSource&&(this._transientXrHitTestSource.cancel(),this._transientXrHitTestSource=null),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){var n=this;if(this.attached&&!this.paused){if(this._xrHitTestSource){var r=e.getHitTestResults(this._xrHitTestSource);this._processWebXRHitTestResult(r)}this._transientXrHitTestSource&&e.getHitTestResultsForTransientInput(this._transientXrHitTestSource).forEach(function(o){n._processWebXRHitTestResult(o.results,o.inputSource)})}},t.prototype._processWebXRHitTestResult=function(e,n){var r=this,o=[];e.forEach(function(l){var h=l.getPose(r._xrSessionManager.referenceSpace);if(h){var v=h.transform.position,b=h.transform.orientation;r._tmpPos.set(v.x,v.y,v.z),r._tmpQuat.set(b.x,b.y,b.z,b.w),d.a.FromFloat32ArrayToRefScaled(h.transform.matrix,0,1,r._tmpMat),r._xrSessionManager.scene.useRightHandedSystem||(r._tmpPos.z*=-1,r._tmpQuat.z*=-1,r._tmpQuat.w*=-1,r._tmpMat.toggleModelMatrixHandInPlace());var A={position:r.autoCloneTransformation?r._tmpPos.clone():r._tmpPos,rotationQuaternion:r.autoCloneTransformation?r._tmpQuat.clone():r._tmpQuat,transformationMatrix:r.autoCloneTransformation?r._tmpMat.clone():r._tmpMat,inputSource:n,isTransient:!!n,xrHitResult:l};o.push(A)}}),this.onHitTestResultObservable.notifyObservers(o)},t.Name=fi.HIT_TEST,t.Version=2,t}(pi);ei.AddWebXRFeature(Hh.Name,function(i,t){return function(){return new Hh(i,t)}},Hh.Version,!1);var Xh=function(i){function t(e){var n=i.call(this,e)||this;return n._enabled=!1,n._featurePointCloud=[],n.onFeaturePointsAddedObservable=new E.c,n.onFeaturePointsUpdatedObservable=new E.c,n.xrNativeFeatureName="bjsfeature-points",n._xrSessionManager.session?n._init():n._xrSessionManager.onXRSessionInit.addOnce(function(){n._init()}),n}return Object(_.d)(t,i),Object.defineProperty(t.prototype,"featurePointCloud",{get:function(){return this._featurePointCloud},enumerable:!1,configurable:!0}),t.prototype.detach=function(){return!!i.prototype.detach.call(this)&&(this.featurePointCloud.length=0,!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._featurePointCloud.length=0,this.onFeaturePointsUpdatedObservable.clear(),this.onFeaturePointsAddedObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&this._enabled&&e){var n=e.featurePointCloud;if(n&&n.length!==0){if(n.length%5!=0)throw new Error("Received malformed feature point cloud of length: "+n.length);for(var r=n.length/5,o=new Array,l=new Array,h=0;h<r;h++){var v=5*h,b=n[v+4];this._featurePointCloud[b]?o.push(b):(this._featurePointCloud[b]={position:new d.e,confidenceValue:0},l.push(b)),this._featurePointCloud[b].position.x=n[v],this._featurePointCloud[b].position.y=n[v+1],this._featurePointCloud[b].position.z=n[v+2],this._featurePointCloud[b].confidenceValue=n[v+3]}l.length>0&&this.onFeaturePointsAddedObservable.notifyObservers(l),o.length>0&&this.onFeaturePointsUpdatedObservable.notifyObservers(o)}}},t.prototype._init=function(){this._xrSessionManager.session.trySetFeaturePointCloudEnabled&&this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0)&&(this._enabled=!0)},t.Name=fi.FEATURE_POINTS,t.Version=1,t}(pi);ei.AddWebXRFeature(Xh.Name,function(i){return function(){return new Xh(i)}},Xh.Version);var UE=function(){function i(t,e,n,r,o){this.xrController=t,this.trackedMeshes=e,this._handMesh=n,this._rigMapping=r,this._defaultHandMesh=!1,this._transformNodeMapping=[],this.handPartsDefinition=this.generateHandPartsDefinition(t.inputSource.hand),this._scene=e[0].getScene(),this._handMesh&&this._rigMapping?this._defaultHandMesh=!1:o||this._generateDefaultHandMesh(),this.xrController.motionController&&(this.xrController.motionController.rootMesh?this.xrController.motionController.rootMesh.setEnabled(!1):this.xrController.motionController.onModelLoadedObservable.add(function(l){l.rootMesh&&l.rootMesh.setEnabled(!1)})),this.xrController.onMotionControllerInitObservable.add(function(l){l.onModelLoadedObservable.add(function(h){h.rootMesh&&h.rootMesh.setEnabled(!1)}),l.rootMesh&&l.rootMesh.setEnabled(!1)})}return i.prototype.generateHandPartsDefinition=function(t){var e;return(e={}).wrist=[t.WRIST],e.thumb=[t.THUMB_METACARPAL,t.THUMB_PHALANX_PROXIMAL,t.THUMB_PHALANX_DISTAL,t.THUMB_PHALANX_TIP],e.index=[t.INDEX_METACARPAL,t.INDEX_PHALANX_PROXIMAL,t.INDEX_PHALANX_INTERMEDIATE,t.INDEX_PHALANX_DISTAL,t.INDEX_PHALANX_TIP],e.middle=[t.MIDDLE_METACARPAL,t.MIDDLE_PHALANX_PROXIMAL,t.MIDDLE_PHALANX_INTERMEDIATE,t.MIDDLE_PHALANX_DISTAL,t.MIDDLE_PHALANX_TIP],e.ring=[t.RING_METACARPAL,t.RING_PHALANX_PROXIMAL,t.RING_PHALANX_INTERMEDIATE,t.RING_PHALANX_DISTAL,t.RING_PHALANX_TIP],e.little=[t.LITTLE_METACARPAL,t.LITTLE_PHALANX_PROXIMAL,t.LITTLE_PHALANX_INTERMEDIATE,t.LITTLE_PHALANX_DISTAL,t.LITTLE_PHALANX_TIP],e},i.prototype.updateFromXRFrame=function(t,e,n){var r=this;n===void 0&&(n=2);var o=this.xrController.inputSource.hand;o&&this.trackedMeshes.forEach(function(l,h){var v=o[h];if(v){var b=t.getJointPose(v,e);if(!b||!b.transform)return;var A=b.transform.position,D=b.transform.orientation;l.position.set(A.x,A.y,A.z),l.rotationQuaternion.set(D.x,D.y,D.z,D.w);var N=(b.radius||.008)*n;l.scaling.set(N,N,N),r._handMesh&&r._rigMapping&&r._rigMapping[h]&&(r._transformNodeMapping[h]=r._transformNodeMapping[h]||r._scene.getTransformNodeByName(r._rigMapping[h]),r._transformNodeMapping[h]&&(r._transformNodeMapping[h].position.copyFrom(l.position),r._transformNodeMapping[h].rotationQuaternion.copyFrom(l.rotationQuaternion),l.isVisible=!1)),l.getScene().useRightHandedSystem||(l.position.z*=-1,l.rotationQuaternion.z*=-1,l.rotationQuaternion.w*=-1)}})},i.prototype.getHandPartMeshes=function(t){var e=this;return this.handPartsDefinition[t].map(function(n){return e.trackedMeshes[n]})},i.prototype.dispose=function(){this.trackedMeshes.forEach(function(t){return t.dispose()}),this._defaultHandMesh&&this._handMesh&&this._handMesh.dispose()},i.prototype._generateDefaultHandMesh=function(){return Object(_.b)(this,void 0,void 0,function(){var t,e,n,r,o,l,h,v;return Object(_.e)(this,function(b){switch(b.label){case 0:return b.trys.push([0,3,,4]),t=this.xrController.inputSource.handedness==="right"?"right":"left",e=(t==="right"?"r":"l")+"_hand_"+(this._scene.useRightHandedSystem?"r":"l")+"hs.glb",[4,Zt.ImportMeshAsync("","https://assets.babylonjs.com/meshes/HandMeshes/",e,this._scene)];case 1:return n=b.sent(),r={base:x.a.FromInts(116,63,203),fresnel:x.a.FromInts(149,102,229),fingerColor:x.a.FromInts(177,130,255),tipFresnel:x.a.FromInts(220,200,255)},[4,(o=new Ph("leftHandShader",this._scene,{emitComments:!1})).loadAsync("https://patrickryanms.github.io/BabylonJStextures/Demos/xrHandMesh/handsShader.json")];case 2:if(b.sent(),o.build(!1),o.needDepthPrePass=!0,o.transparencyMode=nn.a.MATERIAL_ALPHABLEND,o.alphaMode=Xe.a.ALPHA_COMBINE,(l={base:o.getBlockByName("baseColor"),fresnel:o.getBlockByName("fresnelColor"),fingerColor:o.getBlockByName("fingerColor"),tipFresnel:o.getBlockByName("tipFresnelColor")}).base.value=r.base,l.fresnel.value=r.fresnel,l.fingerColor.value=r.fingerColor,l.tipFresnel.value=r.tipFresnel,n.meshes[1].material=o,this._defaultHandMesh=!0,this._handMesh=n.meshes[0],this._rigMapping=["wrist_","thumb_metacarpal_","thumb_proxPhalanx_","thumb_distPhalanx_","thumb_tip_","index_metacarpal_","index_proxPhalanx_","index_intPhalanx_","index_distPhalanx_","index_tip_","middle_metacarpal_","middle_proxPhalanx_","middle_intPhalanx_","middle_distPhalanx_","middle_tip_","ring_metacarpal_","ring_proxPhalanx_","ring_intPhalanx_","ring_distPhalanx_","ring_tip_","little_metacarpal_","little_proxPhalanx_","little_intPhalanx_","little_distPhalanx_","little_tip_"].map(function(A){return A+(t==="right"?"R":"L")}),!(h=this._scene.getTransformNodeByName(this._rigMapping[0])))throw new Error("could not find the wrist node");return h.parent&&h.parent.rotate(Se.a.Y,Math.PI),[3,4];case 3:return v=b.sent(),Qe.b.Error("error loading hand mesh"),console.log(v),[3,4];case 4:return[2]}})})},i}(),Yh=function(i){function t(e,n){var r=i.call(this,e)||this;return r.options=n,r.onHandAddedObservable=new E.c,r.onHandRemovedObservable=new E.c,r._hands={},r._attachHand=function(o){var l,h,v,b,A,D,N,j,k,H;if(o.inputSource.hand&&!r._hands[o.uniqueId]){var J=o.inputSource.hand,te=[],oe=((l=r.options.jointMeshes)===null||l===void 0?void 0:l.sourceMesh)||Mr.a.CreateSphere("jointParent",{diameter:1});oe.isVisible=!!((h=r.options.jointMeshes)===null||h===void 0?void 0:h.keepOriginalVisible);for(var ce=0;ce<J.length;++ce){var he=oe.createInstance(o.uniqueId+"-handJoint-"+ce);if((v=r.options.jointMeshes)===null||v===void 0?void 0:v.onHandJointMeshGenerated){var _e=r.options.jointMeshes.onHandJointMeshGenerated(he,ce,o.uniqueId);_e&&_e!==he&&(he.dispose(),he=_e)}if(he.isPickable=!1,(b=r.options.jointMeshes)===null||b===void 0?void 0:b.enablePhysics){var ye=r.options.jointMeshes.physicsProps||{},Ee=ye.impostorType!==void 0?ye.impostorType:Dt.a.SphereImpostor;he.physicsImpostor=new Dt.a(he,Ee,Object(_.a)({mass:0},ye))}he.rotationQuaternion=new d.b,((A=r.options.jointMeshes)===null||A===void 0?void 0:A.invisible)&&(he.isVisible=!1),te.push(he)}var Oe=o.inputSource.handedness==="right"?"right":"left",Ae=((D=r.options.jointMeshes)===null||D===void 0?void 0:D.handMeshes)&&((N=r.options.jointMeshes)===null||N===void 0?void 0:N.handMeshes[Oe]),xe=((j=r.options.jointMeshes)===null||j===void 0?void 0:j.rigMapping)&&((k=r.options.jointMeshes)===null||k===void 0?void 0:k.rigMapping[Oe]),Pe=new UE(o,te,Ae,xe,(H=r.options.jointMeshes)===null||H===void 0?void 0:H.disableDefaultHandMesh);r._hands[o.uniqueId]={handObject:Pe,id:t._idCounter++},r.onHandAddedObservable.notifyObservers(Pe)}},r.xrNativeFeatureName="hand-tracking",r}return Object(_.d)(t,i),t.prototype.isCompatible=function(){return typeof XRHand!="undefined"},t.prototype.attach=function(){var e=this;return!!i.prototype.attach.call(this)&&(this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,function(n){e._detachHand(n.uniqueId)}),!0)},t.prototype.detach=function(){var e=this;return!!i.prototype.detach.call(this)&&(Object.keys(this._hands).forEach(function(n){e._detachHand(n)}),!0)},t.prototype.dispose=function(){i.prototype.dispose.call(this),this.onHandAddedObservable.clear()},t.prototype.getHandByControllerId=function(e){var n;return((n=this._hands[e])===null||n===void 0?void 0:n.handObject)||null},t.prototype.getHandByHandedness=function(e){var n=this,r=Object.keys(this._hands).map(function(o){return n._hands[o].handObject.xrController.inputSource.handedness}).indexOf(e);return r!==-1?this._hands[r].handObject:null},t.prototype._onXRFrame=function(e){var n=this;Object.keys(this._hands).forEach(function(r){var o;n._hands[r].handObject.updateFromXRFrame(e,n._xrSessionManager.referenceSpace,(o=n.options.jointMeshes)===null||o===void 0?void 0:o.scaleFactor)})},t.prototype._detachHand=function(e){this._hands[e]&&(this.onHandRemovedObservable.notifyObservers(this._hands[e].handObject),this._hands[e].handObject.dispose())},t._idCounter=0,t.Name=fi.HAND_TRACKING,t.Version=1,t}(pi);ei.AddWebXRFeature(Yh.Name,function(i,t){return function(){return new Yh(i,t)}},Yh.Version,!1);var VE=function(i){function t(e,n,r){var o=i.call(this,e,TN["left-right"],n,r)||this;return o._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},o.profileId="microsoft-mixed-reality",o}return Object(_.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:t.MODEL_BASE_URL+"default/"}},t.prototype._getModelLoadingConstraints=function(){var e=Zt.IsPluginForExtensionAvailable(".glb");return e||p.a.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var n=this;this.rootMesh&&(this.getComponentIds().forEach(function(r,o){if(!n.disableAnimation&&r&&n.rootMesh){var l=n._mapping.buttons[r],h=l.rootNodeName;if(!h)return void p.a.Log("Skipping unknown button at index: "+o+" with mapped name: "+r);var v=n._getChildByName(n.rootMesh,h);if(!v)return void p.a.Warn("Missing button mesh with name: "+h);if(l.valueMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.valueNodeName),l.pressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.pressedNodeName),l.unpressedMesh=n._getImmediateChildByName(v,n._mapping.defaultButton.unpressedNodeName),l.valueMesh&&l.pressedMesh&&l.unpressedMesh){var b=n.getComponent(r);b&&b.onButtonStateChangedObservable.add(function(A){n._lerpTransform(l,A.value)},void 0,!0)}else p.a.Warn("Missing button submesh under mesh with name: "+h)}}),this.getComponentIds().forEach(function(r,o){var l=n.getComponent(r);l.isAxes()&&["x-axis","y-axis"].forEach(function(h){if(n.rootMesh){var v=n._mapping.axes[r][h],b=n._getChildByName(n.rootMesh,v.rootNodeName);b?(v.valueMesh=n._getImmediateChildByName(b,n._mapping.defaultAxis.valueNodeName),v.minMesh=n._getImmediateChildByName(b,n._mapping.defaultAxis.minNodeName),v.maxMesh=n._getImmediateChildByName(b,n._mapping.defaultAxis.maxNodeName),v.valueMesh&&v.minMesh&&v.maxMesh?l&&l.onAxisValueChangedObservable.add(function(A){var D=h==="x-axis"?A.x:A.y;n._lerpTransform(v,D,!0)},void 0,!0):p.a.Warn("Missing axis submesh under mesh with name: "+v.rootNodeName)):p.a.Warn("Missing axis mesh with name: "+v.rootNodeName)}})}))},t.prototype._setRootMesh=function(e){var n;this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var o=e[r];o.isPickable=!1,o.parent||(n=o)}n&&n.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t}(ys);Ir.RegisterController("windows-mixed-reality",function(i,t){return new VE(t,i.gamepad,i.handedness)});var TN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},a_=function(i){function t(e,n,r,o,l){l===void 0&&(l=!1);var h=i.call(this,e,EN[r],n,r)||this;return h._forceLegacyControllers=l,h.profileId="oculus-touch",h}return Object(_.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:this.handedness==="left"?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:this._isQuest()?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this,r=this._isQuest(),o=this.handedness==="right"?-1:1;this.getComponentIds().forEach(function(l){var h=l&&n.getComponent(l);h&&h.onButtonStateChangedObservable.add(function(v){if(n.rootMesh&&!n.disableAnimation)switch(l){case"xr-standard-trigger":return void(r||(n._modelRootNode.getChildren()[3].rotation.x=.2*-v.value,n._modelRootNode.getChildren()[3].position.y=.005*-v.value,n._modelRootNode.getChildren()[3].position.z=.005*-v.value));case"xr-standard-squeeze":return void(r||(n._modelRootNode.getChildren()[4].position.x=o*v.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[1].position.y=-.001:n._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(r||(v.pressed?n._modelRootNode.getChildren()[2].position.y=-.001:n._modelRootNode.getChildren()[2].position.y=0))}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0)),e.forEach(function(n){n.isPickable=!1}),this._isQuest()?this._modelRootNode=e[0]:(this._modelRootNode=e[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},t.prototype._updateModel=function(){},t.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t}(ys);Ir.RegisterController("oculus-touch",function(i,t){return new a_(t,i.gamepad,i.handedness)}),Ir.RegisterController("oculus-touch-legacy",function(i,t){return new a_(t,i.gamepad,i.handedness,!0)});var EN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},kE=function(i){function t(e,n,r){var o=i.call(this,e,SN[r],n,r)||this;return o.profileId="htc-vive",o}return Object(_.d)(t,i),t.prototype._getFilenameAndPath=function(){return{filename:t.MODEL_FILENAME,path:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var n=this;this.getComponentIds().forEach(function(r){var o=r&&n.getComponent(r);o&&o.onButtonStateChangedObservable.add(function(l){if(n.rootMesh&&!n.disableAnimation)switch(r){case"xr-standard-trigger":return void(n._modelRootNode.getChildren()[6].rotation.x=.15*-l.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}},void 0,!0)})},t.prototype._setRootMesh=function(e){this.rootMesh=new Ne.a(this.profileId+" "+this.handedness,this.scene),e.forEach(function(n){n.isPickable=!1}),this._modelRootNode=e[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=d.b.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(ys);Ir.RegisterController("htc-vive",function(i,t){return new kE(t,i.gamepad,i.handedness)});var SN={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}}},function(f,s,c){c.d(s,"a",function(){return g});var T=c(34),m=function(){function C(){this.children=[]}return C.prototype.isValid=function(P){return!0},C.prototype.process=function(P,F){var U="";if(this.line){var B=this.line,L=F.processor;L&&(L.lineProcessor&&(B=L.lineProcessor(B,F.isFragment)),L.attributeProcessor&&T.a.StartsWith(this.line,"attribute")?B=L.attributeProcessor(this.line):L.varyingProcessor&&T.a.StartsWith(this.line,"varying")?B=L.varyingProcessor(this.line,F.isFragment):(L.uniformProcessor||L.uniformBufferProcessor)&&T.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?L.uniformProcessor&&(B=L.uniformProcessor(this.line,F.isFragment)):L.uniformBufferProcessor&&(B=L.uniformBufferProcessor(this.line,F.isFragment),F.lookForClosingBracketForUniformBuffer=!0)),L.endOfUniformBufferProcessor&&F.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(F.lookForClosingBracketForUniformBuffer=!1,B=L.endOfUniformBufferProcessor(this.line,F.isFragment))),U+=B+`\r
`}return this.children.forEach(function(z){U+=z.process(P,F)}),this.additionalDefineKey&&(P[this.additionalDefineKey]=this.additionalDefineValue||"true"),U},C}(),E=function(){function C(){}return Object.defineProperty(C.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"lines",{set:function(P){this._lines=[];for(var F=0,U=P;F<U.length;F++){var B=U[F];if(B[0]!=="#")for(var L=B.split(";"),z=0;z<L.length;z++){var X=L[z];(X=X.trim())&&this._lines.push(X+(z!==L.length-1?";":""))}else this._lines.push(B)}},enumerable:!1,configurable:!0}),C}(),d=c(1),x=function(C){function P(){return C!==null&&C.apply(this,arguments)||this}return Object(d.d)(P,C),P.prototype.process=function(F,U){for(var B=0;B<this.children.length;B++){var L=this.children[B];if(L.isValid(F))return L.process(F,U)}return""},P}(m),M=function(C){function P(){return C!==null&&C.apply(this,arguments)||this}return Object(d.d)(P,C),P.prototype.isValid=function(F){return this.testExpression.isTrue(F)},P}(m),w=function(){function C(){}return C.prototype.isTrue=function(P){return!0},C.postfixToInfix=function(P){for(var F=[],U=0,B=P;U<B.length;U++){var L=B[U];if(C._OperatorPriority[L]===void 0)F.push(L);else{var z=F[F.length-1],X=F[F.length-2];F.length-=2,F.push("("+X+L+z+")")}}return F[F.length-1]},C.infixToPostfix=function(P){for(var F=[],U=-1,B=function(){(ee=ee.trim())!==""&&(F.push(ee),ee="")},L=function(me){U<C._Stack.length-1&&(C._Stack[++U]=me)},z=function(){return C._Stack[U]},X=function(){return U===-1?"!!INVALID EXPRESSION!!":C._Stack[U--]},G=0,ee="";G<P.length;){var $=P.charAt(G),fe=G<P.length-1?P.substr(G,2):"";if($==="(")ee="",L($);else if($===")"){for(B();U!==-1&&z()!=="(";)F.push(X());X()}else if(C._OperatorPriority[fe]>1){for(B();U!==-1&&C._OperatorPriority[z()]>=C._OperatorPriority[fe];)F.push(X());L(fe),G++}else ee+=$;G++}for(B();U!==-1;)z()==="("?X():F.push(X());return F},C._OperatorPriority={")":0,"(":1,"||":2,"&&":3},C._Stack=["","","","","","","","","","","","","","","","","","","",""],C}(),S=function(C){function P(F,U){U===void 0&&(U=!1);var B=C.call(this)||this;return B.define=F,B.not=U,B}return Object(d.d)(P,C),P.prototype.isTrue=function(F){var U=F[this.define]!==void 0;return this.not&&(U=!U),U},P}(w),_=function(C){function P(){return C!==null&&C.apply(this,arguments)||this}return Object(d.d)(P,C),P.prototype.isTrue=function(F){return this.leftOperand.isTrue(F)||this.rightOperand.isTrue(F)},P}(w),O=function(C){function P(){return C!==null&&C.apply(this,arguments)||this}return Object(d.d)(P,C),P.prototype.isTrue=function(F){return this.leftOperand.isTrue(F)&&this.rightOperand.isTrue(F)},P}(w),R=function(C){function P(F,U,B){var L=C.call(this)||this;return L.define=F,L.operand=U,L.testValue=B,L}return Object(d.d)(P,C),P.prototype.isTrue=function(F){var U=F[this.define];U===void 0&&(U=this.define);var B=!1,L=parseInt(U),z=parseInt(this.testValue);switch(this.operand){case">":B=L>z;break;case"<":B=L<z;break;case"<=":B=L<=z;break;case">=":B=L>=z;break;case"==":B=L===z}return B},P}(w),I=c(21),y=/defined\s*?\((.+?)\)/g,p=/defined\s*?\[(.+?)\]/g,g=function(){function C(){}return C.Process=function(P,F,U,B){var L=this;this._ProcessIncludes(P,F,function(z){var X=L._ProcessShaderConversion(z,F,B);U(X)})},C._ProcessPrecision=function(P,F){var U=F.shouldUseHighPrecisionShader;return P.indexOf("precision highp float")===-1?P=U?`precision highp float;
`+P:`precision mediump float;
`+P:U||(P=P.replace("precision highp float","precision mediump float")),P},C._ExtractOperation=function(P){var F=/defined\((.+)\)/.exec(P);if(F&&F.length)return new S(F[1].trim(),P[0]==="!");for(var U="",B=0,L=0,z=["==",">=","<=","<",">"];L<z.length&&(U=z[L],!((B=P.indexOf(U))>-1));L++);if(B===-1)return new S(P);var X=P.substring(0,B).trim(),G=P.substring(B+U.length).trim();return new R(X,U,G)},C._BuildSubExpression=function(P){P=P.replace(y,"defined[$1]");for(var F=[],U=0,B=w.infixToPostfix(P);U<B.length;U++){var L=B[U];if(L!=="||"&&L!=="&&")F.push(L);else if(F.length>=2){var z=F[F.length-1],X=F[F.length-2];F.length-=2;var G=L=="&&"?new O:new _;typeof z=="string"&&(z=z.replace(p,"defined($1)")),typeof X=="string"&&(X=X.replace(p,"defined($1)")),G.leftOperand=typeof X=="string"?this._ExtractOperation(X):X,G.rightOperand=typeof z=="string"?this._ExtractOperation(z):z,F.push(G)}}var ee=F[F.length-1];return typeof ee=="string"&&(ee=ee.replace(p,"defined($1)")),typeof ee=="string"?this._ExtractOperation(ee):ee},C._BuildExpression=function(P,F){var U=new M,B=P.substring(0,F),L=P.substring(F);return L=L.substring(0,(L.indexOf("//")+1||L.length+1)-1).trim(),U.testExpression=B==="#ifdef"?new S(L):B==="#ifndef"?new S(L,!0):this._BuildSubExpression(L),U},C._MoveCursorWithinIf=function(P,F,U){for(var B=P.currentLine;this._MoveCursor(P,U);){var L=(B=P.currentLine).substring(0,5).toLowerCase();if(L==="#else"){var z=new m;return F.children.push(z),void this._MoveCursor(P,z)}if(L==="#elif"){var X=this._BuildExpression(B,5);F.children.push(X),U=X}}},C._MoveCursor=function(P,F){for(;P.canRead;){P.lineIndex++;var U=P.currentLine,B=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(U);if(B&&B.length)switch(B[0]){case"#ifdef":var L=new x;F.children.push(L);var z=this._BuildExpression(U,6);L.children.push(z),this._MoveCursorWithinIf(P,L,z);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":L=new x,F.children.push(L),z=this._BuildExpression(U,7),L.children.push(z),this._MoveCursorWithinIf(P,L,z);break;case"#if":L=new x,z=this._BuildExpression(U,3),F.children.push(L),L.children.push(z),this._MoveCursorWithinIf(P,L,z)}else{var X=new m;if(X.line=U,F.children.push(X),U[0]==="#"&&U[1]==="d"){var G=U.replace(";","").split(" ");X.additionalDefineKey=G[1],G.length===3&&(X.additionalDefineValue=G[2])}}}return!1},C._EvaluatePreProcessors=function(P,F,U){var B=new m,L=new E;return L.lineIndex=-1,L.lines=P.split(`
`),this._MoveCursor(L,B),B.process(F,U)},C._PreparePreProcessors=function(P){for(var F={},U=0,B=P.defines;U<B.length;U++){var L=B[U].replace("#define","").replace(";","").trim().split(" ");F[L[0]]=L.length>1?L[1]:""}return F.GL_ES="true",F.__VERSION__=P.version,F[P.platformName]="true",F},C._ProcessShaderConversion=function(P,F,U){var B=this._ProcessPrecision(P,F);if(!F.processor)return B;if(B.indexOf("#version 3")!==-1)return B.replace("#version 300 es","");var L=F.defines,z=this._PreparePreProcessors(F);return F.processor.preProcessor&&(B=F.processor.preProcessor(B,L,F.isFragment)),B=this._EvaluatePreProcessors(B,z,F),F.processor.postProcessor&&(B=F.processor.postProcessor(B,L,F.isFragment,U)),B},C._ProcessIncludes=function(P,F,U){for(var B=this,L=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,z=L.exec(P),X=new String(P),G=!1;z!=null;){var ee=z[1];if(ee.indexOf("__decl__")!==-1&&(ee=ee.replace(/__decl__/,""),F.supportsUniformBuffers&&(ee=(ee=ee.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),ee+="Declaration"),!F.includesShadersStore[ee]){var $=F.shadersRepository+"ShadersInclude/"+ee+".fx";return void C._FileToolsLoadFile($,function(Q){F.includesShadersStore[ee]=Q,B._ProcessIncludes(X,F,U)})}var fe=F.includesShadersStore[ee];if(z[2])for(var me=z[3].split(","),ve=0;ve<me.length;ve+=2){var be=new RegExp(me[ve],"g"),ie=me[ve+1];fe=fe.replace(be,ie)}if(z[4]){var se=z[5];if(se.indexOf("..")!==-1){var V=se.split(".."),K=parseInt(V[0]),Z=parseInt(V[1]),le=fe.slice(0);fe="",isNaN(Z)&&(Z=F.indexParameters[V[1]]);for(var re=K;re<Z;re++)F.supportsUniformBuffers||(le=le.replace(/light\{X\}.(\w*)/g,function(Q,W){return W+"{X}"})),fe+=le.replace(/\{X\}/g,re.toString())+`
`}else F.supportsUniformBuffers||(fe=fe.replace(/light\{X\}.(\w*)/g,function(Q,W){return W+"{X}"})),fe=fe.replace(/\{X\}/g,se)}X=X.replace(z[0],fe),G=G||fe.indexOf("#include<")>=0,z=L.exec(P)}G?this._ProcessIncludes(X.toString(),F,U):U(X)},C._FileToolsLoadFile=function(P,F,U,B,L,z){throw I.a.WarnImport("FileTools")},C}()},function(f,s,c){c(26).a.prototype._readTexturePixels=function(T,m,E,d,x,M){d===void 0&&(d=-1),x===void 0&&(x=0),M===void 0&&(M=null);var w=this._gl;if(!w)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var S=w.createFramebuffer();if(!S)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=S}w.bindFramebuffer(w.FRAMEBUFFER,this._dummyFramebuffer),d>-1?w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+d,T._webGLTexture,x):w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,T._webGLTexture,x);var _=T.type!==void 0?this._getWebGLTextureType(T.type):w.UNSIGNED_BYTE;switch(_){case w.UNSIGNED_BYTE:M||(M=new Uint8Array(4*m*E)),_=w.UNSIGNED_BYTE;break;default:M||(M=new Float32Array(4*m*E)),_=w.FLOAT}return w.readPixels(0,0,m,E,w.RGBA,_,M),w.bindFramebuffer(w.FRAMEBUFFER,this._currentFramebuffer),M}},function(f,s,c){var T="shadowsFragmentFunctions",m=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
#define inline
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;
}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
#define inline
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
#define inline
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#ifdef WEBGL2
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#ifdef WEBGL2
#define GREATEST_LESS_THAN_ONE 0.99999994

#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}





#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="reflectionFunction",m=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,1.));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="bumpFragmentMainFunctions",m=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="bumpFragmentFunctions",m=`#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(DETAIL)
#if DETAILDIRECTUV == 1
#define vDetailUV vMainUV1
#elif DETAILDIRECTUV == 2
#define vDetailUV vMainUV2
#else
varying vec2 vDetailUV;
#endif
uniform sampler2D detailSampler;
#endif
#if defined(BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vDetailUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);
vec2 detailNormalRG=detailColor.wy*2.0-1.0;
float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));
vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;

#if DETAIL_NORMALBLENDMETHOD == 0
detailNormal.xy*=vDetailInfos.z;
vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD == 1
detailNormal.xy*=vDetailInfos.z;
bumpNormal+=vec3(0.0,0.0,1.0);
detailNormal*=vec3(-1.0,-1.0,1.0);
vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;
normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif`;c(5).a.IncludesShadersStore.bumpFragment=T},function(f,s,c){var T="lightFragment",m=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;c(5).a.IncludesShadersStore.fogFragment=T},function(f,s,c){var T="fogVertexDeclaration",m=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="shadowsVertex",m=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.Eval=function(E,d){return(E=E.match(/\([^\(\)]*\)/g)?E.replace(/\([^\(\)]*\)/g,function(x){return x=x.slice(1,x.length-1),m._HandleParenthesisContent(x,d)}):m._HandleParenthesisContent(E,d))==="true"||E!=="false"&&m.Eval(E,d)},m._HandleParenthesisContent=function(E,d){var x;d=d||function(I){return I==="true"};var M=E.split("||");for(var w in M)if(M.hasOwnProperty(w)){var S=m._SimplifyNegation(M[w].trim()),_=S.split("&&");if(_.length>1)for(var O=0;O<_.length;++O){var R=m._SimplifyNegation(_[O].trim());if(!(x=R!=="true"&&R!=="false"?R[0]==="!"?!d(R.substring(1)):d(R):R==="true")){S="false";break}}if(x||S==="true"){x=!0;break}x=S!=="true"&&S!=="false"?S[0]==="!"?!d(S.substring(1)):d(S):S==="true"}return x?"true":"false"},m._SimplifyNegation=function(E){return(E=(E=E.replace(/^[\s!]+/,function(d){return(d=d.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())==="!true"?E="false":E==="!false"&&(E="true"),E},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.ExponentialBackoff=function(E,d){return E===void 0&&(E=3),d===void 0&&(d=500),function(x,M,w){return M.status!==0||w>=E||x.indexOf("file:")!==-1?-1:Math.pow(2,w)*d}},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"zOffset",{get:function(){return this._zOffset},set:function(E){this._zOffset!==E&&(this._zOffset=E,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cullFace",{get:function(){return this._cullFace},set:function(E){this._cullFace!==E&&(this._cullFace=E,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"cull",{get:function(){return this._cull},set:function(E){this._cull!==E&&(this._cull=E,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(E){this._depthFunc!==E&&(this._depthFunc=E,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthMask",{get:function(){return this._depthMask},set:function(E){this._depthMask!==E&&(this._depthMask=E,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"depthTest",{get:function(){return this._depthTest},set:function(E){this._depthTest!==E&&(this._depthTest=E,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"frontFace",{get:function(){return this._frontFace},set:function(E){this._frontFace!==E&&(this._frontFace=E,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},m.prototype.apply=function(E){this.isDirty&&(this._isCullDirty&&(this.cull?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(E.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(E.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?E.enable(E.DEPTH_TEST):E.disable(E.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(E.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(E.enable(E.POLYGON_OFFSET_FILL),E.polygonOffset(this.zOffset,0)):E.disable(E.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(E.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},m}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(2),m=function(){function E(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(E.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(d){this._stencilFunc!==d&&(this._stencilFunc=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(d){this._stencilFuncRef!==d&&(this._stencilFuncRef=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(d){this._stencilFuncMask!==d&&(this._stencilFuncMask=d,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(d){this._stencilOpStencilFail!==d&&(this._stencilOpStencilFail=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(d){this._stencilOpDepthFail!==d&&(this._stencilOpDepthFail=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(d){this._stencilOpStencilDepthPass!==d&&(this._stencilOpStencilDepthPass=d,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(d){this._stencilMask!==d&&(this._stencilMask=d,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(d){this._stencilTest!==d&&(this._stencilTest=d,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),E.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=E.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=E.KEEP,this._stencilOpDepthFail=E.KEEP,this._stencilOpStencilDepthPass=E.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},E.prototype.apply=function(d){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(d.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(d.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(d.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},E.ALWAYS=T.a.ALWAYS,E.KEEP=T.a.KEEP,E.REPLACE=T.a.REPLACE,E}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(m.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(E){this._alphaBlend!==E&&(this._alphaBlend=E,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),m.prototype.setAlphaBlendConstants=function(E,d,x,M){this._blendConstants[0]===E&&this._blendConstants[1]===d&&this._blendConstants[2]===x&&this._blendConstants[3]===M||(this._blendConstants[0]=E,this._blendConstants[1]=d,this._blendConstants[2]=x,this._blendConstants[3]=M,this._isBlendConstantsDirty=!0)},m.prototype.setAlphaBlendFunctionParameters=function(E,d,x,M){this._blendFunctionParameters[0]===E&&this._blendFunctionParameters[1]===d&&this._blendFunctionParameters[2]===x&&this._blendFunctionParameters[3]===M||(this._blendFunctionParameters[0]=E,this._blendFunctionParameters[1]=d,this._blendFunctionParameters[2]=x,this._blendFunctionParameters[3]=M,this._isBlendFunctionParametersDirty=!0)},m.prototype.setAlphaEquationParameters=function(E,d){this._blendEquationParameters[0]===E&&this._blendEquationParameters[1]===d||(this._blendEquationParameters[0]=E,this._blendEquationParameters[1]=d,this._isBlendEquationParametersDirty=!0)},m.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},m.prototype.apply=function(E){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?E.enable(E.BLEND):E.disable(E.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(E.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(E.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(E.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},m}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(m.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),m.prototype._handlesSpectorRebuildCallback=function(E){E&&this.program&&E(this.program)},m.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},m.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},m}()},function(f,s,c){var T;c.d(s,"a",function(){return d}),function(x){x[x.Pending=0]="Pending",x[x.Fulfilled=1]="Fulfilled",x[x.Rejected=2]="Rejected"}(T||(T={}));var m=function(){this.count=0,this.target=0,this.results=[]},E=function(){function x(M){var w=this;if(this._state=T.Pending,this._children=new Array,this._rejectWasConsumed=!1,M)try{M(function(S){w._resolve(S)},function(S){w._reject(S)})}catch(S){this._reject(S)}}return Object.defineProperty(x.prototype,"_result",{get:function(){return this._resultValue},set:function(M){this._resultValue=M,this._parent&&this._parent._result===void 0&&(this._parent._result=M)},enumerable:!1,configurable:!0}),x.prototype.catch=function(M){return this.then(void 0,M)},x.prototype.then=function(M,w){var S=this,_=new x;return _._onFulfilled=M,_._onRejected=w,this._children.push(_),_._parent=this,this._state!==T.Pending&&setTimeout(function(){if(S._state===T.Fulfilled||S._rejectWasConsumed){var O=_._resolve(S._result);if(O!=null)if(O._state!==void 0){var R=O;_._children.push(R),R._parent=_,_=R}else _._result=O}else _._reject(S._reason)}),_},x.prototype._moveChildren=function(M){var w,S=this;if((w=this._children).push.apply(w,M.splice(0,M.length)),this._children.forEach(function(y){y._parent=S}),this._state===T.Fulfilled)for(var _=0,O=this._children;_<O.length;_++)O[_]._resolve(this._result);else if(this._state===T.Rejected)for(var R=0,I=this._children;R<I.length;R++)I[R]._reject(this._reason)},x.prototype._resolve=function(M){try{this._state=T.Fulfilled;var w=null;if(this._onFulfilled&&(w=this._onFulfilled(M)),w!=null)if(w._state!==void 0){var S=w;S._parent=this,S._moveChildren(this._children),M=S._result}else M=w;this._result=M;for(var _=0,O=this._children;_<O.length;_++)O[_]._resolve(M);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(R){this._reject(R,!0)}},x.prototype._reject=function(M,w){if(w===void 0&&(w=!1),this._state=T.Rejected,this._reason=M,this._onRejected&&!w)try{this._onRejected(M),this._rejectWasConsumed=!0}catch(R){M=R}for(var S=0,_=this._children;S<_.length;S++){var O=_[S];this._rejectWasConsumed?O._resolve(null):O._reject(M)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},x.resolve=function(M){var w=new x;return w._resolve(M),w},x._RegisterForFulfillment=function(M,w,S){M.then(function(_){return w.results[S]=_,w.count++,w.count===w.target&&w.rootPromise._resolve(w.results),null},function(_){w.rootPromise._state!==T.Rejected&&w.rootPromise._reject(_)})},x.all=function(M){var w=new x,S=new m;if(S.target=M.length,S.rootPromise=w,M.length)for(var _=0;_<M.length;_++)x._RegisterForFulfillment(M[_],S,_);else w._resolve([]);return w},x.race=function(M){var w=new x;if(M.length)for(var S=0,_=M;S<_.length;S++)_[S].then(function(O){return w&&(w._resolve(O),w=null),null},function(O){w&&(w._reject(O),w=null)});return w},x}(),d=function(){function x(){}return x.Apply=function(M){M===void 0&&(M=!1),(M||typeof Promise=="undefined")&&(window.Promise=E)},x}()},function(f,s,c){c.d(s,"a",function(){return m}),c.d(s,"b",function(){return E});var T=c(57),m=function(){function d(x){x===void 0&&(x=30),this._enabled=!0,this._rollingFrameTime=new E(x)}return d.prototype.sampleFrame=function(x){if(x===void 0&&(x=T.a.Now),this._enabled){if(this._lastFrameTimeMs!=null){var M=x-this._lastFrameTimeMs;this._rollingFrameTime.add(M)}this._lastFrameTimeMs=x}},Object.defineProperty(d.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"instantaneousFPS",{get:function(){var x=this._rollingFrameTime.history(0);return x===0?0:1e3/x},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),d.prototype.enable=function(){this._enabled=!0},d.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),d.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},d}(),E=function(){function d(x){this._samples=new Array(x),this.reset()}return d.prototype.add=function(x){var M;if(this.isSaturated()){var w=this._samples[this._pos];M=w-this.average,this.average-=M/(this._sampleCount-1),this._m2-=M*(w-this.average)}else this._sampleCount++;M=x-this.average,this.average+=M/this._sampleCount,this._m2+=M*(x-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=x,this._pos++,this._pos%=this._samples.length},d.prototype.history=function(x){if(x>=this._sampleCount||x>=this._samples.length)return 0;var M=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(M-x)]},d.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},d.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},d.prototype._wrapPosition=function(x){var M=this._samples.length;return(x%M+M)%M},d}()},function(f,s,c){c.d(s,"a",function(){return m});var T=c(0),m=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new T.e(0,0,0),this._diffPositionForCollisions=new T.e(0,0,0),this._collisionResponse=!0}},function(f,s,c){c.d(s,"a",function(){return d});var T=c(33),m=c(0),E=c(2),d=function(){function x(M,w,S,_,O){S===void 0&&(S=null),_===void 0&&(_=null),O===void 0&&(O=null),this.index=M,this._opaqueSubMeshes=new T.a(256),this._transparentSubMeshes=new T.a(256),this._alphaTestSubMeshes=new T.a(256),this._depthOnlySubMeshes=new T.a(256),this._particleSystems=new T.a(256),this._spriteManagers=new T.a(256),this._edgesRenderers=new T.b(16),this._scene=w,this.opaqueSortCompareFn=S,this.alphaTestSortCompareFn=_,this.transparentSortCompareFn=O}return Object.defineProperty(x.prototype,"opaqueSortCompareFn",{set:function(M){this._opaqueSortCompareFn=M,this._renderOpaque=M?this.renderOpaqueSorted:x.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"alphaTestSortCompareFn",{set:function(M){this._alphaTestSortCompareFn=M,this._renderAlphaTest=M?this.renderAlphaTestSorted:x.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"transparentSortCompareFn",{set:function(M){this._transparentSortCompareFn=M||x.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),x.prototype.render=function(M,w,S,_){if(M)M(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var O=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(O.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),O.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var R=O.getStencilBuffer();if(O.setStencilBuffer(!1),w&&this._renderSprites(),S&&this._renderParticles(_),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(O.setStencilBuffer(R),this._renderTransparent(this._transparentSubMeshes),O.setAlphaMode(E.a.ALPHA_DISABLE)),O.setStencilBuffer(!1),this._edgesRenderers.length){for(var I=0;I<this._edgesRenderers.length;I++)this._edgesRenderers.data[I].render();O.setAlphaMode(E.a.ALPHA_DISABLE)}O.setStencilBuffer(R)}},x.prototype.renderOpaqueSorted=function(M){return x.renderSorted(M,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},x.prototype.renderAlphaTestSorted=function(M){return x.renderSorted(M,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},x.prototype.renderTransparentSorted=function(M){return x.renderSorted(M,this._transparentSortCompareFn,this._scene.activeCamera,!0)},x.renderSorted=function(M,w,S,_){for(var O,R=0,I=S?S.globalPosition:x._zeroVector;R<M.length;R++)(O=M.data[R])._alphaIndex=O.getMesh().alphaIndex,O._distanceToCamera=m.e.Distance(O.getBoundingInfo().boundingSphere.centerWorld,I);var y=M.data.slice(0,M.length);for(w&&y.sort(w),R=0;R<y.length;R++){if(O=y[R],_){var p=O.getMaterial();if(p&&p.needDepthPrePass){var g=p.getScene().getEngine();g.setColorWrite(!1),g.setAlphaMode(E.a.ALPHA_DISABLE),O.render(!1),g.setColorWrite(!0)}}O.render(_)}},x.renderUnsorted=function(M){for(var w=0;w<M.length;w++)M.data[w].render(!1)},x.defaultTransparentSortCompare=function(M,w){return M._alphaIndex>w._alphaIndex?1:M._alphaIndex<w._alphaIndex?-1:x.backToFrontSortCompare(M,w)},x.backToFrontSortCompare=function(M,w){return M._distanceToCamera<w._distanceToCamera?1:M._distanceToCamera>w._distanceToCamera?-1:0},x.frontToBackSortCompare=function(M,w){return M._distanceToCamera<w._distanceToCamera?-1:M._distanceToCamera>w._distanceToCamera?1:0},x.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},x.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},x.prototype.dispatch=function(M,w,S){w===void 0&&(w=M.getMesh()),S===void 0&&(S=M.getMaterial()),S!=null&&(S.needAlphaBlendingForMesh(w)?this._transparentSubMeshes.push(M):S.needAlphaTesting()?(S.needDepthPrePass&&this._depthOnlySubMeshes.push(M),this._alphaTestSubMeshes.push(M)):(S.needDepthPrePass&&this._depthOnlySubMeshes.push(M),this._opaqueSubMeshes.push(M)),w._renderingGroup=this,w._edgesRenderer&&w._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(w._edgesRenderer))},x.prototype.dispatchSprites=function(M){this._spriteManagers.push(M)},x.prototype.dispatchParticles=function(M){this._particleSystems.push(M)},x.prototype._renderParticles=function(M){if(this._particleSystems.length!==0){var w=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var S=0;S<this._particleSystems.length;S++){var _=this._particleSystems.data[S];if((w&&w.layerMask&_.layerMask)!==0){var O=_.emitter;O.position&&M&&M.indexOf(O)===-1||this._scene._activeParticles.addCount(_.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},x.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&this._spriteManagers.length!==0){var M=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var w=0;w<this._spriteManagers.length;w++){var S=this._spriteManagers.data[w];(M&&M.layerMask&S.layerMask)!==0&&S.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},x._zeroVector=m.e.Zero(),x}()},function(f,s,c){c.d(s,"a",function(){return T});var T=function(m,E){this.distance=m,this.mesh=E}},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return m.GenerateBase64StringFromTexture=function(E,d,x){d===void 0&&(d=0),x===void 0&&(x=0);var M=E.getInternalTexture();if(!M)return null;var w=E.readPixels(d,x);if(!w)return null;var S=E.getSize(),_=S.width,O=S.height;if(w instanceof Float32Array){for(var R=w.byteLength/w.BYTES_PER_ELEMENT,I=new Uint8Array(R);--R>=0;){var y=w[R];y<0?y=0:y>1&&(y=1),I[R]=255*y}w=I}var p=document.createElement("canvas");p.width=_,p.height=O;var g=p.getContext("2d");if(!g)return null;var C=g.createImageData(_,O);if(C.data.set(w),g.putImageData(C,0,0),M.invertY){var P=document.createElement("canvas");P.width=_,P.height=O;var F=P.getContext("2d");return F?(F.translate(0,O),F.scale(1,-1),F.drawImage(p,0,0),P.toDataURL("image/png")):null}return p.toDataURL("image/png")},m}()},function(f,s,c){c.d(s,"a",function(){return R});var T=c(1),m=c(0),E=c(8),d=c(31),x=c(7),M=c(41),w=c(46),S=c(4),_=c(43),O=c(12);x.a._instancedMeshFactory=function(I,y){var p=new R(I,y);if(y.instancedBuffers)for(var g in p.instancedBuffers={},y.instancedBuffers)p.instancedBuffers[g]=y.instancedBuffers[g];return p};var R=function(I){function y(p,g){var C=I.call(this,p,g.getScene())||this;C._indexInSourceMeshInstanceArray=-1,g.addInstance(C),C._sourceMesh=g,C._unIndexed=g._unIndexed,C.position.copyFrom(g.position),C.rotation.copyFrom(g.rotation),C.scaling.copyFrom(g.scaling),g.rotationQuaternion&&(C.rotationQuaternion=g.rotationQuaternion.clone()),C.animations=O.b.Slice(g.animations);for(var P=0,F=g.getAnimationRanges();P<F.length;P++){var U=F[P];U!=null&&C.createAnimationRange(U.name,U.from,U.to)}return C.infiniteDistance=g.infiniteDistance,C.setPivotMatrix(g.getPivotMatrix()),C.refreshBoundingInfo(),C._syncSubMeshes(),C}return Object(T.d)(y,I),y.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(y.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),y.prototype._resyncLightSources=function(){},y.prototype._resyncLightSource=function(p){},y.prototype._removeLightSource=function(p,g){},Object.defineProperty(y.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(p){this._sourceMesh&&p!==this._sourceMesh.renderingGroupId&&E.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),y.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},y.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(y.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),y.prototype.createInstance=function(p){return this._sourceMesh.createInstance(p)},y.prototype.isReady=function(p){return p===void 0&&(p=!1),this._sourceMesh.isReady(p,!0)},y.prototype.getVerticesData=function(p,g){return this._sourceMesh.getVerticesData(p,g)},y.prototype.setVerticesData=function(p,g,C,P){return this.sourceMesh&&this.sourceMesh.setVerticesData(p,g,C,P),this.sourceMesh},y.prototype.updateVerticesData=function(p,g,C,P){return this.sourceMesh&&this.sourceMesh.updateVerticesData(p,g,C,P),this.sourceMesh},y.prototype.setIndices=function(p,g){return g===void 0&&(g=null),this.sourceMesh&&this.sourceMesh.setIndices(p,g),this.sourceMesh},y.prototype.isVerticesDataPresent=function(p){return this._sourceMesh.isVerticesDataPresent(p)},y.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(y.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),y.prototype.refreshBoundingInfo=function(p){if(p===void 0&&(p=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var g=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(p),g),this},y.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},y.prototype._activate=function(p,g){if(this._sourceMesh.subMeshes||E.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,p),g){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},y.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},y.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==w.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var p=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,m.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),m.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(m.c.Vector3[7]),this._currentLOD._masterMesh=p,m.c.Matrix[0]}return I.prototype.getWorldMatrix.call(this)},Object.defineProperty(y.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),y.prototype.getLOD=function(p){if(!p)return this;var g=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(p,g.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},y.prototype._preActivateForIntermediateRendering=function(p){return this.sourceMesh._preActivateForIntermediateRendering(p)},y.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var p=0;p<this._sourceMesh.subMeshes.length;p++)this._sourceMesh.subMeshes[p].clone(this,this._sourceMesh);return this},y.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},y.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new _.a(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},y.prototype.clone=function(p,g,C){g===void 0&&(g=null);var P=this._sourceMesh.createInstance(p);if(M.a.DeepCopy(this,P,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances"],[]),this.refreshBoundingInfo(),g&&(P.parent=g),!C)for(var F=0;F<this.getScene().meshes.length;F++){var U=this.getScene().meshes[F];U.parent===this&&U.clone(U.name,P)}return P.computeWorldMatrix(!0),P},y.prototype.dispose=function(p,g){g===void 0&&(g=!1),this._sourceMesh.removeInstance(this),I.prototype.dispose.call(this,p,g)},y}(d.a);x.a.prototype.edgesShareWithInstances=!1,x.a.prototype.registerInstancedBuffer=function(I,y){if(this.removeVerticesData(I),!this.instancedBuffers){this.instancedBuffers={};for(var p=0,g=this.instances;p<g.length;p++)g[p].instancedBuffers={};this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[I]=null,this._userInstancedBuffersStorage.strides[I]=y,this._userInstancedBuffersStorage.sizes[I]=32*y,this._userInstancedBuffersStorage.data[I]=new Float32Array(this._userInstancedBuffersStorage.sizes[I]),this._userInstancedBuffersStorage.vertexBuffers[I]=new S.b(this.getEngine(),this._userInstancedBuffersStorage.data[I],I,!0,!1,y,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[I]);for(var C=0,P=this.instances;C<P.length;C++)P[C].instancedBuffers[I]=null},x.a.prototype._processInstancedBuffers=function(I,y){var p=I.length;for(var g in this.instancedBuffers){for(var C=this._userInstancedBuffersStorage.sizes[g],P=this._userInstancedBuffersStorage.strides[g],F=(p+1)*P;C<F;)C*=2;this._userInstancedBuffersStorage.data[g].length!=C&&(this._userInstancedBuffersStorage.data[g]=new Float32Array(C),this._userInstancedBuffersStorage.sizes[g]=C,this._userInstancedBuffersStorage.vertexBuffers[g]&&(this._userInstancedBuffersStorage.vertexBuffers[g].dispose(),this._userInstancedBuffersStorage.vertexBuffers[g]=null));var U=this._userInstancedBuffersStorage.data[g],B=0;y&&((z=this.instancedBuffers[g]).toArray?z.toArray(U,B):z.copyToArray(U,B),B+=P);for(var L=0;L<p;L++){var z;(z=I[L].instancedBuffers[g]).toArray?z.toArray(U,B):z.copyToArray(U,B),B+=P}this._userInstancedBuffersStorage.vertexBuffers[g]?this._userInstancedBuffersStorage.vertexBuffers[g].updateDirectly(U,0):(this._userInstancedBuffersStorage.vertexBuffers[g]=new S.b(this.getEngine(),this._userInstancedBuffersStorage.data[g],g,!0,!1,P,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[g]))}},x.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var I in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[I]&&this._userInstancedBuffersStorage.vertexBuffers[I].dispose();this.instancedBuffers={}}},function(f,s,c){c.d(s,"a",function(){return T});var T=function(){function m(){}return Object.defineProperty(m,"UniqueId",{get:function(){var E=this._UniqueIdCounter;return this._UniqueIdCounter++,E},enumerable:!1,configurable:!0}),m._UniqueIdCounter=0,m}()},function(f,s,c){var T=c(26),m=c(88);T.a.prototype.createUniformBuffer=function(E){var d=this._gl.createBuffer();if(!d)throw new Error("Unable to create uniform buffer");var x=new m.a(d);return this.bindUniformBuffer(x),E instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,E,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(E),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),x.references=1,x},T.a.prototype.createDynamicUniformBuffer=function(E){var d=this._gl.createBuffer();if(!d)throw new Error("Unable to create dynamic uniform buffer");var x=new m.a(d);return this.bindUniformBuffer(x),E instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,E,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(E),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),x.references=1,x},T.a.prototype.updateUniformBuffer=function(E,d,x,M){this.bindUniformBuffer(E),x===void 0&&(x=0),M===void 0?d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,x,d):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,x,new Float32Array(d)):d instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,d.subarray(x,x+M)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(d).subarray(x,x+M)),this.bindUniformBuffer(null)},T.a.prototype.bindUniformBuffer=function(E){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,E?E.underlyingResource:null)},T.a.prototype.bindUniformBufferBase=function(E,d){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,d,E?E.underlyingResource:null)},T.a.prototype.bindUniformBlock=function(E,d,x){var M=E.program,w=this._gl.getUniformBlockIndex(M,d);this._gl.uniformBlockBinding(M,w,x)}},function(f,s,c){var T="lightsFragmentFunctions",m=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="logDepthFragment",m=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;c(5).a.IncludesShadersStore.bumpVertex=T},function(f,s,c){var T=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;c(5).a.IncludesShadersStore.fogVertex=T},function(f,s,c){var T="logDepthVertex",m=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s){var c;c=function(){return this}();try{c=c||new Function("return this")()}catch(T){typeof window=="object"&&(c=window)}f.exports=c},function(f,s,c){var T="prePassDeclaration",m=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
#ifdef WEBGL2
layout(location=0) out highp vec4 glFragData[{X}];
highp vec4 gl_FragColor;
#endif
#ifdef PREPASS_DEPTHNORMAL
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;
varying highp vec4 vPreviousPosition;
#endif
#endif
`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="fresnelFunction",m=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;c(5).a.IncludesShadersStore.depthPrePass=T},function(f,s,c){var T="prePassVertexDeclaration",m=`#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="bumpVertexDeclaration",m=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T="prePassVertex",m=`#ifdef PREPASS_DEPTHNORMAL
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif`;c(5).a.IncludesShadersStore[T]=m},function(f,s,c){var T=c(5),m=(c(115),c(110),"colorPixelShader"),E=`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
#include<clipPlaneFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`;T.a.ShadersStore[m]=E},function(f,s,c){var T=c(5),m=(c(78),c(117),c(79),c(80),c(81),c(111),"colorVertexShader"),E=`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>
#include<clipPlaneVertexDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(position,1.0);
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
#include<clipPlaneVertex>
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`;T.a.ShadersStore[m]=E},function(f,s,c){(function(T){c.d(s,"b",function(){return O}),c.d(s,"a",function(){return R});var m=c(1),E=c(8),d=c(13),x=c(102),M=c(27),w=c(2),S=c(89),_=c(74),O=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},R=function(I){function y(p){p===void 0&&(p=new O);var g=I.call(this,null)||this;d.a.Instances.push(g),p.deterministicLockstep===void 0&&(p.deterministicLockstep=!1),p.lockstepMaxSteps===void 0&&(p.lockstepMaxSteps=4),g._options=p,_.a.SetMatrixPrecision(!!p.useHighPrecisionMatrix),g._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1},E.a.Log("Babylon.js v"+d.a.Version+" - Null engine");var C=typeof self!="undefined"?self:T!==void 0?T:window;return typeof URL=="undefined"&&(C.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob=="undefined"&&(C.Blob=function(){}),g}return Object(m.d)(y,I),y.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},y.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},y.prototype.getHardwareScalingLevel=function(){return 1},y.prototype.createVertexBuffer=function(p){var g=new S.a;return g.references=1,g},y.prototype.createIndexBuffer=function(p){var g=new S.a;return g.references=1,g},y.prototype.clear=function(p,g,C,P){},y.prototype.getRenderWidth=function(p){return p===void 0&&(p=!1),!p&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},y.prototype.getRenderHeight=function(p){return p===void 0&&(p=!1),!p&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},y.prototype.setViewport=function(p,g,C){this._cachedViewport=p},y.prototype.createShaderProgram=function(p,g,C,P,F){return{__SPECTOR_rebuildProgram:null}},y.prototype.getUniforms=function(p,g){return[]},y.prototype.getAttributes=function(p,g){return[]},y.prototype.bindSamplers=function(p){this._currentEffect=null},y.prototype.enableEffect=function(p){this._currentEffect=p,p.onBind&&p.onBind(p),p._onBindObservable&&p._onBindObservable.notifyObservers(p)},y.prototype.setState=function(p,g,C,P){},y.prototype.setIntArray=function(p,g){return!0},y.prototype.setIntArray2=function(p,g){return!0},y.prototype.setIntArray3=function(p,g){return!0},y.prototype.setIntArray4=function(p,g){return!0},y.prototype.setFloatArray=function(p,g){return!0},y.prototype.setFloatArray2=function(p,g){return!0},y.prototype.setFloatArray3=function(p,g){return!0},y.prototype.setFloatArray4=function(p,g){return!0},y.prototype.setArray=function(p,g){return!0},y.prototype.setArray2=function(p,g){return!0},y.prototype.setArray3=function(p,g){return!0},y.prototype.setArray4=function(p,g){return!0},y.prototype.setMatrices=function(p,g){return!0},y.prototype.setMatrix3x3=function(p,g){return!0},y.prototype.setMatrix2x2=function(p,g){return!0},y.prototype.setFloat=function(p,g){return!0},y.prototype.setFloat2=function(p,g,C){return!0},y.prototype.setFloat3=function(p,g,C,P){return!0},y.prototype.setBool=function(p,g){return!0},y.prototype.setFloat4=function(p,g,C,P,F){return!0},y.prototype.setAlphaMode=function(p,g){g===void 0&&(g=!1),this._alphaMode!==p&&(this.alphaState.alphaBlend=p!==w.a.ALPHA_DISABLE,g||this.setDepthWrite(p===w.a.ALPHA_DISABLE),this._alphaMode=p)},y.prototype.bindBuffers=function(p,g,C){},y.prototype.wipeCaches=function(p){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,p&&(this._currentProgram=null,this.stencilState.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},y.prototype.draw=function(p,g,C,P){},y.prototype.drawElementsType=function(p,g,C,P){},y.prototype.drawArraysType=function(p,g,C,P){},y.prototype._createTexture=function(){return{}},y.prototype._releaseTexture=function(p){},y.prototype.createTexture=function(p,g,C,P,F,U,B,L,z,X,G,ee){F===void 0&&(F=w.a.TEXTURE_TRILINEAR_SAMPLINGMODE),U===void 0&&(U=null),X===void 0&&(X=null);var $=new M.a(this,M.b.Url),fe=String(p);return $.url=fe,$.generateMipMaps=!g,$.samplingMode=F,$.invertY=C,$.baseWidth=this._options.textureSize,$.baseHeight=this._options.textureSize,$.width=this._options.textureSize,$.height=this._options.textureSize,X&&($.format=X),$.isReady=!0,U&&U(),this._internalTexturesCache.push($),$},y.prototype.createRenderTargetTexture=function(p,g){var C=new x.a;g!==void 0&&typeof g=="object"?(C.generateMipMaps=g.generateMipMaps,C.generateDepthBuffer=g.generateDepthBuffer===void 0||g.generateDepthBuffer,C.generateStencilBuffer=C.generateDepthBuffer&&g.generateStencilBuffer,C.type=g.type===void 0?w.a.TEXTURETYPE_UNSIGNED_INT:g.type,C.samplingMode=g.samplingMode===void 0?w.a.TEXTURE_TRILINEAR_SAMPLINGMODE:g.samplingMode):(C.generateMipMaps=g,C.generateDepthBuffer=!0,C.generateStencilBuffer=!1,C.type=w.a.TEXTURETYPE_UNSIGNED_INT,C.samplingMode=w.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var P=new M.a(this,M.b.RenderTarget),F=p.width||p,U=p.height||p;return P._depthStencilBuffer={},P._framebuffer={},P.baseWidth=F,P.baseHeight=U,P.width=F,P.height=U,P.isReady=!0,P.samples=1,P.generateMipMaps=!!C.generateMipMaps,P.samplingMode=C.samplingMode,P.type=C.type,P._generateDepthBuffer=C.generateDepthBuffer,P._generateStencilBuffer=!!C.generateStencilBuffer,this._internalTexturesCache.push(P),P},y.prototype.updateTextureSamplingMode=function(p,g){g.samplingMode=p},y.prototype.bindFramebuffer=function(p,g,C,P,F){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=p,this._currentFramebuffer=p._MSAAFramebuffer?p._MSAAFramebuffer:p._framebuffer,this._cachedViewport&&!F&&this.setViewport(this._cachedViewport,C,P)},y.prototype.unBindFramebuffer=function(p,g,C){this._currentRenderTarget=null,C&&(p._MSAAFramebuffer&&(this._currentFramebuffer=p._framebuffer),C()),this._currentFramebuffer=null},y.prototype.createDynamicVertexBuffer=function(p){var g=new S.a;return g.references=1,g.capacity=1,g},y.prototype.updateDynamicTexture=function(p,g,C,P,F){},y.prototype.areAllEffectsReady=function(){return!0},y.prototype.getError=function(){return 0},y.prototype._getUnpackAlignement=function(){return 1},y.prototype._unpackFlipY=function(p){},y.prototype.updateDynamicIndexBuffer=function(p,g,C){},y.prototype.updateDynamicVertexBuffer=function(p,g,C,P){},y.prototype._bindTextureDirectly=function(p,g){return this._boundTexturesCache[this._activeChannel]!==g&&(this._boundTexturesCache[this._activeChannel]=g,!0)},y.prototype._bindTexture=function(p,g){p<0||this._bindTextureDirectly(0,g)},y.prototype._deleteBuffer=function(p){},y.prototype.releaseEffects=function(){},y.prototype.displayLoadingUI=function(){},y.prototype.hideLoadingUI=function(){},y.prototype._uploadCompressedDataToTextureDirectly=function(p,g,C,P,F,U,B){},y.prototype._uploadDataToTextureDirectly=function(p,g,C,P){},y.prototype._uploadArrayBufferViewToTexture=function(p,g,C,P){},y.prototype._uploadImageToTexture=function(p,g,C,P){},y}(d.a)}).call(this,c(159))},function(f,s,c){c.r(s),function(T){c.d(s,"Debug",function(){return S});var m=c(127),E=c(99);c.d(s,"AbstractScene",function(){return m.AbstractScene}),c.d(s,"AbstractActionManager",function(){return m.AbstractActionManager}),c.d(s,"Action",function(){return m.Action}),c.d(s,"ActionEvent",function(){return m.ActionEvent}),c.d(s,"ActionManager",function(){return m.ActionManager}),c.d(s,"Condition",function(){return m.Condition}),c.d(s,"ValueCondition",function(){return m.ValueCondition}),c.d(s,"PredicateCondition",function(){return m.PredicateCondition}),c.d(s,"StateCondition",function(){return m.StateCondition}),c.d(s,"SwitchBooleanAction",function(){return m.SwitchBooleanAction}),c.d(s,"SetStateAction",function(){return m.SetStateAction}),c.d(s,"SetValueAction",function(){return m.SetValueAction}),c.d(s,"IncrementValueAction",function(){return m.IncrementValueAction}),c.d(s,"PlayAnimationAction",function(){return m.PlayAnimationAction}),c.d(s,"StopAnimationAction",function(){return m.StopAnimationAction}),c.d(s,"DoNothingAction",function(){return m.DoNothingAction}),c.d(s,"CombineAction",function(){return m.CombineAction}),c.d(s,"ExecuteCodeAction",function(){return m.ExecuteCodeAction}),c.d(s,"SetParentAction",function(){return m.SetParentAction}),c.d(s,"PlaySoundAction",function(){return m.PlaySoundAction}),c.d(s,"StopSoundAction",function(){return m.StopSoundAction}),c.d(s,"InterpolateValueAction",function(){return m.InterpolateValueAction}),c.d(s,"Animatable",function(){return m.Animatable}),c.d(s,"_IAnimationState",function(){return m._IAnimationState}),c.d(s,"Animation",function(){return m.Animation}),c.d(s,"TargetedAnimation",function(){return m.TargetedAnimation}),c.d(s,"AnimationGroup",function(){return m.AnimationGroup}),c.d(s,"AnimationPropertiesOverride",function(){return m.AnimationPropertiesOverride}),c.d(s,"EasingFunction",function(){return m.EasingFunction}),c.d(s,"CircleEase",function(){return m.CircleEase}),c.d(s,"BackEase",function(){return m.BackEase}),c.d(s,"BounceEase",function(){return m.BounceEase}),c.d(s,"CubicEase",function(){return m.CubicEase}),c.d(s,"ElasticEase",function(){return m.ElasticEase}),c.d(s,"ExponentialEase",function(){return m.ExponentialEase}),c.d(s,"PowerEase",function(){return m.PowerEase}),c.d(s,"QuadraticEase",function(){return m.QuadraticEase}),c.d(s,"QuarticEase",function(){return m.QuarticEase}),c.d(s,"QuinticEase",function(){return m.QuinticEase}),c.d(s,"SineEase",function(){return m.SineEase}),c.d(s,"BezierCurveEase",function(){return m.BezierCurveEase}),c.d(s,"RuntimeAnimation",function(){return m.RuntimeAnimation}),c.d(s,"AnimationEvent",function(){return m.AnimationEvent}),c.d(s,"AnimationKeyInterpolation",function(){return m.AnimationKeyInterpolation}),c.d(s,"AnimationRange",function(){return m.AnimationRange}),c.d(s,"KeepAssets",function(){return m.KeepAssets}),c.d(s,"InstantiatedEntries",function(){return m.InstantiatedEntries}),c.d(s,"AssetContainer",function(){return m.AssetContainer}),c.d(s,"Analyser",function(){return m.Analyser}),c.d(s,"AudioEngine",function(){return m.AudioEngine}),c.d(s,"AudioSceneComponent",function(){return m.AudioSceneComponent}),c.d(s,"Sound",function(){return m.Sound}),c.d(s,"SoundTrack",function(){return m.SoundTrack}),c.d(s,"WeightedSound",function(){return m.WeightedSound}),c.d(s,"AutoRotationBehavior",function(){return m.AutoRotationBehavior}),c.d(s,"BouncingBehavior",function(){return m.BouncingBehavior}),c.d(s,"FramingBehavior",function(){return m.FramingBehavior}),c.d(s,"AttachToBoxBehavior",function(){return m.AttachToBoxBehavior}),c.d(s,"FadeInOutBehavior",function(){return m.FadeInOutBehavior}),c.d(s,"MultiPointerScaleBehavior",function(){return m.MultiPointerScaleBehavior}),c.d(s,"PointerDragBehavior",function(){return m.PointerDragBehavior}),c.d(s,"SixDofDragBehavior",function(){return m.SixDofDragBehavior}),c.d(s,"Bone",function(){return m.Bone}),c.d(s,"BoneIKController",function(){return m.BoneIKController}),c.d(s,"BoneLookController",function(){return m.BoneLookController}),c.d(s,"Skeleton",function(){return m.Skeleton}),c.d(s,"ArcRotateCameraGamepadInput",function(){return m.ArcRotateCameraGamepadInput}),c.d(s,"ArcRotateCameraKeyboardMoveInput",function(){return m.ArcRotateCameraKeyboardMoveInput}),c.d(s,"ArcRotateCameraMouseWheelInput",function(){return m.ArcRotateCameraMouseWheelInput}),c.d(s,"ArcRotateCameraPointersInput",function(){return m.ArcRotateCameraPointersInput}),c.d(s,"ArcRotateCameraVRDeviceOrientationInput",function(){return m.ArcRotateCameraVRDeviceOrientationInput}),c.d(s,"FlyCameraKeyboardInput",function(){return m.FlyCameraKeyboardInput}),c.d(s,"FlyCameraMouseInput",function(){return m.FlyCameraMouseInput}),c.d(s,"FollowCameraKeyboardMoveInput",function(){return m.FollowCameraKeyboardMoveInput}),c.d(s,"FollowCameraMouseWheelInput",function(){return m.FollowCameraMouseWheelInput}),c.d(s,"FollowCameraPointersInput",function(){return m.FollowCameraPointersInput}),c.d(s,"FreeCameraDeviceOrientationInput",function(){return m.FreeCameraDeviceOrientationInput}),c.d(s,"FreeCameraGamepadInput",function(){return m.FreeCameraGamepadInput}),c.d(s,"FreeCameraKeyboardMoveInput",function(){return m.FreeCameraKeyboardMoveInput}),c.d(s,"FreeCameraMouseInput",function(){return m.FreeCameraMouseInput}),c.d(s,"FreeCameraMouseWheelInput",function(){return m.FreeCameraMouseWheelInput}),c.d(s,"FreeCameraTouchInput",function(){return m.FreeCameraTouchInput}),c.d(s,"FreeCameraVirtualJoystickInput",function(){return m.FreeCameraVirtualJoystickInput}),c.d(s,"CameraInputTypes",function(){return m.CameraInputTypes}),c.d(s,"CameraInputsManager",function(){return m.CameraInputsManager}),c.d(s,"Camera",function(){return m.Camera}),c.d(s,"TargetCamera",function(){return m.TargetCamera}),c.d(s,"FreeCamera",function(){return m.FreeCamera}),c.d(s,"FreeCameraInputsManager",function(){return m.FreeCameraInputsManager}),c.d(s,"TouchCamera",function(){return m.TouchCamera}),c.d(s,"ArcRotateCamera",function(){return m.ArcRotateCamera}),c.d(s,"ArcRotateCameraInputsManager",function(){return m.ArcRotateCameraInputsManager}),c.d(s,"DeviceOrientationCamera",function(){return m.DeviceOrientationCamera}),c.d(s,"FlyCamera",function(){return m.FlyCamera}),c.d(s,"FlyCameraInputsManager",function(){return m.FlyCameraInputsManager}),c.d(s,"FollowCamera",function(){return m.FollowCamera}),c.d(s,"ArcFollowCamera",function(){return m.ArcFollowCamera}),c.d(s,"FollowCameraInputsManager",function(){return m.FollowCameraInputsManager}),c.d(s,"GamepadCamera",function(){return m.GamepadCamera}),c.d(s,"AnaglyphArcRotateCamera",function(){return m.AnaglyphArcRotateCamera}),c.d(s,"AnaglyphFreeCamera",function(){return m.AnaglyphFreeCamera}),c.d(s,"AnaglyphGamepadCamera",function(){return m.AnaglyphGamepadCamera}),c.d(s,"AnaglyphUniversalCamera",function(){return m.AnaglyphUniversalCamera}),c.d(s,"StereoscopicArcRotateCamera",function(){return m.StereoscopicArcRotateCamera}),c.d(s,"StereoscopicFreeCamera",function(){return m.StereoscopicFreeCamera}),c.d(s,"StereoscopicGamepadCamera",function(){return m.StereoscopicGamepadCamera}),c.d(s,"StereoscopicUniversalCamera",function(){return m.StereoscopicUniversalCamera}),c.d(s,"UniversalCamera",function(){return m.UniversalCamera}),c.d(s,"VirtualJoysticksCamera",function(){return m.VirtualJoysticksCamera}),c.d(s,"VRCameraMetrics",function(){return m.VRCameraMetrics}),c.d(s,"VRDeviceOrientationArcRotateCamera",function(){return m.VRDeviceOrientationArcRotateCamera}),c.d(s,"VRDeviceOrientationFreeCamera",function(){return m.VRDeviceOrientationFreeCamera}),c.d(s,"VRDeviceOrientationGamepadCamera",function(){return m.VRDeviceOrientationGamepadCamera}),c.d(s,"OnAfterEnteringVRObservableEvent",function(){return m.OnAfterEnteringVRObservableEvent}),c.d(s,"VRExperienceHelper",function(){return m.VRExperienceHelper}),c.d(s,"WebVRFreeCamera",function(){return m.WebVRFreeCamera}),c.d(s,"Collider",function(){return m.Collider}),c.d(s,"DefaultCollisionCoordinator",function(){return m.DefaultCollisionCoordinator}),c.d(s,"PickingInfo",function(){return m.PickingInfo}),c.d(s,"IntersectionInfo",function(){return m.IntersectionInfo}),c.d(s,"_MeshCollisionData",function(){return m._MeshCollisionData}),c.d(s,"BoundingBox",function(){return m.BoundingBox}),c.d(s,"BoundingInfo",function(){return m.BoundingInfo}),c.d(s,"BoundingSphere",function(){return m.BoundingSphere}),c.d(s,"Octree",function(){return m.Octree}),c.d(s,"OctreeBlock",function(){return m.OctreeBlock}),c.d(s,"OctreeSceneComponent",function(){return m.OctreeSceneComponent}),c.d(s,"Ray",function(){return m.Ray}),c.d(s,"AxesViewer",function(){return m.AxesViewer}),c.d(s,"BoneAxesViewer",function(){return m.BoneAxesViewer}),c.d(s,"DebugLayerTab",function(){return m.DebugLayerTab}),c.d(s,"DebugLayer",function(){return m.DebugLayer}),c.d(s,"PhysicsViewer",function(){return m.PhysicsViewer}),c.d(s,"RayHelper",function(){return m.RayHelper}),c.d(s,"SkeletonViewer",function(){return m.SkeletonViewer}),c.d(s,"DeviceInputSystem",function(){return m.DeviceInputSystem}),c.d(s,"DeviceType",function(){return m.DeviceType}),c.d(s,"PointerInput",function(){return m.PointerInput}),c.d(s,"DualShockInput",function(){return m.DualShockInput}),c.d(s,"XboxInput",function(){return m.XboxInput}),c.d(s,"SwitchInput",function(){return m.SwitchInput}),c.d(s,"DeviceSource",function(){return m.DeviceSource}),c.d(s,"DeviceSourceManager",function(){return m.DeviceSourceManager}),c.d(s,"Constants",function(){return m.Constants}),c.d(s,"ThinEngine",function(){return m.ThinEngine}),c.d(s,"Engine",function(){return m.Engine}),c.d(s,"EngineStore",function(){return m.EngineStore}),c.d(s,"NullEngineOptions",function(){return m.NullEngineOptions}),c.d(s,"NullEngine",function(){return m.NullEngine}),c.d(s,"_OcclusionDataStorage",function(){return m._OcclusionDataStorage}),c.d(s,"_forceTransformFeedbackToBundle",function(){return m._forceTransformFeedbackToBundle}),c.d(s,"EngineView",function(){return m.EngineView}),c.d(s,"WebGLPipelineContext",function(){return m.WebGLPipelineContext}),c.d(s,"WebGL2ShaderProcessor",function(){return m.WebGL2ShaderProcessor}),c.d(s,"NativeEngine",function(){return m.NativeEngine}),c.d(s,"ShaderCodeInliner",function(){return m.ShaderCodeInliner}),c.d(s,"PerformanceConfigurator",function(){return m.PerformanceConfigurator}),c.d(s,"KeyboardEventTypes",function(){return m.KeyboardEventTypes}),c.d(s,"KeyboardInfo",function(){return m.KeyboardInfo}),c.d(s,"KeyboardInfoPre",function(){return m.KeyboardInfoPre}),c.d(s,"PointerEventTypes",function(){return m.PointerEventTypes}),c.d(s,"PointerInfoBase",function(){return m.PointerInfoBase}),c.d(s,"PointerInfoPre",function(){return m.PointerInfoPre}),c.d(s,"PointerInfo",function(){return m.PointerInfo}),c.d(s,"ClipboardEventTypes",function(){return m.ClipboardEventTypes}),c.d(s,"ClipboardInfo",function(){return m.ClipboardInfo}),c.d(s,"DaydreamController",function(){return m.DaydreamController}),c.d(s,"GearVRController",function(){return m.GearVRController}),c.d(s,"GenericController",function(){return m.GenericController}),c.d(s,"OculusTouchController",function(){return m.OculusTouchController}),c.d(s,"PoseEnabledControllerType",function(){return m.PoseEnabledControllerType}),c.d(s,"PoseEnabledControllerHelper",function(){return m.PoseEnabledControllerHelper}),c.d(s,"PoseEnabledController",function(){return m.PoseEnabledController}),c.d(s,"ViveController",function(){return m.ViveController}),c.d(s,"WebVRController",function(){return m.WebVRController}),c.d(s,"WindowsMotionController",function(){return m.WindowsMotionController}),c.d(s,"XRWindowsMotionController",function(){return m.XRWindowsMotionController}),c.d(s,"StickValues",function(){return m.StickValues}),c.d(s,"Gamepad",function(){return m.Gamepad}),c.d(s,"GenericPad",function(){return m.GenericPad}),c.d(s,"GamepadManager",function(){return m.GamepadManager}),c.d(s,"GamepadSystemSceneComponent",function(){return m.GamepadSystemSceneComponent}),c.d(s,"Xbox360Button",function(){return m.Xbox360Button}),c.d(s,"Xbox360Dpad",function(){return m.Xbox360Dpad}),c.d(s,"Xbox360Pad",function(){return m.Xbox360Pad}),c.d(s,"DualShockButton",function(){return m.DualShockButton}),c.d(s,"DualShockDpad",function(){return m.DualShockDpad}),c.d(s,"DualShockPad",function(){return m.DualShockPad}),c.d(s,"AxisDragGizmo",function(){return m.AxisDragGizmo}),c.d(s,"AxisScaleGizmo",function(){return m.AxisScaleGizmo}),c.d(s,"BoundingBoxGizmo",function(){return m.BoundingBoxGizmo}),c.d(s,"Gizmo",function(){return m.Gizmo}),c.d(s,"GizmoManager",function(){return m.GizmoManager}),c.d(s,"PlaneRotationGizmo",function(){return m.PlaneRotationGizmo}),c.d(s,"PositionGizmo",function(){return m.PositionGizmo}),c.d(s,"RotationGizmo",function(){return m.RotationGizmo}),c.d(s,"ScaleGizmo",function(){return m.ScaleGizmo}),c.d(s,"LightGizmo",function(){return m.LightGizmo}),c.d(s,"CameraGizmo",function(){return m.CameraGizmo}),c.d(s,"PlaneDragGizmo",function(){return m.PlaneDragGizmo}),c.d(s,"EnvironmentHelper",function(){return m.EnvironmentHelper}),c.d(s,"PhotoDome",function(){return m.PhotoDome}),c.d(s,"_forceSceneHelpersToBundle",function(){return m._forceSceneHelpersToBundle}),c.d(s,"VideoDome",function(){return m.VideoDome}),c.d(s,"EngineInstrumentation",function(){return m.EngineInstrumentation}),c.d(s,"SceneInstrumentation",function(){return m.SceneInstrumentation}),c.d(s,"_TimeToken",function(){return m._TimeToken}),c.d(s,"EffectLayer",function(){return m.EffectLayer}),c.d(s,"EffectLayerSceneComponent",function(){return m.EffectLayerSceneComponent}),c.d(s,"GlowLayer",function(){return m.GlowLayer}),c.d(s,"HighlightLayer",function(){return m.HighlightLayer}),c.d(s,"Layer",function(){return m.Layer}),c.d(s,"LayerSceneComponent",function(){return m.LayerSceneComponent}),c.d(s,"LensFlare",function(){return m.LensFlare}),c.d(s,"LensFlareSystem",function(){return m.LensFlareSystem}),c.d(s,"LensFlareSystemSceneComponent",function(){return m.LensFlareSystemSceneComponent}),c.d(s,"Light",function(){return m.Light}),c.d(s,"ShadowLight",function(){return m.ShadowLight}),c.d(s,"ShadowGenerator",function(){return m.ShadowGenerator}),c.d(s,"CascadedShadowGenerator",function(){return m.CascadedShadowGenerator}),c.d(s,"ShadowGeneratorSceneComponent",function(){return m.ShadowGeneratorSceneComponent}),c.d(s,"DirectionalLight",function(){return m.DirectionalLight}),c.d(s,"HemisphericLight",function(){return m.HemisphericLight}),c.d(s,"PointLight",function(){return m.PointLight}),c.d(s,"SpotLight",function(){return m.SpotLight}),c.d(s,"DefaultLoadingScreen",function(){return m.DefaultLoadingScreen}),c.d(s,"_BabylonLoaderRegistered",function(){return m._BabylonLoaderRegistered}),c.d(s,"BabylonFileLoaderConfiguration",function(){return m.BabylonFileLoaderConfiguration}),c.d(s,"SceneLoaderAnimationGroupLoadingMode",function(){return m.SceneLoaderAnimationGroupLoadingMode}),c.d(s,"SceneLoader",function(){return m.SceneLoader}),c.d(s,"SceneLoaderFlags",function(){return m.SceneLoaderFlags}),c.d(s,"BackgroundMaterial",function(){return m.BackgroundMaterial}),c.d(s,"ColorCurves",function(){return m.ColorCurves}),c.d(s,"EffectFallbacks",function(){return m.EffectFallbacks}),c.d(s,"Effect",function(){return m.Effect}),c.d(s,"FresnelParameters",function(){return m.FresnelParameters}),c.d(s,"ImageProcessingConfigurationDefines",function(){return m.ImageProcessingConfigurationDefines}),c.d(s,"ImageProcessingConfiguration",function(){return m.ImageProcessingConfiguration}),c.d(s,"Material",function(){return m.Material}),c.d(s,"MaterialDefines",function(){return m.MaterialDefines}),c.d(s,"ThinMaterialHelper",function(){return m.ThinMaterialHelper}),c.d(s,"MaterialHelper",function(){return m.MaterialHelper}),c.d(s,"MultiMaterial",function(){return m.MultiMaterial}),c.d(s,"PBRMaterialDefines",function(){return m.PBRMaterialDefines}),c.d(s,"PBRBaseMaterial",function(){return m.PBRBaseMaterial}),c.d(s,"PBRBaseSimpleMaterial",function(){return m.PBRBaseSimpleMaterial}),c.d(s,"PBRMaterial",function(){return m.PBRMaterial}),c.d(s,"PBRMetallicRoughnessMaterial",function(){return m.PBRMetallicRoughnessMaterial}),c.d(s,"PBRSpecularGlossinessMaterial",function(){return m.PBRSpecularGlossinessMaterial}),c.d(s,"PushMaterial",function(){return m.PushMaterial}),c.d(s,"ShaderMaterial",function(){return m.ShaderMaterial}),c.d(s,"StandardMaterialDefines",function(){return m.StandardMaterialDefines}),c.d(s,"StandardMaterial",function(){return m.StandardMaterial}),c.d(s,"BaseTexture",function(){return m.BaseTexture}),c.d(s,"ColorGradingTexture",function(){return m.ColorGradingTexture}),c.d(s,"CubeTexture",function(){return m.CubeTexture}),c.d(s,"DynamicTexture",function(){return m.DynamicTexture}),c.d(s,"EquiRectangularCubeTexture",function(){return m.EquiRectangularCubeTexture}),c.d(s,"HDRFiltering",function(){return m.HDRFiltering}),c.d(s,"HDRCubeTexture",function(){return m.HDRCubeTexture}),c.d(s,"HtmlElementTexture",function(){return m.HtmlElementTexture}),c.d(s,"InternalTextureSource",function(){return m.InternalTextureSource}),c.d(s,"InternalTexture",function(){return m.InternalTexture}),c.d(s,"_DDSTextureLoader",function(){return m._DDSTextureLoader}),c.d(s,"_ENVTextureLoader",function(){return m._ENVTextureLoader}),c.d(s,"_KTXTextureLoader",function(){return m._KTXTextureLoader}),c.d(s,"_TGATextureLoader",function(){return m._TGATextureLoader}),c.d(s,"_BasisTextureLoader",function(){return m._BasisTextureLoader}),c.d(s,"MirrorTexture",function(){return m.MirrorTexture}),c.d(s,"MultiRenderTarget",function(){return m.MultiRenderTarget}),c.d(s,"TexturePacker",function(){return m.TexturePacker}),c.d(s,"TexturePackerFrame",function(){return m.TexturePackerFrame}),c.d(s,"CustomProceduralTexture",function(){return m.CustomProceduralTexture}),c.d(s,"NoiseProceduralTexture",function(){return m.NoiseProceduralTexture}),c.d(s,"ProceduralTexture",function(){return m.ProceduralTexture}),c.d(s,"ProceduralTextureSceneComponent",function(){return m.ProceduralTextureSceneComponent}),c.d(s,"RawCubeTexture",function(){return m.RawCubeTexture}),c.d(s,"RawTexture",function(){return m.RawTexture}),c.d(s,"RawTexture2DArray",function(){return m.RawTexture2DArray}),c.d(s,"RawTexture3D",function(){return m.RawTexture3D}),c.d(s,"RefractionTexture",function(){return m.RefractionTexture}),c.d(s,"RenderTargetTexture",function(){return m.RenderTargetTexture}),c.d(s,"Texture",function(){return m.Texture}),c.d(s,"VideoTexture",function(){return m.VideoTexture}),c.d(s,"UniformBuffer",function(){return m.UniformBuffer}),c.d(s,"MaterialFlags",function(){return m.MaterialFlags}),c.d(s,"NodeMaterialBlockTargets",function(){return m.NodeMaterialBlockTargets}),c.d(s,"NodeMaterialBlockConnectionPointTypes",function(){return m.NodeMaterialBlockConnectionPointTypes}),c.d(s,"NodeMaterialBlockConnectionPointMode",function(){return m.NodeMaterialBlockConnectionPointMode}),c.d(s,"NodeMaterialSystemValues",function(){return m.NodeMaterialSystemValues}),c.d(s,"NodeMaterialModes",function(){return m.NodeMaterialModes}),c.d(s,"NodeMaterialConnectionPointCompatibilityStates",function(){return m.NodeMaterialConnectionPointCompatibilityStates}),c.d(s,"NodeMaterialConnectionPointDirection",function(){return m.NodeMaterialConnectionPointDirection}),c.d(s,"NodeMaterialConnectionPoint",function(){return m.NodeMaterialConnectionPoint}),c.d(s,"NodeMaterialBlock",function(){return m.NodeMaterialBlock}),c.d(s,"NodeMaterialDefines",function(){return m.NodeMaterialDefines}),c.d(s,"NodeMaterial",function(){return m.NodeMaterial}),c.d(s,"VertexOutputBlock",function(){return m.VertexOutputBlock}),c.d(s,"BonesBlock",function(){return m.BonesBlock}),c.d(s,"InstancesBlock",function(){return m.InstancesBlock}),c.d(s,"MorphTargetsBlock",function(){return m.MorphTargetsBlock}),c.d(s,"LightInformationBlock",function(){return m.LightInformationBlock}),c.d(s,"FragmentOutputBlock",function(){return m.FragmentOutputBlock}),c.d(s,"ImageProcessingBlock",function(){return m.ImageProcessingBlock}),c.d(s,"PerturbNormalBlock",function(){return m.PerturbNormalBlock}),c.d(s,"DiscardBlock",function(){return m.DiscardBlock}),c.d(s,"FrontFacingBlock",function(){return m.FrontFacingBlock}),c.d(s,"DerivativeBlock",function(){return m.DerivativeBlock}),c.d(s,"FragCoordBlock",function(){return m.FragCoordBlock}),c.d(s,"ScreenSizeBlock",function(){return m.ScreenSizeBlock}),c.d(s,"FogBlock",function(){return m.FogBlock}),c.d(s,"LightBlock",function(){return m.LightBlock}),c.d(s,"TextureBlock",function(){return m.TextureBlock}),c.d(s,"ReflectionTextureBlock",function(){return m.ReflectionTextureBlock}),c.d(s,"CurrentScreenBlock",function(){return m.CurrentScreenBlock}),c.d(s,"InputBlock",function(){return m.InputBlock}),c.d(s,"AnimatedInputBlockTypes",function(){return m.AnimatedInputBlockTypes}),c.d(s,"MultiplyBlock",function(){return m.MultiplyBlock}),c.d(s,"AddBlock",function(){return m.AddBlock}),c.d(s,"ScaleBlock",function(){return m.ScaleBlock}),c.d(s,"ClampBlock",function(){return m.ClampBlock}),c.d(s,"CrossBlock",function(){return m.CrossBlock}),c.d(s,"DotBlock",function(){return m.DotBlock}),c.d(s,"TransformBlock",function(){return m.TransformBlock}),c.d(s,"RemapBlock",function(){return m.RemapBlock}),c.d(s,"NormalizeBlock",function(){return m.NormalizeBlock}),c.d(s,"TrigonometryBlockOperations",function(){return m.TrigonometryBlockOperations}),c.d(s,"TrigonometryBlock",function(){return m.TrigonometryBlock}),c.d(s,"ColorMergerBlock",function(){return m.ColorMergerBlock}),c.d(s,"VectorMergerBlock",function(){return m.VectorMergerBlock}),c.d(s,"ColorSplitterBlock",function(){return m.ColorSplitterBlock}),c.d(s,"VectorSplitterBlock",function(){return m.VectorSplitterBlock}),c.d(s,"LerpBlock",function(){return m.LerpBlock}),c.d(s,"DivideBlock",function(){return m.DivideBlock}),c.d(s,"SubtractBlock",function(){return m.SubtractBlock}),c.d(s,"StepBlock",function(){return m.StepBlock}),c.d(s,"OneMinusBlock",function(){return m.OneMinusBlock}),c.d(s,"ViewDirectionBlock",function(){return m.ViewDirectionBlock}),c.d(s,"FresnelBlock",function(){return m.FresnelBlock}),c.d(s,"MaxBlock",function(){return m.MaxBlock}),c.d(s,"MinBlock",function(){return m.MinBlock}),c.d(s,"DistanceBlock",function(){return m.DistanceBlock}),c.d(s,"LengthBlock",function(){return m.LengthBlock}),c.d(s,"NegateBlock",function(){return m.NegateBlock}),c.d(s,"PowBlock",function(){return m.PowBlock}),c.d(s,"RandomNumberBlock",function(){return m.RandomNumberBlock}),c.d(s,"ArcTan2Block",function(){return m.ArcTan2Block}),c.d(s,"SmoothStepBlock",function(){return m.SmoothStepBlock}),c.d(s,"ReciprocalBlock",function(){return m.ReciprocalBlock}),c.d(s,"ReplaceColorBlock",function(){return m.ReplaceColorBlock}),c.d(s,"PosterizeBlock",function(){return m.PosterizeBlock}),c.d(s,"WaveBlockKind",function(){return m.WaveBlockKind}),c.d(s,"WaveBlock",function(){return m.WaveBlock}),c.d(s,"GradientBlockColorStep",function(){return m.GradientBlockColorStep}),c.d(s,"GradientBlock",function(){return m.GradientBlock}),c.d(s,"NLerpBlock",function(){return m.NLerpBlock}),c.d(s,"WorleyNoise3DBlock",function(){return m.WorleyNoise3DBlock}),c.d(s,"SimplexPerlin3DBlock",function(){return m.SimplexPerlin3DBlock}),c.d(s,"NormalBlendBlock",function(){return m.NormalBlendBlock}),c.d(s,"Rotate2dBlock",function(){return m.Rotate2dBlock}),c.d(s,"ReflectBlock",function(){return m.ReflectBlock}),c.d(s,"RefractBlock",function(){return m.RefractBlock}),c.d(s,"DesaturateBlock",function(){return m.DesaturateBlock}),c.d(s,"PBRMetallicRoughnessBlock",function(){return m.PBRMetallicRoughnessBlock}),c.d(s,"SheenBlock",function(){return m.SheenBlock}),c.d(s,"AnisotropyBlock",function(){return m.AnisotropyBlock}),c.d(s,"ReflectionBlock",function(){return m.ReflectionBlock}),c.d(s,"ClearCoatBlock",function(){return m.ClearCoatBlock}),c.d(s,"RefractionBlock",function(){return m.RefractionBlock}),c.d(s,"SubSurfaceBlock",function(){return m.SubSurfaceBlock}),c.d(s,"ParticleTextureBlock",function(){return m.ParticleTextureBlock}),c.d(s,"ParticleRampGradientBlock",function(){return m.ParticleRampGradientBlock}),c.d(s,"ParticleBlendMultiplyBlock",function(){return m.ParticleBlendMultiplyBlock}),c.d(s,"ModBlock",function(){return m.ModBlock}),c.d(s,"NodeMaterialOptimizer",function(){return m.NodeMaterialOptimizer}),c.d(s,"PropertyTypeForEdition",function(){return m.PropertyTypeForEdition}),c.d(s,"editableInPropertyPage",function(){return m.editableInPropertyPage}),c.d(s,"EffectRenderer",function(){return m.EffectRenderer}),c.d(s,"EffectWrapper",function(){return m.EffectWrapper}),c.d(s,"ShadowDepthWrapper",function(){return m.ShadowDepthWrapper}),c.d(s,"Scalar",function(){return m.Scalar}),c.d(s,"extractMinAndMaxIndexed",function(){return m.extractMinAndMaxIndexed}),c.d(s,"extractMinAndMax",function(){return m.extractMinAndMax}),c.d(s,"Space",function(){return m.Space}),c.d(s,"Axis",function(){return m.Axis}),c.d(s,"Coordinate",function(){return m.Coordinate}),c.d(s,"Color3",function(){return m.Color3}),c.d(s,"Color4",function(){return m.Color4}),c.d(s,"TmpColors",function(){return m.TmpColors}),c.d(s,"ToGammaSpace",function(){return m.ToGammaSpace}),c.d(s,"ToLinearSpace",function(){return m.ToLinearSpace}),c.d(s,"Epsilon",function(){return m.Epsilon}),c.d(s,"Frustum",function(){return m.Frustum}),c.d(s,"Orientation",function(){return m.Orientation}),c.d(s,"BezierCurve",function(){return m.BezierCurve}),c.d(s,"Angle",function(){return m.Angle}),c.d(s,"Arc2",function(){return m.Arc2}),c.d(s,"Path2",function(){return m.Path2}),c.d(s,"Path3D",function(){return m.Path3D}),c.d(s,"Curve3",function(){return m.Curve3}),c.d(s,"Plane",function(){return m.Plane}),c.d(s,"Size",function(){return m.Size}),c.d(s,"Vector2",function(){return m.Vector2}),c.d(s,"Vector3",function(){return m.Vector3}),c.d(s,"Vector4",function(){return m.Vector4}),c.d(s,"Quaternion",function(){return m.Quaternion}),c.d(s,"Matrix",function(){return m.Matrix}),c.d(s,"TmpVectors",function(){return m.TmpVectors}),c.d(s,"PositionNormalVertex",function(){return m.PositionNormalVertex}),c.d(s,"PositionNormalTextureVertex",function(){return m.PositionNormalTextureVertex}),c.d(s,"Viewport",function(){return m.Viewport}),c.d(s,"SphericalHarmonics",function(){return m.SphericalHarmonics}),c.d(s,"SphericalPolynomial",function(){return m.SphericalPolynomial}),c.d(s,"AbstractMesh",function(){return m.AbstractMesh}),c.d(s,"Buffer",function(){return m.Buffer}),c.d(s,"VertexBuffer",function(){return m.VertexBuffer}),c.d(s,"DracoCompression",function(){return m.DracoCompression}),c.d(s,"CSG",function(){return m.CSG}),c.d(s,"Geometry",function(){return m.Geometry}),c.d(s,"GroundMesh",function(){return m.GroundMesh}),c.d(s,"TrailMesh",function(){return m.TrailMesh}),c.d(s,"InstancedMesh",function(){return m.InstancedMesh}),c.d(s,"LinesMesh",function(){return m.LinesMesh}),c.d(s,"InstancedLinesMesh",function(){return m.InstancedLinesMesh}),c.d(s,"_CreationDataStorage",function(){return m._CreationDataStorage}),c.d(s,"_InstancesBatch",function(){return m._InstancesBatch}),c.d(s,"Mesh",function(){return m.Mesh}),c.d(s,"VertexData",function(){return m.VertexData}),c.d(s,"MeshBuilder",function(){return m.MeshBuilder}),c.d(s,"SimplificationSettings",function(){return m.SimplificationSettings}),c.d(s,"SimplificationQueue",function(){return m.SimplificationQueue}),c.d(s,"SimplificationType",function(){return m.SimplificationType}),c.d(s,"QuadraticErrorSimplification",function(){return m.QuadraticErrorSimplification}),c.d(s,"SimplicationQueueSceneComponent",function(){return m.SimplicationQueueSceneComponent}),c.d(s,"Polygon",function(){return m.Polygon}),c.d(s,"PolygonMeshBuilder",function(){return m.PolygonMeshBuilder}),c.d(s,"SubMesh",function(){return m.SubMesh}),c.d(s,"MeshLODLevel",function(){return m.MeshLODLevel}),c.d(s,"TransformNode",function(){return m.TransformNode}),c.d(s,"BoxBuilder",function(){return m.BoxBuilder}),c.d(s,"TiledBoxBuilder",function(){return m.TiledBoxBuilder}),c.d(s,"DiscBuilder",function(){return m.DiscBuilder}),c.d(s,"RibbonBuilder",function(){return m.RibbonBuilder}),c.d(s,"SphereBuilder",function(){return m.SphereBuilder}),c.d(s,"HemisphereBuilder",function(){return m.HemisphereBuilder}),c.d(s,"CylinderBuilder",function(){return m.CylinderBuilder}),c.d(s,"TorusBuilder",function(){return m.TorusBuilder}),c.d(s,"TorusKnotBuilder",function(){return m.TorusKnotBuilder}),c.d(s,"LinesBuilder",function(){return m.LinesBuilder}),c.d(s,"PolygonBuilder",function(){return m.PolygonBuilder}),c.d(s,"ShapeBuilder",function(){return m.ShapeBuilder}),c.d(s,"LatheBuilder",function(){return m.LatheBuilder}),c.d(s,"PlaneBuilder",function(){return m.PlaneBuilder}),c.d(s,"TiledPlaneBuilder",function(){return m.TiledPlaneBuilder}),c.d(s,"GroundBuilder",function(){return m.GroundBuilder}),c.d(s,"TubeBuilder",function(){return m.TubeBuilder}),c.d(s,"PolyhedronBuilder",function(){return m.PolyhedronBuilder}),c.d(s,"IcoSphereBuilder",function(){return m.IcoSphereBuilder}),c.d(s,"DecalBuilder",function(){return m.DecalBuilder}),c.d(s,"CapsuleBuilder",function(){return m.CapsuleBuilder}),c.d(s,"DataBuffer",function(){return m.DataBuffer}),c.d(s,"WebGLDataBuffer",function(){return m.WebGLDataBuffer}),c.d(s,"MorphTarget",function(){return m.MorphTarget}),c.d(s,"MorphTargetManager",function(){return m.MorphTargetManager}),c.d(s,"RecastJSPlugin",function(){return m.RecastJSPlugin}),c.d(s,"RecastJSCrowd",function(){return m.RecastJSCrowd}),c.d(s,"Node",function(){return m.Node}),c.d(s,"Database",function(){return m.Database}),c.d(s,"BaseParticleSystem",function(){return m.BaseParticleSystem}),c.d(s,"BoxParticleEmitter",function(){return m.BoxParticleEmitter}),c.d(s,"ConeParticleEmitter",function(){return m.ConeParticleEmitter}),c.d(s,"CylinderParticleEmitter",function(){return m.CylinderParticleEmitter}),c.d(s,"CylinderDirectedParticleEmitter",function(){return m.CylinderDirectedParticleEmitter}),c.d(s,"HemisphericParticleEmitter",function(){return m.HemisphericParticleEmitter}),c.d(s,"PointParticleEmitter",function(){return m.PointParticleEmitter}),c.d(s,"SphereParticleEmitter",function(){return m.SphereParticleEmitter}),c.d(s,"SphereDirectedParticleEmitter",function(){return m.SphereDirectedParticleEmitter}),c.d(s,"CustomParticleEmitter",function(){return m.CustomParticleEmitter}),c.d(s,"MeshParticleEmitter",function(){return m.MeshParticleEmitter}),c.d(s,"GPUParticleSystem",function(){return m.GPUParticleSystem}),c.d(s,"Particle",function(){return m.Particle}),c.d(s,"ParticleHelper",function(){return m.ParticleHelper}),c.d(s,"ParticleSystem",function(){return m.ParticleSystem}),c.d(s,"ParticleSystemSet",function(){return m.ParticleSystemSet}),c.d(s,"SolidParticle",function(){return m.SolidParticle}),c.d(s,"ModelShape",function(){return m.ModelShape}),c.d(s,"DepthSortedParticle",function(){return m.DepthSortedParticle}),c.d(s,"SolidParticleVertex",function(){return m.SolidParticleVertex}),c.d(s,"SolidParticleSystem",function(){return m.SolidParticleSystem}),c.d(s,"CloudPoint",function(){return m.CloudPoint}),c.d(s,"PointsGroup",function(){return m.PointsGroup}),c.d(s,"PointColor",function(){return m.PointColor}),c.d(s,"PointsCloudSystem",function(){return m.PointsCloudSystem}),c.d(s,"SubEmitterType",function(){return m.SubEmitterType}),c.d(s,"SubEmitter",function(){return m.SubEmitter}),c.d(s,"PhysicsEngine",function(){return m.PhysicsEngine}),c.d(s,"PhysicsEngineSceneComponent",function(){return m.PhysicsEngineSceneComponent}),c.d(s,"PhysicsHelper",function(){return m.PhysicsHelper}),c.d(s,"PhysicsRadialExplosionEventOptions",function(){return m.PhysicsRadialExplosionEventOptions}),c.d(s,"PhysicsUpdraftEventOptions",function(){return m.PhysicsUpdraftEventOptions}),c.d(s,"PhysicsVortexEventOptions",function(){return m.PhysicsVortexEventOptions}),c.d(s,"PhysicsRadialImpulseFalloff",function(){return m.PhysicsRadialImpulseFalloff}),c.d(s,"PhysicsUpdraftMode",function(){return m.PhysicsUpdraftMode}),c.d(s,"PhysicsImpostor",function(){return m.PhysicsImpostor}),c.d(s,"PhysicsJoint",function(){return m.PhysicsJoint}),c.d(s,"DistanceJoint",function(){return m.DistanceJoint}),c.d(s,"MotorEnabledJoint",function(){return m.MotorEnabledJoint}),c.d(s,"HingeJoint",function(){return m.HingeJoint}),c.d(s,"Hinge2Joint",function(){return m.Hinge2Joint}),c.d(s,"CannonJSPlugin",function(){return m.CannonJSPlugin}),c.d(s,"AmmoJSPlugin",function(){return m.AmmoJSPlugin}),c.d(s,"OimoJSPlugin",function(){return m.OimoJSPlugin}),c.d(s,"AnaglyphPostProcess",function(){return m.AnaglyphPostProcess}),c.d(s,"BlackAndWhitePostProcess",function(){return m.BlackAndWhitePostProcess}),c.d(s,"BloomEffect",function(){return m.BloomEffect}),c.d(s,"BloomMergePostProcess",function(){return m.BloomMergePostProcess}),c.d(s,"BlurPostProcess",function(){return m.BlurPostProcess}),c.d(s,"ChromaticAberrationPostProcess",function(){return m.ChromaticAberrationPostProcess}),c.d(s,"CircleOfConfusionPostProcess",function(){return m.CircleOfConfusionPostProcess}),c.d(s,"ColorCorrectionPostProcess",function(){return m.ColorCorrectionPostProcess}),c.d(s,"ConvolutionPostProcess",function(){return m.ConvolutionPostProcess}),c.d(s,"DepthOfFieldBlurPostProcess",function(){return m.DepthOfFieldBlurPostProcess}),c.d(s,"DepthOfFieldEffectBlurLevel",function(){return m.DepthOfFieldEffectBlurLevel}),c.d(s,"DepthOfFieldEffect",function(){return m.DepthOfFieldEffect}),c.d(s,"DepthOfFieldMergePostProcessOptions",function(){return m.DepthOfFieldMergePostProcessOptions}),c.d(s,"DepthOfFieldMergePostProcess",function(){return m.DepthOfFieldMergePostProcess}),c.d(s,"DisplayPassPostProcess",function(){return m.DisplayPassPostProcess}),c.d(s,"ExtractHighlightsPostProcess",function(){return m.ExtractHighlightsPostProcess}),c.d(s,"FilterPostProcess",function(){return m.FilterPostProcess}),c.d(s,"FxaaPostProcess",function(){return m.FxaaPostProcess}),c.d(s,"GrainPostProcess",function(){return m.GrainPostProcess}),c.d(s,"HighlightsPostProcess",function(){return m.HighlightsPostProcess}),c.d(s,"ImageProcessingPostProcess",function(){return m.ImageProcessingPostProcess}),c.d(s,"MotionBlurPostProcess",function(){return m.MotionBlurPostProcess}),c.d(s,"PassPostProcess",function(){return m.PassPostProcess}),c.d(s,"PassCubePostProcess",function(){return m.PassCubePostProcess}),c.d(s,"PostProcess",function(){return m.PostProcess}),c.d(s,"PostProcessManager",function(){return m.PostProcessManager}),c.d(s,"RefractionPostProcess",function(){return m.RefractionPostProcess}),c.d(s,"DefaultRenderingPipeline",function(){return m.DefaultRenderingPipeline}),c.d(s,"LensRenderingPipeline",function(){return m.LensRenderingPipeline}),c.d(s,"SSAO2RenderingPipeline",function(){return m.SSAO2RenderingPipeline}),c.d(s,"SSAORenderingPipeline",function(){return m.SSAORenderingPipeline}),c.d(s,"StandardRenderingPipeline",function(){return m.StandardRenderingPipeline}),c.d(s,"PostProcessRenderEffect",function(){return m.PostProcessRenderEffect}),c.d(s,"PostProcessRenderPipeline",function(){return m.PostProcessRenderPipeline}),c.d(s,"PostProcessRenderPipelineManager",function(){return m.PostProcessRenderPipelineManager}),c.d(s,"PostProcessRenderPipelineManagerSceneComponent",function(){return m.PostProcessRenderPipelineManagerSceneComponent}),c.d(s,"SharpenPostProcess",function(){return m.SharpenPostProcess}),c.d(s,"StereoscopicInterlacePostProcessI",function(){return m.StereoscopicInterlacePostProcessI}),c.d(s,"StereoscopicInterlacePostProcess",function(){return m.StereoscopicInterlacePostProcess}),c.d(s,"TonemappingOperator",function(){return m.TonemappingOperator}),c.d(s,"TonemapPostProcess",function(){return m.TonemapPostProcess}),c.d(s,"VolumetricLightScatteringPostProcess",function(){return m.VolumetricLightScatteringPostProcess}),c.d(s,"VRDistortionCorrectionPostProcess",function(){return m.VRDistortionCorrectionPostProcess}),c.d(s,"VRMultiviewToSingleviewPostProcess",function(){return m.VRMultiviewToSingleviewPostProcess}),c.d(s,"ScreenSpaceReflectionPostProcess",function(){return m.ScreenSpaceReflectionPostProcess}),c.d(s,"ScreenSpaceCurvaturePostProcess",function(){return m.ScreenSpaceCurvaturePostProcess}),c.d(s,"ReflectionProbe",function(){return m.ReflectionProbe}),c.d(s,"BoundingBoxRenderer",function(){return m.BoundingBoxRenderer}),c.d(s,"DepthRenderer",function(){return m.DepthRenderer}),c.d(s,"DepthRendererSceneComponent",function(){return m.DepthRendererSceneComponent}),c.d(s,"EdgesRenderer",function(){return m.EdgesRenderer}),c.d(s,"LineEdgesRenderer",function(){return m.LineEdgesRenderer}),c.d(s,"GeometryBufferRenderer",function(){return m.GeometryBufferRenderer}),c.d(s,"GeometryBufferRendererSceneComponent",function(){return m.GeometryBufferRendererSceneComponent}),c.d(s,"PrePassRenderer",function(){return m.PrePassRenderer}),c.d(s,"PrePassRendererSceneComponent",function(){return m.PrePassRendererSceneComponent}),c.d(s,"SubSurfaceSceneComponent",function(){return m.SubSurfaceSceneComponent}),c.d(s,"OutlineRenderer",function(){return m.OutlineRenderer}),c.d(s,"RenderingGroup",function(){return m.RenderingGroup}),c.d(s,"RenderingGroupInfo",function(){return m.RenderingGroupInfo}),c.d(s,"RenderingManager",function(){return m.RenderingManager}),c.d(s,"UtilityLayerRenderer",function(){return m.UtilityLayerRenderer}),c.d(s,"Scene",function(){return m.Scene}),c.d(s,"SceneComponentConstants",function(){return m.SceneComponentConstants}),c.d(s,"Stage",function(){return m.Stage}),c.d(s,"Sprite",function(){return m.Sprite}),c.d(s,"SpriteManager",function(){return m.SpriteManager}),c.d(s,"SpriteMap",function(){return m.SpriteMap}),c.d(s,"SpritePackedManager",function(){return m.SpritePackedManager}),c.d(s,"SpriteSceneComponent",function(){return m.SpriteSceneComponent}),c.d(s,"AlphaState",function(){return m.AlphaState}),c.d(s,"DepthCullingState",function(){return m.DepthCullingState}),c.d(s,"StencilState",function(){return m.StencilState}),c.d(s,"AndOrNotEvaluator",function(){return m.AndOrNotEvaluator}),c.d(s,"AssetTaskState",function(){return m.AssetTaskState}),c.d(s,"AbstractAssetTask",function(){return m.AbstractAssetTask}),c.d(s,"AssetsProgressEvent",function(){return m.AssetsProgressEvent}),c.d(s,"ContainerAssetTask",function(){return m.ContainerAssetTask}),c.d(s,"MeshAssetTask",function(){return m.MeshAssetTask}),c.d(s,"TextFileAssetTask",function(){return m.TextFileAssetTask}),c.d(s,"BinaryFileAssetTask",function(){return m.BinaryFileAssetTask}),c.d(s,"ImageAssetTask",function(){return m.ImageAssetTask}),c.d(s,"TextureAssetTask",function(){return m.TextureAssetTask}),c.d(s,"CubeTextureAssetTask",function(){return m.CubeTextureAssetTask}),c.d(s,"HDRCubeTextureAssetTask",function(){return m.HDRCubeTextureAssetTask}),c.d(s,"EquiRectangularCubeTextureAssetTask",function(){return m.EquiRectangularCubeTextureAssetTask}),c.d(s,"AssetsManager",function(){return m.AssetsManager}),c.d(s,"BasisTranscodeConfiguration",function(){return m.BasisTranscodeConfiguration}),c.d(s,"BasisTools",function(){return m.BasisTools}),c.d(s,"DDSTools",function(){return m.DDSTools}),c.d(s,"expandToProperty",function(){return m.expandToProperty}),c.d(s,"serialize",function(){return m.serialize}),c.d(s,"serializeAsTexture",function(){return m.serializeAsTexture}),c.d(s,"serializeAsColor3",function(){return m.serializeAsColor3}),c.d(s,"serializeAsFresnelParameters",function(){return m.serializeAsFresnelParameters}),c.d(s,"serializeAsVector2",function(){return m.serializeAsVector2}),c.d(s,"serializeAsVector3",function(){return m.serializeAsVector3}),c.d(s,"serializeAsMeshReference",function(){return m.serializeAsMeshReference}),c.d(s,"serializeAsColorCurves",function(){return m.serializeAsColorCurves}),c.d(s,"serializeAsColor4",function(){return m.serializeAsColor4}),c.d(s,"serializeAsImageProcessingConfiguration",function(){return m.serializeAsImageProcessingConfiguration}),c.d(s,"serializeAsQuaternion",function(){return m.serializeAsQuaternion}),c.d(s,"serializeAsMatrix",function(){return m.serializeAsMatrix}),c.d(s,"serializeAsCameraReference",function(){return m.serializeAsCameraReference}),c.d(s,"SerializationHelper",function(){return m.SerializationHelper}),c.d(s,"Deferred",function(){return m.Deferred}),c.d(s,"EnvironmentTextureTools",function(){return m.EnvironmentTextureTools}),c.d(s,"MeshExploder",function(){return m.MeshExploder}),c.d(s,"FilesInput",function(){return m.FilesInput}),c.d(s,"CubeMapToSphericalPolynomialTools",function(){return m.CubeMapToSphericalPolynomialTools}),c.d(s,"HDRTools",function(){return m.HDRTools}),c.d(s,"PanoramaToCubeMapTools",function(){return m.PanoramaToCubeMapTools}),c.d(s,"KhronosTextureContainer",function(){return m.KhronosTextureContainer}),c.d(s,"EventState",function(){return m.EventState}),c.d(s,"Observer",function(){return m.Observer}),c.d(s,"MultiObserver",function(){return m.MultiObserver}),c.d(s,"Observable",function(){return m.Observable}),c.d(s,"PerformanceMonitor",function(){return m.PerformanceMonitor}),c.d(s,"RollingAverage",function(){return m.RollingAverage}),c.d(s,"PromisePolyfill",function(){return m.PromisePolyfill}),c.d(s,"SceneOptimization",function(){return m.SceneOptimization}),c.d(s,"TextureOptimization",function(){return m.TextureOptimization}),c.d(s,"HardwareScalingOptimization",function(){return m.HardwareScalingOptimization}),c.d(s,"ShadowsOptimization",function(){return m.ShadowsOptimization}),c.d(s,"PostProcessesOptimization",function(){return m.PostProcessesOptimization}),c.d(s,"LensFlaresOptimization",function(){return m.LensFlaresOptimization}),c.d(s,"CustomOptimization",function(){return m.CustomOptimization}),c.d(s,"ParticlesOptimization",function(){return m.ParticlesOptimization}),c.d(s,"RenderTargetsOptimization",function(){return m.RenderTargetsOptimization}),c.d(s,"MergeMeshesOptimization",function(){return m.MergeMeshesOptimization}),c.d(s,"SceneOptimizerOptions",function(){return m.SceneOptimizerOptions}),c.d(s,"SceneOptimizer",function(){return m.SceneOptimizer}),c.d(s,"SceneSerializer",function(){return m.SceneSerializer}),c.d(s,"SmartArray",function(){return m.SmartArray}),c.d(s,"SmartArrayNoDuplicate",function(){return m.SmartArrayNoDuplicate}),c.d(s,"StringDictionary",function(){return m.StringDictionary}),c.d(s,"Tags",function(){return m.Tags}),c.d(s,"TextureTools",function(){return m.TextureTools}),c.d(s,"TGATools",function(){return m.TGATools}),c.d(s,"Tools",function(){return m.Tools}),c.d(s,"className",function(){return m.className}),c.d(s,"AsyncLoop",function(){return m.AsyncLoop}),c.d(s,"VideoRecorder",function(){return m.VideoRecorder}),c.d(s,"JoystickAxis",function(){return m.JoystickAxis}),c.d(s,"VirtualJoystick",function(){return m.VirtualJoystick}),c.d(s,"WorkerPool",function(){return m.WorkerPool}),c.d(s,"Logger",function(){return m.Logger}),c.d(s,"_TypeStore",function(){return m._TypeStore}),c.d(s,"FilesInputStore",function(){return m.FilesInputStore}),c.d(s,"DeepCopier",function(){return m.DeepCopier}),c.d(s,"PivotTools",function(){return m.PivotTools}),c.d(s,"PrecisionDate",function(){return m.PrecisionDate}),c.d(s,"ScreenshotTools",function(){return m.ScreenshotTools}),c.d(s,"WebRequest",function(){return m.WebRequest}),c.d(s,"InspectableType",function(){return m.InspectableType}),c.d(s,"BRDFTextureTools",function(){return m.BRDFTextureTools}),c.d(s,"RGBDTextureTools",function(){return m.RGBDTextureTools}),c.d(s,"ColorGradient",function(){return m.ColorGradient}),c.d(s,"Color3Gradient",function(){return m.Color3Gradient}),c.d(s,"FactorGradient",function(){return m.FactorGradient}),c.d(s,"GradientHelper",function(){return m.GradientHelper}),c.d(s,"PerfCounter",function(){return m.PerfCounter}),c.d(s,"RetryStrategy",function(){return m.RetryStrategy}),c.d(s,"CanvasGenerator",function(){return m.CanvasGenerator}),c.d(s,"LoadFileError",function(){return m.LoadFileError}),c.d(s,"RequestFileError",function(){return m.RequestFileError}),c.d(s,"ReadFileError",function(){return m.ReadFileError}),c.d(s,"FileTools",function(){return m.FileTools}),c.d(s,"StringTools",function(){return m.StringTools}),c.d(s,"DataReader",function(){return m.DataReader}),c.d(s,"MinMaxReducer",function(){return m.MinMaxReducer}),c.d(s,"DepthReducer",function(){return m.DepthReducer}),c.d(s,"DataStorage",function(){return m.DataStorage}),c.d(s,"SceneRecorder",function(){return m.SceneRecorder}),c.d(s,"KhronosTextureContainer2",function(){return m.KhronosTextureContainer2}),c.d(s,"Trajectory",function(){return m.Trajectory}),c.d(s,"TrajectoryClassifier",function(){return m.TrajectoryClassifier}),c.d(s,"TimerState",function(){return m.TimerState}),c.d(s,"setAndStartTimer",function(){return m.setAndStartTimer}),c.d(s,"AdvancedTimer",function(){return m.AdvancedTimer}),c.d(s,"CopyTools",function(){return m.CopyTools}),c.d(s,"WebXRCamera",function(){return m.WebXRCamera}),c.d(s,"WebXREnterExitUIButton",function(){return m.WebXREnterExitUIButton}),c.d(s,"WebXREnterExitUIOptions",function(){return m.WebXREnterExitUIOptions}),c.d(s,"WebXREnterExitUI",function(){return m.WebXREnterExitUI}),c.d(s,"WebXRExperienceHelper",function(){return m.WebXRExperienceHelper}),c.d(s,"WebXRInput",function(){return m.WebXRInput}),c.d(s,"WebXRInputSource",function(){return m.WebXRInputSource}),c.d(s,"WebXRManagedOutputCanvasOptions",function(){return m.WebXRManagedOutputCanvasOptions}),c.d(s,"WebXRManagedOutputCanvas",function(){return m.WebXRManagedOutputCanvas}),c.d(s,"WebXRState",function(){return m.WebXRState}),c.d(s,"WebXRTrackingState",function(){return m.WebXRTrackingState}),c.d(s,"WebXRSessionManager",function(){return m.WebXRSessionManager}),c.d(s,"WebXRDefaultExperienceOptions",function(){return m.WebXRDefaultExperienceOptions}),c.d(s,"WebXRDefaultExperience",function(){return m.WebXRDefaultExperience}),c.d(s,"WebXRFeatureName",function(){return m.WebXRFeatureName}),c.d(s,"WebXRFeaturesManager",function(){return m.WebXRFeaturesManager}),c.d(s,"WebXRAbstractFeature",function(){return m.WebXRAbstractFeature}),c.d(s,"WebXRHitTestLegacy",function(){return m.WebXRHitTestLegacy}),c.d(s,"WebXRAnchorSystem",function(){return m.WebXRAnchorSystem}),c.d(s,"WebXRPlaneDetector",function(){return m.WebXRPlaneDetector}),c.d(s,"WebXRBackgroundRemover",function(){return m.WebXRBackgroundRemover}),c.d(s,"WebXRMotionControllerTeleportation",function(){return m.WebXRMotionControllerTeleportation}),c.d(s,"WebXRControllerPointerSelection",function(){return m.WebXRControllerPointerSelection}),c.d(s,"IWebXRControllerPhysicsOptions",function(){return m.IWebXRControllerPhysicsOptions}),c.d(s,"WebXRControllerPhysics",function(){return m.WebXRControllerPhysics}),c.d(s,"WebXRHitTest",function(){return m.WebXRHitTest}),c.d(s,"WebXRFeaturePointSystem",function(){return m.WebXRFeaturePointSystem}),c.d(s,"WebXRHand",function(){return m.WebXRHand}),c.d(s,"WebXRHandTracking",function(){return m.WebXRHandTracking}),c.d(s,"WebXRAbstractMotionController",function(){return m.WebXRAbstractMotionController}),c.d(s,"WebXRControllerComponent",function(){return m.WebXRControllerComponent}),c.d(s,"WebXRGenericTriggerMotionController",function(){return m.WebXRGenericTriggerMotionController}),c.d(s,"WebXRMicrosoftMixedRealityController",function(){return m.WebXRMicrosoftMixedRealityController}),c.d(s,"WebXRMotionControllerManager",function(){return m.WebXRMotionControllerManager}),c.d(s,"WebXROculusTouchMotionController",function(){return m.WebXROculusTouchMotionController}),c.d(s,"WebXRHTCViveMotionController",function(){return m.WebXRHTCViveMotionController}),c.d(s,"WebXRProfiledMotionController",function(){return m.WebXRProfiledMotionController});var d=T!==void 0?T:typeof window!="undefined"?window:void 0;if(d!==void 0){d.BABYLON=x,d.BABYLON=d.BABYLON||{};var x=d.BABYLON;x.Debug=x.Debug||{};var M=[];for(var w in E)x.Debug[w]=E[w],M.push(w);for(var w in m)x[w]=m[w]}var S={AxesViewer:E.AxesViewer,BoneAxesViewer:E.BoneAxesViewer,PhysicsViewer:E.PhysicsViewer,SkeletonViewer:E.SkeletonViewer}}.call(this,c(159))}])})})($b);var PQ=ZN($b.exports),AQ=Object.freeze(Object.assign(Object.create(null),$b.exports,{[Symbol.toStringTag]:"Module",default:PQ}));export{Vt as A,jv as B,pK as C,l8 as D,fK as E,zs as F,l6 as G,kR as H,e6 as I,qP as J,t8 as M,mK as Q,dK as S,g6 as T,jR as V,HF as W,n8 as a,r8 as b,u6 as c,qn as d,h6 as e,_K as f,s8 as g,NR as h,hK as i,_8 as j,h8 as k,mn as l,bK as m,VX as n,zX as o,jX as p,kX as q,GO as r,WF as s,AQ as t,qN as u,Ye as v,g_ as w,KN as x,Ut as y,i8 as z};
//# sourceMappingURL=vendor.85d1c23b.js.map
