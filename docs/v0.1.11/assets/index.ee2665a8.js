import{v as e,i as V,l as b,A as h,I as w,S as G,d as x,u as j,y as S,M,D as B,a as J,b as L,B as g,G as T,c as v,T as q,H as R,e as K,C as Q,f as O,g as W,h as U,j as Y,k as X,m as Z,r as _,n as A,o as P,p as ee,q as te,s as ne,t as re,w as k,x as N,E as ae,Q as oe,z as se,V as le,F as ie,W as ce,J as ue}from"./vendor.85d1c23b.js";const de=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}};de();const me=({mode:n,value:t,setValue:r,theme:o})=>e(V,{defaultLanguage:n,theme:o,options:{minimap:{enabled:!1}},onChange:r,value:t,width:"100%",height:"70vh"}),fe=(n,t)=>{const[r,o]=b(n);return S(()=>{let s=n.concat([]);n.forEach(l=>{l.type==="option"&&l.suboptions&&t&&Object.keys(t).forEach(a=>{const i=t[a];i&&l?.suboptions?.[i]&&(s=s.concat(l.suboptions[i]))})}),o(s)},[t,o,n]),[r]},pe=({hashkey:n,options:t})=>{const[r,o]=b(!1),s=h(()=>{o(!r)},[r]);return e(x,null,e(w,{verticalAlign:"top","aria-label":"Metaframe settings",icon:e(G,null),size:"md",onClick:s}),e(he,{hashkey:n,isOpen:r,setOpen:o,options:t}))},he=({hashkey:n,isOpen:t,setOpen:r,options:o})=>{const[s,l]=j(n||"options",Object.fromEntries(o.filter(c=>c.default).map(c=>[c.name,c.default]))),[a,i]=b(s||{}),[y]=fe(o,a),[C,H]=b(void 0),$=h(c=>{const{name:m,value:u}=c.target;let d=o.concat([]);o.forEach(E=>{E.suboptions&&Object.values(E.suboptions).forEach(F=>d=d.concat(F))});const p=d.find(E=>E.name===m);if(!p){console.error(`No option found for name=${m}`);return}p.type==="boolean"?i({...a,[m]:u==="1"}):i({...a,[m]:u})},[a,i,o]),D=h(()=>{r(!t)},[r,t]),I=h(()=>{const c={};if(Object.keys(a).forEach(u=>{const d=o.find(p=>p.name===u);if(d&&d.validator&&d.type!=="boolean"){const p=d.validator(a[u]);p&&(c[u]=p)}}),Object.keys(c).length>0){H(c);return}H(void 0);const m={};Object.keys(a).forEach(u=>{const d=y.find(p=>p.name===u);d?d.map?m[u]=d.map(a[u]):d.type==="boolean"?m[u]=a[u]===!0||a[u]==="1"||a[u]==="true":m[u]=a[u]:m[u]=a[u]}),r(!t),l(m)},[r,t,o,a,y,l,H]);return S(()=>{if(!t)return;const c=m=>{m.key==="Enter"&&t&&I()};return window.addEventListener("keyup",c),()=>{window.removeEventListener("keyup",c)}},[I,t]),e(W,{placement:"top",onClose:I,isOpen:t},e(M,null,e(B,null,e(J,{borderBottomWidth:"0px"},"Configure metaframe (stored in URL hash params )"),e(L,null,e(g,{maxW:"80%",p:2,borderWidth:"4px",borderRadius:"lg",overflow:"hidden"},e(T,{templateColumns:"repeat(12, 1fr)",gap:6},y.map(c=>e(x,null,e(v,{rowSpan:1,colSpan:4},e(g,{w:"100%",h:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end"},e(q,{textAlign:"right",verticalAlign:"bottom"},c.displayName||c.name,":"))),e(v,{rowSpan:1,colSpan:8}," ",ge(c,a[c.name],$)))),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12}),e(v,{rowSpan:1,colSpan:12},e(R,{spacing:2,direction:"row"},e(K,null),e(w,{size:"lg",color:"red",icon:e(Q,null),onClick:D}),e(w,{size:"lg",color:"green",icon:e(O,null),onClick:I})))))))))},ge=(n,t,r)=>{switch(n.type){case"option":return e(X,{name:n.name,value:t,onChange:r,placeholder:"Select option"},n.options.map(o=>e("option",{value:o},o)));case"boolean":return e(Y,{name:n.name,rightIcon:e(O,null),onChange:r,isChecked:t===!0||t==="1",value:t?0:1});default:return e(g,{w:"100%",h:"10"},e(U,{name:n.name,type:"text",placeholder:"",value:t===void 0?n.default:t,onInput:r}))}},f=Z(n=>({code:void 0,result:void 0,running:!1,mode:"running",setCode:t=>n(r=>({code:t})),setMode:t=>n(r=>({mode:t})),setResult:t=>n(r=>({result:t})),setRunning:t=>n(r=>({running:t}))})),ve=()=>{const n=f(r=>r.running),t=f(r=>r.result);return n?e(_.BeatLoader,{size:8,color:"blue"}):t?t.failure?e(x,null,e(A,{status:"error"},e(P,null),e(te,{mr:2},"Error",t?.failure?.phase?" in phase "+t.failure.phase:"")),e(A,{status:"error"},e(P,null),e(ee,null,`${t.failure?.error}`))):e(A,{status:"success"},e(P,null)):null},ye=Object.getPrototypeOf(async function(){}).constructor,be=(n,t)=>{let r=null,o=Object.keys(t);try{r=ye("exports",`"use strict"; return (async function(${o.join(", ")}){${n}})`)({})}catch(l){return Promise.resolve({failure:{error:l,phase:"compile"}})}if(r){var s="exec";let l=Object.values(t);return r.apply?r.apply(null,l).then(a=>({result:a})).catch(a=>({failure:{error:a,phase:s}})):r.then(a=>a.apply(null,l)).then(a=>({result:a})).catch(a=>({failure:{error:a,phase:s}}))}return Promise.resolve({failure:{error:"compile failed",phase:"compile"}})},z=()=>{const n=ne(),t=f(a=>a.setRunning),r=f(a=>a.setResult),o=f(a=>a.result),s=f(a=>a.running);return S(()=>()=>{if(o?.result&&typeof o?.result=="function")try{o.result()}catch(a){console.error("Failed to cancel without error:",a)}},[o]),[h(async a=>{if(!a||a.trim().length===0){t(!1),r(void 0);return}if(!!n.metaframe){t(!0),r(void 0);try{const i=await be(a,{metaframe:n.metaframe,BABYLON:re});r(i)}catch(i){console.error(i),r({failure:{error:i}})}t(!1)}},[n.metaframe,t,r]),s,o]},we=()=>{const[n,t]=k("mode");f(i=>i.running);const r=f(i=>i.code),[o]=z(),[s,l]=N("text",void 0),a=h(()=>{s!==r&&l(r),t(n==="editing"?"running":"editing")},[n,t,r,s,l]);return S(()=>{n==="running"&&r&&o&&o(r)},[n,r,o]),e(w,{"aria-label":"edit/run",colorScheme:n==="editing"?"green":"blue",onClick:a,icon:n==="editing"?e(O,null):e(ae,null),size:"md"})},Se=({url:n})=>{const[t,r]=b(!1);n=n||`${window.location.origin}${window.location.pathname}/README.md`;const o=h(()=>{r(!t)},[t]);return e(x,null,e(w,{verticalAlign:"top","aria-label":"Help",icon:e(oe,null),size:"md",onClick:o,mr:"2"}),e(Ce,{url:n,isOpen:t,setOpen:r}))},Ce=({isOpen:n,setOpen:t,url:r})=>{const o=h(()=>{t(!n)},[t,n]),s=h(()=>{t(!1)},[t]),l=`https://metapages.github.io/metaframe-markdown/#?url=${r}`;return e(W,{size:"full",placement:"top",onClose:o,isOpen:n,onOverlayClick:s},e(M,null,e(B,null,e(se,{size:"lg",bg:"gray.100"}),e(L,null,e("iframe",{width:"100%",height:"100%",src:l})))))},Ie=[{name:"canvasWidth",displayName:"Canvas width",default:300,type:"number"},{name:"canvasHeight",displayName:"Canvas height",default:100,type:"number"},{name:"theme",displayName:"Light/Dark theme",default:"light",type:"option",options:["light","vs-dark"]},{name:"stretch",displayName:"Stretch to fill container",default:!1,type:"boolean"}],Ee=()=>{const[n]=j("options",{canvasWidth:300,canvasHeight:100,theme:"light",stretch:!1}),t=f(C=>C.code),r=f(C=>C.setCode),[o]=z(),[s]=k("mode"),[l,a]=N("text",void 0);S(()=>{r(l),o&&o(l)},[l,r,o]);const i=e(R,{spacing:2},e(we,null),e(pe,{options:Ie}),e(Se,null)),y=e(g,{w:"100%"},s==="editing"?e(me,{mode:"javascript",theme:n?.theme||"light",setValue:r,value:t}):t&&t.length>0?e("canvas",{style:n?.stretch?{width:"100%",minWidth:n?.canvasWidth||300}:void 0,width:n?.canvasWidth||300,height:n?.canvasHeight||100,id:"renderCanvas"}):null);return e(g,{w:"100%",p:2},e(le,{stretch:!0,spacing:2,alignItems:"flex-start"},y,e(g,null,i),e(ve,null)))},xe=()=>e(Ee,null);ie(e(ue,null,e(ce,null,e(xe,null))),document.getElementById("root"));
//# sourceMappingURL=index.ee2665a8.js.map
